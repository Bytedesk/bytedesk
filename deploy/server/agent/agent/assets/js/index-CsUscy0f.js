import{getApiUrl as b}from"./index-CvNVT5L5.js";import{E as l}from"./index-x2o9k_ZH.js";async function f(t,r,i,a){try{const o=new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14),p=r||`${o}_${t.name}`,s=i||t.type||"image/jpeg",e=new FormData;e.append("file",t),e.append("fileName",p),e.append("fileType",s),e.append("isAvatar",(a==null?void 0:a.isAvatar)||"false"),e.append("kbType",(a==null?void 0:a.kbType)||"feedback");const c=(a==null?void 0:a.visitorUid)||localStorage.getItem("bytedesk_uid")||localStorage.getItem("bytedesk_visitor_uid")||"",u=(a==null?void 0:a.visitorNickname)||localStorage.getItem("bytedesk_nickname")||"",g=(a==null?void 0:a.visitorAvatar)||localStorage.getItem("bytedesk_avatar")||"",v=(a==null?void 0:a.orgUid)||"";e.append("visitorUid",c),e.append("visitorNickname",u),e.append("visitorAvatar",g),e.append("orgUid",v),e.append("client",(a==null?void 0:a.client)||"web"),a!=null&&a.isDebug&&l.debug("handleUpload formData",e);const m=`${b()}/visitor/api/upload/file`,n=await fetch(m,{method:"POST",headers:{},body:e});if(!n.ok)throw new Error(`上传失败: ${n.status} ${n.statusText}`);const d=await n.json();return a!=null&&a.isDebug&&l.debug("upload data:",d),d}catch(o){throw l.error("文件上传失败:",o),o}}async function h(t,r){var i;const a=`screenshot_${new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14)}.jpg`;return((i=(await f(t,a,"image/jpeg",{...r,kbType:"feedback"})).data)==null?void 0:i.fileUrl)||""}export{f as handleUpload,h as uploadScreenshot};
