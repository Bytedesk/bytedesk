"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4285],{54285:function(e,t,n){n.d(t,{Z:function(){return N}});var a=n(90819),r=n.n(a),s=n(89933),i=n.n(s),o=n(45332),u=n.n(o),c=n(15722),l=n(90727),d=n(82669),f=n(80556),g=n(59304),p=n(54881),m=n(2484),v=n(86895),h=n(32525),y=n(82770),x=n(70338),b=n(2907),M=n(33979),w=n(78578),k=n(22115),C=n(76711),j=n.n(C),Z=n(19433),K=n(91361),S=n(88769),z=n(98830),T=n(25784),U=n(89965),R=n(39790),E=n(2250),B=n(44194),O=n(26138),F=n(14906),D=n(39497),P=n(31549),I=function(e){var t,n=e.open,a=e.level,s=e.type,o=e.showKbase,c=void 0===o||o,l=e.isEdit,d=e.onCancel,f=e.onSubmit,g=(0,F.useIntl)(),p=T.A.useForm(),m=u()(p,1)[0],h=(0,K.Z)().translateString,y=(0,z.u)((function(e){return e.currentOrg})),x=(0,S.j)((function(e){return e.kbaseResult})),b=(0,S.j)((function(e){return e.currentKbase})),M=(0,O.v)((function(e){return{currentCategory:e.currentCategory,categoryTreeOptions:e.categoryTreeOptions}})),w=M.currentCategory,k=M.categoryTreeOptions;(0,B.useEffect)((function(){l?m.setFieldsValue({name:h(null==w?void 0:w.name),parentUid:(null==w?void 0:w.parentUid)||D.zBg}):(m.resetFields(),m.setFieldsValue({parentUid:null!=w&&w.uid&&w.uid!==D.zBg?w.uid:D.zBg})),m.setFieldsValue({kbUid:null==b?void 0:b.uid})}),[n,l]);var C=function(){m.validateFields().then(function(){var e=i()(r()().mark((function e(t){var n,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),n=t.parentUid===D.zBg?void 0:t.parentUid,i={uid:l?null==w?void 0:w.uid:"",name:t.name,level:a,type:s,parentUid:n,kbUid:t.kbUid,orgUid:null==y?void 0:y.uid},f(i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),Z.yw.error(g.formatMessage({id:l?"pages.category.update.failed":"pages.category.create.failed"}))}))},I=(0,B.useMemo)((function(){var e,t,n=function e(t){return t.map((function(t){return{title:h(t.title),key:t.key,disabled:t.disabled,children:t.children?e(t.children):void 0}}))}(k||[]);n.length>0&&(null===(e=n[0])||void 0===e?void 0:e.key)===D.zBg&&(n[0].title=g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}));var a=l?null==w?void 0:w.uid:void 0;if(!a)return n;var r=function e(t){var n;t&&(t.disabled=!0,null===(n=t.children)||void 0===n||n.forEach(e))};return function e(t){t&&t.forEach((function(t){var n;t.key===a?r(t):null!==(n=t.children)&&void 0!==n&&n.length&&e(t.children)}))}(n),n.length>0&&(null===(t=n[0])||void 0===t?void 0:t.key)===D.zBg?n:[{title:g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),key:D.zBg,children:void 0}].concat(j()(n))}),[k,l,null==w?void 0:w.uid,g,h]);return(0,P.jsx)("div",{children:(0,P.jsx)(v.Z,{title:l?g.formatMessage({id:"pages.category.drawer.edit"}):g.formatMessage({id:"pages.category.drawer.create"}),open:n,forceRender:!0,onOk:C,onCancel:d,getContainer:!1,okText:g.formatMessage({id:"pages.category.drawer.save"}),cancelText:g.formatMessage({id:"pages.category.drawer.cancel"}),children:(0,P.jsxs)(T.A,{form:m,name:"categoryForm",submitter:!1,children:[(0,P.jsx)(U.Z,{label:g.formatMessage({id:"pages.category.drawer.name",defaultMessage:"分类名称"}),name:"name",rules:[{required:!0,message:g.formatMessage({id:"pages.category.drawer.name.required",defaultMessage:"请输入名称!"})}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&C()},placeholder:g.formatMessage({id:"pages.category.drawer.name.placeholder",defaultMessage:"请输入分类名称"})}}),(0,P.jsx)(R.Z,{name:"parentUid",label:g.formatMessage({id:"pages.category.drawer.parent",defaultMessage:"上级分类"}),allowClear:!0,placeholder:g.formatMessage({id:"pages.category.drawer.parent.placeholder",defaultMessage:"选择上级分类（留空则为顶级）"}),fieldProps:{treeData:I,fieldNames:{label:"title",value:"key",children:"children"},treeDefaultExpandAll:!0,disabled:!1,filterTreeNode:function(e,t){var n;return(null!==(n=null==t?void 0:t.title)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},treeDataSimpleMode:!1}}),c&&(0,P.jsx)(E.Z,{name:"kbUid",label:g.formatMessage({id:"pages.category.drawer.kb"}),allowClear:!0,options:null==x||null===(t=x.data)||void 0===t?void 0:t.content.map((function(e){return{label:h(e.name),value:e.uid}}))})]})})})},L=n(41658),A=n(23753),N=function(e){var t=e.type,n=e.level,a=e.showKbase,s=void 0===a||a,o=(0,F.useIntl)(),C=(0,B.useState)(!0),j=u()(C,2),T=j[0],U=j[1],R=(0,B.useState)(!1),E=u()(R,2),N=E[0],V=E[1],q=(0,B.useState)(1),H=u()(q,2),J=H[0],W=H[1],G=(0,B.useState)(20),Q=u()(G,2),X=Q[0],Y=Q[1],$=(0,B.useState)(0),_=u()($,2),ee=_[0],te=_[1],ne=(0,B.useState)(""),ae=u()(ne,2),re=ae[0],se=ae[1],ie=(0,z.u)((function(e){return e.currentOrg})),oe=(0,S.j)((function(e){return e.currentKbase})),ue=(0,B.useState)(!1),ce=u()(ue,2),le=ce[0],de=ce[1],fe=(0,O.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),ge=fe.categoryTreeOptions,pe=fe.currentCategory,me=fe.setCurrentCategoryUid,ve=(0,K.Z)(),he=ve.translateString,ye=ve.translateStringTranct,xe=v.Z.useModal(),be=u()(xe,2),Me=be[0],we=be[1],ke=function(){var e=i()(r()().mark((function e(){var a,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),a=s?null==oe?void 0:oe.uid:"",e.next=4,(0,L.HK)(t,null==ie?void 0:ie.uid,a,n,{showLoading:!0,pageSize:X,pageNumber:J-1,searchName:re,loadingMessage:o.formatMessage({id:"loading"}),errorMessage:o.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:i=e.sent,A.Z.debug("refreshCategories response: ",i.data),V(!1),i&&i.data&&te(i.data.totalElements||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e){se(e),W(1),setTimeout((function(){ke()}),0)},je=function(e,t){W(e),t&&t!==X&&Y(t),setTimeout((function(){ke()}),0)},Ze=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:U(!1),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:U(!0),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=i()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,L.sT)(t,{showLoading:!0,loadingMessage:o.formatMessage({id:"deleting"}),successMessage:o.formatMessage({id:"delete.success"}),errorMessage:o.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&ke();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=i()(r()().mark((function e(t){var n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={showLoading:!0,loadingMessage:o.formatMessage({id:T?"updating":"creating"}),successMessage:o.formatMessage({id:T?"update.success":"create.success"}),errorMessage:o.formatMessage({id:T?"update.error":"create.error",defaultMessage:T?"Update failed":"Create failed"})},!T){e.next=7;break}return e.next=4,(0,L.ht)(t,n);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,L.i8)(t,n);case 9:e.t0=e.sent;case 10:e.t0&&(de(!1),ke());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,B.useEffect)((function(){s&&(W(1),se(""),ke())}),[oe]),(0,B.useEffect)((function(){W(1),se(""),ke()}),[]);return(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(ee/X)>1||""!==re)&&(0,P.jsx)(h.Z,{placeholder:o.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,P.jsx)(l.Z,{}),suffix:(0,P.jsx)(y.ZP,{type:"text",size:"small",icon:(0,P.jsx)(l.Z,{}),onClick:function(){return Ce(re)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,P.jsx)("span",{onClick:function(e){e.stopPropagation(),se(""),W(1),ke()}})},value:re,onChange:function(e){var t=e.target.value;se(t),t||(W(1),setTimeout((function(){ke()}),0))},onPressEnter:function(e){return Ce(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,P.jsxs)(x.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,P.jsxs)(x.Z,{gap:"small",children:[(0,P.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,P.jsx)(d.Z,{}),onClick:Ze,children:o.formatMessage({id:"create.category"})}),(0,P.jsx)(y.ZP,{size:"small",icon:(0,P.jsx)(f.Z,{spin:N}),onClick:ke,loading:N,children:o.formatMessage({id:"refresh"})})]}),""!==(null==pe?void 0:pe.uid)&&(null==pe?void 0:pe.uid)!==D.zBg&&(0,P.jsx)(b.Z,{menu:{items:[{key:"edit",icon:(0,P.jsx)(g.Z,{}),label:o.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Ke},{key:"delete",icon:(0,P.jsx)(p.Z,{}),label:o.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==D.zBg?Me.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(c.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(he(e.name),"】？"),onOk:function(){Se(e)},onCancel:function(){},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})}):Z.yw.error(o.formatMessage({id:"delete.dept.all.error"}))}(pe)}}]},children:(0,P.jsx)(y.ZP,{size:"small",icon:(0,P.jsx)(m.Z,{})})})]})]}),(0,P.jsx)(M.Z,{defaultSelectedKeys:[null==pe?void 0:pe.uid],selectedKeys:[null==pe?void 0:pe.uid],onSelect:function(e,t){0!==e.length&&me(e[0].toString())},treeData:ge,blockNode:!0,titleRender:function(e){return(0,P.jsx)(w.Z,{title:he(e.title),children:ye(e.title)})}}),Math.ceil(ee/X)>1&&(0,P.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,P.jsx)(k.Z,{size:"small",current:J,pageSize:X,total:ee,onChange:je,onShowSizeChange:je,showSizeChanger:!1,showLessItems:!0}),(0,P.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:o.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:ee})})]}),le&&(0,P.jsx)(I,{open:le,type:t,showKbase:s,isEdit:T,onCancel:function(){de(!1)},onSubmit:ze}),we]})}},88769:function(e,t,n){n.d(t,{j:function(){return d}});var a=n(73193),r=n.n(a),s=n(76711),i=n.n(s),o=n(39497),u=n(58063),c=n(66266),l=n(31403),d=(0,u.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var a=t().kbaseResult.data.content,s=a.findIndex((function(e){return e.uid===n.uid}));if(-1!==s){var o=[].concat(i()(a.slice(0,s)),[n],i()(a.slice(s+1))),u=r()(r()({},t().kbaseResult),{},{data:{content:o}});e({kbaseResult:u,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var a=t().kbaseResult.data.content,s=a.findIndex((function(e){return e.uid===n}));-1!==s?e({kbaseResult:r()(r()({},t().kbaseResult),{},{data:{content:[].concat(i()(a.slice(0,s)),i()(a.slice(s+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:o.wKE})))}}]);