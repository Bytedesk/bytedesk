"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1730],{12073:function(e,r,t){t.d(r,{Z:function(){return M}});var a=t(90819),n=t.n(a),s=t(89933),i=t.n(s),o=t(45332),c=t.n(o),u=t(5286),d=t(36265),l=t(5861);function g(){return p.apply(this,arguments)}function p(){return(p=i()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,r){return h.apply(this,arguments)}function h(){return(h=i()(n()().mark((function e(r,t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:r,captchaCode:t,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=t(80597),v=t(33122),x=t(44194),w=t(31549),M=function(e){var r=e.onKaptchaChange,t=e.onKaptchaCheck,a=(0,l.useIntl)(),s=(0,x.useState)(),o=c()(s,2),d=o[0],p=o[1],h=(0,x.useState)(),M=c()(h,2),b=M[0],y=M[1],k=(0,x.useState)(!1),j=c()(k,2),Z=j[0],C=j[1],S=function(){var e=i()(n()().mark((function e(){var r;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return");case 2:return C(!0),e.prev=3,e.next=6,g();case 6:200===(r=e.sent).code?(p(null==r?void 0:r.data.captchaUid),y(null==r?void 0:r.data.captchaImage)):u.yw.error(a.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),u.yw.error(a.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 13:return e.prev=13,C(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=i()(n()().mark((function e(r,a){var s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(r,a);case 2:s=e.sent,console.log("checkCaptcha response",s),200===s.code?t&&t(!0):t&&t(!1);case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){S()}),[]);return(0,w.jsx)(w.Fragment,{children:b&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.Z,{onChange:function(e){r&&(r(d,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?U(d,e.target.value):t&&t(!1))},prefix:(0,w.jsx)(m.Z,{}),placeholder:a.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,w.jsx)("img",{src:b,alt:"captcha",onClick:S})]})})}},8696:function(e,r,t){t.r(r);var a=t(73193),n=t.n(a),s=t(90819),i=t.n(s),o=t(89933),c=t.n(o),u=t(45332),d=t.n(u),l=t(39778),g=t(26460),p=t(57039),f=t(76630),h=t(82325),m=t(40845),v=t(5328),x=t(12162),w=t(44565),M=t(67922),b=t(58875),y=t(5861),k=t(82600),j=t(98162),Z=t(11258),C=t(2157),S=t(74675),U=t(22504),A=t(44194),q=t(74494),P=t(5286),T=t(36265),z=t(79353),F=t(56321),I=t(51379),E=t(14267),L=t(12073),R=t(87523),N=t(42539),B=t(79093),D=t(31549),H=k.Z.defaultAlgorithm,K=k.Z.darkAlgorithm,$=function(){var e=(0,b.l)((function(e){var r=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:r.borderRadius,":hover":{backgroundColor:r.colorBgTextHover}}}));return(0,D.jsx)("div",{className:e,"data-lang":!0,children:y.SelectLang&&(0,D.jsx)(y.SelectLang,{})})},_=function(e){var r=e.content;return(0,D.jsx)(j.Z,{style:{marginBottom:24},message:r,type:"error",showIcon:!0})},V=function(){var e=m.A.useForm(),r=d()(e,1)[0],t=k.Z.useToken().token,a=(0,q.Z)().isDarkMode,s=(0,A.useRef)(),o=(0,A.useState)(!1),u=d()(o,2),b=u[0],j=u[1],S=(0,y.useModel)("@@initialState"),U=(S.initialState,S.loading,S.refresh,S.setInitialState),H=(0,A.useState)(!1),K=d()(H,2),V=K[0],G=K[1],J=(0,z.t)((function(e){return e.setAccessToken})),Q=(0,I.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid,setUserInfo:e.setUserInfo}})),W=Q.deviceUid,X=Q.setDeviceUid,Y=Q.setUserInfo,O=(0,y.getLocale)();N.Z.debug("register page locale:",O);var ee=(0,y.useIntl)(),re=(0,A.useState)(""),te=d()(re,2),ae=te[0],ne=te[1],se=(0,A.useState)(""),ie=d()(se,2),oe=ie[0],ce=ie[1],ue=function(){var e=c()(i()().mark((function e(t,a){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ne(t),ce(a),r.setFieldValue("captchaCode",a);case 3:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),de=function(){var e=c()(i()().mark((function e(r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j(r);case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();(0,A.useEffect)((function(){(0,R.ME)(),(0,E.Bc)()&&G(!0),(0,E.pr)()}),[]);var le,ge=function(){var e=c()(i()().mark((function e(r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&(0,F.flushSync)((function(){U((function(e){return n()(n()({},e),{},{userInfo:r})}))}));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),pe=function(){var e=c()(i()().mark((function e(r){var t,a,s,o,c,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,N.Z.debug("values:",r),P.yw.loading(ee.formatMessage({id:"registering",defaultMessage:"registering..."})),e.next=5,(0,l.z2)(n()({},r));case 5:if(t=e.sent,N.Z.debug("registerResult:",t),200!==t.code){e.next=19;break}return P.yw.destroy(),P.yw.success(t.message),(s=W)||(s=(0,E.Zx)(),X(s)),o=(0,B.N9)(),c=(0,B.vC)(r.password,o),u={username:null===(a=t.data)||void 0===a?void 0:a.username,passwordHash:c,passwordSalt:o,captchaUid:ae,captchaCode:r.captchaCode,deviceUid:s,platform:T.iw8},fe(u),e.abrupt("return");case 19:P.yw.destroy(),P.yw.error(t.message);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),N.Z.debug(e.t0),P.yw.error(ee.formatMessage({id:"register.error",defaultMessage:"register failed"}));case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(r){return e.apply(this,arguments)}}(),fe=function(){var e=c()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,N.Z.debug("handleSubmit values: ",r),P.yw.loading(ee.formatMessage({id:"logging",defaultMessage:"logging..."})),e.next=5,(0,l.x4)(n()({},r));case 5:t=e.sent,N.Z.debug("LoginResult:",t),200===t.code?(P.yw.destroy(),P.yw.success(ee.formatMessage({id:"login.success",defaultMessage:"login success"})),ge(t.data.user),Y(t.data.user),J(t.data.accessToken),y.history.push("/")):(P.yw.destroy(),P.yw.error(t.message)),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),N.Z.debug(e.t0),P.yw.error(ee.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r){return e.apply(this,arguments)}}();return(0,D.jsxs)(v._Y,{hashed:!1,dark:a,children:[(0,D.jsx)($,{}),(0,D.jsx)("div",{style:{backgroundColor:t.colorBgContainer,textAlign:"center",height:"100vh",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:V?(0,D.jsxs)(x.U,{form:r,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,D.jsx)("img",{alt:"logo",src:"/admin/logo.png"}),title:(0,D.jsx)(y.FormattedMessage,{id:"app.title"}),subTitle:ee.formatMessage({id:"pages.login.registerAccount"}),initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:ee.formatMessage({id:"pages.login.register"})}},onFinish:function(){var e=c()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N.Z.debug("login values:",r),t={username:r.username,password:r.password,mobile:r.mobile,code:r.code,captchaUid:ae,captchaCode:r.captchaCode,platform:T.iw8},N.Z.debug("register info:",t),e.next=5,pe(t);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),children:["error"===status&&(0,D.jsx)(_,{content:ee.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"账户或密码错误"})}),(0,D.jsx)(w.Z,{name:"username",fieldProps:{size:"large",prefix:(0,D.jsx)(p.Z,{})},placeholder:ee.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入邮箱!"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,D.jsx)(w.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,D.jsx)(f.Z,{})},placeholder:ee.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})},{min:8,message:ee.formatMessage({id:"pages.login.password.weak.suggestion",defaultMessage:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})},{validator:(le=c()(i()().mark((function e(r,t){var a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(!((0,B.Qc)(t)<40)){e.next=6;break}return a=ee.formatMessage({id:"pages.login.password.weak.description",defaultMessage:"您当前使用的密码强度较低，存在安全风险。"}),e.abrupt("return",Promise.reject(new Error("".concat(a))));case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e)}))),function(e,r){return le.apply(this,arguments)})}]}),(0,D.jsx)(w.Z,{fieldProps:{size:"large",prefix:(0,D.jsx)(h.Z,{})},name:"mobile",placeholder:ee.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,D.jsx)(m.A.Item,{name:"captchaCode",rules:[{required:!0,message:ee.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,D.jsx)(L.Z,{onKaptchaChange:ue,onKaptchaCheck:de})}),(0,D.jsx)(M.Z,{fieldProps:{size:"large",prefix:(0,D.jsx)(f.Z,{})},captchaProps:{size:"large",disabled:!b},placeholder:ee.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,r){return e?"".concat(r," ").concat(ee.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):ee.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:s,onGetCaptcha:function(){var e=c()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||11!==r.length){e.next=13;break}return t={mobile:r,type:T.zgb,captchaUid:ae,captchaCode:oe,platform:T.iw8},e.next=4,(0,l.Y7)(t);case 4:if(a=e.sent,N.Z.debug("sendMobileCodeResult:",a),200===a.code){e.next=10;break}return P.yw.error(a.message),setTimeout((function(){var e;N.Z.debug("endCaptchaTiming"),null===(e=s.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:P.yw.success(a.message),e.next=14;break;case 13:P.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}),"error"===status&&(0,D.jsx)(_,{content:"验证码错误"}),(0,D.jsx)("div",{style:{marginBottom:64},children:(0,D.jsx)("div",{style:{float:"right"},children:(0,D.jsx)(y.Link,{to:"/auth/login",children:(0,D.jsx)(y.FormattedMessage,{id:"pages.login.submit",defaultMessage:"登录 "})})})})]}):(0,D.jsx)("div",{style:{textAlign:"center",margin:"0 auto"},children:(0,D.jsx)(Z.Z,{description:"only for vip users, please contact: 270580156@qq.com",children:(0,D.jsx)(C.ZP,{type:"primary",onClick:function(){window.open("https://www.weiyuai.cn")},children:"open weiyuai.cn"})})})}),(0,D.jsx)(g.$_,{})]})};r.default=function(){var e=(0,q.Z)().isDarkMode;return(0,D.jsx)(S.ZP,{theme:{algorithm:e?K:H},children:(0,D.jsxs)(U.Z,{children:[(0,D.jsx)(P.ZP,{}),(0,D.jsx)(V,{})]})})}},79093:function(e,r,t){t.d(r,{$g:function(){return d},N9:function(){return c},Qc:function(){return u},vC:function(){return o}});var a=t(46803),n=t.n(a),s=t(42539);function i(e){return"bytedesk_salt"!==e&&e?n().SHA256(e).toString().substring(0,16):"bytedesk_license"}function o(e,r){if(!e)throw new Error("密码不能为空");if(!r)throw new Error("盐值不能为空");try{var t=i(r),a=n().enc.Utf8.parse(t);return n().AES.encrypt(e,a,{mode:n().mode.ECB,padding:n().pad.Pkcs7}).toString()}catch(e){throw s.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function c(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",a=0;a<e;a++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function u(e){var r=0;return e?(e.length>=8&&(r+=20),e.length>=12&&(r+=10),/\d/.test(e)&&(r+=20),/[a-z]/.test(e)&&(r+=20),/[A-Z]/.test(e)&&(r+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(r+=10),Math.min(r,100)):0}function d(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}}}]);