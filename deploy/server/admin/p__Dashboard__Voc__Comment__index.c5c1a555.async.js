"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5357],{11090:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=n.forwardRef(i)},80953:function(e,t,a){var r=a(94433),n=a(38956),s=a(44194),o=a(35074),i=a(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var a=e.fieldProps,s=e.proFieldProps,d=(0,n.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:s},d))};t.Z=s.forwardRef(d)},51039:function(e,t,a){a.r(t),a.d(t,{default:function(){return re}});var r=a(77033),n=a(75112),s=a(39497),o=a(54285),i=a(84176),l=a.n(i),d=a(73193),c=a.n(d),u=a(90819),f=a.n(u),m=a(89933),p=a.n(m),g=a(45332),M=a.n(g),h=a(44194),v=a(86895),x=a(81739),y=a(78578),w=a(82770),b=a(2907),j=a(19433),k=a(14906);function S(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/voc/comment/query/org",{method:"GET",params:c()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return P.apply(this,arguments)}function P(){return(P=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/voc/comment/create",{method:"POST",data:c()(c()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return I.apply(this,arguments)}function I(){return(I=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/voc/comment/update",{method:"POST",data:c()(c()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return A.apply(this,arguments)}function A(){return(A=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/voc/comment/delete",{method:"POST",data:c()(c()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return(O=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/voc/comment/delete/all",{method:"POST",data:c()(c()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=a(98830),z=a(26138),D=a(15722),R=a(90297),U=a(10162),V=a(11090),N=a(2484),B=a(54881),H=a(89246),J=a(96596),L=a.n(J),X=a(5932),G=a(25784),Y=a(89965),Q=a(2250),K=a(80953),W=a(82864),$=a(39487),_=a(31549),ee=function(e){var t=e.isEdit,a=e.isViewMode,r=void 0!==a&&a,n=e.comment,s=e.open,o=(e.level,e.onClose),i=e.onSubmit,l=G.A.useForm(),d=M()(l,1)[0],c=(0,k.useIntl)(),u=(0,q.u)((function(e){return e.currentOrg}));(0,h.useEffect)((function(){t&&n&&d?d.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,description:null==n?void 0:n.description,level:null==n?void 0:n.level,platform:null==n?void 0:n.platform}):(console.log("form resetFields"),d.resetFields())}),[n,d,t]);var f=function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("Form values:",e);var a={uid:t?null==n?void 0:n.uid:"",name:e.name,type:e.type,content:e.description,level:e.level,platform:e.platform,orgUid:null==u?void 0:u.uid};console.log("commentObject:",a),i(a)})).catch((function(e){console.log("Form errors:",e)}))},m=r?c.formatMessage({id:"pages.comment.drawer.view",defaultMessage:"查看评论"}):t?c.formatMessage({id:"pages.comment.drawer.edit",defaultMessage:"编辑评论"}):c.formatMessage({id:"pages.comment.drawer.create",defaultMessage:"新建评论"});return(0,_.jsx)("div",{children:(0,_.jsx)(W.Z,{title:m,width:650,onClose:o,open:s,extra:r?null:(0,_.jsxs)($.Z,{children:[(0,_.jsx)(w.ZP,{onClick:o,children:c.formatMessage({id:"pages.comment.drawer.cancel",defaultMessage:"取消"})}),(0,_.jsx)(w.ZP,{onClick:f,type:"primary",children:c.formatMessage({id:"pages.comment.drawer.save",defaultMessage:"保存"})})]}),children:(0,_.jsxs)(G.A,{form:d,name:"comment",submitter:!t&&!r&&{searchConfig:{resetText:c.formatMessage({id:"pages.comment.drawer.cancel",defaultMessage:"取消"}),submitText:c.formatMessage({id:"pages.comment.drawer.save",defaultMessage:"保存"})},onReset:o},onFinish:t||r?void 0:f,children:[(0,_.jsx)(Y.Z,{label:c.formatMessage({id:"pages.comment.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,readonly:r,tooltip:c.formatMessage({id:"pages.comment.drawer.name.tooltip",defaultMessage:"评论名称"}),fieldProps:{placeholder:c.formatMessage({id:"pages.comment.drawer.name.placeholder",defaultMessage:"请输入评论名称"})}}),(0,_.jsx)(Y.Z,{label:c.formatMessage({id:"pages.comment.drawer.type",defaultMessage:"类型"}),name:"type",readonly:r,tooltip:c.formatMessage({id:"pages.comment.drawer.type.tooltip",defaultMessage:"评论类型"}),fieldProps:{placeholder:c.formatMessage({id:"pages.comment.drawer.type.placeholder",defaultMessage:"请输入评论类型"})}}),(0,_.jsx)(Q.Z,{label:c.formatMessage({id:"pages.comment.drawer.level",defaultMessage:"情感倾向"}),name:"level",readonly:r,tooltip:c.formatMessage({id:"pages.comment.drawer.level.tooltip",defaultMessage:"评论情感倾向"}),options:[{label:"积极",value:"POSITIVE"},{label:"中性",value:"NEUTRAL"},{label:"消极",value:"NEGATIVE"}],fieldProps:{placeholder:c.formatMessage({id:"pages.comment.drawer.level.placeholder",defaultMessage:"请选择情感倾向"})}}),(0,_.jsx)(Y.Z,{label:c.formatMessage({id:"pages.comment.drawer.platform",defaultMessage:"平台"}),name:"platform",readonly:r,tooltip:c.formatMessage({id:"pages.comment.drawer.platform.tooltip",defaultMessage:"评论平台"}),fieldProps:{placeholder:c.formatMessage({id:"pages.comment.drawer.platform.placeholder",defaultMessage:"请输入评论平台"})}}),(0,_.jsx)(K.Z,{label:c.formatMessage({id:"pages.comment.drawer.description",defaultMessage:"内容"}),name:"description",readonly:r,fieldProps:{placeholder:c.formatMessage({id:"pages.comment.drawer.description.placeholder",defaultMessage:"请输入评论内容"}),rows:6},tooltip:c.formatMessage({id:"pages.comment.drawer.description.tooltip",defaultMessage:"详细的评论内容"})})]})})})},te=["current","pageSize","name","description"],ae=function(e){var t=e.level,a=(0,h.useRef)(),r=(0,k.useIntl)(),n=(0,h.useState)(!0),o=M()(n,2),i=o[0],d=o[1],u=(0,h.useState)(!1),m=M()(u,2),g=m[0],Z=m[1],P=(0,h.useState)(1),I=M()(P,2),A=I[0],O=I[1],J=(0,h.useState)(10),G=M()(J,2),Y=G[0],Q=G[1],K=(0,h.useState)(!1),W=M()(K,2),$=W[0],ae=W[1],re=(0,h.useState)({}),ne=M()(re,2),se=ne[0],oe=ne[1],ie=(0,q.u)((function(e){return e.currentOrg})),le=(0,z.v)((function(e){return e.currentCategory})),de=v.Z.useModal(),ce=M()(de,2),ue=ce[0],fe=ce[1],me=(0,h.useState)(0),pe=M()(me,2),ge=pe[0],Me=pe[1],he=(0,h.useState)({}),ve=M()(he,2),xe=ve[0],ye=ve[1],we=function(){ue.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,_.jsx)(D.Z,{}),content:r.formatMessage({id:"deleteAllAffirm",defaultMessage:"Delete all comments?"}),onOk:function(){je()},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})},be=function(){var e=p()(f()().mark((function e(t){var n,s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,E({uid:t.uid});case 3:200===(n=e.sent).code?(j.yw.destroy(),j.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):(j.yw.destroy(),j.yw.error(n.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=p()(f()().mark((function e(){var t,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,F({orgUid:null==ie?void 0:ie.uid});case 3:200===(t=e.sent).code?(j.yw.destroy(),j.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=a.current)||void 0===n||n.reload()):(j.yw.destroy(),j.yw.error(t.message));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=p()(f()().mark((function e(t){var n,s,o,l;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=8;break}return j.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,C(t);case 4:200===(n=e.sent).code?(j.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(s=a.current)||void 0===s||s.reload(),ae(!1)):j.yw.error(n.message),e.next=13;break;case 8:return j.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,T(t);case 11:200===(o=e.sent).code?(j.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(l=a.current)||void 0===l||l.reload(),ae(!1)):j.yw.error(o.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[le]);var Se=function(){var e=p()(f()().mark((function e(a,r,n){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),o=localStorage.getItem(s.LA8),i=c()({orgUid:t===s.Hxq?"":null==ie?void 0:ie.uid,categoryUid:(null==le?void 0:le.uid)===s.zBg?"":null==le?void 0:le.uid,accessToken:o||"",exportType:a},xe),"current"===a?(i.pageNumber=String(A-1),i.pageSize=String(Y)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(i.pageNumber=String(r),i.pageSize=String(n)),window.open((0,X.kG)()+"/api/v1/comment/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Ze=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return Se("range",r,a)}})},s=0;s<r;s++)n();return t},Te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.comment.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.comment.name.tooltip",defaultMessage:"评论名称"}),render:function(e,t){return t.name||"-"}},{title:r.formatMessage({id:"pages.comment.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.comment.type.tooltip",defaultMessage:"评论类型"}),render:function(e,t){return t.type||"-"}},{title:r.formatMessage({id:"pages.comment.description",defaultMessage:"描述"}),dataIndex:"description",ellipsis:!0,hideInSearch:!1,copyable:!0,width:300,tooltip:r.formatMessage({id:"pages.comment.description.tooltip",defaultMessage:"评论描述"}),render:function(e,t){return t.description||"-"}},{title:r.formatMessage({id:"pages.comment.level",defaultMessage:"级别"}),dataIndex:"level",width:100,tooltip:r.formatMessage({id:"pages.comment.level.tooltip",defaultMessage:"评论级别"}),render:function(e,t){if(t.level){return(0,_.jsx)(x.Z,{color:{POSITIVE:"green",NEUTRAL:"blue",NEGATIVE:"red"}[t.level]||"default",children:t.level})}return"-"}},{title:r.formatMessage({id:"pages.comment.platform",defaultMessage:"平台"}),dataIndex:"platform",width:120,tooltip:r.formatMessage({id:"pages.comment.platform.tooltip",defaultMessage:"评论平台"}),render:function(e,t){return t.platform||"-"}},{title:r.formatMessage({id:"pages.comment.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.comment.createdAt.tooltip",defaultMessage:"评论创建时间"}),render:function(e,t){return t.createdAt?L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.comment.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,_.jsx)(y.Z,{title:r.formatMessage({id:"pages.comment.view",defaultMessage:"查看"}),children:(0,_.jsx)("a",{onClick:function(){return function(e){d(!0),Z(!0),oe(e),ae(!0)}(t)},children:(0,_.jsx)(R.Z,{})})},"view"),(0,_.jsx)("a",{onClick:function(){return function(e){d(!0),Z(!1),oe(e),ae(!0)}(t)},children:r.formatMessage({id:"pages.comment.edit",defaultMessage:"Edit"})},"edit"),(0,_.jsx)("a",{onClick:function(){return e=t,void ue.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,_.jsx)(D.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){be(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.comment.delete",defaultMessage:"Delete"})},"delete")]}}],Pe=function(){var e=p()(f()().mark((function e(a,n,o){var i,d,u,m,p,g,M,h,v,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),i=a.current,d=a.pageSize,u=a.name,m=a.description,p=l()(a,te),O(i),Q(d),ye(c()(c()({},p),{},{name:u,description:m})),g=void 0,M=void 0,n&&Object.keys(n).length>0&&(h=Object.keys(n)[0],g=h,M="ascend"===n[h]?"ascend":"descend"),v=c()({pageNumber:i-1,pageSize:d,orgUid:t===s.Hxq?"":null==ie?void 0:ie.uid,name:u,content:m,sortBy:g,sortDirection:M},p),e.next=11,S(v);case 11:if(x=e.sent,console.log("queryCommentsByOrg response:",x,v),200!==x.code){e.next=19;break}return j.yw.destroy(),Me(x.data.totalElements),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 19:return j.yw.destroy(),j.yw.error(x.message),e.abrupt("return",{data:[],success:!1,total:0});case 22:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(H.Z,{columns:Te,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){O(e),Q(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.comment.list",defaultMessage:"社交评论列表"}),toolBarRender:function(){var e=[(0,_.jsx)(w.ZP,{type:"primary",onClick:function(){d(!1),Z(!1),oe({}),ae(!0)},icon:(0,_.jsx)(U.Z,{}),children:r.formatMessage({id:"pages.comment.create",defaultMessage:"添加评论"})},"create")],t=[{key:"export-current",icon:(0,_.jsx)(V.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Se("current")}}];return ge>0&&(ge<=1e3?t.push({key:"export-all",icon:(0,_.jsx)(V.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ge,"条)"),onClick:function(){return Se("all")}}):t.push({key:"export-range",icon:(0,_.jsx)(V.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ge,"条)"),children:Ze(ge)})),e.push((0,_.jsx)(b.Z,{menu:{items:t},placement:"bottom",children:(0,_.jsxs)(w.ZP,{type:"primary",icon:(0,_.jsx)(V.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,_.jsx)(N.Z,{})]})},"export")),e.push((0,_.jsx)(w.ZP,{danger:!0,onClick:we,icon:(0,_.jsx)(B.Z,{}),children:r.formatMessage({id:"pages.comment.deleteAll",defaultMessage:"删除全部"})},"deleteAll")),e},request:Pe}),$&&(0,_.jsx)(ee,{isEdit:i,isViewMode:g,comment:se,level:t,open:$,onClose:function(){ae(!1),Z(!1)},onSubmit:ke}),fe]})},re=function(){var e=(0,n.Z)(),t=e.leftSiderStyle,a=(e.leftSiderWidth,e.contentStyle);return(0,_.jsxs)(r.Z,{style:{height:"100%"},children:[(0,_.jsx)(r.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,_.jsx)(o.Z,{type:s.XFu,level:s.whQ,showKbase:!1})}),(0,_.jsx)(r.Z.Panel,{style:a,children:(0,_.jsx)(ae,{level:s.whQ})})]})}}}]);