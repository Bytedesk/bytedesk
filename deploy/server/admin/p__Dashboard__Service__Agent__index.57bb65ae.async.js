"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{38086:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},r=n(5901),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},11575:function(e,t,n){var i=n(83910),a=n(44194),s=n(85333),r=n(5901),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s.Z}))},l=a.forwardRef(o);t.Z=l},1238:function(e,t,n){var i=n(90819),a=n.n(i),s=n(89933),r=n.n(s),o=n(45332),l=n.n(o),u=n(74491),d=n(5286),c=n(18877),g=n(3771),f=n(31661),v=n(71865),m=n(36265),p=n(14267),h=n(40845),x=n(2685),S=n(5861),w=n(44194),b=n(73001),y=n(42539),M=n(31549);t.Z=function(e){var t,n,i,s,o=h.A.useForm(),j=l()(o,1)[0],k=(0,S.useIntl)(),Z=(0,f.Z)().translateString,C=(0,v.u)((function(e){return e.currentOrg})),F=(0,w.useState)(),T=l()(F,2),U=T[0],q=T[1],A=(0,w.useState)(),R=l()(A,2),P=R[0],L=R[1],E=(0,w.useState)(),I=l()(E,2),O=I[0],z=I[1],B=(0,w.useState)(""),N=l()(B,2),K=N[0],D=N[1],W=(0,w.useRef)(!1),J=(0,w.useRef)(),V=(0,w.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),Q=(0,w.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),H=(0,w.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,w.useCallback)((function(e){j.setFieldValue("welcomeTip",e),H({welcomeTip:e})}),[j,H]);(0,w.useEffect)((function(){if(null!=C&&C.uid&&(J.current!==C.uid&&(J.current=C.uid,W.current=!1),!W.current)){W.current=!0;var e=function(){var e=r()(a()().mark((function e(){var t,n,i,s,r,o,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:C.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(L(n),r=(null==n||null===(i=n.data)||void 0===i?void 0:i.content)||[],o=null==Q?void 0:Q.welcomeKbUid,(l=o||O||(null===(s=r[0])||void 0===s?void 0:s.uid))&&(z(l),j.setFieldValue("welcomeKbUid",l),o!==l&&H({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==C?void 0:C.uid,k,null==Q?void 0:Q.welcomeKbUid,O,j,H]),(0,w.useEffect)((function(){if(null!=C&&C.uid&&O){var e=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:C.uid,kbUid:O},e.next=4,(0,c.pf)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?q(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==C?void 0:C.uid,O,k]),(0,w.useEffect)((function(){if(Q){var e=null==Q?void 0:Q.welcomeFaqs,t=Array.isArray(Q.welcomeFaqUids)?Q.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==U||null===(t=U.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==Q?void 0:Q.welcomeFaqUids,Q]);var G=(0,w.useCallback)((function(e){z(e),j.setFieldValue("welcomeFaqUids",[]),H({welcomeKbUid:e,welcomeFaqUids:[]})}),[H,j]);return(0,w.useEffect)((function(){var e=Z(null==Q?void 0:Q.welcomeTip);void 0!==e&&K!==e&&D(e),null!=Q&&Q.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",Q.welcomeKbUid),O!==Q.welcomeKbUid&&z(Q.welcomeKbUid))}),[Z,null==Q?void 0:Q.welcomeTip,null==Q?void 0:Q.welcomeKbUid,K,j,O,null==P||null===(n=P.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,M.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,M.jsx)(h.A.Item,{name:"welcomeTip",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,M.jsx)(b.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:K,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,M.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==P||null===(i=P.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:Z(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,M.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,M.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==U||null===(s=U.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:Z(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,M.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return H({welcomeFaqUids:e})}}})]})}},11031:function(e,t,n){n.r(t),n.d(t,{default:function(){return Se}});var i=n(44194),a=n(73120),s=n(5861),r=n(76711),o=n.n(r),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),v=n(45332),m=n.n(v),p=n(33154),h=n(2157),x=n(76185),S=n(33122),w=n(92011),b=n(11258),y=n(96082),M=n(95111),j=n(44877),k=n(12201),Z=n(88565),C=n(6430),F=n(12715),T=n(47192),U=n(38086),q=n(33551),A=n(86775),R=n(6992),P=n(41881),L=n(91768),E=n(28172),I=n(35911),O=n(90417),z=n(67878),B=n(5286),N=n(77646),K=n(71865),D=n(76071),W=n(74494),J=n(36265),V=n(28902),Q=n(98896),H=n(93458),Y=(n(14368),n(61401)),G=(n(43769),n(74008)),X=n(29837),_=n(20427),$=n(62742),ee=n(1238),te=n(12745),ne=(n(9290),n(8366)),ie=n(11575),ae=n(42539),se=n(87523),re=n(31549),oe=function(){var e=(0,s.useIntl)(),t=(0,K.u)((function(e){return e.currentOrg})),n=(0,D.Z)(),r=n.leftSiderStyle,l=(n.contentStyle,(0,W.Z)().isDarkMode),d=(0,i.useState)(!1),g=m()(d,2),v=g[0],J=g[1],oe=(0,i.useState)([]),le=m()(oe,2),ue=le[0],de=le[1],ce=(0,i.useState)(),ge=m()(ce,2),fe=ge[0],ve=ge[1],me=(0,i.useState)(""),pe=m()(me,2),he=pe[0],xe=pe[1],Se=(0,i.useState)("tips"),we=m()(Se,2),be=we[0],ye=we[1],Me=(0,i.useState)(!1),je=m()(Me,2),ke=je[0],Ze=je[1],Ce=(0,i.useState)(null),Fe=m()(Ce,2),Te=Fe[0],Ue=Fe[1],qe=(0,i.useMemo)((function(){return ue.find((function(e){return e.uid===fe}))||null}),[ue,fe]),Ae=(0,i.useState)(!1),Re=m()(Ae,2),Pe=Re[0],Le=Re[1],Ee=(0,i.useState)(!1),Ie=m()(Ee,2),Oe=Ie[0],ze=Ie[1],Be=(0,V.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),Ne=Be.setCurrentAgentSettings,Ke=Be.currentAgentSettings,De=(0,i.useState)(!1),We=m()(De,2),Je=We[0],Ve=We[1],Qe=(0,i.useRef)(""),He=(0,i.useMemo)((function(){var e;return null!==(e=null!=Ke?Ke:qe)&&void 0!==e?e:null}),[Ke,qe]),Ye=(0,i.useCallback)((function(e){if(Ke){var t=Ke.draftServiceSettings||Ke.serviceSettings||{};Ne(f()(f()({},Ke),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[Ke,Ne]),Ge=(0,i.useCallback)((function(e){if(Ke){var t=Ke.draftInviteSettings||Ke.inviteSettings||{};Ne(f()(f()({},Ke),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[Ke,Ne]),Xe=(0,i.useCallback)((function(e){if(Ke){var t=Ke.draftMessageLeaveSettings||Ke.messageLeaveSettings||{};Ne(f()(f()({},Ke),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[Ke,Ne]),_e=(0,i.useCallback)((function(e){if(Ke){var t=Ke.draftWorktimeSettings||Ke.worktimeSettings||{};Ne(f()(f()({},Ke),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[Ke,Ne]),$e=(0,i.useCallback)((function(e){if(Ke){var t=Ke.draftQueueSettings||Ke.queueSettings||{};Ne(f()(f()({},Ke),{},{draftQueueSettings:f()(f()({},t),e)}))}}),[Ke,Ne]),et=(0,i.useCallback)((function(e){Ke&&Ne(f()(f()({},Ke),{},{draftRightPanelTabs:e}))}),[Ke,Ne]),tt=(0,i.useCallback)((function(e){Ke&&Ne(f()(f()({},Ke),e))}),[Ke,Ne]),nt=(0,i.useMemo)((function(){if(!he)return ue;var e=he.toLowerCase();return ue.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[ue,he]),it=(0,i.useCallback)(function(){var e=c()(u()().mark((function e(n,i){var a,s,r,o,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return J(!0),a="welcome",e.prev=4,r=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=9,(0,N.u9)(o);case 9:l=e.sent,ae.Z.debug("加载客服配置模板列表: ",l,o),d=(null==l||null===(s=l.data)||void 0===s?void 0:s.content)||[],de(d),!(d.length>0)||fe&&d.some((function(e){return e.uid===fe}))||(ve(d[0].uid),null!=i&&i.keepActive||ye(a));case 14:return e.prev=14,J(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[4,,14,17]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,fe]);(0,i.useEffect)((function(){it(he)}),[null==t?void 0:t.uid]),(0,i.useEffect)((function(){qe?(Ne(qe),Qe.current=JSON.stringify(null!=qe?qe:{}),Ve(!1)):(Ne(null),Qe.current=JSON.stringify({}),Ve(!1))}),[fe]),(0,i.useEffect)((function(){if(qe)try{var e=JSON.stringify(null!=Ke?Ke:{});Ve(e!==Qe.current)}catch(e){Ve(!0)}}),[Ke,null==qe?void 0:qe.uid]);var at=function(){var n=c()(u()().mark((function n(i){var a,s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=i?i:qe)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,N.SJ)(s);case 6:r=n.sent,console.log("删除客服配置模板结果：",r,s),r&&200===r.code?(B.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),it(he)):B.yw.error((null==r?void 0:r.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),st=function(){var n=c()(u()().mark((function n(i,a){var s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:i,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,N.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,N.iO)(s);case 10:n.t0=n.sent;case 11:(r=n.t0)&&200===r.code?(B.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),it(he)):B.yw.error((null==r?void 0:r.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),B.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),rt=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},ot=function(e){if(e){var t=rt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputAssociationKbUid","inputPreviewEnabled","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var a=null==e?void 0:e[i];if(Array.isArray(a)){var s=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickButtonUids","quickButtons"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var i=function(e){if(e)return rt(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},lt=function(e){if(e)return rt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},ut=function(e){if(e)return rt(e,["name","description","color","order"])},dt=function(e){if(e)return rt(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},ct=function(e){if(e)return rt(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},gt=function(e){if(e)return rt(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},ft=function(e){if(e)return rt(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},vt=function(e){if(e)return rt(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},mt=function(e){if(e)return rt(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},pt=function(e){return(Array.isArray(e)?e:[]).filter((function(e){return!(null==e||!e.title||null==e||!e.url)})).map((function(e){return{title:String(e.title),url:String(e.url)}}))},ht=function(){var n=c()(u()().mark((function n(){var i,a,s,r,o,l,d,c;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=qe&&qe.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Le(!0),n.prev=4,a=Ke&&Ke.uid===qe.uid?Ke:qe,s=function(e,t){return f()(f()({},e||{}),t||{})},r={uid:qe.uid,orgUid:null==t?void 0:t.uid,name:null==a?void 0:a.name,description:null==a?void 0:a.description,isDefault:null==a?void 0:a.isDefault,enabled:null==a?void 0:a.enabled,serviceSettings:ot(s(null==a?void 0:a.serviceSettings,null==a?void 0:a.draftServiceSettings)),inviteSettings:lt(s(null==a?void 0:a.inviteSettings,null==a?void 0:a.draftInviteSettings)),intentionSettings:ut(s(null==a?void 0:a.intentionSettings,null==a?void 0:a.draftIntentionSettings)),maxThreadCount:null==a?void 0:a.maxThreadCount,timeoutRemindEnabled:null==a?void 0:a.timeoutRemindEnabled,timeoutRemindTime:null==a?void 0:a.timeoutRemindTime,timeoutRemindTip:null==a?void 0:a.timeoutRemindTip,messageLeaveSettings:dt(s(null==a?void 0:a.messageLeaveSettings,null==a?void 0:a.draftMessageLeaveSettings)),worktimeSettings:gt(s(null==a?void 0:a.worktimeSettings,null==a?void 0:a.draftWorktimeSettings)),autoReplySettings:ft(s(null==a?void 0:a.autoReplySettings,null==a?void 0:a.draftAutoReplySettings)),queueSettings:ct(s(null==a?void 0:a.queueSettings,null==a?void 0:a.draftQueueSettings)),rateDownSettings:vt(s(null==a?void 0:a.rateDownSettings,null==a?void 0:a.draftRateDownSettings)),agentStatusSettings:mt(s(null==a?void 0:a.agentStatusSettings,null==a?void 0:a.draftAgentStatusSettings)),rightPanelTabs:pt(null!==(i=null==a?void 0:a.draftRightPanelTabs)&&void 0!==i?i:null==a?void 0:a.rightPanelTabs)},n.next=10,(0,N.wU)(r);case 10:o=n.sent,console.log("保存客服配置模板结果：",o,r),o&&200===o.code?(B.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),c=null!==(l=null!==(d=null==o?void 0:o.data)&&void 0!==d?d:a)&&void 0!==l?l:{},Qe.current=JSON.stringify(c),Ve(!1),it(he,{keepActive:!0})):B.yw.error((null==o?void 0:o.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),B.yw.error("保存失败");case 19:return n.prev=19,Le(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),xt=function(){var n=c()(u()().mark((function n(){var i,a,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=qe&&qe.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ze(!0),n.prev=4,!Je){n.next=8;break}return n.next=8,ht();case 8:return i={uid:qe.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,N.Xy)(i);case 11:(a=n.sent)&&200===a.code?(B.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Qe.current=JSON.stringify(null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{}),Ve(!1),it(he)):B.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),B.yw.error("发布失败");case 19:return n.prev=19,ze(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),St=(0,i.useMemo)((function(){return null!=qe&&qe.uid?[{key:"welcome",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(k.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,re.jsx)(ee.Z,{serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},onServiceSettingsChange:Ye})},{key:"tips",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(Z.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,re.jsx)($.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},onServiceSettingsChange:Ye})},{key:"service",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(C.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,re.jsx)(_.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},agentMeta:{maxThreadCount:null==He?void 0:He.maxThreadCount,timeoutRemindTime:null==He?void 0:He.timeoutRemindTime},onServiceSettingsChange:Ye,onAgentMetaChange:tt})}].concat(o()((0,se.OJ)()?[{key:"inputAssociation",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(F.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.input.association",defaultMessage:"输入联想"})]}),children:(0,re.jsx)(H.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},onServiceSettingsChange:Ye})}]:[]),o()((0,se.OJ)()?[{key:"rate",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(T.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,re.jsx)(Q.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},onServiceSettingsChange:Ye})}]:[]),o()((0,se.OJ)()?[{key:"messageLeave",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(U.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,re.jsx)(te.Z,{variant:"agent",messageLeaveSettings:{live:null==He?void 0:He.messageLeaveSettings,draft:null==He?void 0:He.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Xe})}]:[]),o()((0,se.OJ)()?[{key:"queue",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(ie.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"agent.settings.queue",defaultMessage:"排队设置"})]}),children:(0,re.jsx)(ne.Z,{variant:"agent",queueSettings:{live:null==He?void 0:He.queueSettings,draft:null==He?void 0:He.draftQueueSettings},onQueueSettingsChange:$e})}]:[]),o()([]),o()((0,se.OJ)()?[{key:"toolbar",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(q.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,re.jsx)(G.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},settingsUid:qe.uid,isActive:"toolbar"===be,onServiceSettingsChange:Ye})}]:[]),o()((0,se.OJ)()?[{key:"right",label:(0,re.jsxs)("span",{children:[(0,re.jsx)(A.Z,{})," ",(0,re.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,re.jsx)(Y.Z,{variant:"agent",serviceSettings:{live:null==He?void 0:He.serviceSettings,draft:null==He?void 0:He.draftServiceSettings},agentRightPanelTabs:{live:null==He?void 0:He.rightPanelTabs,draft:null==He?void 0:He.draftRightPanelTabs},onServiceSettingsChange:Ye,onAgentRightPanelTabsChange:et,settingsUid:qe.uid,isActive:"right"===be})}]:[]),o()([]),o()([])):[]}),[null==qe?void 0:qe.uid,He,Ye,Ge,Xe,_e,$e,et,e,be]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,re.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,re.jsxs)(z.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,re.jsx)(h.ZP,{size:"small",icon:(0,re.jsx)(R.Z,{}),type:"primary",onClick:function(){Ue(null),Ze(!0)},children:(0,re.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:v,children:[(0,re.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,re.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,re.jsx)(S.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:he,onChange:function(e){return xe(e.target.value)},onPressEnter:function(e){it(he)},allowClear:!0,size:"middle"}),(0,re.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return it(he)},children:"搜索"})]})}),(0,re.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,re.jsx)(w.Z,{dataSource:nt,locale:{emptyText:(0,re.jsx)(b.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:b.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,re.jsx)(w.Z.Item,{style:fe===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ve(e.uid)},children:(0,re.jsx)(w.Z.Item.Meta,{title:(0,re.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,re.jsx)(x.Z,{size:4,children:e.isDefault?(0,re.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,re.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,re.jsx)(p.Z.Panel,{children:qe?(0,re.jsx)(z.Z,{title:(0,re.jsxs)(x.Z,{children:[(0,re.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",qe.name||qe.uid]}),(0,re.jsx)(M.Z,{checked:qe.enabled,onChange:function(e){return st(qe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,re.jsx)(h.ZP,{size:"small",icon:(0,re.jsx)(P.Z,{}),onClick:function(e){var t;e.stopPropagation(),Ue(null!=(t=qe)?t:qe),Ze(!0)},children:"编辑"}),(0,re.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),at(qe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,re.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,re.jsx)(L.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),qe.isDefault?(0,re.jsx)(y.Z,{color:"blue",children:"默认"}):null]}),extra:(0,re.jsxs)(x.Z,{children:[(0,re.jsx)(j.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),xt()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,re.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Oe,type:"default",icon:(0,re.jsx)(E.Z,{}),children:(0,re.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,re.jsx)(h.ZP,{onClick:function(){qe&&(Ne(qe),Qe.current=JSON.stringify(null!=qe?qe:{}),Ve(!1))},disabled:!Je,icon:(0,re.jsx)(I.Z,{}),children:(0,re.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,re.jsx)(h.ZP,{type:"primary",loading:Pe,onClick:ht,disabled:!Je,icon:(0,re.jsx)(O.Z,{}),children:(0,re.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,re.jsx)(a.Z,{activeKey:be,onChange:ye,items:St,style:{minHeight:"calc(100vh - 280px)"}})}):(0,re.jsx)(z.Z,{children:(0,re.jsx)(b.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,re.jsx)(X.Z,{open:ke,onOpenChange:Ze,orgUid:(null==t?void 0:t.uid)||"",record:Te,onSuccess:function(){Ze(!1),it(he)}})]})},le=n(68293),ue=n(84176),de=n.n(ue);function ce(e){return ge.apply(this,arguments)}function ge(){return(ge=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/agent/status/query/org",{method:"GET",params:f()(f()({},t),{},{channel:J.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=n(31362),ve=n(94011),me=n(96596),pe=n.n(me),he=["current","pageSize"],xe=function(){var e=(0,s.useIntl)(),t=(0,i.useRef)(),n=(0,i.useState)(1),a=m()(n,2),r=a[0],o=a[1],l=(0,i.useState)(10),d=m()(l,2),g=d[0],v=d[1],p=(0,K.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,re.jsx)(s.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,re.jsx)(s.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,re.jsx)(re.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,re.jsx)(s.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,re.jsx)(s.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,re.jsx)(y.Z,{color:"green",children:(0,re.jsx)(s.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,re.jsx)(y.Z,{color:"red",children:(0,re.jsx)(s.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,re.jsx)(y.Z,{color:"orange",children:(0,re.jsx)(s.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,re.jsx)(s.FormattedMessage,{id:"agent.status.duration",defaultMessage:"Duration"}),dataIndex:"durationSeconds",hideInSearch:!0,tooltip:(0,re.jsx)(s.FormattedMessage,{id:"agent.tooltip.duration",defaultMessage:"Time spent before next status"}),render:function(e,t){return function(e){if(null==e)return"-";var t=Math.max(0,Math.floor(e)),n=Math.floor(t/86400),i=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),s=t%60,r=[];return n>0&&r.push("".concat(n,"d")),(i>0||n>0)&&r.push("".concat(i,"h")),(a>0||i>0||n>0)&&r.push("".concat(a,"m")),r.push("".concat(s,"s")),r.join(" ")}(t.durationSeconds)}},{title:(0,re.jsx)(s.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,re.jsx)(s.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,i){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],S=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae.Z.debug("handleExportExcel",r,g),t=localStorage.getItem(J.LA8),window.open((0,se.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==p?void 0:p.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,re.jsx)(fe.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,i){var a,s,r,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ae.Z.debug("request:",t,n,i),a=t.current,s=t.pageSize,r=de()(t,he),o(a),v(s),l=f()({pageNumber:a-1,pageSize:s,orgUid:null==p?void 0:p.uid},r),e.next=7,ce(l);case 7:return d=e.sent,ae.Z.debug("queryAgentStatusByOrg response:",l,d),200===d.code||B.yw.error(d.message),e.abrupt("return",{data:null==d?void 0:d.data.content,success:!0,total:null==d?void 0:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){o(e),v(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,re.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,re.jsx)(I.Z,{}),children:(0,re.jsx)(s.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,re.jsx)(h.ZP,{onClick:S,type:"primary",icon:(0,re.jsx)(ve.Z,{}),children:(0,re.jsx)(s.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},Se=function(){return(0,re.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,re.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,re.jsx)(le.Z,{})},{key:"settings",label:(0,re.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,re.jsx)(oe,{})},{key:"agentStatus",label:(0,re.jsx)(s.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,re.jsx)(xe,{})}]})}}}]);