"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5800],{47944:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),s=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},i=n(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=s.forwardRef(o)},55785:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),s=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},i=n(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=s.forwardRef(o)},12322:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),s=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},i=n(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=s.forwardRef(o)},68263:function(e,t,n){var r=n(94433),s=n(38956),a=n(37150),i=n(44194),o=n(85618),u=n(35865),l=n(31549),c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var n=e.fieldProps,d=e.children,f=e.params,g=e.proFieldProps,m=e.mode,p=e.valueEnum,h=e.request,v=e.showSearch,x=e.options,M=(0,s.Z)(e,c),y=(0,i.useContext)(o.Z);return(0,l.jsx)(u.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,a.h)(p),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:x,mode:m,showSearch:v,getPopupContainer:y.getPopupContainer},n),ref:t,proFieldProps:g},M),{},{children:d}))},g=i.forwardRef((function(e,t){var n=e.fieldProps,c=e.children,f=e.params,g=e.proFieldProps,m=e.mode,p=e.valueEnum,h=e.request,v=e.options,x=(0,s.Z)(e,d),M=(0,r.Z)({options:v,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),y=(0,i.useContext)(o.Z);return(0,l.jsx)(u.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,a.h)(p),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:y.getPopupContainer},M),ref:t,proFieldProps:g},x),{},{children:c}))})),m=i.forwardRef(f);m.SearchSelect=g,m.displayName="ProFormComponent",t.Z=m},74545:function(e,t,n){n.d(t,{xg:function(){return d}});var r=n(90819),s=n.n(r),a=n(73193),i=n.n(a),o=n(89933),u=n.n(o),l=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/form/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95822:function(e,t,n){n.d(t,{Bo:function(){return p},Gx:function(){return d},hW:function(){return v},sz:function(){return g}});var r=n(90819),s=n.n(r),a=n(73193),i=n.n(a),o=n(89933),u=n.n(o),l=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ticket/process/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ticket/process/delete",{method:"POST",data:{uid:t,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ticket/process/deploy",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ticket/process/undeploy",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51718:function(e,t,n){n.d(t,{Bg:function(){return d},Ch:function(){return p},Gv:function(){return M},L3:function(){return S},bD:function(){return g},mE:function(){return k},nQ:function(){return j},nU:function(){return v},oX:function(){return Z}});var r=n(90819),s=n.n(r),a=n(73193),i=n.n(a),o=n(89933),u=n.n(o),l=n(19736),c=n(6844);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){var n,r,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,r=t.workgroupUid,a=t.type,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(r),{method:"GET",params:{channel:c.XtJ,type:a}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return w.apply(this,arguments)}function w(){return(w=u()(s()().mark((function e(t,n){var r,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,a=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(r,"/orgs/").concat(a,"/bindings"),{method:"POST",data:i()(i()({},n),{},{channel:c.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return P.apply(this,arguments)}function P(){return(P=u()(s()().mark((function e(t,n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(t,"/workgroups/").concat(n,"/categories"),{method:"GET",params:{channel:c.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},88449:function(e,t,n){var r=n(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},16561:function(e,t,n){n.r(t),n.d(t,{default:function(){return De}});var r=n(73193),s=n.n(r),a=n(90819),i=n.n(a),o=n(89933),u=n.n(o),l=n(45332),c=n.n(l),d=n(44194),f=n(19736),g=n(31167),m=n(85255),p=n(3925),h=n(9428),v=n(48769),x=n(71876),M=n(12792),y=n(66810),k=n(65513),b=n(77359),j=n(79866),w=n(68779),Z=n(83910),C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"},S=n(54183),P=function(e,t){return d.createElement(S.Z,(0,Z.Z)({},e,{ref:t,icon:C}))};var F=d.forwardRef(P),T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888.3 693.2c-42.5-24.6-94.3-18-129.2 12.8l-53-30.7V523.6c0-15.7-8.4-30.3-22-38.1l-136-78.3v-67.1c44.2-15 76-56.8 76-106.1 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 49.3 31.8 91.1 76 106.1v67.1l-136 78.3c-13.6 7.8-22 22.4-22 38.1v151.6l-53 30.7c-34.9-30.8-86.8-37.4-129.2-12.8-53.5 31-71.7 99.4-41 152.9 30.8 53.5 98.9 71.9 152.2 41 42.5-24.6 62.7-73 53.6-118.8l48.7-28.3 140.6 81c6.8 3.9 14.4 5.9 22 5.9s15.2-2 22-5.9L674.5 740l48.7 28.3c-9.1 45.7 11.2 94.2 53.6 118.8 53.3 30.9 121.5 12.6 152.2-41 30.8-53.6 12.6-122-40.7-152.9zm-673 138.4a47.6 47.6 0 01-65.2-17.6c-13.2-22.9-5.4-52.3 17.5-65.5a47.6 47.6 0 0165.2 17.6c13.2 22.9 5.4 52.3-17.5 65.5zM522 463.8zM464 234a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm170 446.2l-122 70.3-122-70.3V539.8l122-70.3 122 70.3v140.4zm239.9 133.9c-13.2 22.9-42.4 30.8-65.2 17.6-22.8-13.2-30.7-42.6-17.5-65.5s42.4-30.8 65.2-17.6c22.9 13.2 30.7 42.5 17.5 65.5z"}}]},name:"deployment-unit",theme:"outlined"},E=function(e,t){return d.createElement(S.Z,(0,Z.Z)({},e,{ref:t,icon:T}))};var I=d.forwardRef(E),z=n(10162),L=n(59304),q=n(54881),O=n(47944),U=n(80556),B=n(55785),A=n(93527),H=n(14888),J=n(26710),V=n(88449),D=n(51718),R=n(26557),N=n(26407),X=n(20744),G=n(6844),Q=(0,R.Ue)()((0,N.mW)((0,N.tJ)((0,X.n)((function(e){return{currentTicketSettings:null,ticketSettingsMap:{},setCurrentTicketSettings:function(t){return e({currentTicketSettings:t})},setTicketSettingsForWorkgroup:function(t,n){return e((function(e){e.ticketSettingsMap[t]=n}))},updateCurrentTicketSettings:function(t){return e((function(e){e.currentTicketSettings&&("function"==typeof t?t(e.currentTicketSettings):e.currentTicketSettings=s()(s()({},e.currentTicketSettings),t))}))},removeTicketSettingsForWorkgroup:function(t){return e((function(e){delete e.ticketSettingsMap[t]}))},clearAll:function(){return e({currentTicketSettings:null,ticketSettingsMap:{}})}}})),{name:G.rpR+"_TICKET"}))),_=n(5089),W=n(29589),K=n(58867),Y=n(98986),$=n(96123),ee=n(1691),te=n(8781),ne=n(48907),re=n(82690),se=n(30064),ae=n(31549),ie=_.Z.Text,oe=_.Z.Title,ue=(W.Z.Option,function(e){var t,n,r,s=e.settings,a=e.onChange,i=e.hideRequireLogin,o=void 0!==i&&i,u=(0,f.useIntl)(),l=se.A.useForm(),g=c()(l,1)[0];(0,d.useEffect)((function(){g.setFieldsValue(s)}),[s,g]);var m=K.Z.useWatch("numberPrefix",g),p=K.Z.useWatch("numberLength",g),x=K.Z.useWatch("enableAutoClose",g),M=null!==(t=null!=m?m:s.numberPrefix)&&void 0!==t?t:"",y=null!==(n=null!=p?p:s.numberLength)&&void 0!==n?n:0,b=("boolean"==typeof x||s.enableAutoClose,Math.max(0,y-(null!==(r=null==M?void 0:M.length)&&void 0!==r?r:0))),j=b>0?"".concat("0".repeat(Math.max(b-3,0)),"123").slice(-b):"123",Z="".concat(M).concat(j),C=(0,d.useMemo)((function(){return[{value:G.tSv,label:u.formatMessage({id:"ticket.settings.assignment.type.manual",defaultMessage:"手动分配"})}]}),[u]);return(0,ae.jsxs)(se.A,{form:g,layout:"vertical",submitter:!1,style:{padding:"20px 0"},onValuesChange:function(e){return a(e)},children:[(0,ae.jsxs)("div",{style:{marginBottom:32},children:[(0,ae.jsxs)(h.Z,{size:"small",children:[(0,ae.jsx)(w.Z,{}),(0,ae.jsx)(oe,{level:5,style:{margin:0},children:u.formatMessage({id:"ticket.settings.basic.section.number",defaultMessage:"工单编号设置"})})]}),(0,ae.jsxs)(Y.Z,{gutter:24,children:[(0,ae.jsx)($.Z,{span:12,children:(0,ae.jsx)(se.A.Item,{name:"numberPrefix",label:(0,ae.jsxs)(h.Z,{children:[u.formatMessage({id:"ticket.settings.basic.numberPrefix",defaultMessage:"工单编号前缀"}),(0,ae.jsx)(ee.Z,{title:u.formatMessage({id:"ticket.settings.basic.numberPrefix.tooltip",defaultMessage:"工单编号的前缀，如 TK、WO 等"}),children:(0,ae.jsx)(re.Z,{style:{color:"#999"}})})]}),children:(0,ae.jsx)(v.Z,{maxLength:10,placeholder:u.formatMessage({id:"ticket.settings.basic.numberPrefix.placeholder",defaultMessage:"如：TK、WO"})})})}),(0,ae.jsx)($.Z,{span:12,children:(0,ae.jsx)(se.A.Item,{name:"numberLength",label:(0,ae.jsxs)(h.Z,{children:[u.formatMessage({id:"ticket.settings.basic.numberLength",defaultMessage:"编号长度"}),(0,ae.jsx)(ee.Z,{title:u.formatMessage({id:"ticket.settings.basic.numberLength.tooltip",defaultMessage:"工单编号的总长度，包括前缀"}),children:(0,ae.jsx)(re.Z,{style:{color:"#999"}})})]}),children:(0,ae.jsx)(te.Z,{min:Math.max(M.length+1,6),max:20,placeholder:u.formatMessage({id:"ticket.settings.basic.numberLength.placeholder",defaultMessage:"如：8"})})})})]}),(0,ae.jsx)(ie,{type:"secondary",children:u.formatMessage({id:"ticket.settings.basic.sample",defaultMessage:"示例编号：{sample}"},{sample:Z})})]}),!o&&(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(ne.Z,{style:{margin:"16px 0"}}),(0,ae.jsxs)("div",{children:[(0,ae.jsx)(oe,{level:5,children:u.formatMessage({id:"ticket.settings.basic.section.visitor",defaultMessage:"访客创建限制"})}),(0,ae.jsx)(se.A.Item,{name:"requireLogin",label:u.formatMessage({id:"ticket.settings.basic.requireLogin.label",defaultMessage:"必须登录后才能创建工单"}),valuePropName:"checked",children:(0,ae.jsx)(k.Z,{checkedChildren:u.formatMessage({id:"ticket.settings.basic.requireLogin.on",defaultMessage:"需要登录"}),unCheckedChildren:u.formatMessage({id:"ticket.settings.basic.requireLogin.off",defaultMessage:"允许匿名"})})}),(0,ae.jsx)(ie,{type:"secondary",children:u.formatMessage({id:"ticket.settings.basic.requireLogin.desc",defaultMessage:"启用后，访客必须先通过登录认证才能提交工单。"})})]})]}),(0,ae.jsx)(ne.Z,{style:{margin:"16px 0"}}),(0,ae.jsxs)("div",{children:[(0,ae.jsx)(oe,{level:5,children:u.formatMessage({id:"ticket.settings.basic.section.assignment",defaultMessage:"工单分配方式"})}),(0,ae.jsx)(se.A.Item,{name:"assignmentMode",label:u.formatMessage({id:"ticket.settings.basic.assignment.label",defaultMessage:"分配方式"}),children:(0,ae.jsx)(W.Z,{options:C,placeholder:u.formatMessage({id:"ticket.settings.basic.assignment.placeholder",defaultMessage:"请选择分配方式"})})}),(0,ae.jsx)(ie,{type:"secondary",children:u.formatMessage({id:"ticket.settings.basic.assignment.desc",defaultMessage:"用于控制工单创建后如何自动或人工分配给客服人员。"})})]})]})}),le=n(76711),ce=n.n(le),de=n(51891),fe=n(77753),ge=n(46141),me=n(20921),pe=n(51936),he=n(48965),ve=n(12322),xe=n(2696),Me=n(9170),ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},ke=function(e,t){return d.createElement(S.Z,(0,Z.Z)({},e,{ref:t,icon:ye}))};var be=d.forwardRef(ke),je=n(47598),we=n(88165),Ze=n(44679),Ce=_.Z.Text,Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"tmp_".concat(e,"_").concat(Math.floor(1e3*Math.random()))},Pe=function(e){return ce()(e).sort((function(e,t){var n,r,s=null!==(n=e.orderIndex)&&void 0!==n?n:0,a=null!==(r=t.orderIndex)&&void 0!==r?r:0;return s===a?(e.name||"").localeCompare(t.name||""):s-a}))},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e,t){var n,r,s,a,i;return{uid:null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:Se(t),name:(null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"").trim(),description:null!==(s=null==e?void 0:e.description)&&void 0!==s?s:"",enabled:!1!==(null==e?void 0:e.enabled),defaultCategory:null!==(a=null==e?void 0:e.defaultCategory)&&void 0!==a&&a,orderIndex:null!==(i=null==e?void 0:e.orderIndex)&&void 0!==i?i:t}})),n=Pe(t).map((function(e,t){return s()(s()({},e),{},{orderIndex:t})})),r=!1,a=n.map((function(e){return e.defaultCategory&&e.enabled?r?s()(s()({},e),{},{defaultCategory:!1}):(r=!0,e):e}));if(!r){var i=a.findIndex((function(e){return e.enabled}));i>=0&&(a[i]=s()(s()({},a[i]),{},{defaultCategory:!0}),r=!0)}return!r&&a.length>0&&(a[0]=s()(s()({},a[0]),{},{defaultCategory:!0,enabled:!0})),a},Te=function(e){var t=e.items,n=e.onChange,r=e.categoryType,a=(0,f.useIntl)(),o=(0,Ze.Z)().translateString,l=K.Z.useForm(),g=c()(l,1)[0],m=(0,d.useState)(!1),x=c()(m,2),j=x[0],w=x[1],Z=(0,d.useState)(null),C=c()(Z,2),S=C[0],P=C[1],F=(0,H.u)((function(e){return e.currentOrg})),T=(0,je.v)((function(e){return e.categoryTreeOptions})),E=(0,je.v)((function(e){return e.categoryResult})),I=(0,d.useState)(!1),z=c()(I,2),O=z[0],U=z[1],B=(0,d.useState)([]),J=c()(B,2),V=J[0],D=J[1],R=(0,d.useState)(!1),N=c()(R,2),X=N[0],Q=N[1],_=null!=r?r:G.FXY,W=(0,d.useMemo)((function(){return Fe(null!=t?t:[])}),[t]),Y=(0,d.useMemo)((function(){var e,t=W.filter((function(e){return e.enabled})).length;return{enabled:t,disabled:W.length-t,defaultUid:null===(e=W.find((function(e){return e.defaultCategory&&e.enabled})))||void 0===e?void 0:e.uid}}),[W]);(0,d.useEffect)((function(){null!=F&&F.uid&&(0,we.HK)(_,F.uid,void 0,G.whQ,{pageSize:200,showLoading:!1})}),[null==F?void 0:F.uid,_]);var $=(0,d.useMemo)((function(){return T.filter((function(e){return e.key!==G.zBg}))}),[T]),te=(0,d.useMemo)((function(){var e,t=[];return function e(n){null!=n&&n.length&&n.forEach((function(n){var r;null!=n&&n.uid&&n.uid!==G.zBg&&(t.push(n),null!==(r=n.children)&&void 0!==r&&r.length&&e(n.children))}))}(null==E||null===(e=E.data)||void 0===e?void 0:e.content),t}),[E]),ne=(0,d.useMemo)((function(){var e=new Map;return te.forEach((function(t){t.uid&&e.set(t.uid,t)})),e}),[te]);(0,d.useEffect)((function(){if(O){var e=W.map((function(e){return e.uid})).filter((function(e){return"string"==typeof e&&e.length>0}));D(e)}}),[O,W]);var re=function(e){n(Fe(e))},se=function(){var e=u()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=F&&F.uid){e.next=3;break}return A.yw.warning(a.formatMessage({id:"ticket.settings.category.select.noOrg",defaultMessage:"请先选择一个组织"})),e.abrupt("return");case 3:if(U(!0),0!==$.length){e.next=12;break}return Q(!0),e.prev=6,e.next=9,(0,we.HK)(_,F.uid,void 0,G.whQ,{pageSize:200,showLoading:!1});case 9:return e.prev=9,Q(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])})));return function(){return e.apply(this,arguments)}}(),ie=function(e,t){if(e){var n=ce()(W),r=n.findIndex((function(t){return t.uid===e}));if(!(r<0)){var a="up"===t?r-1:r+1;if(!(a<0||a>=n.length)){var i=n.splice(r,1),o=c()(i,1)[0];n.splice(a,0,o);var u=n.map((function(e,t){return s()(s()({},e),{},{orderIndex:t})}));re(u)}}}},oe=function(){var e=u()(i()().mark((function e(){var t,n,r,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(r=e.sent,null!=S&&S.uid){e.next=6;break}return e.abrupt("return");case 6:o=s()(s()({},S),{},{name:r.name.trim(),description:(null!==(t=r.description)&&void 0!==t?t:"").trim(),enabled:!1!==r.enabled,defaultCategory:!0===r.defaultCategory,orderIndex:null!==(n=S.orderIndex)&&void 0!==n?n:0}),u=W.map((function(e){return e.uid===S.uid?s()(s()({},e),o):e})),re(u),w(!1),P(null),g.resetFields(),A.yw.success(a.formatMessage({id:"ticket.settings.category.update.success",defaultMessage:"分类已更新"})),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),ue=[{title:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.name",defaultMessage:"分类名称"}),dataIndex:"name",key:"name",render:function(e,t){return(0,ae.jsxs)(h.Z,{size:8,children:[t.defaultCategory&&t.enabled?(0,ae.jsx)(y.Z,{color:"gold",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.badge",defaultMessage:"默认"})}):null,(0,ae.jsx)(Ce,{strong:!0,children:o(t.name)||"--"})]})}},{title:(0,ae.jsx)(f.FormattedMessage,{id:"common.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",render:function(e,t){return(0,ae.jsx)(k.Z,{checked:!!t.enabled,onChange:function(e){return function(e,t){if(e){var n=W.map((function(n){return n.uid===e?s()(s()({},n),{},{enabled:t}):n}));re(n)}}(t.uid,e)}})}},{title:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default",defaultMessage:"默认分类"}),dataIndex:"defaultCategory",key:"defaultCategory",render:function(e,t){return(0,ae.jsx)(ee.Z,{title:t.enabled?a.formatMessage({id:"ticket.settings.category.makeDefault",defaultMessage:"设为默认分类"}):a.formatMessage({id:"ticket.settings.category.default.disabled",defaultMessage:"启用后方可设为默认"}),children:(0,ae.jsx)(p.ZP,{type:"text",icon:t.enabled&&t.defaultCategory?(0,ae.jsx)(he.Z,{style:{color:"#faad14"}}):(0,ae.jsx)(ve.Z,{}),disabled:!t.enabled,onClick:function(){return function(e){if(e){var t=W.map((function(t){return s()(s()({},t),{},{defaultCategory:t.uid===e})}));re(t)}}(t.uid)}})})}},{title:(0,ae.jsx)(f.FormattedMessage,{id:"common.order",defaultMessage:"排序"}),key:"order",render:function(e,t,n){return(0,ae.jsxs)(h.Z,{children:[(0,ae.jsx)(ee.Z,{title:a.formatMessage({id:"common.move.up",defaultMessage:"上移"}),children:(0,ae.jsx)(p.ZP,{type:"text",icon:(0,ae.jsx)(xe.Z,{}),disabled:0===n,onClick:function(){return ie(t.uid,"up")}})}),(0,ae.jsx)(ee.Z,{title:a.formatMessage({id:"common.move.down",defaultMessage:"下移"}),children:(0,ae.jsx)(p.ZP,{type:"text",icon:(0,ae.jsx)(Me.Z,{}),disabled:n===W.length-1,onClick:function(){return ie(t.uid,"down")}})})]})}},{title:(0,ae.jsx)(f.FormattedMessage,{id:"common.actions",defaultMessage:"操作"}),key:"actions",render:function(e,t){return(0,ae.jsxs)(h.Z,{size:8,children:[(0,ae.jsx)(p.ZP,{type:"link",icon:(0,ae.jsx)(L.Z,{}),onClick:function(){return function(e){P(e),g.setFieldsValue({name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory}),w(!0)}(t)},children:(0,ae.jsx)(f.FormattedMessage,{id:"common.edit",defaultMessage:"编辑"})}),(0,ae.jsx)(b.Z,{title:a.formatMessage({id:"ticket.settings.category.delete.confirm",defaultMessage:"确认删除该分类？"}),onConfirm:function(){return function(e){if(e){var t=W.filter((function(t){return t.uid!==e}));re(t),A.yw.success(a.formatMessage({id:"ticket.settings.category.delete.success",defaultMessage:"分类已删除"}))}}(t.uid)},okText:a.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:a.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ae.jsx)(p.ZP,{type:"link",danger:!0,icon:(0,ae.jsx)(q.Z,{}),children:(0,ae.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})})]})}}];return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsxs)(de.Z,{title:(0,ae.jsxs)(h.Z,{size:8,children:[(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.title",defaultMessage:"分类列表"}),(0,ae.jsx)(y.Z,{color:"blue",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.summary",defaultMessage:"启用 {enabled} / 禁用 {disabled}",values:{enabled:Y.enabled,disabled:Y.disabled}})}),Y.defaultUid?(0,ae.jsx)(y.Z,{color:"gold",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.current",defaultMessage:"默认已设置"})}):(0,ae.jsx)(y.Z,{color:"red",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.missing",defaultMessage:"请设置默认分类"})})]}),extra:(0,ae.jsx)(p.ZP,{type:"primary",icon:(0,ae.jsx)(be,{}),onClick:se,children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.selectFromTree",defaultMessage:"从分类树选择"})}),styles:{body:{padding:0}},children:[(0,ae.jsx)(fe.Z,{columns:ue,dataSource:W,rowKey:function(e){var t,n;return null!==(t=null!==(n=e.uid)&&void 0!==n?n:e.name)&&void 0!==t?t:Se()},pagination:!1}),(0,ae.jsx)("div",{style:{padding:"16px 24px"},children:(0,ae.jsx)(Ce,{type:"secondary",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.hint",defaultMessage:"至少保留一个启用的分类，并指定默认分类供访客预选。"})})})]}),(0,ae.jsx)(ge.Z,{open:O,title:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.title",defaultMessage:"选择工单分类"}),onOk:function(){if(0!==V.length){var e=new Set(V),t=W.filter((function(t){return t.uid&&e.has(t.uid)})),n=[];V.forEach((function(e){var r;if(!t.some((function(t){return t.uid===e}))){var s=ne.get(e);s&&n.push({uid:s.uid,name:null!==(r=s.name)&&void 0!==r?r:s.uid,description:"",enabled:!0,defaultCategory:!1,orderIndex:t.length+n.length})}}));var r=[].concat(ce()(t),n);re(r),U(!1),A.yw.success(a.formatMessage({id:"ticket.settings.category.select.success",defaultMessage:"分类列表已更新"}))}else A.yw.warning(a.formatMessage({id:"ticket.settings.category.select.empty",defaultMessage:"请选择至少一个分类"}))},onCancel:function(){U(!1),Q(!1)},confirmLoading:X,destroyOnHidden:!0,width:480,okText:a.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:a.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ae.jsxs)(h.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,ae.jsx)(Ce,{type:"secondary",children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.tip",defaultMessage:"勾选需要在工单配置中启用的分类。"})}),X?(0,ae.jsx)("div",{style:{textAlign:"center",padding:"32px 0"},children:(0,ae.jsx)(me.Z,{})}):$.length>0?(0,ae.jsx)(pe.Z,{checkable:!0,selectable:!1,checkedKeys:V,onCheck:function(e){var t;Array.isArray(e)?D(e):D(null!==(t=e.checked)&&void 0!==t?t:[])},treeData:$,height:360,titleRender:function(e){var t="string"==typeof e.title?e.title:"",n=o(t)||t||"--";return(0,ae.jsx)(ee.Z,{title:n,children:n})}}):(0,ae.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.emptyTree",defaultMessage:"暂无可用分类，请先在分类管理中创建。"})})]})}),(0,ae.jsx)(ge.Z,{open:j,title:S?a.formatMessage({id:"ticket.settings.category.modal.edit",defaultMessage:"编辑分类"}):a.formatMessage({id:"ticket.settings.category.modal.create",defaultMessage:"新增分类"}),onOk:oe,onCancel:function(){w(!1),P(null),g.resetFields()},destroyOnHidden:!0,width:520,children:(0,ae.jsxs)(K.Z,{form:g,layout:"vertical",children:[(0,ae.jsx)(K.Z.Item,{name:"name",label:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.name",defaultMessage:"分类名称"}),rules:[{required:!0,message:a.formatMessage({id:"ticket.settings.category.form.name.required",defaultMessage:"请输入分类名称"})},{max:32,message:a.formatMessage({id:"ticket.settings.category.form.name.length",defaultMessage:"名称长度不超过32个字符"})}],children:(0,ae.jsx)(v.Z,{placeholder:a.formatMessage({id:"ticket.settings.category.form.name.placeholder",defaultMessage:"例如：售后支持"}),allowClear:!0})}),(0,ae.jsx)(K.Z.Item,{name:"description",label:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.description",defaultMessage:"描述"}),rules:[{max:120,message:a.formatMessage({id:"ticket.settings.category.form.description.length",defaultMessage:"描述长度不超过120个字符"})}],children:(0,ae.jsx)(v.Z.TextArea,{rows:3,placeholder:a.formatMessage({id:"ticket.settings.category.form.description.placeholder",defaultMessage:"用于帮助访客理解分类用途，可选填"}),allowClear:!0})}),(0,ae.jsx)(K.Z.Item,{name:"enabled",label:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,ae.jsx)(k.Z,{})}),(0,ae.jsx)(K.Z.Item,{name:"defaultCategory",label:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.default",defaultMessage:"设为默认分类"}),valuePropName:"checked",children:(0,ae.jsx)(k.Z,{disabled:0===W.length&&!S})})]})})]})},Ee=function(e){var t=e.open,n=e.record,r=e.ticketType,s=e.onClose,a=e.onSuccess,o=(0,f.useIntl)(),l=(0,H.u)((function(e){return e.currentOrg})),g=K.Z.useForm(),m=c()(g,1)[0],p=(0,d.useState)(!1),h=c()(p,2),x=h[0],M=h[1],y=!(null==n||!n.uid);(0,d.useEffect)((function(){t&&(m.resetFields(),n&&m.setFieldsValue({name:n.name,description:n.description}))}),[t,null==n?void 0:n.uid]);var k=function(){var e=u()(i()().mark((function e(){var t,u,c,d;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.validateFields();case 3:if(t=e.sent,null!=l&&l.uid){e.next=6;break}return e.abrupt("return");case 6:if(M(!0),u=n?n.type===G.IpQ?G.IpQ:G.dCh:r,!y){e.next=15;break}return e.next=11,(0,D.mE)({uid:n.uid,orgUid:l.uid,name:t.name,description:t.description,type:u});case 11:200===(null==(c=e.sent)?void 0:c.code)?(A.yw.success(o.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),a(c.data),s()):A.yw.error((null==c?void 0:c.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:return e.next=17,(0,D.Gv)({orgUid:l.uid,name:t.name,description:t.description,type:u});case 17:200===(null==(d=e.sent)?void 0:d.code)?(A.yw.success(o.formatMessage({id:"common.created",defaultMessage:"创建成功"})),a(d.data),s()):A.yw.error((null==d?void 0:d.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"}));case 19:return e.prev=19,M(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,,19,22]])})));return function(){return e.apply(this,arguments)}}();return(0,ae.jsx)(ge.Z,{title:y?o.formatMessage({id:"ticket.settings.edit.title",defaultMessage:"编辑工单配置"}):o.formatMessage({id:"ticket.settings.create.title",defaultMessage:"新建工单配置"}),width:520,open:t,onCancel:s,onOk:k,okText:y?o.formatMessage({id:"common.save",defaultMessage:"保存"}):o.formatMessage({id:"common.create",defaultMessage:"创建"}),cancelText:o.formatMessage({id:"common.cancel",defaultMessage:"取消"}),confirmLoading:x,destroyOnHidden:!0,children:(0,ae.jsxs)(K.Z,{form:m,layout:"vertical",children:[(0,ae.jsx)(K.Z.Item,{label:o.formatMessage({id:"common.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0,message:o.formatMessage({id:"common.name.required",defaultMessage:"请输入名称"})}],children:(0,ae.jsx)(v.Z,{maxLength:64,showCount:!0,placeholder:o.formatMessage({id:"common.name.placeholder",defaultMessage:"请输入名称"})})}),(0,ae.jsx)(K.Z.Item,{label:o.formatMessage({id:"common.description",defaultMessage:"描述"}),name:"description",children:(0,ae.jsx)(v.Z.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:o.formatMessage({id:"common.description.placeholder",defaultMessage:"请输入描述"})})})]})})},Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},ze=function(e,t){return d.createElement(S.Z,(0,Z.Z)({},e,{ref:t,icon:Ie}))};var Le=d.forwardRef(ze),qe=n(68263),Oe=n(95822),Ue=n(74545),Be=n(65819),Ae=n(36125),He=function(e){var t=e.orgUid,n=e.process,r=e.draftProcess,s=e.form,a=e.draftForm,o=e.ticketScope,l=void 0===o?G.dCh:o,g=e.customFormEnabled,m=void 0!==g&&g,v=e.onProcessChange,x=e.onFormChange,y=e.onCustomFormEnabledChange,b=(0,f.useIntl)(),j=(0,Ze.Z)().translateString,w=se.A.useForm(),Z=c()(w,1)[0],C=(0,d.useState)(!1),S=c()(C,2),P=S[0],F=S[1],T=(0,d.useState)(!1),E=c()(T,2),I=E[0],z=E[1],L=(0,d.useState)([]),q=c()(L,2),O=q[0],B=q[1],H=(0,d.useState)([]),J=c()(H,2),V=J[0],D=J[1],R=l===G.IpQ?G.T2C:G.w_8,N=l===G.IpQ?G.O4J:G.Qou,X=!t,Q=Boolean(m),W=X||!Q,K=(0,d.useCallback)(u()(i()().mark((function e(){var n,r,s,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return B([]),e.abrupt("return");case 3:return F(!0),e.prev=4,n={orgUid:t,pageNumber:0,pageSize:100,status:G.wMY,type:N,sortBy:"updatedAt",sortDirection:"DESC"},e.next=8,(0,Oe.Gx)(n);case 8:r=e.sent,Ae.Z.debug("queryProcessesByOrg response:",null==r?void 0:r.data,n),200===(null==r?void 0:r.code)?B(null!==(s=null==r||null===(a=r.data)||void 0===a?void 0:a.content)&&void 0!==s?s:[]):A.yw.error((null==r?void 0:r.message)||b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load processes",e.t0),A.yw.error(b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"}));case 17:return e.prev=17,F(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,N]),Y=(0,d.useCallback)(u()(i()().mark((function e(){var n,r,s,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return D([]),e.abrupt("return");case 3:return z(!0),e.prev=4,n={orgUid:t,type:R,status:G.eiy,pageNumber:0,pageSize:100},e.next=8,(0,Ue.xg)(n);case 8:r=e.sent,Ae.Z.debug("queryFormsByOrg response:",null==r?void 0:r.data,n),200===(null==r?void 0:r.code)?(o=null!==(s=null==r||null===(a=r.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.filter((function(e){return e.status===G.eiy})))&&void 0!==s?s:[],D(o)):A.yw.error((null==r?void 0:r.message)||b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load ticket forms",e.t0),A.yw.error(b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"}));case 17:return e.prev=17,z(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,R]);(0,d.useEffect)((function(){if(!t)return B([]),void D([]);K(),Y()}),[t,K,Y]);var $=(0,d.useMemo)((function(){var e=new Map;return O.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[n,r].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[O,n,r]),ee=(0,d.useMemo)((function(){var e=new Map;return V.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[s,a].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[V,s,a]),te=(0,d.useMemo)((function(){return $.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[$]),ne=(0,d.useMemo)((function(){return ee.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[ee]),re=(0,d.useMemo)((function(){var e=new Map;return $.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[$]),ie=(0,d.useMemo)((function(){var e=new Map;return ee.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[ee]),oe=(0,d.useMemo)((function(){return void 0!==r?r?r.uid:void 0:null==n?void 0:n.uid}),[r,n]),ue=(0,d.useMemo)((function(){return void 0!==a?a?a.uid:void 0:null==s?void 0:s.uid}),[a,s]);(0,d.useEffect)((function(){Z.setFieldsValue({processUid:oe,formUid:ue,customFormEnabled:Q})}),[Z,oe,ue,Q]);var le=(0,d.useCallback)((function(e){X||y(e)}),[X,y]);return(0,ae.jsx)(se.A,{form:Z,layout:"vertical",submitter:!1,style:{width:"100%"},children:(0,ae.jsxs)(h.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,ae.jsxs)(de.Z,{title:b.formatMessage({id:"ticket.settings.workflow.process.title",defaultMessage:"工单流程绑定"}),extra:(0,ae.jsxs)(h.Z,{size:8,children:[(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(Le,{}),onClick:function(){var e=(0,Be.LE)();window.open(e,"_blank","noopener,noreferrer")},disabled:X,children:b.formatMessage({id:"ticket.settings.workflow.process.openBuilder",defaultMessage:"打开流程设计器"})}),(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(U.Z,{}),onClick:K,loading:P,disabled:X})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,ae.jsx)(qe.Z,{name:"processUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.process.placeholder",defaultMessage:"选择一个已部署的流程"}),options:te,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:X,loading:P,onChange:function(e){return function(e){if(e){var t=re.get(e);t&&v(t)}else v(null)}(e)}}}),te.length||P?null:(0,ae.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.process.emptyOptions",defaultMessage:"暂无已部署流程，请先在流程中心创建并部署"})})]}),(0,ae.jsxs)(de.Z,{title:b.formatMessage({id:"ticket.settings.workflow.form.title",defaultMessage:"工单表单绑定"}),extra:(0,ae.jsxs)(h.Z,{size:8,children:[(0,ae.jsx)(k.Z,{size:"small",checked:Q,onChange:le,disabled:X,checkedChildren:b.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:b.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(Le,{}),onClick:function(){var e=(0,Be.P1)();window.open(e,"_blank","noopener,noreferrer")},disabled:W,children:b.formatMessage({id:"ticket.settings.workflow.form.openBuilder",defaultMessage:"打开表单设计器"})}),(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(U.Z,{}),onClick:Y,loading:I,disabled:W})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,ae.jsx)(_.Z.Text,{type:"secondary",children:b.formatMessage({id:"ticket.settings.workflow.form.custom.desc",defaultMessage:"启用后，桌面端工单抽屉会根据所选流程关联的表单渲染自定义字段。"})}),(0,ae.jsx)(qe.Z,{name:"formUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.form.placeholder",defaultMessage:"选择一个已发布的工单表单"}),options:ne,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:W,loading:I,onChange:function(e){return function(e){if(e){var t=ie.get(e);t&&x(t)}else x(null)}(e)}}}),!Q||ne.length||I?null:(0,ae.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.form.emptyOptions",defaultMessage:"暂无已发布表单，请先在表单中心创建并发布"})})]})]})})},Je=function(e){return e?JSON.parse(JSON.stringify(e)):null},Ve=function(e){return e===G.IpQ?G.IpQ:G.dCh},De=function(){var e=(0,f.useIntl)(),t=(0,H.u)((function(e){return e.currentOrg})),n=(0,J.Z)().isDarkMode,r=(0,V.Z)().leftSiderStyle,a=(0,d.useState)([]),o=c()(a,2),l=o[0],Z=o[1],C=(0,d.useState)(""),S=c()(C,2),P=S[0],T=S[1],E=(0,d.useState)(),R=c()(E,2),N=R[0],X=R[1],_=(0,d.useState)("basic"),W=c()(_,2),K=W[0],Y=W[1],$=(0,d.useState)(!1),ee=c()($,2),te=ee[0],ne=ee[1],re=(0,d.useState)(!1),se=c()(re,2),ie=se[0],oe=se[1],le=(0,d.useState)(!1),ce=c()(le,2),de=ce[0],fe=ce[1],ge=(0,d.useState)(!1),me=c()(ge,2),pe=me[0],he=me[1],ve=(0,d.useState)(null),xe=c()(ve,2),Me=xe[0],ye=xe[1],ke=(0,d.useState)(!1),be=c()(ke,2),je=be[0],we=be[1],Ze=(0,d.useRef)(""),Ce=(0,d.useState)(G.IpQ),Se=c()(Ce,2),Pe=Se[0],Ie=Se[1],ze=Q((function(e){return{setCurrentTicketSettings:e.setCurrentTicketSettings,currentTicketSettings:e.currentTicketSettings,updateCurrentTicketSettings:e.updateCurrentTicketSettings}})),Le=ze.setCurrentTicketSettings,qe=ze.currentTicketSettings,Oe=ze.updateCurrentTicketSettings,Ue=null==t?void 0:t.uid,Be=(0,d.useMemo)((function(){return(N?l.find((function(e){return e.uid===N})):null)||null}),[l,N]),De=(0,d.useMemo)((function(){if(!P)return l;var e=P.toLowerCase();return l.filter((function(t){return((t.name||t.uid||"")+(t.description||"")).toLowerCase().includes(e)}))}),[l,P]),Re=(0,d.useCallback)(function(){var e=u()(i()().mark((function e(n){var r,s,a,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return ne(!0),e.prev=3,s=(null!=n?n:"").trim(),a={orgUid:t.uid,pageNumber:0,pageSize:200,searchText:s,type:Pe},e.next=8,(0,D.Bg)(a);case 8:o=e.sent,Ae.Z.debug("queryTicketSettingsByOrg response:",null==o?void 0:o.data,a),u=(null==o||null===(r=o.data)||void 0===r?void 0:r.content)||[],Z(u),!(u.length>0)||N&&u.some((function(e){return e.uid===N}))||X(u[0].uid);case 13:return e.prev=13,ne(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,N,Pe]);(0,d.useEffect)((function(){Re(P)}),[null==t?void 0:t.uid,Pe]),(0,d.useEffect)((function(){if(Be){var e=Je(Be);Le(e),Ze.current=JSON.stringify(null!=Be?Be:{}),we(!1)}else Le(null),Ze.current=JSON.stringify({}),we(!1)}),[Be,Le]),(0,d.useEffect)((function(){if(qe)try{var e=JSON.stringify(qe);we(e!==Ze.current)}catch(e){we(!0)}else we(!1)}),[qe]);var Ne=function(){var n=u()(i()().mark((function n(r){var a,o,u,l,c;return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:Be)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,D.oX)({uid:a.uid,type:Ve(a.type)});case 6:if(o=n.sent,!((Array.isArray(null==o?void 0:o.data)?o.data:[]).length>0)){n.next=11;break}return A.yw.warning(e.formatMessage({id:"ticket.settings.delete.hasBinding",defaultMessage:"当前工单设置已绑定工作组，请先解绑后再删除"})),n.abrupt("return");case 11:return u={uid:a.uid,orgUid:null==t?void 0:t.uid},l=s()(s()({},u),{},{type:Ve(a.type)}),n.next=15,(0,D.nU)(l);case 15:c=n.sent,console.log("deleteTicketSettings response:",c,l),200===(null==c?void 0:c.code)?(A.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Z((function(e){return e.filter((function(e){return e.uid!==a.uid}))})),N===a.uid&&X(void 0)):A.yw.error((null==c?void 0:c.message)||"删除失败"),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(3),console.error(n.t0),A.yw.error(e.formatMessage({id:"ticket.settings.delete.failed",defaultMessage:"删除失败"}));case 24:case"end":return n.stop()}}),n,null,[[3,20]])})));return function(e){return n.apply(this,arguments)}}(),Xe=function(){var n=u()(i()().mark((function n(r,s){var a;return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,D.mE)({uid:r,orgUid:null==t?void 0:t.uid,enabled:s,type:Ve(null==$e?void 0:$e.type)});case 3:(a=n.sent)&&200===a.code?(A.yw.success(e.formatMessage({id:s?"common.enabled":"common.disabled",defaultMessage:s?"已启用":"已停用"})),Re(P)):A.yw.error((null==a?void 0:a.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),A.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ge=function(e,t){return void 0!==e?null===e?"":null==e?void 0:e.uid:null==t?void 0:t.uid},Qe=function(e){var t,n,r,a;if(!e)return null;var i,o=null!==(t=e.draftBasicSettings)&&void 0!==t?t:e.basicSettings,u=o?s()({},o):void 0,l=null!==(n=e.draftNotificationSettings)&&void 0!==n?n:e.notificationSettings,c=null!==(r=e.draftCategorySettings)&&void 0!==r?r:e.categorySettings,d=c?Fe(null!==(a=c.items)&&void 0!==a?a:[]):void 0,f=Ge(e.draftProcess,e.process),g=Ge(e.draftForm,e.form);return{uid:e.uid,orgUid:e.orgUid,type:Ve(e.type),name:e.name,description:e.description,isDefault:null==e?void 0:e.isDefault,enabled:null==e?void 0:e.enabled,customFormEnabled:null==e?void 0:e.customFormEnabled,basicSettings:u,notificationSettings:l,categorySettings:d?{items:(i=d,null==i?void 0:i.map((function(e,t){var n;return{uid:e.uid,name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory,orderIndex:null!==(n=e.orderIndex)&&void 0!==n?n:t}})))}:void 0,processUid:f,formUid:g}},_e=function(){var n=u()(i()().mark((function n(){var r,a,o,u,l,c;return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=qe)&&r.uid){n.next=4;break}return A.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return",!1);case 4:if(oe(!0),n.prev=5,o=Qe(r)){n.next=10;break}return A.yw.error(e.formatMessage({id:"ticket.settings.save.payload.empty",defaultMessage:"保存数据为空，无法提交"})),n.abrupt("return",!1);case 10:return u=s()(s()({},o),{},{orgUid:null==t?void 0:t.uid,type:null!==(a=null==o?void 0:o.type)&&void 0!==a?a:Pe}),n.next=13,(0,D.mE)(u);case 13:if(l=n.sent,console.log("updateTicketSettings response:",l,u),200!==(null==l?void 0:l.code)){n.next=25;break}return A.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),i=null==l?void 0:l.data,d=r,f=void 0,g=void 0,m=void 0,p=void 0,h=void 0,v=void 0,c=i?s()(s()(s()({},d),i),{},{basicSettings:null!==(f=i.basicSettings)&&void 0!==f?f:d.basicSettings,draftBasicSettings:null!==(g=null!==(m=null!==(p=i.draftBasicSettings)&&void 0!==p?p:i.basicSettings)&&void 0!==m?m:d.draftBasicSettings)&&void 0!==g?g:d.basicSettings,draftCategorySettings:null!==(h=i.draftCategorySettings)&&void 0!==h?h:d.draftCategorySettings,categorySettings:null!==(v=i.categorySettings)&&void 0!==v?v:d.categorySettings}):d,Ze.current=JSON.stringify(null!=c?c:{}),we(!1),Z((function(e){return e.map((function(e){return e.uid===r.uid?c:e}))})),Le(Je(c)),n.abrupt("return",!0);case 25:return A.yw.error((null==l?void 0:l.message)||e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 27:n.next=34;break;case 29:return n.prev=29,n.t0=n.catch(5),console.error("保存失败:",n.t0),A.yw.error(e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 34:return n.prev=34,oe(!1),n.finish(34);case 37:return n.abrupt("return",!1);case 38:case"end":return n.stop()}var i,d,f,g,m,p,h,v}),n,null,[[5,29,34,37]])})));return function(){return n.apply(this,arguments)}}(),We=function(){var n=u()(i()().mark((function n(){var r,s,a,o;return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=qe)&&r.uid){n.next=4;break}return A.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return");case 4:if(fe(!0),n.prev=5,!je){n.next=12;break}return n.next=9,_e();case 9:if(n.sent){n.next=12;break}return n.abrupt("return");case 12:return s={uid:r.uid,orgUid:null==t?void 0:t.uid,type:Ve(r.type)},n.next=15,(0,D.Ch)(s);case 15:a=n.sent,console.log("publishTicketSettings response:",a,s),200===(null==a?void 0:a.code)?(A.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Ze.current=JSON.stringify(null!==(o=null==a?void 0:a.data)&&void 0!==o?o:{}),we(!1),Z((function(e){return e.map((function(e){return e.uid===r.uid?null==a?void 0:a.data:e}))})),Le(Je(null==a?void 0:a.data))):A.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"})),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(5),console.error("发布失败:",n.t0),A.yw.error(e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"}));case 24:return n.prev=24,fe(!1),n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[5,20,24,27]])})));return function(){return n.apply(this,arguments)}}(),Ke=function(e){var t,n,r,s,a,i,o,u;return{numberPrefix:null!==(t=null==e?void 0:e.numberPrefix)&&void 0!==t?t:"TK",numberLength:null!==(n=null==e?void 0:e.numberLength)&&void 0!==n?n:8,defaultPriority:null!==(r=null==e?void 0:e.defaultPriority)&&void 0!==r?r:"medium",validityDays:null!==(s=null==e?void 0:e.validityDays)&&void 0!==s?s:30,autoCloseHours:null!==(a=null==e?void 0:e.autoCloseHours)&&void 0!==a?a:72,enableAutoClose:null!==(i=null==e?void 0:e.enableAutoClose)&&void 0!==i&&i,requireLogin:null!==(o=null==e?void 0:e.requireLogin)&&void 0!==o&&o,assignmentMode:null!==(u=null==e?void 0:e.assignmentMode)&&void 0!==u?u:G.vXk}},Ye=function(e){var t=Array.isArray(null==e?void 0:e.items)?e.items:[];return Fe(t)},$e=null!=qe?qe:Be,et=Pe===G.IpQ?G.p$M:G.hXJ,tt=Pe===G.IpQ,nt=(0,d.useMemo)((function(){var e,t,n,r;if(null==$e||!$e.uid)return[];var a=[{key:"basic",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(w.Z,{})," ",(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.basic",defaultMessage:"基础设置"})]}),children:(0,ae.jsx)("div",{style:{padding:8},children:(0,ae.jsx)(ue,{settings:Ke(null!==(e=null==$e?void 0:$e.draftBasicSettings)&&void 0!==e?e:null==$e?void 0:$e.basicSettings),hideRequireLogin:tt,onChange:function(e){Oe((function(t){var n,r,a=Ke(null!==(n=null!==(r=t.draftBasicSettings)&&void 0!==r?r:t.basicSettings)&&void 0!==n?n:{});t.draftBasicSettings=s()(s()({},a),e),t.hasUnpublishedChanges=!0}))}})})},{key:"categories",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(F,{})," ",(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.categories",defaultMessage:"分类设置"})]}),children:(0,ae.jsx)("div",{style:{padding:8},children:(0,ae.jsx)(Te,{items:Ye(null!==(t=null==$e?void 0:$e.draftCategorySettings)&&void 0!==t?t:null==$e?void 0:$e.categorySettings),categoryType:et,onChange:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Fe(e),n=t.filter((function(e){return e.enabled})).length,r=t.length-n,s=t.find((function(e){return e.defaultCategory&&e.enabled}));return{items:t,defaultCategoryUid:null==s?void 0:s.uid,enabledCount:n,disabledCount:r}}(e);Oe((function(e){e.draftCategorySettings=t,e.hasUnpublishedChanges=!0}))}})})},{key:"workflow",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(I,{})," ",(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.workflow",defaultMessage:"流程与表单"})]}),children:(0,ae.jsx)("div",{style:{padding:8},children:(0,ae.jsx)(He,{orgUid:Ue,process:null!==(n=null==$e?void 0:$e.process)&&void 0!==n?n:null,draftProcess:null==$e?void 0:$e.draftProcess,form:null!==(r=null==$e?void 0:$e.form)&&void 0!==r?r:null,draftForm:null==$e?void 0:$e.draftForm,ticketScope:Pe,customFormEnabled:null==$e?void 0:$e.customFormEnabled,onProcessChange:function(e){Oe((function(t){t.draftProcess=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onFormChange:function(e){Oe((function(t){t.draftForm=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onCustomFormEnabledChange:function(e){Oe((function(t){t.customFormEnabled=e,t.hasUnpublishedChanges=!0}))}})})}];return a}),[$e,e,Oe,et,tt,Ue]),rt=(0,d.useCallback)((function(e){var t=e.trim();T(t),Re(t)}),[Re,T]),st=[{key:G.dCh,label:e.formatMessage({id:"ticket.settings.scope.external",defaultMessage:"外部工单"})},{key:G.IpQ,label:e.formatMessage({id:"ticket.settings.scope.internal",defaultMessage:"内部工单"})}];return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(g.Z,{activeKey:Pe,onChange:function(e){var t=Ve(e);Ie(t),X(void 0),Z([]),Le(null),Ze.current=JSON.stringify({}),we(!1)},items:st}),(0,ae.jsxs)(m.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ae.jsx)(m.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,ae.jsxs)(j.Z,{title:e.formatMessage({id:"ticket.settings.list",defaultMessage:"工单配置列表"}),extra:(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(z.Z,{}),type:"primary",onClick:function(){ye(null),he(!0)},children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:te,children:[(0,ae.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ae.jsxs)(h.Z.Compact,{style:{width:"100%"},children:[(0,ae.jsx)(v.Z,{placeholder:e.formatMessage({id:"ticket.settings.search.placeholder",defaultMessage:"搜索工单配置"}),value:P,onChange:function(e){return T(e.target.value)},onPressEnter:function(){return rt(P)},allowClear:!0,size:"middle"}),(0,ae.jsx)(p.ZP,{type:"primary",size:"middle",onClick:function(){return rt(P)},children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.search",defaultMessage:"搜索"})})]})}),(0,ae.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ae.jsx)(x.Z,{dataSource:De,locale:{emptyText:(0,ae.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ae.jsx)(x.Z.Item,{style:N===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return X(e.uid)},children:(0,ae.jsx)(x.Z.Item.Meta,{title:(0,ae.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ae.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ae.jsx)(h.Z,{size:4,children:e.isDefault?(0,ae.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ae.jsx)("div",{style:{color:n?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ae.jsx)(m.Z.Panel,{children:$e?(0,ae.jsx)(j.Z,{title:(0,ae.jsxs)(h.Z,{children:[(0,ae.jsxs)("span",{children:[e.formatMessage({id:"ticket.settings.editing",defaultMessage:"编辑工单设置"}),": ",$e.name||$e.uid]}),(0,ae.jsx)(k.Z,{checked:!!$e.enabled,onChange:function(e){return Xe($e.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ae.jsx)(p.ZP,{size:"small",icon:(0,ae.jsx)(L.Z,{}),onClick:function(e){e.stopPropagation(),Be&&(ye(Be),he(!0))},children:(0,ae.jsx)(f.FormattedMessage,{id:"ticket.settings.edit",defaultMessage:"编辑"})}),(0,ae.jsx)(b.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ne(Be)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ae.jsx)(p.ZP,{size:"small",danger:!0,icon:(0,ae.jsx)(q.Z,{}),onClick:function(e){return e.stopPropagation()},children:(0,ae.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})}),$e.isDefault?(0,ae.jsx)(y.Z,{color:"blue",children:"默认"}):null,je&&(0,ae.jsx)(y.Z,{color:"red",children:(0,ae.jsx)(f.FormattedMessage,{id:"common.unsaved",defaultMessage:"未保存修改"})})]}),extra:(0,ae.jsxs)(h.Z,{children:[(0,ae.jsx)(b.Z,{title:e.formatMessage({id:"ticket.settings.publish.confirm.title",defaultMessage:"发布到线上环境"}),description:e.formatMessage({id:"ticket.settings.publish.confirm.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:e.formatMessage({id:"ticket.settings.publish.confirm.ok",defaultMessage:"继续发布"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),We()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ae.jsx)(p.ZP,{onClick:function(e){return e.stopPropagation()},loading:de,type:"default",icon:(0,ae.jsx)(O.Z,{}),children:(0,ae.jsx)(f.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ae.jsx)(p.ZP,{onClick:function(){if(Be){var t=Ze.current?JSON.parse(Ze.current):null;Le(Je(t)),we(!1),A.yw.info(e.formatMessage({id:"ticket.settings.reset.info",defaultMessage:"已重置为当前发布版本"}))}},disabled:!je,icon:(0,ae.jsx)(U.Z,{}),children:(0,ae.jsx)(f.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ae.jsx)(p.ZP,{type:"primary",loading:ie,onClick:_e,disabled:!je,icon:(0,ae.jsx)(B.Z,{}),children:(0,ae.jsx)(f.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ae.jsx)(g.Z,{activeKey:K,onChange:Y,items:nt})}):(0,ae.jsx)(j.Z,{children:(0,ae.jsx)(M.Z,{description:e.formatMessage({id:"ticket.settings.select.settings",defaultMessage:"请从左侧选择工单配置"})})})})]}),(0,ae.jsx)(Ee,{open:pe,record:Me||void 0,ticketType:Me?Ve(Me.type):Pe,onClose:function(){return he(!1)},onSuccess:function(){var e=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Re(P);case 2:null!=t&&t.uid&&X(t.uid);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})}}}]);