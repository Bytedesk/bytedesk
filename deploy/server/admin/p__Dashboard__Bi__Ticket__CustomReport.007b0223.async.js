"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[674],{93689:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(77260),r=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},s=n(54183),c=function(e,t){return r.createElement(s.Z,(0,a.Z)({},e,{ref:t,icon:i}))};var o=r.forwardRef(c)},74840:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(77260),r=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},s=n(54183),c=function(e,t){return r.createElement(s.Z,(0,a.Z)({},e,{ref:t,icon:i}))};var o=r.forwardRef(c)},99109:function(e,t,n){n.d(t,{If:function(){return g},dF:function(){return d},j4:function(){return h},v$:function(){return p}});var a=n(90819),r=n.n(a),i=n(73193),s=n.n(i),c=n(89933),o=n.n(c),u=n(5488),l=n(14870);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/query/org",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/create",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/update",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return k.apply(this,arguments)}function k(){return(k=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/delete",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67165:function(e,t,n){n.d(t,{AD:function(){return d},Tl:function(){return p}});var a=n(90819),r=n.n(a),i=n(73193),s=n.n(i),c=n(89933),o=n.n(c),u=n(5488),l=n(14870);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/calculate",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},12942:function(e,t,n){n.r(t);var a=n(90819),r=n.n(a),i=n(89933),s=n.n(i),c=n(45332),o=n.n(c),u=n(44194),l=n(72207),d=n(27904),f=n(79401),p=n(49616),m=n(32973),h=n(5780),v=n(78875),g=n(20228),k=n(65532),x=n(61155),y=n(80556),b=n(90151),w=n(93689),j=n(74840),M=n(48004),R=n(14870),T=n(67165),Z=n(5025),D=n(34599),Y=n(16698),C=n(94956),S=n(18751),z=n(5488),O=n(28977),I=n.n(O),B=n(99109),E=n(68020),F=n(31549),q=l.default.RangePicker,P=d.Z.Option;t.default=function(){var e,t,n=(0,R.useIntl)(),a=(0,S.Z)().translateStringTranct,i=(0,u.useState)(I()().startOf("day")),c=o()(i,2),l=c[0],O=c[1],U=(0,u.useState)(I()().endOf("day")),A=o()(U,2),J=A[0],H=A[1],X=(0,u.useState)("today"),W=o()(X,2),L=W[0],G=W[1],N=(0,u.useState)(z.whQ),Q=o()(N,2),_=Q[0],$=Q[1],K=(0,u.useState)(),V=o()(K,2),ee=V[0],te=V[1],ne=(0,u.useState)(),ae=o()(ne,2),re=ae[0],ie=ae[1],se=(0,D.u)((function(e){return e.currentOrg})),ce=(0,Y.E)((function(e){return e})),oe=ce.agentResult,ue=ce.setAgentResult,le=(0,E.H)((function(e){return e})),de=le.departmentResult,fe=le.setDepartmentResult,pe=(0,u.useState)(),me=o()(pe,2),he=me[0],ve=me[1],ge=(0,u.useState)(!1),ke=o()(ge,2),xe=ke[0],ye=ke[1],be=[{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,F.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,u.useEffect)((function(){if("custom"===L)O(l),H(J);else{var e=I()();"today"===L?(O(e),H(e)):"yesterday"===L?(O(e.subtract(1,"day")),H(e.subtract(1,"day"))):"week"===L?(O(e.startOf("week")),H(e.endOf("week"))):"lastWeek"===L?(O(e.subtract(1,"week").startOf("week")),H(e.subtract(1,"week").endOf("week"))):"month"===L&&(O(e.startOf("month")),H(e.endOf("month")))}}),[L]);var we=function(){var e=s()(r()().mark((function e(){var t,n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==se?void 0:se.uid},e.next=4,(0,B.dF)(t);case 4:200===(n=e.sent).code?(Z.yw.destroy(),fe(n),n.data.content.length>0&&ie(n.data.content[0].uid)):(Z.yw.destroy(),Z.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(){var e=s()(r()().mark((function e(){var t,n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==se?void 0:se.uid},e.next=4,(0,C._t)(t);case 4:200===(n=e.sent).code?(Z.yw.destroy(),ue(n),n.data.content.length>0&&te(n.data.content[0].uid)):(Z.yw.destroy(),Z.yw.error(a(n.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=s()(r()().mark((function e(){var t,a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye(!0),e.prev=1,Z.yw.loading("loading"),t={type:_,startDate:null==l?void 0:l.format("YYYY-MM-DD"),endDate:null==J?void 0:J.format("YYYY-MM-DD"),departmentUid:re,assigneeUid:ee,orgUid:null==se?void 0:se.uid},e.next=6,(0,T.AD)(t);case 6:a=e.sent,console.log("queryStatisticTicketByDate response:",a.data,t),200===a.code?(Z.yw.destroy(),ve(a.data)):(Z.yw.destroy(),Z.yw.error(a.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),Z.yw.error(n.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,ye(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){we(),je()}),[]),(0,u.useEffect)((function(){Me()}),[_,ee,re]),(0,u.useEffect)((function(){Me()}),[l,J]);var Re=[{key:"1",date:null==l?void 0:l.format("YYYY-MM-DD"),totalTickets:(null==he?void 0:he.totalTickets)||0,resolvedTickets:(null==he?void 0:he.resolvedTickets)||0,openTickets:(null==he?void 0:he.openTickets)||0,closedTickets:(null==he?void 0:he.closedTickets)||0,satisfactionRate:(null==he?void 0:he.customerSatisfactionRate)||0,avgResolutionTime:"".concat((null==he?void 0:he.averageResolutionTime)||0,"小时"),avgResponseTime:"".concat((null==he?void 0:he.averageFirstResponseTime)||0,"分钟"),slaComplianceRate:(null==he?void 0:he.slaComplianceRate)||0}],Te=[{title:n.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:n.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:n.formatMessage({id:"bi.ticket.table.resolvedTickets"}),dataIndex:"resolvedTickets",key:"resolvedTickets"},{title:n.formatMessage({id:"bi.ticket.table.processingTickets"}),dataIndex:"openTickets",key:"openTickets"},{title:n.formatMessage({id:"bi.ticket.table.closedTickets"}),dataIndex:"closedTickets",key:"closedTickets"},{title:n.formatMessage({id:"bi.ticket.table.satisfactionRate"}),dataIndex:"satisfactionRate",key:"satisfactionRate",render:function(e){return"".concat(e,"%")}},{title:n.formatMessage({id:"bi.ticket.table.avgResolutionTime"}),dataIndex:"avgResolutionTime",key:"avgResolutionTime",render:function(e){return"".concat(e).concat(n.formatMessage({id:"bi.ticket.unit.minute"}))}},{title:n.formatMessage({id:"bi.ticket.table.avgResponseTime"}),dataIndex:"avgResponseTime",key:"avgResponseTime",render:function(e){return"".concat(e).concat(n.formatMessage({id:"bi.ticket.unit.minute"}))}},{title:n.formatMessage({id:"bi.ticket.table.slaComplianceRate"}),dataIndex:"slaComplianceRate",key:"slaComplianceRate",render:function(e){return"".concat(e,"%")}}];return(0,F.jsxs)("div",{style:{padding:"24px"},children:[(0,F.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,F.jsx)("h2",{children:n.formatMessage({id:"bi.ticket.title.customReport"})}),(0,F.jsxs)("p",{children:[n.formatMessage({id:"bi.ticket.description.customReport"}),"today"===L&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD"),")"]}),"yesterday"===L&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD"),")"]}),("week"===L||"lastWeek"===L||"month"===L||"custom"===L)&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD")," ~ ",J.format("YYYY-MM-DD"),")"]})]})]}),(0,F.jsx)(f.Z,{style:{marginBottom:16},children:(0,F.jsx)(p.Z,{direction:"vertical",style:{width:"100%"},children:(0,F.jsxs)(p.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,F.jsxs)(p.Z,{wrap:!0,children:[(0,F.jsx)(m.ZP.Group,{value:L,onChange:function(e){return G(e.target.value)},children:be.map((function(e){return(0,F.jsx)(m.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===L&&(0,F.jsx)(q,{value:[l,J],onChange:function(e){O(e[0]),H(e[1])}})]}),(0,F.jsxs)(p.Z,{wrap:!0,children:[(0,F.jsxs)(d.Z,{value:_,onChange:$,style:{width:120},placeholder:n.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,F.jsx)(P,{value:z.whQ,children:n.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,F.jsx)(P,{value:z.fyH,children:n.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,F.jsx)(P,{value:z.nYM,children:n.formatMessage({id:"bi.ticket.filterType.department"})})]}),_===z.fyH&&(0,F.jsx)(d.Z,{value:ee,onChange:te,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=oe.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,F.jsx)(P,{value:e.uid,children:a(e.nickname)},e.uid)}))}),_===z.nYM&&(0,F.jsx)(d.Z,{value:re,onChange:ie,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=de.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,F.jsx)(P,{value:e.uid,children:a(e.name)},e.uid)}))}),(0,F.jsx)(h.ZP,{type:"primary",icon:(0,F.jsx)(y.Z,{}),onClick:function(){return Me()},children:(0,F.jsx)(R.FormattedMessage,{id:"bi.common.refresh"})}),(0,F.jsx)(h.ZP,{type:"default",onClick:function(){Z.yw.warning("TODO: 待实现导出功能")},children:n.formatMessage({id:"bi.ticket.filter.export"})})]})]})})}),(0,F.jsxs)(v.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(g.Z,{span:6,children:(0,F.jsx)(f.Z,{children:(0,F.jsx)(k.Z,{title:n.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==he?void 0:he.totalTickets)||0,prefix:(0,F.jsx)(b.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,F.jsx)(g.Z,{span:6,children:(0,F.jsx)(f.Z,{children:(0,F.jsx)(k.Z,{title:n.formatMessage({id:"bi.ticket.card.resolutionRate"}),value:null!=he&&he.totalTickets?Math.round(he.resolvedTickets/he.totalTickets*100):0,prefix:(0,F.jsx)(w.Z,{}),valueStyle:{color:"#1890ff"},suffix:n.formatMessage({id:"bi.ticket.unit.percent"})})})}),(0,F.jsx)(g.Z,{span:6,children:(0,F.jsx)(f.Z,{children:(0,F.jsx)(k.Z,{title:n.formatMessage({id:"bi.ticket.card.satisfactionRate"}),value:(null==he?void 0:he.customerSatisfactionRate)||0,prefix:(0,F.jsx)(j.Z,{}),valueStyle:{color:"#722ed1"},suffix:n.formatMessage({id:"bi.ticket.unit.percent"})})})}),(0,F.jsx)(g.Z,{span:6,children:(0,F.jsx)(f.Z,{children:(0,F.jsx)(k.Z,{title:n.formatMessage({id:"bi.ticket.card.slaComplianceRate"}),value:(null==he?void 0:he.slaComplianceRate)||0,prefix:(0,F.jsx)(M.Z,{}),valueStyle:{color:"#eb2f96"},suffix:n.formatMessage({id:"bi.ticket.unit.percent"})})})})]}),(0,F.jsxs)(v.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(g.Z,{span:12,children:(0,F.jsx)(f.Z,{title:n.formatMessage({id:"bi.ticket.workloadEfficiency"})})}),(0,F.jsx)(g.Z,{span:12,children:(0,F.jsx)(f.Z,{title:n.formatMessage({id:"bi.ticket.statusDistribution"})})})]}),(0,F.jsx)(f.Z,{title:"综合报表数据",loading:xe,children:(0,F.jsx)(x.Z,{columns:Te,dataSource:Re,pagination:!1,size:"middle"})})]})}},68020:function(e,t,n){n.d(t,{H:function(){return p}});var a=n(86222),r=n.n(a),i=n(76711),s=n.n(i),c=n(73193),o=n.n(c),u=n(5488),l=n(16894),d=n(45034),f=n(47401),p=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:u.zBg,nickname:u.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var a=n.find((function(e){return e.uid===t.parentUid}));a&&(a.children||(a.children=[]),a.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var a,r={uid:u.zBg,name:u.zBg};(e({departmentResult:o()(o()({},n),{},{data:{content:[r].concat(s()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(a=n.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var a=t().departmentResult.data.content,r=a.findIndex((function(e){return e.uid===n.uid}));if(-1!==r){var i=[].concat(s()(a.slice(0,r)),[n],s()(a.slice(r+1))),c=o()(o()({},t().departmentResult),{},{data:{content:i}});e({departmentResult:c,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var a,i,s=null===(a=t().departmentResult)||void 0===a||null===(a=a.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.find((function(e){return e.uid===n}));if(s)e({currentDepartment:s});else{!function t(a){var i,s=r()(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(c.uid===n)return void e({currentDepartment:c});c.children&&c.children.length>0&&t(c.children)}}catch(e){s.e(e)}finally{s.f()}}((null===(i=t().departmentResult)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:u.xY_})))}}]);