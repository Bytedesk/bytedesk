"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9522],{80953:function(e,t,r){var n=r(94433),a=r(38956),i=r(44194),u=r(35074),o=r(31549),l=["fieldProps","proFieldProps"],s=function(e,t){var r=e.fieldProps,i=e.proFieldProps,s=(0,a.Z)(e,l);return(0,o.jsx)(u.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:i},s))};t.Z=i.forwardRef(s)},5347:function(e,t,r){r.r(t),r.d(t,{default:function(){return Q}});var n=r(77033),a=r(75112),i=r(39497),u=r(54285),o=r(73193),l=r.n(o),s=r(90819),c=r.n(s),d=r(89933),p=r.n(d),v=r(45332),f=r.n(v),h=r(89246),x=r(81739),m=r(82770),y=r(86895),E=r(59533),g=r(44194),w=r(14906);function P(e){return b.apply(this,arguments)}function b(){return(b=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/opinion/query/org",{method:"GET",params:l()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return I.apply(this,arguments)}function I(){return(I=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/opinion/create",{method:"POST",data:l()(l()({},t),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/opinion/update",{method:"POST",data:l()(l()({},t),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return N.apply(this,arguments)}function N(){return(N=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/opinion/delete",{method:"POST",data:l()(l()({},t),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return O.apply(this,arguments)}function O(){return(O=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=r(15722),D=r(10162),G=r(98830),M=r(26138),R=r(75864),L=r(89965),U=r(80953),q=r(2250),z=r(31549),A=function(e){var t=e.visible,r=e.mode,n=e.opinion,a=e.onClose,u=(0,M.v)().currentCategory,o=(0,G.u)().currentOrg,s="view"===r,d="edit"===r,v=function(){var e=p()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=l()(l()({},t),{},{categoryUid:"i18n.DEPT_ALL"===(null==u?void 0:u.uid)||null==u?void 0:u.uid,orgUid:null==o?void 0:o.uid,level:i.whQ}),!d||null==n||!n.uid){e.next=8;break}return e.next=5,S(l()({uid:n.uid},r));case 5:E.ZP.success("更新成功"),e.next=11;break;case 8:return e.next=10,k(r);case 10:E.ZP.success("创建成功");case 11:return a(!0),e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(0),E.ZP.error(d?"更新失败":"创建失败"),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();return(0,z.jsxs)(R.a,{title:function(){switch(r){case"create":return"新建意见建议";case"edit":return"编辑意见建议";case"view":return"查看意见建议";default:return"意见建议"}}(),open:t,onOpenChange:function(e){e||a()},onFinish:v,width:600,layout:"horizontal",labelCol:{span:6},wrapperCol:{span:18},initialValues:d||s?{title:null==n?void 0:n.title,content:null==n?void 0:n.content,nickname:null==n?void 0:n.nickname,type:null==n?void 0:n.type,priority:null==n?void 0:n.priority,status:null==n?void 0:n.status}:{type:"SUGGESTION",priority:"MEDIUM",status:"PENDING"},readonly:s,submitter:!s&&{submitButtonProps:{children:d?"更新":"创建"}},children:[(0,z.jsx)(L.Z,{name:"title",label:"标题",placeholder:"请输入意见建议标题",rules:[{required:!0,message:"请输入标题"},{max:100,message:"标题不能超过100个字符"}]}),(0,z.jsx)(U.Z,{name:"content",label:"内容",placeholder:"请输入具体的意见建议内容",fieldProps:{rows:4,maxLength:1e3,showCount:!0},rules:[{required:!0,message:"请输入内容"}]}),(0,z.jsx)(L.Z,{name:"nickname",label:"提出人",placeholder:"请输入提出人姓名",rules:[{required:!0,message:"请输入提出人"},{max:50,message:"提出人姓名不能超过50个字符"}]}),(0,z.jsx)(q.Z,{name:"type",label:"类型",options:[{label:"建议",value:"SUGGESTION"},{label:"改进",value:"IMPROVEMENT"},{label:"创新",value:"INNOVATION"},{label:"其他",value:"OTHER"}],rules:[{required:!0,message:"请选择类型"}]}),(0,z.jsx)(q.Z,{name:"priority",label:"优先级",options:[{label:"高优先级",value:"HIGH"},{label:"中优先级",value:"MEDIUM"},{label:"低优先级",value:"LOW"}],rules:[{required:!0,message:"请选择优先级"}]}),(0,z.jsx)(q.Z,{name:"status",label:"状态",options:[{label:"待处理",value:"PENDING"},{label:"评审中",value:"REVIEWING"},{label:"已采纳",value:"APPROVED"},{label:"已拒绝",value:"REJECTED"},{label:"已实施",value:"IMPLEMENTED"}],rules:[{required:!0,message:"请选择状态"}]})]})},V=r(10154),W=r.n(V),H=r(5932),J=function(){var e=p()(c()().mark((function e(t,r,n,a){var u,o,s,d,p,v,h=arguments;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=h.length>4&&void 0!==h[4]?h[4]:"current",o=h.length>5?h[5]:void 0,s=h.length>6?h[6]:void 0;try{d=localStorage.getItem(i.LA8),p=l()(l()({},Object.entries(n).reduce((function(e,t){var r=f()(t,2),n=r[0],a=r[1];return l()(l()({},e),{},W()({},n,a?String(a):""))}),{})),{},{accessToken:d||"",exportType:u}),"current"===u?(p.pageNumber="0",p.pageSize="20"):"all"===u?(p.pageNumber="0",p.pageSize="1000"):"range"===u&&void 0!==o&&void 0!==s&&(p.pageNumber=String(o),p.pageSize=String(s)),v="".concat((0,H.kG)(),"/api/v1/").concat(r.toLowerCase(),"/export?").concat(new URLSearchParams(p).toString()),window.open(v),E.ZP.success("导出任务已开始，请稍候下载")}catch(e){console.error("Export failed:",e),E.ZP.error("导出失败，请重试")}case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),F=function(e){var t=e.level,r=(0,g.useRef)(),n=(0,G.u)().currentOrg,a=(0,M.v)().currentCategory,i=(0,g.useState)(!1),u=f()(i,2),o=u[0],s=u[1],d=(0,g.useState)("create"),v=f()(d,2),w=v[0],P=v[1],b=(0,g.useState)(),k=f()(b,2),I=k[0],S=k[1],Z=[{title:"标题",dataIndex:"title",width:200,search:{transform:function(e){return{title:e}}}},{title:"内容",dataIndex:"content",width:300,ellipsis:!0,search:!1},{title:"提出人",dataIndex:"nickname",width:120,search:{transform:function(e){return{nickname:e}}}},{title:"类型",dataIndex:"type",width:100,valueEnum:{SUGGESTION:{text:"建议",status:"Success"},IMPROVEMENT:{text:"改进",status:"Processing"},INNOVATION:{text:"创新",status:"Warning"},OTHER:{text:"其他",status:"Default"}},search:{transform:function(e){return{type:e}}}},{title:"优先级",dataIndex:"priority",width:100,render:function(e,t){var r={HIGH:{color:"red",text:"高"},MEDIUM:{color:"orange",text:"中"},LOW:{color:"green",text:"低"}}[t.priority];return(0,z.jsx)(x.Z,{color:null==r?void 0:r.color,children:null==r?void 0:r.text})},valueEnum:{HIGH:{text:"高优先级",status:"Error"},MEDIUM:{text:"中优先级",status:"Warning"},LOW:{text:"低优先级",status:"Success"}},search:{transform:function(e){return{priority:e}}}},{title:"状态",dataIndex:"status",width:100,render:function(e,t){var r={PENDING:{color:"orange",text:"待处理"},REVIEWING:{color:"blue",text:"评审中"},APPROVED:{color:"green",text:"已采纳"},REJECTED:{color:"red",text:"已拒绝"},IMPLEMENTED:{color:"purple",text:"已实施"}}[t.status];return(0,z.jsx)(x.Z,{color:null==r?void 0:r.color,children:null==r?void 0:r.text})},valueEnum:{PENDING:{text:"待处理",status:"Warning"},REVIEWING:{text:"评审中",status:"Processing"},APPROVED:{text:"已采纳",status:"Success"},REJECTED:{text:"已拒绝",status:"Error"},IMPLEMENTED:{text:"已实施",status:"Success"}},search:{transform:function(e){return{status:e}}}},{title:"创建时间",dataIndex:"createdAt",width:180,valueType:"dateTime",sorter:!0,search:!1},{title:"操作",valueType:"option",width:200,render:function(e,t){return[(0,z.jsx)(m.ZP,{type:"link",size:"small",onClick:function(){return R(t)},children:"查看"},"view"),(0,z.jsx)(m.ZP,{type:"link",size:"small",onClick:function(){return O(t)},children:"编辑"},"edit"),(0,z.jsx)(m.ZP,{type:"link",size:"small",danger:!0,onClick:function(){return L(t)},children:"删除"},"delete")]}}],N=function(){S(void 0),P("create"),s(!0)},O=function(e){S(e),P("edit"),s(!0)},R=function(e){S(e),P("view"),s(!0)},L=function(e){var t;y.Z.confirm({title:"确认删除",icon:(0,z.jsx)(C.Z,{}),content:'确定要删除意见建议"'.concat(e.title,'"吗？'),okText:"确认",cancelText:"取消",onOk:(t=p()(c()().mark((function t(){var n;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T({uid:e.uid});case 3:E.ZP.success("删除成功"),null===(n=r.current)||void 0===n||n.reload(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),E.ZP.error("删除失败");case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(){return t.apply(this,arguments)})})},U=function(){J([{key:"title",title:"标题"},{key:"content",title:"内容"},{key:"nickname",title:"提出人"},{key:"type",title:"类型"},{key:"priority",title:"优先级"},{key:"status",title:"状态"},{key:"createdAt",title:"创建时间"}],"意见建议",{orgUid:null==n?void 0:n.uid,categoryUid:"i18n.DEPT_ALL"===(null==a?void 0:a.uid)||null==a?void 0:a.uid,level:t},j)};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(h.Z,{columns:Z,actionRef:r,request:function(){var e=p()(c()().mark((function e(r,i){var u,o,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(l()(l()({},r),{},{orgUid:null==n?void 0:n.uid,categoryUid:"i18n.DEPT_ALL"===(null==a?void 0:a.uid)||null==a?void 0:a.uid,level:t,current:r.current||1,size:r.pageSize||20}));case 2:return s=e.sent,e.abrupt("return",{data:(null===(u=s.data)||void 0===u?void 0:u.content)||[],success:200===s.code,total:(null===(o=s.data)||void 0===o?void 0:o.totalElements)||0});case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto",defaultCollapsed:!1},dateFormatter:"string",headerTitle:"意见建议管理",toolBarRender:function(){return[(0,z.jsx)(m.ZP,{onClick:U,children:"导出"},"export"),(0,z.jsx)(m.ZP,{type:"primary",icon:(0,z.jsx)(D.Z,{}),onClick:N,children:"新建意见"},"create")]},pagination:{defaultPageSize:20,showSizeChanger:!0,showQuickJumper:!0}}),(0,z.jsx)(A,{visible:o,mode:w,opinion:I,onClose:function(e){var t;(s(!1),S(void 0),e)&&(null===(t=r.current)||void 0===t||t.reload())}})]})},Q=function(){var e=(0,a.Z)(),t=e.leftSiderStyle,r=(e.leftSiderWidth,e.contentStyle);return(0,z.jsxs)(n.Z,{style:{height:"100%"},children:[(0,z.jsx)(n.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,z.jsx)(u.Z,{type:i.rvu,level:i.whQ,showKbase:!1})}),(0,z.jsx)(n.Z.Panel,{style:r,children:(0,z.jsx)(F,{level:i.whQ})})]})}}}]);