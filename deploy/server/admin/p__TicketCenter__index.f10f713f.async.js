"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9107],{2250:function(e,t,r){var a=r(94433),n=r(38956),s=r(51997),i=r(44194),o=r(80228),c=r(35074),u=r(31549),l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var r=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,m=e.mode,h=e.valueEnum,g=e.request,v=e.showSearch,k=e.options,x=(0,n.Z)(e,l),M=(0,i.useContext)(o.Z);return(0,u.jsx)(c.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,s.h)(h),request:g,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:k,mode:m,showSearch:v,getPopupContainer:M.getPopupContainer},r),ref:t,proFieldProps:p},x),{},{children:d}))},p=i.forwardRef((function(e,t){var r=e.fieldProps,l=e.children,f=e.params,p=e.proFieldProps,m=e.mode,h=e.valueEnum,g=e.request,v=e.options,k=(0,n.Z)(e,d),x=(0,a.Z)({options:v,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),M=(0,i.useContext)(o.Z);return(0,u.jsx)(c.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,s.h)(h),request:g,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:M.getPopupContainer},x),ref:t,proFieldProps:p},k),{},{children:l}))})),m=i.forwardRef(f);m.SearchSelect=p,m.displayName="ProFormComponent",t.Z=m},89965:function(e,t,r){var a=r(32906),n=r(94433),s=r(38956),i=r(81424),o=r(41196),c=r(63924),u=r(34573),l=r(44194),d=r(35074),f=r(31549),p=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],h="text",g=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,a.Z)(t,2),s=r[0],u=r[1];return(0,f.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,a=t.getFieldValue(e.name||[]);return(0,f.jsx)(c.Z,(0,n.Z)((0,n.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,a),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var t=e.fieldProps,r=e.proFieldProps,a=(0,s.Z)(e,p);return(0,f.jsx)(d.Z,(0,n.Z)({valueType:h,fieldProps:t,filedConfig:{valueType:h},proFieldProps:r},a))};v.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,i=(0,s.Z)(e,m),o=(0,l.useState)(!1),c=(0,a.Z)(o,2),p=c[0],v=c[1];return null!=t&&t.statusRender&&i.name?(0,f.jsx)(g,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(d.Z,(0,n.Z)({valueType:"password",fieldProps:(0,n.Z)((0,n.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),v(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),v(!0)}}),proFieldProps:r,filedConfig:{valueType:h}},i))})}):(0,f.jsx)(d.Z,(0,n.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:h}},i))},v.displayName="ProFormComponent",t.Z=v},77098:function(e,t,r){r.d(t,{JP:function(){return v},Nf:function(){return h},PA:function(){return x},Z_:function(){return d},cG:function(){return p},k2:function(){return j},kO:function(){return y},sc:function(){return w}});var a=r(90819),n=r.n(a),s=r(73193),i=r.n(s),o=r(89933),c=r.n(o),u=r(39497),l=r(14906);function d(){return f.apply(this,arguments)}function f(){return(f=c()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/email",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/email",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/email/test",{method:"POST",params:{testEmail:t,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return k.apply(this,arguments)}function k(){return(k=c()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/sms",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/sms",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/sms/test",{method:"POST",params:{testMobile:t,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return Z.apply(this,arguments)}function Z(){return(Z=c()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/ticket-center",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return P.apply(this,arguments)}function P(){return(P=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/settings/platform/ticket-center",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11293:function(e,t,r){r.d(t,{Bg:function(){return d},Ch:function(){return h},Gv:function(){return x},L3:function(){return S},bD:function(){return p},mE:function(){return y},nQ:function(){return w},nU:function(){return v},oX:function(){return j}});var a=r(90819),n=r.n(a),s=r(73193),i=r.n(s),o=r(89933),c=r.n(o),u=r(14906),l=r(39497);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=c()(n()().mark((function e(t){var r,a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.orgUid,a=t.workgroupUid,e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/orgs/".concat(r,"/workgroups/").concat(a),{method:"GET",params:{channel:l.XtJ}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return k.apply(this,arguments)}function k(){return(k=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return Z.apply(this,arguments)}function Z(){return(Z=c()(n()().mark((function e(t,r){var a,s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.uid,s=t.orgUid,e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/".concat(a,"/orgs/").concat(s,"/bindings"),{method:"POST",data:i()(i()({},r),{},{channel:l.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return P.apply(this,arguments)}function P(){return(P=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return C.apply(this,arguments)}function C(){return(C=c()(n()().mark((function e(t,r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/settings/orgs/".concat(t,"/workgroups/").concat(r,"/categories"),{method:"GET",params:{channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},20816:function(e,t,r){r.r(t),r.d(t,{default:function(){return ve}});var a=r(90819),n=r.n(a),s=r(89933),i=r.n(s),o=r(45332),c=r.n(o),u=r(40579),l=r(81739),d=r(82770),f=r(65297),p=r(44194),m=r(14906),h=r(12074),g=r(89246),v=r(97234),k=r(84974),x=r(21559),M=r(71205),y=(r(28099),r(61930)),b=r(5932),w=r(77098),Z=r(23753),j=r(14597),P=r(83910),S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},C=r(54183),E=function(e,t){return p.createElement(C.Z,(0,P.Z)({},e,{ref:t,icon:S}))};var T=p.forwardRef(E),F=r(10162),N=r(76711),q=r.n(N),U=r(82864),I=r(39487),O=r(13847),D=r(25784),J=r(80953),A=r(2250),G=r(89965),X=r(19433),R=r(11293),_=r(33410),L=r(39497),V=r(41196),B=r(59533),z=r(40110),H=r(92354),W=r(62640),K=r(73193),Q=r.n(K),$=r(32525),Y=r(79369),ee=r(40677),te=r(69846),re=r(35281),ae=r(81637),ne=r(739),se=r(66431),ie=r(12546),oe=(r(77586),r(31549)),ce=$.Z.TextArea,ue=Y.ZP.Group,le=ee.Z.Group;var de=function(e){var t=e.forms,r=void 0===t?[]:t,a=e.selectedFormUid,s=e.onFormSelect,o=e.onFormSubmit,u=e.loading,l=void 0!==u&&u,f=e.renderMode,h=void 0===f?"full":f,g=e.fieldNamePrefix,v=void 0===g?"":g,k=(0,p.useState)([]),x=c()(k,2),M=x[0],y=x[1],b=(0,p.useState)(null),w=c()(b,2),Z=w[0],j=w[1],P=V.Z.useForm(),S=c()(P,1)[0],C=(0,m.useIntl)(),E=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("解析表单schema失败:",e),[]}};(0,p.useEffect)((function(){if(a&&r.length>0){var e=r.find((function(e){return e.uid===a}));if(e)if(j(e),e.schema){var t=E(e.schema);y(t)}else y([])}else j(null),y([])}),[a,r]);var T=function(e){var t,r=function(e,t){switch(e){case"text":switch(t){case"email":return C.formatMessage({id:"ticket.form.placeholder.email",defaultMessage:"请输入邮箱地址"});case"tel":return C.formatMessage({id:"ticket.form.placeholder.tel",defaultMessage:"请输入电话号码"});case"textarea":return C.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入文本内容"});case"date":return C.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"datetime-local":return C.formatMessage({id:"ticket.form.placeholder.datetime",defaultMessage:"请选择日期时间"});default:return C.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}case"input":return C.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"});case"textarea":return C.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入多行文本"});case"select":return C.formatMessage({id:"ticket.form.placeholder.select",defaultMessage:"请选择"});case"datePicker":return C.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"timePicker":return C.formatMessage({id:"ticket.form.placeholder.time",defaultMessage:"请选择时间"});default:return C.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}}(e.type,null===(t=e.props)||void 0===t?void 0:t.type);return function(e){var t=e.type,r=e.props,a=void 0===r?{}:r,n=e.options,s=e.placeholder,i=e.isDarkMode,o=void 0!==i&&i;if(!t)return null;var c=t.toLowerCase(),u=o?{backgroundColor:"#141414",borderColor:"#434343",color:"#fff"}:{},l=o?{backgroundColor:"#141414"}:{};switch(c){case"text":switch(a.type||"text"){case"email":return(0,oe.jsx)($.Z,{type:"email",placeholder:s||"请输入邮箱地址",style:u});case"tel":return(0,oe.jsx)($.Z,{type:"tel",placeholder:s||"请输入电话号码",style:u});case"textarea":return(0,oe.jsx)(ce,{rows:a.rows||4,placeholder:s||"请输入文本内容",style:u});case"date":return(0,oe.jsx)(te.ZP,{locale:ie.Z,children:(0,oe.jsx)(re.default,{style:Q()({width:"100%"},u),placeholder:s||"请选择日期"})});case"datetime-local":return(0,oe.jsx)(te.ZP,{locale:ie.Z,children:(0,oe.jsx)(re.default,{showTime:!0,style:Q()({width:"100%"},u),placeholder:s||"请选择日期时间"})});case"file":return(0,oe.jsx)(ae.Z,{accept:a.accept,children:(0,oe.jsx)(d.ZP,{style:o?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传文件"})});default:return(0,oe.jsx)($.Z,{placeholder:s||"请输入",style:u})}case"input":return(0,oe.jsx)($.Z,{placeholder:s||"请输入",style:u});case"textarea":return(0,oe.jsx)(ce,{rows:4,placeholder:s||"请输入多行文本",style:u});case"select":return(0,oe.jsx)(O.Z,{style:Q()({width:"100%"},l),placeholder:s||"请选择",classNames:o?{popup:{root:"dark-mode-select"}}:void 0,options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t)}})):[{label:"选项1",value:"1",key:"option-1"},{label:"选项2",value:"2",key:"option-2"}]});case"radio":return(0,oe.jsx)(ue,{style:o?{color:"#fff"}:{},children:(Array.isArray(n)?n:["选项1","选项2"]).map((function(e,t){return(0,oe.jsx)(Y.ZP,{value:e,style:o?{color:"#fff"}:{},children:e},"".concat(e,"-").concat(t))}))});case"checkbox":return(0,oe.jsx)(le,{style:o?{color:"#fff"}:{},options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t),style:o?{color:"#fff"}:{}}})):[{label:"选项1",value:"1",key:"option-1",style:o?{color:"#fff"}:{}},{label:"选项2",value:"2",key:"option-2",style:o?{color:"#fff"}:{}}]});case"datepicker":return(0,oe.jsx)(te.ZP,{locale:ie.Z,children:(0,oe.jsx)(re.default,{style:Q()({width:"100%"},u),placeholder:s||"请选择日期",classNames:o?{popup:{root:"dark-mode-picker"}}:void 0})});case"timepicker":return(0,oe.jsx)(te.ZP,{locale:ie.Z,children:(0,oe.jsx)(ne.Z,{style:Q()({width:"100%"},u),placeholder:s||"请选择时间",classNames:o?{popup:{root:"dark-mode-picker"}}:void 0})});case"switch":return(0,oe.jsx)(se.Z,{checkedChildren:"开",unCheckedChildren:"关"});case"upload":return(0,oe.jsx)(ae.Z,{accept:a.accept,children:(0,oe.jsx)(d.ZP,{style:o?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传"})});default:return console.log("Unknown component type:",t),(0,oe.jsxs)("div",{children:["未知组件类型: ",t]})}}({type:e.type,props:e.props,options:e.options,placeholder:r,isDarkMode:!1})},F=function(){var e=i()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!o){e.next=6;break}return e.next=4,o(t);case 4:B.ZP.success(C.formatMessage({id:"ticket.form.submit.success",defaultMessage:"表单提交成功"})),S.resetFields();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("表单提交失败:",e.t0),B.ZP.error(C.formatMessage({id:"ticket.form.submit.error",defaultMessage:"表单提交失败"}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();if("fields-only"===h){if(!a||!r.length)return null;var N=r.find((function(e){return e.uid===a}));if(!N||!N.schema)return null;var q=E(N.schema);return q.length?(0,oe.jsx)(oe.Fragment,{children:q.map((function(e,t){return(0,oe.jsx)(V.Z.Item,{name:"".concat(v).concat(e.id||"field-".concat(t)),label:e.label,rules:[{required:e.required,message:C.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:e.label})}],children:T(e)},e.id||"field-".concat(t))}))}):null}return 0===r.length?(0,oe.jsx)(z.Z,{title:C.formatMessage({id:"ticket.form.title",defaultMessage:"工单表单"}),children:(0,oe.jsx)(H.Z,{description:C.formatMessage({id:"ticket.form.empty",defaultMessage:"暂无可用的工单表单"})})}):(0,oe.jsxs)(z.Z,{title:C.formatMessage({id:"ticket.form.title",defaultMessage:"工单表单"}),children:[(0,oe.jsx)(O.Z,{style:{width:"100%",marginBottom:16},placeholder:C.formatMessage({id:"ticket.form.select.placeholder",defaultMessage:"请选择工单表单"}),value:a,onChange:function(e){s&&s(e)},options:r.map((function(e){return{label:e.name,value:e.uid,disabled:"PUBLISHED"!==e.status}}))}),Z&&(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)(W.Z,{orientation:"left",children:Z.name}),Z.description&&(0,oe.jsx)("p",{style:{color:"#666",marginBottom:16},children:Z.description}),M.length>0?(0,oe.jsxs)(V.Z,{form:S,layout:"vertical",onFinish:F,style:{maxWidth:"100%"},children:[Z&&M.length?(0,oe.jsx)(oe.Fragment,{children:M.map((function(e,t){return(0,oe.jsx)(V.Z.Item,{name:"".concat(v).concat(e.id||"field-".concat(t)),label:e.label,rules:[{required:e.required,message:C.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:e.label})}],children:T(e)},e.id||"field-".concat(t))}))}):null,(0,oe.jsx)(V.Z.Item,{children:(0,oe.jsx)(d.ZP,{type:"primary",htmlType:"submit",loading:l,block:!0,children:C.formatMessage({id:"ticket.form.submit",defaultMessage:"提交表单"})})})]}):(0,oe.jsx)(H.Z,{description:C.formatMessage({id:"ticket.form.fields.empty",defaultMessage:"该表单暂无字段配置"})})]})]})},fe=r(91361),pe=function(e){return e?e.trim().replace(/\s+/g," ").slice(0,100):""},me=function(e){var t=e.visible,r=e.onClose,a=e.orgUid,s=e.workgroupUid,o=(0,m.useIntl)(),u=(0,fe.Z)().translateString,l=D.A.useForm(),h=c()(l,1)[0],g=(0,p.useState)(!1),v=c()(g,2),k=v[0],x=v[1],M=(0,m.useModel)("@@initialState").initialState,y=(null!=M?M:{}).userInfo,b="df_org_uid",w=(0,p.useMemo)((function(){return s||""}),[s]),j=(0,p.useState)([]),P=c()(j,2),S=P[0],C=P[1],E=(0,p.useState)(""),T=c()(E,2),F=T[0],N=T[1],V=(0,p.useState)([]),B=c()(V,2),z=B[0],H=B[1],W=(0,p.useState)(!1),K=c()(W,2),Q=K[0],$=K[1],Y=(0,p.useMemo)((function(){return{contactName:(null==y?void 0:y.nickname)||(null==y?void 0:y.username)||"",email:(null==y?void 0:y.email)||"",phone:(null==y?void 0:y.mobile)||""}}),[y]);(0,p.useEffect)((function(){Z.Z.debug("TicketDrawer props orgUid:",a),Z.Z.debug("TicketDrawer final orgUid:",b),Z.Z.debug("TicketDrawer final workgroupUid:",w)}),[a,b,w]),(0,p.useEffect)((function(){if(t){h.setFieldsValue({status:L.sM_,priority:L.GMZ});var e=localStorage.getItem("admin_ticketDraft");e&&h.setFieldValue("description",e)}}),[t,h]),(0,p.useEffect)((function(){if(t){var e=h.getFieldsValue(["contactName","email","phone"]),r={};!e.contactName&&Y.contactName&&(r.contactName=Y.contactName),!e.email&&Y.email&&(r.email=Y.email),!e.phone&&Y.phone&&(r.phone=Y.phone),Object.keys(r).length>0&&h.setFieldsValue(r)}}),[t,Y,h]),(0,p.useEffect)((function(){if(t&&b&&0===S.length){var e=function(){var e=i()(n()().mark((function e(){var t,r,a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={orgUid:b,type:L.wE_,status:L.eiy,pageNumber:0,pageSize:100},e.next=4,(0,_.xg)(r);case 4:a=e.sent,Z.Z.debug("工单表单列表:",a.data,r),200===(null==a?void 0:a.code)&&null!==(t=a.data)&&void 0!==t&&t.content&&C(a.data.content),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("加载工单表单列表失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();e()}}),[t,b,S.length]),(0,p.useEffect)((function(){if(t){if(!w)return Z.Z.warn("TicketDrawer missing orgUid or workgroupUid, skip fetching categories"),H([]),void h.setFieldValue("categoryUid",void 0);var e=!1,r=function(){var t=i()(n()().mark((function t(){var r,a,s;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return $(!0),t.prev=1,t.next=4,(0,R.L3)(b,w);case 4:r=t.sent,Z.Z.debug("工单分类列表:",r.data,b,w),!e&&200===(null==r?void 0:r.code)&&r.data&&(a=r.data.categories||[],s=a.map((function(e){return{label:u(e.name),value:e.uid}})),H(s)),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.error("加载工单分类列表失败:",t.t0),e||H([]);case 13:return t.prev=13,e||$(!1),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,9,13,16]])})));return function(){return t.apply(this,arguments)}}();return r(),function(){e=!0}}}),[t,b,w,h]);var ee=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("解析表单schema失败:",e),[]}},te=function(){var e=i()(n()().mark((function e(t){var a,s,i,c,u,l,d,p,m,g,v,k;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return X.yw.error(o.formatMessage({id:"ticket.create.org.missing",defaultMessage:"缺少组织信息，无法创建工单"})),e.abrupt("return",!1);case 3:if(w){e.next=6;break}return X.yw.error(o.formatMessage({id:"ticket.create.workgroup.missing",defaultMessage:"缺少工作组信息，无法创建工单"})),e.abrupt("return",!1);case 6:return e.prev=6,x(!0),c=t.description||"",u=pe(c),l={},d={},p=S.find((function(e){return e.uid===F})),m=null!=p&&p.schema?ee(p.schema):[],Object.keys(t).forEach((function(e){if(e.startsWith("dynamicField_")){var r=e.replace("dynamicField_",""),a=m.find((function(e){return e.id===r}));a&&(l[r]=t[e],d[r]=a.label)}})),g=null,Object.keys(l).length>0&&F&&(g={formUid:F,formName:(null==p?void 0:p.name)||"表单",formData:l,fieldLabels:d}),v={description:c,summary:u,priority:L.GMZ,status:L.sM_,orgUid:b,workgroupUid:w,contactName:(null===(a=t.contactName)||void 0===a?void 0:a.trim())||"",email:(null===(s=t.email)||void 0===s?void 0:s.trim())||"",phone:(null===(i=t.phone)||void 0===i?void 0:i.trim())||"",reporter:null==y?void 0:y.uid,categoryUid:t.categoryUid||void 0,schema:g?JSON.stringify(g):void 0},e.next=20,(0,f.ax)(v);case 20:if(k=e.sent,Z.Z.debug("Create ticket response:",k,v),200!==(null==k?void 0:k.code)){e.next=30;break}return X.yw.success(o.formatMessage({id:"ticket.create.success",defaultMessage:"工单创建成功"})),h.resetFields(),localStorage.removeItem("admin_ticketDraft"),C([]),N(""),r(!0),e.abrupt("return",!0);case 30:return X.yw.error((null==k?void 0:k.message)||o.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 34:return e.prev=34,e.t0=e.catch(6),console.error("Create ticket failed:",e.t0),X.yw.error(o.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 39:return e.prev=39,x(!1),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[6,34,39,42]])})));return function(t){return e.apply(this,arguments)}}(),re=function(){h.resetFields(),C([]),N(""),H([]),r()};return(0,oe.jsx)(U.Z,{title:o.formatMessage({id:"ticket.create.title",defaultMessage:"创建工单"}),placement:"right",onClose:re,open:t,width:500,extra:(0,oe.jsxs)(I.Z,{children:[S.length>0&&(0,oe.jsx)(O.Z,{style:{width:150},placeholder:o.formatMessage({id:"ticket.form.select.placeholder",defaultMessage:"选择表单"}),value:F,onChange:function(e){N(e)},options:[{label:o.formatMessage({id:"ticket.form.none",defaultMessage:"无表单"}),value:""}].concat(q()(S.map((function(e){return{label:e.name,value:e.uid,disabled:"PUBLISHED"!==e.status}}))))}),(0,oe.jsx)(d.ZP,{onClick:re,children:o.formatMessage({id:"common.cancel",defaultMessage:"取消"})}),(0,oe.jsx)(d.ZP,{type:"primary",onClick:function(){return h.submit()},loading:k,children:o.formatMessage({id:"common.confirm",defaultMessage:"确认"})})]}),children:(0,oe.jsxs)(D.A,{form:h,layout:"vertical",submitter:{render:!1},onFinish:te,initialValues:{status:L.sM_,priority:L.GMZ},children:[(0,oe.jsx)(J.Z,{name:"description",label:o.formatMessage({id:"ticket.description",defaultMessage:"问题描述"}),placeholder:o.formatMessage({id:"ticket.description.placeholder",defaultMessage:"请详细描述您遇到的问题，以便我们更好地为您服务..."}),fieldProps:{rows:6,onBlur:function(){var e=h.getFieldValue("description");e&&localStorage.setItem("admin_ticketDraft",e)}},rules:[{required:!0,message:o.formatMessage({id:"ticket.description.required",defaultMessage:"请输入问题描述"})},{max:2e3,message:o.formatMessage({id:"ticket.description.maxlength",defaultMessage:"描述不能超过2000个字符"})}]}),(0,oe.jsx)(A.Z,{name:"categoryUid",label:o.formatMessage({id:"ticket.category",defaultMessage:"问题分类"}),placeholder:o.formatMessage({id:"ticket.category.placeholder",defaultMessage:"请选择问题分类"}),options:z,rules:[{required:z.length>0,message:o.formatMessage({id:"ticket.category.required",defaultMessage:"请选择问题分类"})}],fieldProps:{loading:Q,showSearch:!0,optionFilterProp:"label",disabled:0===z.length}}),(0,oe.jsx)(de,{forms:S,selectedFormUid:F,renderMode:"fields-only",fieldNamePrefix:"dynamicField_"}),(0,oe.jsx)(G.Z,{name:"contactName",label:o.formatMessage({id:"ticket.contact.name",defaultMessage:"称呼"}),rules:[{required:!0,message:o.formatMessage({id:"ticket.contact.name.required",defaultMessage:"请输入称呼"})}],placeholder:o.formatMessage({id:"ticket.contact.name.placeholder",defaultMessage:"请输入您的称呼"})}),(0,oe.jsx)(G.Z,{name:"email",label:o.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),placeholder:o.formatMessage({id:"ticket.contact.email.placeholder",defaultMessage:"请输入邮箱地址"}),rules:[{type:"email",message:o.formatMessage({id:"ticket.contact.email.invalid",defaultMessage:"请输入有效的邮箱地址"})}]}),(0,oe.jsx)(G.Z,{name:"phone",label:o.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),rules:[{required:!0,message:o.formatMessage({id:"ticket.contact.phone.required",defaultMessage:"请输入手机号码"})}],placeholder:o.formatMessage({id:"ticket.contact.phone.placeholder",defaultMessage:"请输入手机号码"}),extra:o.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})})]})})},he="df_org_uid",ge=function(){var e=(0,m.useIntl)(),t=u.Z.useApp().message,r=(0,m.useSearchParams)(),a=c()(r,2),s=a[0],o=a[1],P=s.get("status")||"todo",S=(0,p.useState)(P),C=c()(S,2),E=C[0],N=C[1],q=(0,p.useState)(!1),U=c()(q,2),I=U[0],O=U[1],D=(0,p.useRef)(),J=(0,j.Z)().isDarkMode,A=(0,p.useState)(null),G=c()(A,2),X=G[0],R=G[1],_=(0,p.useState)(!1),L=c()(_,2),V=(L[0],L[1]),B=(0,m.useModel)("@@initialState").initialState,z=(null!=B?B:{}).userInfo;(0,p.useEffect)((function(){if(null==B||!B.userInfo){m.history.push("/auth/login?redirect=".concat(encodeURIComponent("/ticket-center")))}}),[B]),(0,p.useEffect)((function(){N(P)}),[P]),(0,p.useEffect)((function(){var r=function(){var r=i()(n()().mark((function r(){var a,s;return n()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return V(!0),r.prev=1,r.next=4,(0,w.sc)();case 4:a=r.sent,Z.Z.debug("平台工单中心配置:",a.data),200===(null==a?void 0:a.code)&&a.data&&R({workgroupUid:a.data.workgroupUid,ticketCenterEnabled:null===(s=a.data.ticketCenterEnabled)||void 0===s||s,description:a.data.description}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),console.error("加载平台工单中心配置失败:",r.t0),t.error(e.formatMessage({id:"ticket.center.settings.load.failed",defaultMessage:"加载平台工单中心配置失败"}));case 13:return r.prev=13,V(!1),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[1,9,13,16]])})));return function(){return r.apply(this,arguments)}}();r()}),[e]);var H,W,K={NEW:{text:e.formatMessage({id:"ticket.status.new",defaultMessage:"新建"}),status:"Default"},OPEN:{text:e.formatMessage({id:"ticket.status.open",defaultMessage:"处理中"}),status:"Processing"},PENDING:{text:e.formatMessage({id:"ticket.status.pending",defaultMessage:"待处理"}),status:"Warning"},RESOLVED:{text:e.formatMessage({id:"ticket.status.resolved",defaultMessage:"已解决"}),status:"Success"},CLOSED:{text:e.formatMessage({id:"ticket.status.closed",defaultMessage:"已关闭"}),status:"Default"}},Q=(e.formatMessage({id:"ticket.priority.low",defaultMessage:"低"}),e.formatMessage({id:"ticket.priority.medium",defaultMessage:"中"}),e.formatMessage({id:"ticket.priority.high",defaultMessage:"高"}),e.formatMessage({id:"ticket.priority.urgent",defaultMessage:"紧急"}),[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",align:"center",search:!1},{title:e.formatMessage({id:"ticket.number",defaultMessage:"工单编号"}),dataIndex:"ticketNumber",key:"ticketNumber",width:150},{title:e.formatMessage({id:"ticket.description",defaultMessage:"描述"}),dataIndex:"description",key:"description",ellipsis:!0},{title:e.formatMessage({id:"ticket.status",defaultMessage:"状态"}),dataIndex:"status",key:"status",width:100,valueType:"select",valueEnum:K,render:function(t,r){return a=r.status,n={NEW:{color:"blue",text:e.formatMessage({id:"ticket.status.new",defaultMessage:"新建"})},OPEN:{color:"green",text:e.formatMessage({id:"ticket.status.open",defaultMessage:"处理中"})},PENDING:{color:"orange",text:e.formatMessage({id:"ticket.status.pending",defaultMessage:"待处理"})},RESOLVED:{color:"cyan",text:e.formatMessage({id:"ticket.status.resolved",defaultMessage:"已解决"})},CLOSED:{color:"default",text:e.formatMessage({id:"ticket.status.closed",defaultMessage:"已关闭"})}}[a]||{color:"default",text:a},(0,oe.jsx)(l.Z,{color:n.color,children:n.text});var a,n}},{title:e.formatMessage({id:"ticket.contact.name",defaultMessage:"联系人"}),dataIndex:"contactName",key:"contactName",width:120,search:!1},{title:e.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),dataIndex:"email",key:"email",width:150,search:!1},{title:e.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),dataIndex:"phone",key:"phone",width:120,search:!1},{title:e.formatMessage({id:"ticket.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",key:"createdAt",width:180,search:!1}]),$=[{path:"/ticket-list",name:e.formatMessage({id:"ticket.list",defaultMessage:"工单列表"}),icon:(0,oe.jsx)(T,{})}];return(0,oe.jsxs)(h.f,{title:(H=(0,b.nt)(),W=(0,b.ye)(),H&&W?W:e.formatMessage({id:"app.title"})),logo:(0,b.do)(),layout:"mix",fixedHeader:!0,fixSiderbar:!0,splitMenus:!1,navTheme:J?"realDark":"light",route:{path:"/",routes:$},location:{pathname:"/".concat(E)},menuItemRender:function(e,t){return(0,oe.jsx)("div",{onClick:function(){var t,r,a=null===(t=e.path)||void 0===t?void 0:t.replace("/","");a&&(r={key:a}.key,N(r),o({status:r}))},children:t})},actionsRender:function(){return[(0,oe.jsx)(k.Z,{},"fullScreen"),(0,oe.jsx)(y.Z,{},"trialTip"),!1,(0,oe.jsx)(M.Z,{},"GotoGithub"),!1,(0,oe.jsx)(x.Z,{},"GotoAgent")]},avatarProps:{src:null==z?void 0:z.avatar,title:(0,oe.jsx)(v.gj,{}),render:function(e,t){return(0,oe.jsx)(v.Kd,{menu:!0,children:t})}},footerRender:function(){return(0,oe.jsx)(v.$_,{})},contentStyle:{margin:0,padding:0,background:J?"#141414":"#f0f2f5"},children:[(0,oe.jsx)(g.Z,{actionRef:D,columns:Q,rowKey:"uid",style:{padding:10},request:function(){var r=i()(n()().mark((function r(a){var s;return n()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,f.N2)({pageNumber:(a.current||1)-1,pageSize:a.pageSize||20,orgUid:he,status:a.status||void 0,priority:a.priority||void 0,ticketNumber:a.ticketNumber||void 0});case 3:if(200!==(null==(s=r.sent)?void 0:s.code)||!s.data){r.next=6;break}return r.abrupt("return",{data:s.data.content||[],success:!0,total:s.data.totalElements||0});case 6:return r.abrupt("return",{data:[],success:!1,total:0});case 9:return r.prev=9,r.t0=r.catch(0),console.error("加载工单列表失败:",r.t0),t.error(e.formatMessage({id:"ticket.list.load.failed",defaultMessage:"加载工单列表失败"})),r.abrupt("return",{data:[],success:!1,total:0});case 14:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(e){return r.apply(this,arguments)}}(),search:{labelWidth:"auto"},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:function(t){return e.formatMessage({id:"pages.table.total",defaultMessage:"共 {total} 条"},{total:t})}},toolBarRender:function(){return[(0,oe.jsx)(d.ZP,{type:"primary",icon:(0,oe.jsx)(F.Z,{}),onClick:function(){return O(!0)},children:e.formatMessage({id:"ticket.create",defaultMessage:"创建工单"})},"create")]}}),(0,oe.jsx)(me,{visible:I,onClose:function(e){var t;(O(!1),e)&&(null===(t=D.current)||void 0===t||t.reload())},orgUid:he,workgroupUid:null==X?void 0:X.workgroupUid})]})},ve=function(){return(0,oe.jsx)(u.Z,{children:(0,oe.jsx)(ge,{})})}}}]);