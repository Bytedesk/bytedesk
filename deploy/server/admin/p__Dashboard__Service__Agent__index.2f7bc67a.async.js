"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{74840:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},r=n(54183),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},56663:function(e,t,n){var i=n(90819),a=n.n(i),s=n(89933),r=n.n(s),o=n(45332),l=n.n(o),u=n(73614),d=n(19433),c=n(12864),g=n(7704),f=n(91361),m=n(98830),v=n(39497),p=n(71256),h=n(25784),x=n(2250),S=n(14906),w=n(44194),y=n(11329),M=n(23753),b=n(31549);t.Z=function(e){var t,n,i,s,o=h.A.useForm(),j=l()(o,1)[0],k=(0,S.useIntl)(),C=(0,f.Z)().translateString,F=(0,m.u)((function(e){return e.currentOrg})),Z=(0,w.useState)(),T=l()(Z,2),q=T[0],U=T[1],A=(0,w.useState)(),L=l()(A,2),R=L[0],P=L[1],E=(0,w.useState)(),I=l()(E,2),z=I[0],N=I[1],K=(0,w.useState)(""),B=l()(K,2),O=B[0],W=B[1],D=(0,w.useRef)(!1),Q=(0,w.useRef)(),V=(0,w.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),H=(0,w.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),J=(0,w.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,w.useCallback)((function(e){j.setFieldValue("welcomeTip",e),J({welcomeTip:e})}),[j,J]);(0,w.useEffect)((function(){if(null!=F&&F.uid&&(Q.current!==F.uid&&(Q.current=F.uid,D.current=!1),!D.current)){D.current=!0;var e=function(){var e=r()(a()().mark((function e(){var t,n,i,s,r,o,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:v.QPQ,orgUid:F.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,M.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(P(n),r=(null===(i=n.data)||void 0===i?void 0:i.content)||[],o=null==H?void 0:H.welcomeKbUid,(l=o||z||(null===(s=r[0])||void 0===s?void 0:s.uid))&&(N(l),j.setFieldValue("welcomeKbUid",l),o!==l&&J({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,k,null==H?void 0:H.welcomeKbUid,z,j,J]),(0,w.useEffect)((function(){if(null!=F&&F.uid&&z){var e=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:F.uid,kbUid:z},e.next=4,(0,c.pf)(t);case 4:n=e.sent,M.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?U(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,z,k]),(0,w.useEffect)((function(){if(H){var e=null==H?void 0:H.welcomeFaqs,t=Array.isArray(H.welcomeFaqUids)?H.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==q||null===(t=q.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==H?void 0:H.welcomeFaqUids,H]);var G=(0,w.useCallback)((function(e){N(e),j.setFieldValue("welcomeFaqUids",[]),J({welcomeKbUid:e,welcomeFaqUids:[]})}),[J,j]);return(0,w.useEffect)((function(){var e=C(null==H?void 0:H.welcomeTip);void 0!==e&&O!==e&&W(e),null!=H&&H.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",H.welcomeKbUid),z!==H.welcomeKbUid&&N(H.welcomeKbUid))}),[C,null==H?void 0:H.welcomeTip,null==H?void 0:H.welcomeKbUid,O,j,z,null==R||null===(n=R.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,b.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,b.jsx)(h.A.Item,{name:"welcomeTip",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,b.jsx)(y.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:O,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,b.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==R||null===(i=R.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,b.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,b.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==q||null===(s=q.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,b.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return J({welcomeFaqUids:e})}}})]})}},12650:function(e,t,n){n.r(t),n.d(t,{default:function(){return ve}});var i=n(44194),a=n(67738),s=n(14906),r=n(76711),o=n.n(r),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),m=n(45332),v=n.n(m),p=n(77033),h=n(82770),x=n(39487),S=n(32525),w=n(50716),y=n(92354),M=n(81739),b=n(66431),j=n(63649),k=n(74840),C=n(29337),F=n(68779),Z=n(12322),T=n(31806),q=n(56482),U=n(10162),A=n(59304),L=n(54881),R=n(47944),P=n(80556),E=n(55785),I=n(49764),z=n(19433),N=n(2890),K=n(98830),B=n(75112),O=n(14597),W=n(39497),D=n(99665),Q=n(27153),V=(n(84262),n(66547)),H=(n(94212),n(24479),n(43054)),J=n(90631),Y=n(1460),G=n(56663),X=n(417),_=(n(52260),n(24476)),$=n(58791),ee=n(23753),te=n(31549),ne=function(){var e=(0,s.useIntl)(),t=(0,K.u)((function(e){return e.currentOrg})),n=(0,B.Z)(),r=n.leftSiderStyle,l=(n.contentStyle,(0,O.Z)().isDarkMode),d=(0,i.useState)(!1),g=v()(d,2),m=g[0],W=g[1],ne=(0,i.useState)([]),ie=v()(ne,2),ae=ie[0],se=ie[1],re=(0,i.useState)(),oe=v()(re,2),le=oe[0],ue=oe[1],de=(0,i.useState)(""),ce=v()(de,2),ge=ce[0],fe=ce[1],me=(0,i.useState)("tips"),ve=v()(me,2),pe=ve[0],he=ve[1],xe=(0,i.useState)(!1),Se=v()(xe,2),we=Se[0],ye=Se[1],Me=(0,i.useState)(null),be=v()(Me,2),je=be[0],ke=be[1],Ce=(0,i.useMemo)((function(){return ae.find((function(e){return e.uid===le}))||null}),[ae,le]),Fe=(0,i.useState)(!1),Ze=v()(Fe,2),Te=Ze[0],qe=Ze[1],Ue=(0,i.useState)(!1),Ae=v()(Ue,2),Le=Ae[0],Re=Ae[1],Pe=(0,D.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),Ee=Pe.setCurrentAgentSettings,Ie=Pe.currentAgentSettings,ze=(0,i.useState)(!1),Ne=v()(ze,2),Ke=Ne[0],Be=Ne[1],Oe=(0,i.useRef)(""),We=(0,i.useMemo)((function(){var e;return null!==(e=null!=Ie?Ie:Ce)&&void 0!==e?e:null}),[Ie,Ce]),De=(0,i.useCallback)((function(e){if(Ie){var t=Ie.draftServiceSettings||Ie.serviceSettings||{};Ee(f()(f()({},Ie),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[Ie,Ee]),Qe=(0,i.useCallback)((function(e){if(Ie){var t=Ie.draftInviteSettings||Ie.inviteSettings||{};Ee(f()(f()({},Ie),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[Ie,Ee]),Ve=(0,i.useCallback)((function(e){if(Ie){var t=Ie.draftMessageLeaveSettings||Ie.messageLeaveSettings||{};Ee(f()(f()({},Ie),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[Ie,Ee]),He=(0,i.useCallback)((function(e){if(Ie){var t=Ie.draftWorktimeSettings||Ie.worktimeSettings||{};Ee(f()(f()({},Ie),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[Ie,Ee]),Je=(0,i.useCallback)((function(e){if(Ie){var t=Ie.draftQueueSettings||Ie.queueSettings||{};Ee(f()(f()({},Ie),{},{draftQueueSettings:f()(f()({},t),e)}))}}),[Ie,Ee]),Ye=(0,i.useCallback)((function(e){Ie&&Ee(f()(f()({},Ie),e))}),[Ie,Ee]),Ge=(0,i.useMemo)((function(){if(!ge)return ae;var e=ge.toLowerCase();return ae.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[ae,ge]),Xe=(0,i.useCallback)(function(){var e=c()(u()().mark((function e(n,i){var a,s,r,o,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return W(!0),a="welcome",e.prev=4,r=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=9,(0,N.u9)(o);case 9:l=e.sent,ee.Z.debug("加载客服配置模板列表: ",l,o),d=(null==l||null===(s=l.data)||void 0===s?void 0:s.content)||[],se(d),!(d.length>0)||le&&d.some((function(e){return e.uid===le}))||(ue(d[0].uid),null!=i&&i.keepActive||he(a));case 14:return e.prev=14,W(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[4,,14,17]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,le]);(0,i.useEffect)((function(){Xe(ge)}),[null==t?void 0:t.uid]),(0,i.useEffect)((function(){Ce?(Ee(Ce),Oe.current=JSON.stringify(null!=Ce?Ce:{}),Be(!1)):(Ee(null),Oe.current=JSON.stringify({}),Be(!1))}),[le]),(0,i.useEffect)((function(){if(Ce)try{var e=JSON.stringify(null!=Ie?Ie:{});Be(e!==Oe.current)}catch(e){Be(!0)}}),[Ie,null==Ce?void 0:Ce.uid]);var _e=function(){var n=c()(u()().mark((function n(i){var a,s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=i?i:Ce)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,N.SJ)(s);case 6:r=n.sent,console.log("删除客服配置模板结果：",r,s),r&&200===r.code?(z.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Xe(ge)):z.yw.error((null==r?void 0:r.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),$e=function(){var n=c()(u()().mark((function n(i,a){var s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:i,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,N.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,N.iO)(s);case 10:n.t0=n.sent;case 11:(r=n.t0)&&200===r.code?(z.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),Xe(ge)):z.yw.error((null==r?void 0:r.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),z.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),et=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},tt=function(e){if(e){var t=et(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var a=null==e?void 0:e[i];if(Array.isArray(a)){var s=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickFaqUids","quickFaqs"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var i=function(e){if(e)return et(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},nt=function(e){if(e)return et(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},it=function(e){if(e)return et(e,["name","description","color","order"])},at=function(e){if(e)return et(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},st=function(e){if(e)return et(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueNoticeBatchWindowMs"])},rt=function(e){if(e)return et(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},ot=function(e){if(e)return et(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},lt=function(e){if(e)return et(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},ut=function(e){if(e)return et(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},dt=function(){var n=c()(u()().mark((function n(){var i,a,s,r,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ce&&Ce.uid){n.next=3;break}return z.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return qe(!0),n.prev=4,i=Ie&&Ie.uid===Ce.uid?Ie:Ce,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:Ce.uid,orgUid:null==t?void 0:t.uid,name:null==i?void 0:i.name,description:null==i?void 0:i.description,isDefault:null==i?void 0:i.isDefault,enabled:null==i?void 0:i.enabled,serviceSettings:tt(a(null==i?void 0:i.serviceSettings,null==i?void 0:i.draftServiceSettings)),inviteSettings:nt(a(null==i?void 0:i.inviteSettings,null==i?void 0:i.draftInviteSettings)),intentionSettings:it(a(null==i?void 0:i.intentionSettings,null==i?void 0:i.draftIntentionSettings)),maxThreadCount:null==i?void 0:i.maxThreadCount,timeoutRemindEnabled:null==i?void 0:i.timeoutRemindEnabled,timeoutRemindTime:null==i?void 0:i.timeoutRemindTime,timeoutRemindTip:null==i?void 0:i.timeoutRemindTip,messageLeaveSettings:at(a(null==i?void 0:i.messageLeaveSettings,null==i?void 0:i.draftMessageLeaveSettings)),worktimeSettings:rt(a(null==i?void 0:i.worktimeSettings,null==i?void 0:i.draftWorktimeSettings)),autoReplySettings:ot(a(null==i?void 0:i.autoReplySettings,null==i?void 0:i.draftAutoReplySettings)),queueSettings:st(a(null==i?void 0:i.queueSettings,null==i?void 0:i.draftQueueSettings)),rateDownSettings:lt(a(null==i?void 0:i.rateDownSettings,null==i?void 0:i.draftRateDownSettings)),agentStatusSettings:ut(a(null==i?void 0:i.agentStatusSettings,null==i?void 0:i.draftAgentStatusSettings))},n.next=10,(0,N.wU)(s);case 10:r=n.sent,console.log("保存客服配置模板结果：",r,s),r&&200===r.code?(z.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),d=null!==(o=null!==(l=r.data)&&void 0!==l?l:i)&&void 0!==o?o:{},Oe.current=JSON.stringify(d),Be(!1),Xe(ge,{keepActive:!0})):z.yw.error((null==r?void 0:r.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),z.yw.error("保存失败");case 19:return n.prev=19,qe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),ct=function(){var n=c()(u()().mark((function n(){var i,a,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ce&&Ce.uid){n.next=3;break}return z.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Re(!0),n.prev=4,!Ke){n.next=8;break}return n.next=8,dt();case 8:return i={uid:Ce.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,N.Xy)(i);case 11:(a=n.sent)&&200===a.code?(z.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Oe.current=JSON.stringify(null!==(s=a.data)&&void 0!==s?s:{}),Be(!1),Xe(ge)):z.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),z.yw.error("发布失败");case 19:return n.prev=19,Re(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),gt=(0,i.useMemo)((function(){return null!=Ce&&Ce.uid?[{key:"welcome",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(k.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,te.jsx)(G.Z,{serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:De})},{key:"tips",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(C.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,te.jsx)(Y.Z,{variant:"agent",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:De})},{key:"service",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(F.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,te.jsx)(J.Z,{variant:"agent",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},agentMeta:{maxThreadCount:null==We?void 0:We.maxThreadCount,timeoutRemindTime:null==We?void 0:We.timeoutRemindTime},onServiceSettingsChange:De,onAgentMetaChange:Ye})},{key:"rate",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(Z.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,te.jsx)(Q.Z,{variant:"agent",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:De})},{key:"messageLeave",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(T.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"agent.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,te.jsx)(X.Z,{variant:"agent",messageLeaveSettings:{live:null==We?void 0:We.messageLeaveSettings,draft:null==We?void 0:We.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Ve})},{key:"queue",label:(0,te.jsxs)("span",{children:[(0,te.jsx)($.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"agent.settings.queue",defaultMessage:"排队设置"})]}),children:(0,te.jsx)(_.Z,{variant:"agent",queueSettings:{live:null==We?void 0:We.queueSettings,draft:null==We?void 0:We.draftQueueSettings},onQueueSettingsChange:Je})}].concat(o()([]),o()([]),[{key:"right",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(q.Z,{})," ",(0,te.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,te.jsx)(V.Z,{variant:"agent",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:De,settingsUid:Ce.uid,isActive:"right"===pe})}],o()([]),o()([])):[]}),[null==Ce?void 0:Ce.uid,We,De,Qe,Ve,He,Je,e,pe]);return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,te.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,te.jsxs)(I.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,te.jsx)(h.ZP,{size:"small",icon:(0,te.jsx)(U.Z,{}),type:"primary",onClick:function(){ke(null),ye(!0)},children:(0,te.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:m,children:[(0,te.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,te.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,te.jsx)(S.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:ge,onChange:function(e){return fe(e.target.value)},onPressEnter:function(e){Xe(ge)},allowClear:!0,size:"middle"}),(0,te.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return Xe(ge)},children:"搜索"})]})}),(0,te.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,te.jsx)(w.Z,{dataSource:Ge,locale:{emptyText:(0,te.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,te.jsx)(w.Z.Item,{style:le===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ue(e.uid)},children:(0,te.jsx)(w.Z.Item.Meta,{title:(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,te.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,te.jsx)(x.Z,{size:4,children:e.isDefault?(0,te.jsx)(M.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,te.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,te.jsx)(p.Z.Panel,{children:Ce?(0,te.jsx)(I.Z,{title:(0,te.jsxs)(x.Z,{children:[(0,te.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",Ce.name||Ce.uid]}),(0,te.jsx)(b.Z,{checked:Ce.enabled,onChange:function(e){return $e(Ce.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,te.jsx)(h.ZP,{size:"small",icon:(0,te.jsx)(A.Z,{}),onClick:function(e){var t;e.stopPropagation(),ke(null!=(t=Ce)?t:Ce),ye(!0)},children:"编辑"}),(0,te.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),_e(Ce)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,te.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,te.jsx)(L.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),Ce.isDefault?(0,te.jsx)(M.Z,{color:"blue",children:"默认"}):null]}),extra:(0,te.jsxs)(x.Z,{children:[(0,te.jsx)(j.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),ct()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,te.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Le,type:"default",icon:(0,te.jsx)(R.Z,{}),children:(0,te.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,te.jsx)(h.ZP,{onClick:function(){Ce&&(Ee(Ce),Oe.current=JSON.stringify(null!=Ce?Ce:{}),Be(!1))},disabled:!Ke,icon:(0,te.jsx)(P.Z,{}),children:(0,te.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,te.jsx)(h.ZP,{type:"primary",loading:Te,onClick:dt,disabled:!Ke,icon:(0,te.jsx)(E.Z,{}),children:(0,te.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,te.jsx)(a.Z,{activeKey:pe,onChange:he,items:gt,style:{minHeight:"calc(100vh - 280px)"}})}):(0,te.jsx)(I.Z,{children:(0,te.jsx)(y.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,te.jsx)(H.Z,{open:we,onOpenChange:ye,orgUid:(null==t?void 0:t.uid)||"",record:je,onSuccess:function(){ye(!1),Xe(ge)}})]})},ie=n(52595),ae=n(84176),se=n.n(ae);function re(e){return oe.apply(this,arguments)}function oe(){return(oe=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/agent/status/query/org",{method:"GET",params:f()(f()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=n(5932),ue=n(89246),de=n(61107),ce=n(96596),ge=n.n(ce),fe=["current","pageSize"],me=function(){var e=(0,s.useIntl)(),t=(0,i.useRef)(),n=(0,i.useState)(1),a=v()(n,2),r=a[0],o=a[1],l=(0,i.useState)(10),d=v()(l,2),g=d[0],m=d[1],p=(0,K.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,te.jsx)(s.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,te.jsx)(s.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,te.jsx)(te.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,te.jsx)(s.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,te.jsx)(s.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,te.jsx)(M.Z,{color:"green",children:(0,te.jsx)(s.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,te.jsx)(M.Z,{color:"red",children:(0,te.jsx)(s.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,te.jsx)(M.Z,{color:"orange",children:(0,te.jsx)(s.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,te.jsx)(s.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,te.jsx)(s.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,i){return ge()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],S=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,g),t=localStorage.getItem(W.LA8),window.open((0,le.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==p?void 0:p.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,te.jsx)(ue.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,i){var a,s,r,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,i),a=t.current,s=t.pageSize,r=se()(t,fe),o(a),m(s),l=f()({pageNumber:a-1,pageSize:s,orgUid:null==p?void 0:p.uid},r),e.next=7,re(l);case 7:return d=e.sent,console.log("queryAgentStatusByOrg response:",l,d),200===d.code||z.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){o(e),m(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,te.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,te.jsx)(P.Z,{}),children:(0,te.jsx)(s.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,te.jsx)(h.ZP,{onClick:S,type:"primary",icon:(0,te.jsx)(de.Z,{}),children:(0,te.jsx)(s.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},ve=function(){return(0,te.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,te.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,te.jsx)(ie.Z,{})},{key:"settings",label:(0,te.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,te.jsx)(ne,{})},{key:"agentStatus",label:(0,te.jsx)(s.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,te.jsx)(me,{})}]})}}}]);