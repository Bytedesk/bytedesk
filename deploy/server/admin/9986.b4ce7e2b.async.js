"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9986],{86567:function(e,t,a){a.d(t,{Z:function(){return H}});var r=a(90819),n=a.n(r),s=a(89933),i=a.n(s),o=a(45332),l=a.n(o),u=a(15722),c=a(90727),d=a(82669),g=a(80556),f=a(59304),p=a(54881),m=a(2484),h=a(46141),y=a(48769),v=a(3925),M=a(70984),x=a(71277),k=a(51936),w=a(1691),b=a(74192),C=a(73193),j=a.n(C),S=a(76711),Z=a.n(S),T=a(93527),z=a(44679),U=a(56773),D=a(14888),E=a(30064),B=a(86684),F=a(68263),O=a(74491),K=a(44194),L=a(47598),P=a(19736),A=a(6844),I=a(31549),N=function(e){return e===A.p$M||e===A.hXJ},R=function(e){var t,a=e.open,r=e.level,s=e.type,o=e.showKbase,u=void 0===o||o,c=e.isEdit,d=e.onCancel,g=e.onSubmit,f=(0,P.useIntl)(),p=E.A.useForm(),m=l()(p,1)[0],y=(0,z.Z)().translateString,v=(0,D.u)((function(e){return e.currentOrg})),M=(0,U.j)((function(e){return e.kbaseResult})),x=(0,U.j)((function(e){return e.currentKbase})),k=(0,L.v)((function(e){return{currentCategory:e.currentCategory,categoryTreeOptions:e.categoryTreeOptions}})),w=k.currentCategory,b=k.categoryTreeOptions;(0,K.useEffect)((function(){c?m.setFieldsValue({name:y(null==w?void 0:w.name),parentUid:(null==w?void 0:w.parentUid)||A.zBg}):(m.resetFields(),m.setFieldsValue({parentUid:null!=w&&w.uid&&w.uid!==A.zBg?w.uid:A.zBg})),m.setFieldsValue({kbUid:null==x?void 0:x.uid}),N(s)&&m.setFieldsValue({ticketCategoryType:s})}),[a,c]);var C=function(){m.validateFields().then(function(){var e=i()(n()().mark((function e(t){var a,i,o;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),a=t.parentUid===A.zBg?void 0:t.parentUid,i=N(s)?t.ticketCategoryType:s,o={uid:c?null==w?void 0:w.uid:"",name:t.name,level:r,type:i,parentUid:a,kbUid:t.kbUid,orgUid:null==v?void 0:v.uid},g(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),T.yw.error(f.formatMessage({id:c?"pages.category.update.failed":"pages.category.create.failed"}))}))},S=(0,K.useMemo)((function(){var e,t,a=function e(t){return t.map((function(t){return{title:y(t.title),key:t.key,disabled:t.disabled,children:t.children?e(t.children):void 0}}))}(b||[]);a.length>0&&(null===(e=a[0])||void 0===e?void 0:e.key)===A.zBg&&(a[0].title=f.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}));var r=c?null==w?void 0:w.uid:void 0;if(!r)return a;var n=function e(t){var a;t&&(t.disabled=!0,null===(a=t.children)||void 0===a||a.forEach(e))};return function e(t){t&&t.forEach((function(t){var a;t.key===r?n(t):null!==(a=t.children)&&void 0!==a&&a.length&&e(t.children)}))}(a),a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.key)===A.zBg?a:[{title:f.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),key:A.zBg,children:void 0}].concat(Z()(a))}),[b,c,null==w?void 0:w.uid,f,y]),R=(0,K.useMemo)((function(){return f.formatMessage({id:"pages.category.drawer.parent.placeholder",defaultMessage:"选择上级分类（留空则为顶级）"})}),[f]),q=(0,K.useCallback)((function(e,t){var a=null==t?void 0:t.title;return("string"==typeof a?a:String(null!=a?a:"")).toLowerCase().includes(e.toLowerCase())}),[]),V=(0,K.useMemo)((function(){return{allowClear:!0,placeholder:R,treeData:S,fieldNames:{label:"title",value:"key",children:"children"},treeDefaultExpandAll:!0,treeDataSimpleMode:!1,showSearch:!0,filterTreeNode:q,variant:"outlined"}}),[q,R,S]);return(0,I.jsx)("div",{children:(0,I.jsx)(h.Z,{title:c?f.formatMessage({id:"pages.category.drawer.edit"}):f.formatMessage({id:"pages.category.drawer.create"}),open:a,forceRender:!0,onOk:C,onCancel:d,getContainer:!1,okText:f.formatMessage({id:"pages.category.drawer.save"}),cancelText:f.formatMessage({id:"pages.category.drawer.cancel"}),children:(0,I.jsxs)(E.A,{form:m,name:"categoryForm",submitter:!1,children:[(0,I.jsx)(B.Z,{label:f.formatMessage({id:"pages.category.drawer.name",defaultMessage:"分类名称"}),name:"name",rules:[{required:!0,message:f.formatMessage({id:"pages.category.drawer.name.required",defaultMessage:"请输入名称!"})}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&C()},placeholder:f.formatMessage({id:"pages.category.drawer.name.placeholder",defaultMessage:"请输入分类名称"})}}),N(s)&&(0,I.jsx)(F.Z,{name:"ticketCategoryType",label:f.formatMessage({id:"pages.category.drawer.ticketType",defaultMessage:"工单类型"}),rules:[{required:!0,message:f.formatMessage({id:"pages.category.drawer.ticketType.required",defaultMessage:"请选择工单类型!"})}],options:[{label:f.formatMessage({id:"ticket.tab.external",defaultMessage:"外部工单"}),value:A.hXJ},{label:f.formatMessage({id:"ticket.tab.internal",defaultMessage:"内部工单"}),value:A.p$M}]}),(0,I.jsx)(E.A.Item,{name:"parentUid",label:f.formatMessage({id:"pages.category.drawer.parent",defaultMessage:"上级分类"}),children:(0,I.jsx)(O.Z,j()({},V))}),u&&(0,I.jsx)(F.Z,{name:"kbUid",label:f.formatMessage({id:"pages.category.drawer.kb"}),allowClear:!0,options:null==M||null===(t=M.data)||void 0===t?void 0:t.content.map((function(e){return{label:y(e.name),value:e.uid}}))})]})})})},q=a(88165),V=a(36125),H=function(e){var t=e.type,a=e.level,r=e.showKbase,s=void 0===r||r,o=(0,P.useIntl)(),C=(0,K.useState)(!0),j=l()(C,2),S=j[0],Z=j[1],E=(0,K.useState)(!1),B=l()(E,2),F=B[0],O=B[1],N=(0,K.useState)(1),H=l()(N,2),J=H[0],X=H[1],$=(0,K.useState)(20),W=l()($,2),G=W[0],Q=W[1],Y=(0,K.useState)(0),_=l()(Y,2),ee=_[0],te=_[1],ae=(0,K.useState)(""),re=l()(ae,2),ne=re[0],se=re[1],ie=(0,D.u)((function(e){return e.currentOrg})),oe=(0,U.j)((function(e){return e.currentKbase})),le=(0,K.useState)(!1),ue=l()(le,2),ce=ue[0],de=ue[1],ge=(0,L.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid,resetDefaultCategory:e.resetDefaultCategory}})),fe=ge.categoryTreeOptions,pe=ge.currentCategory,me=ge.setCurrentCategoryUid,he=ge.resetDefaultCategory,ye=(0,z.Z)(),ve=ye.translateString,Me=ye.translateStringTranct,xe=h.Z.useModal(),ke=l()(xe,2),we=ke[0],be=ke[1],Ce=function(){var e=i()(n()().mark((function e(){var r,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),r=s?null==oe?void 0:oe.uid:"",e.next=4,(0,q.HK)(t,null==ie?void 0:ie.uid,r,a,{showLoading:!0,pageSize:G,pageNumber:J-1,searchName:ne,loadingMessage:o.formatMessage({id:"loading"}),errorMessage:o.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:i=e.sent,V.Z.debug("refreshCategories response: ",null==i?void 0:i.data),O(!1),i&&null!=i&&i.data&&te((null==i?void 0:i.data.totalElements)||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(e){se(e),X(1),setTimeout((function(){Ce()}),0)},Se=function(e,t){X(e),t&&t!==G&&Q(t),setTimeout((function(){Ce()}),0)},Ze=function(){var e=i()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z(!1),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=i()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z(!0),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(){var e=i()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,q.sT)(t,{showLoading:!0,loadingMessage:o.formatMessage({id:"deleting"}),successMessage:o.formatMessage({id:"delete.success"}),errorMessage:o.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&Ce();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=i()(n()().mark((function e(t){var a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={showLoading:!0,loadingMessage:o.formatMessage({id:S?"updating":"creating"}),successMessage:o.formatMessage({id:S?"update.success":"create.success"}),errorMessage:o.formatMessage({id:S?"update.error":"create.error",defaultMessage:S?"Update failed":"Create failed"})},!S){e.next=7;break}return e.next=4,(0,q.ht)(t,a);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,q.i8)(t,a);case 9:e.t0=e.sent;case 10:e.t0&&(de(!1),Ce());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,K.useEffect)((function(){s&&(X(1),se(""),Ce())}),[oe]),(0,K.useEffect)((function(){X(1),se(""),he();var e=setTimeout((function(){Ce()}),0);return function(){return clearTimeout(e)}}),[t,he]);return(0,I.jsxs)("div",{children:[(0,I.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(ee/G)>1||""!==ne)&&(0,I.jsx)(y.Z,{placeholder:o.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,I.jsx)(c.Z,{}),suffix:(0,I.jsx)(v.ZP,{type:"text",size:"small",icon:(0,I.jsx)(c.Z,{}),onClick:function(){return je(ne)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,I.jsx)("span",{onClick:function(e){e.stopPropagation(),se(""),X(1),Ce()}})},value:ne,onChange:function(e){var t=e.target.value;se(t),t||(X(1),setTimeout((function(){Ce()}),0))},onPressEnter:function(e){return je(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,I.jsxs)(M.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,I.jsxs)(M.Z,{gap:"small",children:[(0,I.jsx)(v.ZP,{type:"primary",size:"small",icon:(0,I.jsx)(d.Z,{}),onClick:Ze,children:o.formatMessage({id:"create.category"})}),(0,I.jsx)(v.ZP,{size:"small",icon:(0,I.jsx)(g.Z,{spin:F}),onClick:Ce,loading:F,children:o.formatMessage({id:"refresh"})})]}),""!==(null==pe?void 0:pe.uid)&&(null==pe?void 0:pe.uid)!==A.zBg&&(0,I.jsx)(x.Z,{menu:{items:[{key:"edit",icon:(0,I.jsx)(f.Z,{}),label:o.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Te},{key:"delete",icon:(0,I.jsx)(p.Z,{}),label:o.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==A.zBg?we.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,I.jsx)(u.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ve(e.name),"】？"),onOk:function(){ze(e)},onCancel:function(){},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})}):T.yw.error(o.formatMessage({id:"delete.dept.all.error"}))}(pe)}}]},children:(0,I.jsx)(v.ZP,{size:"small",icon:(0,I.jsx)(m.Z,{})})})]})]}),(0,I.jsx)(k.Z,{defaultSelectedKeys:[null==pe?void 0:pe.uid],selectedKeys:[null==pe?void 0:pe.uid],onSelect:function(e,t){0!==e.length&&me(e[0].toString())},treeData:fe,blockNode:!0,titleRender:function(e){return(0,I.jsx)(w.Z,{title:ve(e.title),children:Me(e.title)})}}),Math.ceil(ee/G)>1&&(0,I.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,I.jsx)(b.Z,{size:"small",current:J,pageSize:G,total:ee,onChange:Se,onShowSizeChange:Se,showSizeChanger:!1,showLessItems:!0}),(0,I.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:o.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:ee})})]}),ce&&(0,I.jsx)(R,{open:ce,type:t,showKbase:s,isEdit:S,onCancel:function(){de(!1)},onSubmit:Ue}),be]})}},88449:function(e,t,a){var r=a(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}}}]);