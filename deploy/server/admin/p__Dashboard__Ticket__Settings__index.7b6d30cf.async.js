"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5800],{6317:function(e,t,n){n.d(t,{dI:function(){return g},xg:function(){return c}});var s=n(90819),r=n.n(s),i=n(73193),a=n.n(i),o=n(89933),u=n.n(o),l=n(36265),d=n(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/form/query/org",{method:"GET",params:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/form/delete",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},15338:function(e,t,n){n.d(t,{Bo:function(){return v},Gx:function(){return c},OI:function(){return M},Q3:function(){return g},hW:function(){return k},sz:function(){return p}});var s=n(90819),r=n.n(s),i=n(73193),a=n.n(i),o=n(89933),u=n.n(o),l=n(36265),d=n(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/query/org",{method:"GET",params:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/update",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/delete",{method:"POST",data:{uid:t,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/deploy",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/reset",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/undeploy",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},20188:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return p},Gv:function(){return M},bD:function(){return g},mE:function(){return k},nQ:function(){return j},nU:function(){return v},oX:function(){return Z}});var s=n(90819),r=n.n(s),i=n(73193),a=n.n(i),o=n(89933),u=n.n(o),l=n(5861),d=n(36265);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){var n,s,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,s=t.workgroupUid,i=t.type,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(s),{method:"GET",params:{channel:d.XtJ,type:i}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return w.apply(this,arguments)}function w(){return(w=u()(r()().mark((function e(t,n){var s,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.uid,i=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(s,"/orgs/").concat(i,"/bindings"),{method:"POST",data:a()(a()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},76071:function(e,t,n){var s=n(74494);t.Z=function(){var e=(0,s.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},43588:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ne}});var s=n(73193),r=n.n(s),i=n(90819),a=n.n(i),o=n(89933),u=n.n(o),l=n(45332),d=n.n(l),c=n(44194),f=n(5861),g=n(73120),m=n(33154),p=n(2157),h=n(76185),v=n(33122),x=n(92011),M=n(11258),y=n(96082),k=n(95111),b=n(44877),j=n(67878),w=n(6430),Z=n(5415),C=n(71389),S=n(6992),F=n(41881),P=n(91768),T=n(28172),E=n(35911),I=n(90417),q=n(5286),O=n(71865),U=n(74494),N=n(76071),L=n(20188),z=n(74543),A=n(21152),J=n(72083),B=n(36265),D=(0,z.Ue)()((0,A.mW)((0,A.tJ)((0,J.n)((function(e){return{currentTicketSettings:null,ticketSettingsMap:{},setCurrentTicketSettings:function(t){return e({currentTicketSettings:t})},setTicketSettingsForWorkgroup:function(t,n){return e((function(e){e.ticketSettingsMap[t]=n}))},updateCurrentTicketSettings:function(t){return e((function(e){e.currentTicketSettings&&("function"==typeof t?t(e.currentTicketSettings):e.currentTicketSettings=r()(r()({},e.currentTicketSettings),t))}))},removeTicketSettingsForWorkgroup:function(t){return e((function(e){delete e.ticketSettingsMap[t]}))},clearAll:function(){return e({currentTicketSettings:null,ticketSettingsMap:{}})}}})),{name:B.rpR+"_TICKET"}))),X=n(37351),W=n(15384),Q=n(63642),_=n(10497),G=n(46435),R=n(63889),H=n(20921),K=n(48365),V=n(8651),$=n(27987),Y=n(34937),ee=n(63508),te=n(40845),ne=n(31549),se=X.Z.Text,re=X.Z.Title,ie=(W.Z.Option,function(e){var t=e.record,n=e.form,s=Q.Z.useWatch(t.showField,n);return(0,ne.jsx)(te.A.Item,{name:t.requireField,valuePropName:"checked",noStyle:!0,children:(0,ne.jsx)(_.Z,{disabled:!s})})}),ae=function(e){var t,n,s,r=e.settings,i=e.onChange,a=e.hideRequireLogin,o=void 0!==a&&a,u=e.hideContactFields,l=void 0!==u&&u,g=(0,f.useIntl)(),m=te.A.useForm(),p=d()(m,1)[0];(0,c.useEffect)((function(){p.setFieldsValue(r)}),[r,p]);var x=Q.Z.useWatch("numberPrefix",p),M=Q.Z.useWatch("numberLength",p),y=Q.Z.useWatch("enableAutoClose",p),b=null!==(t=null!=x?x:r.numberPrefix)&&void 0!==t?t:"",j=null!==(n=null!=M?M:r.numberLength)&&void 0!==n?n:0,Z=("boolean"==typeof y||r.enableAutoClose,Math.max(0,j-(null!==(s=null==b?void 0:b.length)&&void 0!==s?s:0))),C=Z>0?"".concat("0".repeat(Math.max(Z-3,0)),"123").slice(-Z):"123",S="".concat(b).concat(C),F=(0,c.useMemo)((function(){return[{value:B.vXk,label:g.formatMessage({id:"ticket.settings.assignment.type.round_robin",defaultMessage:"轮询分配"})},{value:B.tSv,label:g.formatMessage({id:"ticket.settings.assignment.type.manual",defaultMessage:"手动分配"})}]}),[g]);return(0,ne.jsxs)(te.A,{form:p,layout:"vertical",submitter:!1,style:{padding:"20px 0"},onValuesChange:function(e){return i(e)},children:[(0,ne.jsxs)("div",{style:{marginBottom:32},children:[(0,ne.jsxs)(h.Z,{size:"small",children:[(0,ne.jsx)(w.Z,{}),(0,ne.jsx)(re,{level:5,style:{margin:0},children:g.formatMessage({id:"ticket.settings.basic.section.number",defaultMessage:"工单编号设置"})})]}),(0,ne.jsxs)(G.Z,{gutter:24,children:[(0,ne.jsx)(R.Z,{span:12,children:(0,ne.jsx)(te.A.Item,{name:"numberPrefix",label:(0,ne.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.numberPrefix",defaultMessage:"工单编号前缀"}),(0,ne.jsx)(H.Z,{title:g.formatMessage({id:"ticket.settings.basic.numberPrefix.tooltip",defaultMessage:"工单编号的前缀，如 TK、WO 等"}),children:(0,ne.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ne.jsx)(v.Z,{maxLength:10,placeholder:g.formatMessage({id:"ticket.settings.basic.numberPrefix.placeholder",defaultMessage:"如：TK、WO"})})})}),(0,ne.jsx)(R.Z,{span:12,children:(0,ne.jsx)(te.A.Item,{name:"numberLength",label:(0,ne.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.numberLength",defaultMessage:"编号长度"}),(0,ne.jsx)(H.Z,{title:g.formatMessage({id:"ticket.settings.basic.numberLength.tooltip",defaultMessage:"工单编号的总长度，包括前缀"}),children:(0,ne.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ne.jsx)(K.Z,{min:Math.max(b.length+1,6),max:20,placeholder:g.formatMessage({id:"ticket.settings.basic.numberLength.placeholder",defaultMessage:"如：8"})})})})]}),(0,ne.jsx)(se,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.sample",defaultMessage:"示例编号：{sample}"},{sample:S})})]}),!o&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(V.Z,{style:{margin:"16px 0"}}),(0,ne.jsxs)("div",{children:[(0,ne.jsx)(re,{level:5,children:g.formatMessage({id:"ticket.settings.basic.section.visitor",defaultMessage:"访客创建限制"})}),(0,ne.jsx)(te.A.Item,{name:"requireLogin",label:g.formatMessage({id:"ticket.settings.basic.requireLogin.label",defaultMessage:"必须登录后才能创建工单"}),valuePropName:"checked",children:(0,ne.jsx)(k.Z,{checkedChildren:g.formatMessage({id:"ticket.settings.basic.requireLogin.on",defaultMessage:"需要登录"}),unCheckedChildren:g.formatMessage({id:"ticket.settings.basic.requireLogin.off",defaultMessage:"允许匿名"})})}),(0,ne.jsx)(se,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.requireLogin.desc",defaultMessage:"启用后，访客必须先通过登录认证才能提交工单。"})})]})]}),(0,ne.jsx)(V.Z,{style:{margin:"16px 0"}}),(0,ne.jsxs)("div",{children:[(0,ne.jsx)(re,{level:5,children:g.formatMessage({id:"ticket.settings.basic.section.assignment",defaultMessage:"工单分配方式"})}),(0,ne.jsx)(te.A.Item,{name:"assignmentMode",label:g.formatMessage({id:"ticket.settings.basic.assignment.label",defaultMessage:"分配方式"}),children:(0,ne.jsx)(W.Z,{options:F,placeholder:g.formatMessage({id:"ticket.settings.basic.assignment.placeholder",defaultMessage:"请选择分配方式"}),disabled:!0})}),(0,ne.jsx)(se,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.assignment.desc",defaultMessage:"用于控制工单创建后如何自动或人工分配给客服人员。"})})]}),!l&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(V.Z,{style:{margin:"16px 0"}}),(0,ne.jsxs)("div",{children:[(0,ne.jsxs)(h.Z,{size:"small",style:{marginBottom:16},children:[(0,ne.jsx)(ee.Z,{}),(0,ne.jsx)(re,{level:5,style:{margin:0},children:g.formatMessage({id:"ticket.settings.basic.section.contact",defaultMessage:"联系方式字段设置"})})]}),(0,ne.jsx)(se,{type:"secondary",style:{display:"block",marginBottom:16},children:g.formatMessage({id:"ticket.settings.basic.contact.desc",defaultMessage:"配置访客提交工单时需要填写的联系方式字段，控制字段的显示和是否必填。"})}),(0,ne.jsx)($.Z,{dataSource:[{key:"contactName",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.contactName",defaultMessage:"联系人姓名"}),showField:"showContactName",requireField:"requireContactName"},{key:"email",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.email",defaultMessage:"邮箱"}),showField:"showEmail",requireField:"requireEmail"},{key:"phone",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.phone",defaultMessage:"手机号"}),showField:"showPhone",requireField:"requirePhone"},{key:"wechat",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.wechat",defaultMessage:"微信"}),showField:"showWechat",requireField:"requireWechat"}],columns:[{title:g.formatMessage({id:"ticket.settings.basic.contact.column.field",defaultMessage:"字段名称"}),dataIndex:"fieldName",key:"fieldName",width:"40%"},{title:g.formatMessage({id:"ticket.settings.basic.contact.column.show",defaultMessage:"显示"}),dataIndex:"showField",key:"showField",width:"30%",render:function(e,t){return(0,ne.jsx)(te.A.Item,{name:t.showField,valuePropName:"checked",noStyle:!0,children:(0,ne.jsx)(_.Z,{})})}},{title:(0,ne.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.contact.column.required",defaultMessage:"必填"}),(0,ne.jsx)(H.Z,{title:g.formatMessage({id:"ticket.settings.basic.contact.column.required.tooltip",defaultMessage:"仅当字段显示时，必填设置才生效"}),children:(0,ne.jsx)(Y.Z,{style:{color:"#999"}})})]}),dataIndex:"requireField",key:"requireField",width:"30%",render:function(e,t){return(0,ne.jsx)(ie,{record:t,form:p})}}],pagination:!1,size:"small",bordered:!0})]})]})]})},oe=n(76711),ue=n.n(oe),le=n(22060),de=n(25709),ce=n(23513),fe=n(73582),ge=n(95199),me=n(47192),pe=n(92395),he=n(67702),ve=n(48586),xe=n(65717),Me=n(94640),ye=n(31661),ke=X.Z.Text,be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"tmp_".concat(e,"_").concat(Math.floor(1e3*Math.random()))},je=function(e){return ue()(e).sort((function(e,t){var n,s,r=null!==(n=e.orderIndex)&&void 0!==n?n:0,i=null!==(s=t.orderIndex)&&void 0!==s?s:0;return r===i?(e.name||"").localeCompare(t.name||""):r-i}))},we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e,t){var n,s,r,i,a;return{uid:null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:be(t),name:(null!==(s=null==e?void 0:e.name)&&void 0!==s?s:"").trim(),description:null!==(r=null==e?void 0:e.description)&&void 0!==r?r:"",enabled:!1!==(null==e?void 0:e.enabled),defaultCategory:null!==(i=null==e?void 0:e.defaultCategory)&&void 0!==i&&i,orderIndex:null!==(a=null==e?void 0:e.orderIndex)&&void 0!==a?a:t}})),n=je(t).map((function(e,t){return r()(r()({},e),{},{orderIndex:t})})),s=!1,i=n.map((function(e){return e.defaultCategory&&e.enabled?s?r()(r()({},e),{},{defaultCategory:!1}):(s=!0,e):e}));if(!s){var a=i.findIndex((function(e){return e.enabled}));a>=0&&(i[a]=r()(r()({},i[a]),{},{defaultCategory:!0}),s=!0)}return!s&&i.length>0&&(i[0]=r()(r()({},i[0]),{},{defaultCategory:!0,enabled:!0})),i},Ze=function(e){var t=e.items,n=e.onChange,s=e.categoryType,i=(0,f.useIntl)(),o=(0,ye.Z)().translateString,l=Q.Z.useForm(),g=d()(l,1)[0],m=(0,c.useState)(!1),x=d()(m,2),j=x[0],w=x[1],Z=(0,c.useState)(null),C=d()(Z,2),S=C[0],T=C[1],E=(0,O.u)((function(e){return e.currentOrg})),I=(0,xe.v)((function(e){return e.categoryTreeOptions})),U=(0,xe.v)((function(e){return e.categoryResult})),N=(0,c.useState)(!1),L=d()(N,2),z=L[0],A=L[1],J=(0,c.useState)([]),D=d()(J,2),X=D[0],W=D[1],_=(0,c.useState)(!1),G=d()(_,2),R=G[0],K=G[1],V=null!=s?s:B.hXJ,Y=(0,c.useMemo)((function(){return we(null!=t?t:[])}),[t]),ee=(0,c.useMemo)((function(){var e,t=Y.filter((function(e){return e.enabled})).length;return{enabled:t,disabled:Y.length-t,defaultUid:null===(e=Y.find((function(e){return e.defaultCategory&&e.enabled})))||void 0===e?void 0:e.uid}}),[Y]);(0,c.useEffect)((function(){null!=E&&E.uid&&(0,Me.HK)(V,E.uid,void 0,B.whQ,{pageSize:200,showLoading:!1})}),[null==E?void 0:E.uid,V]);var te=(0,c.useMemo)((function(){return I.filter((function(e){return e.key!==B.zBg}))}),[I]),se=(0,c.useMemo)((function(){var e,t=[];return function e(n){null!=n&&n.length&&n.forEach((function(n){var s;null!=n&&n.uid&&n.uid!==B.zBg&&(t.push(n),null!==(s=n.children)&&void 0!==s&&s.length&&e(n.children))}))}(null==U||null===(e=U.data)||void 0===e?void 0:e.content),t}),[U]),re=(0,c.useMemo)((function(){var e=new Map;return se.forEach((function(t){t.uid&&e.set(t.uid,t)})),e}),[se]);(0,c.useEffect)((function(){if(z){var e=Y.map((function(e){return e.uid})).filter((function(e){return"string"==typeof e&&e.length>0}));W(e)}}),[z,Y]);var ie=function(e){n(we(e))},ae=function(){var e=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=E&&E.uid){e.next=3;break}return q.yw.warning(i.formatMessage({id:"ticket.settings.category.select.noOrg",defaultMessage:"请先选择一个组织"})),e.abrupt("return");case 3:if(A(!0),0!==te.length){e.next=12;break}return K(!0),e.prev=6,e.next=9,(0,Me.HK)(V,E.uid,void 0,B.whQ,{pageSize:200,showLoading:!1});case 9:return e.prev=9,K(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])})));return function(){return e.apply(this,arguments)}}(),oe=function(e,t){if(e){var n=ue()(Y),s=n.findIndex((function(t){return t.uid===e}));if(!(s<0)){var i="up"===t?s-1:s+1;if(!(i<0||i>=n.length)){var a=n.splice(s,1),o=d()(a,1)[0];n.splice(i,0,o);var u=n.map((function(e,t){return r()(r()({},e),{},{orderIndex:t})}));ie(u)}}}},je=function(){var e=u()(a()().mark((function e(){var t,n,s,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(s=e.sent,null!=S&&S.uid){e.next=6;break}return e.abrupt("return");case 6:o=r()(r()({},S),{},{name:s.name.trim(),description:(null!==(t=s.description)&&void 0!==t?t:"").trim(),enabled:!1!==s.enabled,defaultCategory:!0===s.defaultCategory,orderIndex:null!==(n=S.orderIndex)&&void 0!==n?n:0}),u=Y.map((function(e){return e.uid===S.uid?r()(r()({},e),o):e})),ie(u),w(!1),T(null),g.resetFields(),q.yw.success(i.formatMessage({id:"ticket.settings.category.update.success",defaultMessage:"分类已更新"})),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),Ze=[{title:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.name",defaultMessage:"分类名称"}),dataIndex:"name",key:"name",render:function(e,t){return(0,ne.jsxs)(h.Z,{size:8,children:[t.defaultCategory&&t.enabled?(0,ne.jsx)(y.Z,{color:"gold",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.badge",defaultMessage:"默认"})}):null,(0,ne.jsx)(ke,{strong:!0,children:o(t.name)||"--"})]})}},{title:(0,ne.jsx)(f.FormattedMessage,{id:"common.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",render:function(e,t){return(0,ne.jsx)(k.Z,{checked:!!t.enabled,onChange:function(e){return function(e,t){if(e){var n=Y.map((function(n){return n.uid===e?r()(r()({},n),{},{enabled:t}):n}));ie(n)}}(t.uid,e)}})}},{title:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default",defaultMessage:"默认分类"}),dataIndex:"defaultCategory",key:"defaultCategory",render:function(e,t){return(0,ne.jsx)(H.Z,{title:t.enabled?i.formatMessage({id:"ticket.settings.category.makeDefault",defaultMessage:"设为默认分类"}):i.formatMessage({id:"ticket.settings.category.default.disabled",defaultMessage:"启用后方可设为默认"}),children:(0,ne.jsx)(p.ZP,{type:"text",icon:t.enabled&&t.defaultCategory?(0,ne.jsx)(ge.Z,{style:{color:"#faad14"}}):(0,ne.jsx)(me.Z,{}),disabled:!t.enabled,onClick:function(){return function(e){if(e){var t=Y.map((function(t){return r()(r()({},t),{},{defaultCategory:t.uid===e})}));ie(t)}}(t.uid)}})})}},{title:(0,ne.jsx)(f.FormattedMessage,{id:"common.order",defaultMessage:"排序"}),key:"order",render:function(e,t,n){return(0,ne.jsxs)(h.Z,{children:[(0,ne.jsx)(H.Z,{title:i.formatMessage({id:"common.move.up",defaultMessage:"上移"}),children:(0,ne.jsx)(p.ZP,{type:"text",icon:(0,ne.jsx)(pe.Z,{}),disabled:0===n,onClick:function(){return oe(t.uid,"up")}})}),(0,ne.jsx)(H.Z,{title:i.formatMessage({id:"common.move.down",defaultMessage:"下移"}),children:(0,ne.jsx)(p.ZP,{type:"text",icon:(0,ne.jsx)(he.Z,{}),disabled:n===Y.length-1,onClick:function(){return oe(t.uid,"down")}})})]})}},{title:(0,ne.jsx)(f.FormattedMessage,{id:"common.actions",defaultMessage:"操作"}),key:"actions",render:function(e,t){return(0,ne.jsxs)(h.Z,{size:8,children:[(0,ne.jsx)(p.ZP,{type:"link",icon:(0,ne.jsx)(F.Z,{}),onClick:function(){return function(e){T(e),g.setFieldsValue({name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory}),w(!0)}(t)},children:(0,ne.jsx)(f.FormattedMessage,{id:"common.edit",defaultMessage:"编辑"})}),(0,ne.jsx)(b.Z,{title:i.formatMessage({id:"ticket.settings.category.delete.confirm",defaultMessage:"确认删除该分类？"}),onConfirm:function(){return function(e){if(e){var t=Y.filter((function(t){return t.uid!==e}));ie(t),q.yw.success(i.formatMessage({id:"ticket.settings.category.delete.success",defaultMessage:"分类已删除"}))}}(t.uid)},okText:i.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ne.jsx)(p.ZP,{type:"link",danger:!0,icon:(0,ne.jsx)(P.Z,{}),children:(0,ne.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})})]})}}];return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsxs)(le.Z,{title:(0,ne.jsxs)(h.Z,{size:8,children:[(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.title",defaultMessage:"分类列表"}),(0,ne.jsx)(y.Z,{color:"blue",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.summary",defaultMessage:"启用 {enabled} / 禁用 {disabled}",values:{enabled:ee.enabled,disabled:ee.disabled}})}),ee.defaultUid?(0,ne.jsx)(y.Z,{color:"gold",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.current",defaultMessage:"默认已设置"})}):(0,ne.jsx)(y.Z,{color:"red",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.missing",defaultMessage:"请设置默认分类"})})]}),extra:(0,ne.jsx)(p.ZP,{type:"primary",icon:(0,ne.jsx)(ve.Z,{}),onClick:ae,children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.selectFromTree",defaultMessage:"从分类树选择"})}),styles:{body:{padding:0}},children:[(0,ne.jsx)($.Z,{columns:Ze,dataSource:Y,rowKey:function(e){var t,n;return null!==(t=null!==(n=e.uid)&&void 0!==n?n:e.name)&&void 0!==t?t:be()},pagination:!1}),(0,ne.jsx)("div",{style:{padding:"16px 24px"},children:(0,ne.jsx)(ke,{type:"secondary",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.hint",defaultMessage:"至少保留一个启用的分类，并指定默认分类供访客预选。"})})})]}),(0,ne.jsx)(de.Z,{open:z,title:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.title",defaultMessage:"选择工单分类"}),onOk:function(){if(0!==X.length){var e=new Set(X),t=Y.filter((function(t){return t.uid&&e.has(t.uid)})),n=[];X.forEach((function(e){var s;if(!t.some((function(t){return t.uid===e}))){var r=re.get(e);r&&n.push({uid:r.uid,name:null!==(s=r.name)&&void 0!==s?s:r.uid,description:"",enabled:!0,defaultCategory:!1,orderIndex:t.length+n.length})}}));var s=[].concat(ue()(t),n);ie(s),A(!1),q.yw.success(i.formatMessage({id:"ticket.settings.category.select.success",defaultMessage:"分类列表已更新"}))}else q.yw.warning(i.formatMessage({id:"ticket.settings.category.select.empty",defaultMessage:"请选择至少一个分类"}))},onCancel:function(){A(!1),K(!1)},confirmLoading:R,destroyOnHidden:!0,width:480,okText:i.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ne.jsxs)(h.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,ne.jsx)(ke,{type:"secondary",children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.tip",defaultMessage:"勾选需要在工单配置中启用的分类。"})}),R?(0,ne.jsx)("div",{style:{textAlign:"center",padding:"32px 0"},children:(0,ne.jsx)(ce.Z,{})}):te.length>0?(0,ne.jsx)(fe.Z,{checkable:!0,selectable:!1,checkedKeys:X,onCheck:function(e){var t;Array.isArray(e)?W(e):W(null!==(t=e.checked)&&void 0!==t?t:[])},treeData:te,height:360,titleRender:function(e){var t="string"==typeof e.title?e.title:"",n=o(t)||t||"--";return(0,ne.jsx)(H.Z,{title:n,children:n})}}):(0,ne.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.emptyTree",defaultMessage:"暂无可用分类，请先在分类管理中创建。"})})]})}),(0,ne.jsx)(de.Z,{open:j,title:S?i.formatMessage({id:"ticket.settings.category.modal.edit",defaultMessage:"编辑分类"}):i.formatMessage({id:"ticket.settings.category.modal.create",defaultMessage:"新增分类"}),onOk:je,onCancel:function(){w(!1),T(null),g.resetFields()},destroyOnHidden:!0,width:520,children:(0,ne.jsxs)(Q.Z,{form:g,layout:"vertical",children:[(0,ne.jsx)(Q.Z.Item,{name:"name",label:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.name",defaultMessage:"分类名称"}),rules:[{required:!0,message:i.formatMessage({id:"ticket.settings.category.form.name.required",defaultMessage:"请输入分类名称"})},{max:32,message:i.formatMessage({id:"ticket.settings.category.form.name.length",defaultMessage:"名称长度不超过32个字符"})}],children:(0,ne.jsx)(v.Z,{placeholder:i.formatMessage({id:"ticket.settings.category.form.name.placeholder",defaultMessage:"例如：售后支持"}),allowClear:!0})}),(0,ne.jsx)(Q.Z.Item,{name:"description",label:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.description",defaultMessage:"描述"}),rules:[{max:120,message:i.formatMessage({id:"ticket.settings.category.form.description.length",defaultMessage:"描述长度不超过120个字符"})}],children:(0,ne.jsx)(v.Z.TextArea,{rows:3,placeholder:i.formatMessage({id:"ticket.settings.category.form.description.placeholder",defaultMessage:"用于帮助访客理解分类用途，可选填"}),allowClear:!0})}),(0,ne.jsx)(Q.Z.Item,{name:"enabled",label:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,ne.jsx)(k.Z,{})}),(0,ne.jsx)(Q.Z.Item,{name:"defaultCategory",label:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.default",defaultMessage:"设为默认分类"}),valuePropName:"checked",children:(0,ne.jsx)(k.Z,{disabled:0===Y.length&&!S})})]})})]})},Ce=function(e){var t=e.open,n=e.record,s=e.ticketType,r=e.onClose,i=e.onSuccess,o=(0,f.useIntl)(),l=(0,O.u)((function(e){return e.currentOrg})),g=Q.Z.useForm(),m=d()(g,1)[0],p=(0,c.useState)(!1),h=d()(p,2),x=h[0],M=h[1],y=!(null==n||!n.uid);(0,c.useEffect)((function(){t&&(m.resetFields(),n&&m.setFieldsValue({name:n.name,description:n.description}))}),[t,null==n?void 0:n.uid]);var k=function(){var e=u()(a()().mark((function e(){var t,u,d,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.validateFields();case 3:if(t=e.sent,null!=l&&l.uid){e.next=6;break}return e.abrupt("return");case 6:if(M(!0),u=n?n.type===B.IpQ?B.IpQ:B.dCh:s,!y){e.next=15;break}return e.next=11,(0,L.mE)({uid:n.uid,orgUid:l.uid,name:t.name,description:t.description,type:u});case 11:200===(null==(d=e.sent)?void 0:d.code)?(q.yw.success(o.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),i(d.data),r()):q.yw.error((null==d?void 0:d.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:return e.next=17,(0,L.Gv)({orgUid:l.uid,name:t.name,description:t.description,type:u});case 17:200===(null==(c=e.sent)?void 0:c.code)?(q.yw.success(o.formatMessage({id:"common.created",defaultMessage:"创建成功"})),i(c.data),r()):q.yw.error((null==c?void 0:c.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"}));case 19:return e.prev=19,M(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,,19,22]])})));return function(){return e.apply(this,arguments)}}();return(0,ne.jsx)(de.Z,{title:y?o.formatMessage({id:"ticket.settings.edit.title",defaultMessage:"编辑工单配置"}):o.formatMessage({id:"ticket.settings.create.title",defaultMessage:"新建工单配置"}),width:520,open:t,onCancel:r,onOk:k,okText:y?o.formatMessage({id:"common.save",defaultMessage:"保存"}):o.formatMessage({id:"common.create",defaultMessage:"创建"}),cancelText:o.formatMessage({id:"common.cancel",defaultMessage:"取消"}),confirmLoading:x,destroyOnHidden:!0,children:(0,ne.jsxs)(Q.Z,{form:m,layout:"vertical",children:[(0,ne.jsx)(Q.Z.Item,{label:o.formatMessage({id:"common.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0,message:o.formatMessage({id:"common.name.required",defaultMessage:"请输入名称"})}],children:(0,ne.jsx)(v.Z,{maxLength:64,showCount:!0,placeholder:o.formatMessage({id:"common.name.placeholder",defaultMessage:"请输入名称"})})}),(0,ne.jsx)(Q.Z.Item,{label:o.formatMessage({id:"common.description",defaultMessage:"描述"}),name:"description",children:(0,ne.jsx)(v.Z.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:o.formatMessage({id:"common.description.placeholder",defaultMessage:"请输入描述"})})})]})})},Se=n(84416),Fe=n(2685),Pe=n(15338),Te=n(6317),Ee=n(87523),Ie=n(42539),qe=function(e){var t=e.orgUid,n=e.process,s=e.draftProcess,r=e.form,i=e.draftForm,o=e.ticketScope,l=void 0===o?B.dCh:o,g=e.customFormEnabled,m=void 0!==g&&g,v=e.onProcessChange,x=e.onFormChange,y=e.onCustomFormEnabledChange,b=(0,f.useIntl)(),j=(0,ye.Z)().translateString,w=te.A.useForm(),Z=d()(w,1)[0],C=(0,c.useState)(!1),S=d()(C,2),F=S[0],P=S[1],T=(0,c.useState)(!1),I=d()(T,2),O=I[0],U=I[1],N=(0,c.useState)([]),L=d()(N,2),z=L[0],A=L[1],J=(0,c.useState)([]),D=d()(J,2),W=D[0],Q=D[1],_=l===B.IpQ?B.T2C:B.w_8,G=l===B.IpQ?B.O4J:B.Qou,R=!t,H=Boolean(m),K=R||!H,V=(0,c.useCallback)(u()(a()().mark((function e(){var n,s,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return A([]),e.abrupt("return");case 3:return P(!0),e.prev=4,n={orgUid:t,pageNumber:0,pageSize:100,status:B.bSv,type:G,sortBy:"updatedAt",sortDirection:"DESC"},e.next=8,(0,Pe.Gx)(n);case 8:s=e.sent,Ie.Z.debug("queryProcessesByOrg response:",null==s?void 0:s.data,n),200===(null==s?void 0:s.code)?A(null!==(r=null==s||null===(i=s.data)||void 0===i?void 0:i.content)&&void 0!==r?r:[]):q.yw.error((null==s?void 0:s.message)||b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load processes",e.t0),q.yw.error(b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"}));case 17:return e.prev=17,P(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,G]),$=(0,c.useCallback)(u()(a()().mark((function e(){var n,s,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return Q([]),e.abrupt("return");case 3:return U(!0),e.prev=4,n={orgUid:t,type:_,status:B.eiy,pageNumber:0,pageSize:100},e.next=8,(0,Te.xg)(n);case 8:s=e.sent,Ie.Z.debug("queryFormsByOrg response:",null==s?void 0:s.data,n),200===(null==s?void 0:s.code)?(o=null!==(r=null==s||null===(i=s.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.filter((function(e){return e.status===B.eiy})))&&void 0!==r?r:[],Q(o)):q.yw.error((null==s?void 0:s.message)||b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load ticket forms",e.t0),q.yw.error(b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"}));case 17:return e.prev=17,U(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,_]);(0,c.useEffect)((function(){if(!t)return A([]),void Q([]);V(),$()}),[t,V,$]);var Y=(0,c.useMemo)((function(){var e=new Map;return z.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[n,s].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[z,n,s]),ee=(0,c.useMemo)((function(){var e=new Map;return W.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[r,i].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[W,r,i]),se=(0,c.useMemo)((function(){return Y.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[Y]),re=(0,c.useMemo)((function(){return ee.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[ee]),ie=(0,c.useMemo)((function(){var e=new Map;return Y.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[Y]),ae=(0,c.useMemo)((function(){var e=new Map;return ee.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[ee]),oe=(0,c.useMemo)((function(){return void 0!==s?s?s.uid:void 0:null==n?void 0:n.uid}),[s,n]),ue=(0,c.useMemo)((function(){return void 0!==i?i?i.uid:void 0:null==r?void 0:r.uid}),[i,r]);(0,c.useEffect)((function(){Z.setFieldsValue({processUid:oe,formUid:ue,customFormEnabled:H})}),[Z,oe,ue,H]);var de=(0,c.useCallback)((function(e){R||y(e)}),[R,y]);return(0,ne.jsx)(te.A,{form:Z,layout:"vertical",submitter:!1,style:{width:"100%"},children:(0,ne.jsxs)(h.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,ne.jsxs)(le.Z,{title:b.formatMessage({id:"ticket.settings.workflow.process.title",defaultMessage:"工单流程绑定"}),extra:(0,ne.jsxs)(h.Z,{size:8,children:[(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(Se.Z,{}),onClick:function(){var e=(0,Ee.LE)();window.open(e,"_blank","noopener,noreferrer")},disabled:R,children:b.formatMessage({id:"ticket.settings.workflow.process.openBuilder",defaultMessage:"打开流程设计器"})}),(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(E.Z,{}),onClick:V,loading:F,disabled:R})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,ne.jsx)(Fe.Z,{name:"processUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.process.placeholder",defaultMessage:"选择一个已部署的流程"}),options:se,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:R,loading:F,onChange:function(e){return function(e){if(e){var t=ie.get(e);t&&v(t)}else v(null)}(e)}}}),se.length||F?null:(0,ne.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.process.emptyOptions",defaultMessage:"暂无已部署流程，请先在流程中心创建并部署"})})]}),(0,ne.jsxs)(le.Z,{title:b.formatMessage({id:"ticket.settings.workflow.form.title",defaultMessage:"工单表单绑定"}),extra:(0,ne.jsxs)(h.Z,{size:8,children:[(0,ne.jsx)(k.Z,{size:"small",checked:H,onChange:de,disabled:R,checkedChildren:b.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:b.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(Se.Z,{}),onClick:function(){var e=(0,Ee.P1)();window.open(e,"_blank","noopener,noreferrer")},disabled:K,children:b.formatMessage({id:"ticket.settings.workflow.form.openBuilder",defaultMessage:"打开表单设计器"})}),(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(E.Z,{}),onClick:$,loading:O,disabled:K})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,ne.jsx)(X.Z.Text,{type:"secondary",children:b.formatMessage({id:"ticket.settings.workflow.form.custom.desc",defaultMessage:"启用后，桌面端工单抽屉会根据所选流程关联的表单渲染自定义字段。"})}),(0,ne.jsx)(Fe.Z,{name:"formUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.form.placeholder",defaultMessage:"选择一个已发布的工单表单"}),options:re,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:K,loading:O,onChange:function(e){return function(e){if(e){var t=ae.get(e);t&&x(t)}else x(null)}(e)}}}),!H||re.length||O?null:(0,ne.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.form.emptyOptions",defaultMessage:"暂无已发布表单，请先在表单中心创建并发布"})})]})]})})},Oe=function(e){return e?JSON.parse(JSON.stringify(e)):null},Ue=function(e){return e===B.IpQ?B.IpQ:B.dCh},Ne=function(){var e=(0,f.useIntl)(),t=(0,O.u)((function(e){return e.currentOrg})),n=(0,U.Z)().isDarkMode,s=(0,N.Z)().leftSiderStyle,i=(0,c.useState)([]),o=d()(i,2),l=o[0],z=o[1],A=(0,c.useState)(""),J=d()(A,2),X=J[0],W=J[1],Q=(0,c.useState)(),_=d()(Q,2),G=_[0],R=_[1],H=(0,c.useState)("basic"),K=d()(H,2),V=K[0],$=K[1],Y=(0,c.useState)(!1),ee=d()(Y,2),te=ee[0],se=ee[1],re=(0,c.useState)(!1),ie=d()(re,2),oe=ie[0],ue=ie[1],le=(0,c.useState)(!1),de=d()(le,2),ce=de[0],fe=de[1],ge=(0,c.useState)(!1),me=d()(ge,2),pe=me[0],he=me[1],ve=(0,c.useState)(null),xe=d()(ve,2),Me=xe[0],ye=xe[1],ke=(0,c.useState)(!1),be=d()(ke,2),je=be[0],Se=be[1],Fe=(0,c.useRef)(""),Pe=(0,c.useState)(B.IpQ),Te=d()(Pe,2),Ee=Te[0],Ne=Te[1],Le=D((function(e){return{setCurrentTicketSettings:e.setCurrentTicketSettings,currentTicketSettings:e.currentTicketSettings,updateCurrentTicketSettings:e.updateCurrentTicketSettings}})),ze=Le.setCurrentTicketSettings,Ae=Le.currentTicketSettings,Je=Le.updateCurrentTicketSettings,Be=null==t?void 0:t.uid,De=(0,c.useMemo)((function(){return(G?l.find((function(e){return e.uid===G})):null)||null}),[l,G]),Xe=(0,c.useMemo)((function(){if(!X)return l;var e=X.toLowerCase();return l.filter((function(t){return((t.name||t.uid||"")+(t.description||"")).toLowerCase().includes(e)}))}),[l,X]),We=(0,c.useCallback)(function(){var e=u()(a()().mark((function e(n){var s,r,i,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return se(!0),e.prev=3,r=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:200,searchText:r,type:Ee},e.next=8,(0,L.Bg)(i);case 8:o=e.sent,Ie.Z.debug("queryTicketSettingsByOrg response:",null==o?void 0:o.data,i),u=(null==o||null===(s=o.data)||void 0===s?void 0:s.content)||[],z(u),!(u.length>0)||G&&u.some((function(e){return e.uid===G}))||R(u[0].uid);case 13:return e.prev=13,se(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,G,Ee]);(0,c.useEffect)((function(){We(X)}),[null==t?void 0:t.uid,Ee]),(0,c.useEffect)((function(){if(De){var e=Oe(De);ze(e),Fe.current=JSON.stringify(null!=De?De:{}),Se(!1)}else ze(null),Fe.current=JSON.stringify({}),Se(!1)}),[De,ze]),(0,c.useEffect)((function(){if(Ae)try{var e=JSON.stringify(Ae);Se(e!==Fe.current)}catch(e){Se(!0)}else Se(!1)}),[Ae]);var Qe=function(){var n=u()(a()().mark((function n(s){var i,o,u,l,d;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(i=null!=s?s:De)&&i.uid){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,L.oX)({uid:i.uid,type:Ue(i.type)});case 6:if(o=n.sent,!((Array.isArray(null==o?void 0:o.data)?o.data:[]).length>0)){n.next=11;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.delete.hasBinding",defaultMessage:"当前工单设置已绑定工作组，请先解绑后再删除"})),n.abrupt("return");case 11:return u={uid:i.uid,orgUid:null==t?void 0:t.uid},l=r()(r()({},u),{},{type:Ue(i.type)}),n.next=15,(0,L.nU)(l);case 15:d=n.sent,console.log("deleteTicketSettings response:",d,l),200===(null==d?void 0:d.code)?(q.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),z((function(e){return e.filter((function(e){return e.uid!==i.uid}))})),G===i.uid&&R(void 0)):q.yw.error((null==d?void 0:d.message)||"删除失败"),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(3),console.error(n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.delete.failed",defaultMessage:"删除失败"}));case 24:case"end":return n.stop()}}),n,null,[[3,20]])})));return function(e){return n.apply(this,arguments)}}(),_e=function(){var n=u()(a()().mark((function n(s,r){var i;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,L.mE)({uid:s,orgUid:null==t?void 0:t.uid,enabled:r,type:Ue(null==Ye?void 0:Ye.type)});case 3:(i=n.sent)&&200===i.code?(q.yw.success(e.formatMessage({id:r?"common.enabled":"common.disabled",defaultMessage:r?"已启用":"已停用"})),We(X)):q.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),q.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ge=function(e,t){return void 0!==e?null===e?"":null==e?void 0:e.uid:null==t?void 0:t.uid},Re=function(e){var t,n,s,i;if(!e)return null;var a,o=null!==(t=e.draftBasicSettings)&&void 0!==t?t:e.basicSettings,u=o?r()({},o):void 0,l=null!==(n=e.draftNotificationSettings)&&void 0!==n?n:e.notificationSettings,d=null!==(s=e.draftCategorySettings)&&void 0!==s?s:e.categorySettings,c=d?we(null!==(i=d.items)&&void 0!==i?i:[]):void 0,f=Ge(e.draftProcess,e.process),g=Ge(e.draftForm,e.form);return{uid:e.uid,orgUid:e.orgUid,type:Ue(e.type),name:e.name,description:e.description,isDefault:null==e?void 0:e.isDefault,enabled:null==e?void 0:e.enabled,customFormEnabled:null==e?void 0:e.customFormEnabled,basicSettings:u,notificationSettings:l,categorySettings:c?{items:(a=c,null==a?void 0:a.map((function(e,t){var n;return{uid:e.uid,name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory,orderIndex:null!==(n=e.orderIndex)&&void 0!==n?n:t}})))}:void 0,processUid:f,formUid:g}},He=function(){var n=u()(a()().mark((function n(){var s,i,o,u,l,d;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=Ae)&&s.uid){n.next=4;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return",!1);case 4:if(ue(!0),n.prev=5,o=Re(s)){n.next=10;break}return q.yw.error(e.formatMessage({id:"ticket.settings.save.payload.empty",defaultMessage:"保存数据为空，无法提交"})),n.abrupt("return",!1);case 10:return u=r()(r()({},o),{},{orgUid:null==t?void 0:t.uid,type:null!==(i=null==o?void 0:o.type)&&void 0!==i?i:Ee}),n.next=13,(0,L.mE)(u);case 13:if(l=n.sent,console.log("updateTicketSettings response:",l,u),200!==(null==l?void 0:l.code)){n.next=25;break}return q.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),a=null==l?void 0:l.data,c=s,f=void 0,g=void 0,m=void 0,p=void 0,h=void 0,v=void 0,d=a?r()(r()(r()({},c),a),{},{basicSettings:null!==(f=a.basicSettings)&&void 0!==f?f:c.basicSettings,draftBasicSettings:null!==(g=null!==(m=null!==(p=a.draftBasicSettings)&&void 0!==p?p:a.basicSettings)&&void 0!==m?m:c.draftBasicSettings)&&void 0!==g?g:c.basicSettings,draftCategorySettings:null!==(h=a.draftCategorySettings)&&void 0!==h?h:c.draftCategorySettings,categorySettings:null!==(v=a.categorySettings)&&void 0!==v?v:c.categorySettings}):c,Fe.current=JSON.stringify(null!=d?d:{}),Se(!1),z((function(e){return e.map((function(e){return e.uid===s.uid?d:e}))})),ze(Oe(d)),n.abrupt("return",!0);case 25:return q.yw.error((null==l?void 0:l.message)||e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 27:n.next=34;break;case 29:return n.prev=29,n.t0=n.catch(5),console.error("保存失败:",n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 34:return n.prev=34,ue(!1),n.finish(34);case 37:return n.abrupt("return",!1);case 38:case"end":return n.stop()}var a,c,f,g,m,p,h,v}),n,null,[[5,29,34,37]])})));return function(){return n.apply(this,arguments)}}(),Ke=function(){var n=u()(a()().mark((function n(){var s,r,i,o;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=Ae)&&s.uid){n.next=4;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return");case 4:if(fe(!0),n.prev=5,!je){n.next=12;break}return n.next=9,He();case 9:if(n.sent){n.next=12;break}return n.abrupt("return");case 12:return r={uid:s.uid,orgUid:null==t?void 0:t.uid,type:Ue(s.type)},n.next=15,(0,L.Ch)(r);case 15:i=n.sent,console.log("publishTicketSettings response:",i,r),200===(null==i?void 0:i.code)?(q.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Fe.current=JSON.stringify(null!==(o=null==i?void 0:i.data)&&void 0!==o?o:{}),Se(!1),z((function(e){return e.map((function(e){return e.uid===s.uid?null==i?void 0:i.data:e}))})),ze(Oe(null==i?void 0:i.data))):q.yw.error((null==i?void 0:i.message)||e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"})),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(5),console.error("发布失败:",n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"}));case 24:return n.prev=24,fe(!1),n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[5,20,24,27]])})));return function(){return n.apply(this,arguments)}}(),Ve=function(e){var t,n,s,r,i,a,o,u,l,d,c,f,g,m,p,h;return{numberPrefix:null!==(t=null==e?void 0:e.numberPrefix)&&void 0!==t?t:"TK",numberLength:null!==(n=null==e?void 0:e.numberLength)&&void 0!==n?n:8,defaultPriority:null!==(s=null==e?void 0:e.defaultPriority)&&void 0!==s?s:"medium",validityDays:null!==(r=null==e?void 0:e.validityDays)&&void 0!==r?r:30,autoCloseHours:null!==(i=null==e?void 0:e.autoCloseHours)&&void 0!==i?i:72,enableAutoClose:null!==(a=null==e?void 0:e.enableAutoClose)&&void 0!==a&&a,requireLogin:null!==(o=null==e?void 0:e.requireLogin)&&void 0!==o&&o,assignmentMode:null!==(u=null==e?void 0:e.assignmentMode)&&void 0!==u?u:B.vXk,showContactName:null===(l=null==e?void 0:e.showContactName)||void 0===l||l,requireContactName:null===(d=null==e?void 0:e.requireContactName)||void 0===d||d,showEmail:null===(c=null==e?void 0:e.showEmail)||void 0===c||c,requireEmail:null!==(f=null==e?void 0:e.requireEmail)&&void 0!==f&&f,showPhone:null===(g=null==e?void 0:e.showPhone)||void 0===g||g,requirePhone:null!==(m=null==e?void 0:e.requirePhone)&&void 0!==m&&m,showWechat:null!==(p=null==e?void 0:e.showWechat)&&void 0!==p&&p,requireWechat:null!==(h=null==e?void 0:e.requireWechat)&&void 0!==h&&h}},$e=function(e){var t=Array.isArray(null==e?void 0:e.items)?e.items:[];return we(t)},Ye=null!=Ae?Ae:De,et=Ee===B.IpQ?B.p$M:B.hXJ,tt=Ee===B.IpQ,nt=(0,c.useMemo)((function(){var e,t,n,s;if(null==Ye||!Ye.uid)return[];var i=[{key:"basic",label:(0,ne.jsxs)("span",{children:[(0,ne.jsx)(w.Z,{})," ",(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.basic",defaultMessage:"基础设置"})]}),children:(0,ne.jsx)("div",{style:{padding:8},children:(0,ne.jsx)(ae,{settings:Ve(null!==(e=null==Ye?void 0:Ye.draftBasicSettings)&&void 0!==e?e:null==Ye?void 0:Ye.basicSettings),hideRequireLogin:tt,hideContactFields:tt,onChange:function(e){Je((function(t){var n,s,i=Ve(null!==(n=null!==(s=t.draftBasicSettings)&&void 0!==s?s:t.basicSettings)&&void 0!==n?n:{});t.draftBasicSettings=r()(r()({},i),e),t.hasUnpublishedChanges=!0}))}})})},{key:"categories",label:(0,ne.jsxs)("span",{children:[(0,ne.jsx)(Z.Z,{})," ",(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.categories",defaultMessage:"分类设置"})]}),children:(0,ne.jsx)("div",{style:{padding:8},children:(0,ne.jsx)(Ze,{items:$e(null!==(t=null==Ye?void 0:Ye.draftCategorySettings)&&void 0!==t?t:null==Ye?void 0:Ye.categorySettings),categoryType:et,onChange:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=we(e),n=t.filter((function(e){return e.enabled})).length,s=t.length-n,r=t.find((function(e){return e.defaultCategory&&e.enabled}));return{items:t,defaultCategoryUid:null==r?void 0:r.uid,enabledCount:n,disabledCount:s}}(e);Je((function(e){e.draftCategorySettings=t,e.hasUnpublishedChanges=!0}))}})})},{key:"workflow",label:(0,ne.jsxs)("span",{children:[(0,ne.jsx)(C.Z,{})," ",(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.workflow",defaultMessage:"流程与表单"})]}),children:(0,ne.jsx)("div",{style:{padding:8},children:(0,ne.jsx)(qe,{orgUid:Be,process:null!==(n=null==Ye?void 0:Ye.process)&&void 0!==n?n:null,draftProcess:null==Ye?void 0:Ye.draftProcess,form:null!==(s=null==Ye?void 0:Ye.form)&&void 0!==s?s:null,draftForm:null==Ye?void 0:Ye.draftForm,ticketScope:Ee,customFormEnabled:null==Ye?void 0:Ye.customFormEnabled,onProcessChange:function(e){Je((function(t){t.draftProcess=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onFormChange:function(e){Je((function(t){t.draftForm=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onCustomFormEnabledChange:function(e){Je((function(t){t.customFormEnabled=e,t.hasUnpublishedChanges=!0}))}})})}];return i}),[Ye,e,Je,et,tt,Be]),st=(0,c.useCallback)((function(e){var t=e.trim();W(t),We(t)}),[We,W]),rt=[{key:B.dCh,label:e.formatMessage({id:"ticket.settings.scope.external",defaultMessage:"外部工单"})},{key:B.IpQ,label:e.formatMessage({id:"ticket.settings.scope.internal",defaultMessage:"内部工单"})}];return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(g.Z,{activeKey:Ee,onChange:function(e){var t=Ue(e);Ne(t),R(void 0),z([]),ze(null),Fe.current=JSON.stringify({}),Se(!1)},items:rt}),(0,ne.jsxs)(m.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ne.jsx)(m.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:s,children:(0,ne.jsxs)(j.Z,{title:e.formatMessage({id:"ticket.settings.list",defaultMessage:"工单配置列表"}),extra:(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(S.Z,{}),type:"primary",onClick:function(){ye(null),he(!0)},children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:te,children:[(0,ne.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ne.jsxs)(h.Z.Compact,{style:{width:"100%"},children:[(0,ne.jsx)(v.Z,{placeholder:e.formatMessage({id:"ticket.settings.search.placeholder",defaultMessage:"搜索工单配置"}),value:X,onChange:function(e){return W(e.target.value)},onPressEnter:function(){return st(X)},allowClear:!0,size:"middle"}),(0,ne.jsx)(p.ZP,{type:"primary",size:"middle",onClick:function(){return st(X)},children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.search",defaultMessage:"搜索"})})]})}),(0,ne.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ne.jsx)(x.Z,{dataSource:Xe,locale:{emptyText:(0,ne.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ne.jsx)(x.Z.Item,{style:G===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return R(e.uid)},children:(0,ne.jsx)(x.Z.Item.Meta,{title:(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ne.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ne.jsx)(h.Z,{size:4,children:e.isDefault?(0,ne.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ne.jsx)("div",{style:{color:n?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ne.jsx)(m.Z.Panel,{children:Ye?(0,ne.jsx)(j.Z,{title:(0,ne.jsxs)(h.Z,{children:[(0,ne.jsxs)("span",{children:[e.formatMessage({id:"ticket.settings.editing",defaultMessage:"编辑工单设置"}),": ",Ye.name||Ye.uid]}),(0,ne.jsx)(k.Z,{checked:!!Ye.enabled,onChange:function(e){return _e(Ye.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ne.jsx)(p.ZP,{size:"small",icon:(0,ne.jsx)(F.Z,{}),onClick:function(e){e.stopPropagation(),De&&(ye(De),he(!0))},children:(0,ne.jsx)(f.FormattedMessage,{id:"ticket.settings.edit",defaultMessage:"编辑"})}),(0,ne.jsx)(b.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Qe(De)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ne.jsx)(p.ZP,{size:"small",danger:!0,icon:(0,ne.jsx)(P.Z,{}),onClick:function(e){return e.stopPropagation()},children:(0,ne.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})}),Ye.isDefault?(0,ne.jsx)(y.Z,{color:"blue",children:"默认"}):null,je&&(0,ne.jsx)(y.Z,{color:"red",children:(0,ne.jsx)(f.FormattedMessage,{id:"common.unsaved",defaultMessage:"未保存修改"})})]}),extra:(0,ne.jsxs)(h.Z,{children:[(0,ne.jsx)(b.Z,{title:e.formatMessage({id:"ticket.settings.publish.confirm.title",defaultMessage:"发布到线上环境"}),description:e.formatMessage({id:"ticket.settings.publish.confirm.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:e.formatMessage({id:"ticket.settings.publish.confirm.ok",defaultMessage:"继续发布"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ke()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ne.jsx)(p.ZP,{onClick:function(e){return e.stopPropagation()},loading:ce,type:"default",icon:(0,ne.jsx)(T.Z,{}),children:(0,ne.jsx)(f.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ne.jsx)(p.ZP,{onClick:function(){if(De){var t=Fe.current?JSON.parse(Fe.current):null;ze(Oe(t)),Se(!1),q.yw.info(e.formatMessage({id:"ticket.settings.reset.info",defaultMessage:"已重置为当前发布版本"}))}},disabled:!je,icon:(0,ne.jsx)(E.Z,{}),children:(0,ne.jsx)(f.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ne.jsx)(p.ZP,{type:"primary",loading:oe,onClick:He,disabled:!je,icon:(0,ne.jsx)(I.Z,{}),children:(0,ne.jsx)(f.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ne.jsx)(g.Z,{activeKey:V,onChange:$,items:nt})}):(0,ne.jsx)(j.Z,{children:(0,ne.jsx)(M.Z,{description:e.formatMessage({id:"ticket.settings.select.settings",defaultMessage:"请从左侧选择工单配置"})})})})]}),(0,ne.jsx)(Ce,{open:pe,record:Me||void 0,ticketType:Me?Ue(Me.type):Ee,onClose:function(){return he(!1)},onSuccess:function(){var e=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(X);case 2:null!=t&&t.uid&&R(t.uid);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})}}}]);