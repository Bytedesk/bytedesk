"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{74840:function(e,t,n){n.d(t,{Z:function(){return s}});var l=n(83910),a=n(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,l.Z)({},e,{ref:t,icon:r}))};var s=a.forwardRef(o)},59908:function(e,t,n){n.d(t,{Z:function(){return s}});var l=n(83910),a=n(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,l.Z)({},e,{ref:t,icon:r}))};var s=a.forwardRef(o)},56663:function(e,t,n){var l=n(90819),a=n.n(l),r=n(89933),i=n.n(r),o=n(45332),s=n.n(o),d=n(73614),u=n(19433),c=n(12864),f=n(7704),p=n(91361),v=n(98830),m=n(39497),g=n(71256),h=n(25784),b=n(2250),x=n(14906),M=n(44194),y=n(11329),k=n(23753),w=n(31549);t.Z=function(e){var t,n,l,r,o=h.A.useForm(),S=s()(o,1)[0],j=(0,x.useIntl)(),C=(0,p.Z)().translateString,T=(0,v.u)((function(e){return e.currentOrg})),Z=(0,M.useState)(),P=s()(Z,2),U=P[0],E=P[1],F=(0,M.useState)(),I=s()(F,2),K=I[0],q=I[1],R=(0,M.useState)(),L=s()(R,2),A=L[0],z=L[1],D=(0,M.useState)(""),W=s()(D,2),N=W[0],O=W[1],B=(0,M.useRef)(!1),V=(0,M.useRef)(),Q=(0,M.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),H=(0,M.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==Q?void 0:Q.draft)&&void 0!==t?t:null==Q?void 0:Q.live)&&void 0!==e?e:void 0}),[Q]),G=(0,M.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),J=(0,M.useCallback)((function(e){S.setFieldValue("welcomeTip",e),G({welcomeTip:e})}),[S,G]);(0,M.useEffect)((function(){if(null!=T&&T.uid&&(V.current!==T.uid&&(V.current=T.uid,B.current=!1),!B.current)){B.current=!0;var e=function(){var e=i()(a()().mark((function e(){var t,n,l,r,i,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:T.uid},e.next=4,(0,f.AP)(t);case 4:n=e.sent,k.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),u.yw.destroy(),200===n.code?(q(n),i=(null===(l=n.data)||void 0===l?void 0:l.content)||[],o=null==H?void 0:H.welcomeKbUid,(s=o||A||(null===(r=i[0])||void 0===r?void 0:r.uid))&&(z(s),S.setFieldValue("welcomeKbUid",s),o!==s&&G({welcomeKbUid:s}))):u.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,j,null==H?void 0:H.welcomeKbUid,A,S,G]),(0,M.useEffect)((function(){if(null!=T&&T.uid&&A){var e=function(){var e=i()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:T.uid,kbUid:A},e.next=4,(0,c.pf)(t);case 4:n=e.sent,k.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),u.yw.destroy(),200===n.code?E(n):u.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,A,j]),(0,M.useEffect)((function(){if(H){var e=null==H?void 0:H.welcomeFaqs,t=Array.isArray(H.welcomeFaqUids)?H.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];S.setFieldValue("welcomeFaqUids",t)}}),[S,null==U||null===(t=U.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==H?void 0:H.welcomeFaqUids,H]);var _=(0,M.useCallback)((function(e){z(e),S.setFieldValue("welcomeFaqUids",[]),G({welcomeKbUid:e,welcomeFaqUids:[]})}),[G,S]);return(0,M.useEffect)((function(){var e=C(null==H?void 0:H.welcomeTip);void 0!==e&&N!==e&&O(e),null!=H&&H.welcomeKbUid&&(S.setFieldValue("welcomeKbUid",H.welcomeKbUid),A!==H.welcomeKbUid&&z(H.welcomeKbUid))}),[C,null==H?void 0:H.welcomeTip,null==H?void 0:H.welcomeKbUid,N,S,A,null==K||null===(n=K.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,w.jsxs)(h.A,{form:S,submitter:!1,style:{marginLeft:"20px"},children:[(0,w.jsx)(h.A.Item,{name:"welcomeTip",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"agent.settings.welcome.tip"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeTip"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),tooltip:j.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:j.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,w.jsx)(y.Z,{placeholder:j.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:N,toolbarKeys:(0,g.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:J})}),(0,w.jsx)(b.Z,{name:"welcomeKbUid",width:"md",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.select",defaultMessage:"é€‰æ‹©æ¬¢è¿è¯­å¸¸è§é—®é¢˜çŸ¥è¯†åº“"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeKbUid"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),options:null==K||null===(l=K.data)||void 0===l||null===(l=l.content)||void 0===l?void 0:l.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return _(e)},allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,w.jsx)(b.Z,{name:"welcomeFaqUids",width:"md",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.faq.welcome"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeFaqUids"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),options:null==U||null===(r=U.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return G({welcomeFaqUids:e})}}})]})}},56278:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ke}});var l=n(44194),a=n(67738),r=n(14906),i=n(76711),o=n.n(i),s=n(90819),d=n.n(s),u=n(89933),c=n.n(u),f=n(73193),p=n.n(f),v=n(45332),m=n.n(v),g=n(77033),h=n(82770),b=n(39487),x=n(32525),M=n(50716),y=n(92354),k=n(81739),w=n(66431),S=n(63649),j=n(74840),C=n(29337),T=n(68779),Z=n(12322),P=n(56482),U=n(10162),E=n(90727),F=n(59304),I=n(54881),K=n(47944),q=n(80556),R=n(55785),L=n(49764),A=n(19433),z=n(88894),D=n(98830),W=n(75112),N=n(14597),O=n(99665),B=n(66547),V=(n(84262),n(94212),n(24479),n(90631)),Q=n(1460),H=n(56663),G=n(25197),J=n(27153),_=n(31549),Y="welcome",$=function(){var e=(0,r.useIntl)(),t=(0,D.u)((function(e){return e.currentOrg})),n=(0,W.Z)().leftSiderStyle,i=(0,N.Z)().isDarkMode,s=(0,l.useState)(!1),u=m()(s,2),f=u[0],v=u[1],$=(0,l.useState)([]),X=m()($,2),ee=X[0],te=X[1],ne=(0,l.useState)(),le=m()(ne,2),ae=le[0],re=le[1],ie=(0,l.useState)(""),oe=m()(ie,2),se=oe[0],de=oe[1],ue=(0,l.useState)(Y),ce=m()(ue,2),fe=ce[0],pe=ce[1],ve=(0,l.useState)(!1),me=m()(ve,2),ge=me[0],he=me[1],be=(0,l.useState)(null),xe=m()(be,2),Me=xe[0],ye=xe[1],ke=(0,l.useMemo)((function(){return ee.find((function(e){return e.uid===ae}))||null}),[ee,ae]),we=(0,l.useState)(!1),Se=m()(we,2),je=Se[0],Ce=Se[1],Te=(0,l.useState)(!1),Ze=m()(Te,2),Pe=Ze[0],Ue=Ze[1],Ee=(0,l.useState)(!1),Fe=m()(Ee,2),Ie=Fe[0],Ke=Fe[1],qe=(0,l.useRef)(""),Re=(0,O.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),Le=Re.setCurrentRobotSettings,Ae=Re.currentRobotSettings,ze=(0,l.useMemo)((function(){var e;return null!==(e=null!=Ae?Ae:ke)&&void 0!==e?e:null}),[Ae,ke]),De=(0,l.useCallback)((function(e){if(Ae){var t=Ae.draftServiceSettings||Ae.serviceSettings||{};Le(p()(p()({},Ae),{},{draftServiceSettings:p()(p()({},t),e)}))}}),[Ae,Le]),We=(0,l.useCallback)((function(e){if(Ae){var t=Ae.draftInviteSettings||Ae.inviteSettings||{};Le(p()(p()({},Ae),{},{draftInviteSettings:p()(p()({},t),e)}))}}),[Ae,Le]),Ne=(0,l.useMemo)((function(){if(!se)return ee;var e=se.toLowerCase();return ee.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),l=(t.description||"").toLowerCase();return n.includes(e)||l.includes(e)}))}),[ee,se]),Oe=(0,l.useCallback)(function(){var e=c()(d()().mark((function e(n,l){var a,r,i,o,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,r=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=8,(0,z.VW)(i);case 8:o=e.sent,console.log("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",o,i),s=(null==o||null===(a=o.data)||void 0===a?void 0:a.content)||[],te(s),!(s.length>0)||ae&&s.some((function(e){return e.uid===ae}))||(re(s[0].uid),null!=l&&l.keepActive||pe(Y));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,ae]),Be=(0,l.useCallback)((function(e){Oe(null!=e?e:se)}),[Oe,se]);(0,l.useEffect)((function(){Oe(se)}),[null==t?void 0:t.uid]),(0,l.useEffect)((function(){ke?(Le(ke),qe.current=JSON.stringify(null!=ke?ke:{}),Ke(!1)):(Le(null),qe.current=JSON.stringify({}),Ke(!1))}),[null==ke?void 0:ke.uid]),(0,l.useEffect)((function(){if(ke)try{var e,t,n=JSON.stringify(null!=Ae?Ae:{}),l=n!==qe.current;console.log("ğŸ” [Dirty Check]",{isDirty:l,selectedUid:null==ke?void 0:ke.uid,currentWelcomeTip:(null==Ae||null===(e=Ae.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==Ae||null===(t=Ae.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:qe.current.length,nowLength:n.length}),Ke(l)}catch(e){Ke(!0)}}),[Ae,null==ke?void 0:ke.uid]);var Ve=function(){var n=c()(d()().mark((function n(l){var a,r,i;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=l?l:ke)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return r={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,z.r$)(r);case 6:(i=n.sent)&&200===i.code?(A.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),Oe(se)):A.yw.error((null==i?void 0:i.message)||"åˆ é™¤å¤±è´¥");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Qe=function(){var n=c()(d()().mark((function n(l,a){var r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,z.sK)({uid:l,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(r=n.sent)&&200===r.code?(A.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),Oe(se)):A.yw.error((null==r?void 0:r.message)||"æ“ä½œå¤±è´¥"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",n.t0),A.yw.error("æ“ä½œå¤±è´¥");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),He=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Ge=function(e){if(e){var t=He(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,l){if(void 0===t[n]){var a=null==e?void 0:e[l];if(Array.isArray(a)){var r=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);r.length>0&&(t[n]=r)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickFaqUids","quickFaqs"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var l=function(e){if(e)return He(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return p()(p()({},t),l?{toolbar:l}:{})}},Je=function(e){if(e)return He(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},_e=function(e){if(e)return He(e,["name","description","color","order"])},Ye=function(e){if(e)return He(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},$e=function(){var n=c()(d()().mark((function n(){var l,a,r,i,o,s;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ke&&ke.uid){n.next=3;break}return A.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:return Ce(!0),n.prev=4,l=Ae&&Ae.uid===ke.uid?Ae:ke,a=function(e,t){return p()(p()({},e||{}),t||{})},r={uid:ke.uid,orgUid:null==t?void 0:t.uid,name:null==l?void 0:l.name,description:null==l?void 0:l.description,isDefault:null==l?void 0:l.isDefault,enabled:null==l?void 0:l.enabled,serviceSettings:Ge(a(null==l?void 0:l.serviceSettings,null==l?void 0:l.draftServiceSettings)),inviteSettings:Je(a(null==l?void 0:l.inviteSettings,null==l?void 0:l.draftInviteSettings)),intentionSettings:_e(a(null==l?void 0:l.intentionSettings,null==l?void 0:l.draftIntentionSettings)),rateDownSettings:Ye(a(null==l?void 0:l.rateDownSettings,null==l?void 0:l.draftRateDownSettings))},n.next=10,(0,z.sK)(r);case 10:i=n.sent,console.log("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",i,r),i&&200===i.code?(A.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),qe.current=JSON.stringify(null!==(o=null!==(s=i.data)&&void 0!==s?s:l)&&void 0!==o?o:{}),Ke(!1),Oe(se)):A.yw.error((null==i?void 0:i.message)||"ä¿å­˜å¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("ä¿å­˜å¤±è´¥:",n.t0),A.yw.error("ä¿å­˜å¤±è´¥");case 19:return n.prev=19,Ce(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Xe=function(){var n=c()(d()().mark((function n(){var l,a,r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ke&&ke.uid){n.next=3;break}return A.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:if(Ue(!0),n.prev=4,!Ie){n.next=8;break}return n.next=8,$e();case 8:return l={uid:ke.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,z.KF)(l);case 11:(a=n.sent)&&200===a.code?(A.yw.success(e.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),qe.current=JSON.stringify(null!==(r=a.data)&&void 0!==r?r:{}),Ke(!1),Oe(se,{keepActive:!0})):A.yw.error((null==a?void 0:a.message)||"å‘å¸ƒå¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("å‘å¸ƒå¤±è´¥:",n.t0),A.yw.error("å‘å¸ƒå¤±è´¥");case 19:return n.prev=19,Ue(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),et=(0,l.useMemo)((function(){return null!=ke&&ke.uid?[{key:"welcome",label:(0,_.jsxs)("span",{children:[(0,_.jsx)(j.Z,{})," ",(0,_.jsx)(r.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"})]}),children:(0,_.jsx)(H.Z,{serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:De})},{key:"tips",label:(0,_.jsxs)("span",{children:[(0,_.jsx)(C.Z,{})," ",(0,_.jsx)(r.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"})]}),children:(0,_.jsx)(Q.Z,{variant:"robot",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:De})},{key:"service",label:(0,_.jsxs)("span",{children:[(0,_.jsx)(T.Z,{})," ",(0,_.jsx)(r.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"})]}),children:(0,_.jsx)(V.Z,{variant:"robot",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:De})},{key:"rate",label:(0,_.jsxs)("span",{children:[(0,_.jsx)(Z.Z,{})," ",(0,_.jsx)(r.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,_.jsx)(J.Z,{variant:"robot",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:De})}].concat(o()([]),[{key:"right",label:(0,_.jsxs)("span",{children:[(0,_.jsx)(P.Z,{})," ",(0,_.jsx)(r.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,_.jsx)(B.Z,{variant:"robot",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:De,settingsUid:ke.uid,isActive:"right"===fe})}],o()([]),o()([])):[]}),[null==ke?void 0:ke.uid,ze,De,We,e,fe]);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(g.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,_.jsx)(g.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,_.jsxs)(L.Z,{title:e.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:(0,_.jsx)(h.ZP,{size:"small",icon:(0,_.jsx)(U.Z,{}),type:"primary",onClick:function(){ye(null),he(!0)},children:(0,_.jsx)(r.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}),bodyStyle:{padding:8},loading:f,children:[(0,_.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,_.jsxs)(b.Z.Compact,{style:{width:"100%"},children:[(0,_.jsx)(x.Z,{placeholder:e.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:se,onChange:function(e){return de(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;de(t),Be(t)},allowClear:!0,size:"middle"}),(0,_.jsx)(h.ZP,{type:"primary",icon:(0,_.jsx)(E.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"æœç´¢"}),onClick:function(){return Be()}})]})}),(0,_.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,_.jsx)(M.Z,{dataSource:Ne,locale:{emptyText:(0,_.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,_.jsx)(M.Z.Item,{style:ae===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return re(e.uid)},children:(0,_.jsx)(M.Z.Item.Meta,{title:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,_.jsx)(b.Z,{size:4,children:e.isDefault?(0,_.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null})]}),description:e.description?(0,_.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,_.jsx)(g.Z.Panel,{children:ke?(0,_.jsx)(L.Z,{title:(0,_.jsxs)(b.Z,{children:[(0,_.jsxs)("span",{children:[e.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",ke.name||ke.uid]}),(0,_.jsx)(w.Z,{checked:!!ke.enabled,onChange:function(e){return Qe(ke.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),(0,_.jsx)(h.ZP,{size:"small",icon:(0,_.jsx)(F.Z,{}),onClick:function(e){var t;e.stopPropagation(),ye(null!=(t=ke)?t:ke),he(!0)},children:"ç¼–è¾‘"}),(0,_.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ve(ke)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,_.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,_.jsx)(I.Z,{}),onClick:function(e){e.stopPropagation()},children:"åˆ é™¤"})}),ke.isDefault?(0,_.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null]}),extra:(0,_.jsxs)(b.Z,{children:[(0,_.jsx)(S.Z,{title:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ",description:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ",okText:"ç»§ç»­å‘å¸ƒ",cancelText:"å–æ¶ˆ",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Xe()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,_.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Pe,type:"default",icon:(0,_.jsx)(K.Z,{}),children:(0,_.jsx)(r.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,_.jsx)(h.ZP,{onClick:function(){ke&&(Le(ke),qe.current=JSON.stringify(null!=ke?ke:{}),Ke(!1))},disabled:!Ie,icon:(0,_.jsx)(q.Z,{}),children:(0,_.jsx)(r.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,_.jsx)(h.ZP,{type:"primary",loading:je,onClick:$e,disabled:!Ie,icon:(0,_.jsx)(R.Z,{}),children:(0,_.jsx)(r.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,_.jsx)(a.Z,{activeKey:fe,onChange:pe,items:et})}):(0,_.jsx)(L.Z,{children:(0,_.jsx)(y.Z,{description:e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,_.jsx)(G.Z,{open:ge,onOpenChange:he,orgUid:(null==t?void 0:t.uid)||"",record:Me,onSuccess:function(){he(!1),Oe(se)}})]})},X=n(10154),ee=n.n(X),te=n(89246),ne=n(33797),le=n(75580),ae=n(68790),re=n(7704),ie=n(39497),oe=n(75864),se=n(89965),de=n(80953),ue=n(25784),ce=n(42491),fe=n(2250),pe=n(94433),ve=n(38956),me=n(35074),ge=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],he=l.forwardRef((function(e,t){var n=e.fieldProps,l=e.proFieldProps,a=e.min,r=e.max,i=e.step,o=e.marks,s=e.vertical,d=e.range,u=(0,ve.Z)(e,ge);return(0,_.jsx)(me.Z,(0,pe.Z)({valueType:"slider",fieldProps:(0,pe.Z)((0,pe.Z)({},n),{},{min:a,max:r,step:i,marks:o,vertical:s,range:d,style:null==n?void 0:n.style}),ref:t,proFieldProps:l,filedConfig:{ignoreWidth:!0}},u))})),be=n(83001),xe=n(13847),Me=n(41196),ye=n(40110),ke=n(70635),we=n(59908),Se=n(2011),je=n(48880),Ce=be.Z.Text,Te=function(e){var t=e.value,n=e.onChange,l=e.options,a=e.loading,r=e.placeholder,i=e.emptyContent,o=e.onSearch,s=e.onDropdownOpen,d=e.onCreate,u=e.createLabel,c=e.createTitle;return(0,_.jsxs)(b.Z.Compact,{block:!0,children:[(0,_.jsx)(xe.Z,{value:t,onChange:function(e){return null==n?void 0:n(e)},options:l,showSearch:!0,filterOption:!1,placeholder:r,loading:a,allowClear:!0,style:{flex:1},notFoundContent:i,onSearch:o,onOpenChange:function(e){e&&s()}}),(0,_.jsx)(h.ZP,{size:"small",icon:(0,_.jsx)(U.Z,{}),onClick:d,title:c,children:u})]})},Ze=function(e){var t,n,a,i,o,s,u,f,v,g,b,x,M,y,k,w,S,j,C,T,Z,P,E,F,I,K,q=e.open,R=e.record,L=e.onClose,W=e.onSuccess,N=(0,r.useIntl)(),O=(0,D.u)((function(e){return e.currentOrg})),B=(0,l.useMemo)((function(){return!(null==R||!R.uid)}),[R]),V=(0,l.useState)(!1),Q=m()(V,2),H=Q[0],J=Q[1],Y=(0,l.useState)([]),$=m()(Y,2),X=$[0],te=$[1],pe=(0,l.useState)(!1),ve=m()(pe,2),me=ve[0],ge=ve[1],be=(0,l.useRef)(),xe=(0,l.useState)((null==R?void 0:R.avatar)||""),Ze=m()(xe,2),Pe=Ze[0],Ue=Ze[1],Ee=(0,l.useState)((null==R?void 0:R.type)||ie.f4h),Fe=m()(Ee,2),Ie=Fe[0],Ke=Fe[1],qe=(0,l.useState)((null==R?void 0:R.system)||!1),Re=m()(qe,2),Le=Re[0],Ae=Re[1],ze=(0,l.useState)([]),De=m()(ze,2),We=De[0],Ne=De[1],Oe=(0,l.useState)({}),Be=m()(Oe,2),Ve=Be[0],Qe=Be[1],He=(0,l.useState)(!1),Ge=m()(He,2),Je=Ge[0],_e=Ge[1],Ye=(0,l.useState)(""),$e=m()(Ye,2),Xe=$e[0],et=$e[1],tt=(0,l.useState)(""),nt=m()(tt,2),lt=nt[0],at=nt[1],rt=(0,l.useState)(""),it=m()(rt,2),ot=it[0],st=it[1],dt=(0,l.useState)(""),ut=m()(dt,2),ct=ut[0],ft=ut[1],pt=(0,l.useState)(!(null==R||null===(t=R.llm)||void 0===t||!t.enabled)),vt=m()(pt,2),mt=vt[0],gt=vt[1],ht=(0,l.useState)(!(null==R||!R.kbEnabled)),bt=m()(ht,2),xt=bt[0],Mt=bt[1],yt=(0,l.useState)(!(null==R||null===(n=R.llm)||void 0===n||!n.useLlmWhenKbEmpty)),kt=m()(yt,2),wt=kt[0],St=kt[1],jt=(0,l.useState)(!1),Ct=m()(jt,2),Tt=Ct[0],Zt=Ct[1],Pt=(0,l.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),Ut=(0,l.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(t):"-"}),[]),Et=(0,l.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),Ft=(0,l.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),It=(0,l.useState)(null==R||null===(a=R.llm)||void 0===a?void 0:a.temperature),Kt=m()(It,2),qt=Kt[0],Rt=Kt[1],Lt=(0,l.useState)(Pt(null==R||null===(i=R.llm)||void 0===i?void 0:i.topP)),At=m()(Lt,2),zt=At[0],Dt=At[1],Wt=(0,l.useState)(null==R||null===(o=R.llm)||void 0===o?void 0:o.topK),Nt=m()(Wt,2),Ot=Nt[0],Bt=Nt[1],Vt=(0,l.useState)(Pt(null==R||null===(s=R.llm)||void 0===s?void 0:s.scoreThreshold)),Qt=m()(Vt,2),Ht=Qt[0],Gt=Qt[1],Jt=(0,l.useState)(null==R||null===(u=R.llm)||void 0===u?void 0:u.maxTokens),_t=m()(Jt,2),Yt=(_t[0],_t[1]),$t=(0,l.useState)(null==R||null===(f=R.llm)||void 0===f?void 0:f.contextMsgCount),Xt=m()($t,2),en=(Xt[0],Xt[1]),tn=(0,l.useCallback)(function(){var e=c()(d()().mark((function e(t){var n,l,a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge(!0),e.prev=1,null!=O&&O.uid){e.next=5;break}return te([]),e.abrupt("return",[]);case 5:return l={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==O?void 0:O.uid,searchText:t||""},e.next=8,(0,z.VW)(l);case 8:return a=e.sent,r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],te(r),e.abrupt("return",r);case 12:return e.prev=12,ge(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(t){return e.apply(this,arguments)}}(),[null==O?void 0:O.uid]);(0,l.useEffect)((function(){var e,t,n,l,a,r,i,o,s,d,u,c,f,p,v,m,g,h,b,x,M,y,k,w,S,j,C,T;if(q){var Z,P,U;if(Ue((null==R?void 0:R.avatar)||""),Ke((null==R?void 0:R.type)||ie.f4h),Ae((null==R?void 0:R.system)||!1),gt(!(null==R||null===(e=R.llm)||void 0===e||!e.enabled)),Mt(!(null==R||!R.kbEnabled)),St(!(null==R||null===(t=R.llm)||void 0===t||!t.useLlmWhenKbEmpty)),null===(n=be.current)||void 0===n||n.setFieldsValue({nickname:null==R?void 0:R.nickname,type:null==R?void 0:R.type,settingsUid:null==R||null===(l=R.settings)||void 0===l?void 0:l.uid,name:null==R?void 0:R.name,categoryUid:null==R?void 0:R.categoryUid,provider:null==R||null===(a=R.llm)||void 0===a?void 0:a.textProvider,model:null==R||null===(r=R.llm)||void 0===r?void 0:r.textModel,prompt:null==R||null===(i=R.llm)||void 0===i?void 0:i.prompt,description:null==R?void 0:R.description,enabled:null==R||null===(o=R.llm)||void 0===o?void 0:o.enabled,enableThinking:null==R||null===(s=R.llm)||void 0===s?void 0:s.enableThinking,enableStreaming:null==R||null===(d=R.llm)||void 0===d?void 0:d.enableStreaming,useLlmWhenKbEmpty:null==R||null===(u=R.llm)||void 0===u?void 0:u.useLlmWhenKbEmpty,temperature:Ft(null==R||null===(c=R.llm)||void 0===c?void 0:c.temperature),topP:Pt(null==R||null===(f=R.llm)||void 0===f?void 0:f.topP),topK:null==R||null===(p=R.llm)||void 0===p?void 0:p.topK,scoreThreshold:Pt(null==R||null===(v=R.llm)||void 0===v?void 0:v.scoreThreshold),maxTokens:null==R||null===(m=R.llm)||void 0===m?void 0:m.maxTokens,contextMsgCount:null==R||null===(g=R.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==R||null===(h=R.llm)||void 0===h?void 0:h.defaultReply,searchType:(null==R||null===(b=R.llm)||void 0===b?void 0:b.searchType)||ie.rk3,kbSourceEnabled:null==R?void 0:R.kbSourceEnabled,kbEnabled:null==R?void 0:R.kbEnabled,kbUid:null==R?void 0:R.kbUid}),null!=R&&R.llm&&(null!=R&&null!==(x=R.llm)&&void 0!==x&&x.textProviderUid||null!=R&&null!==(M=R.llm)&&void 0!==M&&M.textProvider||null!=R&&null!==(y=R.llm)&&void 0!==y&&y.textModel))et((null==R||null===(Z=R.llm)||void 0===Z?void 0:Z.textProvider)||""),at((null==R||null===(P=R.llm)||void 0===P?void 0:P.textProviderUid)||""),st((null==R||null===(U=R.llm)||void 0===U?void 0:U.textModel)||"");else et(""),at(""),st("");Rt(Ft(null==R||null===(k=R.llm)||void 0===k?void 0:k.temperature)),Dt(Pt(null==R||null===(w=R.llm)||void 0===w?void 0:w.topP)),Bt(null==R||null===(S=R.llm)||void 0===S?void 0:S.topK),Gt(Pt(null==R||null===(j=R.llm)||void 0===j?void 0:j.scoreThreshold)),Yt(null==R||null===(C=R.llm)||void 0===C?void 0:C.maxTokens),en(null==R||null===(T=R.llm)||void 0===T?void 0:T.contextMsgCount),Zt(!1)}}),[q,R]);var nn=function(){var e=c()(d()().mark((function e(t){var n,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue(t),!B||!R){e.next=13;break}return e.prev=2,n={uid:null==R?void 0:R.uid,avatar:t},e.next=6,(0,le.lz)(n);case 6:200===(null==(l=e.sent)?void 0:l.code)?(A.yw.success(N.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),null==W||W(l.data)):A.yw.error((null==l?void 0:l.message)||N.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),A.yw.error(N.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){q&&Ie===ie.f4h&&tn()}),[q,Ie,tn]);var ln=(0,l.useMemo)((function(){return X.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (é»˜è®¤)":"").concat(e.enabled?"":" (å·²åœç”¨)"),value:e.uid}}))}),[X]),an=(0,l.useRef)(),rn=(0,l.useCallback)((function(e){an.current&&clearTimeout(an.current),an.current=setTimeout((function(){tn(e)}),300)}),[tn]);(0,l.useEffect)((function(){return function(){an.current&&clearTimeout(an.current)}}),[]);var on=(0,l.useCallback)((function(){X.length||tn()}),[X.length,tn]),sn=(0,l.useCallback)(c()(d()().mark((function e(){var t,n,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==O?void 0:O.uid,level:ie.whQ},e.next=4,(0,ae.mK)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)&&(a=(null==n||null===(l=n.data)||void 0===l?void 0:l.content)||[],Ne(a),lt&&!Xe&&(r=a.find((function(e){return e.uid===lt})))&&et(r.type),!lt&&Xe&&(i=a.find((function(e){return e.type===Xe})))&&at(i.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==O?void 0:O.uid,lt,Xe]);(0,l.useEffect)((function(){q&&sn()}),[q,sn]);var dn=(0,l.useCallback)((function(){return _e(!0)}),[]),un=(0,l.useCallback)((function(){return _e(!1)}),[]),cn=(0,l.useCallback)((function(e,t){Qe((function(n){return p()(p()({},n),{},ee()({},e,t))}))}),[]),fn=(0,l.useCallback)((function(e,t,n){var l,a,r,i=We.find((function(t){return t.uid===e})),o=i?i.type:e;et(o),at(e),st(t),ft(n),null===(l=be.current)||void 0===l||l.setFieldsValue({provider:o,model:t});var s=null===(a=be.current)||void 0===a||null===(r=a.getFieldsValue)||void 0===r?void 0:r.call(a);if(s){var d,u,c,f,p,v,m,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U,E,F=(null==R?void 0:R.llm)||{},I=(null!==(d=s.prompt)&&void 0!==d?d:"")!==(null!==(u=F.prompt)&&void 0!==u?u:"")||(e||"")!==(null!==(c=F.textProviderUid)&&void 0!==c?c:"")||(o||s.provider||"")!==(null!==(f=F.textProvider)&&void 0!==f?f:"")||(t||s.model||"")!==(null!==(p=F.textModel)&&void 0!==p?p:"")||!!s.enabled!=!!F.enabled||!!s.enableThinking!=!!F.enableThinking||!!s.enableStreaming!=!!F.enableStreaming||!!s.useLlmWhenKbEmpty!=!!F.useLlmWhenKbEmpty||(null!==(v=s.temperature)&&void 0!==v?v:null)!==(null!==(m=F.temperature)&&void 0!==m?m:null)||(null!==(g=s.topP)&&void 0!==g?g:null)!==(null!==(h=F.topP)&&void 0!==h?h:null)||(null!==(b=s.topK)&&void 0!==b?b:null)!==(null!==(x=F.topK)&&void 0!==x?x:null)||(null!==(M=s.scoreThreshold)&&void 0!==M?M:null)!==(null!==(y=F.scoreThreshold)&&void 0!==y?y:null)||(null!==(k=s.maxTokens)&&void 0!==k?k:null)!==(null!==(w=F.maxTokens)&&void 0!==w?w:null)||(null!==(S=s.contextMsgCount)&&void 0!==S?S:null)!==(null!==(j=F.contextMsgCount)&&void 0!==j?j:null)||(null!==(C=s.defaultReply)&&void 0!==C?C:"")!==(null!==(T=F.defaultReply)&&void 0!==T?T:"")||(null!==(Z=s.searchType)&&void 0!==Z?Z:"")!==(null!==(P=F.searchType)&&void 0!==P?P:""),K=!!s.kbEnabled!=!(null==R||!R.kbEnabled)||!!s.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(U=s.kbUid)&&void 0!==U?U:"")!==(null!==(E=null==R?void 0:R.kbUid)&&void 0!==E?E:"");Zt(I||K)}_e(!1)}),[We]);return(0,_.jsxs)(oe.a,{onValuesChange:function(e,t){var n,l,a,r,i,o,s,d,u,c,f,p,v,m,g,h,b,x,M,y,k,w,S,j=(null==R?void 0:R.llm)||{},C=(null!==(n=t.prompt)&&void 0!==n?n:"")!==(null!==(l=j.prompt)&&void 0!==l?l:"")||(lt||"")!==(null!==(a=j.textProviderUid)&&void 0!==a?a:"")||(Xe||t.provider||"")!==(null!==(r=j.textProvider)&&void 0!==r?r:"")||(ot||t.model||"")!==(null!==(i=j.textModel)&&void 0!==i?i:"")||!!t.enabled!=!!j.enabled||!!t.enableThinking!=!!j.enableThinking||!!t.enableStreaming!=!!j.enableStreaming||!!t.useLlmWhenKbEmpty!=!!j.useLlmWhenKbEmpty||(null!==(o=t.temperature)&&void 0!==o?o:null)!==(null!==(s=j.temperature)&&void 0!==s?s:null)||(null!==(d=t.topP)&&void 0!==d?d:null)!==(null!==(u=j.topP)&&void 0!==u?u:null)||(null!==(c=t.topK)&&void 0!==c?c:null)!==(null!==(f=j.topK)&&void 0!==f?f:null)||(null!==(p=t.scoreThreshold)&&void 0!==p?p:null)!==(null!==(v=j.scoreThreshold)&&void 0!==v?v:null)||(null!==(m=t.maxTokens)&&void 0!==m?m:null)!==(null!==(g=j.maxTokens)&&void 0!==g?g:null)||(null!==(h=t.contextMsgCount)&&void 0!==h?h:null)!==(null!==(b=j.contextMsgCount)&&void 0!==b?b:null)||(null!==(x=t.defaultReply)&&void 0!==x?x:"")!==(null!==(M=j.defaultReply)&&void 0!==M?M:"")||(null!==(y=t.searchType)&&void 0!==y?y:"")!==(null!==(k=j.searchType)&&void 0!==k?k:""),T=!!t.kbEnabled!=!(null==R||!R.kbEnabled)||!!t.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(w=t.kbUid)&&void 0!==w?w:"")!==(null!==(S=null==R?void 0:R.kbUid)&&void 0!==S?S:"");Zt(C||T)},open:q,onOpenChange:function(e){e||L()},title:N.formatMessage({id:"robot.edit",defaultMessage:"ç¼–è¾‘æœºå™¨äºº"}),width:560,formRef:be,initialValues:B?{nickname:null==R?void 0:R.nickname,type:null==R?void 0:R.type,settingsUid:null==R||null===(v=R.settings)||void 0===v?void 0:v.uid,name:null==R?void 0:R.name,categoryUid:null==R?void 0:R.categoryUid,provider:null==R||null===(g=R.llm)||void 0===g?void 0:g.textProvider,model:null==R||null===(b=R.llm)||void 0===b?void 0:b.textModel,prompt:null==R||null===(x=R.llm)||void 0===x?void 0:x.prompt,description:null==R?void 0:R.description,enabled:null==R||null===(M=R.llm)||void 0===M?void 0:M.enabled,enableThinking:null==R||null===(y=R.llm)||void 0===y?void 0:y.enableThinking,enableStreaming:null==R||null===(k=R.llm)||void 0===k?void 0:k.enableStreaming,useLlmWhenKbEmpty:null==R||null===(w=R.llm)||void 0===w?void 0:w.useLlmWhenKbEmpty,temperature:Ft(null==R||null===(S=R.llm)||void 0===S?void 0:S.temperature),topP:Pt(null==R||null===(j=R.llm)||void 0===j?void 0:j.topP),topK:null==R||null===(C=R.llm)||void 0===C?void 0:C.topK,scoreThreshold:Pt(null==R||null===(T=R.llm)||void 0===T?void 0:T.scoreThreshold),maxTokens:null==R||null===(Z=R.llm)||void 0===Z?void 0:Z.maxTokens,contextMsgCount:null==R||null===(P=R.llm)||void 0===P?void 0:P.contextMsgCount,defaultReply:null==R||null===(E=R.llm)||void 0===E?void 0:E.defaultReply,searchType:(null==R||null===(F=R.llm)||void 0===F?void 0:F.searchType)||ie.rk3,kbSourceEnabled:null==R?void 0:R.kbSourceEnabled,kbEnabled:null==R?void 0:R.kbEnabled,kbUid:null==R?void 0:R.kbUid}:{type:ie.f4h,searchType:ie.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,_.jsxs)("div",{children:[(0,_.jsx)(h.ZP,{style:{marginRight:8},onClick:function(){return L()},children:N.formatMessage({id:"cancel",defaultMessage:"å–æ¶ˆ"})}),(0,_.jsx)(h.ZP,{type:"primary",onClick:function(){var e,t;return null===(e=be.current)||void 0===e||null===(t=e.submit)||void 0===t?void 0:t.call(e)},children:N.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=c()(d()().mark((function e(t){var n,l,a,r,i,o,s,u,c,f,p,v,m,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U,E,F,I;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,B&&null!=R&&R.uid){e.next=4;break}return A.yw.warning(N.formatMessage({id:"robot.edit.only",defaultMessage:"å½“å‰ä»…æ”¯æŒç¼–è¾‘ï¼Œè¯·é€šè¿‡æ–°å»ºå…¥å£åˆ›å»ºæœºå™¨äºº"})),e.abrupt("return",!1);case 4:return T=(null==R?void 0:R.llm)||{},Z=(null!==(n=t.prompt)&&void 0!==n?n:"")!==(null!==(l=T.prompt)&&void 0!==l?l:"")||(lt||"")!==(null!==(a=T.textProviderUid)&&void 0!==a?a:"")||(Xe||t.provider||"")!==(null!==(r=T.textProvider)&&void 0!==r?r:"")||(ot||t.model||"")!==(null!==(i=T.textModel)&&void 0!==i?i:"")||!!t.enabled!=!!T.enabled||!!t.enableThinking!=!!T.enableThinking||!!t.enableStreaming!=!!T.enableStreaming||!!t.useLlmWhenKbEmpty!=!!T.useLlmWhenKbEmpty||(null!==(o=t.temperature)&&void 0!==o?o:null)!==(null!==(s=T.temperature)&&void 0!==s?s:null)||(null!==(u=t.topP)&&void 0!==u?u:null)!==(null!==(c=T.topP)&&void 0!==c?c:null)||(null!==(f=t.topK)&&void 0!==f?f:null)!==(null!==(p=T.topK)&&void 0!==p?p:null)||(null!==(v=t.scoreThreshold)&&void 0!==v?v:null)!==(null!==(m=T.scoreThreshold)&&void 0!==m?m:null)||(null!==(g=t.maxTokens)&&void 0!==g?g:null)!==(null!==(h=T.maxTokens)&&void 0!==h?h:null)||(null!==(b=t.contextMsgCount)&&void 0!==b?b:null)!==(null!==(x=T.contextMsgCount)&&void 0!==x?x:null)||(null!==(M=t.defaultReply)&&void 0!==M?M:"")!==(null!==(y=T.defaultReply)&&void 0!==y?y:"")||(null!==(k=t.searchType)&&void 0!==k?k:"")!==(null!==(w=T.searchType)&&void 0!==w?w:""),P=!!t.kbEnabled!=!(null==R||!R.kbEnabled)||!!t.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(S=t.kbUid)&&void 0!==S?S:"")!==(null!==(j=null==R?void 0:R.kbUid)&&void 0!==j?j:""),U=Z||P,A.yw.loading(N.formatMessage({id:B?"updating":"creating",defaultMessage:B?"Updating":"Creating"})),F={uid:null==R?void 0:R.uid,nickname:t.nickname,name:t.name,type:t.type||ie.f4h,description:t.description,avatar:Pe,settingsUid:t.settingsUid,kbSourceEnabled:t.kbSourceEnabled,kbEnabled:t.kbEnabled,kbUid:t.kbUid,llm:{prompt:t.prompt,textProvider:Xe||t.provider,textProviderUid:lt||void 0,textModel:ot||t.model,enabled:t.enabled,enableThinking:t.enableThinking,enableStreaming:t.enableStreaming,useLlmWhenKbEmpty:t.useLlmWhenKbEmpty,temperature:Ft(t.temperature),topP:Pt(t.topP),topK:t.topK,scoreThreshold:Pt(t.scoreThreshold),maxTokens:t.maxTokens,contextMsgCount:t.contextMsgCount,defaultReply:t.defaultReply,searchType:t.searchType}},e.next=12,(0,le.$l)(F);case 12:if(E=e.sent,console.log("updateRobot:",E,F),A.yw.destroy(),200!==(null===(C=E)||void 0===C?void 0:C.code)){e.next=23;break}return A.yw.success(N.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),U&&A.yw.info(N.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/çŸ¥è¯†åº“ç›¸å…³é…ç½®å·²æ›´æ–°ï¼Œåˆ·æ–°æˆ–é‡æ–°è¿›å…¥æœºå™¨äººä¼šè¯åç”Ÿæ•ˆ"}),5),null==W||W(E.data),L(),e.abrupt("return",!0);case 23:return A.yw.error((null===(I=E)||void 0===I?void 0:I.message)||N.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),A.yw.destroy(),A.yw.error(N.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,_.jsx)(Me.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:N.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"å¤´åƒ"}),children:(0,_.jsxs)(Se.G,{onSuccess:nn,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,_.jsx)(ne.Z,{src:Pe}),(0,_.jsx)(h.ZP,{icon:(0,_.jsx)(we.Z,{}),style:{marginLeft:12},children:N.formatMessage({id:"pages.robot.upload",defaultMessage:"ä¸Šä¼ "})})]},"avatar")}),Ie===ie.Qeb&&Le&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(se.Z,{name:"name",hidden:!0,label:N.formatMessage({id:"name",defaultMessage:"åç§°"}),fieldProps:{placeholder:Le&&Ie===ie.Qeb?N.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.placeholder",defaultMessage:"ç³»ç»Ÿä»£ç†ä¸å¯ä¿®æ”¹åç§°"}):void 0},disabled:Le&&Ie===ie.Qeb}),(0,_.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:-20,marginBottom:10},children:N.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.tip",defaultMessage:"ç³»ç»Ÿå†…ç½®ä»£ç†ï¼Œæ— æ³•ä¿®æ”¹åç§°"})})]}),(0,_.jsx)(se.Z,{name:"nickname",label:N.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),rules:[{required:!0,message:N.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"})}]}),(0,_.jsx)(de.Z,{name:"description",label:N.formatMessage({id:"description",defaultMessage:"æè¿°"})}),Ie===ie.f4h&&(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(ue.A.Item,{name:"settingsUid",label:N.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),rules:[{required:!0,message:N.formatMessage({id:"robot.settings.required",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"})}],children:(0,_.jsx)(Te,{options:ln,loading:me,placeholder:N.formatMessage({id:"robot.settings.placeholder",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"}),emptyContent:0===ln.length?(0,_.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,_.jsx)("div",{style:{marginBottom:8,color:"#999"},children:N.formatMessage({id:"robot.settings.empty",defaultMessage:"æš‚æ— é…ç½®æ¨¡æ¿"})}),(0,_.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,_.jsx)(U.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return J(!0)},children:N.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"})})]}):void 0,onSearch:rn,onDropdownOpen:on,onCreate:function(){return J(!0)},createLabel:N.formatMessage({id:"common.new",defaultMessage:"æ–°å»º"}),createTitle:N.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"})})})}),(0,_.jsx)(ce.Z,{name:"enabled",label:N.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),fieldProps:{onChange:function(e){return gt(e)}}}),mt&&(0,_.jsxs)(l.Fragment,{children:[(0,_.jsxs)("div",{children:[(0,_.jsx)(Ce,{style:{marginBottom:8,display:"block"},children:N.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"æ–‡å­—å¯¹è¯æ¨¡å‹æä¾›å•†"})}),(0,_.jsx)(ye.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:dn,children:(lt||Xe)&&ot?(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)(Ce,{type:"secondary",children:N.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"ä¾›åº”å•†ï¼š"})}),(0,_.jsx)(Ce,{strong:!0,children:(null===(I=We.find((function(e){return e.uid===lt})))||void 0===I?void 0:I.nickname)||(null===(K=We.find((function(e){return e.type===Xe})))||void 0===K?void 0:K.nickname)||Xe}),(0,_.jsx)("br",{}),(0,_.jsx)(Ce,{type:"secondary",children:N.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"æ¨¡å‹ï¼š"})}),(0,_.jsx)(Ce,{strong:!0,children:ct||ot})]}),(0,_.jsx)(h.ZP,{type:"primary",children:N.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"æ›´æ¢æ¨¡å‹"})})]}):(0,_.jsx)("div",{style:{textAlign:"center"},children:(0,_.jsx)(h.ZP,{type:"primary",children:N.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"é€‰æ‹©AIæ¨¡å‹"})})})}),(0,_.jsxs)("div",{style:{display:"none"},children:[(0,_.jsx)(fe.Z,{name:"provider"}),(0,_.jsx)(fe.Z,{name:"model"})]})]}),(0,_.jsx)(he,{name:"temperature",label:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,_.jsx)("span",{children:N.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"})}),(0,_.jsx)("span",{style:{color:"#999"},children:": "+Ut(qt,2)})]}),tooltip:N.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§ï¼Œå€¼è¶Šé«˜è¾“å‡ºè¶Šéšæœºåˆ›æ–°"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Rt(Ft(e))}}}),(0,_.jsx)(he,{name:"topP",label:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,_.jsx)("span",{children:N.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,_.jsx)("span",{style:{color:"#999"},children:": "+Ut(zt,2)})]}),tooltip:N.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P é‡‡æ ·é˜ˆå€¼ï¼Œä¿ç•™ç´¯è®¡æ¦‚ç‡è¾¾åˆ°è¯¥å€¼çš„è¯ï¼ŒèŒƒå›´ 0-1ï¼Œå€¼è¶Šå°è¶Šä¿å®ˆ"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Dt(Ft(e))}}}),(0,_.jsx)(he,{name:"topK",label:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,_.jsx)("span",{children:N.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,_.jsx)("span",{style:{color:"#999"},children:": "+Et(Ot)})]}),tooltip:N.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"æ£€ç´¢æ—¶è¿”å›çš„ç›¸å…³æ–‡æ¡£æ•°é‡"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Bt(e)}}}),(0,_.jsx)(he,{name:"scoreThreshold",label:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,_.jsx)("span",{children:N.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"å¾—åˆ†é˜ˆå€¼"})}),(0,_.jsx)("span",{style:{color:"#999"},children:": "+Ut(Ht,2)})]}),tooltip:N.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"çŸ¥è¯†åº“å¬å›å‘½ä¸­æ–‡æ¡£çš„æœ€ä½å¾—åˆ†é˜ˆå€¼ï¼Œä½äºæ­¤å€¼ä¸çº³å…¥å‚è€ƒ"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Gt(Ft(e))}}}),!1,(0,_.jsx)(de.Z,{name:"prompt",label:N.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})}),(0,_.jsx)(ce.Z,{name:"useLlmWhenKbEmpty",label:N.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"çŸ¥è¯†åº“ç©ºç»“æœæ—¶ä½¿ç”¨å¤§æ¨¡å‹"}),tooltip:N.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"å¼€å¯åï¼Œå½“çŸ¥è¯†åº“æ²¡æœ‰å‘½ä¸­æ—¶å°†ç»§ç»­è°ƒç”¨å¤§æ¨¡å‹å›ç­”ï¼›å…³é—­åˆ™è¿”å›é»˜è®¤å›å¤"}),fieldProps:{onChange:function(e){return St(e)}}}),!wt&&(0,_.jsx)(de.Z,{name:"defaultReply",label:N.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"é»˜è®¤å›å¤"})})]}),(0,_.jsxs)(l.Fragment,{children:[(0,_.jsx)(ce.Z,{name:"kbEnabled",label:N.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"å¯ç”¨çŸ¥è¯†åº“"}),fieldProps:{onChange:function(e){return Mt(e)}}}),xt&&(0,_.jsxs)(l.Fragment,{children:[(0,_.jsx)(ce.Z,{name:"kbSourceEnabled",label:N.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),tooltip:N.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"å¼€å¯åå°†åœ¨å›å¤ä¸­æ˜¾ç¤ºçŸ¥è¯†åº“å‘½ä¸­æ¥æºï¼Œä¾¿äºè°ƒè¯•ä¸åŒæ£€ç´¢ç±»å‹çš„æœç´¢ç»“æœ"})}),(0,_.jsx)(fe.Z,{name:"searchType",label:N.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),valueEnum:ee()(ee()(ee()({},ie.ccx,{text:"å…¨æ–‡"}),ie.DGp,{text:"å‘é‡"}),ie.rk3,{text:"æ··åˆ"})}),(0,_.jsx)(fe.Z,{name:"kbUid",label:N.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),placeholder:N.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"è¯·é€‰æ‹©çŸ¥è¯†åº“"}),showSearch:!0,debounceTime:300,request:function(){var e=c()(d()().mark((function e(t){var n,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:ie.QPQ,orgUid:null==O?void 0:O.uid,searchText:n||""},e.next=5,(0,re.AP)(a);case 5:return r=e.sent,i=(null==r||null===(l=r.data)||void 0===l?void 0:l.content)||[],e.abrupt("return",i.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()})]})]}),Tt&&(0,_.jsx)(ke.Z,{type:"info",showIcon:!0,message:N.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/çŸ¥è¯†åº“ç›¸å…³é…ç½®å·²æ›´æ–°ï¼Œåˆ·æ–°æˆ–é‡æ–°è¿›å…¥æœºå™¨äººä¼šè¯åç”Ÿæ•ˆ"}),style:{marginBottom:12}}),(0,_.jsx)(je.Z,{visible:Je,onCancel:un,onOk:fn,initialProvider:lt||Xe,initialModel:ot,initialModelLabel:ct,providers:We,currentOrgUid:null==O?void 0:O.uid,existingProviderModels:Ve,onModelsLoaded:cn,allowedModelTypes:[ie.l55,ie.xZ8,"CHAT"]}),(0,_.jsx)(G.Z,{open:H,onOpenChange:J,orgUid:(null==O?void 0:O.uid)||"",record:null,onSuccess:function(){J(!1),tn()}})]})},Pe=n(52575),Ue=n(86895),Ee=n(23753),Fe=function(e){var t,n=e.open,a=e.record,i=e.value,o=e.onClose,s=e.onSaved,u=(0,r.useIntl)(),f=(0,l.useState)(i||(null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)||""),v=m()(f,2),g=v[0],b=v[1];(0,l.useEffect)((function(){var e,t;b(null!==(e=null!=i?i:null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[n,i,null==a?void 0:a.uid]);var x=function(){var e=c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(g||"");case 3:A.yw.success(u.formatMessage({id:"copy.success",defaultMessage:"å¤åˆ¶æˆåŠŸ"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),A.yw.error(u.formatMessage({id:"copy.failed",defaultMessage:"å¤åˆ¶å¤±è´¥"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=c()(d()().mark((function e(){var t,n,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return null==o||o(),e.abrupt("return");case 3:return e.prev=3,A.yw.loading(u.formatMessage({id:"saving",defaultMessage:"Saving..."})),n={uid:(t=a).uid,prompt:g,llm:p()(p()({},t.llm||{}),{},{prompt:g})},e.next=9,(0,le.M8)(n);case 9:l=e.sent,Ee.Z.debug("PromptEditModal handleSave updated robot prompt:",l,n),A.yw.destroy(),200===(null==l?void 0:l.code)?(A.yw.success(u.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==s||s()):A.yw.error((null==l?void 0:l.message)||u.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),A.yw.destroy(),A.yw.error(u.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,_.jsx)(Ue.Z,{open:n,title:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),onCancel:o,footer:[(0,_.jsx)(h.ZP,{onClick:x,children:u.formatMessage({id:"copy",defaultMessage:"å¤åˆ¶"})},"copy"),(0,_.jsx)(h.ZP,{type:"primary",onClick:M,children:u.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})},"save"),(0,_.jsx)(h.ZP,{onClick:o,children:u.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:(0,_.jsx)("div",{children:(0,_.jsx)("textarea",{value:g,onChange:function(e){return b(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})})})})},Ie=function(){var e=(0,r.useIntl)(),t=(0,l.useRef)(),n=(0,D.u)((function(e){return e.currentOrg})),a=(0,l.useState)(!1),i=m()(a,2),o=i[0],s=i[1],u=(0,l.useState)(!1),f=m()(u,2),v=f[0],g=f[1],b=(0,l.useState)(null),x=m()(b,2),M=x[0],y=x[1],w=(0,l.useState)(!1),j=m()(w,2),C=j[0],T=j[1],Z=(0,l.useState)(""),P=m()(Z,2),U=P[0],E=P[1],F=(0,l.useState)(null),I=m()(F,2),K=I[0],q=I[1],R=(0,l.useState)({}),L=m()(R,2),z=L[0],W=L[1],N=(0,l.useState)({}),O=m()(N,2),B=O[0],V=O[1];l.useEffect((function(){var e=function(){var e=c()(d()().mark((function e(){var t,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==n?void 0:n.uid,level:ie.whQ},e.next=4,(0,ae.mK)(t);case 4:l=e.sent,Ee.Z.debug("RobotTable loadProviders response:",l,t),200===(null==l?void 0:l.code)&&(r=(null==l||null===(a=l.data)||void 0===a?void 0:a.content)||[],i={},r.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(i[e.uid]=t)})),W(i)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=n&&n.uid?e():W({})}),[null==n?void 0:n.uid]),l.useEffect((function(){var e=function(){var e=c()(d()().mark((function e(){var t,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,orgUid:null==n?void 0:n.uid,searchText:""},e.next=4,(0,re.AP)(t);case 4:l=e.sent,Ee.Z.debug("RobotTable loadKbases response:",l,t),200===(null==l?void 0:l.code)&&(r=(null==l||null===(a=l.data)||void 0===a?void 0:a.content)||[],i={},r.forEach((function(e){null!=e&&e.uid&&(i[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),V(i)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=n&&n.uid?e():V({})}),[null==n?void 0:n.uid]);var Q=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,_.jsx)(ne.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(t,n){var l=null==n?void 0:n.type,a=l===ie.Qeb?"green":l===ie.f4h?"blue":"purple",r=l===ie.f4h?e.formatMessage({id:ie.f4h,defaultMessage:"Service"}):l===ie.Qeb?e.formatMessage({id:ie.Qeb,defaultMessage:"Chat"}):l===ie.wG_?e.formatMessage({id:ie.wG_,defaultMessage:"Marketing"}):e.formatMessage({id:l||"unknown",defaultMessage:l||"-"});return(0,_.jsx)(k.Z,{color:a,children:r})},hideInSearch:!0},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:ee()(ee()(ee()({},ie.f4h,{text:e.formatMessage({id:ie.f4h,defaultMessage:"Service"})}),ie.Qeb,{text:e.formatMessage({id:ie.Qeb,defaultMessage:"Chat"})}),ie.wG_,{text:e.formatMessage({id:ie.wG_,defaultMessage:"Marketing"}),disabled:!0}),hideInTable:!0},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){if((null==n?void 0:n.type)===ie.Qeb){var l,a,r=!(null==n||null===(l=n.llm)||void 0===l||!l.textModel);return(0,_.jsx)("a",{onClick:function(){y(n),s(!0)},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(a=n.llm)||void 0===a?void 0:a.textModel)||e.formatMessage({id:"robot.llm.configured",defaultMessage:"æ¨¡å‹å·²é…ç½®"}):e.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"æœªé…ç½®æ¨¡å‹ï¼Œç‚¹å‡»é…ç½®"})})}return null!=n&&n.settings?(0,_.jsx)("a",{onClick:function(){y(n),s(!0)},children:n.settings.name||e.formatMessage({id:"robot.settings.configured",defaultMessage:"å·²é…ç½®"})}):(0,_.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){y(n),s(!0)},children:e.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"æœªé…ç½®ï¼Œç‚¹å‡»é…ç½®"})})}},{title:e.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(t,n){var l,a=null==n||null===(l=n.llm)||void 0===l?void 0:l.prompt;return a?(0,_.jsx)("a",{onClick:function(){E(a),q(n),T(!0)},children:e.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})}):"-"}},{title:e.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var n,l,a=null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid;return a&&z[a]?z[a]:(null==t||null===(l=t.llm)||void 0===l?void 0:l.textProvider)||"-"}},{title:e.formatMessage({id:"pages.prompt.model",defaultMessage:"æ¨¡å‹"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textModel)||"-"}},{title:e.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,t){var n;return null!=t&&null!==(n=t.llm)&&void 0!==n&&n.enabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"çŸ¥è¯†åº“æœç´¢ç»“æœä¸ºç©ºæ—¶ç”¨LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,t){var n;return null!=t&&null!==(n=t.llm)&&void 0!==n&&n.useLlmWhenKbEmpty?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var n,l,a;return 0===(null==t||null===(n=t.llm)||void 0===n?void 0:n.temperature)?"0":null!==(l=null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)&&void 0!==l?l:"-"}},{title:e.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var n,l;return null!==(n=null==t||null===(l=t.llm)||void 0===l?void 0:l.topK)&&void 0!==n?n:"-"}},{title:e.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"çŸ¥è¯†åº“å¯ç”¨"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,t){var n,l=null==t||null===(n=t.llm)||void 0===n?void 0:n.searchType;return l===ie.ccx?"å…¨æ–‡":l===ie.DGp?"å‘é‡":l===ie.rk3?"æ··åˆ":null!=l?l:"-"}},{title:e.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,t){var n=null==t?void 0:t.kbUid;return n?B[n]||n:"-"}},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(l,a){return[(0,_.jsx)("a",{onClick:function(){return function(t){var l;if(t&&t.uid){var a={chatConfig:{org:null==n?void 0:n.uid,t:ie.ACv,sid:t.uid}};null===(l=window.bytedesk)||void 0===l||l.showChat(a)}else A.yw.error(e.formatMessage({id:"robot.invalid",defaultMessage:"æ— æ•ˆçš„æœºå™¨äºº"}))}(a)},children:e.formatMessage({id:"chat.test",defaultMessage:"æµ‹è¯•"})},"test"),(0,_.jsx)("a",{onClick:function(){return r.history.push("/service/channel")},children:e.formatMessage({id:"robot.get.code",defaultMessage:"è·å–æœºå™¨äººä»£ç "})},"code"),(0,_.jsx)("a",{onClick:function(){y(a),s(!0)},children:e.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,_.jsx)(S.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"åˆ é™¤ç¡®è®¤"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"ç¡®è®¤åˆ é™¤"}),"ã€").concat(null==a?void 0:a.nickname,"ã€‘ï¼Ÿ"),onConfirm:c()(d()().mark((function n(){var l,r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return A.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,le.gf)(a);case 4:l=n.sent,A.yw.destroy(),200===(null==l?void 0:l.code)?(A.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(r=t.current)||void 0===r||r.reload()):A.yw.error((null==l?void 0:l.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),A.yw.destroy(),A.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,_.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(te.Z,{columns:Q,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:ie.f4h}},toolBarRender:function(){return[(0,_.jsx)(h.ZP,{type:"primary",onClick:function(){y(null),g(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=c()(d()().mark((function e(t,l){var a,r,i,o,s,u,c,f,v,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(null!==(a=null==t?void 0:t.current)&&void 0!==a?a:1)-1,u=null!==(r=null==t?void 0:t.pageSize)&&void 0!==r?r:10,c=null!==(i=null==t?void 0:t.searchText)&&void 0!==i?i:"",f=null!==(o=null==t?void 0:t.type)&&void 0!==o?o:ie.f4h,(h=Object.entries(l||{})).length>0&&(b=h[0],x=m()(b,2),M=x[0],(y=x[1])&&(v=M,g="ascend"===y?"ascend":"descend")),k=p()(p()({pageNumber:s,pageSize:u,categoryUid:"",level:ie.whQ,type:f,orgUid:null==n?void 0:n.uid,searchText:c},v?{sortBy:v}:{}),g?{sortDirection:g}:{}),e.prev=7,e.next=10,(0,le.p0)(k);case 10:if(w=e.sent,console.log("RobotTable queryRobotsByOrg response:",w,k),200!==(null==w?void 0:w.code)){e.next=16;break}return P=(null==w||null===(S=w.data)||void 0===S?void 0:S.content)||[],U=null!==(j=null!==(C=null==w||null===(T=w.data)||void 0===T?void 0:T.totalElements)&&void 0!==C?C:null==w||null===(Z=w.data)||void 0===Z?void 0:Z.numberOfElements)&&void 0!==j?j:P.length,e.abrupt("return",{data:P,total:U,success:!0});case 16:return e.abrupt("return",{data:[],total:0,success:!1});case 19:return e.prev=19,e.t0=e.catch(7),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"robot",defaultMessage:"Robot"})}),o&&(0,_.jsx)(Ze,{open:o,record:M,onClose:function(){return s(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),v&&(0,_.jsx)(Pe.Z,{open:v,onClose:function(){return g(!1)},onSubmit:function(){var n=c()(d()().mark((function n(l){var a,r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return A.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,le.lg)(l);case 4:a=n.sent,A.yw.destroy(),200===(null==a?void 0:a.code)?(A.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),g(!1),null===(r=t.current)||void 0===r||r.reload()):A.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),A.yw.destroy(),A.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}),(0,_.jsx)(Fe,{open:C,record:K,value:U,onClose:function(){return T(!1)},onSaved:function(){var e;T(!1),q(null),null===(e=t.current)||void 0===e||e.reload()}})]})},Ke=function(){return(0,_.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,_.jsx)(r.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,_.jsx)(Ie,{})},{key:"settings",label:(0,_.jsx)(r.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,_.jsx)($,{})}]})}}}]);