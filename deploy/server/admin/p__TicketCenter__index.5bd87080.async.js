"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9107],{28172:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},17275:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},2685:function(e,t,a){var r=a(94433),n=a(38956),o=a(28273),s=a(44194),i=a(50079),l=a(85973),c=a(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var a=e.fieldProps,d=e.children,f=e.params,m=e.proFieldProps,p=e.mode,g=e.valueEnum,h=e.request,v=e.showSearch,k=e.options,M=(0,n.Z)(e,u),x=(0,s.useContext)(i.Z);return(0,c.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:k,mode:p,showSearch:v,getPopupContainer:x.getPopupContainer},a),ref:t,proFieldProps:m},M),{},{children:d}))},m=s.forwardRef((function(e,t){var a=e.fieldProps,u=e.children,f=e.params,m=e.proFieldProps,p=e.mode,g=e.valueEnum,h=e.request,v=e.options,k=(0,n.Z)(e,d),M=(0,r.Z)({options:v,mode:p||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),x=(0,s.useContext)(i.Z);return(0,c.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:x.getPopupContainer},M),ref:t,proFieldProps:m},k),{},{children:u}))})),p=s.forwardRef(f);p.SearchSelect=m,p.displayName="ProFormComponent",t.Z=p},44565:function(e,t,a){var r=a(32906),n=a(94433),o=a(38956),s=a(92032),i=a(63642),l=a(9134),c=a(21762),u=a(44194),d=a(85973),f=a(31549),m=["fieldProps","proFieldProps"],p=["fieldProps","proFieldProps"],g="text",h=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),a=(0,r.Z)(t,2),o=a[0],c=a[1];return(0,f.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var a,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,n.Z)((0,n.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return c(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(a=e.statusRender)||void 0===a?void 0:a.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:o,children:e.children}))}})},v=function(e){var t=e.fieldProps,a=e.proFieldProps,r=(0,o.Z)(e,m);return(0,f.jsx)(d.Z,(0,n.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:a},r))};v.Password=function(e){var t=e.fieldProps,a=e.proFieldProps,s=(0,o.Z)(e,p),i=(0,u.useState)(!1),l=(0,r.Z)(i,2),m=l[0],v=l[1];return null!=t&&t.statusRender&&s.name?(0,f.jsx)(h,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:m,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(d.Z,(0,n.Z)({valueType:"password",fieldProps:(0,n.Z)((0,n.Z)({},(0,c.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var a;null==t||null===(a=t.onBlur)||void 0===a||a.call(t,e),v(!1)},onClick:function(e){var a;null==t||null===(a=t.onClick)||void 0===a||a.call(t,e),v(!0)}}),proFieldProps:a,filedConfig:{valueType:g}},s))})}):(0,f.jsx)(d.Z,(0,n.Z)({valueType:"password",fieldProps:t,proFieldProps:a,filedConfig:{valueType:g}},s))},v.displayName="ProFormComponent",t.Z=v},60857:function(e,t,a){var r=a(94433),n=a(38956),o=a(44194),s=a(85973),i=a(31549),l=["fieldProps","proFieldProps"],c=function(e,t){var a=e.fieldProps,o=e.proFieldProps,c=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:o},c))};t.Z=o.forwardRef(c)},51013:function(e,t,a){a.r(t),a.d(t,{default:function(){return ve}});var r=a(90819),n=a.n(r),o=a(89933),s=a.n(o),i=a(45332),l=a.n(i),c=a(22504),u=a(96082),d=a(2157),f=a(10713),m=a(44194),p=a(5861),g=a(26022),h=a(31362),v=a(26460),k=a(74546),M=a(78810),x=a(95191),y=(a(40808),a(5746)),b=a(87523),Z=a(16773),w=a(42539),j=a(74494),P=a(83910),C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},S=a(5901),F=function(e,t){return m.createElement(S.Z,(0,P.Z)({},e,{ref:t,icon:C}))};var E=m.forwardRef(F),N=a(6992),q=a(76711),U=a.n(q),I=a(19095),R=a(76185),T=a(40845),A=a(2685),B=a(60857),V=a(44565),z=a(5286),D=a(20188),K=a(36265),O=a(63642),W=a(14999),_=a(22060),H=a(11258),L=a(15384),G=a(8651),J=a(73193),Q=a.n(J),$=a(33122),X=a(86472),Y=a(10497),ee=a(74675),te=a(99689),ae=a(41770),re=a(76863),ne=a(95111),oe=a(91247),se=(a(77586),a(31549)),ie=$.Z.TextArea,le=X.ZP.Group,ce=Y.Z.Group;var ue=function(e){var t=e.fields,a=e.translate,r=e.forms,o=void 0===r?[]:r,i=e.selectedFormUid,c=e.onFormSelect,u=e.onFormSubmit,f=e.loading,g=void 0!==f&&f,h=e.renderMode,v=void 0===h?"full":h,k=e.fieldNamePrefix,M=void 0===k?"":k,x=(0,m.useState)([]),y=l()(x,2),b=y[0],Z=y[1],w=(0,m.useState)(null),j=l()(w,2),P=j[0],C=j[1],S=O.Z.useForm(),F=l()(S,1)[0],E=(0,p.useIntl)(),N=function(e){if(!e)return"";try{return a&&a(e)||e}catch(t){return console.error("translate field text failed:",t),e}},q=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("解析表单schema失败:",e),[]}},U=o.map((function(e){return e.uid})).join(",");(0,m.useEffect)((function(){if(i&&o.length>0){var e=o.find((function(e){return e.uid===i}));if(e)if(C(e),e.schema){var t=q(e.schema);Z(t)}else Z([])}else C(null),Z([])}),[i,U]);var I=function(e){var t,a=function(e,t){switch(e){case"text":switch(t){case"email":return E.formatMessage({id:"ticket.form.placeholder.email",defaultMessage:"请输入邮箱地址"});case"tel":return E.formatMessage({id:"ticket.form.placeholder.tel",defaultMessage:"请输入电话号码"});case"textarea":return E.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入文本内容"});case"date":return E.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"datetime-local":return E.formatMessage({id:"ticket.form.placeholder.datetime",defaultMessage:"请选择日期时间"});default:return E.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}case"input":return E.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"});case"textarea":return E.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入多行文本"});case"select":return E.formatMessage({id:"ticket.form.placeholder.select",defaultMessage:"请选择"});case"datePicker":return E.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"timePicker":return E.formatMessage({id:"ticket.form.placeholder.time",defaultMessage:"请选择时间"});default:return E.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}}(e.type,null===(t=e.props)||void 0===t?void 0:t.type);return function(e){var t=e.type,a=e.props,r=void 0===a?{}:a,n=e.options,o=e.placeholder,s=e.isDarkMode,i=void 0!==s&&s;if(!t)return null;var l=t.toLowerCase(),c=i?{backgroundColor:"#141414",borderColor:"#434343",color:"#fff"}:{},u=i?{backgroundColor:"#141414"}:{};switch(l){case"text":switch(r.type||"text"){case"email":return(0,se.jsx)($.Z,{type:"email",placeholder:o||"请输入邮箱地址",style:c});case"tel":return(0,se.jsx)($.Z,{type:"tel",placeholder:o||"请输入电话号码",style:c});case"textarea":return(0,se.jsx)(ie,{rows:r.rows||4,placeholder:o||"请输入文本内容",style:c});case"date":return(0,se.jsx)(ee.ZP,{locale:oe.Z,children:(0,se.jsx)(te.default,{style:Q()({width:"100%"},c),placeholder:o||"请选择日期"})});case"datetime-local":return(0,se.jsx)(ee.ZP,{locale:oe.Z,children:(0,se.jsx)(te.default,{showTime:!0,style:Q()({width:"100%"},c),placeholder:o||"请选择日期时间"})});case"file":return(0,se.jsx)(ae.Z,{accept:r.accept,children:(0,se.jsx)(d.ZP,{style:i?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传文件"})});default:return(0,se.jsx)($.Z,{placeholder:o||"请输入",style:c})}case"input":return(0,se.jsx)($.Z,{placeholder:o||"请输入",style:c});case"textarea":return(0,se.jsx)(ie,{rows:4,placeholder:o||"请输入多行文本",style:c});case"select":return(0,se.jsx)(L.Z,{style:Q()({width:"100%"},u),placeholder:o||"请选择",classNames:i?{popup:{root:"dark-mode-select"}}:void 0,options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t)}})):[{label:"选项1",value:"1",key:"option-1"},{label:"选项2",value:"2",key:"option-2"}]});case"radio":return(0,se.jsx)(le,{style:i?{color:"#fff"}:{},children:(Array.isArray(n)?n:["选项1","选项2"]).map((function(e,t){return(0,se.jsx)(X.ZP,{value:e,style:i?{color:"#fff"}:{},children:e},"".concat(e,"-").concat(t))}))});case"checkbox":return(0,se.jsx)(ce,{style:i?{color:"#fff"}:{},options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t),style:i?{color:"#fff"}:{}}})):[{label:"选项1",value:"1",key:"option-1",style:i?{color:"#fff"}:{}},{label:"选项2",value:"2",key:"option-2",style:i?{color:"#fff"}:{}}]});case"datepicker":return(0,se.jsx)(ee.ZP,{locale:oe.Z,children:(0,se.jsx)(te.default,{style:Q()({width:"100%"},c),placeholder:o||"请选择日期",classNames:i?{popup:{root:"dark-mode-picker"}}:void 0})});case"timepicker":return(0,se.jsx)(ee.ZP,{locale:oe.Z,children:(0,se.jsx)(re.Z,{style:Q()({width:"100%"},c),placeholder:o||"请选择时间",classNames:i?{popup:{root:"dark-mode-picker"}}:void 0})});case"switch":return(0,se.jsx)(ne.Z,{checkedChildren:"开",unCheckedChildren:"关"});case"upload":return(0,se.jsx)(ae.Z,{accept:r.accept,children:(0,se.jsx)(d.ZP,{style:i?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传"})});default:return console.log("Unknown component type:",t),(0,se.jsxs)("div",{children:["未知组件类型: ",t]})}}({type:e.type,props:e.props,options:e.options,placeholder:a,isDarkMode:!1})},R=function(){var e=s()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!u){e.next=6;break}return e.next=4,u(t);case 4:W.ZP.success(E.formatMessage({id:"ticket.form.submit.success",defaultMessage:"表单提交成功"})),F.resetFields();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("表单提交失败:",e.t0),W.ZP.error(E.formatMessage({id:"ticket.form.submit.error",defaultMessage:"表单提交失败"}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();if(t&&t.length>0){return(0,se.jsx)(se.Fragment,{children:t.map((function(e,t){var a=function(e,t){return(null==e?void 0:e.id)||(null==e?void 0:e.fieldId)||(null==e?void 0:e.key)||(null==e?void 0:e.name)||"field-".concat(t)}(e,t),r="".concat(M).concat(a),n=(null==e?void 0:e.label)||(null==e?void 0:e.title)||"Field ".concat(t+1),o=N(n)||n,s=null!=e&&e.required?[{required:!0,message:E.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:o})}]:void 0;return(0,se.jsx)(O.Z.Item,{name:r,label:o,rules:s,children:I(e)},r)}))})}if("fields-only"===v){if(!i||!o.length)return null;var T=o.find((function(e){return e.uid===i}));if(!T||!T.schema)return null;var A=q(T.schema);return A.length?(0,se.jsx)(se.Fragment,{children:A.map((function(e,t){return(0,se.jsx)(O.Z.Item,{name:"".concat(M).concat(e.id||"field-".concat(t)),label:N(e.label)||e.label,rules:[{required:e.required,message:E.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:N(e.label)||e.label})}],children:I(e)},e.id||"field-".concat(t))}))}):null}return 0===o.length?(0,se.jsx)(_.Z,{title:E.formatMessage({id:"ticket.form.panel.title",defaultMessage:"工单表单"}),children:(0,se.jsx)(H.Z,{description:E.formatMessage({id:"ticket.form.empty",defaultMessage:"暂无可用的工单表单"})})}):(0,se.jsxs)(_.Z,{title:E.formatMessage({id:"ticket.form.panel.title",defaultMessage:"工单表单"}),children:[(0,se.jsx)(L.Z,{style:{width:"100%",marginBottom:16},placeholder:E.formatMessage({id:"ticket.form.select.placeholder",defaultMessage:"请选择工单表单"}),value:i,onChange:function(e){c&&c(e)},options:o.map((function(e){return{label:e.name,value:e.uid,disabled:"PUBLISHED"!==e.status}}))}),P&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(G.Z,{orientation:"left",children:P.name}),P.description&&(0,se.jsx)("p",{style:{color:"#666",marginBottom:16},children:P.description}),b.length>0?(0,se.jsxs)(O.Z,{form:F,layout:"vertical",onFinish:R,style:{maxWidth:"100%"},children:[P&&b.length?(0,se.jsx)(se.Fragment,{children:b.map((function(e,t){return(0,se.jsx)(O.Z.Item,{name:"".concat(M).concat(e.id||"field-".concat(t)),label:N(e.label)||e.label,rules:[{required:e.required,message:E.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:N(e.label)||e.label})}],children:I(e)},e.id||"field-".concat(t))}))}):null,(0,se.jsx)(O.Z.Item,{children:(0,se.jsx)(d.ZP,{type:"primary",htmlType:"submit",loading:g,block:!0,children:E.formatMessage({id:"ticket.form.submit",defaultMessage:"提交表单"})})})]}):(0,se.jsx)(H.Z,{description:E.formatMessage({id:"ticket.form.fields.empty",defaultMessage:"该表单暂无字段配置"})})]})]})},de=a(31661),fe=a(2261),me=function(e){return e?e.trim().replace(/\s+/g," ").slice(0,100):""},pe=function(e){var t=e.visible,a=e.onClose,r=e.orgUid,o=e.workgroupUid,i=(0,p.useIntl)(),c=(0,de.Z)().translateString,u=T.A.useForm(),g=l()(u,1)[0],h=(0,m.useState)(!1),v=l()(h,2),k=v[0],M=v[1],x=(0,p.useModel)("@@initialState").initialState,y=(null!=x?x:{}).userInfo,b=(0,m.useMemo)((function(){return r||"df_org_uid"}),[r]),Z=(0,m.useMemo)((function(){return o||""}),[o]),j=(0,m.useState)(null),P=l()(j,2),C=P[0],S=P[1],F=(0,m.useState)(!1),E=l()(F,2),N=E[0],q=E[1],O=(0,m.useRef)(),W=(0,m.useMemo)((function(){var e,t,a=null!==(e=null==C?void 0:C.categorySettings)&&void 0!==e?e:null==C?void 0:C.draftCategorySettings;return null!=a&&null!==(t=a.items)&&void 0!==t&&t.length?a.items.filter((function(e){return Boolean(null==e?void 0:e.uid)&&!1!==(null==e?void 0:e.enabled)})).sort((function(e,t){var a,r;return(null!==(a=e.orderIndex)&&void 0!==a?a:0)-(null!==(r=t.orderIndex)&&void 0!==r?r:0)})):[]}),[C]),_=(0,m.useMemo)((function(){return W.map((function(e){return{label:c(e.name||""),value:e.uid}}))}),[W,c]),H=Boolean(null==C?void 0:C.customFormEnabled),L=(0,m.useMemo)((function(){var e;return null!==(e=null==C?void 0:C.form)&&void 0!==e?e:null==C?void 0:C.draftForm}),[C]),G=(0,m.useMemo)((function(){var e,t,a,r,n,o,s,i,l,c=null!==(e=null==C?void 0:C.basicSettings)&&void 0!==e?e:null==C?void 0:C.draftBasicSettings;return{showContactName:null===(t=null==c?void 0:c.showContactName)||void 0===t||t,requireContactName:null===(a=null==c?void 0:c.requireContactName)||void 0===a||a,showEmail:null===(r=null==c?void 0:c.showEmail)||void 0===r||r,requireEmail:null!==(n=null==c?void 0:c.requireEmail)&&void 0!==n&&n,showPhone:null===(o=null==c?void 0:c.showPhone)||void 0===o||o,requirePhone:null===(s=null==c?void 0:c.requirePhone)||void 0===s||s,showWechat:null!==(i=null==c?void 0:c.showWechat)&&void 0!==i&&i,requireWechat:null!==(l=null==c?void 0:c.requireWechat)&&void 0!==l&&l}}),[C]),J=(0,m.useMemo)((function(){if(!H||null==L||!L.schema)return[];try{var e=JSON.parse(L.schema);if(Array.isArray(e))return e;if(Array.isArray(null==e?void 0:e.schema))return e.schema;if(Array.isArray(null==e?void 0:e.fields))return e.fields;if(Array.isArray(null==e?void 0:e.content))return e.content}catch(e){console.error("ticket form schema parse error",e)}return[]}),[H,null==L?void 0:L.schema]),Q=(0,m.useCallback)((function(e,t){return(null==e?void 0:e.id)||(null==e?void 0:e.fieldId)||(null==e?void 0:e.key)||(null==e?void 0:e.name)||"field-".concat(t)}),[]),$=(0,m.useState)(!1),X=l()($,2),Y=X[0],ee=X[1],te=(0,m.useState)([]),ae=l()(te,2),re=ae[0],ne=ae[1],oe=(0,m.useMemo)((function(){return{contactName:(null==y?void 0:y.nickname)||(null==y?void 0:y.username)||"",email:(null==y?void 0:y.email)||"",phone:(null==y?void 0:y.mobile)||""}}),[y]),ie=(0,m.useCallback)(s()(n()().mark((function e(){var t;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&Z){e.next=3;break}return S(null),e.abrupt("return");case 3:return q(!0),e.prev=4,e.next=7,(0,D.bD)({orgUid:b,workgroupUid:Z,type:K.dCh});case 7:t=e.sent,w.Z.debug("getTicketSettingsByWorkgroup response:",null==t?void 0:t.data,b,Z),200===(null==t?void 0:t.code)&&null!=t&&t.data?S(t.data):(S(null),null!=t&&t.message&&w.Z.warn("getTicketSettingsByWorkgroup failed:",t.message)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),console.error("Fetch ticket settings error:",e.t0),S(null);case 16:return e.prev=16,q(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[4,12,16,19]])}))),[b,Z]);(0,m.useEffect)((function(){var e,t,a,r,n=O.current,o=null==C?void 0:C.uid;if(O.current=o,W.length){var s=g.getFieldValue("categoryUid");if(o!==n||!s||!W.some((function(e){return e.uid===s}))){var i=null!==(e=null==C?void 0:C.categorySettings)&&void 0!==e?e:null==C?void 0:C.draftCategorySettings,l=(null===(t=W.find((function(e){return e.uid===(null==i?void 0:i.defaultCategoryUid)})))||void 0===t?void 0:t.uid)||(null===(a=W.find((function(e){return e.defaultCategory})))||void 0===a?void 0:a.uid)||(null===(r=W[0])||void 0===r?void 0:r.uid);g.setFieldsValue({categoryUid:l||void 0})}}else g.setFieldsValue({categoryUid:void 0})}),[C,W,g,t]),(0,m.useEffect)((function(){if(t){g.setFieldsValue({status:K.sM_,priority:K.GMZ,departmentUid:K.zBg,assigneeUid:void 0});var e=localStorage.getItem("admin_ticketDraft");e&&g.setFieldValue("description",e)}}),[t,g]),(0,m.useEffect)((function(){if(t){var e=g.getFieldsValue(["contactName","email","phone"]),a={};!e.contactName&&oe.contactName&&(a.contactName=oe.contactName),!e.email&&oe.email&&(a.email=oe.email),!e.phone&&oe.phone&&(a.phone=oe.phone),Object.keys(a).length>0&&g.setFieldsValue(a)}}),[t,oe,g]),(0,m.useEffect)((function(){t&&b&&Z&&ie()}),[t,b,Z,ie]);var le=function(){var e=s()(n()().mark((function e(t){var r,o,s,l,c,u,d,m,p,h,v,k,x,j,P,F,E;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return z.yw.error(i.formatMessage({id:"ticket.create.org.missing",defaultMessage:"缺少组织信息，无法创建工单"})),e.abrupt("return",!1);case 3:if(Z){e.next=6;break}return z.yw.error(i.formatMessage({id:"ticket.create.workgroup.missing",defaultMessage:"缺少工作组信息，无法创建工单"})),e.abrupt("return",!1);case 6:return e.prev=6,M(!0),u=t.description||"",d=me(u),m=t.priority||K.GMZ,p=t.departmentUid&&t.departmentUid!==K.zBg?t.departmentUid:void 0,h=t.assigneeUid||void 0,v=Array.from(new Set((re||[]).map((function(e){return null==e?void 0:e.uid})).filter((function(e){return Boolean(e)})))),k=Boolean(H&&(null==L?void 0:L.uid)),x=k?new Set(J.map((function(e,t){return"dynamicField_".concat(Q(e,t))}))):new Set,j={},Object.keys(t).forEach((function(e){if(e.startsWith("dynamicField_")){if(k&&x.has(e)){var a=e.replace("dynamicField_","");j[a]=t[e]}delete t[e]}})),P=null,k&&null!=L&&L.uid&&(P={formUid:L.uid,formName:L.name,formSchema:L.schema,formData:j}),F={description:u,title:d,priority:m,status:K.sM_,level:K.Hxq,orgUid:b,workgroupUid:Z,departmentUid:p,assigneeUid:h,contactName:(null===(r=t.contactName)||void 0===r?void 0:r.trim())||"",email:(null===(o=t.email)||void 0===o?void 0:o.trim())||"",phone:(null===(s=t.phone)||void 0===s?void 0:s.trim())||"",wechat:(null===(l=t.wechat)||void 0===l?void 0:l.trim())||"",reporter:null==y?void 0:y.uid,categoryUid:t.categoryUid||void 0,uploadUids:v.length?v:void 0,schema:P?JSON.stringify(P):void 0,ticketSettingsUid:null==C?void 0:C.uid,processEntityUid:null==C||null===(c=C.process)||void 0===c?void 0:c.uid,formEntityUid:k?null==L?void 0:L.uid:void 0},e.next=23,(0,f.ax)(F);case 23:if(E=e.sent,w.Z.debug("createTicket response:",null==E?void 0:E.data,F),200!==(null==E?void 0:E.code)){e.next=34;break}return z.yw.success(i.formatMessage({id:"ticket.create.success",defaultMessage:"工单创建成功"})),g.resetFields(),localStorage.removeItem("admin_ticketDraft"),S(null),ne([]),ee(!1),a(!0),e.abrupt("return",!0);case 34:return z.yw.error((null==E?void 0:E.message)||i.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 38:return e.prev=38,e.t0=e.catch(6),console.error("Create ticket failed:",e.t0),z.yw.error(i.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 43:return e.prev=43,M(!1),e.finish(43);case 46:case"end":return e.stop()}}),e,null,[[6,38,43,46]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){g.resetFields(),S(null),ne([]),ee(!1),a()};return(0,se.jsxs)(I.Z,{title:i.formatMessage({id:"ticket.create.title",defaultMessage:"创建工单"}),placement:"right",onClose:ce,open:t,width:500,extra:(0,se.jsxs)(R.Z,{children:[(0,se.jsx)(d.ZP,{onClick:ce,children:i.formatMessage({id:"common.cancel",defaultMessage:"取消"})}),(0,se.jsx)(d.ZP,{type:"primary",onClick:function(){return g.submit()},loading:k||N,children:i.formatMessage({id:"common.confirm",defaultMessage:"确认"})})]}),children:[(0,se.jsxs)(T.A,{form:g,layout:"vertical",submitter:{render:!1},onFinish:le,initialValues:{status:K.sM_,priority:K.GMZ,departmentUid:K.zBg},children:[_.length>0&&(0,se.jsx)(A.Z,{name:"categoryUid",label:i.formatMessage({id:"ticket.category",defaultMessage:"问题分类"}),placeholder:i.formatMessage({id:"ticket.category.placeholder",defaultMessage:"请选择问题分类"}),options:_,rules:[{required:!0,message:i.formatMessage({id:"ticket.category.required",defaultMessage:"请选择问题分类"})}],fieldProps:{loading:N,showSearch:!0,optionFilterProp:"label"}}),H&&J.length>0&&(0,se.jsx)(ue,{fields:J,fieldNamePrefix:"dynamicField_",translate:c}),(0,se.jsx)(B.Z,{name:"description",label:i.formatMessage({id:"ticket.description",defaultMessage:"问题描述"}),placeholder:i.formatMessage({id:"ticket.description.placeholder",defaultMessage:"请详细描述您遇到的问题，以便我们更好地为您服务..."}),fieldProps:{rows:6,onBlur:function(){var e=g.getFieldValue("description");e&&localStorage.setItem("admin_ticketDraft",e)}},rules:[{required:!0,message:i.formatMessage({id:"ticket.description.required",defaultMessage:"请输入问题描述"})},{max:2e3,message:i.formatMessage({id:"ticket.description.maxlength",defaultMessage:"描述不能超过2000个字符"})}]}),G.showContactName&&(0,se.jsx)(V.Z,{name:"contactName",label:i.formatMessage({id:"ticket.contact.name",defaultMessage:"称呼"}),rules:G.requireContactName?[{required:!0,message:i.formatMessage({id:"ticket.contact.name.required",defaultMessage:"请输入称呼"})}]:[],placeholder:i.formatMessage({id:"ticket.contact.name.placeholder",defaultMessage:"请输入您的称呼"})}),G.showEmail&&(0,se.jsx)(V.Z,{name:"email",label:i.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),placeholder:i.formatMessage({id:"ticket.contact.email.placeholder",defaultMessage:"请输入邮箱地址"}),rules:[].concat(U()(G.requireEmail?[{required:!0,message:i.formatMessage({id:"ticket.contact.email.required",defaultMessage:"请输入邮箱地址"})}]:[]),[{type:"email",message:i.formatMessage({id:"ticket.contact.email.invalid",defaultMessage:"请输入有效的邮箱地址"})}])}),G.showPhone&&(0,se.jsx)(V.Z,{name:"phone",label:i.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),rules:G.requirePhone?[{required:!0,message:i.formatMessage({id:"ticket.contact.phone.required",defaultMessage:"请输入手机号码"})}]:[],placeholder:i.formatMessage({id:"ticket.contact.phone.placeholder",defaultMessage:"请输入手机号码"})}),G.showWechat&&(0,se.jsx)(V.Z,{name:"wechat",label:i.formatMessage({id:"ticket.contact.wechat",defaultMessage:"微信"}),rules:G.requireWechat?[{required:!0,message:i.formatMessage({id:"ticket.contact.wechat.required",defaultMessage:"请输入微信号"})}]:[],placeholder:i.formatMessage({id:"ticket.contact.wechat.placeholder",defaultMessage:"请输入您的微信号"}),extra:i.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})}),G.showPhone&&!G.showWechat&&(0,se.jsx)("div",{style:{marginTop:-16,marginBottom:16},children:(0,se.jsx)("span",{style:{color:"rgba(0, 0, 0, 0.45)",fontSize:12},children:i.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})})})]}),Y&&(0,se.jsx)(fe.Z,{type:K.hcJ,isModalOpen:Y,handleSubmit:function(e){ne((function(t){var a=new Map;return t.forEach((function(e){null!=e&&e.uid&&a.set(e.uid,e)})),(e||[]).forEach((function(e){null!=e&&e.uid&&a.set(e.uid,e)})),Array.from(a.values())})),ee(!1)},handleCancel:function(){return ee(!1)}})]})},ge="df_org_uid",he=function(){var e=(0,p.useIntl)(),t=c.Z.useApp(),a=t.message,r=t.modal,o=(0,p.useSearchParams)(),i=l()(o,2),P=i[0],C=i[1],S=P.get("status")||"todo",F=(0,m.useState)(S),q=l()(F,2),U=q[0],I=q[1],R=(0,m.useState)(!1),T=l()(R,2),A=T[0],B=T[1],V=(0,m.useRef)(),z=(0,m.useRef)(!1),D=(0,b.OJ)(),O=(0,j.Z)().isDarkMode,W=(0,m.useState)(null),_=l()(W,2),H=_[0],L=_[1],G=(0,m.useState)(!1),J=l()(G,2),Q=(J[0],J[1]),$=(0,p.useModel)("@@initialState").initialState,X=(null!=$?$:{}).userInfo;(0,m.useEffect)((function(){if(null==$||!$.userInfo){p.history.push("/auth/login?redirect=".concat(encodeURIComponent("/ticket-center")))}}),[$]),(0,m.useEffect)((function(){I(S)}),[S]);var Y=(0,m.useCallback)((function(){"undefined"!=typeof window&&window.history.length>1?p.history.back():p.history.push("/")}),[p.history]),ee=(0,m.useCallback)((function(t,a){r.warning({title:e.formatMessage({id:"ticket.center.disabled.title",defaultMessage:"SuperTicket 未启用"}),content:e.formatMessage({id:t,defaultMessage:a}),okText:e.formatMessage({id:"common.ok",defaultMessage:"确定"}),cancelButtonProps:{style:{display:"none"}},maskClosable:!1,closable:!1,keyboard:!1,onOk:Y})}),[Y,e,r]);(0,m.useEffect)((function(){if(D){var t=function(){var t=s()(n()().mark((function t(){var r,o,s;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Q(!0),t.prev=1,t.next=4,(0,Z.sc)();case 4:r=t.sent,w.Z.debug("平台工单中心配置:",null==r?void 0:r.data),200===(null==r?void 0:r.code)&&null!=r&&r.data&&(s=!1!==(null==r||null===(o=r.data)||void 0===o?void 0:o.ticketCenterEnabled),L({workgroupUid:null==r?void 0:r.data.workgroupUid,ticketCenterEnabled:s,description:null==r?void 0:r.data.description}),s||z.current||(z.current=!0,ee("ticket.center.disabled.desc","请联系管理员启用 SuperTicket 后再访问此页面。"))),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.error("加载平台工单中心配置失败:",t.t0),a.error(e.formatMessage({id:"ticket.center.settings.load.failed",defaultMessage:"加载平台工单中心配置失败"}));case 13:return t.prev=13,Q(!1),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,9,13,16]])})));return function(){return t.apply(this,arguments)}}();t()}else z.current||(z.current=!0,ee("ticket.center.disabled.no.permission","当前版本无法访问 SuperTicket，请联系管理员升级或启用。"))}),[D,Y,e,a,r]);var te,ae,re={NEW:{text:e.formatMessage({id:"ticket.status.new",defaultMessage:"新建"}),status:"Default"},OPEN:{text:e.formatMessage({id:"ticket.status.open",defaultMessage:"处理中"}),status:"Processing"},PENDING:{text:e.formatMessage({id:"ticket.status.pending",defaultMessage:"待处理"}),status:"Warning"},RESOLVED:{text:e.formatMessage({id:"ticket.status.resolved",defaultMessage:"已解决"}),status:"Success"},CLOSED:{text:e.formatMessage({id:"ticket.status.closed",defaultMessage:"已关闭"}),status:"Default"}},ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",align:"center",search:!1},{title:e.formatMessage({id:"ticket.number",defaultMessage:"工单编号"}),dataIndex:"ticketNumber",key:"ticketNumber",width:150},{title:e.formatMessage({id:"ticket.description",defaultMessage:"描述"}),dataIndex:"description",key:"description",ellipsis:!0},{title:e.formatMessage({id:"ticket.status",defaultMessage:"状态"}),dataIndex:"status",key:"status",width:100,valueType:"select",valueEnum:re,render:function(t,a){return r=a.status,n={NEW:{color:"blue",text:e.formatMessage({id:"ticket.status.new",defaultMessage:"新建"})},OPEN:{color:"green",text:e.formatMessage({id:"ticket.status.open",defaultMessage:"处理中"})},PENDING:{color:"orange",text:e.formatMessage({id:"ticket.status.pending",defaultMessage:"待处理"})},RESOLVED:{color:"cyan",text:e.formatMessage({id:"ticket.status.resolved",defaultMessage:"已解决"})},CLOSED:{color:"default",text:e.formatMessage({id:"ticket.status.closed",defaultMessage:"已关闭"})}}[r]||{color:"default",text:r},(0,se.jsx)(u.Z,{color:n.color,children:n.text});var r,n}},{title:e.formatMessage({id:"ticket.contact.name",defaultMessage:"联系人"}),dataIndex:"contactName",key:"contactName",width:120,search:!1},{title:e.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),dataIndex:"email",key:"email",width:150,search:!1},{title:e.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),dataIndex:"phone",key:"phone",width:120,search:!1},{title:e.formatMessage({id:"ticket.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",key:"createdAt",width:180,search:!1}],oe=[{path:"/ticket-list",name:e.formatMessage({id:"ticket.list",defaultMessage:"工单列表"}),icon:(0,se.jsx)(E,{})}];return(0,se.jsxs)(g.f,{title:(te=(0,b.nt)(),ae=(0,b.ye)(),te&&ae?ae:e.formatMessage({id:"app.title"})),logo:(0,b.do)(),layout:"mix",fixedHeader:!0,fixSiderbar:!0,splitMenus:!1,navTheme:O?"realDark":"light",route:{path:"/",routes:oe},location:{pathname:"/".concat(U)},menuItemRender:function(e,t){return(0,se.jsx)("div",{onClick:function(){var t,a,r=null===(t=e.path)||void 0===t?void 0:t.replace("/","");r&&(a={key:r}.key,I(a),C({status:a}))},children:t})},actionsRender:function(){return[(0,se.jsx)(k.Z,{},"fullScreen"),(0,se.jsx)(y.Z,{},"trialTip"),(0,se.jsx)(x.Z,{},"GotoGithub"),!1,(0,se.jsx)(M.Z,{},"GotoAgent")]},avatarProps:{src:null==X?void 0:X.avatar,title:(0,se.jsx)(v.gj,{}),render:function(e,t){return(0,se.jsx)(v.Kd,{menu:!0,children:t})}},footerRender:function(){return(0,se.jsx)(v.$_,{})},contentStyle:{margin:0,padding:0,background:O?"#141414":"#f0f2f5"},children:[(0,se.jsx)(h.Z,{actionRef:V,columns:ne,rowKey:"uid",style:{padding:10},request:function(){var t=s()(n()().mark((function t(r){var o,s;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={pageNumber:(r.current||1)-1,pageSize:r.pageSize||20,orgUid:ge,ticketNumber:r.ticketNumber||void 0,level:K.Hxq},t.next=4,(0,f.N2)(o);case 4:if(s=t.sent,w.Z.debug("工单列表数据:",s.data,o),200!==(null==s?void 0:s.code)||null==s||!s.data){t.next=10;break}return t.abrupt("return",{data:(null==s?void 0:s.data.content)||[],success:!0,total:(null==s?void 0:s.data.totalElements)||0});case 10:a.error(e.formatMessage({id:"ticket.list.load.failed",defaultMessage:"加载工单列表失败"}));case 11:return t.abrupt("return",{data:[],success:!1,total:0});case 14:return t.prev=14,t.t0=t.catch(0),console.error("加载工单列表失败:",t.t0),a.error(e.formatMessage({id:"ticket.list.load.failed",defaultMessage:"加载工单列表失败"})),t.abrupt("return",{data:[],success:!1,total:0});case 19:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e){return t.apply(this,arguments)}}(),search:{labelWidth:"auto"},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:function(t){return e.formatMessage({id:"pages.table.total",defaultMessage:"共 {total} 条"},{total:t})}},toolBarRender:function(){return[(0,se.jsx)(d.ZP,{type:"primary",icon:(0,se.jsx)(N.Z,{}),onClick:function(){return B(!0)},children:e.formatMessage({id:"ticket.create",defaultMessage:"创建工单"})},"create")]}}),(0,se.jsx)(pe,{visible:A,onClose:function(e){var t;(B(!1),e)&&(null===(t=V.current)||void 0===t||t.reload())},orgUid:ge,workgroupUid:null==H?void 0:H.workgroupUid})]})},ve=function(){return(0,se.jsx)(c.Z,{children:(0,se.jsx)(he,{})})}},42183:function(e,t,a){a.d(t,{j:function(){return d}});var r=a(73193),n=a.n(r),o=a(76711),s=a.n(o),i=a(36265),l=a(74543),c=a(21152),u=a(72083),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var a=e.kbaseResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var a;e({kbaseResult:t}),(null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(a){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===a.uid}));if(-1!==o){var i=[].concat(s()(r.slice(0,o)),[a],s()(r.slice(o+1))),l=n()(n()({},t().kbaseResult),{},{data:{content:i}});e({kbaseResult:l,currentKbase:a})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:a})},removeKbase:function(a){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===a}));-1!==o?e({kbaseResult:n()(n()({},t().kbaseResult),{},{data:{content:[].concat(s()(r.slice(0,o)),s()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",a),t().currentKbase.uid===a&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))}}]);