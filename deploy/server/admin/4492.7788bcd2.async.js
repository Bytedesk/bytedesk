"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4492],{28031:function(e,t,a){a.d(t,{Z:function(){return d}});var s=a(83910),r=a(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},n=a(5901),i=function(e,t){return r.createElement(n.Z,(0,s.Z)({},e,{ref:t,icon:o}))};var d=r.forwardRef(i)},94492:function(e,t,a){a.d(t,{Z:function(){return B}});var s=a(84176),r=a.n(s),o=a(73193),n=a.n(o),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),p=a(45332),f=a.n(p),m=a(61489),h=a(99754),x=a(77686),M=a(68992),w=a(87005),k=a(91768),y=a(28031),v=a(80503),j=a(54596),b=a(62395),T=a(69650),S=a(72264),F=a(97184),Z=a(33633),C=a(77902),I=a(66248),A=a(6237),E=a(44194);function P(e){return R.apply(this,arguments)}function R(){return(R=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/robot/message/query/org",{method:"GET",params:n()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=a(74039),N=a(70097),U=a(62134),z=a(31549),q=["current","pageSize"],_={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},B=function(e){var t=e.superUser,a=(0,b.useIntl)(),s=(0,N.Z)().isDarkMode,o=(0,E.useRef)(),i=(0,h.Z)().translateString,l=(0,x.u)((function(e){return e.currentOrg})),u=(0,E.useState)(1),p=f()(u,2),R=p[0],B=p[1],L=(0,E.useState)(10),H=f()(L,2),O=H[0],G=H[1],V=(0,E.useState)([]),K=f()(V,2),W=K[0],Q=K[1],J=(0,E.useState)([]),Y=f()(J,2),X=Y[0],$=Y[1],ee=(0,E.useState)(0),te=f()(ee,2),ae=te[0],se=te[1],re=(0,E.useState)({}),oe=f()(re,2),ne=oe[0],ie=oe[1],de=(0,E.useState)(!1),le=f()(de,2),ce=le[0],ue=le[1],ge=(0,E.useState)(""),pe=f()(ge,2),fe=pe[0],me=pe[1],he=(0,E.useState)(!1),xe=f()(he,2),Me=xe[0],we=xe[1],ke=(0,E.useState)(""),ye=f()(ke,2),ve=ye[0],je=ye[1],be=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,z.jsx)(b.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,z.jsx)(b.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,z.jsx)(z.Fragment,{children:i(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,z.jsx)(b.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var a;return(0,z.jsx)(z.Fragment,{children:i(null==t||null===(a=t.robot)||void 0===a?void 0:a.nickname)})}},{title:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.prompt",defaultMessage:"Prompt"}),dataIndex:"prompt",hideInSearch:!0,width:250,ellipsis:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.prompt.tooltip"}),render:function(e,t){var s=t.prompt;return s?s.length>50?(0,z.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Se(s)},children:[(0,z.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[s.substring(0,50),"..."]}),(0,z.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Se(s)},children:a.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,z.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:s}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,z.jsx)(b.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.answer.tooltip"}),render:function(e,t){var s=t.answer;return s?s.length>100?(0,z.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Fe(s)},children:[(0,z.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[s.substring(0,100),"..."]}),(0,z.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Fe(s)},children:a.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,z.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:s}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"message.status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.status.tooltip"}),render:function(e,t){return(0,D.ng)(null==t?void 0:t.status)}},{title:(0,z.jsx)(b.FormattedMessage,{id:"message.channel",defaultMessage:"Channel"}),dataIndex:"channel",width:100,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.channel.tooltip"}),render:function(e,t){return(0,D.YG)(t.channel)}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.unanswered",defaultMessage:"未回答"}),dataIndex:"isUnAnswered",width:120,hideInSearch:!0,valueType:"select",valueEnum:{true:{text:"未回答",status:"Error"},false:{text:"已回答",status:"Success"}},tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.isUnAnswered.tooltip"}),render:function(e,t){var a=t.isUnAnswered;return null==a?"-":(0,z.jsx)(F.Z,{status:a?"error":"success",text:a?"未回答":"已回答"})}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.tokens.prompt",defaultMessage:"Prompt Tokens"}),dataIndex:"promptTokens",width:160,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.promptTokens.tooltip"}),render:function(e,t){var a=t.promptTokens;return a?(0,z.jsx)(Z.Z,{color:"blue",children:a}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.tokens.completion",defaultMessage:"Completion Tokens"}),dataIndex:"completionTokens",width:160,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.completionTokens.tooltip"}),render:function(e,t){var a=t.completionTokens;return a?(0,z.jsx)(Z.Z,{color:"green",children:a}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.tokens.total",defaultMessage:"Total Tokens"}),dataIndex:"totalTokens",width:140,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.totalTokens.tooltip"}),render:function(e,t){var a=t.totalTokens;return a?(0,z.jsx)(Z.Z,{color:"orange",children:a}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.provider",defaultMessage:"AI Provider"}),dataIndex:"aiProvider",width:120,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.aiProvider.tooltip"}),render:function(e,t){var a=t.aiProvider;return a?(0,z.jsx)(Z.Z,{color:"purple",children:a}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"ai.model",defaultMessage:"AI Model"}),dataIndex:"aiModel",width:120,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.aiModel.tooltip"}),render:function(e,t){var a=t.aiModel;return a?(0,z.jsx)(Z.Z,{color:"cyan",children:a}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,valueType:"select",valueEnum:{RATE_PENDING:{text:"待评价",status:"Default"},RATE_UP:{text:"点赞",status:"Success"},RATE_DOWN:{text:"点踩",status:"Error"},RATE_FEEDBACK:{text:"反馈意见",status:"Warning"},RATE_TRANSFER:{text:"转人工",status:"Processing"}},tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=_[a]||{text:a,color:"default"};return(0,z.jsx)(Z.Z,{color:s.color,children:s.text||a})}},{title:(0,z.jsx)(b.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,z.jsx)(z.Fragment,{children:t.rateDownTagList.map((function(e){return(0,z.jsx)(Z.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,z.jsx)(b.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,z.jsx)(b.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,z.jsx)(b.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,r){return[(0,z.jsx)("a",{onClick:function(){Te(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,z.jsx)(C.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return Ze(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,z.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],Te=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==l?void 0:l.uid,t:M.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Se=function(e){me(e),ue(!0)},Fe=function(e){je(e),we(!0)},Ze=function(){var e=g()(c()().mark((function e(t){var s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==o||null===(s=o.current)||void 0===s||s.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){var e=g()(c()().mark((function e(){var t,s,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==X.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,r=d()(X);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}m.yw.destroy(),0===s?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),Q([]),$([]),null===(t=o.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=g()(c()().mark((function e(t,a,s){var r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),r=localStorage.getItem(M.LA8),o=n()({orgUid:(null==l?void 0:l.uid)||"",accessToken:r||"",exportType:t},ne),"current"===t?(o.pageNumber=String(R-1),o.pageSize=String(O)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,w.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),Ae=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=o,r=o*a+1,n=Math.min((o+1)*a,e);t.push({key:"export-".concat(o),label:"".concat(r,"-").concat(n," (").concat(n-r+1,"条)"),onClick:function(){return Ie("range",s,a)}})},o=0;o<s;o++)r();return t},Ee={selectedRowKeys:W,onChange:function(e,t){Q(e),$(t)}};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.Z,{columns:be,actionRef:o,cardBordered:!0,rowSelection:Ee,scroll:{x:3e3},request:function(){var e=g()(c()().mark((function e(a,s,o){var n,i,d,u,g,p,f,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,s,o),n=a.current,i=a.pageSize,d=r()(a,q),B(n),G(i),ie(d),u=void 0,g=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],u=p,g="ascend"===s[p]?"ascend":"descend"),f={pageNumber:n-1,pageSize:i,orgUid:null==l?void 0:l.uid,superUser:t,topic:d.topic,threadUid:d.threadUid,userNickname:d.userNickname,robotNickname:d.robotNickname,status:d.status,answer:d.answer,user:d.user,robot:d.robot,isUnAnswered:d.isUnAnswered,promptTokens:d.promptTokens,completionTokens:d.completionTokens,totalTokens:d.totalTokens,aiProvider:d.aiProvider,aiModel:d.aiModel,threads:d.threads,componentType:d.componentType,sortBy:u,sortDirection:g},e.next=11,P(f);case 11:return h=e.sent,console.log("getAllRobotMessages response:",f,h),200===h.code?se(h.data.totalElements):m.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return function(){var e=[],t=[];W.length>0&&t.push({key:"batchDelete",icon:(0,z.jsx)(k.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){I.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:Ce,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,z.jsx)(y.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ie("current")}}];return ae>0&&(ae<=1e3?s.push({key:"export-all",icon:(0,z.jsx)(y.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ae,"条)"),onClick:function(){return Ie("all")}}):s.push({key:"export-range",icon:(0,z.jsx)(y.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ae,"条)"),children:Ae(ae)})),e.push((0,z.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,z.jsxs)(S.ZP,{icon:(0,z.jsx)(y.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,z.jsx)(v.Z,{})]},"button")},"export")),t.length>0&&e.push((0,z.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,z.jsxs)(S.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,z.jsx)(v.Z,{})]})},"batchOperations")),e}()}}),(0,z.jsx)(I.Z,{title:a.formatMessage({id:"prompt.detail",defaultMessage:"Prompt Details"}),open:ce,onCancel:function(){return ue(!1)},footer:[(0,z.jsx)(S.ZP,{onClick:g()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.TE)(fe);case 2:e.sent.success?m.yw.success(a.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"})):m.yw.error(a.formatMessage({id:"copy.failed",defaultMessage:"Copy failed"}));case 4:case"end":return e.stop()}}),e)}))),children:a.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,z.jsx)(S.ZP,{onClick:function(){return ue(!1)},children:a.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,z.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,z.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:s?"#1f1f1f":"#f5f5f5",color:s?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(s?"#434343":"#d9d9d9")},children:fe})})}),(0,z.jsx)(I.Z,{title:a.formatMessage({id:"answer.detail",defaultMessage:"Answer Details"}),open:Me,onCancel:function(){return we(!1)},footer:[(0,z.jsx)(S.ZP,{onClick:g()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.TE)(ve);case 2:e.sent.success?m.yw.success(a.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"})):m.yw.error(a.formatMessage({id:"copy.failed",defaultMessage:"Copy failed"}));case 4:case"end":return e.stop()}}),e)}))),children:a.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,z.jsx)(S.ZP,{onClick:function(){return we(!1)},children:a.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,z.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,z.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:s?"#1f1f1f":"#f5f5f5",color:s?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(s?"#434343":"#d9d9d9")},children:ve})})})]})}}}]);