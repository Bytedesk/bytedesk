"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3606],{24599:function(e,n,t){t.d(n,{Jr:function(){return f},LF:function(){return d},Oh:function(){return y},WS:function(){return h}});var r=t(90819),i=t.n(r),a=t(73193),o=t.n(a),l=t(89933),s=t.n(l),u=t(36265),c=t(5861);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return g.apply(this,arguments)}function g(){return(g=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},53283:function(e,n,t){t.d(n,{G9:function(){return S},J$:function(){return M},N6:function(){return w},VM:function(){return d},c8:function(){return f},gF:function(){return y},rg:function(){return h},sF:function(){return x}});var r=t(90819),i=t.n(r),a=t(73193),o=t.n(a),l=t(89933),s=t.n(l),u=t(36265),c=t(5861);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return g.apply(this,arguments)}function g(){return(g=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return T.apply(this,arguments)}function T(){return(T=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3771:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return y},t5:function(){return h},v_:function(){return f}});var r=t(90819),i=t.n(r),a=t(73193),o=t.n(a),l=t(89933),s=t.n(l),u=t(36265),c=t(5861);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return g.apply(this,arguments)}function g(){return(g=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},81621:function(e,n,t){var r=t(10154),i=t.n(r),a=t(73193),o=t.n(a),l=t(90819),s=t.n(l),u=t(89933),c=t.n(u),d=t(45332),p=t.n(d),f=t(5286),m=t(24599),h=t(53283),v=t(31661),y=t(36265),g=t(50022),x=t(37351),b=t(22060),w=t(99759),k=t(76185),S=t(98162),j=t(2157),M=t(19095),T=t(73120),C=t(5861),Z=t(44194),P=t(74494),q=t(14267),J=t(31549),L=x.Z.Text,U=Z.memo((function(e){var n,t=e.visible,r=e.onCancel,a=e.onOk,l=e.initialProvider,u=e.initialModel,d=e.initialModelLabel,U=e.providers,O=e.currentOrgUid,X=e.existingProviderModels,E=void 0===X?{}:X,G=e.onModelsLoaded,F=e.allowedModelTypes,I=void 0===F?[]:F,z=(0,C.useIntl)(),A=(0,P.Z)().isDarkMode,B=(0,v.Z)().translateString,D=(0,Z.useState)(l||""),H=p()(D,2),N=H[0],R=H[1],Y=(0,Z.useState)(E),_=p()(Y,2),V=_[0],W=_[1],$=(0,Z.useState)(l||""),K=p()($,2),Q=K[0],ee=K[1],ne=(0,Z.useState)(u||""),te=p()(ne,2),re=te[0],ie=te[1],ae=(0,Z.useState)(d||""),oe=p()(ae,2),le=oe[0],se=oe[1],ue=(0,Z.useState)(!1),ce=p()(ue,2),de=ce[0],pe=ce[1],fe=(0,Z.useState)(!1),me=p()(fe,2),he=me[0],ve=me[1];(0,Z.useEffect)((function(){ee(l),ie(u),se(d);var e=l;if(l){var n=U.find((function(e){return e.type===l})),t=U.find((function(e){return e.uid===l}));n&&!t&&(e=n.uid)}R(e),ve(!1)}),[l,u,d,t,U]),(0,Z.useEffect)((function(){if(t&&N&&!V[N]&&!de){pe(!0),f.yw.loading({content:z.formatMessage({id:"loading"}),key:"modelLoading"});var e=U.find((function(e){return e.uid===N}));e&&(e.type===y.CZ7?we(e):Se(e))}}),[t,N,U]);var ye=(0,Z.useCallback)((function(){Q&&re&&a(Q,re,le)}),[Q,re,le,a]),ge=(0,Z.useCallback)((function(){r(),C.history.push("/ai/model")}),[r]),xe=(0,Z.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(n){return e.toLowerCase().includes(n.toLowerCase())}))}),[]),be=(0,Z.useCallback)((function(e){return e?e.filter((function(e){return!xe(e.value)&&(!I||0===I.length||(!e.type||I.includes(e.type)))})):[]}),[I,xe]),we=function(){var e=c()(s()().mark((function e(n){var t,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={baseUrl:null==n?void 0:n.baseUrl},e.next=4,(0,h.VM)(t);case 4:r=e.sent,console.log("getOllamaServerStatus:",r,t),200===r.code&&null!=r&&r.data?(ve(!0),ke(n)):(ve(!1),f.yw.destroy("modelLoading"),pe(!1)),e.next=15;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),ve(!1),f.yw.destroy("modelLoading"),pe(!1);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}(),ke=function(){var e=c()(s()().mark((function e(n){var t,r,a,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={baseUrl:null==n?void 0:n.baseUrl},e.next=4,(0,h.c8)(t);case 4:r=e.sent,console.log("getOllamaLocalModels:",null==r?void 0:r.data,t),200===r.code?(a=null==r?void 0:r.data.map((function(e){return{value:e.name,label:e.name,providerName:n.uid}})),l=be(a),W((function(e){return o()(o()({},e),{},i()({},n.uid,l))})),G&&G(n.uid,l)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),f.yw.error(z.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),pe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(n){return e.apply(this,arguments)}}(),Se=function(){var e=c()(s()().mark((function e(n){var t,r,a,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",enabled:!0,providerUid:null==n?void 0:n.uid,orgUid:O,level:y.whQ},e.next=4,(0,m.LF)(t);case 4:r=e.sent,console.log("queryLlmModelsByOrg:",null==r?void 0:r.data,t),200===r.code?(a=null==r?void 0:r.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:n.uid}})),l=be(a),W((function(e){return o()(o()({},e),{},i()({},n.uid,l))})),G&&G(n.uid,l)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),f.yw.error(z.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),pe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(n){return e.apply(this,arguments)}}(),je=(0,Z.useCallback)((function(e,n){ee(e),ie(n.value),se(n.label)}),[]),Me=(0,Z.useCallback)((function(e){if(R(e),!V[e]&&!de){pe(!0),f.yw.loading({content:z.formatMessage({id:"loading"}),key:"modelLoading"});var n=U.find((function(n){return n.uid===e}));n&&("ollama"===n.type?we(n):Se(n))}}),[U,V,de]),Te=Z.memo((function(e){var n=e.model,t=e.providerUid;return(0,J.jsxs)(b.Z,{hoverable:!0,style:{cursor:"pointer",border:re===n.value&&Q===t?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return je(t,n)},children:[(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,J.jsx)(x.Z.Title,{level:5,style:{margin:0},children:n.label}),(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[n.type&&(0,J.jsx)("div",{style:{marginBottom:8},children:(0,g.Rb)(n.type)}),re===n.value&&Q===t&&(0,J.jsx)(w.Z,{status:"processing",text:z.formatMessage({id:"ai.modelSelection.selected"})})]})]}),n.description&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(x.Z.Text,{type:"secondary",children:null==n?void 0:n.value}),(0,J.jsx)(x.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:n.description})]})]},n.value)}),(function(e,n){return e.model.value===n.model.value&&e.providerUid===n.providerUid&&(re===e.model.value&&Q===e.providerUid)===(re===n.model.value&&Q===n.providerUid)})),Ce=(0,Z.useMemo)((function(){return U.filter((function(e){return!q.ju.includes(e.type)})).map((function(e){var n,t;return{key:e.uid,label:B(e.nickname),children:(0,J.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,J.jsxs)(k.Z,{direction:"vertical",style:{width:"100%"},children:["ollama"===e.type&&!he&&(0,J.jsx)(S.Z,{message:z.formatMessage({id:"ai.ollama.notRunning"}),type:"error",showIcon:!0,style:{marginBottom:"16px"}}),de&&N===e.uid&&!V[e.uid]?(0,J.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,J.jsx)(L,{type:"secondary",children:z.formatMessage({id:"ai.modelSelection.loading"})})}):V[e.uid]&&0!==(null===(n=V[e.uid])||void 0===n?void 0:n.length)?null:(0,J.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,J.jsx)(L,{type:"secondary",style:{display:"block",marginBottom:"16px"},children:z.formatMessage({id:"ai.modelSelection.noModels"})}),(0,J.jsx)(j.ZP,{type:"link",onClick:ge,style:{padding:0,height:"auto",fontSize:"14px",color:"#1890ff"},children:z.formatMessage({id:"ai.modelSelection.addModelTip"})})]}),(0,J.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(t=V[e.uid])||void 0===t?void 0:t.map((function(n){return(0,J.jsx)(Te,{model:n,providerUid:e.uid},n.value)}))})]})})}}))}),[U,V,N,de,re,Q,B,he]);return(0,J.jsx)(M.Z,{title:z.formatMessage({id:"ai.modelSelection.title"}),open:t,onClose:r,width:700,destroyOnHidden:!1,footer:(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:A?"#262626":"#f6f8fa",borderRadius:"6px",border:A?"1px solid #434343":"1px solid #e1e4e8"},children:[(0,J.jsx)(L,{type:"secondary",style:{fontSize:"14px",marginRight:"8px"},children:z.formatMessage({id:"ai.modelSelection.cannotFindModel"})}),(0,J.jsx)(j.ZP,{type:"link",onClick:ge,style:{padding:0,height:"auto",fontSize:"14px"},children:z.formatMessage({id:"ai.modelSelection.addNewModel"})})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)(j.ZP,{onClick:r,style:{marginRight:8},children:z.formatMessage({id:"ai.modelSelection.cancel"})}),(0,J.jsx)(j.ZP,{onClick:ye,type:"primary",children:z.formatMessage({id:"ai.modelSelection.confirm"})})]})]}),children:U.length>0?(0,J.jsx)(T.Z,{activeKey:N||(null===(n=U.filter((function(e){return!q.ju.includes(e.type)}))[0])||void 0===n?void 0:n.uid),onChange:Me,items:Ce,destroyOnHidden:!1}):(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center"},children:[(0,J.jsx)(L,{type:"secondary",style:{fontSize:"16px",marginBottom:"16px"},children:z.formatMessage({id:"ai.modelSelection.noProviders"})}),(0,J.jsx)(L,{type:"secondary",style:{fontSize:"14px",marginBottom:"24px"},children:z.formatMessage({id:"ai.modelSelection.noProvidersTip"})}),(0,J.jsx)(j.ZP,{type:"primary",onClick:ge,style:{fontSize:"14px"},children:z.formatMessage({id:"ai.modelSelection.goToProviders"})})]})})}),(function(e,n){return e.visible===n.visible&&e.initialProvider===n.initialProvider&&e.initialModel===n.initialModel&&e.initialModelLabel===n.initialModelLabel}));n.Z=U},59878:function(e,n,t){t.d(n,{G:function(){return f}});var r=t(73193),i=t.n(r),a=(t(44194),t(41770)),o=t(36265),l=t(96596),s=t.n(l),u=t(42539),c=t(5286),d=t(87523),p=t(31549),f=function(e){var n=e.children,t=e.onSuccess,r=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},f={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var n=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=n,l.fileType=e.type,u.Z.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var n,i=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;t(i),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,p.jsx)(a.Z,i()(i()({},f),{},{children:n}))}},76071:function(e,n,t){var r=t(74494);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}}}]);