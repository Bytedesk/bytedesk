"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9107],{89965:function(e,t,r){var n=r(32906),s=r(94433),a=r(38956),i=r(81424),o=r(41196),l=r(63924),c=r(34573),d=r(44194),u=r(35074),f=r(31549),p=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",v=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,n.Z)(t,2),a=r[0],c=r[1];return(0,f.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,n=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,s.Z)((0,s.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return c(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,n),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:a,children:e.children}))}})},h=function(e){var t=e.fieldProps,r=e.proFieldProps,n=(0,a.Z)(e,p);return(0,f.jsx)(u.Z,(0,s.Z)({valueType:m,fieldProps:t,filedConfig:{valueType:m},proFieldProps:r},n))};h.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,i=(0,a.Z)(e,g),o=(0,d.useState)(!1),l=(0,n.Z)(o,2),p=l[0],h=l[1];return null!=t&&t.statusRender&&i.name?(0,f.jsx)(v,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:h,children:(0,f.jsx)("div",{children:(0,f.jsx)(u.Z,(0,s.Z)({valueType:"password",fieldProps:(0,s.Z)((0,s.Z)({},(0,c.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),h(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),h(!0)}}),proFieldProps:r,filedConfig:{valueType:m}},i))})}):(0,f.jsx)(u.Z,(0,s.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:m}},i))},h.displayName="ProFormComponent",t.Z=h},59206:function(e,t,r){r.r(t),r.d(t,{default:function(){return V}});var n=r(45332),s=r.n(n),a=r(67738),i=r(82770),o=r(40110),l=r(44194),c=r(14906),d=r(12074),u=r(97234),f=r(84974),p=r(21559),g=r(59247),m=r(71205),v=(r(28099),r(61930)),h=r(5932),x=r(83910),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},k=r(54183),y=function(e,t){return l.createElement(k.Z,(0,x.Z)({},e,{ref:t,icon:M}))};var Z=l.forwardRef(y),j=r(10162),P=r(90819),b=r.n(P),C=r(89933),w=r.n(C),F=r(82864),S=r(39487),T=r(25784),I=r(80953),R=r(89965),_=r(19433),z=r(65297),B=r(98830),G=r(39497),E=r(31549),U=function(e){var t=e.visible,r=e.onClose,n=e.orgUid,a=(0,c.useIntl)(),o=T.A.useForm(),d=s()(o,1)[0],u=(0,l.useState)(!1),f=s()(u,2),p=f[0],g=f[1],m=(0,B.u)((function(e){return e.currentOrg})),v=(0,l.useMemo)((function(){return n||(null==m?void 0:m.uid)||""}),[n,null==m?void 0:m.uid]);(0,l.useEffect)((function(){if(t){d.setFieldsValue({status:G.sM_,priority:G.GMZ});var e=localStorage.getItem("admin_ticketDraft");e&&d.setFieldValue("description",e)}}),[t,d]);var h=function(){var e=w()(b()().mark((function e(t){var n,s;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=3;break}return _.yw.error(a.formatMessage({id:"ticket.create.org.missing",defaultMessage:"缺少组织信息，无法创建工单"})),e.abrupt("return",!1);case 3:return e.prev=3,g(!0),n={description:t.description||"",priority:G.GMZ,status:G.sM_,orgUid:v,schema:void 0},e.next=8,(0,z.ax)(n);case 8:if(200!==(null==(s=e.sent)?void 0:s.code)){e.next=15;break}return _.yw.success(a.formatMessage({id:"ticket.create.success",defaultMessage:"工单创建成功"})),d.resetFields(),localStorage.removeItem("admin_ticketDraft"),r(!0),e.abrupt("return",!0);case 15:return _.yw.error((null==s?void 0:s.message)||a.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 19:return e.prev=19,e.t0=e.catch(3),console.error("Create ticket failed:",e.t0),_.yw.error(a.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 24:return e.prev=24,g(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[3,19,24,27]])})));return function(t){return e.apply(this,arguments)}}(),x=function(){d.resetFields(),r()};return(0,E.jsx)(F.Z,{title:a.formatMessage({id:"ticket.create.title",defaultMessage:"创建工单"}),placement:"right",onClose:x,open:t,width:500,extra:(0,E.jsxs)(S.Z,{children:[(0,E.jsx)(i.ZP,{onClick:x,children:a.formatMessage({id:"common.cancel",defaultMessage:"取消"})}),(0,E.jsx)(i.ZP,{type:"primary",onClick:function(){return d.submit()},loading:p,children:a.formatMessage({id:"common.confirm",defaultMessage:"确认"})})]}),children:(0,E.jsxs)(T.A,{form:d,layout:"vertical",submitter:{render:!1},onFinish:h,initialValues:{status:G.sM_,priority:G.GMZ},children:[(0,E.jsx)(I.Z,{name:"description",label:a.formatMessage({id:"ticket.description",defaultMessage:"问题描述"}),placeholder:a.formatMessage({id:"ticket.description.placeholder",defaultMessage:"请详细描述您遇到的问题..."}),fieldProps:{rows:6,onBlur:function(){var e=d.getFieldValue("description");e&&localStorage.setItem("admin_ticketDraft",e)}},rules:[{required:!0,message:a.formatMessage({id:"ticket.description.required",defaultMessage:"请输入问题描述"})},{max:2e3,message:a.formatMessage({id:"ticket.description.maxlength",defaultMessage:"描述不能超过2000个字符"})}]}),(0,E.jsx)(R.Z,{name:"contact",label:a.formatMessage({id:"ticket.contact",defaultMessage:"联系方式"}),rules:[{required:!0,message:a.formatMessage({id:"ticket.contact.required",defaultMessage:"请输入联系方式"})}],placeholder:a.formatMessage({id:"ticket.contact.placeholder",defaultMessage:"手机号码或邮箱地址"}),extra:a.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})})]})})},V=function(){var e=(0,c.useIntl)(),t=(0,c.useSearchParams)(),r=s()(t,2),n=r[0],x=r[1],M=n.get("status")||"todo",k=(0,l.useState)(M),y=s()(k,2),P=y[0],b=y[1],C=(0,l.useState)(!1),w=s()(C,2),F=w[0],S=w[1],T=(0,c.useModel)("@@initialState").initialState,I=(null!=T?T:{}).userInfo;(0,l.useEffect)((function(){if(null==T||!T.userInfo){c.history.push("/auth/login?redirect=".concat(encodeURIComponent("/ticket-center")))}}),[T]);var R=(0,l.useState)({total:1,processing:0,pending:0,review:0}),_=s()(R,1)[0];(0,l.useEffect)((function(){b(M)}),[M]),(0,l.useEffect)((function(){}),[]);var z,B,G=[{path:"/ticket-list",name:e.formatMessage({id:"ticket.list"})||"工单列表",icon:(0,E.jsx)(Z,{})}],V=function(e){var t=e.key;b(t),x({status:t})},q=[{key:"all",label:"".concat(e.formatMessage({id:"ticket.center.all"})," ").concat(_.total)},{key:"processing",label:"".concat(e.formatMessage({id:"ticket.center.statistics.processing"})," ").concat(_.processing)},{key:"pending",label:"".concat(e.formatMessage({id:"ticket.center.statistics.pending"})," ").concat(_.pending)},{key:"review",label:"".concat(e.formatMessage({id:"ticket.center.statistics.review"})," ").concat(_.review)}];return(0,E.jsxs)(d.f,{title:(z=(0,h.nt)(),B=(0,h.ye)(),z&&B?B:e.formatMessage({id:"app.title"})),logo:(0,h.do)(),layout:"mix",fixedHeader:!0,fixSiderbar:!0,splitMenus:!1,route:{path:"/",routes:G},location:{pathname:"/".concat(P)},menuItemRender:function(e,t){return(0,E.jsx)("div",{onClick:function(){var t,r=null===(t=e.path)||void 0===t?void 0:t.replace("/","");r&&V({key:r})},children:t})},actionsRender:function(){return[(0,E.jsx)(f.Z,{},"fullScreen"),(0,E.jsx)(v.Z,{},"trialTip"),!1,(0,E.jsx)(m.Z,{},"GotoGithub"),!1,(0,E.jsx)(p.Z,{},"GotoAgent"),(0,E.jsx)(g.Z,{},"ContactUs")]},avatarProps:{src:null==I?void 0:I.avatar,title:(0,E.jsx)(u.gj,{}),render:function(e,t){return(0,E.jsx)(u.Kd,{menu:!0,children:t})}},footerRender:function(){return(0,E.jsx)(u.$_,{})},contentStyle:{margin:0,padding:0,background:"#f0f2f5"},children:[(0,E.jsx)("div",{style:{padding:"24px 24px 0",background:"#fff",borderBottom:"1px solid #f0f0f0"},children:(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,E.jsx)(a.Z,{activeKey:"todo"===P?"all":P,items:q,onChange:function(e){return V({key:e})},style:{marginBottom:0}}),(0,E.jsx)(i.ZP,{type:"primary",icon:(0,E.jsx)(j.Z,{}),onClick:function(){return S(!0)},children:e.formatMessage({id:"ticket.create",defaultMessage:"创建工单"})})]})}),(0,E.jsx)("div",{style:{padding:"24px"},children:(0,E.jsx)(o.Z,{})}),(0,E.jsx)(U,{visible:F,onClose:function(e){S(!1)}})]})}}}]);