"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6826],{16829:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(83910),a=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},s=n(5901),u=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var c=a.forwardRef(u)},55072:function(e,t,n){n.d(t,{If:function(){return g},dF:function(){return d},j4:function(){return v},v$:function(){return p}});var r=n(90819),a=n.n(r),i=n(73193),s=n.n(i),u=n(89933),c=n.n(u),o=n(68992),l=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/query/org",{method:"GET",params:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/create",{method:"POST",data:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/update",{method:"POST",data:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/delete",{method:"POST",data:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},22261:function(e,t,n){n.d(t,{AD:function(){return d},Tl:function(){return p}});var r=n(90819),a=n.n(r),i=n(73193),s=n.n(i),u=n(89933),c=n.n(u),o=n(68992),l=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/calculate",{method:"POST",data:s()(s()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},40261:function(e,t,n){n.r(t);var r=n(90819),a=n.n(r),i=n(89933),s=n.n(i),u=n(45332),c=n.n(u),o=n(44194),l=n(35079),d=n(78380),f=n(89654),p=n(27401),m=n(67194),v=n(63052),h=n(92393),g=n(72264),y=n(21478),x=n(22888),k=n(35490),w=n(44966),b=n(35911),j=n(57039),M=n(33e3),Z=n(14546),R=n(62395),D=n(22261),T=n(61489),Y=n(77686),S=n(66675),C=n(6677),O=n(99754),z=n(68992),B=n(45634),F=n.n(B),I=n(55072),q=n(74956),E=n(16829),U=n(31549),P=l.default.RangePicker,J=d.Z.Option;t.default=function(){var e,t,n,r,i=(0,R.useIntl)(),u=(0,O.Z)().translateStringTranct,l=(0,o.useState)(F()().startOf("day")),B=c()(l,2),H=B[0],X=B[1],W=(0,o.useState)(F()().endOf("day")),A=c()(W,2),L=A[0],G=A[1],N=(0,o.useState)("today"),Q=c()(N,2),_=Q[0],$=Q[1],K=(0,o.useState)(z.whQ),V=c()(K,2),ee=V[0],te=V[1],ne=(0,o.useState)(),re=c()(ne,2),ae=re[0],ie=re[1],se=(0,o.useState)(),ue=c()(se,2),ce=ue[0],oe=ue[1],le=(0,Y.u)((function(e){return e.currentOrg})),de=(0,S.E)((function(e){return e})),fe=de.agentResult,pe=de.setAgentResult,me=(0,q.H)((function(e){return e})),ve=me.departmentResult,he=me.setDepartmentResult,ge=(0,o.useState)(),ye=c()(ge,2),xe=ye[0],ke=ye[1],we=(0,o.useState)(!1),be=c()(we,2),je=be[0],Me=be[1],Ze=[{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,U.jsx)(R.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,o.useEffect)((function(){if("custom"===_)X(H),G(L);else{var e=F()();"today"===_?(X(e),G(e)):"yesterday"===_?(X(e.subtract(1,"day")),G(e.subtract(1,"day"))):"week"===_?(X(e.startOf("week")),G(e.endOf("week"))):"lastWeek"===_?(X(e.subtract(1,"week").startOf("week")),G(e.subtract(1,"week").endOf("week"))):"month"===_&&(X(e.startOf("month")),G(e.endOf("month")))}}),[_]);var Re=function(){var e=s()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==le?void 0:le.uid},e.next=4,(0,I.dF)(t);case 4:200===(n=e.sent).code?(T.yw.destroy(),he(n),n.data.content.length>0&&oe(n.data.content[0].uid)):(T.yw.destroy(),T.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=s()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==le?void 0:le.uid},e.next=4,(0,C._t)(t);case 4:200===(n=e.sent).code?(T.yw.destroy(),pe(n),n.data.content.length>0&&ie(n.data.content[0].uid)):(T.yw.destroy(),T.yw.error(u(n.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=s()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Me(!0),e.prev=1,T.yw.loading("loading"),t={type:ee,startDate:null==H?void 0:H.format("YYYY-MM-DD"),endDate:null==L?void 0:L.format("YYYY-MM-DD"),departmentUid:ce,assigneeUid:ae,orgUid:null==le?void 0:le.uid},e.next=6,(0,D.AD)(t);case 6:n=e.sent,console.log("queryStatisticTicketByDate response:",n.data,t),200===n.code?(T.yw.destroy(),ke(n.data)):(T.yw.destroy(),T.yw.error(n.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),T.yw.error(i.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,Me(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){Re(),De()}),[]),(0,o.useEffect)((function(){Te()}),[ee,ae,ce]),(0,o.useEffect)((function(){Te()}),[H,L]);var Ye=(null===(e=fe.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e,t){return{key:null==e?void 0:e.uid,name:u(null==e?void 0:e.nickname),avatar:null==e?void 0:e.avatar,totalTickets:(null==xe?void 0:xe.assigneeTickets)||0,resolvedTickets:(null==xe?void 0:xe.resolvedTickets)||0,avgResolutionTime:"".concat((null==xe?void 0:xe.averageResolutionTime)||0,"小时"),workHours:"8小时",efficiency:(null==xe?void 0:xe.assigneeResolutionRate)||0}})))||[],Se=[{title:i.formatMessage({id:"bi.ticket.table.agentName"}),dataIndex:"name",key:"name",render:function(e,t){return(0,U.jsxs)(f.Z,{children:[(0,U.jsx)(p.Z,{src:t.avatar,size:"small"}),(0,U.jsx)("span",{children:e})]})}},{title:i.formatMessage({id:"bi.ticket.table.assigneeTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:i.formatMessage({id:"bi.ticket.table.resolvedTickets"}),dataIndex:"resolvedTickets",key:"resolvedTickets"},{title:i.formatMessage({id:"bi.ticket.table.avgResolutionTime"}),dataIndex:"avgResolutionTime",key:"avgResolutionTime",render:function(e){return"".concat(e).concat(i.formatMessage({id:"bi.ticket.unit.minute"}))}},{title:i.formatMessage({id:"bi.ticket.table.efficiency"}),dataIndex:"efficiency",key:"efficiency",render:function(e){return(0,U.jsx)(m.Z,{percent:e,size:"small",format:function(e){return"".concat(e,"%")}})}}];return(0,U.jsxs)("div",{style:{padding:"24px"},children:[(0,U.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,U.jsx)("h2",{children:i.formatMessage({id:"bi.ticket.title.workload"})}),(0,U.jsxs)("p",{children:[i.formatMessage({id:"bi.ticket.description.workload"}),"today"===_&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",H.format("YYYY-MM-DD"),")"]}),"yesterday"===_&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",H.format("YYYY-MM-DD"),")"]}),("week"===_||"lastWeek"===_||"month"===_||"custom"===_)&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",H.format("YYYY-MM-DD")," ~ ",L.format("YYYY-MM-DD"),")"]})]})]}),(0,U.jsx)(v.Z,{style:{marginBottom:16},children:(0,U.jsx)(f.Z,{direction:"vertical",style:{width:"100%"},children:(0,U.jsxs)(f.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,U.jsxs)(f.Z,{wrap:!0,children:[(0,U.jsx)(h.ZP.Group,{value:_,onChange:function(e){return $(e.target.value)},children:Ze.map((function(e){return(0,U.jsx)(h.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===_&&(0,U.jsx)(P,{value:[H,L],onChange:function(e){X(e[0]),G(e[1])}})]}),(0,U.jsxs)(f.Z,{wrap:!0,children:[(0,U.jsxs)(d.Z,{value:ee,onChange:te,style:{width:120},placeholder:i.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,U.jsx)(J,{value:z.whQ,children:i.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,U.jsx)(J,{value:z.fyH,children:i.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,U.jsx)(J,{value:z.nYM,children:i.formatMessage({id:"bi.ticket.filterType.department"})})]}),ee===z.fyH&&(0,U.jsx)(d.Z,{value:ae,onChange:ie,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(t=fe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,U.jsx)(J,{value:e.uid,children:u(e.nickname)},e.uid)}))}),ee===z.nYM&&(0,U.jsx)(d.Z,{value:ce,onChange:oe,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(n=ve.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return(0,U.jsx)(J,{value:e.uid,children:u(e.name)},e.uid)}))}),(0,U.jsx)(g.ZP,{type:"primary",icon:(0,U.jsx)(b.Z,{}),onClick:function(){return Te()},children:(0,U.jsx)(R.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,U.jsxs)(y.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(v.Z,{children:(0,U.jsx)(k.Z,{title:i.formatMessage({id:"bi.ticket.card.onlineAgents"}),value:(null===(r=fe.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)||0,prefix:(0,U.jsx)(j.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(v.Z,{children:(0,U.jsx)(k.Z,{title:i.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==xe?void 0:xe.totalTickets)||0,prefix:(0,U.jsx)(M.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(v.Z,{children:(0,U.jsx)(k.Z,{title:i.formatMessage({id:"bi.ticket.card.avgResponseTime"}),value:(null==xe?void 0:xe.averageFirstResponseTime)||0,prefix:(0,U.jsx)(Z.Z,{}),valueStyle:{color:"#722ed1"},suffix:i.formatMessage({id:"bi.ticket.unit.minute"})})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(v.Z,{children:(0,U.jsx)(k.Z,{title:i.formatMessage({id:"bi.ticket.card.assigneeResolutionRate"}),value:(null==xe?void 0:xe.assigneeResolutionRate)||0,prefix:(0,U.jsx)(E.Z,{}),valueStyle:{color:"#eb2f96"},suffix:i.formatMessage({id:"bi.ticket.unit.percent"})})})})]}),(0,U.jsx)(v.Z,{title:"客服工作量详细数据",loading:je,children:(0,U.jsx)(w.Z,{columns:Se,dataSource:Ye,pagination:!1,size:"middle"})})]})}},74956:function(e,t,n){n.d(t,{H:function(){return p}});var r=n(86222),a=n.n(r),i=n(76711),s=n.n(i),u=n(73193),c=n.n(u),o=n(68992),l=n(58063),d=n(66266),f=n(31403),p=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:o.zBg,nickname:o.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,a={uid:o.zBg,name:o.zBg};(e({departmentResult:c()(c()({},n),{},{data:{content:[a].concat(s()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var i=[].concat(s()(r.slice(0,a)),[n],s()(r.slice(a+1))),u=c()(c()({},t().departmentResult),{},{data:{content:i}});e({departmentResult:u,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,i,s=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(s)e({currentDepartment:s});else{!function t(r){var i,s=a()(r);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.uid===n)return void e({currentDepartment:u});u.children&&u.children.length>0&&t(u.children)}}catch(e){s.e(e)}finally{s.f()}}((null===(i=t().departmentResult)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:o.xY_})))}}]);