"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5800],{51718:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return p},Gv:function(){return y},L3:function(){return w},bD:function(){return g},mE:function(){return k},nQ:function(){return j},nU:function(){return v},oX:function(){return Z}});var r=n(90819),s=n.n(r),i=n(73193),a=n.n(i),o=n(89933),u=n.n(o),l=n(19736),d=n(6844);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){var n,r,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,r=t.workgroupUid,i=t.type,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(r),{method:"GET",params:{channel:d.XtJ,type:i}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return S.apply(this,arguments)}function S(){return(S=u()(s()().mark((function e(t,n){var r,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,i=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(r,"/orgs/").concat(i,"/bindings"),{method:"POST",data:a()(a()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return T.apply(this,arguments)}function T(){return(T=u()(s()().mark((function e(t,n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(t,"/workgroups/").concat(n,"/categories"),{method:"GET",params:{channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},88449:function(e,t,n){var r=n(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},41444:function(e,t,n){n.r(t),n.d(t,{default:function(){return Fe}});var r=n(89957),s=n.n(r),i=n(73193),a=n.n(i),o=n(90819),u=n.n(o),l=n(89933),d=n.n(l),c=n(45332),f=n.n(c),g=n(44194),m=n(19736),p=n(31167),h=n(85255),v=n(3925),x=n(9428),y=n(48769),M=n(71876),k=n(12792),b=n(66810),j=n(65513),S=n(77359),Z=n(79866),C=n(68779),w=n(28514),T=n(10162),F=n(59304),P=n(54881),I=n(47944),L=n(80556),E=n(55785),O=n(93527),U=n(14888),q=n(26710),A=n(88449),J=n(51718),D=n(26557),z=n(26407),B=n(20744),N=n(6844),K=(0,D.Ue)()((0,z.mW)((0,z.tJ)((0,B.n)((function(e){return{currentTicketSettings:null,ticketSettingsMap:{},setCurrentTicketSettings:function(t){return e({currentTicketSettings:t})},setTicketSettingsForWorkgroup:function(t,n){return e((function(e){e.ticketSettingsMap[t]=n}))},updateCurrentTicketSettings:function(t){return e((function(e){e.currentTicketSettings&&("function"==typeof t?t(e.currentTicketSettings):e.currentTicketSettings=a()(a()({},e.currentTicketSettings),t))}))},removeTicketSettingsForWorkgroup:function(t){return e((function(e){delete e.ticketSettingsMap[t]}))},clearAll:function(){return e({currentTicketSettings:null,ticketSettingsMap:{}})}}})),{name:N.rpR+"_TICKET"}))),X=n(5089),H=n(29589),V=n(58867),W=n(98986),R=n(96123),G=n(1691),_=n(8781),Q=n(48907),Y=n(82690),$=n(30064),ee=n(31549),te=X.Z.Text,ne=X.Z.Title,re=(H.Z.Option,function(e){var t,n,r,s=e.settings,i=e.onChange,a=(0,m.useIntl)(),o=$.A.useForm(),u=f()(o,1)[0];(0,g.useEffect)((function(){u.setFieldsValue(s)}),[s,u]);var l=V.Z.useWatch("numberPrefix",u),d=V.Z.useWatch("numberLength",u),c=V.Z.useWatch("enableAutoClose",u),p=null!==(t=null!=l?l:s.numberPrefix)&&void 0!==t?t:"",h=null!==(n=null!=d?d:s.numberLength)&&void 0!==n?n:0,v=("boolean"==typeof c||s.enableAutoClose,Math.max(0,h-(null!==(r=null==p?void 0:p.length)&&void 0!==r?r:0))),M=v>0?"".concat("0".repeat(Math.max(v-3,0)),"123").slice(-v):"123",k="".concat(p).concat(M);return(0,ee.jsxs)($.A,{form:u,layout:"vertical",submitter:!1,style:{padding:"20px 0"},onValuesChange:function(e){return i(e)},children:[(0,ee.jsxs)("div",{style:{marginBottom:32},children:[(0,ee.jsxs)(x.Z,{size:"small",children:[(0,ee.jsx)(C.Z,{}),(0,ee.jsx)(ne,{level:5,style:{margin:0},children:a.formatMessage({id:"ticket.settings.basic.section.number",defaultMessage:"工单编号设置"})})]}),(0,ee.jsxs)(W.Z,{gutter:24,children:[(0,ee.jsx)(R.Z,{span:12,children:(0,ee.jsx)($.A.Item,{name:"numberPrefix",label:(0,ee.jsxs)(x.Z,{children:[a.formatMessage({id:"ticket.settings.basic.numberPrefix",defaultMessage:"工单编号前缀"}),(0,ee.jsx)(G.Z,{title:a.formatMessage({id:"ticket.settings.basic.numberPrefix.tooltip",defaultMessage:"工单编号的前缀，如 TK、WO 等"}),children:(0,ee.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ee.jsx)(y.Z,{maxLength:10,placeholder:a.formatMessage({id:"ticket.settings.basic.numberPrefix.placeholder",defaultMessage:"如：TK、WO"})})})}),(0,ee.jsx)(R.Z,{span:12,children:(0,ee.jsx)($.A.Item,{name:"numberLength",label:(0,ee.jsxs)(x.Z,{children:[a.formatMessage({id:"ticket.settings.basic.numberLength",defaultMessage:"编号长度"}),(0,ee.jsx)(G.Z,{title:a.formatMessage({id:"ticket.settings.basic.numberLength.tooltip",defaultMessage:"工单编号的总长度，包括前缀"}),children:(0,ee.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ee.jsx)(_.Z,{min:Math.max(p.length+1,6),max:20,placeholder:a.formatMessage({id:"ticket.settings.basic.numberLength.placeholder",defaultMessage:"如：8"})})})})]}),(0,ee.jsx)(te,{type:"secondary",children:a.formatMessage({id:"ticket.settings.basic.sample",defaultMessage:"示例编号：{sample}"},{sample:k})})]}),(0,ee.jsx)(Q.Z,{style:{margin:"16px 0"}}),(0,ee.jsxs)("div",{children:[(0,ee.jsx)(ne,{level:5,children:a.formatMessage({id:"ticket.settings.basic.section.visitor",defaultMessage:"访客创建限制"})}),(0,ee.jsx)($.A.Item,{name:"requireLogin",label:a.formatMessage({id:"ticket.settings.basic.requireLogin.label",defaultMessage:"必须登录后才能创建工单"}),valuePropName:"checked",children:(0,ee.jsx)(j.Z,{checkedChildren:a.formatMessage({id:"ticket.settings.basic.requireLogin.on",defaultMessage:"需要登录"}),unCheckedChildren:a.formatMessage({id:"ticket.settings.basic.requireLogin.off",defaultMessage:"允许匿名"})})}),(0,ee.jsx)(te,{type:"secondary",children:a.formatMessage({id:"ticket.settings.basic.requireLogin.desc",defaultMessage:"启用后，访客必须先通过登录认证才能提交工单。"})})]})]})}),se=n(76711),ie=n.n(se),ae=n(93189),oe=n(51891),ue=n(77753),le=n(46141),de=n(20921),ce=n(51936),fe=n(48965),ge=n(12322),me=n(2696),pe=n(9170),he=n(25420),ve=n(47598),xe=n(88165),ye=n(44679),Me=X.Z.Text,ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"tmp_".concat(e,"_").concat(Math.floor(1e3*Math.random()))},be=function(e){return ie()(e).sort((function(e,t){var n,r,s=null!==(n=e.orderIndex)&&void 0!==n?n:0,i=null!==(r=t.orderIndex)&&void 0!==r?r:0;return s===i?(e.name||"").localeCompare(t.name||""):s-i}))},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e,t){var n,r,s,i,a;return{uid:null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:ke(t),name:(null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"").trim(),description:null!==(s=null==e?void 0:e.description)&&void 0!==s?s:"",enabled:!1!==(null==e?void 0:e.enabled),defaultCategory:null!==(i=null==e?void 0:e.defaultCategory)&&void 0!==i&&i,orderIndex:null!==(a=null==e?void 0:e.orderIndex)&&void 0!==a?a:t}})),n=be(t).map((function(e,t){return a()(a()({},e),{},{orderIndex:t})})),r=!1,s=n.map((function(e){return e.defaultCategory&&e.enabled?r?a()(a()({},e),{},{defaultCategory:!1}):(r=!0,e):e}));if(!r){var i=s.findIndex((function(e){return e.enabled}));i>=0&&(s[i]=a()(a()({},s[i]),{},{defaultCategory:!0}),r=!0)}return!r&&s.length>0&&(s[0]=a()(a()({},s[0]),{},{defaultCategory:!0,enabled:!0})),s},Se=function(e){var t=e.items,n=e.onChange,r=e.categoryType,s=(0,m.useIntl)(),i=(0,ye.Z)().translateString,o=V.Z.useForm(),l=f()(o,1)[0],c=(0,g.useState)(!1),p=f()(c,2),h=p[0],M=p[1],Z=(0,g.useState)(null),C=f()(Z,2),w=C[0],T=C[1],I=(0,U.u)((function(e){return e.currentOrg})),L=(0,ve.v)((function(e){return e.categoryTreeOptions})),E=(0,ve.v)((function(e){return e.categoryResult})),O=(0,g.useState)(!1),q=f()(O,2),A=q[0],J=q[1],D=(0,g.useState)([]),z=f()(D,2),B=z[0],K=z[1],X=(0,g.useState)(!1),H=f()(X,2),W=H[0],R=H[1],_=null!=r?r:N.FXY,Q=(0,g.useMemo)((function(){return je(null!=t?t:[])}),[t]),Y=(0,g.useMemo)((function(){var e,t=Q.filter((function(e){return e.enabled})).length;return{enabled:t,disabled:Q.length-t,defaultUid:null===(e=Q.find((function(e){return e.defaultCategory&&e.enabled})))||void 0===e?void 0:e.uid}}),[Q]);(0,g.useEffect)((function(){null!=I&&I.uid&&(0,xe.HK)(_,I.uid,void 0,N.whQ,{pageSize:200,showLoading:!1})}),[null==I?void 0:I.uid,_]);var $=(0,g.useMemo)((function(){return L.filter((function(e){return e.key!==N.zBg}))}),[L]),te=(0,g.useMemo)((function(){var e,t=[];return function e(n){null!=n&&n.length&&n.forEach((function(n){var r;null!=n&&n.uid&&n.uid!==N.zBg&&(t.push(n),null!==(r=n.children)&&void 0!==r&&r.length&&e(n.children))}))}(null==E||null===(e=E.data)||void 0===e?void 0:e.content),t}),[E]),ne=(0,g.useMemo)((function(){var e=new Map;return te.forEach((function(t){t.uid&&e.set(t.uid,t)})),e}),[te]);(0,g.useEffect)((function(){if(A){var e=Q.map((function(e){return e.uid})).filter((function(e){return"string"==typeof e&&e.length>0}));K(e)}}),[A,Q]);var re=function(e){n(je(e))},se=function(){var e=d()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=I&&I.uid){e.next=3;break}return ae.ZP.warning(s.formatMessage({id:"ticket.settings.category.select.noOrg",defaultMessage:"请先选择一个组织"})),e.abrupt("return");case 3:if(J(!0),0!==$.length){e.next=12;break}return R(!0),e.prev=6,e.next=9,(0,xe.HK)(_,I.uid,void 0,N.whQ,{pageSize:200,showLoading:!1});case 9:return e.prev=9,R(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])})));return function(){return e.apply(this,arguments)}}(),be=function(e,t){if(e){var n=ie()(Q),r=n.findIndex((function(t){return t.uid===e}));if(!(r<0)){var s="up"===t?r-1:r+1;if(!(s<0||s>=n.length)){var i=n.splice(r,1),o=f()(i,1)[0];n.splice(s,0,o);var u=n.map((function(e,t){return a()(a()({},e),{},{orderIndex:t})}));re(u)}}}},Se=function(){var e=d()(u()().mark((function e(){var t,n,r,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.validateFields();case 3:if(r=e.sent,null!=w&&w.uid){e.next=6;break}return e.abrupt("return");case 6:i=a()(a()({},w),{},{name:r.name.trim(),description:(null!==(t=r.description)&&void 0!==t?t:"").trim(),enabled:!1!==r.enabled,defaultCategory:!0===r.defaultCategory,orderIndex:null!==(n=w.orderIndex)&&void 0!==n?n:0}),o=Q.map((function(e){return e.uid===w.uid?a()(a()({},e),i):e})),re(o),M(!1),T(null),l.resetFields(),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.update.success",defaultMessage:"分类已更新"})),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),Ze=[{title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.name",defaultMessage:"分类名称"}),dataIndex:"name",key:"name",render:function(e,t){return(0,ee.jsxs)(x.Z,{size:8,children:[t.defaultCategory&&t.enabled?(0,ee.jsx)(b.Z,{color:"gold",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.badge",defaultMessage:"默认"})}):null,(0,ee.jsx)(Me,{strong:!0,children:i(t.name)||"--"})]})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",render:function(e,t){return(0,ee.jsx)(j.Z,{checked:!!t.enabled,onChange:function(e){return function(e,t){if(e){var n=Q.map((function(n){return n.uid===e?a()(a()({},n),{},{enabled:t}):n}));re(n)}}(t.uid,e)}})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default",defaultMessage:"默认分类"}),dataIndex:"defaultCategory",key:"defaultCategory",render:function(e,t){return(0,ee.jsx)(G.Z,{title:t.enabled?s.formatMessage({id:"ticket.settings.category.makeDefault",defaultMessage:"设为默认分类"}):s.formatMessage({id:"ticket.settings.category.default.disabled",defaultMessage:"启用后方可设为默认"}),children:(0,ee.jsx)(v.ZP,{type:"text",icon:t.enabled&&t.defaultCategory?(0,ee.jsx)(fe.Z,{style:{color:"#faad14"}}):(0,ee.jsx)(ge.Z,{}),disabled:!t.enabled,onClick:function(){return function(e){if(e){var t=Q.map((function(t){return a()(a()({},t),{},{defaultCategory:t.uid===e})}));re(t)}}(t.uid)}})})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.order",defaultMessage:"排序"}),key:"order",render:function(e,t,n){return(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(G.Z,{title:s.formatMessage({id:"common.move.up",defaultMessage:"上移"}),children:(0,ee.jsx)(v.ZP,{type:"text",icon:(0,ee.jsx)(me.Z,{}),disabled:0===n,onClick:function(){return be(t.uid,"up")}})}),(0,ee.jsx)(G.Z,{title:s.formatMessage({id:"common.move.down",defaultMessage:"下移"}),children:(0,ee.jsx)(v.ZP,{type:"text",icon:(0,ee.jsx)(pe.Z,{}),disabled:n===Q.length-1,onClick:function(){return be(t.uid,"down")}})})]})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.actions",defaultMessage:"操作"}),key:"actions",render:function(e,t){return(0,ee.jsxs)(x.Z,{size:8,children:[(0,ee.jsx)(v.ZP,{type:"link",icon:(0,ee.jsx)(F.Z,{}),onClick:function(){return function(e){T(e),l.setFieldsValue({name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory}),M(!0)}(t)},children:(0,ee.jsx)(m.FormattedMessage,{id:"common.edit",defaultMessage:"编辑"})}),(0,ee.jsx)(S.Z,{title:s.formatMessage({id:"ticket.settings.category.delete.confirm",defaultMessage:"确认删除该分类？"}),onConfirm:function(){return function(e){if(e){var t=Q.filter((function(t){return t.uid!==e}));re(t),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.delete.success",defaultMessage:"分类已删除"}))}}(t.uid)},okText:s.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(v.ZP,{type:"link",danger:!0,icon:(0,ee.jsx)(P.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})})]})}}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(oe.Z,{title:(0,ee.jsxs)(x.Z,{size:8,children:[(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.title",defaultMessage:"分类列表"}),(0,ee.jsx)(b.Z,{color:"blue",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.summary",defaultMessage:"启用 {enabled} / 禁用 {disabled}",values:{enabled:Y.enabled,disabled:Y.disabled}})}),Y.defaultUid?(0,ee.jsx)(b.Z,{color:"gold",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.current",defaultMessage:"默认已设置"})}):(0,ee.jsx)(b.Z,{color:"red",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.missing",defaultMessage:"请设置默认分类"})})]}),extra:(0,ee.jsx)(v.ZP,{type:"primary",icon:(0,ee.jsx)(he.Z,{}),onClick:se,children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.selectFromTree",defaultMessage:"从分类树选择"})}),styles:{body:{padding:0}},children:[(0,ee.jsx)(ue.Z,{columns:Ze,dataSource:Q,rowKey:function(e){var t,n;return null!==(t=null!==(n=e.uid)&&void 0!==n?n:e.name)&&void 0!==t?t:ke()},pagination:!1}),(0,ee.jsx)("div",{style:{padding:"16px 24px"},children:(0,ee.jsx)(Me,{type:"secondary",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.hint",defaultMessage:"至少保留一个启用的分类，并指定默认分类供访客预选。"})})})]}),(0,ee.jsx)(le.Z,{open:A,title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.title",defaultMessage:"选择工单分类"}),onOk:function(){if(0!==B.length){var e=new Set(B),t=Q.filter((function(t){return t.uid&&e.has(t.uid)})),n=[];B.forEach((function(e){var r;if(!t.some((function(t){return t.uid===e}))){var s=ne.get(e);s&&n.push({uid:s.uid,name:null!==(r=s.name)&&void 0!==r?r:s.uid,description:"",enabled:!0,defaultCategory:!1,orderIndex:t.length+n.length})}}));var r=[].concat(ie()(t),n);re(r),J(!1),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.select.success",defaultMessage:"分类列表已更新"}))}else ae.ZP.warning(s.formatMessage({id:"ticket.settings.category.select.empty",defaultMessage:"请选择至少一个分类"}))},onCancel:function(){J(!1),R(!1)},confirmLoading:W,destroyOnHidden:!0,width:480,okText:s.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsxs)(x.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,ee.jsx)(Me,{type:"secondary",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.tip",defaultMessage:"勾选需要在工单配置中启用的分类。"})}),W?(0,ee.jsx)("div",{style:{textAlign:"center",padding:"32px 0"},children:(0,ee.jsx)(de.Z,{})}):$.length>0?(0,ee.jsx)(ce.Z,{checkable:!0,selectable:!1,checkedKeys:B,onCheck:function(e){var t;Array.isArray(e)?K(e):K(null!==(t=e.checked)&&void 0!==t?t:[])},treeData:$,height:360,titleRender:function(e){var t="string"==typeof e.title?e.title:"",n=i(t)||t||"--";return(0,ee.jsx)(G.Z,{title:n,children:n})}}):(0,ee.jsx)(k.Z,{image:k.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.emptyTree",defaultMessage:"暂无可用分类，请先在分类管理中创建。"})})]})}),(0,ee.jsx)(le.Z,{open:h,title:w?s.formatMessage({id:"ticket.settings.category.modal.edit",defaultMessage:"编辑分类"}):s.formatMessage({id:"ticket.settings.category.modal.create",defaultMessage:"新增分类"}),onOk:Se,onCancel:function(){M(!1),T(null),l.resetFields()},destroyOnHidden:!0,width:520,children:(0,ee.jsxs)(V.Z,{form:l,layout:"vertical",children:[(0,ee.jsx)(V.Z.Item,{name:"name",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.name",defaultMessage:"分类名称"}),rules:[{required:!0,message:s.formatMessage({id:"ticket.settings.category.form.name.required",defaultMessage:"请输入分类名称"})},{max:32,message:s.formatMessage({id:"ticket.settings.category.form.name.length",defaultMessage:"名称长度不超过32个字符"})}],children:(0,ee.jsx)(y.Z,{placeholder:s.formatMessage({id:"ticket.settings.category.form.name.placeholder",defaultMessage:"例如：售后支持"}),allowClear:!0})}),(0,ee.jsx)(V.Z.Item,{name:"description",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.description",defaultMessage:"描述"}),rules:[{max:120,message:s.formatMessage({id:"ticket.settings.category.form.description.length",defaultMessage:"描述长度不超过120个字符"})}],children:(0,ee.jsx)(y.Z.TextArea,{rows:3,placeholder:s.formatMessage({id:"ticket.settings.category.form.description.placeholder",defaultMessage:"用于帮助访客理解分类用途，可选填"}),allowClear:!0})}),(0,ee.jsx)(V.Z.Item,{name:"enabled",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,ee.jsx)(j.Z,{})}),(0,ee.jsx)(V.Z.Item,{name:"defaultCategory",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.default",defaultMessage:"设为默认分类"}),valuePropName:"checked",children:(0,ee.jsx)(j.Z,{disabled:0===Q.length&&!w})})]})})]})},Ze=function(e){var t=e.open,n=e.record,r=e.ticketType,s=e.onClose,i=e.onSuccess,a=(0,m.useIntl)(),o=(0,U.u)((function(e){return e.currentOrg})),l=V.Z.useForm(),c=f()(l,1)[0],p=(0,g.useState)(!1),h=f()(p,2),v=h[0],x=h[1],M=!(null==n||!n.uid);(0,g.useEffect)((function(){t&&(c.resetFields(),n&&c.setFieldsValue({name:n.name,description:n.description}))}),[t,null==n?void 0:n.uid]);var k=function(){var e=d()(u()().mark((function e(){var t,l,d,f;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.validateFields();case 3:if(t=e.sent,null!=o&&o.uid){e.next=6;break}return e.abrupt("return");case 6:if(x(!0),l=n?n.type===N.VIL?N.VIL:N.DKU:r,!M){e.next=15;break}return e.next=11,(0,J.mE)({uid:n.uid,orgUid:o.uid,name:t.name,description:t.description,type:l});case 11:200===(null==(d=e.sent)?void 0:d.code)?(O.yw.success(a.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),i(d.data),s()):O.yw.error((null==d?void 0:d.message)||a.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:return e.next=17,(0,J.Gv)({orgUid:o.uid,name:t.name,description:t.description,type:l});case 17:200===(null==(f=e.sent)?void 0:f.code)?(O.yw.success(a.formatMessage({id:"common.created",defaultMessage:"创建成功"})),i(f.data),s()):O.yw.error((null==f?void 0:f.message)||a.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"}));case 19:return e.prev=19,x(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,,19,22]])})));return function(){return e.apply(this,arguments)}}();return(0,ee.jsx)(le.Z,{title:M?a.formatMessage({id:"ticket.settings.edit.title",defaultMessage:"编辑工单配置"}):a.formatMessage({id:"ticket.settings.create.title",defaultMessage:"新建工单配置"}),width:520,open:t,onCancel:s,onOk:k,okText:M?a.formatMessage({id:"common.save",defaultMessage:"保存"}):a.formatMessage({id:"common.create",defaultMessage:"创建"}),cancelText:a.formatMessage({id:"common.cancel",defaultMessage:"取消"}),confirmLoading:v,destroyOnHidden:!0,children:(0,ee.jsxs)(V.Z,{form:c,layout:"vertical",children:[(0,ee.jsx)(V.Z.Item,{label:a.formatMessage({id:"common.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0,message:a.formatMessage({id:"common.name.required",defaultMessage:"请输入名称"})}],children:(0,ee.jsx)(y.Z,{maxLength:64,showCount:!0,placeholder:a.formatMessage({id:"common.name.placeholder",defaultMessage:"请输入名称"})})}),(0,ee.jsx)(V.Z.Item,{label:a.formatMessage({id:"common.description",defaultMessage:"描述"}),name:"description",children:(0,ee.jsx)(y.Z.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:a.formatMessage({id:"common.description.placeholder",defaultMessage:"请输入描述"})})})]})})},Ce=n(36125),we=function(e){return e?JSON.parse(JSON.stringify(e)):null},Te=function(e){return e===N.VIL?N.VIL:N.DKU},Fe=function(){var e=(0,m.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,q.Z)().isDarkMode,r=(0,A.Z)().leftSiderStyle,i=(0,g.useState)([]),o=f()(i,2),l=o[0],c=o[1],D=(0,g.useState)(""),z=f()(D,2),B=z[0],X=z[1],H=(0,g.useState)(),V=f()(H,2),W=V[0],R=V[1],G=(0,g.useState)("basic"),_=f()(G,2),Q=_[0],Y=_[1],$=(0,g.useState)(!1),te=f()($,2),ne=te[0],se=te[1],ie=(0,g.useState)(!1),ae=f()(ie,2),oe=ae[0],ue=ae[1],le=(0,g.useState)(!1),de=f()(le,2),ce=de[0],fe=de[1],ge=(0,g.useState)(!1),me=f()(ge,2),pe=me[0],he=me[1],ve=(0,g.useState)(null),xe=f()(ve,2),ye=xe[0],Me=xe[1],ke=(0,g.useState)(!1),be=f()(ke,2),Fe=be[0],Pe=be[1],Ie=(0,g.useRef)(""),Le=(0,g.useState)(N.h_f),Ee=f()(Le,2),Oe=Ee[0],Ue=Ee[1],qe=K((function(e){return{setCurrentTicketSettings:e.setCurrentTicketSettings,currentTicketSettings:e.currentTicketSettings,updateCurrentTicketSettings:e.updateCurrentTicketSettings}})),Ae=qe.setCurrentTicketSettings,Je=qe.currentTicketSettings,De=qe.updateCurrentTicketSettings,ze=(0,g.useMemo)((function(){return(W?l.find((function(e){return e.uid===W})):null)||null}),[l,W]),Be=(0,g.useMemo)((function(){if(!B)return l;var e=B.toLowerCase();return l.filter((function(t){return((t.name||t.uid||"")+(t.description||"")).toLowerCase().includes(e)}))}),[l,B]),Ne=(0,g.useCallback)(function(){var e=d()(u()().mark((function e(n){var r,s,i,a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return se(!0),e.prev=3,s=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:200,searchText:s,type:Oe},e.next=8,(0,J.Bg)(i);case 8:a=e.sent,Ce.Z.debug("queryTicketSettingsByOrg response:",null==a?void 0:a.data,i),o=(null==a||null===(r=a.data)||void 0===r?void 0:r.content)||[],c(o),!(o.length>0)||W&&o.some((function(e){return e.uid===W}))||R(o[0].uid);case 13:return e.prev=13,se(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,W,Oe]);(0,g.useEffect)((function(){Ne(B)}),[null==t?void 0:t.uid,Oe]),(0,g.useEffect)((function(){if(ze){var e=we(ze);Ae(e),Ie.current=JSON.stringify(null!=ze?ze:{}),Pe(!1)}else Ae(null),Ie.current=JSON.stringify({}),Pe(!1)}),[ze,Ae]),(0,g.useEffect)((function(){if(Je)try{var e=JSON.stringify(Je);Pe(e!==Ie.current)}catch(e){Pe(!0)}else Pe(!1)}),[Je]);var Ke=function(){var n=d()(u()().mark((function n(r){var s,i,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=null!=r?r:ze)&&s.uid){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,J.oX)({uid:s.uid,type:Te(s.type)});case 6:if(i=n.sent,!((Array.isArray(null==i?void 0:i.data)?i.data:[]).length>0)){n.next=11;break}return O.yw.warning(e.formatMessage({id:"ticket.settings.delete.hasBinding",defaultMessage:"当前工单设置已绑定工作组，请先解绑后再删除"})),n.abrupt("return");case 11:return o={uid:s.uid,orgUid:null==t?void 0:t.uid},l=a()(a()({},o),{},{type:Te(s.type)}),n.next=15,(0,J.nU)(l);case 15:d=n.sent,console.log("deleteTicketSettings response:",d,l),200===(null==d?void 0:d.code)?(O.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),c((function(e){return e.filter((function(e){return e.uid!==s.uid}))})),W===s.uid&&R(void 0)):O.yw.error((null==d?void 0:d.message)||"删除失败"),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(3),console.error(n.t0),O.yw.error(e.formatMessage({id:"ticket.settings.delete.failed",defaultMessage:"删除失败"}));case 24:case"end":return n.stop()}}),n,null,[[3,20]])})));return function(e){return n.apply(this,arguments)}}(),Xe=function(){var n=d()(u()().mark((function n(r,s){var i;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,J.mE)({uid:r,orgUid:null==t?void 0:t.uid,enabled:s,type:Te(null==Qe?void 0:Qe.type)});case 3:(i=n.sent)&&200===i.code?(O.yw.success(e.formatMessage({id:s?"common.enabled":"common.disabled",defaultMessage:s?"已启用":"已停用"})),Ne(B)):O.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),O.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),He=function(e){if(e){var t=e;return t&&"object"===s()(t)&&"content"in t?t.content:e}},Ve=function(e){var t,n,r,s,i,o,u,l;if(!e)return null;var d,c=null!==(t=e.draftBasicSettings)&&void 0!==t?t:e.basicSettings,f=c?a()({},c):void 0,g=null!==(n=e.draftStatusFlowSettings)&&void 0!==n?n:e.statusFlowSettings,m=null!==(r=e.draftPrioritySettings)&&void 0!==r?r:e.prioritySettings,p=null!==(s=e.draftCustomFieldSettings)&&void 0!==s?s:e.customFieldSettings,h=null!==(i=e.draftAssignmentSettings)&&void 0!==i?i:e.assignmentSettings,v=null!==(o=e.draftNotificationSettings)&&void 0!==o?o:e.notificationSettings,x=null!==(u=e.draftCategorySettings)&&void 0!==u?u:e.categorySettings,y=x?je(null!==(l=x.items)&&void 0!==l?l:[]):void 0;return{uid:e.uid,orgUid:e.orgUid,type:Te(e.type),name:e.name,description:e.description,isDefault:null==e?void 0:e.isDefault,enabled:null==e?void 0:e.enabled,basicSettings:f,statusFlowSettings:He(g),prioritySettings:He(m),assignmentSettings:h,notificationSettings:v,customFieldSettings:He(p),categorySettings:y?{items:(d=y,null==d?void 0:d.map((function(e,t){var n;return{uid:e.uid,name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory,orderIndex:null!==(n=e.orderIndex)&&void 0!==n?n:t}})))}:void 0}},We=function(){var n=d()(u()().mark((function n(){var r,s,i,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=Je)&&r.uid){n.next=4;break}return O.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return",!1);case 4:if(ue(!0),n.prev=5,i=Ve(r)){n.next=10;break}return O.yw.error(e.formatMessage({id:"ticket.settings.save.payload.empty",defaultMessage:"保存数据为空，无法提交"})),n.abrupt("return",!1);case 10:return o=a()(a()({},i),{},{orgUid:null==t?void 0:t.uid,type:null!==(s=null==i?void 0:i.type)&&void 0!==s?s:Oe}),n.next=13,(0,J.mE)(o);case 13:if(l=n.sent,console.log("updateTicketSettings response:",l,o),200!==(null==l?void 0:l.code)){n.next=25;break}return O.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),u=null==l?void 0:l.data,f=r,g=void 0,m=void 0,p=void 0,h=void 0,v=void 0,x=void 0,d=u?a()(a()(a()({},f),u),{},{basicSettings:null!==(g=u.basicSettings)&&void 0!==g?g:f.basicSettings,draftBasicSettings:null!==(m=null!==(p=null!==(h=u.draftBasicSettings)&&void 0!==h?h:u.basicSettings)&&void 0!==p?p:f.draftBasicSettings)&&void 0!==m?m:f.basicSettings,draftCategorySettings:null!==(v=u.draftCategorySettings)&&void 0!==v?v:f.draftCategorySettings,categorySettings:null!==(x=u.categorySettings)&&void 0!==x?x:f.categorySettings}):f,Ie.current=JSON.stringify(null!=d?d:{}),Pe(!1),c((function(e){return e.map((function(e){return e.uid===r.uid?d:e}))})),Ae(we(d)),n.abrupt("return",!0);case 25:return O.yw.error((null==l?void 0:l.message)||e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 27:n.next=34;break;case 29:return n.prev=29,n.t0=n.catch(5),console.error("保存失败:",n.t0),O.yw.error(e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 34:return n.prev=34,ue(!1),n.finish(34);case 37:return n.abrupt("return",!1);case 38:case"end":return n.stop()}var u,f,g,m,p,h,v,x}),n,null,[[5,29,34,37]])})));return function(){return n.apply(this,arguments)}}(),Re=function(){var n=d()(u()().mark((function n(){var r,s,i,a;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=Je)&&r.uid){n.next=4;break}return O.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return");case 4:if(fe(!0),n.prev=5,!Fe){n.next=12;break}return n.next=9,We();case 9:if(n.sent){n.next=12;break}return n.abrupt("return");case 12:return s={uid:r.uid,orgUid:null==t?void 0:t.uid,type:Te(r.type)},n.next=15,(0,J.Ch)(s);case 15:i=n.sent,console.log("publishTicketSettings response:",i,s),200===(null==i?void 0:i.code)?(O.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Ie.current=JSON.stringify(null!==(a=null==i?void 0:i.data)&&void 0!==a?a:{}),Pe(!1),c((function(e){return e.map((function(e){return e.uid===r.uid?null==i?void 0:i.data:e}))})),Ae(we(null==i?void 0:i.data))):O.yw.error((null==i?void 0:i.message)||e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"})),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(5),console.error("发布失败:",n.t0),O.yw.error(e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"}));case 24:return n.prev=24,fe(!1),n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[5,20,24,27]])})));return function(){return n.apply(this,arguments)}}(),Ge=function(e){var t,n,r,s,i,a,o;return{numberPrefix:null!==(t=null==e?void 0:e.numberPrefix)&&void 0!==t?t:"TK",numberLength:null!==(n=null==e?void 0:e.numberLength)&&void 0!==n?n:8,defaultPriority:null!==(r=null==e?void 0:e.defaultPriority)&&void 0!==r?r:"medium",validityDays:null!==(s=null==e?void 0:e.validityDays)&&void 0!==s?s:30,autoCloseHours:null!==(i=null==e?void 0:e.autoCloseHours)&&void 0!==i?i:72,enableAutoClose:null!==(a=null==e?void 0:e.enableAutoClose)&&void 0!==a&&a,requireLogin:null!==(o=null==e?void 0:e.requireLogin)&&void 0!==o&&o}},_e=function(e){var t=Array.isArray(null==e?void 0:e.items)?e.items:[];return je(t)},Qe=null!=Je?Je:ze,Ye=Oe===N.VIL?N.p$M:N.hXJ,$e=(0,g.useMemo)((function(){var e,t;if(null==Qe||!Qe.uid)return[];var n=[{key:"basic",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(C.Z,{})," ",(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.tab.basic",defaultMessage:"基础设置"})]}),children:(0,ee.jsx)("div",{style:{padding:8},children:(0,ee.jsx)(re,{settings:Ge(null!==(e=null==Qe?void 0:Qe.draftBasicSettings)&&void 0!==e?e:null==Qe?void 0:Qe.basicSettings),onChange:function(e){De((function(t){var n,r,s=Ge(null!==(n=null!==(r=t.draftBasicSettings)&&void 0!==r?r:t.basicSettings)&&void 0!==n?n:{});t.draftBasicSettings=a()(a()({},s),e),t.hasUnpublishedChanges=!0}))}})})},{key:"categories",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(w.Z,{})," ",(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.tab.categories",defaultMessage:"分类设置"})]}),children:(0,ee.jsx)("div",{style:{padding:8},children:(0,ee.jsx)(Se,{items:_e(null!==(t=null==Qe?void 0:Qe.draftCategorySettings)&&void 0!==t?t:null==Qe?void 0:Qe.categorySettings),categoryType:Ye,onChange:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=je(e),n=t.filter((function(e){return e.enabled})).length,r=t.length-n,s=t.find((function(e){return e.defaultCategory&&e.enabled}));return{items:t,defaultCategoryUid:null==s?void 0:s.uid,enabledCount:n,disabledCount:r}}(e);De((function(e){e.draftCategorySettings=t,e.hasUnpublishedChanges=!0}))}})})}];return n}),[Qe,e,De,Ye]),et=(0,g.useCallback)((function(e){var t=e.trim();X(t),Ne(t)}),[Ne,X]),tt=[{key:N.DKU,label:e.formatMessage({id:"ticket.settings.scope.external",defaultMessage:"外部工单"})},{key:N.VIL,label:e.formatMessage({id:"ticket.settings.scope.internal",defaultMessage:"内部工单"})}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(p.Z,{activeKey:Oe,onChange:function(e){var t=Te(e);Ue(t),R(void 0),c([]),Ae(null),Ie.current=JSON.stringify({}),Pe(!1)},items:tt}),(0,ee.jsxs)(h.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ee.jsx)(h.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,ee.jsxs)(Z.Z,{title:e.formatMessage({id:"ticket.settings.list",defaultMessage:"工单配置列表"}),extra:(0,ee.jsx)(v.ZP,{size:"small",icon:(0,ee.jsx)(T.Z,{}),type:"primary",onClick:function(){Me(null),he(!0)},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:ne,children:[(0,ee.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ee.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ee.jsx)(y.Z,{placeholder:e.formatMessage({id:"ticket.settings.search.placeholder",defaultMessage:"搜索工单配置"}),value:B,onChange:function(e){return X(e.target.value)},onPressEnter:function(){return et(B)},allowClear:!0,size:"middle"}),(0,ee.jsx)(v.ZP,{type:"primary",size:"middle",onClick:function(){return et(B)},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.search",defaultMessage:"搜索"})})]})}),(0,ee.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ee.jsx)(M.Z,{dataSource:Be,locale:{emptyText:(0,ee.jsx)(k.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:k.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ee.jsx)(M.Z.Item,{style:W===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return R(e.uid)},children:(0,ee.jsx)(M.Z.Item.Meta,{title:(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ee.jsx)(x.Z,{size:4,children:e.isDefault?(0,ee.jsx)(b.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ee.jsx)("div",{style:{color:n?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ee.jsx)(h.Z.Panel,{children:Qe?(0,ee.jsx)(Z.Z,{title:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsxs)("span",{children:[e.formatMessage({id:"ticket.settings.editing",defaultMessage:"编辑工单设置"}),": ",Qe.name||Qe.uid]}),(0,ee.jsx)(j.Z,{checked:!!Qe.enabled,onChange:function(e){return Xe(Qe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ee.jsx)(v.ZP,{size:"small",icon:(0,ee.jsx)(F.Z,{}),onClick:function(e){e.stopPropagation(),ze&&(Me(ze),he(!0))},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.edit",defaultMessage:"编辑"})}),(0,ee.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ke(ze)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(v.ZP,{size:"small",danger:!0,icon:(0,ee.jsx)(P.Z,{}),onClick:function(e){return e.stopPropagation()},children:(0,ee.jsx)(m.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})}),Qe.isDefault?(0,ee.jsx)(b.Z,{color:"blue",children:"默认"}):null,Fe&&(0,ee.jsx)(b.Z,{color:"red",children:(0,ee.jsx)(m.FormattedMessage,{id:"common.unsaved",defaultMessage:"未保存修改"})})]}),extra:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(S.Z,{title:e.formatMessage({id:"ticket.settings.publish.confirm.title",defaultMessage:"发布到线上环境"}),description:e.formatMessage({id:"ticket.settings.publish.confirm.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:e.formatMessage({id:"ticket.settings.publish.confirm.ok",defaultMessage:"继续发布"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Re()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ee.jsx)(v.ZP,{onClick:function(e){return e.stopPropagation()},loading:ce,type:"default",icon:(0,ee.jsx)(I.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ee.jsx)(v.ZP,{onClick:function(){if(ze){var t=Ie.current?JSON.parse(Ie.current):null;Ae(we(t)),Pe(!1),O.yw.info(e.formatMessage({id:"ticket.settings.reset.info",defaultMessage:"已重置为当前发布版本"}))}},disabled:!Fe,icon:(0,ee.jsx)(L.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ee.jsx)(v.ZP,{type:"primary",loading:oe,onClick:We,disabled:!Fe,icon:(0,ee.jsx)(E.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ee.jsx)(p.Z,{activeKey:Q,onChange:Y,items:$e})}):(0,ee.jsx)(Z.Z,{children:(0,ee.jsx)(k.Z,{description:e.formatMessage({id:"ticket.settings.select.settings",defaultMessage:"请从左侧选择工单配置"})})})})]}),(0,ee.jsx)(Ze,{open:pe,record:ye||void 0,ticketType:ye?Te(ye.type):Oe,onClose:function(){return he(!1)},onSuccess:function(){var e=d()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(B);case 2:null!=t&&t.uid&&R(t.uid);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})}}}]);