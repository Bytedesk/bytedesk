"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{39790:function(e,t,n){var a=n(94433),r=n(38956),s=n(44194),i=n(50929),o=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,d=e.proFieldProps,c=(0,r.Z)(e,u);return(0,o.jsx)(i.Z,(0,a.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(l);t.Z=d},7704:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return h},t5:function(){return p},v_:function(){return g}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(39497),d=n(14906);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},41245:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return h},hS:function(){return p},z_:function(){return c}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(39497),d=n(14906);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2011:function(e,t,n){n.d(t,{G:function(){return g}});var a=n(73193),r=n.n(a),s=(n(44194),n(81637)),i=n(39497),o=n(96596),u=n.n(o),l=n(23753),d=n(19433),c=n(5932),f=n(31549),g=function(e){var t=e.children,n=e.onSuccess,a=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var t=u()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,l.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),d.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,f.jsx)(s.Z,r()(r()({},g),{},{children:t}))}},75112:function(e,t,n){var a=n(14597);t.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},85568:function(e,t,n){n.r(t),n.d(t,{default:function(){return me}});var a=n(44194),r=n(67738),s=n(14906),i=n(76711),o=n.n(i),u=n(73193),l=n.n(u),d=n(90819),c=n.n(d),f=n(89933),g=n.n(f),m=n(45332),p=n.n(m),v=n(77033),h=n(82770),x=n(39487),M=n(32525),b=n(50716),y=n(92354),w=n(81739),k=n(66431),S=n(63649),j=n(10162),Z=n(59304),T=n(54881),C=n(49764),U=n(19433),F=n(2890),q=n(98830),I=n(75112),P=n(14597),R=n(39497),A=n(99665),E=n(27153),O=(n(84262),n(66547)),L=(n(94212),n(24479),n(41196)),D=n(86895),N=n(31549),z=function(e){var t=e.open,n=e.onOpenChange,r=e.orgUid,i=e.record,o=e.onSuccess,u=(0,s.useIntl)(),d=L.Z.useForm(),f=p()(d,1)[0];(0,a.useEffect)((function(){var e,n;t&&(i?f.setFieldsValue({name:i.name||"",description:i.description||"",enabled:null===(e=i.enabled)||void 0===e||e,isDefault:null!==(n=i.isDefault)&&void 0!==n&&n}):(f.resetFields(),f.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,i,f]);var m=function(){var e=g()(c()().mark((function e(){var t,a,s,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.validateFields();case 3:if(t=e.sent,a=l()(l()({},t),{},{orgUid:r,uid:null==i?void 0:i.uid}),null==i||!i.uid){e.next=11;break}return e.next=8,(0,F.wU)(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,F.IH)(a);case 13:e.t0=e.sent;case 14:(s=e.t0)&&200===s.code?(d=s.data||{},U.yw.success(u.formatMessage({id:null!=i&&i.uid?"common.updated":"common.created",defaultMessage:null!=i&&i.uid?"更新成功":"创建成功"})),null==o||o(d),n(!1)):U.yw.error((null==s?void 0:s.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)(D.Z,{title:(0,N.jsx)(s.FormattedMessage,{id:null!=i&&i.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=i&&i.uid?"编辑模板":"新建模板"}),open:t,onOk:m,onCancel:function(){n(!1)},okText:(0,N.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,N.jsx)(s.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,N.jsxs)(L.Z,{form:f,layout:"vertical",preserve:!1,children:[(0,N.jsx)(L.Z.Item,{name:"name",label:(0,N.jsx)(s.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:u.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,N.jsx)(M.Z,{placeholder:u.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,N.jsx)(L.Z.Item,{name:"description",label:(0,N.jsx)(s.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,N.jsx)(M.Z.TextArea,{rows:3,placeholder:u.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,N.jsx)(L.Z.Item,{name:"enabled",label:(0,N.jsx)(s.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,N.jsx)(k.Z,{})})]})})},J=n(90631),V=n(1460),B=n(56663),_="welcome",H=function(){var e=(0,s.useIntl)(),t=(0,q.u)((function(e){return e.currentOrg})),n=(0,I.Z)(),i=n.leftSiderStyle,u=(n.contentStyle,(0,P.Z)().isDarkMode),d=(0,a.useState)(!1),f=p()(d,2),m=f[0],L=f[1],D=(0,a.useState)([]),H=p()(D,2),W=H[0],X=H[1],G=(0,a.useState)(),K=p()(G,2),Q=K[0],Y=K[1],$=(0,a.useState)(""),ee=p()($,2),te=ee[0],ne=ee[1],ae=(0,a.useState)(_),re=p()(ae,2),se=re[0],ie=re[1],oe=(0,a.useState)(!1),ue=p()(oe,2),le=ue[0],de=ue[1],ce=(0,a.useState)(null),fe=p()(ce,2),ge=fe[0],me=fe[1],pe=(0,a.useMemo)((function(){return W.find((function(e){return e.uid===Q}))||null}),[W,Q]),ve=(0,a.useState)(!1),he=p()(ve,2),xe=he[0],Me=he[1],be=(0,a.useState)(!1),ye=p()(be,2),we=ye[0],ke=ye[1],Se=(0,A.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),je=Se.setCurrentAgentSettings,Ze=Se.currentAgentSettings,Te=(0,a.useState)(!1),Ce=p()(Te,2),Ue=Ce[0],Fe=Ce[1],qe=(0,a.useRef)(""),Ie=(0,a.useMemo)((function(){if(!te)return W;var e=te.toLowerCase();return W.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),a=(t.description||"").toLowerCase();return n.includes(e)||a.includes(e)}))}),[W,te]),Pe=(0,a.useCallback)(function(){var e=g()(c()().mark((function e(n,a){var r,s,i,o,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return L(!0),e.prev=3,s=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=8,(0,F.u9)(i);case 8:o=e.sent,console.log("查询客服配置模板列表结果：",o,i),u=(null==o||null===(r=o.data)||void 0===r?void 0:r.content)||[],X(u),!(u.length>0)||Q&&u.some((function(e){return e.uid===Q}))||(Y(u[0].uid),null!=a&&a.keepActive||ie(_));case 13:return e.prev=13,L(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,Q]);(0,a.useEffect)((function(){Pe(te)}),[null==t?void 0:t.uid]),(0,a.useEffect)((function(){pe?(je(pe),qe.current=JSON.stringify(null!=pe?pe:{}),Fe(!1)):(je(null),qe.current=JSON.stringify({}),Fe(!1))}),[Q]),(0,a.useEffect)((function(){if(pe)try{var e=JSON.stringify(null!=Ze?Ze:{});Fe(e!==qe.current)}catch(e){Fe(!0)}}),[Ze,null==pe?void 0:pe.uid]);var Re=function(){var n=g()(c()().mark((function n(a){var r,s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=null!=a?a:pe)&&r.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:r.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,F.SJ)(s);case 6:i=n.sent,console.log("删除客服配置模板结果：",i,s),i&&200===i.code?(U.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Pe(te)):U.yw.error((null==i?void 0:i.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Ae=function(){var n=g()(c()().mark((function n(a,r){var s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:a,orgUid:null==t?void 0:t.uid},!r){n.next=8;break}return n.next=5,(0,F.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,F.iO)(s);case 10:n.t0=n.sent;case 11:(i=n.t0)&&200===i.code?(U.yw.success(e.formatMessage({id:r?"common.enabled":"common.disabled",defaultMessage:r?"已启用":"已停用"})),Pe(te)):U.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),U.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),Ee=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Oe=function(e){if(e){var t=Ee(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return Ee(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return l()(l()({},t),n?{toolbar:n}:{})}},Le=function(e){if(e)return Ee(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},De=function(e){if(e)return Ee(e,["name","description","color","order"])},Ne=function(e){if(e)return Ee(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm","worktimeUids"])},ze=function(e){if(e)return Ee(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},Je=function(e){if(e)return Ee(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},Ve=function(e){if(e)return Ee(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Be=function(e){if(e)return Ee(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},_e=function(){var n=g()(c()().mark((function n(){var a,r,s,i,o,u,d;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return U.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Me(!0),n.prev=4,a=Ze&&Ze.uid===pe.uid?Ze:pe,r=function(e,t){return l()(l()({},e||{}),t||{})},s={uid:pe.uid,orgUid:null==t?void 0:t.uid,name:null==a?void 0:a.name,description:null==a?void 0:a.description,isDefault:null==a?void 0:a.isDefault,enabled:null==a?void 0:a.enabled,serviceSettings:Oe(r(null==a?void 0:a.serviceSettings,null==a?void 0:a.draftServiceSettings)),inviteSettings:Le(r(null==a?void 0:a.inviteSettings,null==a?void 0:a.draftInviteSettings)),intentionSettings:De(r(null==a?void 0:a.intentionSettings,null==a?void 0:a.draftIntentionSettings)),maxThreadCount:null==a?void 0:a.maxThreadCount,timeoutRemindEnabled:null==a?void 0:a.timeoutRemindEnabled,timeoutRemindTime:null==a?void 0:a.timeoutRemindTime,timeoutRemindTip:null==a?void 0:a.timeoutRemindTip,messageLeaveSettings:Ne(r(null==a?void 0:a.messageLeaveSettings,null==a?void 0:a.draftMessageLeaveSettings)),autoReplySettings:Je(r(null==a?void 0:a.autoReplySettings,null==a?void 0:a.draftAutoReplySettings)),queueSettings:ze(r(null==a?void 0:a.queueSettings,null==a?void 0:a.draftQueueSettings)),rateDownSettings:Ve(r(null==a?void 0:a.rateDownSettings,null==a?void 0:a.draftRateDownSettings)),agentStatusSettings:Be(r(null==a?void 0:a.agentStatusSettings,null==a?void 0:a.draftAgentStatusSettings))},n.next=10,(0,F.wU)(s);case 10:i=n.sent,console.log("保存客服配置模板结果：",i,s),i&&200===i.code?(U.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),d=null!==(o=null!==(u=i.data)&&void 0!==u?u:a)&&void 0!==o?o:{},qe.current=JSON.stringify(d),Fe(!1),Pe(te,{keepActive:!0})):U.yw.error((null==i?void 0:i.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),U.yw.error("保存失败");case 19:return n.prev=19,Me(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),He=function(){var n=g()(c()().mark((function n(){var a,r,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return U.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ke(!0),n.prev=4,!Ue){n.next=8;break}return n.next=8,_e();case 8:return a={uid:pe.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,F.Xy)(a);case 11:(r=n.sent)&&200===r.code?(U.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),qe.current=JSON.stringify(null!==(s=r.data)&&void 0!==s?s:{}),Fe(!1),Pe(te)):U.yw.error((null==r?void 0:r.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),U.yw.error("发布失败");case 19:return n.prev=19,ke(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),We=(0,a.useMemo)((function(){return null!=pe&&pe.uid?[{key:"welcome",label:(0,N.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,N.jsx)(B.Z,{type:R.Njn,settingsUid:pe.uid})},{key:"tips",label:(0,N.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"}),children:(0,N.jsx)(V.Z,{type:R.Njn,settingsUid:pe.uid})},{key:"service",label:(0,N.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"}),children:(0,N.jsx)(J.Z,{type:R.Njn,settingsUid:pe.uid})},{key:"rate",label:(0,N.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,N.jsx)(E.Z,{type:R.Njn,settingsUid:pe.uid})}].concat(o()([]),[{key:"right",label:(0,N.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,N.jsx)(O.Z,{type:R.Njn,settingsUid:pe.uid,isActive:"right"===se})}],o()([]),o()([])):[]}),[null==pe?void 0:pe.uid,e]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,N.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:i,children:(0,N.jsxs)(C.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(j.Z,{}),type:"primary",onClick:function(){me(null),de(!0)},children:(0,N.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:m,children:[(0,N.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,N.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,N.jsx)(M.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:te,onChange:function(e){return ne(e.target.value)},onPressEnter:function(e){Pe(te)},allowClear:!0,size:"middle"}),(0,N.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return Pe(te)},children:"搜索"})]})}),(0,N.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,N.jsx)(b.Z,{dataSource:Ie,locale:{emptyText:(0,N.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,N.jsx)(b.Z.Item,{style:Q===e.uid?{backgroundColor:u?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Y(e.uid)},children:(0,N.jsx)(b.Z.Item.Meta,{title:(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,N.jsx)(x.Z,{size:4,children:e.isDefault?(0,N.jsx)(w.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,N.jsx)("div",{style:{color:u?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,N.jsx)(v.Z.Panel,{children:pe?(0,N.jsx)(C.Z,{title:(0,N.jsxs)(x.Z,{children:[(0,N.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",pe.name||pe.uid]}),(0,N.jsx)(k.Z,{checked:pe.enabled,onChange:function(e){return Ae(pe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(Z.Z,{}),onClick:function(e){var t;e.stopPropagation(),me(null!=(t=pe)?t:pe),de(!0)},children:"编辑"}),(0,N.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Re(pe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,N.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,N.jsx)(T.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),pe.isDefault?(0,N.jsx)(w.Z,{color:"blue",children:"默认"}):null]}),extra:(0,N.jsxs)(x.Z,{children:[(0,N.jsx)(S.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),He()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,N.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:we,type:"default",children:(0,N.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,N.jsx)(h.ZP,{onClick:function(){pe&&(je(pe),qe.current=JSON.stringify(null!=pe?pe:{}),Fe(!1))},disabled:!Ue,children:(0,N.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,N.jsx)(h.ZP,{type:"primary",loading:xe,onClick:_e,disabled:!Ue,children:(0,N.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,N.jsx)(r.Z,{activeKey:se,onChange:ie,items:We,style:{minHeight:"calc(100vh - 280px)"}})}):(0,N.jsx)(C.Z,{children:(0,N.jsx)(y.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,N.jsx)(z,{open:le,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:ge,onSuccess:function(){de(!1),Pe(te)}})]})},W=n(86222),X=n.n(W),G=n(89246),K=n(33797),Q=n(33019),Y=n(75864),$=n(25784),ee=n(2250),te=n(89965),ne=n(80953),ae=n(59908),re=n(41245),se=n(2011),ie=function(e){var t,n,r=e.open,i=e.record,u=e.onClose,d=e.onSuccess,f=(0,s.useIntl)(),m=(0,q.u)((function(e){return e.currentOrg})),v=(0,a.useState)(!1),x=p()(v,2),M=x[0],b=x[1],y=(0,a.useState)([]),w=p()(y,2),k=w[0],S=w[1],Z=(0,a.useState)(!1),T=p()(Z,2),C=T[0],I=T[1],P=(0,a.useState)((null==i?void 0:i.avatar)||""),R=p()(P,2),A=R[0],E=R[1],O=(0,a.useState)(0),L=p()(O,2),D=L[0],J=L[1],V=(0,a.useRef)(),B=(0,a.useMemo)((function(){return!(null==i||!i.uid)}),[i]),_=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(t),U.yw.success(f.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=(0,a.useCallback)(function(){var e=g()(c()().mark((function e(t){var n,a,r,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(!0),e.prev=1,a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==m?void 0:m.uid,searchText:t||""},e.next=5,(0,F.u9)(a);case 5:return r=e.sent,console.log("queryAgentSettingsByOrg request:",a,r),s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],S(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 10:return e.prev=10,I(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[1,,10,13]])})));return function(t){return e.apply(this,arguments)}}(),[null==m?void 0:m.uid]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(Y.a,{open:r,onOpenChange:function(e){e||u()},title:B?f.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):f.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:V,initialValues:B?{nickname:null==i?void 0:i.nickname,email:null==i?void 0:i.email,mobile:null==i?void 0:i.mobile,description:null==i?void 0:i.description,memberUid:(null==i||null===(t=i.member)||void 0===t?void 0:t.uid)||(null==i?void 0:i.memberUid),settingsUid:null==i||null===(n=i.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:f.formatMessage({id:"save",defaultMessage:"保存"}),resetText:f.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return u()}}},onFinish:function(){var e=g()(c()().mark((function e(t){var n,a,r,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,U.yw.loading(f.formatMessage({id:B?"updating":"creating",defaultMessage:B?"Updating":"Creating"})),!B){e.next=10;break}return r=l()(l()(l()({},i),t),{},{avatar:A||(null==i?void 0:i.avatar)}),e.next=6,(0,Q.sE)(r);case 6:a=e.sent,console.log("updateAgent payload:",r,a),e.next=15;break;case 10:return s={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==m?void 0:m.uid,avatar:A},e.next=13,(0,Q.x_)(s);case 13:a=e.sent,console.log("createAgent payload:",s,a);case 15:if(U.yw.destroy(),200!==(null===(n=a)||void 0===n?void 0:n.code)){e.next=23;break}return U.yw.success(f.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(a.data),u(),e.abrupt("return",!0);case 23:return U.yw.error((null===(o=a)||void 0===o?void 0:o.message)||f.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),U.yw.destroy(),U.yw.error(f.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,N.jsx)($.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:f.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,N.jsxs)(se.G,{onSuccess:_,onError:function(e){U.yw.error(String(e))},children:[(0,N.jsx)(K.Z,{src:A||(null==i?void 0:i.avatar)}),(0,N.jsxs)(h.ZP,{icon:(0,N.jsx)(ae.Z,{}),children:[" ",f.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,N.jsx)(ee.Z,{name:"memberUid",label:f.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:f.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:B,rules:B?[]:[{required:!0,message:f.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=g()(c()().mark((function e(t){var n,a,r,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.next=3,(0,re.z_)({pageNumber:0,pageSize:20,orgUid:null==m?void 0:m.uid,searchText:a||""});case 3:return r=e.sent,s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,N.jsx)(ee.Z,{name:"settingsUid",label:f.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),placeholder:f.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),rules:[{required:!0,message:f.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:D},request:function(){var e=g()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",H(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:C,notFoundContent:0===k.length?(0,N.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,N.jsx)("div",{style:{marginBottom:8,color:"#999"},children:f.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,N.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,N.jsx)(j.Z,{}),onClick:function(){return b(!0)},children:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(j.Z,{}),onClick:function(){return b(!0)},title:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"}),children:f.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,N.jsx)(te.Z,{name:"nickname",label:f.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.nickname.required"})}]}),(0,N.jsx)(te.Z,{name:"email",label:f.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.email.required"})}]}),(0,N.jsx)(te.Z,{name:"mobile",label:f.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.mobile.required"})}]}),(0,N.jsx)(ne.Z,{name:"description",label:f.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,N.jsx)(z,{open:M,onOpenChange:b,orgUid:(null==m?void 0:m.uid)||"",record:null,onSuccess:function(e){var t;b(!1),S((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(o()(t))})),J((function(e){return e+1})),null===(t=V.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},oe=n(50246),ue=n(10404),le=n(76273),de=n(39790),ce=n(90727),fe=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,i=(0,s.useIntl)(),u=le.ZP.useForm(),d=p()(u,1)[0],f=(0,q.u)((function(e){return e.currentOrg})),m=(0,oe.Z)((function(e){return e.memberResult})),v=(0,oe.Z)((function(e){return e.setMemberResult})),x=(0,ue.E)((function(e){return e.agentResult})),b=(0,a.useState)(0),y=p()(b,2),w=y[0],k=y[1],S=(0,a.useState)(""),j=p()(S,2),Z=j[0],T=j[1],C=(0,a.useState)(!1),U=p()(C,2),I=U[0],P=U[1],R=(0,a.useState)([]),A=p()(R,2),E=A[0],O=A[1],L=(0,a.useRef)(null),z=(0,a.useState)(0),J=p()(z,2),V=J[0],B=J[1],_=(0,a.useState)(!0),H=p()(_,2),W=H[0],X=H[1],G=(0,a.useState)(!1),K=p()(G,2),Q=K[0],Y=K[1],$=(0,a.useState)(0),ne=p()($,2),ae=ne[0],se=ne[1],ie=(0,a.useState)(!0),fe=p()(ie,2),ge=fe[0],me=fe[1],pe=(0,a.useState)(!1),ve=p()(pe,2),he=ve[0],xe=ve[1],Me=(0,a.useState)(!1),be=p()(Me,2),ye=be[0],we=be[1],ke=(0,a.useState)([]),Se=p()(ke,2),je=Se[0],Ze=Se[1];(0,a.useEffect)((function(){var e;t&&(console.log("Modal opened, current agent data:",x),console.log("Current member data:",m),null!=m&&null!==(e=m.data)&&void 0!==e&&e.content&&0!==m.data.content.length||g()(c()().mark((function e(){var t,n,a,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==f?void 0:f.uid},e.next=4,(0,re.z_)(n);case 4:a=e.sent,console.log("Init load members response:",a,n),(r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[]).length>0&&v(l()(l()({},m),{},{data:l()(l()({},null==m?void 0:m.data),{},{content:r})})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Init load members failed:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),g()(c()().mark((function e(){var t,n,a,r,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,we(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==f?void 0:f.uid,searchText:""},e.next=5,(0,F.u9)(n);case 5:a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],s=r.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (".concat(i.formatMessage({id:"agent.settings.template.isDefault",defaultMessage:"默认"}),")"):"").concat(e.enabled?"":" (".concat(i.formatMessage({id:"app.disabled",defaultMessage:"已停用"}),")")),value:e.uid}})),Ze(s),!d.getFieldValue("settingsUid")&&s.length>0&&d.setFieldsValue({settingsUid:s[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,we(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))())}),[t,x,m]),(0,a.useEffect)((function(){return function(){L.current&&clearTimeout(L.current)}}),[]);var Te=(0,a.useMemo)((function(){var e=x.data.content.map((function(e){var t;return(null===(t=e.member)||void 0===t?void 0:t.uid)||e.memberUid})).filter((function(e){return e}));return console.log("Existing agent member UIDs:",e),console.log("Agent result data:",x.data.content),e}),[x]),Ce=(0,a.useMemo)((function(){var e,t,n,a=[],r=Z.trim()?E:(null==m||null===(e=m.data)||void 0===e?void 0:e.content)||[];console.log("Total members:",r.length),console.log("Existing agent member UIDs:",Te),console.log("Using search results:",!!Z.trim());for(var s=0;s<r.length;s++){var i=r[s];if(Te.includes(i.uid))console.log("Filtering out member:",i.nickname,i.uid);else{var o={title:"",value:"",children:[]};(n=o).title=(t=i).nickname,n.value=t.uid,a.push(o)}}return console.log("Filtered tree data:",a),a}),[m,E,Z,Te]),Ue=function(){var e=g()(c()().mark((function e(t){var n,a,r,s,i=arguments;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],console.log("handleSearch:",t,"isLoadMore:",n),t.trim()||n){e.next=7;break}return O([]),B(0),X(!0),e.abrupt("return");case 7:return n?Y(!0):P(!0),e.prev=8,a={pageNumber:n?V+1:0,pageSize:20,orgUid:null==f?void 0:f.uid,searchText:t.trim()},e.next=12,(0,re.z_)(a);case 12:r=e.sent,console.log("handleSearch Search members response:",r,a),200===r.code?(s=r.data.content||[],n?(O((function(e){return[].concat(o()(e),o()(s))})),B(V+1)):(O(s),B(0)),X(!r.data.last)):(console.error("handleSearch Search failed:",r.message),n||O([])),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),console.error("Search error:",e.t0),n||O([]);case 21:return e.prev=21,n?Y(!1):P(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[8,17,21,24]])})));return function(t){return e.apply(this,arguments)}}(),Fe=function(e){var t=e.target.value;T(t),L.current&&clearTimeout(L.current),t.trim()?L.current=setTimeout((function(){Ue(t)}),300):(O([]),B(0),X(!0))},qe=function(){Ue(Z)},Ie=function(){!Q&&W&&Z.trim()&&Ue(Z,!0)},Pe=function(){var e=g()(c()().mark((function e(){var t,n,a,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(he||!ge){e.next=17;break}return xe(!0),e.prev=2,t={pageNumber:ae+1,pageSize:20,orgUid:null==f?void 0:f.uid},e.next=6,(0,re.z_)(t);case 6:n=e.sent,console.log("Load more all members response:",n),200===n.code&&(a=n.data.content||[],r=[].concat(o()(m.data.content),o()(a)),v(l()(l()({},m),{},{data:l()(l()({},m.data),{},{content:r})})),se(ae+1),me(!n.data.last)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 14:return e.prev=14,xe(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)("div",{children:(0,N.jsx)(D.Z,{title:i.formatMessage({id:"agent.create",defaultMessage:"创建客服"}),open:t,forceRender:!0,onOk:function(){console.log("handleOk"),d.validateFields().then((function(e){var t;console.log("form values:",e);var n=d.getFieldValue("memberUids"),a=d.getFieldValue("nickname"),s=d.getFieldValue("email"),i=d.getFieldValue("mobile"),o=d.getFieldValue("settingsUid"),u=Z.trim()?E:(null==m||null===(t=m.data)||void 0===t?void 0:t.content)||[],l=[];if(1===n.length){var c={nickname:a,email:s,mobile:i,memberUid:n[0],orgUid:null==f?void 0:f.uid,settingsUid:o};l.push(c)}else n.forEach((function(e){var t=u.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==f?void 0:f.uid,settingsUid:o};l.push(n)}}));console.log("agents:",l),r(l)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,N.jsxs)(le.ZP,{form:d,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,N.jsx)(ee.Z,{label:i.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),name:"settingsUid",tooltip:i.formatMessage({id:"agent.settings.tooltip",defaultMessage:"为本次创建的客服指定配置模板"}),rules:[{required:!0,message:i.formatMessage({id:"agent.settings.required.message",defaultMessage:"请选择客服配置!"})}],fieldProps:{options:je,loading:ye,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:i.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"})}}),(0,N.jsx)(de.Z,{label:i.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),name:"memberUids",tooltip:i.formatMessage({id:"agent.info.member.tooltip",defaultMessage:"请先到组织-》成员-》创建成员，已创建过客服的成员将被过滤"}),rules:[{required:!0,message:i.formatMessage({id:"agent.info.member.required.message",defaultMessage:"请选择成员!"})}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:i.formatMessage({id:"agent.info.member.placeholder.multiple",defaultMessage:"请选择成员（可多选）"}),onChange:function(e){var t;console.log("onTreeSelectChange:",e),k(e.length);var n=Z.trim()?E:(null==m||null===(t=m.data)||void 0===t?void 0:t.content)||[];if(0===e.length)d.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===e.length){var a=n.find((function(t){return t.uid===e[0]}));a&&d.setFieldsValue({nickname:a.nickname||"",email:a.email||"",mobile:a.mobile||""})}else{var r=n.filter((function(t){return e.includes(t.uid)})),s=r.map((function(e){return e.nickname})).filter(Boolean).join(", "),i=r.map((function(e){return e.email})).filter(Boolean).join(", "),o=r.map((function(e){return e.mobile})).filter(Boolean).join(", ");d.setFieldsValue({nickname:s,email:i,mobile:o})}},treeData:Ce,variant:"outlined",popupRender:function(e){return(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,N.jsx)(M.Z,{placeholder:i.formatMessage({id:"agent.info.member.search",defaultMessage:"搜索成员"}),value:Z,onChange:Fe,onPressEnter:function(){return qe()},suffix:(0,N.jsx)(ce.Z,{onClick:qe,style:{cursor:"pointer",color:I?"#1890ff":void 0},spin:I}),allowClear:!0,size:"small"})}),e,(Z.trim()?W:ge)&&(0,N.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,N.jsx)(h.ZP,{type:"link",size:"small",loading:Z.trim()?Q:he,onClick:Z.trim()?Ie:Pe,disabled:Z.trim()?Q:he,children:(Z.trim()?Q:he)?i.formatMessage({id:"loading",defaultMessage:"加载中..."}):i.formatMessage({id:"load.more",defaultMessage:"加载更多"})})})]})}}}),(0,N.jsx)(te.Z,{label:i.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),name:"nickname",disabled:w>1,tooltip:w>1?i.formatMessage({id:"agent.info.nickname.tooltip.multiple",defaultMessage:"多选模式下昵称将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.nickname.tooltip",defaultMessage:"昵称将自动从选中的成员信息中获取"})}),(0,N.jsx)(te.Z,{label:i.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),name:"email",disabled:w>1,tooltip:w>1?i.formatMessage({id:"agent.info.email.tooltip.multiple",defaultMessage:"多选模式下邮箱将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.email.tooltip",defaultMessage:"邮箱将自动从选中的成员信息中获取"})}),(0,N.jsx)(te.Z,{label:i.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),name:"mobile",disabled:w>1,tooltip:w>1?i.formatMessage({id:"agent.info.mobile.tooltip.multiple",defaultMessage:"多选模式下手机号将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.mobile.tooltip",defaultMessage:"手机号将自动从选中的成员信息中获取"})})]})})})},ge=function(){var e=(0,s.useIntl)(),t=(0,a.useRef)(),n=(0,q.u)((function(e){return e.currentOrg})),r=(0,a.useState)(!1),i=p()(r,2),o=i[0],u=i[1],l=(0,a.useState)(!1),d=p()(l,2),f=d[0],m=d[1],v=(0,a.useState)(null),x=p()(v,2),M=x[0],b=x[1],y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,N.jsx)(K.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,N.jsx)("a",{onClick:function(){b(n),u(!0)},children:n.settings.name||e.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,N.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){b(n),u(!0)},children:e.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(t,n){switch(null==n?void 0:n.status){case R.Ra4:return(0,N.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case R.tU$:return(0,N.jsx)(w.Z,{color:"orange",children:e.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case R.LZ1:default:return(0,N.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:e.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(t,n){return null!=n&&n.connected?(0,N.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,N.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,a){return[(0,N.jsx)("a",{onClick:function(){return s.history.push("/service/channel")},children:e.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,N.jsx)("a",{onClick:function(){b(a),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,N.jsx)(S.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==a?void 0:a.nickname,"】？"),onConfirm:g()(c()().mark((function n(){var r,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return U.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,Q.Lr)(a);case 4:r=n.sent,U.yw.destroy(),200===(null==r?void 0:r.code)?(U.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=t.current)||void 0===s||s.reload()):U.yw.error((null==r?void 0:r.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),U.yw.destroy(),U.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,N.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(G.Z,{columns:y,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,N.jsx)(h.ZP,{type:"primary",onClick:function(){b(null),m(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=g()(c()().mark((function e(t,a){var r,s,i,o,u,l,d,f,g,m,p,v,h,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,u=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,l=null!==(i=null==t?void 0:t.searchText)&&void 0!==i?i:"",d={pageNumber:o,pageSize:u,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:l},e.prev=4,e.next=7,(0,Q._t)(d);case 7:if(f=e.sent,console.log("queryAgentsByOrg response:",f,d),200!==(null==f?void 0:f.code)){e.next=13;break}return x=(null==f||null===(g=f.data)||void 0===g?void 0:g.content)||[],M=null!==(m=null!==(p=null==f||null===(v=f.data)||void 0===v?void 0:v.totalElements)&&void 0!==p?p:null==f||null===(h=f.data)||void 0===h?void 0:h.numberOfElements)&&void 0!==m?m:x.length,e.abrupt("return",{data:x,total:M,success:!0});case 13:return e.abrupt("return",{data:[],total:0,success:!1});case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent",defaultMessage:"Agent"})}),o&&(0,N.jsx)(ie,{open:o,record:M,onClose:function(){return u(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),f&&(0,N.jsx)(fe,{open:f,onClose:function(){return m(!1)},onSubmit:function(){var n=g()(c()().mark((function n(a){var r,s,i,o,u,l,d,f,g,p,v,h,x,M,b,y;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(((null==a?void 0:a.length)||0)>200)){n.next=3;break}return U.yw.warning(e.formatMessage({id:"agent.create.batch.limit",defaultMessage:"超过最大批量 200，请分批创建"})),n.abrupt("return");case 3:r="agent-batch-create",U.yw.loading({content:e.formatMessage({id:"saving",defaultMessage:"Saving..."}),key:r,duration:0}),s=[],i=function(e){return new Promise((function(t){return setTimeout(t,e)}))},o=X()(a),n.prev=8,o.s();case 10:if((u=o.n()).done){n.next=52;break}l=u.value,d=0,f=!1,g=null;case 15:if(!(d<3)||f){n.next=49;break}return n.prev=16,n.next=19,(0,Q.x_)(l);case 19:if(200!==(null==(p=n.sent)?void 0:p.code)){n.next=24;break}return s.push({uid:l.memberUid,ok:!0}),f=!0,n.abrupt("break",49);case 24:return s.push({uid:l.memberUid,ok:!1,code:null==p?void 0:p.code,msg:null==p?void 0:p.message}),f=!0,n.abrupt("break",49);case 29:if(n.prev=29,n.t0=n.catch(16),h=null===n.t0||void 0===n.t0||null===(v=n.t0.response)||void 0===v?void 0:v.status,g=n.t0,d+=1,!(409===h&&d<3)){n.next=40;break}return n.next=37,i(300*d);case 37:return n.abrupt("continue",15);case 40:if(502!==h&&503!==h&&504!==h||!(d<3)){n.next=44;break}return n.next=43,i(300*d);case 43:return n.abrupt("continue",15);case 44:return s.push({uid:l.memberUid,ok:!1,code:h,msg:(null===n.t0||void 0===n.t0?void 0:n.t0.message)||"error"}),f=!0,n.abrupt("break",49);case 47:n.next=15;break;case 49:!f&&g&&s.push({uid:l.memberUid,ok:!1,msg:(null===(x=g)||void 0===x?void 0:x.message)||"error"});case 50:n.next=10;break;case 52:n.next=57;break;case 54:n.prev=54,n.t1=n.catch(8),o.e(n.t1);case 57:return n.prev=57,o.f(),n.finish(57);case 60:M=s.filter((function(e){return e.ok})).length,b=s.length-M,M>0?(U.yw.success({content:e.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(M,")"),key:r}),m(!1),null===(y=t.current)||void 0===y||y.reload()):U.yw.destroy(r),b>0&&U.yw.warning(e.formatMessage({id:"create.partial.failed",defaultMessage:"部分创建失败，请查看失败项并重试"})+" (".concat(b,")"));case 64:case"end":return n.stop()}}),n,null,[[8,54,57,60],[16,29]])})));return function(e){return n.apply(this,arguments)}}()})]})},me=function(){return(0,N.jsx)(r.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,N.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,N.jsx)(ge,{})},{key:"settings",label:(0,N.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,N.jsx)(H,{})}]})}},50246:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(39497),r=n(58063),s=n(66266),i=n(31403),o=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n.splice(a,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:a.PQL})))}}]);