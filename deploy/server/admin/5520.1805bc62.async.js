"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5520],{60028:function(e,t,r){r.d(t,{Lp:function(){return h},Pn:function(){return x},c5:function(){return M},ln:function(){return f},p:function(){return l}});var a=r(90819),n=r.n(a),s=r(73193),o=r.n(s),i=r(89933),u=r.n(i),d=r(68992),c=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/tag/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/tag/create",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/tag/update",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/tag/delete",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/tag/delete/all",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},88835:function(e,t,r){r.d(t,{EG:function(){return p},bN:function(){return m},fk:function(){return c},l8:function(){return g}});var a=r(90819),n=r.n(a),s=r(73193),o=r.n(s),i=r(89933),u=r.n(i),d=r(62395);function c(e){return l.apply(this,arguments)}function l(){return(l=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/update/tagList",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/delete",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/process/history/activity",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},65520:function(e,t,r){r.d(t,{Z:function(){return R}});var a=r(84176),n=r.n(a),s=r(73193),o=r.n(s),i=r(86222),u=r.n(i),d=r(90819),c=r.n(d),l=r(89933),p=r.n(l),f=r(45332),g=r.n(f),h=r(61489),m=r(88835),x=r(77686),v=r(68992),M=r(87005),y=r(91768),w=r(28031),k=r(80503),b=r(54596),j=r(62395),S=r(66248),F=r(33633),T=r(77902),I=r(6237),C=r(72264),Z=r(44194),L=r(74039),P=r(70878),q=r(41059),N=r(89654),E=r(78380),A=r(60028),O=r(99754),U=r(31549),D=function(e){var t=e.open,r=e.onClose,a=e.onSubmit,n=e.thread,s=e.orgUid,o=(0,j.useIntl)(),i=(0,O.Z)().translateString,u=P.Z.useForm(),d=g()(u,1)[0],l=(0,Z.useState)([]),f=g()(l,2),x=f[0],M=f[1],y=(0,Z.useState)(!1),w=g()(y,2),k=w[0],b=w[1],S=(0,Z.useMemo)((function(){var e;return 1===(null==n||null===(e=n.tagList)||void 0===e?void 0:e.length)&&""===n.tagList[0]?[]:(null==n?void 0:n.tagList)||[]}),[null==n?void 0:n.tagList]);(0,Z.useEffect)((function(){t&&s&&F()}),[t,s]),(0,Z.useEffect)((function(){t&&n&&d.setFieldsValue({tagList:S})}),[t,n,S,d]);var F=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,A.p)({orgUid:s,type:v.bDv});case 3:200===(t=e.sent).code?M(t.data.content||[]):h.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),h.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=p()(c()().mark((function e(){var t,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,b(!0),e.next=6,d.validateFields();case 6:return t=e.sent,e.next=9,(0,m.EG)({uid:n.uid,tagList:t.tagList||[],orgUid:n.orgUid});case 9:200===(s=e.sent).code?(h.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),a(),r()):h.yw.error(s.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),h.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,b(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,U.jsx)(q.Z,{title:o.formatMessage({id:"edit.thread",defaultMessage:"编辑会话"}),placement:"right",onClose:r,open:t,width:400,extra:(0,U.jsxs)(N.Z,{children:[(0,U.jsx)(C.ZP,{onClick:r,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,U.jsx)(C.ZP,{type:"primary",onClick:T,loading:k,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,U.jsx)(P.Z,{form:d,layout:"vertical",initialValues:{tagList:S},children:(0,U.jsx)(P.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,U.jsx)(E.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:x.map((function(e){return{label:i(e.name),value:e.name}})),filterOption:function(e,t){var r;return(null!==(r=null==t?void 0:t.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())}})})})})},G=["current","pageSize"],R=function(e){var t=e.type,r=e.superUser,a=(0,j.useIntl)(),s=(0,Z.useRef)(),i=(0,Z.useState)(1),d=g()(i,2),l=d[0],f=d[1],P=(0,Z.useState)(10),q=g()(P,2),N=q[0],E=q[1],A=(0,x.u)((function(e){return e.currentOrg})),O=S.Z.useModal(),R=g()(O,2),z=(R[0],R[1]),B=(0,Z.useState)([]),J=g()(B,2),V=J[0],X=J[1],K=(0,Z.useState)([]),Q=g()(K,2),H=Q[0],W=Q[1],Y=(0,Z.useState)(0),$=g()(Y,2),_=$[0],ee=$[1],te=(0,Z.useState)({}),re=g()(te,2),ae=re[0],ne=re[1],se=(0,Z.useState)(!1),oe=g()(se,2),ie=oe[0],ue=oe[1],de=(0,Z.useState)(null),ce=g()(de,2),le=ce[0],pe=ce[1],fe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,U.jsx)(j.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,U.jsx)(j.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,ellipsis:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var r;return(0,U.jsx)(U.Fragment,{children:null==t||null===(r=t.user)||void 0===r?void 0:r.nickname})}},{title:(0,U.jsx)(j.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",copyable:!0,ellipsis:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.agentNickname.tooltip"}),render:function(e,t){var r,a;return(0,U.jsx)(U.Fragment,{children:null!=t&&null!==(r=t.agentProtobuf)&&void 0!==r&&r.nickname?null==t||null===(a=t.agentProtobuf)||void 0===a?void 0:a.nickname:"无"})}},{title:(0,U.jsx)(j.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",copyable:!0,ellipsis:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.robotNickname.tooltip"}),render:function(e,t){var r,a;return(0,U.jsx)(U.Fragment,{children:null!=t&&null!==(r=t.robotProtobuf)&&void 0!==r&&r.nickname?null==t||null===(a=t.robotProtobuf)||void 0===a?void 0:a.nickname:"无"})}},{title:(0,U.jsx)(j.FormattedMessage,{id:"queue.member.workgroup",defaultMessage:"workgroupNickname"}),dataIndex:"workgroupNickname",copyable:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.workgroupNickname.tooltip"}),render:function(e,t){var r,a;return(0,U.jsx)(U.Fragment,{children:null!=t&&null!==(r=t.workgroupProtobuf)&&void 0!==r&&r.nickname?null==t||null===(a=t.workgroupProtobuf)||void 0===a?void 0:a.nickname:"无"})}},{title:(0,U.jsx)(j.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case v.ach:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.new"});case v.j0C:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.roboting"});case v.Q7C:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.offline"});case v.v1N:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.queuing"});case v.hl2:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.chatting"});case v.V1n:return(0,U.jsx)(j.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,U.jsx)(j.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,U.jsx)(j.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,L.YG)(t.channel)}},{title:(0,U.jsx)(j.FormattedMessage,{id:"thread.tagList",defaultMessage:"Tag List"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.tagList.tooltip"}),render:function(e,t){var r;return null==t||null===(r=t.tagList)||void 0===r?void 0:r.map((function(e,t){return(0,U.jsx)(F.Z,{color:"blue",style:{marginRight:4},children:e},t)}))}},{title:(0,U.jsx)(j.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,U.jsx)(j.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,U.jsx)(j.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.type.tooltip"})},{title:(0,U.jsx)(j.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.topic.tooltip"})},{title:(0,U.jsx)(j.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.owner.tooltip"}),render:function(e,t){var r;return(0,U.jsx)(U.Fragment,{children:null==t||null===(r=t.owner)||void 0===r?void 0:r.nickname})}}],ge=function(){var e=p()(c()().mark((function e(t){var r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleDeleteConfirm",t),h.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=2,e.next=5,(0,m.l8)({uid:t.uid});case 5:r=e.sent,h.yw.destroy(),200===r.code?(h.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(n=s.current)||void 0===n||n.reload()):h.yw.error(r.message||a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),h.yw.destroy(),h.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),he=[].concat(fe,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",tooltip:(0,U.jsx)(j.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,r,n){return[(0,U.jsx)("a",{onClick:function(){!function(e){var t;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==A?void 0:A.uid,t:v.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,U.jsx)("a",{style:{marginLeft:8},onClick:function(){pe(t),ue(!0)},children:a.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,U.jsx)(T.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ge(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,U.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),me=function(){var e=p()(c()().mark((function e(){var t,r,n,o,i,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==H.length){e.next=3;break}return h.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:h.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,n=0,o=u()(H),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return d=i.value,e.prev=11,e.next=14,(0,m.l8)({uid:d.uid});case 14:200===e.sent.code?r++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:h.yw.destroy(),0===n?h.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):h.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:n})),X([]),W([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=p()(c()().mark((function e(r,a,n){var s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,n),s=localStorage.getItem(v.LA8),i=o()({componentType:t,orgUid:(null==A?void 0:A.uid)||"",accessToken:s||"",exportType:r},ae),"current"===r?(i.pageNumber=String(l-1),i.pageSize=String(N)):"all"===r?(i.pageNumber="0",i.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==n&&(i.pageNumber=String(a),i.pageSize=String(n)),window.open((0,M.kG)()+"/api/v1/thread/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),n=function(){var a=s,n=s*r+1,o=Math.min((s+1)*r,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return xe("range",a,r)}})},s=0;s<a;s++)n();return t},Me={selectedRowKeys:V,onChange:function(e,t){X(e),W(t)}};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(b.Z,{columns:he,actionRef:s,cardBordered:!0,rowSelection:Me,scroll:{x:"max-content"},request:function(){var e=p()(c()().mark((function e(a,s,i){var u,d,l,p,g,x,v,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,s,i),u=a.current,d=a.pageSize,l=n()(a,G),f(u),E(d),ne(l),p=void 0,g=void 0,s&&Object.keys(s).length>0&&(x=Object.keys(s)[0],p=x,g="ascend"===s[x]?"ascend":"descend"),v=o()(o()({pageNumber:u-1,pageSize:d,componentType:t,orgUid:null==A?void 0:A.uid,mergeByTopic:!1,superUser:r},l),{},{sortBy:p,sortDirection:g}),e.next=11,(0,m.fk)(v);case 11:return M=e.sent,console.log("getAllThreads response:",M,v),200===M.code?ee(M.data.totalElements):h.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];V.length>0&&t.push({key:"batchDelete",icon:(0,U.jsx)(y.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(V.length,")"),onClick:function(){S.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(V.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:me,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,U.jsx)(w.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xe("current")}}];return _>0&&(_<=1e3?r.push({key:"export-all",icon:(0,U.jsx)(w.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_,"条)"),onClick:function(){return xe("all")}}):r.push({key:"export-range",icon:(0,U.jsx)(w.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_,"条)"),children:ve(_)})),e.push((0,U.jsx)(I.Z,{menu:{items:r},placement:"bottom",children:(0,U.jsxs)(C.ZP,{icon:(0,U.jsx)(w.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,U.jsx)(k.Z,{})]},"button")},"export")),t.length>0&&e.push((0,U.jsx)(I.Z,{menu:{items:t},placement:"bottom",children:(0,U.jsxs)(C.ZP,{type:V.length>0?"primary":"default",danger:V.length>0,children:[V.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(V.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,U.jsx)(k.Z,{})]})},"batchOperations")),e}()}}),(0,U.jsx)(D,{open:ie,onClose:function(){ue(!1),pe(null)},onSubmit:function(){var e;null===(e=s.current)||void 0===e||e.reload()},thread:le,orgUid:(null==le?void 0:le.orgUid)||(null==A?void 0:A.uid)}),z]})}}}]);