"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2699],{42699:function(e,t,a){a.d(t,{Z:function(){return I}});var r=a(90819),n=a.n(r),s=a(89933),i=a.n(s),o=a(45332),l=a.n(o),c=a(15722),d=a(90727),u=a(82669),g=a(80556),f=a(59304),p=a(54881),m=a(2484),h=a(68349),v=a(27259),y=a(5780),M=a(90317),x=a(78359),w=a(69857),k=a(27473),C=a(38166),j=a(76711),b=a.n(j),Z=a(5025),S=a(18751),z=a(68866),T=a(34599),U=a(32394),E=a(48821),B=a(38197),O=a(47783),F=a(44194),K=a(8065),D=a(14870),P=a(5488),L=a(31549),A=function(e){var t,a=e.open,r=e.level,s=e.type,o=e.showKbase,c=void 0===o||o,d=e.isEdit,u=e.onCancel,g=e.onSubmit,f=(0,D.useIntl)(),p=U.A.useForm(),m=l()(p,1)[0],v=(0,S.Z)().translateString,y=(0,T.u)((function(e){return e.currentOrg})),M=(0,z.j)((function(e){return e.kbaseResult})),x=(0,z.j)((function(e){return e.currentKbase})),w=(0,K.v)((function(e){return{currentCategory:e.currentCategory,categoryTreeOptions:e.categoryTreeOptions}})),k=w.currentCategory,C=w.categoryTreeOptions;(0,F.useEffect)((function(){d?m.setFieldsValue({name:v(null==k?void 0:k.name),parentUid:(null==k?void 0:k.parentUid)||P.zBg}):(m.resetFields(),m.setFieldsValue({parentUid:null!=k&&k.uid&&k.uid!==P.zBg?k.uid:P.zBg})),m.setFieldsValue({kbUid:null==x?void 0:x.uid})}),[a,d]);var j=function(){m.validateFields().then(function(){var e=i()(n()().mark((function e(t){var a,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),a=t.parentUid===P.zBg?void 0:t.parentUid,i={uid:d?null==k?void 0:k.uid:"",name:t.name,level:r,type:s,parentUid:a,kbUid:t.kbUid,orgUid:null==y?void 0:y.uid},g(i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),Z.yw.error(f.formatMessage({id:d?"pages.category.update.failed":"pages.category.create.failed"}))}))},A=(0,F.useMemo)((function(){var e,t,a=function e(t){return t.map((function(t){return{title:v(t.title),key:t.key,disabled:t.disabled,children:t.children?e(t.children):void 0}}))}(C||[]);a.length>0&&(null===(e=a[0])||void 0===e?void 0:e.key)===P.zBg&&(a[0].title=f.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}));var r=d?null==k?void 0:k.uid:void 0;if(!r)return a;var n=function e(t){var a;t&&(t.disabled=!0,null===(a=t.children)||void 0===a||a.forEach(e))};return function e(t){t&&t.forEach((function(t){var a;t.key===r?n(t):null!==(a=t.children)&&void 0!==a&&a.length&&e(t.children)}))}(a),a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.key)===P.zBg?a:[{title:f.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),key:P.zBg,children:void 0}].concat(b()(a))}),[C,d,null==k?void 0:k.uid,f,v]);return(0,L.jsx)("div",{children:(0,L.jsx)(h.Z,{title:d?f.formatMessage({id:"pages.category.drawer.edit"}):f.formatMessage({id:"pages.category.drawer.create"}),open:a,forceRender:!0,onOk:j,onCancel:u,getContainer:!1,okText:f.formatMessage({id:"pages.category.drawer.save"}),cancelText:f.formatMessage({id:"pages.category.drawer.cancel"}),children:(0,L.jsxs)(U.A,{form:m,name:"categoryForm",submitter:!1,children:[(0,L.jsx)(E.Z,{label:f.formatMessage({id:"pages.category.drawer.name",defaultMessage:"分类名称"}),name:"name",rules:[{required:!0,message:f.formatMessage({id:"pages.category.drawer.name.required",defaultMessage:"请输入名称!"})}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&j()},placeholder:f.formatMessage({id:"pages.category.drawer.name.placeholder",defaultMessage:"请输入分类名称"})}}),(0,L.jsx)(B.Z,{name:"parentUid",label:f.formatMessage({id:"pages.category.drawer.parent",defaultMessage:"上级分类"}),allowClear:!0,placeholder:f.formatMessage({id:"pages.category.drawer.parent.placeholder",defaultMessage:"选择上级分类（留空则为顶级）"}),fieldProps:{treeData:A,fieldNames:{label:"title",value:"key",children:"children"},treeDefaultExpandAll:!0,disabled:!1,filterTreeNode:function(e,t){var a;return(null!==(a=null==t?void 0:t.title)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},treeDataSimpleMode:!1}}),c&&(0,L.jsx)(O.Z,{name:"kbUid",label:f.formatMessage({id:"pages.category.drawer.kb"}),allowClear:!0,options:null==M||null===(t=M.data)||void 0===t?void 0:t.content.map((function(e){return{label:v(e.name),value:e.uid}}))})]})})})},N=a(78323),I=function(e){var t=e.type,a=e.level,r=e.showKbase,s=void 0===r||r,o=(0,D.useIntl)(),j=(0,F.useState)(!0),b=l()(j,2),U=b[0],E=b[1],B=(0,F.useState)(!1),O=l()(B,2),I=O[0],R=O[1],V=(0,F.useState)(1),q=l()(V,2),H=q[0],G=q[1],J=(0,F.useState)(20),Q=l()(J,2),W=Q[0],X=Q[1],Y=(0,F.useState)(0),$=l()(Y,2),_=$[0],ee=$[1],te=(0,F.useState)(""),ae=l()(te,2),re=ae[0],ne=ae[1],se=(0,T.u)((function(e){return e.currentOrg})),ie=(0,z.j)((function(e){return e.currentKbase})),oe=(0,F.useState)(!1),le=l()(oe,2),ce=le[0],de=le[1],ue=(0,K.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),ge=ue.categoryTreeOptions,fe=ue.currentCategory,pe=ue.setCurrentCategoryUid,me=(0,S.Z)(),he=me.translateString,ve=me.translateStringTranct,ye=h.Z.useModal(),Me=l()(ye,2),xe=Me[0],we=Me[1],ke=function(){var e=i()(n()().mark((function e(){var r,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(!0),r=s?null==ie?void 0:ie.uid:"",e.next=4,(0,N.HK)(t,null==se?void 0:se.uid,r,a,{showLoading:!0,pageSize:W,pageNumber:H-1,searchName:re,loadingMessage:o.formatMessage({id:"loading"}),errorMessage:o.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:i=e.sent,console.log("refreshCategories response: ",i.data),R(!1),i&&i.data&&ee(i.data.totalElements||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e){ne(e),G(1),setTimeout((function(){ke()}),0)},je=function(e,t){G(e),t&&t!==W&&X(t),setTimeout((function(){ke()}),0)},be=function(){var e=i()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(!1),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=i()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(!0),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=i()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.sT)(t,{showLoading:!0,loadingMessage:o.formatMessage({id:"deleting"}),successMessage:o.formatMessage({id:"delete.success"}),errorMessage:o.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&ke();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=i()(n()().mark((function e(t){var a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={showLoading:!0,loadingMessage:o.formatMessage({id:U?"updating":"creating"}),successMessage:o.formatMessage({id:U?"update.success":"create.success"}),errorMessage:o.formatMessage({id:U?"update.error":"create.error",defaultMessage:U?"Update failed":"Create failed"})},!U){e.next=7;break}return e.next=4,(0,N.ht)(t,a);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,N.i8)(t,a);case 9:e.t0=e.sent;case 10:e.t0&&(de(!1),ke());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,F.useEffect)((function(){s&&(G(1),ne(""),ke())}),[ie]),(0,F.useEffect)((function(){G(1),ne(""),ke()}),[]);return(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(_/W)>1||""!==re)&&(0,L.jsx)(v.Z,{placeholder:o.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,L.jsx)(d.Z,{}),suffix:(0,L.jsx)(y.ZP,{type:"text",size:"small",icon:(0,L.jsx)(d.Z,{}),onClick:function(){return Ce(re)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,L.jsx)("span",{onClick:function(e){e.stopPropagation(),ne(""),G(1),ke()}})},value:re,onChange:function(e){var t=e.target.value;ne(t),t||(G(1),setTimeout((function(){ke()}),0))},onPressEnter:function(e){return Ce(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,L.jsxs)(M.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,L.jsxs)(M.Z,{gap:"small",children:[(0,L.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,L.jsx)(u.Z,{}),onClick:be,children:o.formatMessage({id:"create.category"})}),(0,L.jsx)(y.ZP,{size:"small",icon:(0,L.jsx)(g.Z,{spin:I}),onClick:ke,loading:I,children:o.formatMessage({id:"refresh"})})]}),""!==(null==fe?void 0:fe.uid)&&(null==fe?void 0:fe.uid)!==P.zBg&&(0,L.jsx)(x.Z,{menu:{items:[{key:"edit",icon:(0,L.jsx)(f.Z,{}),label:o.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Ze},{key:"delete",icon:(0,L.jsx)(p.Z,{}),label:o.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==P.zBg?xe.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,L.jsx)(c.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(he(e.name),"】？"),onOk:function(){Se(e)},onCancel:function(){},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})}):Z.yw.error(o.formatMessage({id:"delete.dept.all.error"}))}(fe)}}]},children:(0,L.jsx)(y.ZP,{size:"small",icon:(0,L.jsx)(m.Z,{})})})]})]}),(0,L.jsx)(w.Z,{defaultSelectedKeys:[null==fe?void 0:fe.uid],selectedKeys:[null==fe?void 0:fe.uid],onSelect:function(e,t){0!==e.length&&pe(e[0].toString())},treeData:ge,blockNode:!0,titleRender:function(e){return(0,L.jsx)(k.Z,{title:he(e.title),children:ve(e.title)})}}),Math.ceil(_/W)>1&&(0,L.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,L.jsx)(C.Z,{size:"small",current:H,pageSize:W,total:_,onChange:je,onShowSizeChange:je,showSizeChanger:!1,showLessItems:!0}),(0,L.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:o.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:_})})]}),ce&&(0,L.jsx)(A,{open:ce,type:t,showKbase:s,isEdit:U,onCancel:function(){de(!1)},onSubmit:ze}),we]})}}}]);