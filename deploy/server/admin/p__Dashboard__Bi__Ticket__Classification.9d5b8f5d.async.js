"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3954],{16829:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),i=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},c=n(5901),s=function(e,t){return i.createElement(c.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=i.forwardRef(s)},83381:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),i=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},c=n(5901),s=function(e,t){return i.createElement(c.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=i.forwardRef(s)},55072:function(e,t,n){n.d(t,{If:function(){return k},dF:function(){return d},j4:function(){return h},v$:function(){return p}});var r=n(90819),i=n.n(r),a=n(73193),c=n.n(a),s=n(89933),u=n.n(s),o=n(68992),l=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/query/org",{method:"GET",params:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/create",{method:"POST",data:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/update",{method:"POST",data:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return g.apply(this,arguments)}function g(){return(g=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/department/delete",{method:"POST",data:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},22261:function(e,t,n){n.d(t,{AD:function(){return d},Tl:function(){return p}});var r=n(90819),i=n.n(r),a=n(73193),c=n.n(a),s=n(89933),u=n.n(s),o=n(68992),l=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/statistic/calculate",{method:"POST",data:c()(c()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},93274:function(e,t,n){n.r(t);var r=n(90819),i=n.n(r),a=n(89933),c=n.n(a),s=n(45332),u=n.n(s),o=n(44194),l=n(35079),d=n(78380),f=n(33633),p=n(67194),m=n(63052),h=n(89654),v=n(92393),k=n(72264),g=n(21478),x=n(22888),y=n(35490),w=n(44966),b=n(35911),j=n(33e3),M=n(83381),Z=n(14546),T=n(16829),D=n(62395),Y=n(22261),R=n(61489),S=n(77686),z=n(66675),C=n(6677),O=n(99754),B=n(68992),I=n(45634),E=n.n(I),q=n(55072),F=n(74956),U=n(31549),P=l.default.RangePicker,J=d.Z.Option;t.default=function(){var e,t,n=(0,D.useIntl)(),r=(0,O.Z)().translateStringTranct,a=(0,o.useState)(E()().startOf("day")),s=u()(a,2),l=s[0],I=s[1],X=(0,o.useState)(E()().endOf("day")),H=u()(X,2),W=H[0],L=H[1],A=(0,o.useState)("today"),G=u()(A,2),N=G[0],Q=G[1],_=(0,o.useState)(B.whQ),V=u()(_,2),$=V[0],K=V[1],ee=(0,o.useState)(),te=u()(ee,2),ne=te[0],re=te[1],ie=(0,o.useState)(),ae=u()(ie,2),ce=ae[0],se=ae[1],ue=(0,S.u)((function(e){return e.currentOrg})),oe=(0,z.E)((function(e){return e})),le=oe.agentResult,de=oe.setAgentResult,fe=(0,F.H)((function(e){return e})),pe=fe.departmentResult,me=fe.setDepartmentResult,he=(0,o.useState)(),ve=u()(he,2),ke=ve[0],ge=ve[1],xe=(0,o.useState)(!1),ye=u()(xe,2),we=ye[0],be=ye[1],je=[{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,U.jsx)(D.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,o.useEffect)((function(){if("custom"===N)I(l),L(W);else{var e=E()();"today"===N?(I(e),L(e)):"yesterday"===N?(I(e.subtract(1,"day")),L(e.subtract(1,"day"))):"week"===N?(I(e.startOf("week")),L(e.endOf("week"))):"lastWeek"===N?(I(e.subtract(1,"week").startOf("week")),L(e.subtract(1,"week").endOf("week"))):"month"===N&&(I(e.startOf("month")),L(e.endOf("month")))}}),[N]);var Me=function(){var e=c()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,q.dF)(t);case 4:200===(n=e.sent).code?(R.yw.destroy(),me(n),n.data.content.length>0&&se(n.data.content[0].uid)):(R.yw.destroy(),R.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=c()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,C._t)(t);case 4:200===(n=e.sent).code?(R.yw.destroy(),de(n),n.data.content.length>0&&re(n.data.content[0].uid)):(R.yw.destroy(),R.yw.error(r(n.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=c()(i()().mark((function e(){var t,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be(!0),e.prev=1,R.yw.loading("loading"),t={type:$,startDate:null==l?void 0:l.format("YYYY-MM-DD"),endDate:null==W?void 0:W.format("YYYY-MM-DD"),departmentUid:ce,assigneeUid:ne,orgUid:null==ue?void 0:ue.uid},e.next=6,(0,Y.AD)(t);case 6:r=e.sent,console.log("queryStatisticTicketByDate response:",r.data,t),200===r.code?(R.yw.destroy(),ge(r.data)):(R.yw.destroy(),R.yw.error(r.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),R.yw.error(n.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,be(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){Me(),Ze()}),[]),(0,o.useEffect)((function(){Te()}),[$,ne,ce]),(0,o.useEffect)((function(){Te()}),[l,W]);var De=[{key:"1",date:null==l?void 0:l.format("YYYY-MM-DD"),criticalTickets:(null==ke?void 0:ke.criticalTickets)||0,highTickets:(null==ke?void 0:ke.highTickets)||0,mediumTickets:(null==ke?void 0:ke.mediumTickets)||0,lowTickets:(null==ke?void 0:ke.lowTickets)||0,totalTickets:(null==ke?void 0:ke.totalTickets)||0}],Ye=[{title:n.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:n.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:n.formatMessage({id:"bi.ticket.table.criticalTickets"}),dataIndex:"criticalTickets",key:"criticalTickets",render:function(e){return(0,U.jsxs)(f.Z,{color:"red",children:[e," ",n.formatMessage({id:"bi.ticket.unit.ticket"})]})}},{title:n.formatMessage({id:"bi.ticket.table.highTickets"}),dataIndex:"highTickets",key:"highTickets",render:function(e){return(0,U.jsxs)(f.Z,{color:"orange",children:[e," ",n.formatMessage({id:"bi.ticket.unit.ticket"})]})}},{title:n.formatMessage({id:"bi.ticket.table.mediumTickets"}),dataIndex:"mediumTickets",key:"mediumTickets",render:function(e){return(0,U.jsxs)(f.Z,{color:"blue",children:[e," ",n.formatMessage({id:"bi.ticket.unit.ticket"})]})}},{title:n.formatMessage({id:"bi.ticket.table.lowTickets"}),dataIndex:"lowTickets",key:"lowTickets",render:function(e){return(0,U.jsxs)(f.Z,{color:"green",children:[e," ",n.formatMessage({id:"bi.ticket.unit.ticket"})]})}},{title:n.formatMessage({id:"bi.ticket.table.resolutionRate"}),dataIndex:"resolutionRate",key:"resolutionRate",render:function(e){return(0,U.jsx)(p.Z,{percent:e,size:"small",format:function(e){return"".concat(e,"%")}})}}];return(0,U.jsxs)("div",{style:{padding:"24px"},children:[(0,U.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,U.jsx)("h2",{children:n.formatMessage({id:"bi.ticket.title.classification"})}),(0,U.jsxs)("p",{children:[n.formatMessage({id:"bi.ticket.description.classification"}),"today"===N&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD"),")"]}),"yesterday"===N&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD"),")"]}),("week"===N||"lastWeek"===N||"month"===N||"custom"===N)&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",l.format("YYYY-MM-DD")," ~ ",W.format("YYYY-MM-DD"),")"]})]})]}),(0,U.jsx)(m.Z,{style:{marginBottom:16},children:(0,U.jsx)(h.Z,{direction:"vertical",style:{width:"100%"},children:(0,U.jsxs)(h.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,U.jsxs)(h.Z,{wrap:!0,children:[(0,U.jsx)(v.ZP.Group,{value:N,onChange:function(e){return Q(e.target.value)},children:je.map((function(e){return(0,U.jsx)(v.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===N&&(0,U.jsx)(P,{value:[l,W],onChange:function(e){I(e[0]),L(e[1])}})]}),(0,U.jsxs)(h.Z,{wrap:!0,children:[(0,U.jsxs)(d.Z,{value:$,onChange:K,style:{width:120},placeholder:n.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,U.jsx)(J,{value:B.whQ,children:n.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,U.jsx)(J,{value:B.fyH,children:n.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,U.jsx)(J,{value:B.nYM,children:n.formatMessage({id:"bi.ticket.filterType.department"})})]}),$===B.fyH&&(0,U.jsx)(d.Z,{value:ne,onChange:re,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=le.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,U.jsx)(J,{value:e.uid,children:r(e.nickname)},e.uid)}))}),$===B.nYM&&(0,U.jsx)(d.Z,{value:ce,onChange:se,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=pe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,U.jsx)(J,{value:e.uid,children:r(e.name)},e.uid)}))}),(0,U.jsx)(k.ZP,{type:"primary",icon:(0,U.jsx)(b.Z,{}),onClick:function(){return Te()},children:(0,U.jsx)(D.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,U.jsxs)(g.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:n.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==ke?void 0:ke.totalTickets)||0,prefix:(0,U.jsx)(j.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:n.formatMessage({id:"bi.ticket.card.criticalTickets"}),value:(null==ke?void 0:ke.criticalTickets)||0,prefix:(0,U.jsx)(M.Z,{}),valueStyle:{color:"#ff4d4f"}})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:n.formatMessage({id:"bi.ticket.card.highTickets"}),value:(null==ke?void 0:ke.highTickets)||0,prefix:(0,U.jsx)(Z.Z,{}),valueStyle:{color:"#fa8c16"}})})}),(0,U.jsx)(x.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:n.formatMessage({id:"bi.ticket.card.resolvedTickets"}),value:(null==ke?void 0:ke.resolvedTickets)||0,prefix:(0,U.jsx)(T.Z,{}),valueStyle:{color:"#52c41a"}})})})]}),(0,U.jsxs)(g.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,U.jsx)(x.Z,{span:12,children:(0,U.jsx)(m.Z,{title:n.formatMessage({id:"bi.ticket.priorityDistribution"})})}),(0,U.jsx)(x.Z,{span:12,children:(0,U.jsx)(m.Z,{title:n.formatMessage({id:"bi.ticket.resolutionTrend"})})})]}),(0,U.jsx)(m.Z,{title:"优先级详细数据",loading:we,children:(0,U.jsx)(w.Z,{columns:Ye,dataSource:De,pagination:!1,size:"middle"})})]})}},74956:function(e,t,n){n.d(t,{H:function(){return p}});var r=n(86222),i=n.n(r),a=n(76711),c=n.n(a),s=n(73193),u=n.n(s),o=n(68992),l=n(58063),d=n(66266),f=n(31403),p=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:o.zBg,nickname:o.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,i={uid:o.zBg,name:o.zBg};(e({departmentResult:u()(u()({},n),{},{data:{content:[i].concat(c()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,i=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==i){var a=[].concat(c()(r.slice(0,i)),[n],c()(r.slice(i+1))),s=u()(u()({},t().departmentResult),{},{data:{content:a}});e({departmentResult:s,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,a,c=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(c)e({currentDepartment:c});else{!function t(r){var a,c=i()(r);try{for(c.s();!(a=c.n()).done;){var s=a.value;if(s.uid===n)return void e({currentDepartment:s});s.children&&s.children.length>0&&t(s.children)}}catch(e){c.e(e)}finally{c.f()}}((null===(a=t().departmentResult)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:o.xY_})))}}]);