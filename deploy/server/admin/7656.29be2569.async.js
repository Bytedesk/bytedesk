"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7656],{11090:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(77260),r=a(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(54183),i=function(e,t){return r.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(i)},2484:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(77260),r=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=a(54183),i=function(e,t){return r.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(i)},37656:function(e,t,a){a.d(t,{Z:function(){return U}});var n=a(84176),r=a.n(n),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),f=a.n(u),p=a(45332),g=a.n(p),m=a(5025),h=a(14870);function M(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/upload/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/upload/delete",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=a(34599),w=a(18580),b=a(5488),S=a(11090),j=a(2484),T=a(54881),Z=a(19975),I=a(68349),C=a(67652),z=a(5780),A=a(78359),D=a(28977),N=a.n(D),R=a(44194),F=a(31549),E=["current","pageSize"],U=function(e){var t=e.level,a=(0,h.useIntl)(),n=(0,R.useRef)(),s=((0,h.useNavigate)(),(0,R.useState)(1)),i=g()(s,2),d=i[0],u=i[1],p=(0,R.useState)(10),x=g()(p,2),y=x[0],D=x[1],U=(0,k.u)((function(e){return e.currentOrg})),q=(0,R.useState)({}),B=g()(q,2),H=B[0],O=B[1],P=(0,R.useState)([]),Y=g()(P,2),G=Y[0],J=Y[1],K=(0,R.useState)([]),L=g()(K,2),V=L[0],Q=L[1],W=(0,R.useState)(0),X=g()(W,2),$=X[0],_=X[1],ee=I.Z.useModal(),te=g()(ee,2),ae=(te[0],te[1]),ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,F.jsx)(h.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",fixed:"left",tooltip:a.formatMessage({id:"upload.nickname.tooltip",defaultMessage:"上传者的昵称"}),render:function(e,t){return(0,F.jsx)(F.Fragment,{children:(a=null==t?void 0:t.user,n=JSON.parse(a),null==n?void 0:n.nickname)});var a,n}},{title:(0,F.jsx)(h.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",copyable:!0,search:!0,tooltip:a.formatMessage({id:"upload.fileName.tooltip",defaultMessage:"上传的文件名称"})},{title:(0,F.jsx)(h.FormattedMessage,{id:"fileType",defaultMessage:"fileType"}),dataIndex:"fileType",hideInSearch:!0,tooltip:a.formatMessage({id:"upload.fileType.tooltip",defaultMessage:"文件的MIME类型"})},{title:(0,F.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",tooltip:a.formatMessage({id:"upload.status.tooltip",defaultMessage:"文件处理状态"}),hideInSearch:!0},{title:(0,F.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",search:!0,tooltip:a.formatMessage({id:"upload.type.tooltip",defaultMessage:"文件分类类型"})},{title:(0,F.jsx)(h.FormattedMessage,{id:"channel",defaultMessage:"Channel"}),dataIndex:"client",tooltip:a.formatMessage({id:"upload.channel.tooltip",defaultMessage:"上传客户端信息"}),hideInSearch:!0},{title:(0,F.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",width:180,sorter:!0,tooltip:a.formatMessage({id:"upload.updatedAt.tooltip",defaultMessage:"最近更新时间"}),hideInSearch:!0,render:function(e,t,a,n){return N()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],re=function(){var e=f()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,v(t);case 3:r=e.sent,console.log("delete response:",r),200===r.code?(null==n||n.current.reload(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=[].concat(ne,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(e,t,n,r){return[(0,F.jsx)("a",{onClick:function(){var e=null==t?void 0:t.fileUrl,a=encodeURIComponent(e);window.open(decodeURIComponent(a))},children:a.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,F.jsx)(C.Z,{title:a.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.fileName,"】？"),onConfirm:function(){return re(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,F.jsx)(z.ZP,{size:"small",type:"link",danger:!0,children:a.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),oe=function(){var e=f()(c()().mark((function e(){var t,r,s,o,i,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,s=0,o=l()(V),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return d=i.value,e.prev=11,e.next=14,v(d);case 14:200===e.sent.code?r++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:s})),J([]),Q([]),null===(t=n.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=f()(c()().mark((function e(a,n,r){var s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,n,r),s=localStorage.getItem(b.LA8),i=o()({orgUid:t===b.Hxq?"":(null==U?void 0:U.uid)||"",accessToken:s||"",exportType:a},H),"current"===a?(i.pageNumber=String(d-1),i.pageSize=String(y)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==n&&void 0!==r&&(i.pageNumber=String(n),i.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/upload/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),le=function(e){for(var t=[],a=1e3,n=Math.ceil(e/a),r=function(){var n=s,r=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return ie("range",n,a)}})},s=0;s<n;s++)r();return t},de={selectedRowKeys:G,onChange:function(e,t){J(e),Q(t)}};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Z.Z,{columns:se,actionRef:n,cardBordered:!0,style:{padding:16},rowSelection:de,scroll:{x:1800},request:function(){var e=f()(c()().mark((function e(a,n,s){var i,l,d,f,p,g,h,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,n,s),i=a.current,l=a.pageSize,d=r()(a,E),u(i),D(l),O(d),f=void 0,p=void 0,n&&Object.keys(n).length>0&&(g=Object.keys(n)[0],f=g,p="ascend"===n[g]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:l,categoryUid:"",kbUid:"",orgUid:t===b.Hxq?"":null==U?void 0:U.uid},d),{},{sortBy:f,sortDirection:p}),e.next=11,M(h);case 11:return x=e.sent,console.log("getAllUploads response:",x,h),200===x.code?_(x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){u(e),D(t)}},dateFormatter:"string",headerTitle:"文档",toolBarRender:function(){return[(0,F.jsx)(A.Z,{menu:{items:(e=[{key:"export-current",label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ie("current")}}],$>0&&($<=1e3?e.push({key:"export-all",label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat($,"条)"),onClick:function(){return ie("all")}}):e.push({key:"export-range",label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat($,"条)"),children:le($)})),e)},placement:"bottomRight",children:(0,F.jsxs)(z.ZP,{type:"primary",icon:(0,F.jsx)(S.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"导出"}),(0,F.jsx)(j.Z,{})]})},"exportDropdown"),G.length>0&&(0,F.jsx)(C.Z,{title:a.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(a.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确认删除"})," ").concat(G.length," ").concat(a.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:oe,okText:a.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:a.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,F.jsxs)(z.ZP,{danger:!0,icon:(0,F.jsx)(T.Z,{}),children:[a.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})," (",G.length,")"]})},"batchDelete")];var e}}),ae]})}}}]);