"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{51146:function(e,t,n){n.d(t,{G9:function(){return k},J$:function(){return S},N6:function(){return w},VM:function(){return d},c8:function(){return p},gF:function(){return x},rg:function(){return m},sF:function(){return y}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),l=n.n(i),u=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11591:function(e,t,n){n.d(t,{Bv:function(){return A},L0:function(){return C},QB:function(){return w},RF:function(){return k},YO:function(){return S},YQ:function(){return T},Yg:function(){return x},kh:function(){return p},kv:function(){return y},pf:function(){return d},y:function(){return m}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),l=n.n(i),u=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/deleteAll",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return U.apply(this,arguments)}function U(){return(U=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return I.apply(this,arguments)}function I(){return(I=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return P.apply(this,arguments)}function P(){return(P=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/agent/text/faq-similar-questions",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},53816:function(e,t,n){var r=n(73193),a=n.n(r),s=n(93527),o=n(26710),i=n(65819),l=n(6844),u=n(19736),c=n(53411),d=(n(90744),n(96596)),f=n.n(d),p=n(44194),g=n(31549);t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,d=e.style,m=e.toolbarKeys,h=e.maxLength,x=e.onChange,v=e.options,y=(0,u.useIntl)(),M=(0,o.Z)().isDarkMode,w=(0,p.useRef)(null),b=(0,p.useRef)(null),k=(0,p.useRef)(!1),j=(0,p.useRef)(x);(0,p.useEffect)((function(){j.current=x}),[x]);var S=function(e,t,n){"function"!=typeof j.current||k.current||j.current(e,t,n)};return(0,p.useEffect)((function(){if(w.current){if(!b.current){var e=new c.cW(a()(a()({element:w.current,theme:M?"dark":"light",placeholder:t,content:n,toolbarKeys:m},v||{}),{},{image:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("orgUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){var t=e.getText(),n=t.length,r="number"==typeof h?h:Number.POSITIVE_INFINITY;if(n>r){var a,o;s.yw.warning(y.formatMessage({id:"character.limit.reached"},{limit:r})||"已达到 ".concat(r," 字符限制"));var i=t.substring(0,r);k.current=!0,setTimeout((function(){b.current&&b.current.setContent(i),k.current=!1}),0),S((null===(a=b.current)||void 0===a?void 0:a.getHtml())||"",(null===(o=b.current)||void 0===o?void 0:o.getMarkdown())||"",i)}else S(e.getHtml(),e.getMarkdown(),e.getText())}}));b.current=e}return function(){b.current&&(b.current.destroy(),b.current=null)}}}),[]),(0,p.useEffect)((function(){b.current&&void 0!==r&&r!==b.current.getHtml()&&(k.current=!0,b.current.setContent(r||"",!1),requestAnimationFrame((function(){k.current=!1})))}),[r]),(0,g.jsx)("div",{ref:w,style:a()({height:"100%"},d)})}},54605:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),s=(n(44194),n(87373)),o=n(6844),i=n(96596),l=n.n(i),u=n(36125),c=n(93527),d=n(65819),f=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},p={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=t,i.fileType=e.type,u.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t,a=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(a),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(s.Z,a()(a()({},p),{},{children:t}))}},8708:function(e,t,n){n.r(t),n.d(t,{default:function(){return Tn}});var r=n(85255),a=n(6844),s=n(86567),o=n(44194),i=n(31167),l=n(32693),u=n(90151),c=n(48800),d=n(76251),f=n(55439),p=n(19736),g=n(84176),m=n.n(g),h=n(73193),x=n.n(h),v=n(86222),y=n.n(v),M=n(90819),w=n.n(M),b=n(89933),k=n.n(b),j=n(45332),S=n.n(j),Z=n(93527);function C(e){return U.apply(this,arguments)}function U(){return(U=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/file/query/org",{method:"GET",params:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return I.apply(this,arguments)}function I(){return(I=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/file/update",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return P.apply(this,arguments)}function P(){return(P=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/file/delete",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return q.apply(this,arguments)}function q(){return(q=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/file/delete/all",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return F.apply(this,arguments)}function F(){return(F=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/file/rechunk",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=n(44679),R=n(56773),z=n(14888),L=n(28506),Y=n(65819),B=n(61689),N=n(9428),V=n(3925),H=n(20921),J=n(31549),X=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,D.Z)().translateString,s=(0,R.j)((function(e){return e.currentKbase})),i=(0,L.L)((function(e){return e.userInfo})),l=(0,z.u)((function(e){return e.currentOrg})),u=(0,o.useState)(""),c=S()(u,2),d=c[0],f=c[1],p=(0,o.useState)(!1),g=S()(p,2),m=g[0],h=g[1],x=function(){console.log("refresh"),h(!1);var e=(0,Y.Cn)()+"?org="+encodeURIComponent(null==l?void 0:l.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==s?void 0:s.uid)+"&uid="+encodeURIComponent(null==i?void 0:i.uid)+"&nickname="+encodeURIComponent(null==i?void 0:i.nickname)+"&avatar="+encodeURIComponent(null==i?void 0:i.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,o.useEffect)((function(){x()}),[s]);return(0,J.jsx)(J.Fragment,{children:(0,J.jsxs)(B.Z,{title:a(null==s?void 0:s.name),onClose:function(){r&&r()},open:n,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:function(){window.open(d)},children:"新窗口"}),(0,J.jsx)(V.ZP,{onClick:function(){console.log("restart"),x()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,J.jsx)(H.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,J.jsx)("iframe",{id:"chat-iframe",src:d,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},Q=n(47598),K=n(14695),W=n(71529),G=n(92110),_=n(59304),$=n(21407),ee=n(54881),te=n(10162),ne=n(58275),re=n(11090),ae=n(2484),se=n(67412),oe=n(46141),ie=n(5089),le=n(66810),ue=n(1691),ce=n(77359),de=n(71277),fe=n(96596),pe=n.n(fe),ge=n(34718),me=n(88165),he=n(53229),xe=n(93189),ve=n(51146),ye=n(6015),Me=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)xe.ZP.info("正在检查模型状态，请稍后再试");else{var r=ye.A.getState().llmproviderConfigDefault.defaultEmbeddingProvider,a=ye.A.getState().llmproviderConfigDefault.defaultEmbeddingModel,s="ollama"===r;s?t?e():(0,ve.J$)({model:a}).then((function(t){if(404===t.code)return console.log("API 返回 404，不影响操作，直接执行"),void e();var n="请首先拉取Embedding向量模型".concat(a,"，用于知识库向量检索");oe.Z.warning({title:"嵌入式模型缺失",content:n,okText:"确定"})})).catch((function(t){console.error("重新检查模型时出错:",t),console.log("API 调用异常，不影响操作，直接执行"),e()})):e()}},we=function(e){var t=e.onModelStatusChange,n=(0,p.useIntl)(),r=(0,o.useState)(!1),a=S()(r,2),s=a[0],i=a[1],l=(0,o.useState)(!1),u=S()(l,2),c=u[0],d=u[1],f=(0,ye.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingModel})),g=(0,ye.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingProvider})),m=(0,o.useState)(!1),h=S()(m,2),x=h[0],v=h[1],y=function(){return"ollama"===g},M=function(){var e=k()(w()().mark((function e(){var n;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("检查嵌入式模型是否存在:",{defaultEmbeddingModel:f,defaultEmbeddingProvider:g}),y()){e.next=5;break}return console.log("不需要检查模型：",{defaultEmbeddingModel:f,defaultEmbeddingProvider:g}),null==t||t(!0),e.abrupt("return");case 5:return e.prev=5,d(!0),null==t||t(!1),e.next=10,(0,ve.J$)({model:f});case 10:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(i(null==n?void 0:n.data),null==t||t(null==n?void 0:n.data),v(!1)):404===n.code?(i(!0),null==t||t(!0),v(!1),console.log("接口404，不影响使用，视为模型存在")):(i(!1),null==t||t(!1),v(!1)),e.next=22;break;case 15:e.prev=15,e.t0=e.catch(5),console.error("检查嵌入式模型失败:",e.t0),i(!0),null==t||t(!0),v(!1),console.log("接口异常，不影响使用，视为模型存在");case 22:return e.prev=22,d(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[5,15,22,25]])})));return function(){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){M()}),[f,g]),y()?c?(0,J.jsx)(he.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):s?x?(0,J.jsx)(he.Z,{type:"warning",showIcon:!0,message:(0,J.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,J.jsx)("span",{children:"嵌入模型配置警告"})}),description:"嵌入模型 ".concat(f," 不存在或无法访问，可能会影响知识库向量检索功能，请检查配置或联系管理员"),style:{marginBottom:16}}):null:(0,J.jsx)(he.Z,{type:"warning",showIcon:!0,message:(0,J.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,J.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型".concat(f,"，用于知识库向量检索")}),style:{marginBottom:16}}):null},be=n(76711),ke=n.n(be),je=n(61353),Se=n(35912),Ze=n(95702),Ce=n(29589),Ue=n(48907),Ae="CREATE_NEW_ROBOT",Ie=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,s=e.currentKbaseUid,o=e.onOk,i=e.onCancel,l=e.onChange,u=(0,p.useIntl)();return(0,J.jsx)(oe.Z,{title:u.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:o,onCancel:i,okText:u.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:u.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,J.jsx)(H.Z,{spinning:n,children:(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsx)("p",{children:u.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,J.jsxs)(Ce.Z,{style:{width:"100%"},placeholder:u.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:l,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(s));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===s,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,J.jsx)(Ce.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,J.jsx)(Ce.Z.Option,{value:"divider",disabled:!0,children:(0,J.jsx)(Ue.Z,{style:{margin:"4px 0"}})}),(0,J.jsx)(Ce.Z.Option,{value:Ae,label:u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,J.jsxs)("div",{style:{color:"#1890ff"},children:[(0,J.jsx)(te.Z,{})," ",u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},Te=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,s=e.checkingEmbeddingModel,i=(0,p.useIntl)(),l=(0,o.useState)(!1),u=S()(l,2),c=u[0],d=u[1],f=(0,o.useState)(!1),g=S()(f,2),m=g[0],h=g[1],v=(0,o.useState)(!1),y=S()(v,2),M=y[0],b=y[1],j=(0,o.useState)(),C=S()(j,2),U=(C[0],C[1]),A=(0,o.useState)([]),I=S()(A,2),T=I[0],P=I[1],E=(0,o.useState)(""),q=S()(E,2),O=q[0],F=q[1],D=function(){var e=k()(w()().mark((function e(r){var s,o,l,u;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,s={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:a.whQ,type:a.f4h,orgUid:null==n?void 0:n.uid},e.next=5,(0,Se.p0)(s);case 5:if(o=e.sent,console.log("queryRobotsByOrg response:",o,s),200!==o.code){e.next=15;break}return l=(null==o?void 0:o.data.content)||[],u=l.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),P(u),r&&u.length>0&&U(u[0]),e.abrupt("return",u);case 15:return Z.yw.error(o.message),e.abrupt("return",[]);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),Z.yw.error(i.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 24:return e.prev=24,b(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,19,24,27]])})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=k()(w()().mark((function e(){var n,r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O&&null!=t&&t.uid){e.next=3;break}return Z.yw.error(i.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return Z.yw.loading(i.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:O,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,Se.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r,n),200!==r.code){e.next=18;break}return Z.yw.destroy(),Z.yw.success(i.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=null==r?void 0:r.data,U(a),e.abrupt("return",!0);case 18:return Z.yw.destroy(),Z.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),Z.yw.destroy(),Z.yw.error(i.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=k()(w()().mark((function e(){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),r){e.next=4;break}return oe.Z.confirm({title:i.formatMessage({id:"warning",defaultMessage:"警告"}),content:i.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:i.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=k()(w()().mark((function e(){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 4:if(!s){e.next=7;break}return Z.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 7:return e.next=9,L();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=k()(w()().mark((function e(){var n,r;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return Z.yw.error(i.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 3:return Z.yw.loading(i.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=6,D(!0);case 6:if(n=e.sent,Z.yw.destroy(),!(n.length>0)){e.next=12;break}n.length>1?(P(n),F(""),d(!0)):Y(n[0]),e.next=21;break;case 12:return e.next=14,D(!1);case 14:if(r=e.sent,console.log("All robots without kbase filter:",r),0!==r.length){e.next=19;break}return Z.yw.info(i.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 19:F(""),d(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:a.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else Z.yw.error(i.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},B=function(){var e=k()(w()().mark((function e(){var n;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=3;break}return Z.yw.error(i.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=T.find((function(e){return e.uid===O})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return oe.Z.confirm({title:i.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:i.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:i.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=k()(w()().mark((function e(){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:e.sent&&(d(!1),Y(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,R();case 9:e.sent&&(d(!1),n&&Y(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=k()(w()().mark((function e(n){var r,a,s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Z.yw.loading(i.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=x()(x()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,Se.lg)(r);case 7:if(a=e.sent,console.log("Create robot response:",a),200!==a.code){e.next=29;break}if(Z.yw.destroy(),Z.yw.success(i.formatMessage({id:"create.success",defaultMessage:"创建成功"})),h(!1),s=null==a?void 0:a.data,console.log("New robot data:",s),null==s||!s.uid){e.next=23;break}F(s.uid),U(s),P((function(e){var t=[s].concat(ke()(e));return console.log("Updated robot list:",t),t})),d(!1),Y(s),e.next=27;break;case 23:return e.next=25,D(!1);case 25:o=e.sent,console.log("Fetched all robots after creation:",o);case 27:e.next=31;break;case 29:Z.yw.destroy(),Z.yw.error(a.message||i.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),Z.yw.destroy(),Z.yw.error(i.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(V.ZP,{icon:(0,J.jsx)(je.Z,{}),type:"primary",onClick:z,disabled:s,children:i.formatMessage({id:"chat.test"})}),(0,J.jsx)(Ie,{visible:c,loading:M,robotList:T,selectedRobotUid:O,currentKbaseUid:null==t?void 0:t.uid,onOk:B,onCancel:function(){return d(!1)},onChange:function(e){e===Ae?(h(!0),F("")):F(e)}}),m&&(0,J.jsx)(Ze.Z,{open:m,onClose:function(){return h(!1)},onSubmit:N})]})},Pe=n(30064),Ee=n(68263),qe=n(86684),Oe=n(13847),Fe=n(48769),De=n(55785),Re=n(14377),ze=function(e){var t=e.isEdit,n=void 0===t||t,r=e.file,a=e.open,s=e.onClose,i=e.onSubmit,l=Pe.A.useForm(),u=S()(l,1)[0],c=(0,R.j)((function(e){return e.currentKbase})),d=(0,z.u)((function(e){return e.currentOrg})),f=(0,Q.v)((function(e){return e.categorySelectOptions})),p=(0,o.useState)(),g=S()(p,2),m=g[0],h=g[1],v=(0,o.useState)([]),y=S()(v,2),M=y[0],b=y[1],j=(0,o.useState)(!1),Z=S()(j,2),C=Z[0],U=Z[1],A=(0,o.useState)(""),I=S()(A,2),T=I[0],P=I[1],E=(0,o.useState)(!1),q=S()(E,2),O=q[0],F=q[1],D=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},L=function(){var e=k()(w()().mark((function e(){var t,n;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,F(!0),e.next=4,u.validateFields();case 4:t=e.sent,n=x()(x()(x()({},r),t),{},{categoryUid:m,tagList:D(M),kbUid:null==c?void 0:c.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",n),i(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),xe.ZP.error("请检查表单填写是否正确");case 14:return e.prev=14,F(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=T.trim();e&&!M.includes(e)&&b([].concat(ke()(M),[e])),U(!1),P("")},H=function(){U(!1),P("")};return(0,o.useEffect)((function(){if(n)u.setFieldsValue({uid:null==r?void 0:r.uid,fileName:null==r?void 0:r.fileName,content:null==r?void 0:r.content,categoryUid:null==r?void 0:r.categoryUid,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled}),h(null==r?void 0:r.categoryUid),b(D((null==r?void 0:r.tagList)||[]));else{if(u.setFieldsValue({fileName:"",content:"",enabled:!0}),f&&f.length>0){var e=f[0].value;u.setFieldValue("categoryUid",e),h(e)}b([]),U(!1),P("")}}),[n,r,u,f]),(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(B.Z,{title:n?"编辑文件":"添加文件",onClose:s,open:a,width:600,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:s,children:"取消"}),(0,J.jsx)(V.ZP,{type:"primary",onClick:L,loading:O,children:"提交"})]}),footer:null,children:(0,J.jsxs)(Pe.A,{form:u,name:"fileForm",submitter:!1,children:[(0,J.jsx)(Ee.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:f,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("file category selected ".concat(e)),h(e)}}}),(0,J.jsx)(qe.Z,{label:"文件名称",name:"fileName",rules:[{required:!0,message:"请输入文件名称"}],placeholder:"请输入文件名称"}),(0,J.jsx)(Oe.Z,{label:"文件内容",name:"content",rules:[{required:!0,message:"请输入文件内容"}],placeholder:"请输入文件内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"文件的文本内容，用于知识库检索"}),(0,J.jsx)(Pe.A.Item,{label:"标签",name:"tagList",tooltip:"为文件添加标签，便于分类和检索",children:(0,J.jsxs)("div",{style:{minHeight:"32px"},children:[(0,J.jsx)(N.Z,{wrap:!0,style:{marginBottom:8},children:D(M).map((function(e,t){return(0,J.jsx)(le.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void b(D(M.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),C?(0,J.jsxs)(N.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)(Fe.Z,{value:T,onChange:function(e){P(e.target.value)},onKeyDown:function(e){"Enter"===e.key?Y():"Escape"===e.key&&H()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,J.jsx)(V.ZP,{type:"primary",size:"small",icon:(0,J.jsx)(De.Z,{}),onClick:Y,disabled:!T.trim(),children:"保存"}),(0,J.jsx)(V.ZP,{size:"small",icon:(0,J.jsx)(Re.Z,{}),onClick:H,children:"取消"})]}):(0,J.jsx)(V.ZP,{type:"dashed",onClick:function(){U(!0),P("")},icon:(0,J.jsx)(te.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),!1]})})})},Le=["current","pageSize"],Ye=function(){var e=(0,p.useIntl)(),t=(0,o.useRef)(),n=(0,D.Z)().translateString,r=(0,o.useState)(1),s=S()(r,2),i=s[0],l=s[1],u=(0,o.useState)(10),c=S()(u,2),d=c[0],f=c[1],g=(0,z.u)((function(e){return e.currentOrg})),h=(0,R.j)((function(e){return e.currentKbase})),v=(0,Q.v)((function(e){return e.currentCategory})),M=(0,Q.v)((function(e){return e.categorySelectOptions})),b=(0,o.useState)(!1),j=S()(b,2),U=j[0],I=j[1],P=(0,o.useState)(!1),q=S()(P,2),F=q[0],L=q[1],B=(0,o.useState)([]),N=S()(B,2),H=N[0],fe=N[1],he=(0,o.useState)([]),xe=S()(he,2),ve=xe[0],ye=xe[1],be=(0,o.useState)(!1),ke=S()(be,2),je=ke[0],Se=ke[1],Ze=(0,o.useState)(!1),Ce=S()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,o.useState)({}),Pe=S()(Ie,2),Ee=Pe[0],qe=Pe[1],Oe=(0,o.useState)(0),Fe=S()(Oe,2),De=Fe[0],Re=Fe[1],Ye=oe.Z.useModal(),Be=S()(Ye,2),Ne=Be[0],Ve=Be[1],He=(0,o.useState)(!1),Je=S()(He,2),Xe=Je[0],Qe=Je[1],Ke=(0,o.useState)(void 0),We=S()(Ke,2),Ge=We[0],_e=We[1],$e=function(){var n=k()(w()().mark((function n(r){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T(r);case 2:200===n.sent.code?(null==t||t.current.reload(),Z.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):Z.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),et=function(){var n=k()(w()().mark((function n(r){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("handleFileDrawerSubmit",r),Z.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"})),Qe(!1),_e(void 0),n.next=6,A(r);case 6:200===n.sent.code?(null==t||t.current.reload(),Z.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"}))):Z.yw.error(e.formatMessage({id:"update.error",defaultMessage:"更新失败"}));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),tt=function(){var n=k()(w()().mark((function n(r){var a,s,o;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"rechunking",defaultMessage:"正在重新切块..."})),n.prev=1,a={uid:r.uid},n.next=5,O(a);case 5:s=n.sent,console.log("rechunk response",s,a),Z.yw.destroy(),200===s.code?(Z.yw.success(e.formatMessage({id:"rechunk.success",defaultMessage:"重新切块成功"})),null===(o=t.current)||void 0===o||o.reload()):Z.yw.error(s.message||e.formatMessage({id:"rechunk.failed",defaultMessage:"重新切块失败"})),n.next=16;break;case 11:n.prev=11,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"rechunk.error",defaultMessage:"重新切块过程发生错误"})),console.error("重新切块错误:",n.t0);case 16:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e){return n.apply(this,arguments)}}(),nt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,J.jsx)(p.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.file.fileName.tooltip"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.fileName;null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{style:{marginRight:4},children:o}),(0,J.jsx)(ie.Z.Text,{copyable:{text:(null==t?void 0:t.fileName)||""}})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"fileUrl",defaultMessage:"File URL"}),dataIndex:"fileUrl",ellipsis:!0,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.fileUrl.tooltip"}),render:function(t,n){return n.fileUrl?(0,J.jsxs)("a",{href:n.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,J.jsx)(W.Z,{})," ",e.formatMessage({id:"view.file"})]}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.tags.tooltip"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(G.Z,{})," ",null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,J.jsx)(le.Z,{children:e},e)}))]}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:e.formatMessage({id:"enabled"}),status:"Success"},false:{text:e.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.enabled.tooltip"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",ellipsis:!0,hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.file.category.tooltip"}),render:function(e,t){var n=M.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,J.jsx)(le.Z,{color:"blue",children:n.label}):(0,J.jsx)(le.Z,{color:"default",children:"未分类"})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.createdAt.tooltip"}),render:function(e,t){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,J.jsx)(p.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.updatedAt.tooltip"}),render:function(e,t){return t.updatedAt?pe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),key:"option",valueType:"option",width:140,fixed:"right",render:function(t,n){return[(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,J.jsx)(V.ZP,{type:"text",size:"small",icon:(0,J.jsx)(_.Z,{}),onClick:function(){return function(e){_e(e),Qe(!0)}(n)}})},"edit"),(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"rechunk",defaultMessage:"重新切块"}),children:(0,J.jsx)(V.ZP,{type:"text",size:"small",icon:(0,J.jsx)($.Z,{}),onClick:function(){return tt(n)}})},"rechunk"),(0,J.jsx)(ce.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return $e(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,J.jsx)(V.ZP,{type:"text",size:"small",icon:(0,J.jsx)(ee.Z,{}),danger:!0})})},"delete")]}}],rt=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ve.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=y()(ve),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,T(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):Z.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),fe([]),ye([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),at=function(){var e=k()(w()().mark((function e(t,n,r){var s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),s=localStorage.getItem(a.LA8),o=x()({categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:(null==g?void 0:g.uid)||"",accessToken:s||"",exportType:t},Ee),"current"===t?(o.pageNumber=i-1,o.pageSize=d):"all"===t?(o.pageNumber=0,o.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=n,o.pageSize=r),window.open((0,Y.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams(Object.entries(o).reduce((function(e,t){var n=S()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),st=function(){var n=k()(w()().mark((function n(){var r,s,o;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==De){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},n.next=8,E(r);case 8:s=n.sent,console.log("handleDeleteAllConfirm response:",s,r),200===s.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(Z.yw.destroy(),Z.yw.error(s.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),ot=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return at("range",r,n)}})},s=0;s<r;s++)a();return t};(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[h,v]),(0,o.useEffect)((function(){return K.Z.on(a.YwV,(function(e){var n;null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){K.Z.off(a.YwV)}}),[]);var it=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,me.HK)(a.QPQ,null==g?void 0:g.uid,null==h?void 0:h.uid,a.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(we,{onModelStatusChange:function(e){Se(e),Ae(!1)}}),(0,J.jsx)(se.Z,{columns:nt,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:H,onChange:function(e,t){fe(e),ye(t)}},scroll:{x:1800},request:function(){var e=k()(w()().mark((function e(t,n,r){var s,o,i,u,c,d,p,y;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,o=t.pageSize,i=m()(t,Le),l(s),f(o),qe(i),u=void 0,c=void 0,n&&Object.keys(n).length>0&&(d=Object.keys(n)[0],u=d,c="ascend"===n[d]?"ascend":"descend"),p=x()(x()({pageNumber:s-1,pageSize:o,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},i),{},{sortBy:u,sortDirection:c}),e.next=10,C(p);case 10:return 200===(y=e.sent).code?(console.log("queryFilesByOrg response:",p,y),Re(null==y?void 0:y.data.totalElements)):Z.yw.error(y.message),e.abrupt("return",{data:null==y?void 0:y.data.content,success:!0,total:null==y?void 0:y.data.totalElements});case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),f(t)}},dateFormatter:"string",headerTitle:n(null==h?void 0:h.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:function(){var t=[(0,J.jsx)(V.ZP,{icon:(0,J.jsx)(te.Z,{}),type:"primary",onClick:function(){return Me((function(){return I(!0)}),je,Ue)},disabled:Ue||!je,children:e.formatMessage({id:"upload",defaultMessage:"File"})},"upload"),(0,J.jsx)(Te,{currentKbase:h,currentOrg:g,embeddingModelExists:je,checkingEmbeddingModel:Ue||!je},"chat")],n=[];H.length>0&&n.push({key:"batchDelete",icon:(0,J.jsx)(ee.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(H.length,")"),onClick:function(){Ne.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(H.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:rt,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,J.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Ne.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文件数据吗？此操作不可恢复!"}),onOk:st,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return at("current")}}];return De>0&&(De<=1e3?r.push({key:"export-all",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(De,"条)"),onClick:function(){return at("all")}}):r.push({key:"export-range",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(De,"条)"),children:ot(De)})),t.push((0,J.jsx)(de.Z,{menu:{items:r},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,J.jsx)(ae.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,J.jsx)(de.Z,{menu:{items:n},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:H.length>0?"primary":"default",danger:H.length>0,children:[H.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(H.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,J.jsx)(ae.Z,{})]})},"batchOperations")),t}}),U&&(0,J.jsx)(ge.Z,{type:a.n1c,acceptType:"*",isModalOpen:U,handleSubmit:function(e){I(!1),null==t||t.current.reload(),it()},handleCancel:function(){I(!1),null==t||t.current.reload()}}),F&&(0,J.jsx)(X,{type:a.ACv,open:F,onClose:function(){return L(!1)}}),Xe&&(0,J.jsx)(ze,{file:Ge,open:Xe,onClose:function(){Qe(!1),_e(void 0)},onSubmit:et}),Ve]})};function Be(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/query/org",{method:"GET",params:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){return He.apply(this,arguments)}function He(){return(He=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/create",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/update",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qe(e){return Ke.apply(this,arguments)}function Ke(){return(Ke=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/delete",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/deleteAll",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){return $e.apply(this,arguments)}function $e(){return($e=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/updateIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e){return tt.apply(this,arguments)}function tt(){return(tt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/updateVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){return rt.apply(this,arguments)}function rt(){return(rt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/updateAllIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e){return st.apply(this,arguments)}function st(){return(st=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/updateAllVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e){return it.apply(this,arguments)}function it(){return(it=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e){return ut.apply(this,arguments)}function ut(){return(ut=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/text/enable",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=n(77274),dt=n(15722),ft=n(93689),pt=n(40439),gt=n(30617),mt=n(61107),ht=n(11591),xt=n(58087),vt=n(52491),yt=n(71876),Mt=function(e){var t=e.isEdit,n=e.text,r=e.open,s=e.onClose,i=e.onSubmit,l=Pe.A.useForm(),u=S()(l,1)[0],c=(0,o.useState)(""),d=S()(c,2),f=(d[0],d[1]),p=(0,z.u)((function(e){return e.currentOrg})),g=(0,Q.v)((function(e){return e.categorySelectOptions})),m=(0,Q.v)((function(e){return e.categoryTreeOptions})),h=(0,o.useState)(),v=S()(h,2),M=v[0],b=v[1],j=(0,R.j)((function(e){return e.currentKbase})),C=(0,o.useState)([]),U=S()(C,2),A=U[0],I=U[1],T=(0,o.useState)(!1),P=S()(T,2),E=P[0],q=P[1],O=(0,o.useState)(""),F=S()(O,2),D=F[0],L=F[1],Y=(0,o.useState)([]),H=S()(Y,2),X=H[0],K=H[1],W=(0,o.useState)(!1),G=S()(W,2),_=G[0],$=G[1],ee=(0,o.useState)(new Set),ne=S()(ee,2),re=ne[0],ae=ne[1],se=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},oe=function(){var e=k()(w()().mark((function e(){var t,n,r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.getFieldValue("title"),n=u.getFieldValue("content"),t&&n){e.next=5;break}return Z.yw.warning("请先填写标题和内容"),e.abrupt("return");case 5:return $(!0),e.prev=6,r={title:t,content:n,orgUid:null==p?void 0:p.uid},e.next=10,ot(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(Z.yw.success("常见问题生成成功"),K(null==a?void 0:a.data),ae(new Set)):(K([]),Z.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),Z.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,$(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){if(r){if(t)u.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid}),f((null==n?void 0:n.content)||""),b(null==n?void 0:n.categoryUid),I(se((null==n?void 0:n.tagList)||[]));else{u.resetFields();var e=function e(t){var n,r=y()(t||[]);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.key!==a.zBg)return s.key;var o=e(s.children||[]);if(o)return o}}catch(e){r.e(e)}finally{r.f()}return""}(m||[]);if(e)u.setFieldValue("categoryUid",e),b(e);else if(g&&g.length>0){var s=g[0].value;u.setFieldValue("categoryUid",s),b(s)}I([]),q(!1),L("")}K([]),ae(new Set)}}),[r,t,n,u,g,m]);var ce=function(){var e=D.trim();if(e&&!A.includes(e)){var t=se([].concat(ke()(A),[e]));I(t)}q(!1),L("")},de=function(){q(!1),L("")},fe=function(){var e=k()(w()().mark((function e(t,n){var r,a,s;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!re.has(n)){e.next=4;break}return Z.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=x()(x()({},t),{},{categoryUid:M||u.getFieldValue("categoryUid"),kbUid:null==j?void 0:j.uid,orgUid:null==p?void 0:p.uid,type:"TEXT"}),Z.yw.loading("正在保存常见问题..."),e.next=8,(0,ht.kh)(r);case 8:200===(a=e.sent).code?((s=new Set(re)).add(n),ae(s),Z.yw.success("常见问题保存成功")):Z.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),Z.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(B.Z,{title:t?"修改文本":"新建文本",onClose:s,open:r,width:650,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:s,children:"取消"}),(0,J.jsx)(V.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=x()(x()({},e),{},{categoryUid:M,tagList:se(A),kbUid:null==j?void 0:j.uid,orgUid:null==p?void 0:p.uid});console.log("submit",t),i(t)}))},type:"primary",children:"保存"}),(0,J.jsx)(V.ZP,{onClick:oe,type:"default",loading:_,icon:(0,J.jsx)(xt.Z,{}),children:"智能生成常见问题"})]}),children:(0,J.jsxs)(Pe.A,{form:u,submitter:{render:function(){return null}},children:[(0,J.jsx)(vt.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==a.zBg})).map((function(t){return x()(x()({},t),{},{children:e(t.children)})}))}(m||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),b(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,J.jsx)(qe.Z,{label:"标题",name:"title",rules:[{required:!0}]}),(0,J.jsx)(Pe.A.Item,{label:"标签",name:"tagList",tooltip:"为文本添加标签，便于分类和检索",children:(0,J.jsxs)("div",{style:{minHeight:"32px"},children:[(0,J.jsx)(N.Z,{wrap:!0,style:{marginBottom:8},children:se(A).map((function(e,t){return(0,J.jsx)(le.Z,{closable:!0,color:"blue",onClose:function(){return t=e,n=se(A.filter((function(e){return e!==t}))),void I(n);var t,n},style:{marginBottom:4},children:e},t)}))}),E?(0,J.jsxs)(N.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)(Fe.Z,{value:D,onChange:function(e){L(e.target.value)},onKeyDown:function(e){"Enter"===e.key?ce():"Escape"===e.key&&de()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,J.jsx)(V.ZP,{type:"primary",size:"small",icon:(0,J.jsx)(De.Z,{}),onClick:ce,disabled:!D.trim(),children:"保存"}),(0,J.jsx)(V.ZP,{size:"small",icon:(0,J.jsx)(Re.Z,{}),onClick:de,children:"取消"})]}):(0,J.jsx)(V.ZP,{type:"dashed",onClick:function(){q(!0),L("")},icon:(0,J.jsx)(te.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,J.jsx)(Oe.Z,{label:"内容",name:"content",rules:[{required:!0}]}),X.length>0&&(0,J.jsxs)("div",{style:{marginTop:16},children:[(0,J.jsx)(ie.Z.Title,{level:5,children:"常见问题列表"}),(0,J.jsx)(yt.Z,{bordered:!0,dataSource:X,renderItem:function(e,t){return(0,J.jsx)(yt.Z.Item,{actions:[(0,J.jsx)(ue.Z,{title:re.has(t)?"已保存":"保存到常见问题库",children:(0,J.jsx)(V.ZP,{type:re.has(t)?"default":"primary",icon:(0,J.jsx)(De.Z,{}),size:"small",disabled:re.has(t),onClick:function(){return fe(e,t)},children:re.has(t)?"已保存":"保存"})},"save")],children:(0,J.jsx)(yt.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})})},wt=["current","pageSize"],bt=function(){var e=(0,p.useIntl)(),t=(0,o.useRef)(),n=(0,D.Z)().translateString,r=(0,o.useState)(1),s=S()(r,2),i=s[0],l=s[1],u=(0,o.useState)(10),c=S()(u,2),d=c[0],f=c[1],g=(0,z.u)((function(e){return e.currentOrg})),h=(0,R.j)((function(e){return e.currentKbase})),v=(0,Q.v)((function(e){return e.currentCategory})),M=(0,Q.v)((function(e){return e.categorySelectOptions})),b=(0,o.useState)(!1),j=S()(b,2),C=j[0],U=j[1],A=(0,o.useState)({}),I=S()(A,2),T=I[0],P=I[1],E=(0,o.useState)(!1),q=S()(E,2),O=q[0],F=q[1],L=oe.Z.useModal(),B=S()(L,2),N=B[0],H=B[1],X=(0,o.useState)([]),K=S()(X,2),W=K[0],G=K[1],_=(0,o.useState)([]),$=S()(_,2),ie=$[0],ce=$[1],fe=(0,o.useState)(!1),he=S()(fe,2),xe=he[0],ve=he[1],ye=(0,o.useState)(!1),Me=S()(ye,2),be=Me[0],ke=Me[1],je=(0,o.useState)({}),Se=S()(je,2),Ze=Se[0],Ce=Se[1],Ue=(0,o.useState)(0),Ae=S()(Ue,2),Ie=Ae[0],Pe=Ae[1],Ee=(0,o.useState)(!1),qe=S()(Ee,2),Oe=qe[0],Fe=qe[1],De=function(){var n=k()(w()().mark((function n(r){var a;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,Qe(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(Z.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):Z.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Re=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ie.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=y()(ie),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Qe(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):Z.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),G([]),ce([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),ze=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,J.jsx)(p.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.text.title.tooltip",defaultMessage:"文档的标题"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0,copyable:!0,tooltip:e.formatMessage({id:"llm.text.content.tooltip",defaultMessage:"文档的具体内容"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.status.tooltip",defaultMessage:"文档索引处理状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,J.jsx)(le.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.vectorStatus.tooltip",defaultMessage:"文档向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,J.jsx)(le.Z,{color:a,icon:(0,J.jsx)(ct.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.category.tooltip",defaultMessage:"文档所属的分类"}),render:function(e,t){var n=M.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,J.jsx)(le.Z,{color:"blue",children:n.label}):(0,J.jsx)(le.Z,{color:"default",children:"未分类"})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"llm.text.tags.tooltip",defaultMessage:"文档的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,J.jsxs)("div",{children:[r.map((function(e,t){return(0,J.jsx)(le.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,J.jsxs)(le.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.createdAt.tooltip",defaultMessage:"文档创建的时间"}),render:function(e,t){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,J.jsx)(p.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.updatedAt.tooltip",defaultMessage:"文档最后更新的时间"}),render:function(e,t){return t.updatedAt?pe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Le=[].concat(ze,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){P(n),F(!0),U(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,J.jsx)(V.ZP,{type:"link",onClick:function(){return function(t){N.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,J.jsx)(dt.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.title,"】？"),onOk:function(){De(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete"),(0,J.jsx)(de.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return He(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Xe(n)}}]},placement:"bottomRight",children:(0,J.jsxs)(V.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,J.jsx)(ae.Z,{})]})},"indexOperations")]}}]);(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[h,v]);var Ye=function(){var e=k()(w()().mark((function e(n){var r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),U(!1)):Z.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ne=function(){var e=k()(w()().mark((function e(n){var r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==T?void 0:T.uid,e.next=3,Je(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),U(!1)):Z.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(){var n=k()(w()().mark((function n(r){var a,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,_e({uid:r.uid});case 4:a=n.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Xe=function(){var n=k()(w()().mark((function n(r){var a,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,et({uid:r.uid});case 4:a=n.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Ke=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ie.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=y()(ie),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,_e({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):Z.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Ge=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ie.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=y()(ie),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,et({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):Z.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),$e=function(){var n=k()(w()().mark((function n(){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=k()(w()().mark((function n(){var r,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),n.prev=1,n.next=4,nt({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=n.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),tt=function(){var n=k()(w()().mark((function n(){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=k()(w()().mark((function n(){var r,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),n.prev=1,n.next=4,at({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=n.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),rt=function(){xe?be?Z.yw.info("正在检查模型状态，请稍后再试"):(U(!0),F(!1),P({})):N.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},st=function(){var n=k()(w()().mark((function n(){var r,s,o;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ie){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},n.next=8,We(r);case 8:s=n.sent,console.log("handleDeleteAllConfirm response:",s,r),200===s.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(Z.yw.destroy(),Z.yw.error(s.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),ot=function(){var e=k()(w()().mark((function e(t,n,r){var s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),s=localStorage.getItem(a.LA8),o=x()({categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid,accessToken:s||"",exportType:t},Ze),"current"===t?(o.pageNumber=String(i-1),o.pageSize=String(d)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=String(n),o.pageSize=String(r)),window.open((0,Y.kG)()+"/api/v1/llm/text/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),it=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,me.HK)(a.QPQ,null==g?void 0:g.uid,null==h?void 0:h.uid,a.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ut=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(xe){t.next=3;break}return N.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响向量检索质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){Fe(!0)}}),t.abrupt("return");case 3:if(!be){t.next=6;break}return Z.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:Fe(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ht={selectedRowKeys:W,onChange:function(e,t){G(e),ce(t)}},xt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return ot("range",r,n)}})},s=0;s<r;s++)a();return t},vt=function(){var n=k()(w()().mark((function n(r){var a,s,o,i,l,u;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ie.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"请选择要处理的项目"})),n.abrupt("return");case 3:Z.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"正在启用..."}):e.formatMessage({id:"disabling",defaultMessage:"正在禁用..."})),s=0,o=0,i=y()(ie),n.prev=7,i.s();case 9:if((l=i.n()).done){n.next=23;break}return u=l.value,n.prev=11,n.next=14,lt({uid:u.uid,enabled:r});case 14:200===n.sent.code?s++:o++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),o++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),i.e(n.t1);case 28:return n.prev=28,i.f(),n.finish(28);case 31:Z.yw.destroy(),0===o?Z.yw.success(r?e.formatMessage({id:"batch.enable.success",defaultMessage:"成功启用 {count} 条记录"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"成功禁用 {count} 条记录"},{count:s})):Z.yw.warning(r?e.formatMessage({id:"batch.enable.partial",defaultMessage:"启用了 {success} 条记录，{fail} 条记录启用失败"},{success:s,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"禁用了 {success} 条记录，{fail} 条记录禁用失败"},{success:s,fail:o})),G([]),ce([]),null===(a=t.current)||void 0===a||a.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(e){return n.apply(this,arguments)}}();return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(we,{onModelStatusChange:function(e){ve(e),ke(!1)}}),(0,J.jsx)(se.Z,{columns:Le,actionRef:t,cardBordered:!0,rowSelection:ht,scroll:{x:1500},sticky:!0,request:function(){var t=k()(w()().mark((function t(n,r,s){var o,i,u,c,d,p,y,M;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,s),Z.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,u=m()(n,wt),l(o),f(i),Ce(u),c=void 0,d=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],c=p,d="ascend"===r[p]?"ascend":"descend"),y=x()(x()({pageNumber:o-1,pageSize:i,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},u),{},{sortBy:c,sortDirection:d}),t.next=12,Be(y);case 12:return M=t.sent,console.log("queryTextsByOrg response:",y,M),Z.yw.destroy(),200===M.code?Pe(null==M?void 0:M.data.totalElements):Z.yw.error(M.message),t.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){l(e),f(t)}},dateFormatter:"string",headerTitle:n(null==h?void 0:h.name)+" - 文本列表",tooltip:be?"正在检查嵌入式模型...":xe?"所添加文本内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[];(0,Y.Ox)()||t.push((0,J.jsx)(V.ZP,{icon:(0,J.jsx)(te.Z,{}),type:"primary",onClick:rt,disabled:be,children:e.formatMessage({id:"create"})},"create"),(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,J.jsx)(Te,{currentKbase:h,currentOrg:g,embeddingModelExists:xe,checkingEmbeddingModel:be})},"chat"));var n=[];W.length>0&&n.push({key:"batchDelete",icon:(0,J.jsx)(ee.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){oe.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Re,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,J.jsx)(ft.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(W.length,")"),onClick:function(){return vt(!0)}},{key:"batchDisable",icon:(0,J.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(W.length,")"),onClick:function(){return vt(!1)}},{key:"batchUpdateIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(W.length,")"),onClick:Ke},{key:"batchUpdateVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(W.length,")"),onClick:Ge}),n.push({key:"deleteAll",icon:(0,J.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){oe.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文本数据吗？此操作不可恢复!"}),onOk:st,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:$e},{key:"updateAllVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:tt});var r=[{key:"import",icon:(0,J.jsx)(gt.Z,{}),label:e.formatMessage({id:"import"}),onClick:ut,disabled:be},{key:"export-current",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ot("current")}}];return Ie>0&&(Ie<=1e3?r.push({key:"export-all",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ie,"条)"),onClick:function(){return ot("all")}}):r.push({key:"export-range",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ie,"条)"),children:xt(Ie)})),r.push({key:"download",icon:(0,J.jsx)(mt.Z,{}),label:e.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,Y.LG)()}}),t.push((0,J.jsx)(de.Z,{menu:{items:r},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,J.jsx)(ae.Z,{})]})},"importExport")),n.length>0&&t.push((0,J.jsx)(de.Z,{menu:{items:n},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,J.jsx)(ae.Z,{})]})},"batchOperations")),t}()}}),C&&(0,J.jsx)(Mt,{isEdit:O,open:C,text:T,onClose:function(){U(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),O?Ne(e):Ye(e)}}),Oe&&(0,J.jsx)(ge.Z,{type:a.pBv,acceptType:".xlsx,.xls,.csv",isModalOpen:Oe,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Fe(!1),null==t||t.current.reload(),it()},handleCancel:function(){console.log("handleUploadDragCancel"),Fe(!1),null==t||t.current.reload()}}),H]})};function kt(e){return jt.apply(this,arguments)}function jt(){return(jt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/query/org",{method:"GET",params:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function St(e){return Zt.apply(this,arguments)}function Zt(){return(Zt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/update",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e){return Ut.apply(this,arguments)}function Ut(){return(Ut=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/delete",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function At(e){return It.apply(this,arguments)}function It(){return(It=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/delete/all",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/updateIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Et(e){return qt.apply(this,arguments)}function qt(){return(qt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/updateVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ot(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/updateAllIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e){return Rt.apply(this,arguments)}function Rt(){return(Rt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/chunk/updateAllVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(e){return Lt.apply(this,arguments)}function Lt(){return(Lt=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yt=n(31543),Bt=n(90104),Nt=n(93312),Vt=function(e){var t=e.isEdit,n=e.chunk,r=e.open,a=e.onClose,s=e.onSubmit,i=Pe.A.useForm(),l=S()(i,1)[0],u=(0,p.useIntl)(),c=(0,z.u)((function(e){return e.currentOrg})),d=(0,R.j)((function(e){return e.currentKbase})),f=(0,Q.v)((function(e){return e.currentCategory})),g=(0,Q.v)((function(e){return e.categorySelectOptions})),m=(0,o.useState)(),h=S()(m,2),v=h[0],y=h[1],M=(0,o.useState)([]),b=S()(M,2),j=b[0],C=b[1],U=(0,o.useState)(!1),A=S()(U,2),I=A[0],T=A[1],P=(0,o.useState)(""),E=S()(P,2),q=E[0],O=E[1],F=(0,o.useState)(!1),D=S()(F,2),L=D[0],Y=D[1],H=(0,o.useState)([]),X=S()(H,2),K=X[0],W=X[1],G=(0,o.useState)(new Set),_=S()(G,2),$=_[0],ee=_[1],ne=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},re=function(){var e=k()(w()().mark((function e(){var t,r;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Y(!0),e.next=4,l.validateFields();case 4:t=e.sent,r=x()(x()(x()({},n),t),{},{categoryUid:v,tagList:ne(j),kbUid:null==d?void 0:d.uid,orgUid:null==c?void 0:c.uid}),console.log("submit",r),s(r),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),Z.yw.error("请检查表单填写是否正确");case 14:return e.prev=14,Y(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=q.trim();e&&!j.includes(e)&&C([].concat(ke()(j),[e])),T(!1),O("")},se=function(){T(!1),O("")},oe=function(){var e=k()(w()().mark((function e(){var t,n,r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.getFieldValue("name"),n=l.getFieldValue("content"),t&&n){e.next=5;break}return Z.yw.warning("请先填写名称和内容"),e.abrupt("return");case 5:return Y(!0),e.prev=6,r={name:t,content:n,orgUid:null==c?void 0:c.uid},e.next=10,zt(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(Z.yw.success("常见问题生成成功"),W(null==a?void 0:a.data),ee(new Set)):(W([]),Z.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),Z.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,Y(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=k()(w()().mark((function e(t,n){var r,a,s;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!$.has(n)){e.next=4;break}return Z.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=x()(x()({},t),{},{categoryUid:null==f?void 0:f.uid,kbUid:null==d?void 0:d.uid,orgUid:null==c?void 0:c.uid,type:"TEXT"}),Z.yw.loading("正在保存常见问题..."),e.next=8,(0,ht.kh)(r);case 8:200===(a=e.sent).code?((s=new Set($)).add(n),ee(s),Z.yw.success("常见问题保存成功")):Z.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),Z.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){if(t&&n)l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid,enabled:void 0===(null==n?void 0:n.enabled)||n.enabled}),y(null==n?void 0:n.categoryUid),C(ne((null==n?void 0:n.tagList)||[]));else{if(l.setFieldsValue({name:"",content:"",enabled:!0}),g&&g.length>0){var e=g[0].value;l.setFieldValue("categoryUid",e),y(e)}C([]),T(!1),O("")}W([]),ee(new Set)}),[t,n,l,g]),(0,J.jsx)(B.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:a,children:"取消"}),(0,J.jsx)(V.ZP,{onClick:re,type:"primary",children:"保存"}),(0,J.jsx)(V.ZP,{onClick:oe,type:"default",loading:L,icon:(0,J.jsx)(xt.Z,{}),children:"智能生成常见问题"})]}),children:(0,J.jsxs)(Pe.A,{form:l,name:"chunkForm",submitter:!1,children:[(0,J.jsx)(Ee.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:g,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("chunk category selected ".concat(e)),y(e)}}}),(0,J.jsx)(qe.Z,{label:u.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0,message:"请输入名称"}],placeholder:"请输入拆分文档名称"}),(0,J.jsx)(Nt.Z,{label:"启用状态",name:"enabled",checkedChildren:"启用",unCheckedChildren:"禁用",tooltip:"控制拆分文档是否在知识库中生效",fieldProps:{defaultChecked:!0}}),(0,J.jsx)(Oe.Z,{label:u.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0,message:"请输入内容"}],placeholder:"请输入拆分文档内容",fieldProps:{rows:6,maxLength:1e4,showCount:!0},tooltip:"拆分文档的文本内容，用于知识库检索"}),(0,J.jsx)(Pe.A.Item,{label:"标签",name:"tagList",tooltip:"为拆分文档添加标签，便于分类和检索",children:(0,J.jsxs)("div",{style:{minHeight:"32px"},children:[(0,J.jsx)(N.Z,{wrap:!0,style:{marginBottom:8},children:ne(j).map((function(e,t){return(0,J.jsx)(le.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void C(ne(j.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),I?(0,J.jsxs)(N.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)(Fe.Z,{value:q,onChange:function(e){O(e.target.value)},onKeyDown:function(e){"Enter"===e.key?ae():"Escape"===e.key&&se()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,J.jsx)(V.ZP,{type:"primary",size:"small",icon:(0,J.jsx)(De.Z,{}),onClick:ae,disabled:!q.trim(),children:"保存"}),(0,J.jsx)(V.ZP,{size:"small",icon:(0,J.jsx)(Re.Z,{}),onClick:se,children:"取消"})]}):(0,J.jsx)(V.ZP,{type:"dashed",onClick:function(){T(!0),O("")},icon:(0,J.jsx)(te.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),K.length>0&&(0,J.jsxs)("div",{style:{marginTop:16},children:[(0,J.jsx)(ie.Z.Title,{level:5,children:"常见问题列表"}),(0,J.jsx)(yt.Z,{bordered:!0,dataSource:K,renderItem:function(e,t){return(0,J.jsx)(yt.Z.Item,{actions:[(0,J.jsx)(ue.Z,{title:$.has(t)?"已保存":"保存到常见问题库",children:(0,J.jsx)(V.ZP,{type:$.has(t)?"default":"primary",icon:(0,J.jsx)(De.Z,{}),size:"small",disabled:$.has(t),onClick:function(){return ce(e,t)},children:$.has(t)?"已保存":"保存"})},"save")],children:(0,J.jsx)(yt.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})},Ht=n(7358),Jt=["current","pageSize"],Xt=function(){var e=(0,p.useIntl)(),t=(0,o.useRef)(),n=(0,D.Z)().translateString,r=(0,o.useState)(1),s=S()(r,2),i=s[0],l=s[1],u=(0,o.useState)(10),c=S()(u,2),d=c[0],f=c[1],g=(0,z.u)((function(e){return e.currentOrg})),h=(0,R.j)((function(e){return e.currentKbase})),v=(0,Q.v)((function(e){return e.currentCategory})),M=(0,Q.v)((function(e){return e.categorySelectOptions})),b=(0,o.useState)(!1),j=S()(b,2),C=j[0],U=j[1],A=(0,o.useState)(!1),I=S()(A,2),T=I[0],P=I[1],E=(0,o.useState)(),q=S()(E,2),O=q[0],F=q[1],L=(0,o.useState)([]),B=S()(L,2),N=B[0],H=B[1],W=(0,o.useState)([]),G=S()(W,2),_=G[0],$=G[1],te=(0,o.useState)(!1),ue=S()(te,2),fe=ue[0],ge=ue[1],me=(0,o.useState)(!1),he=S()(me,2),xe=he[0],ve=he[1],ye=(0,o.useState)({}),Me=S()(ye,2),be=Me[0],ke=Me[1],je=(0,o.useState)(0),Se=S()(je,2),Ze=Se[0],Ce=Se[1],Ue=oe.Z.useModal(),Ae=S()(Ue,2),Ie=Ae[0],Pe=Ae[1],Ee=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0,fixed:"left"},{title:(0,J.jsx)(p.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.chunk.name.tooltip",defaultMessage:"拆分后的内容块名称"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.name;null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{style:{marginRight:4},children:o}),(0,J.jsx)(ie.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,copyable:!0,width:300,tooltip:e.formatMessage({id:"llm.chunk.content.tooltip",defaultMessage:"拆分后的内容块具体内容"}),render:function(t,n){var r=n.content||"-",a=function(){var t=k()(w()().mark((function t(n){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,Bt.TE)(n);case 2:t.sent.success?Z.yw.success(e.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):Z.yw.error(e.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,J.jsx)(Yt.Z,{content:(0,J.jsxs)("div",{children:[(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,J.jsx)("span",{children:e.formatMessage({id:"chunk.content.preview",defaultMessage:"拆分内容预览"})}),(0,J.jsx)(V.ZP,{type:"text",icon:(0,J.jsx)(Ht.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:e.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,J.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:e.formatMessage({id:"chunk.content",defaultMessage:"拆分内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,J.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.status.tooltip",defaultMessage:"拆分内容的处理状态，主要用于全文检索"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,J.jsx)(le.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.vectorStatus.tooltip",defaultMessage:"拆分内容的向量化处理状态，主要用于向量存储和检索"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,J.jsx)(le.Z,{color:a,icon:(0,J.jsx)(ct.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,tooltip:e.formatMessage({id:"llm.chunk.tags.tooltip",defaultMessage:"拆分内容的标签，用于分类和搜索"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,J.jsx)(J.Fragment,{children:null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,J.jsx)(le.Z,{color:"blue",style:{marginBottom:4},children:e},e)}))}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.category.tooltip",defaultMessage:"拆分内容所属的分类"}),render:function(e,t){var n=M.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,J.jsx)(le.Z,{color:"blue",children:n.label}):(0,J.jsx)(le.Z,{color:"default",children:"未分类"})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:e.formatMessage({id:"enabled"}),status:"Success"},false:{text:e.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,width:100,tooltip:e.formatMessage({id:"llm.chunk.enabled.tooltip",defaultMessage:"拆分内容是否启用"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.createdAt.tooltip",defaultMessage:"拆分内容创建的时间"}),render:function(e,t){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,J.jsx)(p.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.updatedAt.tooltip",defaultMessage:"拆分内容最后更新的时间"}),render:function(e,t){return t.updatedAt?pe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],qe=function(){var n=k()(w()().mark((function n(r){var a;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,Ct(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),Z.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):Z.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Oe=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=y()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Ct(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):Z.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),H([]),$([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Fe=function(){var n=k()(w()().mark((function n(r){var a,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!O){n.next=7;break}return n.next=4,St(x()(x()({},r),{},{uid:O.uid}));case 4:a=n.sent,n.next=7;break;case 7:200===a.code?(Z.yw.success(e.formatMessage({id:O?"update.success":"add.success",defaultMessage:O?"Update Success":"Add Success"})),P(!1),null==t||null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(a.message),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),Z.yw.error(e.formatMessage({id:O?"update.error":"add.error",defaultMessage:O?"Update Error":"Add Error"}));case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}(),De=[].concat(Ee,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){return function(e){F(e),P(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,J.jsx)(ce.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return qe(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,J.jsx)(V.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,J.jsx)(de.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Re(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return ze(n)}}]},placement:"bottomRight",children:(0,J.jsxs)(V.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,J.jsx)(ae.Z,{})]})},"indexOperations")]}}]),Re=function(){var n=k()(w()().mark((function n(r){var a,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,Tt({uid:r.uid});case 4:a=n.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),ze=function(){var n=k()(w()().mark((function n(r){var a,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,Et({uid:r.uid});case 4:a=n.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Le=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=y()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Tt({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):Z.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Ye=function(){var n=k()(w()().mark((function n(){var r,a,s,o,i,l;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=y()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Et({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):Z.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Be=function(){var n=k()(w()().mark((function n(){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=k()(w()().mark((function n(){var r,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),n.prev=1,n.next=4,Ot({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=n.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Ne=function(){var n=k()(w()().mark((function n(){return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=k()(w()().mark((function n(){var r,s;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),n.prev=1,n.next=4,Dt({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=n.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(s=t.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[h,v]),(0,o.useEffect)((function(){return K.Z.on(a.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){K.Z.off(a.YwV)}}),[]);var Ve=function(){var e=k()(w()().mark((function e(t,n,r){var s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),s=localStorage.getItem(a.LA8),o=x()({categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:(null==g?void 0:g.uid)||"",accessToken:s||"",exportType:t},be),"current"===t?(o.pageNumber=i-1,o.pageSize=d):"all"===t?(o.pageNumber=0,o.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=n,o.pageSize=r),window.open((0,Y.kG)()+"/api/v1/llm/chunk/export?"+new URLSearchParams(Object.entries(o).reduce((function(e,t){var n=S()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),He=function(){var n=k()(w()().mark((function n(){var r,s,o;return w()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ze){n.next=3;break}return Z.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},n.next=8,At(r);case 8:s=n.sent,console.log("handleDeleteAllConfirm response:",s,r),200===s.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(Z.yw.destroy(),Z.yw.error(s.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),Je=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Ve("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(we,{onModelStatusChange:function(e){ge(e),ve(!1)}}),(0,J.jsx)(se.Z,{columns:De,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:N,onChange:function(e,t){H(e),$(t)}},scroll:{x:2e3},request:function(){var e=k()(w()().mark((function e(t,n,r){var s,o,i,u,c,d,p,y;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),s=t.current,o=t.pageSize,i=m()(t,Jt),l(s),f(o),ke(i),u=void 0,c=void 0,n&&Object.keys(n).length>0&&(d=Object.keys(n)[0],u=d,c="ascend"===n[d]?"ascend":"descend"),p=x()(x()({pageNumber:s-1,pageSize:o,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},i),{},{sortBy:u,sortDirection:c}),e.next=11,kt(p);case 11:return y=e.sent,console.log("queryChunksByOrg response:",y,p),200===y.code?Ce(null==y?void 0:y.data.totalElements):Z.yw.error(y.message),e.abrupt("return",{data:null==y?void 0:y.data.content,success:!0,total:null==y?void 0:y.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),f(t)}},dateFormatter:"string",headerTitle:n(null==h?void 0:h.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:function(){var t=[(0,J.jsx)(Te,{currentKbase:h,currentOrg:g,embeddingModelExists:fe,checkingEmbeddingModel:xe||!fe},"chat")],n=[];N.length>0&&n.push({key:"batchDelete",icon:(0,J.jsx)(ee.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(N.length,")"),onClick:function(){Ie.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(N.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Oe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchUpdateIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(N.length,")"),onClick:Le},{key:"batchUpdateVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(N.length,")"),onClick:Ye}),n.push({key:"deleteAll",icon:(0,J.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Ie.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有拆分数据吗？此操作不可恢复!"}),onOk:He,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Be},{key:"updateAllVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Ne});var r=[{key:"export-current",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ve("current")}}];return Ze>0&&(Ze<=1e3?r.push({key:"export-all",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ze,"条)"),onClick:function(){return Ve("all")}}):r.push({key:"export-range",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ze,"条)"),children:Je(Ze)})),t.push((0,J.jsx)(de.Z,{menu:{items:r},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,J.jsx)(ae.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,J.jsx)(de.Z,{menu:{items:n},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:N.length>0?"primary":"default",danger:N.length>0,children:[N.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(N.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,J.jsx)(ae.Z,{})]})},"batchOperations")),t}}),C&&(0,J.jsx)(X,{type:a.ACv,open:C,onClose:function(){return U(!1)}}),(0,J.jsx)(Vt,{isEdit:!!O,chunk:O,open:T,onClose:function(){return P(!1)},onSubmit:Fe}),Pe]})},Qt=n(15858),Kt=n(78792),Wt=n(69438),Gt=n(30813),_t=n(62715),$t=n(87373),en=n(34759),tn=n(51891),nn=n(53816),rn=["key"],an=function(e){var t=e.isEdit,n=e.faq,r=e.open,s=e.onClose,i=e.onSubmit,l=Pe.A.useForm(),u=S()(l,1)[0],c=(0,o.useState)(""),d=S()(c,2),f=d[0],p=d[1],g=(0,o.useState)(""),h=S()(g,2),v=h[0],M=h[1],b=(0,o.useState)(""),j=S()(b,2),C=j[0],U=j[1],A=(0,z.u)((function(e){return e.currentOrg})),I=(0,R.j)((function(e){return e.currentKbase})),T=(0,Q.v)((function(e){return e.categorySelectOptions})),P=(0,Q.v)((function(e){return e.categoryTreeOptions})),E=(0,Q.v)((function(e){return e.currentCategory})),q=(0,o.useState)(),O=S()(q,2),F=(O[0],O[1]),D=(0,o.useState)([]),L=S()(D,2),H=L[0],X=L[1],K=(0,o.useState)(!1),W=S()(K,2),G=W[0],_=W[1],$=(0,o.useState)(""),ee=S()($,2),ne=ee[0],re=ee[1],ae=(0,o.useRef)(null),se=(0,o.useState)([]),ie=S()(se,2),ce=(ie[0],ie[1]),de=(0,o.useState)([]),fe=S()(de,2),ge=fe[0],me=fe[1],he=(0,o.useState)(!0),xe=S()(he,2),ve=xe[0],ye=xe[1],Me=(0,o.useState)("permanent"),we=S()(Me,2),be=we[0],je=we[1],Se=(0,o.useState)([]),Ze=S()(Se,2),Ce=Ze[0],Ae=Ze[1],Ie=(0,o.useState)(!1),Te=S()(Ie,2),De=Te[0],Re=Te[1],ze=(0,o.useState)([]),Le=S()(ze,2),Ye=Le[0],Be=Le[1],Ne=(0,o.useState)([]),Ve=S()(Ne,2),He=Ve[0],Je=Ve[1],Xe=(0,o.useState)(!1),Qe=S()(Xe,2),Ke=Qe[0],We=Qe[1],Ge=(0,o.useState)(""),_e=S()(Ge,2),$e=_e[0],et=_e[1],tt=(0,o.useState)(""),nt=S()(tt,2),rt=nt[0],at=nt[1],st=(0,o.useState)([]),ot=S()(st,2),it=ot[0],lt=ot[1],ut=(0,o.useState)([]),ct=S()(ut,2),dt=ct[0],ft=ct[1],pt=(0,o.useState)(!1),gt=S()(pt,2),mt=gt[0],yt=gt[1];(0,o.useEffect)((function(){var e=function(){var e=k()(w()().mark((function e(){var t,r,s;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Z.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==E?void 0:E.uid)===a.zBg?"":null==E?void 0:E.uid,kbUid:null==I?void 0:I.uid,orgUid:null==A?void 0:A.uid},e.next=5,(0,ht.pf)(t);case 5:r=e.sent,Z.yw.destroy(),200===r.code?(s=null==r?void 0:r.data.content.map((function(e){return{label:e.question,value:e.uid}})),me(s.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):Z.yw.error(r.message||"加载常见问题失败"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),Z.yw.destroy(),Z.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();r&&e()}),[r,null==I?void 0:I.uid,null==A?void 0:A.uid,null==E?void 0:E.uid,null==n?void 0:n.uid]),(0,o.useEffect)((function(){if(t){var e,r,a,s,o,i=Array.isArray(null==n?void 0:n.similarQuestions)?n.similarQuestions.map((function(e){return"string"==typeof e?e:String(e)})).filter((function(e){return""!==e.trim()})):[];if(u.setFieldsValue({question:null==n?void 0:n.question,similarQuestions:i,answer:null==n?void 0:n.answer,answerHtml:null==n?void 0:n.answerHtml,answerMarkdown:null==n?void 0:n.answerMarkdown,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==I?void 0:I.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateType:"permanent",dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[pe()(n.startDate),pe()(n.endDate)]:void 0}),console.log("edit faq:",n),p((null==n?void 0:n.answer)||""),M((null==n?void 0:n.answerHtml)||(null==n?void 0:n.answer)||""),U((null==n?void 0:n.answerMarkdown)||(null==n?void 0:n.answer)||""),Re(!1),X((null==n||null===(r=n.tagList)||void 0===r?void 0:r.filter((function(e){return e&&""!==e.trim()})))||[]),ce((null==n||null===(a=n.relatedFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]),ye(!1!==(null==n?void 0:n.enabled)),Ae(i),null!=n&&null!==(s=n.images)&&void 0!==s&&s.length&&n.images.some((function(e){return e&&""!==e.trim()}))){var l=n.images.filter((function(e){return e&&""!==e.trim()})),c=l.map((function(e,t){return{uid:"-".concat(t+1),name:"image_".concat(t+1,".jpg"),status:"done",url:e,thumbUrl:e}}));Be(c),Je(l)}else Be([]),Je([]);if(null!=n&&null!==(o=n.attachments)&&void 0!==o&&o.length&&n.attachments.some((function(e){return e&&""!==e.trim()}))){var d=n.attachments.filter((function(e){return e&&""!==e.trim()})),f=d.map((function(e,t){var n=e.substring(e.lastIndexOf("/")+1);return{uid:"-".concat(t+1),name:n||"attachment_".concat(t+1),status:"done",url:e}}));lt(f),ft(d)}else lt([]),ft([])}else{var g=Mt(P);u.setFieldsValue({question:"",similarQuestions:[],answer:"",categoryUid:g,kbUid:null==I?void 0:I.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateType:"permanent",dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),g&&F(g),p(""),M(""),U(""),Re(!1),X([]),ce([]),ye(!0),Ae([]),Be([]),Je([]),lt([]),ft([])}}),[n,r,T,P]);var Mt=function e(t){var n,r=y()(t||[]);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.key!==a.zBg)return s.key;var o=e(s.children||[]);if(o)return o}}catch(e){r.e(e)}finally{r.f()}return""};(0,o.useEffect)((function(){var e;G&&(null===(e=ae.current)||void 0===e||e.focus())}),[G]),(0,o.useEffect)((function(){console.log("editorAnswer",f),console.log("editorAnswerHtml",v)}),[f,v]);var wt=function(){ne&&-1===H.indexOf(ne)&&X([].concat(ke()(H),[ne])),_(!1),re("")},bt=function(){var e=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:et(t.url||t.thumbUrl),We(!0),at(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kt=(0,J.jsx)(V.ZP,{icon:(0,J.jsx)(te.Z,{}),children:"上传图片"}),jt={name:"file",accept:"image/*",action:(0,Y.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(a.LA8)},listType:"picture-card",fileList:Ye,onPreview:bt,onChange:function(e){var t=ke()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;Je((function(e){return[].concat(ke()(e),[r])})),Z.yw.success("上传 ".concat(e.file.name," 成功"))}else Z.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&Z.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t,n;return e.response&&200===e.response.code?x()(x()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl,thumbUrl:null===(n=e.response)||void 0===n?void 0:n.data.fileUrl}):e})),Be(t)},data:function(e){return{file:e,fileName:pe()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:a.IrL,categoryUid:u.getFieldValue("categoryUid")||"",kbUid:(null==I?void 0:I.uid)||"",channel:a.XtJ}},onRemove:function(e){return e.url&&Je((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},St={name:"file",action:(0,Y.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(a.LA8)},fileList:it,onChange:function(e){var t=ke()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;ft((function(e){return[].concat(ke()(e),[r])})),Z.yw.success("上传 ".concat(e.file.name," 成功"))}else Z.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&Z.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t;return e.response&&200===e.response.code?x()(x()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl}):e})),lt(t)},data:function(e){return{file:e,fileName:pe()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:a.IrL,categoryUid:u.getFieldValue("categoryUid")||"",kbUid:(null==I?void 0:I.uid)||"",channel:a.XtJ}},onRemove:function(e){return e.url&&ft((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},Zt=function(){var e=k()(w()().mark((function e(){var t,n,r,a,s,o,i;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,Y.OJ)()){e.next=3;break}return Z.yw.error("生成相似问法功能仅在企业版和平台版可用"),e.abrupt("return");case 3:if((t=u.getFieldValue("question"))&&""!==t.trim()){e.next=7;break}return Z.yw.error("请先输入问题后再生成相似问法"),e.abrupt("return");case 7:return e.prev=7,yt(!0),Z.yw.loading("正在智能生成相似问法..."),n={question:t,orgUid:null==A?void 0:A.uid},e.next=13,(0,ht.YQ)(n);case 13:r=e.sent,console.log("生成相似问法响应:",n,r),Z.yw.destroy(),200===r.code?(a=null==r?void 0:r.data,console.log("生成的相似问法:",a),s=a.similarQuestions.filter((function(e){return e&&""!==e.trim()})),o=Ce.filter((function(e){return e&&""!==e.trim()})),i=ke()(o),s.forEach((function(e){i.includes(e)||i.push(e)})),Ae(i),u.setFieldValue("similarQuestions",i),Z.yw.success("已成功生成 ".concat(s.length," 条相似问法"))):Z.yw.error(r.message||"生成相似问法失败"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(7),console.error("生成相似问法出错:",e.t0),Z.yw.destroy(),Z.yw.error("生成相似问法失败");case 24:return e.prev=24,yt(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[7,19,24,27]])})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(B.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:s,open:r,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:s,children:"取消"}),(0,J.jsx)(V.ZP,{onClick:function(){var e=Ce.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));u.setFieldValue("similarQuestions",e),u.validateFields().then((function(e){var t,r;if(console.log("handleSubmit values:",e),console.log("handleSubmit edited:",f,v,C),"permanent"===e.dateType)t=pe()().format("YYYY-MM-DDTHH:mm:ss"),r=pe()().add(100,"years").format("YYYY-MM-DDTHH:mm:ss");else{var s=e.dateRange;t=null!=s&&s[0]?s[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=s&&s[1]?s[1].format("YYYY-MM-DDTHH:mm:ss"):void 0}var o=Ce.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e})),l=He.filter((function(e){return e&&""!==e.trim()})),u=dt.filter((function(e){return e&&""!==e.trim()})),c=H.filter((function(e){return e&&""!==e.trim()})),d=x()(x()(x()({},n),e),{},{type:a.PYi,kbUid:null==I?void 0:I.uid,orgUid:null==A?void 0:A.uid,answer:e.answerHtml,answerHtml:e.answerHtml,answerMarkdown:e.answerHtml,similarQuestions:o,answerList:e.answerList||[],tagList:c,relatedFaqUids:e.relatedFaqUids||[],startDate:t,endDate:r,images:l,attachments:u});i(d)})).catch((function(e){console.log("Form errors:",e),Z.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,J.jsxs)(Pe.A,{form:u,submitter:{render:function(){return null}},children:[(0,J.jsx)(vt.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(t){return(t||[]).filter((function(e){return e.key!==a.zBg})).map((function(t){return x()(x()({},t),{},{children:t.children?e(t.children):void 0})}))}(P),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),F(e)},fieldNames:{label:"title",value:"key",children:"children"},treeCheckable:!1}}),(0,J.jsx)(qe.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,J.jsx)(Qt.u,{name:"similarQuestions",label:(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,J.jsx)("span",{children:"相似问法"}),(0,J.jsxs)(ue.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:["                ",(0,J.jsx)(ue.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:(0,J.jsx)(V.ZP,{type:"primary",icon:(0,J.jsx)(xt.Z,{}),onClick:Zt,loading:mt,size:"small",children:"智能生成"})})]})]}),creatorButtonProps:{creatorButtonText:"添加相似问法",icon:(0,J.jsx)(te.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(ke()(Ce),[""]);Ae(e),u.setFieldValue("similarQuestions",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var r=u.getFieldValue("similarQuestions")||[],a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):ke()(Ce);Ae(a)},onAfterRemove:function(e,t){var n=u.getFieldValue("similarQuestions")||[],r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];Ae(r)},actionRender:function(e,t,n){return[(0,J.jsx)(V.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=ke()(Ce);r.splice(n,1),Ae(r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,a=m()(e,rn);return(0,J.jsx)(qe.Z,x()(x()({},a),{},{placeholder:"请输入相似问法",rules:[{required:!0,message:"请输入相似问法"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:Ce[t]||"",onChange:function(e){var n=ke()(Ce);n[t]=e.target.value,Ae(n),u.setFieldValue(["similarQuestions",t],e.target.value)}}}),r)}}),(0,J.jsx)(Pe.A.Item,{name:"answerHtml",label:"文本答案",children:(0,J.jsx)(nn.Z,{defaultValue:v,toolbarKeys:(0,Bt.eD)(),style:{height:"200px",width:"600px"},maxLength:16383,onChange:function(e,t,n){console.log("Editor content changed: html",e),console.log("Editor content changed: markdown",t),console.log("Editor content changed: text",n),p(n),M(e),U(t),De||Re(!0)}})}),(0,J.jsxs)(Pe.A.Item,{label:"图片",tooltip:"可以上传多张图片作为回复内容",children:[(0,J.jsx)($t.Z,x()(x()({},jt),{},{children:kt})),(0,J.jsx)(oe.Z,{open:Ke,title:rt,footer:null,onCancel:function(){return We(!1)},children:(0,J.jsx)(en.Z,{alt:"预览图片",style:{width:"100%"},src:$e})})]}),(0,J.jsx)(Pe.A.Item,{label:"附件",tooltip:"可以上传多个附件作为回复内容",children:(0,J.jsx)($t.Z,x()(x()({},St),{},{children:(0,J.jsx)(V.ZP,{icon:(0,J.jsx)(te.Z,{}),children:"上传附件"})}))}),(0,J.jsxs)(Ue.Z,{orientation:"left",children:["扩展答案列表",(0,J.jsx)(V.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,J.jsx)(Qt.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,J.jsx)(te.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,r=e.action,a=t.index;return(0,J.jsx)(tn.Z,{size:"small",style:{marginBottom:16},extra:r,children:n},a)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,J.jsx)("div",{children:e})},children:(0,J.jsxs)(Kt.UW,{children:[(0,J.jsx)(Wt.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,J.jsx)(Oe.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,J.jsx)(Ee.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:ge,fieldProps:{placeholder:"请选择相关问题"}}),(0,J.jsx)(Pe.A.Item,{label:"标签",children:(0,J.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[H.map((function(e){return(0,J.jsx)(le.Z,{closable:!0,onClose:function(){return t=e,n=H.filter((function(e){return e!==t})),void X(n);var t,n},children:e},e)})),G?(0,J.jsx)(Fe.Z,{ref:ae,type:"text",size:"small",style:{width:78},value:ne,onChange:function(e){re(e.target.value)},onBlur:wt,onPressEnter:wt}):(0,J.jsxs)(le.Z,{onClick:function(){_(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,J.jsx)(te.Z,{})," 新标签"]})]})}),(0,J.jsx)(Gt.Z.Group,{name:"dateType",label:"有效期设置",options:[{label:"永久有效",value:"permanent"},{label:"自定义日期",value:"custom"}],fieldProps:{onChange:function(e){je(e.target.value),"permanent"===e.target.value&&u.setFieldValue("dateRange",void 0)},value:be}}),"custom"===be&&(0,J.jsx)(_t.Z,{name:"dateRange",label:"有效日期",rules:[{required:"custom"===be,message:"请选择有效日期范围"}],fieldProps:{style:{width:"100%"}}}),(0,J.jsx)(Nt.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:ve,onChange:function(e){ye(e)}}})]})})})},sn=["current","pageSize"],on=function(){var e=(0,p.useIntl)(),t=(0,D.Z)().translateString,n=(0,o.useRef)(),r=(0,o.useState)(!0),s=S()(r,2),i=s[0],l=s[1],u=(0,o.useState)(),c=S()(u,2),d=c[0],f=c[1],g=(0,o.useState)(!1),h=S()(g,2),v=h[0],M=h[1],b=(0,o.useState)(1),j=S()(b,2),C=j[0],U=j[1],A=(0,o.useState)(10),I=S()(A,2),T=I[0],P=I[1],E=(0,z.u)((function(e){return e.currentOrg})),q=(0,R.j)((function(e){return e.currentKbase})),O=(0,Q.v)((function(e){return e.currentCategory})),F=(0,Q.v)((function(e){return e.categorySelectOptions})),L=(0,o.useState)(!1),B=S()(L,2),N=B[0],H=B[1],X=(0,o.useState)([]),K=S()(X,2),W=K[0],G=K[1],_=(0,o.useState)([]),$=S()(_,2),ie=$[0],fe=$[1],he=(0,o.useState)(0),xe=S()(he,2),ve=xe[0],ye=xe[1],Me=(0,o.useState)(!1),be=S()(Me,2),ke=be[0],je=be[1],Se=(0,o.useState)(!1),Ze=S()(Se,2),Ce=Ze[0],Ue=Ze[1],Ae=(0,o.useState)({}),Ie=S()(Ae,2),Pe=Ie[0],Ee=Ie[1],qe=function(){var t=k()(w()().mark((function t(r){var a;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,(0,ht.Yg)(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),Z.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):Z.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Oe=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ie.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=y()(ie),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,ht.Yg)(l);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):Z.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),G([]),fe([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Fe=function(){var t=k()(w()().mark((function t(r){var a,s,o,i,l,u;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ie.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),t.abrupt("return");case 3:Z.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):e.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),s=0,o=0,i=y()(ie),t.prev=7,i.s();case 9:if((l=i.n()).done){t.next=23;break}return u=l.value,t.prev=11,t.next=14,(0,ht.kv)({uid:u.uid,enabled:r});case 14:200===t.sent.code?s++:o++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),o++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),i.e(t.t1);case 28:return t.prev=28,i.f(),t.finish(28);case 31:Z.yw.destroy(),0===o?Z.yw.success(r?e.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:s})):Z.yw.warning(r?e.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:s,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:s,fail:o})),G([]),fe([]),null===(a=n.current)||void 0===a||a.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(e){return t.apply(this,arguments)}}(),De=function(){var t=k()(w()().mark((function t(){var r,s,o;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ve){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),t.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),t.prev=4,r={categoryUid:(null==O?void 0:O.uid)===a.zBg?"":null==O?void 0:O.uid,kbUid:null==q?void 0:q.uid,orgUid:null==E?void 0:E.uid},t.next=8,(0,ht.QB)(r);case 8:200===(s=t.sent).code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=n.current)||void 0===o||o.reloadAndRest()):(Z.yw.destroy(),Z.yw.error(s.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),Re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.question.tooltip",defaultMessage:"常见问题的问题内容"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"similarQuestions",width:200,ellipsis:!0,search:!1,tooltip:e.formatMessage({id:"faq.similar.questions.tooltip",defaultMessage:"表达相同意思的其他问法"}),render:function(t,n){if(!n.similarQuestions||0===n.similarQuestions.length||1===n.similarQuestions.length&&""===n.similarQuestions[0])return"-";var r=n.similarQuestions.length>3,a=n.similarQuestions.slice(0,3),s=(0,J.jsx)("div",{style:{maxWidth:300,maxHeight:300,overflow:"auto"},children:n.similarQuestions.map((function(e,t){return(0,J.jsxs)("div",{style:{marginBottom:8},children:[(0,J.jsx)(le.Z,{color:"blue",style:{marginRight:4},children:t+1}),e]},t)}))}),o=(0,J.jsxs)("div",{children:[a.map((function(e,t){return(0,J.jsx)(le.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),r&&(0,J.jsxs)(le.Z,{color:"orange",children:["+",n.similarQuestions.length-3]})]});return(0,J.jsx)(Yt.Z,{content:s,title:e.formatMessage({id:"faq.similar.questions",defaultMessage:"所有相似问法"}),placement:"right",trigger:"hover",children:o})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.answer.tooltip",defaultMessage:"常见问题的回答内容"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.status.tooltip",defaultMessage:"问题处理状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,J.jsx)(le.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.vectorStatus.tooltip",defaultMessage:"向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,J.jsx)(le.Z,{color:a,icon:(0,J.jsx)(ct.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.clickCount.tooltip",defaultMessage:"问题被点击的次数"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.upCount.tooltip",defaultMessage:"问题被点赞的次数"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.downCount.tooltip",defaultMessage:"问题被踩的次数"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.category.tooltip",defaultMessage:"问题所属的分类"}),render:function(e,t){var n=F.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,J.jsx)(le.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:F.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.tags",defaultMessage:"标签"}),dataIndex:"tagList",width:150,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.tags.tooltip",defaultMessage:"用于分类和搜索的标签"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,J.jsxs)("div",{children:[r.map((function(e,t){return(0,J.jsx)(le.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,J.jsxs)(le.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.isValid.tooltip",defaultMessage:"问题是否有效可用"}),valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.startDate.tooltip",defaultMessage:"问题生效的开始时间"}),render:function(e,t){return t.startDate?pe()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.endDate.tooltip",defaultMessage:"问题失效的结束时间"}),render:function(e,t){return t.endDate?pe()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.createdAt.tooltip",defaultMessage:"问题创建的时间"}),render:function(e,t){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,J.jsx)(p.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.updatedAt.tooltip",defaultMessage:"问题最后更新的时间"}),render:function(e,t){return t.updatedAt?pe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){!function(e){console.log("showEditDrawer",e),f(e),l(!0),M(!0)}(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,J.jsx)(ce.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return qe(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,J.jsx)(V.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete"),(0,J.jsx)(de.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return ze(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Le(n)}}]},placement:"bottomRight",children:(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,J.jsxs)(V.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,J.jsx)(ae.Z,{})]})})},"indexOperations")]}}],ze=function(){var t=k()(w()().mark((function t(r){var a,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),t.prev=1,t.next=4,(0,ht.RF)({uid:r.uid});case 4:a=t.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Le=function(){var t=k()(w()().mark((function t(r){var a,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),t.prev=1,t.next=4,(0,ht.YO)({uid:r.uid});case 4:a=t.sent,Z.yw.destroy(),200===a.code?(Z.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Ye=function(){ke?Ce?Z.yw.info("正在检查模型状态，请稍后再试"):(f(void 0),l(!1),M(!0)):oe.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){f(void 0),l(!1),M(!0)}})},Be=function(){var t=k()(w()().mark((function t(r){var a,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),i?Z.yw.loading(e.formatMessage({id:"updating"})):Z.yw.loading(e.formatMessage({id:"creating"})),!i){t.next=8;break}return t.next=5,(0,ht.y)(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,ht.kh)(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createFaq response:",r,a),200===a.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),M(!1),null===(s=n.current)||void 0===s||s.reloadAndRest()):(Z.yw.destroy(),Z.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ne=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ke){t.next=3;break}return oe.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){H(!0)}}),t.abrupt("return");case 3:if(!Ce){t.next=6;break}return Z.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:H(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[q,O]);var Ve=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,me.HK)(a.QPQ,null==E?void 0:E.uid,null==q?void 0:q.uid,a.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),He=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ie.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=y()(ie),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,ht.RF)({uid:l.uid});case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):Z.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 34:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Je=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ie.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=y()(ie),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,ht.YO)({uid:l.uid});case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):Z.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 34:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Xe=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=k()(w()().mark((function t(){var r,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),t.prev=1,t.next=4,(0,ht.L0)({kbUid:null==q?void 0:q.uid,categoryUid:(null==O?void 0:O.uid)===a.zBg?"":null==O?void 0:O.uid,orgUid:null==E?void 0:E.uid});case 4:r=t.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Qe=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=k()(w()().mark((function t(){var r,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),t.prev=1,t.next=4,(0,ht.Bv)({kbUid:null==q?void 0:q.uid,categoryUid:(null==O?void 0:O.uid)===a.zBg?"":null==O?void 0:O.uid,orgUid:null==E?void 0:E.uid});case 4:r=t.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ke=function(){var e=k()(w()().mark((function e(t,n,r){var s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),s=localStorage.getItem(a.LA8),o=x()({categoryUid:(null==O?void 0:O.uid)===a.zBg?"":null==O?void 0:O.uid,kbUid:null==q?void 0:q.uid,orgUid:(null==E?void 0:E.uid)||"",accessToken:s||"",exportType:t},Pe),"current"===t?(o.pageNumber=String(C-1),o.pageSize=String(T)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=String(n),o.pageSize=String(r)),window.open((0,Y.kG)()+"/api/v1/faq/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),We={selectedRowKeys:W,onChange:function(e,t){G(e),fe(t)}},Ge=function(){var t=k()(w()().mark((function t(n,r,s){var o,i,l,u,c,d,f,p;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,l=m()(n,sn),U(o),P(i),Ee(l),u=void 0,c=void 0,r&&Object.keys(r).length>0&&(d=Object.keys(r)[0],u=d,c="ascend"===r[d]?"ascend":"descend"),f=x()(x()({pageNumber:o-1,pageSize:i,categoryUid:(null==O?void 0:O.uid)===a.zBg?"":null==O?void 0:O.uid,kbUid:null==q?void 0:q.uid,orgUid:null==E?void 0:E.uid},l),{},{sortBy:u,sortDirection:c}),t.next=11,(0,ht.pf)(f);case 11:return p=t.sent,console.log("queryFaqsByOrg response:",f,p),Z.yw.destroy(),200===p.code?ye(null==p?void 0:p.data.totalElements):Z.yw.error(p.message),t.abrupt("return",{data:null==p?void 0:p.data.content,success:!0,total:null==p?void 0:p.data.totalElements});case 16:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),_e=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Ke("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(we,{onModelStatusChange:function(e){je(e),Ue(!1)}}),(0,J.jsx)(se.Z,{columns:Re,actionRef:n,cardBordered:!0,rowSelection:We,request:Ge,scroll:{x:2300},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){U(e),P(t)}},dateFormatter:"string",headerTitle:t(null==q?void 0:q.name)+" - 常见问题",tooltip:Ce?"正在检查嵌入式模型...":ke?"所添加FAQ内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[];(0,Y.Ox)()||t.push((0,J.jsx)(V.ZP,{icon:(0,J.jsx)(te.Z,{}),type:"primary",onClick:Ye,disabled:Ce,children:e.formatMessage({id:"create"})},"create"),(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,J.jsx)(Te,{currentKbase:q,currentOrg:E,embeddingModelExists:ke,checkingEmbeddingModel:Ce})},"chat"));var n=[];W.length>0&&n.push({key:"batchDelete",icon:(0,J.jsx)(ee.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){oe.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Oe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,J.jsx)(ft.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(W.length,")"),onClick:function(){return Fe(!0)}},{key:"batchDisable",icon:(0,J.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(W.length,")"),onClick:function(){return Fe(!1)}},{key:"batchUpdateIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(W.length,")"),onClick:He},{key:"batchUpdateVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(W.length,")"),onClick:Je}),n.push({key:"deleteAll",icon:(0,J.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){oe.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:De,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Xe},{key:"updateAllVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Qe});var r=[{key:"import",icon:(0,J.jsx)(gt.Z,{}),label:e.formatMessage({id:"import"}),onClick:Ne,disabled:Ce},{key:"export-current",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ke("current")}}];return ve>0&&(ve<=1e3?r.push({key:"export-all",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ve,"条)"),onClick:function(){return Ke("all")}}):r.push({key:"export-range",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ve,"条)"),children:_e(ve)})),r.push({key:"download",icon:(0,J.jsx)(mt.Z,{}),label:e.formatMessage({id:"download.template"}),onClick:function(){return(0,Y.IY)()}}),t.push((0,J.jsx)(de.Z,{menu:{items:r},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,J.jsx)(ae.Z,{})]})},"importExport")),n.length>0&&t.push((0,J.jsx)(de.Z,{menu:{items:n},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,J.jsx)(ae.Z,{})]})},"batchOperations")),t}()}}),(0,J.jsx)(an,{isEdit:i,open:v,faq:d,onClose:function(){return M(!1)},onSubmit:Be}),N&&(0,J.jsx)(ge.Z,{type:a.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:N,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),H(!1),null==n||n.current.reload(),Ve()},handleCancel:function(){console.log("handleUploadDragCancel"),H(!1),null==n||n.current.reload()}})]})};function ln(e){return un.apply(this,arguments)}function un(){return(un=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/query/org",{method:"GET",params:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e){return dn.apply(this,arguments)}function dn(){return(dn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/create",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fn(e){return pn.apply(this,arguments)}function pn(){return(pn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/update",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gn(e){return mn.apply(this,arguments)}function mn(){return(mn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/delete",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hn(e){return xn.apply(this,arguments)}function xn(){return(xn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/crawl",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vn(e){return yn.apply(this,arguments)}function yn(){return(yn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/updateIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mn(e){return wn.apply(this,arguments)}function wn(){return(wn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/updateVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bn(e){return kn.apply(this,arguments)}function kn(){return(kn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/updateAllIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jn(e){return Sn.apply(this,arguments)}function Sn(){return(Sn=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.request)("/api/v1/llm/webpage/updateAllVectorIndex",{method:"POST",data:x()(x()({},t),{},{channel:a.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zn=function(e){var t=e.isEdit,n=e.webpage,r=e.open,s=e.onClose,i=e.onSubmit,l=Pe.A.useForm(),u=S()(l,1)[0],c=(0,R.j)((function(e){return e.currentKbase})),d=(0,z.u)((function(e){return e.currentOrg})),f=(0,Q.v)((function(e){return e.categorySelectOptions})),p=(0,Q.v)((function(e){return e.categoryTreeOptions})),g=(0,o.useState)(),m=S()(g,2),h=m[0],v=m[1],M=(0,o.useState)([]),b=S()(M,2),j=b[0],Z=b[1],C=(0,o.useState)(!1),U=S()(C,2),A=U[0],I=U[1],T=(0,o.useState)(""),P=S()(T,2),E=P[0],q=P[1],O=(0,o.useState)(!1),F=S()(O,2),D=F[0],L=F[1],Y=(0,o.useState)(""),H=S()(Y,2),X=(H[0],H[1]),K=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},W=function(){var e=k()(w()().mark((function e(){var t,n,r;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,L(!0),e.next=4,u.validateFields();case 4:t=e.sent,!(n=t.url)||n.startsWith("http://")||n.startsWith("https://")||(n="https://".concat(n)),r=x()(x()({},t),{},{url:n,categoryUid:h,tagList:K(j),kbUid:null==c?void 0:c.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",r),i(r),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),xe.ZP.error("请检查表单填写是否正确");case 16:return e.prev=16,L(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=u.getFieldValue("url");if(e){var t=e;e.startsWith("http://")||e.startsWith("https://")||(t="https://".concat(e)),X(t),window.open(t,"_blank")}else xe.ZP.warning("请输入网址")},_=function(){var e=E.trim();e&&!j.includes(e)&&Z([].concat(ke()(j),[e])),I(!1),q("")},$=function(){I(!1),q("")};return(0,o.useEffect)((function(){if(t)u.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,url:null==n?void 0:n.url,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid}),v(null==n?void 0:n.categoryUid),Z(K((null==n?void 0:n.tagList)||[]));else{u.setFieldsValue({title:"",url:"",content:"",description:""});var e=function e(t){var n,r=y()(t||[]);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.key!==a.zBg)return s.key;var o=e(s.children||[]);if(o)return o}}catch(e){r.e(e)}finally{r.f()}return""}(p||[]);if(e)u.setFieldValue("categoryUid",e),v(e);else if(f&&f.length>0){var r=f[0].value;u.setFieldValue("categoryUid",r),v(r)}Z([]),I(!1),q("")}}),[t,n,u,f,p]),(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(B.Z,{title:t?"编辑网页":"添加网页",onClose:s,open:r,width:600,extra:(0,J.jsxs)(N.Z,{children:[(0,J.jsx)(V.ZP,{onClick:s,children:"取消"}),(0,J.jsx)(V.ZP,{type:"primary",onClick:W,loading:D,children:"提交"})]}),footer:null,children:(0,J.jsxs)(Pe.A,{form:u,name:"webpageForm",submitter:!1,children:[(0,J.jsx)(vt.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==a.zBg})).map((function(t){return x()(x()({},t),{},{children:e(t.children)})}))}(p||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("webpage category selected ".concat(e)),v(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,J.jsx)(qe.Z,{label:"名称",name:"title",rules:[{required:!0,message:"请输入网页名称"}],placeholder:"请输入网页名称"}),(0,J.jsx)(qe.Z,{label:"URL",name:"url",rules:[{required:!0,message:"请输入网页地址"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,message:"请输入有效的网址"}],placeholder:"请输入网址，例如：www.example.com",renderFormItem:function(e,t){var n;return(0,J.jsxs)(N.Z.Compact,{block:!0,children:[null===(n=t.defaultRender)||void 0===n?void 0:n.call(t,e),(0,J.jsx)(V.ZP,{type:"link",onClick:G,children:"预览"})]})},tooltip:"支持 http 或 https 开头的网址"}),t&&(0,J.jsx)(Oe.Z,{label:"内容",name:"content",placeholder:"网页内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"网页的文本内容，用于知识库检索"}),(0,J.jsx)(Pe.A.Item,{label:"标签",name:"tagList",tooltip:"为网页添加标签，便于分类和检索",children:(0,J.jsxs)("div",{style:{minHeight:"32px"},children:[(0,J.jsx)(N.Z,{wrap:!0,style:{marginBottom:8},children:K(j).map((function(e,t){return(0,J.jsx)(le.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void Z(K(j.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),A?(0,J.jsxs)(N.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)(Fe.Z,{value:E,onChange:function(e){q(e.target.value)},onKeyDown:function(e){"Enter"===e.key?_():"Escape"===e.key&&$()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,J.jsx)(V.ZP,{type:"primary",size:"small",icon:(0,J.jsx)(De.Z,{}),onClick:_,disabled:!E.trim(),children:"保存"}),(0,J.jsx)(V.ZP,{size:"small",icon:(0,J.jsx)(Re.Z,{}),onClick:$,children:"取消"})]}):(0,J.jsx)(V.ZP,{type:"dashed",onClick:function(){I(!0),q("")},icon:(0,J.jsx)(te.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,J.jsx)(Oe.Z,{label:"描述",name:"description",placeholder:"请输入网页描述",fieldProps:{maxLength:500,showCount:!0}})]})})})},Cn=["current","pageSize"],Un=function(){var e=(0,p.useIntl)(),t=(0,D.Z)().translateString,n=(0,o.useRef)(),r=(0,o.useState)(1),s=S()(r,2),i=s[0],l=s[1],u=(0,o.useState)(10),c=S()(u,2),d=c[0],f=c[1],g=(0,z.u)((function(e){return e.currentOrg})),h=(0,R.j)((function(e){return e.currentKbase})),v=(0,Q.v)((function(e){return e.currentCategory})),M=(0,Q.v)((function(e){return e.categorySelectOptions})),b=(0,o.useState)(!1),j=S()(b,2),C=j[0],U=j[1],A=(0,o.useState)({}),I=S()(A,2),T=I[0],P=I[1],E=(0,o.useState)(!1),q=S()(E,2),O=q[0],F=q[1],L=oe.Z.useModal(),B=S()(L,2),N=(B[0],B[1]),H=(0,o.useState)(!1),X=S()(H,2),K=X[0],W=X[1],G=(0,o.useState)(!1),_=S()(G,2),$=_[0],ne=_[1],fe=(0,o.useState)({}),ge=S()(fe,2),me=ge[0],he=ge[1],xe=(0,o.useState)(0),ve=S()(xe,2),ye=ve[0],be=ve[1],ke=(0,o.useState)([]),je=S()(ke,2),Se=je[0],Ze=je[1],Ce=(0,o.useState)([]),Ue=S()(Ce,2),Ae=Ue[0],Ie=Ue[1],Pe=function(){var t=k()(w()().mark((function t(r){var a,s,o;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.content&&""!==r.content.trim()){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),t.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),t.prev=4,a={uid:r.uid},t.next=8,vn(a);case 8:s=t.sent,console.log("更新索引响应:",s,a),Z.yw.destroy(),200===s.code?(Z.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(o=n.current)||void 0===o||o.reload()):Z.yw.error(s.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",t.t0);case 19:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),Ee=function(){var t=k()(w()().mark((function t(r){var a,s,o;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.content&&""!==r.content.trim()){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),t.abrupt("return");case 3:return Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),t.prev=4,a={uid:r.uid},t.next=8,Mn(a);case 8:s=t.sent,console.log("更新向量索引响应:",s,a),Z.yw.destroy(),200===s.code?(Z.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(o=n.current)||void 0===o||o.reload()):Z.yw.error(s.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(4),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",t.t0);case 19:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),qe=function(){var t=k()(w()().mark((function t(r){var a,s,o;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"crawling.content",defaultMessage:"正在抓取网页内容..."})),t.prev=1,a={uid:r.uid},t.next=5,hn(a);case 5:s=t.sent,console.log("抓取网页内容响应:",s,a),Z.yw.destroy(),200===s.code?(Z.yw.success(e.formatMessage({id:"crawl.content.success",defaultMessage:"网页内容抓取已触发"})),null===(o=n.current)||void 0===o||o.reload()):Z.yw.error(s.message||e.formatMessage({id:"crawl.content.failed",defaultMessage:"网页内容抓取失败"})),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"crawl.content.error",defaultMessage:"抓取网页内容过程发生错误"})),console.error("抓取网页内容错误:",t.t0);case 16:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}(),Oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,J.jsx)(p.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"title",copyable:!0,tooltip:e.formatMessage({id:"webpage.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.title}),(0,J.jsx)(ie.Z.Text,{copyable:{text:(null==t?void 0:t.title)||""}})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:e.formatMessage({id:"webpage.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,J.jsx)(ie.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"webpage.category.tooltip",defaultMessage:"网页内容所属的分类"}),render:function(e,t){var n=M.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,J.jsx)(le.Z,{color:"blue",children:n.label}):(0,J.jsx)(le.Z,{color:"default",children:"未分类"})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"webpage.status.tooltip",defaultMessage:"网页索引状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="processing"),(0,J.jsx)(le.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase()),defaultMessage:r})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"webpage.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="warning"),r?(0,J.jsx)(le.Z,{color:a,icon:(0,J.jsx)(ct.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase()),defaultMessage:r})}):"-"}},{title:(0,J.jsx)(p.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:e.formatMessage({id:"webpage.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,J.jsx)(p.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"webpage.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,J.jsxs)("div",{children:[r.map((function(e,t){return(0,J.jsx)(le.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,J.jsxs)(le.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,copyable:!0,width:300,tooltip:e.formatMessage({id:"webpage.content.tooltip",defaultMessage:"爬取的网页内容摘要"}),render:function(t,n){var r=n.content||"-",a=function(){var t=k()(w()().mark((function t(n){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,Bt.TE)(n);case 2:t.sent.success?Z.yw.success(e.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):Z.yw.error(e.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,J.jsx)(Yt.Z,{content:(0,J.jsxs)("div",{children:[(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,J.jsx)("span",{children:e.formatMessage({id:"webpage.content.preview",defaultMessage:"网页内容预览"})}),(0,J.jsx)(V.ZP,{type:"text",icon:(0,J.jsx)(Ht.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:e.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,J.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:e.formatMessage({id:"webpage.content",defaultMessage:"网页内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,J.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,J.jsx)(p.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:e.formatMessage({id:"webpage.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,J.jsx)(p.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:e.formatMessage({id:"webpage.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?pe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Fe=[].concat(Oe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){P(n),F(!0),U(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,J.jsx)(ce.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.title,"】？"),onConfirm:function(){return De(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,J.jsx)(dt.Z,{style:{color:"red"}}),children:(0,J.jsx)(V.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete"),(0,J.jsx)(de.Z,{menu:{items:[{key:"crawlContent",icon:(0,J.jsx)(mt.Z,{}),label:e.formatMessage({id:"crawl.content",defaultMessage:"抓取内容"}),onClick:function(){return qe(n)}},{key:"updateIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Pe(n)}},{key:"updateVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Ee(n)}}]},placement:"bottomRight",children:(0,J.jsx)(ue.Z,{title:e.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),children:(0,J.jsxs)(V.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),(0,J.jsx)(ae.Z,{})]})})},"indexOperations")]}}]);(0,o.useEffect)((function(){var e;null==n||null===(e=n.current)||void 0===e||e.reload()}),[h,v]);var De=function(){var t=k()(w()().mark((function t(r){var a;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,gn(r);case 2:200===(a=t.sent).code?(Z.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),n.current.reload()):Z.yw.error(a.message);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Re=function(){var e=k()(w()().mark((function e(t){var r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cn(t);case 2:200===(r=e.sent).code?(null===(a=n.current)||void 0===a||a.reload(),U(!1)):Z.yw.error(r.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=k()(w()().mark((function e(t){var r,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==T?void 0:T.uid,e.next=3,fn(t);case 3:200===(r=e.sent).code?(null===(a=n.current)||void 0===a||a.reload(),U(!1)):Z.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){K?$?Z.yw.info("正在检查模型状态，请稍后再试"):(U(!0),F(!1),P({})):oe.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},Ye=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ae.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),t.abrupt("return");case 3:Z.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=y()(Ae),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,gn(l);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:Z.yw.destroy(),0===s?Z.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:a})):Z.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:a,fail:s})),Ze([]),Ie([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Be=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l,u;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ae.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:if(a=Ae.filter((function(e){return!e.content||""===e.content.trim()})),!(a.length>0)){t.next=7;break}return Z.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(a.length,"条记录)")),t.abrupt("return");case 7:Z.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),s=0,o=0,i=y()(Ae),t.prev=11,i.s();case 13:if((l=i.n()).done){t.next=27;break}return u=l.value,t.prev=15,t.next=18,vn({uid:u.uid});case 18:200===t.sent.code?s++:o++,t.next=25;break;case 22:t.prev=22,t.t0=t.catch(15),o++;case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(11),i.e(t.t1);case 32:return t.prev=32,i.f(),t.finish(32);case 35:Z.yw.destroy(),0===o?Z.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(s," 条记录的索引")})):Z.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(s," 条记录的索引，").concat(o," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 38:case"end":return t.stop()}}),t,null,[[11,29,32,35],[15,22]])})));return function(){return t.apply(this,arguments)}}(),Ne=function(){var t=k()(w()().mark((function t(){var r,a,s,o,i,l,u;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ae.length){t.next=3;break}return Z.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:if(a=Ae.filter((function(e){return!e.content||""===e.content.trim()})),!(a.length>0)){t.next=7;break}return Z.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(a.length,"条记录)")),t.abrupt("return");case 7:Z.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),s=0,o=0,i=y()(Ae),t.prev=11,i.s();case 13:if((l=i.n()).done){t.next=27;break}return u=l.value,t.prev=15,t.next=18,Mn({uid:u.uid});case 18:200===t.sent.code?s++:o++,t.next=25;break;case 22:t.prev=22,t.t0=t.catch(15),o++;case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(11),i.e(t.t1);case 32:return t.prev=32,i.f(),t.finish(32);case 35:Z.yw.destroy(),0===o?Z.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(s," 条记录的向量索引")})):Z.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(s," 条记录的向量索引，").concat(o," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 38:case"end":return t.stop()}}),t,null,[[11,29,32,35],[15,22]])})));return function(){return t.apply(this,arguments)}}(),Ve=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=k()(w()().mark((function t(){var r,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),t.prev=1,t.next=4,bn({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=t.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),He=function(){var t=k()(w()().mark((function t(){return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:oe.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=k()(w()().mark((function t(){var r,s;return w()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),t.prev=1,t.next=4,jn({kbUid:null==h?void 0:h.uid,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,orgUid:null==g?void 0:g.uid});case 4:r=t.sent,Z.yw.destroy(),200===r.code?(Z.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(s=n.current)||void 0===s||s.reload()):Z.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),Z.yw.destroy(),Z.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Je=function(){var e=k()(w()().mark((function e(t,n,r){var s,o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=localStorage.getItem(a.LA8),o=x()({categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:(null==g?void 0:g.uid)||"",accessToken:s||"",exportType:t},me),"current"===t?(o.pageNumber=i-1,o.pageSize=d):"all"===t?(o.pageNumber=0,o.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=n,o.pageSize=r),window.open((0,Y.kG)()+"/api/v1/webpage/export?"+new URLSearchParams(Object.entries(o).reduce((function(e,t){var n=S()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Xe=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Je("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(we,{onModelStatusChange:function(e){W(e),ne(!1)}}),(0,J.jsx)(se.Z,{columns:Fe,actionRef:n,cardBordered:!0,scroll:{x:2200},rowSelection:{selectedRowKeys:Se,onChange:function(e,t){Ze(e),Ie(t)}},request:function(){var e=k()(w()().mark((function e(t,n,r){var s,o,i,u,c,d,p,y;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,o=t.pageSize,i=m()(t,Cn),l(s),f(o),he(i),u=void 0,c=void 0,n&&Object.keys(n).length>0&&(d=Object.keys(n)[0],u=d,c="ascend"===n[d]?"ascend":"descend"),p=x()(x()({pageNumber:s-1,pageSize:o,categoryUid:(null==v?void 0:v.uid)===a.zBg?"":null==v?void 0:v.uid,kbUid:null==h?void 0:h.uid,orgUid:null==g?void 0:g.uid},i),{},{sortBy:u,sortDirection:c}),e.next=10,ln(p);case 10:return y=e.sent,console.log("queryWebpagesByOrg: ",y,p),200===y.code?be(null==y?void 0:y.data.totalElements):Z.yw.error(y.message),e.abrupt("return",{data:null==y?void 0:y.data.content,success:!0,total:null==y?void 0:y.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),f(t)}},dateFormatter:"string",headerTitle:t(null==h?void 0:h.name)+" - 网页爬虫",tooltip:$?"正在检查嵌入式模型...":K?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){var t=[(0,J.jsx)(V.ZP,{type:"primary",icon:(0,J.jsx)(te.Z,{}),onClick:function(){return Me(Le,K,$)},disabled:$||!K,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,J.jsx)(Te,{currentKbase:h,currentOrg:g,embeddingModelExists:K,checkingEmbeddingModel:$||!K},"chat")],n=[];Se.length>0&&n.push({key:"batchDelete",icon:(0,J.jsx)(ee.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Se.length,")"),onClick:function(){}},{key:"batchUpdateIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Se.length,")"),onClick:Be},{key:"batchUpdateVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Se.length,")"),onClick:Ne}),n.push({key:"updateAllIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Ve},{key:"updateAllVectorIndex",icon:(0,J.jsx)(ct.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:He});var r=[{key:"export-current",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Je("current")}}];return ye>0&&(ye<=1e3?r.push({key:"export-all",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ye,"条)"),onClick:function(){return Je("all")}}):r.push({key:"export-range",icon:(0,J.jsx)(re.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ye,"条)"),children:Xe(ye)})),t.push((0,J.jsx)(de.Z,{menu:{items:r},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:"primary",icon:(0,J.jsx)(re.Z,{}),children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,J.jsx)(ae.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,J.jsx)(ce.Z,{title:e.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(Se.length," ").concat(e.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:Ye,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,J.jsx)(dt.Z,{style:{color:"red"}}),disabled:0===Se.length,children:(0,J.jsx)(de.Z,{menu:{items:n},placement:"bottom",children:(0,J.jsxs)(V.ZP,{type:Se.length>0?"primary":"default",danger:Se.length>0,children:[Se.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Se.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,J.jsx)(ae.Z,{})]})},"batchOperations")},"batchDeleteConfirm")),t}}),C&&(0,J.jsx)(Zn,{isEdit:O,open:C,webpage:T,onClose:function(){U(!1)},onSubmit:function(e){O?ze(e):Re(e)}}),N]})};var An=n(88449),In=function(){var e=(0,p.useIntl)(),t=(0,An.Z)().contentStyle,n=(0,o.useMemo)((function(){var t=[{key:"faq",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(l.Z,{})," ",e.formatMessage({id:"pages.robot.kb.faq",defaultMessage:"Q&A"})]}),children:(0,J.jsx)(on,{})}];return(0,Y.OJ)()&&t.push({key:"text",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(u.Z,{})," ",e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"})]}),children:(0,J.jsx)(bt,{})},{key:"file",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(c.Z,{})," ",e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"})]}),children:(0,J.jsx)(Ye,{})},{key:"split",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(d.Z,{})," ",e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"})]}),children:(0,J.jsx)(Xt,{})},{key:"webpage",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(f.Z,{})," ",e.formatMessage({id:"pages.robot.kb.webpage",defaultMessage:"Webpage Crawling"})]}),children:(0,J.jsx)(Un,{})}),t}),[e]);return(0,J.jsx)("div",{style:t,children:(0,J.jsx)(i.Z,{items:n})})},Tn=function(){return(0,J.jsx)("div",{children:(0,J.jsxs)(r.Z,{children:[(0,J.jsx)(r.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",children:(0,J.jsx)(s.Z,{type:a.QPQ})}),(0,J.jsx)(r.Z.Panel,{children:(0,J.jsx)(In,{})})]})})}}}]);