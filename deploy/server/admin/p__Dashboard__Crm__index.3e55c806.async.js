"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5230],{76946:function(e,t,s){s.r(t),s.d(t,{default:function(){return ne}});var a=s(76711),r=s.n(a),n=s(45332),i=s.n(n),o=s(44194),d=s(44528),c=(s(11575),s(10577),s(17137),s(23688),s(62395)),u=s(73193),l=s.n(u),m=s(90819),f=s.n(m),g=s(89933),p=s.n(g),x=s(54596),M=s(89654),h=(s(33633),s(77902),s(72264)),j=s(6992),v=(s(2915),s(89007)),y=s(47268),b=(s(50447),s(26608)),k=(s(59853),s(61489)),w=s(31549),Z=(s(82465),s(55214),s(12380)),F=s(70527),S=s(84176),C=s.n(S),I=s(66248),A=s(68992);function B(e){return U.apply(this,arguments)}function U(){return(U=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/query/org",{method:"GET",params:l()(l()({},t),{},{channel:A.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return P.apply(this,arguments)}function P(){return(P=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/create",{method:"POST",data:l()(l()({},t),{},{channel:A.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return E.apply(this,arguments)}function E(){return(E=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/update",{method:"POST",data:l()(l()({},t),{},{channel:A.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return z.apply(this,arguments)}function z(){return(z=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/delete",{method:"POST",data:l()(l()({},t),{},{channel:A.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J=s(77686),N=s(87005),R=s(83381),D=s(43837),X=s(41881),Y=s(91768),K=s(28031),G=s(80503),H=s(62954),L=s(6237),Q=s(45634),V=s.n(Q),W=s(69650),$=s(41059),_=function(e){var t=e.isEdit,s=e.customer,a=e.open,r=e.onClose,n=e.onSubmit,d=(0,c.useIntl)(),u=v.A.useForm(),m=i()(u,1)[0],f=W.Z.Text;(0,o.useEffect)((function(){a&&(t&&s?m.setFieldsValue({nickname:s.nickname||"",email:s.email||"",mobile:s.mobile||"",description:s.description||"",notes:s.notes||"",extra:s.extra||"",channel:s.channel||""}):m.resetFields())}),[a,t,s,m]);var g=t?d.formatMessage({id:"customer.edit",defaultMessage:"编辑客户"}):d.formatMessage({id:"customer.create",defaultMessage:"新增客户"}),p=s&&!t,x=p?null:(0,w.jsxs)(M.Z,{children:[(0,w.jsx)(h.ZP,{onClick:r,children:(0,w.jsx)(c.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,w.jsx)(h.ZP,{type:"primary",onClick:function(){m.validateFields().then((function(e){var a=l()(l()({},e),t&&s?{uid:s.uid}:{});n(a)}))},children:(0,w.jsx)(c.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)($.Z,{title:g,onClose:r,open:a,width:500,extra:x,children:p&&s?(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",s.nickname||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),":"]})," ",s.email||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"手机"}),":"]})," ",s.mobile||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"描述"}),":"]})," ",s.description||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"notes",defaultMessage:"备注"}),":"]})," ",s.notes||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"extra",defaultMessage:"额外信息"}),":"]})," ",s.extra||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",s.createdAt||"-"]}),(0,w.jsxs)("div",{style:{marginBottom:16},children:[(0,w.jsxs)(f,{strong:!0,children:[(0,w.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",s.updatedAt||"-"]})]}):(0,w.jsxs)(v.A,{form:m,name:"customerForm",submitter:!1,children:[(0,w.jsx)(y.Z,{name:"nickname",label:(0,w.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:"请输入客户昵称"}]}),(0,w.jsx)(y.Z,{name:"email",label:(0,w.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}]}),(0,w.jsx)(y.Z,{name:"mobile",label:(0,w.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"手机"})}),(0,w.jsx)(b.Z,{name:"description",label:(0,w.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"描述"})}),(0,w.jsx)(b.Z,{name:"notes",label:(0,w.jsx)(c.FormattedMessage,{id:"notes",defaultMessage:"备注"})}),(0,w.jsx)(b.Z,{name:"extra",label:(0,w.jsx)(c.FormattedMessage,{id:"extra",defaultMessage:"额外信息"})})]})})})},ee=["current","pageSize"],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,w.jsx)(c.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,w.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,w.jsx)(c.FormattedMessage,{id:"customer.nickname.tooltip"})},{title:(0,w.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",hideInSearch:!0,tooltip:(0,w.jsx)(c.FormattedMessage,{id:"customer.email.tooltip"})},{title:(0,w.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",copyable:!0,tooltip:(0,w.jsx)(c.FormattedMessage,{id:"customer.mobile.tooltip"})},{title:(0,w.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,tooltip:(0,w.jsx)(c.FormattedMessage,{id:"customer.description.tooltip"})},{title:(0,w.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,w.jsx)(c.FormattedMessage,{id:"customer.createdAt.tooltip"}),render:function(e,t,s,a){return V()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],se=function(e){e.superUser;var t=(0,c.useIntl)(),s=(0,o.useRef)(),a=(0,o.useState)(1),r=i()(a,2),n=r[0],d=r[1],u=(0,o.useState)(10),m=i()(u,2),g=m[0],v=m[1],y=(0,J.u)((function(e){return e.currentOrg})),b=(0,o.useState)({}),Z=i()(b,2),F=Z[0],S=Z[1],U=(0,o.useState)(0),P=i()(U,2),E=P[0],z=P[1],Q=(0,o.useState)([]),V=i()(Q,2),W=V[0],$=V[1],se=(0,o.useState)([]),ae=i()(se,2),re=(ae[0],ae[1]),ne=(0,o.useState)(!1),ie=i()(ne,2),oe=ie[0],de=ie[1],ce=(0,o.useState)(!1),ue=i()(ce,2),le=ue[0],me=ue[1],fe=(0,o.useState)(),ge=i()(fe,2),pe=ge[0],xe=ge[1],Me=function(){var e=p()(f()().mark((function e(a){var r,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!le||!pe){e.next=7;break}return e.next=4,T(l()(l()({},a),{},{uid:pe.uid,orgUid:null==y?void 0:y.uid}));case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,O(l()(l()({},a),{},{orgUid:null==y?void 0:y.uid}));case 9:r=e.sent;case 10:200===r.code?(k.yw.success(le?t.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):t.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),de(!1),null===(n=s.current)||void 0===n||n.reload()):k.yw.error(r.message||t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),k.yw.error(t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),he=function(){xe(void 0),me(!1),de(!0)},je=[].concat(te,[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,a){return(0,w.jsxs)(M.Z,{children:[(0,w.jsx)(H.Z,{title:t.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,w.jsx)(h.ZP,{type:"text",icon:(0,w.jsx)(D.Z,{}),onClick:function(){return function(e){xe(e),me(!1),de(!0)}(a)}})}),(0,w.jsx)(H.Z,{title:t.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,w.jsx)(h.ZP,{type:"text",icon:(0,w.jsx)(X.Z,{}),onClick:function(){return function(e){xe(e),me(!0),de(!0)}(a)}})}),(0,w.jsx)(H.Z,{title:t.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,w.jsx)(h.ZP,{type:"text",danger:!0,icon:(0,w.jsx)(Y.Z,{}),onClick:function(){return function(e){var a;I.Z.confirm({title:t.formatMessage({id:"customer.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,w.jsx)(R.Z,{}),content:t.formatMessage({id:"customer.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(a=p()(f()().mark((function a(){var r,n;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,q({uid:e.uid,orgUid:null==y?void 0:y.uid});case 3:200===(r=a.sent).code?(k.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=s.current)||void 0===n||n.reload()):k.yw.error(r.message||t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("删除客户出错:",a.t0),k.yw.error(t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))),function(){return a.apply(this,arguments)})})}(a)}})})]})}}]),ve=function(){var e=p()(f()().mark((function e(t,s,a){var r,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,s,a),r=localStorage.getItem(A.LA8),i=l()({orgUid:(null==y?void 0:y.uid)||"",accessToken:r||"",exportType:t},F),"current"===t?(i.pageNumber=String(n-1),i.pageSize=String(g)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==s&&void 0!==a&&(i.pageNumber=String(s),i.pageSize=String(a)),window.open((0,N.kG)()+"/api/v1/customer/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],s=1e3,a=Math.ceil(e/s),r=function(){var a=n,r=n*s+1,i=Math.min((n+1)*s,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(i," (").concat(i-r+1,"条)"),onClick:function(){return ve("range",a,s)}})},n=0;n<a;n++)r();return t},be={selectedRowKeys:W,onChange:function(e,t){$(e),re(t)}};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.Z,{columns:je,actionRef:s,cardBordered:!0,rowSelection:be,scroll:{x:1300},request:function(){var e=p()(f()().mark((function e(t,s,a){var r,n,i,o,c,u,m,g;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,i=C()(t,ee),d(r),v(n),S(i),o=void 0,c=void 0,s&&Object.keys(s).length>0&&(u=Object.keys(s)[0],o=u,c="ascend"===s[u]?"ascend":"descend"),m=l()(l()({pageNumber:r-1,pageSize:n,orgUid:null==y?void 0:y.uid},i),{},{sortBy:o,sortDirection:c}),e.next=10,B(m);case 10:return g=e.sent,console.log("queryCustomersByOrg response:",g,m),200===g.code?z(g.data.totalElements):k.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){d(e),v(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"客户列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,w.jsx)(K.Z,{}),label:t.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}],E>0&&(E<=1e3?e.push({key:"export-all",icon:(0,w.jsx)(K.Z,{}),label:t.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(E,"条)"),onClick:function(){return ve("all")}}):e.push({key:"export-range",icon:(0,w.jsx)(K.Z,{}),label:t.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(E,"条)"),children:ye(E)})),[(0,w.jsx)(h.ZP,{type:"primary",icon:(0,w.jsx)(j.Z,{}),onClick:he,children:t.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,w.jsx)(L.Z,{menu:{items:e},placement:"bottom",children:(0,w.jsxs)(h.ZP,{type:"primary",icon:(0,w.jsx)(K.Z,{}),children:[t.formatMessage({id:"export",defaultMessage:"导出"}),(0,w.jsx)(G.Z,{})]})},"exportOperations")];var e}}),(0,w.jsx)(_,{isEdit:le,customer:pe,open:oe,onClose:function(){return de(!1)},onSubmit:Me})]})},ae=s(95091),re=s(94240),ne=function(){var e=(0,c.useIntl)(),t=(0,o.useState)("visitor"),s=i()(t,2),a=s[0],n=s[1],u=(0,o.useMemo)((function(){var t=[{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,w.jsx)(Z.Z,{superUser:!1})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,w.jsx)(F.Z,{superUser:!1})},{key:"customer",label:e.formatMessage({id:"customer"}),children:(0,w.jsx)(se,{superUser:!1})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,w.jsx)(ae.Z,{superUser:!1})}];return!(0,N.Ox)()&&(0,N.OJ)()&&t.splice(2,0,{key:"blackIp",label:e.formatMessage({id:"visitor.tab.blackIp"}),children:(0,w.jsx)(re.Z,{superUser:!1})}),t}),[e]),l=(0,o.useMemo)((function(){return[]}),[]),m=(0,o.useMemo)((function(){return[].concat(r()(u),r()(l))}),[u,l]);return(0,w.jsx)(d.Z,{items:m,activeKey:a,onChange:n,style:{margin:10}})}}}]);