"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4215],{52491:function(e,t,n){var a=n(94433),r=n(38956),s=n(44194),i=n(35865),o=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,d=e.proFieldProps,c=(0,r.Z)(e,u);return(0,o.jsx)(i.Z,(0,a.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(l);t.Z=d},43590:function(e,t,n){n.d(t,{Lr:function(){return v},_t:function(){return c},sE:function(){return p},x_:function(){return g}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},50989:function(e,t,n){n.d(t,{IH:function(){return g},RB:function(){return M},SJ:function(){return v},Xy:function(){return y},iO:function(){return w},u9:function(){return c},wU:function(){return p}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/enable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/disable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return S.apply(this,arguments)}function S(){return(S=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67728:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return v},hS:function(){return p},z_:function(){return c}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},54605:function(e,t,n){n.d(t,{G:function(){return g}});var a=n(73193),r=n.n(a),s=(n(44194),n(87373)),i=n(6844),o=n(96596),u=n.n(o),l=n(36125),d=n(93527),c=n(65819),f=n(31549),g=function(e){var t=e.children,n=e.onSuccess,a=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var t=u()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,l.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var t,r=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(r),d.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,f.jsx)(s.Z,r()(r()({},g),{},{children:t}))}},88449:function(e,t,n){var a=n(26710);t.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},89105:function(e,t,n){var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(45332),d=n.n(l),c=n(44194),f=n(58867),g=n(46141),m=n(48769),p=n(65513),h=n(19736),v=n(93527),b=n(50989),M=n(31549);t.Z=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,s=e.record,o=e.onSuccess,l=(0,h.useIntl)(),x=f.Z.useForm(),w=d()(x,1)[0];(0,c.useEffect)((function(){var e,n;t&&(s?w.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(w.resetFields(),w.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,w]);var k=function(){var e=u()(r()().mark((function e(){var t,u,d,c;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.validateFields();case 3:if(t=e.sent,u=i()(i()({},t),{},{orgUid:a,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,b.wU)(u);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,b.IH)(u);case 13:e.t0=e.sent;case 14:(d=e.t0)&&200===d.code?(c=(null==d?void 0:d.data)||{},v.yw.success(l.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==o||o(c),n(!1)):v.yw.error((null==d?void 0:d.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,M.jsx)(g.Z,{title:(0,M.jsx)(h.FormattedMessage,{id:null!=s&&s.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:k,onCancel:function(){n(!1)},okText:(0,M.jsx)(h.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,M.jsx)(h.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,M.jsxs)(f.Z,{form:w,layout:"vertical",preserve:!1,children:[(0,M.jsx)(f.Z.Item,{name:"name",label:(0,M.jsx)(h.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,M.jsx)(m.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,M.jsx)(f.Z.Item,{name:"description",label:(0,M.jsx)(h.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(m.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,M.jsx)(f.Z.Item,{name:"enabled",label:(0,M.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,M.jsx)(p.Z,{})})]})})}},73693:function(e,t,n){n.d(t,{Z:function(){return $}});var a=n(86222),r=n.n(a),s=n(73193),i=n.n(s),o=n(90819),u=n.n(o),l=n(89933),d=n.n(l),c=n(45332),f=n.n(c),g=n(44194),m=n(19736),p=n(67412),h=n(65100),v=n(66810),b=n(77359),M=n(3925),x=n(93527),w=n(43590),k=n(14888),y=n(6844),S=n(76711),j=n.n(S),Z=n(27625),C=n(30064),U=n(68263),T=n(86684),q=n(13847),I=n(9428),F=n(29589),O=n(10162),P=n(59908),A=n(67728),D=n(50989),E=n(89105),R=n(54605),z=n(31549),J=function(e){var t=e.value,n=e.onChange,a=e.options,r=e.loading,s=e.placeholder,i=e.emptyContent,o=e.onSearch,u=e.onDropdownOpen,l=e.onCreate,d=e.createLabel,c=e.createTitle;return(0,z.jsxs)(I.Z.Compact,{block:!0,children:[(0,z.jsx)(F.Z,{value:t,onChange:n,options:a,showSearch:!0,filterOption:!1,placeholder:s,loading:r,style:{flex:1},notFoundContent:i,onSearch:o,onOpenChange:function(e){e&&u()}}),(0,z.jsx)(M.ZP,{size:"small",icon:(0,z.jsx)(O.Z,{}),onClick:l,title:c,children:d})]})},L=function(e){var t,n,a=e.open,r=e.record,s=e.onClose,o=e.onSuccess,l=(0,m.useIntl)(),c=(0,k.u)((function(e){return e.currentOrg})),p=(0,g.useState)(!1),v=f()(p,2),b=v[0],y=v[1],S=(0,g.useState)([]),I=f()(S,2),F=I[0],L=I[1],X=(0,g.useState)(!1),B=f()(X,2),V=B[0],N=B[1],_=(0,g.useState)((null==r?void 0:r.avatar)||""),H=f()(_,2),G=H[0],W=H[1],Y=(0,g.useRef)(),$=(0,g.useMemo)((function(){return!(null==r||!r.uid)}),[r]),K=function(){var e=d()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W(t),x.yw.success(l.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=(0,g.useCallback)(function(){var e=d()(u()().mark((function e(t){var n,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N(!0),e.prev=1,null!=c&&c.uid){e.next=5;break}return L([]),e.abrupt("return",[]);case 5:return a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==c?void 0:c.uid,searchText:t||""},e.next=8,(0,D.u9)(a);case 8:return r=e.sent,console.log("queryAgentSettingsByOrg request:",a,r),s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],L(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 13:return e.prev=13,N(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==c?void 0:c.uid]);(0,g.useEffect)((function(){Q()}),[Q]);var ee=(0,g.useMemo)((function(){return F.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[F]),te=(0,g.useRef)(),ne=(0,g.useCallback)((function(e){te.current&&clearTimeout(te.current),te.current=setTimeout((function(){Q(e)}),300)}),[Q]);(0,g.useEffect)((function(){return function(){te.current&&clearTimeout(te.current)}}),[]);var ae=(0,g.useCallback)((function(){F.length||Q()}),[Q,F.length]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(Z.a,{open:a,onOpenChange:function(e){e||s()},title:$?l.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):l.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:Y,initialValues:$?{nickname:null==r?void 0:r.nickname,email:null==r?void 0:r.email,mobile:null==r?void 0:r.mobile,description:null==r?void 0:r.description,memberUid:(null==r||null===(t=r.member)||void 0===t?void 0:t.uid)||(null==r?void 0:r.memberUid),settingsUid:null==r||null===(n=r.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:l.formatMessage({id:"save",defaultMessage:"保存"}),resetText:l.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return s()}}},onFinish:function(){var e=d()(u()().mark((function e(t){var n,a,d,f,g;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.yw.loading(l.formatMessage({id:$?"updating":"creating",defaultMessage:$?"Updating":"Creating"})),!$){e.next=10;break}return d=i()(i()(i()({},r),t),{},{avatar:G||(null==r?void 0:r.avatar)}),e.next=6,(0,w.sE)(d);case 6:a=e.sent,console.log("updateAgent payload:",d,a),e.next=15;break;case 10:return f={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==c?void 0:c.uid,avatar:G},e.next=13,(0,w.x_)(f);case 13:a=e.sent,console.log("createAgent payload:",f,a);case 15:if(x.yw.destroy(),200!==(null===(n=a)||void 0===n?void 0:n.code)){e.next=23;break}return x.yw.success(l.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==o||o(a.data),s(),e.abrupt("return",!0);case 23:return x.yw.error((null===(g=a)||void 0===g?void 0:g.message)||l.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),x.yw.destroy(),x.yw.error(l.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(C.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:l.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,z.jsxs)(R.G,{onSuccess:K,onError:function(e){x.yw.error(String(e))},children:[(0,z.jsx)(h.Z,{src:G||(null==r?void 0:r.avatar)}),(0,z.jsxs)(M.ZP,{icon:(0,z.jsx)(P.Z,{}),children:[" ",l.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,z.jsx)(U.Z,{name:"memberUid",label:l.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:l.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:$,rules:$?[]:[{required:!0,message:l.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=d()(u()().mark((function e(t){var n,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.next=3,(0,A.z_)({pageNumber:0,pageSize:20,orgUid:null==c?void 0:c.uid,searchText:a||""});case 3:return r=e.sent,s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,z.jsx)(C.A.Item,{name:"settingsUid",label:l.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),rules:[{required:!0,message:l.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],children:(0,z.jsx)(J,{options:ee,loading:V,placeholder:l.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),emptyContent:0===ee.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:l.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(O.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return y(!0)},children:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:ne,onDropdownOpen:ae,onCreate:function(){return y(!0)},createLabel:l.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})}),(0,z.jsx)(T.Z,{name:"nickname",label:l.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.nickname.required"})}]}),(0,z.jsx)(T.Z,{name:"email",label:l.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.email.required"})}]}),(0,z.jsx)(T.Z,{name:"mobile",label:l.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.mobile.required"})}]}),(0,z.jsx)(q.Z,{name:"description",label:l.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,z.jsx)(E.Z,{open:b,onOpenChange:y,orgUid:(null==c?void 0:c.uid)||"",record:null,onSuccess:function(e){var t;y(!1),L((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(j()(t))})),Q(),null===(t=Y.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},X=n(41587),B=n(46219),V=n(53827),N=n(52491),_=n(46141),H=n(48769),G=n(90727),W=function(e){var t=e.open,n=e.onClose,a=e.onSubmit,r=(0,m.useIntl)(),s=V.ZP.useForm(),o=f()(s,1)[0],l=(0,k.u)((function(e){return e.currentOrg})),c=(0,X.Z)((function(e){return e.memberResult})),p=(0,X.Z)((function(e){return e.setMemberResult})),h=(0,B.E)((function(e){return e.agentResult})),v=(0,g.useState)(0),b=f()(v,2),x=b[0],w=b[1],y=(0,g.useState)(""),S=f()(y,2),Z=S[0],C=S[1],q=(0,g.useState)(!1),I=f()(q,2),F=I[0],O=I[1],P=(0,g.useState)([]),E=f()(P,2),R=E[0],J=E[1],L=(0,g.useRef)(null),W=(0,g.useState)(0),Y=f()(W,2),$=Y[0],K=Y[1],Q=(0,g.useState)(!0),ee=f()(Q,2),te=ee[0],ne=ee[1],ae=(0,g.useState)(!1),re=f()(ae,2),se=re[0],ie=re[1],oe=(0,g.useState)(0),ue=f()(oe,2),le=ue[0],de=ue[1],ce=(0,g.useState)(!0),fe=f()(ce,2),ge=fe[0],me=fe[1],pe=(0,g.useState)(!1),he=f()(pe,2),ve=he[0],be=he[1],Me=(0,g.useState)(!1),xe=f()(Me,2),we=xe[0],ke=xe[1],ye=(0,g.useState)([]),Se=f()(ye,2),je=Se[0],Ze=Se[1];(0,g.useEffect)((function(){var e;t&&(console.log("Modal opened, current agent data:",h),console.log("Current member data:",c),null!=c&&null!==(e=c.data)&&void 0!==e&&e.content&&0!==c.data.content.length||d()(u()().mark((function e(){var t,n,a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==l?void 0:l.uid},e.next=4,(0,A.z_)(n);case 4:a=e.sent,console.log("Init load members response:",a,n),(r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[]).length>0&&p(i()(i()({},c),{},{data:i()(i()({},null==c?void 0:c.data),{},{content:r})})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Init load members failed:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),d()(u()().mark((function e(){var t,n,a,s,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ke(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==l?void 0:l.uid,searchText:""},e.next=5,(0,D.u9)(n);case 5:a=e.sent,s=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],i=s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (".concat(r.formatMessage({id:"agent.settings.template.isDefault",defaultMessage:"默认"}),")"):"").concat(e.enabled?"":" (".concat(r.formatMessage({id:"app.disabled",defaultMessage:"已停用"}),")")),value:e.uid}})),Ze(i),!o.getFieldValue("settingsUid")&&i.length>0&&o.setFieldsValue({settingsUid:i[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,ke(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))())}),[t,h,c]),(0,g.useEffect)((function(){return function(){L.current&&clearTimeout(L.current)}}),[]);var Ce=(0,g.useMemo)((function(){var e=h.data.content.map((function(e){var t;return(null===(t=e.member)||void 0===t?void 0:t.uid)||e.memberUid})).filter((function(e){return e}));return console.log("Existing agent member UIDs:",e),console.log("Agent result data:",h.data.content),e}),[h]),Ue=(0,g.useMemo)((function(){var e,t,n,a=[],r=Z.trim()?R:(null==c||null===(e=c.data)||void 0===e?void 0:e.content)||[];console.log("Total members:",r.length),console.log("Existing agent member UIDs:",Ce),console.log("Using search results:",!!Z.trim());for(var s=0;s<r.length;s++){var i=r[s];if(Ce.includes(i.uid))console.log("Filtering out member:",i.nickname,i.uid);else{var o={title:"",value:"",children:[]};(n=o).title=(t=i).nickname,n.value=t.uid,a.push(o)}}return console.log("Filtered tree data:",a),a}),[c,R,Z,Ce]),Te=function(){var e=d()(u()().mark((function e(t){var n,a,r,s,i=arguments;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],console.log("handleSearch:",t,"isLoadMore:",n),t.trim()||n){e.next=7;break}return J([]),K(0),ne(!0),e.abrupt("return");case 7:return n?ie(!0):O(!0),e.prev=8,a={pageNumber:n?$+1:0,pageSize:20,orgUid:null==l?void 0:l.uid,searchText:t.trim()},e.next=12,(0,A.z_)(a);case 12:r=e.sent,console.log("handleSearch Search members response:",r,a),200===r.code?(s=(null==r?void 0:r.data.content)||[],n?(J((function(e){return[].concat(j()(e),j()(s))})),K($+1)):(J(s),K(0)),ne(!(null!=r&&r.data.last))):(console.error("handleSearch Search failed:",r.message),n||J([])),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),console.error("Search error:",e.t0),n||J([]);case 21:return e.prev=21,n?ie(!1):O(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[8,17,21,24]])})));return function(t){return e.apply(this,arguments)}}(),qe=function(e){var t=e.target.value;C(t),L.current&&clearTimeout(L.current),t.trim()?L.current=setTimeout((function(){Te(t)}),300):(J([]),K(0),ne(!0))},Ie=function(){Te(Z)},Fe=function(){!se&&te&&Z.trim()&&Te(Z,!0)},Oe=function(){var e=d()(u()().mark((function e(){var t,n,a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ve||!ge){e.next=17;break}return be(!0),e.prev=2,t={pageNumber:le+1,pageSize:20,orgUid:null==l?void 0:l.uid},e.next=6,(0,A.z_)(t);case 6:n=e.sent,console.log("Load more all members response:",n),200===n.code&&(a=(null==n?void 0:n.data.content)||[],r=[].concat(j()(c.data.content),j()(a)),p(i()(i()({},c),{},{data:i()(i()({},c.data),{},{content:r})})),de(le+1),me(!(null!=n&&n.data.last))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 14:return e.prev=14,be(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)("div",{children:(0,z.jsx)(_.Z,{title:r.formatMessage({id:"agent.create",defaultMessage:"创建客服"}),open:t,forceRender:!0,onOk:function(){console.log("handleOk"),o.validateFields().then((function(e){var t;console.log("form values:",e);var n=o.getFieldValue("memberUids"),r=o.getFieldValue("nickname"),s=o.getFieldValue("email"),i=o.getFieldValue("mobile"),u=o.getFieldValue("settingsUid"),d=Z.trim()?R:(null==c||null===(t=c.data)||void 0===t?void 0:t.content)||[],f=[];if(1===n.length){var g={nickname:r,email:s,mobile:i,memberUid:n[0],orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(g)}else n.forEach((function(e){var t=d.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(n)}}));console.log("agents:",f),a(f)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,z.jsxs)(V.ZP,{form:o,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,z.jsx)(U.Z,{label:r.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),name:"settingsUid",tooltip:r.formatMessage({id:"agent.settings.tooltip",defaultMessage:"为本次创建的客服指定配置模板"}),rules:[{required:!0,message:r.formatMessage({id:"agent.settings.required.message",defaultMessage:"请选择客服配置!"})}],fieldProps:{options:je,loading:we,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:r.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"})}}),(0,z.jsx)(N.Z,{label:r.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),name:"memberUids",tooltip:r.formatMessage({id:"agent.info.member.tooltip",defaultMessage:"请先到组织-》成员-》创建成员，已创建过客服的成员将被过滤"}),rules:[{required:!0,message:r.formatMessage({id:"agent.info.member.required.message",defaultMessage:"请选择成员!"})}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:r.formatMessage({id:"agent.info.member.placeholder.multiple",defaultMessage:"请选择成员（可多选）"}),onChange:function(e){var t;console.log("onTreeSelectChange:",e),w(e.length);var n=Z.trim()?R:(null==c||null===(t=c.data)||void 0===t?void 0:t.content)||[];if(0===e.length)o.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===e.length){var a=n.find((function(t){return t.uid===e[0]}));a&&o.setFieldsValue({nickname:a.nickname||"",email:a.email||"",mobile:a.mobile||""})}else{var r=n.filter((function(t){return e.includes(t.uid)})),s=r.map((function(e){return e.nickname})).filter(Boolean).join(", "),i=r.map((function(e){return e.email})).filter(Boolean).join(", "),u=r.map((function(e){return e.mobile})).filter(Boolean).join(", ");o.setFieldsValue({nickname:s,email:i,mobile:u})}},treeData:Ue,variant:"outlined",popupRender:function(e){return(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,z.jsx)(H.Z,{placeholder:r.formatMessage({id:"agent.info.member.search",defaultMessage:"搜索成员"}),value:Z,onChange:qe,onPressEnter:function(){return Ie()},suffix:(0,z.jsx)(G.Z,{onClick:Ie,style:{cursor:"pointer",color:F?"#1890ff":void 0},spin:F}),allowClear:!0,size:"small"})}),e,(Z.trim()?te:ge)&&(0,z.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,z.jsx)(M.ZP,{type:"link",size:"small",loading:Z.trim()?se:ve,onClick:Z.trim()?Fe:Oe,disabled:Z.trim()?se:ve,children:(Z.trim()?se:ve)?r.formatMessage({id:"loading",defaultMessage:"加载中..."}):r.formatMessage({id:"load.more",defaultMessage:"加载更多"})})})]})}}}),(0,z.jsx)(T.Z,{label:r.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),name:"nickname",disabled:x>1,tooltip:x>1?r.formatMessage({id:"agent.info.nickname.tooltip.multiple",defaultMessage:"多选模式下昵称将自动从选中的成员信息中获取"}):r.formatMessage({id:"agent.info.nickname.tooltip",defaultMessage:"昵称将自动从选中的成员信息中获取"})}),(0,z.jsx)(T.Z,{label:r.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),name:"email",disabled:x>1,tooltip:x>1?r.formatMessage({id:"agent.info.email.tooltip.multiple",defaultMessage:"多选模式下邮箱将自动从选中的成员信息中获取"}):r.formatMessage({id:"agent.info.email.tooltip",defaultMessage:"邮箱将自动从选中的成员信息中获取"})}),(0,z.jsx)(T.Z,{label:r.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),name:"mobile",disabled:x>1,tooltip:x>1?r.formatMessage({id:"agent.info.mobile.tooltip.multiple",defaultMessage:"多选模式下手机号将自动从选中的成员信息中获取"}):r.formatMessage({id:"agent.info.mobile.tooltip",defaultMessage:"手机号将自动从选中的成员信息中获取"})})]})})})},Y=n(36125),$=function(e){var t=e.superUser,n=(0,m.useIntl)(),a=(0,g.useRef)(),s=(0,k.u)((function(e){return e.currentOrg})),o=(0,g.useState)(!1),l=f()(o,2),c=l[0],S=l[1],j=(0,g.useState)(!1),Z=f()(j,2),C=Z[0],U=Z[1],T=(0,g.useState)(null),q=f()(T,2),I=q[0],F=q[1],O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:n.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,z.jsx)(h.Z,{src:null==t?void 0:t.avatar})}},{title:n.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:n.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.status){case y.Ra4:return(0,z.jsx)(v.Z,{color:"green",children:n.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case y.tU$:return(0,z.jsx)(v.Z,{color:"orange",children:n.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case y.LZ1:default:return(0,z.jsx)(v.Z,{color:"red",children:n.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:n.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(e,t){return null!=t&&t.connected?(0,z.jsx)(v.Z,{color:"green",children:n.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,z.jsx)(v.Z,{color:"red",children:n.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:n.formatMessage({id:"agent.queue.stats",defaultMessage:"队列统计"}),dataIndex:"queueStats",width:280,hideInSearch:!0,render:function(e,t){var a,r,s,i=null==t?void 0:t.queueStats;return i?(0,z.jsxs)("span",{style:{fontSize:12},children:[(0,z.jsxs)(v.Z,{color:"blue",children:[n.formatMessage({id:"agent.queue.today",defaultMessage:"今日"}),": ",null!==(a=i.agentServedCount)&&void 0!==a?a:0]}),(0,z.jsxs)(v.Z,{color:"orange",children:[n.formatMessage({id:"agent.queue.queuing",defaultMessage:"排队中"}),": ",null!==(r=i.queuingCount)&&void 0!==r?r:0]}),(0,z.jsxs)(v.Z,{color:"green",children:[n.formatMessage({id:"agent.queue.chatting",defaultMessage:"接待中"}),": ",null!==(s=i.chattingCount)&&void 0!==s?s:0]})]}):(0,z.jsx)("span",{style:{color:"#999"},children:"-"})}},{title:n.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){return null!=t&&t.settings?(0,z.jsx)("a",{onClick:function(){F(t),S(!0)},children:t.settings.name||n.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,z.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){F(t),S(!0)},children:n.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:n.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:n.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){return[(0,z.jsx)("a",{onClick:function(){return function(e){var t;if(null!=e&&e.uid){var a={chatConfig:{org:null==s?void 0:s.uid,t:y._0X,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}else x.yw.error(n.formatMessage({id:"agent.invalid",defaultMessage:"无效的客服"}))}(t)},children:n.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,z.jsx)("a",{onClick:function(){return m.history.push("/service/channel")},children:n.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,z.jsx)("a",{onClick:function(){F(t),S(!0)},children:n.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,z.jsx)(b.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:d()(u()().mark((function e(){var r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,w.Lr)(t);case 4:r=e.sent,x.yw.destroy(),200===(null==r?void 0:r.code)?(x.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):x.yw.error((null==r?void 0:r.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.destroy(),x.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:n.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,z.jsx)("a",{children:n.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:n.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(p.Z,{columns:O,actionRef:a,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,z.jsx)(M.ZP,{type:"primary",onClick:function(){F(null),U(!0)},children:n.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=d()(u()().mark((function e(n,a){var r,o,l,d,c,g,m,p,h,v,b,M,x,k,y,S,j,Z,C,U,T,q;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=(null!==(r=null==n?void 0:n.current)&&void 0!==r?r:1)-1,c=null!==(o=null==n?void 0:n.pageSize)&&void 0!==o?o:10,g=null!==(l=null==n?void 0:n.searchText)&&void 0!==l?l:"",(h=Object.entries(a||{})).length>0&&(v=h[0],b=f()(v,2),M=b[0],(x=b[1])&&(m=M,p="ascend"===x?"ascend":"descend")),k=i()(i()({pageNumber:d,pageSize:c,orgUid:null==s?void 0:s.uid,searchText:g,superUser:t},m?{sortBy:m}:{}),p?{sortDirection:p}:{}),e.prev=6,e.next=9,(0,w._t)(k);case 9:if(y=e.sent,Y.Z.debug("queryAgentsByOrg response:",y,k),200!==(null==y?void 0:y.code)){e.next=15;break}return T=(null==y||null===(S=y.data)||void 0===S?void 0:S.content)||[],q=null!==(j=null!==(Z=null==y||null===(C=y.data)||void 0===C?void 0:C.totalElements)&&void 0!==Z?Z:null==y||null===(U=y.data)||void 0===U?void 0:U.numberOfElements)&&void 0!==j?j:T.length,e.abrupt("return",{data:T,total:q,success:!0});case 15:return e.abrupt("return",{data:[],total:0,success:!1});case 18:return e.prev=18,e.t0=e.catch(6),e.abrupt("return",{data:[],total:0,success:!1});case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:n.formatMessage({id:"agent",defaultMessage:"Agent"})}),c&&(0,z.jsx)(L,{open:c,record:I,onClose:function(){return S(!1)},onSuccess:function(){var e;return null===(e=a.current)||void 0===e?void 0:e.reload()}}),C&&(0,z.jsx)(W,{open:C,onClose:function(){return U(!1)},onSubmit:function(){var e=d()(u()().mark((function e(t){var s,i,o,l,d,c,f,g,m,p,h,v,b,M,k,y;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(((null==t?void 0:t.length)||0)>200)){e.next=3;break}return x.yw.warning(n.formatMessage({id:"agent.create.batch.limit",defaultMessage:"超过最大批量 200，请分批创建"})),e.abrupt("return");case 3:s="agent-batch-create",x.yw.loading({content:n.formatMessage({id:"saving",defaultMessage:"Saving..."}),key:s,duration:0}),i=[],o=function(e){return new Promise((function(t){return setTimeout(t,e)}))},l=r()(t),e.prev=8,l.s();case 10:if((d=l.n()).done){e.next=52;break}c=d.value,f=0,g=!1,m=null;case 15:if(!(f<3)||g){e.next=49;break}return e.prev=16,e.next=19,(0,w.x_)(c);case 19:if(200!==(null==(p=e.sent)?void 0:p.code)){e.next=24;break}return i.push({uid:c.memberUid,ok:!0}),g=!0,e.abrupt("break",49);case 24:return i.push({uid:c.memberUid,ok:!1,code:null==p?void 0:p.code,msg:null==p?void 0:p.message}),g=!0,e.abrupt("break",49);case 29:if(e.prev=29,e.t0=e.catch(16),v=null===e.t0||void 0===e.t0||null===(h=e.t0.response)||void 0===h?void 0:h.status,m=e.t0,f+=1,!(409===v&&f<3)){e.next=40;break}return e.next=37,o(300*f);case 37:return e.abrupt("continue",15);case 40:if(502!==v&&503!==v&&504!==v||!(f<3)){e.next=44;break}return e.next=43,o(300*f);case 43:return e.abrupt("continue",15);case 44:return i.push({uid:c.memberUid,ok:!1,code:v,msg:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"error"}),g=!0,e.abrupt("break",49);case 47:e.next=15;break;case 49:!g&&m&&i.push({uid:c.memberUid,ok:!1,msg:(null===(b=m)||void 0===b?void 0:b.message)||"error"});case 50:e.next=10;break;case 52:e.next=57;break;case 54:e.prev=54,e.t1=e.catch(8),l.e(e.t1);case 57:return e.prev=57,l.f(),e.finish(57);case 60:M=i.filter((function(e){return e.ok})).length,k=i.length-M,M>0?(x.yw.success({content:n.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(M,")"),key:s}),U(!1),null===(y=a.current)||void 0===y||y.reload()):x.yw.destroy(s),k>0&&x.yw.warning(n.formatMessage({id:"create.partial.failed",defaultMessage:"部分创建失败，请查看失败项并重试"})+" (".concat(k,")"));case 64:case"end":return e.stop()}}),e,null,[[8,54,57,60],[16,29]])})));return function(t){return e.apply(this,arguments)}}()})]})}},41587:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(6844),r=n(26557),s=n(26407),i=n(20744),o=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n.splice(a,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:a.PQL})))}}]);