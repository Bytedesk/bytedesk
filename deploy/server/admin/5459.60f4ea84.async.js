"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5459],{15722:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(83910),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=r(54183),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},82669:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(83910),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},s=r(54183),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},40228:function(e,t,r){r.d(t,{Z:function(){return G}});var n=r(73193),o=r.n(n),a=r(90819),s=r.n(a),i=r(89933),l=r.n(i),u=r(45332),c=r.n(u),d=r(20126),f=r(44194),m=r(99753),p=r(98830),g=r(19433),h=r(14906),v=r(86895),y=r(70338),x=r(82770),w=r(39487),R=r(32525),j=r(50716),C=r(14597),Z=r(91361),P=r(15722),b=r(82669),M=r(90727),k=r(39497),S=r(25784),E=r(89965),O=r(80953),$=r(41196),z=r(31549),F=function(e){var t=e.open,r=e.superUser,n=e.isEdit,o=e.role,a=e.onCancel,i=e.onSubmit,u=$.Z.useForm(),d=c()(u,1)[0],m=(0,h.useIntl)(),y=(0,p.u)((function(e){return e.currentOrg}));(0,f.useEffect)((function(){n&&o?d.setFieldsValue({uid:o.uid,name:o.name,description:o.description}):d.resetFields()}),[n,o]);var x=function(){d.validateFields().then(function(){var e=l()(s()().mark((function e(t){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==o?void 0:o.uid:"",name:t.name,description:t.description,authorityUids:[],orgUid:null==y?void 0:y.uid,level:r?k.Hxq:k.whQ},i(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),g.yw.error(m.formatMessage({id:"role.message.operation.failed"}))}))};return(0,z.jsx)(v.Z,{title:m.formatMessage({id:n?"role.edit.title":"role.create.title"}),open:t,forceRender:!0,onOk:x,onCancel:a,children:(0,z.jsxs)(S.A,{form:d,name:"roleForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,z.jsx)(E.Z,{label:m.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0,message:m.formatMessage({id:"role.name.required"})}],fieldProps:{onPressEnter:function(){d.validateFields(["description"]).then((function(){x()}))}}}),(0,z.jsx)(O.Z,{label:m.formatMessage({id:"role.description"}),name:"description",rules:[{required:!0,message:m.formatMessage({id:"role.description.required"})}],fieldProps:{onPressEnter:function(){x()},autoSize:{minRows:2,maxRows:6}}})]})})},G=function(e){var t=e.superUser,r=(0,h.useIntl)(),n=(0,C.Z)().isDarkMode,a=v.Z.useModal(),i=c()(a,2),u=i[0],S=i[1],E=(0,Z.Z)().translateString,O=(0,f.useState)(!1),$=c()(O,2),G=$[0],U=$[1],I=(0,f.useState)(""),q=c()(I,2),N=q[0],A=q[1],H=(0,f.useState)(!1),T=c()(H,2),L=T[0],V=T[1],B=(0,p.u)((function(e){return e.currentOrg})),D=(0,d.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform,insertRole:e.insertRole,insertRolePlatform:e.insertRolePlatform,upgradeRole:e.upgradeRole,upgradeRolePlatform:e.upgradeRolePlatform,currentRole:e.currentRole,currentRolePlatform:e.currentRolePlatform,removeRole:e.removeRole,removeRolePlatform:e.removeRolePlatform,setCurrentRole:e.setCurrentRole,setCurrentRolePlatform:e.setCurrentRolePlatform}})),Q=D.roleResult,W=D.roleResultPlatform,X=D.setRoleResult,J=D.setRoleResultPlatform,_=D.insertRole,K=D.insertRolePlatform,Y=D.upgradeRole,ee=D.upgradeRolePlatform,te=D.removeRole,re=D.removeRolePlatform,ne=D.currentRole,oe=D.currentRolePlatform,ae=D.setCurrentRole,se=D.setCurrentRolePlatform,ie=t?oe:ne,le=function(e){return[k.jGk,k.w7Z,k.nGQ,k.gJI].includes(null==e?void 0:e.uid)||!0===(null==e?void 0:e.system)},ue=function(){var e=l()(s()().mark((function e(){var n,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:100,orgUid:t?"":null==B?void 0:B.uid,level:t?k.Hxq:k.whQ,searchText:N},e.next=4,(0,m.E9)(n);case 4:o=e.sent,console.log("queryRolesByOrg response: ",o.data,n),200===o.code?(g.yw.destroy(),t?(J(o),""===(null==oe?void 0:oe.uid)&&o.data.content.length>0&&se(o.data.content[0])):(X(o),""===(null==ne?void 0:ne.uid)&&o.data.content.length>0&&ae(o.data.content[0]))):(g.yw.destroy(),g.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){ue()}),[N,null==B?void 0:B.uid]);var ce=function(){var e=l()(s()().mark((function e(n){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"creating"})),e.next=3,(0,m.fA)(o()({},n));case 3:200===(a=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"create.success"})),U(!1),t?(K(a.data),se(a.data)):(_(a.data),ae(a.data))):(g.yw.destroy(),g.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=l()(s()().mark((function e(n){var o,a,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,authorityUids:(null==n||null===(o=n.authorities)||void 0===o?void 0:o.map((function(e){return e.uid})))||[],system:t},g.yw.loading(r.formatMessage({id:"updating"})),e.next=4,(0,m.ul)(a);case 4:200===(i=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success"})),t?ee(i.data):Y(i.data),U(!1)):(g.yw.destroy(),g.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fe=function(){var e=l()(s()().mark((function e(n){var o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"deleting"})),e.next=3,(0,m.Rd)(n);case 3:200===(o=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"delete.success"})),t?re(n.uid):te(n.uid),U(!1),ue()):(g.yw.destroy(),g.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=t?W.data.content:Q.data.content;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(y.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[(0,z.jsx)(x.ZP,{type:"primary",size:"small",icon:(0,z.jsx)(b.Z,{}),onClick:function(){V(!1),U(!0)},children:r.formatMessage({id:"create"})}),(0,z.jsx)(x.ZP,{size:"small",onClick:ue,children:r.formatMessage({id:"refresh"})}),!le(ie)&&(null==ie?void 0:ie.uid)&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x.ZP,{size:"small",onClick:function(){le(ie)?g.yw.error(r.formatMessage({id:"role.system.noedit"})):(V(!0),U(!0))},children:r.formatMessage({id:"edit"})}),(0,z.jsx)(x.ZP,{onClick:function(){return function(e){le(e)?g.yw.error(r.formatMessage({id:"role.system.nodelete"})):u.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,z.jsx)(P.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm"}),"【").concat(E(e.name),"】？"),onOk:function(){fe(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}(ie)},size:"small",style:{float:"right"},danger:!0,children:r.formatMessage({id:"delete"})})]})]}),(0,z.jsx)("div",{style:{margin:5},children:(0,z.jsxs)(w.Z.Compact,{style:{width:"100%"},children:[(0,z.jsx)(R.Z,{placeholder:r.formatMessage({id:"role.search.placeholder",defaultMessage:"搜索角色名称"}),value:N,onChange:function(e){return A(e.target.value)},onPressEnter:function(){return ue()},allowClear:!0}),(0,z.jsx)(x.ZP,{onClick:function(){return ue()},icon:(0,z.jsx)(M.Z,{})})]})}),(0,z.jsx)(j.Z,{dataSource:me,renderItem:function(e){return(0,z.jsx)(j.Z.Item,{style:{backgroundColor:(null==ie?void 0:ie.uid)===e.uid?n?"#333333":"#dddddd":void 0,cursor:"pointer"},onClick:function(){return r=e,void(t?se(r):ae(r));var r},children:(0,z.jsx)(j.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,z.jsx)(z.Fragment,{children:E(e.name)}),description:E(e.description)})},e.uid)}}),G&&(0,z.jsx)(F,{open:G,superUser:t,isEdit:L,role:ie,onCancel:function(){U(!1)},onSubmit:function(e){L?de(e):ce(e)}}),S]})}},77945:function(e,t,r){r.d(t,{Z:function(){return k}});var n=r(44194),o=r(67738),a=r(73193),s=r.n(a),i=r(76711),l=r.n(i),u=r(90819),c=r.n(u),d=r(89933),f=r.n(d),m=r(45332),p=r.n(m),g=r(19433),h=r(39497),v=r(14906);function y(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/authority/query/org",{method:"GET",params:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(91361),R=r(20126),j=r(40110),C=r(40677),Z=r(99753),P=r(31549),b={width:"20%",textAlign:"center"},M=function(e){var t=e.superUser,r=(0,v.useIntl)(),o=(0,w.Z)().translateString,a=(0,n.useState)({uid:""}),i=p()(a,2),u=i[0],d=i[1],m=(0,R.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole,currentRolePlatform:e.currentRolePlatform,setCurrentRolePlatform:e.setCurrentRolePlatform}})),x=m.upgradeRole,M=m.currentRole,k=m.setCurrentRole,S=m.currentRolePlatform,E=m.setCurrentRolePlatform,O=(0,n.useState)([]),$=p()(O,2),z=$[0],F=$[1],G=(0,n.useState)(M.authorities),U=p()(G,2),I=U[0],q=U[1],N=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,level:h.Hxq},e.next=3,y(t);case 3:r=e.sent,console.log("getAuthorities response",r),200===r.code?F(r.data.content):(console.log("getAuthorities error",r),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=z.reduce((function(e,t){var r=t.name.split("_"),n=p()(r,1)[0];return e[n]||(e[n]=[]),e[n].push(t),e}),{});(0,n.useEffect)((function(){t?(d(S),q(S.authorities)):(d(M),q(M.authorities))}),[M,S,t]),(0,n.useEffect)((function(){N()}),[]);var H=function(e){return e.some((function(e){return I.some((function(t){return t.name===e.name}))}))},T=function(){var e=f()(c()().mark((function e(t){var n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",n),g.yw.loading(r.formatMessage({id:"updating"})),e.next=5,(0,Z.ul)(n);case 5:o=e.sent,console.log("updateRole:",o),200===o.code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),x(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,P.jsx)(P.Fragment,{children:Object.keys(A).map((function(e){return(0,P.jsx)(j.Z,{title:(0,P.jsx)(C.Z,{checked:(r=A[e],r.every((function(e){return I.some((function(t){return t.name===e.name}))}))),indeterminate:H(A[e]),onChange:function(r){return function(e,r){var n,o=A[e];r?(n=l()(I),o.forEach((function(e){n.some((function(t){return t.name===e.name}))||n.push(e)}))):n=I.filter((function(e){return!o.some((function(t){return t.name===e.name}))})),q(n),t?(E(s()(s()({},S),{},{authorities:n})),T(s()(s()({},S),{},{authorities:n}))):(k(s()(s()({},M),{},{authorities:n})),T(s()(s()({},M),{},{authorities:n})))}(e,r.target.checked)},disabled:(null==u?void 0:u.system)||""===(null==u?void 0:u.uid),children:o(e)}),style:{marginTop:10},children:A[e].map((function(e){return(0,P.jsx)(j.Z.Grid,{style:b,children:(0,P.jsx)(C.Z,{checked:null==I?void 0:I.some((function(t){return t.name===e.name})),disabled:!0,children:o(e.name)})},e.name)}))},e);var r}))})},k=function(e){var t=e.superUser,r=[{key:"authority",label:"权限",children:(0,P.jsx)(M,{superUser:t})}];return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(o.Z,{defaultActiveKey:"1",items:r,onChange:function(e){console.log(e)}})})}},75112:function(e,t,r){var n=r(14597);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},70338:function(e,t,r){r.d(t,{Z:function(){return C}});var n=r(44194),o=r(51865),a=r.n(o),s=r(34573),i=r(69256),l=r(31246),u=r(51858),c=r(77167);const d=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],m=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var p=function(e,t){return a()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const r=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${r}`]:r&&d.includes(r)}})(e,t)),((e,t)=>{const r={};return m.forEach((n=>{r[`${e}-align-${n}`]=t.align===n})),r[`${e}-align-stretch`]=!t.align&&!!t.vertical,r})(e,t)),((e,t)=>{const r={};return f.forEach((n=>{r[`${e}-justify-${n}`]=t.justify===n})),r})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,r={};return d.forEach((e=>{r[`${t}-wrap-${e}`]={flexWrap:e}})),r},y=e=>{const{componentCls:t}=e,r={};return m.forEach((e=>{r[`${t}-align-${e}`]={alignItems:e}})),r},x=e=>{const{componentCls:t}=e,r={};return f.forEach((e=>{r[`${t}-justify-${e}`]={justifyContent:e}})),r};var w=(0,u.I$)("Flex",(e=>{const{paddingXS:t,padding:r,paddingLG:n}=e,o=(0,c.IX)(e,{flexGapSM:t,flexGap:r,flexGapLG:n});return[g(o),h(o),v(o),y(o),x(o)]}),(()=>({})),{resetStyle:!1}),R=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};const j=n.forwardRef(((e,t)=>{const{prefixCls:r,rootClassName:o,className:u,style:c,flex:d,gap:f,vertical:m=!1,component:g="div",children:h}=e,v=R(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component","children"]),{flex:y,direction:x,getPrefixCls:j}=n.useContext(l.E_),C=j("flex",r),[Z,P,b]=w(C),M=null!=m?m:null==y?void 0:y.vertical,k=a()(u,o,null==y?void 0:y.className,C,P,b,p(C,e),{[`${C}-rtl`]:"rtl"===x,[`${C}-gap-${f}`]:(0,i.n)(f),[`${C}-vertical`]:M}),S=Object.assign(Object.assign({},null==y?void 0:y.style),c);return d&&(S.flex=d),f&&!(0,i.n)(f)&&(S.gap=f),Z(n.createElement(g,Object.assign({ref:t,className:k,style:S},(0,s.Z)(v,["justify","wrap","align"])),h))}));var C=j}}]);