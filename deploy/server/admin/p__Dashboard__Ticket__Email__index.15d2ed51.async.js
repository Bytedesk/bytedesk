"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5256],{2077:function(e,a,s){s.d(a,{LE:function(){return u},W5:function(){return g},p0:function(){return m},zl:function(){return M}});var t=s(90819),r=s.n(t),n=s(73193),l=s.n(n),i=s(89933),d=s.n(i),o=s(14906);function u(e){return c.apply(this,arguments)}function c(){return(c=d()(r()().mark((function e(a){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/workgroup/query/org",{method:"GET",params:l()({},a)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return f.apply(this,arguments)}function f(){return(f=d()(r()().mark((function e(a){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/workgroup/create",{method:"POST",data:l()({},a)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=d()(r()().mark((function e(a){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/workgroup/update",{method:"POST",data:l()({},a)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=d()(r()().mark((function e(a){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/workgroup/delete",{method:"POST",data:l()({},a)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},23216:function(e,a,s){s.r(a),s.d(a,{default:function(){return Le}});var t=s(44194),r=s(67738),n=s(73193),l=s.n(n),i=s(84176),d=s.n(i),o=s(10154),u=s.n(o),c=s(90819),m=s.n(c),f=s(89933),g=s.n(f),p=s(45332),M=s.n(p),x=s(86895),h=s(66431),j=s(39487),v=s(82770),y=s(63649),Z=s(10162),b=s(80556),w=s(89246),k=s(14906),T=s(98830),I=s(19433),S=s(6203),E=s(42496),C=s(31549),F=function(e){var a=e.open,s=e.isEdit,t=void 0!==s&&s,r=e.email,n=e.loading,l=e.onClose,i=e.onSubmit;return(0,C.jsx)(E.Z,{type:"TICKET",isEdit:t,email:r,open:a,loading:n,onClose:l,onSubmit:i})},A=["current","pageSize","keyword"],R=function(){var e=(0,k.useIntl)(),a=(0,t.useRef)(),s=(0,T.u)((function(e){return e.currentOrg})),r=(0,t.useState)(!1),n=M()(r,2),i=n[0],o=n[1],c=(0,t.useState)(!1),f=M()(c,2),p=f[0],E=f[1],R=(0,t.useState)(void 0),N=M()(R,2),q=N[0],P=N[1],O=(0,t.useState)(!1),W=M()(O,2),L=W[0],U=W[1],D=function(){var e;return null===(e=a.current)||void 0===e?void 0:e.reload()},H=function(){E(!1),P(void 0),o(!0)},z=function(){var a=g()(m()().mark((function a(s,t,r){var n;return m()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,S.s)(u()({uid:s.uid},t,r));case 3:200===(n=a.sent).code?(I.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"})),D()):I.yw.error(n.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),I.yw.error(e.formatMessage({id:"request.error",defaultMessage:"请求失败"}));case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));return function(e,s,t){return a.apply(this,arguments)}}(),K=(0,t.useMemo)((function(){return{QQ:{text:e.formatMessage({id:"email.provider.qq",defaultMessage:"QQ邮箱"})},TENCENT_ENTERPRISE:{text:e.formatMessage({id:"email.provider.tencentEnterprise",defaultMessage:"腾讯企业邮箱"})},SINA:{text:e.formatMessage({id:"email.provider.sina",defaultMessage:"新浪邮箱"})},GMAIL:{text:e.formatMessage({id:"email.provider.gmail",defaultMessage:"Gmail"})},NETEASE_163:{text:e.formatMessage({id:"email.provider.netease163",defaultMessage:"网易163邮箱"})},NETEASE_ENTERPRISE:{text:e.formatMessage({id:"email.provider.neteaseEnterprise",defaultMessage:"网易企业邮箱"})},ALIYUN_ENTERPRISE:{text:e.formatMessage({id:"email.provider.aliyunEnterprise",defaultMessage:"阿里云企业邮箱"})},HOTMAIL:{text:e.formatMessage({id:"email.provider.hotmail",defaultMessage:"Hotmail/Outlook"})},FEISHU_ENTERPRISE:{text:e.formatMessage({id:"email.provider.feishuEnterprise",defaultMessage:"飞书企业邮箱"})},YAHOO:{text:e.formatMessage({id:"email.provider.yahoo",defaultMessage:"Yahoo邮箱"})},OTHER:{text:e.formatMessage({id:"email.provider.other",defaultMessage:"其他邮箱"})}}}),[e]),B=((0,t.useMemo)((function(){return{SERVICE:{text:e.formatMessage({id:"email.usage.service",defaultMessage:"在线客服接待"})},TICKET:{text:e.formatMessage({id:"email.usage.ticket",defaultMessage:"工单客服"})}}}),[e]),(0,t.useMemo)((function(){return[{dataIndex:"index",valueType:"indexBorder",width:48,align:"center"},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.name",defaultMessage:"名称"}),dataIndex:"name",copyable:!0,ellipsis:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.address",defaultMessage:"邮箱地址"}),dataIndex:"emailAddress",copyable:!0,ellipsis:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.provider",defaultMessage:"服务提供商"}),dataIndex:"provider",width:160,valueType:"select",valueEnum:K},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.protocol",defaultMessage:"协议"}),dataIndex:"protocol",width:120,valueType:"select",hideInSearch:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.enabled",defaultMessage:"启用"}),dataIndex:"enabled",width:100,render:function(e,a){return(0,C.jsx)(h.Z,{size:"small",checked:!!a.enabled,onChange:function(e){return z(a,"enabled",e)}})},search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.debug",defaultMessage:"调试"}),dataIndex:"debug",width:100,render:function(e,a){return(0,C.jsx)(h.Z,{size:"small",checked:!!a.debug,onChange:function(e){return z(a,"debug",e)}})},search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",width:180,search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",width:180,search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"action",defaultMessage:"操作"}),key:"option",dataIndex:"option",hideInSearch:!0,width:220,fixed:"right",render:function(a,s){return(0,C.jsxs)(j.Z,{children:[(0,C.jsx)(v.ZP,{type:"link",onClick:function(){return function(e){E(!0),P(e),o(!0)}(s)},children:(0,C.jsx)(k.FormattedMessage,{id:"edit",defaultMessage:"编辑"})}),(0,C.jsx)(y.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除提示"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(s.name,"】?"),onConfirm:function(){return function(a){var s;x.Z.confirm({title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(a.name,"】？"),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:(s=g()(m()().mark((function s(){var t;return m()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return I.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),s.prev=1,s.next=4,(0,S.nd)({uid:a.uid});case 4:t=s.sent,I.yw.destroy(),200===t.code?(I.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),D()):I.yw.error(t.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),s.next=13;break;case 9:s.prev=9,s.t0=s.catch(1),I.yw.destroy(),I.yw.error(e.formatMessage({id:"request.error",defaultMessage:"请求失败"}));case 13:case"end":return s.stop()}}),s,null,[[1,9]])}))),function(){return s.apply(this,arguments)})})}(s)},okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,C.jsx)(v.ZP,{type:"link",danger:!0,children:(0,C.jsx)(k.FormattedMessage,{id:"delete",defaultMessage:"删除"})})})]})}}]}),[e]));return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(w.Z,{rowKey:"uid",actionRef:a,columns:B,cardBordered:!0,scroll:{x:1400},headerTitle:e.formatMessage({id:"email.list",defaultMessage:"邮箱应用列表"}),toolBarRender:function(){return[(0,C.jsx)(v.ZP,{type:"primary",icon:(0,C.jsx)(Z.Z,{}),onClick:H,children:(0,C.jsx)(k.FormattedMessage,{id:"create",defaultMessage:"新建"})},"create"),(0,C.jsx)(v.ZP,{icon:(0,C.jsx)(b.Z,{}),onClick:D},"refresh")]},search:{labelWidth:"auto"},request:function(){var a=g()(m()().mark((function a(t){var r,n,i,o,u,c,f,g,p,M,x,h;return m()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=(n=t).current,o=n.pageSize,u=n.keyword,c=d()(n,A),f=(i||1)-1,g=o||10,p=l()({pageNumber:f,pageSize:g,orgUid:null==s?void 0:s.uid,searchText:(null==u||null===(r=u.trim)||void 0===r?void 0:r.call(u))||void 0},c),a.prev=4,a.next=7,(0,S.eg)(p);case 7:if(M=a.sent,console.log("queryEmailsByOrg resp:",M,p),200!==M.code){a.next=11;break}return a.abrupt("return",{data:(null===(x=M.data)||void 0===x?void 0:x.content)||[],success:!0,total:(null===(h=M.data)||void 0===h?void 0:h.totalElements)||0});case 11:return I.yw.error(M.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),a.abrupt("return",{data:[],success:!1});case 15:return a.prev=15,a.t0=a.catch(4),I.yw.error(e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),a.abrupt("return",{data:[],success:!1});case 19:case"end":return a.stop()}}),a,null,[[4,15]])})));return function(e){return a.apply(this,arguments)}}(),pagination:{showSizeChanger:!0},options:{fullScreen:!1,setting:!0,reload:!1}}),i&&(0,C.jsx)(F,{open:i,isEdit:p,email:q,loading:L,onClose:function(){return o(!1)},onSubmit:function(){var a=g()(m()().mark((function a(s){var t;return m()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(U(!0),a.prev=1,!p){a.next=8;break}return a.next=5,(0,S.s)(l()(l()({},s),{},{uid:null==q?void 0:q.uid}));case 5:a.t0=a.sent,a.next=11;break;case 8:return a.next=10,(0,S.D$)(s);case 10:a.t0=a.sent;case 11:200===(t=a.t0).code?(I.yw.success(e.formatMessage({id:p?"update.success":"create.success",defaultMessage:p?"更新成功":"创建成功"})),o(!1),D()):I.yw.error(t.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"}));case 13:return a.prev=13,U(!1),a.finish(13);case 16:case"end":return a.stop()}}),a,null,[[1,,13,16]])})));return function(e){return a.apply(this,arguments)}}()})]})},N=s(32525),q=s(41196),P=s(13847),O=s(39497),W="/api/v1/email-template";function L(e){return U.apply(this,arguments)}function U(){return(U=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("".concat(W,"/query/org"),{method:"GET",params:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return H.apply(this,arguments)}function H(){return(H=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("".concat(W,"/create"),{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return K.apply(this,arguments)}function K(){return(K=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("".concat(W,"/update"),{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return G.apply(this,arguments)}function G(){return(G=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("".concat(W,"/delete"),{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=["current","pageSize","keyword"],Y=N.Z.TextArea,_=function(){var e=(0,k.useIntl)(),a=(0,t.useRef)(),s=(0,T.u)((function(e){return e.currentOrg})),r=q.Z.useForm(),n=M()(r,1)[0],i=(0,t.useState)(!1),o=M()(i,2),u=o[0],c=o[1],f=(0,t.useState)(!1),p=M()(f,2),S=p[0],E=p[1],F=(0,t.useState)(void 0),A=M()(F,2),R=A[0],O=A[1],W=(0,t.useState)(!1),U=M()(W,2),H=U[0],K=U[1],G=function(){var e;return null===(e=a.current)||void 0===e?void 0:e.reload()},_=(0,t.useMemo)((function(){return[{value:"TICKET_REPLY",label:e.formatMessage({id:"email.template.type.ticketReply",defaultMessage:"工单回复"})},{value:"MARKETING",label:e.formatMessage({id:"email.template.type.marketing",defaultMessage:"营销"})},{value:"NOTIFICATION",label:e.formatMessage({id:"email.template.type.notification",defaultMessage:"通知"})},{value:"SYSTEM",label:e.formatMessage({id:"email.template.type.system",defaultMessage:"系统"})}]}),[e]),J=(0,t.useMemo)((function(){return[{value:"DRAFT",label:e.formatMessage({id:"email.template.status.draft",defaultMessage:"草稿"})},{value:"PUBLISHED",label:e.formatMessage({id:"email.template.status.published",defaultMessage:"已发布"})},{value:"ARCHIVED",label:e.formatMessage({id:"email.template.status.archived",defaultMessage:"已归档"})}]}),[e]),V=(0,t.useMemo)((function(){return _.reduce((function(e,a){return e[a.value]={text:a.label},e}),{})}),[_]),Q=(0,t.useMemo)((function(){return J.reduce((function(e,a){return e[a.value]={text:a.label},e}),{})}),[J]),$=function(){E(!1),O(void 0),n.resetFields(),c(!0)},ee=(0,t.useMemo)((function(){return[{dataIndex:"index",valueType:"indexBorder",width:48,align:"center"},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.name",defaultMessage:"模板名称"}),dataIndex:"name",copyable:!0,ellipsis:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.subject",defaultMessage:"邮件主题"}),dataIndex:"subject",ellipsis:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.type",defaultMessage:"模板类型"}),dataIndex:"templateType",width:120,valueEnum:V},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.status",defaultMessage:"状态"}),dataIndex:"status",width:100,valueEnum:Q},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.enabled",defaultMessage:"启用"}),dataIndex:"enabled",width:80,valueType:"switch",render:function(a,s){return s.enabled?e.formatMessage({id:"common.yes",defaultMessage:"是"}):e.formatMessage({id:"common.no",defaultMessage:"否"})},search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.template.content",defaultMessage:"模板内容"}),dataIndex:"content",ellipsis:!0,render:function(e,a){return a.content||"-"}},{title:(0,C.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",width:180,search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",width:180,search:!1},{title:(0,C.jsx)(k.FormattedMessage,{id:"action",defaultMessage:"操作"}),key:"option",dataIndex:"option",hideInSearch:!0,width:220,fixed:"right",render:function(a,s){return(0,C.jsxs)(j.Z,{children:[(0,C.jsx)(v.ZP,{type:"link",onClick:function(){return function(e){E(!0),O(e),n.setFieldsValue({name:e.name,subject:e.subject,preheader:e.preheader,content:e.content,plainText:e.plainText,contentType:e.contentType,templateType:e.templateType,status:e.status,enabled:e.enabled}),c(!0)}(s)},children:(0,C.jsx)(k.FormattedMessage,{id:"edit",defaultMessage:"编辑"})}),(0,C.jsx)(y.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除提示"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(s.name,"】?"),onConfirm:function(){return function(a){var s;x.Z.confirm({title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(a.name,"】？"),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:(s=g()(m()().mark((function s(){var t;return m()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return I.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),s.prev=1,s.next=4,B({uid:a.uid});case 4:t=s.sent,I.yw.destroy(),200===t.code?(I.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),G()):I.yw.error(t.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),s.next=13;break;case 9:s.prev=9,s.t0=s.catch(1),I.yw.destroy(),I.yw.error(e.formatMessage({id:"request.error",defaultMessage:"请求失败"}));case 13:case"end":return s.stop()}}),s,null,[[1,9]])}))),function(){return s.apply(this,arguments)})})}(s)},okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,C.jsx)(v.ZP,{type:"link",danger:!0,children:(0,C.jsx)(k.FormattedMessage,{id:"delete",defaultMessage:"删除"})})})]})}}]}),[e]),ae=function(){var a=g()(m()().mark((function a(){var t,r,i;return m()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.validateFields();case 2:if(t=a.sent,K(!0),a.prev=4,r=l()(l()({},t),{},{uid:S?null==R?void 0:R.uid:void 0,orgUid:null==s?void 0:s.uid}),!S){a.next=12;break}return a.next=9,z(r);case 9:a.t0=a.sent,a.next=15;break;case 12:return a.next=14,D(r);case 14:a.t0=a.sent;case 15:200===(i=a.t0).code?(I.yw.success(e.formatMessage({id:S?"update.success":"create.success",defaultMessage:S?"更新成功":"创建成功"})),c(!1),G()):I.yw.error(i.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"}));case 17:return a.prev=17,K(!1),a.finish(17);case 20:case"end":return a.stop()}}),a,null,[[4,,17,20]])})));return function(){return a.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(w.Z,{rowKey:"uid",actionRef:a,columns:ee,cardBordered:!0,scroll:{x:1e3},headerTitle:e.formatMessage({id:"email.template.list",defaultMessage:"邮件模板列表"}),toolBarRender:function(){return[(0,C.jsx)(v.ZP,{type:"primary",icon:(0,C.jsx)(Z.Z,{}),onClick:$,children:(0,C.jsx)(k.FormattedMessage,{id:"create",defaultMessage:"新建"})},"create"),(0,C.jsx)(v.ZP,{icon:(0,C.jsx)(b.Z,{}),onClick:G},"refresh")]},search:{labelWidth:"auto"},request:function(){var a=g()(m()().mark((function a(t){var r,n,i,o,u,c,f,g,p,M,x,h;return m()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=(n=t).current,o=n.pageSize,u=n.keyword,c=d()(n,X),f=(i||1)-1,g=o||10,p=l()({pageNumber:f,pageSize:g,orgUid:null==s?void 0:s.uid,searchText:(null==u||null===(r=u.trim)||void 0===r?void 0:r.call(u))||void 0},c),a.prev=4,a.next=7,L(p);case 7:if(200!==(M=a.sent).code){a.next=10;break}return a.abrupt("return",{data:(null===(x=M.data)||void 0===x?void 0:x.content)||[],success:!0,total:(null===(h=M.data)||void 0===h?void 0:h.totalElements)||0});case 10:return I.yw.error(M.message||e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),a.abrupt("return",{data:[],success:!1});case 14:return a.prev=14,a.t0=a.catch(4),I.yw.error(e.formatMessage({id:"request.error",defaultMessage:"请求失败"})),a.abrupt("return",{data:[],success:!1});case 18:case"end":return a.stop()}}),a,null,[[4,14]])})));return function(e){return a.apply(this,arguments)}}(),pagination:{showSizeChanger:!0},options:{fullScreen:!1,setting:!0,reload:!1}}),(0,C.jsx)(x.Z,{open:u,title:S?e.formatMessage({id:"edit",defaultMessage:"编辑"}):e.formatMessage({id:"create",defaultMessage:"新建"}),onCancel:function(){return c(!1)},onOk:ae,confirmLoading:H,destroyOnClose:!0,okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,C.jsxs)(q.Z,{form:n,layout:"vertical",preserve:!1,initialValues:{name:"",subject:"",preheader:"",content:"",plainText:"",contentType:"HTML",templateType:"TICKET_REPLY",status:"DRAFT",enabled:!0},children:[(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.name",defaultMessage:"模板名称"}),name:"name",rules:[{required:!0,message:e.formatMessage({id:"email.template.name.required",defaultMessage:"请输入模板名称"})}],children:(0,C.jsx)(N.Z,{placeholder:e.formatMessage({id:"email.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.subject",defaultMessage:"邮件主题"}),name:"subject",children:(0,C.jsx)(N.Z,{placeholder:e.formatMessage({id:"email.template.subject.placeholder",defaultMessage:"请输入邮件主题，可包含变量"})})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.preheader",defaultMessage:"预览文本"}),name:"preheader",children:(0,C.jsx)(N.Z,{placeholder:e.formatMessage({id:"email.template.preheader.placeholder",defaultMessage:"用于邮件客户端预览的简短文本"})})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.content",defaultMessage:"模板内容"}),name:"content",rules:[{required:!0,message:e.formatMessage({id:"email.template.content.required",defaultMessage:"请输入模板内容"})}],children:(0,C.jsx)(Y,{rows:6,placeholder:e.formatMessage({id:"email.template.content.placeholder",defaultMessage:"请输入模板HTML或文本内容"})})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.plainText",defaultMessage:"纯文本内容"}),name:"plainText",children:(0,C.jsx)(Y,{rows:4,placeholder:e.formatMessage({id:"email.template.plainText.placeholder",defaultMessage:"可选：纯文本版本内容"})})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.contentType",defaultMessage:"内容类型"}),name:"contentType",children:(0,C.jsx)(P.Z,{options:[{value:"HTML",label:"HTML"},{value:"MARKDOWN",label:"MARKDOWN"},{value:"TEXT",label:"TEXT"}]})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.type",defaultMessage:"模板类型"}),name:"templateType",children:(0,C.jsx)(P.Z,{options:_})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.status",defaultMessage:"状态"}),name:"status",children:(0,C.jsx)(P.Z,{options:J})}),(0,C.jsx)(q.Z.Item,{label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.enabled",defaultMessage:"启用"}),name:"enabled",valuePropName:"checked",children:(0,C.jsx)(h.Z,{})})]})})]})},J=s(59533),V=s(78578),Q=s(81739),$=s(31806),ee=s(40209),ae=s(15722),se=s(90297),te=s(59145),re=s(59304),ne=s(54881),le=s(77647);function ie(e){return de.apply(this,arguments)}function de(){return(de=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/email/message/query/org",{method:"GET",params:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return ue.apply(this,arguments)}function ue(){return ue=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/email/message/create",{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),ue.apply(this,arguments)}function ce(e){return me.apply(this,arguments)}function me(){return me=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/email/message/update",{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function fe(e){return ge.apply(this,arguments)}function ge(){return ge=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/email/message/delete",{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),ge.apply(this,arguments)}function pe(e){return Me.apply(this,arguments)}function Me(){return Me=g()(m()().mark((function e(a){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/email/message/send",{method:"POST",data:l()(l()({},a),{},{channel:O.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Me.apply(this,arguments)}var xe=s(83001),he=s(82864),je=s(34201),ve=s(79489),ye=s(62640),Ze=s(10938),be=N.Z.TextArea,we=P.Z.Option,ke=xe.Z.Title,Te=function(e){var a=e.open,s=e.onClose,r=e.onSuccess,n=(e.workgroupUid,e.replyToEmail),i=q.Z.useForm(),d=M()(i,1)[0],o=t.useState(!1),u=M()(o,2),c=u[0],f=u[1],p=(0,Ze.n)((function(e){return e.currentEmail})),x=(0,k.useIntl)(),h=!!n,y=function(){var e=g()(m()().mark((function e(a){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,e.next=4,pe(l()(l()({},a),{},{emailConfigUid:null==p?void 0:p.uid}));case 4:200===(t=e.sent).code?(I.yw.success(x.formatMessage({id:"email.message.send.success",defaultMessage:"邮件发送成功"})),d.resetFields(),s(),null==r||r()):I.yw.error(t.message||x.formatMessage({id:"email.message.send.error",defaultMessage:"邮件发送失败"})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),I.yw.error(x.formatMessage({id:"email.message.send.error",defaultMessage:"邮件发送失败"}));case 11:return e.prev=11,f(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})));return function(a){return e.apply(this,arguments)}}(),Z=function(){d.resetFields(),s()};return t.useEffect((function(){if(a&&h&&n){var e,s=null!==(e=n.subject)&&void 0!==e&&e.startsWith("Re:")?n.subject:"Re: ".concat(n.subject||""),t="\n\n".concat(x.formatMessage({id:"email.message.reply.separator",defaultMessage:"---------- 原始邮件 ----------"}),"\n").concat(x.formatMessage({id:"email.message.reply.from",defaultMessage:"发件人"}),": ").concat(n.fromName||""," <").concat(n.fromAddress||"",">\n").concat(x.formatMessage({id:"email.message.reply.sentAt",defaultMessage:"发送时间"}),": ").concat(n.emailDate?new Date(n.emailDate).toLocaleString():"","\n").concat(x.formatMessage({id:"email.message.reply.to",defaultMessage:"收件人"}),": ").concat(n.toAddresses||"","\n").concat(x.formatMessage({id:"email.message.reply.subject",defaultMessage:"主题"}),": ").concat(n.subject||"","\n\n").concat(n.contentText||"");d.setFieldsValue({subject:s,toAddresses:n.fromAddress,textContent:t})}else a&&!h&&d.resetFields()}),[a,h,n,d,x]),(0,C.jsx)(he.Z,{title:(0,C.jsxs)(j.Z,{children:[h?(0,C.jsx)(te.Z,{}):(0,C.jsx)(le.Z,{}),(0,C.jsx)(ke,{level:4,style:{margin:0},children:x.formatMessage({id:h?"email.message.drawer.replyTitle":"email.message.drawer.sendTitle",defaultMessage:h?"回复邮件":"发送邮件"})})]}),open:a,onClose:Z,width:600,extra:(0,C.jsxs)(j.Z,{children:[(0,C.jsx)(v.ZP,{onClick:Z,children:x.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,C.jsx)(v.ZP,{type:"primary",icon:h?(0,C.jsx)(te.Z,{}):(0,C.jsx)(le.Z,{}),loading:c,onClick:function(){return d.submit()},children:x.formatMessage({id:h?"email.message.action.reply":"email.message.action.send",defaultMessage:h?"回复":"发送"})})]}),children:(0,C.jsxs)(q.Z,{form:d,layout:"vertical",onFinish:y,initialValues:{priority:3,requestReceipt:!1,encoding:"UTF-8"},children:[(0,C.jsx)(q.Z.Item,{label:x.formatMessage({id:"email.message.senderEmail",defaultMessage:"发送者邮箱"}),children:(0,C.jsx)(N.Z,{value:(null==p?void 0:p.emailAddress)||x.formatMessage({id:"email.message.noEmailSelected",defaultMessage:"未选择邮箱"}),readOnly:!0,disabled:!0,style:{backgroundColor:"#f5f5f5"}})}),(0,C.jsx)(q.Z.Item,{name:"subject",label:x.formatMessage({id:"email.message.field.subject",defaultMessage:"邮件主题"}),rules:[{required:!0,message:x.formatMessage({id:"email.message.field.subject.required",defaultMessage:"请输入邮件主题"})}],children:(0,C.jsx)(N.Z,{placeholder:x.formatMessage({id:"email.message.field.subject.placeholder",defaultMessage:"请输入邮件主题"})})}),(0,C.jsx)(q.Z.Item,{name:"toAddresses",label:x.formatMessage({id:"email.message.field.to",defaultMessage:"收件人"}),rules:[{required:!0,message:x.formatMessage({id:"email.message.field.to.required",defaultMessage:"请输入收件人邮箱"})}],children:(0,C.jsx)(N.Z,{placeholder:x.formatMessage({id:"email.message.field.to.placeholder",defaultMessage:"收件人邮箱地址，多个用逗号分隔"})})}),(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"ccAddresses",label:x.formatMessage({id:"email.message.field.cc",defaultMessage:"抄送"}),children:(0,C.jsx)(N.Z,{placeholder:x.formatMessage({id:"email.message.field.cc.placeholder",defaultMessage:"抄送邮箱地址，多个用逗号分隔"})})})}),(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"bccAddresses",label:x.formatMessage({id:"email.message.field.bcc",defaultMessage:"密送"}),children:(0,C.jsx)(N.Z,{placeholder:x.formatMessage({id:"email.message.field.bcc.placeholder",defaultMessage:"密送邮箱地址，多个用逗号分隔"})})})})]}),(0,C.jsx)(ye.Z,{}),(0,C.jsx)(q.Z.Item,{name:"textContent",label:x.formatMessage({id:"email.message.field.textContent",defaultMessage:"邮件内容（文本）"}),rules:[{required:!0,message:x.formatMessage({id:"email.message.field.textContent.required",defaultMessage:"请输入邮件内容"})}],children:(0,C.jsx)(be,{rows:8,placeholder:x.formatMessage({id:"email.message.field.textContent.placeholder",defaultMessage:"请输入邮件文本内容"}),showCount:!0,maxLength:5e3})}),(0,C.jsx)(q.Z.Item,{name:"htmlContent",label:x.formatMessage({id:"email.message.field.htmlContent",defaultMessage:"邮件内容（HTML）"}),help:x.formatMessage({id:"email.message.field.htmlContent.help",defaultMessage:"可选，如果填写HTML内容，将以HTML格式发送"}),children:(0,C.jsx)(be,{rows:6,placeholder:x.formatMessage({id:"email.message.field.htmlContent.placeholder",defaultMessage:"邮件HTML内容（可选）"}),showCount:!0,maxLength:1e4})}),(0,C.jsx)(ye.Z,{}),(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"priority",label:x.formatMessage({id:"email.message.field.priority",defaultMessage:"优先级"}),children:(0,C.jsxs)(P.Z,{placeholder:x.formatMessage({id:"email.message.field.priority.placeholder",defaultMessage:"选择优先级"}),children:[(0,C.jsx)(we,{value:1,children:x.formatMessage({id:"email.message.field.priority.high",defaultMessage:"高优先级"})}),(0,C.jsx)(we,{value:3,children:x.formatMessage({id:"email.message.field.priority.normal",defaultMessage:"普通优先级"})}),(0,C.jsx)(we,{value:5,children:x.formatMessage({id:"email.message.field.priority.low",defaultMessage:"低优先级"})})]})})}),(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"requestReceipt",label:x.formatMessage({id:"email.message.field.requestReceipt",defaultMessage:"请求送达回执"}),children:(0,C.jsxs)(P.Z,{placeholder:x.formatMessage({id:"email.message.field.requestReceipt.placeholder",defaultMessage:"是否请求送达回执"}),children:[(0,C.jsx)(we,{value:!0,children:x.formatMessage({id:"common.yes",defaultMessage:"是"})}),(0,C.jsx)(we,{value:!1,children:x.formatMessage({id:"common.no",defaultMessage:"否"})})]})})})]}),(0,C.jsx)(q.Z.Item,{name:"encoding",label:x.formatMessage({id:"email.message.field.encoding",defaultMessage:"邮件编码"}),children:(0,C.jsxs)(P.Z,{placeholder:x.formatMessage({id:"email.message.field.encoding.placeholder",defaultMessage:"选择邮件编码"}),children:[(0,C.jsx)(we,{value:"UTF-8",children:"UTF-8"}),(0,C.jsx)(we,{value:"GBK",children:"GBK"}),(0,C.jsx)(we,{value:"ISO-8859-1",children:"ISO-8859-1"})]})})]})})},Ie=s(40122),Se=s(92354),Ee=function(e){var a=e.content,s=e.style,t=e.maxHeight,r=void 0===t?300:t,n=e.showBorder,i=void 0===n||n,d=e.className;if(!a||""===a.trim())return(0,C.jsx)("div",{className:d,style:l()({border:i?"1px solid #d9d9d9":"none",borderRadius:"6px",padding:"16px",minHeight:"60px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fafafa"},s),children:(0,C.jsx)(Se.Z,{description:"无内容",image:Se.Z.PRESENTED_IMAGE_SIMPLE,style:{margin:0}})});return(0,C.jsx)("div",{className:d,style:l()({border:i?"1px solid #d9d9d9":"none",borderRadius:"6px",padding:"12px",backgroundColor:"#fff",maxHeight:r,overflow:"auto"},s),children:(0,C.jsx)("div",{dangerouslySetInnerHTML:{__html:a},style:{lineHeight:1.6,fontSize:"14px",color:"#333",wordWrap:"break-word",wordBreak:"break-all"}})})},Ce=s(55785),Fe=N.Z.TextArea,Ae=P.Z.Option,Re=xe.Z.Title,Ne=xe.Z.Text,qe=function(e){var a=e.open,s=e.onClose,r=e.onSuccess,n=e.workgroupUid,i=e.editingRecord,d=e.mode,o=void 0===d?"view":d,u=q.Z.useForm(),c=M()(u,1)[0],f=t.useState(!1),p=M()(f,2),x=p[0],h=p[1],y=(0,k.useIntl)(),Z="view"===o,b="edit"===o,w="create"===o,T=t.useMemo((function(){return{SUCCESS:{color:"green",text:y.formatMessage({id:"email.message.status.success",defaultMessage:"成功"})},FAILED:{color:"red",text:y.formatMessage({id:"email.message.status.failed",defaultMessage:"失败"})},PENDING:{color:"orange",text:y.formatMessage({id:"email.message.status.pending",defaultMessage:"待发送"})},RETRY:{color:"blue",text:y.formatMessage({id:"email.message.status.retry",defaultMessage:"重试中"})},UNKNOWN:{color:"default",text:y.formatMessage({id:"email.message.status.unknown",defaultMessage:"未知"})}}}),[y]);t.useEffect((function(){a&&i?c.setFieldsValue(i):a&&w&&c.resetFields()}),[a,i,c,w]);var I,S,E=function(){var e=g()(m()().mark((function e(a){var s,t,d;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h(!0),e.prev=1,!b||!i){e.next=9;break}return e.next=5,ce(l()(l()({},a),{},{uid:i.uid,workgroupUid:n}));case 5:200===(t=e.sent).code&&J.ZP.success(y.formatMessage({id:"update.success",defaultMessage:"更新成功"})),e.next=14;break;case 9:if(!w){e.next=14;break}return e.next=12,oe(l()(l()({},a),{},{workgroupUid:n}));case 12:200===(t=e.sent).code&&J.ZP.success(y.formatMessage({id:"create.success",defaultMessage:"创建成功"}));case 14:200===(null===(s=t)||void 0===s?void 0:s.code)?(F(),null==r||r()):J.ZP.error((null===(d=t)||void 0===d?void 0:d.message)||y.formatMessage({id:"operation.failed",defaultMessage:"操作失败"})),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),J.ZP.error(y.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 20:return e.prev=20,h(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23]])})));return function(a){return e.apply(this,arguments)}}(),F=function(){c.resetFields(),s()};return(0,C.jsx)(he.Z,{title:(0,C.jsxs)(j.Z,{children:[Z?(0,C.jsx)(se.Z,{}):(0,C.jsx)(re.Z,{}),(0,C.jsx)(Re,{level:4,style:{margin:0},children:Z?y.formatMessage({id:"email.message.view.title",defaultMessage:"邮件详情"}):b?y.formatMessage({id:"email.message.edit.title",defaultMessage:"编辑邮件记录"}):w?y.formatMessage({id:"email.message.create.title",defaultMessage:"新增邮件记录"}):y.formatMessage({id:"email.message.title",defaultMessage:"邮件记录"})})]}),open:a,onClose:F,width:700,extra:(0,C.jsxs)(j.Z,{children:[(0,C.jsx)(v.ZP,{onClick:F,children:y.formatMessage({id:"cancel",defaultMessage:"取消"})}),!Z&&(0,C.jsx)(v.ZP,{type:"primary",icon:(0,C.jsx)(Ce.Z,{}),loading:x,onClick:function(){return c.submit()},children:y.formatMessage({id:"save",defaultMessage:"保存"})})]}),children:Z?(0,C.jsx)("div",{children:(0,C.jsxs)(Ie.Z,{column:1,bordered:!0,children:[(0,C.jsx)(Ie.Z.Item,{label:"邮件主题",children:(0,C.jsxs)(j.Z,{children:[(0,C.jsx)($.Z,{}),(0,C.jsx)(Ne,{strong:!0,children:(null==i?void 0:i.subject)||y.formatMessage({id:"email.message.noSubject",defaultMessage:"无主题"})})]})}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.messageId",defaultMessage:"邮件ID"}),children:(null==i?void 0:i.messageId)||"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.fromAddress",defaultMessage:"发件人"}),children:(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:(0,C.jsx)(Ne,{strong:!0,children:(null==i?void 0:i.fromName)||y.formatMessage({id:"email.message.noSenderName",defaultMessage:"未知"})})}),(0,C.jsx)(Ne,{type:"secondary",children:null==i?void 0:i.fromAddress})]})}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.to",defaultMessage:"收件人"}),children:(null==i?void 0:i.toAddresses)||"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.cc",defaultMessage:"抄送"}),children:(null==i?void 0:i.ccAddresses)||"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.bcc",defaultMessage:"密送"}),children:(null==i?void 0:i.bccAddresses)||"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.status",defaultMessage:"状态"}),children:null!=i&&i.status?(I=i.status,S=T[I]||T.UNKNOWN,(0,C.jsx)(Q.Z,{color:S.color,children:S.text})):"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.importance",defaultMessage:"重要性"}),children:null!=i&&i.important?(0,C.jsx)(Q.Z,{color:"red",children:y.formatMessage({id:"email.message.field.importance.high",defaultMessage:"重要"})}):(0,C.jsx)(Q.Z,{children:y.formatMessage({id:"email.message.field.importance.normal",defaultMessage:"普通"})})}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.hasAttachments",defaultMessage:"是否有附件"}),children:null!=i&&i.hasAttachments?(0,C.jsx)(Q.Z,{color:"blue",children:y.formatMessage({id:"email.message.field.hasAttachments.yes",defaultMessage:"有附件"})}):(0,C.jsx)(Q.Z,{children:y.formatMessage({id:"email.message.field.hasAttachments.no",defaultMessage:"无附件"})})}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.emailDate",defaultMessage:"邮件时间"}),children:null!=i&&i.emailDate?new Date(i.emailDate).toLocaleString():"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.emailSize",defaultMessage:"邮件大小"}),children:null!=i&&i.emailSize?"".concat((i.emailSize/1024).toFixed(1),"KB"):"-"}),(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.textContent",defaultMessage:"邮件内容（文本）"}),children:(0,C.jsx)("div",{style:{maxHeight:"200px",overflow:"auto",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5",padding:"8px",borderRadius:"4px"},children:(null==i?void 0:i.contentText)||y.formatMessage({id:"email.message.field.textContent.empty",defaultMessage:"无内容"})})}),(null==i?void 0:i.contentHtml)&&(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.htmlContent",defaultMessage:"邮件内容（HTML）"}),children:(0,C.jsx)(Ee,{content:i.contentHtml,maxHeight:300,style:{backgroundColor:"#f5f5f5"}})}),(null==i?void 0:i.errorMessage)&&(0,C.jsx)(Ie.Z.Item,{label:y.formatMessage({id:"email.message.field.errorMessage",defaultMessage:"错误信息"}),children:(0,C.jsx)(Ne,{type:"danger",children:i.errorMessage})})]})}):(0,C.jsxs)(q.Z,{form:c,layout:"vertical",onFinish:E,children:[(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"subject",label:y.formatMessage({id:"email.message.field.subject",defaultMessage:"邮件主题"}),rules:[{required:!0,message:y.formatMessage({id:"email.message.field.subject.required",defaultMessage:"请输入邮件主题"})}],children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.subject.placeholder",defaultMessage:"请输入邮件主题"})})})}),(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"messageId",label:y.formatMessage({id:"email.message.field.messageId",defaultMessage:"邮件ID"}),children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.messageId.placeholder",defaultMessage:"邮件唯一标识符"})})})})]}),(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"fromAddress",label:y.formatMessage({id:"email.message.field.fromAddress",defaultMessage:"发件人邮箱"}),rules:[{required:!0,message:y.formatMessage({id:"email.message.field.fromAddress.required",defaultMessage:"请输入发件人邮箱"})},{type:"email",message:y.formatMessage({id:"email.message.field.fromAddress.invalid",defaultMessage:"请输入有效的邮箱地址"})}],children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.fromAddress.placeholder",defaultMessage:"发件人邮箱地址"})})})}),(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"fromName",label:y.formatMessage({id:"email.message.field.fromName",defaultMessage:"发件人姓名"}),children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.fromName.placeholder",defaultMessage:"发件人姓名"})})})})]}),(0,C.jsx)(q.Z.Item,{name:"toAddresses",label:y.formatMessage({id:"email.message.field.to",defaultMessage:"收件人"}),rules:[{required:!0,message:y.formatMessage({id:"email.message.field.to.required",defaultMessage:"请输入收件人邮箱"})}],children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.to.placeholder",defaultMessage:"收件人邮箱地址，多个用逗号分隔"})})}),(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"ccAddresses",label:y.formatMessage({id:"email.message.field.cc",defaultMessage:"抄送"}),children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.cc.placeholder",defaultMessage:"抄送邮箱地址，多个用逗号分隔"})})})}),(0,C.jsx)(ve.Z,{span:12,children:(0,C.jsx)(q.Z.Item,{name:"bccAddresses",label:y.formatMessage({id:"email.message.field.bcc",defaultMessage:"密送"}),children:(0,C.jsx)(N.Z,{placeholder:y.formatMessage({id:"email.message.field.bcc.placeholder",defaultMessage:"密送邮箱地址，多个用逗号分隔"})})})})]}),(0,C.jsx)(ye.Z,{}),(0,C.jsx)(q.Z.Item,{name:"contentText",label:y.formatMessage({id:"email.message.field.textContent",defaultMessage:"邮件内容（文本）"}),children:(0,C.jsx)(Fe,{rows:6,placeholder:y.formatMessage({id:"email.message.field.textContent.placeholder",defaultMessage:"邮件文本内容"}),showCount:!0,maxLength:5e3})}),(0,C.jsx)(q.Z.Item,{name:"contentHtml",label:y.formatMessage({id:"email.message.field.htmlContent",defaultMessage:"邮件内容（HTML）"}),children:(0,C.jsx)(Fe,{rows:4,placeholder:y.formatMessage({id:"email.message.field.htmlContent.placeholder",defaultMessage:"邮件HTML内容"}),showCount:!0,maxLength:1e4})}),(0,C.jsx)(ye.Z,{}),(0,C.jsxs)(je.Z,{gutter:16,children:[(0,C.jsx)(ve.Z,{span:8,children:(0,C.jsx)(q.Z.Item,{name:"status",label:y.formatMessage({id:"email.message.status",defaultMessage:"状态"}),children:(0,C.jsxs)(P.Z,{placeholder:y.formatMessage({id:"email.message.field.status.placeholder",defaultMessage:"选择状态"}),children:[(0,C.jsx)(Ae,{value:"SUCCESS",children:T.SUCCESS.text}),(0,C.jsx)(Ae,{value:"FAILED",children:T.FAILED.text}),(0,C.jsx)(Ae,{value:"PENDING",children:T.PENDING.text}),(0,C.jsx)(Ae,{value:"RETRY",children:T.RETRY.text})]})})}),(0,C.jsx)(ve.Z,{span:8,children:(0,C.jsx)(q.Z.Item,{name:"important",label:y.formatMessage({id:"email.message.field.importance",defaultMessage:"重要性"}),children:(0,C.jsxs)(P.Z,{placeholder:y.formatMessage({id:"email.message.field.importance.placeholder",defaultMessage:"选择重要性"}),children:[(0,C.jsx)(Ae,{value:!0,children:y.formatMessage({id:"email.message.field.importance.high",defaultMessage:"重要"})}),(0,C.jsx)(Ae,{value:!1,children:y.formatMessage({id:"email.message.field.importance.normal",defaultMessage:"普通"})})]})})}),(0,C.jsx)(ve.Z,{span:8,children:(0,C.jsx)(q.Z.Item,{name:"hasAttachments",label:y.formatMessage({id:"email.message.field.hasAttachments",defaultMessage:"是否有附件"}),children:(0,C.jsxs)(P.Z,{placeholder:y.formatMessage({id:"email.message.field.hasAttachments.placeholder",defaultMessage:"是否有附件"}),children:[(0,C.jsx)(Ae,{value:!0,children:y.formatMessage({id:"email.message.field.hasAttachments.yes",defaultMessage:"有附件"})}),(0,C.jsx)(Ae,{value:!1,children:y.formatMessage({id:"email.message.field.hasAttachments.no",defaultMessage:"无附件"})})]})})})]}),(0,C.jsx)(q.Z.Item,{name:"errorMessage",label:y.formatMessage({id:"email.message.field.errorMessage",defaultMessage:"错误信息"}),children:(0,C.jsx)(Fe,{rows:2,placeholder:y.formatMessage({id:"email.message.field.errorMessage.placeholder",defaultMessage:"错误信息"})})})]})})},Pe=["current","pageSize","keyword"],Oe=xe.Z.Text,We=function(e){var a=e.workgroupUid,s=(0,k.useIntl)(),r=(0,t.useRef)(),n=(0,t.useState)(!1),i=M()(n,2),o=i[0],u=i[1],c=(0,t.useState)("view"),f=M()(c,2),p=f[0],x=f[1],h=(0,t.useState)(!1),Z=M()(h,2),I=Z[0],S=Z[1],E=(0,t.useState)(null),F=M()(E,2),A=F[0],R=F[1],N=(0,t.useState)(null),q=M()(N,2),P=q[0],O=q[1],W=(0,T.u)((function(e){return e.currentOrg})),L=(0,Ze.n)((function(e){return e.currentEmail})),U=(0,t.useMemo)((function(){return{SENT:{color:"blue",text:s.formatMessage({id:"email.message.type.sent",defaultMessage:"发送"})},RECEIVED:{color:"green",text:s.formatMessage({id:"email.message.type.received",defaultMessage:"接收"})},DRAFT:{color:"orange",text:s.formatMessage({id:"email.message.type.draft",defaultMessage:"草稿"})},REPLY:{color:"purple",text:s.formatMessage({id:"email.message.type.reply",defaultMessage:"回复"})},FORWARD:{color:"cyan",text:s.formatMessage({id:"email.message.type.forward",defaultMessage:"转发"})},UNKNOWN:{color:"default",text:s.formatMessage({id:"email.message.type.unknown",defaultMessage:"未知"})}}}),[s]),D=(0,t.useMemo)((function(){return{SUCCESS:{color:"green",text:s.formatMessage({id:"email.message.status.success",defaultMessage:"成功"})},FAILED:{color:"red",text:s.formatMessage({id:"email.message.status.failed",defaultMessage:"失败"})},PENDING:{color:"orange",text:s.formatMessage({id:"email.message.status.pending",defaultMessage:"待发送"})},RETRY:{color:"blue",text:s.formatMessage({id:"email.message.status.retry",defaultMessage:"重试中"})},UNKNOWN:{color:"default",text:s.formatMessage({id:"email.message.status.unknown",defaultMessage:"未知"})}}}),[s]),H=function(){R(null),S(!0)},z=function(){var e=g()(m()().mark((function e(a){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe({uid:a.uid});case 3:200===e.sent.code&&(J.ZP.success(s.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),null===(t=r.current)||void 0===t||t.reload()),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),J.ZP.error(s.formatMessage({id:"delete.error",defaultMessage:"删除失败"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(a){return e.apply(this,arguments)}}(),K=[{dataIndex:"index",valueType:"indexBorder",width:56,align:"center"},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.subject",defaultMessage:"主题"}),dataIndex:"subject",key:"subject",fixed:"left",width:260,ellipsis:!0,render:function(e,a){return(0,C.jsxs)(j.Z,{children:[(0,C.jsx)($.Z,{}),(0,C.jsx)(V.Z,{title:e,children:(0,C.jsx)(Oe,{strong:!a.read,children:e||s.formatMessage({id:"email.message.noSubject",defaultMessage:"无主题"})})}),a.hasAttachments&&(0,C.jsx)(ee.Z,{})]})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.type",defaultMessage:"类型"}),dataIndex:"type",key:"type",width:100,render:function(e){var a=U[e]||U.UNKNOWN;return(0,C.jsx)(Q.Z,{color:a.color,children:a.text})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.from",defaultMessage:"发件人"}),dataIndex:"fromAddress",key:"fromAddress",width:200,render:function(e,a){return(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:a.fromName||s.formatMessage({id:"email.message.noSenderName",defaultMessage:"未知"})}),(0,C.jsx)(Oe,{type:"secondary",style:{fontSize:"12px"},children:e})]})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.to",defaultMessage:"收件人"}),dataIndex:"toAddresses",key:"toAddresses",ellipsis:!0,width:200,render:function(e){return(0,C.jsx)(V.Z,{title:e,children:(0,C.jsx)(Oe,{children:e})})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.cc",defaultMessage:"抄送"}),dataIndex:"ccAddresses",key:"ccAddresses",ellipsis:!0,width:200,render:function(e){return(0,C.jsx)(V.Z,{title:e,children:(0,C.jsx)(Oe,{children:e||"-"})})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.status",defaultMessage:"状态"}),dataIndex:"status",key:"status",width:100,render:function(e){var a=D[e]||D.UNKNOWN;return(0,C.jsx)(Q.Z,{color:a.color,children:a.text})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.important",defaultMessage:"重要性"}),dataIndex:"important",key:"important",width:80,render:function(e){return e?(0,C.jsx)(ae.Z,{style:{color:"red"}}):null}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.date",defaultMessage:"时间"}),dataIndex:"emailDate",key:"emailDate",valueType:"dateTime",width:180},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.size",defaultMessage:"大小"}),dataIndex:"emailSize",key:"emailSize",width:100,render:function(e){return e?"".concat((e/1024).toFixed(1),"KB"):"-"}},{title:(0,C.jsx)(k.FormattedMessage,{id:"email.message.preview",defaultMessage:"内容预览"}),dataIndex:"contentText",key:"contentText",width:300,ellipsis:!0,render:function(e,a){return(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{style:{marginBottom:"4px"},children:(0,C.jsx)(Q.Z,{color:"default",style:{fontSize:"10px",padding:"0 4px"},children:"TEXT"})}),(0,C.jsx)(V.Z,{title:e,children:(0,C.jsx)(Oe,{type:"secondary",style:{fontSize:"12px"},children:(null==e?void 0:e.substring(0,50))||"-"})})]})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"action",defaultMessage:"操作"}),key:"action",dataIndex:"option",fixed:"right",width:220,hideInSearch:!0,render:function(e,a){return(0,C.jsxs)(j.Z,{size:"small",children:[(0,C.jsx)(V.Z,{title:s.formatMessage({id:"email.message.action.view",defaultMessage:"查看"}),children:(0,C.jsx)(v.ZP,{type:"text",icon:(0,C.jsx)(se.Z,{}),onClick:function(){O(a),x("view"),u(!0)}})}),(0,C.jsx)(V.Z,{title:s.formatMessage({id:"email.message.action.reply",defaultMessage:"回复"}),children:(0,C.jsx)(v.ZP,{type:"text",icon:(0,C.jsx)(te.Z,{}),onClick:function(){return function(e){R(e),S(!0)}(a)}})}),(0,C.jsx)(V.Z,{title:s.formatMessage({id:"email.message.action.edit",defaultMessage:"编辑"}),children:(0,C.jsx)(v.ZP,{type:"text",icon:(0,C.jsx)(re.Z,{}),onClick:function(){O(a),x("edit"),u(!0)}})}),(0,C.jsx)(y.Z,{title:s.formatMessage({id:"email.message.delete.confirm",defaultMessage:"确定删除这条邮件记录吗？"}),onConfirm:function(){return z(a)},okText:s.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,C.jsx)(v.ZP,{type:"text",danger:!0,icon:(0,C.jsx)(ne.Z,{})})})]})}}];return(0,t.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.reload()}),[a,null==W?void 0:W.uid,null==L?void 0:L.emailAddress]),(0,C.jsxs)("div",{children:[(0,C.jsx)(w.Z,{rowKey:"uid",actionRef:r,columns:K,cardBordered:!0,scroll:{x:1800},headerTitle:(0,C.jsxs)("span",{children:[(0,C.jsx)($.Z,{})," ",s.formatMessage({id:"email.message.title",defaultMessage:"邮件消息管理"})]}),toolBarRender:function(){return[(0,C.jsx)(v.ZP,{type:"primary",icon:(0,C.jsx)(le.Z,{}),onClick:H,children:(0,C.jsx)(k.FormattedMessage,{id:"email.message.send",defaultMessage:"发送邮件"})},"create"),(0,C.jsx)(v.ZP,{icon:(0,C.jsx)(b.Z,{}),onClick:function(){var e;return null===(e=r.current)||void 0===e?void 0:e.reload()}},"refresh")]},search:{labelWidth:"auto"},request:function(){var e=g()(m()().mark((function e(a){var t,r,n,i,o,u,c,f,g,p,M,x;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=a).current,i=r.pageSize,o=r.keyword,u=d()(r,Pe),c=(n||1)-1,f=i||10,g=l()({pageNumber:c,pageSize:f,emailAddress:(null==L?void 0:L.emailAddress)||"",orgUid:null==W?void 0:W.uid,searchText:(null==o||null===(t=o.trim)||void 0===t?void 0:t.call(o))||void 0},u||{}),e.prev=4,e.next=7,ie(g);case 7:if(200!==(p=e.sent).code){e.next=10;break}return e.abrupt("return",{data:(null===(M=p.data)||void 0===M?void 0:M.content)||[],success:!0,total:(null===(x=p.data)||void 0===x?void 0:x.totalElements)||0});case 10:return J.ZP.error(p.message||s.formatMessage({id:"request.error",defaultMessage:"请求失败"})),e.abrupt("return",{data:[],success:!1});case 14:return e.prev=14,e.t0=e.catch(4),J.ZP.error(s.formatMessage({id:"request.error",defaultMessage:"请求失败"})),e.abrupt("return",{data:[],success:!1});case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(a){return e.apply(this,arguments)}}(),pagination:{showSizeChanger:!0},options:{fullScreen:!1,setting:!0,reload:!1}}),(0,C.jsx)(qe,{open:o,onClose:function(){u(!1),O(null)},onSuccess:function(){var e;null===(e=r.current)||void 0===e||e.reload()},workgroupUid:a,editingRecord:P,mode:p}),(0,C.jsx)(Te,{open:I,onClose:function(){S(!1),R(null)},onSuccess:function(){var e;null===(e=r.current)||void 0===e||e.reload()},workgroupUid:a,replyToEmail:A})]})},Le=function(){return(0,C.jsx)(r.Z,{defaultActiveKey:"table",items:[{key:"table",label:(0,C.jsx)(k.FormattedMessage,{id:"email.app.tab",defaultMessage:"邮箱应用"}),children:(0,C.jsx)(R,{})},{key:"message",label:(0,C.jsx)(k.FormattedMessage,{id:"email.message.tab",defaultMessage:"邮件消息"}),children:(0,C.jsx)(We,{})},{key:"template",label:(0,C.jsx)(k.FormattedMessage,{id:"email.template.tab",defaultMessage:"邮件模板"}),children:(0,C.jsx)(_,{})}]})}},24388:function(e,a,s){s.d(a,{$:function(){return c}});var t=s(73193),r=s.n(t),n=s(76711),l=s.n(n),i=s(39497),d=s(58063),o=s(66266),u=s(31403),c=(0,d.Ue)()((0,o.mW)((0,o.tJ)((0,u.n)((function(e,a){return{workgroupResult:{data:{content:[]}},currentWorkgroup:{uid:"",nickname:"",avatar:"",description:"",orgUid:""},insertWorkgroup:function(a){e((function(e){e.workgroupResult.data.content.unshift(a)}))},updateWorkgroup:function(a){e((function(e){var s=e.workgroupResult.data.content,t=s.findIndex((function(e){return e.uid===a.uid}));-1!==t?s[t]=a:console.warn("Workgroup with uid ".concat(a.uid," not found."))}))},deleteWorkgroup:function(a){e((function(e){var s=e.workgroupResult.data.content,t=s.findIndex((function(e){return e.uid===a.uid}));-1!==t?s.splice(t,1):console.warn("Workgroup with uid ".concat(a.uid," not found."))}))},setWorkgroupResult:function(s){var t;(e({workgroupResult:s}),""===a().currentWorkgroup.uid)&&((null===(t=s.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentWorkgroup:s.data.content[0]}))},setCurrentWorkgroup:function(s){var t=a().workgroupResult.data.content,n=t.findIndex((function(e){return e.uid===s.uid}));if(-1!==n){var i=[].concat(l()(t.slice(0,n)),[s],l()(t.slice(n+1))),d=r()(r()({},a().workgroupResult),{},{data:{content:i}});e({workgroupResult:d,currentWorkgroup:s})}else console.warn("Workgroup with the specified uid not found."),e({currentWorkgroup:s})},deleteCurrentWorkgroup:function(s){var t=a().workgroupResult.data.content,n=t.findIndex((function(e){return e.uid===s}));-1!==n?e({workgroupResult:r()(r()({},a().workgroupResult),{},{data:{content:[].concat(l()(t.slice(0,n)),l()(t.slice(n+1)))}})}):console.warn("Workgroup not found in cache:",s),a().currentWorkgroup.uid===s&&e({currentWorkgroup:{uid:"",orgUid:""}})},deleteWorkgroupCache:function(){return e({},!0)}}})),{name:i.b6l})))}}]);