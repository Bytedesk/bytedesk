"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4955],{54008:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return v},t5:function(){return b},v_:function(){return p}});var r=t(90819),a=t.n(r),o=t(73193),s=t.n(o),l=t(89933),i=t.n(l),u=t(68992),c=t(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:s()(s()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:s()(s()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:s()(s()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:s()(s()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},65041:function(e,n,t){t.d(n,{G:function(){return p}});var r=t(73193),a=t.n(r),o=(t(44194),t(2348)),s=t(68992),l=t(45634),i=t.n(l),u=t(46130),c=t(61489),d=t(87005),f=t(31549),p=function(e){var n=e.children,t=e.onSuccess,r=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:s.IrL,categoryUid:"",kbUid:"",channel:s.XtJ},p={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var n=i()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=n,l.fileType=e.type,u.Z.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var n=e.file.response.data.fileUrl;t(n),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(o.Z,a()(a()({},p),{},{children:n}))}},38552:function(e,n,t){var r=t(70097);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},67190:function(e,n,t){t.d(n,{Z:function(){return B}});var r=t(90819),a=t.n(r),o=t(76711),s=t.n(o),l=t(73193),i=t.n(l),u=t(89933),c=t.n(u),d=t(45332),f=t.n(d),p=t(66248),g=t(11853),b=t(72264),m=t(6237),v=t(13243),h=t(60593),k=t(44194),x=t(10154),y=t.n(x),w=t(61489),K=t(99754),Z=t(77686),j=t(68992),S=t(89007),M=t(47268),C=t(50447),P=t(26608),F=t(70878),H=t(27401),U=t(22014),R=t(65041),T=t(41558),E=t(87005),V=t(31549),L=function(e){var n=e.open,t=e.isEdit,r=e.type,o=e.kbase,s=e.onCancel,l=e.onSubmit,u=S.A.useForm(),d=f()(u,1)[0],g=(0,K.Z)().translateString,m=(0,Z.u)((function(e){return e.currentOrg})),v=(0,k.useRef)(null),h=(0,k.useState)((0,E.kG)()+"/avatars/workflow.png"),x=f()(h,2),L=x[0],q=x[1],A=(0,k.useState)([]),I=f()(A,2),O=I[0],D=(I[1],(0,k.useState)({})),_=f()(D,2),J=_[0],N=_[1],z=(0,k.useState)(!1),X=f()(z,2),G=X[0],Y=X[1],B="ollama",Q="bge-m3:latest",W=(0,k.useState)((null==o?void 0:o.embeddingProvider)||B),$=f()(W,2),ee=$[0],ne=$[1],te=(0,k.useState)((null==o?void 0:o.embeddingModel)||Q),re=f()(te,2),ae=re[0],oe=re[1],se=(0,k.useState)(""),le=f()(se,2),ie=le[0],ue=le[1];(0,k.useEffect)((function(){t?(d.setFieldsValue({name:g(null==o?void 0:o.name)}),d.setFieldsValue({headline:g(null==o?void 0:o.headline)}),d.setFieldsValue({footerHtml:g(null==o?void 0:o.footerHtml)}),d.setFieldsValue({descriptionHtml:g(null==o?void 0:o.descriptionHtml)}),d.setFieldsValue({language:null==o?void 0:o.language}),d.setFieldsValue({logoUrl:null==o?void 0:o.logoUrl}),q((null==o?void 0:o.logoUrl)||""),null!=o&&o.embeddingProvider&&(ne(o.embeddingProvider),d.setFieldsValue({embeddingProvider:o.embeddingProvider})),null!=o&&o.embeddingModel&&(oe(o.embeddingModel),d.setFieldsValue({embeddingModel:o.embeddingModel}))):(d.resetFields(),d.setFieldsValue({language:"ZH_CN"}),d.setFieldsValue({logoUrl:L}),d.setFieldsValue({embeddingProvider:B,embeddingModel:Q})),n&&setTimeout((function(){var e;null===(e=v.current)||void 0===e||e.focus()}),100)}),[n,t,o]),(0,k.useEffect)((function(){if(ee&&ae&&J[ee]){var e=J[ee].find((function(e){return e.value===ae}));e&&ue(e.label)}}),[J,ee,ae]);var ce=(0,k.useCallback)((function(){Y(!1)}),[]),de=(0,k.useCallback)((function(e,n,t){ne(e),oe(n),ue(t),d.setFieldValue("embeddingProvider",e),d.setFieldValue("embeddingModel",n),Y(!1)}),[d]),fe=(0,k.useCallback)((function(e,n){N((function(t){return i()(i()({},t),{},y()({},e,n))}))}),[]),pe=function(){d.validateFields().then(function(){var e=c()(a()().mark((function e(n){var s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("KbaseForm handleSubmit:",n),s={uid:t?null==o?void 0:o.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:r,language:n.language,embeddingProvider:n.embeddingProvider||B,embeddingModel:n.embeddingModel||Q,logoUrl:n.logoUrl||L,orgUid:null==m?void 0:m.uid},l(s);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),w.yw.error("创建知识库失败")}))},ge=function(e){"Enter"===e.key&&pe()};return(0,V.jsxs)("div",{children:[(0,V.jsx)(p.Z,{title:"新建知识库",open:n,forceRender:!0,onOk:pe,onCancel:s,children:(0,V.jsxs)(S.A,{form:d,submitter:!1,children:[(0,V.jsx)(F.Z.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:"Logo",children:(0,V.jsxs)(R.G,{onSuccess:function(e){q(e),d.setFieldValue("logoUrl",e)},onError:function(e){console.log("logo upload error:",e)},children:[(0,V.jsx)(H.Z,{src:L}),(0,V.jsx)(b.ZP,{icon:(0,V.jsx)(U.Z,{}),children:"上传"})]})}),(0,V.jsx)(M.Z,{name:"logoUrl",hidden:!0}),(0,V.jsx)(C.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,V.jsx)(M.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:ge,placeholder:"请输入名称",ref:v}}),r===j.VX&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(M.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:ge,placeholder:"请输入名称"}}),(0,V.jsx)(P.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,V.jsx)(P.Z,{label:"描述",name:"descriptionHtml"})]})}),r===j.QPQ&&(0,V.jsx)(T.Z,{visible:G,onCancel:ce,onOk:de,initialProvider:ee,initialModel:ae,initialModelLabel:ie,providers:O,currentOrgUid:null==m?void 0:m.uid,existingProviderModels:J,onModelsLoaded:fe,allowedModelTypes:[j.xTq]})]})},q=t(54008),A=t(49840),I=t(70097),O=t(62395),D=t(83381),_=t(90092),J=t(35911),N=t(41881),z=t(91768),X=t(80503),G=t(12715),Y=p.Z.confirm,B=function(e){var n=e.type,t=(0,O.useIntl)(),r=(0,k.useState)(!1),o=f()(r,2),l=o[0],u=o[1],d=(0,k.useRef)(!1),p=(0,k.useState)(!0),x=f()(p,2),y=x[0],S=x[1],M=(0,k.useState)(0),C=f()(M,2),P=C[0],F=C[1],H=(0,k.useState)(!1),U=f()(H,2),R=U[0],T=U[1],E=(0,k.useState)(""),B=f()(E,2),Q=B[0],W=B[1],$=(0,I.Z)().isDarkMode,ee=(0,K.Z)().translateString,ne=(0,Z.u)((function(e){return e.currentOrg})),te=(0,k.useState)(!0),re=f()(te,2),ae=re[0],oe=re[1],se=(0,A.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),le=se.kbaseResult,ie=se.currentKbase,ue=se.insertKbase,ce=se.updateLocalKbase,de=se.setKbaseResult,fe=se.setCurrentKbase,pe=se.removeKbase,ge=(0,k.useCallback)(c()(a()().mark((function e(){var t,r,o,c,f,p,g,b,m,v,h,k,x=arguments;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.length>0&&void 0!==x[0]?x[0]:0,r=x.length>1&&void 0!==x[1]&&x[1],!l&&!d.current){e.next=4;break}return e.abrupt("return");case 4:return d.current=!0,u(!0),o={pageNumber:t,pageSize:20,type:n,orgUid:null==ne?void 0:ne.uid,searchText:Q},e.prev=7,e.next=10,(0,q.AP)(o);case 10:c=e.sent,console.log("queryKbasesByOrg: ",c),200===c.code?(b=(null==c||null===(f=c.data)||void 0===f?void 0:f.content)||[],m=null!==(p=null==c||null===(g=c.data)||void 0===g?void 0:g.last)&&void 0!==p?p:0===b.length,S(!m),F(t),r?(h=(null==le||null===(v=le.data)||void 0===v?void 0:v.content)||[],k=i()(i()({},c),{},{data:i()(i()({},c.data),{},{content:[].concat(s()(h),s()(b))})}),de(k)):de(c)):w.yw.error(c.message);case 13:return e.prev=13,d.current=!1,u(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[7,,13,17]])}))),[l,Q,n,null==ne?void 0:ne.uid,le,de]);(0,k.useEffect)((function(){console.log("useEffect: getKbase"),F(0),S(!0),ge(0,!1)}),[Q,n,null==ne?void 0:ne.uid]);var be=function(){var e=c()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",w.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,q.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(ue(r.data),fe(r.data),w.yw.success({content:"创建成功！",key:t,duration:2}),T(!1)):(console.log("create kb failed",r),w.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=c()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",w.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,q.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(ce(r.data),fe(r.data),w.yw.success({content:"更新成功！",key:t,duration:2}),T(!1)):(console.log("update kb failed",r),w.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ve=function(){var e=c()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",ie),oe(!0),T(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=c()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae?me(n):be(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ke=function(){var e=c()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==le.data.content.length){e.next=4;break}return w.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,q._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(pe(n.uid),ge()):(console.log("handleDeleteKbase: ",r),w.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=function(e){var t=function(e){return n!==j._FS?ee(e.descriptionHtml):e.level===j.Hxq?"全平台客服可见":e.level===j.whQ?"本组织客服可见":e.level===j.fyH?"本客服可见":ee(e.descriptionHtml)}(e);return t};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(g.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,V.jsxs)(g.Z,{gap:"small",children:[(0,V.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,V.jsx)(_.Z,{}),onClick:function(){console.log("new kb"),oe(!1),T(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,V.jsx)(b.ZP,{size:"small",icon:(0,V.jsx)(J.Z,{spin:l}),onClick:function(){F(0),S(!0),ge(0,!1)},loading:l,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==ie?void 0:ie.uid)&&(0,V.jsx)(m.Z,{menu:{items:[{key:"edit",icon:(0,V.jsx)(N.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ve},{key:"delete",icon:(0,V.jsx)(z.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){Y({title:t.formatMessage({id:"deleteTip"}),icon:(0,V.jsx)(D.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ee(e.name),"】？"),onOk:function(){ke(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(ie)}}]},children:(0,V.jsx)(b.ZP,{size:"small",icon:(0,V.jsx)(X.Z,{})})})]}),(0,V.jsx)("div",{style:{padding:"0 10px 10px 10px"},children:(0,V.jsx)(v.Z.Search,{placeholder:t.formatMessage({id:"kbase.search.placeholder",defaultMessage:"搜索知识库名称"}),value:Q,onChange:function(e){return W(e.target.value)},onSearch:function(e){console.log("搜索内容:",e)},enterButton:(0,V.jsx)(G.Z,{}),allowClear:!0,style:{width:"100%"}})}),(0,V.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 200px)"},onScroll:function(e){var n=e.currentTarget,t=n.scrollTop;n.scrollHeight-t-n.clientHeight<50&&y&&!l&&ge(P+1,!0)},children:(0,V.jsx)(h.Z,{itemLayout:"horizontal",dataSource:le.data.content,renderItem:function(e,n){return(0,V.jsx)(h.Z.Item,{style:ie.uid===e.uid?{backgroundColor:$?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){fe(e)},children:(0,V.jsx)(h.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:e.logoUrl?(0,V.jsx)("img",{src:e.logoUrl,alt:"logo",style:{width:40,height:40,borderRadius:"50%",objectFit:"cover"}}):void 0,title:ee(e.name),description:xe(e)})})}})}),R&&(0,V.jsx)(L,{open:R,isEdit:ae,type:n,kbase:ie,onSubmit:he,onCancel:function(){T(!1)}})]})}},49840:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),o=t(76711),s=t.n(o),l=t(68992),i=t(58063),u=t(66266),c=t(31403),d=(0,i.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==o){var l=[].concat(s()(r.slice(0,o)),[t],s()(r.slice(o+1))),i=a()(a()({},n().kbaseResult),{},{data:{content:l}});e({kbaseResult:i,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t}));-1!==o?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(s()(r.slice(0,o)),s()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:l.wKE})))}}]);