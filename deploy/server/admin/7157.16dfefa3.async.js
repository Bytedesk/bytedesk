"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7157],{43321:function(e,t,n){var a=n(94433),r=n(38956),s=n(44194),i=n(85973),u=n(31549),o=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,d=e.proFieldProps,c=(0,r.Z)(e,o);return(0,u.jsx)(i.Z,(0,a.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(l);t.Z=d},29341:function(e,t,n){n.d(t,{Lr:function(){return h},_t:function(){return c},sE:function(){return p},x_:function(){return g}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(36265),d=n(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77646:function(e,t,n){n.d(t,{IH:function(){return g},RB:function(){return M},SJ:function(){return h},Xy:function(){return y},iO:function(){return k},u9:function(){return c},wU:function(){return p}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(36265),d=n(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/enable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return w.apply(this,arguments)}function w(){return(w=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/disable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return S.apply(this,arguments)}function S(){return(S=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},37592:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return h},hS:function(){return p},z_:function(){return c}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(36265),d=n(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},59878:function(e,t,n){n.d(t,{G:function(){return g}});var a=n(73193),r=n.n(a),s=(n(44194),n(41770)),i=n(36265),u=n(96596),o=n.n(u),l=n(42539),d=n(5286),c=n(87523),f=n(31549),g=function(e){var t=e.children,n=e.onSuccess,a=e.onError,u={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:u,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var t=o()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return u.file=e,u.fileName=t,u.fileType=e.type,l.Z.log("beforeUpload",u),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var t,r=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(r),d.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,f.jsx)(s.Z,r()(r()({},g),{},{children:t}))}},76071:function(e,t,n){var a=n(74494);t.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},29837:function(e,t,n){var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(45332),d=n.n(l),c=n(44194),f=n(63642),g=n(25709),m=n(33122),p=n(95111),v=n(5861),h=n(5286),b=n(77646),M=n(31549);t.Z=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,s=e.record,u=e.onSuccess,l=(0,v.useIntl)(),x=f.Z.useForm(),k=d()(x,1)[0];(0,c.useEffect)((function(){var e,n;t&&(s?k.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(k.resetFields(),k.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,k]);var w=function(){var e=o()(r()().mark((function e(){var t,o,d,c;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.validateFields();case 3:if(t=e.sent,o=i()(i()({},t),{},{orgUid:a,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,b.wU)(o);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,b.IH)(o);case 13:e.t0=e.sent;case 14:(d=e.t0)&&200===d.code?(c=(null==d?void 0:d.data)||{},h.yw.success(l.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==u||u(c),n(!1)):h.yw.error((null==d?void 0:d.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,M.jsx)(g.Z,{title:(0,M.jsx)(v.FormattedMessage,{id:null!=s&&s.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:w,onCancel:function(){n(!1)},okText:(0,M.jsx)(v.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,M.jsx)(v.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,M.jsxs)(f.Z,{form:k,layout:"vertical",preserve:!1,children:[(0,M.jsx)(f.Z.Item,{name:"name",label:(0,M.jsx)(v.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,M.jsx)(m.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,M.jsx)(f.Z.Item,{name:"description",label:(0,M.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(m.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,M.jsx)(f.Z.Item,{name:"enabled",label:(0,M.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,M.jsx)(p.Z,{})})]})})}},68293:function(e,t,n){n.d(t,{Z:function(){return $}});var a=n(86222),r=n.n(a),s=n(73193),i=n.n(s),u=n(90819),o=n.n(u),l=n(89933),d=n.n(l),c=n(45332),f=n.n(c),g=n(44194),m=n(5861),p=n(31362),v=n(44423),h=n(96082),b=n(44877),M=n(2157),x=n(5286),k=n(29341),w=n(71865),y=n(36265),S=n(76711),j=n.n(S),Z=n(99279),U=n(40845),C=n(2685),q=n(44565),T=n(60857),I=n(76185),F=n(15384),O=n(6992),P=n(22014),A=n(37592),D=n(77646),E=n(29837),R=n(59878),z=n(31549),J=function(e){var t=e.value,n=e.onChange,a=e.options,r=e.loading,s=e.placeholder,i=e.emptyContent,u=e.onSearch,o=e.onDropdownOpen,l=e.onCreate,d=e.createLabel,c=e.createTitle;return(0,z.jsxs)(I.Z.Compact,{block:!0,children:[(0,z.jsx)(F.Z,{value:t,onChange:n,options:a,showSearch:!0,filterOption:!1,placeholder:s,loading:r,style:{flex:1},notFoundContent:i,onSearch:u,onOpenChange:function(e){e&&o()}}),(0,z.jsx)(M.ZP,{size:"small",icon:(0,z.jsx)(O.Z,{}),onClick:l,title:c,children:d})]})},L=function(e){var t,n,a=e.open,r=e.record,s=e.onClose,u=e.onSuccess,l=(0,m.useIntl)(),c=(0,w.u)((function(e){return e.currentOrg})),p=(0,g.useState)(!1),h=f()(p,2),b=h[0],y=h[1],S=(0,g.useState)([]),I=f()(S,2),F=I[0],L=I[1],X=(0,g.useState)(!1),V=f()(X,2),B=V[0],N=V[1],_=(0,g.useState)((null==r?void 0:r.avatar)||""),H=f()(_,2),G=H[0],W=H[1],Y=(0,g.useRef)(),$=(0,g.useMemo)((function(){return!(null==r||!r.uid)}),[r]),K=function(){var e=d()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W(t),x.yw.success(l.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=(0,g.useCallback)(function(){var e=d()(o()().mark((function e(t){var n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N(!0),e.prev=1,null!=c&&c.uid){e.next=5;break}return L([]),e.abrupt("return",[]);case 5:return a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==c?void 0:c.uid,searchText:t||""},e.next=8,(0,D.u9)(a);case 8:return r=e.sent,console.log("queryAgentSettingsByOrg request:",a,r),s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],L(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 13:return e.prev=13,N(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==c?void 0:c.uid]);(0,g.useEffect)((function(){Q()}),[Q]);var ee=(0,g.useMemo)((function(){return F.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[F]),te=(0,g.useRef)(),ne=(0,g.useCallback)((function(e){te.current&&clearTimeout(te.current),te.current=setTimeout((function(){Q(e)}),300)}),[Q]);(0,g.useEffect)((function(){return function(){te.current&&clearTimeout(te.current)}}),[]);var ae=(0,g.useCallback)((function(){F.length||Q()}),[Q,F.length]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(Z.a,{open:a,onOpenChange:function(e){e||s()},title:$?l.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):l.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:Y,initialValues:$?{nickname:null==r?void 0:r.nickname,email:null==r?void 0:r.email,mobile:null==r?void 0:r.mobile,description:null==r?void 0:r.description,memberUid:(null==r||null===(t=r.member)||void 0===t?void 0:t.uid)||(null==r?void 0:r.memberUid),settingsUid:null==r||null===(n=r.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:l.formatMessage({id:"save",defaultMessage:"保存"}),resetText:l.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return s()}}},onFinish:function(){var e=d()(o()().mark((function e(t){var n,a,d,f,g;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.yw.loading(l.formatMessage({id:$?"updating":"creating",defaultMessage:$?"Updating":"Creating"})),!$){e.next=10;break}return d=i()(i()(i()({},r),t),{},{avatar:G||(null==r?void 0:r.avatar)}),e.next=6,(0,k.sE)(d);case 6:a=e.sent,console.log("updateAgent payload:",d,a),e.next=15;break;case 10:return f={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==c?void 0:c.uid,avatar:G},e.next=13,(0,k.x_)(f);case 13:a=e.sent,console.log("createAgent payload:",f,a);case 15:if(x.yw.destroy(),200!==(null===(n=a)||void 0===n?void 0:n.code)){e.next=23;break}return x.yw.success(l.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==u||u(a.data),s(),e.abrupt("return",!0);case 23:return x.yw.error((null===(g=a)||void 0===g?void 0:g.message)||l.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),x.yw.destroy(),x.yw.error(l.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(U.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:l.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,z.jsxs)(R.G,{onSuccess:K,onError:function(e){x.yw.error(String(e))},children:[(0,z.jsx)(v.Z,{src:G||(null==r?void 0:r.avatar)}),(0,z.jsxs)(M.ZP,{icon:(0,z.jsx)(P.Z,{}),children:[" ",l.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,z.jsx)(C.Z,{name:"memberUid",label:l.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:l.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:$,rules:$?[]:[{required:!0,message:l.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=d()(o()().mark((function e(t){var n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.next=3,(0,A.z_)({pageNumber:0,pageSize:20,orgUid:null==c?void 0:c.uid,searchText:a||""});case 3:return r=e.sent,s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,z.jsx)(U.A.Item,{name:"settingsUid",label:l.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),rules:[{required:!0,message:l.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],children:(0,z.jsx)(J,{options:ee,loading:B,placeholder:l.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),emptyContent:0===ee.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:l.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(O.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return y(!0)},children:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:ne,onDropdownOpen:ae,onCreate:function(){return y(!0)},createLabel:l.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})}),(0,z.jsx)(q.Z,{name:"nickname",label:l.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.nickname.required"})}]}),(0,z.jsx)(q.Z,{name:"email",label:l.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.email.required"})}]}),(0,z.jsx)(q.Z,{name:"mobile",label:l.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.mobile.required"})}]}),(0,z.jsx)(T.Z,{name:"description",label:l.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,z.jsx)(E.Z,{open:b,onOpenChange:y,orgUid:(null==c?void 0:c.uid)||"",record:null,onSuccess:function(e){var t;y(!1),L((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(j()(t))})),Q(),null===(t=Y.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},X=n(66400),V=n(87666),B=n(86538),N=n(43321),_=n(25709),H=n(33122),G=n(12715),W=function(e){var t=e.open,n=e.onClose,a=e.onSubmit,s=(0,m.useIntl)(),u=B.ZP.useForm(),l=f()(u,1)[0],c=(0,w.u)((function(e){return e.currentOrg})),p=(0,X.Z)((function(e){return e.memberResult})),v=(0,X.Z)((function(e){return e.setMemberResult})),h=(0,V.E)((function(e){return e.agentResult})),b=(0,g.useState)(0),x=f()(b,2),y=x[0],S=x[1],Z=(0,g.useState)(""),U=f()(Z,2),T=U[0],I=U[1],F=(0,g.useState)(!1),O=f()(F,2),P=O[0],E=O[1],R=(0,g.useState)([]),J=f()(R,2),L=J[0],W=J[1],Y=(0,g.useRef)(null),$=(0,g.useState)(0),K=f()($,2),Q=K[0],ee=K[1],te=(0,g.useState)(!0),ne=f()(te,2),ae=ne[0],re=ne[1],se=(0,g.useState)(!1),ie=f()(se,2),ue=ie[0],oe=ie[1],le=(0,g.useState)(0),de=f()(le,2),ce=de[0],fe=de[1],ge=(0,g.useState)(!0),me=f()(ge,2),pe=me[0],ve=me[1],he=(0,g.useState)(!1),be=f()(he,2),Me=be[0],xe=be[1],ke=(0,g.useState)(new Set),we=f()(ke,2),ye=we[0],Se=we[1],je=(0,g.useState)(!1),Ze=f()(je,2),Ue=Ze[0],Ce=Ze[1],qe=(0,g.useState)([]),Te=f()(qe,2),Ie=Te[0],Fe=Te[1];(0,g.useEffect)((function(){if(t){if(null==c||!c.uid)return;fe(0),ve(!0),xe(!0),I(""),W([]),ee(0),re(!0),d()(o()().mark((function e(){var t,n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:20,orgUid:null==c?void 0:c.uid},e.next=4,(0,A.z_)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)?(s=(null==n||null===(a=n.data)||void 0===a?void 0:a.content)||[],v({code:null==n?void 0:n.code,message:null==n?void 0:n.message,data:i()(i()({},null==n?void 0:n.data),{},{content:s})}),ve(!(null!=n&&null!==(r=n.data)&&void 0!==r&&r.last))):console.error("Init load members (paged) failed:",null==n?void 0:n.message),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Init load members (paged) failed:",e.t0);case 11:return e.prev=11,xe(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))(),d()(o()().mark((function e(){var t,n,a,r,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Ce(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==c?void 0:c.uid,searchText:""},e.next=5,(0,D.u9)(n);case 5:a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],i=r.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (".concat(s.formatMessage({id:"agent.settings.template.isDefault",defaultMessage:"默认"}),")"):"").concat(e.enabled?"":" (".concat(s.formatMessage({id:"app.disabled",defaultMessage:"已停用"}),")")),value:e.uid}})),Fe(i),!l.getFieldValue("settingsUid")&&i.length>0&&l.setFieldsValue({settingsUid:i[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,Ce(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))()}}),[t,null==c?void 0:c.uid,l,s,v]),(0,g.useEffect)((function(){if(t&&null!=c&&c.uid){var e=!1;return d()(o()().mark((function t(){var n,a,s,i,u,l,d,f,g,m,p,v,h,b;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=new Set,a=200,s=0,i=200;case 5:if(!(s<i)){t.next=23;break}return d={pageNumber:s,pageSize:a,orgUid:c.uid},t.next=9,(0,k._t)(d);case 9:if(f=t.sent,!e){t.next=12;break}return t.abrupt("return");case 12:if(200===(null==f?void 0:f.code)){t.next=15;break}return console.error("Load all agents failed:",null==f?void 0:f.message,d),t.abrupt("break",23);case 15:g=(null==f||null===(u=f.data)||void 0===u?void 0:u.content)||[],m=r()(g);try{for(m.s();!(p=m.n()).done;)h=p.value,(b=(null==h||null===(v=h.member)||void 0===v?void 0:v.uid)||(null==h?void 0:h.memberUid))&&n.add(b)}catch(e){m.e(e)}finally{m.f()}if(!(null!=f&&null!==(l=f.data)&&void 0!==l&&l.last||0===g.length)){t.next=20;break}return t.abrupt("break",23);case 20:s+=1,t.next=5;break;case 23:e||Se(n),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),console.error("Load all agents error:",t.t0);case 29:case"end":return t.stop()}}),t,null,[[0,26]])})))(),function(){e=!0}}}),[t,null==c?void 0:c.uid]),(0,g.useEffect)((function(){return function(){Y.current&&clearTimeout(Y.current)}}),[]);var Oe=(0,g.useMemo)((function(){var e,t,n=new Set,a=(null==h||null===(e=h.data)||void 0===e?void 0:e.content)||[],s=r()(a);try{for(s.s();!(t=s.n()).done;){var i,u=t.value,o=(null==u||null===(i=u.member)||void 0===i?void 0:i.uid)||(null==u?void 0:u.memberUid);o&&n.add(o)}}catch(e){s.e(e)}finally{s.f()}return n}),[h]),Pe=(0,g.useMemo)((function(){return ye.size>0?ye:Oe}),[ye,Oe]),Ae=(0,g.useMemo)((function(){for(var e,t,n,a=[],r=T.trim()?L:(null==p||null===(e=p.data)||void 0===e?void 0:e.content)||[],i=0;i<r.length;i++){var u=r[i],o=Pe.has(u.uid),l={title:"",value:"",children:[]};t=u,(n=l).title=t.nickname,n.value=t.uid,o&&(l.disabled=!0,l.title="".concat(l.title," (").concat(s.formatMessage({id:"agent.member.alreadyCreated",defaultMessage:"已创建客服"}),")")),a.push(l)}return a}),[p,L,T,Pe,s]),De=function(){var e=d()(o()().mark((function e(t){var n,a,r,s,i=arguments;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],t.trim()||n){e.next=6;break}return W([]),ee(0),re(!0),e.abrupt("return");case 6:return n?oe(!0):E(!0),e.prev=7,a={pageNumber:n?Q+1:0,pageSize:20,orgUid:null==c?void 0:c.uid,searchText:t.trim()},e.next=11,(0,A.z_)(a);case 11:200===(r=e.sent).code?(s=(null==r?void 0:r.data.content)||[],n?(W((function(e){return[].concat(j()(e),j()(s))})),ee(Q+1)):(W(s),ee(0)),re(!(null!=r&&r.data.last))):(console.error("handleSearch Search failed:",r.message),n||W([])),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error("Search error:",e.t0),n||W([]);case 19:return e.prev=19,n?oe(!1):E(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,15,19,22]])})));return function(t){return e.apply(this,arguments)}}(),Ee=function(e){var t=e.target.value;I(t),Y.current&&clearTimeout(Y.current),t.trim()?Y.current=setTimeout((function(){De(t)}),300):(W([]),ee(0),re(!0))},Re=function(){De(T)},ze=function(){!ue&&ae&&T.trim()&&De(T,!0)},Je=function(){var e=d()(o()().mark((function e(){var t,n,a,r,s,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Me||!pe){e.next=16;break}return xe(!0),e.prev=2,t={pageNumber:ce+1,pageSize:20,orgUid:null==c?void 0:c.uid},e.next=6,(0,A.z_)(t);case 6:200===(n=e.sent).code&&(r=(null==n?void 0:n.data.content)||[],s=X.Z.getState().memberResult,u=[].concat(j()((null==s||null===(a=s.data)||void 0===a?void 0:a.content)||[]),j()(r)),v({code:null==n?void 0:n.code,message:null==n?void 0:n.message,data:i()(i()({},null==n?void 0:n.data),{},{content:u})}),fe(ce+1),ve(!(null!=n&&n.data.last))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 13:return e.prev=13,xe(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,10,13,16]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)("div",{children:(0,z.jsx)(_.Z,{title:s.formatMessage({id:"agent.create",defaultMessage:"创建客服"}),open:t,forceRender:!0,onOk:function(){l.validateFields().then((function(e){var t,n=(l.getFieldValue("memberUids")||[]).filter((function(e){return e&&!Pe.has(e)}));if(0!==n.length){var r=l.getFieldValue("nickname"),s=l.getFieldValue("email"),i=l.getFieldValue("mobile"),u=l.getFieldValue("settingsUid"),o=T.trim()?L:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[],d=[];if(1===n.length){var f={nickname:r,email:s,mobile:i,memberUid:n[0],orgUid:null==c?void 0:c.uid,settingsUid:u};d.push(f)}else n.forEach((function(e){var t=o.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==c?void 0:c.uid,settingsUid:u};d.push(n)}}));a(d)}else console.warn("No selectable members, all are already agents.")})).catch((function(e){console.error("Form errors:",e)}))},onCancel:function(){n()},children:(0,z.jsxs)(B.ZP,{form:l,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,z.jsx)(C.Z,{label:s.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),name:"settingsUid",tooltip:s.formatMessage({id:"agent.settings.tooltip",defaultMessage:"为本次创建的客服指定配置模板"}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.required.message",defaultMessage:"请选择客服配置!"})}],fieldProps:{options:Ie,loading:Ue,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:s.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"})}}),(0,z.jsx)(N.Z,{label:s.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),name:"memberUids",tooltip:s.formatMessage({id:"agent.info.member.tooltip",defaultMessage:"请先到组织-》成员-》创建成员，已创建过客服的成员会被标记并禁止选择"}),rules:[{required:!0,message:s.formatMessage({id:"agent.info.member.required.message",defaultMessage:"请选择成员!"})}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:s.formatMessage({id:"agent.info.member.placeholder.multiple",defaultMessage:"请选择成员（可多选）"}),onChange:function(e){var t,n=(e||[]).filter((function(e){return e&&!Pe.has(e)}));n.length!==(e||[]).length&&l.setFieldsValue({memberUids:n}),S(n.length);var a=T.trim()?L:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[];if(0===n.length)l.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===n.length){var r=a.find((function(e){return e.uid===n[0]}));r&&l.setFieldsValue({nickname:r.nickname||"",email:r.email||"",mobile:r.mobile||""})}else{var s=a.filter((function(e){return n.includes(e.uid)})),i=s.map((function(e){return e.nickname})).filter(Boolean).join(", "),u=s.map((function(e){return e.email})).filter(Boolean).join(", "),o=s.map((function(e){return e.mobile})).filter(Boolean).join(", ");l.setFieldsValue({nickname:i,email:u,mobile:o})}},treeData:Ae,variant:"outlined",popupRender:function(e){return(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,z.jsx)(H.Z,{placeholder:s.formatMessage({id:"agent.info.member.search",defaultMessage:"搜索成员"}),value:T,onChange:Ee,onPressEnter:function(){return Re()},suffix:(0,z.jsx)(G.Z,{onClick:Re,style:{cursor:"pointer",color:P?"#1890ff":void 0},spin:P}),allowClear:!0,size:"small"})}),e,(T.trim()?ae:pe)&&(0,z.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,z.jsx)(M.ZP,{type:"link",size:"small",loading:T.trim()?ue:Me,onClick:T.trim()?ze:Je,disabled:T.trim()?ue:Me,children:(T.trim()?ue:Me)?s.formatMessage({id:"loading",defaultMessage:"加载中..."}):s.formatMessage({id:"load.more",defaultMessage:"加载更多"})})})]})}}}),(0,z.jsx)(q.Z,{label:s.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),name:"nickname",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.nickname.tooltip.multiple",defaultMessage:"多选模式下昵称将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.nickname.tooltip",defaultMessage:"昵称将自动从选中的成员信息中获取"})}),(0,z.jsx)(q.Z,{label:s.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),name:"email",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.email.tooltip.multiple",defaultMessage:"多选模式下邮箱将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.email.tooltip",defaultMessage:"邮箱将自动从选中的成员信息中获取"})}),(0,z.jsx)(q.Z,{label:s.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),name:"mobile",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.mobile.tooltip.multiple",defaultMessage:"多选模式下手机号将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.mobile.tooltip",defaultMessage:"手机号将自动从选中的成员信息中获取"})})]})})})},Y=n(42539),$=function(e){var t=e.superUser,n=(0,m.useIntl)(),a=(0,g.useRef)(),s=(0,w.u)((function(e){return e.currentOrg})),u=(0,g.useState)(!1),l=f()(u,2),c=l[0],S=l[1],j=(0,g.useState)(!1),Z=f()(j,2),U=Z[0],C=Z[1],q=(0,g.useState)(null),T=f()(q,2),I=T[0],F=T[1],O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:n.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,z.jsx)(v.Z,{src:null==t?void 0:t.avatar})}},{title:n.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:n.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.status){case y.Ra4:return(0,z.jsx)(h.Z,{color:"green",children:n.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case y.tU$:return(0,z.jsx)(h.Z,{color:"orange",children:n.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case y.LZ1:default:return(0,z.jsx)(h.Z,{color:"red",children:n.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:n.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(e,t){return null!=t&&t.connected?(0,z.jsx)(h.Z,{color:"green",children:n.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,z.jsx)(h.Z,{color:"red",children:n.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:n.formatMessage({id:"agent.queue.stats",defaultMessage:"队列统计"}),dataIndex:"queueStats",width:280,hideInSearch:!0,render:function(e,t){var a,r,s,i=null==t?void 0:t.queueStats;return i?(0,z.jsxs)("span",{style:{fontSize:12},children:[(0,z.jsxs)(h.Z,{color:"blue",children:[n.formatMessage({id:"agent.queue.today",defaultMessage:"今日"}),": ",null!==(a=i.agentServedCount)&&void 0!==a?a:0]}),(0,z.jsxs)(h.Z,{color:"orange",children:[n.formatMessage({id:"agent.queue.queuing",defaultMessage:"排队中"}),": ",null!==(r=i.queuingCount)&&void 0!==r?r:0]}),(0,z.jsxs)(h.Z,{color:"green",children:[n.formatMessage({id:"agent.queue.chatting",defaultMessage:"接待中"}),": ",null!==(s=i.chattingCount)&&void 0!==s?s:0]})]}):(0,z.jsx)("span",{style:{color:"#999"},children:"-"})}},{title:n.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){return null!=t&&t.settings?(0,z.jsx)("a",{onClick:function(){F(t),S(!0)},children:t.settings.name||n.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,z.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){F(t),S(!0)},children:n.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:n.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:n.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){return[(0,z.jsx)("a",{onClick:function(){return function(e){var t;if(null!=e&&e.uid){var a={chatConfig:{org:null==s?void 0:s.uid,t:y._0X,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}else x.yw.error(n.formatMessage({id:"agent.invalid",defaultMessage:"无效的客服"}))}(t)},children:n.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,z.jsx)("a",{onClick:function(){return m.history.push("/service/channel")},children:n.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,z.jsx)("a",{onClick:function(){F(t),S(!0)},children:n.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,z.jsx)(b.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:d()(o()().mark((function e(){var r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,k.Lr)(t);case 4:r=e.sent,x.yw.destroy(),200===(null==r?void 0:r.code)?(x.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):x.yw.error((null==r?void 0:r.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.destroy(),x.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:n.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,z.jsx)("a",{children:n.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:n.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(p.Z,{columns:O,actionRef:a,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,z.jsx)(M.ZP,{type:"primary",onClick:function(){F(null),C(!0)},children:n.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=d()(o()().mark((function e(n,a){var r,u,l,d,c,g,m,p,v,h,b,M,x,w,y,S,j,Z,U,C,q,T;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=(null!==(r=null==n?void 0:n.current)&&void 0!==r?r:1)-1,c=null!==(u=null==n?void 0:n.pageSize)&&void 0!==u?u:10,g=null!==(l=null==n?void 0:n.searchText)&&void 0!==l?l:"",(v=Object.entries(a||{})).length>0&&(h=v[0],b=f()(h,2),M=b[0],(x=b[1])&&(m=M,p="ascend"===x?"ascend":"descend")),w=i()(i()({pageNumber:d,pageSize:c,orgUid:null==s?void 0:s.uid,searchText:g,superUser:t},m?{sortBy:m}:{}),p?{sortDirection:p}:{}),e.prev=6,e.next=9,(0,k._t)(w);case 9:if(y=e.sent,Y.Z.debug("queryAgentsByOrg response:",y,w),200!==(null==y?void 0:y.code)){e.next=15;break}return q=(null==y||null===(S=y.data)||void 0===S?void 0:S.content)||[],T=null!==(j=null!==(Z=null==y||null===(U=y.data)||void 0===U?void 0:U.totalElements)&&void 0!==Z?Z:null==y||null===(C=y.data)||void 0===C?void 0:C.numberOfElements)&&void 0!==j?j:q.length,e.abrupt("return",{data:q,total:T,success:!0});case 15:return e.abrupt("return",{data:[],total:0,success:!1});case 18:return e.prev=18,e.t0=e.catch(6),e.abrupt("return",{data:[],total:0,success:!1});case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:n.formatMessage({id:"agent",defaultMessage:"Agent"})}),c&&(0,z.jsx)(L,{open:c,record:I,onClose:function(){return S(!1)},onSuccess:function(){var e;return null===(e=a.current)||void 0===e?void 0:e.reload()}}),U&&(0,z.jsx)(W,{open:U,onClose:function(){return C(!1)},onSubmit:function(){var e=d()(o()().mark((function e(t){var s,i,u,l,d,c,f,g,m,p,v,h,b,M,w,y;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(((null==t?void 0:t.length)||0)>200)){e.next=3;break}return x.yw.warning(n.formatMessage({id:"agent.create.batch.limit",defaultMessage:"超过最大批量 200，请分批创建"})),e.abrupt("return");case 3:s="agent-batch-create",x.yw.loading({content:n.formatMessage({id:"saving",defaultMessage:"Saving..."}),key:s,duration:0}),i=[],u=function(e){return new Promise((function(t){return setTimeout(t,e)}))},l=r()(t),e.prev=8,l.s();case 10:if((d=l.n()).done){e.next=52;break}c=d.value,f=0,g=!1,m=null;case 15:if(!(f<3)||g){e.next=49;break}return e.prev=16,e.next=19,(0,k.x_)(c);case 19:if(200!==(null==(p=e.sent)?void 0:p.code)){e.next=24;break}return i.push({uid:c.memberUid,ok:!0}),g=!0,e.abrupt("break",49);case 24:return i.push({uid:c.memberUid,ok:!1,code:null==p?void 0:p.code,msg:null==p?void 0:p.message}),g=!0,e.abrupt("break",49);case 29:if(e.prev=29,e.t0=e.catch(16),h=null===e.t0||void 0===e.t0||null===(v=e.t0.response)||void 0===v?void 0:v.status,m=e.t0,f+=1,!(409===h&&f<3)){e.next=40;break}return e.next=37,u(300*f);case 37:return e.abrupt("continue",15);case 40:if(502!==h&&503!==h&&504!==h||!(f<3)){e.next=44;break}return e.next=43,u(300*f);case 43:return e.abrupt("continue",15);case 44:return i.push({uid:c.memberUid,ok:!1,code:h,msg:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"error"}),g=!0,e.abrupt("break",49);case 47:e.next=15;break;case 49:!g&&m&&i.push({uid:c.memberUid,ok:!1,msg:(null===(b=m)||void 0===b?void 0:b.message)||"error"});case 50:e.next=10;break;case 52:e.next=57;break;case 54:e.prev=54,e.t1=e.catch(8),l.e(e.t1);case 57:return e.prev=57,l.f(),e.finish(57);case 60:M=i.filter((function(e){return e.ok})).length,w=i.length-M,M>0?(x.yw.success({content:n.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(M,")"),key:s}),C(!1),null===(y=a.current)||void 0===y||y.reload()):x.yw.destroy(s),w>0&&x.yw.warning(n.formatMessage({id:"create.partial.failed",defaultMessage:"部分创建失败，请查看失败项并重试"})+" (".concat(w,")"));case 64:case"end":return e.stop()}}),e,null,[[8,54,57,60],[16,29]])})));return function(t){return e.apply(this,arguments)}}()})]})}},66400:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(36265),r=n(74543),s=n(21152),i=n(72083),u=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n.splice(a,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:a.PQL})))}}]);