"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{56278:function(e,t,n){n.r(t),n.d(t,{default:function(){return be}});var r=n(44194),a=n(67738),l=n(14906),s=n(76711),i=n.n(s),o=n(73193),d=n.n(o),u=n(90819),c=n.n(u),f=n(89933),p=n.n(f),g=n(45332),m=n.n(g),v=n(77033),h=n(82770),x=n(32525),M=n(50716),b=n(92354),y=n(39487),k=n(81739),w=n(66431),S=n(63649),j=n(10162),T=n(59304),C=n(54881),Z=n(49764),P=n(19433),I=n(88894),U=n(98830),F=n(75112),E=n(14597),R=n(39497),A=n(99665),q=n(66547),K=(n(84262),n(94212),n(24479),n(90631)),D=n(1460),z=n(56663),O=n(25197),Q=n(27153),N=n(31549),L="welcome",B=function(){var e=(0,l.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,F.Z)().leftSiderStyle,s=(0,E.Z)().isDarkMode,o=(0,r.useState)(!1),u=m()(o,2),f=u[0],g=u[1],B=(0,r.useState)([]),_=m()(B,2),V=_[0],G=_[1],H=(0,r.useState)(),W=m()(H,2),J=W[0],X=W[1],$=(0,r.useState)(""),Y=m()($,2),ee=Y[0],te=Y[1],ne=(0,r.useState)(L),re=m()(ne,2),ae=re[0],le=re[1],se=(0,r.useState)(!1),ie=m()(se,2),oe=ie[0],de=ie[1],ue=(0,r.useState)(null),ce=m()(ue,2),fe=ce[0],pe=ce[1],ge=(0,r.useMemo)((function(){return V.find((function(e){return e.uid===J}))||null}),[V,J]),me=(0,r.useState)(!1),ve=m()(me,2),he=ve[0],xe=ve[1],Me=(0,r.useState)(!1),be=m()(Me,2),ye=be[0],ke=be[1],we=(0,r.useState)(!1),Se=m()(we,2),je=Se[0],Te=Se[1],Ce=(0,r.useRef)(""),Ze=(0,A.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),Pe=Ze.setCurrentRobotSettings,Ie=Ze.currentRobotSettings,Ue=(0,r.useMemo)((function(){if(!ee)return V;var e=ee.toLowerCase();return V.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[V,ee]),Fe=(0,r.useCallback)(function(){var e=p()(c()().mark((function e(n,r){var a,l,s,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return g(!0),e.prev=3,l=(null!=n?n:"").trim(),s={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:l||void 0},e.next=8,(0,I.VW)(s);case 8:i=e.sent,console.log("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",i,s),o=(null==i||null===(a=i.data)||void 0===a?void 0:a.content)||[],G(o),!(o.length>0)||J&&o.some((function(e){return e.uid===J}))||(X(o[0].uid),null!=r&&r.keepActive||le(L));case 13:return e.prev=13,g(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,J]);(0,r.useEffect)((function(){Fe(ee)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){ge?(Pe(ge),Ce.current=JSON.stringify(null!=ge?ge:{}),Te(!1)):(Pe(null),Ce.current=JSON.stringify({}),Te(!1))}),[null==ge?void 0:ge.uid]),(0,r.useEffect)((function(){if(ge)try{var e,t,n=JSON.stringify(null!=Ie?Ie:{}),r=n!==Ce.current;console.log("ğŸ” [Dirty Check]",{isDirty:r,selectedUid:null==ge?void 0:ge.uid,currentWelcomeTip:(null==Ie||null===(e=Ie.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==Ie||null===(t=Ie.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:Ce.current.length,nowLength:n.length}),Te(r)}catch(e){Te(!0)}}),[Ie,null==ge?void 0:ge.uid]);var Ee=function(){var n=p()(c()().mark((function n(r){var a,l,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:ge)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return l={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,I.r$)(l);case 6:(s=n.sent)&&200===s.code?(P.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),Fe(ee)):P.yw.error((null==s?void 0:s.message)||"åˆ é™¤å¤±è´¥");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Re=function(){var n=p()(c()().mark((function n(r,a){var l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,I.sK)({uid:r,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(l=n.sent)&&200===l.code?(P.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),Fe(ee)):P.yw.error((null==l?void 0:l.message)||"æ“ä½œå¤±è´¥"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",n.t0),P.yw.error("æ“ä½œå¤±è´¥");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ae=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},qe=function(e){if(e){var t=Ae(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return Ae(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return d()(d()({},t),n?{toolbar:n}:{})}},Ke=function(e){if(e)return Ae(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},De=function(e){if(e)return Ae(e,["name","description","color","order"])},ze=function(e){if(e)return Ae(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Oe=function(){var n=p()(c()().mark((function n(){var r,a,l,s,i,o;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ge&&ge.uid){n.next=3;break}return P.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:return xe(!0),n.prev=4,r=Ie&&Ie.uid===ge.uid?Ie:ge,a=function(e,t){return d()(d()({},e||{}),t||{})},l={uid:ge.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,serviceSettings:qe(a(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),inviteSettings:Ke(a(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),intentionSettings:De(a(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),rateDownSettings:ze(a(null==r?void 0:r.rateDownSettings,null==r?void 0:r.draftRateDownSettings))},n.next=10,(0,I.sK)(l);case 10:s=n.sent,console.log("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",s,l),s&&200===s.code?(P.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),Ce.current=JSON.stringify(null!==(i=null!==(o=s.data)&&void 0!==o?o:r)&&void 0!==i?i:{}),Te(!1),Fe(ee)):P.yw.error((null==s?void 0:s.message)||"ä¿å­˜å¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("ä¿å­˜å¤±è´¥:",n.t0),P.yw.error("ä¿å­˜å¤±è´¥");case 19:return n.prev=19,xe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Qe=function(){var n=p()(c()().mark((function n(){var r,a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ge&&ge.uid){n.next=3;break}return P.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:if(ke(!0),n.prev=4,!je){n.next=8;break}return n.next=8,Oe();case 8:return r={uid:ge.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,I.KF)(r);case 11:(a=n.sent)&&200===a.code?(P.yw.success(e.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),Ce.current=JSON.stringify(null!==(l=a.data)&&void 0!==l?l:{}),Te(!1),Fe(ee,{keepActive:!0})):P.yw.error((null==a?void 0:a.message)||"å‘å¸ƒå¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("å‘å¸ƒå¤±è´¥:",n.t0),P.yw.error("å‘å¸ƒå¤±è´¥");case 19:return n.prev=19,ke(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Ne=(0,r.useMemo)((function(){return null!=ge&&ge.uid?[{key:"welcome",label:(0,N.jsx)(l.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"}),children:(0,N.jsx)(z.Z,{type:R._X4,settingsUid:ge.uid})},{key:"tips",label:(0,N.jsx)(l.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"}),children:(0,N.jsx)(D.Z,{type:R._X4,settingsUid:ge.uid})},{key:"service",label:(0,N.jsx)(l.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"}),children:(0,N.jsx)(K.Z,{type:R._X4,settingsUid:ge.uid})},{key:"rate",label:(0,N.jsx)(l.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,N.jsx)(Q.Z,{type:R._X4,settingsUid:ge.uid})}].concat(i()([]),[{key:"right",label:(0,N.jsx)(l.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,N.jsx)(q.Z,{type:R._X4,settingsUid:ge.uid,isActive:"right"===ae})}],i()([]),i()([])):[]}),[null==ge?void 0:ge.uid,e]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,N.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,N.jsxs)(Z.Z,{title:e.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(j.Z,{}),type:"primary",onClick:function(){pe(null),de(!0)},children:(0,N.jsx)(l.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}),bodyStyle:{padding:8},loading:f,children:[(0,N.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,N.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:ee,onChange:function(e){return te(e.target.value)},onSearch:function(e){te(e),Fe(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,N.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,N.jsx)(M.Z,{dataSource:Ue,locale:{emptyText:(0,N.jsx)(b.Z,{description:e.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:b.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,N.jsx)(M.Z.Item,{style:J===e.uid?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return X(e.uid)},children:(0,N.jsx)(M.Z.Item.Meta,{title:(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,N.jsx)(y.Z,{size:4,children:e.isDefault?(0,N.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null})]}),description:e.description?(0,N.jsx)("div",{style:{color:s?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,N.jsx)(v.Z.Panel,{children:ge?(0,N.jsx)(Z.Z,{title:(0,N.jsxs)(y.Z,{children:[(0,N.jsxs)("span",{children:[e.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",ge.name||ge.uid]}),(0,N.jsx)(w.Z,{checked:!!ge.enabled,onChange:function(e){return Re(ge.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(T.Z,{}),onClick:function(e){var t;e.stopPropagation(),pe(null!=(t=ge)?t:ge),de(!0)},children:"ç¼–è¾‘"}),(0,N.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ee(ge)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,N.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,N.jsx)(C.Z,{}),onClick:function(e){e.stopPropagation()},children:"åˆ é™¤"})}),ge.isDefault?(0,N.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null]}),extra:(0,N.jsxs)(y.Z,{children:[(0,N.jsx)(S.Z,{title:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ",description:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ",okText:"ç»§ç»­å‘å¸ƒ",cancelText:"å–æ¶ˆ",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Qe()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,N.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:ye,type:"default",children:(0,N.jsx)(l.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,N.jsx)(h.ZP,{onClick:function(){ge&&(Pe(ge),Ce.current=JSON.stringify(null!=ge?ge:{}),Te(!1))},disabled:!je,children:(0,N.jsx)(l.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,N.jsx)(h.ZP,{type:"primary",loading:he,onClick:Oe,disabled:!je,children:(0,N.jsx)(l.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,N.jsx)(a.Z,{activeKey:ae,onChange:le,items:Ne})}):(0,N.jsx)(Z.Z,{children:(0,N.jsx)(b.Z,{description:e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,N.jsx)(O.Z,{open:oe,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:fe,onSuccess:function(){de(!1),Fe(ee)}})]})},_=n(10154),V=n.n(_),G=n(89246),H=n(33797),W=n(75580),J=n(68790),X=n(75864),$=n(89965),Y=n(80953),ee=n(2250),te=n(42491),ne=n(94433),re=n(38956),ae=n(50929),le=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],se=r.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,a=e.min,l=e.max,s=e.step,i=e.marks,o=e.vertical,d=e.range,u=(0,re.Z)(e,le);return(0,N.jsx)(ae.Z,(0,ne.Z)({valueType:"slider",fieldProps:(0,ne.Z)((0,ne.Z)({},n),{},{min:a,max:l,step:s,marks:i,vertical:o,range:d,style:null==n?void 0:n.style}),ref:t,proFieldProps:r,filedConfig:{ignoreWidth:!0}},u))})),ie=n(83001),oe=n(41196),de=n(40110),ue=n(59908),ce=n(2011),fe=n(48880),pe=n(7704),ge=ie.Z.Text,me=function(e){var t,n,a,s,i,o,u,f,g,v,x,M,b,y,k,w,S,T,C=e.open,Z=e.record,F=e.onClose,E=e.onSuccess,A=(0,l.useIntl)(),q=(0,U.u)((function(e){return e.currentOrg})),K=(0,r.useMemo)((function(){return!(null==Z||!Z.uid)}),[Z]),D=(0,r.useState)(!1),z=m()(D,2),Q=z[0],L=z[1],B=(0,r.useState)([]),_=m()(B,2),G=(_[0],_[1]),ne=(0,r.useState)(!1),re=m()(ne,2),ae=re[0],le=re[1],ie=(0,r.useState)(0),me=m()(ie,2),ve=me[0],he=me[1],xe=(0,r.useRef)(),Me=(0,r.useState)((null==Z?void 0:Z.avatar)||""),be=m()(Me,2),ye=be[0],ke=be[1],we=(0,r.useState)((null==Z?void 0:Z.type)||R.f4h),Se=m()(we,2),je=Se[0],Te=Se[1],Ce=(0,r.useState)((null==Z?void 0:Z.system)||!1),Ze=m()(Ce,2),Pe=Ze[0],Ie=Ze[1],Ue=(0,r.useState)([]),Fe=m()(Ue,2),Ee=Fe[0],Re=Fe[1],Ae=(0,r.useState)({}),qe=m()(Ae,2),Ke=qe[0],De=qe[1],ze=(0,r.useState)(!1),Oe=m()(ze,2),Qe=Oe[0],Ne=Oe[1],Le=(0,r.useState)(""),Be=m()(Le,2),_e=Be[0],Ve=Be[1],Ge=(0,r.useState)(""),He=m()(Ge,2),We=He[0],Je=He[1],Xe=(0,r.useState)(""),$e=m()(Xe,2),Ye=$e[0],et=$e[1],tt=(0,r.useState)(""),nt=m()(tt,2),rt=nt[0],at=nt[1],lt=(0,r.useState)(!(null==Z||null===(t=Z.llm)||void 0===t||!t.enabled)),st=m()(lt,2),it=st[0],ot=st[1],dt=(0,r.useState)(!(null==Z||!Z.kbEnabled)),ut=m()(dt,2),ct=ut[0],ft=ut[1],pt=(0,r.useCallback)(function(){var e=p()(c()().mark((function e(t){var n,r,a,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return le(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==q?void 0:q.uid,searchText:t||""},e.next=5,(0,I.VW)(r);case 5:return a=e.sent,l=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],G(l),e.abrupt("return",l.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (é»˜è®¤)":"").concat(e.enabled?"":" (å·²åœç”¨)"),value:e.uid}})));case 9:return e.prev=9,le(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==q?void 0:q.uid]);(0,r.useEffect)((function(){var e,t,n,r,a,l,s,i,o,d,u,c,f,p,g,m,v,h,x,M,b,y,k;C&&(ke((null==Z?void 0:Z.avatar)||""),Te((null==Z?void 0:Z.type)||R.f4h),Ie((null==Z?void 0:Z.system)||!1),ot(!(null==Z||null===(e=Z.llm)||void 0===e||!e.enabled)),ft(!(null==Z||!Z.kbEnabled)),null===(t=xe.current)||void 0===t||t.setFieldsValue({nickname:null==Z?void 0:Z.nickname,type:null==Z?void 0:Z.type,settingsUid:null==Z||null===(n=Z.settings)||void 0===n?void 0:n.uid,name:null==Z?void 0:Z.name,categoryUid:null==Z?void 0:Z.categoryUid,provider:null==Z||null===(r=Z.llm)||void 0===r?void 0:r.textProvider,model:null==Z||null===(a=Z.llm)||void 0===a?void 0:a.textModel,prompt:null==Z||null===(l=Z.llm)||void 0===l?void 0:l.prompt,description:null==Z?void 0:Z.description,enabled:null==Z||null===(s=Z.llm)||void 0===s?void 0:s.enabled,enableThinking:null==Z||null===(i=Z.llm)||void 0===i?void 0:i.enableThinking,enableStreaming:null==Z||null===(o=Z.llm)||void 0===o?void 0:o.enableStreaming,temperature:null==Z||null===(d=Z.llm)||void 0===d?void 0:d.temperature,topP:null==Z||null===(u=Z.llm)||void 0===u?void 0:u.topP,topK:null==Z||null===(c=Z.llm)||void 0===c?void 0:c.topK,scoreThreshold:null==Z||null===(f=Z.llm)||void 0===f?void 0:f.scoreThreshold,maxTokens:null==Z||null===(p=Z.llm)||void 0===p?void 0:p.maxTokens,contextMsgCount:null==Z||null===(g=Z.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==Z||null===(m=Z.llm)||void 0===m?void 0:m.defaultReply,searchType:(null==Z||null===(v=Z.llm)||void 0===v?void 0:v.searchType)||R.rk3,kbSourceEnabled:null==Z?void 0:Z.kbSourceEnabled,kbEnabled:null==Z?void 0:Z.kbEnabled,kbUid:null==Z?void 0:Z.kbUid}),null!=Z&&Z.llm&&(null!=Z&&null!==(h=Z.llm)&&void 0!==h&&h.textProviderUid||null!=Z&&null!==(x=Z.llm)&&void 0!==x&&x.textProvider||null!=Z&&null!==(M=Z.llm)&&void 0!==M&&M.textModel)?(Ve((null==Z||null===(b=Z.llm)||void 0===b?void 0:b.textProvider)||""),Je((null==Z||null===(y=Z.llm)||void 0===y?void 0:y.textProviderUid)||""),et((null==Z||null===(k=Z.llm)||void 0===k?void 0:k.textModel)||"")):(Ve(""),Je(""),et("")))}),[C,Z]);var gt=function(){var e=p()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ke(t),!K||!Z){e.next=13;break}return e.prev=2,n={uid:null==Z?void 0:Z.uid,avatar:t},e.next=6,(0,W.lz)(n);case 6:200===(null==(r=e.sent)?void 0:r.code)?(P.yw.success(A.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),null==E||E(r.data)):P.yw.error((null==r?void 0:r.message)||A.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),P.yw.error(A.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),mt=(0,r.useCallback)(p()(c()().mark((function e(){var t,n,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==q?void 0:q.uid,level:R.whQ},e.next=4,(0,J.mK)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)&&(a=(null==n||null===(r=n.data)||void 0===r?void 0:r.content)||[],Re(a),We&&!_e&&(l=a.find((function(e){return e.uid===We})))&&Ve(l.type),!We&&_e&&(s=a.find((function(e){return e.type===_e})))&&Je(s.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==q?void 0:q.uid,We,_e]);(0,r.useEffect)((function(){C&&mt()}),[C,mt]);var vt=(0,r.useCallback)((function(){return Ne(!0)}),[]),ht=(0,r.useCallback)((function(){return Ne(!1)}),[]),xt=(0,r.useCallback)((function(e,t){De((function(n){return d()(d()({},n),{},V()({},e,t))}))}),[]),Mt=(0,r.useCallback)((function(e,t,n){var r,a=Ee.find((function(t){return t.uid===e})),l=a?a.type:e;Ve(l),Je(e),et(t),at(n),null===(r=xe.current)||void 0===r||r.setFieldsValue({provider:l,model:t}),Ne(!1)}),[Ee]);return(0,N.jsxs)(X.a,{open:C,onOpenChange:function(e){e||F()},title:A.formatMessage({id:"robot.edit",defaultMessage:"ç¼–è¾‘æœºå™¨äºº"}),width:560,formRef:xe,initialValues:K?{nickname:null==Z?void 0:Z.nickname,type:null==Z?void 0:Z.type,settingsUid:null==Z||null===(n=Z.settings)||void 0===n?void 0:n.uid,name:null==Z?void 0:Z.name,categoryUid:null==Z?void 0:Z.categoryUid,provider:null==Z||null===(a=Z.llm)||void 0===a?void 0:a.textProvider,model:null==Z||null===(s=Z.llm)||void 0===s?void 0:s.textModel,prompt:null==Z||null===(i=Z.llm)||void 0===i?void 0:i.prompt,description:null==Z?void 0:Z.description,enabled:null==Z||null===(o=Z.llm)||void 0===o?void 0:o.enabled,enableThinking:null==Z||null===(u=Z.llm)||void 0===u?void 0:u.enableThinking,enableStreaming:null==Z||null===(f=Z.llm)||void 0===f?void 0:f.enableStreaming,temperature:null==Z||null===(g=Z.llm)||void 0===g?void 0:g.temperature,topP:null==Z||null===(v=Z.llm)||void 0===v?void 0:v.topP,topK:null==Z||null===(x=Z.llm)||void 0===x?void 0:x.topK,scoreThreshold:null==Z||null===(M=Z.llm)||void 0===M?void 0:M.scoreThreshold,maxTokens:null==Z||null===(b=Z.llm)||void 0===b?void 0:b.maxTokens,contextMsgCount:null==Z||null===(y=Z.llm)||void 0===y?void 0:y.contextMsgCount,defaultReply:null==Z||null===(k=Z.llm)||void 0===k?void 0:k.defaultReply,searchType:(null==Z||null===(w=Z.llm)||void 0===w?void 0:w.searchType)||R.rk3,kbSourceEnabled:null==Z?void 0:Z.kbSourceEnabled,kbEnabled:null==Z?void 0:Z.kbEnabled,kbUid:null==Z?void 0:Z.kbUid}:{type:R.f4h,searchType:R.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,N.jsxs)("div",{children:[(0,N.jsx)(h.ZP,{style:{marginRight:8},onClick:function(){return F()},children:A.formatMessage({id:"cancel",defaultMessage:"å–æ¶ˆ"})}),(0,N.jsx)(h.ZP,{type:"primary",onClick:function(){var e,t;return null===(e=xe.current)||void 0===e||null===(t=e.submit)||void 0===t?void 0:t.call(e)},children:A.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=p()(c()().mark((function e(t){var n,r,a,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,K&&null!=Z&&Z.uid){e.next=4;break}return P.yw.warning(A.formatMessage({id:"robot.edit.only",defaultMessage:"å½“å‰ä»…æ”¯æŒç¼–è¾‘ï¼Œè¯·é€šè¿‡æ–°å»ºå…¥å£åˆ›å»ºæœºå™¨äºº"})),e.abrupt("return",!1);case 4:return P.yw.loading(A.formatMessage({id:K?"updating":"creating",defaultMessage:K?"Updating":"Creating"})),a={uid:null==Z?void 0:Z.uid,nickname:t.nickname,name:t.name,type:t.type||R.f4h,description:t.description,avatar:ye,settingsUid:t.settingsUid,kbSourceEnabled:t.kbSourceEnabled,kbEnabled:t.kbEnabled,kbUid:t.kbUid,llm:{prompt:t.prompt,textProvider:_e||t.provider,textProviderUid:We||void 0,textModel:Ye||t.model,enabled:t.enabled,enableThinking:t.enableThinking,enableStreaming:t.enableStreaming,temperature:t.temperature,topP:t.topP,topK:t.topK,scoreThreshold:t.scoreThreshold,maxTokens:t.maxTokens,contextMsgCount:t.contextMsgCount,defaultReply:t.defaultReply,searchType:t.searchType}},e.next=8,(0,W.$l)(a);case 8:if(r=e.sent,console.log("updateRobot:",r,a),P.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=18;break}return P.yw.success(A.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==E||E(r.data),F(),e.abrupt("return",!0);case 18:return P.yw.error((null===(l=r)||void 0===l?void 0:l.message)||A.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.abrupt("return",!1);case 20:e.next=27;break;case 22:return e.prev=22,e.t0=e.catch(0),P.yw.destroy(),P.yw.error(A.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"})),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,N.jsx)(oe.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:A.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"å¤´åƒ"}),children:(0,N.jsxs)(ce.G,{onSuccess:gt,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,N.jsx)(H.Z,{src:ye}),(0,N.jsx)(h.ZP,{icon:(0,N.jsx)(ue.Z,{}),style:{marginLeft:12},children:A.formatMessage({id:"pages.robot.upload",defaultMessage:"ä¸Šä¼ "})})]},"avatar")}),je===R.Qeb&&Pe&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)($.Z,{name:"name",hidden:!0,label:A.formatMessage({id:"name",defaultMessage:"åç§°"}),fieldProps:{placeholder:Pe&&je===R.Qeb?"ç³»ç»Ÿä»£ç†ä¸å¯ä¿®æ”¹åç§°":void 0},disabled:Pe&&je===R.Qeb}),(0,N.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:-20,marginBottom:10},children:"ç³»ç»Ÿå†…ç½®ä»£ç†ï¼Œæ— æ³•ä¿®æ”¹åç§°"})]}),(0,N.jsx)($.Z,{name:"nickname",label:A.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),rules:[{required:!0,message:A.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"})}]}),(0,N.jsx)(Y.Z,{name:"description",label:A.formatMessage({id:"description",defaultMessage:"æè¿°"})}),je===R.f4h&&(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(ee.Z,{name:"settingsUid",label:A.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),placeholder:A.formatMessage({id:"robot.settings.placeholder",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"}),rules:[{required:!0,message:A.formatMessage({id:"robot.settings.required",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:ve},request:function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",pt(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:ae},addonAfter:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(j.Z,{}),onClick:function(){return L(!0)},title:A.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"}),children:A.formatMessage({id:"common.new",defaultMessage:"æ–°å»º"})})})}),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(te.Z,{name:"enabled",label:A.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),fieldProps:{onChange:function(e){return ot(e)}}}),it&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{children:[(0,N.jsx)(ge,{style:{marginBottom:8,display:"block"},children:"æ–‡å­—å¯¹è¯æ¨¡å‹æä¾›å•†"}),(0,N.jsx)(de.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:vt,children:(We||_e)&&Ye?(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsxs)("div",{children:[(0,N.jsx)(ge,{type:"secondary",children:"ä¾›åº”å•†ï¼š"}),(0,N.jsx)(ge,{strong:!0,children:(null===(S=Ee.find((function(e){return e.uid===We})))||void 0===S?void 0:S.nickname)||(null===(T=Ee.find((function(e){return e.type===_e})))||void 0===T?void 0:T.nickname)||_e}),(0,N.jsx)("br",{}),(0,N.jsx)(ge,{type:"secondary",children:"æ¨¡å‹ï¼š"}),(0,N.jsx)(ge,{strong:!0,children:rt||Ye})]}),(0,N.jsx)(h.ZP,{type:"primary",children:"æ›´æ¢æ¨¡å‹"})]}):(0,N.jsx)("div",{style:{textAlign:"center"},children:(0,N.jsx)(h.ZP,{type:"primary",children:"é€‰æ‹©AIæ¨¡å‹"})})}),(0,N.jsxs)("div",{style:{display:"none"},children:[(0,N.jsx)(ee.Z,{name:"provider"}),(0,N.jsx)(ee.Z,{name:"model"})]})]}),(0,N.jsx)(se,{name:"temperature",label:A.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),fieldProps:{min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}}}),(0,N.jsx)(se,{name:"topP",label:A.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"}),fieldProps:{min:0,max:1,step:.1,marks:{0:"0",.5:"0.5",1:"1"}}}),(0,N.jsx)(se,{name:"topK",label:A.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),fieldProps:{min:0,max:100,step:1}}),(0,N.jsx)(se,{name:"scoreThreshold",label:A.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"å¾—åˆ†é˜ˆå€¼"}),fieldProps:{min:0,max:1,step:.01,marks:{0:"0",.5:"0.5",1:"1"}}}),(0,N.jsx)(se,{name:"maxTokens",label:A.formatMessage({id:"pages.prompt.maxTokens",defaultMessage:"æœ€å¤§Tokens"}),fieldProps:{min:0,max:8192,step:1}}),(0,N.jsx)(se,{name:"contextMsgCount",label:A.formatMessage({id:"pages.prompt.contextMsgCount",defaultMessage:"ä¸Šä¸‹æ–‡æ¶ˆæ¯æ•°"}),fieldProps:{min:0,max:50,step:1}}),(0,N.jsx)(Y.Z,{name:"prompt",label:A.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})}),(0,N.jsx)(Y.Z,{name:"defaultReply",label:A.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"é»˜è®¤å›å¤"})})]})]}),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(te.Z,{name:"kbEnabled",label:A.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"å¯ç”¨çŸ¥è¯†åº“"}),fieldProps:{onChange:function(e){return ft(e)}}}),ct&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(te.Z,{name:"kbSourceEnabled",label:A.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"})}),(0,N.jsx)(ee.Z,{name:"searchType",label:A.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),valueEnum:V()(V()(V()({},R.ccx,{text:"å…¨æ–‡"}),R.DGp,{text:"å‘é‡"}),R.rk3,{text:"æ··åˆ"})}),(0,N.jsx)(ee.Z,{name:"kbUid",label:A.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),placeholder:A.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"è¯·é€‰æ‹©çŸ¥è¯†åº“"}),showSearch:!0,debounceTime:300,request:function(){var e=p()(c()().mark((function e(t){var n,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:R.QPQ,orgUid:null==q?void 0:q.uid,searchText:n||""},e.next=5,(0,pe.AP)(a);case 5:return l=e.sent,s=(null==l||null===(r=l.data)||void 0===r?void 0:r.content)||[],e.abrupt("return",s.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()})]})]}),(0,N.jsx)(fe.Z,{visible:Qe,onCancel:ht,onOk:Mt,initialProvider:We||_e,initialModel:Ye,initialModelLabel:rt,providers:Ee,currentOrgUid:null==q?void 0:q.uid,existingProviderModels:Ke,onModelsLoaded:xt,allowedModelTypes:[R.l55,R.xZ8,"CHAT"]}),(0,N.jsx)(O.Z,{open:Q,onOpenChange:L,orgUid:(null==q?void 0:q.uid)||"",record:null,onSuccess:function(){L(!1),he((function(e){return e+1}))}})]})},ve=n(52575),he=n(86895),xe=function(e){var t,n=e.open,a=e.record,s=e.value,i=e.onClose,o=e.onSaved,u=(0,l.useIntl)(),f=(0,r.useState)(s||(null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)||""),g=m()(f,2),v=g[0],x=g[1];(0,r.useEffect)((function(){var e,t;x(null!==(e=null!=s?s:null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[n,s,null==a?void 0:a.uid]);var M=function(){var e=p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(v||"");case 3:P.yw.success(u.formatMessage({id:"copy.success",defaultMessage:"å¤åˆ¶æˆåŠŸ"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),P.yw.error(u.formatMessage({id:"copy.failed",defaultMessage:"å¤åˆ¶å¤±è´¥"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=p()(c()().mark((function e(){var t,n,r,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return null==i||i(),e.abrupt("return");case 3:return e.prev=3,P.yw.loading(u.formatMessage({id:"saving",defaultMessage:"Saving..."})),n=a,r=d()(d()({uid:n.uid,name:n.name,nickname:n.nickname,description:n.description,avatar:n.avatar,type:n.type},n.type===R.f4h&&null!==(t=n.settings)&&void 0!==t&&t.uid?{settingsUid:n.settings.uid}:{}),{},{llm:d()(d()({},n.llm||{}),{},{prompt:v})}),e.next=9,(0,W.$l)(r);case 9:l=e.sent,P.yw.destroy(),200===(null==l?void 0:l.code)?(P.yw.success(u.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==o||o()):P.yw.error((null==l?void 0:l.message)||u.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),P.yw.destroy(),P.yw.error(u.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)(he.Z,{open:n,title:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),onCancel:i,footer:[(0,N.jsx)(h.ZP,{onClick:M,children:u.formatMessage({id:"copy",defaultMessage:"å¤åˆ¶"})},"copy"),(0,N.jsx)(h.ZP,{type:"primary",onClick:b,children:u.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})},"save"),(0,N.jsx)(h.ZP,{onClick:i,children:u.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:(0,N.jsx)("div",{children:(0,N.jsx)("textarea",{value:v,onChange:function(e){return x(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})})})})},Me=function(){var e=(0,l.useIntl)(),t=(0,r.useRef)(),n=(0,U.u)((function(e){return e.currentOrg})),a=(0,r.useState)(!1),s=m()(a,2),i=s[0],o=s[1],d=(0,r.useState)(!1),u=m()(d,2),f=u[0],g=u[1],v=(0,r.useState)(null),x=m()(v,2),M=x[0],b=x[1],y=(0,r.useState)(!1),w=m()(y,2),j=w[0],T=w[1],C=(0,r.useState)(""),Z=m()(C,2),I=Z[0],F=Z[1],E=(0,r.useState)(null),A=m()(E,2),q=A[0],K=A[1],D=(0,r.useState)({}),z=m()(D,2),O=z[0],Q=z[1];r.useEffect((function(){var e=function(){var e=p()(c()().mark((function e(){var t,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==n?void 0:n.uid,level:R.whQ},e.next=4,(0,J.mK)(t);case 4:200===(null==(r=e.sent)?void 0:r.code)&&(l=(null==r||null===(a=r.data)||void 0===a?void 0:a.content)||[],s={},l.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(s[e.uid]=t)})),Q(s)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null!=n&&n.uid?e():Q({})}),[null==n?void 0:n.uid]);var L=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,N.jsx)(H.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(t,n){var r=null==n?void 0:n.type,a=r===R.Qeb?"green":r===R.f4h?"blue":"purple",l=r===R.f4h?e.formatMessage({id:R.f4h,defaultMessage:"Service"}):r===R.Qeb?e.formatMessage({id:R.Qeb,defaultMessage:"Chat"}):r===R.wG_?e.formatMessage({id:R.wG_,defaultMessage:"Marketing"}):e.formatMessage({id:r||"unknown",defaultMessage:r||"-"});return(0,N.jsx)(k.Z,{color:a,children:l})},hideInSearch:!0},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:V()(V()(V()({},R.f4h,{text:e.formatMessage({id:R.f4h,defaultMessage:"Service"})}),R.Qeb,{text:e.formatMessage({id:R.Qeb,defaultMessage:"Chat"})}),R.wG_,{text:e.formatMessage({id:R.wG_,defaultMessage:"Marketing"}),disabled:!0}),hideInTable:!0},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){if((null==n?void 0:n.type)===R.Qeb){var r,a,l=!(null==n||null===(r=n.llm)||void 0===r||!r.textModel);return(0,N.jsx)("a",{onClick:function(){b(n),o(!0)},style:{color:l?void 0:"#ff4d4f"},children:l?(null===(a=n.llm)||void 0===a?void 0:a.textModel)||e.formatMessage({id:"robot.llm.configured",defaultMessage:"æ¨¡å‹å·²é…ç½®"}):e.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"æœªé…ç½®æ¨¡å‹ï¼Œç‚¹å‡»é…ç½®"})})}return null!=n&&n.settings?(0,N.jsx)("a",{onClick:function(){b(n),o(!0)},children:n.settings.name||e.formatMessage({id:"robot.settings.configured",defaultMessage:"å·²é…ç½®"})}):(0,N.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){b(n),o(!0)},children:e.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"æœªé…ç½®ï¼Œç‚¹å‡»é…ç½®"})})}},{title:e.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(t,n){var r,a=null==n||null===(r=n.llm)||void 0===r?void 0:r.prompt;return a?(0,N.jsx)("a",{onClick:function(){F(a),K(n),T(!0)},children:e.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})}):"-"}},{title:e.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var n,r,a=null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid;return a&&O[a]?O[a]:(null==t||null===(r=t.llm)||void 0===r?void 0:r.textProvider)||"-"}},{title:e.formatMessage({id:"pages.prompt.textProviderUid",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†UID"}),dataIndex:["llm","textProviderUid"],hideInSearch:!0,width:200,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid)||"-"}},{title:e.formatMessage({id:"pages.prompt.model",defaultMessage:"æ¨¡å‹"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textModel)||"-"}},{title:e.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,t){var n;return null!=t&&null!==(n=t.llm)&&void 0!==n&&n.enabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var n,r,a;return 0===(null==t||null===(n=t.llm)||void 0===n?void 0:n.temperature)?"0":null!==(r=null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)&&void 0!==r?r:"-"}},{title:e.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var n,r;return null!==(n=null==t||null===(r=t.llm)||void 0===r?void 0:r.topK)&&void 0!==n?n:"-"}},{title:e.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"çŸ¥è¯†åº“å¯ç”¨"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,N.jsx)("a",{onClick:function(){return l.history.push("/service/channel")},children:e.formatMessage({id:"robot.get.code",defaultMessage:"è·å–æœºå™¨äººä»£ç "})},"code"),(0,N.jsx)("a",{onClick:function(){b(r),o(!0)},children:e.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,N.jsx)(S.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"åˆ é™¤ç¡®è®¤"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"ç¡®è®¤åˆ é™¤"}),"ã€").concat(null==r?void 0:r.nickname,"ã€‘ï¼Ÿ"),onConfirm:p()(c()().mark((function n(){var a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return P.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,W.gf)(r);case 4:a=n.sent,P.yw.destroy(),200===(null==a?void 0:a.code)?(P.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(l=t.current)||void 0===l||l.reload()):P.yw.error((null==a?void 0:a.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),P.yw.destroy(),P.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,N.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(G.Z,{columns:L,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:R.f4h}},toolBarRender:function(){return[(0,N.jsx)(h.ZP,{type:"primary",onClick:function(){b(null),g(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=p()(c()().mark((function e(t){var r,a,l,s,i,o,d,u,f,p,g,m,v,h,x,M,b;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,o=null!==(a=null==t?void 0:t.pageSize)&&void 0!==a?a:10,d=null!==(l=null==t?void 0:t.searchText)&&void 0!==l?l:"",u=null!==(s=null==t?void 0:t.type)&&void 0!==s?s:R.f4h,f={pageNumber:i,pageSize:o,categoryUid:"",level:R.whQ,type:u,orgUid:null==n?void 0:n.uid,searchText:d},e.prev=5,e.next=8,(0,W.p0)(f);case 8:if(p=e.sent,console.log("RobotTable queryRobotsByOrg response:",p,f),200!==(null==p?void 0:p.code)){e.next=14;break}return M=(null==p||null===(g=p.data)||void 0===g?void 0:g.content)||[],b=null!==(m=null!==(v=null==p||null===(h=p.data)||void 0===h?void 0:h.totalElements)&&void 0!==v?v:null==p||null===(x=p.data)||void 0===x?void 0:x.numberOfElements)&&void 0!==m?m:M.length,e.abrupt("return",{data:M,total:b,success:!0});case 14:return e.abrupt("return",{data:[],total:0,success:!1});case 17:return e.prev=17,e.t0=e.catch(5),e.abrupt("return",{data:[],total:0,success:!1});case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"robot",defaultMessage:"Robot"})}),i&&(0,N.jsx)(me,{open:i,record:M,onClose:function(){return o(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),f&&(0,N.jsx)(ve.Z,{open:f,onClose:function(){return g(!1)},onSubmit:function(){var n=p()(c()().mark((function n(r){var a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return P.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,W.lg)(r);case 4:a=n.sent,P.yw.destroy(),200===(null==a?void 0:a.code)?(P.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),g(!1),null===(l=t.current)||void 0===l||l.reload()):P.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),P.yw.destroy(),P.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}),(0,N.jsx)(xe,{open:j,record:q,value:I,onClose:function(){return T(!1)},onSaved:function(){var e;T(!1),K(null),null===(e=t.current)||void 0===e||e.reload()}})]})},be=function(){return(0,N.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,N.jsx)(l.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,N.jsx)(Me,{})},{key:"settings",label:(0,N.jsx)(l.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,N.jsx)(B,{})}]})}}}]);