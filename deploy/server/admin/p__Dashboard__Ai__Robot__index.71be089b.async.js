"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{4308:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(83910),a=n(44194),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"},s=n(5901),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:l}))};var o=a.forwardRef(i)},82325:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(83910),a=n(44194),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M744 62H280c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h464c35.3 0 64-28.7 64-64V126c0-35.3-28.7-64-64-64zm-8 824H288V134h448v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"mobile",theme:"outlined"},s=n(5901),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:l}))};var o=a.forwardRef(i)},86772:function(e,t,n){var r=n(94433),a=n(38956),l=n(75477),s=n(941),i=n(44194),o=n(99066),d=n(46659),u=n(31549),c=["options","fieldProps","proFieldProps","valueEnum"],p=i.forwardRef((function(e,t){var n=e.options,s=e.fieldProps,i=e.proFieldProps,o=e.valueEnum,p=(0,a.Z)(e,c);return(0,u.jsx)(d.Z,(0,r.Z)({ref:t,valueType:"checkbox",valueEnum:(0,l.h)(o,void 0),fieldProps:(0,r.Z)({options:n},s),lightProps:(0,r.Z)({labelFormatter:function(){return(0,u.jsx)(d.Z,(0,r.Z)({ref:t,valueType:"checkbox",mode:"read",valueEnum:(0,l.h)(o,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:n},s),proFieldProps:i},p))}},p.lightProps),proFieldProps:i},p))})),f=i.forwardRef((function(e,t){var n=e.fieldProps,a=e.children;return(0,u.jsx)(s.Z,(0,r.Z)((0,r.Z)({ref:t},n),{},{children:a}))})),g=(0,o.G)(f,{valuePropName:"checked"});g.Group=p,t.Z=g},50447:function(e,t,n){var r=n(94433),a=n(38956),l=n(75477),s=n(44194),i=n(18758),o=n(46659),d=n(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var n=e.fieldProps,c=e.children,p=e.params,f=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,x=e.options,M=(0,a.Z)(e,u),b=(0,s.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,l.h)(m),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:x,mode:g,showSearch:h,getPopupContainer:b.getPopupContainer},n),ref:t,proFieldProps:f},M),{},{children:c}))},f=s.forwardRef((function(e,t){var n=e.fieldProps,u=e.children,p=e.params,f=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.options,x=(0,a.Z)(e,c),M=(0,r.Z)({options:h,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),b=(0,s.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,l.h)(m),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:b.getPopupContainer},M),ref:t,proFieldProps:f},x),{},{children:u}))})),g=s.forwardRef(p);g.SearchSelect=f,g.displayName="ProFormComponent",t.Z=g},47268:function(e,t,n){var r=n(32906),a=n(94433),l=n(38956),s=n(92032),i=n(70878),o=n(35068),d=n(21762),u=n(44194),c=n(46659),p=n(31549),f=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",v=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,r.Z)(t,2),l=n[0],d=n[1];return(0,p.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,r=t.getFieldValue(e.name||[]);return(0,p.jsx)(o.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return d(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,r),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:l,children:e.children}))}})},h=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,l.Z)(e,f);return(0,p.jsx)(c.Z,(0,a.Z)({valueType:m,fieldProps:t,filedConfig:{valueType:m},proFieldProps:n},r))};h.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,s=(0,l.Z)(e,g),i=(0,u.useState)(!1),o=(0,r.Z)(i,2),f=o[0],h=o[1];return null!=t&&t.statusRender&&s.name?(0,p.jsx)(v,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:f,onOpenChange:h,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,d.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),h(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),h(!0)}}),proFieldProps:n,filedConfig:{valueType:m}},s))})}):(0,p.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:m}},s))},h.displayName="ProFormComponent",t.Z=h},99032:function(e,t,n){n.r(t),n.d(t,{default:function(){return be}});var r=n(44194),a=n(44528),l=n(62395),s=n(76711),i=n.n(s),o=n(73193),d=n.n(o),u=n(90819),c=n.n(u),p=n(89933),f=n.n(p),g=n(45332),m=n.n(g),v=n(88130),h=n(72264),x=n(13243),M=n(60593),b=n(42876),y=n(89654),k=n(33633),w=n(15065),j=n(77902),S=n(6992),Z=n(41881),P=n(91768),T=n(66759),C=n(61489),F=n(90170),I=n(77686),U=n(38552),E=n(70097),R=n(68992),q=n(91733),A=n(30394),z=(n(98257),n(57648),n(23968),n(51898)),K=n(28672),D=n(65448),N=n(34519),O=n(84005),L=n(31549),Q="welcome",V=function(){var e=(0,l.useIntl)(),t=(0,I.u)((function(e){return e.currentOrg})),n=(0,U.Z)().leftSiderStyle,s=(0,E.Z)().isDarkMode,o=(0,r.useState)(!1),u=m()(o,2),p=u[0],g=u[1],V=(0,r.useState)([]),B=m()(V,2),H=B[0],G=B[1],_=(0,r.useState)(),W=m()(_,2),J=W[0],X=W[1],$=(0,r.useState)(""),Y=m()($,2),ee=Y[0],te=Y[1],ne=(0,r.useState)(Q),re=m()(ne,2),ae=re[0],le=re[1],se=(0,r.useState)(!1),ie=m()(se,2),oe=ie[0],de=ie[1],ue=(0,r.useState)(null),ce=m()(ue,2),pe=ce[0],fe=ce[1],ge=(0,r.useMemo)((function(){return H.find((function(e){return e.uid===J}))||null}),[H,J]),me=(0,r.useState)(!1),ve=m()(me,2),he=ve[0],xe=ve[1],Me=(0,r.useState)(!1),be=m()(Me,2),ye=be[0],ke=be[1],we=(0,r.useState)(!1),je=m()(we,2),Se=je[0],Ze=je[1],Pe=(0,r.useRef)(""),Te=(0,q.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),Ce=Te.setCurrentRobotSettings,Fe=Te.currentRobotSettings,Ie=(0,r.useMemo)((function(){if(!ee)return H;var e=ee.toLowerCase();return H.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[H,ee]),Ue=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var a,l,s,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return g(!0),e.prev=3,l=(null!=n?n:"").trim(),s={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:l||void 0},e.next=8,(0,F.VW)(s);case 8:i=e.sent,console.log("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",i,s),o=(null==i||null===(a=i.data)||void 0===a?void 0:a.content)||[],G(o),!(o.length>0)||J&&o.some((function(e){return e.uid===J}))||(X(o[0].uid),null!=r&&r.keepActive||le(Q));case 13:return e.prev=13,g(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,J]);(0,r.useEffect)((function(){Ue(ee)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){ge?(Ce(ge),Pe.current=JSON.stringify(null!=ge?ge:{}),Ze(!1)):(Ce(null),Pe.current=JSON.stringify({}),Ze(!1))}),[null==ge?void 0:ge.uid]),(0,r.useEffect)((function(){if(ge)try{var e,t,n=JSON.stringify(null!=Fe?Fe:{}),r=n!==Pe.current;console.log("ğŸ” [Dirty Check]",{isDirty:r,selectedUid:null==ge?void 0:ge.uid,currentWelcomeTip:(null==Fe||null===(e=Fe.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==Fe||null===(t=Fe.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:Pe.current.length,nowLength:n.length}),Ze(r)}catch(e){Ze(!0)}}),[Fe,null==ge?void 0:ge.uid]);var Ee=function(){var n=f()(c()().mark((function n(r){var a,l,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:ge)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return l={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,F.r$)(l);case 6:(s=n.sent)&&200===s.code?(C.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),Ue(ee)):C.yw.error((null==s?void 0:s.message)||"åˆ é™¤å¤±è´¥");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Re=function(){var n=f()(c()().mark((function n(r,a){var l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,F.sK)({uid:r,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(l=n.sent)&&200===l.code?(C.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),Ue(ee)):C.yw.error((null==l?void 0:l.message)||"æ“ä½œå¤±è´¥"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",n.t0),C.yw.error("æ“ä½œå¤±è´¥");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),qe=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Ae=function(e){if(e){var t=qe(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return qe(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return d()(d()({},t),n?{toolbar:n}:{})}},ze=function(e){if(e)return qe(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ke=function(e){if(e)return qe(e,["name","description","color","order"])},De=function(e){if(e)return qe(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Ne=function(){var n=f()(c()().mark((function n(){var r,a,l,s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ge&&ge.uid){n.next=3;break}return C.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:return xe(!0),n.prev=4,r=Fe&&Fe.uid===ge.uid?Fe:ge,a={uid:ge.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,serviceSettings:Ae(null==r?void 0:r.draftServiceSettings),inviteSettings:ze(null==r?void 0:r.draftInviteSettings),intentionSettings:Ke(null==r?void 0:r.draftIntentionSettings),rateDownSettings:De(null==r?void 0:r.draftRateDownSettings)},n.next=9,(0,F.sK)(a);case 9:l=n.sent,console.log("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",l,a),l&&200===l.code?(C.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),Pe.current=JSON.stringify(null!==(s=null!==(i=l.data)&&void 0!==i?i:r)&&void 0!==s?s:{}),Ze(!1),Ue(ee)):C.yw.error((null==l?void 0:l.message)||"ä¿å­˜å¤±è´¥"),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(4),console.error("ä¿å­˜å¤±è´¥:",n.t0),C.yw.error("ä¿å­˜å¤±è´¥");case 18:return n.prev=18,xe(!1),n.finish(18);case 21:case"end":return n.stop()}}),n,null,[[4,14,18,21]])})));return function(){return n.apply(this,arguments)}}(),Oe=function(){var n=f()(c()().mark((function n(){var r,a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ge&&ge.uid){n.next=3;break}return C.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:if(ke(!0),n.prev=4,!Se){n.next=8;break}return n.next=8,Ne();case 8:return r={uid:ge.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,F.KF)(r);case 11:(a=n.sent)&&200===a.code?(C.yw.success(e.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),Pe.current=JSON.stringify(null!==(l=a.data)&&void 0!==l?l:{}),Ze(!1),Ue(ee,{keepActive:!0})):C.yw.error((null==a?void 0:a.message)||"å‘å¸ƒå¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("å‘å¸ƒå¤±è´¥:",n.t0),C.yw.error("å‘å¸ƒå¤±è´¥");case 19:return n.prev=19,ke(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Le=(0,r.useMemo)((function(){return null!=ge&&ge.uid?[{key:"welcome",label:(0,L.jsx)(l.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"}),children:(0,L.jsx)(D.Z,{type:R._X4,settingsUid:ge.uid})},{key:"tips",label:(0,L.jsx)(l.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"}),children:(0,L.jsx)(K.Z,{type:R._X4,settingsUid:ge.uid})},{key:"service",label:(0,L.jsx)(l.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"}),children:(0,L.jsx)(z.Z,{type:R._X4,settingsUid:ge.uid})},{key:"rate",label:(0,L.jsx)(l.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,L.jsx)(O.Z,{type:R._X4,settingsUid:ge.uid})}].concat(i()([]),[{key:"right",label:(0,L.jsx)(l.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,L.jsx)(A.Z,{type:R._X4,settingsUid:ge.uid,isActive:"right"===ae})}],i()([]),i()([])):[]}),[null==ge?void 0:ge.uid,e]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,L.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,L.jsxs)(T.Z,{title:e.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:(0,L.jsx)(h.ZP,{size:"small",icon:(0,L.jsx)(S.Z,{}),type:"primary",onClick:function(){fe(null),de(!0)},children:(0,L.jsx)(l.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}),bodyStyle:{padding:8},loading:p,children:[(0,L.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,L.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:ee,onChange:function(e){return te(e.target.value)},onSearch:function(e){te(e),Ue(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,L.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,L.jsx)(M.Z,{dataSource:Ie,locale:{emptyText:(0,L.jsx)(b.Z,{description:e.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:b.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,L.jsx)(M.Z.Item,{style:J===e.uid?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return X(e.uid)},children:(0,L.jsx)(M.Z.Item.Meta,{title:(0,L.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,L.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,L.jsx)(y.Z,{size:4,children:e.isDefault?(0,L.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null})]}),description:e.description?(0,L.jsx)("div",{style:{color:s?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,L.jsx)(v.Z.Panel,{children:ge?(0,L.jsx)(T.Z,{title:(0,L.jsxs)(y.Z,{children:[(0,L.jsxs)("span",{children:[e.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",ge.name||ge.uid]}),(0,L.jsx)(w.Z,{checked:!!ge.enabled,onChange:function(e){return Re(ge.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),(0,L.jsx)(h.ZP,{size:"small",icon:(0,L.jsx)(Z.Z,{}),onClick:function(e){var t;e.stopPropagation(),fe(null!=(t=ge)?t:ge),de(!0)},children:"ç¼–è¾‘"}),(0,L.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ee(ge)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,L.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,L.jsx)(P.Z,{}),onClick:function(e){e.stopPropagation()},children:"åˆ é™¤"})}),ge.isDefault?(0,L.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null]}),extra:(0,L.jsxs)(y.Z,{children:[(0,L.jsx)(j.Z,{title:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ",description:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ",okText:"ç»§ç»­å‘å¸ƒ",cancelText:"å–æ¶ˆ",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Oe()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,L.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:ye,type:"default",children:(0,L.jsx)(l.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,L.jsx)(h.ZP,{onClick:function(){ge&&(Ce(ge),Pe.current=JSON.stringify(null!=ge?ge:{}),Ze(!1))},disabled:!Se,children:(0,L.jsx)(l.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,L.jsx)(h.ZP,{type:"primary",loading:he,onClick:Ne,disabled:!Se,children:(0,L.jsx)(l.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,L.jsx)(a.Z,{activeKey:ae,onChange:le,items:Le})}):(0,L.jsx)(T.Z,{children:(0,L.jsx)(b.Z,{description:e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,L.jsx)(N.Z,{open:oe,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:pe,onSuccess:function(){de(!1),Ue(ee)}})]})},B=n(10154),H=n.n(B),G=n(54596),_=n(27401),W=n(94571),J=n(16743),X=n(2915),$=n(47268),Y=n(26608),ee=n(50447),te=n(59853),ne=n(94433),re=n(38956),ae=n(46659),le=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],se=r.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,a=e.min,l=e.max,s=e.step,i=e.marks,o=e.vertical,d=e.range,u=(0,re.Z)(e,le);return(0,L.jsx)(ae.Z,(0,ne.Z)({valueType:"slider",fieldProps:(0,ne.Z)((0,ne.Z)({},n),{},{min:a,max:l,step:s,marks:i,vertical:o,range:d,style:null==n?void 0:n.style}),ref:t,proFieldProps:r,filedConfig:{ignoreWidth:!0}},u))})),ie=n(69650),oe=n(70878),de=n(63052),ue=n(22014),ce=n(65041),pe=n(41558),fe=n(54008),ge=ie.Z.Text,me=function(e){var t,n,a,s,i,o,u,p,g,v,x,M,b,y,k,w,j,Z=e.open,P=e.record,T=e.onClose,U=e.onSuccess,E=(0,l.useIntl)(),q=(0,I.u)((function(e){return e.currentOrg})),A=(0,r.useMemo)((function(){return!(null==P||!P.uid)}),[P]),z=(0,r.useState)(!1),K=m()(z,2),D=K[0],O=K[1],Q=(0,r.useState)([]),V=m()(Q,2),B=(V[0],V[1]),G=(0,r.useState)(!1),ne=m()(G,2),re=ne[0],ae=ne[1],le=(0,r.useState)(0),ie=m()(le,2),me=ie[0],ve=ie[1],he=(0,r.useRef)(),xe=(0,r.useState)((null==P?void 0:P.avatar)||""),Me=m()(xe,2),be=Me[0],ye=Me[1],ke=(0,r.useState)((null==P?void 0:P.type)||R.f4h),we=m()(ke,2),je=we[0],Se=we[1],Ze=(0,r.useState)((null==P?void 0:P.system)||!1),Pe=m()(Ze,2),Te=Pe[0],Ce=Pe[1],Fe=(0,r.useState)([]),Ie=m()(Fe,2),Ue=Ie[0],Ee=Ie[1],Re=(0,r.useState)({}),qe=m()(Re,2),Ae=qe[0],ze=qe[1],Ke=(0,r.useState)(!1),De=m()(Ke,2),Ne=De[0],Oe=De[1],Le=(0,r.useState)(""),Qe=m()(Le,2),Ve=Qe[0],Be=Qe[1],He=(0,r.useState)(""),Ge=m()(He,2),_e=Ge[0],We=Ge[1],Je=(0,r.useState)(""),Xe=m()(Je,2),$e=Xe[0],Ye=Xe[1],et=(0,r.useState)(""),tt=m()(et,2),nt=tt[0],rt=tt[1],at=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,a,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ae(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==q?void 0:q.uid,searchText:t||""},e.next=5,(0,F.VW)(r);case 5:return a=e.sent,l=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],B(l),e.abrupt("return",l.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (é»˜è®¤)":"").concat(e.enabled?"":" (å·²åœç”¨)"),value:e.uid}})));case 9:return e.prev=9,ae(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==q?void 0:q.uid]);(0,r.useEffect)((function(){var e,t,n,r,a,l,s,i,o,d,u,c,p,f,g,m,v,h,x,M,b,y;Z&&(ye((null==P?void 0:P.avatar)||""),Se((null==P?void 0:P.type)||R.f4h),Ce((null==P?void 0:P.system)||!1),null===(e=he.current)||void 0===e||e.setFieldsValue({nickname:null==P?void 0:P.nickname,type:null==P?void 0:P.type,settingsUid:null==P||null===(t=P.settings)||void 0===t?void 0:t.uid,name:null==P?void 0:P.name,categoryUid:null==P?void 0:P.categoryUid,provider:null==P||null===(n=P.llm)||void 0===n?void 0:n.textProvider,model:null==P||null===(r=P.llm)||void 0===r?void 0:r.textModel,prompt:null==P||null===(a=P.llm)||void 0===a?void 0:a.prompt,description:null==P?void 0:P.description,enabled:null==P||null===(l=P.llm)||void 0===l?void 0:l.enabled,enableThinking:null==P||null===(s=P.llm)||void 0===s?void 0:s.enableThinking,enableStreaming:null==P||null===(i=P.llm)||void 0===i?void 0:i.enableStreaming,temperature:null==P||null===(o=P.llm)||void 0===o?void 0:o.temperature,topP:null==P||null===(d=P.llm)||void 0===d?void 0:d.topP,topK:null==P||null===(u=P.llm)||void 0===u?void 0:u.topK,scoreThreshold:null==P||null===(c=P.llm)||void 0===c?void 0:c.scoreThreshold,maxTokens:null==P||null===(p=P.llm)||void 0===p?void 0:p.maxTokens,contextMsgCount:null==P||null===(f=P.llm)||void 0===f?void 0:f.contextMsgCount,defaultReply:null==P||null===(g=P.llm)||void 0===g?void 0:g.defaultReply,searchType:(null==P||null===(m=P.llm)||void 0===m?void 0:m.searchType)||R.rk3,kbSourceEnabled:null==P?void 0:P.kbSourceEnabled,kbEnabled:null==P?void 0:P.kbEnabled,kbUid:null==P?void 0:P.kbUid}),null!=P&&P.llm&&(null!=P&&null!==(v=P.llm)&&void 0!==v&&v.textProviderUid||null!=P&&null!==(h=P.llm)&&void 0!==h&&h.textProvider||null!=P&&null!==(x=P.llm)&&void 0!==x&&x.textModel)?(Be((null==P||null===(M=P.llm)||void 0===M?void 0:M.textProvider)||""),We((null==P||null===(b=P.llm)||void 0===b?void 0:b.textProviderUid)||""),Ye((null==P||null===(y=P.llm)||void 0===y?void 0:y.textModel)||"")):(Be(""),We(""),Ye("")))}),[Z,P]);var lt=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye(t),!A||!P){e.next=13;break}return e.prev=2,n={uid:null==P?void 0:P.uid,avatar:t},e.next=6,(0,W.lz)(n);case 6:200===(null==(r=e.sent)?void 0:r.code)?(C.yw.success(E.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),null==U||U(r.data)):C.yw.error((null==r?void 0:r.message)||E.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),C.yw.error(E.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),st=(0,r.useCallback)(f()(c()().mark((function e(){var t,n,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==q?void 0:q.uid,level:R.whQ},e.next=4,(0,J.mK)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)&&(a=(null==n||null===(r=n.data)||void 0===r?void 0:r.content)||[],Ee(a),_e&&!Ve&&(l=a.find((function(e){return e.uid===_e})))&&Be(l.type),!_e&&Ve&&(s=a.find((function(e){return e.type===Ve})))&&We(s.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==q?void 0:q.uid,_e,Ve]);(0,r.useEffect)((function(){Z&&st()}),[Z,st]);var it=(0,r.useCallback)((function(){return Oe(!0)}),[]),ot=(0,r.useCallback)((function(){return Oe(!1)}),[]),dt=(0,r.useCallback)((function(e,t){ze((function(n){return d()(d()({},n),{},H()({},e,t))}))}),[]),ut=(0,r.useCallback)((function(e,t,n){var r,a=Ue.find((function(t){return t.uid===e})),l=a?a.type:e;Be(l),We(e),Ye(t),rt(n),null===(r=he.current)||void 0===r||r.setFieldsValue({provider:l,model:t}),Oe(!1)}),[Ue]);return(0,L.jsxs)(X.a,{open:Z,onOpenChange:function(e){e||T()},title:E.formatMessage({id:"robot.edit",defaultMessage:"ç¼–è¾‘æœºå™¨äºº"}),width:560,formRef:he,initialValues:A?{nickname:null==P?void 0:P.nickname,type:null==P?void 0:P.type,settingsUid:null==P||null===(t=P.settings)||void 0===t?void 0:t.uid,name:null==P?void 0:P.name,categoryUid:null==P?void 0:P.categoryUid,provider:null==P||null===(n=P.llm)||void 0===n?void 0:n.textProvider,model:null==P||null===(a=P.llm)||void 0===a?void 0:a.textModel,prompt:null==P||null===(s=P.llm)||void 0===s?void 0:s.prompt,description:null==P?void 0:P.description,enabled:null==P||null===(i=P.llm)||void 0===i?void 0:i.enabled,enableThinking:null==P||null===(o=P.llm)||void 0===o?void 0:o.enableThinking,enableStreaming:null==P||null===(u=P.llm)||void 0===u?void 0:u.enableStreaming,temperature:null==P||null===(p=P.llm)||void 0===p?void 0:p.temperature,topP:null==P||null===(g=P.llm)||void 0===g?void 0:g.topP,topK:null==P||null===(v=P.llm)||void 0===v?void 0:v.topK,scoreThreshold:null==P||null===(x=P.llm)||void 0===x?void 0:x.scoreThreshold,maxTokens:null==P||null===(M=P.llm)||void 0===M?void 0:M.maxTokens,contextMsgCount:null==P||null===(b=P.llm)||void 0===b?void 0:b.contextMsgCount,defaultReply:null==P||null===(y=P.llm)||void 0===y?void 0:y.defaultReply,searchType:(null==P||null===(k=P.llm)||void 0===k?void 0:k.searchType)||R.rk3,kbSourceEnabled:null==P?void 0:P.kbSourceEnabled,kbEnabled:null==P?void 0:P.kbEnabled,kbUid:null==P?void 0:P.kbUid}:{type:R.f4h,searchType:R.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,L.jsxs)("div",{children:[(0,L.jsx)(h.ZP,{style:{marginRight:8},onClick:function(){return T()},children:E.formatMessage({id:"cancel",defaultMessage:"å–æ¶ˆ"})}),(0,L.jsx)(h.ZP,{type:"primary",onClick:function(){var e,t;return null===(e=he.current)||void 0===e||null===(t=e.submit)||void 0===t?void 0:t.call(e)},children:E.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=f()(c()().mark((function e(t){var n,r,a,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,A&&null!=P&&P.uid){e.next=4;break}return C.yw.warning(E.formatMessage({id:"robot.edit.only",defaultMessage:"å½“å‰ä»…æ”¯æŒç¼–è¾‘ï¼Œè¯·é€šè¿‡æ–°å»ºå…¥å£åˆ›å»ºæœºå™¨äºº"})),e.abrupt("return",!1);case 4:return C.yw.loading(E.formatMessage({id:A?"updating":"creating",defaultMessage:A?"Updating":"Creating"})),a={uid:null==P?void 0:P.uid,nickname:t.nickname,name:t.name,type:t.type||R.f4h,description:t.description,avatar:be,settingsUid:t.settingsUid,kbSourceEnabled:t.kbSourceEnabled,kbEnabled:t.kbEnabled,kbUid:t.kbUid,llm:{prompt:t.prompt,textProvider:Ve||t.provider,textProviderUid:_e||void 0,textModel:$e||t.model,enabled:t.enabled,enableThinking:t.enableThinking,enableStreaming:t.enableStreaming,temperature:t.temperature,topP:t.topP,topK:t.topK,scoreThreshold:t.scoreThreshold,maxTokens:t.maxTokens,contextMsgCount:t.contextMsgCount,defaultReply:t.defaultReply,searchType:t.searchType}},e.next=8,(0,W.$l)(a);case 8:if(r=e.sent,console.log("updateRobot:",r,a),C.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=18;break}return C.yw.success(E.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==U||U(r.data),T(),e.abrupt("return",!0);case 18:return C.yw.error((null===(l=r)||void 0===l?void 0:l.message)||E.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.abrupt("return",!1);case 20:e.next=27;break;case 22:return e.prev=22,e.t0=e.catch(0),C.yw.destroy(),C.yw.error(E.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"})),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,L.jsx)(oe.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:E.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"å¤´åƒ"}),children:(0,L.jsxs)(ce.G,{onSuccess:lt,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,L.jsx)(_.Z,{src:be}),(0,L.jsx)(h.ZP,{icon:(0,L.jsx)(ue.Z,{}),style:{marginLeft:12},children:E.formatMessage({id:"pages.robot.upload",defaultMessage:"ä¸Šä¼ "})})]},"avatar")}),je===R.Qeb&&Te&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)($.Z,{name:"name",hidden:!0,label:E.formatMessage({id:"name",defaultMessage:"åç§°"}),fieldProps:{placeholder:Te&&je===R.Qeb?"ç³»ç»Ÿä»£ç†ä¸å¯ä¿®æ”¹åç§°":void 0},disabled:Te&&je===R.Qeb}),(0,L.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:-20,marginBottom:10},children:"ç³»ç»Ÿå†…ç½®ä»£ç†ï¼Œæ— æ³•ä¿®æ”¹åç§°"})]}),(0,L.jsx)($.Z,{name:"nickname",label:E.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),rules:[{required:!0,message:E.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"})}]}),(0,L.jsx)(Y.Z,{name:"description",label:E.formatMessage({id:"description",defaultMessage:"æè¿°"})}),je===R.f4h&&(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(ee.Z,{name:"settingsUid",label:E.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),placeholder:E.formatMessage({id:"robot.settings.placeholder",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"}),rules:[{required:!0,message:E.formatMessage({id:"robot.settings.required",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:me},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",at(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:re},addonAfter:(0,L.jsx)(h.ZP,{size:"small",icon:(0,L.jsx)(S.Z,{}),onClick:function(){return O(!0)},title:E.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"}),children:E.formatMessage({id:"common.new",defaultMessage:"æ–°å»º"})})})}),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{children:[(0,L.jsx)(ge,{style:{marginBottom:8,display:"block"},children:"æ–‡å­—å¯¹è¯æ¨¡å‹æä¾›å•†"}),(0,L.jsx)(de.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:it,children:(_e||Ve)&&$e?(0,L.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,L.jsxs)("div",{children:[(0,L.jsx)(ge,{type:"secondary",children:"ä¾›åº”å•†ï¼š"}),(0,L.jsx)(ge,{strong:!0,children:(null===(w=Ue.find((function(e){return e.uid===_e})))||void 0===w?void 0:w.nickname)||(null===(j=Ue.find((function(e){return e.type===Ve})))||void 0===j?void 0:j.nickname)||Ve}),(0,L.jsx)("br",{}),(0,L.jsx)(ge,{type:"secondary",children:"æ¨¡å‹ï¼š"}),(0,L.jsx)(ge,{strong:!0,children:nt||$e})]}),(0,L.jsx)(h.ZP,{type:"primary",children:"æ›´æ¢æ¨¡å‹"})]}):(0,L.jsx)("div",{style:{textAlign:"center"},children:(0,L.jsx)(h.ZP,{type:"primary",children:"é€‰æ‹©AIæ¨¡å‹"})})}),(0,L.jsxs)("div",{style:{display:"none"},children:[(0,L.jsx)(ee.Z,{name:"provider"}),(0,L.jsx)(ee.Z,{name:"model"})]})]}),(0,L.jsx)(te.Z,{name:"enabled",label:E.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨"})}),(0,L.jsx)(te.Z,{name:"enableThinking",label:E.formatMessage({id:"pages.prompt.enableThinking",defaultMessage:"å¯ç”¨æ€è€ƒ"})}),(0,L.jsx)(te.Z,{name:"enableStreaming",label:E.formatMessage({id:"pages.prompt.enableStreaming",defaultMessage:"å¯ç”¨æµå¼"})}),(0,L.jsx)(se,{name:"temperature",label:E.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),fieldProps:{min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}}}),(0,L.jsx)(se,{name:"topP",label:E.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"}),fieldProps:{min:0,max:1,step:.1,marks:{0:"0",.5:"0.5",1:"1"}}}),(0,L.jsx)(se,{name:"topK",label:E.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),fieldProps:{min:0,max:100,step:1}}),(0,L.jsx)(se,{name:"scoreThreshold",label:E.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"å¾—åˆ†é˜ˆå€¼"}),fieldProps:{min:0,max:1,step:.01,marks:{0:"0",.5:"0.5",1:"1"}}}),(0,L.jsx)(se,{name:"maxTokens",label:E.formatMessage({id:"pages.prompt.maxTokens",defaultMessage:"æœ€å¤§Tokens"}),fieldProps:{min:0,max:8192,step:1}}),(0,L.jsx)(se,{name:"contextMsgCount",label:E.formatMessage({id:"pages.prompt.contextMsgCount",defaultMessage:"ä¸Šä¸‹æ–‡æ¶ˆæ¯æ•°"}),fieldProps:{min:0,max:50,step:1}}),(0,L.jsx)(ee.Z,{name:"searchType",label:E.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),valueEnum:H()(H()(H()({},R.ccx,{text:"å…¨æ–‡"}),R.DGp,{text:"å‘é‡"}),R.rk3,{text:"æ··åˆ"})}),(0,L.jsx)(Y.Z,{name:"prompt",label:E.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})}),(0,L.jsx)(Y.Z,{name:"defaultReply",label:E.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"é»˜è®¤å›å¤"})})]}),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(te.Z,{name:"kbSourceEnabled",label:E.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"})}),(0,L.jsx)(te.Z,{name:"kbEnabled",label:E.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"å¯ç”¨çŸ¥è¯†åº“"})}),(0,L.jsx)(ee.Z,{name:"kbUid",label:E.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),placeholder:E.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"è¯·é€‰æ‹©çŸ¥è¯†åº“"}),showSearch:!0,debounceTime:300,request:function(){var e=f()(c()().mark((function e(t){var n,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:R.QPQ,orgUid:null==q?void 0:q.uid,searchText:n||""},e.next=5,(0,fe.AP)(a);case 5:return l=e.sent,s=(null==l||null===(r=l.data)||void 0===r?void 0:r.content)||[],e.abrupt("return",s.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()})]}),(0,L.jsx)(pe.Z,{visible:Ne,onCancel:ot,onOk:ut,initialProvider:_e||Ve,initialModel:$e,initialModelLabel:nt,providers:Ue,currentOrgUid:null==q?void 0:q.uid,existingProviderModels:Ae,onModelsLoaded:dt,allowedModelTypes:[R.l55,R.xZ8,"CHAT"]}),(0,L.jsx)(N.Z,{open:D,onOpenChange:O,orgUid:(null==q?void 0:q.uid)||"",record:null,onSuccess:function(){O(!1),ve((function(e){return e+1}))}})]})},ve=n(47239),he=n(66248),xe=function(e){var t,n=e.open,a=e.record,s=e.value,i=e.onClose,o=e.onSaved,u=(0,l.useIntl)(),p=(0,r.useState)(s||(null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)||""),g=m()(p,2),v=g[0],x=g[1];(0,r.useEffect)((function(){var e,t;x(null!==(e=null!=s?s:null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[n,s,null==a?void 0:a.uid]);var M=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(v||"");case 3:C.yw.success(u.formatMessage({id:"copy.success",defaultMessage:"å¤åˆ¶æˆåŠŸ"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),C.yw.error(u.formatMessage({id:"copy.failed",defaultMessage:"å¤åˆ¶å¤±è´¥"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=f()(c()().mark((function e(){var t,n,r,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return null==i||i(),e.abrupt("return");case 3:return e.prev=3,C.yw.loading(u.formatMessage({id:"saving",defaultMessage:"Saving..."})),n=a,r=d()(d()({uid:n.uid,name:n.name,nickname:n.nickname,description:n.description,avatar:n.avatar,type:n.type},n.type===R.f4h&&null!==(t=n.settings)&&void 0!==t&&t.uid?{settingsUid:n.settings.uid}:{}),{},{llm:d()(d()({},n.llm||{}),{},{prompt:v})}),e.next=9,(0,W.$l)(r);case 9:l=e.sent,C.yw.destroy(),200===(null==l?void 0:l.code)?(C.yw.success(u.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==o||o()):C.yw.error((null==l?void 0:l.message)||u.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),C.yw.destroy(),C.yw.error(u.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(){return e.apply(this,arguments)}}();return(0,L.jsx)(he.Z,{open:n,title:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),onCancel:i,footer:[(0,L.jsx)(h.ZP,{onClick:M,children:u.formatMessage({id:"copy",defaultMessage:"å¤åˆ¶"})},"copy"),(0,L.jsx)(h.ZP,{type:"primary",onClick:b,children:u.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})},"save"),(0,L.jsx)(h.ZP,{onClick:i,children:u.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:(0,L.jsx)("div",{children:(0,L.jsx)("textarea",{value:v,onChange:function(e){return x(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})})})})},Me=function(){var e=(0,l.useIntl)(),t=(0,r.useRef)(),n=(0,I.u)((function(e){return e.currentOrg})),a=(0,r.useState)(!1),s=m()(a,2),i=s[0],o=s[1],d=(0,r.useState)(!1),u=m()(d,2),p=u[0],g=u[1],v=(0,r.useState)(null),x=m()(v,2),M=x[0],b=x[1],y=(0,r.useState)(!1),w=m()(y,2),S=w[0],Z=w[1],P=(0,r.useState)(""),T=m()(P,2),F=T[0],U=T[1],E=(0,r.useState)(null),q=m()(E,2),A=q[0],z=q[1],K=(0,r.useState)({}),D=m()(K,2),N=D[0],O=D[1];r.useEffect((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r,a,l,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==n?void 0:n.uid,level:R.whQ},e.next=4,(0,J.mK)(t);case 4:200===(null==(r=e.sent)?void 0:r.code)&&(l=(null==r||null===(a=r.data)||void 0===a?void 0:a.content)||[],s={},l.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(s[e.uid]=t)})),O(s)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null!=n&&n.uid?e():O({})}),[null==n?void 0:n.uid]);var Q=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,L.jsx)(_.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(t,n){var r=null==n?void 0:n.type,a=r===R.Qeb?"green":r===R.f4h?"blue":"purple",l=r===R.f4h?e.formatMessage({id:R.f4h,defaultMessage:"Service"}):r===R.Qeb?e.formatMessage({id:R.Qeb,defaultMessage:"Chat"}):r===R.wG_?e.formatMessage({id:R.wG_,defaultMessage:"Marketing"}):e.formatMessage({id:r||"unknown",defaultMessage:r||"-"});return(0,L.jsx)(k.Z,{color:a,children:l})},hideInSearch:!0},{title:e.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:H()(H()(H()({},R.f4h,{text:e.formatMessage({id:R.f4h,defaultMessage:"Service"})}),R.Qeb,{text:e.formatMessage({id:R.Qeb,defaultMessage:"Chat"})}),R.wG_,{text:e.formatMessage({id:R.wG_,defaultMessage:"Marketing"}),disabled:!0}),hideInTable:!0},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){if((null==n?void 0:n.type)===R.Qeb){var r,a,l=!(null==n||null===(r=n.llm)||void 0===r||!r.textModel);return(0,L.jsx)("a",{onClick:function(){b(n),o(!0)},style:{color:l?void 0:"#ff4d4f"},children:l?(null===(a=n.llm)||void 0===a?void 0:a.textModel)||e.formatMessage({id:"robot.llm.configured",defaultMessage:"æ¨¡å‹å·²é…ç½®"}):e.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"æœªé…ç½®æ¨¡å‹ï¼Œç‚¹å‡»é…ç½®"})})}return null!=n&&n.settings?(0,L.jsx)("a",{onClick:function(){b(n),o(!0)},children:n.settings.name||e.formatMessage({id:"robot.settings.configured",defaultMessage:"å·²é…ç½®"})}):(0,L.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){b(n),o(!0)},children:e.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"æœªé…ç½®ï¼Œç‚¹å‡»é…ç½®"})})}},{title:e.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(t,n){var r,a=null==n||null===(r=n.llm)||void 0===r?void 0:r.prompt;return a?(0,L.jsx)("a",{onClick:function(){U(a),z(n),Z(!0)},children:e.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})}):"-"}},{title:e.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var n,r,a=null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid;return a&&N[a]?N[a]:(null==t||null===(r=t.llm)||void 0===r?void 0:r.textProvider)||"-"}},{title:e.formatMessage({id:"pages.prompt.textProviderUid",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†UID"}),dataIndex:["llm","textProviderUid"],hideInSearch:!0,width:200,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid)||"-"}},{title:e.formatMessage({id:"pages.prompt.model",defaultMessage:"æ¨¡å‹"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textModel)||"-"}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var n,r,a;return 0===(null==t||null===(n=t.llm)||void 0===n?void 0:n.temperature)?"0":null!==(r=null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)&&void 0!==r?r:"-"}},{title:e.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var n,r;return null!==(n=null==t||null===(r=t.llm)||void 0===r?void 0:r.topK)&&void 0!==n?n:"-"}},{title:e.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"çŸ¥è¯†åº“å¯ç”¨"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"æ˜¯":"å¦"}},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,L.jsx)("a",{onClick:function(){return l.history.push("/service/channel")},children:e.formatMessage({id:"robot.get.code",defaultMessage:"è·å–æœºå™¨äººä»£ç "})},"code"),(0,L.jsx)("a",{onClick:function(){b(r),o(!0)},children:e.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,L.jsx)(j.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"åˆ é™¤ç¡®è®¤"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"ç¡®è®¤åˆ é™¤"}),"ã€").concat(null==r?void 0:r.nickname,"ã€‘ï¼Ÿ"),onConfirm:f()(c()().mark((function n(){var a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return C.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,W.gf)(r);case 4:a=n.sent,C.yw.destroy(),200===(null==a?void 0:a.code)?(C.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(l=t.current)||void 0===l||l.reload()):C.yw.error((null==a?void 0:a.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),C.yw.destroy(),C.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,L.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(G.Z,{columns:Q,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:R.f4h}},toolBarRender:function(){return[(0,L.jsx)(h.ZP,{type:"primary",onClick:function(){b(null),g(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=f()(c()().mark((function e(t){var r,a,l,s,i,o,d,u,p,f,g,m,v,h,x,M,b;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,o=null!==(a=null==t?void 0:t.pageSize)&&void 0!==a?a:10,d=null!==(l=null==t?void 0:t.searchText)&&void 0!==l?l:"",u=null!==(s=null==t?void 0:t.type)&&void 0!==s?s:R.f4h,p={pageNumber:i,pageSize:o,categoryUid:"",level:R.whQ,type:u,orgUid:null==n?void 0:n.uid,searchText:d},e.prev=5,e.next=8,(0,W.p0)(p);case 8:if(f=e.sent,console.log("RobotTable queryRobotsByOrg response:",f,p),200!==(null==f?void 0:f.code)){e.next=14;break}return M=(null==f||null===(g=f.data)||void 0===g?void 0:g.content)||[],b=null!==(m=null!==(v=null==f||null===(h=f.data)||void 0===h?void 0:h.totalElements)&&void 0!==v?v:null==f||null===(x=f.data)||void 0===x?void 0:x.numberOfElements)&&void 0!==m?m:M.length,e.abrupt("return",{data:M,total:b,success:!0});case 14:return e.abrupt("return",{data:[],total:0,success:!1});case 17:return e.prev=17,e.t0=e.catch(5),e.abrupt("return",{data:[],total:0,success:!1});case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"robot",defaultMessage:"Robot"})}),i&&(0,L.jsx)(me,{open:i,record:M,onClose:function(){return o(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),p&&(0,L.jsx)(ve.Z,{open:p,onClose:function(){return g(!1)},onSubmit:function(){var n=f()(c()().mark((function n(r){var a,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return C.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,W.lg)(r);case 4:a=n.sent,C.yw.destroy(),200===(null==a?void 0:a.code)?(C.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),g(!1),null===(l=t.current)||void 0===l||l.reload()):C.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),C.yw.destroy(),C.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}),(0,L.jsx)(xe,{open:S,record:A,value:F,onClose:function(){return Z(!1)},onSaved:function(){var e;Z(!1),z(null),null===(e=t.current)||void 0===e||e.reload()}})]})},be=function(){return(0,L.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,L.jsx)(l.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,L.jsx)(Me,{})},{key:"settings",label:(0,L.jsx)(l.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,L.jsx)(V,{})}]})}}}]);