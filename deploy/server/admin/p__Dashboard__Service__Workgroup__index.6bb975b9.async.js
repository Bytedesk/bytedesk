"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{38778:function(e,t,n){n.r(t),n.d(t,{default:function(){return Re}});var r=n(44194),o=n(31167),i=n(19736),s=n(76711),a=n.n(s),l=n(89957),u=n.n(l),d=n(90819),g=n.n(d),c=n(89933),f=n.n(c),v=n(73193),m=n.n(v),p=n(45332),b=n.n(p),h=n(85255),x=n(3925),k=n(9428),S=n(48769),w=n(71876),M=n(12792),j=n(66810),y=n(65513),T=n(77359),R=n(29337),Z=n(68779),C=n(12322),F=n(58087),L=n(32530),P=n(31806),W=n(34600),A=n(56482),q=n(12781),U=n(10162),E=n(90727),I=n(59304),K=n(54881),V=n(47944),z=n(80556),D=n(55785),N=n(79866),O=n(93527),Q=n(64484),H=n(14888),B=n(88449),J=n(26710),G=n(6844),X=n(61952),Y=n(2061),$=(n(47460),n(15012),n(42670)),_=n(23312),ee=n(1725),te=n(20585),ne=n(83281),re=n(21914),oe=n(10154),ie=n.n(oe),se=n(35912),ae=n(44679),le=n(30064),ue=n(22576),de=n(31928),ge=n(68263),ce=n(36125),fe=n(31549),ve=function(e){var t=e.variant,n=e.robotRoutingSettings,o=e.onRobotRoutingSettingsChange,i=le.A.useForm(),s=b()(i,1)[0],a=(0,r.useRef)(!1),l=(0,r.useState)([]),u=b()(l,2),d=u[0],c=u[1],v=(0,H.u)((function(e){return e.currentOrg})),m=(0,ae.Z)().translateString,p=(0,r.useMemo)((function(){var e;return null!==(e=null==n?void 0:n.draft)&&void 0!==e?e:null==n?void 0:n.live}),[n]);(0,r.useEffect)((function(){var e,n;if("workgroup"===t){var r=null!==(e=null==p?void 0:p.robotUid)&&void 0!==e?e:null==p||null===(n=p.robot)||void 0===n?void 0:n.uid;s.setFieldsValue({defaultRobot:null==p?void 0:p.defaultRobot,offlineRobot:null==p?void 0:p.offlineRobot,nonWorktimeRobot:null==p?void 0:p.nonWorktimeRobot,robotUid:r})}}),[t,p,s]);var h=function(){var e=f()(g()().mark((function e(){var t,n,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.current){e.next=3;break}return ce.Z.debug("isLoading: 1",a.current),e.abrupt("return");case 3:return a.current=!0,O.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:G.f4h,orgUid:null==v?void 0:v.uid},e.next=8,(0,se.p0)(t);case 8:n=e.sent,ce.Z.debug("queryRobotsByOrg: ",n),200===n.code?c(null==n||null===(r=n.data)||void 0===r?void 0:r.content):O.yw.error(n.message),a.current=!1,O.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){h()}),[]);var x=function(){var e;null===(e=s.validateFields)||void 0===e||e.call(s,["robotUid"]).catch((function(){return null}))},k=function(e){return function(t){var n,r=!(null==t||null===(n=t.target)||void 0===n||!n.checked);null==o||o(ie()({},e,r)),x()}};return(0,fe.jsx)(le.A,{form:s,style:{marginLeft:"20px"},submitter:!1,children:"workgroup"===t&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(ue.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:k("defaultRobot")}}),(0,fe.jsx)(ue.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:k("offlineRobot")}}),(0,fe.jsx)(ue.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:k("nonWorktimeRobot")}}),(0,fe.jsx)(de.Z,{name:["defaultRobot","offlineRobot","nonWorktimeRobot"],children:function(e){var t=e.defaultRobot,n=e.offlineRobot,r=e.nonWorktimeRobot,i=!!(t||n||r);return(0,fe.jsx)(ge.Z,{name:"robotUid",label:"客服机器人",width:"md",options:d.map((function(e){return{value:e.uid,label:m(e.nickname)}})),rules:[{validator:function(e,t){return i&&!t?Promise.reject(new Error("请选择客服机器人")):Promise.resolve()}}],fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){null==o||o({robotUid:null!=e?e:void 0}),x()}}})}})]})})},me=(n(81005),n(35165)),pe=n(30813),be=n(58867),he=function(){var e=be.Z.useForm(),t=b()(e,1)[0],n=(0,i.useIntl)(),o=(0,X.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),s=o.currentWorkgroupSettings,a=o.setCurrentWorkgroupSettings,l=(0,r.useState)(G.vXk),u=b()(l,2),d=u[0],g=u[1];(0,r.useEffect)((function(){if(s){var e=s;g(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[s]);return(0,fe.jsx)("div",{children:(0,fe.jsxs)(le.A,{form:t,submitter:!1,children:[(0,fe.jsx)(pe.Z.Group,{name:"routingMode",label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:G.vXk},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:G.ZD$},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:G.owQ},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:G.e2F},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:G.zWk},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:G.HQF},{label:(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:G.WDq}],fieldProps:{value:d,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),g(e.target.value)}(e),t=e.target.value,s&&a(m()(m()({},s),{},{routingMode:t}))}}}),(0,fe.jsxs)(le.A.Item,{children:[d===G.vXk&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),d===G.ZD$&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),d===G.owQ&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),d===G.e2F&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),d===G.zWk&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),d===G.HQF&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),d===G.JEC&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),d===G.WDq&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},xe=n(58791),ke=n(74341),Se=n(93312),we=n(86684),Me=function(e){var t=e.robotToAgentSettings,n=e.onRobotToAgentSettingsChange,o=(0,i.useIntl)(),s=le.A.useForm(),a=b()(s,1)[0],l=(0,r.useRef)(!1),u=(0,r.useMemo)((function(){return null!=t?t:{}}),[t]),d=(0,r.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==u?void 0:u.draft)&&void 0!==t?t:null==u?void 0:u.live)&&void 0!==e?e:void 0}),[null==u?void 0:u.draft,null==u?void 0:u.live]),g=o.formatMessage({id:"robot.to.agent.manual.label.default",defaultMessage:"转人工客服"}),c=(0,r.useCallback)((function(e){return Array.from(new Set((null!=e?e:[]).map((function(e){return(null!=e?e:"").trim()})).filter((function(e){return e.length>0}))))}),[]),f=(0,r.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==n||n(e))}),[n]);(0,r.useEffect)((function(){var e,t,n,r,o,i,s,u,c;l.current=!0,a.setFieldsValue({enabled:null===(e=null==d?void 0:d.enabled)||void 0===e||e,keywordTriggerEnabled:null===(t=null==d?void 0:d.keywordTriggerEnabled)||void 0===t||t,triggerKeywords:null!==(n=null==d?void 0:d.triggerKeywords)&&void 0!==n?n:[],minConfidence:null!==(r=null==d?void 0:d.minConfidence)&&void 0!==r?r:65,maxRobotRepliesBeforeTransfer:null!==(o=null==d?void 0:d.maxRobotRepliesBeforeTransfer)&&void 0!==o?o:3,autoTransferDelaySeconds:null!==(i=null==d?void 0:d.autoTransferDelaySeconds)&&void 0!==i?i:0,cooldownSeconds:null!==(s=null==d?void 0:d.cooldownSeconds)&&void 0!==s?s:90,allowVisitorManualTransfer:null===(u=null==d?void 0:d.allowVisitorManualTransfer)||void 0===u||u,manualTransferLabel:null!==(c=null==d?void 0:d.manualTransferLabel)&&void 0!==c?c:g}),l.current=!1}),[d,a,g]);var v=(0,r.useCallback)((function(e){if(!l.current){var t=m()({},e);if("triggerKeywords"in e){var n=c(e.triggerKeywords);t.triggerKeywords=n,n.length!==(e.triggerKeywords||[]).length&&(l.current=!0,a.setFieldsValue({triggerKeywords:n}),l.current=!1)}if("manualTransferLabel"in e&&"string"==typeof e.manualTransferLabel){var r=e.manualTransferLabel.trim();t.manualTransferLabel=r,r!==e.manualTransferLabel&&(l.current=!0,a.setFieldsValue({manualTransferLabel:r}),l.current=!1)}f(t)}}),[f,a,c]),p=(0,r.useCallback)((function(e){var t=e.keys;return(0,fe.jsx)(ke.Z,{type:"generic",keys:t,live:null==u?void 0:u.live,draft:null==u?void 0:u.draft})}),[null==u?void 0:u.draft,null==u?void 0:u.live]);return(0,fe.jsxs)(le.A,{layout:"vertical",form:a,submitter:!1,style:{marginLeft:"20px",maxWidth:640},onValuesChange:v,children:[(0,fe.jsx)(Se.Z,{width:"md",name:"enabled",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.enabled",defaultMessage:"启用机器人转人工策略"}),(0,fe.jsx)(p,{keys:["enabled"]})]})}),(0,fe.jsx)(de.Z,{name:["enabled"],children:function(e){var t=!1===e.enabled;return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Se.Z,{width:"md",name:"keywordTriggerEnabled",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keyword.trigger",defaultMessage:"允许关键词触发"}),(0,fe.jsx)(p,{keys:["keywordTriggerEnabled"]})]}),tooltip:o.formatMessage({id:"robot.to.agent.keyword.trigger.tip",defaultMessage:"访客发送关键词时立即转人工"}),fieldProps:{disabled:t}}),(0,fe.jsx)(ge.Z,{width:"lg",name:"triggerKeywords",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keywords",defaultMessage:"转人工关键词"}),(0,fe.jsx)(p,{keys:["triggerKeywords"]})]}),fieldProps:{mode:"tags",tokenSeparators:[",","，"," ",";","；","\n"],disabled:t||!1===a.getFieldValue("keywordTriggerEnabled"),placeholder:o.formatMessage({id:"robot.to.agent.keywords.placeholder",defaultMessage:"输入关键词并回车确认，可粘贴多个"})},extra:o.formatMessage({id:"robot.to.agent.keywords.extra",defaultMessage:"直接输入关键词，然后回车确认，可设置多个关键词"})}),(0,fe.jsx)(Se.Z,{width:"md",name:"allowVisitorManualTransfer",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.transfer",defaultMessage:"允许访客手动转人工"}),(0,fe.jsx)(p,{keys:["allowVisitorManualTransfer"]})]}),fieldProps:{disabled:t}}),(0,fe.jsx)(de.Z,{name:["allowVisitorManualTransfer"],children:function(e){return!1!==e.allowVisitorManualTransfer?(0,fe.jsx)(we.Z,{width:"lg",name:"manualTransferLabel",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.label",defaultMessage:"手动转人工按钮文案"}),(0,fe.jsx)(p,{keys:["manualTransferLabel"]})]}),fieldProps:{maxLength:20,disabled:t},placeholder:o.formatMessage({id:"robot.to.agent.manual.label.placeholder",defaultMessage:"如：转人工客服"})}):null}})]})}})]})},je="tips",ye=function(){var e=(0,i.useIntl)(),t=(0,H.u)((function(e){return e.currentOrg})),n=(0,B.Z)().leftSiderStyle,s=(0,J.Z)().isDarkMode,l=(0,r.useState)(!1),d=b()(l,2),c=d[0],v=d[1],p=(0,r.useState)([]),G=b()(p,2),oe=G[0],ie=G[1],se=(0,r.useState)(),ae=b()(se,2),le=ae[0],ue=ae[1],de=(0,r.useState)(""),ge=b()(de,2),ce=ge[0],pe=ge[1],be=(0,r.useState)(je),ke=b()(be,2),Se=ke[0],we=ke[1],ye=(0,r.useState)(!1),Te=b()(ye,2),Re=Te[0],Ze=Te[1],Ce=(0,r.useState)(null),Fe=b()(Ce,2),Le=Fe[0],Pe=Fe[1],We=(0,r.useMemo)((function(){return oe.find((function(e){return e.uid===le}))||null}),[oe,le]),Ae=(0,r.useState)(!1),qe=b()(Ae,2),Ue=qe[0],Ee=qe[1],Ie=(0,r.useState)(!1),Ke=b()(Ie,2),Ve=Ke[0],ze=Ke[1],De=(0,r.useState)(!1),Ne=b()(De,2),Oe=Ne[0],Qe=Ne[1],He=(0,r.useRef)(""),Be=(0,X.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Je=Be.setCurrentWorkgroupSettings,Ge=Be.currentWorkgroupSettings,Xe=(0,r.useMemo)((function(){var e;return null!==(e=null!=Ge?Ge:We)&&void 0!==e?e:null}),[Ge,We]),Ye=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftServiceSettings||Ge.serviceSettings||{};Je(m()(m()({},Ge),{},{draftServiceSettings:m()(m()({},t),e)}))}}),[Ge,Je]),$e=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftInviteSettings||Ge.inviteSettings||{};Je(m()(m()({},Ge),{},{draftInviteSettings:m()(m()({},t),e)}))}}),[Ge,Je]),_e=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftMessageLeaveSettings||Ge.messageLeaveSettings||{};Je(m()(m()({},Ge),{},{draftMessageLeaveSettings:m()(m()({},t),e)}))}}),[Ge,Je]),et=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftWorktimeSettings||Ge.worktimeSettings||{};Je(m()(m()({},Ge),{},{draftWorktimeSettings:m()(m()({},t),e)}))}}),[Ge,Je]),tt=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftRobotRoutingSettings||Ge.robotRoutingSettings||{};Je(m()(m()({},Ge),{},{draftRobotRoutingSettings:m()(m()({},t),e)}))}}),[Ge,Je]),nt=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftQueueSettings||Ge.queueSettings||{};Je(m()(m()({},Ge),{},{draftQueueSettings:m()(m()({},t),e)}))}}),[Ge,Je]),rt=(0,r.useCallback)((function(e){if(Ge){var t=Ge.draftRobotToAgentSettings||Ge.robotToAgentSettings||{};Je(m()(m()({},Ge),{},{draftRobotToAgentSettings:m()(m()({},t),e)}))}}),[Ge,Je]),ot=(0,r.useMemo)((function(){if(!ce)return oe;var e=ce.toLowerCase();return oe.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[oe,ce]),it=(0,r.useCallback)(function(){var e=f()(g()().mark((function e(n,r){var o,i,s,a,l;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,i=(null!=n?n:"").trim(),s={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:i||void 0},e.next=8,(0,Q.zc)(s);case 8:a=e.sent,console.log("加载工作组配置模板列表: ",a,s),l=(null==a||null===(o=a.data)||void 0===o?void 0:o.content)||[],ie(l),!(l.length>0)||le&&l.some((function(e){return e.uid===le}))||(ue(l[0].uid),null!=r&&r.keepActive||we(je));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,le]),st=(0,r.useCallback)((function(e){it(null!=e?e:ce)}),[it,ce]);(0,r.useEffect)((function(){it(ce)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){We?(Je(We),He.current=JSON.stringify(null!=We?We:{}),Qe(!1)):(Je(null),He.current=JSON.stringify({}),Qe(!1))}),[null==We?void 0:We.uid]),(0,r.useEffect)((function(){if(We)try{var e=JSON.stringify(null!=Ge?Ge:{});Qe(e!==He.current)}catch(e){Qe(!0)}}),[Ge,null==We?void 0:We.uid]);var at=function(){var n=f()(g()().mark((function n(r){var o,i,s;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=null!=r?r:We)&&o.uid){n.next=3;break}return n.abrupt("return");case 3:return i={uid:o.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,Q.zN)(i);case 6:(s=n.sent)&&200===s.code?(O.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),it(ce)):O.yw.error((null==s?void 0:s.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),lt=function(){var n=f()(g()().mark((function n(r,o){var i;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,Q.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:o});case 3:(i=n.sent)&&200===i.code?(O.yw.success(e.formatMessage({id:o?"common.enabled":"common.disabled",defaultMessage:o?"已启用":"已停用"})),it(ce)):O.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),O.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),ut=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},dt=function(e){return!e||"object"!==u()(e)||0===Object.keys(e).length},gt=function(e){if(e){var t=ut(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return ut(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return m()(m()({},t),n?{toolbar:n}:{})}},ct=function(e){if(e)return ut(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},ft=function(e){if(e)return ut(e,["name","description","color","order"])},vt=function(e){if(e)return ut(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},mt=function(e){if(e)return ut(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},pt=function(e){if(e){var t=ut(e,["enabled","keywordTriggerEnabled","triggerKeywords","minConfidence","maxRobotRepliesBeforeTransfer","autoTransferDelaySeconds","cooldownSeconds","allowVisitorManualTransfer","manualTransferLabel"]),n=m()({},t);return Array.isArray(n.triggerKeywords)&&(n.triggerKeywords=Array.from(new Set(n.triggerKeywords.map((function(e){return(e||"").trim()})).filter((function(e){return e.length>0}))))),"string"==typeof n.manualTransferLabel&&(n.manualTransferLabel=n.manualTransferLabel.trim()),n}},bt=function(e){var t,n;if(e){var r=ut(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),o=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return m()(m()({},r),o?{robotUid:o}:{})}},ht=function(e){if(e)return ut(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},xt=function(){var n=f()(g()().mark((function n(){var r,o,i,s,a,l,u,d,c,f,v,p,b,h;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=We&&We.uid){n.next=3;break}return O.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Ee(!0),n.prev=4,r=Ge&&Ge.uid===We.uid?Ge:We,i=gt((o=function(e,t){return m()(m()({},e||{}),t||{})})(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),s=ct(o(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),a=ft(o(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),l=vt(o(null==r?void 0:r.messageLeaveSettings,null==r?void 0:r.draftMessageLeaveSettings)),u=ht(o(null==r?void 0:r.worktimeSettings,null==r?void 0:r.draftWorktimeSettings)),d=bt(o(null==r?void 0:r.robotRoutingSettings,null==r?void 0:r.draftRobotRoutingSettings)),c=mt(o(null==r?void 0:r.queueSettings,null==r?void 0:r.draftQueueSettings)),f=pt(o(null==r?void 0:r.robotToAgentSettings,null==r?void 0:r.draftRobotToAgentSettings)),v=m()(m()(m()(m()(m()(m()(m()(m()({uid:We.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode},dt(i)?{}:{serviceSettings:i}),dt(s)?{}:{inviteSettings:s}),dt(a)?{}:{intentionSettings:a}),dt(l)?{}:{messageLeaveSettings:l}),dt(u)?{}:{worktimeSettings:u}),dt(d)?{}:{robotRoutingSettings:d}),dt(c)?{}:{queueSettings:c}),dt(f)?{}:{robotToAgentSettings:f}),n.next=18,(0,Q.Y2)(v);case 18:p=n.sent,console.log("保存工作组配置模板: ",p,v),p&&200===p.code?(O.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),He.current=JSON.stringify(null!==(b=null!==(h=null==p?void 0:p.data)&&void 0!==h?h:r)&&void 0!==b?b:{}),Qe(!1),it(ce,{keepActive:!0})):O.yw.error((null==p?void 0:p.message)||"保存失败"),n.next=27;break;case 23:n.prev=23,n.t0=n.catch(4),console.error("保存失败:",n.t0),O.yw.error("保存失败");case 27:return n.prev=27,Ee(!1),n.finish(27);case 30:case"end":return n.stop()}}),n,null,[[4,23,27,30]])})));return function(){return n.apply(this,arguments)}}(),kt=function(){var n=f()(g()().mark((function n(){var r,o,i;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=We&&We.uid){n.next=3;break}return O.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ze(!0),n.prev=4,!Oe){n.next=8;break}return n.next=8,xt();case 8:return r={uid:We.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,Q.Dm)(r);case 11:(o=n.sent)&&200===o.code?(O.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),He.current=JSON.stringify(null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{}),Qe(!1),it(ce)):O.yw.error((null==o?void 0:o.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),O.yw.error("发布失败");case 19:return n.prev=19,ze(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),St=(0,r.useMemo)((function(){return null!=We&&We.uid?[{key:"tips",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(R.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,fe.jsx)(ee.Z,{variant:"workgroup",serviceSettings:{live:null==Xe?void 0:Xe.serviceSettings,draft:null==Xe?void 0:Xe.draftServiceSettings},onServiceSettingsChange:Ye})},{key:"service",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(Z.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"})]}),children:(0,fe.jsx)(_.Z,{variant:"workgroup",serviceSettings:{live:null==Xe?void 0:Xe.serviceSettings,draft:null==Xe?void 0:Xe.draftServiceSettings},onServiceSettingsChange:Ye})},{key:"rate",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(C.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,fe.jsx)(re.Z,{variant:"workgroup",serviceSettings:{live:null==Xe?void 0:Xe.serviceSettings,draft:null==Xe?void 0:Xe.draftServiceSettings},onServiceSettingsChange:Ye})},{key:"robot",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(F.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"robot",defaultMessage:"Robot"})]}),children:(0,fe.jsx)(ve,{variant:"workgroup",robotRoutingSettings:{live:null==Xe?void 0:Xe.robotRoutingSettings,draft:null==Xe?void 0:Xe.draftRobotRoutingSettings},onRobotRoutingSettingsChange:tt})},{key:"robotToAgent",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(L.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"robotToAgent",defaultMessage:"Robot to Agent"})]}),children:(0,fe.jsx)(Me,{variant:"workgroup",robotToAgentSettings:{live:null==Xe?void 0:Xe.robotToAgentSettings,draft:null==Xe?void 0:Xe.draftRobotToAgentSettings},onRobotToAgentSettingsChange:rt})},{key:"messageLeave",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(P.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,fe.jsx)(te.Z,{variant:"workgroup",messageLeaveSettings:{live:null==Xe?void 0:Xe.messageLeaveSettings,draft:null==Xe?void 0:Xe.draftMessageLeaveSettings},onMessageLeaveSettingsChange:_e})},{key:"queue",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(xe.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"workgroup.settings.queue",defaultMessage:"排队设置"})]}),children:(0,fe.jsx)(me.Z,{variant:"workgroup",queueSettings:{live:null==Xe?void 0:Xe.queueSettings,draft:null==Xe?void 0:Xe.draftQueueSettings},onQueueSettingsChange:nt})}].concat(a()([]),[{key:"toolbar",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(W.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,fe.jsx)($.Z,{variant:"workgroup",serviceSettings:{live:null==Xe?void 0:Xe.serviceSettings,draft:null==Xe?void 0:Xe.draftServiceSettings},settingsUid:We.uid,isActive:"toolbar"===Se,onServiceSettingsChange:Ye})},{key:"right",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(A.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,fe.jsx)(Y.Z,{variant:"workgroup",serviceSettings:{live:null==Xe?void 0:Xe.serviceSettings,draft:null==Xe?void 0:Xe.draftServiceSettings},onServiceSettingsChange:Ye,settingsUid:We.uid,isActive:"right"===Se})}],a()([]),[{key:"route",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(q.Z,{})," ",(0,fe.jsx)(i.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"})]}),children:(0,fe.jsx)(he,{})}],a()([])):[]}),[null==We?void 0:We.uid,Xe,e,Ye,$e,_e,tt,rt,et,nt,Se]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(h.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,fe.jsx)(h.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,fe.jsxs)(N.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,fe.jsx)(x.ZP,{size:"small",icon:(0,fe.jsx)(U.Z,{}),type:"primary",onClick:function(){Pe(null),Ze(!0)},children:(0,fe.jsx)(i.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:c,children:[(0,fe.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,fe.jsxs)(k.Z.Compact,{style:{width:"100%"},children:[(0,fe.jsx)(S.Z,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:ce,onChange:function(e){return pe(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;pe(t),st(t)},allowClear:!0,size:"middle"}),(0,fe.jsx)(x.ZP,{type:"primary",icon:(0,fe.jsx)(E.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return st()}})]})}),(0,fe.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,fe.jsx)(w.Z,{dataSource:ot,locale:{emptyText:(0,fe.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,fe.jsx)(w.Z.Item,{style:le===e.uid?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ue(e.uid)},children:(0,fe.jsx)(w.Z.Item.Meta,{title:(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,fe.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,fe.jsx)(k.Z,{size:4,children:e.isDefault?(0,fe.jsx)(j.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,fe.jsx)("div",{style:{color:s?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,fe.jsx)(h.Z.Panel,{children:We?(0,fe.jsx)(N.Z,{title:(0,fe.jsxs)(k.Z,{children:[(0,fe.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",We.name||We.uid]}),(0,fe.jsx)(y.Z,{checked:!!We.enabled,onChange:function(e){return lt(We.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,fe.jsx)(x.ZP,{size:"small",icon:(0,fe.jsx)(I.Z,{}),onClick:function(e){var t;e.stopPropagation(),Pe(null!=(t=We)?t:We),Ze(!0)},children:"编辑"}),(0,fe.jsx)(T.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),at(We)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,fe.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,fe.jsx)(K.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),We.isDefault?(0,fe.jsx)(j.Z,{color:"blue",children:"默认"}):null]}),extra:(0,fe.jsxs)(k.Z,{children:[(0,fe.jsx)(T.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),kt()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,fe.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ve,type:"default",icon:(0,fe.jsx)(V.Z,{}),children:(0,fe.jsx)(i.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,fe.jsx)(x.ZP,{onClick:function(){We&&(Je(We),He.current=JSON.stringify(null!=We?We:{}),Qe(!1))},disabled:!Oe,icon:(0,fe.jsx)(z.Z,{}),children:(0,fe.jsx)(i.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,fe.jsx)(x.ZP,{type:"primary",loading:Ue,onClick:xt,disabled:!Oe,icon:(0,fe.jsx)(D.Z,{}),children:(0,fe.jsx)(i.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,fe.jsx)(o.Z,{activeKey:Se,onChange:we,items:St})}):(0,fe.jsx)(N.Z,{children:(0,fe.jsx)(M.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,fe.jsx)(ne.Z,{open:Re,onOpenChange:Ze,orgUid:(null==t?void 0:t.uid)||"",record:Le,onSuccess:function(){Ze(!1),it(ce)}})]})},Te=n(55141),Re=function(){return(0,fe.jsx)(o.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,fe.jsx)(i.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,fe.jsx)(Te.Z,{})},{key:"settings",label:(0,fe.jsx)(i.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,fe.jsx)(ye,{})}]})}}}]);