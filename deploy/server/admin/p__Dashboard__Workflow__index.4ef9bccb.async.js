"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[761],{28031:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},26608:function(e,t,a){var r=a(94433),n=a(38956),o=a(44194),s=a(46659),i=a(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var a=e.fieldProps,o=e.proFieldProps,d=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:o},d))};t.Z=o.forwardRef(d)},896:function(e,t,a){a.d(t,{$B:function(){return p},Au:function(){return c},_I:function(){return h},rI:function(){return w}});var r=a(90819),n=a.n(r),o=a(73193),s=a.n(o),i=a(89933),l=a.n(i),d=a(68992),u=a(62395);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/query/org",{method:"GET",params:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/create",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return m.apply(this,arguments)}function m(){return(m=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/update",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/delete",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},35994:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var r=a(50885),n=a(38552),o=a(68992),s=a(92066),i=a(84176),l=a.n(i),d=a(73193),u=a.n(d),c=a(90819),f=a.n(c),p=a(89933),g=a.n(p),w=a(45332),m=a.n(w),h=a(44194),M=a(66248),v=a(35068),x=a(72264),y=a(6237),k=a(61489),j=a(896),b=a(62395),S=a(77643),Z=a(77686),C=a(89007),I=a(50447),P=a(47268),T=a(26608),A=a(41059),U=a(89654),q=a(99754),z=a(31549),B=function(e){var t,a,r=e.isEdit,n=e.workflow,s=e.open,i=(e.level,e.onClose),l=e.onSubmit,d=C.A.useForm(),u=m()(d,1)[0],c=(0,b.useIntl)(),f=(0,Z.u)((function(e){return e.currentOrg})),p=(0,h.useState)(),g=m()(p,2),w=g[0],M=g[1],v=(0,S.v)((function(e){return e.categoryResult})),y=(0,q.Z)().translateString;(0,h.useEffect)((function(){if(r&&n&&u){var e;u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid});var t=null==v||null===(e=v.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==n?void 0:n.categoryUid)}));M(t)}else console.log("form resetFields"),u.resetFields()}),[n,u,r,null==v||null===(t=v.data)||void 0===t?void 0:t.content]);return(0,z.jsx)("div",{children:(0,z.jsx)(A.Z,{title:r?c.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):c.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:i,open:s,extra:(0,z.jsxs)(U.Z,{children:[(0,z.jsx)(x.ZP,{onClick:i,children:c.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,z.jsx)(x.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==n?void 0:n.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==w?void 0:w.uid,orgUid:null==f?void 0:f.uid};console.log("workflowObject:",t),l(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:c.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,z.jsxs)(C.A,{form:u,name:"workflow",submitter:!1,children:[(0,z.jsx)(I.Z,{label:c.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==v||null===(a=v.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==o.zBg})))||void 0===a?void 0:a.map((function(e){return{label:y(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),M(null==v||null===(t=v.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,z.jsx)(P.Z,{label:c.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:c.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,z.jsx)(P.Z,{label:c.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:c.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:c.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,z.jsx)(T.Z,{label:c.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:c.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,z.jsx)(T.Z,{label:c.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:c.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},E=a(83381),F=a(32164),H=a(6992),O=a(28031),D=a(80503),R=a(54596),Y=a(45634),J=a.n(Y),W=a(87005),N=a(62134),X=["current","pageSize","content"],L=function(e){var t=e.level,a=(e.type,(0,h.useRef)()),r=(0,b.useIntl)(),n=(0,h.useState)(!0),s=m()(n,2),i=s[0],d=s[1],c=(0,q.Z)().translateString,p=(0,h.useState)(1),w=m()(p,2),C=w[0],I=w[1],P=(0,h.useState)(10),T=m()(P,2),A=T[0],U=T[1],Y=(0,h.useState)(!1),L=m()(Y,2),Q=L[0],V=L[1],_=(0,h.useState)([]),G=m()(_,2),K=(G[0],G[1]),$=(0,h.useState)({}),ee=m()($,2),te=ee[0],ae=ee[1],re=(0,S.v)((function(e){return e.currentCategory})),ne=(0,Z.u)((function(e){return e.currentOrg})),oe=M.Z.useModal(),se=m()(oe,2),ie=se[0],le=se[1],de=(0,h.useState)(0),ue=m()(de,2),ce=ue[0],fe=ue[1],pe=(0,h.useState)({}),ge=m()(pe,2),we=ge[0],me=ge[1],he=function(){var e=g()(f()().mark((function e(t){var n,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,j._I)(t);case 3:200===(n=e.sent).code?(k.yw.destroy(),k.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=a.current)||void 0===o||o.reload()):(k.yw.destroy(),k.yw.error(n.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(f()().mark((function e(t){var n,o,s,l;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=8;break}return k.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,j.rI)(t);case 4:200===(n=e.sent).code?(k.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=a.current)||void 0===o||o.reload(),V(!1)):k.yw.error(n.message),e.next=13;break;case 8:return k.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,j.$B)(t);case 11:200===(s=e.sent).code?(k.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(l=a.current)||void 0===l||l.reload(),V(!1)):k.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var ve=function(){var e=g()(f()().mark((function e(a,r,n){var s,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),s=localStorage.getItem(o.LA8),i=u()({categoryUid:(null==re?void 0:re.uid)===o.zBg?"":null==re?void 0:re.uid,orgUid:t===o.Hxq?"":null==ne?void 0:ne.uid,level:t,accessToken:s||"",exportType:a},we),"current"===a?(i.pageNumber=String(C-1),i.pageSize=String(A)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(i.pageNumber=String(r),i.pageSize=String(n)),window.open((0,W.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),xe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=o,n=o*a+1,s=Math.min((o+1)*a,e);t.push({key:"export-".concat(o),label:"".concat(n,"-").concat(s," (").concat(s-n+1,"条)"),onClick:function(){return ve("range",r,a)}})},o=0;o<r;o++)n();return t},ye=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",n=function(){var e=g()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.TE)(t);case 2:e.sent.success?k.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):k.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,z.jsx)(v.Z,{content:(0,z.jsxs)("div",{children:[(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,z.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,z.jsx)(x.ZP,{type:"text",icon:(0,z.jsx)(F.Z,{}),onClick:function(e){e.stopPropagation(),n(a)},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,z.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,z.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?J()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?J()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,z.jsx)("a",{onClick:function(){return function(e){d(!0),ae(e),V(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,z.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,z.jsx)(E.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(c(e.name),"】？"),onOk:function(){he(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(f()().mark((function e(a,n,s){var i,d,c,p,g,w,m,h,M;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),i=a.current,d=a.pageSize,c=a.content,p=l()(a,X),I(i),U(d),me(u()(u()({},p),{},{content:c})),g=void 0,w=void 0,n&&Object.keys(n).length>0&&(m=Object.keys(n)[0],g=m,w="ascend"===n[m]?"ascend":"descend"),h=u()(u()({pageNumber:i-1,pageSize:d,name:"",orgUid:t===o.Hxq?"":null==ne?void 0:ne.uid,categoryUid:(null==re?void 0:re.uid)===o.zBg?"":null==re?void 0:re.uid,level:t},p),{},{content:c,sortBy:g,sortDirection:w}),e.next=11,(0,j.Au)(h);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,h),200!==M.code){e.next=20;break}return k.yw.destroy(),K(M.data.content),fe(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return k.yw.destroy(),k.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(R.Z,{columns:ye,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){I(e),U(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,z.jsx)(x.ZP,{type:"primary",onClick:function(){window.open((0,W.HU)(),"_blank")},icon:(0,z.jsx)(H.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,z.jsx)(O.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,z.jsx)(O.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ve("all")}}):t.push({key:"export-range",icon:(0,z.jsx)(O.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:xe(ce)})),e.push((0,z.jsx)(y.Z,{menu:{items:t},placement:"bottom",children:(0,z.jsxs)(x.ZP,{type:"primary",icon:(0,z.jsx)(O.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,z.jsx)(D.Z,{})]})},"export")),e},request:ke}),Q&&(0,z.jsx)(B,{isEdit:i,workflow:te,level:t,open:Q,onClose:function(){return V(!1)},onSubmit:Me}),le]})},Q=r.Z.Sider,V=r.Z.Content,_=function(){var e=(0,n.Z)(),t=e.leftSiderStyle,a=e.leftSiderWidth,i=e.contentStyle;return(0,z.jsxs)(r.Z,{children:[(0,z.jsx)(Q,{width:a,style:t,children:(0,z.jsx)(s.Z,{type:o.H8R,level:o.whQ,showKbase:!1})}),(0,z.jsx)(r.Z,{children:(0,z.jsx)(V,{style:i,children:(0,z.jsx)(L,{level:o.whQ})})})]})}}}]);