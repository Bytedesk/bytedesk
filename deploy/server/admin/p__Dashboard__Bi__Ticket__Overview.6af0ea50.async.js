"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4577],{16829:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(83910),i=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},s=n(5901),c=function(e,t){return i.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var o=i.forwardRef(c)},83381:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(83910),i=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=n(5901),c=function(e,t){return i.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var o=i.forwardRef(c)},55072:function(e,t,n){n.d(t,{If:function(){return g},dF:function(){return d},j4:function(){return h},v$:function(){return p}});var r=n(90819),i=n.n(r),a=n(73193),s=n.n(a),c=n(89933),o=n.n(c),l=n(68992),u=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/department/query/org",{method:"GET",params:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/department/create",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/department/update",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return k.apply(this,arguments)}function k(){return(k=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/department/delete",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},22261:function(e,t,n){n.d(t,{AD:function(){return d},Tl:function(){return p}});var r=n(90819),i=n.n(r),a=n(73193),s=n.n(a),c=n(89933),o=n.n(c),l=n(68992),u=n(62395);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ticket/statistic/calculate",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},30310:function(e,t,n){n.r(t);var r=n(90819),i=n.n(r),a=n(89933),s=n.n(a),c=n(45332),o=n.n(c),l=n(44194),u=n(35079),d=n(78380),f=n(67194),p=n(63052),m=n(89654),h=n(92393),v=n(72264),g=n(21478),k=n(22888),x=n(35490),y=n(44966),j=n(35911),T=n(33e3),b=n(14546),w=n(16829),M=n(83381),Z=n(62395),D=n(22261),R=n(61489),Y=n(77686),S=n(66675),z=n(6677),C=n(99754),I=n(68992),O=n(45634),B=n.n(O),E=n(55072),q=n(74956),F=n(31549),P=u.default.RangePicker,U=d.Z.Option;t.default=function(){var e,t,n=(0,Z.useIntl)(),r=(0,C.Z)().translateStringTranct,a=(0,l.useState)(B()().startOf("day")),c=o()(a,2),u=c[0],O=c[1],J=(0,l.useState)(B()().endOf("day")),W=o()(J,2),X=W[0],H=W[1],A=(0,l.useState)("today"),L=o()(A,2),G=L[0],N=L[1],Q=(0,l.useState)(I.whQ),_=o()(Q,2),V=_[0],$=_[1],K=(0,l.useState)(),ee=o()(K,2),te=ee[0],ne=ee[1],re=(0,l.useState)(),ie=o()(re,2),ae=ie[0],se=ie[1],ce=(0,Y.u)((function(e){return e.currentOrg})),oe=(0,S.E)((function(e){return e})),le=oe.agentResult,ue=oe.setAgentResult,de=(0,q.H)((function(e){return e})),fe=de.departmentResult,pe=de.setDepartmentResult,me=(0,l.useState)(),he=o()(me,2),ve=he[0],ge=he[1],ke=(0,l.useState)(!1),xe=o()(ke,2),ye=(xe[0],xe[1]),je=[{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,l.useEffect)((function(){if("custom"===G)O(u),H(X);else{var e=B()();"today"===G?(O(e),H(e)):"yesterday"===G?(O(e.subtract(1,"day")),H(e.subtract(1,"day"))):"week"===G?(O(e.startOf("week")),H(e.endOf("week"))):"lastWeek"===G?(O(e.subtract(1,"week").startOf("week")),H(e.subtract(1,"week").endOf("week"))):"month"===G&&(O(e.startOf("month")),H(e.endOf("month")))}}),[G]);var Te=function(){var e=s()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==ce?void 0:ce.uid},e.next=4,(0,E.dF)(t);case 4:200===(n=e.sent).code?(R.yw.destroy(),pe(n),n.data.content.length>0&&se(n.data.content[0].uid)):(R.yw.destroy(),R.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=s()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ce?void 0:ce.uid},e.next=4,(0,z._t)(t);case 4:200===(n=e.sent).code?(R.yw.destroy(),ue(n),n.data.content.length>0&&ne(n.data.content[0].uid)):(R.yw.destroy(),R.yw.error(r(n.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=s()(i()().mark((function e(){var t,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye(!0),e.prev=1,R.yw.loading("loading"),t={type:V,startDate:null==u?void 0:u.format("YYYY-MM-DD"),endDate:null==X?void 0:X.format("YYYY-MM-DD"),departmentUid:ae,assigneeUid:te,orgUid:null==ce?void 0:ce.uid},e.next=6,(0,D.AD)(t);case 6:r=e.sent,console.log("queryStatisticTicketByDate response:",r.data,t),200===r.code?(R.yw.destroy(),ge(r.data)):(R.yw.destroy(),R.yw.error(r.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),R.yw.error(n.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,ye(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){Te(),be()}),[]),(0,l.useEffect)((function(){we()}),[V,te,ae]),(0,l.useEffect)((function(){we()}),[u,X]);var Me=[{status:"新建",count:(null==ve?void 0:ve.newTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.newTickets/ve.totalTickets*100):0,color:"#1890ff"},{status:"处理中",count:(null==ve?void 0:ve.processingTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.processingTickets/ve.totalTickets*100):0,color:"#faad14"},{status:"已解决",count:(null==ve?void 0:ve.resolvedTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.resolvedTickets/ve.totalTickets*100):0,color:"#52c41a"},{status:"已关闭",count:(null==ve?void 0:ve.closedTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.closedTickets/ve.totalTickets*100):0,color:"#666"}].filter((function(e){return e.count>0})),Ze=[{key:"1",date:null==u?void 0:u.format("YYYY-MM-DD"),totalTickets:(null==ve?void 0:ve.totalTickets)||0,newTickets:(null==ve?void 0:ve.newTickets)||0,inProgress:(null==ve?void 0:ve.processingTickets)||0,resolved:(null==ve?void 0:ve.resolvedTickets)||0,closed:(null==ve?void 0:ve.closedTickets)||0,avgResolutionTime:"".concat((null==ve?void 0:ve.averageResolutionTime)||0,"小时"),priority:(null==ve?void 0:ve.criticalTickets)>0?"高":(null==ve?void 0:ve.highTickets)>0?"中":"低"}],De=[{title:n.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:n.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:n.formatMessage({id:"bi.ticket.table.processingTickets"}),dataIndex:"processingTickets",key:"processingTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:n.formatMessage({id:"bi.ticket.table.resolvedTickets"}),dataIndex:"resolvedTickets",key:"resolvedTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:n.formatMessage({id:"bi.ticket.table.closedTickets"}),dataIndex:"closedTickets",key:"closedTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:n.formatMessage({id:"bi.ticket.table.resolutionRate"}),dataIndex:"resolutionRate",key:"resolutionRate",render:function(e){return"".concat(e,"%")}},{title:n.formatMessage({id:"bi.ticket.table.avgResolutionTime"}),dataIndex:"avgResolutionTime",key:"avgResolutionTime",render:function(e){return"".concat(e).concat(n.formatMessage({id:"bi.ticket.unit.minute"}))}}];return(0,F.jsxs)("div",{style:{padding:"24px"},children:[(0,F.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,F.jsx)("h2",{children:n.formatMessage({id:"bi.ticket.title.overview"})}),(0,F.jsxs)("p",{children:[n.formatMessage({id:"bi.ticket.description.overview"}),"today"===G&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",u.format("YYYY-MM-DD"),")"]}),"yesterday"===G&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",u.format("YYYY-MM-DD"),")"]}),("week"===G||"lastWeek"===G||"month"===G||"custom"===G)&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",u.format("YYYY-MM-DD")," ~ ",X.format("YYYY-MM-DD"),")"]})]})]}),(0,F.jsx)(p.Z,{style:{marginBottom:16},children:(0,F.jsx)(m.Z,{direction:"vertical",style:{width:"100%"},children:(0,F.jsxs)(m.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,F.jsxs)(m.Z,{wrap:!0,children:[(0,F.jsx)(h.ZP.Group,{value:G,onChange:function(e){return N(e.target.value)},children:je.map((function(e){return(0,F.jsx)(h.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===G&&(0,F.jsx)(P,{value:[u,X],onChange:function(e){O(e[0]),H(e[1])}})]}),(0,F.jsxs)(m.Z,{wrap:!0,children:[(0,F.jsxs)(d.Z,{value:V,onChange:$,style:{width:120},placeholder:n.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,F.jsx)(U,{value:I.whQ,children:n.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,F.jsx)(U,{value:I.fyH,children:n.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,F.jsx)(U,{value:I.nYM,children:n.formatMessage({id:"bi.ticket.filterType.department"})})]}),V===I.fyH&&(0,F.jsx)(d.Z,{value:te,onChange:ne,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=le.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,F.jsx)(U,{value:e.uid,children:r(e.nickname)},e.uid)}))}),V===I.nYM&&(0,F.jsx)(d.Z,{value:ae,onChange:se,style:{width:150},placeholder:n.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=fe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,F.jsx)(U,{value:e.uid,children:r(e.name)},e.uid)}))}),(0,F.jsx)(v.ZP,{type:"primary",icon:(0,F.jsx)(j.Z,{}),onClick:function(){return we()},children:(0,F.jsx)(Z.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,F.jsxs)(g.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(k.Z,{span:6,children:(0,F.jsx)(p.Z,{children:(0,F.jsx)(x.Z,{title:n.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==ve?void 0:ve.totalTickets)||0,prefix:(0,F.jsx)(T.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,F.jsx)(k.Z,{span:6,children:(0,F.jsx)(p.Z,{children:(0,F.jsx)(x.Z,{title:n.formatMessage({id:"bi.ticket.card.processingTickets"}),value:(null==ve?void 0:ve.processingTickets)||0,prefix:(0,F.jsx)(b.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,F.jsx)(k.Z,{span:6,children:(0,F.jsx)(p.Z,{children:(0,F.jsx)(x.Z,{title:n.formatMessage({id:"bi.ticket.card.resolvedTickets"}),value:(null==ve?void 0:ve.resolvedTickets)||0,prefix:(0,F.jsx)(w.Z,{}),valueStyle:{color:"#722ed1"}})})}),(0,F.jsx)(k.Z,{span:6,children:(0,F.jsx)(p.Z,{children:(0,F.jsx)(x.Z,{title:n.formatMessage({id:"bi.ticket.card.avgResolutionTime"}),value:(null==ve?void 0:ve.averageResolutionTime)||0,prefix:(0,F.jsx)(M.Z,{}),valueStyle:{color:"#eb2f96"},suffix:n.formatMessage({id:"bi.ticket.unit.minute"})})})})]}),(0,F.jsxs)(g.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(k.Z,{span:12,children:(0,F.jsx)(p.Z,{title:n.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,F.jsx)("div",{style:{height:300},children:Me.map((function(e,t){return(0,F.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,F.jsx)("span",{children:e.status}),(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,F.jsx)("div",{style:{width:12,height:12,backgroundColor:e.color,marginRight:8,borderRadius:2}}),(0,F.jsx)("span",{style:{marginRight:8},children:e.count}),(0,F.jsxs)("span",{style:{color:"#666"},children:["(",e.percentage,"%)"]})]})]},t)}))})})}),(0,F.jsx)(k.Z,{span:12,children:(0,F.jsx)(p.Z,{title:n.formatMessage({id:"bi.ticket.resolutionTrend"}),children:(0,F.jsx)("div",{style:{height:300,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,F.jsxs)("div",{style:{textAlign:"center"},children:[(0,F.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[null!=ve&&ve.totalTickets?Math.round(ve.resolvedTickets/ve.totalTickets*100):0,"%"]}),(0,F.jsx)("div",{style:{color:"#666"},children:"今日解决率"}),(0,F.jsxs)("div",{style:{marginTop:16,color:"#999"},children:["客户满意度: ",(null==ve?void 0:ve.customerSatisfactionRate)||0,"%"]})]})})})})]}),(0,F.jsx)(p.Z,{title:n.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,F.jsx)(y.Z,{columns:De,dataSource:Ze,pagination:!1,size:"middle"})})]})}},74956:function(e,t,n){n.d(t,{H:function(){return p}});var r=n(86222),i=n.n(r),a=n(76711),s=n.n(a),c=n(73193),o=n.n(c),l=n(68992),u=n(58063),d=n(66266),f=n(31403),p=(0,u.Ue)()((0,d.mW)((0,d.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:l.zBg,nickname:l.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,i={uid:l.zBg,name:l.zBg};(e({departmentResult:o()(o()({},n),{},{data:{content:[i].concat(s()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,i=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==i){var a=[].concat(s()(r.slice(0,i)),[n],s()(r.slice(i+1))),c=o()(o()({},t().departmentResult),{},{data:{content:a}});e({departmentResult:c,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,a,s=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(s)e({currentDepartment:s});else{!function t(r){var a,s=i()(r);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.uid===n)return void e({currentDepartment:c});c.children&&c.children.length>0&&t(c.children)}}catch(e){s.e(e)}finally{s.f()}}((null===(a=t().departmentResult)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:l.xY_})))}}]);