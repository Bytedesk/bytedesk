"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{74840:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(83910),r=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},i=n(54183),o=function(e,t){return r.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(o)},59908:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(83910),r=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},i=n(54183),o=function(e,t){return r.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(o)},39790:function(e,t,n){var a=n(94433),r=n(38956),s=n(44194),i=n(35074),o=n(31549),l=["fieldProps","request","params","proFieldProps"],u=function(e,t){var n=e.fieldProps,s=e.request,u=e.params,d=e.proFieldProps,c=(0,r.Z)(e,l);return(0,o.jsx)(i.Z,(0,a.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:u,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(u);t.Z=d},41245:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return h},hS:function(){return p},z_:function(){return c}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(39497),d=n(14906);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},56663:function(e,t,n){var a=n(90819),r=n.n(a),s=n(89933),i=n.n(s),o=n(45332),l=n.n(o),u=n(73614),d=n(19433),c=n(12864),f=n(7704),g=n(91361),m=n(98830),p=n(39497),v=n(71256),h=n(25784),x=n(2250),M=n(14906),b=n(44194),w=n(11329),y=n(23753),S=n(31549);t.Z=function(e){var t,n,a,s,o=h.A.useForm(),k=l()(o,1)[0],j=(0,M.useIntl)(),C=(0,g.Z)().translateString,Z=(0,m.u)((function(e){return e.currentOrg})),F=(0,b.useState)(),U=l()(F,2),T=U[0],q=U[1],I=(0,b.useState)(),A=l()(I,2),R=A[0],P=A[1],E=(0,b.useState)(),L=l()(E,2),z=L[0],O=L[1],D=(0,b.useState)(""),N=l()(D,2),B=N[0],V=N[1],K=(0,b.useRef)(!1),W=(0,b.useRef)(),H=(0,b.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),J=(0,b.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==H?void 0:H.draft)&&void 0!==t?t:null==H?void 0:H.live)&&void 0!==e?e:void 0}),[H]),Y=(0,b.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),_=(0,b.useCallback)((function(e){k.setFieldValue("welcomeTip",e),Y({welcomeTip:e})}),[k,Y]);(0,b.useEffect)((function(){if(null!=Z&&Z.uid&&(W.current!==Z.uid&&(W.current=Z.uid,K.current=!1),!K.current)){K.current=!0;var e=function(){var e=i()(r()().mark((function e(){var t,n,a,s,i,o,l;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:p.QPQ,orgUid:Z.uid},e.next=4,(0,f.AP)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(P(n),i=(null===(a=n.data)||void 0===a?void 0:a.content)||[],o=null==J?void 0:J.welcomeKbUid,(l=o||z||(null===(s=i[0])||void 0===s?void 0:s.uid))&&(O(l),k.setFieldValue("welcomeKbUid",l),o!==l&&Y({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==Z?void 0:Z.uid,j,null==J?void 0:J.welcomeKbUid,z,k,Y]),(0,b.useEffect)((function(){if(null!=Z&&Z.uid&&z){var e=function(){var e=i()(r()().mark((function e(){var t,n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:Z.uid,kbUid:z},e.next=4,(0,c.pf)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?q(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==Z?void 0:Z.uid,z,j]),(0,b.useEffect)((function(){if(J){var e=null==J?void 0:J.welcomeFaqs,t=Array.isArray(J.welcomeFaqUids)?J.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];k.setFieldValue("welcomeFaqUids",t)}}),[k,null==T||null===(t=T.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==J?void 0:J.welcomeFaqUids,J]);var Q=(0,b.useCallback)((function(e){O(e),k.setFieldValue("welcomeFaqUids",[]),Y({welcomeKbUid:e,welcomeFaqUids:[]})}),[Y,k]);return(0,b.useEffect)((function(){var e=C(null==J?void 0:J.welcomeTip);void 0!==e&&B!==e&&V(e),null!=J&&J.welcomeKbUid&&(k.setFieldValue("welcomeKbUid",J.welcomeKbUid),z!==J.welcomeKbUid&&O(J.welcomeKbUid))}),[C,null==J?void 0:J.welcomeTip,null==J?void 0:J.welcomeKbUid,B,k,z,null==R||null===(n=R.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,S.jsxs)(h.A,{form:k,submitter:!1,style:{marginLeft:"20px"},children:[(0,S.jsx)(h.A.Item,{name:"welcomeTip",label:(0,S.jsxs)("span",{children:[j.formatMessage({id:"agent.settings.welcome.tip"}),(0,S.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),tooltip:j.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:j.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,S.jsx)(w.Z,{placeholder:j.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:B,toolbarKeys:(0,v.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:_})}),(0,S.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,S.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,S.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),options:null==R||null===(a=R.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return Q(e)},allowClear:!0,placeholder:(0,S.jsx)(M.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,S.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,S.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.faq.welcome"}),(0,S.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),options:null==T||null===(s=T.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,S.jsx)(M.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return Y({welcomeFaqUids:e})}}})]})}},2011:function(e,t,n){n.d(t,{G:function(){return g}});var a=n(73193),r=n.n(a),s=(n(44194),n(81637)),i=n(39497),o=n(96596),l=n.n(o),u=n(23753),d=n(19433),c=n(5932),f=n(31549),g=function(e){var t=e.children,n=e.onSuccess,a=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,u.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),d.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,f.jsx)(s.Z,r()(r()({},g),{},{children:t}))}},3391:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ae}});var a=n(44194),r=n(67738),s=n(14906),i=n(76711),o=n.n(i),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),f=n(73193),g=n.n(f),m=n(45332),p=n.n(m),v=n(77033),h=n(82770),x=n(39487),M=n(32525),b=n(50716),w=n(92354),y=n(81739),S=n(66431),k=n(63649),j=n(74840),C=n(29337),Z=n(68779),F=n(12322),U=n(56482),T=n(10162),q=n(59304),I=n(54881),A=n(47944),R=n(80556),P=n(55785),E=n(49764),L=n(19433),z=n(2890),O=n(98830),D=n(75112),N=n(14597),B=n(99665),V=n(27153),K=(n(84262),n(66547)),W=(n(94212),n(24479),n(41196)),H=n(86895),J=n(31549),Y=function(e){var t=e.open,n=e.onOpenChange,r=e.orgUid,i=e.record,o=e.onSuccess,l=(0,s.useIntl)(),d=W.Z.useForm(),f=p()(d,1)[0];(0,a.useEffect)((function(){var e,n;t&&(i?f.setFieldsValue({name:i.name||"",description:i.description||"",enabled:null===(e=i.enabled)||void 0===e||e,isDefault:null!==(n=i.isDefault)&&void 0!==n&&n}):(f.resetFields(),f.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,i,f]);var m=function(){var e=c()(u()().mark((function e(){var t,a,s,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.validateFields();case 3:if(t=e.sent,a=g()(g()({},t),{},{orgUid:r,uid:null==i?void 0:i.uid}),null==i||!i.uid){e.next=11;break}return e.next=8,(0,z.wU)(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,z.IH)(a);case 13:e.t0=e.sent;case 14:(s=e.t0)&&200===s.code?(d=s.data||{},L.yw.success(l.formatMessage({id:null!=i&&i.uid?"common.updated":"common.created",defaultMessage:null!=i&&i.uid?"更新成功":"创建成功"})),null==o||o(d),n(!1)):L.yw.error((null==s?void 0:s.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)(H.Z,{title:(0,J.jsx)(s.FormattedMessage,{id:null!=i&&i.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=i&&i.uid?"编辑模板":"新建模板"}),open:t,onOk:m,onCancel:function(){n(!1)},okText:(0,J.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,J.jsx)(s.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,J.jsxs)(W.Z,{form:f,layout:"vertical",preserve:!1,children:[(0,J.jsx)(W.Z.Item,{name:"name",label:(0,J.jsx)(s.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,J.jsx)(M.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,J.jsx)(W.Z.Item,{name:"description",label:(0,J.jsx)(s.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,J.jsx)(M.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,J.jsx)(W.Z.Item,{name:"enabled",label:(0,J.jsx)(s.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,J.jsx)(S.Z,{})})]})})},_=n(90631),Q=n(1460),G=n(56663),X=(n(417),n(52260),function(){var e=(0,s.useIntl)(),t=(0,O.u)((function(e){return e.currentOrg})),n=(0,D.Z)(),i=n.leftSiderStyle,l=(n.contentStyle,(0,N.Z)().isDarkMode),d=(0,a.useState)(!1),f=p()(d,2),m=f[0],W=f[1],H=(0,a.useState)([]),X=p()(H,2),$=X[0],ee=X[1],te=(0,a.useState)(),ne=p()(te,2),ae=ne[0],re=ne[1],se=(0,a.useState)(""),ie=p()(se,2),oe=ie[0],le=ie[1],ue=(0,a.useState)("tips"),de=p()(ue,2),ce=de[0],fe=de[1],ge=(0,a.useState)(!1),me=p()(ge,2),pe=me[0],ve=me[1],he=(0,a.useState)(null),xe=p()(he,2),Me=xe[0],be=xe[1],we=(0,a.useMemo)((function(){return $.find((function(e){return e.uid===ae}))||null}),[$,ae]),ye=(0,a.useState)(!1),Se=p()(ye,2),ke=Se[0],je=Se[1],Ce=(0,a.useState)(!1),Ze=p()(Ce,2),Fe=Ze[0],Ue=Ze[1],Te=(0,B.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),qe=Te.setCurrentAgentSettings,Ie=Te.currentAgentSettings,Ae=(0,a.useState)(!1),Re=p()(Ae,2),Pe=Re[0],Ee=Re[1],Le=(0,a.useRef)(""),ze=(0,a.useMemo)((function(){var e;return null!==(e=null!=Ie?Ie:we)&&void 0!==e?e:null}),[Ie,we]),Oe=(0,a.useCallback)((function(e){if(Ie){var t=Ie.draftServiceSettings||Ie.serviceSettings||{};qe(g()(g()({},Ie),{},{draftServiceSettings:g()(g()({},t),e)}))}}),[Ie,qe]),De=(0,a.useCallback)((function(e){if(Ie){var t=Ie.draftInviteSettings||Ie.inviteSettings||{};qe(g()(g()({},Ie),{},{draftInviteSettings:g()(g()({},t),e)}))}}),[Ie,qe]),Ne=(0,a.useCallback)((function(e){if(Ie){var t=Ie.draftMessageLeaveSettings||Ie.messageLeaveSettings||{};qe(g()(g()({},Ie),{},{draftMessageLeaveSettings:g()(g()({},t),e)}))}}),[Ie,qe]),Be=(0,a.useCallback)((function(e){if(Ie){var t=Ie.draftWorktimeSettings||Ie.worktimeSettings||{};qe(g()(g()({},Ie),{},{draftWorktimeSettings:g()(g()({},t),e)}))}}),[Ie,qe]),Ve=(0,a.useCallback)((function(e){Ie&&qe(g()(g()({},Ie),e))}),[Ie,qe]),Ke=(0,a.useMemo)((function(){if(!oe)return $;var e=oe.toLowerCase();return $.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),a=(t.description||"").toLowerCase();return n.includes(e)||a.includes(e)}))}),[$,oe]),We=(0,a.useCallback)(function(){var e=c()(u()().mark((function e(n,a){var r,s,i,o,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return W(!0),r="welcome",e.prev=4,i=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:i||void 0},e.next=9,(0,z.u9)(o);case 9:l=e.sent,console.log("加载客服配置模板列表: ",l,o),d=(null==l||null===(s=l.data)||void 0===s?void 0:s.content)||[],ee(d),!(d.length>0)||ae&&d.some((function(e){return e.uid===ae}))||(re(d[0].uid),null!=a&&a.keepActive||fe(r));case 14:return e.prev=14,W(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[4,,14,17]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,ae]);(0,a.useEffect)((function(){We(oe)}),[null==t?void 0:t.uid]),(0,a.useEffect)((function(){we?(qe(we),Le.current=JSON.stringify(null!=we?we:{}),Ee(!1)):(qe(null),Le.current=JSON.stringify({}),Ee(!1))}),[ae]),(0,a.useEffect)((function(){if(we)try{var e=JSON.stringify(null!=Ie?Ie:{});Ee(e!==Le.current)}catch(e){Ee(!0)}}),[Ie,null==we?void 0:we.uid]);var He=function(){var n=c()(u()().mark((function n(a){var r,s,i;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=null!=a?a:we)&&r.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:r.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,z.SJ)(s);case 6:i=n.sent,console.log("删除客服配置模板结果：",i,s),i&&200===i.code?(L.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),We(oe)):L.yw.error((null==i?void 0:i.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Je=function(){var n=c()(u()().mark((function n(a,r){var s,i;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:a,orgUid:null==t?void 0:t.uid},!r){n.next=8;break}return n.next=5,(0,z.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,z.iO)(s);case 10:n.t0=n.sent;case 11:(i=n.t0)&&200===i.code?(L.yw.success(e.formatMessage({id:r?"common.enabled":"common.disabled",defaultMessage:r?"已启用":"已停用"})),We(oe)):L.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),L.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),Ye=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},_e=function(e){if(e){var t=Ye(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,a){if(void 0===t[n]){var r=null==e?void 0:e[a];if(Array.isArray(r)){var s=r.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickFaqUids","quickFaqs"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var a=function(e){if(e)return Ye(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return g()(g()({},t),a?{toolbar:a}:{})}},Qe=function(e){if(e)return Ye(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ge=function(e){if(e)return Ye(e,["name","description","color","order"])},Xe=function(e){if(e)return Ye(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},$e=function(e){if(e)return Ye(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},et=function(e){if(e)return Ye(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},tt=function(e){if(e)return Ye(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},nt=function(e){if(e)return Ye(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},at=function(e){if(e)return Ye(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},rt=function(){var n=c()(u()().mark((function n(){var a,r,s,i,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=we&&we.uid){n.next=3;break}return L.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return je(!0),n.prev=4,a=Ie&&Ie.uid===we.uid?Ie:we,r=function(e,t){return g()(g()({},e||{}),t||{})},s={uid:we.uid,orgUid:null==t?void 0:t.uid,name:null==a?void 0:a.name,description:null==a?void 0:a.description,isDefault:null==a?void 0:a.isDefault,enabled:null==a?void 0:a.enabled,serviceSettings:_e(r(null==a?void 0:a.serviceSettings,null==a?void 0:a.draftServiceSettings)),inviteSettings:Qe(r(null==a?void 0:a.inviteSettings,null==a?void 0:a.draftInviteSettings)),intentionSettings:Ge(r(null==a?void 0:a.intentionSettings,null==a?void 0:a.draftIntentionSettings)),maxThreadCount:null==a?void 0:a.maxThreadCount,timeoutRemindEnabled:null==a?void 0:a.timeoutRemindEnabled,timeoutRemindTime:null==a?void 0:a.timeoutRemindTime,timeoutRemindTip:null==a?void 0:a.timeoutRemindTip,messageLeaveSettings:Xe(r(null==a?void 0:a.messageLeaveSettings,null==a?void 0:a.draftMessageLeaveSettings)),worktimeSettings:et(r(null==a?void 0:a.worktimeSettings,null==a?void 0:a.draftWorktimeSettings)),autoReplySettings:tt(r(null==a?void 0:a.autoReplySettings,null==a?void 0:a.draftAutoReplySettings)),queueSettings:$e(r(null==a?void 0:a.queueSettings,null==a?void 0:a.draftQueueSettings)),rateDownSettings:nt(r(null==a?void 0:a.rateDownSettings,null==a?void 0:a.draftRateDownSettings)),agentStatusSettings:at(r(null==a?void 0:a.agentStatusSettings,null==a?void 0:a.draftAgentStatusSettings))},n.next=10,(0,z.wU)(s);case 10:i=n.sent,console.log("保存客服配置模板结果：",i,s),i&&200===i.code?(L.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),d=null!==(o=null!==(l=i.data)&&void 0!==l?l:a)&&void 0!==o?o:{},Le.current=JSON.stringify(d),Ee(!1),We(oe,{keepActive:!0})):L.yw.error((null==i?void 0:i.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),L.yw.error("保存失败");case 19:return n.prev=19,je(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),st=function(){var n=c()(u()().mark((function n(){var a,r,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=we&&we.uid){n.next=3;break}return L.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Ue(!0),n.prev=4,!Pe){n.next=8;break}return n.next=8,rt();case 8:return a={uid:we.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,z.Xy)(a);case 11:(r=n.sent)&&200===r.code?(L.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Le.current=JSON.stringify(null!==(s=r.data)&&void 0!==s?s:{}),Ee(!1),We(oe)):L.yw.error((null==r?void 0:r.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),L.yw.error("发布失败");case 19:return n.prev=19,Ue(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),it=(0,a.useMemo)((function(){return null!=we&&we.uid?[{key:"welcome",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(j.Z,{})," ",(0,J.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,J.jsx)(G.Z,{serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:Oe})},{key:"tips",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(C.Z,{})," ",(0,J.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,J.jsx)(Q.Z,{variant:"agent",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:Oe})},{key:"service",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(Z.Z,{})," ",(0,J.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,J.jsx)(_.Z,{variant:"agent",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},agentMeta:{maxThreadCount:null==ze?void 0:ze.maxThreadCount,timeoutRemindTime:null==ze?void 0:ze.timeoutRemindTime},onServiceSettingsChange:Oe,onAgentMetaChange:Ve})},{key:"rate",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(F.Z,{})," ",(0,J.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,J.jsx)(V.Z,{variant:"agent",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:Oe})}].concat(o()([]),o()([]),o()([]),[{key:"right",label:(0,J.jsxs)("span",{children:[(0,J.jsx)(U.Z,{})," ",(0,J.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,J.jsx)(K.Z,{variant:"agent",serviceSettings:{live:null==ze?void 0:ze.serviceSettings,draft:null==ze?void 0:ze.draftServiceSettings},onServiceSettingsChange:Oe,settingsUid:we.uid,isActive:"right"===ce})}],o()([]),o()([])):[]}),[null==we?void 0:we.uid,ze,Oe,De,Ne,Be,e,ce]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,J.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:i,children:(0,J.jsxs)(E.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,J.jsx)(h.ZP,{size:"small",icon:(0,J.jsx)(T.Z,{}),type:"primary",onClick:function(){be(null),ve(!0)},children:(0,J.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:m,children:[(0,J.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,J.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,J.jsx)(M.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:oe,onChange:function(e){return le(e.target.value)},onPressEnter:function(e){We(oe)},allowClear:!0,size:"middle"}),(0,J.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return We(oe)},children:"搜索"})]})}),(0,J.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,J.jsx)(b.Z,{dataSource:Ke,locale:{emptyText:(0,J.jsx)(w.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:w.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,J.jsx)(b.Z.Item,{style:ae===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return re(e.uid)},children:(0,J.jsx)(b.Z.Item.Meta,{title:(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,J.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,J.jsx)(x.Z,{size:4,children:e.isDefault?(0,J.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,J.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,J.jsx)(v.Z.Panel,{children:we?(0,J.jsx)(E.Z,{title:(0,J.jsxs)(x.Z,{children:[(0,J.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",we.name||we.uid]}),(0,J.jsx)(S.Z,{checked:we.enabled,onChange:function(e){return Je(we.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,J.jsx)(h.ZP,{size:"small",icon:(0,J.jsx)(q.Z,{}),onClick:function(e){var t;e.stopPropagation(),be(null!=(t=we)?t:we),ve(!0)},children:"编辑"}),(0,J.jsx)(k.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),He(we)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,J.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,J.jsx)(I.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),we.isDefault?(0,J.jsx)(y.Z,{color:"blue",children:"默认"}):null]}),extra:(0,J.jsxs)(x.Z,{children:[(0,J.jsx)(k.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),st()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,J.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Fe,type:"default",icon:(0,J.jsx)(A.Z,{}),children:(0,J.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,J.jsx)(h.ZP,{onClick:function(){we&&(qe(we),Le.current=JSON.stringify(null!=we?we:{}),Ee(!1))},disabled:!Pe,icon:(0,J.jsx)(R.Z,{}),children:(0,J.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,J.jsx)(h.ZP,{type:"primary",loading:ke,onClick:rt,disabled:!Pe,icon:(0,J.jsx)(P.Z,{}),children:(0,J.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,J.jsx)(r.Z,{activeKey:ce,onChange:fe,items:it,style:{minHeight:"calc(100vh - 280px)"}})}):(0,J.jsx)(E.Z,{children:(0,J.jsx)(w.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,J.jsx)(Y,{open:pe,onOpenChange:ve,orgUid:(null==t?void 0:t.uid)||"",record:Me,onSuccess:function(){ve(!1),We(oe)}})]})}),$=n(86222),ee=n.n($),te=n(89246),ne=n(33797),ae=n(33019),re=n(39497),se=n(75864),ie=n(25784),oe=n(2250),le=n(89965),ue=n(80953),de=n(13847),ce=n(59908),fe=n(41245),ge=n(2011),me=function(e){var t=e.value,n=e.onChange,a=e.options,r=e.loading,s=e.placeholder,i=e.emptyContent,o=e.onSearch,l=e.onDropdownOpen,u=e.onCreate,d=e.createLabel,c=e.createTitle;return(0,J.jsxs)(x.Z.Compact,{block:!0,children:[(0,J.jsx)(de.Z,{value:t,onChange:n,options:a,showSearch:!0,filterOption:!1,placeholder:s,loading:r,style:{flex:1},notFoundContent:i,onSearch:o,onOpenChange:function(e){e&&l()}}),(0,J.jsx)(h.ZP,{size:"small",icon:(0,J.jsx)(T.Z,{}),onClick:u,title:c,children:d})]})},pe=function(e){var t,n,r=e.open,i=e.record,l=e.onClose,d=e.onSuccess,f=(0,s.useIntl)(),m=(0,O.u)((function(e){return e.currentOrg})),v=(0,a.useState)(!1),x=p()(v,2),M=x[0],b=x[1],w=(0,a.useState)([]),y=p()(w,2),S=y[0],k=y[1],j=(0,a.useState)(!1),C=p()(j,2),Z=C[0],F=C[1],U=(0,a.useState)((null==i?void 0:i.avatar)||""),q=p()(U,2),I=q[0],A=q[1],R=(0,a.useRef)(),P=(0,a.useMemo)((function(){return!(null==i||!i.uid)}),[i]),E=function(){var e=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(t),L.yw.success(f.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=(0,a.useCallback)(function(){var e=c()(u()().mark((function e(t){var n,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F(!0),e.prev=1,null!=m&&m.uid){e.next=5;break}return k([]),e.abrupt("return",[]);case 5:return a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==m?void 0:m.uid,searchText:t||""},e.next=8,(0,z.u9)(a);case 8:return r=e.sent,console.log("queryAgentSettingsByOrg request:",a,r),s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],k(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 13:return e.prev=13,F(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==m?void 0:m.uid]);(0,a.useEffect)((function(){D()}),[D]);var N=(0,a.useMemo)((function(){return S.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[S]),B=(0,a.useRef)(),V=(0,a.useCallback)((function(e){B.current&&clearTimeout(B.current),B.current=setTimeout((function(){D(e)}),300)}),[D]);(0,a.useEffect)((function(){return function(){B.current&&clearTimeout(B.current)}}),[]);var K=(0,a.useCallback)((function(){S.length||D()}),[D,S.length]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(se.a,{open:r,onOpenChange:function(e){e||l()},title:P?f.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):f.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:R,initialValues:P?{nickname:null==i?void 0:i.nickname,email:null==i?void 0:i.email,mobile:null==i?void 0:i.mobile,description:null==i?void 0:i.description,memberUid:(null==i||null===(t=i.member)||void 0===t?void 0:t.uid)||(null==i?void 0:i.memberUid),settingsUid:null==i||null===(n=i.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:f.formatMessage({id:"save",defaultMessage:"保存"}),resetText:f.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return l()}}},onFinish:function(){var e=c()(u()().mark((function e(t){var n,a,r,s,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,L.yw.loading(f.formatMessage({id:P?"updating":"creating",defaultMessage:P?"Updating":"Creating"})),!P){e.next=10;break}return r=g()(g()(g()({},i),t),{},{avatar:I||(null==i?void 0:i.avatar)}),e.next=6,(0,ae.sE)(r);case 6:a=e.sent,console.log("updateAgent payload:",r,a),e.next=15;break;case 10:return s={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==m?void 0:m.uid,avatar:I},e.next=13,(0,ae.x_)(s);case 13:a=e.sent,console.log("createAgent payload:",s,a);case 15:if(L.yw.destroy(),200!==(null===(n=a)||void 0===n?void 0:n.code)){e.next=23;break}return L.yw.success(f.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(a.data),l(),e.abrupt("return",!0);case 23:return L.yw.error((null===(o=a)||void 0===o?void 0:o.message)||f.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),L.yw.destroy(),L.yw.error(f.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,J.jsx)(ie.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:f.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,J.jsxs)(ge.G,{onSuccess:E,onError:function(e){L.yw.error(String(e))},children:[(0,J.jsx)(ne.Z,{src:I||(null==i?void 0:i.avatar)}),(0,J.jsxs)(h.ZP,{icon:(0,J.jsx)(ce.Z,{}),children:[" ",f.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,J.jsx)(oe.Z,{name:"memberUid",label:f.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:f.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:P,rules:P?[]:[{required:!0,message:f.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=c()(u()().mark((function e(t){var n,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.next=3,(0,fe.z_)({pageNumber:0,pageSize:20,orgUid:null==m?void 0:m.uid,searchText:a||""});case 3:return r=e.sent,s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,J.jsx)(ie.A.Item,{name:"settingsUid",label:f.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),rules:[{required:!0,message:f.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],children:(0,J.jsx)(me,{options:N,loading:Z,placeholder:f.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),emptyContent:0===N.length?(0,J.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,J.jsx)("div",{style:{marginBottom:8,color:"#999"},children:f.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,J.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,J.jsx)(T.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return b(!0)},children:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:V,onDropdownOpen:K,onCreate:function(){return b(!0)},createLabel:f.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})}),(0,J.jsx)(le.Z,{name:"nickname",label:f.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.nickname.required"})}]}),(0,J.jsx)(le.Z,{name:"email",label:f.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.email.required"})}]}),(0,J.jsx)(le.Z,{name:"mobile",label:f.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.mobile.required"})}]}),(0,J.jsx)(ue.Z,{name:"description",label:f.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,J.jsx)(Y,{open:M,onOpenChange:b,orgUid:(null==m?void 0:m.uid)||"",record:null,onSuccess:function(e){var t;b(!1),k((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(o()(t))})),D(),null===(t=R.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},ve=n(50246),he=n(10404),xe=n(76273),Me=n(39790),be=n(90727),we=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,i=(0,s.useIntl)(),l=xe.ZP.useForm(),d=p()(l,1)[0],f=(0,O.u)((function(e){return e.currentOrg})),m=(0,ve.Z)((function(e){return e.memberResult})),v=(0,ve.Z)((function(e){return e.setMemberResult})),x=(0,he.E)((function(e){return e.agentResult})),b=(0,a.useState)(0),w=p()(b,2),y=w[0],S=w[1],k=(0,a.useState)(""),j=p()(k,2),C=j[0],Z=j[1],F=(0,a.useState)(!1),U=p()(F,2),T=U[0],q=U[1],I=(0,a.useState)([]),A=p()(I,2),R=A[0],P=A[1],E=(0,a.useRef)(null),L=(0,a.useState)(0),D=p()(L,2),N=D[0],B=D[1],V=(0,a.useState)(!0),K=p()(V,2),W=K[0],Y=K[1],_=(0,a.useState)(!1),Q=p()(_,2),G=Q[0],X=Q[1],$=(0,a.useState)(0),ee=p()($,2),te=ee[0],ne=ee[1],ae=(0,a.useState)(!0),re=p()(ae,2),se=re[0],ie=re[1],ue=(0,a.useState)(!1),de=p()(ue,2),ce=de[0],ge=de[1],me=(0,a.useState)(!1),pe=p()(me,2),we=pe[0],ye=pe[1],Se=(0,a.useState)([]),ke=p()(Se,2),je=ke[0],Ce=ke[1];(0,a.useEffect)((function(){var e;t&&(console.log("Modal opened, current agent data:",x),console.log("Current member data:",m),null!=m&&null!==(e=m.data)&&void 0!==e&&e.content&&0!==m.data.content.length||c()(u()().mark((function e(){var t,n,a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==f?void 0:f.uid},e.next=4,(0,fe.z_)(n);case 4:a=e.sent,console.log("Init load members response:",a,n),(r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[]).length>0&&v(g()(g()({},m),{},{data:g()(g()({},null==m?void 0:m.data),{},{content:r})})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Init load members failed:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),c()(u()().mark((function e(){var t,n,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ye(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==f?void 0:f.uid,searchText:""},e.next=5,(0,z.u9)(n);case 5:a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],s=r.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (".concat(i.formatMessage({id:"agent.settings.template.isDefault",defaultMessage:"默认"}),")"):"").concat(e.enabled?"":" (".concat(i.formatMessage({id:"app.disabled",defaultMessage:"已停用"}),")")),value:e.uid}})),Ce(s),!d.getFieldValue("settingsUid")&&s.length>0&&d.setFieldsValue({settingsUid:s[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,ye(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))())}),[t,x,m]),(0,a.useEffect)((function(){return function(){E.current&&clearTimeout(E.current)}}),[]);var Ze=(0,a.useMemo)((function(){var e=x.data.content.map((function(e){var t;return(null===(t=e.member)||void 0===t?void 0:t.uid)||e.memberUid})).filter((function(e){return e}));return console.log("Existing agent member UIDs:",e),console.log("Agent result data:",x.data.content),e}),[x]),Fe=(0,a.useMemo)((function(){var e,t,n,a=[],r=C.trim()?R:(null==m||null===(e=m.data)||void 0===e?void 0:e.content)||[];console.log("Total members:",r.length),console.log("Existing agent member UIDs:",Ze),console.log("Using search results:",!!C.trim());for(var s=0;s<r.length;s++){var i=r[s];if(Ze.includes(i.uid))console.log("Filtering out member:",i.nickname,i.uid);else{var o={title:"",value:"",children:[]};(n=o).title=(t=i).nickname,n.value=t.uid,a.push(o)}}return console.log("Filtered tree data:",a),a}),[m,R,C,Ze]),Ue=function(){var e=c()(u()().mark((function e(t){var n,a,r,s,i=arguments;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],console.log("handleSearch:",t,"isLoadMore:",n),t.trim()||n){e.next=7;break}return P([]),B(0),Y(!0),e.abrupt("return");case 7:return n?X(!0):q(!0),e.prev=8,a={pageNumber:n?N+1:0,pageSize:20,orgUid:null==f?void 0:f.uid,searchText:t.trim()},e.next=12,(0,fe.z_)(a);case 12:r=e.sent,console.log("handleSearch Search members response:",r,a),200===r.code?(s=r.data.content||[],n?(P((function(e){return[].concat(o()(e),o()(s))})),B(N+1)):(P(s),B(0)),Y(!r.data.last)):(console.error("handleSearch Search failed:",r.message),n||P([])),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),console.error("Search error:",e.t0),n||P([]);case 21:return e.prev=21,n?X(!1):q(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[8,17,21,24]])})));return function(t){return e.apply(this,arguments)}}(),Te=function(e){var t=e.target.value;Z(t),E.current&&clearTimeout(E.current),t.trim()?E.current=setTimeout((function(){Ue(t)}),300):(P([]),B(0),Y(!0))},qe=function(){Ue(C)},Ie=function(){!G&&W&&C.trim()&&Ue(C,!0)},Ae=function(){var e=c()(u()().mark((function e(){var t,n,a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ce||!se){e.next=17;break}return ge(!0),e.prev=2,t={pageNumber:te+1,pageSize:20,orgUid:null==f?void 0:f.uid},e.next=6,(0,fe.z_)(t);case 6:n=e.sent,console.log("Load more all members response:",n),200===n.code&&(a=n.data.content||[],r=[].concat(o()(m.data.content),o()(a)),v(g()(g()({},m),{},{data:g()(g()({},m.data),{},{content:r})})),ne(te+1),ie(!n.data.last)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 14:return e.prev=14,ge(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)("div",{children:(0,J.jsx)(H.Z,{title:i.formatMessage({id:"agent.create",defaultMessage:"创建客服"}),open:t,forceRender:!0,onOk:function(){console.log("handleOk"),d.validateFields().then((function(e){var t;console.log("form values:",e);var n=d.getFieldValue("memberUids"),a=d.getFieldValue("nickname"),s=d.getFieldValue("email"),i=d.getFieldValue("mobile"),o=d.getFieldValue("settingsUid"),l=C.trim()?R:(null==m||null===(t=m.data)||void 0===t?void 0:t.content)||[],u=[];if(1===n.length){var c={nickname:a,email:s,mobile:i,memberUid:n[0],orgUid:null==f?void 0:f.uid,settingsUid:o};u.push(c)}else n.forEach((function(e){var t=l.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==f?void 0:f.uid,settingsUid:o};u.push(n)}}));console.log("agents:",u),r(u)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,J.jsxs)(xe.ZP,{form:d,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,J.jsx)(oe.Z,{label:i.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),name:"settingsUid",tooltip:i.formatMessage({id:"agent.settings.tooltip",defaultMessage:"为本次创建的客服指定配置模板"}),rules:[{required:!0,message:i.formatMessage({id:"agent.settings.required.message",defaultMessage:"请选择客服配置!"})}],fieldProps:{options:je,loading:we,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:i.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"})}}),(0,J.jsx)(Me.Z,{label:i.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),name:"memberUids",tooltip:i.formatMessage({id:"agent.info.member.tooltip",defaultMessage:"请先到组织-》成员-》创建成员，已创建过客服的成员将被过滤"}),rules:[{required:!0,message:i.formatMessage({id:"agent.info.member.required.message",defaultMessage:"请选择成员!"})}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:i.formatMessage({id:"agent.info.member.placeholder.multiple",defaultMessage:"请选择成员（可多选）"}),onChange:function(e){var t;console.log("onTreeSelectChange:",e),S(e.length);var n=C.trim()?R:(null==m||null===(t=m.data)||void 0===t?void 0:t.content)||[];if(0===e.length)d.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===e.length){var a=n.find((function(t){return t.uid===e[0]}));a&&d.setFieldsValue({nickname:a.nickname||"",email:a.email||"",mobile:a.mobile||""})}else{var r=n.filter((function(t){return e.includes(t.uid)})),s=r.map((function(e){return e.nickname})).filter(Boolean).join(", "),i=r.map((function(e){return e.email})).filter(Boolean).join(", "),o=r.map((function(e){return e.mobile})).filter(Boolean).join(", ");d.setFieldsValue({nickname:s,email:i,mobile:o})}},treeData:Fe,variant:"outlined",popupRender:function(e){return(0,J.jsxs)("div",{children:[(0,J.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,J.jsx)(M.Z,{placeholder:i.formatMessage({id:"agent.info.member.search",defaultMessage:"搜索成员"}),value:C,onChange:Te,onPressEnter:function(){return qe()},suffix:(0,J.jsx)(be.Z,{onClick:qe,style:{cursor:"pointer",color:T?"#1890ff":void 0},spin:T}),allowClear:!0,size:"small"})}),e,(C.trim()?W:se)&&(0,J.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,J.jsx)(h.ZP,{type:"link",size:"small",loading:C.trim()?G:ce,onClick:C.trim()?Ie:Ae,disabled:C.trim()?G:ce,children:(C.trim()?G:ce)?i.formatMessage({id:"loading",defaultMessage:"加载中..."}):i.formatMessage({id:"load.more",defaultMessage:"加载更多"})})})]})}}}),(0,J.jsx)(le.Z,{label:i.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),name:"nickname",disabled:y>1,tooltip:y>1?i.formatMessage({id:"agent.info.nickname.tooltip.multiple",defaultMessage:"多选模式下昵称将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.nickname.tooltip",defaultMessage:"昵称将自动从选中的成员信息中获取"})}),(0,J.jsx)(le.Z,{label:i.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),name:"email",disabled:y>1,tooltip:y>1?i.formatMessage({id:"agent.info.email.tooltip.multiple",defaultMessage:"多选模式下邮箱将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.email.tooltip",defaultMessage:"邮箱将自动从选中的成员信息中获取"})}),(0,J.jsx)(le.Z,{label:i.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),name:"mobile",disabled:y>1,tooltip:y>1?i.formatMessage({id:"agent.info.mobile.tooltip.multiple",defaultMessage:"多选模式下手机号将自动从选中的成员信息中获取"}):i.formatMessage({id:"agent.info.mobile.tooltip",defaultMessage:"手机号将自动从选中的成员信息中获取"})})]})})})},ye=function(){var e=(0,s.useIntl)(),t=(0,a.useRef)(),n=(0,O.u)((function(e){return e.currentOrg})),r=(0,a.useState)(!1),i=p()(r,2),o=i[0],l=i[1],d=(0,a.useState)(!1),f=p()(d,2),m=f[0],v=f[1],x=(0,a.useState)(null),M=p()(x,2),b=M[0],w=M[1],S=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,J.jsx)(ne.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,J.jsx)("a",{onClick:function(){w(n),l(!0)},children:n.settings.name||e.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,J.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){w(n),l(!0)},children:e.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(t,n){switch(null==n?void 0:n.status){case re.Ra4:return(0,J.jsx)(y.Z,{color:"green",children:e.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case re.tU$:return(0,J.jsx)(y.Z,{color:"orange",children:e.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case re.LZ1:default:return(0,J.jsx)(y.Z,{color:"red",children:e.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:e.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(t,n){return null!=n&&n.connected?(0,J.jsx)(y.Z,{color:"green",children:e.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,J.jsx)(y.Z,{color:"red",children:e.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(a,r){return[(0,J.jsx)("a",{onClick:function(){return function(t){var a;if(null!=t&&t.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:re._0X,sid:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)}else L.yw.error(e.formatMessage({id:"agent.invalid",defaultMessage:"无效的客服"}))}(r)},children:e.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,J.jsx)("a",{onClick:function(){return s.history.push("/service/channel")},children:e.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,J.jsx)("a",{onClick:function(){w(r),l(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,J.jsx)(k.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:c()(u()().mark((function n(){var a,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return L.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,ae.Lr)(r);case 4:a=n.sent,L.yw.destroy(),200===(null==a?void 0:a.code)?(L.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=t.current)||void 0===s||s.reload()):L.yw.error((null==a?void 0:a.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),L.yw.destroy(),L.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,J.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(te.Z,{columns:S,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,J.jsx)(h.ZP,{type:"primary",onClick:function(){w(null),v(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=c()(u()().mark((function e(t,a){var r,s,i,o,l,d,c,f,m,v,h,x,M,b,w,y,S,k,j,C,Z,F;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,l=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,d=null!==(i=null==t?void 0:t.searchText)&&void 0!==i?i:"",(m=Object.entries(a||{})).length>0&&(v=m[0],h=p()(v,2),x=h[0],(M=h[1])&&(c=x,f="ascend"===M?"ascend":"descend")),b=g()(g()({pageNumber:o,pageSize:l,orgUid:null==n?void 0:n.uid,searchText:d},c?{sortBy:c}:{}),f?{sortDirection:f}:{}),e.prev=6,e.next=9,(0,ae._t)(b);case 9:if(w=e.sent,console.log("queryAgentsByOrg response:",w,b),200!==(null==w?void 0:w.code)){e.next=15;break}return Z=(null==w||null===(y=w.data)||void 0===y?void 0:y.content)||[],F=null!==(S=null!==(k=null==w||null===(j=w.data)||void 0===j?void 0:j.totalElements)&&void 0!==k?k:null==w||null===(C=w.data)||void 0===C?void 0:C.numberOfElements)&&void 0!==S?S:Z.length,e.abrupt("return",{data:Z,total:F,success:!0});case 15:return e.abrupt("return",{data:[],total:0,success:!1});case 18:return e.prev=18,e.t0=e.catch(6),e.abrupt("return",{data:[],total:0,success:!1});case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent",defaultMessage:"Agent"})}),o&&(0,J.jsx)(pe,{open:o,record:b,onClose:function(){return l(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),m&&(0,J.jsx)(we,{open:m,onClose:function(){return v(!1)},onSubmit:function(){var n=c()(u()().mark((function n(a){var r,s,i,o,l,d,c,f,g,m,p,h,x,M,b,w;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(((null==a?void 0:a.length)||0)>200)){n.next=3;break}return L.yw.warning(e.formatMessage({id:"agent.create.batch.limit",defaultMessage:"超过最大批量 200，请分批创建"})),n.abrupt("return");case 3:r="agent-batch-create",L.yw.loading({content:e.formatMessage({id:"saving",defaultMessage:"Saving..."}),key:r,duration:0}),s=[],i=function(e){return new Promise((function(t){return setTimeout(t,e)}))},o=ee()(a),n.prev=8,o.s();case 10:if((l=o.n()).done){n.next=52;break}d=l.value,c=0,f=!1,g=null;case 15:if(!(c<3)||f){n.next=49;break}return n.prev=16,n.next=19,(0,ae.x_)(d);case 19:if(200!==(null==(m=n.sent)?void 0:m.code)){n.next=24;break}return s.push({uid:d.memberUid,ok:!0}),f=!0,n.abrupt("break",49);case 24:return s.push({uid:d.memberUid,ok:!1,code:null==m?void 0:m.code,msg:null==m?void 0:m.message}),f=!0,n.abrupt("break",49);case 29:if(n.prev=29,n.t0=n.catch(16),h=null===n.t0||void 0===n.t0||null===(p=n.t0.response)||void 0===p?void 0:p.status,g=n.t0,c+=1,!(409===h&&c<3)){n.next=40;break}return n.next=37,i(300*c);case 37:return n.abrupt("continue",15);case 40:if(502!==h&&503!==h&&504!==h||!(c<3)){n.next=44;break}return n.next=43,i(300*c);case 43:return n.abrupt("continue",15);case 44:return s.push({uid:d.memberUid,ok:!1,code:h,msg:(null===n.t0||void 0===n.t0?void 0:n.t0.message)||"error"}),f=!0,n.abrupt("break",49);case 47:n.next=15;break;case 49:!f&&g&&s.push({uid:d.memberUid,ok:!1,msg:(null===(x=g)||void 0===x?void 0:x.message)||"error"});case 50:n.next=10;break;case 52:n.next=57;break;case 54:n.prev=54,n.t1=n.catch(8),o.e(n.t1);case 57:return n.prev=57,o.f(),n.finish(57);case 60:M=s.filter((function(e){return e.ok})).length,b=s.length-M,M>0?(L.yw.success({content:e.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(M,")"),key:r}),v(!1),null===(w=t.current)||void 0===w||w.reload()):L.yw.destroy(r),b>0&&L.yw.warning(e.formatMessage({id:"create.partial.failed",defaultMessage:"部分创建失败，请查看失败项并重试"})+" (".concat(b,")"));case 64:case"end":return n.stop()}}),n,null,[[8,54,57,60],[16,29]])})));return function(e){return n.apply(this,arguments)}}()})]})},Se=n(84176),ke=n.n(Se);function je(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/agent/status/query/org",{method:"GET",params:g()(g()({},t),{},{channel:re.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ze=n(5932),Fe=n(61107),Ue=n(96596),Te=n.n(Ue),qe=["current","pageSize"],Ie=function(){var e=(0,s.useIntl)(),t=(0,a.useRef)(),n=(0,a.useState)(1),r=p()(n,2),i=r[0],o=r[1],l=(0,a.useState)(10),d=p()(l,2),f=d[0],m=d[1],v=(0,O.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,J.jsx)(s.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,J.jsx)(s.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,J.jsx)(J.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,J.jsx)(s.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,J.jsx)(s.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,J.jsx)(y.Z,{color:"green",children:(0,J.jsx)(s.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,J.jsx)(y.Z,{color:"red",children:(0,J.jsx)(s.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,J.jsx)(y.Z,{color:"orange",children:(0,J.jsx)(s.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,J.jsx)(s.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,J.jsx)(s.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,a){return Te()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],M=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,f),t=localStorage.getItem(re.LA8),window.open((0,Ze.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==v?void 0:v.uid)||"",pageNumber:String(i-1),pageSize:String(f),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)(te.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,a){var r,s,i,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,a),r=t.current,s=t.pageSize,i=ke()(t,qe),o(r),m(s),l=g()({pageNumber:r-1,pageSize:s,orgUid:null==v?void 0:v.uid},i),e.next=7,je(l);case 7:return d=e.sent,console.log("queryAgentStatusByOrg response:",l,d),200===d.code||L.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){o(e),m(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,J.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,J.jsx)(R.Z,{}),children:(0,J.jsx)(s.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,J.jsx)(h.ZP,{onClick:M,type:"primary",icon:(0,J.jsx)(Fe.Z,{}),children:(0,J.jsx)(s.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},Ae=function(){return(0,J.jsx)(r.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,J.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,J.jsx)(ye,{})},{key:"settings",label:(0,J.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,J.jsx)(X,{})},{key:"agentStatus",label:(0,J.jsx)(s.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,J.jsx)(Ie,{})}]})}},50246:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(39497),r=n(58063),s=n(66266),i=n(31403),o=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n.splice(a,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:a.PQL})))}}]);