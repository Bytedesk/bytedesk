"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7960],{47944:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},15722:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},11090:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},30617:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},42085:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},2484:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},82669:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},68263:function(e,t,n){var r=n(94433),a=n(38956),s=n(37150),i=n(44194),o=n(85618),l=n(35865),u=n(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var n=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.showSearch,x=e.options,b=(0,a.Z)(e,d),M=(0,i.useContext)(o.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:x,mode:m,showSearch:v,getPopupContainer:M.getPopupContainer},n),ref:t,proFieldProps:p},b),{},{children:c}))},p=i.forwardRef((function(e,t){var n=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.options,x=(0,a.Z)(e,c),b=(0,r.Z)({options:v,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),M=(0,i.useContext)(o.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:M.getPopupContainer},b),ref:t,proFieldProps:p},x),{},{children:d}))})),m=i.forwardRef(f);m.SearchSelect=p,m.displayName="ProFormComponent",t.Z=m},86684:function(e,t,n){var r=n(32906),a=n(94433),s=n(38956),i=n(81424),o=n(58867),l=n(31543),u=n(34573),d=n(44194),c=n(35865),f=n(31549),p=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",h=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,r.Z)(t,2),s=n[0],u=n[1];return(0,f.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,s.Z)(e,p);return(0,f.jsx)(c.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:n},r))};v.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,i=(0,s.Z)(e,m),o=(0,d.useState)(!1),l=(0,r.Z)(o,2),p=l[0],v=l[1];return null!=t&&t.statusRender&&i.name?(0,f.jsx)(h,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),v(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),v(!0)}}),proFieldProps:n,filedConfig:{valueType:g}},i))})}):(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:g}},i))},v.displayName="ProFormComponent",t.Z=v},13847:function(e,t,n){var r=n(94433),a=n(38956),s=n(44194),i=n(35865),o=n(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var n=e.fieldProps,s=e.proFieldProps,u=(0,a.Z)(e,l);return(0,o.jsx)(i.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:s},u))};t.Z=s.forwardRef(u)},52491:function(e,t,n){var r=n(94433),a=n(38956),s=n(44194),i=n(35865),o=n(31549),l=["fieldProps","request","params","proFieldProps"],u=function(e,t){var n=e.fieldProps,s=e.request,u=e.params,d=e.proFieldProps,c=(0,a.Z)(e,l);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:u,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(u);t.Z=d},48337:function(e,t,n){n.d(t,{Cd:function(){return b},E9:function(){return c},Rd:function(){return v},fA:function(){return p},ul:function(){return g}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/reset/level",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17509:function(e,t,n){n.d(t,{If:function(){return v},dF:function(){return c},j4:function(){return g},v$:function(){return p}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67728:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return v},hS:function(){return g},z_:function(){return c}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(6844),d=n(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},88449:function(e,t,n){var r=n(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},28151:function(e,t,n){n.r(t),n.d(t,{default:function(){return Me}});var r=n(85255),a=n(44194),s=n(88449),i=n(73193),o=n.n(i),l=n(84176),u=n.n(l),d=n(76711),c=n.n(d),f=n(90819),p=n.n(f),m=n(89933),g=n.n(m),h=n(86222),v=n.n(h),x=n(45332),b=n.n(x),M=n(67728),y=n(11394),w=n(14888),j=n(10162),Z=n(54881),k=n(30617),S=n(11090),C=n(61107),P=n(2484),F=n(86307),D=n(46141),E=n(5089),T=n(66810),z=n(77359),R=n(3925),U=n(71277),I=n(6844),q=n(30064),O=n(86684),B=n(68263),N=n(19736),A=n(61689),$=n(9428),V=n(74491),H=n(24184),G=n(93527),L=n(48337),Q=n(44679),J=n(73546),X=n(36125),W=n(31549),_=E.Z.Text,K=function(e){var t,n,r=e.isEdit,s=e.member,i=e.open,l=e.onClose,u=e.onSubmit,d=e.isSubmitting,f=void 0!==d&&d,m=q.A.useForm(),h=b()(m,1)[0],v=(0,N.useIntl)(),x=(0,Q.Z)().translateString,M=(0,y.H)((function(e){return e.departmentResult})),j=(0,w.u)((function(e){return e.currentOrg})),Z=(0,a.useState)([]),k=b()(Z,2),S=k[0],C=k[1],P=(0,a.useState)([]),F=b()(P,2),D=F[0],E=F[1],T=(0,a.useState)(0),z=b()(T,2),U=z[0],K=z[1],Y=(0,a.useState)(!1),ee=b()(Y,2),te=ee[0],ne=ee[1];(0,a.useEffect)((function(){r&&s&&h?h.setFieldsValue({uid:null==s?void 0:s.uid,nickname:null==s?void 0:s.nickname,email:null==s?void 0:s.email,mobile:null==s?void 0:s.mobile,jobNo:null==s?void 0:s.jobNo,jobTitle:x(null==s?void 0:s.jobTitle),seatNo:null==s?void 0:s.seatNo,telephone:null==s?void 0:s.telephone,deptUid:null==s?void 0:s.deptUid}):(X.Z.debug("form resetFields"),h.resetFields(),C([I.nGQ]),h.setFieldsValue({roleUids:[I.nGQ]}),K(0))}),[s,r]);var re,ae=function e(t,n){var r;if(null!=t&&null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=v.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name,n.value=t.uid,t.children)for(var a=0;a<t.children.length;a++){var s={title:"",value:"",children:[]};e(t.children[a],s),n.children.push(s)}},se=(0,a.useMemo)((function(){for(var e=[],t=0;t<M.data.content.length;t++)if(M.data.content[t].name!==I.zBg){var n={title:"",value:"",children:[]};ae(M.data.content[t],n),e.push(n)}return e}),[M]),ie=function(){var e=g()(p()().mark((function e(){var t,n,r,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return G.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:null==j?void 0:j.uid,orgAndPlatform:!0},e.next=4,(0,L.E9)(t);case 4:n=e.sent,X.Z.debug("queryRolesByOrg response ",n),200===n.code?(G.yw.destroy(),r=null==n?void 0:n.data.content.find((function(e){return e.uid===I.nGQ})),r||null==n||n.data.content.push({uid:I.nGQ,name:"member",description:"成员角色",system:!0}),a=null==n?void 0:n.data.content,E(a)):(G.yw.destroy(),G.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e,t=(null==s||null===(e=s.roleUids)||void 0===e?void 0:e.filter((function(e){return""!==e})))||[];C(t)}),[s]),(0,a.useEffect)((function(){i&&(ie(),r||(C([I.nGQ]),h.setFieldsValue({roleUids:[I.nGQ]}),K(0)))}),[i,r]),(0,W.jsx)("div",{children:(0,W.jsx)(A.Z,{title:r?(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.edit.title"}):(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.create.title"}),onClose:l,open:i,width:600,extra:(0,W.jsxs)($.Z,{children:[(0,W.jsx)(R.ZP,{onClick:l,disabled:f,children:(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.button.cancel"})}),(0,W.jsx)(R.ZP,{onClick:function(){X.Z.debug("handleSubmit"),h.validateFields().then((function(e){X.Z.debug("Form values:",e);var t=o()({uid:null==s?void 0:s.uid,nickname:e.nickname,email:e.email,mobile:e.mobile,jobNo:e.jobNo,jobTitle:e.jobTitle,seatNo:e.seatNo,telephone:e.telephone,deptUid:e.deptUid,orgUid:null==j?void 0:j.uid,roleUids:S},!r&&e.password&&{password:e.password});X.Z.debug("memberObject:",t),u(t)})).catch((function(e){X.Z.debug("Form errors:",e)}))},type:"primary",loading:f,disabled:f,children:(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.button.save"})})]}),children:(0,W.jsxs)(q.A,{form:h,name:"memForm",submitter:!1,children:[(0,W.jsx)(q.A.Item,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.department"}),name:"deptUid",rules:[{required:!0,message:v.formatMessage({id:"team.member.form.department.required"})}],children:(0,W.jsx)(V.Z,{placeholder:v.formatMessage({id:"team.member.form.department.placeholder"}),allowClear:!0,treeDefaultExpandAll:!0,treeData:se,variant:"outlined",styles:{popup:{root:{maxHeight:400,overflow:"auto"}}}})}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.name",defaultMessage:"昵称"}),name:"nickname",rules:[{required:!0,message:v.formatMessage({id:"team.member.form.name.required"})}]}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.mobile"}),name:"mobile",disabled:r,rules:[{required:!0,message:v.formatMessage({id:"team.member.form.mobile.required"})},{pattern:/^1[3456789]\d{9}$/,message:v.formatMessage({id:"team.member.form.mobile.invalid"})}]}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.email"}),name:"email",disabled:r,rules:[{required:!0,message:v.formatMessage({id:"team.member.form.email.required"})},{type:"email",message:v.formatMessage({id:"team.member.form.email.invalid"})}]}),!r&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(O.Z.Password,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.password"}),name:"password",rules:[{required:!0,message:v.formatMessage({id:"team.member.form.password.required"})},{min:6,message:v.formatMessage({id:"team.member.form.password.min"})}],placeholder:v.formatMessage({id:"team.member.form.password.placeholder"}),fieldProps:{onChange:function(e){var t=e.target.value;if(t){var n=(0,J.Qc)(t);K(n)}else K(0)}}}),U>0&&(0,W.jsxs)("div",{style:{marginBottom:16},children:[(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,W.jsx)(_,{children:"密码强度:"}),(0,W.jsx)(_,{type:"secondary",children:(0,J.$g)(U)})]}),(0,W.jsx)(H.Z,{percent:U,strokeColor:(re=U,re>=80?"#52c41a":re>=60?"#faad14":re>=40?"#ff7a45":"#ff4d4f"),size:"small",showInfo:!1}),(0,W.jsx)("div",{style:{marginTop:4},children:(0,W.jsx)(_,{type:"secondary",style:{fontSize:"12px"},children:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})]})]}),(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser)&&(0,W.jsx)("p",{children:"超级管理员拥有所有权限，禁止编辑角色"}),(0,W.jsx)(B.Z,{name:"roleUids",label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.role"}),width:"md",disabled:null==s||null===(n=s.user)||void 0===n?void 0:n.superUser,options:(D||[]).filter((function(e){return e.uid===I.nGQ||!e.system||S.includes(e.uid)})).map((function(e){return{value:e.uid,label:x(e.name),disabled:(!0===e.system||e.uid===I.nGQ)&&!S.includes(e.uid)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:v.formatMessage({id:"team.member.form.role.placeholder"}),value:S,onChange:function(e){X.Z.debug("selected ".concat(e));var t=D.filter((function(e){return!0===e.system})).map((function(e){return e.uid})),n=S.filter((function(n){return t.includes(n)&&!e.includes(n)}));if(n.length>0){var r=[].concat(c()(e),c()(n));G.yw.warning("系统角色不允许取消选择");var a=r.filter((function(e){return""!==e}));C(a)}else if(e.includes(I.nGQ)){var s=e.filter((function(e){return""!==e}));C(s)}else{var i=[].concat(c()(e),[I.nGQ]);G.yw.warning("成员角色不允许取消选择");var o=i.filter((function(e){return""!==e}));C(o)}},optionItemRender:function(e){var t=D.find((function(t){return t.uid===e.value}));return null!=t&&t.system?(0,W.jsxs)("span",{children:[e.label," ",S.includes(e.value)&&"(系统角色，不可取消)"]}):e.value===I.nGQ?(0,W.jsxs)("span",{children:[e.label," ",S.includes(e.value)&&"(成员角色，不可取消)"]}):e.label}}}),(0,W.jsx)("div",{style:{marginBottom:16},children:(0,W.jsx)(R.ZP,{type:"link",onClick:function(){return ne(!te)},style:{padding:0},children:te?"隐藏高级设置":"高级设置"})}),te&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.jobNo"}),name:"jobNo"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.jobTitle"}),name:"jobTitle"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.seatNo"}),name:"seatNo"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.telephone"}),name:"telephone"})]})]})})})},Y=n(58867),ee=n(93189),te=n(48769),ne=n(24008),re=function(e){var t,n,r,s=e.open,i=e.member,o=e.onClose,l=e.onSuccess,u=(0,N.useIntl)(),d=Y.Z.useForm(),c=b()(d,1)[0],f=(0,a.useState)(!1),m=b()(f,2),h=m[0],v=m[1],x=(0,a.useState)(0),M=b()(x,2),y=M[0],w=M[1],j=(0,a.useState)(!1),Z=b()(j,2),k=Z[0],S=Z[1],C=function(){c.resetFields(),w(0),S(!1)},P=function(){C(),o()},F=function(){var e=g()(p()().mark((function e(t){var n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i&&null!==(n=i.user)&&void 0!==n&&n.uid){e.next=3;break}return ee.ZP.error(u.formatMessage({id:"change.password.error.noUid",defaultMessage:"用户ID不存在"})),e.abrupt("return");case 3:return y<40&&ee.ZP.warning(u.formatMessage({id:"change.password.warning.weakPassword",defaultMessage:"密码强度较弱，建议使用更强的密码"})),v(!0),e.prev=5,e.next=8,(0,ne.TZ)({uid:i.user.uid,newPassword:t.newPassword});case 8:200===(r=e.sent).code?(ee.ZP.success(u.formatMessage({id:"change.password.success",defaultMessage:"密码修改成功"})),P(),null==l||l()):ee.ZP.error(r.message||u.formatMessage({id:"change.password.failed",defaultMessage:"密码修改失败"})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),ee.ZP.error(u.formatMessage({id:"change.password.error",defaultMessage:"密码修改出错"}));case 15:return e.prev=15,v(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[5,12,15,18]])})));return function(t){return e.apply(this,arguments)}}(),E=function(e){return e>=80?"#52c41a":e>=60?"#faad14":e>=40?"#fa8c16":"#ff4d4f"};return(0,a.useEffect)((function(){s||C()}),[s]),(0,W.jsx)(D.Z,{title:u.formatMessage({id:"change.password",defaultMessage:"修改密码"}),open:s,onCancel:P,footer:null,destroyOnHidden:!0,width:500,children:(0,W.jsxs)(Y.Z,{form:c,onFinish:F,layout:"vertical",requiredMark:!1,children:[(0,W.jsx)(Y.Z.Item,{label:u.formatMessage({id:"user.nickname",defaultMessage:"用户昵称"}),children:(0,W.jsx)(te.Z,{value:(null==i?void 0:i.nickname)||"",disabled:!0,placeholder:u.formatMessage({id:"user.nickname.placeholder",defaultMessage:"用户昵称"})})}),(0,W.jsx)(Y.Z.Item,{label:u.formatMessage({id:"user.username",defaultMessage:"用户名"}),children:(0,W.jsx)(te.Z,{value:(null==i||null===(t=i.user)||void 0===t?void 0:t.username)||"",disabled:!0,placeholder:u.formatMessage({id:"user.username.placeholder",defaultMessage:"用户名"})})}),(0,W.jsx)(Y.Z.Item,{name:"newPassword",label:u.formatMessage({id:"new.password",defaultMessage:"新密码"}),rules:[{required:!0,message:u.formatMessage({id:"new.password.required",defaultMessage:"请输入新密码"})},{min:6,message:u.formatMessage({id:"new.password.minLength",defaultMessage:"密码长度不能少于6位"})},{max:50,message:u.formatMessage({id:"new.password.maxLength",defaultMessage:"密码长度不能超过50位"})}],children:(0,W.jsx)(te.Z.Password,{placeholder:u.formatMessage({id:"new.password.placeholder",defaultMessage:"请输入新密码"}),onChange:function(e){var t=e.target.value,n=(0,J.Qc)(t);w(n)},visibilityToggle:{visible:k,onVisibleChange:S}})}),y>0&&(0,W.jsxs)(Y.Z.Item,{children:[(0,W.jsxs)("div",{style:{marginBottom:8},children:[(0,W.jsxs)("span",{style:{marginRight:8},children:[u.formatMessage({id:"password.strength",defaultMessage:"密码强度"}),":"]}),(0,W.jsx)("span",{style:{color:E(y),fontWeight:"bold"},children:(n=y,r=(0,J.$g)(n),u.formatMessage({id:"password.strength.".concat(r),defaultMessage:r}))})]}),(0,W.jsx)(H.Z,{percent:y,strokeColor:E(y),size:"small",showInfo:!1}),(0,W.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:u.formatMessage({id:"password.strength.tip",defaultMessage:"建议使用包含大小写字母、数字和特殊字符的强密码"})})]}),(0,W.jsx)(Y.Z.Item,{name:"confirmPassword",label:u.formatMessage({id:"confirm.password",defaultMessage:"确认密码"}),dependencies:["newPassword"],rules:[{required:!0,message:u.formatMessage({id:"confirm.password.required",defaultMessage:"请确认新密码"})},function(e){var t=e.getFieldValue;return{validator:function(e,n){return n&&t("newPassword")!==n?Promise.reject(new Error(u.formatMessage({id:"confirm.password.mismatch",defaultMessage:"两次输入的密码不一致"}))):Promise.resolve()}}}],children:(0,W.jsx)(te.Z.Password,{placeholder:u.formatMessage({id:"confirm.password.placeholder",defaultMessage:"请再次输入新密码"})})}),(0,W.jsx)(Y.Z.Item,{children:(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[(0,W.jsx)(R.ZP,{onClick:P,disabled:h,children:u.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,W.jsx)(R.ZP,{type:"primary",htmlType:"submit",loading:h,disabled:y<20,children:u.formatMessage({id:"confirm",defaultMessage:"确认"})})]})})]})})},ae=n(65819),se=n(34718),ie=n(17509),oe=n(28506),le=["current","pageSize"],ue=function(){var e,t,n,r,s,i,l,d,f,m,h,x,q,O=(0,a.useRef)(),B=(0,N.useIntl)(),A=(0,a.useRef)(!1),$=(0,a.useRef)(!1),V=(0,Q.Z)().translateString,H=(0,a.useState)(!0),J=b()(H,2),_=J[0],Y=J[1],ee=(0,a.useState)(1),te=b()(ee,2),ne=te[0],ue=te[1],de=(0,a.useState)(10),ce=b()(de,2),fe=ce[0],pe=ce[1],me=(0,a.useState)({}),ge=b()(me,2),he=ge[0],ve=ge[1],xe=(0,a.useState)(),be=b()(xe,2),Me=be[0],ye=be[1],we=(0,a.useState)(!1),je=b()(we,2),Ze=je[0],ke=je[1],Se=(0,w.u)((function(e){return e.currentOrg})),Ce=(0,oe.L)((function(e){return e.userInfo})),Pe=(0,y.H)((function(e){return e.currentDepartment})),Fe=D.Z.useModal(),De=b()(Fe,2),Ee=De[0],Te=De[1],ze=(0,a.useState)(!1),Re=b()(ze,2),Ue=Re[0],Ie=Re[1],qe=(0,a.useState)(),Oe=b()(qe,2),Be=Oe[0],Ne=Oe[1],Ae=(0,y.H)((function(e){return{departmentResult:e.departmentResult,setDepartmentResult:e.setDepartmentResult}})),$e=Ae.departmentResult,Ve=Ae.setDepartmentResult,He=(0,a.useState)([]),Ge=b()(He,2),Le=Ge[0],Qe=Ge[1],Je=(0,a.useState)([]),Xe=b()(Je,2),We=Xe[0],_e=Xe[1],Ke=(0,a.useState)([]),Ye=b()(Ke,2),et=Ye[0],tt=Ye[1],nt=(0,a.useState)(0),rt=b()(nt,2),at=rt[0],st=rt[1],it=(0,a.useState)(!1),ot=b()(it,2),lt=ot[0],ut=ot[1],dt=(0,a.useState)(!1),ct=b()(dt,2),ft=ct[0],pt=ct[1],mt=(0,N.useAccess)(),gt=null!==(e=null==mt||null===(t=mt.canSuper)||void 0===t?void 0:t.call(mt))&&void 0!==e&&e,ht=(0,a.useMemo)((function(){var e;return null==mt||null===(e=mt.getModulePermission)||void 0===e?void 0:e.call(mt,"MEMBER")}),[mt]),vt=(0,a.useMemo)((function(){return gt?I.Hxq:null!=Pe&&Pe.uid&&(null==Pe?void 0:Pe.uid)!==I.zBg?I.nYM:I.whQ}),[gt,Pe]),xt=null!==(n=null==ht||null===(r=ht.canRead)||void 0===r?void 0:r.call(ht,vt))&&void 0!==n&&n,bt=null!==(s=null==ht||null===(i=ht.canCreate)||void 0===i?void 0:i.call(ht,vt))&&void 0!==s&&s,Mt=null!==(l=null==ht||null===(d=ht.canUpdate)||void 0===d?void 0:d.call(ht,vt))&&void 0!==l&&l,yt=null!==(f=null==ht||null===(m=ht.canDelete)||void 0===m?void 0:m.call(ht,vt))&&void 0!==f&&f,wt=null!==(h=null==ht||null===(x=ht.canExport)||void 0===x?void 0:x.call(ht,vt))&&void 0!==h&&h,jt=function(e,t){G.yw.warning(B.formatMessage({id:e,defaultMessage:t}))},Zt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,W.jsx)(N.FormattedMessage,{id:"pages.user.nickname",defaultMessage:"昵称"}),dataIndex:"nickname",fixed:"left",copyable:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.nickname.tooltip",defaultMessage:"成员的昵称或显示名称"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"pages.user.username",defaultMessage:"Username"}),dataIndex:"username",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.username.tooltip",defaultMessage:"成员的登录账号名称"}),render:function(e,t){var n,r=null==t||null===(n=t.user)||void 0===n?void 0:n.username;return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("span",{children:r}),r&&(0,W.jsx)(E.Z.Text,{copyable:{text:r},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.mobile.tooltip",defaultMessage:"成员的手机号码联系方式"}),render:function(e,t){return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("a",{href:"tel:".concat(t.mobile),children:t.mobile}),t.mobile&&(0,W.jsx)(E.Z.Text,{copyable:{text:t.mobile},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",copyable:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.email.tooltip",defaultMessage:"成员的电子邮箱地址"}),render:function(e,t){return(0,W.jsx)("a",{href:"mailto:".concat(e),children:e})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"jobNo",defaultMessage:"工号"}),dataIndex:"jobNo",copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.jobNo.tooltip",defaultMessage:"成员在组织内部的工号标识"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"jobTitle",defaultMessage:"职位"}),dataIndex:"jobTitle",copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.jobTitle.tooltip",defaultMessage:"成员在组织内的职位或职务名称"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"seatNo",defaultMessage:"座席号"}),dataIndex:"seatNo",copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.seatNo.tooltip",defaultMessage:"成员的座席编号，通常用于客服系统"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"telephone",defaultMessage:"电话"}),dataIndex:"telephone",copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.telephone.tooltip",defaultMessage:"成员的固定电话或分机号"}),render:function(e){return e?(0,W.jsx)("a",{href:"tel:".concat(e),children:e}):""}},{title:(0,W.jsx)(N.FormattedMessage,{id:"department",defaultMessage:"Department"}),dataIndex:"deptUid",valueType:"select",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.department.tooltip",defaultMessage:"成员所属的部门或组织单位"}),fieldProps:{options:function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=[],s=v()(t||[]);try{for(s.s();!(n=s.n()).done;){var i=n.value;if(i.uid!==I.zBg){var o=V(i.name),l=r?"".concat(r," / ").concat(o):o;a.push({label:l,value:i.uid}),i.children&&i.children.length>0&&(a=a.concat(e(i.children,l)))}}}catch(e){s.e(e)}finally{s.f()}return a}((null==$e||null===(q=$e.data)||void 0===q?void 0:q.content)||[])},render:function(e,t){var n=function e(t,n){var r,a=v()(t||[]);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.uid===n)return s;if(s.children&&s.children.length>0){var i=e(s.children,n);if(i)return i}}}catch(e){a.e(e)}finally{a.f()}return null}($e.data.content,t.deptUid);return n?(0,W.jsx)(T.Z,{color:"green",children:V(n.name)}):""}},{title:(0,W.jsx)(N.FormattedMessage,{id:"roles",defaultMessage:"Roles"}),dataIndex:"roleUids",hideInSearch:!0,width:180,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.roles.tooltip",defaultMessage:"成员拥有的角色，决定其系统权限"}),render:function(e,t){var n=t.roleUids.filter((function(e){return""!==e})).map((function(e){var t=Le.find((function(t){return t.uid===e}));return t?V(t.name):""}));return(0,W.jsx)(W.Fragment,{children:n.map((function(e,t){return e&&(0,W.jsx)(T.Z,{color:"blue",style:{margin:"2px"},children:e},t)}))})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,hideInSearch:!0,sorter:!0,valueType:"dateTime",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.createdAt.tooltip",defaultMessage:"成员创建或添加的时间"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0,valueType:"dateTime",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.updatedAt.tooltip",defaultMessage:"成员信息最后更新的时间"})},{title:B.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.actions.tooltip",defaultMessage:"对成员可执行的操作，如编辑、删除等"}),render:function(e,t,n,r){var a,s,i=[];return Mt&&(i.push((0,W.jsx)("a",{onClick:function(){X.Z.debug("editable:",t),Rt(t)},children:B.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),i.push((0,W.jsx)("a",{onClick:function(){X.Z.debug("changePassword:",t),Bt(t)},children:B.formatMessage({id:"change.password",defaultMessage:"修改密码"})},"changePassword"))),!yt||null!=t&&null!==(a=t.user)&&void 0!==a&&a.superUser||(null==t||null===(s=t.user)||void 0===s?void 0:s.uid)===(null==Ce?void 0:Ce.uid)||i.push((0,W.jsx)(z.Z,{title:B.formatMessage({id:"deleteTip"}),description:"".concat(B.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.nickname,"】？"),onConfirm:function(){return Ft(t)},okText:B.formatMessage({id:"ok"}),cancelText:B.formatMessage({id:"cancel"}),children:(0,W.jsx)(R.ZP,{type:"link",danger:!0,children:B.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")),i}}],kt=function(){var e=g()(p()().mark((function e(){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(bt){e.next=3;break}return jt("member.permission.createDenied","暂无创建成员权限"),e.abrupt("return");case 3:Ie(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),St=function(){var e=g()(p()().mark((function e(){var t,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return G.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:null==Se?void 0:Se.uid,orgAndPlatform:!0},e.next=4,(0,L.E9)(t);case 4:n=e.sent,X.Z.debug("queryRolesByOrg response ",n),200===n.code?(G.yw.destroy(),(null==n?void 0:n.data.content).forEach((function(e){Le.find((function(t){return t.uid===e.uid}))||Qe((function(t){return[].concat(c()(t),[e])}))}))):(G.yw.destroy(),G.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ct=function(){var e=g()(p()().mark((function e(t){var n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X.Z.debug("handleSubmitDrawer:",t),!_||Mt){e.next=4;break}return jt("member.permission.updateDenied","暂无编辑成员权限"),e.abrupt("return");case 4:if(_||bt){e.next=7;break}return jt("member.permission.createDenied","暂无创建成员权限"),e.abrupt("return");case 7:if(pt(!0),e.prev=8,!_){e.next=17;break}return e.next=12,(0,M.hS)(t);case 12:n=e.sent,X.Z.debug("updateMember:",n),200===n.code?(G.yw.success(B.formatMessage({id:"update.success",defaultMessage:"update success"})),O.current.reload(),Ut()):G.yw.error(n.message),e.next=22;break;case 17:return e.next=19,(0,M.D$)(t);case 19:r=e.sent,X.Z.debug("createMember:",r),200===r.code?(G.yw.success(B.formatMessage({id:"create.success",defaultMessage:"create success"})),O.current.reload(),Ut()):G.yw.error(r.message);case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),console.error("提交失败:",e.t0),G.yw.error(B.formatMessage({id:"submit.error",defaultMessage:"提交失败，请重试"}));case 28:return e.prev=28,pt(!1),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[8,24,28,31]])})));return function(t){return e.apply(this,arguments)}}(),Pt=function(){var e=g()(p()().mark((function e(){var t,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,orgUid:null==Se?void 0:Se.uid},e.next=3,(0,ie.dF)(t);case 3:n=e.sent,X.Z.debug("queryDepartmentsByOrg:",n,t),200===n.code?Ve(n):G.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ft=function(){var e=g()(p()().mark((function e(t){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt){e.next=3;break}return jt("member.permission.deleteDenied","暂无删除成员权限"),e.abrupt("return");case 3:return X.Z.debug("delete mem:",t),e.next=6,(0,M.EP)(t);case 6:n=e.sent,X.Z.debug("deleteMember:",n),200===n.code?(G.yw.success(B.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),O.current.reload()):G.yw.error(n.message);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Dt={selectedRowKeys:We,onChange:function(e,t){_e(e),tt(t)},getCheckboxProps:function(e){var t,n;return{disabled:(null==e||null===(t=e.user)||void 0===t?void 0:t.superUser)||(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)===(null==Ce?void 0:Ce.uid),name:e.nickname}}};(0,a.useEffect)((function(){St()}),[]),(0,a.useEffect)((function(){O.current.reload()}),[Pe]);var Et,Tt=function(){var e=g()(p()().mark((function e(t,n,r){var a,s,i,l,d,c,f,m,g;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return $.current||(jt("member.permission.readDenied","暂无查看成员权限"),$.current=!0),e.abrupt("return",{data:[],success:!0,total:0});case 3:if(!A.current){e.next=6;break}return X.Z.debug("isLoading: 1",A.current),e.abrupt("return",{});case 6:return A.current=!0,G.yw.loading("正在加载"),s=t.current,i=t.pageSize,l=u()(t,le),ve(l),ue(s),pe(i),d=void 0,c=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],d=f,c="ascend"===n[f]?"ascend":"descend"),m=o()(o()({pageNumber:s-1,pageSize:i,orgUid:null==Se?void 0:Se.uid,deptUid:(null==Pe?void 0:Pe.uid)===I.zBg?"":null==Pe?void 0:Pe.uid,subDeptUids:(null==Pe||null===(a=Pe.children)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]},l),{},{sortBy:d,sortDirection:c}),e.next=18,(0,M.z_)(m);case 18:return g=e.sent,X.Z.debug("queryMembersByOrg:",m,g),200===g.code?st(null==g?void 0:g.data.totalElements):G.yw.error(g.message),A.current=!1,G.yw.destroy(),e.abrupt("return",{data:null==g?void 0:g.data.content,success:!0,total:null==g?void 0:g.data.totalElements});case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),zt=function(){bt?(ye(void 0),Y(!1),ke(!0)):jt("member.permission.createDenied","暂无创建成员权限")},Rt=function(e){Mt?(ye(e),Y(!0),ke(!0)):jt("member.permission.updateDenied","暂无编辑成员权限")},Ut=function(){ke(!1)},It=function(){var e=g()(p()().mark((function e(t,n,r){var a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wt){e.next=3;break}return jt("member.permission.exportDenied","暂无导出成员权限"),e.abrupt("return");case 3:X.Z.debug("handleExportExcel",t,n,r,he),a=localStorage.getItem(I.LA8),s=o()(o()({orgUid:(null==Se?void 0:Se.uid)||"",accessToken:a||"",exportType:t},he),{},{deptUid:(null==Pe?void 0:Pe.uid)===I.zBg?"":null==Pe?void 0:Pe.uid}),"current"===t?(s.pageNumber=String(ne-1),s.pageSize=String(fe)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,ae.kG)()+"/api/v1/member/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),qt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return It("range",r,n)}})},s=0;s<r;s++)a();return t},Ot=function(){var e=g()(p()().mark((function e(){var t,n,r,a,s,i,o,l,u,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt){e.next=3;break}return jt("member.permission.deleteDenied","暂无删除成员权限"),e.abrupt("return");case 3:if(0!==et.length){e.next=6;break}return G.yw.warning(B.formatMessage({id:"batch.delete.noselection",defaultMessage:"请先选择要删除的项目"})),e.abrupt("return");case 6:if(n=et.filter((function(e){var t,n;return!(null!=e&&null!==(t=e.user)&&void 0!==t&&t.superUser)&&(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)!==(null==Ce?void 0:Ce.uid)})),0!==n.length){e.next=10;break}return G.yw.warning(B.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"选中的都是超级用户或当前登录用户，无法删除"})),e.abrupt("return");case 10:n.length<et.length&&(r=et.filter((function(e){var t;return null==e||null===(t=e.user)||void 0===t?void 0:t.superUser})).length,a=et.filter((function(e){var t;return(null==e||null===(t=e.user)||void 0===t?void 0:t.uid)===(null==Ce?void 0:Ce.uid)})).length,s=B.formatMessage({id:"batch.delete.containsSpecialUsers",defaultMessage:"选中的 {total} 项中包含 {skippedCount} 项无法删除"},{total:et.length,skippedCount:et.length-n.length}),r>0&&a>0?s+=B.formatMessage({id:"batch.delete.superAndCurrentUsers",defaultMessage:"（包括 {superCount} 个超级用户和当前登录用户）"},{superCount:r}):r>0?s+=B.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"（{superCount} 个超级用户）"},{superCount:r}):a>0&&(s+=B.formatMessage({id:"batch.delete.currentUser",defaultMessage:"（当前登录用户）"})),G.yw.warning(s)),G.yw.loading(B.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),i=0,o=0,l=v()(n),e.prev=15,l.s();case 17:if((u=l.n()).done){e.next=31;break}return d=u.value,e.prev=19,e.next=22,(0,M.EP)(d);case 22:200===e.sent.code?i++:o++,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(19),o++;case 29:e.next=17;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(15),l.e(e.t1);case 36:return e.prev=36,l.f(),e.finish(36);case 39:G.yw.destroy(),0===o?G.yw.success(B.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:i})):G.yw.warning(B.formatMessage({id:"batch.delete.partial",defaultMessage:"已删除 {success} 项，{fail} 项删除失败"},{success:i,fail:o})),_e([]),tt([]),null===(t=O.current)||void 0===t||t.reloadAndRest();case 44:case"end":return e.stop()}}),e,null,[[15,33,36,39],[19,26]])})));return function(){return e.apply(this,arguments)}}(),Bt=function(e){Mt?(Ne(e),ut(!0)):jt("member.permission.updateDenied","暂无编辑成员权限")};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(F.Z,{columns:Zt,actionRef:O,cardBordered:!0,rowSelection:yt?Dt:void 0,request:Tt,rowKey:"uid",scroll:{x:2500},search:{labelWidth:"auto"},pagination:{pageSize:fe,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){ue(e),pe(t)}},headerTitle:null!=Pe&&null!==(Et=Pe.name)&&void 0!==Et&&Et.startsWith("i18n.")?B.formatMessage({id:null==Pe?void 0:Pe.name,defaultMessage:null==Pe?void 0:Pe.name}):null==Pe?void 0:Pe.name,toolBarRender:function(){var e=[];bt&&e.push((0,W.jsx)(R.ZP,{icon:(0,W.jsx)(j.Z,{}),type:"primary",onClick:zt,children:B.formatMessage({id:"create.member",defaultMessage:"创建成员"})},"create"));var t=[];yt&&We.length>0&&t.push({key:"batchDelete",icon:(0,W.jsx)(Z.Z,{}),danger:!0,label:B.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(We.length,")"),onClick:function(){Ee.confirm({title:B.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),content:"".concat(B.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确认删除选中的"})," ").concat(We.length," ").concat(B.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:Ot,okText:B.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:B.formatMessage({id:"cancel",defaultMessage:"取消"})})}});var n=[];return bt&&n.push({key:"import",icon:(0,W.jsx)(k.Z,{}),label:B.formatMessage({id:"import",defaultMessage:"导入"}),onClick:kt}),wt&&(n.push({key:"export-current",icon:(0,W.jsx)(S.Z,{}),label:B.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return It("current")}}),at>0&&(at<=1e3?n.push({key:"export-all",icon:(0,W.jsx)(S.Z,{}),label:B.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(at,"条)"),onClick:function(){return It("all")}}):n.push({key:"export-range",icon:(0,W.jsx)(S.Z,{}),label:B.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(at,"条)"),children:qt(at)}))),bt&&n.push({key:"download",icon:(0,W.jsx)(C.Z,{}),label:B.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,ae.$E)()}}),n.length>0&&e.push((0,W.jsx)(U.Z,{menu:{items:n},placement:"bottom",children:(0,W.jsxs)(R.ZP,{type:"primary",children:[B.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,W.jsx)(P.Z,{})]})},"importExport")),t.length>0&&e.push((0,W.jsx)(U.Z,{menu:{items:t},placement:"bottom",children:(0,W.jsxs)(R.ZP,{type:We.length>0?"primary":"default",danger:We.length>0,children:[We.length>0?B.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(We.length,")"):B.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,W.jsx)(P.Z,{})]})},"batchOperations")),e}}),Ze&&(0,W.jsx)(K,{isEdit:_,member:Me,open:Ze,onClose:Ut,onSubmit:Ct,isSubmitting:ft}),Ue&&(0,W.jsx)(se.Z,{type:I.zey,acceptType:".xls,.xlsx,.csv",isModalOpen:Ue,handleSubmit:function(e){X.Z.debug("handleUploadDragSubmit",e),Ie(!1),Pt(),null==O||O.current.reload()},handleCancel:function(){X.Z.debug("handleUploadDragCancel"),Ie(!1),null==O||O.current.reload()}}),(0,W.jsx)(re,{open:lt,member:Be,onClose:function(){ut(!1)},onSuccess:function(){var e;null===(e=O.current)||void 0===e||e.reload()}}),Te]})},de=n(70984),ce=n(51936),fe=n(15722),pe=n(82669),me=n(80556),ge=n(59304),he=n(52491),ve=n(13847),xe=function(e){var t=e.open,n=e.isEdit,r=e.department,s=e.onCancel,i=e.onSubmit,o=Y.Z.useForm(),l=b()(o,1)[0],u=(0,N.useIntl)(),d=(0,y.H)((function(e){return e.departmentResult})),c=(0,w.u)((function(e){return e.currentOrg})),f=(0,Q.Z)().translateString,m=(0,a.useRef)(null);(0,a.useEffect)((function(){if(t)if(n)l.setFieldsValue({uid:null==r?void 0:r.uid,parentUid:(null==r?void 0:r.parentUid)||I.zBg,name:f(null==r?void 0:r.name),description:null==r?void 0:r.description});else{l.resetFields();var e=null!=r&&r.uid&&r.uid!==I.zBg?r.uid:I.zBg;l.setFieldsValue({parentUid:e})}}),[t,n,null==r?void 0:r.uid]);var h=function e(t,n){var r;if(null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=u.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name||"",n.value=t.uid||"",t.children&&t.children.length>0){n.children=[];for(var a=0;a<t.children.length;a++){var s={title:"",value:""};e(t.children[a],s),n.children.push(s)}}},v=(0,a.useMemo)((function(){for(var e,t=[],a=(null==d||null===(e=d.data)||void 0===e?void 0:e.content)||[],s=0;s<a.length;s++){var i;if((null===(i=a[s])||void 0===i?void 0:i.uid)!==I.zBg){var o={title:"",value:""};h(a[s],o),t.push(o)}}var l=n?null==r?void 0:r.uid:void 0;if(l){var c=function e(t){var n;t&&(t.disabled=!0,null===(n=t.children)||void 0===n||n.forEach(e))};!function e(t){t&&t.forEach((function(t){t.value===l?c(t):t.children&&t.children.length>0&&e(t.children)}))}(t)}return[{title:u.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),value:I.zBg}].concat(t)}),[d,n,null==r?void 0:r.uid]),x=function(){l.validateFields().then(function(){var e=g()(p()().mark((function e(t){var a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.parentUid===I.zBg?void 0:t.parentUid,s={uid:n?null==r?void 0:r.uid:"",name:t.name,description:t.description,parentUid:a,orgUid:null==c?void 0:c.uid},console.log("handleSaveDep:",t,s),i(s);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),G.yw.error(n?"更新部门失败":"创建部门失败")}))};return(0,W.jsx)("div",{children:(0,W.jsx)(D.Z,{title:n?"编辑部门":"创建部门",open:t,forceRender:!0,onOk:x,onCancel:s,children:(0,W.jsxs)(q.A,{form:l,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,W.jsx)(he.Z,{label:"上级部门",name:"parentUid",allowClear:!0,fieldProps:{treeData:v,fieldNames:{label:"title",value:"value",children:"children"},placeholder:"请选择上级部门(可选)",allowClear:!0,treeDefaultExpandAll:!0,filterTreeNode:function(e,t){var n;return(null!==(n=t&&t.title)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},variant:"outlined",styles:{popup:{root:{maxHeight:400,overflow:"auto"}}}}}),(0,W.jsx)(O.Z,{label:"部门名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(){m.current&&m.current.focus()}}}),(0,W.jsx)(ve.Z,{label:"部门简介",name:"description",fieldProps:{ref:m,onPressEnter:function(e){e.preventDefault(),x()}}})]})})})},be=function(){var e=(0,N.useIntl)(),t=(0,a.useState)(!1),n=b()(t,2),r=n[0],s=n[1],i=(0,a.useState)(!1),o=b()(i,2),l=o[0],u=o[1],d=(0,w.u)((function(e){return e.currentOrg})),c=D.Z.useModal(),f=b()(c,2),m=f[0],h=f[1],v=(0,a.useState)(!1),x=b()(v,2),M=x[0],j=x[1],k=(0,y.H)((function(e){return{currentDepartment:e.currentDepartment,departmentResult:e.departmentResult,insertDepartment:e.insertDepartment,upgradeDepartment:e.upgradeDepartment,removeDepartment:e.removeDepartment,setCurrentDepartment:e.setCurrentDepartment,setDepartmentResult:e.setDepartmentResult,setCurrentDepUid:e.setCurrentDepUid}})),S=k.currentDepartment,C=k.departmentResult,F=k.insertDepartment,E=k.upgradeDepartment,T=k.removeDepartment,z=k.setCurrentDepartment,q=k.setDepartmentResult,O=k.setCurrentDepUid,B=function(){var t=g()(p()().mark((function t(n){var r;return p()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return X.Z.debug("handleDeleteDept",n),G.yw.loading(e.formatMessage({id:"deleting"})),t.next=4,(0,ie.If)(n);case 4:r=t.sent,X.Z.debug("handleDeleteDept:",r),200===r.code?(G.yw.destroy(),G.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),T(null==n?void 0:n.uid),s(!1)):(G.yw.destroy(),G.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),A=function t(n,r){var a,s="";if(s=null!==(a=n.name)&&void 0!==a&&a.startsWith(I.VoP)?e.formatMessage({id:n.name,defaultMessage:n.name}):n.name||"",void 0!==n.memberCount&&null!==n.memberCount&&n.memberCount>=0?s="".concat(s," (").concat(n.memberCount,")"):null!==n.memberCount&&void 0!==n.memberCount||(s="".concat(s," (0)")),r.title=s,r.key=n.uid||"",n.children)for(var i=0;i<n.children.length;i++){var o={title:"",key:"",children:[]};t(n.children[i],o),r.children.push(o)}},$=(0,a.useMemo)((function(){var t=[],n=0;C.data.content&&C.data.content.forEach((function(e){if(e.uid!==I.zBg){var t,r=null!==(t=e.memberCount)&&void 0!==t?t:0;n+=r}}));for(var r=0;r<C.data.content.length;r++){var a={title:"",key:"",children:[]};if(C.data.content[r].uid===I.zBg){var s=e.formatMessage({id:"allDept",defaultMessage:"全部"});s="".concat(s," (").concat(n,")"),a.title=s,a.key=I.zBg}else A(C.data.content[r],a);t.push(a)}return t}),[C]),V=function(){var e=g()(p()().mark((function e(){var t,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),t={pageNumber:0,pageSize:100,orgUid:null==d?void 0:d.uid},e.next=4,(0,ie.dF)(t);case 4:n=e.sent,X.Z.debug("queryDepartmentsByOrg:",n,t),200===n.code?q(n):G.yw.error(n.message),j(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){V()}),[]);var H=function(){var t=g()(p()().mark((function t(n){var r;return p()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return X.Z.debug("handleCreateDept",n),G.yw.loading(e.formatMessage({id:"creating"})),t.next=4,(0,ie.v$)(n);case 4:r=t.sent,X.Z.debug("createDepartment:",r),200===r.code?(G.yw.destroy(),G.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),F(null==r?void 0:r.data),z(null==r?void 0:r.data),s(!1),V()):(G.yw.destroy(),G.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=function(){var t=g()(p()().mark((function t(n){var r;return p()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return G.yw.loading(e.formatMessage({id:"updating"})),t.next=3,(0,ie.j4)(n);case 3:r=t.sent,X.Z.debug("handleUpdateDept:",n,r),200===r.code?(G.yw.destroy(),G.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),z(null==r?void 0:r.data),E(null==r?void 0:r.data),s(!1),V()):(G.yw.destroy(),G.yw.error(r.message));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(de.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,W.jsxs)(de.Z,{gap:"small",children:[(0,W.jsx)(R.ZP,{type:"primary",size:"small",icon:(0,W.jsx)(pe.Z,{}),onClick:function(){X.Z.debug("new dep"),u(!1),s(!0)},children:e.formatMessage({id:"createDept",defaultMessage:"createDepartment"})}),(0,W.jsx)(R.ZP,{size:"small",icon:(0,W.jsx)(me.Z,{spin:M}),onClick:V,loading:M,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})})]}),(null==S?void 0:S.uid)&&(null==S?void 0:S.uid)!==I.zBg&&(0,W.jsx)(U.Z,{menu:{items:[{key:"edit",icon:(0,W.jsx)(ge.Z,{}),label:e.formatMessage({id:"edit",defaultMessage:"Edit"}),onClick:function(){X.Z.debug("edit role"),u(!0),s(!0)}},{key:"delete",icon:(0,W.jsx)(Z.Z,{}),label:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"}),danger:!0,onClick:function(){return t=S,void m.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,W.jsx)(fe.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){B(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t}}]},children:(0,W.jsx)(R.ZP,{size:"small",icon:(0,W.jsx)(P.Z,{})})})]}),(0,W.jsx)(ce.Z,{defaultSelectedKeys:[(null==S?void 0:S.uid)||I.zBg],onSelect:function(e,t){X.Z.debug("selected",e,t),0!==e.length&&O(e[0].toString())},treeData:$,blockNode:!0}),r&&(0,W.jsx)(xe,{open:r,isEdit:l,department:S,onCancel:function(){s(!1)},onSubmit:function(e){l?L(e):H(e)}}),h]})},Me=function(){var e=(0,s.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,W.jsxs)(r.Z,{style:{height:"100%"},children:[(0,W.jsx)(r.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,W.jsx)(be,{})}),(0,W.jsx)(r.Z.Panel,{style:n,children:(0,W.jsx)(ue,{})})]})}},11394:function(e,t,n){n.d(t,{H:function(){return p}});var r=n(86222),a=n.n(r),s=n(76711),i=n.n(s),o=n(73193),l=n.n(o),u=n(6844),d=n(26557),c=n(26407),f=n(20744),p=(0,d.Ue)()((0,c.mW)((0,c.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:u.zBg,nickname:u.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,a={uid:u.zBg,name:u.zBg};(e({departmentResult:l()(l()({},n),{},{data:{content:[a].concat(i()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(i()(r.slice(0,a)),[n],i()(r.slice(a+1))),o=l()(l()({},t().departmentResult),{},{data:{content:s}});e({departmentResult:o,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,s,i=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(i)e({currentDepartment:i});else{!function t(r){var s,i=a()(r);try{for(i.s();!(s=i.n()).done;){var o=s.value;if(o.uid===n)return void e({currentDepartment:o});o.children&&o.children.length>0&&t(o.children)}}catch(e){i.e(e)}finally{i.f()}}((null===(s=t().departmentResult)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:u.xY_})))},73546:function(e,t,n){n.d(t,{$g:function(){return d},N9:function(){return l},Qc:function(){return u},vC:function(){return o}});var r=n(46803),a=n.n(r),s=n(36125);function i(e){return"bytedesk_salt"!==e&&e?a().SHA256(e).toString().substring(0,16):"bytedesk_license"}function o(e,t){if(!e)throw new Error("密码不能为空");if(!t)throw new Error("盐值不能为空");try{var n=i(t),r=a().enc.Utf8.parse(n);return a().AES.encrypt(e,r,{mode:a().mode.ECB,padding:a().pad.Pkcs7}).toString()}catch(e){throw s.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function l(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}function u(e){var t=0;return e?(e.length>=8&&(t+=20),e.length>=12&&(t+=10),/\d/.test(e)&&(t+=20),/[a-z]/.test(e)&&(t+=20),/[A-Z]/.test(e)&&(t+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(t+=10),Math.min(t,100)):0}function d(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}},70984:function(e,t,n){n.d(t,{Z:function(){return j}});var r=n(44194),a=n(51865),s=n.n(a),i=n(34573),o=n(82640),l=n(76175),u=n(74083),d=n(77167);const c=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],p=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var m=function(e,t){return s()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const n=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${n}`]:n&&c.includes(n)}})(e,t)),((e,t)=>{const n={};return p.forEach((r=>{n[`${e}-align-${r}`]=t.align===r})),n[`${e}-align-stretch`]=!t.align&&!!t.vertical,n})(e,t)),((e,t)=>{const n={};return f.forEach((r=>{n[`${e}-justify-${r}`]=t.justify===r})),n})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,n={};return c.forEach((e=>{n[`${t}-wrap-${e}`]={flexWrap:e}})),n},x=e=>{const{componentCls:t}=e,n={};return p.forEach((e=>{n[`${t}-align-${e}`]={alignItems:e}})),n},b=e=>{const{componentCls:t}=e,n={};return f.forEach((e=>{n[`${t}-justify-${e}`]={justifyContent:e}})),n};var M=(0,u.I$)("Flex",(e=>{const{paddingXS:t,padding:n,paddingLG:r}=e,a=(0,d.IX)(e,{flexGapSM:t,flexGap:n,flexGapLG:r});return[g(a),h(a),v(a),x(a),b(a)]}),(()=>({})),{resetStyle:!1}),y=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const w=r.forwardRef(((e,t)=>{const{prefixCls:n,rootClassName:a,className:u,style:d,flex:c,gap:f,vertical:p=!1,component:g="div",children:h}=e,v=y(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component","children"]),{flex:x,direction:b,getPrefixCls:w}=r.useContext(l.E_),j=w("flex",n),[Z,k,S]=M(j),C=null!=p?p:null==x?void 0:x.vertical,P=s()(u,a,null==x?void 0:x.className,j,k,S,m(j,e),{[`${j}-rtl`]:"rtl"===b,[`${j}-gap-${f}`]:(0,o.n)(f),[`${j}-vertical`]:C}),F=Object.assign(Object.assign({},null==x?void 0:x.style),d);return c&&(F.flex=c),f&&!(0,o.n)(f)&&(F.gap=f),Z(r.createElement(g,Object.assign({ref:t,className:P,style:F},(0,i.Z)(v,["justify","wrap","align"])),h))}));var j=w}}]);