"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[325],{94439:function(e,t,a){a.d(t,{Jr:function(){return p},LF:function(){return u},Oh:function(){return h},WS:function(){return g}});var r=a(90819),l=a.n(r),n=a(73193),o=a.n(n),i=a(89933),s=a.n(i),d=a(6844),c=a(19736);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51146:function(e,t,a){a.d(t,{G9:function(){return j},J$:function(){return P},N6:function(){return w},VM:function(){return u},c8:function(){return p},gF:function(){return h},rg:function(){return g},sF:function(){return y}});var r=a(90819),l=a.n(r),n=a(73193),o=a.n(n),i=a(89933),s=a.n(i),d=a(6844),c=a(19736);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return Z.apply(this,arguments)}function Z(){return(Z=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return k.apply(this,arguments)}function k(){return(k=s()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},54605:function(e,t,a){a.d(t,{G:function(){return p}});var r=a(73193),l=a.n(r),n=(a(44194),a(87373)),o=a(6844),i=a(96596),s=a.n(i),d=a(36125),c=a(93527),u=a(65819),m=a(31549),p=function(e){var t=e.children,a=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},p={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var t=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=t,i.fileType=e.type,d.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var t,l=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;a(l),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,m.jsx)(n.Z,l()(l()({},p),{},{children:t}))}},88449:function(e,t,a){var r=a(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},15597:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ke}});var r=a(44194),l=a(88449),n=a(85255),o=a(76711),i=a.n(o),s=a(73193),d=a.n(s),c=a(90819),u=a.n(c),m=a(89933),p=a.n(m),f=a(45332),g=a.n(f),v=a(77611),h=a(93527),x=a(26710),y=a(44679),b=a(19736),w=a(46141),M=a(70984),j=a(3925),Z=a(9428),P=a(48769),k=a(71876),C=a(65100),S=a(66810),T=a(14888),L=a(6844),U=a(15722),D=a(10162),I=a(11684),z=a(27407),E=a(90727),N=a(6015),O=a(10154),R=a.n(O),q=a(30064),A=a(68263),F=a(86684),B=a(13847),K=a(93312),J=a(58867),V=a(61689),G=a(54605),W=a(59908),X=a(65819),H=a(36125),_=a(31549),Y=function(e){var t,a=e.open,l=e.isEdit,n=e.llmProvider,o=e.level,i=e.onCancel,s=e.onSubmit,c=(0,b.useIntl)(),m=J.Z.useForm(),f=g()(m,1)[0],v=(0,T.u)((function(e){return e.currentOrg})),x=(0,r.useState)(),y=g()(x,2),w=y[0],M=y[1],Z=(0,r.useState)(""),P=g()(Z,2),k=P[0],S=P[1],U=(t={},R()(R()(R()(R()(R()(R()(R()(R()(R()(R()(t,L.CZ7,{nickname:"Ollama",logo:"ollama.png",baseUrl:"http://127.0.0.1:11434",webUrl:"https://ollama.com/",status:"PRODUCTION"}),L.hBm,{nickname:"智谱",logo:"zhipu.png",baseUrl:"https://open.bigmodel.cn/api/paas",webUrl:"https://open.bigmodel.cn/",status:"PRODUCTION"}),L.JZt,{nickname:"DeepSeek",logo:"deepseek.png",baseUrl:"https://api.deepseek.com",webUrl:"https://deepseek.com/",status:"PRODUCTION"}),L.dtX,{nickname:"通义千问",logo:"dashscope.png",baseUrl:"https://dashscope.aliyuncs.com",webUrl:"https://dashscope.aliyun.com/",status:"PRODUCTION"}),L.cEx,{nickname:"硅基流动",logo:"silicon.png",baseUrl:"https://api.siliconflow.cn",webUrl:"https://www.siliconflow.cn/",status:"PRODUCTION"}),L.ADi,{nickname:"Gitee魔力方舟",logo:"gitee.png",baseUrl:"https://ai.gitee.com",webUrl:"https://ai.gitee.com/",status:"PRODUCTION"}),L.qqA,{nickname:"腾讯混元",logo:"hunyuan.png",baseUrl:"https://api.hunyuan.cloud.tencent.com",webUrl:"https://hunyuan.tencent.com/",status:"PRODUCTION"}),L.Gh5,{nickname:"百度千帆",logo:"yiyan.png",baseUrl:"https://qianfan.baidubce.com/v2",webUrl:"https://console.bce.baidu.com/iam/#/iam/apikey/list",status:"PRODUCTION"}),L.dAZ,{nickname:"火山引擎",logo:"doubao.png",baseUrl:"https://ark.cn-beijing.volces.com/api/v3",webUrl:"https://console.volcengine.com/ark/",status:"PRODUCTION"}),L.tjv,{nickname:"Minimax",logo:"minimax.png",baseUrl:"https://api.minimax.chat/v1/",webUrl:"https://platform.minimaxi.com/",status:"PRODUCTION"}),R()(R()(R()(R()(R()(R()(R()(R()(R()(R()(t,L.CA4,{nickname:"OpenAI",logo:"openai.png",baseUrl:"https://api.openai.com",webUrl:"https://openai.com/",status:"PRODUCTION"}),L.d_o,{nickname:"Coze",logo:"coze.png",baseUrl:"https://api.coze.cn",webUrl:"https://www.coze.cn/",status:"PRODUCTION"}),L.UPk,{nickname:"Dify",logo:"dify.png",baseUrl:"https://api.dify.ai/v1",webUrl:"https://www.dify.ai/",status:"PRODUCTION"}),L.lhE,{nickname:"MaxKB",logo:"maxkb.png",baseUrl:"https://api.maxkb.cn",webUrl:"https://www.maxkb.cn/",status:"PRODUCTION"}),L.PL6,{nickname:"n8n",logo:"n8n.png",baseUrl:"https://api.n8n.io",webUrl:"https://n8n.io/",status:"PRODUCTION"}),L.TDs,{nickname:"Ragflow",logo:"ragflow.png",baseUrl:"https://api.ragflow.io",webUrl:"https://www.ragflow.io/",status:"PRODUCTION"}),L.eZp,{nickname:"OpenRouter",logo:"openrouter.png",baseUrl:"https://openrouter.ai/api",webUrl:"https://openrouter.ai/",status:"PRODUCTION"}),L.AQo,{nickname:"讯飞星火",logo:"xinghuo.png",baseUrl:"https://xinghuo.xfyun.cn/sparkapi",webUrl:"https://xinghuo.xfyun.cn/sparkapi",status:"DEVELOPMENT"}),L.S6p,{nickname:"Kimi",logo:"moonshot.png",baseUrl:"https://api.moonshot.cn",webUrl:"https://moonshot.ai/",status:"DEVELOPMENT"}),L.JN,{nickname:"百小应",logo:"baichuan.png",baseUrl:"https://api.baichuan-ai.com",webUrl:"https://www.baichuan-ai.com/",status:"DEVELOPMENT"}),R()(R()(R()(R()(R()(R()(t,L.ZeX,{nickname:"Yi",logo:"yi.png",baseUrl:"https://api.lingyiwanwu.com",webUrl:"https://platform.lingyiwanwu.com/",status:"DEVELOPMENT"}),L.i10,{nickname:"StepFun",logo:"stepfun.png",baseUrl:"https://api.stepfun.com",webUrl:"https://platform.stepfun.com/",status:"DEVELOPMENT"}),L.TkL,{nickname:"Groq",logo:"groq.png",baseUrl:"https://api.groq.com/openai",webUrl:"https://groq.com/",status:"DEVELOPMENT"}),L.fjv,{nickname:"Anthropic",logo:"anthropic.png",baseUrl:"https://api.anthropic.com/",webUrl:"https://anthropic.com/",status:"DEVELOPMENT"}),L.yTV,{nickname:"Gemini",logo:"gemini.png",baseUrl:"https://generativelanguage.googleapis.com",webUrl:"https://gemini.google.com/",status:"DEVELOPMENT"}),L.A2J,{nickname:"AIHubMix",logo:"aihubmix.png",baseUrl:"https://aihubmix.com",webUrl:"https://aihubmix.com/",status:"DEVELOPMENT"})),D=[{label:"Ollama",value:L.CZ7,category:"production"},{label:"智谱AI",value:L.hBm,category:"production"},{label:"DeepSeek",value:L.JZt,category:"production"},{label:"阿里云DashScope",value:L.dtX,category:"production"},{label:"SiliconFlow",value:L.cEx,category:"production"},{label:"Gitee AI",value:L.ADi,category:"production"},{label:"腾讯云",value:L.qqA,category:"production"},{label:"百度云",value:L.Gh5,category:"production"},{label:"火山引擎",value:L.dAZ,category:"production"},{label:"MiniMax",value:L.tjv,category:"production"},{label:"星火",value:L.AQo,category:"development"},{label:"Moonshot",value:L.S6p,category:"development"},{label:"百川",value:L.JN,category:"development"},{label:"零一万物",value:L.ZeX,category:"development"},{label:"阶跃星辰",value:L.i10,category:"development"},{label:"OpenRouter",value:L.eZp,category:"development"},{label:"Groq",value:L.TkL,category:"development"},{label:"Anthropic",value:L.fjv,category:"development"},{label:"OpenAI",value:L.CA4,category:"development"},{label:"Google Gemini",value:L.yTV,category:"development"},{label:"AiHubMix",value:L.A2J,category:"development"},{label:"自定义",value:L.ZPo,category:"custom"},{label:"Coze",value:L.d_o,category:"thirdparty"},{label:"Dify",value:L.UPk,category:"thirdparty"},{label:"N8N",value:L.PL6,category:"thirdparty"},{label:"MaxKB",value:L.lhE,category:"thirdparty"},{label:"RagFlow",value:L.TDs,category:"thirdparty"}],I=[{label:"已上线",options:D.filter((function(e){return"production"===e.category}))},{label:"开发中",options:D.filter((function(e){return"development"===e.category}))},{label:"自定义",options:D.filter((function(e){return"custom"===e.category}))},{label:"第三方知识库",options:D.filter((function(e){return"thirdparty"===e.category}))}],z=[L.CZ7,L.hBm,L.JZt,L.dtX,L.cEx,L.ADi,L.qqA,L.Gh5,L.dAZ,L.tjv,L.AQo,L.S6p,L.JN,L.ZeX,L.i10,L.eZp,L.TkL,L.fjv,L.CA4,L.yTV,L.A2J],E=l&&z.includes((null==n?void 0:n.type)||""),N=f.getFieldValue("type")===L.d_o,O=f.getFieldValue("type")===L.TDs;(0,r.useEffect)((function(){var e;l?(M(n),S((null==n?void 0:n.logo)||""),f.setFieldsValue({logo:null==n?void 0:n.logo,type:null==n?void 0:n.type,nickname:null==n?void 0:n.nickname,description:null==n?void 0:n.description,webUrl:null==n?void 0:n.webUrl,status:null==n?void 0:n.status,baseUrl:null==n?void 0:n.baseUrl,apiKey:null==n?void 0:n.apiKey,cozeBotId:null==n?void 0:n.cozeBotId,ragflowType:null==n?void 0:n.ragflowType,ragflowId:null==n?void 0:n.ragflowId,enabled:null===(e=null==n?void 0:n.enabled)||void 0===e||e})):(f.resetFields(),S(""),f.setFieldsValue({enabled:!0,status:L.KY}))}),[l,n]);return(0,_.jsx)("div",{children:(0,_.jsx)(V.Z,{title:l?c.formatMessage({id:"ai.provider.edit"}):c.formatMessage({id:"ai.provider.create"}),open:a,onClose:i,width:500,extra:(0,_.jsx)(j.ZP,{type:"primary",onClick:function(){f.validateFields().then(function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={uid:l?null==n?void 0:n.uid:"",type:null==t?void 0:t.type,nickname:null==t?void 0:t.nickname,logo:k||(null==w?void 0:w.logo),description:null==t?void 0:t.description,webUrl:null==t?void 0:t.webUrl,status:(null==t?void 0:t.status)||L.L2A,baseUrl:null==t?void 0:t.baseUrl,apiKey:null==t?void 0:t.apiKey,cozeBotId:null==t?void 0:t.cozeBotId,ragflowType:null==t?void 0:t.ragflowType,ragflowId:null==t?void 0:t.ragflowId,enabled:null===(a=null==t?void 0:t.enabled)||void 0===a||a,level:o,orgUid:null==v?void 0:v.uid},H.Z.debug("handleSaveLlmProvider:",t,r),s(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){H.Z.debug("Failed:",e),h.yw.error(l?c.formatMessage({id:"ai.provider.update.failed"}):c.formatMessage({id:"ai.provider.create.failed"}))}))},children:l?c.formatMessage({id:"ai.provider.update"}):c.formatMessage({id:"ai.provider.confirm"})}),children:(0,_.jsxs)(q.A,{form:f,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,_.jsx)(q.A.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:c.formatMessage({id:"ai.provider.logo"}),children:(0,_.jsxs)(G.G,{onSuccess:function(e){H.Z.debug("handleUploadSuccess:",e),S(e)},onError:function(e){H.Z.debug("handleUploadError:",e),h.yw.error(c.formatMessage({id:"ai.provider.upload.failed"}))},children:[(0,_.jsx)(C.Z,{src:k,size:64}),(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(W.Z,{}),style:{marginLeft:8},children:c.formatMessage({id:"ai.provider.uploadLogo"})})]})}),(0,_.jsx)(A.Z,{width:"md",name:"type",label:c.formatMessage({id:"ai.provider.type"}),placeholder:c.formatMessage({id:"ai.provider.type.placeholder"}),disabled:E,options:I,rules:[{required:!0,message:c.formatMessage({id:"ai.provider.type.required"})}],fieldProps:{showSearch:!0,onChange:function(e){H.Z.debug("Provider type changed:",e);D.find((function(t){return t.value===e}));M(d()(d()({},w),{},{type:e}));var t=U[e];if(e&&t){var a=(0,X.kG)()+"/assets/images/llm/provider/"+e+".png";S(a),f.setFieldsValue({logo:a,baseUrl:t.baseUrl,webUrl:t.webUrl})}f.validateFields([])}},tooltip:E?c.formatMessage({id:"ai.provider.type.system.tooltip"}):void 0}),(0,_.jsx)(F.Z,{label:c.formatMessage({id:"ai.provider.nickname"}),name:"nickname",rules:[{required:!0,message:c.formatMessage({id:"ai.provider.nickname.required"})}],fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}}}),(0,_.jsx)(B.Z,{label:c.formatMessage({id:"ai.provider.description"}),name:"description",fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}}}),(0,_.jsx)(F.Z,{label:c.formatMessage({id:"ai.provider.webUrl"}),name:"webUrl",placeholder:c.formatMessage({id:"ai.provider.webUrl.placeholder"}),rules:[{type:"url",message:c.formatMessage({id:"ai.provider.webUrl.invalid"})}],fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}}}),(0,_.jsx)(A.Z,{label:c.formatMessage({id:"ai.provider.status"}),name:"status",options:[{label:c.formatMessage({id:"ai.provider.status.development"}),value:L.L2A},{label:c.formatMessage({id:"ai.provider.status.production"}),value:L.KY}],rules:[{required:!0,message:c.formatMessage({id:"ai.provider.status.required"})}],fieldProps:{placeholder:c.formatMessage({id:"ai.provider.status.placeholder"})}}),(0,_.jsx)(F.Z,{label:c.formatMessage({id:"ai.provider.baseUrl"}),name:"baseUrl",placeholder:c.formatMessage({id:"ai.provider.baseUrl.placeholder"}),rules:[{required:!0,message:c.formatMessage({id:"ai.provider.baseUrl.required"})},{validator:function(e,t){if(t){if(t.endsWith("/"))return Promise.reject(new Error(c.formatMessage({id:"ai.provider.baseUrl.noTrailingSlash"})));if(!t.startsWith("http://")&&!t.startsWith("https://"))return Promise.reject(new Error(c.formatMessage({id:"ai.provider.baseUrl.mustStartWithHttp"})))}return Promise.resolve()}}],fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}},extra:c.formatMessage({id:"ai.provider.baseUrl.extra"})}),(null==w?void 0:w.type)!==L.CZ7&&(0,_.jsx)(F.Z.Password,{label:c.formatMessage({id:"ai.provider.apiKey"}),name:"apiKey",fieldProps:{placeholder:c.formatMessage({id:"ai.provider.apiKey.placeholder"}),allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}}}),N&&(0,_.jsx)(F.Z,{label:c.formatMessage({id:"ai.provider.cozeBotId"}),name:"cozeBotId",placeholder:c.formatMessage({id:"ai.provider.cozeBotId.placeholder"}),rules:[{required:!0,message:c.formatMessage({id:"ai.provider.cozeBotId.required"})}],fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}},extra:c.formatMessage({id:"ai.provider.cozeBotId.extra"})}),O&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(A.Z,{label:c.formatMessage({id:"ai.provider.ragflowType"}),name:"ragflowType",placeholder:c.formatMessage({id:"ai.provider.ragflowType.placeholder"}),options:[{label:c.formatMessage({id:"ai.provider.ragflowType.chat"}),value:"chat"},{label:c.formatMessage({id:"ai.provider.ragflowType.agent"}),value:"agent"}],rules:[{required:!0,message:c.formatMessage({id:"ai.provider.ragflowType.required"})}],extra:c.formatMessage({id:"ai.provider.ragflowType.extra"})}),(0,_.jsx)(F.Z,{label:c.formatMessage({id:"ai.provider.ragflowId"}),name:"ragflowId",placeholder:c.formatMessage({id:"ai.provider.ragflowId.placeholder"}),rules:[{required:!0,message:c.formatMessage({id:"ai.provider.ragflowId.required"})}],fieldProps:{onPressEnter:function(e){H.Z.debug("onPressEnter:",e)}},extra:c.formatMessage({id:"ai.provider.ragflowId.extra"})})]}),(0,_.jsx)(K.Z,{label:c.formatMessage({id:"ai.provider.enabled"}),name:"enabled",tooltip:c.formatMessage({id:"ai.provider.enabled.tooltip"}),checkedChildren:c.formatMessage({id:"ai.provider.enabled.checked"}),unCheckedChildren:c.formatMessage({id:"ai.provider.enabled.unchecked"})})]})})})},Q=a(26557),$=a(26407),ee=a(20744),te=(0,Q.Ue)()((0,$.mW)((0,$.tJ)((0,ee.n)((function(e,t){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},tabsToClosePlatform:[],insertLlmProviderPlatform:function(t){e((function(e){e.llmproviderResultPlatform.data.content.unshift(t)}))},upgradeLlmProviderPlatform:function(t){e((function(e){var a=e.llmproviderResultPlatform.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("LlmProvider with uid ".concat(t.uid," not found."))}))},setLlmProviderResultPlatform:function(a){e({llmproviderResultPlatform:a});var r,l=t().currentLlmProviderPlatform;""!==l.uid&&void 0!==l||(null===(r=a.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLlmProviderPlatform:a.data.content[0]})},setCurrentLlmProviderPlatform:function(a){var r=t().llmproviderResultPlatform.data.content,l=r.findIndex((function(e){return e.uid===a.uid}));if(-1!==l){var n=[].concat(i()(r.slice(0,l)),[a],i()(r.slice(l+1))),o=d()(d()({},t().llmproviderResultPlatform),{},{data:{content:n}});e({llmproviderResultPlatform:o,currentLlmProviderPlatform:a})}else e({currentLlmProviderPlatform:a})},deleteCurrentLlmProviderPlatform:function(a){var r=t().llmproviderResultPlatform.data.content,l=r.findIndex((function(e){return e.uid===a}));-1!==l?e({llmproviderResultPlatform:d()(d()({},t().llmproviderResultPlatform),{},{data:{content:[].concat(i()(r.slice(0,l)),i()(r.slice(l+1)))}})}):console.warn("LlmProvider not found in cache:",a),t().currentLlmProviderPlatform.uid===a&&e({currentLlmProviderPlatform:{uid:""}})},addTabToClosePlatform:function(t){e((function(e){e.tabsToClosePlatform.includes(t)||e.tabsToClosePlatform.push(t)}))},removeTabToClosePlatform:function(t){e((function(e){e.tabsToClosePlatform=e.tabsToClosePlatform.filter((function(e){return e!==t}))}))},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:L.dNm}))),ae=a(90104),re=function(e){var t,a,l,n,o=e.level,s=e.superUser,c=(0,x.Z)().isDarkMode,m=(0,b.useIntl)(),f=(0,y.Z)().translateString,O=(0,T.u)((function(e){return e.currentOrg})),R=(0,r.useState)(!1),q=g()(R,2),A=q[0],F=q[1],B=(0,r.useState)(!1),K=g()(B,2),J=K[0],V=K[1],G=(0,r.useState)(!1),W=g()(G,2),X=W[0],Q=W[1],$=(0,r.useState)(!0),ee=g()($,2),re=ee[0],le=ee[1],ne=(0,r.useState)(0),oe=g()(ne,2),ie=oe[0],se=oe[1],de=(0,r.useState)((function(){var e=localStorage.getItem("llmProviderSortDirection");return"ascend"===e||"descend"===e?e:"descend"})),ce=g()(de,2),ue=ce[0],me=ce[1],pe=(0,r.useState)(""),fe=g()(pe,2),ge=fe[0],ve=fe[1],he=(0,r.useState)(!1),xe=g()(he,2),ye=xe[0],be=xe[1],we=(0,r.useMemo)((function(){var e=o===L.Hxq?"platform":(null==O?void 0:O.uid)||"org";return"llmProviderSelected:".concat(o,":").concat(e)}),[o,null==O?void 0:O.uid]),Me=(0,r.useState)(null),je=g()(Me,2),Ze=(je[0],je[1]);(0,r.useEffect)((function(){Ze(localStorage.getItem(we))}),[we]);var Pe=(0,N.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider,addTabToClose:e.addTabToClose}})),ke=Pe.llmproviderResult,Ce=Pe.currentLlmProvider,Se=Pe.setLlmProviderResult,Te=Pe.insertLlmProvider,Le=Pe.setCurrentLlmProvider,Ue=Pe.upgradeLlmProvider,De=Pe.deleteCurrentLlmProvider,Ie=Pe.addTabToClose,ze=te((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform,addTabToClosePlatform:e.addTabToClosePlatform}})),Ee=ze.llmproviderResultPlatform,Ne=ze.currentLlmProviderPlatform,Oe=ze.setLlmProviderResultPlatform,Re=ze.insertLlmProviderPlatform,qe=ze.setCurrentLlmProviderPlatform,Ae=ze.upgradeLlmProviderPlatform,Fe=ze.deleteCurrentLlmProviderPlatform,Be=ze.addTabToClosePlatform,Ke=(0,r.useState)(o===L.Hxq),Je=g()(Ke,1)[0],Ve=Je?Ne:Ce,Ge=w.Z.useModal(),We=g()(Ge,2),Xe=We[0],He=We[1],_e=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("delete robot",t),h.yw.loading(m.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,v.HH)(t);case 4:if(a=e.sent,H.Z.debug("delete robot response",a),200===a.code){h.yw.destroy(),h.yw.success(m.formatMessage({id:"delete.success",defaultMessage:"Delete success"}));try{(r=localStorage.getItem(we))&&r===t.uid&&localStorage.removeItem(we)}catch(e){}Je?(Fe(t.uid),Be(t.uid)):(De(t.uid),Ie(t.uid))}else h.yw.destroy(),h.yw.error(a.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ye=(0,r.useCallback)(p()(u()().mark((function e(){var t,a,r,l,n,s,c,m,p,f,g,x,y,b,w,M,j,Z,P=arguments;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=P.length>0&&void 0!==P[0]?P[0]:0,a=P.length>1&&void 0!==P[1]&&P[1],H.Z.debug("getLlmProviders",{page:t,isLoadMore:a,sortDirection:ue}),!X){e.next=5;break}return e.abrupt("return");case 5:return Q(!0),r={pageNumber:t,pageSize:20,sortBy:"updatedAt",sortDirection:ue,searchText:ge,orgUid:o===L.Hxq?"":null==O?void 0:O.uid,level:o},e.prev=7,e.next=10,(0,v.mK)(r);case 10:l=e.sent,H.Z.debug("queryLlmProvidersByOrg: ",l,r),200===l.code?(c=(null==l||null===(n=l.data)||void 0===n?void 0:n.content)||[],m=(null==l||null===(s=l.data)||void 0===s?void 0:s.last)||!1,le(!m),se(t),Je?a?(f=(null==Ee||null===(p=Ee.data)||void 0===p?void 0:p.content)||[],g=d()(d()({},l),{},{data:d()(d()({},null==l?void 0:l.data),{},{content:[].concat(i()(f),i()(c))})}),Oe(g)):(Oe(l),c.length>0&&(x=function(){try{return localStorage.getItem(we)}catch(e){return null}}(),y=x?c.find((function(e){return e.uid===x})):null,qe(y||c[0])),be(!0)):a?(w=(null==ke||null===(b=ke.data)||void 0===b?void 0:b.content)||[],M=d()(d()({},l),{},{data:d()(d()({},null==l?void 0:l.data),{},{content:[].concat(i()(w),i()(c))})}),Se(M)):(Se(l),c.length>0&&(j=function(){try{return localStorage.getItem(we)}catch(e){return null}}(),Z=j?c.find((function(e){return e.uid===j})):null,Le(Z||c[0])),be(!0))):h.yw.error(l.message),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error("获取LLM提供商失败:",e.t0),h.yw.error("获取数据失败");case 19:return e.prev=19,Q(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,15,19,22]])}))),[X,ue,ge,o,null==O?void 0:O.uid,Je,Ee,ke,Oe,Se,qe,Le,we]);(0,r.useEffect)((function(){se(0),le(!0),be(!1),Ye(0,!1)}),[o,null==O?void 0:O.uid,ue,ge]);var Qe=function(){var e=p()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("createLlmProvider",t),h.yw.loading(m.formatMessage({id:"creating"})),e.next=4,(0,v.T)(t);case 4:a=e.sent,H.Z.debug("createLlmProvider:",a),200===a.code?(h.yw.destroy(),h.yw.success(m.formatMessage({id:"create.success",defaultMessage:"create success"})),Je?(Re(null==a?void 0:a.data),qe(null==a?void 0:a.data)):(Te(null==a?void 0:a.data),Le(null==a?void 0:a.data)),F(!1)):(h.yw.destroy(),h.yw.error(a.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=p()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(m.formatMessage({id:"updating"})),e.next=3,(0,v.fx)(t);case 3:a=e.sent,H.Z.debug("updateLlmProvider:",t,a),200===a.code?(h.yw.destroy(),h.yw.success(m.formatMessage({id:"update.success",defaultMessage:"update success"})),Je?(Ae(null==a?void 0:a.data),qe(null==a?void 0:a.data)):(Ue(null==a?void 0:a.data),Le(null==a?void 0:a.data)),F(!1)):(h.yw.destroy(),h.yw.error(a.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(e){H.Z.debug("搜索内容:",e)};return(0,r.useEffect)((function(){if(ye)try{Ve&&Ve.uid&&localStorage.setItem(we,Ve.uid)}catch(e){}}),[ye,null==Ve?void 0:Ve.uid,we]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{style:{margin:10},children:[(0,_.jsxs)(M.Z,{gap:"small",align:"flex-start",children:[(0,_.jsx)(j.ZP,{size:"small",type:"primary",icon:(0,_.jsx)(D.Z,{}),onClick:function(){H.Z.debug("new llmProvider"),V(!1),F(!0)},children:m.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,_.jsx)(j.ZP,{size:"small",onClick:function(){H.Z.debug("edit llmProvider"),V(!0),F(!0)},disabled:""===(null==Ve?void 0:Ve.uid),children:m.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,_.jsx)(j.ZP,{size:"small",icon:"descend"===ue?(0,_.jsx)(I.Z,{}):(0,_.jsx)(z.Z,{}),onClick:function(){var e="descend"===ue?"ascend":"descend";me(e),localStorage.setItem("llmProviderSortDirection",e),se(0),le(!0),Ye(0,!1)},title:"descend"===ue?"当前降序排列，点击切换为升序":"当前升序排列，点击切换为降序",children:"descend"===ue?"升序":"降序"}),(0,_.jsx)(j.ZP,{onClick:function(){return function(e){Xe.confirm({title:m.formatMessage({id:"deleteTip"}),icon:(0,_.jsx)(U.Z,{}),content:"".concat(m.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(f(e.nickname),"】？"),onOk:function(){_e(e)},onCancel:function(){},okText:m.formatMessage({id:"ok"}),cancelText:m.formatMessage({id:"cancel"})})}(Ve)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==Ve?void 0:Ve.uid),children:m.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,_.jsx)("div",{style:{marginTop:16},children:(0,_.jsxs)(Z.Z.Compact,{style:{width:"100%"},children:[(0,_.jsx)(P.Z,{placeholder:m.formatMessage({id:"search.placeholder",defaultMessage:"搜索提供商名称或描述"}),value:ge,onChange:function(e){return ve(e.target.value)},onPressEnter:function(e){e.preventDefault(),et(e.currentTarget.value)},allowClear:!0}),(0,_.jsx)(j.ZP,{type:"primary",icon:(0,_.jsx)(E.Z,{}),"aria-label":m.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return et(ge)}})]})})]}),(0,_.jsxs)("div",{style:{maxHeight:"calc(100vh - 100px)",overflowY:"auto",paddingBottom:"20px"},onScroll:function(e){var t=e.currentTarget,a=t.scrollTop;t.scrollHeight-a-t.clientHeight<50&&re&&!X&&!X&&re&&Ye(ie+1,!0)},children:[(0,_.jsx)(k.Z,{itemLayout:"horizontal",loading:X&&0===ie,dataSource:(Je?(null==Ee||null===(t=Ee.data)||void 0===t?void 0:t.content)||[]:(null==ke||null===(a=ke.data)||void 0===a?void 0:a.content)||[]).filter((function(e){return!ae.ju.includes(e.type)})),renderItem:function(e,t){return(0,_.jsx)(k.Z.Item,{style:d()(d()({},(null==Ve?void 0:Ve.uid)===e.uid?{backgroundColor:c?"#333333":"#dddddd"}:{}),{},{cursor:"pointer"}),onClick:function(){return function(e,t){Je?qe(e):Le(e);try{null!=e&&e.uid&&(localStorage.setItem(we,e.uid),Ze(e.uid))}catch(e){}}(e)},children:(0,_.jsx)(k.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,_.jsxs)("span",{style:{fontSize:"14px",color:c?"#888":"#666",minWidth:"20px",textAlign:"right"},children:[t+1,"."]}),(0,_.jsx)(C.Z,{src:e.logo})]}),title:(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,_.jsx)("span",{children:null==e?void 0:e.nickname}),(0,_.jsx)(S.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?m.formatMessage({id:"ai.provider.status.enabled"}):m.formatMessage({id:"ai.provider.status.disabled"})})]}),description:(0,_.jsxs)("div",{children:[s&&(0,_.jsx)("div",{children:(null==e?void 0:e.status)===L.KY?m.formatMessage({id:"ai.provider.status.production"}):m.formatMessage({id:"ai.provider.status.development"})}),(null==e?void 0:e.description)&&(0,_.jsx)("div",{style:{marginTop:s?"4px":"0",color:"#666"},children:e.description})]})})})}}),X&&ie>0&&(0,_.jsx)("div",{style:{textAlign:"center",padding:"12px"},children:(0,_.jsx)("span",{style:{color:"#999"},children:"加载中..."})}),!re&&(Je?null==Ee||null===(l=Ee.data)||void 0===l||null===(l=l.content)||void 0===l?void 0:l.length:null==ke||null===(n=ke.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&(0,_.jsx)("div",{style:{textAlign:"center",padding:"12px"},children:(0,_.jsx)("span",{style:{color:"#999"},children:"已加载全部数据"})})]}),A&&(0,_.jsx)(Y,{open:A,isEdit:J,level:o,llmProvider:Ve,onCancel:function(){F(!1)},onSubmit:function(e){J?$e(e):Qe(e)}}),He]})},le=a(31167),ne=a(86222),oe=a.n(ne),ie=a(94439),se=a(35731),de=a(93189),ce=a(65513),ue=a(53229),me=a(42032),pe=a(98986),fe=a(96123),ge=a(5089),ve=a(1691),he=a(48907),xe=a(74192),ye=function(e){var t=e.isEdit,a=e.llmmodel,l=e.provider,n=e.open,o=e.level,i=e.onClose,s=e.onSubmit,d=q.A.useForm(),c=g()(d,1)[0],u=(0,b.useIntl)(),m=(0,T.u)((function(e){return e.currentOrg})),p=[{label:u.formatMessage({id:"model.type.text"}),value:L.l55},{label:u.formatMessage({id:"model.type.embedding"}),value:L.xTq},{label:u.formatMessage({id:"model.type.rerank"}),value:L.SeQ},{label:u.formatMessage({id:"model.type.vision"}),value:L.xZ8},{label:u.formatMessage({id:"model.type.code"}),value:L.rrk},{label:u.formatMessage({id:"model.type.reasoning"}),value:L.GNM},{label:u.formatMessage({id:"model.type.text2image"}),value:L.eQL},{label:u.formatMessage({id:"model.type.image2text"}),value:L.ztv},{label:u.formatMessage({id:"model.type.audio2text"}),value:L._D8},{label:u.formatMessage({id:"model.type.text2audio"}),value:L.YNO},{label:u.formatMessage({id:"model.type.text2video"}),value:L.GZK},{label:u.formatMessage({id:"model.type.video2text"}),value:L.B6M}];(0,r.useEffect)((function(){var e;t&&a&&c?c.setFieldsValue({uid:null==a?void 0:a.uid,name:null==a?void 0:a.name,nickname:null==a?void 0:a.nickname,description:null==a?void 0:a.description,type:null==a?void 0:a.type,enabled:null!==(e=null==a?void 0:a.enabled)&&void 0!==e&&e}):(H.Z.debug("form resetFields"),c.resetFields(),c.setFieldValue("type",L.l55),c.setFieldValue("enabled",!0))}),[a]);return(0,r.useEffect)((function(){}),[a]),(0,_.jsx)("div",{children:(0,_.jsx)(V.Z,{title:t?u.formatMessage({id:"model.edit"}):u.formatMessage({id:"model.create"}),width:600,onClose:i,open:n,extra:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)(j.ZP,{onClick:i,children:u.formatMessage({id:"cancel"})}),(0,_.jsx)(j.ZP,{onClick:function(){H.Z.debug("handleSubmit"),c.validateFields().then((function(e){var r;H.Z.debug("Form values:",e);var n={uid:t?null==a?void 0:a.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(r=e.enabled)||void 0===r||r,providerUid:null==l?void 0:l.uid,providerType:null==l?void 0:l.type,level:o,orgUid:null==m?void 0:m.uid};H.Z.debug("llmmodelObject:",n),s(n)})).catch((function(e){H.Z.debug("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"ok"})})]}),children:(0,_.jsxs)(q.A,{form:c,name:"model",submitter:!1,children:[(0,_.jsx)(F.Z,{label:u.formatMessage({id:"model.name"}),name:"name"}),(0,_.jsx)(F.Z,{label:u.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,_.jsx)(B.Z,{label:u.formatMessage({id:"model.description"}),name:"description",placeholder:u.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,_.jsx)(A.Z,{label:u.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:u.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:u.formatMessage({id:"model.type.required"})}]}),(0,_.jsx)(K.Z,{label:u.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:u.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:u.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:u.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},be=a(11090),we=a(59304),Me=a(80556),je=a(7358),Ze=a(30617),Pe=a(20921),ke=a(77753),Ce=ge.Z.Text,Se=function(e){var t=e.provider,a=e.open,l=(e.level,e.onClose),n=e.onSubmit,o=e.existingModels,i=void 0===o?[]:o,s=(0,b.useIntl)(),c=(0,r.useState)(!1),m=g()(c,2),f=m[0],v=m[1],x=(0,r.useState)([]),y=g()(x,2),w=y[0],M=y[1],P=(0,r.useState)([]),k=g()(P,2),C=k[0],T=k[1],U=(0,r.useState)({current:1,pageSize:10,total:0}),D=g()(U,2),I=D[0],z=D[1],E=function(e){return i.some((function(t){return t.name===e.name}))},N=function(){var e=p()(u()().mark((function e(){var a,r,l,n,o,i,d,c,m,p,f,g,x,y,b,w,j,Z=arguments;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Z.length>0&&void 0!==Z[0]?Z[0]:I.current,r=Z.length>1&&void 0!==Z[1]?Z[1]:I.pageSize,v(!0),e.prev=3,l={pageNumber:Math.max(0,(a||1)-1),pageSize:r||10,level:L.Hxq,providerType:t.type},e.next=7,(0,ie.LF)(l);case 7:n=e.sent,console.log("获取平台模型列表:",n,l),200===n.code?(g=(null==n?void 0:n.data)||{},x=g.content||[],M(x),y=null!==(o=null!==(i=null!==(d=null!==(c=g.totalElements)&&void 0!==c?c:g.total)&&void 0!==d?d:g.totalCount)&&void 0!==i?i:g.totalItems)&&void 0!==o?o:0,b=(null!==(m=g.number)&&void 0!==m?m:(a||1)-1)+1,w=null!==(p=null!==(f=g.size)&&void 0!==f?f:r)&&void 0!==p?p:10,z({current:b,pageSize:w,total:y}),1===(a||1)&&0===C.length&&(j=x.filter((function(e){return E(e)})).map((function(e){return e.uid})),T(j))):h.yw.error(n.message||s.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),console.error("获取平台模型异常:",e.t0),h.yw.error(s.formatMessage({id:"ai.model.import.fetchError"}));case 16:return e.prev=16,v(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,12,16,19]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){a&&(z((function(e){return d()(d()({},e),{},{current:1})})),N(1,I.pageSize))}),[a]);var O=[{title:s.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,t){return(0,_.jsxs)(Z.Z,{children:[e,E(t)&&(0,_.jsx)(S.Z,{color:"green",children:s.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:s.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:s.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0,render:function(e){return(0,_.jsx)(ve.Z,{placement:"topLeft",zIndex:2e3,styles:{body:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere",maxWidth:"60vw"}},getPopupContainer:function(e){var t;return(null==e||null===(t=e.ownerDocument)||void 0===t?void 0:t.body)||document.body},title:e||"-",children:(0,_.jsx)("span",{children:e||"-"})})}}],R={selectedRowKeys:C,onChange:function(e){T(e)}};return(0,_.jsxs)(V.Z,{title:s.formatMessage({id:"ai.model.import.title"},{provider:t.nickname}),width:700,open:a,onClose:l,destroyOnClose:!0,footer:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)(j.ZP,{onClick:l,children:s.formatMessage({id:"ai.model.import.cancel"})}),(0,_.jsx)(j.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=w.filter((function(e){return C.includes(e.uid)}));n(e)}else h.yw.warning(s.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:s.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,_.jsxs)(Ce,{type:"secondary",children:[s.formatMessage({id:"ai.model.import.description"},{provider:t.nickname}),i.length>0&&(0,_.jsx)(Ce,{type:"secondary",style:{marginLeft:8},children:s.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,_.jsx)("div",{style:{marginTop:16},children:(0,_.jsx)(Pe.Z,{spinning:f,children:(0,_.jsx)(ke.Z,{rowKey:"uid",columns:O,dataSource:w,pagination:{current:I.current,pageSize:I.pageSize,total:I.total,showSizeChanger:!0},rowSelection:R,size:"small",onChange:function(e){var t=(null==e?void 0:e.current)||1,a=(null==e?void 0:e.pageSize)||I.pageSize;N(t,a)}})})}),0===w.length&&!f&&(0,_.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,_.jsx)(Ce,{type:"secondary",children:s.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},Te=function(e){var t=e.provider,a=e.level,l=(0,b.useIntl)(),n=(0,x.Z)().isDarkMode,o=(0,r.useState)(!0),i=g()(o,2),s=i[0],c=i[1],m=(0,r.useState)(!0),f=g()(m,2),M=f[0],S=f[1],I=(0,y.Z)().translateString,z=(0,r.useState)(),O=g()(z,2),R=O[0],q=O[1],A=(0,r.useState)(!1),F=g()(A,2),B=F[0],K=F[1],J=(0,r.useState)(!1),V=g()(J,2),G=V[0],W=V[1],X=(0,T.u)((function(e){return e.currentOrg})),Q=(0,r.useState)([]),$=g()(Q,2),ee=$[0],te=$[1],ae=(0,N.A)((function(e){return e.upgradeLlmProvider})),re=w.Z.useModal(),le=g()(re,2),ne=le[0],Pe=le[1],ke=(0,r.useState)(!1),Ce=g()(ke,2),Te=Ce[0],Le=Ce[1],Ue=(0,r.useState)(""),De=g()(Ue,2),Ie=De[0],ze=De[1],Ee=(0,r.useState)(!0),Ne=g()(Ee,2),Oe=Ne[0],Re=Ne[1],qe=(0,r.useState)(!1),Ae=g()(qe,2),Fe=Ae[0],Be=Ae[1],Ke=(0,r.useState)(!1),Je=g()(Ke,2),Ve=Je[0],Ge=Je[1],We=(0,r.useState)(!1),Xe=g()(We,2),He=Xe[0],_e=Xe[1],Ye=(0,r.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),Qe=g()(Ye,2),$e=Qe[0],et=Qe[1],tt=(0,r.useState)(window.innerHeight),at=g()(tt,2),rt=(at[0],at[1]);(0,r.useEffect)((function(){var e=function(){rt(window.innerHeight)};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]);var lt=(0,N.A)((function(e){var t;return(null===(t=e.llmproviderResult)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.content)||[]})).find((function(e){return e.uid===(null==t?void 0:t.uid)}))||t,nt=function(){var e=p()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("delete robot",t),h.yw.loading(l.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,ie.Oh)(t);case 4:a=e.sent,H.Z.debug("delete robot response",a),200===a.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ot($e.current,$e.pageSize,Ie)):(h.yw.destroy(),h.yw.error(a.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ot=function(){var e=p()(u()().mark((function e(){var t,r,l,n,o,i=arguments;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:1,r=i.length>1&&void 0!==i[1]?i[1]:10,l=i.length>2&&void 0!==i[2]?i[2]:Ie,H.Z.debug("requestModels",{page:t,size:r,search:l}),Be(!0),n={pageNumber:t-1,pageSize:r,providerUid:null==lt?void 0:lt.uid,orgUid:null==X?void 0:X.uid,level:a,searchText:l},e.next=8,(0,ie.LF)(n);case 8:o=e.sent,H.Z.debug("queryLlmModelsByOrg: ",o,n),200===o.code?(te(null==o?void 0:o.data.content),et((function(e){return d()(d()({},e),{},{current:t,pageSize:r,total:(null==o?void 0:o.data.totalElements)||0})})),Be(!1)):(Be(!1),h.yw.error(o.message));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),it=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _e(!0),e.prev=1,e.next=4,ot($e.current,$e.pageSize,Ie);case 4:return e.prev=4,_e(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}(),st=function(e){ze(e),ot(1,$e.pageSize,e)},dt=function(){var e=p()(u()().mark((function e(){var t,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.Z.debug("refreshProvider"),null!=lt&&lt.uid){e.next=4;break}return h.yw.error(l.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return Ge(!0),h.yw.loading(l.formatMessage({id:"loading",defaultMessage:"Loading"})),t={uid:lt.uid,orgUid:null==X?void 0:X.uid,level:a},e.prev=7,e.next=10,(0,v.N0)(t);case 10:r=e.sent,H.Z.debug("queryLlmProviderByUid: ",r,t),200===r.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"provider.refresh.success"})),ae(null==r?void 0:r.data)):(h.yw.destroy(),h.yw.error(r.message)),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(7),h.yw.destroy(),h.yw.error(l.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 20:return e.prev=20,Ge(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,15,20,23]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){ot(1,10)}),[]),(0,r.useEffect)((function(){var e=function(e){if(!(B||G||Te)&&(e.ctrlKey||e.metaKey))switch(e.key){case"r":e.preventDefault(),it();break;case"n":e.preventDefault(),c(!1),K(!0)}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[$e.current,$e.pageSize,B,G,Te]);var ct=function(){K(!1)},ut=function(){W(!1)},mt=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.Z.debug("handleSubmitDrawer:",t),!s){e.next=9;break}return e.next=4,(0,ie.WS)(t);case 4:a=e.sent,H.Z.debug("updateLlmModel:",null==a?void 0:a.data),200===a.code?(h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),ot($e.current,$e.pageSize,Ie),ct()):h.yw.error(a.message),e.next=14;break;case 9:return e.next=11,(0,ie.Jr)(t);case 11:r=e.sent,H.Z.debug("createLlmModel:",null==r?void 0:r.data),200===r.code?(h.yw.success(l.formatMessage({id:"create.success",defaultMessage:"create success"})),ot(1,$e.pageSize,Ie),ct()):h.yw.error(r.message);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=p()(u()().mark((function e(t){var r,n,o,i,s,d,c,m;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.Z.debug("导入选中的模型:",t),t&&0!==t.length){e.next=5;break}return h.yw.warning(l.formatMessage({id:"model.import.none.selected"})),ut(),e.abrupt("return");case 5:if(r=ee.map((function(e){return e.name})),n=t.filter((function(e){return!r.includes(e.name)})),0!==n.length){e.next=11;break}return h.yw.info(l.formatMessage({id:"model.import.already.exist"})),ut(),e.abrupt("return");case 11:h.yw.loading("".concat(l.formatMessage({id:"loading"})).concat(n.length).concat(l.formatMessage({id:"model.add"}),"...")),e.prev=12,o=0,i=oe()(n),e.prev=15,i.s();case 17:if((s=i.n()).done){e.next=27;break}return d=s.value,c={name:d.name,nickname:d.nickname,description:d.description,type:d.type,enabled:!0,providerUid:lt.uid,orgUid:null==X?void 0:X.uid,level:a},e.next=22,(0,ie.Jr)(c);case 22:m=e.sent,H.Z.debug("createLlmModel:",m,c),200===m.code&&o++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),i.e(e.t0);case 32:return e.prev=32,i.f(),e.finish(32);case 35:h.yw.destroy(),o>0?(h.yw.success(l.formatMessage({id:"model.import.success"},{count:o})),ot(1,$e.pageSize,Ie)):h.yw.warning(l.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),h.yw.destroy(),h.yw.error(l.formatMessage({id:"model.import.failed"}));case 44:ut();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(t){return e.apply(this,arguments)}}(),ft=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("handleUpdateProvider:",lt),a=d()(d()({},lt),{},{status:t?L.KY:L.L2A}),e.next=4,(0,v.fx)(a);case 4:r=e.sent,H.Z.debug("updateLlmProvider:",a,r),200===r.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),ae(null==r?void 0:r.data)):(h.yw.destroy(),h.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gt=function(e){var t;H.Z.debug("list on delete",e),t=e,ne.confirm({title:l.formatMessage({id:"deleteTip"}),icon:(0,_.jsx)(U.Z,{}),content:"".concat(l.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(I(t.nickname),"】？"),onOk:function(){nt(t)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})})},vt=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("switch enabled to ".concat(t)),a=d()(d()({},lt),{},{enabled:t}),h.yw.loading(l.formatMessage({id:"updating"})),e.next=5,(0,v.fx)(a);case 5:r=e.sent,H.Z.debug("updateLlmProvider enabled:",a,r),200===r.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),ae(null==r?void 0:r.data)):(h.yw.destroy(),h.yw.error(r.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ht=function(){var e=p()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(l.formatMessage({id:"updating"})),e.next=3,(0,v.fx)(t);case 3:a=e.sent,H.Z.debug("updateLlmProvider:",t,a),200===a.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),ae(null==a?void 0:a.data),Le(!1),null!=a&&a.data.apiKey&&Re(!0)):(h.yw.destroy(),h.yw.error(a.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xt=function(){var e=p()(u()().mark((function e(t,r){var n,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("switch model enabled to ".concat(t),r),n=d()(d()({},r),{},{enabled:t,providerUid:null==lt?void 0:lt.uid,orgUid:null==X?void 0:X.uid,level:a}),h.yw.loading(l.formatMessage({id:"updating"})),e.next=5,(0,ie.WS)(n);case 5:o=e.sent,H.Z.debug("updateLlmModel enabled:",n,o),200===o.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),te((function(e){return e.map((function(e){return e.uid===r.uid?d()(d()({},e),{},{enabled:t}):e}))}))):(h.yw.destroy(),h.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),yt=function(){var e=p()(u()().mark((function e(t,a){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t);case 3:de.ZP.success(l.formatMessage({id:"copy.success",defaultMessage:"复制成功"},{field:a})),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("复制失败:",e.t0),de.ZP.error(l.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,a){return e.apply(this,arguments)}}();return(0,_.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,_.jsxs)("div",{style:{flexShrink:0,padding:"16px 24px",borderBottom:"1px solid #f0f0f0"},children:[(0,_.jsxs)("h1",{children:[(0,_.jsx)(C.Z,{src:null==lt?void 0:lt.logo}),(0,_.jsx)("span",{style:{marginLeft:"12px"},children:null==lt?void 0:lt.nickname}),(0,_.jsx)(ce.Z,{checked:null==lt?void 0:lt.enabled,onChange:vt,checkedChildren:l.formatMessage({id:"provider.enabled"}),unCheckedChildren:l.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(be.Z,{}),onClick:function(){window.open(null==lt?void 0:lt.webUrl,"_blank")}}),(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(we.Z,{}),onClick:function(){S(!0),Le(!0)}}),(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(Me.Z,{}),loading:Ve,onClick:dt})]}),(null==lt?void 0:lt.description)&&(0,_.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:lt.description}),(0,_.jsx)(ue.Z,{message:l.formatMessage({id:"provider.config.alert"}),type:null!=lt&&lt.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,_.jsx)(me.Z,{size:"small",style:{marginBottom:"16px"},items:[{key:"config",label:l.formatMessage({id:"provider.config.info",defaultMessage:"配置信息"}),extra:(0,_.jsx)(j.ZP,{type:"primary",size:"small",icon:(0,_.jsx)(we.Z,{}),onClick:function(e){e.stopPropagation(),S(!0),Le(!0)},children:l.formatMessage({id:"provider.edit"})}),children:(0,_.jsxs)(pe.Z,{gutter:[16,12],children:[(0,_.jsx)(fe.Z,{xs:24,sm:24,md:12,lg:8,children:(0,_.jsxs)("div",{className:"provider-field-item",children:[(0,_.jsx)("div",{className:"field-label",children:l.formatMessage({id:"ai.provider.baseUrl"})}),(0,_.jsxs)("div",{className:"field-value",children:[(0,_.jsx)(ge.Z.Text,{copyable:!1,ellipsis:{tooltip:null==lt?void 0:lt.baseUrl},style:{maxWidth:"calc(100% - 32px)"},children:(null==lt?void 0:lt.baseUrl)||"-"}),(null==lt?void 0:lt.baseUrl)&&(0,_.jsx)(ve.Z,{title:l.formatMessage({id:"copy",defaultMessage:"复制"}),children:(0,_.jsx)(j.ZP,{type:"text",size:"small",icon:(0,_.jsx)(je.Z,{}),onClick:function(){return yt(lt.baseUrl,"Base URL")},style:{flexShrink:0}})})]})]})}),(0,_.jsx)(fe.Z,{xs:24,sm:24,md:12,lg:8,children:(0,_.jsxs)("div",{className:"provider-field-item",children:[(0,_.jsx)("div",{className:"field-label",children:l.formatMessage({id:"ai.provider.apiKey"})}),(0,_.jsxs)("div",{className:"field-value",children:[(0,_.jsx)(ge.Z.Text,{copyable:!1,ellipsis:{tooltip:null!=lt&&lt.apiKey?"".concat(lt.apiKey.slice(0,3)).concat("*".repeat(20)):""},style:{maxWidth:"calc(100% - 32px)"},children:null!=lt&&lt.apiKey?"".concat(lt.apiKey.slice(0,3)).concat("*".repeat(20)):"-"}),(null==lt?void 0:lt.apiKey)&&(0,_.jsx)(ve.Z,{title:l.formatMessage({id:"copy",defaultMessage:"复制"}),children:(0,_.jsx)(j.ZP,{type:"text",size:"small",icon:(0,_.jsx)(je.Z,{}),onClick:function(){return yt(lt.apiKey,"API Key")},style:{flexShrink:0}})})]})]})}),(null==lt?void 0:lt.cozeBotId)&&(0,_.jsx)(fe.Z,{xs:24,sm:24,md:12,lg:8,children:(0,_.jsxs)("div",{className:"provider-field-item",children:[(0,_.jsx)("div",{className:"field-label",children:l.formatMessage({id:"ai.provider.cozeBotId"})}),(0,_.jsxs)("div",{className:"field-value",children:[(0,_.jsx)(ge.Z.Text,{copyable:!1,ellipsis:{tooltip:lt.cozeBotId},style:{maxWidth:"calc(100% - 32px)"},children:lt.cozeBotId}),(0,_.jsx)(ve.Z,{title:l.formatMessage({id:"copy",defaultMessage:"复制"}),children:(0,_.jsx)(j.ZP,{type:"text",size:"small",icon:(0,_.jsx)(je.Z,{}),onClick:function(){return yt(lt.cozeBotId,"Coze Bot ID")},style:{flexShrink:0}})})]})]})}),(null==lt?void 0:lt.ragflowType)&&(0,_.jsx)(fe.Z,{xs:24,sm:24,md:12,lg:8,children:(0,_.jsxs)("div",{className:"provider-field-item",children:[(0,_.jsx)("div",{className:"field-label",children:l.formatMessage({id:"ai.provider.ragflowType"})}),(0,_.jsxs)("div",{className:"field-value",children:[(0,_.jsx)(ge.Z.Text,{copyable:!1,ellipsis:{tooltip:lt.ragflowType},style:{maxWidth:"calc(100% - 32px)"},children:lt.ragflowType}),(0,_.jsx)(ve.Z,{title:l.formatMessage({id:"copy",defaultMessage:"复制"}),children:(0,_.jsx)(j.ZP,{type:"text",size:"small",icon:(0,_.jsx)(je.Z,{}),onClick:function(){return yt(lt.ragflowType,"Ragflow Type")},style:{flexShrink:0}})})]})]})}),(null==lt?void 0:lt.ragflowId)&&(0,_.jsx)(fe.Z,{xs:24,sm:24,md:12,lg:8,children:(0,_.jsxs)("div",{className:"provider-field-item",children:[(0,_.jsx)("div",{className:"field-label",children:l.formatMessage({id:"ai.provider.ragflowId"})}),(0,_.jsxs)("div",{className:"field-value",children:[(0,_.jsx)(ge.Z.Text,{copyable:!1,ellipsis:{tooltip:lt.ragflowId},style:{maxWidth:"calc(100% - 32px)"},children:lt.ragflowId}),(0,_.jsx)(ve.Z,{title:l.formatMessage({id:"copy",defaultMessage:"复制"}),children:(0,_.jsx)(j.ZP,{type:"text",size:"small",icon:(0,_.jsx)(je.Z,{}),onClick:function(){return yt(lt.ragflowId,"Ragflow ID")},style:{flexShrink:0}})})]})]})})]})}]}),!(null!=lt&&lt.apiKey)&&Oe&&(0,_.jsx)(ue.Z,{message:l.formatMessage({id:"provider.apikey.empty.warning",defaultMessage:"API Key未配置"}),description:l.formatMessage({id:"provider.apikey.empty.description",defaultMessage:"请配置API Key以正常使用AI服务"}),type:"warning",showIcon:!0,closable:!0,onClose:function(){return Re(!1)},style:{marginBottom:"16px"},action:(0,_.jsx)(j.ZP,{size:"small",type:"primary",onClick:function(){S(!0),Le(!0)},children:l.formatMessage({id:"provider.config.now",defaultMessage:"立即配置"})})}),a===L.Hxq&&(0,_.jsx)(ce.Z,{checkedChildren:l.formatMessage({id:"provider.online"}),unCheckedChildren:l.formatMessage({id:"provider.offline"}),defaultChecked:(null==lt?void 0:lt.status)===L.KY,onChange:function(e){H.Z.debug("switch to ".concat(e)),ft(e)}}),(0,_.jsx)(he.Z,{orientation:"left",children:l.formatMessage({id:"model.list"})}),(0,_.jsxs)(Z.Z,{wrap:!0,children:[(0,_.jsx)(ve.Z,{title:"".concat(l.formatMessage({id:"model.add"})," (Ctrl/Cmd + N)"),children:(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(D.Z,{}),type:"primary",onClick:function(){c(!1),K(!0)},children:l.formatMessage({id:"model.add"})})}),"ollama"!==lt.type&&a===L.whQ&&(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(Ze.Z,{}),onClick:function(){return W(!0)},children:l.formatMessage({id:"model.import"})}),(0,_.jsx)(ve.Z,{title:"".concat(l.formatMessage({id:"model.refresh"})," (Ctrl/Cmd + R)"),children:(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(Me.Z,{}),loading:He,onClick:it,children:l.formatMessage({id:"model.refresh"})})}),(0,_.jsxs)(Z.Z.Compact,{style:{maxWidth:300},children:[(0,_.jsx)(P.Z,{placeholder:l.formatMessage({id:"model.search.placeholder",defaultMessage:"搜索模型名称或描述..."}),value:Ie,onChange:function(e){var t=e.target.value;ze(t),t||(ze(""),ot(1,$e.pageSize,""))},onPressEnter:function(e){e.preventDefault(),st(e.currentTarget.value)},allowClear:!0}),(0,_.jsx)(j.ZP,{type:"primary",icon:(0,_.jsx)(E.Z,{}),"aria-label":l.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return st(Ie)}})]})]})]}),(0,_.jsx)("div",{className:"llm-model-list-container",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px 24px 0 24px",display:"flex",flexDirection:"column"},children:(0,_.jsx)(k.Z,{itemLayout:"horizontal",className:"llm-model-list",loading:Fe,dataSource:ee,pagination:!1,renderItem:function(e,t){return(0,_.jsx)(k.Z.Item,{style:(null==R?void 0:R.uid)===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},actions:[(0,_.jsx)(j.ZP,{type:"link",onClick:function(){return t=e,H.Z.debug("list on edit",t),q(t),c(!0),void K(!0);var t},children:l.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,_.jsx)(j.ZP,{type:"link",onClick:function(){return gt(e)},children:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,_.jsx)(k.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,_.jsxs)(Z.Z,{children:[(0,_.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[($e.current-1)*$e.pageSize+t+1,"."]}),(0,_.jsx)("span",{children:e.nickname}),(0,se.Rb)(e.type),(0,_.jsx)(ce.Z,{size:"small",checked:e.enabled,onChange:function(t){return xt(t,e)},checkedChildren:l.formatMessage({id:"model.enabled"}),unCheckedChildren:l.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,_.jsxs)("div",{children:[(0,_.jsx)(ge.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,_.jsx)("div",{style:{marginTop:"4px"},children:(0,_.jsx)(ge.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}})}),(0,_.jsx)("div",{style:{flexShrink:0,padding:"16px 24px 16px 24px",borderTop:n?"1px solid #333":"1px solid #f0f0f0",backgroundColor:n?"#141414":"#f5f5f5",display:"flex",justifyContent:"center"},children:ee.length>0&&(0,_.jsx)(xe.Z,{current:$e.current,pageSize:$e.pageSize,total:$e.total,showSizeChanger:$e.showSizeChanger,showQuickJumper:$e.showQuickJumper,showTotal:$e.showTotal,pageSizeOptions:$e.pageSizeOptions,onChange:function(e,t){H.Z.debug("Pagination onChange:",{page:e,pageSize:t}),ot(e,t,Ie)},onShowSizeChange:function(e,t){H.Z.debug("Pagination onShowSizeChange:",{current:e,size:t}),ot(1,t,Ie)}})}),B&&(0,_.jsx)(ye,{isEdit:s,llmmodel:R,provider:lt,open:B,level:a,onClose:ct,onSubmit:mt}),G&&(0,_.jsx)(Se,{provider:lt,open:G,level:a,onClose:ut,onSubmit:pt,existingModels:ee}),Te&&(0,_.jsx)(Y,{open:Te,isEdit:M,level:a,llmProvider:lt,onCancel:function(){return Le(!1)},onSubmit:ht}),Pe]})},Le=a(51146),Ue=a(77274),De=a(82690),Ie=a(54881),ze=a(77359),Ee=a(83103),Ne=a(93689),Oe=a(54495),Re=function(e,t,a){var r=function(e,t,a){var r=e.toLowerCase(),l=(null==t?void 0:t.toLowerCase())||"",n=(null==a?void 0:a.toLowerCase())||"";return r.includes("llama")||r.includes("mistral")||r.includes("gemma")||r.includes("phi")?"chat":r.includes("embedding")||r.includes("embed")||r.includes("instructor")?"embedding":r.includes("vision")||r.includes("llava")||r.includes("bakllava")||r.includes("qwen-vl")?"vision":r.includes("code")||r.includes("codellama")||r.includes("wizardcoder")?"code":r.includes("rerank")||r.includes("bge-rerank")?"rerank":r.includes("audio")||r.includes("whisper")?"audio2text":r.includes("text2image")||r.includes("stable-diffusion")?"text2image":l.includes("llama")||l.includes("mistral")||l.includes("gemma")?"chat":l.includes("embedding")?"embedding":l.includes("vision")||l.includes("multimodal")?"vision":l.includes("code")?"code":(n.includes("gguf")||n.includes("ggml"),"chat")}(e,t,a),l="default",n=r;switch(r){case"chat":l="blue",n="对话";break;case"embedding":l="purple",n="向量嵌入";break;case"vision":l="green",n="视觉";break;case"code":l="cyan",n="代码";break;case"rerank":l="cyan",n="排序";break;case"audio2text":l="volcano",n="语音转文本";break;case"text2image":l="magenta",n="文本生成图像";break;default:l="default",n=r}return(0,_.jsx)(S.Z,{color:l,children:n})},qe=function(e){var t,a,l,n,o,i,s,d,c,u,m,p,f,v=e.visible,h=e.onClose,x=e.modelName,y=e.modelDetails,w=e.loading,M=e.onRefresh,C=e.onPull,T=e.onDelete,L=(e.isRemoteModel,e.isLocalModel),U=e.pullingModelName,D=e.localModelNames,I=void 0===D?[]:D,z=(0,b.useIntl)(),N=(0,r.useState)(""),O=g()(N,2),R=O[0],q=O[1],A=y&&"model"in y&&"tags"in y,F=y&&"license"in y&&"modelfile"in y,B=I.includes(x);return(0,_.jsxs)(V.Z,{title:z.formatMessage({id:"ai.ollama.modelDetails.title"},{modelName:x}),width:600,placement:"right",onClose:h,open:v,zIndex:1002,children:[w?(0,_.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:(0,_.jsx)(Pe.Z,{tip:z.formatMessage({id:"ai.ollama.modelDetails.loading"}),spinning:!0,children:(0,_.jsx)("div",{style:{padding:"50px",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px",minHeight:"200px"}})})}):y?(0,_.jsxs)(_.Fragment,{children:[A&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(Ee.Z,{bordered:!0,column:1,title:z.formatMessage({id:"ai.ollama.modelDetails.basicInfo"}),styles:{label:{width:"120px"}},children:[(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.name"}),children:(0,_.jsxs)(Z.Z,{children:[(null===(t=y.model)||void 0===t?void 0:t.name)||x,B&&(0,_.jsx)(S.Z,{color:"success",children:z.formatMessage({id:"ai.ollama.modelDetails.installed"})})]})}),(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Re(x)}),(null===(a=y.model)||void 0===a?void 0:a.description)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.description"}),children:y.model.description}),(null===(l=y.model)||void 0===l?void 0:l.lastUpdated)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),children:y.model.lastUpdated}),(null===(n=y.model)||void 0===n?void 0:n.pullCount)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.pullCount"}),children:y.model.pullCount}),(null===(o=y.model)||void 0===o?void 0:o.totalTags)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.totalTags"}),children:y.model.totalTags}),(null===(i=y.model)||void 0===i?void 0:i.popularTags)&&y.model.popularTags.length>0&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.popularTags"}),children:(0,_.jsx)(Z.Z,{wrap:!0,children:y.model.popularTags.map((function(e,t){return(0,_.jsx)(S.Z,{color:"blue",children:e},t)}))})}),(null===(s=y.model)||void 0===s?void 0:s.modified_at)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modifiedAt"}),children:(0,ae.mr)(y.model.modified_at.toString())})]}),y.tags&&y.tags.length>0&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(he.Z,{orientation:"left",children:z.formatMessage({id:"ai.ollama.modelDetails.availableVersions"})}),(0,_.jsx)(P.Z,{placeholder:z.formatMessage({id:"ai.ollama.modelDetails.searchVersions"}),prefix:(0,_.jsx)(E.Z,{}),value:R,onChange:function(e){return q(e.target.value)},style:{marginBottom:16},allowClear:!0}),(0,_.jsx)(k.Z,{itemLayout:"horizontal",dataSource:function(){if(!A||!y.tags)return[];var e=y.tags;if(!R)return e;var t=R.toLowerCase();return e.filter((function(e){return e.tag.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)}))}(),renderItem:function(e){var t=function(e,t){var a="".concat(e,":").concat(t);return I.includes(a)}(x,e.tag),a="".concat(x,":").concat(e.tag);return(0,_.jsxs)(k.Z.Item,{children:[(0,_.jsx)(k.Z.Item.Meta,{title:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)("span",{children:e.name}),(0,_.jsx)(S.Z,{color:"green",children:e.tag}),Re(x),e.size&&(0,_.jsx)(S.Z,{color:"orange",children:e.size}),t&&(0,_.jsx)(S.Z,{color:"success",children:z.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,_.jsxs)("span",{children:[z.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),": ",e.lastUpdated]})}),(0,_.jsx)(Z.Z,{children:(0,_.jsx)(ve.Z,{title:t?z.formatMessage({id:"ai.ollama.modelDetails.versionExists"}):z.formatMessage({id:"ai.ollama.modelDetails.pullThisVersion"}),children:(0,_.jsx)(j.ZP,{type:"primary",size:"small",icon:t?(0,_.jsx)(Ne.Z,{}):(0,_.jsx)(Oe.Z,{}),loading:U===a,onClick:function(){C(a)},disabled:t,children:t?z.formatMessage({id:"ai.ollama.modelDetails.installed"}):z.formatMessage({id:"ai.ollama.modelDetails.pullVersion"})})})})]})}})]})]}),F&&(0,_.jsxs)(Ee.Z,{bordered:!0,column:1,title:z.formatMessage({id:"ai.ollama.modelDetails.localModel"}),styles:{label:{width:"120px"}},children:[(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Re(x,null===(d=y.details)||void 0===d?void 0:d.family,null===(c=y.details)||void 0===c?void 0:c.format)}),(null===(u=y.details)||void 0===u?void 0:u.format)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelFormat"}),children:y.details.format}),(null===(m=y.details)||void 0===m?void 0:m.family)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelFamily"}),children:y.details.family}),(null===(p=y.details)||void 0===p?void 0:p.parameter_size)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.parameterSize"}),children:y.details.parameter_size}),(null===(f=y.details)||void 0===f?void 0:f.quantization_level)&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.quantizationLevel"}),children:y.details.quantization_level}),y.system&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.systemInfo"}),children:y.system}),y.template&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.template"}),children:(0,_.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:y.template})}),y.modelfile&&(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelfile"}),children:(0,_.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:y.modelfile})}),(0,_.jsx)(Ee.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.license"}),children:y.license})]})]}):(0,_.jsx)(ue.Z,{message:z.formatMessage({id:"ai.ollama.modelDetails.error"}),type:"warning"}),(0,_.jsx)(he.Z,{}),(0,_.jsxs)(Z.Z,{children:[!w&&(0,_.jsx)(j.ZP,{type:"primary",onClick:function(){return M(x)},icon:(0,_.jsx)(Me.Z,{}),children:z.formatMessage({id:"ai.ollama.modelDetails.refresh"})}),L&&(0,_.jsx)(ze.Z,{title:z.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:z.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:x}),onConfirm:function(){T(x),h()},okText:z.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:z.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),children:(0,_.jsx)(j.ZP,{type:"primary",danger:!0,icon:(0,_.jsx)(Ie.Z,{}),children:z.formatMessage({id:"ai.ollama.modelDetails.delete"})})})]})]})},Ae=function(e){var t=e.visible,a=e.onClose,l=e.models,n=e.loading,o=e.onRefresh,i=e.onModelDetails,s=e.onPull,d=e.pullingModelName,c=e.localModelNames,u=void 0===c?[]:c,m=(0,b.useIntl)(),p=(0,r.useState)(""),f=g()(p,2),v=f[0],h=f[1],x=l.filter((function(e){var t=v.toLowerCase();return e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.popularTags&&e.popularTags.some((function(e){return e.toLowerCase().includes(t)}))}));return(0,_.jsxs)(V.Z,{title:m.formatMessage({id:"ai.ollama.title"}),width:600,placement:"right",onClose:a,open:t,zIndex:1001,children:[(0,_.jsxs)(Z.Z,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[(0,_.jsxs)(Z.Z,{style:{width:"100%",justifyContent:"space-between"},children:[(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(Me.Z,{}),loading:n,onClick:o,children:m.formatMessage({id:"ai.ollama.refreshRemote"})}),(0,_.jsx)("span",{style:{color:"#999",fontSize:"14px"},children:m.formatMessage({id:"ai.ollama.modelDetails.modelCount"},{filteredCount:x.length,totalCount:l.length})})]}),(0,_.jsx)(P.Z,{placeholder:m.formatMessage({id:"ai.ollama.modelDetails.searchModels"}),prefix:(0,_.jsx)(E.Z,{}),onChange:function(e){return h(e.target.value)},allowClear:!0})]}),(0,_.jsx)(k.Z,{itemLayout:"vertical",loading:n,dataSource:x,renderItem:function(e){var t,a,r=(a=e.name,u.includes(a));return(0,_.jsx)(k.Z.Item,{extra:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)(j.ZP,{type:"default",icon:(0,_.jsx)(De.Z,{}),onClick:function(){return i(e.name)},style:{marginRight:8},children:m.formatMessage({id:"ai.ollama.modelDetails.details"})}),(0,_.jsx)(ve.Z,{title:r?m.formatMessage({id:"ai.ollama.modelDetails.modelExistsTooltip"}):m.formatMessage({id:"ai.ollama.modelDetails.modelNotExistsTooltip"}),children:(0,_.jsx)(j.ZP,{type:"primary",icon:r?(0,_.jsx)(Ne.Z,{}):(0,_.jsx)(Oe.Z,{}),loading:d===e.name,onClick:function(){return s(e.name)},disabled:r,children:r?m.formatMessage({id:"ai.ollama.modelDetails.installed"}):m.formatMessage({id:"ai.ollama.modelDetails.pullModel"})})})]}),children:(0,_.jsx)(k.Z.Item.Meta,{title:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)("strong",{children:e.name}),Re(e.name),r&&(0,_.jsx)(S.Z,{color:"success",children:m.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,_.jsxs)(Z.Z,{direction:"vertical",style:{width:"100%"},children:[(0,_.jsxs)(Z.Z,{children:[e.pullCount&&(0,_.jsx)(S.Z,{color:"cyan",children:m.formatMessage({id:"ai.ollama.modelDetails.downloads"},{count:e.pullCount})}),e.lastUpdated&&(0,_.jsx)(S.Z,{color:"orange",children:m.formatMessage({id:"ai.ollama.modelDetails.updated"},{time:e.lastUpdated})})]}),(0,_.jsx)("div",{children:e.description||m.formatMessage({id:"ai.ollama.modelDetails.noDescription"})}),(0,_.jsx)(Z.Z,{style:{marginTop:8},children:null===(t=e.popularTags)||void 0===t?void 0:t.map((function(e,t){return(0,_.jsx)(S.Z,{color:"blue",children:e},t)}))})]})})})}})]})},Fe=function(e){var t=e.provider,a=e.level,l=(0,b.useIntl)(),n=(0,x.Z)().isDarkMode,o=(0,r.useState)(!1),i=g()(o,2),s=i[0],c=i[1],m=(0,r.useState)(!1),f=g()(m,2),y=f[0],w=f[1],M=(0,r.useState)(!1),P=g()(M,2),T=P[0],L=P[1],U=(0,r.useState)([]),D=g()(U,2),I=D[0],z=D[1],E=(0,r.useState)(!1),O=g()(E,2),R=O[0],q=O[1],A=(0,N.A)((function(e){return e.upgradeLlmProvider})),F=(0,r.useState)(),B=g()(F,2),K=B[0],J=B[1],V=(0,N.A)((function(e){var t;return(null===(t=e.llmproviderResult)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.content)||[]})).find((function(e){return e.uid===(null==t?void 0:t.uid)}))||t,G=(0,r.useState)(!1),W=g()(G,2),X=W[0],Q=W[1],$=(0,r.useState)([]),ee=g()($,2),te=ee[0],re=ee[1],le=(0,r.useState)(!1),ne=g()(le,2),oe=ne[0],ie=ne[1],se=(0,r.useState)(""),de=g()(se,2),me=de[0],pe=de[1],fe=(0,r.useState)(""),ge=g()(fe,2),xe=ge[0],ye=ge[1],je=(0,r.useState)(!1),Ze=g()(je,2),Pe=Ze[0],ke=Ze[1],Ce=(0,r.useState)(!1),Se=g()(Ce,2),Te=Se[0],Ee=Se[1],Ne=(0,r.useState)(null),Oe=g()(Ne,2),Fe=Oe[0],Be=Oe[1],Ke=(0,r.useState)(""),Je=g()(Ke,2),Ve=Je[0],Ge=Je[1],We=function(){var e=p()(u()().mark((function e(){var t,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=V&&V.baseUrl){e.next=4;break}return h.yw.error(l.formatMessage({id:"ai.ollama.apiUrlNotConfigured"})),L(!1),e.abrupt("return");case 4:return H.Z.debug("pingOllama",null==V?void 0:V.baseUrl),t={baseUrl:null==V?void 0:V.baseUrl},e.next=8,(0,Le.VM)(t);case 8:a=e.sent,H.Z.debug("getOllamaServerStatus: ",a,t),200===a.code?L(null==a?void 0:a.data):L(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Xe=function(){var e=p()(u()().mark((function e(){var t,a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.Z.debug("requestLocalModels"),w(!0),t={baseUrl:null==V?void 0:V.baseUrl},e.next=5,(0,Le.c8)(t);case 5:a=e.sent,H.Z.debug("getOllamaLocalModels: ",a,t),200===a.code&&(r=null==a?void 0:a.data.map((function(e){var t=e.name.split(":"),a=t[0]||e.name,r=t.length>1?t[1]:"default";return d()(d()({},e),{},{modelName:a,modelVersion:r})})),z(r)),w(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),He=function(){var e=p()(u()().mark((function e(){var t,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie(!0),t={baseUrl:null==V?void 0:V.baseUrl},e.next=4,(0,Le.rg)(t);case 4:a=e.sent,H.Z.debug("getOllamaLibraryModels: ",a,t),200===a.code?re(null==a?void 0:a.data):h.yw.error(a.message||l.formatMessage({id:"ai.ollama.remoteModels.fetchFailed"})),ie(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.prev=1,e.next=4,Promise.all([We(),Xe()]);case 4:return e.prev=4,c(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){_e()}),[]),(0,r.useEffect)((function(){var e=function(e){if(!(R||X||Pe)&&(e.ctrlKey||e.metaKey))switch(e.key){case"r":e.preventDefault(),_e();break;case"m":e.preventDefault(),Ye()}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[R,X,Pe]);var Ye=function(){Q(!0),He()},Qe=function(){var e=p()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(l.formatMessage({id:"updating"})),e.next=3,(0,v.fx)(t);case 3:a=e.sent,H.Z.debug("updateLlmProvider:",t,a),200===a.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),A(null==a?void 0:a.data),q(!1)):(h.yw.destroy(),h.yw.error(a.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.Z.debug("switch enabled to ".concat(t)),!t||T){e.next=4;break}return h.yw.error(l.formatMessage({id:"ai.ollama.startFirst"})),e.abrupt("return");case 4:return a=d()(d()({},V),{},{enabled:t}),h.yw.loading(l.formatMessage({id:"updating"})),e.next=8,(0,v.fx)(a);case 8:r=e.sent,H.Z.debug("updateLlmProvider enabled:",a,r),200===r.code?(h.yw.destroy(),h.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),A(null==r?void 0:r.data)):(h.yw.destroy(),h.yw.error(r.message));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=3;break}return h.yw.error(l.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return pe(t),h.yw.loading(l.formatMessage({id:"ai.ollama.modelDetails.deleteModel.loading"},{modelName:t})),e.prev=5,a={baseUrl:null==V?void 0:V.baseUrl,model:t},e.next=9,(0,Le.G9)(a);case 9:r=e.sent,H.Z.debug("deleteOllamaModel:",null==r?void 0:r.data,t),200===r.code&&null!=r&&r.data?(h.yw.success(l.formatMessage({id:"ai.ollama.modelDetails.deleteModel.success"},{modelName:t})),Xe()):h.yw.error(r.message||l.formatMessage({id:"ai.ollama.modelDetails.deleteModel.failed"},{modelName:t})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("删除模型出错:",e.t0),h.yw.error(l.formatMessage({id:"ai.ollama.modelDetails.deleteModel.error"},{error:e.t0}));case 18:return e.prev=18,pe(""),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[5,14,18,21]])})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=p()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=3;break}return h.yw.error(l.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return ye(t),h.yw.loading(l.formatMessage({id:"ai.ollama.modelDetails.pulling"},{modelName:t})),e.prev=5,a={baseUrl:null==V?void 0:V.baseUrl,model:t},e.next=9,(0,Le.N6)(a);case 9:200===(r=e.sent).code&&null!=r&&r.data?(h.yw.success(l.formatMessage({id:"ai.ollama.modelDetails.pullSuccess"},{modelName:t})),Q(!1),Xe()):h.yw.error(r.message||l.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:t})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("拉取模型出错:",e.t0),h.yw.error(l.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:t}));case 17:return e.prev=17,ye(""),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})));return function(t){return e.apply(this,arguments)}}(),at=function(){var e=p()(u()().mark((function e(t){var a,r,n,o,i,s,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ee(!0),Ge(t),ke(!0),e.prev=3,a=I.some((function(e){return e.name===t})),r=te.some((function(e){return e.name===t})),!a){e.next=14;break}return o={baseUrl:null==V?void 0:V.baseUrl,model:t},e.next=10,(0,Le.sF)(o);case 10:n=e.sent,H.Z.debug("getOllamaModelDetails (local):",n),e.next=27;break;case 14:if(!r){e.next=22;break}return i={baseUrl:null==V?void 0:V.baseUrl,model:t},e.next=18,(0,Le.gF)(i);case 18:n=e.sent,H.Z.debug("getOllamaLibraryModelDetails (remote):",n),e.next=27;break;case 22:return s={baseUrl:null==V?void 0:V.baseUrl,model:t},e.next=25,(0,Le.gF)(s);case 25:n=e.sent,H.Z.debug("getOllamaLibraryModelDetails (default):",n);case 27:200===n.code?Be(null===(d=n)||void 0===d?void 0:d.data):(h.yw.error(n.message||l.formatMessage({id:"ai.ollama.modelDetails.fetchFailed"},{modelName:t})),Be(null)),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(3),console.error("获取模型详情出错:",e.t0),h.yw.error(l.formatMessage({id:"ai.ollama.modelDetails.fetchError"},{error:e.t0})),Be(null);case 35:return e.prev=35,Ee(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[3,30,35,38]])})));return function(t){return e.apply(this,arguments)}}();return(0,_.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,_.jsxs)("div",{style:{flexShrink:0,padding:"16px 24px",borderBottom:"1px solid #f0f0f0"},children:[(0,_.jsxs)("h1",{children:[(0,_.jsx)(C.Z,{src:null==V?void 0:V.logo}),(0,_.jsx)("span",{style:{marginLeft:"12px"},children:null==V?void 0:V.nickname}),(0,_.jsx)(ce.Z,{checked:null==V?void 0:V.enabled,onChange:$e,checkedChildren:l.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.checked"}),unCheckedChildren:l.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.unchecked"}),style:{marginLeft:"8px"}}),(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(be.Z,{}),onClick:function(){window.open(null==V?void 0:V.webUrl,"_blank")}}),(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(we.Z,{}),onClick:function(){return q(!0)}})]}),(null==V?void 0:V.description)&&(0,_.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:V.description}),(0,_.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,_.jsxs)("span",{children:["baseUrl: ",null==V?void 0:V.baseUrl]}),(0,_.jsx)(j.ZP,{type:"link",size:"small",icon:(0,_.jsx)(we.Z,{}),onClick:function(){return q(!0)},children:l.formatMessage({id:"ai.ollama.modelDetails.edit"})})]}),(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)(ve.Z,{title:"".concat(l.formatMessage({id:"ai.ollama.refresh"})," (Ctrl/Cmd + R)"),children:(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(Me.Z,{}),loading:s,type:"primary",onClick:_e,children:l.formatMessage({id:"ai.ollama.refresh"})})}),(0,_.jsx)(ve.Z,{title:"".concat(l.formatMessage({id:"ai.ollama.remoteModels"})," (Ctrl/Cmd + M)"),children:(0,_.jsx)(j.ZP,{icon:(0,_.jsx)(Ue.Z,{}),type:"primary",onClick:Ye,children:l.formatMessage({id:"ai.ollama.remoteModels"})})})]}),(0,_.jsx)("br",{}),(0,_.jsx)("br",{}),T?(0,_.jsx)(ue.Z,{message:l.formatMessage({id:"ai.ollama.running"}),type:"success"}):(0,_.jsx)(ue.Z,{message:l.formatMessage({id:"ai.ollama.notRunning"}),type:"error"}),(0,_.jsx)(he.Z,{orientation:"left",children:l.formatMessage({id:"ai.ollama.localModels"})})]}),(0,_.jsx)("div",{className:"llm-model-list-container",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px 24px"},children:(0,_.jsx)(k.Z,{itemLayout:"horizontal",className:"llm-model-list",loading:y,dataSource:I,renderItem:function(e,t){return(0,_.jsx)(k.Z.Item,{style:(null==K?void 0:K.name)===(null==e?void 0:e.name)?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){J(e)},actions:[(0,_.jsx)(j.ZP,{type:"text",icon:(0,_.jsx)(De.Z,{}),onClick:function(t){t.stopPropagation(),at(null==e?void 0:e.name)},children:l.formatMessage({id:"ai.ollama.modelDetails.details"})},"details"),(0,_.jsx)(ze.Z,{title:l.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:l.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:null==e?void 0:e.name}),onConfirm:function(t){null==t||t.stopPropagation(),et(null==e?void 0:e.modelName)},okText:l.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:l.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),onCancel:function(e){return null==e?void 0:e.stopPropagation()},children:(0,_.jsx)(j.ZP,{type:"text",danger:!0,icon:(0,_.jsx)(Ie.Z,{}),loading:me===(null==e?void 0:e.modelName),onClick:function(e){return e.stopPropagation()},children:l.formatMessage({id:"ai.ollama.modelDetails.deleteModel"})})},"delete")],children:(0,_.jsx)(k.Z.Item.Meta,{title:(0,_.jsxs)(Z.Z,{children:[(0,_.jsx)("span",{children:null==e?void 0:e.modelName}),(0,_.jsx)(S.Z,{color:"blue",children:null==e?void 0:e.modelVersion}),Re(null==e?void 0:e.modelName,null==e?void 0:e.family,null==e?void 0:e.format),(null==e?void 0:e.size)&&(0,_.jsx)(S.Z,{color:"green",children:(0,ae.sS)(null==e?void 0:e.size)}),(null==e?void 0:e.parameter_size)&&(0,_.jsx)(ve.Z,{title:"参数大小",children:(0,_.jsx)(S.Z,{color:"purple",children:null==e?void 0:e.parameter_size})})]}),description:(0,_.jsxs)(Z.Z,{direction:"vertical",children:[(0,_.jsx)("div",{children:l.formatMessage({id:"ai.ollama.modelDetails.fullName"},{name:null==e?void 0:e.name})}),(0,_.jsx)("div",{children:l.formatMessage({id:"ai.ollama.modelDetails.digest"},{digest:null==e?void 0:e.digest})}),(null==e?void 0:e.family)&&(0,_.jsx)("div",{children:l.formatMessage({id:"ai.ollama.modelDetails.family"},{family:null==e?void 0:e.family})}),(null==e?void 0:e.quantization_level)&&(0,_.jsx)("div",{children:l.formatMessage({id:"ai.ollama.modelDetails.quantization"},{level:null==e?void 0:e.quantization_level})}),(0,_.jsx)("div",{children:l.formatMessage({id:"ai.ollama.modelDetails.updateTime"},{time:(0,ae.mr)(null==e?void 0:e.modified_at.toString())})})]}),style:{marginLeft:"15px"}})})}})}),(0,_.jsx)(Ae,{visible:X,onClose:function(){return Q(!1)},models:te,loading:oe,onRefresh:He,onModelDetails:at,onPull:tt,pullingModelName:xe,localModelNames:I.map((function(e){return e.modelName}))}),(0,_.jsx)(qe,{visible:Pe,onClose:function(){return ke(!1)},modelName:Ve,modelDetails:Fe,loading:Te,onRefresh:at,onPull:tt,onDelete:et,isRemoteModel:te.some((function(e){return e.name===Ve})),isLocalModel:I.some((function(e){return e.name===Ve})),pullingModelName:xe,localModelNames:I.map((function(e){return e.name}))}),R&&(0,_.jsx)(Y,{open:R,isEdit:!0,level:a,llmProvider:V,onCancel:function(){return q(!1)},onSubmit:Qe})]})},Be=function(e){var t=e.level,a=(0,r.useState)(""),l=g()(a,2),n=l[0],o=l[1],s=(0,r.useState)([]),d=g()(s,2),c=d[0],u=d[1];(0,r.useEffect)((function(){return document.body.classList.add("no-scroll"),function(){document.body.classList.remove("no-scroll")}}),[]);var m=(0,N.A)((function(e){return{currentLlmProvider:e.currentLlmProvider,llmproviderResult:e.llmproviderResult,setCurrentLlmProvider:e.setCurrentLlmProvider,tabsToClose:e.tabsToClose,removeTabToClose:e.removeTabToClose}})),p=m.currentLlmProvider,f=m.llmproviderResult,v=m.setCurrentLlmProvider,h=m.tabsToClose,x=m.removeTabToClose,y=te((function(e){return{currentLlmProviderPlatform:e.currentLlmProviderPlatform,llmproviderResultPlatform:e.llmproviderResultPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,tabsToClosePlatform:e.tabsToClosePlatform,removeTabToClosePlatform:e.removeTabToClosePlatform}})),b=y.currentLlmProviderPlatform,w=y.llmproviderResultPlatform,M=y.setCurrentLlmProviderPlatform,j=y.tabsToClosePlatform,Z=y.removeTabToClosePlatform,P=(0,r.useState)(t===L.Hxq),k=g()(P,1)[0],C=k?b:p,S=k?j:h,T=k?Z:x;(0,r.useEffect)((function(){S.length>0&&S.forEach((function(e){c.find((function(t){return t.key===e}))?(U(e),T(e)):T(e)}))}),[S,c,T]),(0,r.useEffect)((function(){if(C&&C.uid)if(console.log("llmProvider: ",C),c.find((function(e){return e.key===C.uid})))o(C.uid);else{var e=i()(c);C.type===L.CZ7?e.push({label:C.nickname||C.type,children:(0,_.jsx)("div",{className:"llm-provider-tab-pane-content",children:(0,_.jsx)(Fe,{provider:C,level:t})}),key:C.uid,closable:!0}):e.push({label:C.nickname||C.type,children:(0,_.jsx)("div",{className:"llm-provider-tab-pane-content",children:(0,_.jsx)(Te,{provider:C,level:t})}),key:C.uid,closable:!0}),u(e),o(C.uid)}}),[C,c]);var U=function(e){var t=n,a=-1;c.forEach((function(t,r){t.key===e&&(a=r-1)}));var r=c.filter((function(t){return t.key!==e}));if(r.length&&t===e){var l,i;t=a>=0?r[a].key:r[0].key;var s=(k?(null==w||null===(l=w.data)||void 0===l?void 0:l.content)||[]:(null==f||null===(i=f.data)||void 0===i?void 0:i.content)||[]).find((function(e){return e.uid===t}));s&&(k?M(s):v(s))}u(r),o(t)};return 0===c.length?null:(0,_.jsx)("div",{className:"llm-provider-tab-container",children:(0,_.jsx)(le.Z,{type:"editable-card",onChange:function(e){var t,a;o(e);var r=(k?(null==w||null===(t=w.data)||void 0===t?void 0:t.content)||[]:(null==f||null===(a=f.data)||void 0===a?void 0:a.content)||[]).find((function(t){return t.uid===e}));r&&(k?M(r):v(r))},activeKey:n,onEdit:function(e,t){"remove"===t&&U(e)},items:c,className:"llm-provider-tabs",hideAdd:!0})})},Ke=function(){var e=(0,l.Z)(),t=e.leftSiderStyle,a=e.contentStyle;return(0,_.jsxs)(n.Z,{style:{height:"100%"},children:[(0,_.jsx)(n.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,_.jsx)(re,{level:L.whQ,superUser:!1})}),(0,_.jsx)(n.Z.Panel,{style:a,children:(0,_.jsx)(Be,{level:L.whQ,superUser:!1})})]})}}}]);