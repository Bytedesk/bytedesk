"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3129],{16829:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(77260),r=a(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},s=a(5901),l=function(e,t){return r.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))};var o=r.forwardRef(l)},38722:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(77260),r=a(44194),i={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},s=a(5901),l=function(e,t){return r.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))};var o=r.forwardRef(l)},80503:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(77260),r=a(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},s=a(5901),l=function(e,t){return r.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))};var o=r.forwardRef(l)},60123:function(e,t,a){a.d(t,{LX:function(){return f},T:function(){return u},ay:function(){return h},eY:function(){return m}});var n=a(90819),r=a.n(n),i=a(73193),s=a.n(i),l=a(89933),o=a.n(l),c=a(25191),d=a(75699);function u(e){return p.apply(this,arguments)}function p(){return(p=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/query/org",{method:"GET",params:s()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return y.apply(this,arguments)}function y(){return(y=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/create",{method:"POST",data:s()(s()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/update",{method:"POST",data:s()(s()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/delete",{method:"POST",data:s()(s()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},55386:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});var n=a(84176),r=a.n(n),i=a(10154),s=a.n(i),l=a(73193),o=a.n(l),c=a(86222),d=a.n(c),u=a(90819),p=a.n(u),f=a(89933),y=a.n(f),m=a(45332),g=a.n(m),h=a(44194),x=a(43443),v=a(44532),M=a(77407),q=a(35129),b=a(50972),j=a(6992),w=a(91768),k=a(16829),Z=a(38722),S=a(80503),I=a(79148),C=a(75699),T=a(60123),z=a(76711),F=a.n(z),P=a(55738),A=a(25950),N=a(34251),Y=a(34651),D=a(43413),B=a(24418),O=a(63065),R=a(38862),E=a(68525),L=a(61978),H=a(41881),J=a(92395),V=a(67702),W=a(25191),X=a(31881),U=a(31549),K=(P.Z.Title,P.Z.Text),G=A.Z.TextArea,Q=N.Z.Option,_=function(e){var t=e.open,a=e.onClose,n=e.onSave,r=e.initialPlan,i=(0,C.useIntl)(),s=(0,h.useState)(null),l=g()(s,2),c=l[0],d=l[1],u=(0,h.useState)(!1),p=g()(u,2),f=p[0],y=p[1],m=(0,h.useState)(null),x=g()(m,2),v=x[0],b=x[1],k=(0,h.useState)(-1),Z=g()(k,2),S=Z[0],I=Z[1],T=Y.Z.useForm(),z=g()(T,1)[0],P=Y.Z.useForm(),_=g()(P,1)[0],$=(0,X.u)((function(e){return e.currentOrg}));(0,h.useEffect)((function(){if(r){var e={uid:r.uid,name:r.name,description:r.description,type:r.type,indicators:r.indicators||[],enabled:r.enabled,orgUid:r.orgUid};d(e),z.setFieldsValue(e)}else{var t={name:"",description:"",type:W.VJe,indicators:[],enabled:!0,orgUid:null==$?void 0:$.uid};d(t),z.setFieldsValue(t)}}),[r,z]);var ee,te=[{title:i.formatMessage({id:"quality.plan.serialNumber"}),dataIndex:"index",key:"index",width:80,render:function(e,t,a){return a+1}},{title:i.formatMessage({id:"quality.plan.indicatorName"}),dataIndex:"indicatorName",key:"indicatorName"},{title:i.formatMessage({id:"quality.plan.indicatorScore"}),dataIndex:"indicatorScore",key:"indicatorScore",render:function(e,t){return(0,U.jsxs)("span",{style:{color:t.deduction?"red":"green"},children:[t.deduction?"":"+",e||0]})}},{title:i.formatMessage({id:"quality.plan.deduction"}),key:"deduction",width:100,render:function(e,t){return(0,U.jsx)("span",{style:{color:t.deduction?"red":"inherit"},children:t.deduction?"是":"否"})}},{title:i.formatMessage({id:"quality.plan.mandatory"}),key:"mandatory",width:100,render:function(e,t){return(0,U.jsx)("span",{style:{color:t.mandatory?"blue":"inherit"},children:t.mandatory?"是":"否"})}},{title:i.formatMessage({id:"quality.plan.description"}),dataIndex:"description",key:"description",ellipsis:!0},{title:i.formatMessage({id:"actions"}),key:"action",width:200,render:function(e,t,a){var n;return(0,U.jsxs)(D.Z,{size:"small",children:[(0,U.jsx)(M.ZP,{type:"text",size:"small",icon:(0,U.jsx)(H.Z,{}),onClick:function(){return ae(t,a)}}),(0,U.jsx)(M.ZP,{type:"text",size:"small",danger:!0,icon:(0,U.jsx)(w.Z,{}),onClick:function(){return ne(a)}}),(0,U.jsx)(M.ZP,{type:"text",size:"small",icon:(0,U.jsx)(J.Z,{}),disabled:0===a,onClick:function(){return re(a,"up")}}),(0,U.jsx)(M.ZP,{type:"text",size:"small",icon:(0,U.jsx)(V.Z,{}),disabled:a===((null==c||null===(n=c.indicators)||void 0===n?void 0:n.length)||0)-1,onClick:function(){return re(a,"down")}})]})}}],ae=function(e,t){b(e),I(t),_.setFieldsValue(e),y(!0)},ne=function(e){if(c){var t=F()(c.indicators||[]);t.splice(e,1);var a=o()(o()({},c),{},{indicators:t});d(a)}},re=function(e,t){if(c){var a=F()(c.indicators||[]);if("up"===t&&e>0){var n=[a[e-1],a[e]];a[e]=n[0],a[e-1]=n[1]}else if("down"===t&&e<a.length-1){var r=[a[e+1],a[e]];a[e]=r[0],a[e+1]=r[1]}var i=o()(o()({},c),{},{indicators:a});d(i)}};return(0,U.jsxs)(B.Z,{title:r?i.formatMessage({id:"quality.plan.edit"})+": ".concat(r.name):i.formatMessage({id:"quality.plan.create"}),open:t,onClose:a,width:800,extra:(0,U.jsxs)(D.Z,{children:[(0,U.jsx)(M.ZP,{onClick:a,children:i.formatMessage({id:"quality.plan.cancel"})}),(0,U.jsx)(M.ZP,{type:"primary",onClick:function(){z.validateFields().then((function(e){if(c){var t=o()(o()({},c),e);n(t)}}))},children:i.formatMessage({id:"quality.plan.save"})})]}),children:[(0,U.jsxs)("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto"},children:[(0,U.jsx)(O.Z,{title:i.formatMessage({id:"quality.plan.basicInfo"}),style:{marginBottom:16},children:(0,U.jsxs)(Y.Z,{form:z,layout:"vertical",children:[(0,U.jsx)(Y.Z.Item,{name:"name",label:i.formatMessage({id:"quality.plan.name"}),rules:[{required:!0,message:i.formatMessage({id:"quality.plan.name.required"})}],children:(0,U.jsx)(A.Z,{placeholder:i.formatMessage({id:"quality.plan.name.required"})})}),(0,U.jsx)(Y.Z.Item,{name:"type",label:i.formatMessage({id:"quality.plan.type"}),rules:[{required:!0,message:i.formatMessage({id:"quality.plan.type.required"})}],children:(0,U.jsxs)(N.Z,{placeholder:i.formatMessage({id:"quality.plan.type.required"}),children:[(0,U.jsx)(Q,{value:W.VJe,children:i.formatMessage({id:"quality.plan.type.onlineService"})}),(0,U.jsx)(Q,{value:W.tZS,children:i.formatMessage({id:"quality.plan.type.bot"})}),(0,U.jsx)(Q,{value:W.Drr,children:i.formatMessage({id:"quality.plan.type.callCenter"})}),(0,U.jsx)(Q,{value:W.Yo1,children:i.formatMessage({id:"quality.plan.type.ticket"})})]})}),(0,U.jsx)(Y.Z.Item,{name:"description",label:i.formatMessage({id:"quality.plan.description"}),children:(0,U.jsx)(G,{rows:3,placeholder:i.formatMessage({id:"quality.plan.description.tooltip"})})}),(0,U.jsx)(Y.Z.Item,{name:"enabled",label:i.formatMessage({id:"quality.plan.status"}),valuePropName:"checked",children:(0,U.jsx)(R.Z,{})})]})}),(0,U.jsxs)(O.Z,{title:(0,U.jsxs)(D.Z,{children:[i.formatMessage({id:"quality.plan.indicators"}),(0,U.jsxs)(K,{type:"secondary",children:["(",i.formatMessage({id:"quality.plan.totalScore"}),": ",(ee=(null==c?void 0:c.indicators)||[],ee.reduce((function(e,t){var a=t.indicatorScore||0;return e+(t.deduction?0:a)}),0)),")"]})]}),style:{marginBottom:16},children:[(0,U.jsx)("div",{style:{marginBottom:16,padding:"12px",backgroundColor:"#f5f5f5",borderRadius:"6px"},children:(0,U.jsxs)("div",{style:{fontSize:"13px",lineHeight:"1.5"},children:[(0,U.jsxs)("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:[i.formatMessage({id:"quality.plan.scoreExplanation"}),"："]}),(0,U.jsxs)("div",{style:{display:"flex",gap:"20px"},children:[(0,U.jsxs)("div",{children:[(0,U.jsxs)("span",{style:{color:"#52c41a",fontWeight:"bold"},children:[i.formatMessage({id:"quality.plan.positiveIndicator"}),"："]}),(0,U.jsx)("span",{style:{color:"#666"},children:i.formatMessage({id:"quality.plan.positiveIndicator.desc"})})]}),(0,U.jsxs)("div",{children:[(0,U.jsxs)("span",{style:{color:"#ff4d4f",fontWeight:"bold"},children:[i.formatMessage({id:"quality.plan.negativeIndicator"}),"："]}),(0,U.jsx)("span",{style:{color:"#666"},children:i.formatMessage({id:"quality.plan.negativeIndicator.desc"})})]})]})]})}),(0,U.jsx)(E.Z,{columns:te,dataSource:(null==c?void 0:c.indicators)||[],pagination:!1,size:"small",rowKey:function(e){return e.indicatorName||Math.random().toString()}}),(0,U.jsx)("div",{style:{marginTop:16},children:(0,U.jsx)(M.ZP,{type:"primary",icon:(0,U.jsx)(j.Z,{}),onClick:function(){b(null),_.resetFields(),y(!0)},children:i.formatMessage({id:"quality.plan.addIndicator"})})})]}),(0,U.jsx)(O.Z,{title:i.formatMessage({id:"quality.plan.evaluationCriteria"}),style:{marginBottom:16},children:(0,U.jsxs)("div",{style:{fontSize:"14px",lineHeight:"1.6"},children:[(0,U.jsx)("p",{children:(0,U.jsx)("strong",{children:"评估标准："})}),(0,U.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[(0,U.jsx)("li",{children:(0,U.jsx)("span",{style:{color:"#52c41a"},children:"优秀：90-100分"})}),(0,U.jsx)("li",{children:(0,U.jsx)("span",{style:{color:"#1890ff"},children:"良好：80-89分"})}),(0,U.jsx)("li",{children:(0,U.jsx)("span",{style:{color:"#faad14"},children:"合格：70-79分"})}),(0,U.jsx)("li",{children:(0,U.jsx)("span",{style:{color:"#ff4d4f"},children:"不合格：<70分"})})]}),(0,U.jsx)("p",{style:{marginTop:"12px",color:"#666",fontSize:"13px"},children:"这样的设计确保了质检体系的科学性和公平性，加分项统一为100分便于标准化评估，减分项则根据违规行为的严重程度给予相应的惩罚。"})]})})]}),(0,U.jsx)(q.Z,{title:v?i.formatMessage({id:"quality.plan.editIndicator"}):i.formatMessage({id:"quality.plan.addIndicator"}),open:f,onOk:function(){_.validateFields().then((function(e){if(c){var t,a={indicatorName:e.indicatorName,indicatorScore:e.indicatorScore||0,deduction:e.deduction||!1,mandatory:e.mandatory||!1,description:e.description};v&&S>=0?(t=F()(c.indicators||[]))[S]=a:t=[].concat(F()(c.indicators||[]),[a]);var n=o()(o()({},c),{},{indicators:t});d(n),y(!1),_.resetFields()}}))},onCancel:function(){y(!1),_.resetFields()},children:(0,U.jsxs)(Y.Z,{form:_,layout:"vertical",children:[(0,U.jsx)(Y.Z.Item,{name:"indicatorName",label:i.formatMessage({id:"quality.plan.indicatorName"}),rules:[{required:!0,message:i.formatMessage({id:"quality.plan.indicatorName.required"})}],children:(0,U.jsx)(A.Z,{placeholder:i.formatMessage({id:"quality.plan.indicatorName.required"})})}),(0,U.jsx)(Y.Z.Item,{name:"indicatorScore",label:i.formatMessage({id:"quality.plan.indicatorScore"}),rules:[{required:!0,message:i.formatMessage({id:"quality.plan.indicatorScore.required"})}],children:(0,U.jsx)(L.Z,{min:0,max:100,style:{width:"100%"}})}),(0,U.jsx)(Y.Z.Item,{name:"deduction",label:i.formatMessage({id:"quality.plan.deduction"}),valuePropName:"checked",children:(0,U.jsx)(R.Z,{})}),(0,U.jsx)(Y.Z.Item,{name:"mandatory",label:i.formatMessage({id:"quality.plan.mandatory"}),valuePropName:"checked",children:(0,U.jsx)(R.Z,{})}),(0,U.jsx)(Y.Z.Item,{name:"description",label:i.formatMessage({id:"quality.plan.indicatorDescription"}),children:(0,U.jsx)(G,{rows:3,placeholder:i.formatMessage({id:"quality.plan.indicatorDescription"})})})]})})]})},$=a(28977),ee=a.n($),te=a(31756),ae=["current","pageSize"],ne=function(){var e=(0,C.useIntl)(),t=(0,h.useRef)(),a=(0,h.useState)(!1),n=g()(a,2),i=n[0],l=n[1],c=(0,h.useState)(null),u=g()(c,2),f=u[0],m=u[1],z=(0,h.useState)([]),F=g()(z,2),P=F[0],A=F[1],N=(0,h.useState)([]),Y=g()(N,2),D=Y[0],B=Y[1],O=(0,X.u)((function(e){return e.currentOrg})),R=function(){var a=y()(p()().mark((function a(n){var r;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,T.ay)({uid:n.uid});case 3:200===a.sent.code?(null==t||null===(r=t.current)||void 0===r||r.reload(),te.yw.success(e.formatMessage({id:"quality.plan.delete.success"}))):te.yw.error(e.formatMessage({id:"quality.plan.delete.error"})),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),te.yw.error(e.formatMessage({id:"quality.plan.delete.error"})),console.error("Delete quality plan error:",a.t0);case 11:case"end":return a.stop()}}),a,null,[[0,7]])})));return function(e){return a.apply(this,arguments)}}(),E=function(){var a=y()(p()().mark((function a(){var n,r,i,s,l,o;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==D.length){a.next=3;break}return te.yw.warning(e.formatMessage({id:"quality.plan.batch.delete.noselection"})),a.abrupt("return");case 3:te.yw.loading(e.formatMessage({id:"quality.plan.deleting"})),r=0,i=0,s=d()(D),a.prev=7,s.s();case 9:if((l=s.n()).done){a.next=23;break}return o=l.value,a.prev=11,a.next=14,(0,T.ay)({uid:o.uid});case 14:200===a.sent.code?r++:i++,a.next=21;break;case 18:a.prev=18,a.t0=a.catch(11),i++;case 21:a.next=9;break;case 23:a.next=28;break;case 25:a.prev=25,a.t1=a.catch(7),s.e(a.t1);case 28:return a.prev=28,s.f(),a.finish(28);case 31:te.yw.destroy(),0===i?te.yw.success(e.formatMessage({id:"quality.plan.batch.delete.success"},{count:r})):te.yw.warning(e.formatMessage({id:"quality.plan.batch.delete.partial"},{success:r,fail:i})),A([]),B([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 36:case"end":return a.stop()}}),a,null,[[7,25,28,31],[11,18]])})));return function(){return a.apply(this,arguments)}}(),L=function(){var a=y()(p()().mark((function a(n){var r,i,s,l,c,u;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==D.length){a.next=3;break}return te.yw.warning(e.formatMessage({id:"quality.plan.batch.noselection"})),a.abrupt("return");case 3:te.yw.loading(n?e.formatMessage({id:"quality.plan.enabling"}):e.formatMessage({id:"quality.plan.disabling"})),i=0,s=0,l=d()(D),a.prev=7,l.s();case 9:if((c=l.n()).done){a.next=23;break}return u=c.value,a.prev=11,a.next=14,(0,T.eY)(o()(o()({},u),{},{enabled:n}));case 14:200===a.sent.code?i++:s++,a.next=21;break;case 18:a.prev=18,a.t0=a.catch(11),s++;case 21:a.next=9;break;case 23:a.next=28;break;case 25:a.prev=25,a.t1=a.catch(7),l.e(a.t1);case 28:return a.prev=28,l.f(),a.finish(28);case 31:te.yw.destroy(),0===s?te.yw.success(n?e.formatMessage({id:"quality.plan.batch.enable.success"},{count:i}):e.formatMessage({id:"quality.plan.batch.disable.success"},{count:i})):te.yw.warning(n?e.formatMessage({id:"quality.plan.batch.enable.partial"},{success:i,fail:s}):e.formatMessage({id:"quality.plan.batch.disable.partial"},{success:i,fail:s})),A([]),B([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return a.stop()}}),a,null,[[7,25,28,31],[11,18]])})));return function(e){return a.apply(this,arguments)}}(),H=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.name",defaultMessage:"方案名称"}),dataIndex:"name",key:"name",copyable:!0,fixed:"left",width:150,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"quality.plan.name.tooltip",defaultMessage:"质检方案的名称"})},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.description",defaultMessage:"描述"}),dataIndex:"description",key:"description",width:200,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"quality.plan.description.tooltip",defaultMessage:"质检方案的描述信息"})},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.type",defaultMessage:"类型"}),dataIndex:"type",key:"type",width:120,tooltip:e.formatMessage({id:"quality.plan.type.tooltip",defaultMessage:"质检方案的类型"}),valueEnum:s()(s()(s()(s()({},W.VJe,{text:e.formatMessage({id:"quality.plan.type.onlineService"}),status:"Processing"}),W.tZS,{text:e.formatMessage({id:"quality.plan.type.bot"}),status:"Success"}),W.Drr,{text:e.formatMessage({id:"quality.plan.type.callCenter"}),status:"Warning"}),W.Yo1,{text:e.formatMessage({id:"quality.plan.type.ticket"}),status:"Default"}),render:function(t){var a="blue",n=t;switch(t){case W.VJe:n=e.formatMessage({id:"quality.plan.type.onlineService"}),a="blue";break;case W.tZS:n=e.formatMessage({id:"quality.plan.type.bot"}),a="green";break;case W.Drr:n=e.formatMessage({id:"quality.plan.type.callCenter"}),a="orange";break;case W.Yo1:n=e.formatMessage({id:"quality.plan.type.ticket"}),a="purple";break;default:n=t||e.formatMessage({id:"quality.plan.type.onlineService"}),a="blue"}return(0,U.jsx)(x.Z,{color:a,children:n})}},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.indicatorsCount",defaultMessage:"质检指标数量"}),key:"indicatorsCount",width:120,hideInSearch:!0,tooltip:e.formatMessage({id:"quality.plan.indicatorsCount.tooltip",defaultMessage:"质检方案包含的指标数量"}),render:function(e,t){var a;return(0,U.jsx)("span",{children:(null===(a=t.indicators)||void 0===a?void 0:a.length)||0})}},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",width:100,hideInSearch:!0,tooltip:e.formatMessage({id:"quality.plan.status.tooltip",defaultMessage:"质检方案是否启用"}),valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}}},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",key:"createdAt",width:180,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"quality.plan.createdAt.tooltip",defaultMessage:"质检方案创建时间"}),render:function(e,t){return t.createdAt?ee()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,U.jsx)(C.FormattedMessage,{id:"quality.plan.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",key:"updatedAt",width:180,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"quality.plan.updatedAt.tooltip",defaultMessage:"质检方案最后更新时间"}),render:function(e,t){return t.updatedAt?ee()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(t,a,n,r){return[(0,U.jsx)("a",{onClick:function(){J(a)},children:e.formatMessage({id:"edit"})},"editable"),(0,U.jsx)("a",{onClick:function(){V(a)},children:e.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,U.jsx)(v.Z,{title:e.formatMessage({id:"deleteTip"}),description:e.formatMessage({id:"quality.plan.delete.confirm"},{name:null==a?void 0:a.name}),onConfirm:function(){return R(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,U.jsx)(M.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}],J=function(e){m(e),l(!0)},V=function(e){var t=o()(o()({},e),{},{uid:void 0,name:"".concat(e.name,"_副本")});m(t),l(!0)},K=function(){m(null),l(!0)},G=function(){var a=y()(p()().mark((function a(n){var r,i,s,o;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!n.uid){a.next=9;break}return te.yw.loading(e.formatMessage({id:"quality.plan.updating"})),a.next=5,(0,T.eY)(n);case 5:200===(r=a.sent).code?(te.yw.destroy(),te.yw.success(e.formatMessage({id:"quality.plan.update.success"})),l(!1),null===(i=t.current)||void 0===i||i.reloadAndRest()):(te.yw.destroy(),te.yw.error(r.message||e.formatMessage({id:"quality.plan.update.error"}))),a.next=14;break;case 9:return te.yw.loading(e.formatMessage({id:"quality.plan.creating"})),a.next=12,(0,T.LX)(n);case 12:200===(s=a.sent).code?(te.yw.destroy(),te.yw.success(e.formatMessage({id:"quality.plan.create.success"})),l(!1),null===(o=t.current)||void 0===o||o.reloadAndRest()):(te.yw.destroy(),te.yw.error(s.message||e.formatMessage({id:"quality.plan.create.error"})));case 14:a.next=21;break;case 16:a.prev=16,a.t0=a.catch(0),te.yw.destroy(),te.yw.error(e.formatMessage({id:"quality.plan.save.error"})),console.error("Save quality plan error:",a.t0);case 21:case"end":return a.stop()}}),a,null,[[0,16]])})));return function(e){return a.apply(this,arguments)}}(),Q={selectedRowKeys:P,onChange:function(e,t){A(e),B(t)}},$=function(){var t=y()(p()().mark((function t(a,n,i){var s,l,c,d,u,f,y,m;return p()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",a,n,i),te.yw.loading(e.formatMessage({id:"quality.plan.loading"})),s=a.current,l=a.pageSize,c=r()(a,ae),d=void 0,u=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],d=f,u="ascend"===n[f]?"ascend":"descend"),y=o()(o()({pageNumber:s-1,pageSize:l},c),{},{sortBy:d,sortDirection:u,orgUid:null==O?void 0:O.uid}),t.prev=7,t.next=10,(0,T.T)(y);case 10:if(m=t.sent,console.log("queryQualityPlansByOrg response:",m.data,y),te.yw.destroy(),200!==m.code||!m.data){t.next=17;break}return t.abrupt("return",{data:m.data.content||[],success:!0,total:m.data.totalElements||0});case 17:return te.yw.error(m.message||e.formatMessage({id:"quality.plan.fetch.error"})),t.abrupt("return",{data:[],success:!1,total:0});case 19:t.next=27;break;case 21:return t.prev=21,t.t0=t.catch(7),te.yw.destroy(),te.yw.error(e.formatMessage({id:"quality.plan.fetch.error"})),console.error("Fetch quality plans error:",t.t0),t.abrupt("return",{data:[],success:!1,total:0});case 27:case"end":return t.stop()}}),t,null,[[7,21]])})));return function(e,a,n){return t.apply(this,arguments)}}();return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(I.Z,{columns:H,actionRef:t,cardBordered:!0,rowSelection:Q,request:$,scroll:{x:1200},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10},dateFormatter:"string",headerTitle:e.formatMessage({id:"quality.plan.management"}),toolBarRender:function(){return function(){var t=[];t.push((0,U.jsx)(M.ZP,{icon:(0,U.jsx)(j.Z,{}),type:"primary",onClick:K,children:e.formatMessage({id:"quality.plan.create"})},"create"));var a=[];return P.length>0&&a.push({key:"batchDelete",icon:(0,U.jsx)(w.Z,{}),danger:!0,label:e.formatMessage({id:"quality.plan.batch.delete"})+" (".concat(P.length,")"),onClick:function(){q.Z.confirm({title:e.formatMessage({id:"deleteTip"}),content:e.formatMessage({id:"quality.plan.batch.delete.confirm"},{count:P.length}),onOk:E,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,U.jsx)(k.Z,{}),label:e.formatMessage({id:"quality.plan.batch.enable"})+" (".concat(P.length,")"),onClick:function(){return L(!0)}},{key:"batchDisable",icon:(0,U.jsx)(Z.Z,{}),label:e.formatMessage({id:"quality.plan.batch.disable"})+" (".concat(P.length,")"),onClick:function(){return L(!1)}}),a.length>0&&t.push((0,U.jsx)(b.Z,{menu:{items:a},placement:"bottom",children:(0,U.jsxs)(M.ZP,{type:P.length>0?"primary":"default",danger:P.length>0,children:[P.length>0?e.formatMessage({id:"quality.plan.batch.operations"})+" (".concat(P.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,U.jsx)(S.Z,{})]})},"batchOperations")),t}()}}),(0,U.jsx)(_,{open:i,onClose:function(){return l(!1)},onSave:G,initialPlan:f})]})}}}]);