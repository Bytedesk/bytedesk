"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2575],{25197:function(e,t,s){var a=s(90819),n=s.n(a),r=s(73193),o=s.n(r),l=s(89933),i=s.n(l),d=s(45332),u=s.n(d),c=s(44194),f=s(41196),g=s(86895),m=s(32525),p=s(66431),h=s(14906),v=s(19433),M=s(88894),b=s(31549);t.Z=function(e){var t=e.open,s=e.onOpenChange,a=e.orgUid,r=e.record,l=e.onSuccess,d=(0,h.useIntl)(),x=f.Z.useForm(),j=u()(x,1)[0];(0,c.useEffect)((function(){var e,s;t&&(r?j.setFieldsValue({name:r.name||"",description:r.description||"",enabled:null===(e=r.enabled)||void 0===e||e,isDefault:null!==(s=r.isDefault)&&void 0!==s&&s}):(j.resetFields(),j.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,r,j]);var k=function(){var e=i()(n()().mark((function e(){var t,i,u;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.validateFields();case 3:if(t=e.sent,i=o()(o()({},t),{},{orgUid:a,uid:null==r?void 0:r.uid}),null==r||!r.uid){e.next=11;break}return e.next=8,(0,M.sK)(i);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,M.ZJ)(i);case 13:e.t0=e.sent;case 14:(u=e.t0)&&200===u.code?(v.yw.success(d.formatMessage({id:null!=r&&r.uid?"common.updated":"common.created",defaultMessage:null!=r&&r.uid?"更新成功":"创建成功"})),null==l||l(),s(!1)):v.yw.error((null==u?void 0:u.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(g.Z,{title:(0,b.jsx)(h.FormattedMessage,{id:null!=r&&r.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=r&&r.uid?"编辑模板":"新建模板"}),open:t,onOk:k,onCancel:function(){return s(!1)},okText:(0,b.jsx)(h.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,b.jsx)(h.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,b.jsxs)(f.Z,{form:j,layout:"vertical",preserve:!1,children:[(0,b.jsx)(f.Z.Item,{name:"name",label:(0,b.jsx)(h.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:d.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,b.jsx)(m.Z,{placeholder:d.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,b.jsx)(f.Z.Item,{name:"description",label:(0,b.jsx)(h.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(m.Z.TextArea,{rows:3,placeholder:d.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,b.jsx)(f.Z.Item,{name:"enabled",label:(0,b.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,b.jsx)(p.Z,{})})]})})}},52575:function(e,t,s){var a=s(90819),n=s.n(a),r=s(89933),o=s.n(r),l=s(45332),i=s.n(l),d=s(98830),u=s(39497),c=s(25784),f=s(89965),g=s(2250),m=s(14906),p=s(86895),h=s(41196),v=s(33797),M=s(82770),b=s(44194),x=s(88894),j=s(25197),k=s(10162),Z=s(2011),y=s(59908),F=s(31549);t.Z=function(e){var t=e.open,s=e.onClose,a=e.onSubmit,r=(0,m.useIntl)(),l=c.A.useForm(),w=i()(l,1)[0],S=(0,d.u)((function(e){return e.currentOrg})),C=(0,b.useState)(!1),U=i()(C,2),O=U[0],q=U[1],P=(0,b.useState)(!1),T=i()(P,2),E=T[0],R=T[1],V=(0,b.useState)(0),A=i()(V,2),I=A[0],N=A[1],D=(0,b.useState)([]),z=i()(D,2),G=z[0],W=z[1],B=(0,b.useState)(""),Q=i()(B,2),_=Q[0],H=Q[1],J=(0,b.useCallback)(function(){var e=o()(n()().mark((function e(t){var s,a,r,o;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(!0),e.prev=1,a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==S?void 0:S.uid,searchText:t||""},e.next=5,(0,x.VW)(a);case 5:return r=e.sent,console.log("queryRobotSettingsByOrg response:",r,a),o=(null==r||null===(s=r.data)||void 0===s?void 0:s.content)||[],W(o),!w.getFieldValue("settingsUid")&&o.length>0&&w.setFieldsValue({settingsUid:o[0].uid}),e.abrupt("return",o.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,R(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==S?void 0:S.uid,w]),K=function(){console.log("handleSaveRobot"),w.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==S?void 0:S.uid,avatar:e.avatar||_};console.log("robotObject:",t),a(t),w.resetFields(),H("")})).catch((function(e){console.log("Form errors:",e)}))};(0,b.useEffect)((function(){console.log("RobotForm useEffect"),t&&(w.resetFields(),w.setFieldsValue({type:u.f4h}),H(""))}),[t,w]);var L=function(){var e=o()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),H(t),w.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,F.jsx)("div",{children:(0,F.jsxs)(p.Z,{title:r.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:r.formatMessage({id:"save",defaultMessage:"Save"}),onOk:K,onCancel:function(){w.resetFields(),s()},children:[(0,F.jsxs)(c.A,{form:w,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,F.jsx)(h.Z.Item,{name:"avatarUpload",label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,F.jsxs)(Z.G,{onSuccess:L,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,F.jsx)(v.Z,{src:_}),(0,F.jsx)(M.ZP,{icon:(0,F.jsx)(y.Z,{}),style:{marginLeft:12},children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,F.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,F.jsx)(g.Z,{label:r.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:r.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],placeholder:r.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:I},request:function(){var e=o()(n()().mark((function e(t){var s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.keyWords,e.abrupt("return",J(s));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:E,notFoundContent:0===G.length?(0,F.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,F.jsx)("div",{style:{marginBottom:8,color:"#999"},children:r.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,F.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,F.jsx)(k.Z,{}),onClick:function(){return q(!0)},children:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,F.jsx)(M.ZP,{size:"small",icon:(0,F.jsx)(k.Z,{}),onClick:function(){return q(!0)},title:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:r.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,F.jsx)(f.Z,{label:r.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:r.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return K()}}}),(0,F.jsx)(g.Z,{label:r.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:r.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:r.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb,disabled:!0},{label:r.formatMessage({id:u.wG_,defaultMessage:"Marketing"}),value:u.wG_,disabled:!0}],rules:[{required:!0,message:r.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:r.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,F.jsx)(j.Z,{open:O,onOpenChange:q,orgUid:(null==S?void 0:S.uid)||"",record:null,onSuccess:function(){q(!1),N((function(e){return e+1}))}})]})})}}}]);