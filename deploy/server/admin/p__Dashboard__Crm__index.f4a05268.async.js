"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5230],{3591:function(e,t,s){s.r(t),s.d(t,{default:function(){return ne}});var a=s(76711),r=s.n(a),n=s(45332),i=s.n(n),o=s(44194),d=s(73120),c=s(5861),l=s(315),u=s(60904),m=s(84176),f=s.n(m),g=s(73193),p=s.n(g),x=s(90819),M=s.n(x),h=s(89933),j=s.n(h),v=s(5286),y=s(25709),b=s(36265);function k(e){return w.apply(this,arguments)}function w(){return(w=j()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/query/org",{method:"GET",params:p()(p()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return F.apply(this,arguments)}function F(){return(F=j()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/create",{method:"POST",data:p()(p()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=j()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/update",{method:"POST",data:p()(p()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=j()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/customer/delete",{method:"POST",data:p()(p()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=s(71865),U=s(87523),P=s(83381),O=s(43837),T=s(41881),E=s(91768),q=s(28031),z=s(6992),J=s(80503),N=s(31362),R=s(76185),D=s(20921),X=s(2157),Y=s(95330),K=s(96596),G=s.n(K),H=s(40845),L=s(44565),Q=s(60857),V=s(37351),W=s(19095),$=s(31549),_=function(e){var t=e.isEdit,s=e.customer,a=e.open,r=e.onClose,n=e.onSubmit,d=(0,c.useIntl)(),l=H.A.useForm(),u=i()(l,1)[0],m=V.Z.Text;(0,o.useEffect)((function(){a&&(t&&s?u.setFieldsValue({nickname:s.nickname||"",email:s.email||"",mobile:s.mobile||"",description:s.description||"",notes:s.notes||"",extra:s.extra||"",channel:s.channel||""}):u.resetFields())}),[a,t,s,u]);var f=t?d.formatMessage({id:"customer.edit",defaultMessage:"编辑客户"}):d.formatMessage({id:"customer.create",defaultMessage:"新增客户"}),g=s&&!t,x=g?null:(0,$.jsxs)(R.Z,{children:[(0,$.jsx)(X.ZP,{onClick:r,children:(0,$.jsx)(c.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,$.jsx)(X.ZP,{type:"primary",onClick:function(){u.validateFields().then((function(e){var a=p()(p()({},e),t&&s?{uid:s.uid}:{});n(a)}))},children:(0,$.jsx)(c.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,$.jsx)($.Fragment,{children:(0,$.jsx)(W.Z,{title:f,onClose:r,open:a,width:500,extra:x,children:g&&s?(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",s.nickname||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),":"]})," ",s.email||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"手机"}),":"]})," ",s.mobile||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"描述"}),":"]})," ",s.description||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"notes",defaultMessage:"备注"}),":"]})," ",s.notes||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"extra",defaultMessage:"额外信息"}),":"]})," ",s.extra||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",s.createdAt||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(m,{strong:!0,children:[(0,$.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",s.updatedAt||"-"]})]}):(0,$.jsxs)(H.A,{form:u,name:"customerForm",submitter:!1,children:[(0,$.jsx)(L.Z,{name:"nickname",label:(0,$.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:"请输入客户昵称"}]}),(0,$.jsx)(L.Z,{name:"email",label:(0,$.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}]}),(0,$.jsx)(L.Z,{name:"mobile",label:(0,$.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"手机"})}),(0,$.jsx)(Q.Z,{name:"description",label:(0,$.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"描述"})}),(0,$.jsx)(Q.Z,{name:"notes",label:(0,$.jsx)(c.FormattedMessage,{id:"notes",defaultMessage:"备注"})}),(0,$.jsx)(Q.Z,{name:"extra",label:(0,$.jsx)(c.FormattedMessage,{id:"extra",defaultMessage:"额外信息"})})]})})})},ee=["current","pageSize"],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,$.jsx)(c.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,$.jsx)(c.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,$.jsx)(c.FormattedMessage,{id:"customer.nickname.tooltip"})},{title:(0,$.jsx)(c.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",hideInSearch:!0,tooltip:(0,$.jsx)(c.FormattedMessage,{id:"customer.email.tooltip"})},{title:(0,$.jsx)(c.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",copyable:!0,tooltip:(0,$.jsx)(c.FormattedMessage,{id:"customer.mobile.tooltip"})},{title:(0,$.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,tooltip:(0,$.jsx)(c.FormattedMessage,{id:"customer.description.tooltip"})},{title:(0,$.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,$.jsx)(c.FormattedMessage,{id:"customer.createdAt.tooltip"}),render:function(e,t,s,a){return G()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],se=function(e){e.superUser;var t=(0,c.useIntl)(),s=(0,o.useRef)(),a=(0,o.useState)(1),r=i()(a,2),n=r[0],d=r[1],l=(0,o.useState)(10),u=i()(l,2),m=u[0],g=u[1],x=(0,B.u)((function(e){return e.currentOrg})),h=(0,o.useState)({}),w=i()(h,2),F=w[0],C=w[1],A=(0,o.useState)(0),K=i()(A,2),G=K[0],H=K[1],L=(0,o.useState)([]),Q=i()(L,2),V=Q[0],W=Q[1],se=(0,o.useState)([]),ae=i()(se,2),re=(ae[0],ae[1]),ne=(0,o.useState)(!1),ie=i()(ne,2),oe=ie[0],de=ie[1],ce=(0,o.useState)(!1),le=i()(ce,2),ue=le[0],me=le[1],fe=(0,o.useState)(),ge=i()(fe,2),pe=ge[0],xe=ge[1],Me=function(){var e=j()(M()().mark((function e(a){var r,n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ue||!pe){e.next=7;break}return e.next=4,S(p()(p()({},a),{},{uid:pe.uid,orgUid:null==x?void 0:x.uid}));case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,Z(p()(p()({},a),{},{orgUid:null==x?void 0:x.uid}));case 9:r=e.sent;case 10:200===r.code?(v.yw.success(ue?t.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):t.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),de(!1),null===(n=s.current)||void 0===n||n.reload()):v.yw.error(r.message||t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),v.yw.error(t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),he=function(){xe(void 0),me(!1),de(!0)},je=[].concat(te,[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,a){return(0,$.jsxs)(R.Z,{children:[(0,$.jsx)(D.Z,{title:t.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,$.jsx)(X.ZP,{type:"text",icon:(0,$.jsx)(O.Z,{}),onClick:function(){return function(e){xe(e),me(!1),de(!0)}(a)}})}),(0,$.jsx)(D.Z,{title:t.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,$.jsx)(X.ZP,{type:"text",icon:(0,$.jsx)(T.Z,{}),onClick:function(){return function(e){xe(e),me(!0),de(!0)}(a)}})}),(0,$.jsx)(D.Z,{title:t.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,$.jsx)(X.ZP,{type:"text",danger:!0,icon:(0,$.jsx)(E.Z,{}),onClick:function(){return function(e){var a;y.Z.confirm({title:t.formatMessage({id:"customer.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,$.jsx)(P.Z,{}),content:t.formatMessage({id:"customer.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(a=j()(M()().mark((function a(){var r,n;return M()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,I({uid:e.uid,orgUid:null==x?void 0:x.uid});case 3:200===(r=a.sent).code?(v.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=s.current)||void 0===n||n.reload()):v.yw.error(r.message||t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),a.next=11;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("删除客户出错:",a.t0),v.yw.error(t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return a.stop()}}),a,null,[[0,7]])}))),function(){return a.apply(this,arguments)})})}(a)}})})]})}}]),ve=function(){var e=j()(M()().mark((function e(t,s,a){var r,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,s,a),r=localStorage.getItem(b.LA8),i=p()({orgUid:(null==x?void 0:x.uid)||"",accessToken:r||"",exportType:t},F),"current"===t?(i.pageNumber=String(n-1),i.pageSize=String(m)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==s&&void 0!==a&&(i.pageNumber=String(s),i.pageSize=String(a)),window.open((0,U.kG)()+"/api/v1/customer/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],s=1e3,a=Math.ceil(e/s),r=function(){var a=n,r=n*s+1,i=Math.min((n+1)*s,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(i," (").concat(i-r+1,"条)"),onClick:function(){return ve("range",a,s)}})},n=0;n<a;n++)r();return t},be={selectedRowKeys:V,onChange:function(e,t){W(e),re(t)}};return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(N.Z,{columns:je,actionRef:s,cardBordered:!0,rowSelection:be,scroll:{x:1300},request:function(){var e=j()(M()().mark((function e(t,s,a){var r,n,i,o,c,l,u,m;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,i=f()(t,ee),d(r),g(n),C(i),o=void 0,c=void 0,s&&Object.keys(s).length>0&&(l=Object.keys(s)[0],o=l,c="ascend"===s[l]?"ascend":"descend"),u=p()(p()({pageNumber:r-1,pageSize:n,orgUid:null==x?void 0:x.uid},i),{},{sortBy:o,sortDirection:c}),e.next=10,k(u);case 10:return m=e.sent,console.log("queryCustomersByOrg response:",m,u),200===m.code?H(null==m?void 0:m.data.totalElements):v.yw.error(m.message),e.abrupt("return",{data:null==m?void 0:m.data.content,success:!0,total:null==m?void 0:m.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){d(e),g(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"客户列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,$.jsx)(q.Z,{}),label:t.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}],G>0&&(G<=1e3?e.push({key:"export-all",icon:(0,$.jsx)(q.Z,{}),label:t.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return ve("all")}}):e.push({key:"export-range",icon:(0,$.jsx)(q.Z,{}),label:t.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ye(G)})),[(0,$.jsx)(X.ZP,{type:"primary",icon:(0,$.jsx)(z.Z,{}),onClick:he,children:t.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,$.jsx)(Y.Z,{menu:{items:e},placement:"bottom",children:(0,$.jsxs)(X.ZP,{type:"primary",icon:(0,$.jsx)(q.Z,{}),children:[t.formatMessage({id:"export",defaultMessage:"导出"}),(0,$.jsx)(J.Z,{})]})},"exportOperations")];var e}}),(0,$.jsx)(_,{isEdit:ue,customer:pe,open:oe,onClose:function(){return de(!1)},onSubmit:Me})]})},ae=s(85654),re=s(33935),ne=function(){var e=(0,c.useIntl)(),t=(0,o.useState)("visitor"),s=i()(t,2),a=s[0],n=s[1],m=(0,o.useMemo)((function(){var t=[{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,$.jsx)(l.Z,{superUser:!1})},{key:"customer",label:e.formatMessage({id:"customer"}),children:(0,$.jsx)(se,{superUser:!1})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,$.jsx)(u.Z,{superUser:!1})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,$.jsx)(ae.Z,{superUser:!1})}];return(0,U.OJ)()&&t.splice(2,0,{key:"blackIp",label:e.formatMessage({id:"visitor.tab.blackIp"}),children:(0,$.jsx)(re.Z,{superUser:!1})}),t}),[e]),f=(0,o.useMemo)((function(){return[]}),[]),g=(0,o.useMemo)((function(){return[].concat(r()(m),r()(f))}),[m,f]);return(0,$.jsx)(d.Z,{items:g,activeKey:a,onChange:n,style:{margin:10}})}}}]);