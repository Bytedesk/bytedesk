"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{7704:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return h},t5:function(){return m},v_:function(){return f}});var r=n(90819),s=n.n(r),a=n(73193),o=n.n(a),i=n(89933),u=n.n(i),l=n(39497),d=n(14906);function c(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},75112:function(e,t,n){var r=n(14597);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},93455:function(e,t,n){n.r(t),n.d(t,{default:function(){return ye}});var r=n(44194),s=n(67738),a=n(14906),o=n(76711),i=n.n(o),u=n(73193),l=n.n(u),d=n(90819),c=n.n(d),g=n(89933),f=n.n(g),p=n(45332),m=n.n(p),v=n(77033),h=n(82770),x=n(32525),k=n(50716),w=n(92354),M=n(39487),b=n(81739),y=n(66431),S=n(63649),j=n(10162),C=n(59304),Z=n(54881),F=n(49764),R=n(19433),T=n(43167),U=n(98830),P=n(75112),I=n(14597),W=n(39497),q=n(99665),A=n(66547),D=(n(84262),n(94212),n(24479),n(90631)),L=n(1460),O=n(41196),E=n(86895),z=n(31549),N=function(e){var t=e.open,n=e.onOpenChange,s=e.orgUid,o=e.record,i=e.onSuccess,u=(0,a.useIntl)(),d=O.Z.useForm(),g=m()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(o?g.setFieldsValue({name:o.name||"",description:o.description||"",enabled:null===(e=o.enabled)||void 0===e||e,isDefault:null!==(n=o.isDefault)&&void 0!==n&&n}):(g.resetFields(),g.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,o,g]);var p=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(t=e.sent,r=l()(l()({},t),{},{orgUid:s,uid:null==o?void 0:o.uid}),null==o||!o.uid){e.next=11;break}return e.next=8,(0,T.Y2)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,T.jT)(r);case 13:e.t0=e.sent;case 14:(a=e.t0)&&200===a.code?(R.yw.success(u.formatMessage({id:null!=o&&o.uid?"common.updated":"common.created",defaultMessage:null!=o&&o.uid?"更新成功":"创建成功"})),null==i||i(),n(!1)):R.yw.error((null==a?void 0:a.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving workgroup settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)(E.Z,{title:(0,z.jsx)(a.FormattedMessage,{id:null!=o&&o.uid?"workgroup.settings.template.edit":"workgroup.settings.template.create",defaultMessage:null!=o&&o.uid?"编辑模板":"新建模板"}),open:t,onOk:p,onCancel:function(){return n(!1)},okText:(0,z.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,z.jsx)(a.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,z.jsxs)(O.Z,{form:g,layout:"vertical",preserve:!1,children:[(0,z.jsx)(O.Z.Item,{name:"name",label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:u.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,z.jsx)(x.Z,{placeholder:u.formatMessage({id:"workgroup.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,z.jsx)(O.Z.Item,{name:"description",label:(0,z.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,z.jsx)(x.Z.TextArea,{rows:3,placeholder:u.formatMessage({id:"workgroup.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,z.jsx)(O.Z.Item,{name:"enabled",label:(0,z.jsx)(a.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,z.jsx)(y.Z,{})})]})})},V=n(27153),B=n(91361),J=n(25784),H=n(10434),X=n(78622),Q=n(59216),G=n(2250),K=n(96596),_=n.n(K);function Y(e){return $.apply(this,arguments)}function $(){return($=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/create",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/update",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/delete",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se=n(75580),ae="HH:mm:ss",oe=function(e){var t=e.type,n=J.A.useForm(),s=m()(n,1)[0],a=(0,r.useRef)(!1),o=(0,r.useRef)(),u=(0,q.z)((function(e){return{currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),d=u.currentAgentSettings,g=u.currentWorkgroupSettings,p=u.setCurrentAgentSettings,v=u.setCurrentWorkgroupSettings,h=(0,r.useState)([]),x=m()(h,2),k=x[0],w=x[1],M=(0,U.u)((function(e){return e.currentOrg})),b=(0,B.Z)().translateString,y=(0,r.useState)([]),S=m()(y,2),j=S[0],C=S[1];(0,r.useEffect)((function(){if(t===W.Njn){var e=d,n=(null==e?void 0:e.draftMessageLeaveSettings)||(null==e?void 0:e.messageLeaveSettings);C((null==n?void 0:n.worktimes)||[])}else if(t===W.aZD){var r,a=(null==g?void 0:g.draftMessageLeaveSettings)||(null==g?void 0:g.messageLeaveSettings);C((null==a?void 0:a.worktimes)||[]);var o=(null==g?void 0:g.draftRobotRoutingSettings)||(null==g?void 0:g.robotRoutingSettings);s.setFieldValue("defaultRobot",null==o?void 0:o.defaultRobot),s.setFieldValue("offlineRobot",null==o?void 0:o.offlineRobot),s.setFieldValue("nonWorktimeRobot",null==o?void 0:o.nonWorktimeRobot),s.setFieldValue("robotUid",(null==o||null===(r=o.robot)||void 0===r?void 0:r.uid)||(null==o?void 0:o.robotUid))}}),[t,d,g]);var Z=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.current){e.next=3;break}return console.log("isLoading: 1",a.current),e.abrupt("return");case 3:return a.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:W.f4h,orgUid:null==M?void 0:M.uid},e.next=8,(0,se.p0)(t);case 8:n=e.sent,console.log("queryRobotsByOrg: ",n),200===n.code?w(null===(r=n.data)||void 0===r?void 0:r.content):R.yw.error(n.message),a.current=!1,R.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){Z()}),[]);var F,T,P=function(e){if(g){var t=g.robotRoutingSettings||{},n=g.draftRobotRoutingSettings||{};v(l()(l()({},g),{},{robotRoutingSettings:l()(l()({},t),e),draftRobotRoutingSettings:l()(l()({},n),e)}))}},I=function(){var e=[];return j.forEach((function(t){e.push({worktime:[_()(t.startTime,ae),_()(t.endTime,ae)]})})),e},A=function(){var e=f()(c()().mark((function e(t,n,r){var s,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onWorktimeChange:",r,n),a={uid:null===(s=j[r])||void 0===s?void 0:s.uid,startTime:n[0],endTime:n[1]},e.next=4,ee(a);case 4:o=e.sent,console.log("updateWorktime response:",o),200===o.code||R.yw.error(o.message);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createWorktime"),t={startTime:"00:00:00",endTime:"23:59:59"},e.next=4,Y(t);case 4:n=e.sent,console.log("createWorktime response:",n),200===n.code?C([].concat(i()(j),[n.data])):R.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteWorktime:",t,null===(n=j[t])||void 0===n?void 0:n.uid),s={uid:null===(r=j[t])||void 0===r?void 0:r.uid},e.next=4,ne(s);case 4:a=e.sent,console.log("deleteWorktime response:",a),200===a.code?C(j.filter((function(e,n){return n!==t}))):R.yw.error(a.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){console.log("worktimes:",j),s.setFieldValue("worktimes",I()),function(){var e=j.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);if(t===W.Njn&&d){var n=d.messageLeaveSettings||{},r=d.draftMessageLeaveSettings||{};p(l()(l()({},d),{},{messageLeaveSettings:l()(l()({},n),{},{worktimeUids:e}),draftMessageLeaveSettings:l()(l()({},r),{},{worktimeUids:e})}))}else if(t===W.aZD&&g){var s=g.messageLeaveSettings||{},a=g.draftMessageLeaveSettings||{};v(l()(l()({},g),{},{messageLeaveSettings:l()(l()({},s),{},{worktimeUids:e}),draftMessageLeaveSettings:l()(l()({},a),{},{worktimeUids:e})}))}}()}),[j]),(0,z.jsx)(z.Fragment,{children:(0,z.jsxs)(J.A,{form:s,style:{marginLeft:"20px"},submitter:!1,children:[t===W.aZD&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(H.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:function(e){var t;return P({defaultRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),(0,z.jsx)(H.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:function(e){var t;return P({offlineRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),(0,z.jsx)(H.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:function(e){var t;return P({nonWorktimeRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}})]}),(0,z.jsx)(X.u,{name:"worktimes",style:{marginBlockEnd:0,width:"300px"},label:"工作时间区间，支持多个",creatorRecord:{worktime:[_()("00:00:00",ae),_()("23:59:59",ae)]},initialValue:I(),creatorButtonProps:{creatorButtonText:"添加",icon:!1,style:{width:"unset"}},copyIconProps:!1,deleteIconProps:{tooltipText:"删除"},itemRender:function(e){var t=e.listDom,n=e.action;return(0,z.jsxs)("div",{style:{display:"inline-flex",marginInlineEnd:25},children:[t,n]})},min:1,max:4,actionRef:o,actionGuard:{beforeAddRow:(T=f()(c()().mark((function e(t,n,r){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeAddRow:",t,n),e.next=3,D();case 3:return e.abrupt("return",new Promise((function(e){e(!0)})));case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return T.apply(this,arguments)}),beforeRemoveRow:(F=f()(c()().mark((function e(t,n){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeRemoveRow:",t),r=Array.isArray(t)?t[0]:t,e.next=4,L(r);case 4:return e.abrupt("return",new Promise((function(e){e(0!==t)})));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return F.apply(this,arguments)})},children:function(e,t,n){return(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(Q.Z.RangePicker,{width:"md",name:"worktime",fieldProps:{onChange:function(e,n){A(e,n,t)},format:ae}},"worktime")})}}),t===W.aZD&&(0,z.jsx)(G.Z,{name:"robotUid",label:"客服机器人",width:"md",options:k.map((function(e){return{value:e.uid,label:b(e.nickname)}})),fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){P({robotUid:null!=e?e:void 0})}}})]})})},ie=n(49906),ue=function(){var e=O.Z.useForm(),t=m()(e,1)[0],n=(0,a.useIntl)(),s=(0,q.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),o=s.currentWorkgroupSettings,i=s.setCurrentWorkgroupSettings,u=(0,r.useState)(W.vXk),d=m()(u,2),c=d[0],g=d[1];(0,r.useEffect)((function(){if(o){var e=o;g(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[o]);return(0,z.jsx)("div",{children:(0,z.jsxs)(J.A,{form:t,submitter:!1,children:[(0,z.jsx)(ie.Z.Group,{name:"routingMode",label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:W.vXk},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:W.ZD$},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:W.owQ},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:W.e2F},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:W.zWk},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:W.HQF},{label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:W.WDq}],fieldProps:{value:c,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),g(e.target.value)}(e),t=e.target.value,o&&i(l()(l()({},o),{},{routingMode:t}))}}}),(0,z.jsxs)(J.A.Item,{children:[c===W.vXk&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),c===W.ZD$&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),c===W.owQ&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),c===W.e2F&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),c===W.zWk&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),c===W.HQF&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),c===W.JEC&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),c===W.WDq&&(0,z.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},le="tips",de=function(){var e=(0,a.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,P.Z)().leftSiderStyle,o=(0,I.Z)().isDarkMode,u=(0,r.useState)(!1),d=m()(u,2),g=d[0],p=d[1],O=(0,r.useState)([]),E=m()(O,2),B=E[0],J=E[1],H=(0,r.useState)(),X=m()(H,2),Q=X[0],G=X[1],K=(0,r.useState)(""),_=m()(K,2),Y=_[0],$=_[1],ee=(0,r.useState)(le),te=m()(ee,2),ne=te[0],re=te[1],se=(0,r.useState)(!1),ae=m()(se,2),ie=ae[0],de=ae[1],ce=(0,r.useState)(null),ge=m()(ce,2),fe=ge[0],pe=ge[1],me=(0,r.useMemo)((function(){return B.find((function(e){return e.uid===Q}))||null}),[B,Q]),ve=(0,r.useState)(!1),he=m()(ve,2),xe=he[0],ke=he[1],we=(0,r.useState)(!1),Me=m()(we,2),be=Me[0],ye=Me[1],Se=(0,r.useState)(!1),je=m()(Se,2),Ce=je[0],Ze=je[1],Fe=(0,r.useRef)(""),Re=(0,q.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Te=Re.setCurrentWorkgroupSettings,Ue=Re.currentWorkgroupSettings,Pe=(0,r.useMemo)((function(){if(!Y)return B;var e=Y.toLowerCase();return B.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[B,Y]),Ie=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var s,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return p(!0),e.prev=3,a=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:a||void 0},e.next=8,(0,T.zc)(o);case 8:i=e.sent,console.log("加载工作组配置模板列表: ",i,o),u=(null==i||null===(s=i.data)||void 0===s?void 0:s.content)||[],J(u),!(u.length>0)||Q&&u.some((function(e){return e.uid===Q}))||(G(u[0].uid),null!=r&&r.keepActive||re(le));case 13:return e.prev=13,p(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,Q]);(0,r.useEffect)((function(){Ie(Y)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){me?(Te(me),Fe.current=JSON.stringify(null!=me?me:{}),Ze(!1)):(Te(null),Fe.current=JSON.stringify({}),Ze(!1))}),[null==me?void 0:me.uid]),(0,r.useEffect)((function(){if(me)try{var e=JSON.stringify(null!=Ue?Ue:{});Ze(e!==Fe.current)}catch(e){Ze(!0)}}),[Ue,null==me?void 0:me.uid]);var We=function(){var n=f()(c()().mark((function n(r){var s,a,o;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=null!=r?r:me)&&s.uid){n.next=3;break}return n.abrupt("return");case 3:return a={uid:s.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,T.zN)(a);case 6:(o=n.sent)&&200===o.code?(R.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Ie(Y)):R.yw.error((null==o?void 0:o.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),qe=function(){var n=f()(c()().mark((function n(r,s){var a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,T.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:s});case 3:(a=n.sent)&&200===a.code?(R.yw.success(e.formatMessage({id:s?"common.enabled":"common.disabled",defaultMessage:s?"已启用":"已停用"})),Ie(Y)):R.yw.error((null==a?void 0:a.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),R.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ae=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},De=function(e){if(e){var t=Ae(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return Ae(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return l()(l()({},t),n?{toolbar:n}:{})}},Le=function(e){if(e)return Ae(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Oe=function(e){if(e)return Ae(e,["name","description","color","order"])},Ee=function(e){if(e)return Ae(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm","worktimeUids"])},ze=function(e){if(e)return Ae(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},Ne=function(e){var t,n;if(e){var r=Ae(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),s=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return l()(l()({},r),s?{robotUid:s}:{})}},Ve=function(){var n=f()(c()().mark((function n(){var r,s,a,o,i,u;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=me&&me.uid){n.next=3;break}return R.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return ke(!0),n.prev=4,r=Ue&&Ue.uid===me.uid?Ue:me,s=function(e,t){return l()(l()({},e||{}),t||{})},a={uid:me.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode,serviceSettings:De(s(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),inviteSettings:Le(s(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),intentionSettings:Oe(s(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),messageLeaveSettings:Ee(s(null==r?void 0:r.messageLeaveSettings,null==r?void 0:r.draftMessageLeaveSettings)),robotRoutingSettings:Ne(s(null==r?void 0:r.robotRoutingSettings,null==r?void 0:r.draftRobotRoutingSettings)),queueSettings:ze(s(null==r?void 0:r.queueSettings,null==r?void 0:r.draftQueueSettings))},n.next=10,(0,T.Y2)(a);case 10:o=n.sent,console.log("保存工作组配置模板: ",o,a),o&&200===o.code?(R.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Fe.current=JSON.stringify(null!==(i=null!==(u=o.data)&&void 0!==u?u:r)&&void 0!==i?i:{}),Ze(!1),Ie(Y,{keepActive:!0})):R.yw.error((null==o?void 0:o.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),R.yw.error("保存失败");case 19:return n.prev=19,ke(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Be=function(){var n=f()(c()().mark((function n(){var r,s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=me&&me.uid){n.next=3;break}return R.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ye(!0),n.prev=4,!Ce){n.next=8;break}return n.next=8,Ve();case 8:return r={uid:me.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,T.Dm)(r);case 11:(s=n.sent)&&200===s.code?(R.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Fe.current=JSON.stringify(null!==(a=s.data)&&void 0!==a?a:{}),Ze(!1),Ie(Y)):R.yw.error((null==s?void 0:s.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),R.yw.error("发布失败");case 19:return n.prev=19,ye(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Je=(0,r.useMemo)((function(){return null!=me&&me.uid?[{key:"tips",label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"}),children:(0,z.jsx)(L.Z,{type:W.aZD,settingsUid:me.uid})},{key:"service",label:(0,z.jsx)(a.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"}),children:(0,z.jsx)(D.Z,{type:W.aZD,settingsUid:me.uid})},{key:"rate",label:(0,z.jsx)(a.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,z.jsx)(V.Z,{type:W.aZD,settingsUid:me.uid})},{key:"robot",label:(0,z.jsx)(a.FormattedMessage,{id:"robot",defaultMessage:"Robot"}),children:(0,z.jsx)(oe,{type:W.aZD})}].concat(i()([]),[{key:"right",label:(0,z.jsx)(a.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,z.jsx)(A.Z,{type:W.aZD,settingsUid:me.uid,isActive:"right"===ne})}],i()([]),i()([]),[{key:"route",label:(0,z.jsx)(a.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"}),children:(0,z.jsx)(ue,{})}]):[]}),[null==me?void 0:me.uid,e]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,z.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,z.jsxs)(F.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(j.Z,{}),type:"primary",onClick:function(){pe(null),de(!0)},children:(0,z.jsx)(a.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,z.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,z.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:Y,onChange:function(e){return $(e.target.value)},onSearch:function(e){$(e),Ie(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,z.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,z.jsx)(k.Z,{dataSource:Pe,locale:{emptyText:(0,z.jsx)(w.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:w.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,z.jsx)(k.Z.Item,{style:Q===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return G(e.uid)},children:(0,z.jsx)(k.Z.Item.Meta,{title:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,z.jsx)(M.Z,{size:4,children:e.isDefault?(0,z.jsx)(b.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,z.jsx)("div",{style:{color:o?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,z.jsx)(v.Z.Panel,{children:me?(0,z.jsx)(F.Z,{title:(0,z.jsxs)(M.Z,{children:[(0,z.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",me.name||me.uid]}),(0,z.jsx)(y.Z,{checked:!!me.enabled,onChange:function(e){return qe(me.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(C.Z,{}),onClick:function(e){var t;e.stopPropagation(),pe(null!=(t=me)?t:me),de(!0)},children:"编辑"}),(0,z.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),We(me)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,z.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,z.jsx)(Z.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),me.isDefault?(0,z.jsx)(b.Z,{color:"blue",children:"默认"}):null]}),extra:(0,z.jsxs)(M.Z,{children:[(0,z.jsx)(S.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Be()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,z.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:be,type:"default",children:(0,z.jsx)(a.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,z.jsx)(h.ZP,{onClick:function(){me&&(Te(me),Fe.current=JSON.stringify(null!=me?me:{}),Ze(!1))},disabled:!Ce,children:(0,z.jsx)(a.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,z.jsx)(h.ZP,{type:"primary",loading:xe,onClick:Ve,disabled:!Ce,children:(0,z.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,z.jsx)(s.Z,{activeKey:ne,onChange:re,items:Je})}):(0,z.jsx)(F.Z,{children:(0,z.jsx)(w.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,z.jsx)(N,{open:ie,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:fe,onSuccess:function(){de(!1),Ie(Y)}})]})},ce=n(89246),ge=n(33797),fe=n(78578),pe=n(2077),me=n(75864),ve=n(89965),he=n(80953),xe=n(33019),ke=n(10404),we=function(e){var t,n,s,o=e.open,i=e.record,u=e.onClose,d=e.onSuccess,g=(0,a.useIntl)(),p=(0,B.Z)().translateString,v=(0,U.u)((function(e){return e.currentOrg})),x=(0,r.useMemo)((function(){return!(null==i||!i.uid)}),[i]),k=(0,r.useState)(!1),w=m()(k,2),b=w[0],y=w[1],S=(0,r.useState)([]),C=m()(S,2),Z=C[0],F=C[1],P=(0,r.useState)(!1),I=m()(P,2),W=I[0],q=I[1],A=(0,r.useState)(0),D=m()(A,2),L=D[0],O=D[1],E=(0,r.useRef)(),V=(0,ke.E)((function(e){return e.agentResult})),H=(0,ke.E)((function(e){return e.setAgentResult})),X=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==v?void 0:v.uid,searchText:t||""},e.next=5,(0,T.zc)(r);case 5:return s=e.sent,a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],F(a),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,q(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==v?void 0:v.uid]);return(0,r.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&null!=v&&v.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:v.uid},e.next=6,(0,xe._t)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?H(n):null!=n&&n.message&&R.yw.warning(n.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[o,null==v?void 0:v.uid,H]),(0,z.jsxs)(me.a,{open:o,onOpenChange:function(e){e||u()},title:x?g.formatMessage({id:"workgroup.edit",defaultMessage:"编辑工作组"}):g.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),width:520,formRef:E,initialValues:x?{nickname:null==i?void 0:i.nickname,description:null==i?void 0:i.description,settingsUid:null==i||null===(t=i.settings)||void 0===t?void 0:t.uid,agents:(null==i||null===(n=i.agents)||void 0===n?void 0:n.map((function(e){return e.uid})))||[]}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:g.formatMessage({id:"save",defaultMessage:"保存"}),resetText:g.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return u()}}},onFinish:function(){var e=f()(c()().mark((function e(t){var n,r,s,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,R.yw.loading(g.formatMessage({id:x?"updating":"creating",defaultMessage:x?"Updating":"Creating"})),!x){e.next=9;break}return s=l()(l()(l()({},i),t),{},{agentUids:t.agents}),e.next=6,(0,pe.W5)(s);case 6:r=e.sent,e.next=13;break;case 9:return a={nickname:t.nickname,description:t.description,settingsUid:t.settingsUid,orgUid:null==v?void 0:v.uid,agentUids:t.agents},e.next=12,(0,pe.p0)(a);case 12:r=e.sent;case 13:if(R.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=21;break}return R.yw.success(g.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(r.data),u(),e.abrupt("return",!0);case 21:return R.yw.error((null===(o=r)||void 0===o?void 0:o.message)||g.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),R.yw.destroy(),R.yw.error(g.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(G.Z,{name:"agents",label:g.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),placeholder:g.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),options:((null==V||null===(s=V.data)||void 0===s?void 0:s.content)||[]).map((function(e){return{value:e.uid,label:p(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0}}),(0,z.jsx)(J.A.Item,{label:g.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),children:(0,z.jsxs)(M.Z.Compact,{style:{width:"100%"},children:[(0,z.jsx)("div",{style:{flex:1},children:(0,z.jsx)(G.Z,{name:"settingsUid",label:!1,placeholder:g.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:L},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",X(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{style:{width:"100%"},filterOption:!1,loading:W,notFoundContent:0===Z.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:g.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(j.Z,{}),onClick:function(){return y(!0)},children:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0}})}),(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(j.Z,{}),onClick:function(){return y(!0)},title:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:g.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,z.jsx)(ve.Z,{name:"nickname",label:g.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,z.jsx)(he.Z,{name:"description",label:g.formatMessage({id:"workgroup.info.description",defaultMessage:"描述"})}),(0,z.jsx)(N,{open:b,onOpenChange:y,orgUid:(null==v?void 0:v.uid)||"",record:null,onSuccess:function(){y(!1),O((function(e){return e+1}))}})]})},Me=function(e){var t,n=e.open,s=e.onClose,o=e.onSubmit,i=(0,a.useIntl)(),u=J.A.useForm(),l=m()(u,1)[0],d=(0,B.Z)().translateString,g=(0,U.u)((function(e){return e.currentOrg})),p=(0,ke.E)((function(e){return e.agentResult})),v=(0,ke.E)((function(e){return e.setAgentResult})),x=(0,r.useState)([]),k=m()(x,2),w=k[0],M=k[1],b=(0,r.useState)(!1),y=m()(b,2),S=y[0],C=y[1],Z=(0,r.useState)(!1),F=m()(Z,2),P=F[0],I=F[1],W=(0,r.useState)(0),q=m()(W,2),A=q[0],D=q[1],L=(0,r.useState)([]),O=m()(L,2),V=O[0],H=O[1];(0,r.useEffect)((function(){n&&(l.setFieldsValue({nickname:"",agents:[]}),M([]))}),[n]);var X=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==g?void 0:g.uid,searchText:t||""},e.next=5,(0,T.zc)(r);case 5:return s=e.sent,console.log("queryWorkgroupSettingsByOrg response:",s,r),a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],H(a),!l.getFieldValue("settingsUid")&&a.length>0&&l.setFieldsValue({settingsUid:a[0].uid}),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,I(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==g?void 0:g.uid,l]);(0,r.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=g&&g.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:g.uid},e.next=6,(0,xe._t)(t);case 6:200===(null==(r=e.sent)?void 0:r.code)?v(r):null!=r&&r.message&&R.yw.warning(r.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,null==g?void 0:g.uid,v]);return(0,z.jsx)("div",{children:(0,z.jsxs)(E.Z,{title:i.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),open:n,forceRender:!0,onOk:function(){console.log("handleOk"),l.validateFields().then((function(e){console.log("form values:",e);var t={nickname:l.getFieldValue("nickname"),agentUids:l.getFieldValue("agents"),settingsUid:l.getFieldValue("settingsUid"),orgUid:null==g?void 0:g.uid};console.log("workgroup:",t),o(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),s()},children:[(0,z.jsxs)(J.A,{form:l,name:"wgForm",submitter:{render:function(e,t){return(0,z.jsx)(z.Fragment,{})}},children:[(0,z.jsx)(G.Z,{name:"settingsUid",label:i.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),rules:[{required:!0,message:i.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],placeholder:i.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:A},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",X(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:P,notFoundContent:0===V.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:i.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(j.Z,{}),onClick:function(){return C(!0)},children:i.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(j.Z,{}),onClick:function(){return C(!0)},title:i.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:i.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,z.jsx)(ve.Z,{label:i.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),name:"nickname",rules:[{required:!0,message:i.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,z.jsx)(G.Z,{name:"agents",label:i.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),options:((null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[]).map((function(e){return{value:e.uid,label:d(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:i.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),value:w,onChange:function(e){console.log("selected ".concat(e)),M(e)}}})]}),(0,z.jsx)(N,{open:S,onOpenChange:C,orgUid:(null==g?void 0:g.uid)||"",record:null,onSuccess:function(){C(!1),D((function(e){return e+1}))}})]})})},be=function(){var e=(0,a.useIntl)(),t=(0,r.useRef)(),n=(0,U.u)((function(e){return e.currentOrg})),s=(0,r.useState)(!1),o=m()(s,2),i=o[0],u=o[1],l=(0,r.useState)(!1),d=m()(l,2),g=d[0],p=d[1],v=(0,r.useState)(null),x=m()(v,2),k=x[0],w=x[1],M=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,z.jsx)(ge.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),dataIndex:"agents",width:320,hideInSearch:!0,ellipsis:!0,render:function(t,n){var r=(null==n?void 0:n.agents)||[];return null!=r&&r.length?(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,z.jsx)(ge.Z.Group,{max:{count:5},size:"small",children:r.map((function(e){var t;return(0,z.jsx)(fe.Z,{title:null==e?void 0:e.nickname,children:(0,z.jsx)(ge.Z,{src:null==e?void 0:e.avatar,children:null===(t=(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)||"?")||void 0===t?void 0:t.slice(0,1)})},null==e?void 0:e.uid)}))}),(0,z.jsx)("span",{style:{color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.map((function(e){return null==e?void 0:e.nickname})).filter(Boolean).join("、")})]}):(0,z.jsx)("span",{style:{color:"#999"},children:e.formatMessage({id:"workgroup.members.empty",defaultMessage:"暂无成员"})})}},{title:e.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,z.jsx)("a",{onClick:function(){w(n),u(!0)},children:n.settings.name||e.formatMessage({id:"workgroup.settings.configured",defaultMessage:"已配置"})}):(0,z.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){w(n),u(!0)},children:e.formatMessage({id:"workgroup.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,z.jsx)("a",{onClick:function(){return a.history.push("/service/channel")},children:e.formatMessage({id:"workgroup.get.code",defaultMessage:"获取工作组代码"})},"code"),(0,z.jsx)("a",{onClick:function(){w(r),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,z.jsx)(S.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:f()(c()().mark((function n(){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,pe.zl)(r);case 4:s=n.sent,R.yw.destroy(),200===(null==s?void 0:s.code)?(R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(a=t.current)||void 0===a||a.reload()):R.yw.error((null==s?void 0:s.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),R.yw.destroy(),R.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,z.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(ce.Z,{columns:M,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,z.jsx)(h.ZP,{type:"primary",onClick:function(){w(null),p(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=f()(c()().mark((function e(t){var r,s,a,o,i,u,l,d,g,f,p,m,v,h,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,i=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,u=null!==(a=null==t?void 0:t.searchText)&&void 0!==a?a:"",l={pageNumber:o,pageSize:i,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:u},e.prev=4,e.next=7,(0,pe.LE)(l);case 7:if(200!==(null==(d=e.sent)?void 0:d.code)){e.next=12;break}return h=(null==d||null===(g=d.data)||void 0===g?void 0:g.content)||[],x=null!==(f=null!==(p=null==d||null===(m=d.data)||void 0===m?void 0:m.totalElements)&&void 0!==p?p:null==d||null===(v=d.data)||void 0===v?void 0:v.numberOfElements)&&void 0!==f?f:h.length,e.abrupt("return",{data:h,total:x,success:!0});case 12:return e.abrupt("return",{data:[],total:0,success:!1});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"workgroup",defaultMessage:"Workgroup"})}),i&&(0,z.jsx)(we,{open:i,record:k,onClose:function(){return u(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),g&&(0,z.jsx)(Me,{open:g,onClose:function(){return p(!1)},onSubmit:function(){var n=f()(c()().mark((function n(r){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return R.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,pe.p0)(r);case 4:s=n.sent,R.yw.destroy(),200===(null==s?void 0:s.code)?(R.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),p(!1),null===(a=t.current)||void 0===a||a.reload()):R.yw.error((null==s?void 0:s.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),R.yw.destroy(),R.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()})]})},ye=function(){return(0,z.jsx)(s.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,z.jsx)(a.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,z.jsx)(be,{})},{key:"settings",label:(0,z.jsx)(a.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,z.jsx)(de,{})}]})}}}]);