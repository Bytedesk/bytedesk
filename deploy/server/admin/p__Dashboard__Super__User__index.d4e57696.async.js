"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4693],{15722:function(e,t,a){a.d(t,{Z:function(){return c}});var r=a(83910),s=a(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=a(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},11090:function(e,t,a){a.d(t,{Z:function(){return c}});var r=a(83910),s=a(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=a(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},2484:function(e,t,a){a.d(t,{Z:function(){return c}});var r=a(83910),s=a(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=a(54183),o=function(e,t){return s.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},42491:function(e,t,a){var r=a(94433),s=a(38956),n=a(44194),i=a(35074),o=a(31549),c=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=n.forwardRef((function(e,t){var a=e.fieldProps,n=e.unCheckedChildren,d=e.checkedChildren,l=e.proFieldProps,u=(0,s.Z)(e,c);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:n,checkedChildren:d},a),ref:t,valuePropName:"checked",proFieldProps:l,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},u))}));t.Z=d},26997:function(e,t,a){a.r(t),a.d(t,{default:function(){return ge}});var r=a(75762),s=a(85764),n=a(72831),i=a(67738),o=a(73193),c=a.n(o),d=a(84176),l=a.n(d),u=a(90819),g=a.n(u),f=a(89933),p=a.n(f),m=a(45332),h=a.n(m),x=a(19433),M=a(34369),v=a(99753),y=a(10162),b=a(11090),w=a(89246),k=a(83001),j=a(39487),Z=a(81739),S=a(62640),I=a(63649),C=a(82770),z=a(44194),F=a(98830),T=a(25784),R=a(89965),A=a(42491),U=a(41196),P=a(82864),B=a(14906),D=a(31549),E=function(e){var t=e.isEdit,a=e.user,r=e.open,s=e.onClose,n=e.onSubmit,i=U.Z.useForm(),o=h()(i,1)[0],d=(0,B.useIntl)(),l=(0,F.u)((function(e){return e.currentOrg}));(0,z.useEffect)((function(){t?o.setFieldsValue({username:null==a?void 0:a.username,nickname:null==a?void 0:a.nickname,email:null==a?void 0:a.email,emailVerified:null==a?void 0:a.emailVerified,mobile:null==a?void 0:a.mobile,mobileVerified:null==a?void 0:a.mobileVerified,enabled:null==a?void 0:a.enabled}):(o.resetFields(),o.setFieldsValue({enabled:!0}))}),[r]);return(0,D.jsx)(P.Z,{title:t?(0,D.jsx)(B.FormattedMessage,{id:"pages.user.edit",defaultMessage:"Edit User"}):(0,D.jsx)(B.FormattedMessage,{id:"pages.user.create",defaultMessage:"Create User"}),onClose:s,open:r,width:600,extra:(0,D.jsxs)(j.Z,{children:[(0,D.jsx)(C.ZP,{onClick:s,children:(0,D.jsx)(B.FormattedMessage,{id:"pages.common.cancel"})}),(0,D.jsx)(C.ZP,{onClick:function(){o.validateFields().then((function(e){null==a||!a.superUser||!1!==e.enabled&&!1!==e.mobileVerified&&!1!==e.emailVerified?n(c()(c()(c()({},a),e),{},{orgUid:null==l?void 0:l.uid})):x.yw.error(d.formatMessage({id:"pages.user.superUser.notAllow"}))})).catch((function(e){console.log("Form errors:",e),x.yw.error(d.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,D.jsx)(B.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,D.jsxs)(T.A,{form:o,submitter:!1,children:[(0,D.jsx)(R.Z,{name:"username",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.username"}),rules:[{required:!0,message:d.formatMessage({id:"pages.user.username.required"})}]}),(0,D.jsx)(R.Z,{name:"nickname",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.nickname"}),rules:[{required:!0,message:d.formatMessage({id:"pages.user.nickname.required"})}]}),(0,D.jsx)(R.Z,{name:"email",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.email"}),rules:[{required:!0,message:d.formatMessage({id:"pages.user.email.required"})},{type:"email",message:d.formatMessage({id:"pages.user.email.invalid"})}]}),(0,D.jsx)(A.Z,{name:"emailVerified",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.email.verified"})}),(0,D.jsx)(R.Z,{name:"mobile",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.mobile"}),rules:[{required:!0,message:d.formatMessage({id:"pages.user.mobile.required"})},{pattern:/^1[3-9]\d{9}$/,message:d.formatMessage({id:"pages.user.mobile.invalid"})}]}),(0,D.jsx)(A.Z,{name:"mobileVerified",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.mobile.verified"})}),(0,D.jsx)(A.Z,{name:"enabled",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.enabled",defaultMessage:"Status"}),checkedChildren:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.status.disabled",defaultMessage:"禁用"})}),(0,D.jsx)(R.Z.Password,{name:"password",label:(0,D.jsx)(B.FormattedMessage,{id:"pages.user.password"}),rules:[{required:!t,message:d.formatMessage({id:"pages.user.password.required"})}]})]})})},O=a(26138),q=a(20126),Y=a(91361),V=a(96596),N=a.n(V),L=a(39497),H=a(5932),J=["current","pageSize"],K=function(){var e=(0,B.useIntl)(),t=(0,z.useRef)(),a=(0,Y.Z)().translateString,r=(0,z.useState)(!0),s=h()(r,2),n=s[0],i=s[1],o=(0,z.useState)(),d=h()(o,2),u=d[0],f=d[1],m=(0,z.useState)(!1),T=h()(m,2),R=T[0],A=T[1],U=(0,z.useState)(1),P=h()(U,2),V=P[0],K=P[1],W=(0,z.useState)(10),Q=h()(W,2),G=Q[0],X=Q[1],$=(0,F.u)((function(e){return e.currentOrg})),_=(0,q.Z)((function(e){return{setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),ee=_.setRoleResult,te=_.setRoleResultPlatform,ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.common.search",defaultMessage:"搜索"}),dataIndex:"searchText",hideInTable:!0,fieldProps:{placeholder:e.formatMessage({id:"pages.user.searchPlaceholder",defaultMessage:"搜索用户名/昵称/邮箱/手机号/组织"})}},{title:e.formatMessage({id:"uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:e.formatMessage({id:"pages.user.username"}),dataIndex:"username",copyable:!0},{title:e.formatMessage({id:"pages.user.nickname"}),dataIndex:"nickname",render:function(e,t){var r=a(t.nickname);return r?(0,D.jsx)(k.Z.Text,{copyable:{text:r},children:r}):"-"}},{title:e.formatMessage({id:"pages.user.email"}),dataIndex:"email",width:300,render:function(t,a){return(0,D.jsxs)(j.Z,{size:4,children:[a.email?(0,D.jsx)(k.Z.Text,{copyable:{text:a.email},children:a.email}):(0,D.jsx)("span",{children:"-"}),(0,D.jsx)(Z.Z,{color:a.emailVerified?"success":"default",children:a.emailVerified?e.formatMessage({id:"pages.user.email.verified.yes"}):e.formatMessage({id:"pages.user.email.verified.no"})})]})}},{title:e.formatMessage({id:"pages.user.mobile"}),dataIndex:"mobile",width:250,render:function(t,a){return(0,D.jsxs)(j.Z,{size:4,children:[a.mobile?(0,D.jsx)(k.Z.Text,{copyable:{text:a.mobile},children:a.mobile}):(0,D.jsx)("span",{children:"-"}),(0,D.jsx)(Z.Z,{color:a.mobileVerified?"success":"default",children:a.mobileVerified?e.formatMessage({id:"pages.user.mobile.verified.yes"}):e.formatMessage({id:"pages.user.mobile.verified.no"})})]})}},{title:e.formatMessage({id:"pages.user.organization"}),dataIndex:"currentOrganization",render:function(e,t){var a,r=null===(a=t.currentOrganization)||void 0===a?void 0:a.name;return r?(0,D.jsx)(k.Z.Text,{copyable:{text:r},children:(0,D.jsx)(Z.Z,{color:"blue",children:r})}):"-"},fieldProps:{placeholder:e.formatMessage({id:"pages.user.organization.searchPlaceholder",defaultMessage:"搜索组织名称"})}},{title:e.formatMessage({id:"pages.user.roles"}),dataIndex:"currentRoles",hideInSearch:!0,width:250,render:function(e,t){return t.currentRoles&&t.currentRoles.length>0?(0,D.jsx)(j.Z,{wrap:!0,children:t.currentRoles.map((function(e,t){return(0,D.jsx)(Z.Z,{color:"green",children:a(e.name)},t)}))}):null}},{title:e.formatMessage({id:"pages.user.description"}),dataIndex:"description",hideInSearch:!0,hideInTable:!0},{title:e.formatMessage({id:"pages.user.enabled"}),dataIndex:"enabled",hideInSearch:!0,width:100,render:function(t,a){return a.enabled?e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}):e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.user.superUser"}),dataIndex:"superUser",hideInSearch:!0,width:100,render:function(t,a){return a.superUser?e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.user.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.createdAt?N()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.user.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.updatedAt?N()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],re=[].concat(ae,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,a,r,s){return[(0,D.jsx)("a",{onClick:function(){ie(a)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!a.superUser&&(0,D.jsxs)(z.Fragment,{children:[(0,D.jsx)(S.Z,{type:"vertical"},"divider"),(0,D.jsx)(I.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:a.nickname||a.username}),onConfirm:function(){return oe(a)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,D.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")]}}]),se=(0,O.v)((function(e){return e.currentCategory})),ne=function(){f(void 0),i(!1),A(!0)},ie=function(e){f(e),i(!0),A(!0)},oe=function(){var r=p()(g()().mark((function r(s){var n,i;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!s.superUser){r.next=3;break}return x.yw.error(e.formatMessage({id:"pages.user.superUser.notDelete"})),r.abrupt("return");case 3:return x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),r.prev=4,r.next=7,(0,M.h8)({uid:s.uid});case 7:n=r.sent,x.yw.destroy(),200===n.code?(x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=t.current)||void 0===i||i.reloadAndRest()):x.yw.error(a(n.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(4),x.yw.destroy(),x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete user error:",r.t0);case 17:case"end":return r.stop()}}),r,null,[[4,12]])})));return function(e){return r.apply(this,arguments)}}(),ce=function(){var a=p()(g()().mark((function a(r){var s,i;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(console.log("handleSubmitDrawer",r),n?x.yw.loading(e.formatMessage({id:"updating"})):x.yw.loading(e.formatMessage({id:"creating"})),!n){a.next=8;break}return a.next=5,(0,M.Nq)(r);case 5:a.t0=a.sent,a.next=11;break;case 8:return a.next=10,(0,M.r4)(r);case 10:a.t0=a.sent;case 11:s=a.t0,console.log("createUser response:",r,s),200===s.code?(x.yw.destroy(),x.yw.loading(e.formatMessage({id:"create.success"})),A(!1),null===(i=t.current)||void 0===i||i.reloadAndRest()):(x.yw.destroy(),x.yw.error(s.message));case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),de=function(){var t=p()(g()().mark((function t(){var a,r;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),a={pageNumber:0,pageSize:100,orgUid:null==$?void 0:$.uid},t.next=4,(0,v.E9)(a);case 4:r=t.sent,console.log("queryRolesByOrg response ",r),200===r.code?(x.yw.destroy(),ee(r)):(x.yw.destroy(),x.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),le=function(){var t=p()(g()().mark((function t(){var a,r;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),a={pageNumber:0,pageSize:100,level:L.Hxq},t.next=4,(0,v.E9)(a);case 4:r=t.sent,console.log("queryRolesBySuper response ",r),200===r.code?(x.yw.destroy(),te(r)):(x.yw.destroy(),x.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,z.useEffect)((function(){de(),le()}),[]),(0,z.useEffect)((function(){var e;console.log("currentCategory:",se),null===(e=t.current)||void 0===e||e.reloadAndRest()}),[se]);var ue=function(){var e=p()(g()().mark((function e(){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",V,G),t=localStorage.getItem(L.LA8),window.open((0,H.kG)()+"/api/v1/user/export?"+new URLSearchParams({pageNumber:String(V-1),pageSize:String(G),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(w.Z,{columns:re,actionRef:t,cardBordered:!0,scroll:{x:2500},request:function(){var t=p()(g()().mark((function t(r,s,n){var i,o,d,u,f;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",r,s,n),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),i=r.current,o=r.pageSize,d=l()(r,J),K(i),X(o),u=c()({pageNumber:i-1,pageSize:o,superUser:!0},d),t.next=8,(0,M._9)(u);case 8:return f=t.sent,console.log("getAllUsers response:",u,f),x.yw.destroy(),200===f.code||x.yw.error(a(f.message)),t.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:G,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){console.log("pagination onChange:",e,t),K(e),X(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.user.list",defaultMessage:"用户列表"}),toolBarRender:function(){return[(0,D.jsx)(C.ZP,{icon:(0,D.jsx)(y.Z,{}),type:"primary",onClick:ne,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button"),(0,D.jsx)(C.ZP,{icon:(0,D.jsx)(b.Z,{}),type:"primary",onClick:ue,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),R&&(0,D.jsx)(E,{isEdit:n,open:R,user:u,onClose:function(){A(!1)},onSubmit:ce})]})},W=a(43590),Q=a(86222),G=a.n(Q),X=a(97462),$=a(59304),_=a(54881),ee=a(2484),te=a(86895),ae=a(2907),re=a(31203),se=["current","pageSize"],ne=function(e){var t=e.superUser,a=(0,B.useIntl)(),r=(0,z.useRef)(),s=(0,F.u)((function(e){return e.currentOrg})),n=(0,z.useState)(1),i=h()(n,2),o=i[0],d=i[1],u=(0,z.useState)(10),f=h()(u,2),m=f[0],M=f[1],v=(0,z.useState)({}),k=h()(v,2),j=k[0],Z=k[1],S=(0,z.useState)(0),T=h()(S,2),R=T[0],A=T[1],U=(0,z.useState)([]),P=h()(U,2),E=P[0],O=P[1],q=(0,z.useState)([]),Y=h()(q,2),V=Y[0],N=Y[1],J=(0,z.useState)(!1),K=h()(J,2),W=K[0],Q=K[1],ne=(0,z.useState)(),ie=h()(ne,2),oe=ie[0],ce=ie[1],de=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(B.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.whiteIp.ip"}),dataIndex:"ip",copyable:!0,width:150,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.whiteIp.ip.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.white.description"}),dataIndex:"description",copyable:!0,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.white.description.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"message.createdAt.tooltip"})}],le=[].concat(de,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,r,s){return[(0,D.jsx)(C.ZP,{size:"small",type:"link",icon:(0,D.jsx)($.Z,{}),onClick:function(){return fe(t)},children:a.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,D.jsx)(I.Z,{title:a.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return ge(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,D.jsx)(C.ZP,{size:"small",type:"link",danger:!0,children:a.formatMessage({id:"visitor.whiteIp.delete",defaultMessage:"Delete"})})},"delete")]}}]),ue=function(){var e=p()(g()().mark((function e(a,r,n){var i,d;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),i=localStorage.getItem(L.LA8),d=c()({orgUid:t?"":null==s?void 0:s.uid,accessToken:i||"",exportType:a},j),"current"===a?(d.pageNumber=String(o-1),d.pageSize=String(m)):"all"===a?(d.pageNumber="0",d.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(d.pageNumber=String(r),d.pageSize=String(n)),window.open((0,H.kG)()+"/api/v1/ip/white/export?"+new URLSearchParams(d).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ge=function(){var e=p()(g()().mark((function e(t){var s,n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,(0,X.QE)(t.uid);case 4:s=e.sent,console.log("delete response:",s),200===s.code?(null==r||null===(n=r.current)||void 0===n||n.reload(),x.yw.success(a.formatMessage({id:"delete.success"}))):x.yw.error(a.formatMessage({id:"delete.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.error(a.formatMessage({id:"delete.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),fe=function(e){ce(e),Q(!0)},pe=function(){ce(void 0),Q(!0)},me=function(){var e=p()(g()().mark((function e(){var t,s,n,i,o,c;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.length){e.next=3;break}return x.yw.warning(a.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:x.yw.loading(a.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,i=G()(V),e.prev=7,i.s();case 9:if((o=i.n()).done){e.next=23;break}return c=o.value,e.prev=11,e.next=14,(0,X.QE)(c.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:x.yw.destroy(),0===n?x.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条白名单"},{count:s})):x.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"成功删除 {success} 条白名单，失败 {fail} 条"},{success:s,fail:n})),O([]),N([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),he=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,i=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ue("range",r,a)}})},n=0;n<r;n++)s();return t},xe={selectedRowKeys:E,onChange:function(e,t){O(e),N(t)}};return(0,D.jsxs)(z.Fragment,{children:[(0,D.jsx)(w.Z,{columns:le,actionRef:r,cardBordered:!0,rowSelection:xe,scroll:{x:800},request:function(){var e=p()(g()().mark((function e(a,r,n){var i,o,u,f,p,m,h,v;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,o=a.pageSize,u=l()(a,se),d(i),M(o),Z(u),f=void 0,p=void 0,r&&Object.keys(r).length>0&&(m=Object.keys(r)[0],f=m,p="ascend"===r[m]?"ascend":"descend"),h=c()(c()({pageNumber:a.current-1,pageSize:o,orgUid:null==s?void 0:s.uid},u),{},{sortBy:f,sortDirection:p,superUser:t}),e.next=10,(0,X.Fx)(h);case 10:return v=e.sent,console.log("queryIpWhites response:",v,h),200===v.code?A(v.data.totalElements):x.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){d(e),M(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"visitor.whiteIp.list"}),toolBarRender:function(){return function(){var e=[];e.push((0,D.jsx)(C.ZP,{type:"primary",icon:(0,D.jsx)(y.Z,{}),onClick:pe,children:a.formatMessage({id:"visitor.whiteIp.add",defaultMessage:"添加白名单IP"})},"add"));var t=[];E.length>0&&(t.push({key:"batchDelete",icon:(0,D.jsx)(_.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete",defaultMessage:"批量删除白名单"})+" (".concat(E.length,")"),onClick:function(){te.Z.confirm({title:a.formatMessage({id:"batch.deleteTip",defaultMessage:"删除白名单确认"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(E.length," ").concat(a.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:me,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}}),e.push((0,D.jsx)(ae.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(C.ZP,{type:"primary",danger:!0,children:[a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",E.length,")",(0,D.jsx)(ee.Z,{})]})},"batchOperations")));var r=[{key:"export-current",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ue("current")}}];return R>0&&(R<=1e3?r.push({key:"export-all",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(R,"条)"),onClick:function(){return ue("all")}}):r.push({key:"export-range",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(R,"条)"),children:he(R)})),e.push((0,D.jsx)(ae.Z,{menu:{items:r},placement:"bottom",children:(0,D.jsxs)(C.ZP,{type:"primary",icon:(0,D.jsx)(b.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"导出"}),(0,D.jsx)(ee.Z,{})]})},"exportOperations")),e}()}}),(0,D.jsx)(re.Z,{visible:W,onClose:function(){return Q(!1)},onSuccess:function(){var e;null===(e=r.current)||void 0===e||e.reload()},type:"white",editData:oe,superUser:t})]})};function ie(e){return oe.apply(this,arguments)}function oe(){return(oe=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,B.request)("/api/v1/ip/access/query/org",{method:"GET",params:c()(c()({},t),{},{channel:L.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return de.apply(this,arguments)}function de(){return(de=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,B.request)("/api/v1/ip/access/delete",{method:"POST",data:{uid:t,channel:L.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=["current","pageSize"],ue=function(e){var t=e.superUser,a=(0,B.useIntl)(),r=(0,z.useRef)(),s=(0,F.u)((function(e){return e.currentOrg})),n=(0,z.useState)(1),i=h()(n,2),o=i[0],d=i[1],u=(0,z.useState)(10),f=h()(u,2),m=f[0],M=f[1],v=(0,z.useState)({}),y=h()(v,2),k=y[0],j=y[1],Z=(0,z.useState)(0),S=h()(Z,2),T=S[0],R=S[1],A=(0,z.useState)([]),U=h()(A,2),P=U[0],E=U[1],O=(0,z.useState)([]),q=h()(O,2),Y=q[0],V=q[1],J=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(B.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.ip"}),dataIndex:"ip",copyable:!0,width:150,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.ip.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.ipLocation"}),dataIndex:"ipLocation",width:180,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.ipLocation.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.endpoint"}),dataIndex:"endpoint",tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.endpoint.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.params"}),dataIndex:"params",tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.params.tooltip"}),ellipsis:!0},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.accessCount"}),dataIndex:"accessCount",width:100,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.accessCount.tooltip"})},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.accessTime"}),dataIndex:"accessTime",width:180,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.accessTime.tooltip"}),render:function(e){return e?N()(String(e)).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.lastAccessTime"}),dataIndex:"lastAccessTime",width:180,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"visitor.accessIp.lastAccessTime.tooltip"}),render:function(e){return e?N()(String(e)).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,D.jsx)(B.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(B.FormattedMessage,{id:"message.createdAt.tooltip"}),render:function(e){return e?N()(String(e)).format("YYYY-MM-DD HH:mm:ss"):"-"}}],K=[].concat(J,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,r,s){return[(0,D.jsx)(I.Z,{title:a.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return Q(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,D.jsx)(C.ZP,{size:"small",type:"link",danger:!0,children:a.formatMessage({id:"visitor.accessIp.delete",defaultMessage:"Delete"})})},"delete")]}}]),W=function(){var e=p()(g()().mark((function e(a,r,n){var i,d;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),i=localStorage.getItem(L.LA8),d=c()({orgUid:t?"":null==s?void 0:s.uid,accessToken:i||"",exportType:a},k),"current"===a?(d.pageNumber=String(o-1),d.pageSize=String(m)):"all"===a?(d.pageNumber="0",d.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(d.pageNumber=String(r),d.pageSize=String(n)),window.open((0,H.kG)()+"/api/v1/ip/access/export?"+new URLSearchParams(d).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Q=function(){var e=p()(g()().mark((function e(t){var s,n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,ce(t.uid);case 4:s=e.sent,console.log("delete response:",s),200===s.code?(null==r||null===(n=r.current)||void 0===n||n.reload(),x.yw.success(a.formatMessage({id:"delete.success"}))):x.yw.error(a.formatMessage({id:"delete.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.error(a.formatMessage({id:"delete.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=p()(g()().mark((function e(){var t,s,n,i,o,c;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Y.length){e.next=3;break}return x.yw.warning(a.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:x.yw.loading(a.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,i=G()(Y),e.prev=7,i.s();case 9:if((o=i.n()).done){e.next=23;break}return c=o.value,e.prev=11,e.next=14,ce(c.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:x.yw.destroy(),0===n?x.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条访问记录"},{count:s})):x.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"成功删除 {success} 条访问记录，失败 {fail} 条"},{success:s,fail:n})),E([]),V([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),$=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,i=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return W("range",r,a)}})},n=0;n<r;n++)s();return t},re={selectedRowKeys:P,onChange:function(e,t){E(e),V(t)}};return(0,D.jsx)(w.Z,{columns:K,actionRef:r,cardBordered:!0,rowSelection:re,scroll:{x:2e3},request:function(){var e=p()(g()().mark((function e(a,r,n){var i,o,u,f,p,m,h,v;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,o=a.pageSize,u=l()(a,le),d(i),M(o),j(u),f=void 0,p=void 0,r&&Object.keys(r).length>0&&(m=Object.keys(r)[0],f=m,p="ascend"===r[m]?"ascend":"descend"),h=c()(c()({pageNumber:a.current-1,pageSize:o,orgUid:null==s?void 0:s.uid},u),{},{sortBy:f,sortDirection:p,superUser:t}),e.next=10,ie(h);case 10:return v=e.sent,console.log("queryIpAccesses response:",v,h),200===v.code?R(v.data.totalElements):x.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){d(e),M(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"visitor.accessIp.list"}),toolBarRender:function(){return function(){var e=[],t=[];P.length>0&&(t.push({key:"batchDelete",icon:(0,D.jsx)(_.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete",defaultMessage:"批量删除访问记录"})+" (".concat(P.length,")"),onClick:function(){te.Z.confirm({title:a.formatMessage({id:"batch.deleteTip",defaultMessage:"删除访问记录确认"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(P.length," ").concat(a.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:X,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}}),e.push((0,D.jsx)(ae.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(C.ZP,{type:"primary",danger:!0,children:[a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",P.length,")",(0,D.jsx)(ee.Z,{})]})},"batchOperations")));var r=[{key:"export-current",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return W("current")}}];return T>0&&(T<=1e3?r.push({key:"export-all",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(T,"条)"),onClick:function(){return W("all")}}):r.push({key:"export-range",icon:(0,D.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(T,"条)"),children:$(T)})),e.push((0,D.jsx)(ae.Z,{menu:{items:r},placement:"bottom",children:(0,D.jsxs)(C.ZP,{type:"primary",icon:(0,D.jsx)(b.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"导出"}),(0,D.jsx)(ee.Z,{})]})},"exportOperations")),e}()}})},ge=function(){var e=(0,B.useIntl)(),t=[{key:"user",label:e.formatMessage({id:"user"}),children:(0,D.jsx)(K,{})},{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,D.jsx)(n.Z,{superUser:!0})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,D.jsx)(W.Z,{superUser:!0})}];return!(0,H.Ox)()&&(0,H.OJ)()&&t.splice(2,0,{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,D.jsx)(r.Z,{superUser:!0})},{key:"blackIp",label:e.formatMessage({id:"visitor.tab.blackIp"}),children:(0,D.jsx)(s.Z,{superUser:!0})},{key:"whiteIp",label:e.formatMessage({id:"visitor.tab.whiteIp"}),children:(0,D.jsx)(ne,{superUser:!0})},{key:"accessIp",label:e.formatMessage({id:"visitor.tab.accessIp"}),children:(0,D.jsx)(ue,{superUser:!0})}),(0,D.jsx)(i.Z,{defaultActiveKey:"user",items:t,style:{padding:"10px"}})}},26138:function(e,t,a){a.d(t,{v:function(){return p}});var r=a(86222),s=a.n(r),n=a(73193),i=a.n(n),o=a(76711),c=a.n(o),d=a(39497),l=a(58063),u=a(66266),g=a(31403),f=a(23753);var p=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,g.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:d.zBg,name:d.zBg},setCategoryResult:function(t){var a=function(e){var t=[];return e.data.content.forEach((function(e){var a={label:e.name,value:e.uid};t.push(a)})),t}(t),r=function(e){var t,a=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],r=function e(t){var a={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(a.children=t.children.map((function(t){return e(t)}))),a};return a.filter((function(e){return e&&e.uid&&e.uid!==d.zBg})).map((function(e){return r(e)}))}(t),s=[{title:d.zBg,key:d.zBg}].concat(c()(r)),n={uid:d.zBg,name:d.zBg},o=i()(i()({},t),{},{data:i()(i()({},t.data),{},{content:[n].concat(c()(t.data.content))})});e({categoryResult:o,categoryTreeOptions:s,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:d.zBg,name:d.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){f.Z.log("resetDefaultCategory"),e({currentCategory:{uid:d.zBg,name:d.zBg}})},setCurrentCategoryUid:function(a){if(a!==d.zBg){var r=function e(t,a){if(t&&0!==t.length){var r,n=s()(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if((null==i?void 0:i.uid)===a)return i;var o=e(null==i?void 0:i.children,a);if(o)return o}}catch(e){n.e(e)}finally{n.f()}}}(t().categoryResult.data.content,a);e({currentCategory:null!=r?r:{uid:d.zBg,name:d.zBg}})}else e({currentCategory:{uid:d.zBg,name:d.zBg}})},deleteCategoryCache:function(){return e({},!0)}}})),{name:d.OMm})))}}]);