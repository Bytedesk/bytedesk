"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{54008:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return h},t5:function(){return m},v_:function(){return f}});var r=n(90819),s=n.n(r),a=n(73193),o=n.n(a),i=n(89933),u=n.n(i),l=n(68992),d=n(62395);function c(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},38552:function(e,t,n){var r=n(70097);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},11719:function(e,t,n){n.r(t),n.d(t,{default:function(){return je}});var r=n(44194),s=n(44528),a=n(62395),o=n(76711),i=n.n(o),u=n(73193),l=n.n(u),d=n(90819),c=n.n(d),g=n(89933),f=n.n(g),p=n(45332),m=n.n(p),v=n(88130),h=n(72264),x=n(13243),k=n(60593),w=n(42876),M=n(89654),b=n(33633),y=n(15065),j=n(77902),S=n(6992),Z=n(41881),C=n(91768),F=n(66759),R=n(61489),T=n(34203),U=n(77686),P=n(38552),I=n(70097),W=n(68992),q=n(91733),A=n(30394),D=(n(98257),n(57648),n(23968),n(51898)),O=n(28672),E=n(65448),L=n(70878),z=n(66248),N=n(31549),V=function(e){var t=e.open,n=e.onOpenChange,s=e.orgUid,o=e.record,i=e.onSuccess,u=(0,a.useIntl)(),d=L.Z.useForm(),g=m()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(o?g.setFieldsValue({name:o.name||"",description:o.description||"",enabled:null===(e=o.enabled)||void 0===e||e,isDefault:null!==(n=o.isDefault)&&void 0!==n&&n}):(g.resetFields(),g.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,o,g]);var p=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(t=e.sent,r=l()(l()({},t),{},{orgUid:s,uid:null==o?void 0:o.uid}),null==o||!o.uid){e.next=11;break}return e.next=8,(0,T.Y2)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,T.jT)(r);case 13:e.t0=e.sent;case 14:(a=e.t0)&&200===a.code?(R.yw.success(u.formatMessage({id:null!=o&&o.uid?"common.updated":"common.created",defaultMessage:null!=o&&o.uid?"更新成功":"创建成功"})),null==i||i(),n(!1)):R.yw.error((null==a?void 0:a.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving workgroup settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)(z.Z,{title:(0,N.jsx)(a.FormattedMessage,{id:null!=o&&o.uid?"workgroup.settings.template.edit":"workgroup.settings.template.create",defaultMessage:null!=o&&o.uid?"编辑模板":"新建模板"}),open:t,onOk:p,onCancel:function(){return n(!1)},okText:(0,N.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,N.jsx)(a.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,N.jsxs)(L.Z,{form:g,layout:"vertical",preserve:!1,children:[(0,N.jsx)(L.Z.Item,{name:"name",label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:u.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,N.jsx)(x.Z,{placeholder:u.formatMessage({id:"workgroup.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,N.jsx)(L.Z.Item,{name:"description",label:(0,N.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,N.jsx)(x.Z.TextArea,{rows:3,placeholder:u.formatMessage({id:"workgroup.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,N.jsx)(L.Z.Item,{name:"enabled",label:(0,N.jsx)(a.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,N.jsx)(y.Z,{})})]})})},B=n(84005),J=n(99754),H=n(89007),X=n(86772),Q=n(42867),G=n(41253),K=n(50447),_=n(45634),Y=n.n(_);function $(e){return ee.apply(this,arguments)}function ee(){return(ee=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/create",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/update",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return se.apply(this,arguments)}function se(){return(se=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/worktime/delete",{method:"POST",data:l()(l()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(94571),oe="HH:mm:ss",ie=function(e){var t=e.type,n=H.A.useForm(),s=m()(n,1)[0],a=(0,r.useRef)(!1),o=(0,r.useRef)(),u=(0,q.z)((function(e){return{currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),d=u.currentAgentSettings,g=u.currentWorkgroupSettings,p=u.setCurrentAgentSettings,v=u.setCurrentWorkgroupSettings,h=(0,r.useState)([]),x=m()(h,2),k=x[0],w=x[1],M=(0,U.u)((function(e){return e.currentOrg})),b=(0,J.Z)().translateString,y=(0,r.useState)([]),j=m()(y,2),S=j[0],Z=j[1];(0,r.useEffect)((function(){if(t===W.Njn){var e=d,n=(null==e?void 0:e.draftMessageLeaveSettings)||(null==e?void 0:e.messageLeaveSettings);Z((null==n?void 0:n.worktimes)||[])}else if(t===W.aZD){var r,a=(null==g?void 0:g.draftMessageLeaveSettings)||(null==g?void 0:g.messageLeaveSettings);Z((null==a?void 0:a.worktimes)||[]);var o=(null==g?void 0:g.draftRobotRoutingSettings)||(null==g?void 0:g.robotRoutingSettings);s.setFieldValue("defaultRobot",null==o?void 0:o.defaultRobot),s.setFieldValue("offlineRobot",null==o?void 0:o.offlineRobot),s.setFieldValue("nonWorktimeRobot",null==o?void 0:o.nonWorktimeRobot),s.setFieldValue("robotUid",(null==o||null===(r=o.robot)||void 0===r?void 0:r.uid)||(null==o?void 0:o.robotUid))}}),[t,d,g]);var C=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.current){e.next=3;break}return console.log("isLoading: 1",a.current),e.abrupt("return");case 3:return a.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:W.f4h,orgUid:null==M?void 0:M.uid},e.next=8,(0,ae.p0)(t);case 8:n=e.sent,console.log("queryRobotsByOrg: ",n),200===n.code?w(null===(r=n.data)||void 0===r?void 0:r.content):R.yw.error(n.message),a.current=!1,R.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){C()}),[]);var F,T,P=function(e){if(g){var t=g.robotRoutingSettings||{},n=g.draftRobotRoutingSettings||{};v(l()(l()({},g),{},{robotRoutingSettings:l()(l()({},t),e),draftRobotRoutingSettings:l()(l()({},n),e)}))}},I=function(){var e=[];return S.forEach((function(t){e.push({worktime:[Y()(t.startTime,oe),Y()(t.endTime,oe)]})})),e},A=function(){var e=f()(c()().mark((function e(t,n,r){var s,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onWorktimeChange:",r,n),a={uid:null===(s=S[r])||void 0===s?void 0:s.uid,startTime:n[0],endTime:n[1]},e.next=4,te(a);case 4:o=e.sent,console.log("updateWorktime response:",o),200===o.code||R.yw.error(o.message);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createWorktime"),t={startTime:"00:00:00",endTime:"23:59:59"},e.next=4,$(t);case 4:n=e.sent,console.log("createWorktime response:",n),200===n.code?Z([].concat(i()(S),[n.data])):R.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteWorktime:",t,null===(n=S[t])||void 0===n?void 0:n.uid),s={uid:null===(r=S[t])||void 0===r?void 0:r.uid},e.next=4,re(s);case 4:a=e.sent,console.log("deleteWorktime response:",a),200===a.code?Z(S.filter((function(e,n){return n!==t}))):R.yw.error(a.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){console.log("worktimes:",S),s.setFieldValue("worktimes",I()),function(){var e=S.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);if(t===W.Njn&&d){var n=d.messageLeaveSettings||{},r=d.draftMessageLeaveSettings||{};p(l()(l()({},d),{},{messageLeaveSettings:l()(l()({},n),{},{worktimeUids:e}),draftMessageLeaveSettings:l()(l()({},r),{},{worktimeUids:e})}))}else if(t===W.aZD&&g){var s=g.messageLeaveSettings||{},a=g.draftMessageLeaveSettings||{};v(l()(l()({},g),{},{messageLeaveSettings:l()(l()({},s),{},{worktimeUids:e}),draftMessageLeaveSettings:l()(l()({},a),{},{worktimeUids:e})}))}}()}),[S]),(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(H.A,{form:s,style:{marginLeft:"20px"},submitter:!1,children:[t===W.aZD&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(X.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:function(e){var t;return P({defaultRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),(0,N.jsx)(X.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:function(e){var t;return P({offlineRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),(0,N.jsx)(X.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:function(e){var t;return P({nonWorktimeRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}})]}),(0,N.jsx)(Q.u,{name:"worktimes",style:{marginBlockEnd:0,width:"300px"},label:"工作时间区间，支持多个",creatorRecord:{worktime:[Y()("00:00:00",oe),Y()("23:59:59",oe)]},initialValue:I(),creatorButtonProps:{creatorButtonText:"添加",icon:!1,style:{width:"unset"}},copyIconProps:!1,deleteIconProps:{tooltipText:"删除"},itemRender:function(e){var t=e.listDom,n=e.action;return(0,N.jsxs)("div",{style:{display:"inline-flex",marginInlineEnd:25},children:[t,n]})},min:1,max:4,actionRef:o,actionGuard:{beforeAddRow:(T=f()(c()().mark((function e(t,n,r){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeAddRow:",t,n),e.next=3,D();case 3:return e.abrupt("return",new Promise((function(e){e(!0)})));case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return T.apply(this,arguments)}),beforeRemoveRow:(F=f()(c()().mark((function e(t,n){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeRemoveRow:",t),r=Array.isArray(t)?t[0]:t,e.next=4,O(r);case 4:return e.abrupt("return",new Promise((function(e){e(0!==t)})));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return F.apply(this,arguments)})},children:function(e,t,n){return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(G.Z.RangePicker,{width:"md",name:"worktime",fieldProps:{onChange:function(e,n){A(e,n,t)},format:oe}},"worktime")})}}),t===W.aZD&&(0,N.jsx)(K.Z,{name:"robotUid",label:"客服机器人",width:"md",options:k.map((function(e){return{value:e.uid,label:b(e.nickname)}})),fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){P({robotUid:null!=e?e:void 0})}}})]})})},ue=n(51602),le=function(){var e=L.Z.useForm(),t=m()(e,1)[0],n=(0,a.useIntl)(),s=(0,q.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),o=s.currentWorkgroupSettings,i=s.setCurrentWorkgroupSettings,u=(0,r.useState)(W.vXk),d=m()(u,2),c=d[0],g=d[1];(0,r.useEffect)((function(){if(o){var e=o;g(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[o]);return(0,N.jsx)("div",{children:(0,N.jsxs)(H.A,{form:t,submitter:!1,children:[(0,N.jsx)(ue.Z.Group,{name:"routingMode",label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:W.vXk},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:W.ZD$},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:W.owQ},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:W.e2F},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:W.zWk},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:W.HQF},{label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:W.WDq}],fieldProps:{value:c,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),g(e.target.value)}(e),t=e.target.value,o&&i(l()(l()({},o),{},{routingMode:t}))}}}),(0,N.jsxs)(H.A.Item,{children:[c===W.vXk&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),c===W.ZD$&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),c===W.owQ&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),c===W.e2F&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),c===W.zWk&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),c===W.HQF&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),c===W.JEC&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),c===W.WDq&&(0,N.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},de="welcome",ce=function(){var e=(0,a.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,P.Z)().leftSiderStyle,o=(0,I.Z)().isDarkMode,u=(0,r.useState)(!1),d=m()(u,2),g=d[0],p=d[1],L=(0,r.useState)([]),z=m()(L,2),J=z[0],H=z[1],X=(0,r.useState)(),Q=m()(X,2),G=Q[0],K=Q[1],_=(0,r.useState)(""),Y=m()(_,2),$=Y[0],ee=Y[1],te=(0,r.useState)(de),ne=m()(te,2),re=ne[0],se=ne[1],ae=(0,r.useState)(!1),oe=m()(ae,2),ue=oe[0],ce=oe[1],ge=(0,r.useState)(null),fe=m()(ge,2),pe=fe[0],me=fe[1],ve=(0,r.useMemo)((function(){return J.find((function(e){return e.uid===G}))||null}),[J,G]),he=(0,r.useState)(!1),xe=m()(he,2),ke=xe[0],we=xe[1],Me=(0,r.useState)(!1),be=m()(Me,2),ye=be[0],je=be[1],Se=(0,r.useState)(!1),Ze=m()(Se,2),Ce=Ze[0],Fe=Ze[1],Re=(0,r.useRef)(""),Te=(0,q.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Ue=Te.setCurrentWorkgroupSettings,Pe=Te.currentWorkgroupSettings,Ie=(0,r.useMemo)((function(){if(!$)return J;var e=$.toLowerCase();return J.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[J,$]),We=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var s,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return p(!0),e.prev=3,a=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:a||void 0},e.next=8,(0,T.zc)(o);case 8:i=e.sent,console.log("加载工作组配置模板列表: ",i,o),u=(null==i||null===(s=i.data)||void 0===s?void 0:s.content)||[],H(u),!(u.length>0)||G&&u.some((function(e){return e.uid===G}))||(K(u[0].uid),null!=r&&r.keepActive||se(de));case 13:return e.prev=13,p(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,G]);(0,r.useEffect)((function(){We($)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){ve?(Ue(ve),Re.current=JSON.stringify(null!=ve?ve:{}),Fe(!1)):(Ue(null),Re.current=JSON.stringify({}),Fe(!1))}),[null==ve?void 0:ve.uid]),(0,r.useEffect)((function(){if(ve)try{var e=JSON.stringify(null!=Pe?Pe:{});Fe(e!==Re.current)}catch(e){Fe(!0)}}),[Pe,null==ve?void 0:ve.uid]);var qe=function(){var n=f()(c()().mark((function n(r){var s,a,o;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=null!=r?r:ve)&&s.uid){n.next=3;break}return n.abrupt("return");case 3:return a={uid:s.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,T.zN)(a);case 6:(o=n.sent)&&200===o.code?(R.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),We($)):R.yw.error((null==o?void 0:o.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Ae=function(){var n=f()(c()().mark((function n(r,s){var a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,T.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:s});case 3:(a=n.sent)&&200===a.code?(R.yw.success(e.formatMessage({id:s?"common.enabled":"common.disabled",defaultMessage:s?"已启用":"已停用"})),We($)):R.yw.error((null==a?void 0:a.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),R.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),De=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Oe=function(e){if(e){var t=De(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return De(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return l()(l()({},t),n?{toolbar:n}:{})}},Ee=function(e){if(e)return De(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Le=function(e){if(e)return De(e,["name","description","color","order"])},ze=function(e){if(e)return De(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm","worktimeUids"])},Ne=function(e){if(e)return De(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},Ve=function(e){var t,n;if(e){var r=De(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),s=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return l()(l()({},r),s?{robotUid:s}:{})}},Be=function(){var n=f()(c()().mark((function n(){var r,s,a,o,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ve&&ve.uid){n.next=3;break}return R.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return we(!0),n.prev=4,r=Pe&&Pe.uid===ve.uid?Pe:ve,s={uid:ve.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode,serviceSettings:Oe(null==r?void 0:r.draftServiceSettings),inviteSettings:Ee(null==r?void 0:r.draftInviteSettings),intentionSettings:Le(null==r?void 0:r.draftIntentionSettings),messageLeaveSettings:ze(null==r?void 0:r.draftMessageLeaveSettings),robotRoutingSettings:Ve(null==r?void 0:r.draftRobotRoutingSettings),queueSettings:Ne(null==r?void 0:r.draftQueueSettings)},n.next=9,(0,T.Y2)(s);case 9:a=n.sent,console.log("保存工作组配置模板: ",a,s),a&&200===a.code?(R.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Re.current=JSON.stringify(null!==(o=null!==(i=a.data)&&void 0!==i?i:r)&&void 0!==o?o:{}),Fe(!1),We($,{keepActive:!0})):R.yw.error((null==a?void 0:a.message)||"保存失败"),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(4),console.error("保存失败:",n.t0),R.yw.error("保存失败");case 18:return n.prev=18,we(!1),n.finish(18);case 21:case"end":return n.stop()}}),n,null,[[4,14,18,21]])})));return function(){return n.apply(this,arguments)}}(),Je=function(){var n=f()(c()().mark((function n(){var r,s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ve&&ve.uid){n.next=3;break}return R.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(je(!0),n.prev=4,!Ce){n.next=8;break}return n.next=8,Be();case 8:return r={uid:ve.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,T.Dm)(r);case 11:(s=n.sent)&&200===s.code?(R.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Re.current=JSON.stringify(null!==(a=s.data)&&void 0!==a?a:{}),Fe(!1),We($)):R.yw.error((null==s?void 0:s.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),R.yw.error("发布失败");case 19:return n.prev=19,je(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),He=(0,r.useMemo)((function(){return null!=ve&&ve.uid?[{key:"welcome",label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,N.jsx)(E.Z,{type:W.aZD,settingsUid:ve.uid})},{key:"tips",label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"}),children:(0,N.jsx)(O.Z,{type:W.aZD,settingsUid:ve.uid})},{key:"service",label:(0,N.jsx)(a.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"}),children:(0,N.jsx)(D.Z,{type:W.aZD,settingsUid:ve.uid})},{key:"rate",label:(0,N.jsx)(a.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,N.jsx)(B.Z,{type:W.aZD,settingsUid:ve.uid})},{key:"robot",label:(0,N.jsx)(a.FormattedMessage,{id:"robot",defaultMessage:"Robot"}),children:(0,N.jsx)(ie,{type:W.aZD})}].concat(i()([]),[{key:"right",label:(0,N.jsx)(a.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,N.jsx)(A.Z,{type:W.aZD,settingsUid:ve.uid,isActive:"right"===re})}],i()([]),i()([]),[{key:"route",label:(0,N.jsx)(a.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"}),children:(0,N.jsx)(le,{})}]):[]}),[null==ve?void 0:ve.uid,e]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,N.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,N.jsxs)(F.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(S.Z,{}),type:"primary",onClick:function(){me(null),ce(!0)},children:(0,N.jsx)(a.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,N.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,N.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:$,onChange:function(e){return ee(e.target.value)},onSearch:function(e){ee(e),We(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,N.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,N.jsx)(k.Z,{dataSource:Ie,locale:{emptyText:(0,N.jsx)(w.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:w.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,N.jsx)(k.Z.Item,{style:G===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return K(e.uid)},children:(0,N.jsx)(k.Z.Item.Meta,{title:(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,N.jsx)(M.Z,{size:4,children:e.isDefault?(0,N.jsx)(b.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,N.jsx)("div",{style:{color:o?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,N.jsx)(v.Z.Panel,{children:ve?(0,N.jsx)(F.Z,{title:(0,N.jsxs)(M.Z,{children:[(0,N.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",ve.name||ve.uid]}),(0,N.jsx)(y.Z,{checked:!!ve.enabled,onChange:function(e){return Ae(ve.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(Z.Z,{}),onClick:function(e){var t;e.stopPropagation(),me(null!=(t=ve)?t:ve),ce(!0)},children:"编辑"}),(0,N.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),qe(ve)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,N.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,N.jsx)(C.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),ve.isDefault?(0,N.jsx)(b.Z,{color:"blue",children:"默认"}):null]}),extra:(0,N.jsxs)(M.Z,{children:[(0,N.jsx)(j.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Je()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,N.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:ye,type:"default",children:(0,N.jsx)(a.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,N.jsx)(h.ZP,{onClick:function(){ve&&(Ue(ve),Re.current=JSON.stringify(null!=ve?ve:{}),Fe(!1))},disabled:!Ce,children:(0,N.jsx)(a.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,N.jsx)(h.ZP,{type:"primary",loading:ke,onClick:Be,disabled:!Ce,children:(0,N.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,N.jsx)(s.Z,{activeKey:re,onChange:se,items:He})}):(0,N.jsx)(F.Z,{children:(0,N.jsx)(w.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,N.jsx)(V,{open:ue,onOpenChange:ce,orgUid:(null==t?void 0:t.uid)||"",record:pe,onSuccess:function(){ce(!1),We($)}})]})},ge=n(54596),fe=n(27401),pe=n(62954),me=n(44635),ve=n(2915),he=n(47268),xe=n(26608),ke=n(6677),we=n(66675),Me=function(e){var t,n,s,o=e.open,i=e.record,u=e.onClose,d=e.onSuccess,g=(0,a.useIntl)(),p=(0,J.Z)().translateString,v=(0,U.u)((function(e){return e.currentOrg})),x=(0,r.useMemo)((function(){return!(null==i||!i.uid)}),[i]),k=(0,r.useState)(!1),w=m()(k,2),M=w[0],b=w[1],y=(0,r.useState)([]),j=m()(y,2),Z=j[0],C=j[1],F=(0,r.useState)(!1),P=m()(F,2),I=P[0],W=P[1],q=(0,r.useState)(0),A=m()(q,2),D=A[0],O=A[1],E=(0,r.useRef)(),L=(0,we.E)((function(e){return e.agentResult})),z=(0,we.E)((function(e){return e.setAgentResult})),B=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==v?void 0:v.uid,searchText:t||""},e.next=5,(0,T.zc)(r);case 5:return s=e.sent,a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],C(a),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,W(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==v?void 0:v.uid]);return(0,r.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&null!=v&&v.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:v.uid},e.next=6,(0,ke._t)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?z(n):null!=n&&n.message&&R.yw.warning(n.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[o,null==v?void 0:v.uid,z]),(0,N.jsxs)(ve.a,{open:o,onOpenChange:function(e){e||u()},title:x?g.formatMessage({id:"workgroup.edit",defaultMessage:"编辑工作组"}):g.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),width:520,formRef:E,initialValues:x?{nickname:null==i?void 0:i.nickname,description:null==i?void 0:i.description,settingsUid:null==i||null===(t=i.settings)||void 0===t?void 0:t.uid,agents:(null==i||null===(n=i.agents)||void 0===n?void 0:n.map((function(e){return e.uid})))||[]}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:g.formatMessage({id:"save",defaultMessage:"保存"}),resetText:g.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return u()}}},onFinish:function(){var e=f()(c()().mark((function e(t){var n,r,s,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,R.yw.loading(g.formatMessage({id:x?"updating":"creating",defaultMessage:x?"Updating":"Creating"})),!x){e.next=9;break}return s=l()(l()(l()({},i),t),{},{agentUids:t.agents}),e.next=6,(0,me.W5)(s);case 6:r=e.sent,e.next=13;break;case 9:return a={nickname:t.nickname,description:t.description,settingsUid:t.settingsUid,orgUid:null==v?void 0:v.uid,agentUids:t.agents},e.next=12,(0,me.p0)(a);case 12:r=e.sent;case 13:if(R.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=21;break}return R.yw.success(g.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(r.data),u(),e.abrupt("return",!0);case 21:return R.yw.error((null===(o=r)||void 0===o?void 0:o.message)||g.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),R.yw.destroy(),R.yw.error(g.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,N.jsx)(K.Z,{name:"agents",label:g.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),placeholder:g.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),options:((null==L||null===(s=L.data)||void 0===s?void 0:s.content)||[]).map((function(e){return{value:e.uid,label:p(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0}}),(0,N.jsx)(K.Z,{name:"settingsUid",label:g.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),placeholder:g.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:D},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",B(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:I,notFoundContent:0===Z.length?(0,N.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,N.jsx)("div",{style:{marginBottom:8,color:"#999"},children:g.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,N.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,N.jsx)(S.Z,{}),onClick:function(){return b(!0)},children:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(S.Z,{}),onClick:function(){return b(!0)},title:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:g.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,N.jsx)(he.Z,{name:"nickname",label:g.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,N.jsx)(xe.Z,{name:"description",label:g.formatMessage({id:"workgroup.info.description",defaultMessage:"描述"})}),(0,N.jsx)(V,{open:M,onOpenChange:b,orgUid:(null==v?void 0:v.uid)||"",record:null,onSuccess:function(){b(!1),O((function(e){return e+1}))}})]})},be=function(e){var t,n=e.open,s=e.onClose,o=e.onSubmit,i=(0,a.useIntl)(),u=H.A.useForm(),l=m()(u,1)[0],d=(0,J.Z)().translateString,g=(0,U.u)((function(e){return e.currentOrg})),p=(0,we.E)((function(e){return e.agentResult})),v=(0,we.E)((function(e){return e.setAgentResult})),x=(0,r.useState)([]),k=m()(x,2),w=k[0],M=k[1],b=(0,r.useState)(!1),y=m()(b,2),j=y[0],Z=y[1],C=(0,r.useState)(!1),F=m()(C,2),P=F[0],I=F[1],W=(0,r.useState)(0),q=m()(W,2),A=q[0],D=q[1],O=(0,r.useState)([]),E=m()(O,2),L=E[0],B=E[1];(0,r.useEffect)((function(){n&&(l.setFieldsValue({nickname:"",agents:[]}),M([]))}),[n]);var X=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==g?void 0:g.uid,searchText:t||""},e.next=5,(0,T.zc)(r);case 5:return s=e.sent,console.log("queryWorkgroupSettingsByOrg response:",s,r),a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],B(a),!l.getFieldValue("settingsUid")&&a.length>0&&l.setFieldsValue({settingsUid:a[0].uid}),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,I(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==g?void 0:g.uid,l]);(0,r.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=g&&g.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:g.uid},e.next=6,(0,ke._t)(t);case 6:200===(null==(r=e.sent)?void 0:r.code)?v(r):null!=r&&r.message&&R.yw.warning(r.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,null==g?void 0:g.uid,v]);return(0,N.jsx)("div",{children:(0,N.jsxs)(z.Z,{title:i.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),open:n,forceRender:!0,onOk:function(){console.log("handleOk"),l.validateFields().then((function(e){console.log("form values:",e);var t={nickname:l.getFieldValue("nickname"),agentUids:l.getFieldValue("agents"),settingsUid:l.getFieldValue("settingsUid"),orgUid:null==g?void 0:g.uid};console.log("workgroup:",t),o(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),s()},children:[(0,N.jsxs)(H.A,{form:l,name:"wgForm",submitter:{render:function(e,t){return(0,N.jsx)(N.Fragment,{})}},children:[(0,N.jsx)(K.Z,{name:"settingsUid",label:i.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),rules:[{required:!0,message:i.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],placeholder:i.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:A},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",X(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:P,notFoundContent:0===L.length?(0,N.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,N.jsx)("div",{style:{marginBottom:8,color:"#999"},children:i.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,N.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,N.jsx)(S.Z,{}),onClick:function(){return Z(!0)},children:i.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,N.jsx)(h.ZP,{size:"small",icon:(0,N.jsx)(S.Z,{}),onClick:function(){return Z(!0)},title:i.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:i.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,N.jsx)(he.Z,{label:i.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),name:"nickname",rules:[{required:!0,message:i.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,N.jsx)(K.Z,{name:"agents",label:i.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),options:((null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[]).map((function(e){return{value:e.uid,label:d(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:i.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),value:w,onChange:function(e){console.log("selected ".concat(e)),M(e)}}})]}),(0,N.jsx)(V,{open:j,onOpenChange:Z,orgUid:(null==g?void 0:g.uid)||"",record:null,onSuccess:function(){Z(!1),D((function(e){return e+1}))}})]})})},ye=function(){var e=(0,a.useIntl)(),t=(0,r.useRef)(),n=(0,U.u)((function(e){return e.currentOrg})),s=(0,r.useState)(!1),o=m()(s,2),i=o[0],u=o[1],l=(0,r.useState)(!1),d=m()(l,2),g=d[0],p=d[1],v=(0,r.useState)(null),x=m()(v,2),k=x[0],w=x[1],M=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,N.jsx)(fe.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),dataIndex:"agents",width:320,hideInSearch:!0,ellipsis:!0,render:function(t,n){var r=(null==n?void 0:n.agents)||[];return null!=r&&r.length?(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,N.jsx)(fe.Z.Group,{max:{count:5},size:"small",children:r.map((function(e){var t;return(0,N.jsx)(pe.Z,{title:null==e?void 0:e.nickname,children:(0,N.jsx)(fe.Z,{src:null==e?void 0:e.avatar,children:null===(t=(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)||"?")||void 0===t?void 0:t.slice(0,1)})},null==e?void 0:e.uid)}))}),(0,N.jsx)("span",{style:{color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.map((function(e){return null==e?void 0:e.nickname})).filter(Boolean).join("、")})]}):(0,N.jsx)("span",{style:{color:"#999"},children:e.formatMessage({id:"workgroup.members.empty",defaultMessage:"暂无成员"})})}},{title:e.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,N.jsx)("a",{onClick:function(){w(n),u(!0)},children:n.settings.name||e.formatMessage({id:"workgroup.settings.configured",defaultMessage:"已配置"})}):(0,N.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){w(n),u(!0)},children:e.formatMessage({id:"workgroup.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,N.jsx)("a",{onClick:function(){return a.history.push("/service/channel")},children:e.formatMessage({id:"workgroup.get.code",defaultMessage:"获取工作组代码"})},"code"),(0,N.jsx)("a",{onClick:function(){w(r),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,N.jsx)(j.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:f()(c()().mark((function n(){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,me.zl)(r);case 4:s=n.sent,R.yw.destroy(),200===(null==s?void 0:s.code)?(R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(a=t.current)||void 0===a||a.reload()):R.yw.error((null==s?void 0:s.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),R.yw.destroy(),R.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,N.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(ge.Z,{columns:M,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,N.jsx)(h.ZP,{type:"primary",onClick:function(){w(null),p(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=f()(c()().mark((function e(t){var r,s,a,o,i,u,l,d,g,f,p,m,v,h,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,i=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,u=null!==(a=null==t?void 0:t.searchText)&&void 0!==a?a:"",l={pageNumber:o,pageSize:i,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:u},e.prev=4,e.next=7,(0,me.LE)(l);case 7:if(200!==(null==(d=e.sent)?void 0:d.code)){e.next=12;break}return h=(null==d||null===(g=d.data)||void 0===g?void 0:g.content)||[],x=null!==(f=null!==(p=null==d||null===(m=d.data)||void 0===m?void 0:m.totalElements)&&void 0!==p?p:null==d||null===(v=d.data)||void 0===v?void 0:v.numberOfElements)&&void 0!==f?f:h.length,e.abrupt("return",{data:h,total:x,success:!0});case 12:return e.abrupt("return",{data:[],total:0,success:!1});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"workgroup",defaultMessage:"Workgroup"})}),i&&(0,N.jsx)(Me,{open:i,record:k,onClose:function(){return u(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),g&&(0,N.jsx)(be,{open:g,onClose:function(){return p(!1)},onSubmit:function(){var n=f()(c()().mark((function n(r){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return R.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,me.p0)(r);case 4:s=n.sent,R.yw.destroy(),200===(null==s?void 0:s.code)?(R.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),p(!1),null===(a=t.current)||void 0===a||a.reload()):R.yw.error((null==s?void 0:s.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),R.yw.destroy(),R.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()})]})},je=function(){return(0,N.jsx)(s.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,N.jsx)(a.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,N.jsx)(ye,{})},{key:"settings",label:(0,N.jsx)(a.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,N.jsx)(ce,{})}]})}}}]);