"use strict"; var bd_kfe_kefu = { created: function () { bd_kfe_data.adminUid = bd_kfe_utils.getUrlParam("uid"), bd_kfe_data.workGroupWid = bd_kfe_utils.getUrlParam("wid"), bd_kfe_data.subDomain = bd_kfe_utils.getUrlParam("sub"), bd_kfe_data.type = bd_kfe_utils.getUrlParam("type"), bd_kfe_data.agentUid = bd_kfe_utils.getUrlParam("aid"), bd_kfe_data.closable = bd_kfe_utils.getUrlParam("closable"), bd_kfe_data.preload = bd_kfe_utils.getUrlParam("preload"), bd_kfe_data.column = bd_kfe_utils.getUrlParam("column"), bd_kfe_data.history = bd_kfe_utils.getUrlParam("history"), bd_kfe_data.postscript = bd_kfe_utils.getUrlParam("postscript"), bd_kfe_data.lang = bd_kfe_utils.getUrlParam("lang"), bd_kfe_data.color = bd_kfe_utils.getUrlParam("color"), bd_kfe_data.background = bd_kfe_utils.getUrlParam("background"), bd_kfe_data.nickname = null === bd_kfe_utils.getUrlParam("nickname") ? "" : bd_kfe_utils.getUrlParam("nickname"), bd_kfe_data.avatar = null === bd_kfe_utils.getUrlParam("avatar") ? "" : bd_kfe_utils.getUrlParam("avatar"), bd_kfe_data.v2robot = null === bd_kfe_utils.getUrlParam("v2robot") ? "0" : bd_kfe_utils.getUrlParam("v2robot"), "true" === localStorage.voiceMuted && ($("#bytedesk_sound").hide(), $("#bytedesk_mute").show(), bd_kfe_data.voiceMuted = !0) }, mounted: function () { if (bd_kfe_data.selfuser = bd_kfe_utils.getUrlParam("selfuser"), "1" === bd_kfe_data.selfuser) if ("1" !== localStorage.bd_kfe_selfuser) localStorage.bd_kfe_selfuser = "1", bd_kfe_httpapi.registerUser(); else { bd_kfe_data.passport.token.access_token = localStorage.bd_kfe_access_token, bd_kfe_data.uid = localStorage.bd_kfe_uid, bd_kfe_data.username = localStorage.bd_kfe_username, bd_kfe_data.nickname = localStorage.bd_kfe_nickname, bd_kfe_data.password = bd_kfe_data.username; var e = bd_kfe_utils.getUrlParam("username"); bd_kfe_data.username === e ? null !== bd_kfe_data.passport.token.access_token && void 0 !== bd_kfe_data.passport.token.access_token && "" !== bd_kfe_data.passport.token.access_token ? bd_kfe_httpapi.requestThread() : null !== bd_kfe_data.username && void 0 !== bd_kfe_data.username && "" !== bd_kfe_data.username && bd_kfe_httpapi.login() : bd_kfe_httpapi.registerUser() } else "1" === localStorage.bd_kfe_selfuser ? (localStorage.bd_kfe_selfuser = "0", bd_kfe_httpapi.requestUsername()) : (localStorage.bd_kfe_selfuser = "0", bd_kfe_data.passport.token.access_token = localStorage.bd_kfe_access_token, bd_kfe_data.uid = localStorage.bd_kfe_uid, bd_kfe_data.username = localStorage.bd_kfe_username, bd_kfe_data.nickname = localStorage.bd_kfe_nickname, bd_kfe_data.password = bd_kfe_data.username, null !== bd_kfe_data.passport.token.access_token && void 0 !== bd_kfe_data.passport.token.access_token && "" !== bd_kfe_data.passport.token.access_token ? bd_kfe_httpapi.requestThread() : null !== bd_kfe_data.username && void 0 !== bd_kfe_data.username && "" !== bd_kfe_data.username ? bd_kfe_httpapi.login() : bd_kfe_httpapi.requestUsername()); bd_kfe_httpapi.getBaseUrl() } }; !function () { $.support.cors = !0, String.prototype.startsWith || (String.prototype.startsWith = function (e, t) { return t = t || 0, this.indexOf(e, t) === t }), String.prototype.includes || (String.prototype.includes = function (e) { var t = !1; return -1 !== this.indexOf(e) && (t = !0), t }), String.prototype.endsWith || (String.prototype.endsWith = function (e) { return -1 !== this.indexOf(e, this.length - e.length) }), bd_kfe_utils.isMobile(), bd_kfe_kefu.created(), null != bd_kfe_data.color && bd_kfe_data.color.startsWith("#") && $("#pageChat .header").css("color", bd_kfe_data.color), null != bd_kfe_data.background && bd_kfe_data.background.startsWith("#") && $("#pageChat .header").css("background-color", bd_kfe_data.background), "1" === bd_kfe_data.closable && ($("#bytedesk_close").css("display", "block"), $("#bytedesk_max").css("display", "block"), $("#pageChat").css("border-radius", "10px")), "1" === bd_kfe_data.column && $("#bytedesk_left").css("width", "100%"), $("input[id=imagefile]").change(function (e) { bd_kfe_utils.printLog("upload:" + $(this).val(), $(this)), bd_kfe_utils.uploadImage($("input[id=imagefile]")[0].files[0]) }), $("input[id=videofile]").change(function (e) { bd_kfe_utils.printLog("upload:" + $(this).val(), $(this)), bd_kfe_utils.uploadVideo($("input[id=videofile]")[0].files[0]) }), $("input[id=filefile]").change(function (e) { bd_kfe_utils.printLog("upload file:" + $(this).val(), $(this)), bd_kfe_utils.uploadFile($("input[id=filefile]")[0].files[0]) }), $("#bytedesk_max").click(function () { window.parent.postMessage("bytedesk-max", "*") }), $("#bytedesk_minus").click(function () { window.parent.postMessage("bytedesk-minus", "*") }), $("#bytedesk_close").click(function () { window.parent.postMessage("bytedesk-close", "*") }), $("#bytedesk_sound").click(function () { $("#bytedesk_sound").hide(), $("#bytedesk_mute").show(), bd_kfe_data.voiceMuted = !0, localStorage.voiceMuted = !0 }), $("#bytedesk_mute").click(function () { $("#bytedesk_mute").hide(), $("#bytedesk_sound").show(), bd_kfe_data.voiceMuted = !1, localStorage.voiceMuted = !1 }), $("#bytedesk_qrcode").click(function () { $("#bytedesk_qrcode_overlay").show(), $("#bytedesk_qrcode_container").show(); var e = bd_kfe_data.getH5Url(); bd_kfe_httpapi.getShortUrl(e, function (e) { var t = e; console.log("shortUrl:", t), bd_kfe_utils.showQrcode(t) }, function (e) { console.log("error:", e), alert(e) }), console.log("h5Url:", e) }), $("#bytedesk_qrcode_overlay").click(function () { $("#bytedesk_qrcode_overlay").hide(), $("#bytedesk_qrcode_container").hide() }), $("#bytedesk_qrcode_close").click(function () { $("#bytedesk_qrcode_overlay").hide(), $("#bytedesk_qrcode_container").hide() }), $("#bytedesk_input-emoji").click(function () { bd_kfe_utils.switchEmotion() }), $("#bytedesk_upload_image").click(function () { bd_kfe_utils.showUploadImageDialog() }), $("#bytedesk_upload_video").click(function () { bd_kfe_utils.showUploadVideoDialog() }), $("#bytedesk_upload_file").click(function () { bd_kfe_utils.showUploadFileDialog() }), $("#bytedesk_more").click(function () { bd_kfe_httpapi.loadHistoryMessages(!0) }), $("#bytedesk_message_rate").click(function () { $("#bytedesk_rate").show(), $("#bytedesk_main").hide() }), $("#bytedesk_rate-close").click(function () { $("#bytedesk_rate").hide(), $("#bytedesk_main").show() }), $("#bytedesk_leave_close").click(function () { $("#bytedesk_leave").hide(), $("#bytedesk_main").show() }), $("#bytedesk_message_agent").click(function () { $("#bytedesk_loading").show(), bd_kfe_httpapi.requestAgent() }), $("#bytedesk_input_pc_send").click(function () { bd_kfe_stompapi.sendTextMessage() }), $("#bytedesk_input-mobile_send_btn").click(function () { bd_kfe_httpapi.sendMobile() }), $("#bytedesk_quick_question_arrow").click(function () { "↓" === $("#bytedesk_quick_question_arrow").text() ? ($("#bytedesk_quick_question_arrow").text("↑"), $(".bytedesk_quick_question-item").hide()) : ($("#bytedesk_quick_question_arrow").text("↓"), $(".bytedesk_quick_question-item").show()) }), bd_kfe_data.browserTitle = document.title, document.addEventListener("visibilitychange", function () { "hidden" === document.visibilityState ? bd_kfe_data.browserTabHidden = !0 : "visible" === document.visibilityState && (bd_kfe_data.browserTabHidden = !1, document.title = bd_kfe_data.browserTitle) }), document.getElementById("bytedesk_input_textarea").addEventListener("paste", function (e) { var t, a, d, i = e.clipboardData, _ = 0; if (i) { if (!(t = i.items)) return; for (a = t[0], d = i.types || []; _ < d.length; _++)if ("Files" === d[_]) { a = t[_]; break } a && "file" === a.kind && a.type.match(/^image\//i) && bd_kfe_utils.imgReader(a) } }), $("#bytedesk_input_textarea").val(""), document.attachEvent && g("pageChat").attachEvent("onselectstart", function () { return !1 }), $("#dragHeader").mousedown(function (e) { window.parent.postMessage({ msg: "bytedesk-mousedown", mouseX: e.clientX, mouseY: e.clientY }, "*") }), $(document).mousemove(function (e) { window.parent.postMessage({ msg: "bytedesk-mousemove", mouseX: e.clientX, mouseY: e.clientY }, "*") }), $("#dragHeader").mouseup(function (e) { window.parent.postMessage("bytedesk-mouseup", "*") }), window.addEventListener("online", function () { var e = "请在此输入文本内容或者粘贴QQ/微信截图或拖拽图片发送"; "en" === bd_kfe_data.lang && (e = "Please Input Text"), $("#bytedesk_input_textarea").attr("placeholder", e), bd_kfe_httpapi.loadMessagesUnread() }), window.addEventListener("offline", function () { var e = "网络已断开"; "en" === bd_kfe_data.lang && (e = "Network Disconnected"), $("#bytedesk_input_textarea").attr("placeholder", e) }), window.addEventListener("mouseup", function (e) { window.parent.postMessage("bytedesk-mouseup", "*") }), window.addEventListener("message", function (e) { }), bd_kfe_kefu.mounted(), bd_kfe_data.browserTitle = document.title, document.addEventListener("visibilitychange", function () { "hidden" === document.visibilityState ? bd_kfe_data.hidden = !0 : "visible" === document.visibilityState && (bd_kfe_data.hidden = !1, bd_kfe_utils.restoreBrowserTitle()) }, !1); var e = document.body; e.addEventListener("dragenter", function (e) { e.preventDefault() }, !1), e.addEventListener("dragleave", function (e) { e.preventDefault() }, !1), e.addEventListener("dragover", function (e) { e.preventDefault() }, !1), e.addEventListener("drop", function (e) { t(e) }, !1); var t = function (e) { e.preventDefault(); var t = e.dataTransfer.files; if (0 != t.length && -1 !== t[0].type.indexOf("image")) { var a = t[0]; if (/\.(gif|jpg|jpeg|png|webp|GIF|JPG|PNG|WEBP)$/.test(a.name)) return void bd_kfe_utils.uploadImage(a); bd_kfe_utils.uploadFile(a) } }; bd_kfe_utils.dragRightColumnInit(), bd_kfe_utils.requestNotification(), bd_kfe_stompapi.delaySendPreviewMessage = _.debounce(bd_kfe_stompapi.sendPreviewMessage, 500), null === bd_kfe_utils.getUrlParam("websiteurl") ? (bd_kfe_data.websiteUrl = window.location.href, bd_kfe_data.websiteTitle = document.title, bd_kfe_data.refererUrl = document.referrer) : (bd_kfe_data.websiteUrl = bd_kfe_utils.getUrlParam("websiteurl"), bd_kfe_data.websiteTitle = bd_kfe_utils.getUrlParam("websitetitle"), bd_kfe_data.refererUrl = bd_kfe_utils.getUrlParam("refererurl")) }();