/*
 * Copyright 2010 david varnes.
 *
 * Licensed under the Apache License, version 2.0 (the "License"); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at:
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.bytedesk.call.esl.client.transport;

/**
 * This parser provides a static helper method to split a standard Header field
 * into the name and value parts.
 * <p/>
 * This code was copied from the splitHeader() method in the HttpMessageDecoder class, which
 * is licensed under the Apache License version 2. (Original author: Trustin Lee.)
 */
public class HeaderParser {
	/**
	 * Split a header in the form
	 * <pre>
	 *   Header-Name: Some_header-value
	 * </pre>
	 * into a String array.
	 *
	 * @param sb the string header to parse
	 * @return a String[] array with header name at 0 and header value at 1
	 */
	public static String[] splitHeader(String sb) {
		final int length = sb.length();
		int nameStart;
		int nameEnd;
		int colonEnd;
		int valueStart;
		int valueEnd;

		nameStart = findNonWhitespace(sb, 0);
		for (nameEnd = nameStart; nameEnd < length; nameEnd++) {
			char ch = sb.charAt(nameEnd);
			if (ch == ':' || Character.isWhitespace(ch)) {
				break;
			}
		}

		for (colonEnd = nameEnd; colonEnd < length; colonEnd++) {
			if (sb.charAt(colonEnd) == ':') {
				colonEnd++;
				break;
			}
		}

		valueStart = findNonWhitespace(sb, colonEnd);
		if (valueStart == length) {
			return new String[]{
				sb.substring(nameStart, nameEnd),
				""
			};
		}

		valueEnd = findEndOfString(sb);
		return new String[]{
			sb.substring(nameStart, nameEnd),
			sb.substring(valueStart, valueEnd)
		};
	}

	private static int findNonWhitespace(String sb, int offset) {
		int result;
		for (result = offset; result < sb.length(); result++) {
			if (!Character.isWhitespace(sb.charAt(result))) {
				break;
			}
		}
		return result;
	}

	private static int findEndOfString(String sb) {
		int result;
		for (result = sb.length(); result > 0; result--) {
			if (!Character.isWhitespace(sb.charAt(result - 1))) {
				break;
			}
		}
		return result;
	}
}
