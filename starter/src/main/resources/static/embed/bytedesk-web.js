var BytedeskWeb=function(){"use strict";var En=Object.defineProperty;var Cn=(z,$,L)=>$ in z?En(z,$,{enumerable:!0,configurable:!0,writable:!0,value:L}):z[$]=L;var C=(z,$,L)=>Cn(z,typeof $!="symbol"?$+"":$,L);const z="ANONYMOUS",$="EVENT_BUS_SERVER_ERROR_500",L="EVENT_BUS_HTTP_ERROR",Rt="ACCESS_TOKEN",de="WEB_FLOAT",Ot="CLOSE_CHAT_WINDOW",Bt="MAXIMIZE_WINDOW",Ut="MINIMIZE_WINDOW",_t="RECEIVE_MESSAGE",Mt="INVITE_VISITOR",At="INVITE_VISITOR_ACCEPT",It="INVITE_VISITOR_REJECT",Wt="LOCALSTORAGE_RESPONSE",H="BYTEDESK_UID",V="BYTEDESK_VISITOR_UID",Q="BYTEDESK_BROWSE_FAILED_TIMESTAMP",Ft="BYTEDESK_LOG_ENABLE";let Y=null;const Lt=t=>{Y=t},P=()=>{const t=localStorage.getItem(Ft);return t===null?(Y==null?void 0:Y.isDebug)??!1:t==="true"},De=(()=>{const t=(Y==null?void 0:Y.isDebug)??!1;return t&&process.env.NODE_ENV==="production"?1:t?0:1})(),Ne=new Map,Pt=1e3,Nt=t=>{const e=Date.now(),i=Ne.get(t);return!i||e-i>Pt?(Ne.set(t,e),!0):!1},se=()=>{const t=new Date,e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return`${e}-${i}-${n} ${o}:${s}:${r}`},a={debug:(t,...e)=>{if(P()&&De<=0){if(!Nt(t))return;const i=se();e.length?console.debug(`${i} [DEBUG]: ${t}`,...e):console.debug(`${i} [DEBUG]: ${t}`)}},info:(t,...e)=>{if(P()&&De<=1){const i=se();e.length?console.info(`${i} [INFO]: ${t}`,...e):console.info(`${i} [INFO]: ${t}`)}},warn:(t,...e)=>{if(P()&&De<=2){const i=se();e.length?console.warn(`${i} [WARN]: ${t}`,...e):console.warn(`${i} [WARN]: ${t}`)}},error:(t,...e)=>{const i=se();e.length?console.error(`${i} [ERROR]: ${t}`,...e):console.error(`${i} [ERROR]: ${t}`)},debugIf:(t,...e)=>{P()&&a.debug(t,...e)},log:(t,...e)=>{if(P()){const i=se();e.length?console.log(`${i} [LOG]: ${t}`,...e):console.log(`${i} [LOG]: ${t}`)}},group:t=>{P()&&console.group(`[ByteDesk] ${t}`)},groupEnd:()=>{P()&&console.groupEnd()},table:t=>{P()&&console.table(t)},time:t=>{P()&&console.time(`[ByteDesk] ${t}`)},timeEnd:t=>{P()&&console.timeEnd(`[ByteDesk] ${t}`)}};class $t{constructor(e){C(this,"config");C(this,"bubble",null);C(this,"window",null);C(this,"inviteDialog",null);C(this,"contextMenu",null);C(this,"hideTimeout",null);C(this,"isVisible",!1);C(this,"isDragging",!1);C(this,"windowState","normal");C(this,"loopCount",0);C(this,"loopTimer",null);C(this,"initVisitorPromise",null);C(this,"getUnreadMessageCountPromise",null);C(this,"clearUnreadMessagesPromise",null);C(this,"feedbackTooltip",null);C(this,"feedbackDialog",null);C(this,"selectedText","");C(this,"selectionDebounceTimer",null);C(this,"isTooltipVisible",!1);C(this,"lastSelectionText","");C(this,"lastMouseEvent",null);C(this,"lastSelectionRect",null);this.config={...this.getDefaultConfig(),...e},Lt(this.config),this.setupApiUrl()}async setupApiUrl(){try{const{setApiUrl:e}=await Promise.resolve().then(()=>bn),i=this.config.apiUrl||"https://api.weiyuai.cn";e(i),a.info("API URL 已设置为:",i)}catch(e){a.error("设置API URL时出错:",e)}}getDefaultConfig(){return{isDebug:!1,forceRefresh:!1,htmlUrl:"https://cdn.weiyuai.cn/chat",apiUrl:"https://api.weiyuai.cn",placement:"bottom-right",marginBottom:20,marginSide:20,autoPopup:!1,inviteConfig:{show:!1,text:"邀请您加入对话",acceptText:"开始对话",rejectText:"稍后再说"},tabsConfig:{home:!1,messages:!0,help:!1,news:!1},bubbleConfig:{show:!0,icon:"👋",title:"需要帮助吗？",subtitle:"点击开始对话"},buttonConfig:{show:!0,width:60,height:60,onClick:()=>{this.showChat()}},feedbackConfig:{enabled:!1,trigger:"selection",showOnSelection:!0,selectionText:"文档反馈",buttonText:"文档反馈",dialogTitle:"提交意见反馈",placeholder:"请描述您的问题或优化建议",submitText:"提交反馈",cancelText:"取消",successMessage:"反馈已提交，感谢您的意见！",categoryNames:["错别字、拼写错误","链接跳转有问题","文档和实操过程不一致","文档难以理解","建议或其他"],requiredTypes:!1,typesSectionTitle:"问题类型",typesDescription:"（多选）",submitScreenshot:!0},chatConfig:{org:"df_org_uid",t:"2",sid:"df_rt_uid"},animation:{enabled:!0,duration:300,type:"ease"},theme:{mode:"system",textColor:"#ffffff",backgroundColor:"#0066FF"},window:{width:380,height:640},draggable:!1,locale:"zh-cn"}}async init(){var e,i;if(await this._initVisitor(),await this._browseVisitor(),this.createBubble(),this.createInviteDialog(),this.setupMessageListener(),this.setupResizeListener(),(e=this.config.feedbackConfig)!=null&&e.enabled&&(this.config.isDebug&&a.debug("BytedeskWeb: 开始初始化文档反馈功能，document.readyState:",document.readyState),this.initFeedbackFeature(),document.readyState!=="complete")){this.config.isDebug&&a.debug("BytedeskWeb: DOM未完全加载，设置备用初始化");const n=()=>{this.config.isDebug&&a.debug("BytedeskWeb: window load事件触发，重新初始化反馈功能"),this.initFeedbackFeature(),window.removeEventListener("load",n)};window.addEventListener("load",n);const o=()=>{this.config.isDebug&&a.debug("BytedeskWeb: DOMContentLoaded事件触发，重新初始化反馈功能"),setTimeout(()=>this.initFeedbackFeature(),100),document.removeEventListener("DOMContentLoaded",o)};document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",o)}this._getUnreadMessageCount(),this.config.autoPopup&&setTimeout(()=>{this.showChat()},this.config.autoPopupDelay||1e3),(i=this.config.inviteConfig)!=null&&i.show&&setTimeout(()=>{this.showInviteDialog()},this.config.inviteConfig.delay||3e3)}async _initVisitor(){var s,r,c,f;if(this.initVisitorPromise)return a.debug("访客初始化请求正在进行中，返回现有Promise"),this.initVisitorPromise;const e=localStorage.getItem(H),i=localStorage.getItem(V);a.debug("localUid: ",e),a.debug("localVisitorUid: ",i);const o=((s=this.config.chatConfig)==null?void 0:s.visitorUid)&&i?((r=this.config.chatConfig)==null?void 0:r.visitorUid)===i:!0;return e&&i&&o?(a.debug("访客信息相同，直接返回本地访客信息"),(f=(c=this.config).onVisitorInfo)==null||f.call(c,e||"",i||""),{uid:e,visitorUid:i}):(a.debug("开始创建访客初始化Promise"),this.initVisitorPromise=Promise.resolve().then(()=>Et).then(async({initVisitor:u})=>{var l,h,p,y,g,m,b,x,T,S,v,E,R,B,k,A,j,W,U,G,Z,ne,Ce;try{const oe={uid:String(((l=this.config.chatConfig)==null?void 0:l.uid)||e||""),visitorUid:String(((h=this.config.chatConfig)==null?void 0:h.visitorUid)||i||""),orgUid:String(((p=this.config.chatConfig)==null?void 0:p.org)||""),nickname:String(((y=this.config.chatConfig)==null?void 0:y.name)||""),avatar:String(((g=this.config.chatConfig)==null?void 0:g.avatar)||""),mobile:String(((m=this.config.chatConfig)==null?void 0:m.mobile)||""),email:String(((b=this.config.chatConfig)==null?void 0:b.email)||""),note:String(((x=this.config.chatConfig)==null?void 0:x.note)||""),extra:typeof((T=this.config.chatConfig)==null?void 0:T.extra)=="string"?this.config.chatConfig.extra:JSON.stringify(((S=this.config.chatConfig)==null?void 0:S.extra)||{}),vipLevel:String(((v=this.config.chatConfig)==null?void 0:v.vipLevel)||""),debug:((E=this.config.chatConfig)==null?void 0:E.debug)||!1,settingsUid:((R=this.config.chatConfig)==null?void 0:R.settingsUid)||"",loadHistory:((B=this.config.chatConfig)==null?void 0:B.loadHistory)||!1},I=await u(oe);return a.debug("访客初始化API响应:",I.data,oe),((k=I.data)==null?void 0:k.code)===200?((j=(A=I.data)==null?void 0:A.data)!=null&&j.uid&&(localStorage.setItem(H,I.data.data.uid),a.debug("已保存uid到localStorage:",I.data.data.uid)),(U=(W=I.data)==null?void 0:W.data)!=null&&U.visitorUid&&(localStorage.setItem(V,I.data.data.visitorUid),a.debug("已保存visitorUid到localStorage:",I.data.data.visitorUid)),(G=I.data)!=null&&G.data&&(a.debug("触发onVisitorInfo回调"),(ne=(Z=this.config).onVisitorInfo)==null||ne.call(Z,I.data.data.uid||"",I.data.data.visitorUid||"")),I.data.data):(a.error("访客初始化失败:",(Ce=I.data)==null?void 0:Ce.message),null)}catch(oe){return a.error("访客初始化出错:",oe),null}finally{a.debug("访客初始化Promise完成，清除引用"),this.initVisitorPromise=null}}),this.initVisitorPromise)}async _browseVisitor(){var e,i,n,o;try{const s=localStorage.getItem(Q);if(s){const R=parseInt(s),B=Date.now(),k=60*60*1e3;if(B-R<k){const A=Math.ceil((k-(B-R))/1e3/60);a.warn(`浏览记录发送失败后1小时内禁止发送，还需等待 ${A} 分钟`);return}else localStorage.removeItem(Q)}const r=window.location.href,c=document.title,f=document.referrer,u=navigator.userAgent,l=this.getBrowserInfo(u),h=this.getOSInfo(u),p=this.getDeviceInfo(u),y=`${screen.width}x${screen.height}`,g=new URLSearchParams(window.location.search),m=g.get("utm_source")||void 0,b=g.get("utm_medium")||void 0,x=g.get("utm_campaign")||void 0,T=localStorage.getItem(H),S={url:r,title:c,referrer:f,userAgent:u,operatingSystem:h,browser:l,deviceType:p,screenResolution:y,utmSource:m,utmMedium:b,utmCampaign:x,status:"ONLINE",visitorUid:String(((e=this.config.chatConfig)==null?void 0:e.uid)||T||""),orgUid:((i=this.config.chatConfig)==null?void 0:i.org)||""};if(!S.visitorUid){a.warn("访客uid为空，跳过browse操作");return}const{browse:v}=await Promise.resolve().then(()=>Et),E=await v(S);((n=E.data)==null?void 0:n.code)===200?localStorage.removeItem(Q):(a.error("浏览记录发送失败:",(o=E.data)==null?void 0:o.message),localStorage.setItem(Q,Date.now().toString()),a.warn("已记录浏览记录发送失败时间，1小时内将禁止再次发送"))}catch(s){a.error("发送浏览记录时出错:",s),localStorage.setItem(Q,Date.now().toString()),a.warn("已记录浏览记录发送失败时间，1小时内将禁止再次发送")}}getBrowserInfo(e){return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":e.includes("Opera")?"Opera":"Unknown"}getOSInfo(e){return e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown"}getDeviceInfo(e){return e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":"Desktop"}async _getUnreadMessageCount(){return this.getUnreadMessageCountPromise?(a.debug("获取未读消息数请求正在进行中，返回现有Promise"),this.getUnreadMessageCountPromise):(this.getUnreadMessageCountPromise=Promise.resolve().then(()=>Ct).then(async({getUnreadMessageCount:e})=>{var i,n,o,s,r;try{const c=String(((i=this.config.chatConfig)==null?void 0:i.visitorUid)||""),f=localStorage.getItem(H),u=localStorage.getItem(V),l={uid:f||"",visitorUid:c||u||"",orgUid:((n=this.config.chatConfig)==null?void 0:n.org)||""};if(l.uid==="")return 0;const h=await e(l);return((o=h.data)==null?void 0:o.code)===200?((s=h==null?void 0:h.data)!=null&&s.data&&((r=h==null?void 0:h.data)==null?void 0:r.data)>0?this.showUnreadBadge(h.data.data):this.clearUnreadBadge(),h.data.data||0):0}catch(c){return a.error("获取未读消息数出错:",c),0}finally{this.getUnreadMessageCountPromise=null}}),this.getUnreadMessageCountPromise)}async getUnreadMessageCount(){return this._getUnreadMessageCount()}async initVisitor(){return this._initVisitor()}async browseVisitor(){return this._browseVisitor()}clearBrowseFailedLimit(){localStorage.removeItem(Q),a.info("已清除浏览记录发送失败的限制")}clearVisitorInfo(){localStorage.removeItem(H),localStorage.removeItem(V),a.info("已清除本地访客信息")}async forceInitVisitor(){return this.clearVisitorInfo(),this.initVisitorPromise=null,this._initVisitor()}showUnreadBadge(e){if(a.debug("showUnreadBadge() 被调用，count:",e),(this.config.buttonConfig||{}).show===!1){a.debug("showUnreadBadge: buttonConfig.show 为 false，不显示角标");return}if(!this.bubble){a.debug("showUnreadBadge: bubble 不存在");return}let n=this.bubble.querySelector(".bytedesk-unread-badge");n?a.debug("showUnreadBadge: 更新现有角标"):(a.debug("showUnreadBadge: 创建新的角标"),n=document.createElement("div"),n.className="bytedesk-unread-badge",n.style.cssText=`
        position: absolute;
        top: -8px;
        right: -8px;
        min-width: 18px;
        height: 18px;
        padding: 0 4px;
        background: #ff4d4f;
        color: white;
        font-size: 12px;
        font-weight: bold;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        border: 2px solid white;
      `,this.bubble.appendChild(n)),n.textContent=e>99?"99+":e.toString(),a.debug("showUnreadBadge: 角标数字已更新为",n.textContent)}clearUnreadBadge(){if(!this.bubble){a.debug("clearUnreadBadge: bubble 不存在");return}const e=this.bubble.querySelector(".bytedesk-unread-badge");e?e.remove():a.debug("clearUnreadBadge: 未找到角标")}async clearUnreadMessages(){return this.clearUnreadMessagesPromise?(a.debug("清空未读消息请求正在进行中，返回现有Promise"),this.clearUnreadMessagesPromise):(this.clearUnreadMessagesPromise=Promise.resolve().then(()=>Ct).then(async({clearUnreadMessages:e})=>{var i,n;try{const o=String(((i=this.config.chatConfig)==null?void 0:i.visitorUid)||""),s=localStorage.getItem(H),r=localStorage.getItem(V),c={uid:s||"",visitorUid:o||r||"",orgUid:((n=this.config.chatConfig)==null?void 0:n.org)||""},f=await e(c);return a.debug("清空未读消息数:",f.data,c),f.data.code===200?(a.info("清空未读消息数成功:",f.data),this.clearUnreadBadge(),f.data.data||0):(a.error("清空未读消息数失败:",f.data.message),0)}catch(o){return a.error("清空未读消息数出错:",o),0}finally{this.clearUnreadMessagesPromise=null}}),this.clearUnreadMessagesPromise)}createBubble(){var h,p,y,g,m,b,x,T,S,v,E,R,B;if(this.bubble&&document.body.contains(this.bubble)){a.debug("createBubble: 气泡已存在，不重复创建");return}this.bubble&&!document.body.contains(this.bubble)&&(a.debug("createBubble: 清理已存在的 bubble 引用"),this.bubble=null);const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      ${this.config.placement==="bottom-left"?"left":"right"}: ${this.config.marginSide}px;
      bottom: ${this.config.marginBottom}px;
      display: flex;
      flex-direction: column;
      align-items: ${this.config.placement==="bottom-left"?"flex-start":"flex-end"};
      gap: 10px;
      z-index: 9999;
    `;let i=null;if((h=this.config.bubbleConfig)!=null&&h.show){i=document.createElement("div"),i.style.cssText=`
        background: ${((p=this.config.theme)==null?void 0:p.mode)==="dark"?"#1f2937":"white"};
        color: ${((y=this.config.theme)==null?void 0:y.mode)==="dark"?"#e5e7eb":"#1f2937"};
        padding: 12px 16px;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        max-width: 220px;
        margin-bottom: 8px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
        position: relative;
      `;const k=document.createElement("div");k.style.cssText=`
        display: flex;
        align-items: center;
        gap: 8px;
        flex-direction: ${this.config.placement==="bottom-left"?"row":"row-reverse"};
      `,k.setAttribute("data-placement",this.config.placement||"bottom-right");const A=document.createElement("span");A.textContent=((g=this.config.bubbleConfig)==null?void 0:g.icon)||"",A.style.fontSize="20px",k.appendChild(A);const j=document.createElement("div"),W=document.createElement("div");W.textContent=((m=this.config.bubbleConfig)==null?void 0:m.title)||"",W.style.fontWeight="bold",W.style.color=((b=this.config.theme)==null?void 0:b.mode)==="dark"?"#e5e7eb":"#1f2937",W.style.marginBottom="4px",W.style.textAlign=this.config.placement==="bottom-left"?"left":"right",j.appendChild(W);const U=document.createElement("div");U.textContent=((x=this.config.bubbleConfig)==null?void 0:x.subtitle)||"",U.style.fontSize="0.9em",U.style.color=((T=this.config.theme)==null?void 0:T.mode)==="dark"?"#9ca3af":"#4b5563",U.style.textAlign=this.config.placement==="bottom-left"?"left":"right",j.appendChild(U),k.appendChild(j),i.appendChild(k);const G=document.createElement("div");G.style.cssText=`
        position: absolute;
        bottom: -6px;
        ${this.config.placement==="bottom-left"?"left: 24px":"right: 24px"};
        width: 12px;
        height: 12px;
        background: ${((S=this.config.theme)==null?void 0:S.mode)==="dark"?"#1f2937":"white"};
        transform: rotate(45deg);
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      `;const Z=document.createElement("div");Z.style.cssText=`
        position: absolute;
        bottom: 0;
        ${this.config.placement==="bottom-left"?"left: 18px":"right: 18px"};
        width: 24px;
        height: 12px;
        background: ${((v=this.config.theme)==null?void 0:v.mode)==="dark"?"#1f2937":"white"};
      `,i.appendChild(G),i.appendChild(Z),e.appendChild(i),setTimeout(()=>{i&&(i.style.opacity="1",i.style.transform="translateY(0)")},500)}this.bubble=document.createElement("button");const n=this.config.buttonConfig||{},o=n.width||60,s=n.height||60,r=Math.min(o,s)/2,c=((E=this.config.theme)==null?void 0:E.mode)==="dark",f=c?"#3B82F6":"#0066FF",u=((R=this.config.theme)==null?void 0:R.backgroundColor)||f;this.bubble.style.cssText=`
      background-color: ${u};
      width: ${o}px;
      height: ${s}px;
      border-radius: ${r}px;
      border: none;
      cursor: ${this.config.draggable?"move":"pointer"};
      display: ${n.show===!1?"none":"flex"};
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 16px rgba(0, 0, 0, ${c?"0.3":"0.12"});
      transition: all 0.3s ease;
      outline: none;
      position: relative;
      user-select: none;
    `;const l=document.createElement("div");if(l.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    `,n.icon){const k=document.createElement("span");k.textContent=n.icon,k.style.fontSize=`${s*.4}px`,l.appendChild(k)}else{const k=document.createElement("div");k.innerHTML=`
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 14.663 3.04094 17.0829 4.73812 18.875L2.72681 21.1705C2.44361 21.4937 2.67314 22 3.10288 22H12Z" 
                fill="white"/>
        </svg>
      `,l.appendChild(k)}if(n.text){const k=document.createElement("span");k.textContent=n.text,k.style.cssText=`
        color: ${((B=this.config.theme)==null?void 0:B.textColor)||"#ffffff"};
        font-size: ${s*.25}px;
        white-space: nowrap;
      `,l.appendChild(k)}if(this.bubble.appendChild(l),this.bubble.addEventListener("mouseenter",()=>{this.bubble.style.transform="scale(1.1)"}),this.bubble.addEventListener("mouseleave",()=>{this.bubble.style.transform="scale(1)"}),e.appendChild(this.bubble),this.config.draggable){let k=0,A=0,j=0,W=0;this.bubble.addEventListener("mousedown",U=>{U.button===0&&(this.isDragging=!0,k=U.clientX,A=U.clientY,j=e.offsetLeft,W=e.offsetTop,e.style.transition="none")}),document.addEventListener("mousemove",U=>{if(!this.isDragging)return;U.preventDefault();const G=U.clientX-k,Z=U.clientY-A,ne=j+G,Ce=W+Z,oe=window.innerHeight-e.offsetHeight;ne<=window.innerWidth/2?(e.style.left=`${Math.max(0,ne)}px`,e.style.right="auto",e.style.alignItems="flex-start",this.config.placement="bottom-left"):(e.style.right=`${Math.max(0,window.innerWidth-ne-e.offsetWidth)}px`,e.style.left="auto",e.style.alignItems="flex-end",this.config.placement="bottom-right"),e.style.bottom=`${Math.min(Math.max(0,window.innerHeight-Ce-e.offsetHeight),oe)}px`}),document.addEventListener("mouseup",()=>{this.isDragging&&(this.isDragging=!1,e.style.transition="all 0.3s ease",this.config.marginSide=parseInt(this.config.placement==="bottom-left"?e.style.left:e.style.right)||20,this.config.marginBottom=parseInt(e.style.bottom||"20"))})}this.bubble.addEventListener("click",()=>{if(!this.isDragging){a.debug("bubble click");const k=this.bubble.messageElement;k instanceof HTMLElement&&(k.style.display="none"),this.showChat()}}),this.bubble.messageElement=i,document.body.appendChild(e),this.bubble.addEventListener("contextmenu",k=>{this.showContextMenu(k)}),document.addEventListener("click",()=>{this.hideContextMenu()})}createChatWindow(){var c,f,u,l,h,p;if(this.window&&document.body.contains(this.window)){a.debug("createChatWindow: 聊天窗口已存在，不重复创建");return}this.window&&!document.body.contains(this.window)&&(a.debug("createChatWindow: 清理已存在的 window 引用"),this.window=null),this.window=document.createElement("div");const e=window.innerWidth<=768,i=window.innerWidth,n=window.innerHeight,o=Math.min(((c=this.config.window)==null?void 0:c.width)||i*.9,i*.9),s=Math.min(((f=this.config.window)==null?void 0:f.height)||n*.9,n*.9);e?this.window.style.cssText=`
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 90vh;
        display: none;
        z-index: 10000;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        overflow: hidden;
        transition: all ${(u=this.config.animation)==null?void 0:u.duration}ms ${(l=this.config.animation)==null?void 0:l.type};
      `:this.window.style.cssText=`
        position: fixed;
        ${this.config.placement==="bottom-right"?"right":"left"}: ${this.config.marginSide}px;
        bottom: ${this.config.marginBottom}px;
        width: ${o}px;
        height: ${s}px;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        display: none;
        overflow: hidden;
        z-index: 10000;
        transition: all ${(h=this.config.animation)==null?void 0:h.duration}ms ${(p=this.config.animation)==null?void 0:p.type};
      `;const r=document.createElement("iframe");r.style.cssText=`
      width: 100%;
      height: 100%;
      border: none;
      display: block; // 添加这一行
      vertical-align: bottom; // 添加这一行
    `,r.src=this.generateChatUrl(),a.debug("iframe.src: ",r.src),this.window.appendChild(r),document.body.appendChild(this.window)}generateChatUrl(e="messages"){a.debug("this.config: ",this.config,e);const i=new URLSearchParams,n=localStorage.getItem(H),o=localStorage.getItem(V);n&&n.trim()!==""&&i.append("uid",n),o&&o.trim()!==""&&i.append("visitorUid",o),Object.entries(this.config.chatConfig||{}).forEach(([r,c])=>{if(r==="debug"&&c===!0)i.append("debug","1");else if(r==="loadHistory"&&c===!0)i.append("loadHistory","1");else if(r==="goodsInfo"||r==="orderInfo")try{typeof c=="string"?i.append(r,c):i.append(r,JSON.stringify(c))}catch(f){a.error(`Error processing ${r}:`,f)}else if(r==="extra")try{let f=typeof c=="string"?JSON.parse(c):c;f.goodsInfo&&delete f.goodsInfo,f.orderInfo&&delete f.orderInfo,Object.keys(f).length>0&&i.append(r,JSON.stringify(f))}catch(f){a.error("Error processing extra parameter:",f)}else r!=="debug"&&r!=="loadHistory"&&i.append(r,String(c))}),Object.entries(this.config.browseConfig||{}).forEach(([r,c])=>{i.append(r,String(c))}),Object.entries(this.config.theme||{}).forEach(([r,c])=>{i.append(r,String(c))}),i.append("lang",this.config.locale||"zh-cn");const s=`${this.config.htmlUrl}?${i.toString()}`;return a.debug("chat url: ",s),s}setupMessageListener(){window.addEventListener("message",e=>{switch(e.data.type){case Ot:this.hideChat();break;case Bt:this.toggleMaximize();break;case Ut:this.minimizeWindow();break;case _t:a.debug("RECEIVE_MESSAGE");break;case Mt:a.debug("INVITE_VISITOR");break;case At:a.debug("INVITE_VISITOR_ACCEPT");break;case It:a.debug("INVITE_VISITOR_REJECT");break;case Wt:this.handleLocalStorageData(e);break}})}handleLocalStorageData(e){var r,c;const{uid:i,visitorUid:n}=e.data;a.debug("handleLocalStorageData 被调用",i,n,e.data);const o=localStorage.getItem(H),s=localStorage.getItem(V);if(o===i&&s===n){a.debug("handleLocalStorageData: 值相同，跳过设置");return}localStorage.setItem(H,i),localStorage.setItem(V,n),a.debug("handleLocalStorageData: 已更新localStorage",{uid:i,visitorUid:n}),(c=(r=this.config).onVisitorInfo)==null||c.call(r,i,n)}sendMessageToIframe(e){var n;const i=(n=this.window)==null?void 0:n.querySelector("iframe");i&&i.contentWindow&&i.contentWindow.postMessage(e,"*")}showChat(e){var i,n;if(e&&(this.config={...this.config,...e},this.window&&(document.body.removeChild(this.window),this.window=null)),this.window||this.createChatWindow(),this.window){const o=window.innerWidth<=768;if(this.window.style.display="block",this.config.forceRefresh){const s=this.window.querySelector("iframe");s&&(s.src=this.generateChatUrl())}if(this.setupResizeListener(),o&&this.window&&(this.window.style.transform="translateY(100%)",requestAnimationFrame(()=>{this.window&&(this.window.style.transform="translateY(0)")})),this.isVisible=!0,this.bubble){this.bubble.style.display="none";const s=this.bubble.messageElement;s instanceof HTMLElement&&(s.style.display="none")}}this.hideInviteDialog(),(n=(i=this.config).onShowChat)==null||n.call(i)}hideChat(){var e,i,n,o,s;if(this.window){if(window.innerWidth<=768?(this.window.style.transform="translateY(100%)",setTimeout(()=>{this.window&&(this.window.style.display="none")},((e=this.config.animation)==null?void 0:e.duration)||300)):this.window.style.display="none",this.isVisible=!1,this.bubble){this.bubble.style.display=((i=this.config.buttonConfig)==null?void 0:i.show)===!1?"none":"inline-flex";const c=this.bubble.messageElement;c instanceof HTMLElement&&(c.style.display=((n=this.config.bubbleConfig)==null?void 0:n.show)===!1?"none":"block")}(s=(o=this.config).onHideChat)==null||s.call(o)}}minimizeWindow(){this.window&&(this.windowState="minimized",this.window.style.display="none",this.hideChat())}toggleMaximize(){this.window&&window.open(this.generateChatUrl(),"_blank")}setupResizeListener(){const e=()=>{var r,c;if(!this.window||!this.isVisible)return;const n=window.innerWidth<=768,o=window.innerWidth,s=window.innerHeight;if(n)Object.assign(this.window.style,{left:"0",bottom:"0",width:"100%",height:"90vh",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"});else{let f=this.windowState==="maximized"?o:Math.min(((r=this.config.window)==null?void 0:r.width)||o*.9,o*.9),u=this.windowState==="maximized"?s:Math.min(((c=this.config.window)==null?void 0:c.height)||s*.9,s*.9);const l=this.config.placement==="bottom-right"?this.config.marginSide:void 0,h=this.config.placement==="bottom-left"?this.config.marginSide:void 0;Object.assign(this.window.style,{width:`${f}px`,height:`${u}px`,right:l?`${l}px`:"auto",left:h?`${h}px`:"auto",bottom:`${this.config.marginBottom}px`,borderRadius:this.windowState==="maximized"?"0":"12px"})}};let i;window.addEventListener("resize",()=>{clearTimeout(i),i=window.setTimeout(e,100)}),e()}destroy(){var i;const e=(i=this.bubble)==null?void 0:i.parentElement;e&&document.body.contains(e)&&(document.body.removeChild(e),this.bubble=null),this.window&&document.body.contains(this.window)&&(document.body.removeChild(this.window),this.window=null),window.removeEventListener("resize",this.setupResizeListener.bind(this)),this.loopTimer&&(window.clearTimeout(this.loopTimer),this.loopTimer=null),this.inviteDialog&&document.body.contains(this.inviteDialog)&&(document.body.removeChild(this.inviteDialog),this.inviteDialog=null),this.contextMenu&&document.body.contains(this.contextMenu)&&(document.body.removeChild(this.contextMenu),this.contextMenu=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.selectionDebounceTimer&&(clearTimeout(this.selectionDebounceTimer),this.selectionDebounceTimer=null),this.destroyFeedbackFeature()}createInviteDialog(){var c,f,u,l,h,p;if(this.inviteDialog&&document.body.contains(this.inviteDialog)){a.debug("createInviteDialog: 邀请框已存在，不重复创建");return}this.inviteDialog&&!document.body.contains(this.inviteDialog)&&(a.debug("createInviteDialog: 清理已存在的 inviteDialog 引用"),this.inviteDialog=null);const e=((c=this.config.theme)==null?void 0:c.mode)==="dark";if(this.inviteDialog=document.createElement("div"),this.inviteDialog.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: ${e?"#1f2937":"white"};
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, ${e?"0.3":"0.15"});
      z-index: 10001;
      display: none;
      max-width: 300px;
      text-align: center;
    `,(f=this.config.inviteConfig)!=null&&f.icon){const y=document.createElement("div");y.style.cssText=`
        font-size: 32px;
        margin-bottom: 12px;
        color: ${e?"#e5e7eb":"#333"};
      `,y.textContent=this.config.inviteConfig.icon,this.inviteDialog.appendChild(y)}const i=document.createElement("div");i.style.cssText=`
      margin-bottom: 16px;
      color: ${e?"#e5e7eb":"#333"};
    `,i.textContent=((u=this.config.inviteConfig)==null?void 0:u.text)||"需要帮助吗？点击开始对话",this.inviteDialog.appendChild(i);const n=document.createElement("div");n.style.cssText=`
      display: flex;
      gap: 10px;
      justify-content: center;
    `;const o=document.createElement("button");o.textContent=((l=this.config.inviteConfig)==null?void 0:l.acceptText)||"开始对话";const s=((h=this.config.theme)==null?void 0:h.backgroundColor)||(e?"#3B82F6":"#0066FF");o.style.cssText=`
      padding: 8px 16px;
      background: ${s};
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    `,o.onclick=()=>{var y,g;this.hideInviteDialog(),this.showChat(),(g=(y=this.config.inviteConfig)==null?void 0:y.onAccept)==null||g.call(y)};const r=document.createElement("button");r.textContent=((p=this.config.inviteConfig)==null?void 0:p.rejectText)||"稍后再说",r.style.cssText=`
      padding: 8px 16px;
      background: ${e?"#374151":"#f5f5f5"};
      color: ${e?"#d1d5db":"#666"};
      border: none;
      border-radius: 4px;
      cursor: pointer;
    `,r.onclick=()=>{var y,g;this.hideInviteDialog(),(g=(y=this.config.inviteConfig)==null?void 0:y.onReject)==null||g.call(y),this.handleInviteLoop()},n.appendChild(o),n.appendChild(r),this.inviteDialog.appendChild(n),document.body.appendChild(this.inviteDialog)}showInviteDialog(){var e,i;this.inviteDialog&&(this.inviteDialog.style.display="block",(i=(e=this.config.inviteConfig)==null?void 0:e.onOpen)==null||i.call(e))}hideInviteDialog(){var e,i;a.debug("hideInviteDialog before"),this.inviteDialog&&(this.inviteDialog.style.display="none",(i=(e=this.config.inviteConfig)==null?void 0:e.onClose)==null||i.call(e),a.debug("hideInviteDialog after"))}handleInviteLoop(){const{loop:e,loopDelay:i=3e3,loopCount:n=1/0}=this.config.inviteConfig||{};!e||this.loopCount>=n-1||(this.loopTimer&&window.clearTimeout(this.loopTimer),this.loopTimer=window.setTimeout(()=>{this.loopCount++,this.showInviteDialog()},i))}showButton(){if(this.bubble&&this.bubble.style.display!=="none"){a.debug("showButton: 按钮已经显示，无需重复显示");return}this.bubble?(this.bubble.style.display="inline-flex",a.debug("showButton: 按钮已显示")):a.debug("showButton: bubble 不存在，需要先创建")}hideButton(){this.bubble&&(this.bubble.style.display="none")}showBubble(){if(this.bubble){const e=this.bubble.messageElement;if(e instanceof HTMLElement){if(e.style.display!=="none"&&e.style.opacity!=="0"){a.debug("showBubble: 气泡已经显示，无需重复显示");return}e.style.display="block",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},100),a.debug("showBubble: 气泡已显示")}else a.debug("showBubble: messageElement 不存在")}else a.debug("showBubble: bubble 不存在")}hideBubble(){if(this.bubble){const e=this.bubble.messageElement;e instanceof HTMLElement&&(e.style.opacity="0",e.style.transform="translateY(10px)",setTimeout(()=>{e.style.display="none"},300))}}createContextMenu(){this.contextMenu=document.createElement("div"),this.contextMenu.style.cssText=`
      position: fixed;
      background: white;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 4px 0;
      display: none;
      z-index: 10000;
      min-width: 150px;
    `;const e=[{text:"隐藏按钮和气泡",onClick:()=>{this.hideButton(),this.hideBubble()}},{text:"切换位置",onClick:()=>{this.togglePlacement()}}];e.forEach((i,n)=>{const o=document.createElement("div");if(o.style.cssText=`
        padding: 8px 16px;
        cursor: pointer;
        color: #333;
        font-size: 14px;
        
        &:hover {
          background: #f5f5f5;
        }
      `,o.textContent=i.text,o.onclick=()=>{i.onClick(),this.hideContextMenu()},this.contextMenu&&this.contextMenu.appendChild(o),n<e.length-1){const s=document.createElement("div");s.style.cssText=`
          height: 1px;
          background: #eee;
          margin: 4px 0;
        `,this.contextMenu&&this.contextMenu.appendChild(s)}}),document.body.appendChild(this.contextMenu)}showContextMenu(e){if(e.preventDefault(),this.contextMenu||this.createContextMenu(),this.contextMenu){this.contextMenu.style.visibility="hidden",this.contextMenu.style.display="block";const i=this.contextMenu.offsetWidth,n=this.contextMenu.offsetHeight;let o=e.clientX,s=e.clientY;o+i>window.innerWidth&&(o=o-i),s+n>window.innerHeight&&(s=s-n),o=Math.max(0,o),s=Math.max(0,s),this.contextMenu.style.left=`${o}px`,this.contextMenu.style.top=`${s}px`,this.contextMenu.style.visibility="visible"}}hideContextMenu(){this.contextMenu&&(this.contextMenu.style.display="none")}togglePlacement(){var i,n;if(!this.bubble)return;this.config.placement=this.config.placement==="bottom-left"?"bottom-right":"bottom-left";const e=this.bubble.parentElement;e&&(e.style.left=this.config.placement==="bottom-left"?`${this.config.marginSide}px`:"auto",e.style.right=this.config.placement==="bottom-right"?`${this.config.marginSide}px`:"auto",e.style.alignItems=this.config.placement==="bottom-left"?"flex-start":"flex-end",this.window&&this.isVisible&&(this.window.style.left=this.config.placement==="bottom-left"?`${this.config.marginSide}px`:"auto",this.window.style.right=this.config.placement==="bottom-right"?`${this.config.marginSide}px`:"auto"),(n=(i=this.config).onConfigChange)==null||n.call(i,{placement:this.config.placement}))}initFeedbackFeature(){var e,i;if(a.debug("BytedeskWeb: 初始化文档反馈功能开始"),a.debug("BytedeskWeb: feedbackConfig:",this.config.feedbackConfig),a.debug("BytedeskWeb: feedbackConfig.enabled:",(e=this.config.feedbackConfig)==null?void 0:e.enabled),!((i=this.config.feedbackConfig)!=null&&i.enabled)){a.debug("BytedeskWeb: 文档反馈功能未启用，退出初始化");return}(this.feedbackTooltip||this.feedbackDialog)&&(a.debug("BytedeskWeb: 反馈功能已存在，先销毁再重新创建"),this.destroyFeedbackFeature()),this.config.feedbackConfig.trigger==="selection"||this.config.feedbackConfig.trigger==="both"?(a.debug("BytedeskWeb: 触发器匹配，设置文本选择监听器"),a.debug("BytedeskWeb: 触发器类型:",this.config.feedbackConfig.trigger),this.setupTextSelectionListener()):(a.debug("BytedeskWeb: 触发器不匹配，跳过文本选择监听器"),a.debug("BytedeskWeb: 触发器类型:",this.config.feedbackConfig.trigger)),a.debug("BytedeskWeb: 开始创建反馈提示框"),this.createFeedbackTooltip(),a.debug("BytedeskWeb: 开始创建反馈对话框"),this.createFeedbackDialog(),a.debug("BytedeskWeb: 文档反馈功能初始化完成"),a.debug("BytedeskWeb: 反馈提示框存在:",!!this.feedbackTooltip),a.debug("BytedeskWeb: 反馈对话框存在:",!!this.feedbackDialog)}setupTextSelectionListener(){a.debug("BytedeskWeb: 设置文本选择监听器"),document.addEventListener("mouseup",e=>{this.lastMouseEvent=e,a.debug("BytedeskWeb: mouseup事件触发",e),this.handleTextSelectionWithDebounce(e)},{capture:!0,passive:!0}),document.addEventListener("selectionchange",()=>{if(!this.lastMouseEvent){a.debug("BytedeskWeb: selectionchange事件触发（无鼠标事件）");const e=new MouseEvent("mouseup",{clientX:window.innerWidth/2,clientY:window.innerHeight/2});this.handleTextSelectionWithDebounce(e)}}),document.addEventListener("keyup",e=>{(e.shiftKey||e.ctrlKey||e.metaKey)&&(a.debug("BytedeskWeb: keyup事件触发（带修饰键）",e),this.handleTextSelectionWithDebounce(e))},{capture:!0,passive:!0}),document.addEventListener("click",e=>{const i=e.target;i!=null&&i.closest("[data-bytedesk-feedback]")||this.hideFeedbackTooltip()}),a.debug("BytedeskWeb: 文本选择监听器设置完成")}handleTextSelectionWithDebounce(e){this.config.isDebug&&a.debug("BytedeskWeb: handleTextSelectionWithDebounce被调用 - 防抖机制生效"),this.selectionDebounceTimer&&(clearTimeout(this.selectionDebounceTimer),this.config.isDebug&&a.debug("BytedeskWeb: 清除之前的防抖定时器")),this.selectionDebounceTimer=setTimeout(()=>{this.config.isDebug&&a.debug("BytedeskWeb: 防抖延迟结束，开始处理文本选择"),this.handleTextSelection(e)},200)}handleTextSelection(e){var o,s;this.config.isDebug&&a.debug("BytedeskWeb: handleTextSelection被调用");const i=window.getSelection();if(this.config.isDebug&&(a.debug("BytedeskWeb: window.getSelection()结果:",i),a.debug("BytedeskWeb: selection.rangeCount:",i==null?void 0:i.rangeCount)),!i||i.rangeCount===0){this.config.isDebug&&a.debug("BytedeskWeb: 没有选择或范围为0，隐藏提示"),this.hideFeedbackTooltip();return}const n=i.toString().trim();if(this.config.isDebug&&(a.debug("BytedeskWeb: 检测到文本选择:",`"${n}"`),a.debug("BytedeskWeb: 选中文本长度:",n.length)),n===this.lastSelectionText&&this.isTooltipVisible){this.config.isDebug&&a.debug("BytedeskWeb: 文本选择未变化且提示框已显示，跳过处理");return}if(n.length===0){this.config.isDebug&&a.debug("BytedeskWeb: 选中文本为空，隐藏提示"),this.hideFeedbackTooltip();return}if(n.length<3){this.config.isDebug&&a.debug("BytedeskWeb: 选中文本太短，忽略:",`"${n}"`),this.hideFeedbackTooltip();return}this.selectedText=n,this.lastSelectionText=n;try{const r=i.getRangeAt(0);this.lastSelectionRect=r.getBoundingClientRect(),this.config.isDebug&&a.debug("BytedeskWeb: 存储选中文本位置:",this.lastSelectionRect)}catch(r){this.config.isDebug&&a.warn("BytedeskWeb: 获取选中文本位置失败:",r),this.lastSelectionRect=null}this.config.isDebug&&a.debug("BytedeskWeb: 设置selectedText为:",`"${n}"`),(o=this.config.feedbackConfig)!=null&&o.showOnSelection?(this.config.isDebug&&a.debug("BytedeskWeb: 配置允许显示选择提示，调用showFeedbackTooltip"),this.showFeedbackTooltip(this.lastMouseEvent||void 0)):this.config.isDebug&&(a.debug("BytedeskWeb: 配置不允许显示选择提示"),a.debug("BytedeskWeb: feedbackConfig.showOnSelection:",(s=this.config.feedbackConfig)==null?void 0:s.showOnSelection))}createFeedbackTooltip(){var i;if(this.config.isDebug&&a.debug("BytedeskWeb: createFeedbackTooltip被调用"),this.feedbackTooltip&&document.body.contains(this.feedbackTooltip)){this.config.isDebug&&a.debug("BytedeskWeb: 反馈提示框已存在且在DOM中，跳过创建");return}this.feedbackTooltip&&!document.body.contains(this.feedbackTooltip)&&(this.config.isDebug&&a.debug("BytedeskWeb: 提示框变量存在但不在DOM中，重置变量"),this.feedbackTooltip=null),this.feedbackTooltip=document.createElement("div"),this.feedbackTooltip.setAttribute("data-bytedesk-feedback","tooltip"),this.feedbackTooltip.style.cssText=`
      position: fixed;
      background: #2e88ff;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      cursor: pointer;
      z-index: 999999;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateY(-100%);
      margin-top: -8px;
      user-select: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      display: none;
    `;const e=((i=this.config.feedbackConfig)==null?void 0:i.selectionText)||"文档反馈";this.config.isDebug&&a.debug("BytedeskWeb: 提示框文本:",e),this.feedbackTooltip.innerHTML=`
      <span style="margin-right: 4px;">📝</span>
      ${e}
    `,this.feedbackTooltip.addEventListener("click",async n=>{this.config.isDebug&&(a.debug("BytedeskWeb: 反馈提示框被点击"),a.debug("BytedeskWeb: 点击时选中文字:",this.selectedText)),n.stopPropagation(),n.preventDefault();try{await this.showFeedbackDialog(),this.config.isDebug&&a.debug("BytedeskWeb: 对话框显示完成，现在隐藏提示框"),this.hideFeedbackTooltip()}catch(o){this.config.isDebug&&a.error("BytedeskWeb: 显示对话框时出错:",o)}}),document.body.appendChild(this.feedbackTooltip),this.config.isDebug&&(a.debug("BytedeskWeb: 反馈提示框已创建并添加到页面"),a.debug("BytedeskWeb: 提示框元素:",this.feedbackTooltip))}showFeedbackTooltip(e){this.config.isDebug&&(a.debug("BytedeskWeb: showFeedbackTooltip被调用"),a.debug("BytedeskWeb: feedbackTooltip存在:",!!this.feedbackTooltip),a.debug("BytedeskWeb: selectedText存在:",!!this.selectedText));const i=this.feedbackTooltip&&document.body.contains(this.feedbackTooltip);if(this.config.isDebug&&a.debug("BytedeskWeb: feedbackTooltip在DOM中:",i),(!this.feedbackTooltip||!i)&&(this.config.isDebug&&a.debug("BytedeskWeb: 提示框不存在或已从DOM中移除，重新创建"),this.createFeedbackTooltip()),!this.feedbackTooltip||!this.selectedText){this.config.isDebug&&a.debug("BytedeskWeb: 提示框或选中文本不存在，退出显示");return}const n=window.getSelection();if(!n||n.rangeCount===0){this.config.isDebug&&a.debug("BytedeskWeb: 无有效选择，无法计算位置");return}const o=n.getRangeAt(0);let s;try{const b=document.createRange();b.setStart(o.startContainer,o.startOffset);let x=o.startOffset;const T=o.startContainer.textContent||"";if(o.startContainer.nodeType===Node.TEXT_NODE){for(;x<Math.min(T.length,o.endOffset);){const S=document.createRange();S.setStart(o.startContainer,o.startOffset),S.setEnd(o.startContainer,x+1);const v=S.getBoundingClientRect(),E=b.getBoundingClientRect();if(Math.abs(v.top-E.top)>5)break;x++}b.setEnd(o.startContainer,Math.max(x,o.startOffset+1)),s=b.getBoundingClientRect()}else s=o.getBoundingClientRect()}catch(b){this.config.isDebug&&a.debug("BytedeskWeb: 获取第一行位置失败，使用整个选择区域:",b),s=o.getBoundingClientRect()}this.config.isDebug&&a.debug("BytedeskWeb: 选中文本第一行位置信息:",{left:s.left,top:s.top,right:s.right,bottom:s.bottom,width:s.width,height:s.height});const r=120,c=40,f=15,u=5;let l=s.left+u,h=s.top-c-f;const p=window.innerWidth,y=window.innerHeight,g=window.scrollX,m=window.scrollY;l<10&&(l=10),l+r>p-10&&(l=p-r-10),h<m+10&&(h=s.bottom+f,this.config.isDebug&&a.debug("BytedeskWeb: 上方空间不足，调整为显示在选中文字第一行下方")),l+=g,h+=m,this.config.isDebug&&a.debug("BytedeskWeb: 最终提示框位置:",{x:l,y:h,说明:"显示在选中文字第一行左上角上方，增加间距避免遮挡",verticalOffset:f,horizontalOffset:u,选中区域:s,视口信息:{viewportWidth:p,viewportHeight:y,scrollX:g,scrollY:m}}),this.feedbackTooltip.style.position="absolute",this.feedbackTooltip.style.left=l+"px",this.feedbackTooltip.style.top=h+"px",this.feedbackTooltip.style.display="block",this.feedbackTooltip.style.visibility="visible",this.feedbackTooltip.style.opacity="0",this.feedbackTooltip.style.zIndex="999999",this.config.isDebug&&a.debug("BytedeskWeb: 提示框位置已设置，样式:",{position:this.feedbackTooltip.style.position,left:this.feedbackTooltip.style.left,top:this.feedbackTooltip.style.top,display:this.feedbackTooltip.style.display,visibility:this.feedbackTooltip.style.visibility,opacity:this.feedbackTooltip.style.opacity,zIndex:this.feedbackTooltip.style.zIndex}),this.isTooltipVisible=!0,setTimeout(()=>{this.feedbackTooltip&&this.isTooltipVisible&&(this.feedbackTooltip.style.opacity="1",this.config.isDebug&&a.debug("BytedeskWeb: 提示框透明度设置为1，应该可见了"))},10)}hideFeedbackTooltip(){const e=this.feedbackTooltip&&document.body.contains(this.feedbackTooltip);if(this.config.isDebug&&(a.debug("BytedeskWeb: hideFeedbackTooltip被调用"),a.debug("BytedeskWeb: feedbackTooltip存在:",!!this.feedbackTooltip),a.debug("BytedeskWeb: feedbackTooltip在DOM中:",e)),!this.feedbackTooltip||!e){this.isTooltipVisible=!1,this.lastSelectionText="",this.config.isDebug&&a.debug("BytedeskWeb: 提示框不存在或不在DOM中，仅重置状态");return}this.isTooltipVisible=!1,this.lastSelectionText="",this.feedbackTooltip.style.opacity="0",setTimeout(()=>{this.feedbackTooltip&&document.body.contains(this.feedbackTooltip)&&!this.isTooltipVisible?(this.feedbackTooltip.style.display="none",this.feedbackTooltip.style.visibility="hidden",this.config.isDebug&&a.debug("BytedeskWeb: 提示框已隐藏")):this.config.isDebug&&this.isTooltipVisible&&a.debug("BytedeskWeb: 跳过隐藏操作，提示框状态已改变为可见")},100)}createFeedbackDialog(){var i,n,o,s,r,c,f,u;if(this.config.isDebug&&a.debug("BytedeskWeb: createFeedbackDialog被调用"),this.feedbackDialog&&document.body.contains(this.feedbackDialog)){this.config.isDebug&&a.debug("BytedeskWeb: 反馈对话框已存在且在DOM中，跳过创建");return}this.feedbackDialog&&!document.body.contains(this.feedbackDialog)&&(this.config.isDebug&&a.debug("BytedeskWeb: 对话框变量存在但不在DOM中，重置变量"),this.feedbackDialog=null),this.feedbackDialog=document.createElement("div"),this.feedbackDialog.setAttribute("data-bytedesk-feedback","dialog"),this.feedbackDialog.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000000;
      display: none;
      justify-content: center;
      align-items: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    `;const e=document.createElement("div");e.style.cssText=`
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
    `,e.innerHTML=`
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #333;">
          ${((i=this.config.feedbackConfig)==null?void 0:i.dialogTitle)||"提交意见反馈"}
        </h3>
        <button type="button" data-action="close" style="
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #999;
          line-height: 1;
          padding: 0;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">×</button>
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #555;">选中的文字：</label>
        <div id="bytedesk-selected-text" style="
          background: #f5f5f5;
          padding: 12px;
          border-radius: 6px;
          border-left: 4px solid #2e88ff;
          font-size: 14px;
          line-height: 1.5;
          color: #333;
          max-height: 100px;
          overflow-y: auto;
        "></div>
      </div>

      ${(n=this.config.feedbackConfig)!=null&&n.categoryNames&&this.config.feedbackConfig.categoryNames.length>0?`
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
          <span style="color: #ff4d4f;">*</span> ${((o=this.config.feedbackConfig)==null?void 0:o.typesSectionTitle)||"问题类型"} ${((s=this.config.feedbackConfig)==null?void 0:s.typesDescription)||"（多选）"}
        </label>
        <div id="bytedesk-feedback-types" style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
          margin-bottom: 8px;
        ">
          ${this.config.feedbackConfig.categoryNames.map(l=>`
            <label style="
              display: flex;
              align-items: flex-start;
              gap: 8px;
              cursor: pointer;
              padding: 8px;
              border-radius: 4px;
              transition: background-color 0.2s;
            " onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'">
              <input type="checkbox" name="feedback-type" value="${l}" style="
                margin: 2px 0 0 0;
                cursor: pointer;
              ">
              <span style="
                font-size: 14px;
                line-height: 1.4;
                color: #333;
                flex: 1;
              ">${l}</span>
            </label>
          `).join("")}
        </div>
      </div>
      `:""}

      ${((r=this.config.feedbackConfig)==null?void 0:r.submitScreenshot)!==!1?`
      <div style="margin-bottom: 16px;">
        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 500; color: #555;">
          <input type="checkbox" id="bytedesk-submit-screenshot" checked style="cursor: pointer;">
          提交截图内容
        </label>
        <div id="bytedesk-screenshot-container" style="
          border: 2px dashed #ddd;
          border-radius: 6px;
          padding: 20px;
          text-align: center;
          color: #999;
          min-height: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
          gap: 8px;
        ">
          <div style="font-size: 24px;">📷</div>
          <div>正在生成截图预览...</div>
          <div style="font-size: 12px; color: #666;">截图将在提交时上传到服务器</div>
        </div>
      </div>
      `:""}

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
          <span style="color: #ff4d4f;">*</span> 问题描述
        </label>
        <textarea id="bytedesk-feedback-text" placeholder="${((c=this.config.feedbackConfig)==null?void 0:c.placeholder)||"请详细描述您的问题或优化建议"}" style="
          width: 100%;
          min-height: 120px;
          padding: 12px;
          border: 1px solid #ddd;
          border-radius: 6px;
          font-size: 14px;
          font-family: inherit;
          resize: vertical;
          box-sizing: border-box;
        "></textarea>
      </div>

      <div style="display: flex; justify-content: flex-end; gap: 12px;">
        <button type="button" data-action="cancel" style="
          background: #f5f5f5;
          color: #666;
          border: 1px solid #ddd;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          font-family: inherit;
        ">${((f=this.config.feedbackConfig)==null?void 0:f.cancelText)||"取消"}</button>
        <button type="button" data-action="submit" style="
          background: #2e88ff;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          font-family: inherit;
        ">${((u=this.config.feedbackConfig)==null?void 0:u.submitText)||"提交反馈"}</button>
      </div>

      <div style="margin-top: 12px; text-align: center; font-size: 12px; color: #999;">
        <a href="https://www.weiyuai.cn/" target="_blank" rel="noopener noreferrer" style="color: #aaaaaa; text-decoration: none;">
           微语技术支持
        </a>
      </div>
    `,e.addEventListener("click",l=>{var y,g;switch(l.target.getAttribute("data-action")){case"close":case"cancel":this.hideFeedbackDialog(),(g=(y=this.config.feedbackConfig)==null?void 0:y.onCancel)==null||g.call(y);break;case"submit":this.submitFeedback();break}}),this.feedbackDialog.appendChild(e),this.feedbackDialog.addEventListener("click",l=>{var h,p;l.target===this.feedbackDialog&&(this.hideFeedbackDialog(),(p=(h=this.config.feedbackConfig)==null?void 0:h.onCancel)==null||p.call(h))}),document.addEventListener("keydown",l=>{var h,p,y;l.key==="Escape"&&((h=this.feedbackDialog)==null?void 0:h.style.display)==="flex"&&(this.hideFeedbackDialog(),(y=(p=this.config.feedbackConfig)==null?void 0:p.onCancel)==null||y.call(p))}),document.body.appendChild(this.feedbackDialog)}async showFeedbackDialog(){this.config.isDebug&&(a.debug("BytedeskWeb: showFeedbackDialog被调用"),a.debug("BytedeskWeb: feedbackDialog存在:",!!this.feedbackDialog));const e=this.feedbackDialog&&document.body.contains(this.feedbackDialog);if(this.config.isDebug&&a.debug("BytedeskWeb: feedbackDialog在DOM中:",e),(!this.feedbackDialog||!e)&&(this.config.isDebug&&a.debug("BytedeskWeb: 对话框不存在或已从DOM中移除，重新创建"),this.createFeedbackDialog()),!this.feedbackDialog){this.config.isDebug&&a.debug("BytedeskWeb: 对话框创建失败，退出显示");return}this.config.isDebug&&a.debug("BytedeskWeb: 开始填充对话框内容");const i=this.feedbackDialog.querySelector("#bytedesk-selected-text");i&&(i.textContent=this.selectedText||"",this.config.isDebug&&a.debug("BytedeskWeb: 已填充选中文字:",this.selectedText));const n=this.feedbackDialog.querySelector("#bytedesk-feedback-text");n&&(n.value=""),this.feedbackDialog.style.display="flex",this.config.isDebug&&(a.debug("BytedeskWeb: 对话框已设置为显示状态"),a.debug("BytedeskWeb: 对话框样式:",{display:this.feedbackDialog.style.display,visibility:this.feedbackDialog.style.visibility,zIndex:this.feedbackDialog.style.zIndex}));try{await this.generateScreenshotPreview(),this.config.isDebug&&a.debug("BytedeskWeb: 截图预览生成完成")}catch(o){this.config.isDebug&&a.error("BytedeskWeb: 截图预览生成失败:",o)}}hideFeedbackDialog(){this.feedbackDialog&&(this.feedbackDialog.style.display="none")}async generateAndUploadScreenshot(){var e;try{let i;const n=(e=this.feedbackDialog)==null?void 0:e.screenshotCanvas;if(n)this.config.isDebug&&a.debug("BytedeskWeb: 使用已生成的截图canvas"),i=n;else{const o=await this.loadHtml2Canvas();if(!o)return this.config.isDebug&&a.debug("BytedeskWeb: html2canvas加载失败，跳过截图"),null;this.config.isDebug&&a.debug("BytedeskWeb: 重新生成截图");const s=this.calculateScreenshotArea();i=await o(document.body,{height:s.height,width:s.width,x:s.x,y:s.y,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",scale:1,ignoreElements:r=>r.hasAttribute("data-bytedesk-feedback")||r.closest("[data-bytedesk-feedback]")!==null})}return new Promise(o=>{i.toBlob(async s=>{var r;if(!s){a.error("无法生成截图blob"),o(null);return}try{const c=`screenshot_${Date.now()}.jpg`,f=new File([s],c,{type:"image/jpeg"});this.config.isDebug&&a.debug("BytedeskWeb: 截图生成成功，文件大小:",Math.round(s.size/1024),"KB");const{uploadScreenshot:u}=await Promise.resolve().then(()=>kn),l=await u(f,{orgUid:((r=this.config.chatConfig)==null?void 0:r.org)||"",isDebug:this.config.isDebug});this.config.isDebug&&a.debug("BytedeskWeb: 截图上传成功，URL:",l),o(l)}catch(c){a.error("截图上传失败:",c),o(null)}},"image/jpeg",.8)})}catch(i){return a.error("生成截图失败:",i),null}}async generateScreenshotPreview(){var i;const e=(i=this.feedbackDialog)==null?void 0:i.querySelector("#bytedesk-screenshot-container");if(e)try{const n=await this.loadHtml2Canvas();if(!n){e.innerHTML=`
          <div style="color: #999; text-align: center; padding: 20px; flex-direction: column; gap: 8px; display: flex; align-items: center;">
            <div style="font-size: 24px;">📷</div>
            <div>截图功能暂时不可用</div>
            <div style="font-size: 12px; color: #666;">网络连接问题或资源加载失败</div>
          </div>
        `;return}e.innerHTML="正在生成截图预览...",this.config.isDebug&&a.debug("BytedeskWeb: 开始生成截图预览");const o=this.calculateScreenshotArea(),s=await n(document.body,{height:o.height,width:o.width,x:o.x,y:o.y,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",scale:1,ignoreElements:u=>u.hasAttribute("data-bytedesk-feedback")||u.closest("[data-bytedesk-feedback]")!==null}),r=document.createElement("img");r.src=s.toDataURL("image/jpeg",.8),r.style.cssText=`
        max-width: 100%;
        max-height: 200px;
        border-radius: 4px;
        border: 1px solid #ddd;
        cursor: pointer;
      `,r.onclick=()=>{const u=document.createElement("img");u.src=r.src,u.style.cssText=`
          max-width: 90vw;
          max-height: 90vh;
          border-radius: 8px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        `;const l=document.createElement("div");l.style.cssText=`
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0,0,0,0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000001;
          cursor: pointer;
        `;const h=document.createElement("div");h.style.cssText=`
          position: absolute;
          top: 20px;
          right: 20px;
          color: white;
          font-size: 14px;
          background: rgba(0,0,0,0.6);
          padding: 8px 12px;
          border-radius: 4px;
          user-select: none;
        `,h.textContent="点击任意位置关闭",l.appendChild(h),l.appendChild(u),l.onclick=()=>document.body.removeChild(l),document.body.appendChild(l)};const c=document.createElement("div");c.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      `,c.appendChild(r);const f=document.createElement("div");f.style.cssText=`
        font-size: 12px;
        color: #666;
        text-align: center;
      `,f.innerHTML="点击图片可放大查看<br/>提交时将自动上传此截图",c.appendChild(f),e.innerHTML="",e.appendChild(c),this.feedbackDialog.screenshotCanvas=s,this.config.isDebug&&a.debug("BytedeskWeb: 截图预览生成成功")}catch(n){a.error("生成截图预览失败:",n),e.innerHTML=`
        <div style="color: #ff6b6b; text-align: center; flex-direction: column; gap: 8px; display: flex; align-items: center;">
          <div style="font-size: 24px;">⚠️</div>
          <div>截图预览生成失败</div>
          <div style="font-size: 12px; margin-top: 4px; color: #999;">请检查页面权限或网络连接</div>
        </div>
      `}}calculateScreenshotArea(){let e={height:window.innerHeight,width:window.innerWidth,x:0,y:0,scrollX:0,scrollY:0};try{let i=this.lastSelectionRect;if(!i){const n=window.getSelection();n&&n.rangeCount>0&&(i=n.getRangeAt(0).getBoundingClientRect())}if(i&&i.width>0&&i.height>0){const n=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,s=i.left+n,r=i.top+o,c=Math.min(800,window.innerWidth),f=Math.min(600,window.innerHeight);let u=s-c/2,l=r-f/2;const h=document.documentElement.scrollWidth,p=document.documentElement.scrollHeight;u=Math.max(0,Math.min(u,h-c)),l=Math.max(0,Math.min(l,p-f)),e={height:f,width:c,x:u,y:l,scrollX:0,scrollY:0},this.config.isDebug&&a.debug("BytedeskWeb: 选中文本截图区域:",{selectedRect:i,absolutePosition:{left:s,top:r},captureArea:{x:u,y:l,width:c,height:f},pageSize:{width:h,height:p}})}else if(this.lastMouseEvent){const n=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,s=this.lastMouseEvent.clientX+n,r=this.lastMouseEvent.clientY+o,c=Math.min(800,window.innerWidth),f=Math.min(600,window.innerHeight);let u=s-c/2,l=r-f/2;const h=document.documentElement.scrollWidth,p=document.documentElement.scrollHeight;u=Math.max(0,Math.min(u,h-c)),l=Math.max(0,Math.min(l,p-f)),e={height:f,width:c,x:u,y:l,scrollX:0,scrollY:0},this.config.isDebug&&a.debug("BytedeskWeb: 鼠标位置截图区域:",{mousePosition:{x:this.lastMouseEvent.clientX,y:this.lastMouseEvent.clientY},absolutePosition:{x:s,y:r},captureArea:{x:u,y:l,width:c,height:f}})}}catch(i){this.config.isDebug&&a.warn("BytedeskWeb: 计算截图区域失败，使用默认区域:",i)}return e}async loadHtml2Canvas(){try{return window.html2canvas?window.html2canvas:await this.loadHtml2CanvasFromCDN()}catch(e){return this.config.isDebug&&a.warn("html2canvas 加载失败:",e),null}}async loadHtml2CanvasFromCDN(){return new Promise((e,i)=>{if(window.html2canvas){e(window.html2canvas);return}const n=document.createElement("script");n.src=this.config.apiUrl+"/assets/js/html2canvas.min.js",n.onload=()=>{window.html2canvas?e(window.html2canvas):i(new Error("html2canvas 加载失败"))},n.onerror=()=>{i(new Error("无法从CDN加载html2canvas"))},document.head.appendChild(n)})}async submitFeedback(){var c,f,u,l,h,p,y;const e=(c=this.feedbackDialog)==null?void 0:c.querySelector("#bytedesk-feedback-text"),i=(e==null?void 0:e.value.trim())||"";if(!i){alert("请填写反馈内容"),e==null||e.focus();return}const n=[],o=(f=this.feedbackDialog)==null?void 0:f.querySelectorAll('input[name="feedback-type"]:checked');if(o&&o.forEach(g=>{n.push(g.value)}),(u=this.config.feedbackConfig)!=null&&u.requiredTypes&&n.length===0){alert("请至少选择一个问题类型");return}const s=(l=this.feedbackDialog)==null?void 0:l.querySelector(".bytedesk-feedback-submit"),r=(s==null?void 0:s.textContent)||"提交反馈";s&&(s.disabled=!0,s.textContent="提交中...",s.style.opacity="0.6");try{const g=(h=this.feedbackDialog)==null?void 0:h.querySelector("#bytedesk-submit-screenshot"),m=(g==null?void 0:g.checked)!==!1;let b=[];if(m){this.config.isDebug&&a.debug("BytedeskWeb: 开始生成和上传截图"),s&&(s.textContent="正在生成截图...");const T=await this.generateAndUploadScreenshot();T&&(b.push(T),this.config.isDebug&&a.debug("BytedeskWeb: 截图上传成功:",T)),s&&(s.textContent="正在提交反馈...")}const x={selectedText:this.selectedText,...b.length>0&&{images:b},content:i,url:window.location.href,title:document.title,userAgent:navigator.userAgent,visitorUid:localStorage.getItem("bytedesk_uid")||"",orgUid:((p=this.config.chatConfig)==null?void 0:p.org)||"",...n.length>0&&{categoryNames:n.join(",")}};(y=this.config.feedbackConfig)!=null&&y.onSubmit?this.config.feedbackConfig.onSubmit(x):await this.submitFeedbackToServer(x),this.showFeedbackSuccess(),setTimeout(()=>{this.hideFeedbackDialog()},2e3)}catch(g){a.error("提交反馈失败:",g),alert("提交失败，请稍后重试")}finally{s&&(s.disabled=!1,s.textContent=r,s.style.opacity="1")}}async submitFeedbackToServer(e){try{const{submitFeedback:i}=await Promise.resolve().then(()=>Sn),n=await i(e);return this.config.isDebug&&a.debug("反馈提交响应:",n),n}catch(i){throw a.error("提交反馈到服务器失败:",i),i}}showFeedbackSuccess(){var i;if(!this.feedbackDialog)return;const e=this.feedbackDialog.querySelector("div > div");e&&(e.innerHTML=`
      <div style="text-align: center; padding: 40px 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">✅</div>
        <h3 style="margin: 0 0 12px 0; color: #28a745;">
          ${((i=this.config.feedbackConfig)==null?void 0:i.successMessage)||"反馈已提交，感谢您的意见！"}
        </h3>
        <div style="color: #666; font-size: 14px;">
          我们会认真处理您的反馈，不断改进产品体验
        </div>
      </div>
    `)}showDocumentFeedback(e){var i;if(!((i=this.config.feedbackConfig)!=null&&i.enabled)){a.warn("文档反馈功能未启用");return}e&&(this.selectedText=e),this.showFeedbackDialog()}reinitFeedbackFeature(){this.config.isDebug&&a.debug("BytedeskWeb: 重新初始化反馈功能"),this.destroyFeedbackFeature(),this.initFeedbackFeature()}forceInitFeedbackFeature(){return a.debug("BytedeskWeb: 强制初始化反馈功能被调用"),a.debug("BytedeskWeb: 当前配置:",this.config.feedbackConfig),a.debug("BytedeskWeb: isDebug:",this.config.isDebug),this.config.feedbackConfig||(a.debug("BytedeskWeb: 创建默认反馈配置"),this.config.feedbackConfig={enabled:!0,trigger:"selection",showOnSelection:!0,selectionText:"📝 文档反馈",dialogTitle:"提交意见反馈",placeholder:"请详细描述您发现的问题、改进建议或其他意见...",submitText:"提交反馈",cancelText:"取消",successMessage:"感谢您的反馈！我们会认真处理您的意见。"}),this.config.feedbackConfig.enabled||(a.debug("BytedeskWeb: 启用反馈配置"),this.config.feedbackConfig.enabled=!0),a.debug("BytedeskWeb: 销毁现有反馈功能"),this.destroyFeedbackFeature(),a.debug("BytedeskWeb: 重新初始化反馈功能"),this.initFeedbackFeature(),a.debug("BytedeskWeb: 强制初始化完成，检查结果:"),a.debug("- showDocumentFeedback方法存在:",typeof this.showDocumentFeedback=="function"),a.debug("- testTextSelection方法存在:",typeof this.testTextSelection=="function"),a.debug("- 反馈提示框存在:",!!this.feedbackTooltip),a.debug("- 反馈对话框存在:",!!this.feedbackDialog),a.debug("- 反馈提示框DOM存在:",!!document.querySelector('[data-bytedesk-feedback="tooltip"]')),a.debug("- 反馈对话框DOM存在:",!!document.querySelector('[data-bytedesk-feedback="dialog"]')),{success:!!(this.feedbackTooltip&&this.feedbackDialog),methods:{showDocumentFeedback:typeof this.showDocumentFeedback=="function",testTextSelection:typeof this.testTextSelection=="function"},elements:{tooltip:!!this.feedbackTooltip,dialog:!!this.feedbackDialog,tooltipDOM:!!document.querySelector('[data-bytedesk-feedback="tooltip"]'),dialogDOM:!!document.querySelector('[data-bytedesk-feedback="dialog"]')}}}testTextSelection(e="测试选中文字"){this.config.isDebug&&a.debug("BytedeskWeb: 测试文本选择功能，模拟选中文字:",`"${e}"`),this.selectedText=e;try{const i=document.createElement("div");i.textContent=e,i.style.cssText=`
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background: #f0f0f0;
        border: 2px dashed #ccc;
        border-radius: 8px;
        font-size: 16px;
        z-index: 1000;
        pointer-events: none;
      `,document.body.appendChild(i);const n=document.createRange();n.selectNodeContents(i);const o=window.getSelection();o&&(o.removeAllRanges(),o.addRange(n),this.config.isDebug&&a.debug("BytedeskWeb: 已创建模拟文本选择"),this.feedbackTooltip?this.showFeedbackTooltip():a.error("BytedeskWeb: 反馈提示框不存在，无法测试"),setTimeout(()=>{o&&o.removeAllRanges(),document.body.contains(i)&&document.body.removeChild(i),this.hideFeedbackTooltip()},5e3))}catch(i){a.error("BytedeskWeb: 创建测试选择失败:",i)}}getDebugInfo(){return{config:this.config,feedbackConfig:this.config.feedbackConfig,feedbackTooltip:!!this.feedbackTooltip,feedbackDialog:!!this.feedbackDialog,selectedText:this.selectedText,methods:{showDocumentFeedback:typeof this.showDocumentFeedback,testTextSelection:typeof this.testTextSelection,forceInitFeedbackFeature:typeof this.forceInitFeedbackFeature}}}destroyFeedbackFeature(){this.feedbackTooltip&&(this.feedbackTooltip.remove(),this.feedbackTooltip=null),this.feedbackDialog&&(this.feedbackDialog.remove(),this.feedbackDialog=null),this.selectedText=""}}function $e(t,e){return function(){return t.apply(e,arguments)}}const{toString:Ht}=Object.prototype,{getPrototypeOf:ve}=Object,{iterator:ue,toStringTag:He}=Symbol,fe=(t=>e=>{const i=Ht.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),F=t=>(t=t.toLowerCase(),e=>fe(e)===t),he=t=>e=>typeof e===t,{isArray:ee}=Array,re=he("undefined");function jt(t){return t!==null&&!re(t)&&t.constructor!==null&&!re(t.constructor)&&_(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const je=F("ArrayBuffer");function zt(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&je(t.buffer),e}const Vt=he("string"),_=he("function"),ze=he("number"),ge=t=>t!==null&&typeof t=="object",qt=t=>t===!0||t===!1,be=t=>{if(fe(t)!=="object")return!1;const e=ve(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(He in t)&&!(ue in t)},Yt=F("Date"),Jt=F("File"),Xt=F("Blob"),Kt=F("FileList"),Gt=t=>ge(t)&&_(t.pipe),Zt=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||_(t.append)&&((e=fe(t))==="formdata"||e==="object"&&_(t.toString)&&t.toString()==="[object FormData]"))},Qt=F("URLSearchParams"),[ei,ti,ii,ni]=["ReadableStream","Request","Response","Headers"].map(F),oi=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ae(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,o;if(typeof t!="object"&&(t=[t]),ee(t))for(n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else{const s=i?Object.getOwnPropertyNames(t):Object.keys(t),r=s.length;let c;for(n=0;n<r;n++)c=s[n],e.call(null,t[c],c,t)}}function Ve(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,o;for(;n-- >0;)if(o=i[n],e===o.toLowerCase())return o;return null}const J=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qe=t=>!re(t)&&t!==J;function Re(){const{caseless:t}=qe(this)&&this||{},e={},i=(n,o)=>{const s=t&&Ve(e,o)||o;be(e[s])&&be(n)?e[s]=Re(e[s],n):be(n)?e[s]=Re({},n):ee(n)?e[s]=n.slice():e[s]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&ae(arguments[n],i);return e}const si=(t,e,i,{allOwnKeys:n}={})=>(ae(e,(o,s)=>{i&&_(o)?t[s]=$e(o,i):t[s]=o},{allOwnKeys:n}),t),ri=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ai=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},ci=(t,e,i,n)=>{let o,s,r;const c={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),s=o.length;s-- >0;)r=o[s],(!n||n(r,t,e))&&!c[r]&&(e[r]=t[r],c[r]=!0);t=i!==!1&&ve(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},li=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},di=t=>{if(!t)return null;if(ee(t))return t;let e=t.length;if(!ze(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},ui=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&ve(Uint8Array)),fi=(t,e)=>{const n=(t&&t[ue]).call(t);let o;for(;(o=n.next())&&!o.done;){const s=o.value;e.call(t,s[0],s[1])}},hi=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},gi=F("HTMLFormElement"),bi=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,o){return n.toUpperCase()+o}),Ye=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),pi=F("RegExp"),Je=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};ae(i,(o,s)=>{let r;(r=e(o,s,t))!==!1&&(n[s]=r||o)}),Object.defineProperties(t,n)},mi=t=>{Je(t,(e,i)=>{if(_(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(_(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},yi=(t,e)=>{const i={},n=o=>{o.forEach(s=>{i[s]=!0})};return ee(t)?n(t):n(String(t).split(e)),i},wi=()=>{},xi=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function ki(t){return!!(t&&_(t.append)&&t[He]==="FormData"&&t[ue])}const Ti=t=>{const e=new Array(10),i=(n,o)=>{if(ge(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[o]=n;const s=ee(n)?[]:{};return ae(n,(r,c)=>{const f=i(r,o+1);!re(f)&&(s[c]=f)}),e[o]=void 0,s}}return n};return i(t,0)},Si=F("AsyncFunction"),Ei=t=>t&&(ge(t)||_(t))&&_(t.then)&&_(t.catch),Xe=((t,e)=>t?setImmediate:e?((i,n)=>(J.addEventListener("message",({source:o,data:s})=>{o===J&&s===i&&n.length&&n.shift()()},!1),o=>{n.push(o),J.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",_(J.postMessage)),Ci=typeof queueMicrotask<"u"?queueMicrotask.bind(J):typeof process<"u"&&process.nextTick||Xe,d={isArray:ee,isArrayBuffer:je,isBuffer:jt,isFormData:Zt,isArrayBufferView:zt,isString:Vt,isNumber:ze,isBoolean:qt,isObject:ge,isPlainObject:be,isReadableStream:ei,isRequest:ti,isResponse:ii,isHeaders:ni,isUndefined:re,isDate:Yt,isFile:Jt,isBlob:Xt,isRegExp:pi,isFunction:_,isStream:Gt,isURLSearchParams:Qt,isTypedArray:ui,isFileList:Kt,forEach:ae,merge:Re,extend:si,trim:oi,stripBOM:ri,inherits:ai,toFlatObject:ci,kindOf:fe,kindOfTest:F,endsWith:li,toArray:di,forEachEntry:fi,matchAll:hi,isHTMLForm:gi,hasOwnProperty:Ye,hasOwnProp:Ye,reduceDescriptors:Je,freezeMethods:mi,toObjectSet:yi,toCamelCase:bi,noop:wi,toFiniteNumber:xi,findKey:Ve,global:J,isContextDefined:qe,isSpecCompliantForm:ki,toJSONObject:Ti,isAsyncFn:Si,isThenable:Ei,setImmediate:Xe,asap:Ci,isIterable:t=>t!=null&&_(t[ue])};function w(t,e,i,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}d.inherits(w,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:d.toJSONObject(this.config),code:this.code,status:this.status}}});const Ke=w.prototype,Ge={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ge[t]={value:t}}),Object.defineProperties(w,Ge),Object.defineProperty(Ke,"isAxiosError",{value:!0}),w.from=(t,e,i,n,o,s)=>{const r=Object.create(Ke);return d.toFlatObject(t,r,function(f){return f!==Error.prototype},c=>c!=="isAxiosError"),w.call(r,t.message,e,i,n,o),r.cause=t,r.name=t.name,s&&Object.assign(r,s),r};const Di=null;function Oe(t){return d.isPlainObject(t)||d.isArray(t)}function Ze(t){return d.endsWith(t,"[]")?t.slice(0,-2):t}function Qe(t,e,i){return t?t.concat(e).map(function(o,s){return o=Ze(o),!i&&s?"["+o+"]":o}).join(i?".":""):e}function vi(t){return d.isArray(t)&&!t.some(Oe)}const Ri=d.toFlatObject(d,{},null,function(e){return/^is[A-Z]/.test(e)});function pe(t,e,i){if(!d.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=d.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,b){return!d.isUndefined(b[m])});const n=i.metaTokens,o=i.visitor||l,s=i.dots,r=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&d.isSpecCompliantForm(e);if(!d.isFunction(o))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(d.isDate(g))return g.toISOString();if(d.isBoolean(g))return g.toString();if(!f&&d.isBlob(g))throw new w("Blob is not supported. Use a Buffer instead.");return d.isArrayBuffer(g)||d.isTypedArray(g)?f&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function l(g,m,b){let x=g;if(g&&!b&&typeof g=="object"){if(d.endsWith(m,"{}"))m=n?m:m.slice(0,-2),g=JSON.stringify(g);else if(d.isArray(g)&&vi(g)||(d.isFileList(g)||d.endsWith(m,"[]"))&&(x=d.toArray(g)))return m=Ze(m),x.forEach(function(S,v){!(d.isUndefined(S)||S===null)&&e.append(r===!0?Qe([m],v,s):r===null?m:m+"[]",u(S))}),!1}return Oe(g)?!0:(e.append(Qe(b,m,s),u(g)),!1)}const h=[],p=Object.assign(Ri,{defaultVisitor:l,convertValue:u,isVisitable:Oe});function y(g,m){if(!d.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+m.join("."));h.push(g),d.forEach(g,function(x,T){(!(d.isUndefined(x)||x===null)&&o.call(e,x,d.isString(T)?T.trim():T,m,p))===!0&&y(x,m?m.concat(T):[T])}),h.pop()}}if(!d.isObject(t))throw new TypeError("data must be an object");return y(t),e}function et(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Be(t,e){this._pairs=[],t&&pe(t,this,e)}const tt=Be.prototype;tt.append=function(e,i){this._pairs.push([e,i])},tt.toString=function(e){const i=e?function(n){return e.call(this,n,et)}:et;return this._pairs.map(function(o){return i(o[0])+"="+i(o[1])},"").join("&")};function Oi(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function it(t,e,i){if(!e)return t;const n=i&&i.encode||Oi;d.isFunction(i)&&(i={serialize:i});const o=i&&i.serialize;let s;if(o?s=o(e,i):s=d.isURLSearchParams(e)?e.toString():new Be(e,i).toString(n),s){const r=t.indexOf("#");r!==-1&&(t=t.slice(0,r)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class nt{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){d.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ot={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Bi={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:Be,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},Ue=typeof window<"u"&&typeof document<"u",_e=typeof navigator=="object"&&navigator||void 0,Ui=Ue&&(!_e||["ReactNative","NativeScript","NS"].indexOf(_e.product)<0),_i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Mi=Ue&&window.location.href||"http://localhost",O={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ue,hasStandardBrowserEnv:Ui,hasStandardBrowserWebWorkerEnv:_i,navigator:_e,origin:Mi},Symbol.toStringTag,{value:"Module"})),...Bi};function Ai(t,e){return pe(t,new O.classes.URLSearchParams,Object.assign({visitor:function(i,n,o,s){return O.isNode&&d.isBuffer(i)?(this.append(n,i.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Ii(t){return d.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Wi(t){const e={},i=Object.keys(t);let n;const o=i.length;let s;for(n=0;n<o;n++)s=i[n],e[s]=t[s];return e}function st(t){function e(i,n,o,s){let r=i[s++];if(r==="__proto__")return!0;const c=Number.isFinite(+r),f=s>=i.length;return r=!r&&d.isArray(o)?o.length:r,f?(d.hasOwnProp(o,r)?o[r]=[o[r],n]:o[r]=n,!c):((!o[r]||!d.isObject(o[r]))&&(o[r]=[]),e(i,n,o[r],s)&&d.isArray(o[r])&&(o[r]=Wi(o[r])),!c)}if(d.isFormData(t)&&d.isFunction(t.entries)){const i={};return d.forEachEntry(t,(n,o)=>{e(Ii(n),o,i,0)}),i}return null}function Fi(t,e,i){if(d.isString(t))try{return(e||JSON.parse)(t),d.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const ce={transitional:ot,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",o=n.indexOf("application/json")>-1,s=d.isObject(e);if(s&&d.isHTMLForm(e)&&(e=new FormData(e)),d.isFormData(e))return o?JSON.stringify(st(e)):e;if(d.isArrayBuffer(e)||d.isBuffer(e)||d.isStream(e)||d.isFile(e)||d.isBlob(e)||d.isReadableStream(e))return e;if(d.isArrayBufferView(e))return e.buffer;if(d.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ai(e,this.formSerializer).toString();if((c=d.isFileList(e))||n.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return pe(c?{"files[]":e}:e,f&&new f,this.formSerializer)}}return s||o?(i.setContentType("application/json",!1),Fi(e)):e}],transformResponse:[function(e){const i=this.transitional||ce.transitional,n=i&&i.forcedJSONParsing,o=this.responseType==="json";if(d.isResponse(e)||d.isReadableStream(e))return e;if(e&&d.isString(e)&&(n&&!this.responseType||o)){const r=!(i&&i.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(c){if(r)throw c.name==="SyntaxError"?w.from(c,w.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:O.classes.FormData,Blob:O.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};d.forEach(["delete","get","head","post","put","patch"],t=>{ce.headers[t]={}});const Li=d.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Pi=t=>{const e={};let i,n,o;return t&&t.split(`
`).forEach(function(r){o=r.indexOf(":"),i=r.substring(0,o).trim().toLowerCase(),n=r.substring(o+1).trim(),!(!i||e[i]&&Li[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},rt=Symbol("internals");function le(t){return t&&String(t).trim().toLowerCase()}function me(t){return t===!1||t==null?t:d.isArray(t)?t.map(me):String(t)}function Ni(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const $i=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Me(t,e,i,n,o){if(d.isFunction(n))return n.call(this,e,i);if(o&&(e=i),!!d.isString(e)){if(d.isString(n))return e.indexOf(n)!==-1;if(d.isRegExp(n))return n.test(e)}}function Hi(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function ji(t,e){const i=d.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(o,s,r){return this[n].call(this,e,o,s,r)},configurable:!0})})}let M=class{constructor(e){e&&this.set(e)}set(e,i,n){const o=this;function s(c,f,u){const l=le(f);if(!l)throw new Error("header name must be a non-empty string");const h=d.findKey(o,l);(!h||o[h]===void 0||u===!0||u===void 0&&o[h]!==!1)&&(o[h||f]=me(c))}const r=(c,f)=>d.forEach(c,(u,l)=>s(u,l,f));if(d.isPlainObject(e)||e instanceof this.constructor)r(e,i);else if(d.isString(e)&&(e=e.trim())&&!$i(e))r(Pi(e),i);else if(d.isObject(e)&&d.isIterable(e)){let c={},f,u;for(const l of e){if(!d.isArray(l))throw TypeError("Object iterator must return a key-value pair");c[u=l[0]]=(f=c[u])?d.isArray(f)?[...f,l[1]]:[f,l[1]]:l[1]}r(c,i)}else e!=null&&s(i,e,n);return this}get(e,i){if(e=le(e),e){const n=d.findKey(this,e);if(n){const o=this[n];if(!i)return o;if(i===!0)return Ni(o);if(d.isFunction(i))return i.call(this,o,n);if(d.isRegExp(i))return i.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=le(e),e){const n=d.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||Me(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let o=!1;function s(r){if(r=le(r),r){const c=d.findKey(n,r);c&&(!i||Me(n,n[c],c,i))&&(delete n[c],o=!0)}}return d.isArray(e)?e.forEach(s):s(e),o}clear(e){const i=Object.keys(this);let n=i.length,o=!1;for(;n--;){const s=i[n];(!e||Me(this,this[s],s,e,!0))&&(delete this[s],o=!0)}return o}normalize(e){const i=this,n={};return d.forEach(this,(o,s)=>{const r=d.findKey(n,s);if(r){i[r]=me(o),delete i[s];return}const c=e?Hi(s):String(s).trim();c!==s&&delete i[s],i[c]=me(o),n[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return d.forEach(this,(n,o)=>{n!=null&&n!==!1&&(i[o]=e&&d.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[rt]=this[rt]={accessors:{}}).accessors,o=this.prototype;function s(r){const c=le(r);n[c]||(ji(o,r),n[c]=!0)}return d.isArray(e)?e.forEach(s):s(e),this}};M.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),d.reduceDescriptors(M.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}}),d.freezeMethods(M);function Ae(t,e){const i=this||ce,n=e||i,o=M.from(n.headers);let s=n.data;return d.forEach(t,function(c){s=c.call(i,s,o.normalize(),e?e.status:void 0)}),o.normalize(),s}function at(t){return!!(t&&t.__CANCEL__)}function te(t,e,i){w.call(this,t??"canceled",w.ERR_CANCELED,e,i),this.name="CanceledError"}d.inherits(te,w,{__CANCEL__:!0});function ct(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new w("Request failed with status code "+i.status,[w.ERR_BAD_REQUEST,w.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function zi(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Vi(t,e){t=t||10;const i=new Array(t),n=new Array(t);let o=0,s=0,r;return e=e!==void 0?e:1e3,function(f){const u=Date.now(),l=n[s];r||(r=u),i[o]=f,n[o]=u;let h=s,p=0;for(;h!==o;)p+=i[h++],h=h%t;if(o=(o+1)%t,o===s&&(s=(s+1)%t),u-r<e)return;const y=l&&u-l;return y?Math.round(p*1e3/y):void 0}}function qi(t,e){let i=0,n=1e3/e,o,s;const r=(u,l=Date.now())=>{i=l,o=null,s&&(clearTimeout(s),s=null),t.apply(null,u)};return[(...u)=>{const l=Date.now(),h=l-i;h>=n?r(u,l):(o=u,s||(s=setTimeout(()=>{s=null,r(o)},n-h)))},()=>o&&r(o)]}const ye=(t,e,i=3)=>{let n=0;const o=Vi(50,250);return qi(s=>{const r=s.loaded,c=s.lengthComputable?s.total:void 0,f=r-n,u=o(f),l=r<=c;n=r;const h={loaded:r,total:c,progress:c?r/c:void 0,bytes:f,rate:u||void 0,estimated:u&&c&&l?(c-r)/u:void 0,event:s,lengthComputable:c!=null,[e?"download":"upload"]:!0};t(h)},i)},lt=(t,e)=>{const i=t!=null;return[n=>e[0]({lengthComputable:i,total:t,loaded:n}),e[1]]},dt=t=>(...e)=>d.asap(()=>t(...e)),Yi=O.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,O.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(O.origin),O.navigator&&/(msie|trident)/i.test(O.navigator.userAgent)):()=>!0,Ji=O.hasStandardBrowserEnv?{write(t,e,i,n,o,s){const r=[t+"="+encodeURIComponent(e)];d.isNumber(i)&&r.push("expires="+new Date(i).toGMTString()),d.isString(n)&&r.push("path="+n),d.isString(o)&&r.push("domain="+o),s===!0&&r.push("secure"),document.cookie=r.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Xi(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Ki(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function ut(t,e,i){let n=!Xi(e);return t&&(n||i==!1)?Ki(t,e):e}const ft=t=>t instanceof M?{...t}:t;function X(t,e){e=e||{};const i={};function n(u,l,h,p){return d.isPlainObject(u)&&d.isPlainObject(l)?d.merge.call({caseless:p},u,l):d.isPlainObject(l)?d.merge({},l):d.isArray(l)?l.slice():l}function o(u,l,h,p){if(d.isUndefined(l)){if(!d.isUndefined(u))return n(void 0,u,h,p)}else return n(u,l,h,p)}function s(u,l){if(!d.isUndefined(l))return n(void 0,l)}function r(u,l){if(d.isUndefined(l)){if(!d.isUndefined(u))return n(void 0,u)}else return n(void 0,l)}function c(u,l,h){if(h in e)return n(u,l);if(h in t)return n(void 0,u)}const f={url:s,method:s,data:s,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:c,headers:(u,l,h)=>o(ft(u),ft(l),h,!0)};return d.forEach(Object.keys(Object.assign({},t,e)),function(l){const h=f[l]||o,p=h(t[l],e[l],l);d.isUndefined(p)&&h!==c||(i[l]=p)}),i}const ht=t=>{const e=X({},t);let{data:i,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:s,headers:r,auth:c}=e;e.headers=r=M.from(r),e.url=it(ut(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&r.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let f;if(d.isFormData(i)){if(O.hasStandardBrowserEnv||O.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if((f=r.getContentType())!==!1){const[u,...l]=f?f.split(";").map(h=>h.trim()).filter(Boolean):[];r.setContentType([u||"multipart/form-data",...l].join("; "))}}if(O.hasStandardBrowserEnv&&(n&&d.isFunction(n)&&(n=n(e)),n||n!==!1&&Yi(e.url))){const u=o&&s&&Ji.read(s);u&&r.set(o,u)}return e},Gi=typeof XMLHttpRequest<"u"&&function(t){return new Promise(function(i,n){const o=ht(t);let s=o.data;const r=M.from(o.headers).normalize();let{responseType:c,onUploadProgress:f,onDownloadProgress:u}=o,l,h,p,y,g;function m(){y&&y(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(l),o.signal&&o.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(o.method.toUpperCase(),o.url,!0),b.timeout=o.timeout;function x(){if(!b)return;const S=M.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),E={data:!c||c==="text"||c==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:S,config:t,request:b};ct(function(B){i(B),m()},function(B){n(B),m()},E),b=null}"onloadend"in b?b.onloadend=x:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(x)},b.onabort=function(){b&&(n(new w("Request aborted",w.ECONNABORTED,t,b)),b=null)},b.onerror=function(){n(new w("Network Error",w.ERR_NETWORK,t,b)),b=null},b.ontimeout=function(){let v=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const E=o.transitional||ot;o.timeoutErrorMessage&&(v=o.timeoutErrorMessage),n(new w(v,E.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,t,b)),b=null},s===void 0&&r.setContentType(null),"setRequestHeader"in b&&d.forEach(r.toJSON(),function(v,E){b.setRequestHeader(E,v)}),d.isUndefined(o.withCredentials)||(b.withCredentials=!!o.withCredentials),c&&c!=="json"&&(b.responseType=o.responseType),u&&([p,g]=ye(u,!0),b.addEventListener("progress",p)),f&&b.upload&&([h,y]=ye(f),b.upload.addEventListener("progress",h),b.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(l=S=>{b&&(n(!S||S.type?new te(null,t,b):S),b.abort(),b=null)},o.cancelToken&&o.cancelToken.subscribe(l),o.signal&&(o.signal.aborted?l():o.signal.addEventListener("abort",l)));const T=zi(o.url);if(T&&O.protocols.indexOf(T)===-1){n(new w("Unsupported protocol "+T+":",w.ERR_BAD_REQUEST,t));return}b.send(s||null)})},Zi=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let n=new AbortController,o;const s=function(u){if(!o){o=!0,c();const l=u instanceof Error?u:this.reason;n.abort(l instanceof w?l:new te(l instanceof Error?l.message:l))}};let r=e&&setTimeout(()=>{r=null,s(new w(`timeout ${e} of ms exceeded`,w.ETIMEDOUT))},e);const c=()=>{t&&(r&&clearTimeout(r),r=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(s):u.removeEventListener("abort",s)}),t=null)};t.forEach(u=>u.addEventListener("abort",s));const{signal:f}=n;return f.unsubscribe=()=>d.asap(c),f}},Qi=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let n=0,o;for(;n<i;)o=n+e,yield t.slice(n,o),n=o},en=async function*(t,e){for await(const i of tn(t))yield*Qi(i,e)},tn=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},gt=(t,e,i,n)=>{const o=en(t,e);let s=0,r,c=f=>{r||(r=!0,n&&n(f))};return new ReadableStream({async pull(f){try{const{done:u,value:l}=await o.next();if(u){c(),f.close();return}let h=l.byteLength;if(i){let p=s+=h;i(p)}f.enqueue(new Uint8Array(l))}catch(u){throw c(u),u}},cancel(f){return c(f),o.return()}},{highWaterMark:2})},we=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bt=we&&typeof ReadableStream=="function",nn=we&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),pt=(t,...e)=>{try{return!!t(...e)}catch{return!1}},on=bt&&pt(()=>{let t=!1;const e=new Request(O.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),mt=64*1024,Ie=bt&&pt(()=>d.isReadableStream(new Response("").body)),xe={stream:Ie&&(t=>t.body)};we&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!xe[e]&&(xe[e]=d.isFunction(t[e])?i=>i[e]():(i,n)=>{throw new w(`Response type '${e}' is not supported`,w.ERR_NOT_SUPPORT,n)})})})(new Response);const sn=async t=>{if(t==null)return 0;if(d.isBlob(t))return t.size;if(d.isSpecCompliantForm(t))return(await new Request(O.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(d.isArrayBufferView(t)||d.isArrayBuffer(t))return t.byteLength;if(d.isURLSearchParams(t)&&(t=t+""),d.isString(t))return(await nn(t)).byteLength},rn=async(t,e)=>{const i=d.toFiniteNumber(t.getContentLength());return i??sn(e)},We={http:Di,xhr:Gi,fetch:we&&(async t=>{let{url:e,method:i,data:n,signal:o,cancelToken:s,timeout:r,onDownloadProgress:c,onUploadProgress:f,responseType:u,headers:l,withCredentials:h="same-origin",fetchOptions:p}=ht(t);u=u?(u+"").toLowerCase():"text";let y=Zi([o,s&&s.toAbortSignal()],r),g;const m=y&&y.unsubscribe&&(()=>{y.unsubscribe()});let b;try{if(f&&on&&i!=="get"&&i!=="head"&&(b=await rn(l,n))!==0){let E=new Request(e,{method:"POST",body:n,duplex:"half"}),R;if(d.isFormData(n)&&(R=E.headers.get("content-type"))&&l.setContentType(R),E.body){const[B,k]=lt(b,ye(dt(f)));n=gt(E.body,mt,B,k)}}d.isString(h)||(h=h?"include":"omit");const x="credentials"in Request.prototype;g=new Request(e,{...p,signal:y,method:i.toUpperCase(),headers:l.normalize().toJSON(),body:n,duplex:"half",credentials:x?h:void 0});let T=await fetch(g,p);const S=Ie&&(u==="stream"||u==="response");if(Ie&&(c||S&&m)){const E={};["status","statusText","headers"].forEach(A=>{E[A]=T[A]});const R=d.toFiniteNumber(T.headers.get("content-length")),[B,k]=c&&lt(R,ye(dt(c),!0))||[];T=new Response(gt(T.body,mt,B,()=>{k&&k(),m&&m()}),E)}u=u||"text";let v=await xe[d.findKey(xe,u)||"text"](T,t);return!S&&m&&m(),await new Promise((E,R)=>{ct(E,R,{data:v,headers:M.from(T.headers),status:T.status,statusText:T.statusText,config:t,request:g})})}catch(x){throw m&&m(),x&&x.name==="TypeError"&&/Load failed|fetch/i.test(x.message)?Object.assign(new w("Network Error",w.ERR_NETWORK,t,g),{cause:x.cause||x}):w.from(x,x&&x.code,t,g)}})};d.forEach(We,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const yt=t=>`- ${t}`,an=t=>d.isFunction(t)||t===null||t===!1,wt={getAdapter:t=>{t=d.isArray(t)?t:[t];const{length:e}=t;let i,n;const o={};for(let s=0;s<e;s++){i=t[s];let r;if(n=i,!an(i)&&(n=We[(r=String(i)).toLowerCase()],n===void 0))throw new w(`Unknown adapter '${r}'`);if(n)break;o[r||"#"+s]=n}if(!n){const s=Object.entries(o).map(([c,f])=>`adapter ${c} `+(f===!1?"is not supported by the environment":"is not available in the build"));let r=e?s.length>1?`since :
`+s.map(yt).join(`
`):" "+yt(s[0]):"as no adapter specified";throw new w("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return n},adapters:We};function Fe(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new te(null,t)}function xt(t){return Fe(t),t.headers=M.from(t.headers),t.data=Ae.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),wt.getAdapter(t.adapter||ce.adapter)(t).then(function(n){return Fe(t),n.data=Ae.call(t,t.transformResponse,n),n.headers=M.from(n.headers),n},function(n){return at(n)||(Fe(t),n&&n.response&&(n.response.data=Ae.call(t,t.transformResponse,n.response),n.response.headers=M.from(n.response.headers))),Promise.reject(n)})}const kt="1.10.0",ke={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ke[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Tt={};ke.transitional=function(e,i,n){function o(s,r){return"[Axios v"+kt+"] Transitional option '"+s+"'"+r+(n?". "+n:"")}return(s,r,c)=>{if(e===!1)throw new w(o(r," has been removed"+(i?" in "+i:"")),w.ERR_DEPRECATED);return i&&!Tt[r]&&(Tt[r]=!0,console.warn(o(r," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(s,r,c):!0}},ke.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function cn(t,e,i){if(typeof t!="object")throw new w("options must be an object",w.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let o=n.length;for(;o-- >0;){const s=n[o],r=e[s];if(r){const c=t[s],f=c===void 0||r(c,s,t);if(f!==!0)throw new w("option "+s+" must be "+f,w.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new w("Unknown option "+s,w.ERR_BAD_OPTION)}}const Te={assertOptions:cn,validators:ke},N=Te.validators;let K=class{constructor(e){this.defaults=e||{},this.interceptors={request:new nt,response:new nt}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const s=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=X(this.defaults,i);const{transitional:n,paramsSerializer:o,headers:s}=i;n!==void 0&&Te.assertOptions(n,{silentJSONParsing:N.transitional(N.boolean),forcedJSONParsing:N.transitional(N.boolean),clarifyTimeoutError:N.transitional(N.boolean)},!1),o!=null&&(d.isFunction(o)?i.paramsSerializer={serialize:o}:Te.assertOptions(o,{encode:N.function,serialize:N.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Te.assertOptions(i,{baseUrl:N.spelling("baseURL"),withXsrfToken:N.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let r=s&&d.merge(s.common,s[i.method]);s&&d.forEach(["delete","get","head","post","put","patch","common"],g=>{delete s[g]}),i.headers=M.concat(r,s);const c=[];let f=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(f=f&&m.synchronous,c.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let l,h=0,p;if(!f){const g=[xt.bind(this),void 0];for(g.unshift.apply(g,c),g.push.apply(g,u),p=g.length,l=Promise.resolve(i);h<p;)l=l.then(g[h++],g[h++]);return l}p=c.length;let y=i;for(h=0;h<p;){const g=c[h++],m=c[h++];try{y=g(y)}catch(b){m.call(this,b);break}}try{l=xt.call(this,y)}catch(g){return Promise.reject(g)}for(h=0,p=u.length;h<p;)l=l.then(u[h++],u[h++]);return l}getUri(e){e=X(this.defaults,e);const i=ut(e.baseURL,e.url,e.allowAbsoluteUrls);return it(i,e.params,e.paramsSerializer)}};d.forEach(["delete","get","head","options"],function(e){K.prototype[e]=function(i,n){return this.request(X(n||{},{method:e,url:i,data:(n||{}).data}))}}),d.forEach(["post","put","patch"],function(e){function i(n){return function(s,r,c){return this.request(X(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:r}))}}K.prototype[e]=i(),K.prototype[e+"Form"]=i(!0)});let ln=class vt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(s){i=s});const n=this;this.promise.then(o=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](o);n._listeners=null}),this.promise.then=o=>{let s;const r=new Promise(c=>{n.subscribe(c),s=c}).then(o);return r.cancel=function(){n.unsubscribe(s)},r},e(function(s,r,c){n.reason||(n.reason=new te(s,r,c),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new vt(function(o){e=o}),cancel:e}}};function dn(t){return function(i){return t.apply(null,i)}}function un(t){return d.isObject(t)&&t.isAxiosError===!0}const Le={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Le).forEach(([t,e])=>{Le[e]=t});function St(t){const e=new K(t),i=$e(K.prototype.request,e);return d.extend(i,K.prototype,e,{allOwnKeys:!0}),d.extend(i,e,null,{allOwnKeys:!0}),i.create=function(o){return St(X(t,o))},i}const D=St(ce);D.Axios=K,D.CanceledError=te,D.CancelToken=ln,D.isCancel=at,D.VERSION=kt,D.toFormData=pe,D.AxiosError=w,D.Cancel=D.CanceledError,D.all=function(e){return Promise.all(e)},D.spread=dn,D.isAxiosError=un,D.mergeConfig=X,D.AxiosHeaders=M,D.formToJSON=t=>st(d.isHTMLForm(t)?new FormData(t):t),D.getAdapter=wt.getAdapter,D.HttpStatusCode=Le,D.default=D;const{Axios:An,AxiosError:In,CanceledError:Wn,isCancel:Fn,CancelToken:Ln,VERSION:Pn,all:Nn,Cancel:$n,isAxiosError:Hn,spread:jn,toFormData:zn,AxiosHeaders:Vn,HttpStatusCode:qn,formToJSON:Yn,getAdapter:Jn,mergeConfig:Xn}=D;function fn(t){return{all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map(function(o){o(i)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,i)})}}}const ie=fn();let Se="";function Ee(){return Se||"https://api.weiyuai.cn"}function hn(t){return t&&t.trim()!==""?(Se=t,a.info("API URL已设置为:",Se)):a.warn("尝试设置无效的API URL"),Se}const q=D.create({timeout:2e4,baseURL:Ee()});q.interceptors.request.use(t=>{t.baseURL=Ee();const e=localStorage.getItem(Rt);return e&&e.length>10&&t.url&&t.url.startsWith("/api")&&(t.headers.Authorization=`Bearer ${e}`),!e&&t.url&&t.url.startsWith("/api")?Promise.reject(gn):t},t=>(a.error("request error",t),t.response.status===403&&ie.emit(L,"403"),t.response.status===401&&ie.emit(L,"401"),Promise.reject(t))),q.interceptors.response.use(t=>t,t=>{if(a.error("response error",t),t.response)switch(t.response.status){case 400:a.error("axios interception error 400"),ie.emit(L,"400");break;case 401:a.error("axios interception error 401"),ie.emit(L,"401");break;case 403:a.error("axios interception error 403"),ie.emit(L,"403");break;case 500:a.error("axios interception error 500"),ie.emit($,"500");break}return"return axios interception error"});const Pe={data:null,status:601,statusText:z,headers:{},config:{headers:{}},request:null},gn={message:"匿名用户，无需访问服务器接口",name:z,code:"601",config:Pe.config,request:Pe.request,response:Pe,isAxiosError:!0,toJSON:function(){return{message:this.message,name:this.name,code:this.code,config:this.config,request:this.request,response:this.response}}},bn=Object.freeze(Object.defineProperty({__proto__:null,default:q,getApiUrl:Ee,setApiUrl:hn},Symbol.toStringTag,{value:"Module"}));async function pn(t){return q("/visitor/api/v1/init",{method:"POST",data:{...t,client:de}})}async function mn(t){return q("/visitor/api/v1/browse",{method:"POST",data:{...t,client:de}})}const Et=Object.freeze(Object.defineProperty({__proto__:null,browse:mn,initVisitor:pn},Symbol.toStringTag,{value:"Module"}));async function yn(t){return q("/visitor/api/v1/message/unread/count",{method:"GET",params:{...t,client:de}})}async function wn(t){return q("/visitor/api/v1/message/unread/clear",{method:"POST",data:{...t,client:de}})}const Ct=Object.freeze(Object.defineProperty({__proto__:null,clearUnreadMessages:wn,getUnreadMessageCount:yn},Symbol.toStringTag,{value:"Module"}));async function Dt(t,e,i,n){try{const o=new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14),s=e||`${o}_${t.name}`,r=i||t.type||"image/jpeg",c=new FormData;c.append("file",t),c.append("fileName",s),c.append("fileType",r),c.append("isAvatar",(n==null?void 0:n.isAvatar)||"false"),c.append("kbType",(n==null?void 0:n.kbType)||"feedback");const f=(n==null?void 0:n.visitorUid)||localStorage.getItem("bytedesk_uid")||localStorage.getItem("bytedesk_visitor_uid")||"",u=(n==null?void 0:n.visitorNickname)||localStorage.getItem("bytedesk_nickname")||"",l=(n==null?void 0:n.visitorAvatar)||localStorage.getItem("bytedesk_avatar")||"",h=(n==null?void 0:n.orgUid)||"";c.append("visitorUid",f),c.append("visitorNickname",u),c.append("visitorAvatar",l),c.append("orgUid",h),c.append("client",(n==null?void 0:n.client)||"web"),n!=null&&n.isDebug&&a.debug("handleUpload formData",c);const y=`${Ee()}/visitor/api/upload/file`,g=await fetch(y,{method:"POST",headers:{},body:c});if(!g.ok)throw new Error(`上传失败: ${g.status} ${g.statusText}`);const m=await g.json();return n!=null&&n.isDebug&&a.debug("upload data:",m),m}catch(o){throw a.error("文件上传失败:",o),o}}async function xn(t,e){var s;const n=`screenshot_${new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14)}.jpg`;return((s=(await Dt(t,n,"image/jpeg",{...e,kbType:"feedback"})).data)==null?void 0:s.fileUrl)||""}const kn=Object.freeze(Object.defineProperty({__proto__:null,handleUpload:Dt,uploadScreenshot:xn},Symbol.toStringTag,{value:"Module"}));function Tn(t){return q({url:"/visitor/api/feedback/submit",method:"post",data:t})}const Sn=Object.freeze(Object.defineProperty({__proto__:null,submitFeedback:Tn},Symbol.toStringTag,{value:"Module"}));return $t}();
