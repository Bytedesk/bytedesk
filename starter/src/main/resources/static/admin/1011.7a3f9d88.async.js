"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1011],{88674:function(e,n,l){l.d(n,{$2:function(){return S},$j:function(){return h},Fh:function(){return m},Fu:function(){return v},OW:function(){return x},WD:function(){return p},uy:function(){return T},vF:function(){return M}});var t=l(90819),r=l.n(t),a=l(73193),o=l.n(a),s=l(89933),u=l.n(s),i=l(27353),d=l(2290);function p(e){return c.apply(this,arguments)}function c(){return(c=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/query/org",{method:"GET",params:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return f.apply(this,arguments)}function f(){return(f=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/create",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/update",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/delete",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/score",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return k.apply(this,arguments)}function k(){return(k=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/optimize",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return j.apply(this,arguments)}function j(){return(j=u()(r()().mark((function e(n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/reset",{method:"POST",data:o()(o()({},n),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,n){return C.apply(this,arguments)}function C(){return(C=u()(r()().mark((function e(n,l){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/reset/".concat(n),{method:"POST",data:o()(o()({},l||{}),{},{channel:i.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36651:function(e,n,l){var t=l(90819),r=l.n(t),a=l(89933),o=l.n(a),s=l(45332),u=l.n(s),i=l(44194),d=l(2290),p=l(64724),c=l(19058),m=l(90883),f=l(46206),v=l(31461),g=l(25456),h=l(2887),b=l(38623),x=l(49108),y=l(50884),M=l(88674),k=l(31549),T=p.Z.Text,j=p.Z.Paragraph;n.Z=function(e){var n=e.open,l=e.orgUid,t=e.onClose,a=e.onSelect,s=(0,d.useIntl)(),p=(0,i.useState)(!1),S=u()(p,2),C=S[0],w=S[1],E=(0,i.useState)([]),P=u()(E,2),Z=P[0],U=P[1],K=(0,i.useState)(0),N=u()(K,2),R=N[0],L=N[1],W=(0,i.useState)(""),O=u()(W,2),F=O[0],H=O[1],A=(0,i.useState)("ZH_CN"),I=u()(A,2),_=I[0],z=I[1],D=(0,i.useState)(0),q=u()(D,2),J=q[0],B=q[1],V=(0,i.useState)(10),X=u()(V,2),G=X[0],Q=X[1],$=(0,i.useRef)(null),Y=(0,i.useMemo)((function(){return[{value:"ZH_CN",label:s.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"简体中文(ZH_CN)"})},{value:"EN",label:s.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"})},{value:"ZH_TW",label:s.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"繁體中文(ZH_TW)"})}]}),[s]),ee=(0,i.useMemo)((function(){return{ZH_CN:s.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"简体中文(ZH_CN)"}),EN:s.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"}),ZH_TW:s.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"繁體中文(ZH_TW)"})}}),[s]),ne=(0,i.useMemo)((function(){return{GENERAL:s.formatMessage({id:"prompt.type.general",defaultMessage:"通用"}),THREAD_SUMMARY:s.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"会话总结"}),THREAD_INTENTION:s.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"会话意图"}),THREAD_EMOTION:s.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"会话情绪"}),CUSTOMER_PROFILE:s.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"客户画像"}),TICKET_ASSIST:s.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"工单辅助"}),THREAD:s.formatMessage({id:"prompt.type.legacy.thread",defaultMessage:"（旧）THREAD"}),CUSTOMER:s.formatMessage({id:"prompt.type.legacy.customer",defaultMessage:"（旧）CUSTOMER"}),TICKET:s.formatMessage({id:"prompt.type.legacy.ticket",defaultMessage:"（旧）TICKET"})}}),[s]),le=(0,i.useCallback)(function(){var e=o()(r()().mark((function e(n){var t,a,o,u,i,d,p,c,m,f,v,g;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=4;break}return U([]),L(0),e.abrupt("return");case 4:return i=null!==(t=null==n?void 0:n.pageNumber)&&void 0!==t?t:J,d=null!==(a=null==n?void 0:n.pageSize)&&void 0!==a?a:G,p=null!==(o=null==n?void 0:n.searchText)&&void 0!==o?o:F,c=null!==(u=null==n?void 0:n.language)&&void 0!==u?u:_,w(!0),e.prev=9,v={pageNumber:i,pageSize:d,orgUid:l,language:c,searchText:p,enabled:!0,sortBy:"updatedAt",sortDirection:"descend"},e.next=13,(0,M.WD)(v);case 13:g=e.sent,U((null==g||null===(m=g.data)||void 0===m?void 0:m.content)||[]),L((null==g||null===(f=g.data)||void 0===f?void 0:f.totalElements)||0),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),y.yw.error(s.formatMessage({id:"error",defaultMessage:"请求出错"}));case 21:return e.prev=21,w(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[9,18,21,24]])})));return function(n){return e.apply(this,arguments)}}(),[s,_,l,J,G,F]);(0,i.useEffect)((function(){n&&(le({pageNumber:0}),B(0))}),[n,le]),(0,i.useEffect)((function(){return function(){$.current&&(clearTimeout($.current),$.current=null)}}),[]);var te=(0,i.useCallback)((function(e){H(e),$.current&&clearTimeout($.current),$.current=setTimeout((function(){B(0),le({pageNumber:0,searchText:e})}),300)}),[le]),re=(0,i.useCallback)((function(e){z(e),B(0),le({pageNumber:0,language:e})}),[le]);return(0,k.jsx)(c.Z,{open:n,onClose:t,width:720,destroyOnHidden:!0,title:s.formatMessage({id:"prompt.select",defaultMessage:"选择提示词"}),extra:(0,k.jsx)(m.ZP,{onClick:t,children:s.formatMessage({id:"close",defaultMessage:"关闭"})}),children:(0,k.jsxs)(f.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,k.jsxs)(f.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,k.jsx)(v.Z,{value:F,onChange:function(e){return te(e.target.value)},allowClear:!0,placeholder:s.formatMessage({id:"search",defaultMessage:"搜索"}),style:{maxWidth:360}}),(0,k.jsx)(g.Z,{value:_,allowClear:!0,placeholder:s.formatMessage({id:"language",defaultMessage:"语言"}),options:Y,style:{width:220},onChange:function(e){return re(e)}})]}),(0,k.jsx)(h.Z,{loading:C,dataSource:Z,locale:{emptyText:s.formatMessage({id:"empty",defaultMessage:"暂无数据"})},renderItem:function(e){return(0,k.jsx)(h.Z.Item,{actions:[(0,k.jsx)(m.ZP,{type:"primary",size:"small",onClick:function(){null!=e&&e.systemPrompt?a(e):y.yw.warning(s.formatMessage({id:"prompt.system.empty",defaultMessage:"该提示词没有系统提示词"}))},children:s.formatMessage({id:"select",defaultMessage:"选择"})},"select")],children:(0,k.jsx)(h.Z.Item.Meta,{title:(0,k.jsxs)(f.Z,{wrap:!0,children:[(0,k.jsx)(T,{strong:!0,children:(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.uid)||"-"}),(null==e?void 0:e.language)&&(0,k.jsx)(b.Z,{children:ee[e.language]||e.language}),(null==e?void 0:e.type)&&(0,k.jsx)(b.Z,{color:"blue",children:ne[e.type]||e.type}),!1===(null==e?void 0:e.enabled)&&(0,k.jsx)(b.Z,{color:"default",children:"OFF"})]}),description:(0,k.jsx)(j,{style:{marginBottom:0},ellipsis:{rows:2,expandable:!1},children:(null==e?void 0:e.systemPrompt)||"-"})})},e.uid)}}),(0,k.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,k.jsx)(x.Z,{current:J+1,pageSize:G,total:R,showSizeChanger:!0,showQuickJumper:!0,onChange:function(e,n){var l=Math.max(0,(e||1)-1),t=n||10;B(l),Q(t),le({pageNumber:l,pageSize:t})}})})]})})}},51011:function(e,n,l){var t=l(10154),r=l.n(t),a=l(73193),o=l.n(a),s=l(90819),u=l.n(s),i=l(89933),d=l.n(i),p=l(45332),c=l.n(p),m=l(44194),f=l(89622),v=l(67186),g=l(83788),h=l(97588),b=l(74056),x=l(17455),y=l(74745),M=l(2290),k=l(50884),T=l(24471),j=l(28520),S=l(27353),C=l(48301),w=l(80650),E=l(64724),P=l(46206),Z=l(25456),U=l(90883),K=l(69159),N=l(83801),R=l(99065),L=l(18221),W=l(6992),O=l(22014),F=l(43420),H=l(28704),A=l(26168),I=l(77129),_=l(36651),z=l(31549),D=E.Z.Text,q=function(e){var n=e.value,l=e.onChange,t=e.options,r=e.loading,a=e.placeholder,o=e.emptyContent,s=e.onSearch,u=e.onDropdownOpen,i=e.onCreate,d=e.createLabel,p=e.createTitle;return(0,z.jsxs)(P.Z.Compact,{block:!0,children:[(0,z.jsx)(Z.Z,{value:n,onChange:function(e){return null==l?void 0:l(e)},options:t,showSearch:!0,filterOption:!1,placeholder:a,loading:r,allowClear:!0,style:{flex:1},notFoundContent:o,onSearch:s,onOpenChange:function(e){e&&u()}}),(0,z.jsx)(U.ZP,{size:"small",icon:(0,z.jsx)(W.Z,{}),onClick:i,title:p,children:d})]})};n.Z=function(e){var n,l,t,a,s,i,p,E,P,Z,J,B,V,X,G,Q,$,Y,ee,ne,le,te,re,ae,oe,se,ue=e.open,ie=e.record,de=e.onClose,pe=e.onSuccess,ce=(0,M.useIntl)(),me=(0,j.u)((function(e){return e.currentOrg})),fe=(0,m.useMemo)((function(){return!(null==ie||!ie.uid)}),[ie]),ve=(0,m.useState)(!1),ge=c()(ve,2),he=ge[0],be=ge[1],xe=(0,m.useState)([]),ye=c()(xe,2),Me=ye[0],ke=ye[1],Te=(0,m.useState)(!1),je=c()(Te,2),Se=je[0],Ce=je[1],we=(0,m.useRef)(),Ee=(0,m.useState)((null==ie?void 0:ie.avatar)||""),Pe=c()(Ee,2),Ze=Pe[0],Ue=Pe[1],Ke=(0,m.useState)((null==ie?void 0:ie.type)||S.f4h),Ne=c()(Ke,2),Re=Ne[0],Le=Ne[1],We=(0,m.useState)(!1),Oe=c()(We,2),Fe=Oe[0],He=Oe[1],Ae=(0,m.useState)((null==ie?void 0:ie.system)||!1),Ie=c()(Ae,2),_e=(Ie[0],Ie[1]),ze=(0,m.useState)([]),De=c()(ze,2),qe=De[0],Je=De[1],Be=(0,m.useState)({}),Ve=c()(Be,2),Xe=Ve[0],Ge=Ve[1],Qe=(0,m.useState)(!1),$e=c()(Qe,2),Ye=$e[0],en=$e[1],nn=(0,m.useState)(""),ln=c()(nn,2),tn=ln[0],rn=ln[1],an=(0,m.useState)(""),on=c()(an,2),sn=on[0],un=on[1],dn=(0,m.useState)(""),pn=c()(dn,2),cn=pn[0],mn=pn[1],fn=(0,m.useState)(""),vn=c()(fn,2),gn=vn[0],hn=vn[1],bn=(0,m.useState)(!(null==ie||null===(n=ie.llm)||void 0===n||!n.enabled)),xn=c()(bn,2),yn=xn[0],Mn=xn[1],kn=(0,m.useState)(!(null==ie||!ie.kbEnabled)),Tn=c()(kn,2),jn=Tn[0],Sn=Tn[1],Cn=(0,m.useState)(!(null==ie||null===(l=ie.llm)||void 0===l||!l.useLlmWhenKbEmpty)),wn=c()(Cn,2),En=wn[0],Pn=wn[1],Zn=(0,m.useState)(!1),Un=c()(Zn,2),Kn=Un[0],Nn=Un[1],Rn=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),Ln=(0,m.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(n):"-"}),[]),Wn=(0,m.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),On=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),Fn=(0,m.useState)(null==ie||null===(t=ie.llm)||void 0===t?void 0:t.temperature),Hn=c()(Fn,2),An=Hn[0],In=Hn[1],_n=(0,m.useState)(Rn(null==ie||null===(a=ie.llm)||void 0===a?void 0:a.topP)),zn=c()(_n,2),Dn=zn[0],qn=zn[1],Jn=(0,m.useState)(null==ie||null===(s=ie.llm)||void 0===s?void 0:s.topK),Bn=c()(Jn,2),Vn=Bn[0],Xn=Bn[1],Gn=(0,m.useState)(Rn(null==ie||null===(i=ie.llm)||void 0===i?void 0:i.scoreThreshold)),Qn=c()(Gn,2),$n=Qn[0],Yn=Qn[1],el=(0,m.useState)(null==ie||null===(p=ie.llm)||void 0===p?void 0:p.maxTokens),nl=c()(el,2),ll=(nl[0],nl[1]),tl=(0,m.useState)(null==ie||null===(E=ie.llm)||void 0===E?void 0:E.contextMsgCount),rl=c()(tl,2),al=(rl[0],rl[1]),ol=(0,m.useCallback)(function(){var e=d()(u()().mark((function e(n){var l,t,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ce(!0),e.prev=1,null!=me&&me.uid){e.next=5;break}return ke([]),e.abrupt("return",[]);case 5:return t={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==me?void 0:me.uid,searchText:n||""},e.next=8,(0,C.VW)(t);case 8:return r=e.sent,a=(null==r||null===(l=r.data)||void 0===l?void 0:l.content)||[],ke(a),e.abrupt("return",a);case 12:return e.prev=12,Ce(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(n){return e.apply(this,arguments)}}(),[null==me?void 0:me.uid]);(0,m.useEffect)((function(){var e,n,l,t,r,a,o,s,u,i,d,p,c,m,f,v,g,h,b,x,y,M,k,T,j,C,w,E;if(ue){var P,Z,U;if(Ue((null==ie?void 0:ie.avatar)||""),Le((null==ie?void 0:ie.type)||S.f4h),_e((null==ie?void 0:ie.system)||!1),Mn(!(null==ie||null===(e=ie.llm)||void 0===e||!e.enabled)),Sn(!(null==ie||!ie.kbEnabled)),Pn(!(null==ie||null===(n=ie.llm)||void 0===n||!n.useLlmWhenKbEmpty)),null===(l=we.current)||void 0===l||l.setFieldsValue({nickname:null==ie?void 0:ie.nickname,type:null==ie?void 0:ie.type,settingsUid:null==ie||null===(t=ie.settings)||void 0===t?void 0:t.uid,name:null==ie?void 0:ie.name,categoryUid:null==ie?void 0:ie.categoryUid,provider:null==ie||null===(r=ie.llm)||void 0===r?void 0:r.textProvider,model:null==ie||null===(a=ie.llm)||void 0===a?void 0:a.textModel,prompt:null==ie||null===(o=ie.llm)||void 0===o?void 0:o.prompt,description:null==ie?void 0:ie.description,enabled:null==ie||null===(s=ie.llm)||void 0===s?void 0:s.enabled,enableThinking:null==ie||null===(u=ie.llm)||void 0===u?void 0:u.enableThinking,enableStreaming:null==ie||null===(i=ie.llm)||void 0===i?void 0:i.enableStreaming,useLlmWhenKbEmpty:null==ie||null===(d=ie.llm)||void 0===d?void 0:d.useLlmWhenKbEmpty,temperature:On(null==ie||null===(p=ie.llm)||void 0===p?void 0:p.temperature),topP:Rn(null==ie||null===(c=ie.llm)||void 0===c?void 0:c.topP),topK:null==ie||null===(m=ie.llm)||void 0===m?void 0:m.topK,scoreThreshold:Rn(null==ie||null===(f=ie.llm)||void 0===f?void 0:f.scoreThreshold),maxTokens:null==ie||null===(v=ie.llm)||void 0===v?void 0:v.maxTokens,contextMsgCount:null==ie||null===(g=ie.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==ie||null===(h=ie.llm)||void 0===h?void 0:h.defaultReply,searchType:(null==ie||null===(b=ie.llm)||void 0===b?void 0:b.searchType)||S.rk3,kbSourceEnabled:null==ie?void 0:ie.kbSourceEnabled,kbEnabled:null==ie?void 0:ie.kbEnabled,kbUid:null==ie?void 0:ie.kbUid}),null!=ie&&ie.llm&&(null!=ie&&null!==(x=ie.llm)&&void 0!==x&&x.textProviderUid||null!=ie&&null!==(y=ie.llm)&&void 0!==y&&y.textProvider||null!=ie&&null!==(M=ie.llm)&&void 0!==M&&M.textModel))rn((null==ie||null===(P=ie.llm)||void 0===P?void 0:P.textProvider)||""),un((null==ie||null===(Z=ie.llm)||void 0===Z?void 0:Z.textProviderUid)||""),mn((null==ie||null===(U=ie.llm)||void 0===U?void 0:U.textModel)||"");else rn(""),un(""),mn("");In(On(null==ie||null===(k=ie.llm)||void 0===k?void 0:k.temperature)),qn(Rn(null==ie||null===(T=ie.llm)||void 0===T?void 0:T.topP)),Xn(null==ie||null===(j=ie.llm)||void 0===j?void 0:j.topK),Yn(Rn(null==ie||null===(C=ie.llm)||void 0===C?void 0:C.scoreThreshold)),ll(null==ie||null===(w=ie.llm)||void 0===w?void 0:w.maxTokens),al(null==ie||null===(E=ie.llm)||void 0===E?void 0:E.contextMsgCount),Nn(!1)}}),[ue,ie]);var sl=function(){var e=d()(u()().mark((function e(n){var l,t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue(n),!fe||!ie){e.next=13;break}return e.prev=2,l={uid:null==ie?void 0:ie.uid,avatar:n},e.next=6,(0,T.lz)(l);case 6:200===(null==(t=e.sent)?void 0:t.code)?(k.yw.success(ce.formatMessage({id:"update.success",defaultMessage:"更新成功"})),null==pe||pe(t.data)):k.yw.error((null==t?void 0:t.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),k.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(n){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){ue&&Re===S.f4h&&ol()}),[ue,Re,ol]);var ul=(0,m.useMemo)((function(){return Me.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[Me]),il=(0,m.useRef)(),dl=(0,m.useCallback)((function(e){il.current&&clearTimeout(il.current),il.current=setTimeout((function(){ol(e)}),300)}),[ol]);(0,m.useEffect)((function(){return function(){il.current&&clearTimeout(il.current)}}),[]);var pl=(0,m.useCallback)((function(){Me.length||ol()}),[Me.length,ol]),cl=(0,m.useCallback)(d()(u()().mark((function e(){var n,l,t,r,a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==me?void 0:me.uid,level:S.whQ},e.next=4,(0,A.mK)(n);case 4:200===(null==(l=e.sent)?void 0:l.code)&&(r=(null==l||null===(t=l.data)||void 0===t?void 0:t.content)||[],Je(r),sn&&!tn&&(a=r.find((function(e){return e.uid===sn})))&&rn(a.type),!sn&&tn&&(o=r.find((function(e){return e.type===tn})))&&un(o.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==me?void 0:me.uid,sn,tn]);(0,m.useEffect)((function(){ue&&cl()}),[ue,cl]);var ml=(0,m.useCallback)((function(){return en(!0)}),[]),fl=(0,m.useCallback)((function(){return en(!1)}),[]),vl=(0,m.useCallback)((function(e,n){Ge((function(l){return o()(o()({},l),{},r()({},e,n))}))}),[]),gl=(0,m.useCallback)((function(e,n,l){var t,r,a,o=qe.find((function(n){return n.uid===e})),s=o?o.type:e;rn(s),un(e),mn(n),hn(l),null===(t=we.current)||void 0===t||t.setFieldsValue({provider:s,model:n});var u=null===(r=we.current)||void 0===r||null===(a=r.getFieldsValue)||void 0===a?void 0:a.call(r);if(u){var i,d,p,c,m,f,v,g,h,b,x,y,M,k,T,j,S,C,w,E,P,Z,U,K=(null==ie?void 0:ie.llm)||{},N=(null!==(i=u.prompt)&&void 0!==i?i:"")!==(null!==(d=K.prompt)&&void 0!==d?d:"")||(e||"")!==(null!==(p=K.textProviderUid)&&void 0!==p?p:"")||(s||u.provider||"")!==(null!==(c=K.textProvider)&&void 0!==c?c:"")||(n||u.model||"")!==(null!==(m=K.textModel)&&void 0!==m?m:"")||!!u.enabled!=!!K.enabled||!!u.enableThinking!=!!K.enableThinking||!!u.enableStreaming!=!!K.enableStreaming||!!u.useLlmWhenKbEmpty!=!!K.useLlmWhenKbEmpty||(null!==(f=u.temperature)&&void 0!==f?f:null)!==(null!==(v=K.temperature)&&void 0!==v?v:null)||(null!==(g=u.topP)&&void 0!==g?g:null)!==(null!==(h=K.topP)&&void 0!==h?h:null)||(null!==(b=u.topK)&&void 0!==b?b:null)!==(null!==(x=K.topK)&&void 0!==x?x:null)||(null!==(y=u.scoreThreshold)&&void 0!==y?y:null)!==(null!==(M=K.scoreThreshold)&&void 0!==M?M:null)||(null!==(k=u.maxTokens)&&void 0!==k?k:null)!==(null!==(T=K.maxTokens)&&void 0!==T?T:null)||(null!==(j=u.contextMsgCount)&&void 0!==j?j:null)!==(null!==(S=K.contextMsgCount)&&void 0!==S?S:null)||(null!==(C=u.defaultReply)&&void 0!==C?C:"")!==(null!==(w=K.defaultReply)&&void 0!==w?w:"")||(null!==(E=u.searchType)&&void 0!==E?E:"")!==(null!==(P=K.searchType)&&void 0!==P?P:""),R=!!u.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!u.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(Z=u.kbUid)&&void 0!==Z?Z:"")!==(null!==(U=null==ie?void 0:ie.kbUid)&&void 0!==U?U:"");Nn(N||R)}en(!1)}),[qe]);return(0,z.jsxs)(f.a,{onValuesChange:function(e,n){var l,t,r,a,o,s,u,i,d,p,c,m,f,v,g,h,b,x,y,M,k,T,j,S=(null==ie?void 0:ie.llm)||{},C=(null!==(l=n.prompt)&&void 0!==l?l:"")!==(null!==(t=S.prompt)&&void 0!==t?t:"")||(sn||"")!==(null!==(r=S.textProviderUid)&&void 0!==r?r:"")||(tn||n.provider||"")!==(null!==(a=S.textProvider)&&void 0!==a?a:"")||(cn||n.model||"")!==(null!==(o=S.textModel)&&void 0!==o?o:"")||!!n.enabled!=!!S.enabled||!!n.enableThinking!=!!S.enableThinking||!!n.enableStreaming!=!!S.enableStreaming||!!n.useLlmWhenKbEmpty!=!!S.useLlmWhenKbEmpty||(null!==(s=n.temperature)&&void 0!==s?s:null)!==(null!==(u=S.temperature)&&void 0!==u?u:null)||(null!==(i=n.topP)&&void 0!==i?i:null)!==(null!==(d=S.topP)&&void 0!==d?d:null)||(null!==(p=n.topK)&&void 0!==p?p:null)!==(null!==(c=S.topK)&&void 0!==c?c:null)||(null!==(m=n.scoreThreshold)&&void 0!==m?m:null)!==(null!==(f=S.scoreThreshold)&&void 0!==f?f:null)||(null!==(v=n.maxTokens)&&void 0!==v?v:null)!==(null!==(g=S.maxTokens)&&void 0!==g?g:null)||(null!==(h=n.contextMsgCount)&&void 0!==h?h:null)!==(null!==(b=S.contextMsgCount)&&void 0!==b?b:null)||(null!==(x=n.defaultReply)&&void 0!==x?x:"")!==(null!==(y=S.defaultReply)&&void 0!==y?y:"")||(null!==(M=n.searchType)&&void 0!==M?M:"")!==(null!==(k=S.searchType)&&void 0!==k?k:""),w=!!n.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!n.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(T=n.kbUid)&&void 0!==T?T:"")!==(null!==(j=null==ie?void 0:ie.kbUid)&&void 0!==j?j:"");Nn(C||w)},open:ue,onOpenChange:function(e){e||de()},title:ce.formatMessage({id:"robot.edit",defaultMessage:"编辑机器人"}),width:560,formRef:we,initialValues:fe?{nickname:null==ie?void 0:ie.nickname,type:null==ie?void 0:ie.type,settingsUid:null==ie||null===(P=ie.settings)||void 0===P?void 0:P.uid,name:null==ie?void 0:ie.name,categoryUid:null==ie?void 0:ie.categoryUid,provider:null==ie||null===(Z=ie.llm)||void 0===Z?void 0:Z.textProvider,model:null==ie||null===(J=ie.llm)||void 0===J?void 0:J.textModel,prompt:null==ie||null===(B=ie.llm)||void 0===B?void 0:B.prompt,description:null==ie?void 0:ie.description,enabled:null==ie||null===(V=ie.llm)||void 0===V?void 0:V.enabled,enableThinking:null==ie||null===(X=ie.llm)||void 0===X?void 0:X.enableThinking,enableStreaming:null==ie||null===(G=ie.llm)||void 0===G?void 0:G.enableStreaming,useLlmWhenKbEmpty:null==ie||null===(Q=ie.llm)||void 0===Q?void 0:Q.useLlmWhenKbEmpty,temperature:On(null==ie||null===($=ie.llm)||void 0===$?void 0:$.temperature),topP:Rn(null==ie||null===(Y=ie.llm)||void 0===Y?void 0:Y.topP),topK:null==ie||null===(ee=ie.llm)||void 0===ee?void 0:ee.topK,scoreThreshold:Rn(null==ie||null===(ne=ie.llm)||void 0===ne?void 0:ne.scoreThreshold),maxTokens:null==ie||null===(le=ie.llm)||void 0===le?void 0:le.maxTokens,contextMsgCount:null==ie||null===(te=ie.llm)||void 0===te?void 0:te.contextMsgCount,defaultReply:null==ie||null===(re=ie.llm)||void 0===re?void 0:re.defaultReply,searchType:(null==ie||null===(ae=ie.llm)||void 0===ae?void 0:ae.searchType)||S.rk3,kbSourceEnabled:null==ie?void 0:ie.kbSourceEnabled,kbEnabled:null==ie?void 0:ie.kbEnabled,kbUid:null==ie?void 0:ie.kbUid}:{type:S.f4h,searchType:S.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,z.jsxs)("div",{children:[(0,z.jsx)(U.ZP,{style:{marginRight:8},onClick:function(){return de()},children:ce.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,z.jsx)(U.ZP,{type:"primary",onClick:function(){var e,n;return null===(e=we.current)||void 0===e||null===(n=e.submit)||void 0===n?void 0:n.call(e)},children:ce.formatMessage({id:"save",defaultMessage:"保存"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=d()(u()().mark((function e(n){var l,t,r,a,o,s,i,d,p,c,m,f,v,g,h,b,x,y,M,j,C,w,E,P,Z,U,K,N,R,L,W,O;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,fe&&null!=ie&&ie.uid){e.next=4;break}return k.yw.warning(ce.formatMessage({id:"robot.edit.only",defaultMessage:"当前仅支持编辑，请通过新建入口创建机器人"})),e.abrupt("return",!1);case 4:return Z=(null==ie?void 0:ie.llm)||{},U=(null!==(l=n.prompt)&&void 0!==l?l:"")!==(null!==(t=Z.prompt)&&void 0!==t?t:"")||(sn||"")!==(null!==(r=Z.textProviderUid)&&void 0!==r?r:"")||(tn||n.provider||"")!==(null!==(a=Z.textProvider)&&void 0!==a?a:"")||(cn||n.model||"")!==(null!==(o=Z.textModel)&&void 0!==o?o:"")||!!n.enabled!=!!Z.enabled||!!n.enableThinking!=!!Z.enableThinking||!!n.enableStreaming!=!!Z.enableStreaming||!!n.useLlmWhenKbEmpty!=!!Z.useLlmWhenKbEmpty||(null!==(s=n.temperature)&&void 0!==s?s:null)!==(null!==(i=Z.temperature)&&void 0!==i?i:null)||(null!==(d=n.topP)&&void 0!==d?d:null)!==(null!==(p=Z.topP)&&void 0!==p?p:null)||(null!==(c=n.topK)&&void 0!==c?c:null)!==(null!==(m=Z.topK)&&void 0!==m?m:null)||(null!==(f=n.scoreThreshold)&&void 0!==f?f:null)!==(null!==(v=Z.scoreThreshold)&&void 0!==v?v:null)||(null!==(g=n.maxTokens)&&void 0!==g?g:null)!==(null!==(h=Z.maxTokens)&&void 0!==h?h:null)||(null!==(b=n.contextMsgCount)&&void 0!==b?b:null)!==(null!==(x=Z.contextMsgCount)&&void 0!==x?x:null)||(null!==(y=n.defaultReply)&&void 0!==y?y:"")!==(null!==(M=Z.defaultReply)&&void 0!==M?M:"")||(null!==(j=n.searchType)&&void 0!==j?j:"")!==(null!==(C=Z.searchType)&&void 0!==C?C:""),K=!!n.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!n.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(w=n.kbUid)&&void 0!==w?w:"")!==(null!==(E=null==ie?void 0:ie.kbUid)&&void 0!==E?E:""),N=U||K,k.yw.loading(ce.formatMessage({id:fe?"updating":"creating",defaultMessage:fe?"Updating":"Creating"})),L={uid:null==ie?void 0:ie.uid,nickname:n.nickname,name:n.name,type:n.type||S.f4h,description:n.description,avatar:Ze,settingsUid:n.settingsUid,kbSourceEnabled:n.kbSourceEnabled,kbEnabled:n.kbEnabled,kbUid:n.kbUid,llm:{prompt:n.prompt,textProvider:tn||n.provider,textProviderUid:sn||void 0,textModel:cn||n.model,enabled:n.enabled,enableThinking:n.enableThinking,enableStreaming:n.enableStreaming,useLlmWhenKbEmpty:n.useLlmWhenKbEmpty,temperature:On(n.temperature),topP:Rn(n.topP),topK:n.topK,scoreThreshold:Rn(n.scoreThreshold),maxTokens:n.maxTokens,contextMsgCount:n.contextMsgCount,defaultReply:n.defaultReply,searchType:n.searchType}},e.next=12,(0,T.$l)(L);case 12:if(R=e.sent,console.log("updateRobot:",R,L),k.yw.destroy(),200!==(null===(P=R)||void 0===P?void 0:P.code)){e.next=23;break}return k.yw.success(ce.formatMessage({id:"save.success",defaultMessage:"保存成功"})),N&&k.yw.info(ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),5),null==pe||pe(null===(W=R)||void 0===W?void 0:W.data),de(),e.abrupt("return",!0);case 23:return k.yw.error((null===(O=R)||void 0===O?void 0:O.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),k.yw.destroy(),k.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(n){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(K.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:ce.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"头像"}),children:(0,z.jsxs)(F.G,{onSuccess:sl,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,z.jsx)(N.Z,{src:Ze}),(0,z.jsx)(U.ZP,{icon:(0,z.jsx)(O.Z,{}),style:{marginLeft:12},children:ce.formatMessage({id:"pages.robot.upload",defaultMessage:"上传"})})]},"avatar")}),(0,z.jsx)(v.Z,{name:"nickname",label:ce.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:ce.formatMessage({id:"nickname",defaultMessage:"昵称"})}]}),(0,z.jsx)(g.Z,{name:"description",label:ce.formatMessage({id:"description",defaultMessage:"描述"})}),Re===S.f4h&&(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(h.A.Item,{name:"settingsUid",label:ce.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),rules:[{required:!0,message:ce.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,z.jsx)(q,{options:ul,loading:Se,placeholder:ce.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),emptyContent:0===ul.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:ce.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(U.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(W.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return be(!0)},children:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:dl,onDropdownOpen:pl,onCreate:function(){return be(!0)},createLabel:ce.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})})}),(0,z.jsx)(b.Z,{name:"enabled",label:ce.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),fieldProps:{onChange:function(e){return Mn(e)}}}),yn&&(0,z.jsxs)(m.Fragment,{children:[(0,z.jsxs)("div",{children:[(0,z.jsx)(D,{style:{marginBottom:8,display:"block"},children:ce.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"文字对话模型提供商"})}),(0,z.jsx)(R.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:ml,children:(sn||tn)&&cn?(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsxs)("div",{children:[(0,z.jsx)(D,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"供应商："})}),(0,z.jsx)(D,{strong:!0,children:(null===(oe=qe.find((function(e){return e.uid===sn})))||void 0===oe?void 0:oe.nickname)||(null===(se=qe.find((function(e){return e.type===tn})))||void 0===se?void 0:se.nickname)||tn}),(0,z.jsx)("br",{}),(0,z.jsx)(D,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"模型："})}),(0,z.jsx)(D,{strong:!0,children:gn||cn})]}),(0,z.jsx)(U.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"更换模型"})})]}):(0,z.jsx)("div",{style:{textAlign:"center"},children:(0,z.jsx)(U.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"选择AI模型"})})})}),(0,z.jsxs)("div",{style:{display:"none"},children:[(0,z.jsx)(x.Z,{name:"provider"}),(0,z.jsx)(x.Z,{name:"model"})]})]}),(0,z.jsx)(y.Z,{name:"temperature",label:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,z.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"})}),(0,z.jsx)("span",{style:{color:"#999"},children:": "+Ln(An,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"控制输出的随机性，值越高输出越随机创新"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return In(On(e))}}}),(0,z.jsx)(y.Z,{name:"topP",label:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,z.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,z.jsx)("span",{style:{color:"#999"},children:": "+Ln(Dn,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P 采样阈值，保留累计概率达到该值的词，范围 0-1，值越小越保守"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return qn(On(e))}}}),(0,z.jsx)(y.Z,{name:"topK",label:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,z.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,z.jsx)("span",{style:{color:"#999"},children:": "+Wn(Vn)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"检索时返回的相关文档数量"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Xn(e)}}}),(0,z.jsx)(y.Z,{name:"scoreThreshold",label:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,z.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"得分阈值"})}),(0,z.jsx)("span",{style:{color:"#999"},children:": "+Ln($n,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"知识库召回命中文档的最低得分阈值，低于此值不纳入参考"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Yn(On(e))}}}),!1,(0,z.jsx)(g.Z,{name:"prompt",label:ce.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})}),(0,z.jsx)("div",{style:{marginTop:8,marginBottom:12},children:(0,z.jsx)(U.ZP,{onClick:function(){null!=me&&me.uid?He(!0):k.yw.warning(ce.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"}))},children:ce.formatMessage({id:"prompt.select",defaultMessage:"选择提示词"})})}),(0,z.jsx)(b.Z,{name:"useLlmWhenKbEmpty",label:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库空结果时使用大模型"}),tooltip:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"开启后，当知识库没有命中时将继续调用大模型回答；关闭则返回默认回复"}),fieldProps:{onChange:function(e){return Pn(e)}}}),!En&&(0,z.jsx)(g.Z,{name:"defaultReply",label:ce.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"默认回复"})})]}),(0,z.jsxs)(m.Fragment,{children:[(0,z.jsx)(b.Z,{name:"kbEnabled",label:ce.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"启用知识库"}),fieldProps:{onChange:function(e){return Sn(e)}}}),jn&&(0,z.jsxs)(m.Fragment,{children:[(0,z.jsx)(b.Z,{name:"kbSourceEnabled",label:ce.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),tooltip:ce.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"开启后将在回复中显示知识库命中来源，便于调试不同检索类型的搜索结果"})}),(0,z.jsx)(x.Z,{name:"searchType",label:ce.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),valueEnum:r()(r()(r()({},S.ccx,{text:"全文"}),S.DGp,{text:"向量"}),S.rk3,{text:"混合"})}),(0,z.jsx)(x.Z,{name:"kbUid",label:ce.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),placeholder:ce.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"请选择知识库"}),showSearch:!0,debounceTime:300,request:function(){var e=d()(u()().mark((function e(n){var l,t,r,a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=n.keyWords,e.prev=1,r={pageNumber:0,pageSize:50,type:S.QPQ,orgUid:null==me?void 0:me.uid,searchText:l||""},e.next=5,(0,I.AP)(r);case 5:return a=e.sent,o=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],e.abrupt("return",o.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(n){return e.apply(this,arguments)}}()})]})]}),Kn&&(0,z.jsx)(L.Z,{type:"info",showIcon:!0,message:ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),style:{marginBottom:12}}),(0,z.jsx)(H.Z,{visible:Ye,onCancel:fl,onOk:gl,initialProvider:sn||tn,initialModel:cn,initialModelLabel:gn,providers:qe,currentOrgUid:null==me?void 0:me.uid,existingProviderModels:Xe,onModelsLoaded:vl,allowedModelTypes:[S.l55,S.xZ8,"CHAT"]}),(0,z.jsx)(_.Z,{open:Fe,orgUid:null==me?void 0:me.uid,onClose:function(){return He(!1)},onSelect:function(e){var n;null!=e&&e.systemPrompt?(null===(n=we.current)||void 0===n||n.setFieldsValue({prompt:e.systemPrompt}),k.yw.success(ce.formatMessage({id:"success",defaultMessage:"已替换提示词"})),He(!1)):k.yw.warning(ce.formatMessage({id:"prompt.system.empty",defaultMessage:"该提示词没有 系统提示词"}))}}),(0,z.jsx)(w.Z,{open:he,onOpenChange:be,orgUid:(null==me?void 0:me.uid)||"",record:null,onSuccess:function(){be(!1),ol()}})]})}}}]);