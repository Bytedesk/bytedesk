"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2575],{25197:function(e,t,s){var a=s(90819),n=s.n(a),r=s(73193),o=s.n(r),l=s(89933),i=s.n(l),d=s(45332),u=s.n(d),c=s(44194),f=s(41196),g=s(86895),m=s(32525),p=s(66431),v=s(14906),h=s(19433),M=s(88894),b=s(31549);t.Z=function(e){var t=e.open,s=e.onOpenChange,a=e.orgUid,r=e.record,l=e.onSuccess,d=(0,v.useIntl)(),x=f.Z.useForm(),j=u()(x,1)[0];(0,c.useEffect)((function(){var e,s;t&&(r?j.setFieldsValue({name:r.name||"",description:r.description||"",enabled:null===(e=r.enabled)||void 0===e||e,isDefault:null!==(s=r.isDefault)&&void 0!==s&&s}):(j.resetFields(),j.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,r,j]);var k=function(){var e=i()(n()().mark((function e(){var t,i,u;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.validateFields();case 3:if(t=e.sent,i=o()(o()({},t),{},{orgUid:a,uid:null==r?void 0:r.uid}),null==r||!r.uid){e.next=11;break}return e.next=8,(0,M.sK)(i);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,M.ZJ)(i);case 13:e.t0=e.sent;case 14:(u=e.t0)&&200===u.code?(h.yw.success(d.formatMessage({id:null!=r&&r.uid?"common.updated":"common.created",defaultMessage:null!=r&&r.uid?"更新成功":"创建成功"})),null==l||l(),s(!1)):h.yw.error((null==u?void 0:u.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(g.Z,{title:(0,b.jsx)(v.FormattedMessage,{id:null!=r&&r.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=r&&r.uid?"编辑模板":"新建模板"}),open:t,onOk:k,onCancel:function(){return s(!1)},okText:(0,b.jsx)(v.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,b.jsx)(v.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,b.jsxs)(f.Z,{form:j,layout:"vertical",preserve:!1,children:[(0,b.jsx)(f.Z.Item,{name:"name",label:(0,b.jsx)(v.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:d.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,b.jsx)(m.Z,{placeholder:d.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,b.jsx)(f.Z.Item,{name:"description",label:(0,b.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(m.Z.TextArea,{rows:3,placeholder:d.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,b.jsx)(f.Z.Item,{name:"enabled",label:(0,b.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,b.jsx)(p.Z,{})})]})})}},52575:function(e,t,s){var a=s(90819),n=s.n(a),r=s(89933),o=s.n(r),l=s(45332),i=s.n(l),d=s(98830),u=s(39497),c=s(25784),f=s(89965),g=s(2250),m=s(14906),p=s(86895),v=s(41196),h=s(33797),M=s(82770),b=s(39487),x=s(44194),j=s(88894),k=s(25197),Z=s(10162),y=s(2011),F=s(59908),w=s(31549);t.Z=function(e){var t=e.open,s=e.onClose,a=e.onSubmit,r=(0,m.useIntl)(),l=c.A.useForm(),S=i()(l,1)[0],C=(0,d.u)((function(e){return e.currentOrg})),U=(0,x.useState)(!1),O=i()(U,2),q=O[0],P=O[1],R=(0,x.useState)(!1),T=i()(R,2),E=T[0],I=T[1],V=(0,x.useState)(0),A=i()(V,2),N=A[0],D=A[1],z=(0,x.useState)([]),G=i()(z,2),W=G[0],B=G[1],Q=(0,x.useState)(""),_=i()(Q,2),H=_[0],J=_[1],K=(0,x.useCallback)(function(){var e=o()(n()().mark((function e(t){var s,a,r,o;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(!0),e.prev=1,a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==C?void 0:C.uid,searchText:t||""},e.next=5,(0,j.VW)(a);case 5:return r=e.sent,console.log("queryRobotSettingsByOrg response:",r,a),o=(null==r||null===(s=r.data)||void 0===s?void 0:s.content)||[],B(o),!S.getFieldValue("settingsUid")&&o.length>0&&S.setFieldsValue({settingsUid:o[0].uid}),e.abrupt("return",o.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,I(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==C?void 0:C.uid,S]),L=function(){console.log("handleSaveRobot"),S.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==C?void 0:C.uid,avatar:e.avatar||H};console.log("robotObject:",t),a(t),S.resetFields(),J("")})).catch((function(e){console.log("Form errors:",e)}))};(0,x.useEffect)((function(){console.log("RobotForm useEffect"),t&&(S.resetFields(),S.setFieldsValue({type:u.f4h}),J(""))}),[t,S]);var X=function(){var e=o()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),J(t),S.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,w.jsx)("div",{children:(0,w.jsxs)(p.Z,{title:r.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:r.formatMessage({id:"save",defaultMessage:"Save"}),onOk:L,onCancel:function(){S.resetFields(),s()},children:[(0,w.jsxs)(c.A,{form:S,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,w.jsx)(v.Z.Item,{name:"avatarUpload",label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,w.jsxs)(y.G,{onSuccess:X,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,w.jsx)(h.Z,{src:H}),(0,w.jsx)(M.ZP,{icon:(0,w.jsx)(F.Z,{}),style:{marginLeft:12},children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,w.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,w.jsx)(g.Z,{label:r.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:r.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],placeholder:r.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:N},request:function(){var e=o()(n()().mark((function e(t){var s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.keyWords,e.abrupt("return",K(s));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:E,notFoundContent:0===W.length?(0,w.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,w.jsx)("div",{style:{marginBottom:8,color:"#999"},children:r.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,w.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,w.jsx)(Z.Z,{}),onClick:function(){return P(!0)},children:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0},renderFormItem:function(e,t){var s;return(0,w.jsxs)(b.Z.Compact,{block:!0,children:[null===(s=t.defaultRender)||void 0===s?void 0:s.call(t,e),(0,w.jsx)(M.ZP,{size:"small",icon:(0,w.jsx)(Z.Z,{}),onClick:function(){return P(!0)},title:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:r.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}}),(0,w.jsx)(f.Z,{label:r.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:r.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return L()}}}),(0,w.jsx)(g.Z,{label:r.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:r.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:r.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb,disabled:!0},{label:r.formatMessage({id:u.wG_,defaultMessage:"Marketing"}),value:u.wG_,disabled:!0}],rules:[{required:!0,message:r.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:r.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,w.jsx)(k.Z,{open:q,onOpenChange:P,orgUid:(null==C?void 0:C.uid)||"",record:null,onSuccess:function(){P(!1),D((function(e){return e+1}))}})]})})}}}]);