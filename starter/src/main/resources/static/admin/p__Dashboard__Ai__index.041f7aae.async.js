"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2522],{27522:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return h},t5:function(){return v},v_:function(){return g}});var o=n(90819),r=n.n(o),s=n(73193),a=n.n(s),i=n(89933),l=n.n(i),u=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:a()(a()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:a()(a()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:a()(a()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:a()(a()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},96115:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ue}});var o=n(75574),r=n(44194),s=n(90819),a=n.n(s),i=n(89933),l=n.n(i),u=n(45332),c=n.n(u),d=n(66310),f=n(53530),g=n(27487),p=n(75365),v=n(9452),m=n(84288),h=n(15722),b=n(82669),x=n(30921),y=n(23864),C=n(40612),M=n(55735),w=n(69169),j=n(4499),k=n(84881),q=n(31549),Z=function(e){var t=e.open,n=e.onClose,o=e.onSubmit,s=(0,x.useIntl)(),a=w.A.useForm(),i=c()(a,1)[0],l=(0,C.u)((function(e){return e.currentOrg}));return(0,r.useEffect)((function(){console.log("RobotForm useEffect"),i.setFieldsValue({type:M.f4h})}),[]),(0,q.jsx)("div",{children:(0,q.jsx)(f.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:function(){console.log("handleSaveRobot"),i.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},orgUid:null==l?void 0:l.uid};console.log("robotObject:",t),o(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){n()},children:(0,q.jsxs)(w.A,{form:i,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,q.jsx)(j.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,q.jsx)(k.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:M.f4h,defaultMessage:"Service"}),value:M.f4h}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})},F=n(66916),S=n(86803),R=n(76750),T=function(){var e=(0,y.Z)().isDarkMode,t=(0,x.useIntl)(),n=((0,r.useRef)(!1),(0,R.Z)()),o=n.translateString,s=n.translateStringTranct,i=(0,d.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,insertRobot:e.insertRobot,deleteCurrentRobot:e.deleteCurrentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),u=i.robotResult,w=i.currentRobot,j=i.insertRobot,k=i.deleteCurrentRobot,T=i.setRobotResult,U=i.setCurrentRobot,A=(0,C.u)((function(e){return e.currentOrg})),V=f.Z.useModal(),P=c()(V,2),O=P[0],E=P[1],I=function(){var e=l()(a()().mark((function e(n){var o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),S.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,F.gf)(n);case 4:o=e.sent,console.log("delete robot response",o),200===o.code?(S.yw.destroy(),S.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),k(n.uid)):(S.yw.destroy(),S.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=l()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.yw.loading("loading"),t={pageNumber:0,pageSize:100,categoryUid:"",level:M.whQ,type:M.f4h,orgUid:null==A?void 0:A.uid},e.next=4,(0,F.p0)(t);case 4:n=e.sent,console.log("queryRobotsByOrg: ",n,t),200===n.code?(S.yw.destroy(),T(n),!w&&n.data.content.length>0&&U(n.data.content[0])):(S.yw.destroy(),S.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){z()}),[]);var L=(0,r.useState)(!1),N=c()(L,2),W=N[0],_=N[1],B=function(){var e=l()(a()().mark((function e(n){var o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.yw.loading(t.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=3,(0,F.lg)(n);case 3:o=e.sent,console.log("handleSaveRobot response:",o),200===o.code?(S.yw.destroy(),S.yw.success(t.formatMessage({id:"create.success"})),j(o.data),_(!1)):(S.yw.destroy(),_(!1),S.yw.error(o.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(e){return t.formatMessage({id:null==e?void 0:e.type,defaultMessage:null==e?void 0:e.type})};return(0,q.jsxs)("div",{children:[(0,q.jsx)("div",{style:{margin:10},children:(0,q.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[(0,q.jsx)(p.ZP,{size:"small",type:"primary",icon:(0,q.jsx)(b.Z,{}),onClick:function(){_(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,q.jsx)(p.ZP,{size:"small",onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,q.jsx)(p.ZP,{onClick:function(){return function(e){O.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,q.jsx)(h.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(o(e.nickname),"】？"),onOk:function(){I(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(w)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==w?void 0:w.uid),children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,q.jsx)(v.Z,{itemLayout:"horizontal",dataSource:u.data.content,renderItem:function(t,n){return(0,q.jsx)(v.Z.Item,{style:(null==w?void 0:w.uid)===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){U(t)},children:(0,q.jsx)(v.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,q.jsx)(m.C,{src:t.avatar}),title:(0,q.jsx)(q.Fragment,{children:s(null==t?void 0:t.nickname)}),description:Q(t)})})}}),W&&(0,q.jsx)(Z,{open:W,onClose:function(){_(!1)},onSubmit:B}),E]})},U=n(8247),A=n(80690),V=n(73193),P=n.n(V),O=n(6631),E=n(59908),I=n(32350),z=n(57178),L=(n(26286),function(){var e,t=w.A.useForm(),n=c()(t,1)[0],o=(0,x.useIntl)(),s=(0,R.Z)().translateString,i=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),u=i.currentRobot,f=i.setCurrentRobot,g=(0,r.useState)(""),v=c()(g,2),h=v[0],b=v[1],y=(0,r.useState)(s(null==u||null===(e=u.serviceSettings)||void 0===e?void 0:e.welcomeTip)||""),C=c()(y,2),M=C[0],k=C[1];(0,r.useEffect)((function(){var e;u&&(n.setFieldValue("nickname",s(null==u?void 0:u.nickname)),k(s(null==u||null===(e=u.serviceSettings)||void 0===e?void 0:e.welcomeTip)),n.setFieldValue("description",s(null==u?void 0:u.description)))}),[u]);var Z=function(){var e=l()(a()().mark((function e(t){var n,r,s,i,l,c,d,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),S.yw.loading(o.formatMessage({id:"updating"})),d=P()(P()({},u),{},{serviceSettings:P()(P()({},u.serviceSettings),{},{welcomeTip:M,welcomeFaqUids:null==u||null===(n=u.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),quickFaqUids:null==u||null===(r=u.serviceSettings)||void 0===r||null===(r=r.quickFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null==u||null===(s=u.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==u||null===(i=u.serviceSettings)||void 0===i||null===(i=i.guessFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),hotFaqUids:null==u||null===(l=u.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==u||null===(c=u.serviceSettings)||void 0===c||null===(c=c.shortcutFaqs)||void 0===c?void 0:c.map((function(e){return e.uid}))}),nickname:t.nickname,description:t.description,avatar:h}),console.log("robotObject:",d),e.next=6,(0,F.$l)(d);case 6:g=e.sent,console.log("updateRobot response:",g),200===g.code?(S.yw.success(o.formatMessage({id:"update.success"})),f(g.data)):S.yw.error(g.message),S.yw.destroy();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=l()(a()().mark((function e(t){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUploadSuccess:",t),b(t),n=P()(P()({},u),{},{avatar:t}),e.next=5,(0,F.n1)(n);case 5:r=e.sent,console.log("updateAvatar response:",r),200===r.code?(S.yw.success(o.formatMessage({id:"update.success"})),f(r.data)):S.yw.error(r.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){b(null==u?void 0:u.avatar)}),[u]),(0,q.jsxs)(w.A,{form:n,style:{marginLeft:"20px"},onFinish:Z,children:[(0,q.jsx)(z.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return console.log("Upload event:",e),Array.isArray(e)?e:null==e?void 0:e.fileList},label:o.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,q.jsxs)(O.G,{onSuccess:T,onError:function(e){console.log("handleUploadError:",e)},children:[(0,q.jsx)(m.C,{src:h}),(0,q.jsx)(p.ZP,{icon:(0,q.jsx)(E.Z,{}),children:o.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,q.jsx)(j.Z,{width:"md",name:"nickname",label:o.formatMessage({id:"agent.info.nickname"}),rules:[{required:!0,message:o.formatMessage({id:"agent.info.nickname.required"})}]}),(0,q.jsx)(I.Z,{width:"md",name:"description",label:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})}),N=n(27522),W=n(5651),_=function(){var e=(0,x.useIntl)(),t=(0,x.useNavigate)(),n=w.A.useForm(),o=c()(n,1)[0],s=(0,R.Z)().translateString,i=(0,r.useState)(),u=c()(i,2),f=u[0],g=u[1],v=(0,C.u)((function(e){return e.currentOrg})),m=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),h=m.currentRobot,b=m.setCurrentRobot,y=function(){var t=l()(a()().mark((function t(){var n,o;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,type:M.QPQ,orgUid:null==v?void 0:v.uid},t.next=4,(0,N.AP)(n);case 4:o=t.sent,console.log("getKeywordBase response:",n,o),S.yw.destroy(),200===o.code?g(o):S.yw.error(o.message);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,r.useEffect)((function(){y()}),[]),(0,r.useEffect)((function(){o.setFieldValue("kbUid",null==h?void 0:h.kbUid)}),[h]);var j=function(){var t=l()(a()().mark((function t(n){var o,r,s,i,l,u,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("onFinish values:",n),u=P()(P()({},h),{},{serviceSettings:P()(P()({},h.serviceSettings),{},{faqUids:null==h||null===(o=h.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})),quickFaqUids:null==h||null===(r=h.serviceSettings)||void 0===r||null===(r=r.quickFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),guessFaqUids:null==h||null===(s=h.serviceSettings)||void 0===s||null===(s=s.guessFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),hotFaqUids:null==h||null===(i=h.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==h||null===(l=h.serviceSettings)||void 0===l||null===(l=l.shortcutFaqs)||void 0===l?void 0:l.map((function(e){return e.uid}))}),kbUid:n.kbUid}),console.log("robotObject:",u),t.next=5,(0,F.$l)(u);case 5:c=t.sent,console.log("updateRobot response:",c),200===c.code?(S.yw.destroy(),S.yw.success(e.formatMessage({id:"update.success"})),b(c.data)):(S.yw.destroy(),S.yw.error(c.message));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,q.jsx)("div",{children:(0,q.jsxs)(w.A,{form:o,onFinish:j,children:[(0,q.jsx)(k.Z,{width:"md",name:"kbUid",label:"知识库",options:null==f?void 0:f.data.content.map((function(e){return{value:e.uid,label:s(e.name)}})),fieldProps:{onChange:function(e){console.log("kbUid:",e)}}}),(0,q.jsx)(w.A.Item,{children:(0,q.jsx)(p.ZP,{icon:(0,q.jsx)(W.Z,{}),onClick:function(){t("/kb/llm/data")},children:"添加大模型知识库"},"github")})]})})},B=n(43705),Q=n(71469),X=n(50796);function G(e){return K.apply(this,arguments)}function K(){return(K=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/provider/query/org",{method:"GET",params:P()(P()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return $.apply(this,arguments)}function $(){return($=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/model/query/org",{method:"GET",params:P()(P()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=n(48708),J=n(79907);function Y(){return ee.apply(this,arguments)}function ee(){return(ee=l()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:M.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return(ne=l()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:M.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=function(){var e=(0,x.useIntl)(),t=w.A.useForm(),n=c()(t,1)[0],o=(0,R.Z)().translateString,s=(0,C.u)((function(e){return e.currentOrg})),i=(0,r.useState)([]),u=c()(i,2),f=u[0],g=u[1],v=(0,r.useState)([]),m=c()(v,2),h=m[0],b=m[1],y=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),j=y.currentRobot,Z=y.setCurrentRobot;(0,r.useEffect)((function(){var e,t,r,s,a,i,l,u;n.setFieldValue("enabled",null==j||null===(e=j.llm)||void 0===e?void 0:e.enabled),n.setFieldValue("topK",null==j||null===(t=j.llm)||void 0===t?void 0:t.topK),n.setFieldValue("scoreThreshold",null==j||null===(r=j.llm)||void 0===r?void 0:r.scoreThreshold),n.setFieldValue("provider",null==j||null===(s=j.llm)||void 0===s?void 0:s.provider),n.setFieldValue("model",null==j||null===(a=j.llm)||void 0===a?void 0:a.model),n.setFieldValue("temperature",null==j||null===(i=j.llm)||void 0===i?void 0:i.temperature),n.setFieldValue("prompt",o(null==j||null===(l=j.llm)||void 0===l?void 0:l.prompt)),n.setFieldValue("contextMsgCount",null==j||null===(u=j.llm)||void 0===u?void 0:u.contextMsgCount)}),[j]);var T=function(){var e=l()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,orgUid:null==s?void 0:s.uid,level:M.whQ},e.next=4,G(t);case 4:n=e.sent,console.log("queryLlmProvidersByOrg result:",n),200===n.code?g(n.data.content||[]):S.yw.error(n.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){T();O({uid:"",name:"zhipu"})}),[]);var U=function(){var t=l()(a()().mark((function t(n){var o,r,s,i,l,u,c,d;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSubmit",n),S.yw.loading(e.formatMessage({id:"updating"})),c=P()(P()({},j),{},{serviceSettings:P()(P()({},j.serviceSettings),{},{welcomeFaqUids:null==j||null===(o=j.serviceSettings)||void 0===o||null===(o=o.welcomeFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),faqUids:null===(r=j.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==j||null===(s=j.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==j||null===(i=j.serviceSettings)||void 0===i||null===(i=i.guessFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),hotFaqUids:null==j||null===(l=j.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==j||null===(u=j.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),llm:P()(P()({},j.llm),{},{enabled:n.enabled,topK:n.topK,scoreThreshold:n.scoreThreshold,provider:n.provider,model:n.model,temperature:n.temperature,prompt:n.prompt,contextMsgCount:n.contextMsgCount})}),console.log("robotObject:",c),t.next=6,(0,F.$l)(c);case 6:d=t.sent,console.log("updateRobot response:",d),200===d.code?(S.yw.destroy(),S.yw.success(e.formatMessage({id:"update.success"})),Z(d.data)):(S.yw.destroy(),S.yw.error(d.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),A=function(){var e=l()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("pingOllama"),e.next=3,Y();case 3:t=e.sent,console.log("getOllamaServerStatus: ",t),200===t.code&&t.data?V():S.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=l()(a()().mark((function e(){var t,o,r,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,te();case 3:t=e.sent,console.log("getOllamaLocalModels: ",t),200===t.code?(o=t.data.map((function(e){return{value:e.name,label:e.name}})),b(o),0===o.length?n.setFieldValue("model",void 0):(s=null==j||null===(r=j.llm)||void 0===r?void 0:r.model)&&o.some((function(e){return e.value===s}))?n.setFieldValue("model",s):n.setFieldValue("model",o[0].value)):S.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var t=l()(a()().mark((function t(o){var r,i,l,u,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S.yw.loading(e.formatMessage({id:"loading"})),t.prev=1,r={pageNumber:0,pageSize:50,providerName:null==o?void 0:o.name,orgUid:null==s?void 0:s.uid,level:M.whQ},t.next=5,D(r);case 5:i=t.sent,console.log("queryLlmModelsByOrg response:",i,r),200===i.code?(l=i.data.content.map((function(e){return{value:e.name,label:e.nickname}})),b(l),0===l.length?n.setFieldValue("model",void 0):(c=null==j||null===(u=j.llm)||void 0===u?void 0:u.model)&&l.some((function(e){return e.value===c}))?n.setFieldValue("model",c):n.setFieldValue("model",l[0].value)):S.yw.error(i.message),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Failed to fetch models:",t.t0),S.yw.error(e.formatMessage({id:"error"}));case 14:return t.prev=14,S.yw.destroy(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,10,14,17]])})));return function(e){return t.apply(this,arguments)}}(),E=function(){var e=l()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=f.find((function(e){return e.name===t})),console.log("selectedProvider:",n),null!=n&&n.name&&("ollama"===n.name?A():O(n));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(w.A,{form:n,size:"large",submitter:{render:function(e,t){return[(0,q.jsx)(p.ZP,{type:"default",onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields()},children:"重置"},"reset"),(0,q.jsx)(p.ZP,{type:"primary",onClick:function(){var t;null===(t=e.form)||void 0===t||t.submit()},children:"保存"},"submit")]},submitButtonProps:{size:"large",htmlType:"button"}},onFinish:U,children:[(0,q.jsx)(H.Z,{width:"lg",name:"enabled",label:"启用大模型",tooltip:"启用大模型后，将会关闭关键词。用户在发送消息时，将会直接请求大模型。"}),(0,q.jsx)(I.Z,{width:"lg",name:"prompt",label:"提示词",placeholder:"请输入提示词",rules:[{required:!0,message:"请输入提示词"}]}),(0,q.jsx)(k.Z,{width:"lg",name:"provider",label:"AI 供应商",options:f.map((function(e){return{value:e.name,label:o(e.nickname)}})),onChange:E,rules:[{required:!0,message:"请选择 AI 供应商"}]}),(0,q.jsx)(k.Z,{width:"lg",name:"model",label:"大模型",options:h,rules:[{required:!0,message:"请选择大模型"}]}),(0,q.jsx)(J.Z,{width:"lg",label:"温度",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"请输入温度"}]}),(0,q.jsx)(J.Z,{width:"lg",label:"上下文消息数",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"请输入上下文消息数"}]})]})})},re=(n(40058),n(75808)),se=n(40836),ae=n(98473),ie=n(23635),le=function(){var e=(0,x.useIntl)(),t=(0,r.useMemo)((function(){return[{key:"kb",label:(0,q.jsx)(x.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,q.jsx)(_,{})},{key:"faq",label:(0,q.jsx)(x.FormattedMessage,{id:"menu.kbase.faq",defaultMessage:"FAQ"}),children:(0,q.jsx)(B.Z,{type:M._X4})},{key:"quickFaqs",label:(0,q.jsx)(x.FormattedMessage,{id:"menu.kbase.quickbutton",defaultMessage:"Quick Button"}),children:(0,q.jsx)(Q.Z,{type:M._X4})},{key:"llm",label:(0,q.jsx)(x.FormattedMessage,{id:"llm",defaultMessage:"LLM"}),children:(0,q.jsx)(oe,{})},{key:"rate",label:(0,q.jsx)(x.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,q.jsx)(ie.Z,{type:M._X4})},{key:"right",label:(0,q.jsx)(x.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,q.jsx)(se.Z,{type:M._X4})},{key:"popup",label:(0,q.jsx)(x.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,q.jsx)(re.Z,{type:M._X4})},{key:"trigger",label:(0,q.jsx)(x.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"}),children:(0,q.jsx)(ae.Z,{type:M._X4})},{key:"inputassociation",label:(0,q.jsx)(x.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,q.jsx)(X.Z,{type:M._X4})}]}),[e]);return(0,q.jsx)(U.Z,{tabPosition:"left",items:t})},ue=n(14238),ce=n(87491),de=n(88996),fe=n(80601),ge=n(88201),pe=n(5602),ve=n(62673),me=n(59485),he=n(38775),be=n(80556),xe=n(40074),ye=n(58791),Ce=n(61353),Me=n(16852),we=n(40439),je=n(59145),ke=n(58087),qe=n(70185),Ze=function(){var e=(0,x.useIntl)(),t=(0,r.useContext)(qe.I).isDarkMode,n=(0,d.V)((function(e){return e.currentRobot})),o=(0,C.u)((function(e){return e.currentOrg})),s=(0,r.useState)(!1),i=c()(s,2),u=i[0],f=i[1],g=(0,r.useState)({totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0}),v=c()(g,2),m=v[0],h=v[1],b=function(){var t=l()(a()().mark((function t(){var r,s,i,l,u,c,d,g,p,v,m,b,x;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("requestQueue"),f(!0),S.yw.info(e.formatMessage({id:"refresh",defaultMessage:"正在刷新队列数据..."})),t.prev=3,r={pageNumber:0,pageSize:100,agentUid:null==n?void 0:n.uid,orgUid:null==o?void 0:o.uid},t.next=7,(0,ce.Wq)(r);case 7:s=t.sent,console.log("queryQueuesByOrg response:",s.data),200==(null==s?void 0:s.code)?(S.yw.destroy(),null!=s&&null!==(i=s.data)&&void 0!==i&&i.content&&s.data.content.length>0?(x=s.data.content.reduce((function(e,t){return e.totalCount+=t.totalCount||0,e.queuingCount+=t.queuingCount||0,e.chattingCount+=t.chattingCount||0,e.offlineCount+=t.offlineCount||0,e.closedCount+=t.closedCount||0,e.leaveMsgCount+=t.leaveMsgCount||0,e.robotToAgentCount+=t.robotToAgentCount||0,e.avgWaitTime=t.avgWaitTime,e.avgResolveTime=t.avgResolveTime,e}),{totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0}),h({totalCount:null!==(l=x.totalCount)&&void 0!==l?l:0,queuingCount:null!==(u=x.queuingCount)&&void 0!==u?u:0,chattingCount:null!==(c=x.chattingCount)&&void 0!==c?c:0,offlineCount:null!==(d=x.offlineCount)&&void 0!==d?d:0,closedCount:null!==(g=x.closedCount)&&void 0!==g?g:0,leaveMsgCount:null!==(p=x.leaveMsgCount)&&void 0!==p?p:0,robotToAgentCount:null!==(v=x.robotToAgentCount)&&void 0!==v?v:0,avgWaitTime:null!==(m=x.avgWaitTime)&&void 0!==m?m:0,avgResolveTime:null!==(b=x.avgResolveTime)&&void 0!==b?b:0})):h({totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0})):S.yw.error(null==s?void 0:s.message);case 10:return t.prev=10,f(!1),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[3,,10,13]])})));return function(){return t.apply(this,arguments)}}();(0,r.useEffect)((function(){b()}),[n]);var y={boxShadow:t?"0 4px 8px rgba(255,255,255,0.05)":"0 4px 8px rgba(0,0,0,0.1)",borderRadius:"8px",height:"100%",transition:"transform 0.3s",cursor:"pointer"},M={totalCount:{bg:t?"#0a2642":"#e6f7ff",valueColor:"#1890ff"},queuingCount:{bg:t?"#3b2500":"#fff7e6",valueColor:"#fa8c16"},chattingCount:{bg:t?"#162312":"#f6ffed",valueColor:"#52c41a"},offlineCount:{bg:t?"#1f1f1f":"#fcfcfc",valueColor:t?"#d9d9d9":"#8c8c8c"},closedCount:{bg:t?"#2a0e0d":"#fff1f0",valueColor:"#ff4d4f"},leaveMsgCount:{bg:t?"#230e2c":"#f9f0ff",valueColor:"#722ed1"},robotToAgentCount:{bg:t?"#102039":"#e6fffb",valueColor:"#13c2c2"},avgWaitTime:{bg:t?"#273010":"#fcffe6",valueColor:"#a0d911"},avgResolveTime:{bg:t?"#172b4d":"#f0f5ff",valueColor:"#2f54eb"}};return(0,q.jsxs)("div",{style:{padding:"4px"},children:[(0,q.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,q.jsx)(de.Z,{title:e.formatMessage({id:"refresh",defaultMessage:"刷新数据"}),children:(0,q.jsx)(p.ZP,{type:"primary",icon:(0,q.jsx)(be.Z,{}),loading:u,onClick:b,size:"small",children:e.formatMessage({id:"refresh",defaultMessage:"刷新"})})})}),(0,q.jsxs)(fe.Z,{spinning:u,children:[(0,q.jsxs)(ge.Z,{gutter:[16,16],children:[(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.totalCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.totalCount",defaultMessage:"总会话"}),value:m.totalCount,prefix:(0,q.jsx)(xe.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.queuingCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.queuingCount",defaultMessage:"排队中"}),value:m.queuingCount,prefix:(0,q.jsx)(ye.Z,{}),valueStyle:{color:"#fa8c16"}})})}),(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.chattingCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.chattingCount",defaultMessage:"会话中"}),value:m.chattingCount,prefix:(0,q.jsx)(Ce.Z,{}),valueStyle:{color:"#52c41a"}})})}),(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.offlineCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.offlineCount",defaultMessage:"离线留言"}),value:m.offlineCount,prefix:(0,q.jsx)(Me.Z,{}),valueStyle:{color:"#8c8c8c"}})})}),(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.closedCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.closedCount",defaultMessage:"已关闭"}),value:m.closedCount,prefix:(0,q.jsx)(we.Z,{}),valueStyle:{color:"#ff4d4f"}})})}),(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.leaveMsgCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.leaveMsgCount",defaultMessage:"留言数"}),value:m.leaveMsgCount,prefix:(0,q.jsx)(je.Z,{}),valueStyle:{color:M.leaveMsgCount.valueColor}})})})]}),(0,q.jsx)(he.Z,{style:{margin:"16px 0",fontSize:"14px"},children:e.formatMessage({id:"queue.additionalStats",defaultMessage:"更多统计"})}),(0,q.jsx)(ge.Z,{gutter:[16,16],children:(0,q.jsx)(pe.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,q.jsx)(ve.Z,{style:P()(P()({},y),{},{backgroundColor:M.robotToAgentCount.bg}),hoverable:!0,children:(0,q.jsx)(me.Z,{title:e.formatMessage({id:"queue.robotToAgentCount",defaultMessage:"转人工数"}),value:m.robotToAgentCount,prefix:(0,q.jsx)(ke.Z,{}),valueStyle:{color:M.robotToAgentCount.valueColor}})})})})]})]})},Fe=function(){var e=(0,x.useIntl)(),t=(0,r.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,q.jsx)(L,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,q.jsx)(ue.Z,{type:M._X4})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,q.jsx)(le,{})},{key:"monitor",label:e.formatMessage({id:"queue.dashboard.title",defaultMessage:"Monitor"}),children:(0,q.jsx)(Ze,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,q.jsx)(A.Z,{type:M._X4})}]}),[e]);return(0,q.jsx)(U.Z,{defaultActiveKey:"basic",items:t})},Se=n(96865),Re=o.Z.Sider,Te=o.Z.Content,Ue=function(){var e=(0,Se.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,r=e.contentStyle;return(0,q.jsxs)(o.Z,{children:[(0,q.jsx)(Re,{width:n,style:t,children:(0,q.jsx)(T,{})}),(0,q.jsx)(o.Z,{children:(0,q.jsx)(Te,{style:r,children:(0,q.jsx)(Fe,{})})})]})}}}]);