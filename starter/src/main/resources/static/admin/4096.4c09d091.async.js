"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4096],{22014:function(e,t,a){a.d(t,{Z:function(){return l}});var s=a(83910),n=a(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=a(5901),i=function(e,t){return n.createElement(o.Z,(0,s.Z)({},e,{ref:t,icon:r}))};var l=n.forwardRef(i)},82465:function(e,t,a){var s=a(94433),n=a(38956),r=a(44194),o=a(46659),i=a(31549),l=["fieldProps","min","proFieldProps","max"],d=function(e,t){var a=e.fieldProps,r=e.min,d=e.proFieldProps,u=e.max,c=(0,n.Z)(e,l);return(0,i.jsx)(o.Z,(0,s.Z)({valueType:"digit",fieldProps:(0,s.Z)({min:r,max:u},a),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:d},c))},u=r.forwardRef(d);t.Z=u},59853:function(e,t,a){var s=a(94433),n=a(38956),r=a(44194),o=a(46659),i=a(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=r.forwardRef((function(e,t){var a=e.fieldProps,r=e.unCheckedChildren,d=e.checkedChildren,u=e.proFieldProps,c=(0,n.Z)(e,l);return(0,i.jsx)(o.Z,(0,s.Z)({valueType:"switch",fieldProps:(0,s.Z)({unCheckedChildren:r,checkedChildren:d},a),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=d},26608:function(e,t,a){var s=a(94433),n=a(38956),r=a(44194),o=a(46659),i=a(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var a=e.fieldProps,r=e.proFieldProps,d=(0,n.Z)(e,l);return(0,i.jsx)(o.Z,(0,s.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:r},d))};t.Z=r.forwardRef(d)},34519:function(e,t,a){var s=a(90819),n=a.n(s),r=a(73193),o=a.n(r),i=a(89933),l=a.n(i),d=a(45332),u=a.n(d),c=a(44194),f=a(70878),g=a(66248),p=a(13243),m=a(15065),h=a(62395),v=a(61489),M=a(90170),b=a(31549);t.Z=function(e){var t=e.open,a=e.onOpenChange,s=e.orgUid,r=e.record,i=e.onSuccess,d=(0,h.useIntl)(),x=f.Z.useForm(),Z=u()(x,1)[0];(0,c.useEffect)((function(){var e,a;t&&(r?Z.setFieldsValue({name:r.name||"",description:r.description||"",enabled:null===(e=r.enabled)||void 0===e||e,isDefault:null!==(a=r.isDefault)&&void 0!==a&&a}):(Z.resetFields(),Z.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,r,Z]);var j=function(){var e=l()(n()().mark((function e(){var t,l,u;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.validateFields();case 3:if(t=e.sent,l=o()(o()({},t),{},{orgUid:s,uid:null==r?void 0:r.uid}),null==r||!r.uid){e.next=11;break}return e.next=8,(0,M.sK)(l);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,M.ZJ)(l);case 13:e.t0=e.sent;case 14:(u=e.t0)&&200===u.code?(v.yw.success(d.formatMessage({id:null!=r&&r.uid?"common.updated":"common.created",defaultMessage:null!=r&&r.uid?"更新成功":"创建成功"})),null==i||i(),a(!1)):v.yw.error((null==u?void 0:u.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(g.Z,{title:(0,b.jsx)(h.FormattedMessage,{id:null!=r&&r.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=r&&r.uid?"编辑模板":"新建模板"}),open:t,onOk:j,onCancel:function(){return a(!1)},okText:(0,b.jsx)(h.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,b.jsx)(h.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,b.jsxs)(f.Z,{form:Z,layout:"vertical",preserve:!1,children:[(0,b.jsx)(f.Z.Item,{name:"name",label:(0,b.jsx)(h.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:d.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,b.jsx)(p.Z,{placeholder:d.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,b.jsx)(f.Z.Item,{name:"description",label:(0,b.jsx)(h.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(p.Z.TextArea,{rows:3,placeholder:d.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,b.jsx)(f.Z.Item,{name:"enabled",label:(0,b.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,b.jsx)(m.Z,{})})]})})}},47239:function(e,t,a){var s=a(90819),n=a.n(s),r=a(89933),o=a.n(r),i=a(45332),l=a.n(i),d=a(77686),u=a(68992),c=a(89007),f=a(47268),g=a(50447),p=a(62395),m=a(66248),h=a(70878),v=a(27401),M=a(72264),b=a(44194),x=a(90170),Z=a(34519),j=a(6992),k=a(65041),F=a(22014),P=a(31549);t.Z=function(e){var t=e.open,a=e.onClose,s=e.onSubmit,r=(0,p.useIntl)(),i=c.A.useForm(),w=l()(i,1)[0],C=(0,d.u)((function(e){return e.currentOrg})),y=(0,b.useState)(!1),S=l()(y,2),U=S[0],R=S[1],T=(0,b.useState)(!1),V=l()(T,2),O=V[0],q=V[1],E=(0,b.useState)(0),N=l()(E,2),A=N[0],I=N[1],z=(0,b.useState)([]),D=l()(z,2),W=D[0],B=D[1],G=(0,b.useState)(""),H=l()(G,2),L=H[0],Q=H[1],_=(0,b.useCallback)(function(){var e=o()(n()().mark((function e(t){var a,s,r,o;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(!0),e.prev=1,s={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==C?void 0:C.uid,searchText:t||""},e.next=5,(0,x.VW)(s);case 5:return r=e.sent,console.log("queryRobotSettingsByOrg response:",r,s),o=(null==r||null===(a=r.data)||void 0===a?void 0:a.content)||[],B(o),!w.getFieldValue("settingsUid")&&o.length>0&&w.setFieldsValue({settingsUid:o[0].uid}),e.abrupt("return",o.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,q(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==C?void 0:C.uid,w]),J=function(){console.log("handleSaveRobot"),w.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==C?void 0:C.uid,avatar:e.avatar||L};console.log("robotObject:",t),s(t),w.resetFields(),Q("")})).catch((function(e){console.log("Form errors:",e)}))};(0,b.useEffect)((function(){console.log("RobotForm useEffect"),t&&(w.resetFields(),w.setFieldsValue({type:u.f4h}),Q(""))}),[t,w]);var K=function(){var e=o()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),Q(t),w.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,P.jsx)("div",{children:(0,P.jsxs)(m.Z,{title:r.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:r.formatMessage({id:"save",defaultMessage:"Save"}),onOk:J,onCancel:function(){w.resetFields(),a()},children:[(0,P.jsxs)(c.A,{form:w,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,P.jsx)(h.Z.Item,{name:"avatarUpload",label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,P.jsxs)(k.G,{onSuccess:K,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,P.jsx)(v.Z,{src:L}),(0,P.jsx)(M.ZP,{icon:(0,P.jsx)(F.Z,{}),style:{marginLeft:12},children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,P.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,P.jsx)(g.Z,{label:r.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:r.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],placeholder:r.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:A},request:function(){var e=o()(n()().mark((function e(t){var a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.abrupt("return",_(a));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:O,notFoundContent:0===W.length?(0,P.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,P.jsx)("div",{style:{marginBottom:8,color:"#999"},children:r.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,P.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,P.jsx)(j.Z,{}),onClick:function(){return R(!0)},children:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,P.jsx)(M.ZP,{size:"small",icon:(0,P.jsx)(j.Z,{}),onClick:function(){return R(!0)},title:r.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:r.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,P.jsx)(f.Z,{label:r.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:r.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return J()}}}),(0,P.jsx)(g.Z,{label:r.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:r.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:r.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb,disabled:!0},{label:r.formatMessage({id:u.wG_,defaultMessage:"Marketing"}),value:u.wG_,disabled:!0}],rules:[{required:!0,message:r.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:r.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,P.jsx)(Z.Z,{open:U,onOpenChange:R,orgUid:(null==C?void 0:C.uid)||"",record:null,onSuccess:function(){R(!1),I((function(e){return e+1}))}})]})})}}}]);