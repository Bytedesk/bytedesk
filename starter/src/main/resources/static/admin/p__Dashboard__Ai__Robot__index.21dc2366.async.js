"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{74840:function(e,t,a){a.d(t,{Z:function(){return l}});var s=a(83910),r=a(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},i=a(54183),o=function(e,t){return r.createElement(i.Z,(0,s.Z)({},e,{ref:t,icon:n}))};var l=r.forwardRef(o)},27901:function(e,t,a){var s=a(90819),r=a.n(s),n=a(89933),i=a.n(n),o=a(45332),l=a.n(o),d=a(66441),u=a(43388),c=a(84553),g=a(13845),f=a(88722),m=a(74171),p=a(94976),v=a(78112),M=a(99036),h=a(59005),x=a(4628),b=a(44194),y=a(66406),w=a(67242),j=a(31549);t.Z=function(e){var t,a,s,n,o=M.A.useForm(),S=l()(o,1)[0],k=(0,x.useIntl)(),Z=(0,f.Z)().translateString,C=(0,m.u)((function(e){return e.currentOrg})),T=(0,b.useState)(),P=l()(T,2),U=P[0],F=P[1],R=(0,b.useState)(),E=l()(R,2),O=E[0],A=E[1],I=(0,b.useState)(),z=l()(I,2),N=z[0],q=z[1],H=(0,b.useState)(""),_=l()(H,2),B=_[0],L=_[1],K=(0,b.useRef)(!1),D=(0,b.useRef)(),W=(0,b.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),J=(0,b.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==W?void 0:W.draft)&&void 0!==t?t:null==W?void 0:W.live)&&void 0!==e?e:void 0}),[W]),V=(0,b.useCallback)((function(t){var a;null===(a=e.onServiceSettingsChange)||void 0===a||a.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,b.useCallback)((function(e){S.setFieldValue("welcomeTip",e),V({welcomeTip:e})}),[S,V]);(0,b.useEffect)((function(){if(null!=C&&C.uid&&(D.current!==C.uid&&(D.current=C.uid,K.current=!1),!K.current)){K.current=!0;var e=function(){var e=i()(r()().mark((function e(){var t,a,s,n,i,o,l;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:p.QPQ,orgUid:C.uid},e.next=4,(0,g.AP)(t);case 4:a=e.sent,w.Z.debug("TabServiceWelcome queryKbasesByOrg:",a,t),u.yw.destroy(),200===a.code?(A(a),i=(null==a||null===(s=a.data)||void 0===s?void 0:s.content)||[],o=null==J?void 0:J.welcomeKbUid,(l=o||N||(null===(n=i[0])||void 0===n?void 0:n.uid))&&(q(l),S.setFieldValue("welcomeKbUid",l),o!==l&&V({welcomeKbUid:l}))):u.yw.error(a.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==C?void 0:C.uid,k,null==J?void 0:J.welcomeKbUid,N,S,V]),(0,b.useEffect)((function(){if(null!=C&&C.uid&&N){var e=function(){var e=i()(r()().mark((function e(){var t,a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:C.uid,kbUid:N},e.next=4,(0,c.pf)(t);case 4:a=e.sent,w.Z.debug("TabServiceWelcome queryFaqsByOrg:",a,t),u.yw.destroy(),200===a.code?F(a):u.yw.error(a.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==C?void 0:C.uid,N,k]),(0,b.useEffect)((function(){if(J){var e=null==J?void 0:J.welcomeFaqs,t=Array.isArray(J.welcomeFaqUids)?J.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];S.setFieldValue("welcomeFaqUids",t)}}),[S,null==U||null===(t=U.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==J?void 0:J.welcomeFaqUids,J]);var G=(0,b.useCallback)((function(e){q(e),S.setFieldValue("welcomeFaqUids",[]),V({welcomeKbUid:e,welcomeFaqUids:[]})}),[V,S]);return(0,b.useEffect)((function(){var e=Z(null==J?void 0:J.welcomeTip);void 0!==e&&B!==e&&L(e),null!=J&&J.welcomeKbUid&&(S.setFieldValue("welcomeKbUid",J.welcomeKbUid),N!==J.welcomeKbUid&&q(J.welcomeKbUid))}),[Z,null==J?void 0:J.welcomeTip,null==J?void 0:J.welcomeKbUid,B,S,N,null==O||null===(a=O.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length]),(0,j.jsxs)(M.A,{form:S,submitter:!1,style:{marginLeft:"20px"},children:[(0,j.jsx)(M.A.Item,{name:"welcomeTip",label:(0,j.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,j.jsx)(d.Z,{type:"service",keys:["welcomeTip"],live:null==W?void 0:W.live,draft:null==W?void 0:W.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,j.jsx)(y.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:B,toolbarKeys:(0,v.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,j.jsx)(h.Z,{name:"welcomeKbUid",width:"md",label:(0,j.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"é€‰æ‹©çŒœä½ æƒ³é—®çŸ¥è¯†åº“"}),(0,j.jsx)(d.Z,{type:"service",keys:["welcomeKbUid"],live:null==W?void 0:W.live,draft:null==W?void 0:W.draft})]}),options:null==O||null===(s=O.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:Z(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,j.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,j.jsx)(h.Z,{name:"welcomeFaqUids",width:"md",label:(0,j.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,j.jsx)(d.Z,{type:"service",keys:["welcomeFaqUids"],live:null==W?void 0:W.live,draft:null==W?void 0:W.draft})]}),options:null==U||null===(n=U.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:Z(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,j.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return V({welcomeFaqUids:e})}}})]})}},43922:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ie}});var s=a(44194),r=a(21600),n=a(4628),i=a(76711),o=a.n(i),l=a(90819),d=a.n(l),u=a(89933),c=a.n(u),g=a(73193),f=a.n(g),m=a(45332),p=a.n(m),v=a(81581),M=a(69533),h=a(30310),x=a(1282),b=a(83281),y=a(96955),w=a(90581),j=a(12461),S=a(43275),k=a(27729),Z=a(82878),C=a(74840),T=a(29337),P=a(68779),U=a(90727),F=a(12322),R=a(34600),E=a(56482),O=a(94322),A=a(10162),I=a(59304),z=a(54881),N=a(47944),q=a(4317),H=a(80556),_=a(55785),B=a(97135),L=a(43388),K=a(47926),D=a(74171),W=a(21850),J=a(25553),V=a(39325),Y=a(85977),G=a(95093),Q=a(1596),$=(a(94147),a(77500)),X=a(12608),ee=a(27501),te=a(83610),ae=a(27901),se=(a(66441),a(31549)),re=a(97799),ne=a(42e3),ie=(a(92029),a(67242)),oe=a(58620),le="welcome",de=function(){var e,t,a,i,l,u,g,m,de=(0,n.useIntl)(),ue=(0,n.useAccess)(),ce=(0,D.u)((function(e){return e.currentOrg})),ge=(0,W.Z)().leftSiderStyle,fe=(0,J.Z)().isDarkMode,me=(0,s.useState)(!1),pe=p()(me,2),ve=pe[0],Me=pe[1],he=(0,s.useState)([]),xe=p()(he,2),be=xe[0],ye=xe[1],we=(0,s.useState)(),je=p()(we,2),Se=je[0],ke=je[1],Ze=(0,s.useState)(""),Ce=p()(Ze,2),Te=Ce[0],Pe=Ce[1],Ue=(0,s.useState)(le),Fe=p()(Ue,2),Re=Fe[0],Ee=Fe[1],Oe=(0,s.useState)(!1),Ae=p()(Oe,2),Ie=Ae[0],ze=Ae[1],Ne=(0,s.useState)(null),qe=p()(Ne,2),He=qe[0],_e=qe[1],Be=(0,s.useState)(!1),Le=p()(Be,2),Ke=Le[0],De=Le[1],We=(0,s.useMemo)((function(){return be.find((function(e){return e.uid===Se}))||null}),[be,Se]),Je=(0,s.useState)(!1),Ve=p()(Je,2),Ye=Ve[0],Ge=Ve[1],Qe=(0,s.useState)(!1),$e=p()(Qe,2),Xe=$e[0],et=$e[1],tt=(0,s.useState)(!1),at=p()(tt,2),st=at[0],rt=at[1],nt=(0,s.useRef)(""),it=(0,V.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),ot=it.setCurrentRobotSettings,lt=it.currentRobotSettings,dt=(0,s.useMemo)((function(){var e;return null!==(e=null!=lt?lt:We)&&void 0!==e?e:null}),[lt,We]),ut=(0,s.useMemo)((function(){var e;return null==ue||null===(e=ue.getModulePermission)||void 0===e?void 0:e.call(ue,Y.MY.ROBOT_SETTINGS)}),[ue]),ct=null!==(e=null==ut||null===(t=ut.canRead)||void 0===t?void 0:t.call(ut))&&void 0!==e&&e,gt=null!==(a=null==ut||null===(i=ut.canCreate)||void 0===i?void 0:i.call(ut))&&void 0!==a&&a,ft=null!==(l=null==ut||null===(u=ut.canUpdate)||void 0===u?void 0:u.call(ut))&&void 0!==l&&l,mt=null!==(g=null==ut||null===(m=ut.canDelete)||void 0===m?void 0:m.call(ut))&&void 0!==g&&g,pt=(0,s.useRef)(!1),vt=function(e,t){L.yw.warning(de.formatMessage({id:e,defaultMessage:t}))},Mt=(0,s.useCallback)((function(e){if(lt){var t=lt.draftServiceSettings||lt.serviceSettings||{};ot(f()(f()({},lt),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[lt,ot]),ht=(0,s.useCallback)((function(e){if(lt){var t=lt.draftTriggerSettings||lt.triggerSettings||{};ot(f()(f()({},lt),{},{draftTriggerSettings:f()(f()({},t),e)}))}}),[lt,ot]),xt=((0,s.useCallback)((function(e){if(lt){var t=lt.draftSummarySettings||lt.summarySettings||{};ot(f()(f()({},lt),{},{draftSummarySettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){if(lt){var t=lt.draftInviteSettings||lt.inviteSettings||{};ot(f()(f()({},lt),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[lt,ot])),bt=((0,s.useCallback)((function(e){if(lt){var t=lt.draftIntentionSettings||lt.intentionSettings||{};ot(f()(f()({},lt),{},{draftIntentionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){if(lt){var t=lt.draftEmotionSettings||lt.emotionSettings||{};ot(f()(f()({},lt),{},{draftEmotionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){var t;if(lt){var a=lt.draftToolsSettings||lt.toolsSettings||{};ot(f()(f()({},lt),{},{draftToolsSettings:f()(f()(f()({},a),e),{},{toolConfigs:null!==(t=e.toolConfigs)&&void 0!==t?t:a.toolConfigs})}))}}),[lt,ot]),(0,s.useMemo)((function(){if(!Te)return be;var e=Te.toLowerCase();return be.filter((function(t){var a=(t.name||t.uid||"").toLowerCase(),s=(t.description||"").toLowerCase();return a.includes(e)||s.includes(e)}))}),[be,Te])),yt=(0,s.useCallback)(function(){var e=c()(d()().mark((function e(t,a){var s,r,n,i,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=ce&&ce.uid){e.next=2;break}return e.abrupt("return");case 2:if(ct){e.next=9;break}return pt.current||(pt.current=!0,vt("robot_settings.permission.read.denied","æ— æƒé™ï¼šæŸ¥çœ‹æœºå™¨äººé…ç½®")),ye([]),ke(void 0),ot(null),rt(!1),e.abrupt("return");case 9:return Me(!0),e.prev=10,r=(null!=t?t:"").trim(),n={orgUid:ce.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=15,(0,K.VW)(n);case 15:i=e.sent,ie.Z.debug("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",i,n),o=(null==i||null===(s=i.data)||void 0===s?void 0:s.content)||[],ye(o),!(o.length>0)||Se&&o.some((function(e){return e.uid===Se}))||(ke(o[0].uid),null!=a&&a.keepActive||Ee(le));case 20:return e.prev=20,Me(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[10,,20,23]])})));return function(t,a){return e.apply(this,arguments)}}(),[null==ce?void 0:ce.uid,Se,ct,ot]),wt=(0,s.useCallback)((function(e){yt(null!=e?e:Te)}),[yt,Te]);(0,s.useEffect)((function(){yt(Te)}),[null==ce?void 0:ce.uid]),(0,s.useEffect)((function(){We?(ot(We),nt.current=JSON.stringify(null!=We?We:{}),rt(!1)):(ot(null),nt.current=JSON.stringify({}),rt(!1))}),[We]),(0,s.useEffect)((function(){if(We)try{var e,t,a=JSON.stringify(null!=lt?lt:{}),s=a!==nt.current;ie.Z.debug("ğŸ” [Dirty Check]",{isDirty:s,selectedUid:null==We?void 0:We.uid,currentWelcomeTip:(null==lt||null===(e=lt.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==lt||null===(t=lt.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:nt.current.length,nowLength:a.length}),rt(s)}catch(e){rt(!0)}}),[lt,null==We?void 0:We.uid]);var jt=function(){var e=c()(d()().mark((function e(t){var a,s,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mt){e.next=3;break}return vt("robot_settings.permission.delete.denied","æ— æƒé™ï¼šåˆ é™¤æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=(a=null!=t?t:We)&&a.uid){e.next=6;break}return e.abrupt("return");case 6:return s={uid:a.uid,orgUid:null==ce?void 0:ce.uid,pageNumber:0,pageSize:100},e.next=9,(0,K.r$)(s);case 9:(r=e.sent)&&200===r.code?(L.yw.success(de.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),yt(Te)):L.yw.error((null==r?void 0:r.message)||de.formatMessage({id:"delete.error",defaultMessage:"åˆ é™¤å¤±è´¥"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),St=function(){var e=c()(d()().mark((function e(t,a){var s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:return e.prev=3,e.next=6,(0,K.sK)({uid:t,orgUid:null==ce?void 0:ce.uid,enabled:a});case 6:(s=e.sent)&&200===s.code?(L.yw.success(de.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),yt(Te)):L.yw.error((null==s?void 0:s.message)||de.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"}));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,a){return e.apply(this,arguments)}}(),kt=function(e,t){if(e){var a={};return t.forEach((function(t){void 0!==e[t]&&(a[t]=e[t])})),a}},Zt=function(e){if(e){var t=kt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputAssociationKbUid","inputPreviewEnabled","inputPreviewAlwaysShow","inputPreviewShowSeconds","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","requireLogin","showLogo","validateUntil"]),a=function(a,s){if(void 0===t[a]){var r=null==e?void 0:e[s];if(Array.isArray(r)){var n=r.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);n.length>0&&(t[a]=n)}}};a("welcomeFaqUids","welcomeFaqs"),a("faqUids","faqs"),a("quickButtonUids","quickButtons"),a("guessFaqUids","guessFaqs"),a("hotFaqUids","hotFaqs"),a("shortcutFaqUids","shortcutFaqs");var s=function(e){if(e)return kt(e,["smile","upload","image","file","uploadRobot","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),s?{toolbar:s}:{})}},Ct=function(e){if(e){var t=null==e?void 0:e.triggers;return Array.isArray(t)?{uid:null==e?void 0:e.uid,triggers:t.map((function(e){return{uid:null==e?void 0:e.uid,triggerKey:null==e?void 0:e.triggerKey,enabled:null==e?void 0:e.enabled,type:null==e?void 0:e.type,name:null==e?void 0:e.name,description:null==e?void 0:e.description,config:null==e?void 0:e.config}}))}:kt(e,["uid"])}},Tt=function(e){if(e)return kt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Pt=function(e){if(e)return kt(e,["name","description","color","order","robotUid","enabled","executionTiming"])},Ut=function(e){if(e)return kt(e,["name","description","robotUid","enabled","executionTiming"])},Ft=function(e){if(e)return kt(e,["name","description","defaultTemplate","robotUid","enabled","executionTiming"])},Rt=function(e){if(e)return kt(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Et=function(e){if(e){var t=kt(e,["enabled","invocationMode","toolChoice","maxToolInvocations","defaultToolPrompt"]);return e.toolConfigs&&(t.toolConfigs=e.toolConfigs.map((function(e){return kt(e,["key","name","description","category","icon","enabled","bindingType","beanName","className","methodName","endpoint","inputSchema","outputSchema","systemPrompt","orderIndex","requiresApproval","metadata"])}))),t}},Ot=function(){var e=c()(d()().mark((function e(){var t,a,s,r,n,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=We&&We.uid){e.next=6;break}return L.yw.warning(de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:return Ge(!0),e.prev=7,t=lt&&lt.uid===We.uid?lt:We,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:We.uid,orgUid:null==ce?void 0:ce.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,isDefault:null==t?void 0:t.isDefault,enabled:null==t?void 0:t.enabled,serviceSettings:Zt(a(null==t?void 0:t.serviceSettings,null==t?void 0:t.draftServiceSettings)),triggerSettings:Ct(a(null==t?void 0:t.triggerSettings,null==t?void 0:t.draftTriggerSettings)),inviteSettings:Tt(a(null==t?void 0:t.inviteSettings,null==t?void 0:t.draftInviteSettings)),intentionSettings:Pt(a(null==t?void 0:t.intentionSettings,null==t?void 0:t.draftIntentionSettings)),emotionSettings:Ut(a(null==t?void 0:t.emotionSettings,null==t?void 0:t.draftEmotionSettings)),summarySettings:Ft(a(null==t?void 0:t.summarySettings,null==t?void 0:t.draftSummarySettings)),rateDownSettings:Rt(a(null==t?void 0:t.rateDownSettings,null==t?void 0:t.draftRateDownSettings)),toolsSettings:Et(a(null==t?void 0:t.toolsSettings,null==t?void 0:t.draftToolsSettings))},e.next=13,(0,K.sK)(s);case 13:r=e.sent,ie.Z.debug("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",r,s),r&&200===r.code?(L.yw.success(de.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),nt.current=JSON.stringify(null!==(n=null!==(i=null==r?void 0:r.data)&&void 0!==i?i:t)&&void 0!==n?n:{}),rt(!1),yt(Te)):L.yw.error((null==r?void 0:r.message)||de.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("ä¿å­˜å¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"}));case 22:return e.prev=22,Ge(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),At=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šå‘å¸ƒæœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=We&&We.uid){e.next=6;break}return L.yw.warning(de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:if(et(!0),e.prev=7,!st){e.next=11;break}return e.next=11,Ot();case 11:return t={uid:We.uid,orgUid:null==ce?void 0:ce.uid},e.next=14,(0,K.KF)(t);case 14:(a=e.sent)&&200===a.code?(L.yw.success(de.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),nt.current=JSON.stringify(null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{}),rt(!1),yt(Te,{keepActive:!0})):L.yw.error((null==a?void 0:a.message)||de.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("å‘å¸ƒå¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"}));case 22:return e.prev=22,et(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),It=(0,s.useMemo)((function(){return null!=We&&We.uid?[{key:"welcome",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(C.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"})]}),children:(0,se.jsx)(ae.Z,{serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})},{key:"tips",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(T.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"})]}),children:(0,se.jsx)(te.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})},{key:"service",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(P.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"})]}),children:(0,se.jsx)(ee.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}].concat(o()([]),o()((0,oe.OJ)()?[{key:"inputAssociation",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(U.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"robot.settings.input.association",defaultMessage:"è¾“å…¥è”æƒ³"})]}),children:(0,se.jsx)(G.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"rate",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(F.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,se.jsx)(ne.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"toolbar",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(R.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,se.jsx)(X.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},settingsUid:We.uid,isActive:"toolbar"===Re,onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"right",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(E.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,se.jsx)(Q.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt,settingsUid:We.uid,isActive:"right"===Re})}]:[]),o()((0,oe.OJ)()?[{key:"trigger",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(O.Z,{})," ",(0,se.jsx)(n.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"})]}),children:(0,se.jsx)($.Z,{variant:"robot",triggerSettings:{live:null==dt?void 0:dt.triggerSettings,draft:null==dt?void 0:dt.draftTriggerSettings},onTriggerSettingsChange:ht})}]:[]),o()([]),o()([])):[]}),[null==We?void 0:We.uid,dt,Mt,ht,xt,de,Re]);return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,se.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:ge,children:(0,se.jsxs)(B.Z,{title:de.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:gt?(0,se.jsx)(M.ZP,{size:"small",icon:(0,se.jsx)(A.Z,{}),type:"primary",onClick:function(){gt?(_e(null),ze(!0)):vt("robot_settings.permission.create.denied","æ— æƒé™ï¼šåˆ›å»ºæœºå™¨äººé…ç½®")},children:(0,se.jsx)(n.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}):null,bodyStyle:{padding:8},loading:ve,children:[(0,se.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,se.jsxs)(h.Z.Compact,{style:{width:"100%"},children:[(0,se.jsx)(x.Z,{placeholder:de.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:Te,onChange:function(e){return Pe(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;Pe(t),wt(t)},allowClear:!0,size:"middle"}),(0,se.jsx)(M.ZP,{type:"primary",icon:(0,se.jsx)(U.Z,{}),"aria-label":de.formatMessage({id:"common.search",defaultMessage:"æœç´¢"}),onClick:function(){return wt()}})]})}),(0,se.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,se.jsx)(b.Z,{dataSource:bt,locale:{emptyText:(0,se.jsx)(y.Z,{description:de.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,se.jsx)(b.Z.Item,{style:Se===e.uid?{backgroundColor:fe?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ke(e.uid)},children:(0,se.jsx)(b.Z.Item.Meta,{title:(0,se.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,se.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,se.jsx)(h.Z,{size:4,children:e.isDefault?(0,se.jsx)(w.Z,{color:"blue",children:(0,se.jsx)(n.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null})]}),description:e.description?(0,se.jsx)("div",{style:{color:fe?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,se.jsx)(v.Z.Panel,{children:We?(0,se.jsx)(B.Z,{title:(0,se.jsxs)(h.Z,{children:[(0,se.jsxs)("span",{children:[de.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",We.name||We.uid]}),(0,se.jsx)(j.Z,{checked:!!We.enabled,onChange:function(e){return St(We.uid,e)},disabled:!ft,checkedChildren:de.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:de.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),ft?(0,se.jsx)(M.ZP,{size:"small",icon:(0,se.jsx)(I.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=We,ft?(_e(null!=t?t:We),ze(!0)):vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®")},children:(0,se.jsx)(n.FormattedMessage,{id:"pages.common.edit",defaultMessage:"ç¼–è¾‘"})}):null,mt?(0,se.jsx)(S.Z,{title:de.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),jt(We)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:de.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:de.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,se.jsx)(M.ZP,{size:"small",danger:!0,icon:(0,se.jsx)(z.Z,{}),onClick:function(e){e.stopPropagation()},children:(0,se.jsx)(n.FormattedMessage,{id:"pages.common.delete",defaultMessage:"åˆ é™¤"})})}):null,We.isDefault?(0,se.jsx)(w.Z,{color:"blue",children:(0,se.jsx)(n.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null]}),extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(S.Z,{title:de.formatMessage({id:"settings.publish.online.title",defaultMessage:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ"}),description:de.formatMessage({id:"settings.publish.online.desc",defaultMessage:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ"}),okText:de.formatMessage({id:"settings.publish.online.ok",defaultMessage:"ç»§ç»­å‘å¸ƒ"}),cancelText:de.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),At()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,se.jsx)(M.ZP,{onClick:function(e){return e.stopPropagation()},loading:Xe,disabled:!ft,type:"default",icon:(0,se.jsx)(N.Z,{}),children:(0,se.jsx)(n.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,se.jsx)(M.ZP,{onClick:function(e){e.stopPropagation(),De(!0)},disabled:!ft,type:"default",icon:(0,se.jsx)(q.Z,{}),children:(0,se.jsx)(n.FormattedMessage,{id:"settings.gray.publish",defaultMessage:"ç°åº¦å‘å¸ƒ"})}),(0,se.jsx)(M.ZP,{onClick:function(){We&&(ot(We),nt.current=JSON.stringify(null!=We?We:{}),rt(!1))},disabled:!st||!ft,icon:(0,se.jsx)(H.Z,{}),children:(0,se.jsx)(n.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,se.jsx)(M.ZP,{type:"primary",loading:Ye,onClick:Ot,disabled:!st||!ft,icon:(0,se.jsx)(_.Z,{}),children:(0,se.jsx)(n.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,se.jsx)(r.Z,{activeKey:Re,onChange:Ee,items:It})}):(0,se.jsx)(B.Z,{children:(0,se.jsx)(y.Z,{description:de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,se.jsx)(re.Z,{open:Ie,onOpenChange:ze,orgUid:(null==ce?void 0:ce.uid)||"",record:He,onSuccess:function(){ze(!1),yt(Te)}}),(0,se.jsxs)(k.Z,{title:de.formatMessage({id:"settings.gray.publish.title",defaultMessage:"ç°åº¦å‘å¸ƒè¯´æ˜"}),open:Ke,onCancel:function(){return De(!1)},footer:[(0,se.jsx)(M.ZP,{onClick:function(){return De(!1)},children:(0,se.jsx)(n.FormattedMessage,{id:"common.close",defaultMessage:"å…³é—­"})},"close"),(0,se.jsx)(M.ZP,{type:"primary",onClick:function(){De(!1),n.history.push("/service/channel")},children:(0,se.jsx)(n.FormattedMessage,{id:"settings.gray.publish.go.channel",defaultMessage:"å‰å¾€æ¸ é“é¡µé¢è·å–é“¾æ¥"})},"go")],children:[(0,se.jsx)(Z.Z.Paragraph,{children:(0,se.jsx)(n.FormattedMessage,{id:"settings.gray.publish.p1",defaultMessage:"ç°åº¦å‘å¸ƒç”¨äºæµ‹è¯•å½“å‰è‰ç¨¿ï¼ˆdraftï¼‰é…ç½®ï¼Œç‚¹å‡»ä¿å­˜ï¼Œä½†æœªç‚¹å‡»å‘å¸ƒï¼Œä¸ä¼šå½±å“çº¿ä¸Šç¯å¢ƒã€‚"})}),(0,se.jsx)(Z.Z.Paragraph,{children:(0,se.jsx)(n.FormattedMessage,{id:"settings.gray.publish.p2",defaultMessage:"åœ¨æ¸ é“é¡µé¢ç”Ÿæˆé“¾æ¥æ—¶å‹¾é€‰â€œç°åº¦æµ‹è¯•â€ï¼Œé“¾æ¥ä¼šè¿½åŠ  {draft1}ï¼›åµŒå…¥å¼è„šæœ¬ä¼šåœ¨ {chatConfig} ä¸­å¢åŠ  {draftTrue}ã€‚",values:{draft1:(0,se.jsx)(Z.Z.Text,{code:!0,children:"draft=1"}),chatConfig:(0,se.jsx)(Z.Z.Text,{code:!0,children:"chatConfig"}),draftTrue:(0,se.jsx)(Z.Z.Text,{code:!0,children:"draft: true"})}})})]})]})},ue=a(43330),ce=a(84176),ge=a.n(ce),fe=a(34512),me=a(76791),pe=a(30857),ve=a(99036),Me=a(86702),he=a(59005),xe=a(50628),be=a(60241),ye=function(e){return{userPrompt:null==e?void 0:e.userPrompt,variables:null==e?void 0:e.variables,tags:null==e?void 0:e.tags,metadata:null==e?void 0:e.metadata}},we=function(e){var t=e.open,a=e.mode,r=e.initialValues,i=e.onCancel,o=e.onSubmit,l=(0,n.useIntl)(),u=(0,s.useRef)(null);(0,s.useEffect)((function(){var e,a;t?null===(e=u.current)||void 0===e||e.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||"GENERAL",enabled:"boolean"!=typeof(null==r?void 0:r.enabled)||r.enabled,language:(null==r?void 0:r.language)||"ZH_CN",systemPrompt:null==r?void 0:r.systemPrompt}):null===(a=u.current)||void 0===a||a.resetFields()}),[t,r]);var g="create"===a?l.formatMessage({id:"prompt.create",defaultMessage:"æ–°å»ºæç¤ºè¯"}):l.formatMessage({id:"prompt.edit",defaultMessage:"ç¼–è¾‘æç¤ºè¯"});return(0,se.jsx)(pe.Z,{open:t,title:g,onClose:i,width:600,destroyOnHidden:!0,extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(M.ZP,{onClick:function(){var e;null===(e=u.current)||void 0===e||e.resetFields()},children:l.formatMessage({id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,se.jsx)(M.ZP,{onClick:i,children:l.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"})}),(0,se.jsx)(M.ZP,{type:"primary",onClick:function(){var e;null===(e=u.current)||void 0===e||e.submit()},children:l.formatMessage({id:"common.confirm",defaultMessage:"ç¡®è®¤"})})]}),children:(0,se.jsxs)(ve.A,{formRef:u,layout:"vertical",onFinish:function(){var e=c()(d()().mark((function e(t){var s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="edit"===a?f()(f()({},ye(r)),t):t,e.next=3,o(s);case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submitter:!1,children:[(0,se.jsx)(Me.Z,{name:"uid",hidden:!0}),(0,se.jsx)(Me.Z,{name:"name",label:l.formatMessage({id:"name",defaultMessage:"åç§°"}),rules:[{required:!0,message:l.formatMessage({id:"name.required",defaultMessage:"è¯·è¾“å…¥åç§°"})}],fieldProps:{maxLength:128}}),(0,se.jsx)(Me.Z,{name:"nickname",label:l.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),fieldProps:{maxLength:128}}),(0,se.jsx)(he.Z,{name:"type",label:l.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),rules:[{required:!0,message:l.formatMessage({id:"type.required",defaultMessage:"è¯·é€‰æ‹©ç±»å‹"})}],options:[{value:"GENERAL",label:l.formatMessage({id:"prompt.type.general",defaultMessage:"é€šç”¨"})},{value:"THREAD_SUMMARY",label:l.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"ä¼šè¯æ€»ç»“"})},{value:"THREAD_INTENTION",label:l.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"ä¼šè¯æ„å›¾"})},{value:"THREAD_EMOTION",label:l.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"ä¼šè¯æƒ…ç»ª"})},{value:"CUSTOMER_PROFILE",label:l.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"å®¢æˆ·ç”»åƒ"})},{value:"TICKET_ASSIST",label:l.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"å·¥å•è¾…åŠ©"})},{value:"THREAD",label:l.formatMessage({id:"prompt.type.legacy.thread",defaultMessage:"ï¼ˆæ—§ï¼‰THREAD"})},{value:"CUSTOMER",label:l.formatMessage({id:"prompt.type.legacy.customer",defaultMessage:"ï¼ˆæ—§ï¼‰CUSTOMER"})},{value:"TICKET",label:l.formatMessage({id:"prompt.type.legacy.ticket",defaultMessage:"ï¼ˆæ—§ï¼‰TICKET"})}]}),(0,se.jsx)(xe.Z,{name:"enabled",label:l.formatMessage({id:"enabled",defaultMessage:"å¯ç”¨"})}),(0,se.jsx)(Me.Z,{name:"description",label:l.formatMessage({id:"description",defaultMessage:"æè¿°"}),fieldProps:{maxLength:512}}),(0,se.jsx)(he.Z,{name:"language",label:l.formatMessage({id:"language",defaultMessage:"è¯­è¨€"}),showSearch:!0,options:[{value:"ZH_CN",label:l.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"ç®€ä½“ä¸­æ–‡(ZH_CN)"})},{value:"EN",label:l.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"})},{value:"ZH_TW",label:l.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"ç¹é«”ä¸­æ–‡(ZH_TW)"})}]}),(0,se.jsx)(be.Z,{name:"systemPrompt",label:l.formatMessage({id:"prompt.system",defaultMessage:"ç³»ç»Ÿæç¤ºè¯"}),fieldProps:{rows:6}})]})})},je=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},Se=function(e){var t=e.open,a=e.record,r=e.orgUid,i=e.canUpdate,o=e.autoRunAction,l=void 0===o?null:o,u=e.onAutoRunConsumed,g=e.onClose,f=e.onReload,m=(0,n.useIntl)(),v=(0,s.useState)(a),h=p()(v,2),x=h[0],b=h[1],y=(0,s.useState)(null),w=p()(y,2),j=w[0],Z=w[1],C=(0,s.useState)(null),T=p()(C,2),P=T[0],U=T[1];(0,s.useEffect)((function(){b(a),Z((null==a?void 0:a.scoreObject)||je(null==a?void 0:a.scoreResult)),U((null==a?void 0:a.optimizeObject)||je(null==a?void 0:a.optimizationMetadata))}),[a]);var F=null==x?void 0:x.uid,R=(0,s.useMemo)((function(){return(null==x?void 0:x.language)||"ZH_CN"}),[null==x?void 0:x.language]),E=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,L.yw.loading(m.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=6,(0,me.OW)({uid:F,orgUid:r});case 6:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(m.formatMessage({id:"success",defaultMessage:"è¯„åˆ†æˆåŠŸ"})),b(null==t?void 0:t.data),Z((null==t||null===(a=t.data)||void 0===a?void 0:a.scoreObject)||je(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),null==f||f()):L.yw.error((null==t?void 0:t.message)||m.formatMessage({id:"failed",defaultMessage:"è¯„åˆ†å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),L.yw.error(m.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,L.yw.loading(m.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=6,(0,me.vF)({uid:F,orgUid:r});case 6:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(m.formatMessage({id:"success",defaultMessage:"ä¼˜åŒ–æˆåŠŸ"})),b(null==t?void 0:t.data),U((null==t||null===(a=t.data)||void 0===a?void 0:a.optimizeObject)||je(null==t||null===(s=t.data)||void 0===s?void 0:s.optimizationMetadata)),null==f||f()):L.yw.error((null==t?void 0:t.message)||m.formatMessage({id:"failed",defaultMessage:"ä¼˜åŒ–å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),L.yw.error(m.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=c()(d()().mark((function e(){var t,a,s,n,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,L.yw.loading(m.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=6,(0,me.$2)(F,{orgUid:r});case 6:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(m.formatMessage({id:"success",defaultMessage:"é‡ç½®æˆåŠŸ"})),b(null==t?void 0:t.data),Z((null==t||null===(a=t.data)||void 0===a?void 0:a.scoreObject)||je(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),U((null==t||null===(n=t.data)||void 0===n?void 0:n.optimizeObject)||je(null==t||null===(i=t.data)||void 0===i?void 0:i.optimizationMetadata)),null==f||f()):L.yw.error((null==t?void 0:t.message)||m.formatMessage({id:"failed",defaultMessage:"é‡ç½®å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),L.yw.error(m.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){t&&F&&l&&c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("score"!==l){e.next=5;break}return e.next=3,E();case 3:e.next=8;break;case 5:if("optimize"!==l){e.next=8;break}return e.next=8,O();case 8:null==u||u();case 9:case"end":return e.stop()}}),e)})))()}),[t,F,l]),(0,se.jsx)(k.Z,{title:m.formatMessage({id:"prompt.detail",defaultMessage:"æç¤ºè¯è¯¦æƒ…"}),open:t,onCancel:g,width:900,footer:x?[(0,se.jsx)(S.Z,{title:m.formatMessage({id:"prompt.reset.confirm",defaultMessage:"ç¡®è®¤é‡ç½®ä¸ºç³»ç»Ÿé»˜è®¤æç¤ºè¯ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return L.yw.warning(m.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šé‡ç½®æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,A();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{danger:!0,children:m.formatMessage({id:"prompt.reset.default",defaultMessage:"é‡ç½®é»˜è®¤"})})},"detailReset"),(0,se.jsx)(S.Z,{title:m.formatMessage({id:"prompt.score.confirm",defaultMessage:"ç¡®è®¤å¯¹è¯¥æç¤ºè¯è¿›è¡Œè¯„åˆ†ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return L.yw.warning(m.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šè¯„åˆ†æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,E();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{children:m.formatMessage({id:"prompt.score",defaultMessage:"è¯„åˆ†"})})},"detailScore"),(0,se.jsx)(S.Z,{title:m.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"ç¡®è®¤å¯¹è¯¥æç¤ºè¯è¿›è¡Œä¼˜åŒ–ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return L.yw.warning(m.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šä¼˜åŒ–æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,O();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{type:"primary",children:m.formatMessage({id:"prompt.optimize",defaultMessage:"ä¼˜åŒ–"})})},"detailOptimize"),(0,se.jsx)(M.ZP,{onClick:g,children:m.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")]:[(0,se.jsx)(M.ZP,{onClick:g,children:m.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:x?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)("div",{style:{marginBottom:12},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"name",defaultMessage:"åç§°"}),"ï¼š"]})," ",x.name||"-",(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),"ï¼š"]})," ",x.nickname||"-"]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"language",defaultMessage:"è¯­è¨€"}),"ï¼š"]})," ",R]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),"ï¼š"]})," ",x.type||"-"]})]}),(0,se.jsxs)("div",{style:{marginBottom:16},children:[(0,se.jsx)("h4",{children:m.formatMessage({id:"prompt.system",defaultMessage:"ç³»ç»Ÿæç¤ºè¯"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:x.systemPrompt||""})]}),(0,se.jsxs)("div",{style:{marginBottom:16},children:[(0,se.jsx)("h4",{children:m.formatMessage({id:"prompt.score.result",defaultMessage:"è¯„åˆ†ç»“æœ"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:j?JSON.stringify(j,null,2):"æš‚æ— ç»“æœ"})]}),(0,se.jsxs)("div",{style:{marginBottom:8},children:[(0,se.jsx)("h4",{children:m.formatMessage({id:"prompt.optimize.result",defaultMessage:"ä¼˜åŒ–ç»“æœ"})}),(0,se.jsxs)("div",{style:{marginBottom:8},children:[(0,se.jsx)("b",{children:m.formatMessage({id:"prompt.optimized.prompt",defaultMessage:"ä¼˜åŒ–åçš„æç¤ºè¯"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:180,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:x.optimizedPrompt||""})]}),(0,se.jsxs)("div",{children:[(0,se.jsx)("b",{children:m.formatMessage({id:"prompt.optimization.metadata",defaultMessage:"ä¼˜åŒ–å…ƒæ•°æ®"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:180,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:P?JSON.stringify(P,null,2):"æš‚æ— ç»“æœ"})]})]})]}):(0,se.jsx)("div",{children:m.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"})})})},ke=a(98280),Ze=a(2287),Ce=a(10390),Te=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},Pe=function(e){var t,a,r=e.open,i=e.record,o=e.orgUid,l=e.canUpdate,u=e.autoRunScore,g=void 0!==u&&u,f=e.onAutoRunConsumed,m=e.onClose,v=e.onReload,x=(0,n.useIntl)(),b=(0,s.useState)(i),y=p()(b,2),j=y[0],k=y[1],C=(0,s.useState)(null),T=p()(C,2),P=T[0],U=T[1];(0,s.useEffect)((function(){k(i),U((null==i?void 0:i.scoreObject)||Te(null==i?void 0:i.scoreResult))}),[i]);var F=null==j?void 0:j.uid,R=(0,s.useMemo)((function(){var e,t;return o||(null==j?void 0:j.orgUid)||(null==i?void 0:i.orgUid)||(null==j||null===(e=j.org)||void 0===e?void 0:e.uid)||(null==i||null===(t=i.org)||void 0===t?void 0:t.uid)}),[o,j,i]),E=(0,s.useMemo)((function(){return(null==j?void 0:j.language)||"ZH_CN"}),[null==j?void 0:j.language]),O=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:if(R){e.next=5;break}return L.yw.warning(x.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 5:return e.prev=5,L.yw.loading(x.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=9,(0,me.OW)({uid:F,orgUid:R});case 9:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(x.formatMessage({id:"success",defaultMessage:"è¯„åˆ†æˆåŠŸ"})),k(null==t?void 0:t.data),U((null==t||null===(a=t.data)||void 0===a?void 0:a.scoreObject)||Te(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),null==v||v()):L.yw.error((null==t?void 0:t.message)||x.formatMessage({id:"failed",defaultMessage:"è¯„åˆ†å¤±è´¥"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),L.yw.error(x.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=c()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:if(R){e.next=5;break}return L.yw.warning(x.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 5:return e.prev=5,L.yw.loading(x.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=9,(0,me.vF)({uid:F,orgUid:R});case 9:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(x.formatMessage({id:"success",defaultMessage:"ä¼˜åŒ–æˆåŠŸ"})),k(null==t?void 0:t.data),null==v||v()):L.yw.error((null==t?void 0:t.message)||x.formatMessage({id:"failed",defaultMessage:"ä¼˜åŒ–å¤±è´¥"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),L.yw.error(x.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=2;break}return e.abrupt("return");case 2:if(R){e.next=5;break}return L.yw.warning(x.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 5:return e.prev=5,L.yw.loading(x.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=9,(0,me.$2)(F,{orgUid:R});case 9:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(x.formatMessage({id:"success",defaultMessage:"é‡ç½®æˆåŠŸ"})),k(null==t?void 0:t.data),U((null==t||null===(a=t.data)||void 0===a?void 0:a.scoreObject)||Te(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),null==v||v()):L.yw.error((null==t?void 0:t.message)||x.formatMessage({id:"failed",defaultMessage:"é‡ç½®å¤±è´¥"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),L.yw.error(x.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){r&&F&&g&&l&&c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:null==f||f();case 3:case"end":return e.stop()}}),e)})))()}),[r,F,g,l]);var z=(0,s.useMemo)((function(){var e=null==P?void 0:P.score;if("number"==typeof e&&!Number.isNaN(e))return e<=1?Math.max(0,Math.min(100,Math.round(100*e))):e<=10?Math.max(0,Math.min(100,Math.round(10*e))):Math.max(0,Math.min(100,Math.round(e)))}),[null==P?void 0:P.score]);return(0,se.jsx)(pe.Z,{open:r,title:x.formatMessage({id:"prompt.score.result",defaultMessage:"è¯„åˆ†ç»“æœ"}),width:660,onClose:m,destroyOnHidden:!0,extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(S.Z,{title:x.formatMessage({id:"prompt.reset.confirm",defaultMessage:"ç¡®è®¤é‡ç½®ä¸ºç³»ç»Ÿé»˜è®¤æç¤ºè¯ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=3;break}return L.yw.warning(x.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šé‡ç½®æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,I();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{danger:!0,disabled:!j||!l,children:x.formatMessage({id:"prompt.reset.default",defaultMessage:"é‡ç½®é»˜è®¤"})})}),(0,se.jsx)(S.Z,{title:x.formatMessage({id:"prompt.score.confirm",defaultMessage:"ç¡®è®¤å¯¹è¯¥æç¤ºè¯è¿›è¡Œè¯„åˆ†ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=3;break}return L.yw.warning(x.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šè¯„åˆ†æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,O();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{disabled:!j||!l,children:x.formatMessage({id:"prompt.score",defaultMessage:"è¯„åˆ†"})})}),(0,se.jsx)(S.Z,{title:x.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"ç¡®è®¤å¯¹è¯¥æç¤ºè¯è¿›è¡Œä¼˜åŒ–ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=3;break}return L.yw.warning(x.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šä¼˜åŒ–æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,A();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{type:"primary",disabled:!j||!l,children:x.formatMessage({id:"prompt.optimize",defaultMessage:"ä¼˜åŒ–"})})}),(0,se.jsx)(M.ZP,{onClick:m,children:x.formatMessage({id:"close",defaultMessage:"å…³é—­"})})]}),children:j?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)("div",{style:{marginBottom:12},children:[(0,se.jsxs)("b",{children:[x.formatMessage({id:"name",defaultMessage:"åç§°"}),"ï¼š"]})," ",j.name||"-",(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[x.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),"ï¼š"]})," ",j.nickname||"-"]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[x.formatMessage({id:"language",defaultMessage:"è¯­è¨€"}),"ï¼š"]})," ",E]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[x.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),"ï¼š"]})," ",j.type||"-"]})]}),(0,se.jsxs)("div",{style:{marginBottom:16},children:[(0,se.jsx)("h4",{children:x.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:j.systemPrompt||""})]}),(0,se.jsxs)("div",{style:{marginBottom:16},children:[(0,se.jsx)("h4",{children:x.formatMessage({id:"prompt.score.result",defaultMessage:"è¯„åˆ†ç»“æœ"})}),P?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(ke.Z,{bordered:!0,size:"small",column:1,children:[(0,se.jsx)(ke.Z.Item,{label:x.formatMessage({id:"prompt.score",defaultMessage:"è¯„åˆ†"}),children:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)("span",{children:"number"==typeof P.score?P.score:"-"}),"number"==typeof z?(0,se.jsx)(Ze.Z,{percent:z,size:"small",style:{width:220}}):null]})}),(0,se.jsx)(ke.Z.Item,{label:x.formatMessage({id:"grade",defaultMessage:"ç­‰çº§"}),children:P.grade?(0,se.jsx)(w.Z,{color:"blue",children:P.grade}):"-"})]}),(0,se.jsx)(Ce.Z,{style:{margin:"12px 0"}}),(0,se.jsxs)(ke.Z,{bordered:!0,size:"small",column:1,children:[(0,se.jsx)(ke.Z.Item,{label:x.formatMessage({id:"prompt.strengths",defaultMessage:"ä¼˜ç‚¹"}),children:null!==(t=P.strengths)&&void 0!==t&&t.length?(0,se.jsx)(h.Z,{direction:"vertical",size:4,children:P.strengths.map((function(e,t){return(0,se.jsx)("div",{children:e},"".concat(t,"-").concat(e))}))}):"-"}),(0,se.jsx)(ke.Z.Item,{label:x.formatMessage({id:"prompt.weaknesses",defaultMessage:"ç¼ºç‚¹"}),children:null!==(a=P.weaknesses)&&void 0!==a&&a.length?(0,se.jsx)(h.Z,{direction:"vertical",size:4,children:P.weaknesses.map((function(e,t){return(0,se.jsx)("div",{children:e},"".concat(t,"-").concat(e))}))}):"-"}),(0,se.jsx)(ke.Z.Item,{label:x.formatMessage({id:"prompt.suggestions",defaultMessage:"å»ºè®®"}),children:(0,se.jsx)(Z.Z.Paragraph,{style:{marginBottom:0,whiteSpace:"pre-wrap"},children:P.suggestions||"-"})})]})]}):(0,se.jsx)("div",{children:x.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"})})]})]}):(0,se.jsx)("div",{children:x.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"})})})},Ue=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},Fe=function(e){var t=e.open,a=e.record,r=e.orgUid,i=e.canUpdate,o=e.autoRunOptimize,l=void 0!==o&&o,u=e.onAutoRunConsumed,g=e.onClose,f=e.onReload,m=(0,n.useIntl)(),v=(0,s.useState)(a),x=p()(v,2),b=x[0],y=x[1],w=(0,s.useState)(null),j=p()(w,2),k=j[0],Z=j[1];(0,s.useEffect)((function(){y(a),Z((null==a?void 0:a.optimizeObject)||Ue(null==a?void 0:a.optimizationMetadata))}),[a]);var C=null==b?void 0:b.uid,T=(0,s.useMemo)((function(){var e,t;return r||(null==b?void 0:b.orgUid)||(null==a?void 0:a.orgUid)||(null==b||null===(e=b.org)||void 0===e?void 0:e.uid)||(null==a||null===(t=a.org)||void 0===t?void 0:t.uid)}),[r,b,a]),P=(0,s.useMemo)((function(){return(null==b?void 0:b.language)||"ZH_CN"}),[null==b?void 0:b.language]),U=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=2;break}return e.abrupt("return");case 2:if(T){e.next=5;break}return L.yw.warning(m.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 5:return e.prev=5,L.yw.loading(m.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=9,(0,me.vF)({uid:C,orgUid:T});case 9:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(m.formatMessage({id:"success",defaultMessage:"ä¼˜åŒ–æˆåŠŸ"})),y(null==t?void 0:t.data),Z((null==t||null===(a=t.data)||void 0===a?void 0:a.optimizeObject)||Ue(null==t||null===(s=t.data)||void 0===s?void 0:s.optimizationMetadata)),null==f||f()):L.yw.error((null==t?void 0:t.message)||m.formatMessage({id:"failed",defaultMessage:"ä¼˜åŒ–å¤±è´¥"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),L.yw.error(m.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=c()(d()().mark((function e(){var t,a,s,r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=2;break}return e.abrupt("return");case 2:if(T){e.next=5;break}return L.yw.warning(m.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 5:if(t=null==b?void 0:b.optimizedPrompt){e.next=9;break}return L.yw.warning(m.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"})),e.abrupt("return");case 9:return e.prev=9,L.yw.loading(m.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),a={uid:C,orgUid:T,name:null==b?void 0:b.name,nickname:null==b?void 0:b.nickname,description:null==b?void 0:b.description,type:null==b?void 0:b.type,enabled:null==b?void 0:b.enabled,language:null==b?void 0:b.language,systemPrompt:t,userPrompt:null==b?void 0:b.userPrompt,variables:null==b?void 0:b.variables,tags:null==b?void 0:b.tags,metadata:null==b?void 0:b.metadata},e.next=14,(0,me.Fu)(a);case 14:200===(null==(s=e.sent)?void 0:s.code)?(L.yw.success(m.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),y(null==s?void 0:s.data),Z((null==s||null===(r=s.data)||void 0===r?void 0:r.optimizeObject)||Ue(null==s||null===(n=s.data)||void 0===n?void 0:n.optimizationMetadata)),null==f||f()):L.yw.error((null==s?void 0:s.message)||m.formatMessage({id:"update.failed",defaultMessage:"æ›´æ–°å¤±è´¥"})),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),L.yw.error(m.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 21:case"end":return e.stop()}}),e,null,[[9,18]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){t&&C&&l&&i&&c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:null==u||u();case 3:case"end":return e.stop()}}),e)})))()}),[t,C,l,i]),(0,se.jsx)(pe.Z,{open:t,title:m.formatMessage({id:"prompt.optimize.result",defaultMessage:"ä¼˜åŒ–ç»“æœ"}),width:660,onClose:g,destroyOnHidden:!0,extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(S.Z,{title:m.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"ç¡®è®¤å¯¹è¯¥æç¤ºè¯è¿›è¡Œä¼˜åŒ–ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return L.yw.warning(m.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šä¼˜åŒ–æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,U();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{disabled:!b||!i,children:m.formatMessage({id:"prompt.optimize",defaultMessage:"ä¼˜åŒ–"})})}),(0,se.jsx)(S.Z,{title:m.formatMessage({id:"prompt.apply.optimized.confirm",defaultMessage:"ç¡®è®¤å°†ä¼˜åŒ–åçš„æç¤ºè¯è¦†ç›–åˆ°ç³»ç»Ÿæç¤ºè¯ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return L.yw.warning(m.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šç¼–è¾‘æç¤ºè¯"})),e.abrupt("return");case 3:return e.next=5,F();case 5:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)(M.ZP,{type:"primary",disabled:!b||!(null!=b&&b.optimizedPrompt)||!i,children:m.formatMessage({id:"prompt.apply.optimized",defaultMessage:"ä¸€é”®æ›´æ–°åˆ°ç³»ç»Ÿæç¤ºè¯"})})}),(0,se.jsx)(M.ZP,{onClick:g,children:m.formatMessage({id:"close",defaultMessage:"å…³é—­"})})]}),children:b?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)("div",{style:{marginBottom:12},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"name",defaultMessage:"åç§°"}),"ï¼š"]})," ",b.name||"-",(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),"ï¼š"]})," ",b.nickname||"-"]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"language",defaultMessage:"è¯­è¨€"}),"ï¼š"]})," ",P]}),(0,se.jsxs)("span",{style:{marginLeft:16},children:[(0,se.jsxs)("b",{children:[m.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),"ï¼š"]})," ",b.type||"-"]})]}),(0,se.jsxs)("div",{style:{marginBottom:16},children:[(0,se.jsx)("h4",{children:m.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:b.systemPrompt||""})]}),(0,se.jsxs)("div",{style:{marginBottom:8},children:[(0,se.jsx)("h4",{children:m.formatMessage({id:"prompt.optimize.result",defaultMessage:"ä¼˜åŒ–ç»“æœ"})}),(0,se.jsxs)("div",{style:{marginBottom:8},children:[(0,se.jsx)("b",{children:m.formatMessage({id:"prompt.optimized.prompt",defaultMessage:"ä¼˜åŒ–åçš„æç¤ºè¯"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:260,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:b.optimizedPrompt||""})]}),(0,se.jsxs)("div",{children:[(0,se.jsx)("b",{children:m.formatMessage({id:"prompt.optimization.metadata",defaultMessage:"ä¼˜åŒ–å…ƒæ•°æ®"})}),(0,se.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:260,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:k?JSON.stringify(k,null,2):"æš‚æ— ç»“æœ"})]})]})]}):(0,se.jsx)("div",{children:m.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"})})})},Re=function(e){var t=e.open,a=e.record,r=e.orgUid,i=e.canUpdate,o=e.value,l=e.onClose,u=e.onSaved,g=(0,n.useIntl)(),f=(0,s.useState)(o||(null==a?void 0:a.systemPrompt)||""),m=p()(f,2),v=m[0],h=m[1],x=(0,s.useMemo)((function(){var e;return r||(null==a?void 0:a.orgUid)||(null==a||null===(e=a.org)||void 0===e?void 0:e.uid)}),[r,a]);(0,s.useEffect)((function(){var e;h(null!==(e=null!=o?o:null==a?void 0:a.systemPrompt)&&void 0!==e?e:"")}),[t,o,null==a?void 0:a.uid]);var b=function(){var e=c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(v||"");case 3:L.yw.success(g.formatMessage({id:"copy.success",defaultMessage:"å¤åˆ¶æˆåŠŸ"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),L.yw.error(g.formatMessage({id:"copy.failed",defaultMessage:"å¤åˆ¶å¤±è´¥"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=c()(d()().mark((function e(){var t,s,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return null==l||l(),e.abrupt("return");case 3:if(i){e.next=6;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šç¼–è¾‘æç¤ºè¯"})),e.abrupt("return");case 6:if(x){e.next=9;break}return L.yw.warning(g.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 9:return e.prev=9,L.yw.loading(g.formatMessage({id:"saving",defaultMessage:"Saving..."})),s={uid:(t=a).uid,orgUid:x,name:t.name,nickname:null==t?void 0:t.nickname,description:t.description,type:t.type,enabled:t.enabled,language:null==t?void 0:t.language,systemPrompt:v,userPrompt:null==t?void 0:t.userPrompt,variables:null==t?void 0:t.variables,tags:null==t?void 0:t.tags,metadata:null==t?void 0:t.metadata},e.next=15,(0,me.Fu)(s);case 15:r=e.sent,ie.Z.debug("PromptSystemPromptModal handleSave updated systemPrompt:",r,s),L.yw.destroy(),200===(null==r?void 0:r.code)?(L.yw.success(g.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==u||u()):L.yw.error((null==r?void 0:r.message)||g.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(9),L.yw.destroy(),L.yw.error(g.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 25:case"end":return e.stop()}}),e,null,[[9,21]])})));return function(){return e.apply(this,arguments)}}();return(0,se.jsx)(k.Z,{open:t,title:g.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),onCancel:l,footer:[(0,se.jsx)(M.ZP,{onClick:b,children:g.formatMessage({id:"copy",defaultMessage:"å¤åˆ¶"})},"copy"),(0,se.jsx)(M.ZP,{type:"primary",onClick:y,disabled:!a||!i,children:g.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})},"save"),(0,se.jsx)(M.ZP,{onClick:l,children:g.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:(0,se.jsx)("div",{children:(0,se.jsx)("textarea",{value:v,onChange:function(e){return h(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:g.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})})})})},Ee=["current","pageSize"],Oe=function(){var e,t,a,r,i,o,l,u,g=(0,n.useIntl)(),m=(0,n.useAccess)(),v=(0,s.useRef)(),h=(0,D.u)((function(e){return e.currentOrg})),x={GENERAL:{text:g.formatMessage({id:"prompt.type.general",defaultMessage:"é€šç”¨"})},THREAD_SUMMARY:{text:g.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"ä¼šè¯æ€»ç»“"})},THREAD_INTENTION:{text:g.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"ä¼šè¯æ„å›¾"})},THREAD_EMOTION:{text:g.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"ä¼šè¯æƒ…ç»ª"})},CUSTOMER_PROFILE:{text:g.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"å®¢æˆ·ç”»åƒ"})},TICKET_ASSIST:{text:g.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"å·¥å•è¾…åŠ©"})}},b={ZH_CN:{text:g.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"ç®€ä½“ä¸­æ–‡(ZH_CN)"})},EN:{text:g.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"})},ZH_TW:{text:g.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"ç¹é«”ä¸­æ–‡(ZH_TW)"})}},y=(0,s.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,Y.MY.PROMPT)}),[m]),j=null!==(e=null==y||null===(t=y.canRead)||void 0===t?void 0:t.call(y))&&void 0!==e&&e,k=null!==(a=null==y||null===(r=y.canCreate)||void 0===r?void 0:r.call(y))&&void 0!==a&&a,Z=null!==(i=null==y||null===(o=y.canUpdate)||void 0===o?void 0:o.call(y))&&void 0!==i&&i,C=null!==(l=null==y||null===(u=y.canDelete)||void 0===u?void 0:u.call(y))&&void 0!==l&&l,T=(0,s.useState)(!1),P=p()(T,2),U=P[0],F=P[1],R=(0,s.useState)("create"),E=p()(R,2),O=E[0],A=E[1],I=(0,s.useState)(void 0),z=p()(I,2),N=z[0],q=z[1],H=(0,s.useState)(!1),_=p()(H,2),B=_[0],K=_[1],W=(0,s.useState)(void 0),J=p()(W,2),V=J[0],G=J[1],Q=(0,s.useState)(null),$=p()(Q,2),X=$[0],ee=$[1],te=(0,s.useState)(!1),ae=p()(te,2),re=ae[0],ne=ae[1],oe=(0,s.useState)(void 0),le=p()(oe,2),de=le[0],ue=le[1],ce=(0,s.useState)(!1),pe=p()(ce,2),ve=pe[0],Me=pe[1],he=(0,s.useState)(!1),xe=p()(he,2),be=xe[0],ye=xe[1],je=(0,s.useState)(void 0),ke=p()(je,2),Ze=ke[0],Ce=ke[1],Te=(0,s.useState)(!1),Ue=p()(Te,2),Oe=Ue[0],Ae=Ue[1],Ie=(0,s.useState)(!1),ze=p()(Ie,2),Ne=ze[0],qe=ze[1],He=(0,s.useState)(""),_e=p()(He,2),Be=_e[0],Le=_e[1],Ke=(0,s.useState)(null),De=p()(Ke,2),We=De[0],Je=De[1],Ve=function(){A("create"),q(void 0),F(!0)},Ye=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:g.formatMessage({id:"name",defaultMessage:"åç§°"}),dataIndex:"name",copyable:!0,ellipsis:!0,sorter:!0,fixed:"left"},{title:g.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,sorter:!0,width:200},{title:g.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),dataIndex:"type",valueType:"select",width:160,valueEnum:x,render:function(e,t){var a,s=(null==t?void 0:t.type)||"-",r=(null==x||null===(a=x[s])||void 0===a?void 0:a.text)||s;return(0,se.jsx)(w.Z,{children:r})}},{title:g.formatMessage({id:"description",defaultMessage:"æè¿°"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:g.formatMessage({id:"language",defaultMessage:"è¯­è¨€"}),dataIndex:"language",valueType:"select",width:110,ellipsis:!0,copyable:!0,valueEnum:b},{title:g.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),dataIndex:"systemPrompt",width:120,hideInSearch:!0,render:function(e,t){var a=null==t?void 0:t.systemPrompt;return a?(0,se.jsx)("a",{onClick:function(){j?(Le(a),Je(t),qe(!0)):L.yw.warning(g.formatMessage({id:"prompt.permission.read.denied",defaultMessage:"æ— æƒé™ï¼šæŸ¥çœ‹æç¤ºè¯"}))},children:g.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})}):"-"}},{title:g.formatMessage({id:"enabled",defaultMessage:"å¯ç”¨"}),dataIndex:"enabled",valueType:"select",width:100,valueEnum:{true:{text:g.formatMessage({id:"yes",defaultMessage:"æ˜¯"})},false:{text:g.formatMessage({id:"no",defaultMessage:"å¦"})}},render:function(e,t){return null!=t&&t.enabled?(0,se.jsx)(w.Z,{color:"green",children:"ON"}):(0,se.jsx)(w.Z,{color:"default",children:"OFF"})}},{title:g.formatMessage({id:"updatedAt",defaultMessage:"æ›´æ–°æ—¶é—´"}),dataIndex:"updatedAt",width:200,hideInSearch:!0,sorter:!0},{title:g.formatMessage({id:"action",defaultMessage:"æ“ä½œ"}),valueType:"option",width:320,fixed:"right",render:function(e,t){return[(0,se.jsx)("a",{onClick:function(){ee(null),function(e){G(e),K(!0)}(t)},children:g.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})},"view"),(0,se.jsx)(S.Z,{title:g.formatMessage({id:"prompt.reset.confirm",defaultMessage:"ç¡®è®¤é‡ç½®ä¸ºç³»ç»Ÿé»˜è®¤æç¤ºè¯ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){var a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šé‡ç½®æç¤ºè¯"})),e.abrupt("return");case 3:if(null!=t&&t.uid){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,L.yw.loading(g.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=9,(0,me.$2)(t.uid,{orgUid:null==h?void 0:h.uid});case 9:200===(null==(a=e.sent)?void 0:a.code)?(L.yw.success(g.formatMessage({id:"success",defaultMessage:"é‡ç½®æˆåŠŸ"})),null===(s=v.current)||void 0===s||s.reload()):L.yw.error((null==a?void 0:a.message)||g.formatMessage({id:"failed",defaultMessage:"é‡ç½®å¤±è´¥"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),L.yw.error(g.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])}))),children:(0,se.jsx)("a",{children:g.formatMessage({id:"prompt.reset.default",defaultMessage:"é‡ç½®é»˜è®¤"})})},"reset"),(0,se.jsx)("a",{onClick:function(){Z?function(e){ue(e),Me(!1),ne(!0)}(t):L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šè¯„åˆ†æç¤ºè¯"}))},children:g.formatMessage({id:"prompt.score",defaultMessage:"è¯„åˆ†"})},"score"),(0,se.jsx)("a",{onClick:function(){Z?function(e){Ce(e),Ae(!1),ye(!0)}(t):L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šä¼˜åŒ–æç¤ºè¯"}))},children:g.formatMessage({id:"prompt.optimize",defaultMessage:"ä¼˜åŒ–"})},"optimize"),(0,se.jsx)("a",{onClick:function(){Z?function(e){A("edit"),q(e),F(!0)}(t):L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šç¼–è¾‘æç¤ºè¯"}))},children:g.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,se.jsx)(S.Z,{title:g.formatMessage({id:"delete.confirm",defaultMessage:"ç¡®è®¤åˆ é™¤ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){var a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.delete.denied",defaultMessage:"æ— æƒé™ï¼šåˆ é™¤æç¤ºè¯"})),e.abrupt("return");case 3:if(null!=t&&t.uid){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,(0,me.$j)({uid:t.uid});case 7:200===(null==(a=e.sent)?void 0:a.code)?(L.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"åˆ é™¤æˆåŠŸ"})),null===(s=v.current)||void 0===s||s.reload()):L.yw.error((null==a?void 0:a.message)||g.formatMessage({id:"delete.failed",defaultMessage:"åˆ é™¤å¤±è´¥"}));case 9:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)("a",{children:g.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}}];return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(fe.Z,{columns:Ye,actionRef:v,cardBordered:!0,scroll:{x:"max-content"},form:{initialValues:{language:"ZH_CN"}},request:function(){var e=c()(d()().mark((function e(t,a){var s,r,n,i,o,l,u,c,m,p,v,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.read.denied",defaultMessage:"æ— æƒé™ï¼šæŸ¥çœ‹æç¤ºè¯"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return o=(i=t).current,l=i.pageSize,"true"===(null==(u=ge()(i,Ee))?void 0:u.enabled)?u.enabled=!0:"false"===(null==u?void 0:u.enabled)&&(u.enabled=!1),a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],c=p,m="ascend"===a[p]?"ascend":"descend"),v=f()(f()({pageNumber:(o||1)-1,pageSize:l||10,orgUid:null==h?void 0:h.uid},u),{},{language:null!==(s=null==u?void 0:u.language)&&void 0!==s?s:"ZH_CN",sortBy:c,sortDirection:m}),e.next=9,(0,me.WD)(v);case 9:return M=e.sent,ie.Z.debug("PromptTab queryPromptsByOrg:",M,v),e.abrupt("return",{data:(null==M||null===(r=M.data)||void 0===r?void 0:r.content)||[],success:!0,total:(null==M||null===(n=M.data)||void 0===n?void 0:n.totalElements)||0});case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0},headerTitle:g.formatMessage({id:"menu.robot.prompt",defaultMessage:"æç¤ºè¯"}),toolBarRender:function(){return e=[],k&&e.push((0,se.jsx)(M.ZP,{type:"primary",onClick:Ve,children:g.formatMessage({id:"create",defaultMessage:"æ–°å»º"})},"create")),Z&&e.push((0,se.jsx)(S.Z,{title:g.formatMessage({id:"prompt.reset.all.confirm",defaultMessage:"ç¡®è®¤é‡ç½®å…¨éƒ¨ä¸ºç³»ç»Ÿé»˜è®¤æç¤ºè¯ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){var t,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=h&&h.uid){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.org.missing",defaultMessage:"è¯·å…ˆé€‰æ‹©ç»„ç»‡"})),e.abrupt("return");case 3:return e.prev=3,L.yw.loading(g.formatMessage({id:"loading",defaultMessage:"æ­£åœ¨å¤„ç†..."})),e.next=7,(0,me.uy)({orgUid:h.uid});case 7:200===(null==(t=e.sent)?void 0:t.code)?(L.yw.success(g.formatMessage({id:"prompt.reset.all.success",defaultMessage:"å·²é‡ç½®ä¸ºç³»ç»Ÿé»˜è®¤"})),null===(a=v.current)||void 0===a||a.reload()):L.yw.error((null==t?void 0:t.message)||g.formatMessage({id:"failed",defaultMessage:"é‡ç½®å¤±è´¥"})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),L.yw.error(g.formatMessage({id:"error",defaultMessage:"è¯·æ±‚å‡ºé”™"}));case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),children:(0,se.jsx)(M.ZP,{danger:!0,children:g.formatMessage({id:"prompt.reset.all",defaultMessage:"é‡ç½®å…¨éƒ¨é»˜è®¤"})},"resetAllBtn")},"resetAll")),e;var e}}),(0,se.jsx)(we,{open:U,mode:O,initialValues:N,onCancel:function(){return F(!1)},onSubmit:function(){var e=c()(d()().mark((function e(t){var a,s,r,n,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=f()(f()({},t),{},{orgUid:null==h?void 0:h.uid}),"create"!==O){e.next=8;break}return e.next=5,(0,me.Fh)(a);case 5:return 200===(null==(s=e.sent)?void 0:s.code)?(L.yw.success(g.formatMessage({id:"create.success",defaultMessage:"åˆ›å»ºæˆåŠŸ"})),F(!1),null===(r=v.current)||void 0===r||r.reload()):L.yw.error((null==s?void 0:s.message)||g.formatMessage({id:"create.failed",defaultMessage:"åˆ›å»ºå¤±è´¥"})),e.abrupt("return");case 8:return e.next=10,(0,me.Fu)(a);case 10:200===(null==(n=e.sent)?void 0:n.code)?(L.yw.success(g.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),F(!1),null===(i=v.current)||void 0===i||i.reload()):L.yw.error((null==n?void 0:n.message)||g.formatMessage({id:"update.failed",defaultMessage:"æ›´æ–°å¤±è´¥"})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),L.yw.error(g.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()}),(0,se.jsx)(Se,{open:B,record:V,orgUid:null==h?void 0:h.uid,canUpdate:Z,autoRunAction:X,onAutoRunConsumed:function(){return ee(null)},onReload:function(){var e;return null===(e=v.current)||void 0===e?void 0:e.reload()},onClose:function(){K(!1),G(void 0),ee(null)}}),(0,se.jsx)(Pe,{open:re,record:de,orgUid:null==h?void 0:h.uid,canUpdate:Z,autoRunScore:ve,onAutoRunConsumed:function(){return Me(!1)},onReload:function(){var e;return null===(e=v.current)||void 0===e?void 0:e.reload()},onClose:function(){ne(!1),ue(void 0),Me(!1)}}),(0,se.jsx)(Fe,{open:be,record:Ze,orgUid:null==h?void 0:h.uid,canUpdate:Z,autoRunOptimize:Oe,onAutoRunConsumed:function(){return Ae(!1)},onReload:function(){var e;return null===(e=v.current)||void 0===e?void 0:e.reload()},onClose:function(){ye(!1),Ce(void 0),Ae(!1)}}),(0,se.jsx)(Re,{open:Ne,record:We,value:Be,orgUid:null==h?void 0:h.uid,canUpdate:Z,onClose:function(){return qe(!1)},onSaved:function(){var e;qe(!1),Je(null),null===(e=v.current)||void 0===e||e.reload()}})]})},Ae=a(94976),Ie=function(){var e,t,a,s,i,o,l,d,u=(0,n.useAccess)(),c=null!==(e=null==u||null===(t=u.hasAnyModulePermission)||void 0===t?void 0:t.call(u,Y.MY.ROBOT))&&void 0!==e&&e,g=null!==(a=null==u||null===(s=u.hasAnyModulePermission)||void 0===s?void 0:s.call(u,Y.MY.ROBOT_SETTINGS))&&void 0!==a&&a,f=null!==(i=null==u||null===(o=u.hasAnyModulePermission)||void 0===o?void 0:o.call(u,Y.MY.PROMPT))&&void 0!==i&&i,m=[];if(c&&m.push({key:"table",label:(0,se.jsx)(n.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,se.jsx)(ue.Z,{robotType:Ae.f4h})}),g&&m.push({key:"settings",label:(0,se.jsx)(n.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,se.jsx)(de,{})}),c&&m.push({key:"agent",label:(0,se.jsx)(n.FormattedMessage,{id:"menu.robot.agent",defaultMessage:"æ™ºèƒ½ä½“"}),children:(0,se.jsx)(ue.Z,{robotType:Ae.Qeb})}),f&&m.push({key:"prompt",label:(0,se.jsx)(n.FormattedMessage,{id:"menu.robot.prompt",defaultMessage:"Prompt"}),children:(0,se.jsx)(Oe,{})}),0===m.length)return null;var p=String(null!==(l=null===(d=m[0])||void 0===d?void 0:d.key)&&void 0!==l?l:"table");return(0,se.jsx)(r.Z,{defaultActiveKey:p,style:{padding:"10px"},items:m})}}}]);