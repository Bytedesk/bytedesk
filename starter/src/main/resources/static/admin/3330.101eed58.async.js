"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3330],{6231:function(e,t,a){var n=a(90819),r=a.n(n),s=a(89933),l=a.n(s),o=a(45332),i=a.n(o),d=a(74171),u=a(94976),c=a(99036),f=a(86702),g=a(59005),p=a(4628),v=a(27729),m=a(69705),h=a(28582),M=a(69533),b=a(30310),x=a(69174),y=a(44194),w=a(47926),k=a(97799),S=a(10162),I=a(11818),j=a(59908),C=a(31549);t.Z=function(e){var t=e.open,a=e.onClose,n=e.onSubmit,s=(0,p.useIntl)(),o=c.A.useForm(),Z=i()(o,1)[0],T=(0,d.u)((function(e){return e.currentOrg})),U=(0,y.useState)(!1),E=i()(U,2),A=E[0],P=E[1],R=(0,y.useState)(!1),F=i()(R,2),O=F[0],K=F[1],Q=(0,y.useState)(0),D=i()(Q,2),B=D[0],N=D[1],z=(0,y.useState)([]),q=i()(z,2),L=q[0],V=q[1],W=(0,y.useState)([]),G=i()(W,2),H=G[0],_=G[1],J=(0,y.useState)(""),Y=i()(J,2),X=Y[0],$=Y[1],ee=(0,y.useCallback)(function(){var e=l()(r()().mark((function e(t){var a,n,s,l,o;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K(!0),e.prev=1,n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==T?void 0:T.uid,searchText:t||""},e.next=5,(0,w.VW)(n);case 5:return s=e.sent,console.log("queryRobotSettingsByOrg response:",s,n),l=(null==s||null===(a=s.data)||void 0===a?void 0:a.content)||[],V(l),!Z.getFieldValue("settingsUid")&&l.length>0&&Z.setFieldsValue({settingsUid:l[0].uid}),o=l.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),_(o),e.abrupt("return",o);case 13:return e.prev=13,K(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==T?void 0:T.uid,Z]);(0,y.useEffect)((function(){t&&ee()}),[t,B,ee]);var te=function(){console.log("handleSaveRobot"),Z.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==T?void 0:T.uid,avatar:e.avatar||X};console.log("robotObject:",t),n(t),Z.resetFields(),$("")})).catch((function(e){console.log("Form errors:",e)}))};(0,y.useEffect)((function(){console.log("RobotForm useEffect"),t&&(Z.resetFields(),Z.setFieldsValue({type:u.f4h}),$(""))}),[t,Z]);var ae=function(){var e=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),$(t),Z.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsx)("div",{children:(0,C.jsxs)(v.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:te,onCancel:function(){Z.resetFields(),a()},children:[(0,C.jsxs)(c.A,{form:Z,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,C.jsx)(m.Z.Item,{name:"avatarUpload",label:s.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,C.jsxs)(I.G,{onSuccess:ae,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,C.jsx)(h.Z,{src:X}),(0,C.jsx)(M.ZP,{icon:(0,C.jsx)(j.Z,{}),style:{marginLeft:12},children:s.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,C.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,C.jsx)(c.A.Item,{label:s.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:s.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,C.jsxs)(b.Z.Compact,{block:!0,children:[(0,C.jsx)(x.Z,{showSearch:!0,allowClear:!0,placeholder:s.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),options:H,loading:O,filterOption:!1,onSearch:function(e){return ee(e)},onFocus:function(){return ee()},notFoundContent:0===L.length?(0,C.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,C.jsx)("div",{style:{marginBottom:8,color:"#999"},children:s.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,C.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,C.jsx)(S.Z,{}),onClick:function(){return P(!0)},children:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0}),(0,C.jsx)(M.ZP,{size:"small",icon:(0,C.jsx)(S.Z,{}),onClick:function(){return P(!0)},title:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:s.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,C.jsx)(f.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return te()}}}),(0,C.jsx)(g.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:s.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,C.jsx)(k.Z,{open:A,onOpenChange:P,orgUid:(null==T?void 0:T.uid)||"",record:null,onSuccess:function(){P(!1),N((function(e){return e+1}))}})]})})}},43330:function(e,t,a){a.d(t,{Z:function(){return P}});var n=a(73193),r=a.n(n),s=a(10154),l=a.n(s),o=a(90819),i=a.n(o),d=a(89933),u=a.n(d),c=a(45332),f=a.n(c),g=a(44194),p=a(4628),v=a(44565),m=a(28582),h=a(90581),M=a(43275),b=a(69533),x=a(43388),y=a(56862),w=a(90084),k=a(13845),S=a(74171),I=a(85977),j=a(94976),C=a(80950),Z=a(6231),T=a(27729),U=a(67242),E=a(31549),A=function(e){var t,a=e.open,n=e.record,s=e.value,l=e.onClose,o=e.onSaved,d=(0,p.useIntl)(),c=(0,g.useState)(s||(null==n||null===(t=n.llm)||void 0===t?void 0:t.prompt)||""),v=f()(c,2),m=v[0],h=v[1];(0,g.useEffect)((function(){var e,t;h(null!==(e=null!=s?s:null==n||null===(t=n.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[a,s,null==n?void 0:n.uid]);var M=function(){var e=u()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(m||"");case 3:x.yw.success(d.formatMessage({id:"copy.success",defaultMessage:"复制成功"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),x.yw.error(d.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=u()(i()().mark((function e(){var t,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.uid){e.next=3;break}return null==l||l(),e.abrupt("return");case 3:return e.prev=3,x.yw.loading(d.formatMessage({id:"saving",defaultMessage:"Saving..."})),a={uid:(t=n).uid,prompt:m,llm:r()(r()({},t.llm||{}),{},{prompt:m})},e.next=9,(0,y.M8)(a);case 9:s=e.sent,U.Z.debug("PromptEditModal handleSave updated robot prompt:",s,a),x.yw.destroy(),200===(null==s?void 0:s.code)?(x.yw.success(d.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==o||o()):x.yw.error((null==s?void 0:s.message)||d.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),x.yw.destroy(),x.yw.error(d.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,E.jsx)(T.Z,{open:a,title:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),onCancel:l,footer:[(0,E.jsx)(b.ZP,{onClick:M,children:d.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,E.jsx)(b.ZP,{type:"primary",onClick:w,children:d.formatMessage({id:"save",defaultMessage:"保存"})},"save"),(0,E.jsx)(b.ZP,{onClick:l,children:d.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:(0,E.jsx)("div",{children:(0,E.jsx)("textarea",{value:m,onChange:function(e){return h(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})})})})},P=function(e){var t,a,n,s,o,d,c,T,P=e.superUser,R=(0,p.useIntl)(),F=(0,p.useAccess)(),O=(0,g.useRef)(),K=(0,S.u)((function(e){return e.currentOrg})),Q=(0,g.useState)(!1),D=f()(Q,2),B=D[0],N=D[1],z=(0,g.useState)(!1),q=f()(z,2),L=q[0],V=q[1],W=(0,g.useState)(null),G=f()(W,2),H=G[0],_=G[1],J=(0,g.useState)(!1),Y=f()(J,2),X=Y[0],$=Y[1],ee=(0,g.useState)(""),te=f()(ee,2),ae=te[0],ne=te[1],re=(0,g.useState)(null),se=f()(re,2),le=se[0],oe=se[1],ie=(0,g.useState)({}),de=f()(ie,2),ue=de[0],ce=de[1],fe=(0,g.useState)({}),ge=f()(fe,2),pe=ge[0],ve=ge[1],me=(0,g.useMemo)((function(){var e;return null==F||null===(e=F.getModulePermission)||void 0===e?void 0:e.call(F,I.MY.ROBOT)}),[F]),he=null!==(t=null==me||null===(a=me.canRead)||void 0===a?void 0:a.call(me))&&void 0!==t&&t,Me=null!==(n=null==me||null===(s=me.canCreate)||void 0===s?void 0:s.call(me))&&void 0!==n&&n,be=null!==(o=null==me||null===(d=me.canUpdate)||void 0===d?void 0:d.call(me))&&void 0!==o&&o,xe=null!==(c=null==me||null===(T=me.canDelete)||void 0===T?void 0:T.call(me))&&void 0!==c&&c,ye=(0,g.useRef)(!1),we=function(e,t){x.yw.warning(R.formatMessage({id:e,defaultMessage:t}))};g.useEffect((function(){var e=function(){var e=u()(i()().mark((function e(){var t,a,n,r,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==K?void 0:K.uid,level:j.whQ},e.next=4,(0,w.mK)(t);case 4:a=e.sent,U.Z.debug("RobotTable loadProviders response:",a,t),200===(null==a?void 0:a.code)&&(r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],s={},r.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(s[e.uid]=t)})),ce(s)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=K&&K.uid?e():ce({})}),[null==K?void 0:K.uid]),g.useEffect((function(){var e=function(){var e=u()(i()().mark((function e(){var t,a,n,r,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,orgUid:null==K?void 0:K.uid,searchText:""},e.next=4,(0,k.AP)(t);case 4:a=e.sent,U.Z.debug("RobotTable loadKbases response:",a,t),200===(null==a?void 0:a.code)&&(r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],s={},r.forEach((function(e){null!=e&&e.uid&&(s[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),ve(s)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=K&&K.uid?e():ve({})}),[null==K?void 0:K.uid]);var ke=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:R.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:R.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,E.jsx)(m.Z,{src:null==t?void 0:t.avatar})}},{title:R.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(e,t){var a=null==t?void 0:t.type,n=a===j.Qeb?"green":a===j.f4h?"blue":"purple",r=a===j.f4h?R.formatMessage({id:j.f4h,defaultMessage:"Service"}):a===j.Qeb?R.formatMessage({id:j.Qeb,defaultMessage:"Chat"}):a===j.wG_?R.formatMessage({id:j.wG_,defaultMessage:"Marketing"}):R.formatMessage({id:a||"unknown",defaultMessage:a||"-"});return(0,E.jsx)(h.Z,{color:n,children:r})},hideInSearch:!0},{title:R.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:l()(l()({},j.f4h,{text:R.formatMessage({id:j.f4h,defaultMessage:"Service"})}),j.Qeb,{text:R.formatMessage({id:j.Qeb,defaultMessage:"Chat"})}),hideInTable:!0},{title:R.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:R.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){if((null==t?void 0:t.type)===j.Qeb){var a,n,r=!(null==t||null===(a=t.llm)||void 0===a||!a.textModel);return(0,E.jsx)("a",{onClick:function(){be?(_(t),N(!0)):we("robot.permission.update.denied","无权限：编辑机器人")},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(n=t.llm)||void 0===n?void 0:n.textModel)||R.formatMessage({id:"robot.llm.configured",defaultMessage:"模型已配置"}):R.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"未配置模型，点击配置"})})}return null!=t&&t.settings?(0,E.jsx)("a",{onClick:function(){be?(_(t),N(!0)):we("robot.permission.update.denied","无权限：编辑机器人")},children:t.settings.name||R.formatMessage({id:"robot.settings.configured",defaultMessage:"已配置"})}):(0,E.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){be?(_(t),N(!0)):we("robot.permission.update.denied","无权限：编辑机器人")},children:R.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:R.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(e,t){var a,n=null==t||null===(a=t.llm)||void 0===a?void 0:a.prompt;return n?(0,E.jsx)("a",{onClick:function(){he?(ne(n),oe(t),$(!0)):we("robot.permission.read.denied","无权限：查看机器人")},children:R.formatMessage({id:"view",defaultMessage:"查看"})}):"-"}},{title:R.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"文本模型提供商"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var a,n,r=null==t||null===(a=t.llm)||void 0===a?void 0:a.textProviderUid;return r&&ue[r]?ue[r]:(null==t||null===(n=t.llm)||void 0===n?void 0:n.textProvider)||"-"}},{title:R.formatMessage({id:"pages.prompt.model",defaultMessage:"模型"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var a;return(null==t||null===(a=t.llm)||void 0===a?void 0:a.textModel)||"-"}},{title:R.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,t){var a;return null!=t&&null!==(a=t.llm)&&void 0!==a&&a.enabled?"是":"否"}},{title:R.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库搜索结果为空时用LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,t){var a;return null!=t&&null!==(a=t.llm)&&void 0!==a&&a.useLlmWhenKbEmpty?"是":"否"}},{title:R.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:R.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var a,n,r;return 0===(null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)?"0":null!==(n=null==t||null===(r=t.llm)||void 0===r?void 0:r.temperature)&&void 0!==n?n:"-"}},{title:R.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var a,n;return null!==(a=null==t||null===(n=t.llm)||void 0===n?void 0:n.topK)&&void 0!==a?a:"-"}},{title:R.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"知识库启用"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"是":"否"}},{title:R.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"是":"否"}},{title:R.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,t){var a,n=null==t||null===(a=t.llm)||void 0===a?void 0:a.searchType;return n===j.ccx?"全文":n===j.DGp?"向量":n===j.rk3?"混合":null!=n?n:"-"}},{title:R.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,t){var a=null==t?void 0:t.kbUid;return a?pe[a]||a:"-"}},{title:R.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:R.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:R.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){var a=[];return he&&(a.push((0,E.jsx)("a",{onClick:function(){return function(e){var t;if(he)if(e&&e.uid){var a={chatConfig:{org:null==K?void 0:K.uid,t:j.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}else x.yw.error(R.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}));else we("robot.permission.read.denied","无权限：查看机器人")}(t)},children:R.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test")),a.push((0,E.jsx)("a",{onClick:function(){return p.history.push("/service/channel")},children:R.formatMessage({id:"robot.get.code",defaultMessage:"获取机器人代码"})},"code"))),be&&a.push((0,E.jsx)("a",{onClick:function(){_(t),N(!0)},children:R.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")),xe&&a.push((0,E.jsx)(M.Z,{title:R.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(R.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:u()(i()().mark((function e(){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xe){e.next=3;break}return we("robot.permission.delete.denied","无权限：删除机器人"),e.abrupt("return");case 3:return x.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=4,e.next=7,(0,y.gf)(t);case 7:a=e.sent,x.yw.destroy(),200===(null==a?void 0:a.code)?(x.yw.success(R.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=O.current)||void 0===n||n.reload()):x.yw.error((null==a?void 0:a.message)||"Delete failed"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),x.yw.destroy(),x.yw.error("Delete error");case 16:case"end":return e.stop()}}),e,null,[[4,12]])}))),okText:R.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:R.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,E.jsx)("a",{children:R.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),a}},{title:R.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(v.Z,{columns:ke,actionRef:O,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:j.f4h}},toolBarRender:function(){var e=[];return Me&&e.push((0,E.jsx)(b.ZP,{type:"primary",onClick:function(){Me?(_(null),V(!0)):we("robot.permission.create.denied","无权限：创建机器人")},children:R.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")),e},request:function(){var e=u()(i()().mark((function e(t,a){var n,s,l,o,d,u,c,g,p,v,m,h,M,b,x,w,k,S,I,C,Z,T,U,E;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(he){e.next=3;break}return ye.current||(ye.current=!0,we("robot.permission.read.denied","无权限：查看机器人")),e.abrupt("return",{data:[],total:0,success:!1});case 3:return d=(null!==(n=null==t?void 0:t.current)&&void 0!==n?n:1)-1,u=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,c=null!==(l=null==t?void 0:t.searchText)&&void 0!==l?l:"",g=null!==(o=null==t?void 0:t.type)&&void 0!==o?o:j.f4h,(m=Object.entries(a||{})).length>0&&(h=m[0],M=f()(h,2),b=M[0],(x=M[1])&&(p=b,v="ascend"===x?"ascend":"descend")),w=r()(r()({pageNumber:d,pageSize:u,categoryUid:"",level:j.whQ,type:g,orgUid:null==K?void 0:K.uid,searchText:c,superUser:P},p?{sortBy:p}:{}),v?{sortDirection:v}:{}),e.prev=10,e.next=13,(0,y.p0)(w);case 13:if(k=e.sent,console.log("RobotTable queryRobotsByOrg response:",k,w),200!==(null==k?void 0:k.code)){e.next=19;break}return U=(null==k||null===(S=k.data)||void 0===S?void 0:S.content)||[],E=null!==(I=null!==(C=null==k||null===(Z=k.data)||void 0===Z?void 0:Z.totalElements)&&void 0!==C?C:null==k||null===(T=k.data)||void 0===T?void 0:T.numberOfElements)&&void 0!==I?I:U.length,e.abrupt("return",{data:U,total:E,success:!0});case 19:return e.abrupt("return",{data:[],total:0,success:!1});case 22:return e.prev=22,e.t0=e.catch(10),e.abrupt("return",{data:[],total:0,success:!1});case 25:case"end":return e.stop()}}),e,null,[[10,22]])})));return function(t,a){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:R.formatMessage({id:"robot",defaultMessage:"Robot"})}),B&&(0,E.jsx)(C.Z,{open:B,record:H,onClose:function(){return N(!1)},onSuccess:function(){var e;return null===(e=O.current)||void 0===e?void 0:e.reload()}}),L&&(0,E.jsx)(Z.Z,{open:L,onClose:function(){return V(!1)},onSubmit:function(){var e=u()(i()().mark((function e(t){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Me){e.next=3;break}return we("robot.permission.create.denied","无权限：创建机器人"),e.abrupt("return");case 3:return x.yw.loading(R.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=4,e.next=7,(0,y.lg)(t);case 7:a=e.sent,x.yw.destroy(),200===(null==a?void 0:a.code)?(x.yw.success(R.formatMessage({id:"create.success",defaultMessage:"Create success"})),V(!1),null===(n=O.current)||void 0===n||n.reload()):x.yw.error((null==a?void 0:a.message)||R.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),x.yw.destroy(),x.yw.error(R.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()}),(0,E.jsx)(A,{open:X,record:le,value:ae,onClose:function(){return $(!1)},onSaved:function(){var e;$(!1),oe(null),null===(e=O.current)||void 0===e||e.reload()}})]})}}}]);