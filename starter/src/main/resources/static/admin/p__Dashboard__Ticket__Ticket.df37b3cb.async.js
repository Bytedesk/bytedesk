"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[987],{59908:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(11757),i=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=r(54183),s=function(e,t){return i.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var u=i.forwardRef(s)},32350:function(e,t,r){var n=r(17082),i=r(73457),a=r(44194),o=r(87413),s=r(31549),u=["fieldProps","proFieldProps"],c=function(e,t){var r=e.fieldProps,a=e.proFieldProps,c=(0,i.Z)(e,u);return(0,s.jsx)(o.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:a},c))};t.Z=a.forwardRef(c)},72614:function(e,t,r){r.d(t,{W5:function(){return v},n1:function(){return m},p0:function(){return f},u7:function(){return d},zl:function(){return y}});var n=r(90819),i=r.n(n),a=r(73193),o=r.n(a),s=r(89933),u=r.n(s),c=r(55735),l=r(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/query/org",{method:"GET",params:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/create",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/update",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/update/avatar",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return k.apply(this,arguments)}function k(){return(k=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/delete",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17220:function(e,t,r){r(44194);var n=r(75365),i=r(54881),a=r(30921),o=r(31549);t.Z=function(e){var t,r,s=e.file,u=e.onDelete,c=e.showDelete,l=void 0===c||c,d=(0,a.useIntl)();return(0,o.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:d.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[l&&(0,o.jsx)(n.ZP,{type:"text",size:"small",icon:(0,o.jsx)(i.Z,{}),onClick:function(){return u(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,o.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(r=s.fileType)&&void 0!==r&&r.startsWith("image/")?(0,o.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,o.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,o.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,r){var n=r(76711),i=r.n(n),a=r(73193),o=r.n(a),s=r(45332),u=r.n(s),c=r(44194),l=r(42085),d=r(30348),p=r(53530),f=r(28977),g=r.n(f),v=r(55735),h=r(86803),m=r(44521),x=r(17220),y=r(30921),k=r(6397),w=r(31549),b=d.Z.Dragger;t.Z=function(e){var t=e.type,r=(e.acceptType,e.isModalOpen),n=e.attachments,a=e.handleSubmit,s=e.handleCancel,d=(0,y.useIntl)(),f=(0,k.j)((function(e){return e.currentKbase})),j=(0,c.useState)([]),M=u()(j,2),S=M[0],Z=M[1],T=(0,c.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==f?void 0:f.uid,client:v.bVn}),F=u()(T,2),I=F[0],C=F[1];(0,c.useEffect)((function(){console.log("UploadDrag currentKbase",f),f&&C((function(e){return o()(o()({},e),{},{kb_uid:null==f?void 0:f.uid})}))}),[f]);var U=(0,c.useMemo)((function(){return{name:"file",multiple:!0,action:(0,m.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(v.LA8)},data:I,showUploadList:!1,beforeUpload:function(e){var t=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return C((function(r){return o()(o()({},r),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&h.yw.loading(d.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(h.yw.destroy(),h.yw.success(d.formatMessage({id:"upload.success"},{filename:e.file.name})),Z((function(t){return[].concat(i()(t),[e.file.response.data])}))):(h.yw.destroy(),h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[I,d]);(0,c.useEffect)((function(){C((function(e){return o()(o()({},e),{},{kb_type:t,category_uid:""})})),n&&Z(n.map((function(e){return e.upload})))}),[t]);var q=function(e){console.log("handleDelete",e),Z((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,w.jsxs)(p.Z,{title:d.formatMessage({id:"upload.modal.title"}),open:r,onOk:function(){a(S)},onCancel:s,children:[(0,w.jsxs)(b,o()(o()({},U),{},{children:[(0,w.jsx)("p",{className:"ant-upload-drag-icon",children:(0,w.jsx)(l.Z,{})}),(0,w.jsx)("p",{className:"ant-upload-text",children:d.formatMessage({id:"upload.drag.text"})}),(0,w.jsx)("p",{className:"ant-upload-hint",children:d.formatMessage({id:"upload.drag.hint"})})]})),(0,w.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:S.map((function(e){return(0,w.jsx)(x.Z,{file:e,onDelete:q},e.uid)}))})})]})}},21041:function(e,t,r){r.r(t),r.d(t,{default:function(){return he}});var n=r(75574),i=r(73193),a=r.n(i),o=r(84176),s=r.n(o),u=r(10154),c=r.n(u),l=r(90819),d=r.n(l),p=r(89933),f=r.n(p),g=r(45332),v=r.n(g),h=r(86803),m=r(55735),x=r(30921);function y(e){return k.apply(this,arguments)}function k(){return(k=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/query/org",{method:"GET",params:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/update",{method:"POST",data:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return M.apply(this,arguments)}function M(){return(M=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/delete",{method:"POST",data:{uid:t,client:m.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/history/process",{method:"GET",params:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return F.apply(this,arguments)}function F(){return(F=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/history/task",{method:"GET",params:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return C.apply(this,arguments)}function C(){return(C=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/history/activity",{method:"GET",params:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=r(40612),q=r(90838),z=r(32045),P=r(76750),V=r(11090),E=r(81947),O=r(53530),_=r(29266),D=r(75365),N=r(28977),A=r.n(N),H=r(44194),Y=r(76711),B=r.n(Y),L=r(16309),W=r(73442),R=r(3849),G=r(72614),X=r(6807),J=r(4499),K=r(32350),Q=r(84881),$=r(17220),ee=r(27650),te=r(59908),re=r(31549),ne=function(e){var t=e.open,r=e.isEdit,n=e.ticket,i=e.onClose,a=e.onSuccess,o=L.Z.useForm(),s=v()(o,1)[0],u=(0,x.useIntl)(),c=(0,P.Z)().translateString,l=(0,U.u)((function(e){return e.currentOrg})),p=(0,H.useState)([]),g=v()(p,2),y=g[0],k=g[1],b=(0,H.useState)([]),j=v()(b,2),M=j[0],S=j[1],Z=(0,H.useState)([]),T=v()(Z,2),F=T[0],I=T[1],C=(0,H.useState)(!1),q=v()(C,2),V=q[0],E=q[1],O=(0,H.useState)([]),_=v()(O,2),N=_[0],A=_[1],Y=[{value:m.sM_,label:u.formatMessage({id:"ticket.status.new"})},{value:m.sFW,label:u.formatMessage({id:"ticket.status.claimed"})},{value:m.z1,label:u.formatMessage({id:"ticket.status.processing"})},{value:m.pIN,label:u.formatMessage({id:"ticket.status.pending"})},{value:m.XrC,label:u.formatMessage({id:"ticket.status.holding"})},{value:m.yib,label:u.formatMessage({id:"ticket.status.reopened"})},{value:m.hwr,label:u.formatMessage({id:"ticket.status.resolved"})},{value:m.frw,label:u.formatMessage({id:"ticket.status.closed"})},{value:m.xw4,label:u.formatMessage({id:"ticket.status.cancelled"})}],ne=[{value:m.JTO,label:u.formatMessage({id:"ticket.priority.lowest"})},{value:m.sbT,label:u.formatMessage({id:"ticket.priority.low"})},{value:m.GMZ,label:u.formatMessage({id:"ticket.priority.medium"})},{value:m.Bt2,label:u.formatMessage({id:"ticket.priority.high"})},{value:m._Xr,label:u.formatMessage({id:"ticket.priority.urgent"})},{value:m.Lx6,label:u.formatMessage({id:"ticket.priority.critical"})}],ie=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,z.XS)({type:m.hcJ,orgUid:null==l?void 0:l.uid,pageNumber:0,pageSize:100});case 3:200===(r=e.sent).code&&null!==(t=r.data)&&void 0!==t&&t.content&&k(r.data.content),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Fetch categories error:",e.t0),h.yw.error(u.formatMessage({id:"ticket.category.load.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==l?void 0:l.uid},e.next=3,(0,G.u7)(t);case 3:200===(r=e.sent).code?(S(r.data.content),I(r.data.content.reduce((function(e,t){var r;return null===(r=t.agents)||void 0===r||r.forEach((function(t){e.find((function(e){return e.uid===t.uid}))||e.push(t)})),e}),[]))):h.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,H.useEffect)((function(){t&&(ae(),ie())}),[t]);var oe=y.filter((function(e){return e.uid!==m.zBg})),se=function(){var e=f()(d()().mark((function e(){var t,r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.validateFields();case 3:return t=e.sent,h.yw.loading(u.formatMessage({id:"updating"})),r={uid:null==n?void 0:n.uid,title:null==t?void 0:t.title,description:null==t?void 0:t.description,categoryUid:null==t?void 0:t.categoryUid,workgroupUid:null==t?void 0:t.workgroupUid,assigneeUid:null==t?void 0:t.assigneeUid,status:null==t?void 0:t.status,priority:null==t?void 0:t.priority,uploadUids:N.map((function(e){return e.uid}))},console.log("updateTicket request",r),e.next=9,w(r);case 9:o=e.sent,console.log("updateTicket response",o),200===o.code?(h.yw.success(u.formatMessage({id:"update.success"})),a(),i()):h.yw.error(o.message),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Update failed:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}();H.useEffect((function(){var e,r,i;t&&n&&(s.setFieldsValue({title:null==n?void 0:n.title,description:null==n?void 0:n.description,status:null==n?void 0:n.status,priority:null==n?void 0:n.priority,categoryUid:null==n?void 0:n.categoryUid,workgroupUid:null==n||null===(e=n.workgroup)||void 0===e?void 0:e.uid,assigneeUid:null==n||null===(r=n.assignee)||void 0===r?void 0:r.uid}),A(null==n||null===(i=n.attachments)||void 0===i?void 0:i.map((function(e){return e.upload}))))}),[t,n]);var ue=function(e){console.log("handleDelete",e),A((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,re.jsx)(W.Z,{title:u.formatMessage({id:"ticket.edit.title"}),width:600,open:t,onClose:i,extra:(0,re.jsxs)(R.Z,{children:[(0,re.jsx)(D.ZP,{onClick:i,children:(0,re.jsx)(x.FormattedMessage,{id:"cancel"})}),(0,re.jsx)(D.ZP,{type:"primary",onClick:se,children:(0,re.jsx)(x.FormattedMessage,{id:"save"})})]}),children:(0,re.jsxs)(X.ZP,{form:s,submitter:!1,layout:"vertical",children:[(0,re.jsx)(J.Z,{name:"title",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.title"}),rules:[{required:!0}]}),(0,re.jsx)(K.Z,{name:"description",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.description"}),rules:[{required:!0}]}),(0,re.jsx)(Q.Z,{name:"categoryUid",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.category"}),rules:[{required:!0}],options:oe.map((function(e){return{label:c(e.name),value:e.uid}}))}),(0,re.jsx)(Q.Z,{name:"workgroupUid",label:u.formatMessage({id:"ticket.workgroup"}),rules:[{required:!0}],options:M.map((function(e){return{label:c(e.nickname),value:e.uid}})),placeholder:u.formatMessage({id:"ticket.workgroup.placeholder"}),onChange:function(e){var t=M.find((function(t){return t.uid===e}));null!=t&&t.agents?(I(t.agents),s.setFieldValue("assigneeUid",void 0)):I([])}}),(0,re.jsx)(Q.Z,{name:"assigneeUid",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),options:F.map((function(e){return{label:e.nickname,value:e.uid}}))}),(0,re.jsx)(Q.Z,{name:"status",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.status"}),rules:[{required:!0}],options:Y}),(0,re.jsx)(Q.Z,{name:"priority",label:(0,re.jsx)(x.FormattedMessage,{id:"ticket.priority"}),rules:[{required:!0}],options:ne}),V&&(0,re.jsx)(ee.Z,{type:m.hcJ,isModalOpen:V,attachments:null==n?void 0:n.attachments,handleSubmit:function(e){console.log("handleSubmit",e),A(r&&n?e:function(t){return[].concat(B()(t),B()(e))}),E(!1)},handleCancel:function(){E(!1)}}),(0,re.jsx)("div",{style:{marginTop:"16px",marginBottom:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,re.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:N.map((function(e){return(0,re.jsx)($.Z,{file:e,onDelete:ue},e.uid)}))})}),(0,re.jsx)(D.ZP,{icon:(0,re.jsx)(te.Z,{}),onClick:function(){return E(!0)},children:u.formatMessage({id:"ticket.upload.button"})})]})})},ie=r(44521),ae=r(80601),oe=r(51004),se=r(73589),ue=function(e){var t=e.ticket,r=e.isThreadTicket,n=void 0!==r&&r,i=(0,U.u)((function(e){return e.currentOrg})),a=(0,H.useState)([]),o=v()(a,2),s=(o[0],o[1]),u=(0,H.useState)([]),c=v()(u,2),l=(c[0],c[1]),p=(0,H.useState)([]),g=v()(p,2),y=g[0],k=g[1],w=(0,H.useState)(!1),b=v()(w,2),j=b[0],M=b[1],Z=(0,x.useIntl)();console.log("currentTicket",t,j);var F=function(){var e=f()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),r={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid,processInstanceId:null==t?void 0:t.processInstanceId,orgUid:null==i?void 0:i.uid},e.next=7,S(r);case 7:n=e.sent,console.log("queryTicketHistoryProcess response:",n.data),200===n.code?s(n.data||[]):(console.log("queryTicketHistoryTask error:",n.data),h.yw.error(n.message)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fetch ticket history error:",e.t0),h.yw.error("获取工单历史记录失败");case 16:return e.prev=16,M(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=f()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),r={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid,processInstanceId:null==t?void 0:t.processInstanceId,orgUid:null==i?void 0:i.uid},e.next=7,T(r);case 7:n=e.sent,console.log("queryTicketHistoryTask response:",n.data),200===n.code?l(n.data||[]):(console.log("queryTicketHistoryTask error:",n.data),h.yw.error(n.message)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fetch ticket history error:",e.t0),h.yw.error("获取工单历史记录失败");case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=f()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),r={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid},e.next=7,I(r);case 7:n=e.sent,console.log("queryTicketHistoryActivity response:",n.data),200===n.code?k(n.data||[]):(console.log("queryTicketHistoryActivity error:",n.data),h.yw.error(n.message)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fetch ticket history error:",e.t0),h.yw.error("获取工单历史记录失败");case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}();(0,H.useEffect)((function(){n||(F(),C(),q())}),[t]);var z=function(e){return e?e===m.sM_||e===m.sFW||e===m.W66||e===m.z1||e===m.pIN||e===m.XrC||e===m.L1h||e===m.yib||e===m.hwr||e===m.AzB||e===m.frw||e===m.xw4?Z.formatMessage({id:"ticket.status.".concat(e.toLowerCase())}):e:""};return(0,re.jsx)(re.Fragment,{children:(0,re.jsxs)(ae.Z,{spinning:j,children:[(0,re.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center"},children:"活动历史"}),(0,re.jsx)(oe.Z,{direction:"vertical",size:"small",current:y.length-1,style:{padding:"16px"},items:y.map((function(e,t){var r;return{title:z(null==e?void 0:e.activityName)||"活动",description:(0,re.jsxs)("div",{children:[(0,re.jsxs)("div",{children:["处理人: ",(null==e?void 0:e.assignee)||"未分配"]}),(0,re.jsxs)("div",{children:["处理时间: ",(null===(r=e.startTime)||void 0===r?void 0:r.toLocaleString())||"未分配"]})]}),status:t===y.length-1?"process":"finish"}}))}),0===y.length&&(0,re.jsx)(se.Z,{description:"请选择工单查看流转过程"})]})})},ce=function(e){var t=e.open,r=e.ticket,n=e.onClose;return(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(W.Z,{open:t,onClose:function(){n()},title:"工单详情",children:(0,re.jsx)(ue,{ticket:r,isThreadTicket:!1})})})},le=["current","pageSize"],de=function(){var e=(0,x.useIntl)(),t=(0,H.useRef)(),r=(0,H.useState)(1),n=v()(r,2),i=n[0],o=n[1],u=(0,H.useState)(10),l=v()(u,2),p=l[0],g=l[1],k=(0,U.u)((function(e){return e.currentOrg})),w=(0,P.Z)().translateString,b=(0,q.v)().setCategoryResult,M=(0,q.v)((function(e){return e.currentCategory})),S=(0,H.useState)(!1),Z=v()(S,2),T=Z[0],F=Z[1],I=(0,H.useState)(),C=v()(I,2),N=C[0],Y=C[1],B=(0,H.useState)(!1),L=v()(B,2),W=L[0],R=L[1],G=O.Z.useModal(),X=v()(G,2),J=X[0],K=X[1],Q=(0,H.useState)(!1),$=v()(Q,2),ee=$[0],te=$[1],ae=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,type:m.hcJ,orgUid:null==k?void 0:k.uid},e.next=3,(0,z.XS)(t);case 3:200===(r=e.sent).code?b(r):h.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,H.useEffect)((function(){ae()}),[]);var oe=(0,q.v)((function(e){return e.categoryResult.data.content}));(0,H.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reload()}),[null==M?void 0:M.uid]);var se=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.title"}),dataIndex:"title",copyable:!0,ellipsis:!0},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.description"}),dataIndex:"description",ellipsis:!0},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.status"}),dataIndex:"status",hideInSearch:!0,render:function(e,t){var r=c()(c()(c()(c()(c()(c()(c()(c()(c()({},m.sM_,"blue"),m.sFW,"cyan"),m.z1,"processing"),m.pIN,"warning"),m.XrC,"orange"),m.yib,"volcano"),m.hwr,"success"),m.frw,"default"),m.xw4,"error");return(0,re.jsx)(_.Z,{color:r[t.status],children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.status.".concat(t.status.toLowerCase())})})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.priority"}),dataIndex:"priority",hideInSearch:!0,render:function(e,t){var r,n=c()(c()(c()(c()(c()(c()({},m.JTO,"default"),m.sbT,"blue"),m.GMZ,"orange"),m.Bt2,"volcano"),m._Xr,"red"),m.Lx6,"purple");return(0,re.jsx)(_.Z,{color:n[null==t?void 0:t.priority],children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.priority.".concat(null==t||null===(r=t.priority)||void 0===r?void 0:r.toLowerCase())})})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),dataIndex:"assignee",hideInSearch:!0,render:function(e,t,r,n){var i;return(0,re.jsx)(_.Z,{color:"blue",children:null==t||null===(i=t.assignee)||void 0===i?void 0:i.nickname})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.reporter"}),dataIndex:"reporter",hideInSearch:!0,render:function(e,t,r,n){var i;return(0,re.jsx)(_.Z,{color:"red",children:null==t||null===(i=t.reporter)||void 0===i?void 0:i.nickname})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"ticket.category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(t,r){var n=oe.find((function(e){return e.uid===r.categoryUid}));return n?(0,re.jsx)(_.Z,{color:"green",children:w(n.name)}):(0,re.jsx)(_.Z,{color:"default",children:e.formatMessage({id:"uncategorized",defaultMessage:"Uncategorized"})})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"createdAt"}),dataIndex:"createdAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,r,n){return A()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,re.jsx)(x.FormattedMessage,{id:"updatedAt"}),dataIndex:"updatedAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,r,n){return A()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,re.jsx)(x.FormattedMessage,{id:"action"}),key:"option",dataIndex:"option",hideInSearch:!0,width:200,render:function(e,r){return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(D.ZP,{type:"link",onClick:function(){return Y(r),F(!0),void R(!0)},children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.action.edit"})}),(0,re.jsx)(D.ZP,{type:"link",onClick:function(){return e=r,console.log("handleViewTicket",e),Y(e),void te(!0);var e},children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.action.view"})}),(0,re.jsx)(D.ZP,{type:"link",onClick:function(){return e=r,console.log("handleDeleteTicket",e),void J.confirm({title:"确定要删除该工单吗？",onOk:(n=f()(d()().mark((function r(){var n,i;return d()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("onOk"),r.next=3,j(e.uid);case 3:n=r.sent,console.log("deleteTicket response:",n),200===n.code?(h.yw.success(n.message),null===(i=t.current)||void 0===i||i.reload()):h.yw.error(n.message);case 6:case"end":return r.stop()}}),r)}))),function(){return n.apply(this,arguments)})});var e,n},children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.action.delete"})})]})}}],ue=function(){var e=f()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,p),t=localStorage.getItem(m.LA8),window.open((0,ie.kG)()+"/api/v1/ticket/export?"+new URLSearchParams({orgUid:(null==k?void 0:k.uid)||"",pageNumber:String(i-1),pageSize:String(p),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(E.Z,{columns:se,actionRef:t,cardBordered:!0,columnsState:{defaultValue:{description:{show:!1},createdAt:{show:!1},reporter:{show:!1}},persistenceKey:"ticket-table-columns",persistenceType:"localStorage"},request:function(){var e=f()(d()().mark((function e(t,r,n){var i,u,c,l,p;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.current,u=t.pageSize,c=s()(t,le),o(i),g(u),l=a()(a()({pageNumber:i-1,pageSize:u,orgUid:null==k?void 0:k.uid},(null==M?void 0:M.uid)!==m.zBg&&{categoryUid:null==M?void 0:M.uid}),c),e.next=6,y(l);case 6:return p=e.sent,console.log("queryTicketsByOrgUid response:",p,l),200===p.code||h.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"ticket.list"}),toolBarRender:function(){return[(0,re.jsx)(D.ZP,{type:"primary",onClick:function(){return window.open((0,ie.rl)())},children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.action.open.flow.editor"})}),(0,re.jsx)(D.ZP,{icon:(0,re.jsx)(V.Z,{}),type:"primary",onClick:ue,children:(0,re.jsx)(x.FormattedMessage,{id:"ticket.action.export"})},"button")]}}),T&&(0,re.jsx)(ne,{open:T,isEdit:W,ticket:N,onClose:function(){F(!1),Y(void 0),R(!1)},onSuccess:function(){var e;null===(e=t.current)||void 0===e||e.reload()}}),ee&&(0,re.jsx)(ce,{open:ee,ticket:N,onClose:function(){return te(!1)}}),K]})},pe=r(95160),fe=r(96865),ge=n.Z.Sider,ve=n.Z.Content,he=function(){var e=(0,fe.Z)(),t=e.leftSiderStyle,r=e.contentStyle;return(0,re.jsx)(re.Fragment,{children:(0,re.jsxs)(n.Z,{children:[(0,re.jsx)(ge,{style:t,width:250,children:(0,re.jsx)(pe.Z,{type:m.FXY})}),(0,re.jsx)(n.Z,{children:(0,re.jsx)(ve,{style:r,children:(0,re.jsx)(de,{})})})]})})}}}]);