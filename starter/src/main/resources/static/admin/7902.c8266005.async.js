"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7902],{57902:function(e,l,t){t.d(l,{Z:function(){return ne}});var n=t(73193),a=t.n(n),r=t(10154),o=t.n(r),i=t(90819),s=t.n(i),d=t(89933),u=t.n(d),c=t(45332),p=t.n(c),v=t(44194),m=t(5861),f=t(31362),g=t(44423),h=t(96082),b=t(44877),x=t(2157),M=t(5286),y=t(96845),k=t(28485),w=t(3771),S=t(71865),j=t(36265),T=t(99279),C=t(44565),E=t(60857),P=t(40845),I=t(13437),Z=t(2685),U=t(94433),K=t(38956),L=t(85973),R=t(31549),W=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],A=v.forwardRef((function(e,l){var t=e.fieldProps,n=e.proFieldProps,a=e.min,r=e.max,o=e.step,i=e.marks,s=e.vertical,d=e.range,u=(0,K.Z)(e,W);return(0,R.jsx)(L.Z,(0,U.Z)({valueType:"slider",fieldProps:(0,U.Z)((0,U.Z)({},t),{},{min:a,max:r,step:o,marks:i,vertical:s,range:d,style:null==t?void 0:t.style}),ref:l,proFieldProps:n,filedConfig:{ignoreWidth:!0}},u))})),F=t(14592),N=t(12038),D=t(37351),O=t(76185),z=t(15384),Q=t(63642),B=t(22060),V=t(98162),q=t(6992),G=t(22014),H=t(59878),_=t(81621),J=D.Z.Text,$=function(e){var l=e.value,t=e.onChange,n=e.options,a=e.loading,r=e.placeholder,o=e.emptyContent,i=e.onSearch,s=e.onDropdownOpen,d=e.onCreate,u=e.createLabel,c=e.createTitle;return(0,R.jsxs)(O.Z.Compact,{block:!0,children:[(0,R.jsx)(z.Z,{value:l,onChange:function(e){return null==t?void 0:t(e)},options:n,showSearch:!0,filterOption:!1,placeholder:r,loading:a,allowClear:!0,style:{flex:1},notFoundContent:o,onSearch:i,onOpenChange:function(e){e&&s()}}),(0,R.jsx)(x.ZP,{size:"small",icon:(0,R.jsx)(q.Z,{}),onClick:d,title:c,children:u})]})},X=function(e){var l,t,n,r,i,d,c,f,h,b,U,K,L,W,D,O,z,X,Y,ee,le,te,ne,ae,re,oe,ie=e.open,se=e.record,de=e.onClose,ue=e.onSuccess,ce=(0,m.useIntl)(),pe=(0,S.u)((function(e){return e.currentOrg})),ve=(0,v.useMemo)((function(){return!(null==se||!se.uid)}),[se]),me=(0,v.useState)(!1),fe=p()(me,2),ge=fe[0],he=fe[1],be=(0,v.useState)([]),xe=p()(be,2),Me=xe[0],ye=xe[1],ke=(0,v.useState)(!1),we=p()(ke,2),Se=we[0],je=we[1],Te=(0,v.useRef)(),Ce=(0,v.useState)((null==se?void 0:se.avatar)||""),Ee=p()(Ce,2),Pe=Ee[0],Ie=Ee[1],Ze=(0,v.useState)((null==se?void 0:se.type)||j.f4h),Ue=p()(Ze,2),Ke=Ue[0],Le=Ue[1],Re=(0,v.useState)((null==se?void 0:se.system)||!1),We=p()(Re,2),Ae=(We[0],We[1]),Fe=(0,v.useState)([]),Ne=p()(Fe,2),De=Ne[0],Oe=Ne[1],ze=(0,v.useState)({}),Qe=p()(ze,2),Be=Qe[0],Ve=Qe[1],qe=(0,v.useState)(!1),Ge=p()(qe,2),He=Ge[0],_e=Ge[1],Je=(0,v.useState)(""),$e=p()(Je,2),Xe=$e[0],Ye=$e[1],el=(0,v.useState)(""),ll=p()(el,2),tl=ll[0],nl=ll[1],al=(0,v.useState)(""),rl=p()(al,2),ol=rl[0],il=rl[1],sl=(0,v.useState)(""),dl=p()(sl,2),ul=dl[0],cl=dl[1],pl=(0,v.useState)(!(null==se||null===(l=se.llm)||void 0===l||!l.enabled)),vl=p()(pl,2),ml=vl[0],fl=vl[1],gl=(0,v.useState)(!(null==se||!se.kbEnabled)),hl=p()(gl,2),bl=hl[0],xl=hl[1],Ml=(0,v.useState)(!(null==se||null===(t=se.llm)||void 0===t||!t.useLlmWhenKbEmpty)),yl=p()(Ml,2),kl=yl[0],wl=yl[1],Sl=(0,v.useState)(!1),jl=p()(Sl,2),Tl=jl[0],Cl=jl[1],El=(0,v.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),Pl=(0,v.useCallback)((function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(l):"-"}),[]),Il=(0,v.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),Zl=(0,v.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),Ul=(0,v.useState)(null==se||null===(n=se.llm)||void 0===n?void 0:n.temperature),Kl=p()(Ul,2),Ll=Kl[0],Rl=Kl[1],Wl=(0,v.useState)(El(null==se||null===(r=se.llm)||void 0===r?void 0:r.topP)),Al=p()(Wl,2),Fl=Al[0],Nl=Al[1],Dl=(0,v.useState)(null==se||null===(i=se.llm)||void 0===i?void 0:i.topK),Ol=p()(Dl,2),zl=Ol[0],Ql=Ol[1],Bl=(0,v.useState)(El(null==se||null===(d=se.llm)||void 0===d?void 0:d.scoreThreshold)),Vl=p()(Bl,2),ql=Vl[0],Gl=Vl[1],Hl=(0,v.useState)(null==se||null===(c=se.llm)||void 0===c?void 0:c.maxTokens),_l=p()(Hl,2),Jl=(_l[0],_l[1]),$l=(0,v.useState)(null==se||null===(f=se.llm)||void 0===f?void 0:f.contextMsgCount),Xl=p()($l,2),Yl=(Xl[0],Xl[1]),et=(0,v.useCallback)(function(){var e=u()(s()().mark((function e(l){var t,n,a,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(je(!0),e.prev=1,null!=pe&&pe.uid){e.next=5;break}return ye([]),e.abrupt("return",[]);case 5:return n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==pe?void 0:pe.uid,searchText:l||""},e.next=8,(0,F.VW)(n);case 8:return a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],ye(r),e.abrupt("return",r);case 12:return e.prev=12,je(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(l){return e.apply(this,arguments)}}(),[null==pe?void 0:pe.uid]);(0,v.useEffect)((function(){var e,l,t,n,a,r,o,i,s,d,u,c,p,v,m,f,g,h,b,x,M,y,k,w,S,T,C,E;if(ie){var P,I,Z;if(Ie((null==se?void 0:se.avatar)||""),Le((null==se?void 0:se.type)||j.f4h),Ae((null==se?void 0:se.system)||!1),fl(!(null==se||null===(e=se.llm)||void 0===e||!e.enabled)),xl(!(null==se||!se.kbEnabled)),wl(!(null==se||null===(l=se.llm)||void 0===l||!l.useLlmWhenKbEmpty)),null===(t=Te.current)||void 0===t||t.setFieldsValue({nickname:null==se?void 0:se.nickname,type:null==se?void 0:se.type,settingsUid:null==se||null===(n=se.settings)||void 0===n?void 0:n.uid,name:null==se?void 0:se.name,categoryUid:null==se?void 0:se.categoryUid,provider:null==se||null===(a=se.llm)||void 0===a?void 0:a.textProvider,model:null==se||null===(r=se.llm)||void 0===r?void 0:r.textModel,prompt:null==se||null===(o=se.llm)||void 0===o?void 0:o.prompt,description:null==se?void 0:se.description,enabled:null==se||null===(i=se.llm)||void 0===i?void 0:i.enabled,enableThinking:null==se||null===(s=se.llm)||void 0===s?void 0:s.enableThinking,enableStreaming:null==se||null===(d=se.llm)||void 0===d?void 0:d.enableStreaming,useLlmWhenKbEmpty:null==se||null===(u=se.llm)||void 0===u?void 0:u.useLlmWhenKbEmpty,temperature:Zl(null==se||null===(c=se.llm)||void 0===c?void 0:c.temperature),topP:El(null==se||null===(p=se.llm)||void 0===p?void 0:p.topP),topK:null==se||null===(v=se.llm)||void 0===v?void 0:v.topK,scoreThreshold:El(null==se||null===(m=se.llm)||void 0===m?void 0:m.scoreThreshold),maxTokens:null==se||null===(f=se.llm)||void 0===f?void 0:f.maxTokens,contextMsgCount:null==se||null===(g=se.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==se||null===(h=se.llm)||void 0===h?void 0:h.defaultReply,searchType:(null==se||null===(b=se.llm)||void 0===b?void 0:b.searchType)||j.rk3,kbSourceEnabled:null==se?void 0:se.kbSourceEnabled,kbEnabled:null==se?void 0:se.kbEnabled,kbUid:null==se?void 0:se.kbUid}),null!=se&&se.llm&&(null!=se&&null!==(x=se.llm)&&void 0!==x&&x.textProviderUid||null!=se&&null!==(M=se.llm)&&void 0!==M&&M.textProvider||null!=se&&null!==(y=se.llm)&&void 0!==y&&y.textModel))Ye((null==se||null===(P=se.llm)||void 0===P?void 0:P.textProvider)||""),nl((null==se||null===(I=se.llm)||void 0===I?void 0:I.textProviderUid)||""),il((null==se||null===(Z=se.llm)||void 0===Z?void 0:Z.textModel)||"");else Ye(""),nl(""),il("");Rl(Zl(null==se||null===(k=se.llm)||void 0===k?void 0:k.temperature)),Nl(El(null==se||null===(w=se.llm)||void 0===w?void 0:w.topP)),Ql(null==se||null===(S=se.llm)||void 0===S?void 0:S.topK),Gl(El(null==se||null===(T=se.llm)||void 0===T?void 0:T.scoreThreshold)),Jl(null==se||null===(C=se.llm)||void 0===C?void 0:C.maxTokens),Yl(null==se||null===(E=se.llm)||void 0===E?void 0:E.contextMsgCount),Cl(!1)}}),[ie,se]);var lt=function(){var e=u()(s()().mark((function e(l){var t,n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ie(l),!ve||!se){e.next=13;break}return e.prev=2,t={uid:null==se?void 0:se.uid,avatar:l},e.next=6,(0,y.lz)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?(M.yw.success(ce.formatMessage({id:"update.success",defaultMessage:"更新成功"})),null==ue||ue(n.data)):M.yw.error((null==n?void 0:n.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),M.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(l){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ie&&Ke===j.f4h&&et()}),[ie,Ke,et]);var tt=(0,v.useMemo)((function(){return Me.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[Me]),nt=(0,v.useRef)(),at=(0,v.useCallback)((function(e){nt.current&&clearTimeout(nt.current),nt.current=setTimeout((function(){et(e)}),300)}),[et]);(0,v.useEffect)((function(){return function(){nt.current&&clearTimeout(nt.current)}}),[]);var rt=(0,v.useCallback)((function(){Me.length||et()}),[Me.length,et]),ot=(0,v.useCallback)(u()(s()().mark((function e(){var l,t,n,a,r,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==pe?void 0:pe.uid,level:j.whQ},e.next=4,(0,k.mK)(l);case 4:200===(null==(t=e.sent)?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],Oe(a),tl&&!Xe&&(r=a.find((function(e){return e.uid===tl})))&&Ye(r.type),!tl&&Xe&&(o=a.find((function(e){return e.type===Xe})))&&nl(o.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==pe?void 0:pe.uid,tl,Xe]);(0,v.useEffect)((function(){ie&&ot()}),[ie,ot]);var it=(0,v.useCallback)((function(){return _e(!0)}),[]),st=(0,v.useCallback)((function(){return _e(!1)}),[]),dt=(0,v.useCallback)((function(e,l){Ve((function(t){return a()(a()({},t),{},o()({},e,l))}))}),[]),ut=(0,v.useCallback)((function(e,l,t){var n,a,r,o=De.find((function(l){return l.uid===e})),i=o?o.type:e;Ye(i),nl(e),il(l),cl(t),null===(n=Te.current)||void 0===n||n.setFieldsValue({provider:i,model:l});var s=null===(a=Te.current)||void 0===a||null===(r=a.getFieldsValue)||void 0===r?void 0:r.call(a);if(s){var d,u,c,p,v,m,f,g,h,b,x,M,y,k,w,S,j,T,C,E,P,I,Z,U=(null==se?void 0:se.llm)||{},K=(null!==(d=s.prompt)&&void 0!==d?d:"")!==(null!==(u=U.prompt)&&void 0!==u?u:"")||(e||"")!==(null!==(c=U.textProviderUid)&&void 0!==c?c:"")||(i||s.provider||"")!==(null!==(p=U.textProvider)&&void 0!==p?p:"")||(l||s.model||"")!==(null!==(v=U.textModel)&&void 0!==v?v:"")||!!s.enabled!=!!U.enabled||!!s.enableThinking!=!!U.enableThinking||!!s.enableStreaming!=!!U.enableStreaming||!!s.useLlmWhenKbEmpty!=!!U.useLlmWhenKbEmpty||(null!==(m=s.temperature)&&void 0!==m?m:null)!==(null!==(f=U.temperature)&&void 0!==f?f:null)||(null!==(g=s.topP)&&void 0!==g?g:null)!==(null!==(h=U.topP)&&void 0!==h?h:null)||(null!==(b=s.topK)&&void 0!==b?b:null)!==(null!==(x=U.topK)&&void 0!==x?x:null)||(null!==(M=s.scoreThreshold)&&void 0!==M?M:null)!==(null!==(y=U.scoreThreshold)&&void 0!==y?y:null)||(null!==(k=s.maxTokens)&&void 0!==k?k:null)!==(null!==(w=U.maxTokens)&&void 0!==w?w:null)||(null!==(S=s.contextMsgCount)&&void 0!==S?S:null)!==(null!==(j=U.contextMsgCount)&&void 0!==j?j:null)||(null!==(T=s.defaultReply)&&void 0!==T?T:"")!==(null!==(C=U.defaultReply)&&void 0!==C?C:"")||(null!==(E=s.searchType)&&void 0!==E?E:"")!==(null!==(P=U.searchType)&&void 0!==P?P:""),L=!!s.kbEnabled!=!(null==se||!se.kbEnabled)||!!s.kbSourceEnabled!=!(null==se||!se.kbSourceEnabled)||(null!==(I=s.kbUid)&&void 0!==I?I:"")!==(null!==(Z=null==se?void 0:se.kbUid)&&void 0!==Z?Z:"");Cl(K||L)}_e(!1)}),[De]);return(0,R.jsxs)(T.a,{onValuesChange:function(e,l){var t,n,a,r,o,i,s,d,u,c,p,v,m,f,g,h,b,x,M,y,k,w,S,j=(null==se?void 0:se.llm)||{},T=(null!==(t=l.prompt)&&void 0!==t?t:"")!==(null!==(n=j.prompt)&&void 0!==n?n:"")||(tl||"")!==(null!==(a=j.textProviderUid)&&void 0!==a?a:"")||(Xe||l.provider||"")!==(null!==(r=j.textProvider)&&void 0!==r?r:"")||(ol||l.model||"")!==(null!==(o=j.textModel)&&void 0!==o?o:"")||!!l.enabled!=!!j.enabled||!!l.enableThinking!=!!j.enableThinking||!!l.enableStreaming!=!!j.enableStreaming||!!l.useLlmWhenKbEmpty!=!!j.useLlmWhenKbEmpty||(null!==(i=l.temperature)&&void 0!==i?i:null)!==(null!==(s=j.temperature)&&void 0!==s?s:null)||(null!==(d=l.topP)&&void 0!==d?d:null)!==(null!==(u=j.topP)&&void 0!==u?u:null)||(null!==(c=l.topK)&&void 0!==c?c:null)!==(null!==(p=j.topK)&&void 0!==p?p:null)||(null!==(v=l.scoreThreshold)&&void 0!==v?v:null)!==(null!==(m=j.scoreThreshold)&&void 0!==m?m:null)||(null!==(f=l.maxTokens)&&void 0!==f?f:null)!==(null!==(g=j.maxTokens)&&void 0!==g?g:null)||(null!==(h=l.contextMsgCount)&&void 0!==h?h:null)!==(null!==(b=j.contextMsgCount)&&void 0!==b?b:null)||(null!==(x=l.defaultReply)&&void 0!==x?x:"")!==(null!==(M=j.defaultReply)&&void 0!==M?M:"")||(null!==(y=l.searchType)&&void 0!==y?y:"")!==(null!==(k=j.searchType)&&void 0!==k?k:""),C=!!l.kbEnabled!=!(null==se||!se.kbEnabled)||!!l.kbSourceEnabled!=!(null==se||!se.kbSourceEnabled)||(null!==(w=l.kbUid)&&void 0!==w?w:"")!==(null!==(S=null==se?void 0:se.kbUid)&&void 0!==S?S:"");Cl(T||C)},open:ie,onOpenChange:function(e){e||de()},title:ce.formatMessage({id:"robot.edit",defaultMessage:"编辑机器人"}),width:560,formRef:Te,initialValues:ve?{nickname:null==se?void 0:se.nickname,type:null==se?void 0:se.type,settingsUid:null==se||null===(h=se.settings)||void 0===h?void 0:h.uid,name:null==se?void 0:se.name,categoryUid:null==se?void 0:se.categoryUid,provider:null==se||null===(b=se.llm)||void 0===b?void 0:b.textProvider,model:null==se||null===(U=se.llm)||void 0===U?void 0:U.textModel,prompt:null==se||null===(K=se.llm)||void 0===K?void 0:K.prompt,description:null==se?void 0:se.description,enabled:null==se||null===(L=se.llm)||void 0===L?void 0:L.enabled,enableThinking:null==se||null===(W=se.llm)||void 0===W?void 0:W.enableThinking,enableStreaming:null==se||null===(D=se.llm)||void 0===D?void 0:D.enableStreaming,useLlmWhenKbEmpty:null==se||null===(O=se.llm)||void 0===O?void 0:O.useLlmWhenKbEmpty,temperature:Zl(null==se||null===(z=se.llm)||void 0===z?void 0:z.temperature),topP:El(null==se||null===(X=se.llm)||void 0===X?void 0:X.topP),topK:null==se||null===(Y=se.llm)||void 0===Y?void 0:Y.topK,scoreThreshold:El(null==se||null===(ee=se.llm)||void 0===ee?void 0:ee.scoreThreshold),maxTokens:null==se||null===(le=se.llm)||void 0===le?void 0:le.maxTokens,contextMsgCount:null==se||null===(te=se.llm)||void 0===te?void 0:te.contextMsgCount,defaultReply:null==se||null===(ne=se.llm)||void 0===ne?void 0:ne.defaultReply,searchType:(null==se||null===(ae=se.llm)||void 0===ae?void 0:ae.searchType)||j.rk3,kbSourceEnabled:null==se?void 0:se.kbSourceEnabled,kbEnabled:null==se?void 0:se.kbEnabled,kbUid:null==se?void 0:se.kbUid}:{type:j.f4h,searchType:j.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,R.jsxs)("div",{children:[(0,R.jsx)(x.ZP,{style:{marginRight:8},onClick:function(){return de()},children:ce.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,R.jsx)(x.ZP,{type:"primary",onClick:function(){var e,l;return null===(e=Te.current)||void 0===e||null===(l=e.submit)||void 0===l?void 0:l.call(e)},children:ce.formatMessage({id:"save",defaultMessage:"保存"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=u()(s()().mark((function e(l){var t,n,a,r,o,i,d,u,c,p,v,m,f,g,h,b,x,k,w,S,T,C,E,P,I,Z,U,K,L,R,W,A;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,ve&&null!=se&&se.uid){e.next=4;break}return M.yw.warning(ce.formatMessage({id:"robot.edit.only",defaultMessage:"当前仅支持编辑，请通过新建入口创建机器人"})),e.abrupt("return",!1);case 4:return I=(null==se?void 0:se.llm)||{},Z=(null!==(t=l.prompt)&&void 0!==t?t:"")!==(null!==(n=I.prompt)&&void 0!==n?n:"")||(tl||"")!==(null!==(a=I.textProviderUid)&&void 0!==a?a:"")||(Xe||l.provider||"")!==(null!==(r=I.textProvider)&&void 0!==r?r:"")||(ol||l.model||"")!==(null!==(o=I.textModel)&&void 0!==o?o:"")||!!l.enabled!=!!I.enabled||!!l.enableThinking!=!!I.enableThinking||!!l.enableStreaming!=!!I.enableStreaming||!!l.useLlmWhenKbEmpty!=!!I.useLlmWhenKbEmpty||(null!==(i=l.temperature)&&void 0!==i?i:null)!==(null!==(d=I.temperature)&&void 0!==d?d:null)||(null!==(u=l.topP)&&void 0!==u?u:null)!==(null!==(c=I.topP)&&void 0!==c?c:null)||(null!==(p=l.topK)&&void 0!==p?p:null)!==(null!==(v=I.topK)&&void 0!==v?v:null)||(null!==(m=l.scoreThreshold)&&void 0!==m?m:null)!==(null!==(f=I.scoreThreshold)&&void 0!==f?f:null)||(null!==(g=l.maxTokens)&&void 0!==g?g:null)!==(null!==(h=I.maxTokens)&&void 0!==h?h:null)||(null!==(b=l.contextMsgCount)&&void 0!==b?b:null)!==(null!==(x=I.contextMsgCount)&&void 0!==x?x:null)||(null!==(k=l.defaultReply)&&void 0!==k?k:"")!==(null!==(w=I.defaultReply)&&void 0!==w?w:"")||(null!==(S=l.searchType)&&void 0!==S?S:"")!==(null!==(T=I.searchType)&&void 0!==T?T:""),U=!!l.kbEnabled!=!(null==se||!se.kbEnabled)||!!l.kbSourceEnabled!=!(null==se||!se.kbSourceEnabled)||(null!==(C=l.kbUid)&&void 0!==C?C:"")!==(null!==(E=null==se?void 0:se.kbUid)&&void 0!==E?E:""),K=Z||U,M.yw.loading(ce.formatMessage({id:ve?"updating":"creating",defaultMessage:ve?"Updating":"Creating"})),R={uid:null==se?void 0:se.uid,nickname:l.nickname,name:l.name,type:l.type||j.f4h,description:l.description,avatar:Pe,settingsUid:l.settingsUid,kbSourceEnabled:l.kbSourceEnabled,kbEnabled:l.kbEnabled,kbUid:l.kbUid,llm:{prompt:l.prompt,textProvider:Xe||l.provider,textProviderUid:tl||void 0,textModel:ol||l.model,enabled:l.enabled,enableThinking:l.enableThinking,enableStreaming:l.enableStreaming,useLlmWhenKbEmpty:l.useLlmWhenKbEmpty,temperature:Zl(l.temperature),topP:El(l.topP),topK:l.topK,scoreThreshold:El(l.scoreThreshold),maxTokens:l.maxTokens,contextMsgCount:l.contextMsgCount,defaultReply:l.defaultReply,searchType:l.searchType}},e.next=12,(0,y.$l)(R);case 12:if(L=e.sent,console.log("updateRobot:",L,R),M.yw.destroy(),200!==(null===(P=L)||void 0===P?void 0:P.code)){e.next=23;break}return M.yw.success(ce.formatMessage({id:"save.success",defaultMessage:"保存成功"})),K&&M.yw.info(ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),5),null==ue||ue(null===(W=L)||void 0===W?void 0:W.data),de(),e.abrupt("return",!0);case 23:return M.yw.error((null===(A=L)||void 0===A?void 0:A.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),M.yw.destroy(),M.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(l){return e.apply(this,arguments)}}(),children:[(0,R.jsx)(Q.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:ce.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"头像"}),children:(0,R.jsxs)(H.G,{onSuccess:lt,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,R.jsx)(g.Z,{src:Pe}),(0,R.jsx)(x.ZP,{icon:(0,R.jsx)(G.Z,{}),style:{marginLeft:12},children:ce.formatMessage({id:"pages.robot.upload",defaultMessage:"上传"})})]},"avatar")}),(0,R.jsx)(C.Z,{name:"nickname",label:ce.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:ce.formatMessage({id:"nickname",defaultMessage:"昵称"})}]}),(0,R.jsx)(E.Z,{name:"description",label:ce.formatMessage({id:"description",defaultMessage:"描述"})}),Ke===j.f4h&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(P.A.Item,{name:"settingsUid",label:ce.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),rules:[{required:!0,message:ce.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,R.jsx)($,{options:tt,loading:Se,placeholder:ce.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),emptyContent:0===tt.length?(0,R.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,R.jsx)("div",{style:{marginBottom:8,color:"#999"},children:ce.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,R.jsx)(x.ZP,{size:"small",type:"primary",icon:(0,R.jsx)(q.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return he(!0)},children:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:at,onDropdownOpen:rt,onCreate:function(){return he(!0)},createLabel:ce.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})})}),(0,R.jsx)(I.Z,{name:"enabled",label:ce.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),fieldProps:{onChange:function(e){return fl(e)}}}),ml&&(0,R.jsxs)(v.Fragment,{children:[(0,R.jsxs)("div",{children:[(0,R.jsx)(J,{style:{marginBottom:8,display:"block"},children:ce.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"文字对话模型提供商"})}),(0,R.jsx)(B.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:it,children:(tl||Xe)&&ol?(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,R.jsxs)("div",{children:[(0,R.jsx)(J,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"供应商："})}),(0,R.jsx)(J,{strong:!0,children:(null===(re=De.find((function(e){return e.uid===tl})))||void 0===re?void 0:re.nickname)||(null===(oe=De.find((function(e){return e.type===Xe})))||void 0===oe?void 0:oe.nickname)||Xe}),(0,R.jsx)("br",{}),(0,R.jsx)(J,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"模型："})}),(0,R.jsx)(J,{strong:!0,children:ul||ol})]}),(0,R.jsx)(x.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"更换模型"})})]}):(0,R.jsx)("div",{style:{textAlign:"center"},children:(0,R.jsx)(x.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"选择AI模型"})})})}),(0,R.jsxs)("div",{style:{display:"none"},children:[(0,R.jsx)(Z.Z,{name:"provider"}),(0,R.jsx)(Z.Z,{name:"model"})]})]}),(0,R.jsx)(A,{name:"temperature",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Pl(Ll,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"控制输出的随机性，值越高输出越随机创新"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Rl(Zl(e))}}}),(0,R.jsx)(A,{name:"topP",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Pl(Fl,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P 采样阈值，保留累计概率达到该值的词，范围 0-1，值越小越保守"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Nl(Zl(e))}}}),(0,R.jsx)(A,{name:"topK",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Il(zl)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"检索时返回的相关文档数量"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Ql(e)}}}),(0,R.jsx)(A,{name:"scoreThreshold",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"得分阈值"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Pl(ql,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"知识库召回命中文档的最低得分阈值，低于此值不纳入参考"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Gl(Zl(e))}}}),!1,(0,R.jsx)(E.Z,{name:"prompt",label:ce.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})}),(0,R.jsx)(I.Z,{name:"useLlmWhenKbEmpty",label:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库空结果时使用大模型"}),tooltip:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"开启后，当知识库没有命中时将继续调用大模型回答；关闭则返回默认回复"}),fieldProps:{onChange:function(e){return wl(e)}}}),!kl&&(0,R.jsx)(E.Z,{name:"defaultReply",label:ce.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"默认回复"})})]}),(0,R.jsxs)(v.Fragment,{children:[(0,R.jsx)(I.Z,{name:"kbEnabled",label:ce.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"启用知识库"}),fieldProps:{onChange:function(e){return xl(e)}}}),bl&&(0,R.jsxs)(v.Fragment,{children:[(0,R.jsx)(I.Z,{name:"kbSourceEnabled",label:ce.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),tooltip:ce.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"开启后将在回复中显示知识库命中来源，便于调试不同检索类型的搜索结果"})}),(0,R.jsx)(Z.Z,{name:"searchType",label:ce.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),valueEnum:o()(o()(o()({},j.ccx,{text:"全文"}),j.DGp,{text:"向量"}),j.rk3,{text:"混合"})}),(0,R.jsx)(Z.Z,{name:"kbUid",label:ce.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),placeholder:ce.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"请选择知识库"}),showSearch:!0,debounceTime:300,request:function(){var e=u()(s()().mark((function e(l){var t,n,a,r,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:j.QPQ,orgUid:null==pe?void 0:pe.uid,searchText:t||""},e.next=5,(0,w.AP)(a);case 5:return r=e.sent,o=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",o.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(l){return e.apply(this,arguments)}}()})]})]}),Tl&&(0,R.jsx)(V.Z,{type:"info",showIcon:!0,message:ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),style:{marginBottom:12}}),(0,R.jsx)(_.Z,{visible:He,onCancel:st,onOk:ut,initialProvider:tl||Xe,initialModel:ol,initialModelLabel:ul,providers:De,currentOrgUid:null==pe?void 0:pe.uid,existingProviderModels:Be,onModelsLoaded:dt,allowedModelTypes:[j.l55,j.xZ8,"CHAT"]}),(0,R.jsx)(N.Z,{open:ge,onOpenChange:he,orgUid:(null==pe?void 0:pe.uid)||"",record:null,onSuccess:function(){he(!1),et()}})]})},Y=t(10403),ee=t(25709),le=t(42539),te=function(e){var l,t=e.open,n=e.record,r=e.value,o=e.onClose,i=e.onSaved,d=(0,m.useIntl)(),c=(0,v.useState)(r||(null==n||null===(l=n.llm)||void 0===l?void 0:l.prompt)||""),f=p()(c,2),g=f[0],h=f[1];(0,v.useEffect)((function(){var e,l;h(null!==(e=null!=r?r:null==n||null===(l=n.llm)||void 0===l?void 0:l.prompt)&&void 0!==e?e:"")}),[t,r,null==n?void 0:n.uid]);var b=function(){var e=u()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(g||"");case 3:M.yw.success(d.formatMessage({id:"copy.success",defaultMessage:"复制成功"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),M.yw.error(d.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=u()(s()().mark((function e(){var l,t,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.uid){e.next=3;break}return null==o||o(),e.abrupt("return");case 3:return e.prev=3,M.yw.loading(d.formatMessage({id:"saving",defaultMessage:"Saving..."})),t={uid:(l=n).uid,prompt:g,llm:a()(a()({},l.llm||{}),{},{prompt:g})},e.next=9,(0,y.M8)(t);case 9:r=e.sent,le.Z.debug("PromptEditModal handleSave updated robot prompt:",r,t),M.yw.destroy(),200===(null==r?void 0:r.code)?(M.yw.success(d.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==i||i()):M.yw.error((null==r?void 0:r.message)||d.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),M.yw.destroy(),M.yw.error(d.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,R.jsx)(ee.Z,{open:t,title:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),onCancel:o,footer:[(0,R.jsx)(x.ZP,{onClick:b,children:d.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,R.jsx)(x.ZP,{type:"primary",onClick:k,children:d.formatMessage({id:"save",defaultMessage:"保存"})},"save"),(0,R.jsx)(x.ZP,{onClick:o,children:d.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:(0,R.jsx)("div",{children:(0,R.jsx)("textarea",{value:g,onChange:function(e){return h(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})})})})},ne=function(e){var l=e.superUser,t=(0,m.useIntl)(),n=(0,v.useRef)(),r=(0,S.u)((function(e){return e.currentOrg})),i=(0,v.useState)(!1),d=p()(i,2),c=d[0],T=d[1],C=(0,v.useState)(!1),E=p()(C,2),P=E[0],I=E[1],Z=(0,v.useState)(null),U=p()(Z,2),K=U[0],L=U[1],W=(0,v.useState)(!1),A=p()(W,2),F=A[0],N=A[1],D=(0,v.useState)(""),O=p()(D,2),z=O[0],Q=O[1],B=(0,v.useState)(null),V=p()(B,2),q=V[0],G=V[1],H=(0,v.useState)({}),_=p()(H,2),J=_[0],$=_[1],ee=(0,v.useState)({}),ne=p()(ee,2),ae=ne[0],re=ne[1];v.useEffect((function(){var e=function(){var e=u()(s()().mark((function e(){var l,t,n,a,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==r?void 0:r.uid,level:j.whQ},e.next=4,(0,k.mK)(l);case 4:t=e.sent,le.Z.debug("RobotTable loadProviders response:",t,l),200===(null==t?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],o={},a.forEach((function(e){var l=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(o[e.uid]=l)})),$(o)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=r&&r.uid?e():$({})}),[null==r?void 0:r.uid]),v.useEffect((function(){var e=function(){var e=u()(s()().mark((function e(){var l,t,n,a,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:200,orgUid:null==r?void 0:r.uid,searchText:""},e.next=4,(0,w.AP)(l);case 4:t=e.sent,le.Z.debug("RobotTable loadKbases response:",t,l),200===(null==t?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],o={},a.forEach((function(e){null!=e&&e.uid&&(o[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),re(o)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=r&&r.uid?e():re({})}),[null==r?void 0:r.uid]);var oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:t.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:t.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,l){return(0,R.jsx)(g.Z,{src:null==l?void 0:l.avatar})}},{title:t.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(e,l){var n=null==l?void 0:l.type,a=n===j.Qeb?"green":n===j.f4h?"blue":"purple",r=n===j.f4h?t.formatMessage({id:j.f4h,defaultMessage:"Service"}):n===j.Qeb?t.formatMessage({id:j.Qeb,defaultMessage:"Chat"}):n===j.wG_?t.formatMessage({id:j.wG_,defaultMessage:"Marketing"}):t.formatMessage({id:n||"unknown",defaultMessage:n||"-"});return(0,R.jsx)(h.Z,{color:a,children:r})},hideInSearch:!0},{title:t.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:o()(o()({},j.f4h,{text:t.formatMessage({id:j.f4h,defaultMessage:"Service"})}),j.Qeb,{text:t.formatMessage({id:j.Qeb,defaultMessage:"Chat"})}),hideInTable:!0},{title:t.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:t.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,l){if((null==l?void 0:l.type)===j.Qeb){var n,a,r=!(null==l||null===(n=l.llm)||void 0===n||!n.textModel);return(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(a=l.llm)||void 0===a?void 0:a.textModel)||t.formatMessage({id:"robot.llm.configured",defaultMessage:"模型已配置"}):t.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"未配置模型，点击配置"})})}return null!=l&&l.settings?(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},children:l.settings.name||t.formatMessage({id:"robot.settings.configured",defaultMessage:"已配置"})}):(0,R.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){L(l),T(!0)},children:t.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:t.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(e,l){var n,a=null==l||null===(n=l.llm)||void 0===n?void 0:n.prompt;return a?(0,R.jsx)("a",{onClick:function(){Q(a),G(l),N(!0)},children:t.formatMessage({id:"view",defaultMessage:"查看"})}):"-"}},{title:t.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"文本模型提供商"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,l){var t,n,a=null==l||null===(t=l.llm)||void 0===t?void 0:t.textProviderUid;return a&&J[a]?J[a]:(null==l||null===(n=l.llm)||void 0===n?void 0:n.textProvider)||"-"}},{title:t.formatMessage({id:"pages.prompt.model",defaultMessage:"模型"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,l){var t;return(null==l||null===(t=l.llm)||void 0===t?void 0:t.textModel)||"-"}},{title:t.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,l){var t;return null!=l&&null!==(t=l.llm)&&void 0!==t&&t.enabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库搜索结果为空时用LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,l){var t;return null!=l&&null!==(t=l.llm)&&void 0!==t&&t.useLlmWhenKbEmpty?"是":"否"}},{title:t.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:t.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,l){var t,n,a;return 0===(null==l||null===(t=l.llm)||void 0===t?void 0:t.temperature)?"0":null!==(n=null==l||null===(a=l.llm)||void 0===a?void 0:a.temperature)&&void 0!==n?n:"-"}},{title:t.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,l){var t,n;return null!==(t=null==l||null===(n=l.llm)||void 0===n?void 0:n.topK)&&void 0!==t?t:"-"}},{title:t.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"知识库启用"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,l){return null!=l&&l.kbEnabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,l){return null!=l&&l.kbSourceEnabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,l){var t,n=null==l||null===(t=l.llm)||void 0===t?void 0:t.searchType;return n===j.ccx?"全文":n===j.DGp?"向量":n===j.rk3?"混合":null!=n?n:"-"}},{title:t.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,l){var t=null==l?void 0:l.kbUid;return t?ae[t]||t:"-"}},{title:t.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:t.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,l){return[(0,R.jsx)("a",{onClick:function(){return function(e){var l;if(e&&e.uid){var n={chatConfig:{org:null==r?void 0:r.uid,t:j.ACv,sid:e.uid}};null===(l=window.bytedesk)||void 0===l||l.showChat(n)}else M.yw.error(t.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))}(l)},children:t.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,R.jsx)("a",{onClick:function(){return m.history.push("/service/channel")},children:t.formatMessage({id:"robot.get.code",defaultMessage:"获取机器人代码"})},"code"),(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},children:t.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,R.jsx)(b.Z,{title:t.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==l?void 0:l.nickname,"】？"),onConfirm:u()(s()().mark((function e(){var a,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,y.gf)(l);case 4:a=e.sent,M.yw.destroy(),200===(null==a?void 0:a.code)?(M.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(r=n.current)||void 0===r||r.reload()):M.yw.error((null==a?void 0:a.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),M.yw.destroy(),M.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:t.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:t.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,R.jsx)("a",{children:t.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:t.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(f.Z,{columns:oe,actionRef:n,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:j.f4h}},toolBarRender:function(){return[(0,R.jsx)(x.ZP,{type:"primary",onClick:function(){L(null),I(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=u()(s()().mark((function e(t,n){var o,i,d,u,c,v,m,f,g,h,b,x,M,k,w,S,T,C,E,P,I,Z,U,K;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(null!==(o=null==t?void 0:t.current)&&void 0!==o?o:1)-1,v=null!==(i=null==t?void 0:t.pageSize)&&void 0!==i?i:10,m=null!==(d=null==t?void 0:t.searchText)&&void 0!==d?d:"",f=null!==(u=null==t?void 0:t.type)&&void 0!==u?u:j.f4h,(b=Object.entries(n||{})).length>0&&(x=b[0],M=p()(x,2),k=M[0],(w=M[1])&&(g=k,h="ascend"===w?"ascend":"descend")),S=a()(a()({pageNumber:c,pageSize:v,categoryUid:"",level:j.whQ,type:f,orgUid:null==r?void 0:r.uid,searchText:m,superUser:l},g?{sortBy:g}:{}),h?{sortDirection:h}:{}),e.prev=7,e.next=10,(0,y.p0)(S);case 10:if(T=e.sent,console.log("RobotTable queryRobotsByOrg response:",T,S),200!==(null==T?void 0:T.code)){e.next=16;break}return U=(null==T||null===(C=T.data)||void 0===C?void 0:C.content)||[],K=null!==(E=null!==(P=null==T||null===(I=T.data)||void 0===I?void 0:I.totalElements)&&void 0!==P?P:null==T||null===(Z=T.data)||void 0===Z?void 0:Z.numberOfElements)&&void 0!==E?E:U.length,e.abrupt("return",{data:U,total:K,success:!0});case 16:return e.abrupt("return",{data:[],total:0,success:!1});case 19:return e.prev=19,e.t0=e.catch(7),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(l,t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:t.formatMessage({id:"robot",defaultMessage:"Robot"})}),c&&(0,R.jsx)(X,{open:c,record:K,onClose:function(){return T(!1)},onSuccess:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.reload()}}),P&&(0,R.jsx)(Y.Z,{open:P,onClose:function(){return I(!1)},onSubmit:function(){var e=u()(s()().mark((function e(l){var a,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.yw.loading(t.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=1,e.next=4,(0,y.lg)(l);case 4:a=e.sent,M.yw.destroy(),200===(null==a?void 0:a.code)?(M.yw.success(t.formatMessage({id:"create.success",defaultMessage:"Create success"})),I(!1),null===(r=n.current)||void 0===r||r.reload()):M.yw.error((null==a?void 0:a.message)||t.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),M.yw.destroy(),M.yw.error(t.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(l){return e.apply(this,arguments)}}()}),(0,R.jsx)(te,{open:F,record:q,value:z,onClose:function(){return N(!1)},onSaved:function(){var e;N(!1),G(null),null===(e=n.current)||void 0===e||e.reload()}})]})}}}]);