"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4461],{15722:function(e,n,t){t.d(n,{Z:function(){return l}});var a=t(83910),r=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=t(54183),i=function(e,n){return r.createElement(o.Z,(0,a.Z)({},e,{ref:n,icon:s}))};var l=r.forwardRef(i)},59005:function(e,n,t){var a=t(94433),r=t(38956),s=t(57343),o=t(44194),i=t(45441),l=t(9953),u=t(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,n){var t=e.fieldProps,c=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,h=e.showSearch,M=e.options,x=(0,r.Z)(e,d),w=(0,o.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,s.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:M,mode:m,showSearch:h,getPopupContainer:w.getPopupContainer},t),ref:n,proFieldProps:f},x),{},{children:c}))},f=o.forwardRef((function(e,n){var t=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,h=e.options,M=(0,r.Z)(e,c),x=(0,a.Z)({options:h,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),w=(0,o.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,s.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:w.getPopupContainer},x),ref:n,proFieldProps:f},M),{},{children:d}))})),m=o.forwardRef(p);m.SearchSelect=f,m.displayName="ProFormComponent",n.Z=m},50628:function(e,n,t){var a=t(94433),r=t(38956),s=t(44194),o=t(9953),i=t(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=s.forwardRef((function(e,n){var t=e.fieldProps,s=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,r.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:s,checkedChildren:u},t),ref:n,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));n.Z=u},86702:function(e,n,t){var a=t(32906),r=t(94433),s=t(38956),o=t(81424),i=t(69705),l=t(65641),u=t(34573),d=t(44194),c=t(9953),p=t(31549),f=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",v=function(e){var n=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),t=(0,a.Z)(n,2),s=t[0],u=t[1];return(0,p.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(n){var t,a=n.getFieldValue(e.name||[]);return(0,p.jsx)(l.Z,(0,r.Z)((0,r.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(t=e.statusRender)||void 0===t?void 0:t.call(e,a),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},h=function(e){var n=e.fieldProps,t=e.proFieldProps,a=(0,s.Z)(e,f);return(0,p.jsx)(c.Z,(0,r.Z)({valueType:g,fieldProps:n,filedConfig:{valueType:g},proFieldProps:t},a))};h.Password=function(e){var n=e.fieldProps,t=e.proFieldProps,o=(0,s.Z)(e,m),i=(0,d.useState)(!1),l=(0,a.Z)(i,2),f=l[0],h=l[1];return null!=n&&n.statusRender&&o.name?(0,p.jsx)(v,{name:o.name,statusRender:null==n?void 0:n.statusRender,popoverProps:null==n?void 0:n.popoverProps,strengthText:null==n?void 0:n.strengthText,open:f,onOpenChange:h,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,r.Z)({valueType:"password",fieldProps:(0,r.Z)((0,r.Z)({},(0,u.Z)(n,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var t;null==n||null===(t=n.onBlur)||void 0===t||t.call(n,e),h(!1)},onClick:function(e){var t;null==n||null===(t=n.onClick)||void 0===t||t.call(n,e),h(!0)}}),proFieldProps:t,filedConfig:{valueType:g}},o))})}):(0,p.jsx)(c.Z,(0,r.Z)({valueType:"password",fieldProps:n,proFieldProps:t,filedConfig:{valueType:g}},o))},h.displayName="ProFormComponent",n.Z=h},60241:function(e,n,t){var a=t(94433),r=t(38956),s=t(44194),o=t(9953),i=t(31549),l=["fieldProps","proFieldProps"],u=function(e,n){var t=e.fieldProps,s=e.proFieldProps,u=(0,r.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({ref:n,valueType:"textarea",fieldProps:t,proFieldProps:s},u))};n.Z=s.forwardRef(u)},56230:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var a=t(73193),r=t.n(a),s=t(90819),o=t.n(s),i=t(89933),l=t.n(i),u=t(45332),d=t.n(u),c=t(43388),p=t(94976),f=t(4628);function m(e){return g.apply(this,arguments)}function g(){return(g=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.request)("/api/v1/menu/query/org",{method:"GET",params:r()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.request)("/api/v1/menu/create",{method:"POST",data:r()(r()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.request)("/api/v1/menu/update",{method:"POST",data:r()(r()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return y.apply(this,arguments)}function y(){return(y=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.request)("/api/v1/menu/delete",{method:"POST",data:r()(r()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=t(74171),b=t(15722),P=t(10162),Z=t(44565),C=t(90581),j=t(92351),S=t(82878),T=t(12461),O=t(43275),F=t(69533),N=t(44194),I=t(84176),E=t.n(I),q=t(99036),W=t(86702),A=t(60241),B=t(59005),R=t(50628),K=t(30857),L=t(30310),U=t(31549),z=["iconPreset"],D={type:"DESKTOP",color:"blue",order:0,enabled:!0,openInNewWindow:!0},V=function(e){var n=e.open,t=e.isEdit,a=e.orgUid,s=e.menu,o=e.onClose,i=e.onSubmit,l=q.A.useForm(),u=d()(l,1)[0],c=(0,f.useIntl)(),p=(0,N.useMemo)((function(){return[{label:c.formatMessage({id:"menu.type.option.admin",defaultMessage:"Admin · Console"}),value:"ADMIN",disabled:!0},{label:c.formatMessage({id:"menu.type.option.desktop",defaultMessage:"Desktop · Workspace"}),value:"DESKTOP"},{label:c.formatMessage({id:"menu.type.option.workflow",defaultMessage:"Workflow · Automation"}),value:"WORKFLOW",disabled:!0},{label:c.formatMessage({id:"menu.type.option.notebase",defaultMessage:"NoteBase · Knowledge"}),value:"NOTEBASE",disabled:!0},{label:c.formatMessage({id:"menu.type.option.kanban",defaultMessage:"Kanban · Task Board"}),value:"KANBAN",disabled:!0}]}),[c]),m=(0,N.useMemo)((function(){return[{label:c.formatMessage({id:"menu.icon.option.message",defaultMessage:"Message · MessageOutlined"}),value:"MessageOutlined"},{label:c.formatMessage({id:"menu.icon.option.mail",defaultMessage:"Mail · MailOutlined"}),value:"MailOutlined"},{label:c.formatMessage({id:"menu.icon.option.settings",defaultMessage:"Settings · SettingOutlined"}),value:"SettingOutlined"},{label:c.formatMessage({id:"menu.icon.option.statistic",defaultMessage:"Statistic · LineChartOutlined"}),value:"LineChartOutlined"},{label:c.formatMessage({id:"menu.icon.option.support",defaultMessage:"Support · PhoneOutlined"}),value:"PhoneOutlined"},{label:c.formatMessage({id:"menu.icon.option.knowledge",defaultMessage:"Knowledge · BookOutlined"}),value:"BookOutlined"},{label:c.formatMessage({id:"menu.icon.option.link",defaultMessage:"External Link · LinkOutlined"}),value:"LinkOutlined"}]}),[c]);(0,N.useEffect)((function(){if(n)if(t&&s){var e,a,o=null===(e=m.find((function(e){return e.value===s.icon})))||void 0===e?void 0:e.value;u.setFieldsValue(r()(r()(r()({},D),s),{},{order:null!==(a=s.order)&&void 0!==a?a:0,iconPreset:o}))}else u.setFieldsValue(r()(r()({},D),{},{iconPreset:void 0}));else u.resetFields()}),[n,t,s,u,m]);return(0,U.jsx)(K.Z,{title:t?c.formatMessage({id:"menu.edit",defaultMessage:"编辑菜单"}):c.formatMessage({id:"menu.create",defaultMessage:"创建菜单"}),width:560,destroyOnHidden:!0,onClose:o,open:n,extra:(0,U.jsxs)(L.Z,{children:[(0,U.jsx)(F.ZP,{onClick:o,children:c.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,U.jsx)(F.ZP,{type:"primary",onClick:function(){return u.submit()},children:c.formatMessage({id:"save",defaultMessage:"保存"})})]}),children:(0,U.jsxs)(q.A,{form:u,layout:"vertical",submitter:!1,onFinish:function(){return u.validateFields().then((function(e){var n,t=e.iconPreset,o=E()(e,z),l=r()(r()({},o),{},{uid:null==s?void 0:s.uid,color:o.color||"blue",icon:o.icon||t||"LinkOutlined",orgUid:null!==(n=null==s?void 0:s.orgUid)&&void 0!==n?n:a});i(l)}))},children:[(0,U.jsx)(W.Z,{name:"name",label:c.formatMessage({id:"name",defaultMessage:"名称"}),rules:[{required:!0,message:c.formatMessage({id:"menu.name.required",defaultMessage:"请输入菜单名称"})}]}),(0,U.jsx)(A.Z,{name:"description",label:c.formatMessage({id:"description",defaultMessage:"描述"}),fieldProps:{rows:2}}),(0,U.jsx)(B.Z,{name:"type",label:c.formatMessage({id:"type",defaultMessage:"类型"}),options:p,rules:[{required:!0,message:c.formatMessage({id:"menu.type.required",defaultMessage:"请选择菜单类型"})}]}),(0,U.jsx)(W.Z,{name:"link",label:c.formatMessage({id:"link",defaultMessage:"链接"}),rules:[{required:!0,message:c.formatMessage({id:"menu.link.required",defaultMessage:"请输入链接地址"})}]}),(0,U.jsx)(R.Z,{name:"enabled",label:c.formatMessage({id:"enabled",defaultMessage:"启用"})}),(0,U.jsx)(R.Z,{name:"openInNewWindow",label:c.formatMessage({id:"menu.new.window",defaultMessage:"新窗口打开"})})]})})},J=t(67242),X=function(){var e=(0,f.useIntl)(),n=(0,N.useRef)(),t=(0,k.u)((function(e){return e.currentOrg})),a=(0,N.useState)(!1),s=d()(a,2),i=s[0],u=s[1],p=(0,N.useState)(!1),g=d()(p,2),h=g[0],x=g[1],y=(0,N.useState)(),I=d()(y,2),E=I[0],q=I[1],W=(0,N.useState)(null),A=d()(W,2),B=A[0],R=A[1],K=(0,N.useMemo)((function(){return{ADMIN:{text:e.formatMessage({id:"menu.type.option.admin",defaultMessage:"Admin · Console"})},DESKTOP:{text:e.formatMessage({id:"menu.type.option.desktop",defaultMessage:"Desktop · Workspace"})},WORKFLOW:{text:e.formatMessage({id:"menu.type.option.workflow",defaultMessage:"Workflow · Automation"})},NOTEBASE:{text:e.formatMessage({id:"menu.type.option.notebase",defaultMessage:"NoteBase · Knowledge"})},KANBAN:{text:e.formatMessage({id:"menu.type.option.kanban",defaultMessage:"Kanban · Task Board"})}}}),[e]),L=function(){null!=t&&t.uid?(x(!1),q(void 0),u(!0)):c.yw.warning(e.formatMessage({id:"menu.org.required",defaultMessage:"请先选择组织"}))},z=function(){var a=l()(o()().mark((function a(r){var s,i,l;return o()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,w({uid:r.uid,orgUid:null!==(s=r.orgUid)&&void 0!==s?s:null==t?void 0:t.uid});case 2:i=a.sent,J.Z.debug("delete menu",i),200===i.code?(c.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),null===(l=n.current)||void 0===l||l.reload()):c.yw.error(i.message||e.formatMessage({id:"delete.failed",defaultMessage:"删除失败"}));case 5:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),D=function(){var t=l()(o()().mark((function t(a){var s,i,l;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.orgUid){t.next=3;break}return c.yw.error(e.formatMessage({id:"menu.org.required",defaultMessage:"请先选择组织"})),t.abrupt("return");case 3:if(!h||null==E||!E.uid){t.next=9;break}return t.next=6,M(r()(r()(r()({},E),a),{},{uid:E.uid}));case 6:i=t.sent,t.next=12;break;case 9:return t.next=11,v(a);case 11:i=t.sent;case 12:J.Z.debug("persist menu",null===(s=i)||void 0===s?void 0:s.data,a),200===i.code?(c.yw.success(e.formatMessage({id:"save.success",defaultMessage:"保存成功"})),u(!1),null===(l=n.current)||void 0===l||l.reload()):c.yw.error(i.message||e.formatMessage({id:"save.failed",defaultMessage:"保存失败"}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),X=function(){var a=l()(o()().mark((function a(r,s,i){var l,u,d,p;return o()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r.uid){a.next=2;break}return a.abrupt("return");case 2:return R("".concat(r.uid,"-").concat(s)),u={uid:r.uid,name:r.name,description:r.description,type:r.type,color:r.color,icon:r.icon,link:r.link,order:r.order,enabled:"enabled"===s?i:r.enabled,openInNewWindow:"openInNewWindow"===s?i:r.openInNewWindow,orgUid:null!==(l=r.orgUid)&&void 0!==l?l:null==t?void 0:t.uid},a.prev=4,a.next=7,M(u);case 7:200===(d=a.sent).code?null===(p=n.current)||void 0===p||p.reload():c.yw.error(d.message||e.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(4),c.yw.error(e.formatMessage({id:"menu.toggle.failed",defaultMessage:"更新开关失败"}));case 14:return a.prev=14,R(null),a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[4,11,14,17]])})));return function(e,n,t){return a.apply(this,arguments)}}(),G=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"name",defaultMessage:"名称"}),dataIndex:"name",key:"name",copyable:!0,ellipsis:!0},{title:e.formatMessage({id:"type",defaultMessage:"类型"}),dataIndex:"type",key:"type",valueType:"select",valueEnum:K,render:function(e,n){var t;return(0,U.jsx)(C.Z,{color:"blue",children:(null===(t=K[n.type])||void 0===t?void 0:t.text)||n.type})}},{title:e.formatMessage({id:"link",defaultMessage:"链接"}),dataIndex:"link",key:"link",copyable:!0,ellipsis:!0,render:function(e,n){return n.link?(0,U.jsx)(j.Z,{title:n.link,children:(0,U.jsx)(S.Z.Link,{href:n.link,target:"_blank",rel:"noreferrer",children:n.link})}):"-"}},{title:e.formatMessage({id:"enabled",defaultMessage:"启用"}),dataIndex:"enabled",key:"enabled",valueType:"select",valueEnum:{true:{text:e.formatMessage({id:"enabled",defaultMessage:"启用"})},false:{text:e.formatMessage({id:"disabled",defaultMessage:"禁用"})}},render:function(e,n){return(0,U.jsx)(T.Z,{checked:n.enabled,onChange:function(e){return X(n,"enabled",e)},loading:B==="".concat(n.uid,"-enabled")})}},{title:e.formatMessage({id:"menu.new.window",defaultMessage:"新窗口打开"}),dataIndex:"openInNewWindow",key:"openInNewWindow",hideInSearch:!0,render:function(e,n){return(0,U.jsx)(T.Z,{checked:n.openInNewWindow,onChange:function(e){return X(n,"openInNewWindow",e)},loading:B==="".concat(n.uid,"-openInNewWindow")})}},{title:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",key:"createdAt",sorter:!0,hideInSearch:!0,width:200},{title:e.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",fixed:"right",width:160,render:function(n,t){return[(0,U.jsx)("a",{onClick:function(){return function(e){x(!0),q(e),u(!0)}(t)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,U.jsx)(O.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"确认删除?"}),onConfirm:function(){return z(t)},okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),icon:(0,U.jsx)(b.Z,{style:{color:"red"}}),children:(0,U.jsx)(F.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}];return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(Z.Z,{rowKey:"uid",actionRef:n,columns:G,search:{labelWidth:"auto"},pagination:{defaultPageSize:10,showSizeChanger:!0},scroll:{x:1200},request:function(){var n=l()(o()().mark((function n(a,r){var s,i,l,u,d;return o()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=2;break}return n.abrupt("return",{data:[],success:!0,total:0});case 2:return l={pageNumber:a.current?a.current-1:0,pageSize:a.pageSize,orgUid:t.uid,name:a.name,type:a.type,link:a.link},void 0!==a.enabled&&(l.enabled=!0===a.enabled||"true"===a.enabled),(u=Object.keys(r||{})[0])&&(l.sortBy=u,l.sortDirection="ascend"===r[u]?"asc":"desc"),n.next=8,m(l);case 8:if(200===(d=n.sent).code){n.next=12;break}return c.yw.error(d.message||e.formatMessage({id:"menu.load.failed",defaultMessage:"加载菜单失败"})),n.abrupt("return",{data:[],success:!1,total:0});case 12:return n.abrupt("return",{data:(null===(s=d.data)||void 0===s?void 0:s.content)||[],success:!0,total:(null===(i=d.data)||void 0===i?void 0:i.totalElements)||0});case 13:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),toolBarRender:function(){return[(0,U.jsx)(F.ZP,{type:"primary",icon:(0,U.jsx)(P.Z,{}),onClick:L,children:e.formatMessage({id:"menu.create",defaultMessage:"创建菜单"})},"create")]}}),(0,U.jsx)(V,{open:i,isEdit:h,menu:E,orgUid:null==t?void 0:t.uid,onClose:function(){u(!1)},onSubmit:D})]})},G=function(){return(0,U.jsx)(X,{})}}}]);