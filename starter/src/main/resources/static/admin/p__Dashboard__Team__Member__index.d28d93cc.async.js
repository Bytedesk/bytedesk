"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7960],{47944:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(i)},11090:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(i)},30617:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(i)},42085:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(i)},32350:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(35175),i=n(31549),u=["fieldProps","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.proFieldProps,l=(0,a.Z)(e,u);return(0,i.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:s},l))};t.Z=s.forwardRef(l)},2516:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(35175),i=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,d=e.proFieldProps,c=(0,a.Z)(e,u);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(l);t.Z=d},81924:function(e,t,n){n.d(t,{E9:function(){return c},Rd:function(){return v},fA:function(){return m},ul:function(){return g}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),d=n(41159);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11603:function(e,t,n){n.d(t,{If:function(){return v},dF:function(){return c},j4:function(){return g},v$:function(){return m}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),d=n(41159);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,n){n.d(t,{D$:function(){return m},EP:function(){return v},hS:function(){return g},z_:function(){return c}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),d=n(41159);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},96865:function(e,t,n){var r=n(23864);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,t,n){var r=n(55735),a=n(65461),s=n(41159);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},6529:function(e,t,n){n.r(t),n.d(t,{default:function(){return me}});var r=n(75574),a=n(44194),s=n(96865),o=n(73193),i=n.n(o),u=n(84176),l=n.n(u),d=n(90819),c=n.n(d),f=n(89933),m=n.n(f),p=n(86222),g=n.n(p),h=n(76711),v=n.n(h),b=n(45332),x=n.n(b),M=n(73669),y=n(53782),w=n(40612),j=n(10162),k=n(54881),S=n(30617),Z=n(11090),D=n(61107),C=n(2484),F=n(48524),R=n(53530),U=n(32327),P=n(29266),T=n(61355),E=n(75365),z=n(96485),I=n(55735),q=n(69169),V=n(2516),N=n(4499),O=n(84881),B=n(41159),A=n(73442),H=n(3849),K=n(86803),G=n(81924),L=n(76750),W=n(31549),Q=function(e){var t,n,r=e.isEdit,s=e.member,o=e.open,i=e.onClose,u=e.onSubmit,l=q.A.useForm(),d=x()(l,1)[0],f=(0,B.useIntl)(),p=(0,L.Z)().translateString,g=(0,y.H)((function(e){return e.departmentResult})),h=(0,w.u)((function(e){return e.currentOrg})),b=(0,a.useState)([]),M=x()(b,2),j=M[0],k=M[1],S=(0,a.useState)([]),Z=x()(S,2),D=Z[0],C=Z[1];(0,a.useEffect)((function(){r&&s&&d?d.setFieldsValue({uid:null==s?void 0:s.uid,nickname:null==s?void 0:s.nickname,email:null==s?void 0:s.email,mobile:null==s?void 0:s.mobile,jobNo:null==s?void 0:s.jobNo,jobTitle:p(null==s?void 0:s.jobTitle),seatNo:null==s?void 0:s.seatNo,telephone:null==s?void 0:s.telephone,deptUid:null==s?void 0:s.deptUid}):(console.log("form resetFields"),d.resetFields(),k([I.nGQ]),d.setFieldsValue({roleUids:[I.nGQ]}))}),[s,r]);var F=function e(t,n){var r;if(null!=t&&null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=f.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name,n.value=t.uid,t.children)for(var a=0;a<t.children.length;a++){var s={title:"",value:"",children:[]};e(t.children[a],s),n.children.push(s)}},R=(0,a.useMemo)((function(){for(var e=[],t=0;t<g.data.content.length;t++)if(g.data.content[t].name!==I.zBg){var n={title:"",value:"",children:[]};F(g.data.content[t],n),e.push(n)}return e}),[g]),U=function(){var e=m()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:null==h?void 0:h.uid,orgAndPlatform:!0},e.next=4,(0,G.E9)(t);case 4:n=e.sent,console.log("queryRolesByOrg response ",n),200===n.code?(K.yw.destroy(),r=n.data.content.find((function(e){return e.uid===I.nGQ})),r||n.data.content.push({uid:I.nGQ,name:"member",description:"成员角色",system:!0}),a=n.data.content,C(a)):(K.yw.destroy(),K.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e,t=(null==s||null===(e=s.roleUids)||void 0===e?void 0:e.filter((function(e){return""!==e})))||[];k(t)}),[s]),(0,a.useEffect)((function(){o&&(U(),r||(k([I.nGQ]),d.setFieldsValue({roleUids:[I.nGQ]})))}),[o,r]),(0,W.jsx)("div",{children:(0,W.jsx)(A.Z,{title:r?(0,W.jsx)(B.FormattedMessage,{id:"team.member.drawer.edit.title"}):(0,W.jsx)(B.FormattedMessage,{id:"team.member.drawer.create.title"}),onClose:i,open:o,width:600,extra:(0,W.jsxs)(H.Z,{children:[(0,W.jsx)(E.ZP,{onClick:i,children:(0,W.jsx)(B.FormattedMessage,{id:"team.member.drawer.button.cancel"})}),(0,W.jsx)(E.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("Form values:",e);var t={uid:null==s?void 0:s.uid,nickname:e.nickname,email:e.email,mobile:e.mobile,jobNo:e.jobNo,jobTitle:e.jobTitle,seatNo:e.seatNo,telephone:e.telephone,deptUid:e.deptUid,orgUid:null==h?void 0:h.uid,roleUids:j};console.log("memberObject:",t),u(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:(0,W.jsx)(B.FormattedMessage,{id:"team.member.drawer.button.save"})})]}),children:(0,W.jsxs)(q.A,{form:d,name:"memForm",submitter:!1,children:[(0,W.jsx)(V.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.department"}),name:"deptUid",width:"md",placeholder:f.formatMessage({id:"team.member.form.department.placeholder"}),allowClear:!0,rules:[{required:!0,message:f.formatMessage({id:"team.member.form.department.required"})}],fieldProps:{treeDefaultExpandAll:!0,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:R,variant:"outlined"}}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.name"}),name:"nickname",rules:[{required:!0,message:f.formatMessage({id:"team.member.form.name.required"})}]}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.mobile"}),name:"mobile",disabled:r,rules:[{required:!0,message:f.formatMessage({id:"team.member.form.mobile.required"})},{pattern:/^1[3456789]\d{9}$/,message:f.formatMessage({id:"team.member.form.mobile.invalid"})}]}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.email"}),name:"email",disabled:r,rules:[{required:!0,message:f.formatMessage({id:"team.member.form.email.required"})},{type:"email",message:f.formatMessage({id:"team.member.form.email.invalid"})}]}),(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser)&&(0,W.jsx)("p",{children:"超级管理员拥有所有权限，禁止编辑角色"}),(0,W.jsx)(O.Z,{name:"roleUids",label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.role"}),width:"md",disabled:null==s||null===(n=s.user)||void 0===n?void 0:n.superUser,options:(D||[]).filter((function(e){return e.uid===I.nGQ||!e.system||j.includes(e.uid)})).map((function(e){return{value:e.uid,label:p(e.name),disabled:(!0===e.system||e.uid===I.nGQ)&&!j.includes(e.uid)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:f.formatMessage({id:"team.member.form.role.placeholder"}),value:j,onChange:function(e){console.log("selected ".concat(e));var t=D.filter((function(e){return!0===e.system})).map((function(e){return e.uid})),n=j.filter((function(n){return t.includes(n)&&!e.includes(n)}));if(n.length>0){var r=[].concat(v()(e),v()(n));K.yw.warning("系统角色不允许取消选择");var a=r.filter((function(e){return""!==e}));k(a)}else if(e.includes(I.nGQ)){var s=e.filter((function(e){return""!==e}));k(s)}else{var o=[].concat(v()(e),[I.nGQ]);K.yw.warning("成员角色不允许取消选择");var i=o.filter((function(e){return""!==e}));k(i)}},optionItemRender:function(e){var t=D.find((function(t){return t.uid===e.value}));return null!=t&&t.system?(0,W.jsxs)("span",{children:[e.label," ",j.includes(e.value)&&"(系统角色，不可取消)"]}):e.value===I.nGQ?(0,W.jsxs)("span",{children:[e.label," ",j.includes(e.value)&&"(成员角色，不可取消)"]}):e.label}}}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.jobNo"}),name:"jobNo"}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.jobTitle"}),name:"jobTitle"}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.seatNo"}),name:"seatNo"}),(0,W.jsx)(N.Z,{label:(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.telephone"}),name:"telephone"}),(0,W.jsxs)("p",{children:[(0,W.jsx)(B.FormattedMessage,{id:"team.member.form.login.tip"}),(0,W.jsx)("a",{href:f.formatMessage({id:"team.member.form.login.tip.link"}),target:"_blank",rel:"noopener noreferrer",children:"，点击链接可打开页面"})]})]})})})},$=n(36310),_=n(27650),J=n(11603),Y=n(51239),X=["current","pageSize"],ee=function(){var e,t=(0,a.useRef)(),n=(0,B.useIntl)(),r=(0,a.useRef)(!1),s=(0,L.Z)().translateString,o=(0,a.useState)(!0),u=x()(o,2),d=u[0],f=u[1],p=(0,a.useState)(1),h=x()(p,2),b=h[0],q=h[1],V=(0,a.useState)(10),N=x()(V,2),O=N[0],A=N[1],H=(0,a.useState)({}),ee=x()(H,2),te=ee[0],ne=ee[1],re=(0,a.useState)(),ae=x()(re,2),se=ae[0],oe=ae[1],ie=(0,a.useState)(!1),ue=x()(ie,2),le=ue[0],de=ue[1],ce=(0,w.u)((function(e){return e.currentOrg})),fe=(0,Y.L)((function(e){return e.userInfo})),me=(0,y.H)((function(e){return e.currentDepartment})),pe=R.Z.useModal(),ge=x()(pe,2),he=(ge[0],ge[1]),ve=(0,a.useState)(!1),be=x()(ve,2),xe=be[0],Me=be[1],ye=(0,y.H)((function(e){return{departmentResult:e.departmentResult,setDepartmentResult:e.setDepartmentResult}})),we=ye.departmentResult,je=ye.setDepartmentResult,ke=(0,a.useState)([]),Se=x()(ke,2),Ze=Se[0],De=Se[1],Ce=(0,a.useState)([]),Fe=x()(Ce,2),Re=Fe[0],Ue=Fe[1],Pe=(0,a.useState)([]),Te=x()(Pe,2),Ee=Te[0],ze=Te[1],Ie=(0,a.useState)(0),qe=x()(Ie,2),Ve=qe[0],Ne=qe[1],Oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,W.jsx)(B.FormattedMessage,{id:"pages.user.nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",fixed:"left",copyable:!0,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.nickname.tooltip",defaultMessage:"成员的昵称或显示名称"})},{title:(0,W.jsx)(B.FormattedMessage,{id:"pages.user.username",defaultMessage:"Username"}),dataIndex:"username",width:180,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.username.tooltip",defaultMessage:"成员的登录账号名称"}),render:function(e,t){var n,r=null==t||null===(n=t.user)||void 0===n?void 0:n.username;return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("span",{children:r}),r&&(0,W.jsx)(U.Z.Text,{copyable:{text:r},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(B.FormattedMessage,{id:"jobNo",defaultMessage:"工号"}),dataIndex:"jobNo",width:100,copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.jobNo.tooltip",defaultMessage:"成员在组织内部的工号标识"})},{title:(0,W.jsx)(B.FormattedMessage,{id:"jobTitle",defaultMessage:"职位"}),dataIndex:"jobTitle",width:120,copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.jobTitle.tooltip",defaultMessage:"成员在组织内的职位或职务名称"})},{title:(0,W.jsx)(B.FormattedMessage,{id:"seatNo",defaultMessage:"座席号"}),dataIndex:"seatNo",width:100,copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.seatNo.tooltip",defaultMessage:"成员的座席编号，通常用于客服系统"})},{title:(0,W.jsx)(B.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",width:120,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.mobile.tooltip",defaultMessage:"成员的手机号码联系方式"}),render:function(e,t){return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("a",{href:"tel:".concat(t.mobile),children:t.mobile}),t.mobile&&(0,W.jsx)(U.Z.Text,{copyable:{text:t.mobile},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(B.FormattedMessage,{id:"telephone",defaultMessage:"电话"}),dataIndex:"telephone",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.telephone.tooltip",defaultMessage:"成员的固定电话或分机号"}),render:function(e){return e?(0,W.jsx)("a",{href:"tel:".concat(e),children:e}):""}},{title:(0,W.jsx)(B.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",width:180,copyable:!0,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.email.tooltip",defaultMessage:"成员的电子邮箱地址"}),render:function(e,t){return(0,W.jsx)("a",{href:"mailto:".concat(e),children:e})}}].concat(v()([]),[{title:(0,W.jsx)(B.FormattedMessage,{id:"department",defaultMessage:"Department"}),dataIndex:"deptUid",width:150,valueType:"select",tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.department.tooltip",defaultMessage:"成员所属的部门或组织单位"}),fieldProps:{options:function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=[],o=g()(t||[]);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.uid!==I.zBg){var u=s(i.name),l=r?"".concat(r," / ").concat(u):u;a.push({label:l,value:i.uid}),i.children&&i.children.length>0&&(a=a.concat(e(i.children,l)))}}}catch(e){o.e(e)}finally{o.f()}return a}((null==we||null===(e=we.data)||void 0===e?void 0:e.content)||[])},render:function(e,t){var n=function e(t,n){var r,a=g()(t||[]);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.uid===n)return s;if(s.children&&s.children.length>0){var o=e(s.children,n);if(o)return o}}}catch(e){a.e(e)}finally{a.f()}return null}(we.data.content,t.deptUid);return n?(0,W.jsx)(P.Z,{color:"green",children:s(n.name)}):""}},{title:(0,W.jsx)(B.FormattedMessage,{id:"roles",defaultMessage:"Roles"}),dataIndex:"roleUids",hideInSearch:!0,width:180,tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.roles.tooltip",defaultMessage:"成员拥有的角色，决定其系统权限"}),render:function(e,t){var n=t.roleUids.filter((function(e){return""!==e})).map((function(e){var t=Ze.find((function(t){return t.uid===e}));return t?s(t.name):""}));return(0,W.jsx)(W.Fragment,{children:n.map((function(e,t){return e&&(0,W.jsx)(P.Z,{color:"blue",style:{margin:"2px"},children:e},t)}))})}},{title:(0,W.jsx)(B.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,hideInSearch:!0,sorter:!0,valueType:"dateTime",tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.createdAt.tooltip",defaultMessage:"成员创建或添加的时间"})},{title:(0,W.jsx)(B.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0,valueType:"dateTime",tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.updatedAt.tooltip",defaultMessage:"成员信息最后更新的时间"})}]),Be=[].concat(v()(Oe),[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",tooltip:(0,W.jsx)(B.FormattedMessage,{id:"member.actions.tooltip",defaultMessage:"对成员可执行的操作，如编辑、删除等"}),render:function(e,t,r,a){var s,o;return[(0,W.jsx)("a",{onClick:function(){console.log("editable:",t),Je(t)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!(null!=t&&null!==(s=t.user)&&void 0!==s&&s.superUser)&&(null==t||null===(o=t.user)||void 0===o?void 0:o.uid)!==(null==fe?void 0:fe.uid)&&(0,W.jsx)(T.Z,{title:n.formatMessage({id:"deleteTip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.nickname,"】？"),onConfirm:function(){return Le(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,W.jsx)(E.ZP,{type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),Ae=function(){var e=m()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Me(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),He=function(){var e=m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:null==ce?void 0:ce.uid,orgAndPlatform:!0},e.next=4,(0,G.E9)(t);case 4:n=e.sent,console.log("queryRolesByOrg response ",n),200===n.code?(K.yw.destroy(),n.data.content.forEach((function(e){Ze.find((function(t){return t.uid===e.uid}))||De((function(t){return[].concat(v()(t),[e])}))}))):(K.yw.destroy(),K.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=m()(c()().mark((function e(r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!d){e.next=9;break}return e.next=4,(0,M.hS)(r);case 4:a=e.sent,console.log("updateMember:",a),200===a.code?(K.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),t.current.reload(),Ye()):K.yw.error(a.message),e.next=14;break;case 9:return e.next=11,(0,M.D$)(r);case 11:s=e.sent,console.log("createMember:",s),200===s.code?(K.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),t.current.reload(),Ye()):K.yw.error(s.message);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,orgUid:null==ce?void 0:ce.uid},e.next=3,(0,J.dF)(t);case 3:n=e.sent,console.log("queryDepartmentsByOrg:",n,t),200===n.code?je(n):K.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=m()(c()().mark((function e(r){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete mem:",r),e.next=3,(0,M.EP)(r);case 3:a=e.sent,console.log("deleteMember:",a),200===a.code?(K.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):K.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We={selectedRowKeys:Re,onChange:function(e,t){Ue(e),ze(t)},getCheckboxProps:function(e){var t,n;return{disabled:(null==e||null===(t=e.user)||void 0===t?void 0:t.superUser)||(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)===(null==fe?void 0:fe.uid),name:e.nickname}}};(0,a.useEffect)((function(){He()}),[]),(0,a.useEffect)((function(){t.current.reload()}),[me]);var Qe,$e=function(){var e=m()(c()().mark((function e(t,n,a){var s,o,u,d,f,m,p,g,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return",{});case 3:return r.current=!0,K.yw.loading("正在加载"),o=t.current,u=t.pageSize,d=l()(t,X),ne(d),q(o),A(u),f=void 0,m=void 0,n&&Object.keys(n).length>0&&(p=Object.keys(n)[0],f=p,m="ascend"===n[p]?"ascend":"descend"),g=i()(i()({pageNumber:o-1,pageSize:u,orgUid:null==ce?void 0:ce.uid,deptUid:(null==me?void 0:me.uid)===I.zBg?"":null==me?void 0:me.uid,subDeptUids:(null==me||null===(s=me.children)||void 0===s?void 0:s.map((function(e){return e.uid})))||[]},d),{},{sortBy:f,sortDirection:m}),e.next=15,(0,M.z_)(g);case 15:return h=e.sent,console.log("queryMembersByOrg:",g,h),200===h.code?Ne(h.data.totalElements):K.yw.error(h.message),r.current=!1,K.yw.destroy(),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 21:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),_e=function(){oe(void 0),f(!1),de(!0)},Je=function(e){oe(e),f(!0),de(!0)},Ye=function(){de(!1)},Xe=function(){var e=m()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r,te),a=localStorage.getItem(I.LA8),s=i()(i()({orgUid:(null==ce?void 0:ce.uid)||"",accessToken:a||"",exportType:t},te),{},{deptUid:(null==me?void 0:me.uid)===I.zBg?"":null==me?void 0:me.uid}),"current"===t?(s.pageNumber=String(b-1),s.pageSize=String(O)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,$.kG)()+"/api/v1/member/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),et=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Xe("range",r,n)}})},s=0;s<r;s++)a();return t},tt=function(){var e=m()(c()().mark((function e(){var r,a,s,o,i,u,l,d,f,m;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ee.length){e.next=3;break}return K.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"请先选择要删除的项目"})),e.abrupt("return");case 3:if(a=Ee.filter((function(e){var t,n;return!(null!=e&&null!==(t=e.user)&&void 0!==t&&t.superUser)&&(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)!==(null==fe?void 0:fe.uid)})),0!==a.length){e.next=7;break}return K.yw.warning(n.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"选中的都是超级用户或当前登录用户，无法删除"})),e.abrupt("return");case 7:a.length<Ee.length&&(s=Ee.filter((function(e){var t;return null==e||null===(t=e.user)||void 0===t?void 0:t.superUser})).length,o=Ee.filter((function(e){var t;return(null==e||null===(t=e.user)||void 0===t?void 0:t.uid)===(null==fe?void 0:fe.uid)})).length,i=n.formatMessage({id:"batch.delete.containsSpecialUsers",defaultMessage:"选中的 {total} 项中包含 {skippedCount} 项无法删除"},{total:Ee.length,skippedCount:Ee.length-a.length}),s>0&&o>0?i+=n.formatMessage({id:"batch.delete.superAndCurrentUsers",defaultMessage:"（包括 {superCount} 个超级用户和当前登录用户）"},{superCount:s}):s>0?i+=n.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"（{superCount} 个超级用户）"},{superCount:s}):o>0&&(i+=n.formatMessage({id:"batch.delete.currentUser",defaultMessage:"（当前登录用户）"})),K.yw.warning(i)),K.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),u=0,l=0,d=g()(a),e.prev=12,d.s();case 14:if((f=d.n()).done){e.next=28;break}return m=f.value,e.prev=16,e.next=19,(0,M.EP)(m);case 19:200===e.sent.code?u++:l++,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(16),l++;case 26:e.next=14;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(12),d.e(e.t1);case 33:return e.prev=33,d.f(),e.finish(33);case 36:K.yw.destroy(),0===l?K.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:u})):K.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"已删除 {success} 项，{fail} 项删除失败"},{success:u,fail:l})),Ue([]),ze([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 41:case"end":return e.stop()}}),e,null,[[12,30,33,36],[16,23]])})));return function(){return e.apply(this,arguments)}}();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(F.Z,{columns:Be,actionRef:t,cardBordered:!0,rowSelection:We,request:$e,rowKey:"uid",scroll:{x:1800},search:{labelWidth:"auto"},pagination:{pageSize:O,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){q(e),A(t)}},headerTitle:null!=me&&null!==(Qe=me.name)&&void 0!==Qe&&Qe.startsWith("i18n.")?n.formatMessage({id:null==me?void 0:me.name,defaultMessage:null==me?void 0:me.name}):null==me?void 0:me.name,toolBarRender:function(){var e=[(0,W.jsx)(E.ZP,{icon:(0,W.jsx)(j.Z,{}),type:"primary",onClick:_e,children:n.formatMessage({id:"create.member",defaultMessage:"创建成员"})},"create")],t=[];Re.length>0&&t.push({key:"batchDelete",icon:(0,W.jsx)(k.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Re.length,")"),onClick:function(){R.Z.confirm({title:n.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确认删除选中的"})," ").concat(Re.length," ").concat(n.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:tt,okText:n.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"取消"})})}});var r=[{key:"import",icon:(0,W.jsx)(S.Z,{}),label:n.formatMessage({id:"import",defaultMessage:"导入"}),onClick:Ae},{key:"export-current",icon:(0,W.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Xe("current")}}];return Ve>0&&(Ve<=1e3?r.push({key:"export-all",icon:(0,W.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ve,"条)"),onClick:function(){return Xe("all")}}):r.push({key:"export-range",icon:(0,W.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ve,"条)"),children:et(Ve)})),r.push({key:"download",icon:(0,W.jsx)(D.Z,{}),label:n.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,$.$E)()}}),e.push((0,W.jsx)(z.Z,{menu:{items:r},placement:"bottom",children:(0,W.jsxs)(E.ZP,{type:"primary",children:[n.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,W.jsx)(C.Z,{})]})},"importExport")),t.length>0&&e.push((0,W.jsx)(z.Z,{menu:{items:t},placement:"bottom",children:(0,W.jsxs)(E.ZP,{type:Re.length>0?"primary":"default",danger:Re.length>0,children:[Re.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Re.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,W.jsx)(C.Z,{})]})},"batchOperations")),e}}),le&&(0,W.jsx)(Q,{isEdit:d,member:se,open:le,onClose:Ye,onSubmit:Ke}),xe&&(0,W.jsx)(_.Z,{type:I.zey,acceptType:".xls,.xlsx,.csv",isModalOpen:xe,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Me(!1),Ge(),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),Me(!1),null==t||t.current.reload()}}),he]})},te=n(27487),ne=n(79777),re=n(15722),ae=n(82669),se=n(80556),oe=n(59304),ie=n(32350),ue=n(16309),le=function(e){var t=e.open,n=e.isEdit,r=e.department,s=e.onCancel,o=e.onSubmit,i=ue.Z.useForm(),u=x()(i,1)[0],l=(0,B.useIntl)(),d=(0,a.useState)(""),f=x()(d,2),p=f[0],g=f[1],h=(0,y.H)((function(e){return e.departmentResult})),v=(0,w.u)((function(e){return e.currentOrg})),b=(0,L.Z)().translateString,M=(0,a.useRef)(null);(0,a.useEffect)((function(){t&&n?(u.setFieldsValue({uid:null==r?void 0:r.uid,parentUid:null==r?void 0:r.parentUid,name:b(null==r?void 0:r.name),description:null==r?void 0:r.description}),console.log("useEffect:",p)):u.resetFields()}),[t]);var j=function e(t,n){var r;if(null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=l.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name||"",n.value=t.uid||"",t.children)for(var a=0;a<t.children.length;a++){e(t.children[a],{title:"",value:"",children:[]})}},k=(0,a.useMemo)((function(){for(var e=[],t=0;t<h.data.content.length;t++)if(h.data.content[t].name!==I.zBg){var n={title:"",value:"",children:[]};j(h.data.content[t],n),e.push(n)}return e}),[h]),S=function(){u.validateFields().then(function(){var e=m()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==r?void 0:r.uid:"",name:t.name,description:t.description,parentUid:p||void 0,orgUid:null==v?void 0:v.uid},console.log("handleSaveDep:",t,a),o(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),K.yw.error("创建部门失败")}))};return(0,W.jsx)("div",{children:(0,W.jsx)(R.Z,{title:"创建部门",open:t,forceRender:!0,onOk:S,onCancel:s,children:(0,W.jsxs)(q.A,{form:u,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,W.jsx)(V.Z,{label:"上级部门",name:"parentUid",allowClear:!0,fieldProps:{treeData:k,placeholder:"请选择上级部门(可选)",allowClear:!0,treeDefaultExpandAll:!0,onChange:function(e){console.log("onParentSelectChange:",e),g(e||"")},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,W.jsx)(N.Z,{label:"部门名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(){M.current&&M.current.focus()}}}),(0,W.jsx)(ie.Z,{label:"部门简介",name:"description",fieldProps:{ref:M,onPressEnter:function(e){e.preventDefault(),S()}}})]})})})},de=function(){var e=(0,B.useIntl)(),t=(0,a.useState)(!1),n=x()(t,2),r=n[0],s=n[1],o=(0,a.useState)(!1),i=x()(o,2),u=i[0],l=i[1],d=(0,w.u)((function(e){return e.currentOrg})),f=R.Z.useModal(),p=x()(f,2),g=p[0],h=p[1],v=(0,a.useState)(!1),b=x()(v,2),M=b[0],j=b[1],S=(0,y.H)((function(e){return{currentDepartment:e.currentDepartment,departmentResult:e.departmentResult,insertDepartment:e.insertDepartment,upgradeDepartment:e.upgradeDepartment,removeDepartment:e.removeDepartment,setCurrentDepartment:e.setCurrentDepartment,setDepartmentResult:e.setDepartmentResult,setCurrentDepUid:e.setCurrentDepUid}})),Z=S.currentDepartment,D=S.departmentResult,F=S.insertDepartment,U=S.upgradeDepartment,P=S.removeDepartment,T=S.setCurrentDepartment,q=S.setDepartmentResult,V=S.setCurrentDepUid,N=function(){var t=m()(c()().mark((function t(n){var r;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleDeleteDept",n),K.yw.loading(e.formatMessage({id:"deleting"})),t.next=4,(0,J.If)(n);case 4:r=t.sent,console.log("handleDeleteDept:",r),200===r.code?(K.yw.destroy(),K.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),P(null==n?void 0:n.uid),s(!1)):(K.yw.destroy(),K.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=function t(n,r){var a,s="";if(s=null!==(a=n.name)&&void 0!==a&&a.startsWith(I.VoP)?e.formatMessage({id:n.name,defaultMessage:n.name}):n.name||"",void 0!==n.memberCount&&null!==n.memberCount&&n.memberCount>=0?s="".concat(s," (").concat(n.memberCount,")"):null!==n.memberCount&&void 0!==n.memberCount||(s="".concat(s," (0)")),r.title=s,r.key=n.uid||"",n.children)for(var o=0;o<n.children.length;o++){var i={title:"",key:"",children:[]};t(n.children[o],i),r.children.push(i)}},A=(0,a.useMemo)((function(){var t=[],n=0;D.data.content&&D.data.content.forEach((function(e){if(e.uid!==I.zBg){var t,r=null!==(t=e.memberCount)&&void 0!==t?t:0;n+=r}}));for(var r=0;r<D.data.content.length;r++){var a={title:"",key:"",children:[]};if(D.data.content[r].uid===I.zBg){var s=e.formatMessage({id:"allDept",defaultMessage:"全部"});s="".concat(s," (").concat(n,")"),a.title=s,a.key=I.zBg}else O(D.data.content[r],a);t.push(a)}return t}),[D]),H=function(){var e=m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),t={pageNumber:0,pageSize:100,orgUid:null==d?void 0:d.uid},e.next=4,(0,J.dF)(t);case 4:n=e.sent,console.log("queryDepartmentsByOrg:",n,t),200===n.code?q(n):K.yw.error(n.message),j(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){H()}),[]);var G=function(){var t=m()(c()().mark((function t(n){var r;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleCreateDept",n),K.yw.loading(e.formatMessage({id:"creating"})),t.next=4,(0,J.v$)(n);case 4:r=t.sent,console.log("createDepartment:",r),200===r.code?(K.yw.destroy(),K.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),F(r.data),T(r.data),s(!1),H()):(K.yw.destroy(),K.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=function(){var t=m()(c()().mark((function t(n){var r;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return K.yw.loading(e.formatMessage({id:"updating"})),t.next=3,(0,J.j4)(n);case 3:r=t.sent,console.log("handleUpdateDept:",n,r),200===r.code?(K.yw.destroy(),K.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),T(r.data),U(r.data),s(!1),H()):(K.yw.destroy(),K.yw.error(r.message));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(te.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,W.jsxs)(te.Z,{gap:"small",children:[(0,W.jsx)(E.ZP,{type:"primary",size:"small",icon:(0,W.jsx)(ae.Z,{}),onClick:function(){console.log("new dep"),l(!1),s(!0)},children:e.formatMessage({id:"createDept",defaultMessage:"createDepartment"})}),(0,W.jsx)(E.ZP,{size:"small",icon:(0,W.jsx)(se.Z,{spin:M}),onClick:H,loading:M,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})})]}),(null==Z?void 0:Z.uid)&&(null==Z?void 0:Z.uid)!==I.zBg&&(0,W.jsx)(z.Z,{menu:{items:[{key:"edit",icon:(0,W.jsx)(oe.Z,{}),label:e.formatMessage({id:"edit",defaultMessage:"Edit"}),onClick:function(){console.log("edit role"),l(!0),s(!0)}},{key:"delete",icon:(0,W.jsx)(k.Z,{}),label:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"}),danger:!0,onClick:function(){return t=Z,void g.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,W.jsx)(re.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){N(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t}}]},children:(0,W.jsx)(E.ZP,{size:"small",icon:(0,W.jsx)(C.Z,{})})})]}),(0,W.jsx)(ne.Z,{defaultSelectedKeys:[(null==Z?void 0:Z.uid)||I.zBg],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&V(e[0].toString())},treeData:A,blockNode:!0}),r&&(0,W.jsx)(le,{open:r,isEdit:u,department:Z,onCancel:function(){s(!1)},onSubmit:function(e){u?L(e):G(e)}}),h]})},ce=r.Z.Sider,fe=r.Z.Content,me=function(){var e=(0,s.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,a=e.contentStyle;return(0,W.jsxs)(r.Z,{children:[(0,W.jsx)(ce,{width:n,style:t,children:(0,W.jsx)(de,{})}),(0,W.jsx)(r.Z,{children:(0,W.jsx)(fe,{style:a,children:(0,W.jsx)(ee,{})})})]})}},6397:function(e,t,n){n.d(t,{j:function(){return c}});var r=n(73193),a=n.n(r),s=n(76711),o=n.n(s),i=n(55735),u=n(44435),l=n(83642),d=n(83890),c=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var r=t().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[n],o()(r.slice(s+1))),u=a()(a()({},t().kbaseResult),{},{data:{content:i}});e({kbaseResult:u,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var r=t().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===n}));-1!==s?e({kbaseResult:a()(a()({},t().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))},53782:function(e,t,n){n.d(t,{H:function(){return m}});var r=n(86222),a=n.n(r),s=n(76711),o=n.n(s),i=n(73193),u=n.n(i),l=n(55735),d=n(44435),c=n(83642),f=n(83890),m=(0,d.Ue)()((0,c.mW)((0,c.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:l.zBg,nickname:l.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,a={uid:l.zBg,name:l.zBg};(e({departmentResult:u()(u()({},n),{},{data:{content:[a].concat(o()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(o()(r.slice(0,a)),[n],o()(r.slice(a+1))),i=u()(u()({},t().departmentResult),{},{data:{content:s}});e({departmentResult:i,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,s,o=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(o)e({currentDepartment:o});else{!function t(r){var s,o=a()(r);try{for(o.s();!(s=o.n()).done;){var i=s.value;if(i.uid===n)return void e({currentDepartment:i});i.children&&i.children.length>0&&t(i.children)}}catch(e){o.e(e)}finally{o.f()}}((null===(s=t().departmentResult)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:l.xY_})))}}]);