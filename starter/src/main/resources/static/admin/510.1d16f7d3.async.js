"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[510],{51146:function(e,t,n){n.d(t,{G9:function(){return k},J$:function(){return S},N6:function(){return w},VM:function(){return d},c8:function(){return p},gF:function(){return x},rg:function(){return m},sF:function(){return y}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),l=n.n(i),u=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11591:function(e,t,n){n.d(t,{Bv:function(){return A},L0:function(){return C},QB:function(){return w},RF:function(){return k},YO:function(){return S},YQ:function(){return T},Yg:function(){return x},kh:function(){return p},kv:function(){return y},pf:function(){return d},y:function(){return m}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),l=n.n(i),u=n(6844),c=n(19736);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/deleteAll",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return U.apply(this,arguments)}function U(){return(U=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return I.apply(this,arguments)}function I(){return(I=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return E.apply(this,arguments)}function E(){return(E=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/agent/text/faq-similar-questions",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},53816:function(e,t,n){var r=n(73193),a=n.n(r),s=n(93527),o=n(26710),i=n(65819),l=n(6844),u=n(19736),c=n(53411),d=(n(90744),n(96596)),f=n.n(d),p=n(44194),g=n(31549);t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,d=e.style,m=e.toolbarKeys,h=e.maxLength,x=e.onChange,v=e.options,y=(0,u.useIntl)(),M=(0,o.Z)().isDarkMode,w=(0,p.useRef)(null),b=(0,p.useRef)(null),k=(0,p.useRef)(!1),j=(0,p.useRef)(x);(0,p.useEffect)((function(){j.current=x}),[x]);var S=function(e,t,n){"function"!=typeof j.current||k.current||j.current(e,t,n)};return(0,p.useEffect)((function(){if(w.current){if(!b.current){var e=new c.cW(a()(a()({element:w.current,theme:M?"dark":"light",placeholder:t,content:n,toolbarKeys:m},v||{}),{},{image:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("orgUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,i.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",o),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",l.QPQ),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){var t=e.getText(),n=t.length,r="number"==typeof h?h:Number.POSITIVE_INFINITY;if(n>r){var a,o;s.yw.warning(y.formatMessage({id:"character.limit.reached"},{limit:r})||"已达到 ".concat(r," 字符限制"));var i=t.substring(0,r);k.current=!0,setTimeout((function(){b.current&&b.current.setContent(i),k.current=!1}),0),S((null===(a=b.current)||void 0===a?void 0:a.getHtml())||"",(null===(o=b.current)||void 0===o?void 0:o.getMarkdown())||"",i)}else S(e.getHtml(),e.getMarkdown(),e.getText())}}));b.current=e}return function(){b.current&&(b.current.destroy(),b.current=null)}}}),[]),(0,p.useEffect)((function(){b.current&&void 0!==r&&r!==b.current.getHtml()&&(k.current=!0,b.current.setContent(r||"",!1),requestAnimationFrame((function(){k.current=!1})))}),[r]),(0,g.jsx)("div",{ref:w,style:a()({height:"100%"},d)})}},27942:function(e,t,n){n.d(t,{Z:function(){return A}});var r=n(76711),a=n.n(r),s=n(73193),o=n.n(s),i=n(90819),l=n.n(i),u=n(89933),c=n.n(u),d=n(45332),f=n.n(d),p=n(93527),g=n(46141),m=n(3925),h=n(61353),x=n(19736),v=n(44194),y=n(35912),M=n(6844),w=n(95702),b=n(10162),k=n(20921),j=n(29589),S=n(48907),Z=n(31549),C="CREATE_NEW_ROBOT",U=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,s=e.currentKbaseUid,o=e.onOk,i=e.onCancel,l=e.onChange,u=(0,x.useIntl)();return(0,Z.jsx)(g.Z,{title:u.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:o,onCancel:i,okText:u.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:u.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,Z.jsx)(k.Z,{spinning:n,children:(0,Z.jsxs)("div",{style:{marginBottom:16},children:[(0,Z.jsx)("p",{children:u.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,Z.jsxs)(j.Z,{style:{width:"100%"},placeholder:u.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:l,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(s));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===s,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,Z.jsx)(j.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,Z.jsx)(j.Z.Option,{value:"divider",disabled:!0,children:(0,Z.jsx)(S.Z,{style:{margin:"4px 0"}})}),(0,Z.jsx)(j.Z.Option,{value:C,label:u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,Z.jsxs)("div",{style:{color:"#1890ff"},children:[(0,Z.jsx)(b.Z,{})," ",u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},A=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,s=e.checkingEmbeddingModel,i=(0,x.useIntl)(),u=(0,v.useState)(!1),d=f()(u,2),b=d[0],k=d[1],j=(0,v.useState)(!1),S=f()(j,2),A=S[0],I=S[1],T=(0,v.useState)(!1),E=f()(T,2),P=E[0],O=E[1],q=(0,v.useState)(),F=f()(q,2),D=(F[0],F[1]),R=(0,v.useState)([]),L=f()(R,2),z=L[0],Y=L[1],B=(0,v.useState)(""),N=f()(B,2),V=N[0],H=N[1],J=function(){var e=c()(l()().mark((function e(r){var a,s,o,u;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),e.prev=1,a={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:M.whQ,type:M.f4h,orgUid:null==n?void 0:n.uid},e.next=5,(0,y.p0)(a);case 5:if(s=e.sent,console.log("queryRobotsByOrg response:",s,a),200!==s.code){e.next=15;break}return o=(null==s?void 0:s.data.content)||[],u=o.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),Y(u),r&&u.length>0&&D(u[0]),e.abrupt("return",u);case 15:return p.yw.error(s.message),e.abrupt("return",[]);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),p.yw.error(i.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 24:return e.prev=24,O(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,19,24,27]])})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=c()(l()().mark((function e(){var n,r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V&&null!=t&&t.uid){e.next=3;break}return p.yw.error(i.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return p.yw.loading(i.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:V,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,y.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r,n),200!==r.code){e.next=18;break}return p.yw.destroy(),p.yw.success(i.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=null==r?void 0:r.data,D(a),e.abrupt("return",!0);case 18:return p.yw.destroy(),p.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),p.yw.destroy(),p.yw.error(i.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=c()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),r){e.next=4;break}return g.Z.confirm({title:i.formatMessage({id:"warning",defaultMessage:"警告"}),content:i.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:i.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=c()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 4:if(!s){e.next=7;break}return p.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 7:return e.next=9,K();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=c()(l()().mark((function e(){var n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return p.yw.error(i.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 3:return p.yw.loading(i.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=6,J(!0);case 6:if(n=e.sent,p.yw.destroy(),!(n.length>0)){e.next=12;break}n.length>1?(Y(n),H(""),k(!0)):G(n[0]),e.next=21;break;case 12:return e.next=14,J(!1);case 14:if(r=e.sent,console.log("All robots without kbase filter:",r),0!==r.length){e.next=19;break}return p.yw.info(i.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 19:H(""),k(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:M.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else p.yw.error(i.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},W=function(){var e=c()(l()().mark((function e(){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V){e.next=3;break}return p.yw.error(i.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=z.find((function(e){return e.uid===V})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return g.Z.confirm({title:i.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:i.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:i.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:i.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=c()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X();case 2:e.sent&&(k(!1),G(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,X();case 9:e.sent&&(k(!1),n&&G(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=c()(l()().mark((function e(n){var r,s,u,c;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.yw.loading(i.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=o()(o()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,y.lg)(r);case 7:if(s=e.sent,console.log("Create robot response:",s),200!==s.code){e.next=29;break}if(p.yw.destroy(),p.yw.success(i.formatMessage({id:"create.success",defaultMessage:"创建成功"})),I(!1),u=null==s?void 0:s.data,console.log("New robot data:",u),null==u||!u.uid){e.next=23;break}H(u.uid),D(u),Y((function(e){var t=[u].concat(a()(e));return console.log("Updated robot list:",t),t})),k(!1),G(u),e.next=27;break;case 23:return e.next=25,J(!1);case 25:c=e.sent,console.log("Fetched all robots after creation:",c);case 27:e.next=31;break;case 29:p.yw.destroy(),p.yw.error(s.message||i.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),p.yw.destroy(),p.yw.error(i.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(m.ZP,{icon:(0,Z.jsx)(h.Z,{}),type:"primary",onClick:Q,disabled:s,children:i.formatMessage({id:"chat.test"})}),(0,Z.jsx)(U,{visible:b,loading:P,robotList:z,selectedRobotUid:V,currentKbaseUid:null==t?void 0:t.uid,onOk:W,onCancel:function(){return k(!1)},onChange:function(e){e===C?(I(!0),H("")):H(e)}}),A&&(0,Z.jsx)(w.Z,{open:A,onClose:function(){return I(!1)},onSubmit:_})]})}},84905:function(e,t,n){var r=n(45332),a=n.n(r),s=n(44679),o=n(56773),i=n(14888),l=n(28506),u=n(65819),c=n(61689),d=n(9428),f=n(3925),p=n(20921),g=n(44194),m=n(31549);t.Z=function(e){var t=e.type,n=e.open,r=e.onClose,h=(0,s.Z)().translateString,x=(0,o.j)((function(e){return e.currentKbase})),v=(0,l.L)((function(e){return e.userInfo})),y=(0,i.u)((function(e){return e.currentOrg})),M=(0,g.useState)(""),w=a()(M,2),b=w[0],k=w[1],j=(0,g.useState)(!1),S=a()(j,2),Z=S[0],C=S[1],U=function(){console.log("refresh"),C(!1);var e=(0,u.Cn)()+"?org="+encodeURIComponent(null==y?void 0:y.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==x?void 0:x.uid)+"&uid="+encodeURIComponent(null==v?void 0:v.uid)+"&nickname="+encodeURIComponent(null==v?void 0:v.nickname)+"&avatar="+encodeURIComponent(null==v?void 0:v.avatar)+"&navbar=0&"+(new Date).getTime();k(e)};(0,g.useEffect)((function(){U()}),[x]);return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(c.Z,{title:h(null==x?void 0:x.name),onClose:function(){r&&r()},open:n,extra:(0,m.jsxs)(d.Z,{children:[(0,m.jsx)(f.ZP,{onClick:function(){window.open(b)},children:"新窗口"}),(0,m.jsx)(f.ZP,{onClick:function(){console.log("restart"),U()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,m.jsx)(p.Z,{spinning:!Z,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,m.jsx)("iframe",{id:"chat-iframe",src:b,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){C(!0),console.log("Iframe loaded successfully!")}})]})})}},27858:function(e,t,n){n.d(t,{w:function(){return x}});var r=n(90819),a=n.n(r),s=n(89933),o=n.n(s),i=n(45332),l=n.n(i),u=n(44194),c=n(53229),d=n(93189),f=n(46141),p=n(19736),g=n(51146),m=n(6015),h=n(31549),x=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)d.ZP.info("正在检查模型状态，请稍后再试");else{var r=m.A.getState().llmproviderConfigDefault.defaultEmbeddingProvider,a=m.A.getState().llmproviderConfigDefault.defaultEmbeddingModel,s="ollama"===r;s?t?e():(0,g.J$)({model:a}).then((function(t){if(404===t.code)return console.log("API 返回 404，不影响操作，直接执行"),void e();var n="请首先拉取Embedding向量模型".concat(a,"，用于知识库向量检索");f.Z.warning({title:"嵌入式模型缺失",content:n,okText:"确定"})})).catch((function(t){console.error("重新检查模型时出错:",t),console.log("API 调用异常，不影响操作，直接执行"),e()})):e()}};t.Z=function(e){var t=e.onModelStatusChange,n=(0,p.useIntl)(),r=(0,u.useState)(!1),s=l()(r,2),i=s[0],d=s[1],f=(0,u.useState)(!1),x=l()(f,2),v=x[0],y=x[1],M=(0,m.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingModel})),w=(0,m.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingProvider})),b=(0,u.useState)(!1),k=l()(b,2),j=k[0],S=k[1],Z=function(){return"ollama"===w},C=function(){var e=o()(a()().mark((function e(){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("检查嵌入式模型是否存在:",{defaultEmbeddingModel:M,defaultEmbeddingProvider:w}),Z()){e.next=5;break}return console.log("不需要检查模型：",{defaultEmbeddingModel:M,defaultEmbeddingProvider:w}),null==t||t(!0),e.abrupt("return");case 5:return e.prev=5,y(!0),null==t||t(!1),e.next=10,(0,g.J$)({model:M});case 10:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(d(null==n?void 0:n.data),null==t||t(null==n?void 0:n.data),S(!1)):404===n.code?(d(!0),null==t||t(!0),S(!1),console.log("接口404，不影响使用，视为模型存在")):(d(!1),null==t||t(!1),S(!1)),e.next=22;break;case 15:e.prev=15,e.t0=e.catch(5),console.error("检查嵌入式模型失败:",e.t0),d(!0),null==t||t(!0),S(!1),console.log("接口异常，不影响使用，视为模型存在");case 22:return e.prev=22,y(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[5,15,22,25]])})));return function(){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){C()}),[M,w]),Z()?v?(0,h.jsx)(c.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):i?j?(0,h.jsx)(c.Z,{type:"warning",showIcon:!0,message:(0,h.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,h.jsx)("span",{children:"嵌入模型配置警告"})}),description:"嵌入模型 ".concat(M," 不存在或无法访问，可能会影响知识库向量检索功能，请检查配置或联系管理员"),style:{marginBottom:16}}):null:(0,h.jsx)(c.Z,{type:"warning",showIcon:!0,message:(0,h.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,h.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型".concat(M,"，用于知识库向量检索")}),style:{marginBottom:16}}):null}},54605:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),s=(n(44194),n(87373)),o=n(6844),i=n(96596),l=n.n(i),u=n(36125),c=n(93527),d=n(65819),f=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},p={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=t,i.fileType=e.type,u.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t,a=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(a),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(s.Z,a()(a()({},p),{},{children:t}))}},27839:function(e,t,n){n.d(t,{Z:function(){return Ae}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(6844),x=n(19736);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/update",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/delete",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/delete/all",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/chunk/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return q.apply(this,arguments)}function q(){return q=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}var F=n(84905),D=n(47598),R=n(56773),L=n(14888),z=n(14695),Y=n(67412),B=n(46141),N=n(5089),V=n(31543),H=n(3925),J=n(66810),X=n(77359),Q=n(71277),K=n(44194),G=n(96596),W=n.n(G),_=n(44679),$=n(65819),ee=n(90104),te=n(76711),ne=n.n(te),re=n(11591),ae=n(58087),se=n(10162),oe=n(55785),ie=n(14377),le=n(30064),ue=n(68263),ce=n(86684),de=n(93312),fe=n(13847),pe=n(61689),ge=n(9428),me=n(48769),he=n(71876),xe=n(1691),ve=n(31549),ye=function(e){var t=e.isEdit,n=e.chunk,r=e.open,a=e.onClose,s=e.onSubmit,i=le.A.useForm(),l=g()(i,1)[0],u=(0,x.useIntl)(),d=(0,L.u)((function(e){return e.currentOrg})),p=(0,R.j)((function(e){return e.currentKbase})),h=(0,D.v)((function(e){return e.currentCategory})),v=(0,D.v)((function(e){return e.categorySelectOptions})),y=(0,K.useState)(),M=g()(y,2),w=M[0],b=M[1],k=(0,K.useState)([]),j=g()(k,2),S=j[0],Z=j[1],C=(0,K.useState)(!1),U=g()(C,2),A=U[0],I=U[1],T=(0,K.useState)(""),E=g()(T,2),P=E[0],q=E[1],F=(0,K.useState)(!1),z=g()(F,2),Y=z[0],B=z[1],V=(0,K.useState)([]),X=g()(V,2),Q=X[0],G=X[1],W=(0,K.useState)(new Set),_=g()(W,2),$=_[0],ee=_[1],te=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ye=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,B(!0),e.next=4,l.validateFields();case 4:t=e.sent,r=o()(o()(o()({},n),t),{},{categoryUid:w,tagList:te(S),kbUid:null==p?void 0:p.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",r),s(r),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),m.yw.error("请检查表单填写是否正确");case 14:return e.prev=14,B(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=P.trim();e&&!S.includes(e)&&Z([].concat(ne()(S),[e])),I(!1),q("")},we=function(){I(!1),q("")},be=function(){var e=f()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.getFieldValue("name"),n=l.getFieldValue("content"),t&&n){e.next=5;break}return m.yw.warning("请先填写名称和内容"),e.abrupt("return");case 5:return B(!0),e.prev=6,r={name:t,content:n,orgUid:null==d?void 0:d.uid},e.next=10,O(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(m.yw.success("常见问题生成成功"),G(null==a?void 0:a.data),ee(new Set)):(G([]),m.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),m.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,B(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=f()(c()().mark((function e(t,n){var r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!$.has(n)){e.next=4;break}return m.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=o()(o()({},t),{},{categoryUid:null==h?void 0:h.uid,kbUid:null==p?void 0:p.uid,orgUid:null==d?void 0:d.uid,type:"TEXT"}),m.yw.loading("正在保存常见问题..."),e.next=8,(0,re.kh)(r);case 8:200===(a=e.sent).code?((s=new Set($)).add(n),ee(s),m.yw.success("常见问题保存成功")):m.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),m.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,K.useEffect)((function(){if(t&&n)l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid,enabled:void 0===(null==n?void 0:n.enabled)||n.enabled}),b(null==n?void 0:n.categoryUid),Z(te((null==n?void 0:n.tagList)||[]));else{if(l.setFieldsValue({name:"",content:"",enabled:!0}),v&&v.length>0){var e=v[0].value;l.setFieldValue("categoryUid",e),b(e)}Z([]),I(!1),q("")}G([]),ee(new Set)}),[t,n,l,v]),(0,ve.jsx)(pe.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,ve.jsxs)(ge.Z,{children:[(0,ve.jsx)(H.ZP,{onClick:a,children:"取消"}),(0,ve.jsx)(H.ZP,{onClick:ye,type:"primary",children:"保存"}),(0,ve.jsx)(H.ZP,{onClick:be,type:"default",loading:Y,icon:(0,ve.jsx)(ae.Z,{}),children:"智能生成常见问题"})]}),children:(0,ve.jsxs)(le.A,{form:l,name:"chunkForm",submitter:!1,children:[(0,ve.jsx)(ue.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:v,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("chunk category selected ".concat(e)),b(e)}}}),(0,ve.jsx)(ce.Z,{label:u.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0,message:"请输入名称"}],placeholder:"请输入拆分文档名称"}),(0,ve.jsx)(de.Z,{label:"启用状态",name:"enabled",checkedChildren:"启用",unCheckedChildren:"禁用",tooltip:"控制拆分文档是否在知识库中生效",fieldProps:{defaultChecked:!0}}),(0,ve.jsx)(fe.Z,{label:u.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0,message:"请输入内容"}],placeholder:"请输入拆分文档内容",fieldProps:{rows:6,maxLength:1e4,showCount:!0},tooltip:"拆分文档的文本内容，用于知识库检索"}),(0,ve.jsx)(le.A.Item,{label:"标签",name:"tagList",tooltip:"为拆分文档添加标签，便于分类和检索",children:(0,ve.jsxs)("div",{style:{minHeight:"32px"},children:[(0,ve.jsx)(ge.Z,{wrap:!0,style:{marginBottom:8},children:te(S).map((function(e,t){return(0,ve.jsx)(J.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void Z(te(S.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),A?(0,ve.jsxs)(ge.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)(me.Z,{value:P,onChange:function(e){q(e.target.value)},onKeyDown:function(e){"Enter"===e.key?Me():"Escape"===e.key&&we()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,ve.jsx)(H.ZP,{type:"primary",size:"small",icon:(0,ve.jsx)(oe.Z,{}),onClick:Me,disabled:!P.trim(),children:"保存"}),(0,ve.jsx)(H.ZP,{size:"small",icon:(0,ve.jsx)(ie.Z,{}),onClick:we,children:"取消"})]}):(0,ve.jsx)(H.ZP,{type:"dashed",onClick:function(){I(!0),q("")},icon:(0,ve.jsx)(se.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),Q.length>0&&(0,ve.jsxs)("div",{style:{marginTop:16},children:[(0,ve.jsx)(N.Z.Title,{level:5,children:"常见问题列表"}),(0,ve.jsx)(he.Z,{bordered:!0,dataSource:Q,renderItem:function(e,t){return(0,ve.jsx)(he.Z.Item,{actions:[(0,ve.jsx)(xe.Z,{title:$.has(t)?"已保存":"保存到常见问题库",children:(0,ve.jsx)(H.ZP,{type:$.has(t)?"default":"primary",icon:(0,ve.jsx)(oe.Z,{}),size:"small",disabled:$.has(t),onClick:function(){return ke(e,t)},children:$.has(t)?"已保存":"保存"})},"save")],children:(0,ve.jsx)(he.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})},Me=n(7358),we=n(77274),be=n(2484),ke=n(54881),je=n(58275),Se=n(11090),Ze=n(27858),Ce=n(27942),Ue=["current","pageSize"],Ae=function(e){var t=e.superUser,n=(0,x.useIntl)(),r=(0,K.useRef)(),s=(0,_.Z)().translateString,i=(0,K.useState)(1),u=g()(i,2),d=u[0],p=u[1],y=(0,K.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,L.u)((function(e){return e.currentOrg})),A=(0,R.j)((function(e){return e.currentKbase})),T=(0,D.v)((function(e){return e.currentCategory})),P=(0,D.v)((function(e){return e.categorySelectOptions})),O=(0,K.useState)(!1),q=g()(O,2),G=q[0],te=q[1],ne=(0,K.useState)(!1),re=g()(ne,2),ae=re[0],se=re[1],oe=(0,K.useState)(),ie=g()(oe,2),le=ie[0],ue=ie[1],ce=(0,K.useState)([]),de=g()(ce,2),fe=de[0],pe=de[1],ge=(0,K.useState)([]),me=g()(ge,2),he=me[0],xe=me[1],Ae=(0,K.useState)(!1),Ie=g()(Ae,2),Te=Ie[0],Ee=Ie[1],Pe=(0,K.useState)(!1),Oe=g()(Pe,2),qe=Oe[0],Fe=Oe[1],De=(0,K.useState)({}),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,K.useState)(0),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=B.Z.useModal(),Je=g()(He,2),Xe=Je[0],Qe=Je[1],Ke=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0,fixed:"left"},{title:(0,ve.jsx)(x.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",ellipsis:!0,copyable:!0,fixed:"left",tooltip:n.formatMessage({id:"llm.chunk.name.tooltip",defaultMessage:"拆分后的内容块名称"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.name;null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)("span",{style:{marginRight:4},children:o}),(0,ve.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,copyable:!0,width:300,tooltip:n.formatMessage({id:"llm.chunk.content.tooltip",defaultMessage:"拆分后的内容块具体内容"}),render:function(e,t){var r=t.content||"-",a=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ee.TE)(t);case 2:e.sent.success?m.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):m.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ve.jsx)(V.Z,{content:(0,ve.jsxs)("div",{children:[(0,ve.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,ve.jsx)("span",{children:n.formatMessage({id:"chunk.content.preview",defaultMessage:"拆分内容预览"})}),(0,ve.jsx)(H.ZP,{type:"text",icon:(0,ve.jsx)(Me.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,ve.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:n.formatMessage({id:"chunk.content",defaultMessage:"拆分内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,ve.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.status.tooltip",defaultMessage:"拆分内容的处理状态，主要用于全文检索"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,ve.jsx)(J.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.vectorStatus.tooltip",defaultMessage:"拆分内容的向量化处理状态，主要用于向量存储和检索"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,ve.jsx)(J.Z,{color:a,icon:(0,ve.jsx)(we.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,tooltip:n.formatMessage({id:"llm.chunk.tags.tooltip",defaultMessage:"拆分内容的标签，用于分类和搜索"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,ve.jsx)(ve.Fragment,{children:null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,ve.jsx)(J.Z,{color:"blue",style:{marginBottom:4},children:e},e)}))}):"-"}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.category.tooltip",defaultMessage:"拆分内容所属的分类"}),render:function(e,t){var n=P.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,ve.jsx)(J.Z,{color:"blue",children:n.label}):(0,ve.jsx)(J.Z,{color:"default",children:"未分类"})}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:n.formatMessage({id:"enabled"}),status:"Success"},false:{text:n.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,width:100,tooltip:n.formatMessage({id:"llm.chunk.enabled.tooltip",defaultMessage:"拆分内容是否启用"})},{title:(0,ve.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.chunk.createdAt.tooltip",defaultMessage:"拆分内容创建的时间"}),render:function(e,t){return W()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,ve.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.chunk.updatedAt.tooltip",defaultMessage:"拆分内容最后更新的时间"}),render:function(e,t){return t.updatedAt?W()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Ge=function(){var e=f()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,b(t);case 3:a=e.sent,console.log("delete response:",a),200===a.code?(null==r||r.current.reload(),m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(n.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=l()(he),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,b(u);case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),pe([]),xe([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!le){e.next=7;break}return e.next=4,M(o()(o()({},t),{},{uid:le.uid}));case 4:a=e.sent,e.next=7;break;case 7:200===a.code?(m.yw.success(n.formatMessage({id:le?"update.success":"add.success",defaultMessage:le?"Update Success":"Add Success"})),se(!1),null==r||null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),m.yw.error(n.formatMessage({id:le?"update.error":"add.error",defaultMessage:le?"Update Error":"Add Error"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),$e=[].concat(Ke,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,ve.jsx)("a",{onClick:function(){return function(e){ue(e),se(!0)}(t)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,ve.jsx)(X.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.name,"】？"),onConfirm:function(){return Ge(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,ve.jsx)(H.ZP,{size:"small",type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,ve.jsx)(Q.Z,{menu:{items:[{key:"updateIndex",label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return et(t)}},{key:"updateVectorIndex",label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return tt(t)}}]},placement:"bottomRight",children:(0,ve.jsxs)(H.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,ve.jsx)(be.Z,{})]})},"indexOperations")]}}]),et=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,Z({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,U({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=l()(he),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,Z({uid:u.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),rt=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=l()(he),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,U({uid:u.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),at=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,I({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,E({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,K.useEffect)((function(){var e;null==r||null===(e=r.current)||void 0===e||e.reload()}),[A,T]),(0,K.useEffect)((function(){return z.Z.on(h.YwV,(function(e){var t;console.log("EVENT_BUS_MQTT_NOTICE",e),null==r||null===(t=r.current)||void 0===t||t.reload()})),function(){z.Z.off(h.YwV)}}),[]);var ot=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=o()({categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:(null==C?void 0:C.uid)||"",accessToken:a||"",exportType:t},Le),"current"===t?(s.pageNumber=d-1,s.pageSize=k):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,$.kG)()+"/api/v1/llm/chunk/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),it=function(){var e=f()(c()().mark((function e(){var t,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ne){e.next=3;break}return m.yw.warning(n.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:null==C?void 0:C.uid},e.next=8,j(t);case 8:a=e.sent,console.log("handleDeleteAllConfirm response:",a,t),200===a.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=r.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||n.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),lt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return ot("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Ze.Z,{onModelStatusChange:function(e){Ee(e),Fe(!1)}}),(0,ve.jsx)(Y.Z,{columns:$e,actionRef:r,cardBordered:!0,rowSelection:{selectedRowKeys:fe,onChange:function(e,t){pe(e),xe(t)}},scroll:{x:2e3},request:function(){var e=f()(c()().mark((function e(n,r,s){var i,l,u,d,f,g,x,y,M,w;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",n,r,s),i=n.current,l=n.pageSize,u=a()(n,Ue),p(i),S(l),ze(u),d=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],d=g,f="ascend"===r[g]?"ascend":"descend"),x=t?void 0:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,y=t||null==A?void 0:A.uid,M=o()(o()({pageNumber:i-1,pageSize:l,categoryUid:x,kbUid:y,orgUid:null==C?void 0:C.uid,superUser:t},u),{},{sortBy:d,sortDirection:f}),e.next=13,v(M);case 13:return w=e.sent,console.log("queryChunksByOrg response:",w,M),200===w.code?Ve(null==w?void 0:w.data.totalElements):m.yw.error(w.message),e.abrupt("return",{data:null==w?void 0:w.data.content,success:!0,total:null==w?void 0:w.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:s(null==A?void 0:A.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:t?function(){return[]}:function(){var e=[(0,ve.jsx)(Ce.Z,{currentKbase:A,currentOrg:C,embeddingModelExists:Te,checkingEmbeddingModel:qe||!Te},"chat")],t=[];fe.length>0&&t.push({key:"batchDelete",icon:(0,ve.jsx)(ke.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete"})+" (".concat(fe.length,")"),onClick:function(){Xe.confirm({title:n.formatMessage({id:"batch.deleteTip"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm"})," ").concat(fe.length," ").concat(n.formatMessage({id:"items"}),"?"),onOk:We,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"batchUpdateIndex",icon:(0,ve.jsx)(we.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(fe.length,")"),onClick:nt},{key:"batchUpdateVectorIndex",icon:(0,ve.jsx)(we.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(fe.length,")"),onClick:rt}),t.push({key:"deleteAll",icon:(0,ve.jsx)(je.Z,{}),danger:!0,label:n.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Xe.confirm({title:n.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:n.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有拆分数据吗？此操作不可恢复!"}),onOk:it,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,ve.jsx)(we.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:at},{key:"updateAllVectorIndex",icon:(0,ve.jsx)(we.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:st});var r=[{key:"export-current",icon:(0,ve.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ot("current")}}];return Ne>0&&(Ne<=1e3?r.push({key:"export-all",icon:(0,ve.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ne,"条)"),onClick:function(){return ot("all")}}):r.push({key:"export-range",icon:(0,ve.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ne,"条)"),children:lt(Ne)})),e.push((0,ve.jsx)(Q.Z,{menu:{items:r},placement:"bottom",children:(0,ve.jsxs)(H.ZP,{type:"primary",children:[n.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,ve.jsx)(be.Z,{})]})},"exportDropdown")),t.length>0&&e.push((0,ve.jsx)(Q.Z,{menu:{items:t},placement:"bottom",children:(0,ve.jsxs)(H.ZP,{type:fe.length>0?"primary":"default",danger:fe.length>0,children:[fe.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(fe.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ve.jsx)(be.Z,{})]})},"batchOperations")),e}}),G&&(0,ve.jsx)(F.Z,{type:h.ACv,open:G,onClose:function(){return te(!1)}}),(0,ve.jsx)(ye,{isEdit:!!le,chunk:le,open:ae,onClose:function(){return se(!1)},onSubmit:_e}),Qe]})}},7636:function(e,t,n){n.d(t,{Z:function(){return be}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(11591),x=n(14888),v=n(77274),y=n(2484),M=n(10162),w=n(54881),b=n(93689),k=n(40439),j=n(58275),S=n(30617),Z=n(11090),C=n(61107),U=n(67412),A=n(66810),I=n(31543),T=n(77359),E=n(3925),P=n(71277),O=n(1691),q=n(46141),F=n(44194),D=n(47598),R=n(19736),L=n(44679),z=n(56773),Y=n(6844),B=n(34718),N=n(65819),V=n(96596),H=n.n(V),J=n(88165),X=n(27942),Q=n(27858),K=n(76711),G=n.n(K),W=n(30064),_=n(86684),$=n(15858),ee=n(78792),te=n(69438),ne=n(13847),re=n(68263),ae=n(30813),se=n(62715),oe=n(93312),ie=n(61689),le=n(9428),ue=n(74491),ce=n(87373),de=n(34759),fe=n(48907),pe=n(51891),ge=n(48769),me=n(58087),he=n(90104),xe=n(53816),ve=n(31549),ye=["key"],Me=function(e){var t=e.isEdit,n=e.faq,r=e.open,s=e.onClose,i=e.onSubmit,u=W.A.useForm(),d=g()(u,1)[0],p=(0,F.useState)(""),v=g()(p,2),y=v[0],w=v[1],b=(0,F.useState)(""),k=g()(b,2),j=k[0],S=k[1],Z=(0,F.useState)(""),C=g()(Z,2),U=C[0],I=C[1],T=(0,x.u)((function(e){return e.currentOrg})),P=(0,z.j)((function(e){return e.currentKbase})),R=(0,D.v)((function(e){return e.categorySelectOptions})),L=(0,D.v)((function(e){return e.categoryTreeOptions})),B=(0,D.v)((function(e){return e.currentCategory})),V=(0,F.useState)(),J=g()(V,2),X=(J[0],J[1]),Q=(0,F.useState)([]),K=g()(Q,2),Me=K[0],we=K[1],be=(0,F.useState)(!1),ke=g()(be,2),je=ke[0],Se=ke[1],Ze=(0,F.useState)(""),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,F.useRef)(null),Te=(0,F.useState)([]),Ee=g()(Te,2),Pe=(Ee[0],Ee[1]),Oe=(0,F.useState)([]),qe=g()(Oe,2),Fe=qe[0],De=qe[1],Re=(0,F.useState)(!0),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,F.useState)("permanent"),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,F.useState)([]),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],Ge=(0,F.useState)(!1),We=g()(Ge,2),_e=We[0],$e=We[1],et=(0,F.useState)([]),tt=g()(et,2),nt=tt[0],rt=tt[1],at=(0,F.useState)([]),st=g()(at,2),ot=st[0],it=st[1],lt=(0,F.useState)(!1),ut=g()(lt,2),ct=ut[0],dt=ut[1],ft=(0,F.useState)(""),pt=g()(ft,2),gt=pt[0],mt=pt[1],ht=(0,F.useState)(""),xt=g()(ht,2),vt=xt[0],yt=xt[1],Mt=(0,F.useState)([]),wt=g()(Mt,2),bt=wt[0],kt=wt[1],jt=(0,F.useState)([]),St=g()(jt,2),Zt=St[0],Ct=St[1],Ut=(0,F.useState)(!1),At=g()(Ut,2),It=At[0],Tt=At[1];(0,F.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==B?void 0:B.uid)===Y.zBg?"":null==B?void 0:B.uid,kbUid:null==P?void 0:P.uid,orgUid:null==T?void 0:T.uid},e.next=5,(0,h.pf)(t);case 5:r=e.sent,m.yw.destroy(),200===r.code?(a=null==r?void 0:r.data.content.map((function(e){return{label:e.question,value:e.uid}})),De(a.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):m.yw.error(r.message||"加载常见问题失败"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),m.yw.destroy(),m.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();r&&e()}),[r,null==P?void 0:P.uid,null==T?void 0:T.uid,null==B?void 0:B.uid,null==n?void 0:n.uid]),(0,F.useEffect)((function(){if(t){var e,r,a,s,o,i=Array.isArray(null==n?void 0:n.similarQuestions)?n.similarQuestions.map((function(e){return"string"==typeof e?e:String(e)})).filter((function(e){return""!==e.trim()})):[];if(d.setFieldsValue({question:null==n?void 0:n.question,similarQuestions:i,answer:null==n?void 0:n.answer,answerHtml:null==n?void 0:n.answerHtml,answerMarkdown:null==n?void 0:n.answerMarkdown,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==P?void 0:P.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateType:"permanent",dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[H()(n.startDate),H()(n.endDate)]:void 0}),console.log("edit faq:",n),w((null==n?void 0:n.answer)||""),S((null==n?void 0:n.answerHtml)||(null==n?void 0:n.answer)||""),I((null==n?void 0:n.answerMarkdown)||(null==n?void 0:n.answer)||""),$e(!1),we((null==n||null===(r=n.tagList)||void 0===r?void 0:r.filter((function(e){return e&&""!==e.trim()})))||[]),Pe((null==n||null===(a=n.relatedFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]),Ye(!1!==(null==n?void 0:n.enabled)),Ke(i),null!=n&&null!==(s=n.images)&&void 0!==s&&s.length&&n.images.some((function(e){return e&&""!==e.trim()}))){var l=n.images.filter((function(e){return e&&""!==e.trim()})),u=l.map((function(e,t){return{uid:"-".concat(t+1),name:"image_".concat(t+1,".jpg"),status:"done",url:e,thumbUrl:e}}));rt(u),it(l)}else rt([]),it([]);if(null!=n&&null!==(o=n.attachments)&&void 0!==o&&o.length&&n.attachments.some((function(e){return e&&""!==e.trim()}))){var c=n.attachments.filter((function(e){return e&&""!==e.trim()})),f=c.map((function(e,t){var n=e.substring(e.lastIndexOf("/")+1);return{uid:"-".concat(t+1),name:n||"attachment_".concat(t+1),status:"done",url:e}}));kt(f),Ct(c)}else kt([]),Ct([])}else{var p=Et(L);d.setFieldsValue({question:"",similarQuestions:[],answer:"",answerHtml:"",answerMarkdown:"",categoryUid:p,kbUid:null==P?void 0:P.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateType:"permanent",dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),p&&X(p),w(""),S(""),I(""),$e(!1),we([]),Pe([]),Ye(!0),Ke([]),rt([]),it([]),kt([]),Ct([])}}),[n,r,R,L]);var Et=function e(t){var n,r=l()(t||[]);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.key!==Y.zBg)return a.key;var s=e(a.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""};(0,F.useEffect)((function(){var e;je&&(null===(e=Ie.current)||void 0===e||e.focus())}),[je]),(0,F.useEffect)((function(){console.log("editorAnswer",y),console.log("editorAnswerHtml",j)}),[y,j]);var Pt=function(){Ue&&-1===Me.indexOf(Ue)&&we([].concat(G()(Me),[Ue])),Se(!1),Ae("")},Ot=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:mt(t.url||t.thumbUrl),dt(!0),yt(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qt=(0,ve.jsx)(E.ZP,{icon:(0,ve.jsx)(M.Z,{}),children:"上传图片"}),Ft={name:"file",accept:"image/*",action:(0,N.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(Y.LA8)},listType:"picture-card",fileList:nt,onPreview:Ot,onChange:function(e){var t=G()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;it((function(e){return[].concat(G()(e),[r])})),m.yw.success("上传 ".concat(e.file.name," 成功"))}else m.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&m.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t,n;return e.response&&200===e.response.code?o()(o()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl,thumbUrl:null===(n=e.response)||void 0===n?void 0:n.data.fileUrl}):e})),rt(t)},data:function(e){return{file:e,fileName:H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:Y.IrL,categoryUid:d.getFieldValue("categoryUid")||"",kbUid:(null==P?void 0:P.uid)||"",channel:Y.XtJ}},onRemove:function(e){return e.url&&it((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},Dt={name:"file",action:(0,N.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(Y.LA8)},fileList:bt,onChange:function(e){var t=G()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;Ct((function(e){return[].concat(G()(e),[r])})),m.yw.success("上传 ".concat(e.file.name," 成功"))}else m.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&m.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t;return e.response&&200===e.response.code?o()(o()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl}):e})),kt(t)},data:function(e){return{file:e,fileName:H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:Y.IrL,categoryUid:d.getFieldValue("categoryUid")||"",kbUid:(null==P?void 0:P.uid)||"",channel:Y.XtJ}},onRemove:function(e){return e.url&&Ct((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},Rt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,o,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,N.OJ)()){e.next=3;break}return m.yw.error("生成相似问法功能仅在企业版和平台版可用"),e.abrupt("return");case 3:if((t=d.getFieldValue("question"))&&""!==t.trim()){e.next=7;break}return m.yw.error("请先输入问题后再生成相似问法"),e.abrupt("return");case 7:return e.prev=7,Tt(!0),m.yw.loading("正在智能生成相似问法..."),n={question:t,orgUid:null==T?void 0:T.uid},e.next=13,(0,h.YQ)(n);case 13:r=e.sent,console.log("生成相似问法响应:",n,r),m.yw.destroy(),200===r.code?(a=null==r?void 0:r.data,console.log("生成的相似问法:",a),s=a.similarQuestions.filter((function(e){return e&&""!==e.trim()})),o=Qe.filter((function(e){return e&&""!==e.trim()})),i=G()(o),s.forEach((function(e){i.includes(e)||i.push(e)})),Ke(i),d.setFieldValue("similarQuestions",i),m.yw.success("已成功生成 ".concat(s.length," 条相似问法"))):m.yw.error(r.message||"生成相似问法失败"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(7),console.error("生成相似问法出错:",e.t0),m.yw.destroy(),m.yw.error("生成相似问法失败");case 24:return e.prev=24,Tt(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[7,19,24,27]])})));return function(){return e.apply(this,arguments)}}();return(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsx)(ie.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:s,open:r,extra:(0,ve.jsxs)(le.Z,{children:[(0,ve.jsx)(E.ZP,{onClick:s,children:"取消"}),(0,ve.jsx)(E.ZP,{onClick:function(){var e=Qe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));d.setFieldValue("similarQuestions",e),d.validateFields().then((function(e){var t,r;if(console.log("handleSubmit values:",e),console.log("handleSubmit edited:",y,j,U),"permanent"===e.dateType)t=H()().format("YYYY-MM-DDTHH:mm:ss"),r=H()().add(100,"years").format("YYYY-MM-DDTHH:mm:ss");else{var a=e.dateRange;t=null!=a&&a[0]?a[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=a&&a[1]?a[1].format("YYYY-MM-DDTHH:mm:ss"):void 0}var s=Qe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e})),l=ot.filter((function(e){return e&&""!==e.trim()})),u=Zt.filter((function(e){return e&&""!==e.trim()})),c=Me.filter((function(e){return e&&""!==e.trim()})),d=o()(o()(o()({},n),e),{},{type:Y.PYi,kbUid:null==P?void 0:P.uid,orgUid:null==T?void 0:T.uid,answer:e.answerHtml,answerHtml:e.answerHtml,answerMarkdown:e.answerHtml,similarQuestions:s,answerList:e.answerList||[],tagList:c,relatedFaqUids:e.relatedFaqUids||[],startDate:t,endDate:r,images:l,attachments:u});i(d)})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,ve.jsxs)(W.A,{form:d,submitter:{render:function(){return null}},children:[(0,ve.jsx)(W.A.Item,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],children:(0,ve.jsx)(ue.Z,{treeData:function e(t){return(t||[]).filter((function(e){return e.key!==Y.zBg})).map((function(t){return o()(o()({},t),{},{children:t.children?e(t.children):void 0})}))}(L),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),X(e)},fieldNames:{label:"title",value:"key",children:"children"},treeCheckable:!1,variant:"outlined"})}),(0,ve.jsx)(_.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,ve.jsx)($.u,{name:"similarQuestions",label:(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,ve.jsx)("span",{children:"相似问法"}),(0,ve.jsxs)(O.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:["                ",(0,ve.jsx)(O.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:(0,ve.jsx)(E.ZP,{type:"primary",icon:(0,ve.jsx)(me.Z,{}),onClick:Rt,loading:It,size:"small",children:"智能生成"})})]})]}),creatorButtonProps:{creatorButtonText:"添加相似问法",icon:(0,ve.jsx)(M.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(G()(Qe),[""]);Ke(e),d.setFieldValue("similarQuestions",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var r=d.getFieldValue("similarQuestions")||[],a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):G()(Qe);Ke(a)},onAfterRemove:function(e,t){var n=d.getFieldValue("similarQuestions")||[],r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];Ke(r)},actionRender:function(e,t,n){return[(0,ve.jsx)(E.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=G()(Qe);r.splice(n,1),Ke(r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,s=a()(e,ye);return(0,ve.jsx)(_.Z,o()(o()({},s),{},{placeholder:"请输入相似问法",rules:[{required:!0,message:"请输入相似问法"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:Qe[t]||"",onChange:function(e){var n=G()(Qe);n[t]=e.target.value,Ke(n),d.setFieldValue(["similarQuestions",t],e.target.value)}}}),r)}}),(0,ve.jsx)(W.A.Item,{name:"answerHtml",label:"文本答案",children:(0,ve.jsx)(xe.Z,{value:j,toolbarKeys:(0,he.eD)(),style:{height:"200px",width:"600px"},maxLength:16383,onChange:function(e,t,n){console.log("Editor content changed: html",e),console.log("Editor content changed: markdown",t),console.log("Editor content changed: text",n),w(n),S(e),I(t),d.setFieldValue("answerHtml",e),_e||$e(!0)}})}),(0,ve.jsxs)(W.A.Item,{label:"图片",tooltip:"可以上传多张图片作为回复内容",children:[(0,ve.jsx)(ce.Z,o()(o()({},Ft),{},{children:qt})),(0,ve.jsx)(q.Z,{open:ct,title:vt,footer:null,onCancel:function(){return dt(!1)},children:(0,ve.jsx)(de.Z,{alt:"预览图片",style:{width:"100%"},src:gt})})]}),(0,ve.jsx)(W.A.Item,{label:"附件",tooltip:"可以上传多个附件作为回复内容",children:(0,ve.jsx)(ce.Z,o()(o()({},Dt),{},{children:(0,ve.jsx)(E.ZP,{icon:(0,ve.jsx)(M.Z,{}),children:"上传附件"})}))}),(0,ve.jsxs)(fe.Z,{orientation:"left",children:["扩展答案列表",(0,ve.jsx)(E.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,ve.jsx)($.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,ve.jsx)(M.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,r=e.action,a=t.index;return(0,ve.jsx)(pe.Z,{size:"small",style:{marginBottom:16},extra:r,children:n},a)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,ve.jsx)("div",{children:e})},children:(0,ve.jsxs)(ee.UW,{children:[(0,ve.jsx)(te.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,ve.jsx)(ne.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,ve.jsx)(re.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:Fe,fieldProps:{placeholder:"请选择相关问题"}}),(0,ve.jsx)(W.A.Item,{label:"标签",children:(0,ve.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[Me.map((function(e){return(0,ve.jsx)(A.Z,{closable:!0,onClose:function(){return t=e,n=Me.filter((function(e){return e!==t})),void we(n);var t,n},children:e},e)})),je?(0,ve.jsx)(ge.Z,{ref:Ie,type:"text",size:"small",style:{width:78},value:Ue,onChange:function(e){Ae(e.target.value)},onBlur:Pt,onPressEnter:Pt}):(0,ve.jsxs)(A.Z,{onClick:function(){Se(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,ve.jsx)(M.Z,{})," 新标签"]})]})}),(0,ve.jsx)(ae.Z.Group,{name:"dateType",label:"有效期设置",options:[{label:"永久有效",value:"permanent"},{label:"自定义日期",value:"custom"}],fieldProps:{onChange:function(e){He(e.target.value),"permanent"===e.target.value&&d.setFieldValue("dateRange",void 0)},value:Ve}}),"custom"===Ve&&(0,ve.jsx)(se.Z,{name:"dateRange",label:"有效日期",rules:[{required:"custom"===Ve,message:"请选择有效日期范围"}],fieldProps:{style:{width:"100%"}}}),(0,ve.jsx)(oe.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:ze,onChange:function(e){Ye(e)}}})]})})})},we=["current","pageSize"],be=function(e){var t=e.superUser,n=(0,R.useIntl)(),r=(0,L.Z)().translateString,s=(0,F.useRef)(),i=(0,F.useState)(!0),u=g()(i,2),d=u[0],p=u[1],V=(0,F.useState)(),K=g()(V,2),G=K[0],W=K[1],_=(0,F.useState)(!1),$=g()(_,2),ee=$[0],te=$[1],ne=(0,F.useState)(1),re=g()(ne,2),ae=re[0],se=re[1],oe=(0,F.useState)(10),ie=g()(oe,2),le=ie[0],ue=ie[1],ce=(0,x.u)((function(e){return e.currentOrg})),de=(0,z.j)((function(e){return e.currentKbase})),fe=(0,D.v)((function(e){return e.currentCategory})),pe=(0,D.v)((function(e){return e.categorySelectOptions})),ge=(0,F.useState)(!1),me=g()(ge,2),he=me[0],xe=me[1],ye=(0,F.useState)([]),be=g()(ye,2),ke=be[0],je=be[1],Se=(0,F.useState)([]),Ze=g()(Se,2),Ce=Ze[0],Ue=Ze[1],Ae=(0,F.useState)(0),Ie=g()(Ae,2),Te=Ie[0],Ee=Ie[1],Pe=(0,F.useState)(!1),Oe=g()(Pe,2),qe=Oe[0],Fe=Oe[1],De=(0,F.useState)(!1),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,F.useState)({}),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=function(){var e=f()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,(0,h.Yg)(t);case 3:r=e.sent,console.log("delete response:",r),200===r.code?(null==s||s.current.reload(),m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(n.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Je=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ce.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,a=0,o=l()(Ce),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,(0,h.Yg)(u);case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:a})),je([]),Ue([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Xe=function(){var e=f()(c()().mark((function e(t){var r,a,o,i,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ce.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 3:m.yw.loading(t?n.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):n.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),a=0,o=0,i=l()(Ce),e.prev=7,i.s();case 9:if((u=i.n()).done){e.next=23;break}return d=u.value,e.prev=11,e.next=14,(0,h.kv)({uid:d.uid,enabled:t});case 14:200===e.sent.code?a++:o++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),o++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===o?m.yw.success(t?n.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:a}):n.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:a})):m.yw.warning(t?n.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:a,fail:o}):n.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:a,fail:o})),je([]),Ue([]),null===(r=s.current)||void 0===r||r.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(t){return e.apply(this,arguments)}}(),Qe=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Te){e.next=3;break}return m.yw.warning(n.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==fe?void 0:fe.uid)===Y.zBg?"":null==fe?void 0:fe.uid,kbUid:null==de?void 0:de.uid,orgUid:null==ce?void 0:ce.uid},e.next=8,(0,h.QB)(t);case 8:200===(r=e.sent).code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(a=s.current)||void 0===a||a.reloadAndRest()):(m.yw.destroy(),m.yw.error(r.message||n.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),Ke=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0,tooltip:n.formatMessage({id:"faq.question.tooltip",defaultMessage:"常见问题的问题内容"})},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"similarQuestions",width:200,ellipsis:!0,search:!1,tooltip:n.formatMessage({id:"faq.similar.questions.tooltip",defaultMessage:"表达相同意思的其他问法"}),render:function(e,t){if(!t.similarQuestions||0===t.similarQuestions.length||1===t.similarQuestions.length&&""===t.similarQuestions[0])return"-";var r=t.similarQuestions.length>3,a=t.similarQuestions.slice(0,3),s=(0,ve.jsx)("div",{style:{maxWidth:300,maxHeight:300,overflow:"auto"},children:t.similarQuestions.map((function(e,t){return(0,ve.jsxs)("div",{style:{marginBottom:8},children:[(0,ve.jsx)(A.Z,{color:"blue",style:{marginRight:4},children:t+1}),e]},t)}))}),o=(0,ve.jsxs)("div",{children:[a.map((function(e,t){return(0,ve.jsx)(A.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),r&&(0,ve.jsxs)(A.Z,{color:"orange",children:["+",t.similarQuestions.length-3]})]});return(0,ve.jsx)(I.Z,{content:s,title:n.formatMessage({id:"faq.similar.questions",defaultMessage:"所有相似问法"}),placement:"right",trigger:"hover",children:o})}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,tooltip:n.formatMessage({id:"faq.answer.tooltip",defaultMessage:"常见问题的回答内容"})},{title:(0,ve.jsx)(R.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"faq.status.tooltip",defaultMessage:"问题处理状态"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,ve.jsx)(A.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"faq.vectorStatus.tooltip",defaultMessage:"向量化处理状态"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,ve.jsx)(A.Z,{color:a,icon:(0,ve.jsx)(v.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0,tooltip:n.formatMessage({id:"faq.clickCount.tooltip",defaultMessage:"问题被点击的次数"})},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0,tooltip:n.formatMessage({id:"faq.upCount.tooltip",defaultMessage:"问题被点赞的次数"})},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0,tooltip:n.formatMessage({id:"faq.downCount.tooltip",defaultMessage:"问题被踩的次数"})},{title:(0,ve.jsx)(R.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"faq.category.tooltip",defaultMessage:"问题所属的分类"}),render:function(e,t){var n=pe.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,ve.jsx)(A.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:pe.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.tags",defaultMessage:"标签"}),dataIndex:"tagList",width:150,hideInSearch:!0,tooltip:n.formatMessage({id:"faq.tags.tooltip",defaultMessage:"用于分类和搜索的标签"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,ve.jsxs)("div",{children:[r.map((function(e,t){return(0,ve.jsx)(A.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,ve.jsxs)(A.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:n.formatMessage({id:"faq.isValid.tooltip",defaultMessage:"问题是否有效可用"}),valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:n.formatMessage({id:"faq.startDate.tooltip",defaultMessage:"问题生效的开始时间"}),render:function(e,t){return t.startDate?H()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:n.formatMessage({id:"faq.endDate.tooltip",defaultMessage:"问题失效的结束时间"}),render:function(e,t){return t.endDate?H()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"faq.createdAt.tooltip",defaultMessage:"问题创建的时间"}),render:function(e,t){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,ve.jsx)(R.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"faq.updatedAt.tooltip",defaultMessage:"问题最后更新的时间"}),render:function(e,t){return t.updatedAt?H()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,ve.jsx)("a",{onClick:function(){!function(e){console.log("showEditDrawer",e),W(e),p(!0),te(!0)}(t)},children:n.formatMessage({id:"edit"})},"editable"),(0,ve.jsx)(T.Z,{title:n.formatMessage({id:"deleteTip"}),description:"".concat(n.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.question,"】？"),onConfirm:function(){return He(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,ve.jsx)(E.ZP,{size:"small",type:"link",danger:!0,children:n.formatMessage({id:"delete"})})},"delete"),(0,ve.jsx)(P.Z,{menu:{items:[{key:"updateIndex",label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Ge(t)}},{key:"updateVectorIndex",label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return We(t)}}]},placement:"bottomRight",children:(0,ve.jsx)(O.Z,{title:n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,ve.jsxs)(E.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,ve.jsx)(y.Z,{})]})})},"indexOperations")]}}],Ge=function(){var e=f()(c()().mark((function e(t){var r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,(0,h.RF)({uid:t.uid});case 4:r=e.sent,m.yw.destroy(),200===r.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(a=s.current)||void 0===a||a.reload()):m.yw.error(r.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=f()(c()().mark((function e(t){var r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,(0,h.YO)({uid:t.uid});case 4:r=e.sent,m.yw.destroy(),200===r.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(a=s.current)||void 0===a||a.reload()):m.yw.error(r.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),_e=function(){qe?Le?m.yw.info("正在检查模型状态，请稍后再试"):(W(void 0),p(!1),te(!0)):q.Z.confirm({title:n.formatMessage({id:"warning",defaultMessage:"警告"}),content:n.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:n.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){W(void 0),p(!1),te(!0)}})},$e=function(){var e=f()(c()().mark((function e(t){var r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),d?m.yw.loading(n.formatMessage({id:"updating"})):m.yw.loading(n.formatMessage({id:"creating"})),!d){e.next=8;break}return e.next=5,(0,h.y)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,h.kh)(t);case 10:e.t0=e.sent;case 11:r=e.t0,console.log("createFaq response:",t,r),200===r.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),te(!1),null===(a=s.current)||void 0===a||a.reloadAndRest()):(m.yw.destroy(),m.yw.error(r.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qe){e.next=3;break}return q.Z.confirm({title:n.formatMessage({id:"warning",defaultMessage:"警告"}),content:n.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:n.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){xe(!0)}}),e.abrupt("return");case 3:if(!Le){e.next=6;break}return m.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 6:xe(!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,F.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.reloadAndRest()}),[de,fe]);var tt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.HK)(Y.QPQ,null==ce?void 0:ce.uid,null==de?void 0:de.uid,Y.whQ,{showLoading:!0,loadingMessage:n.formatMessage({id:"loading"}),errorMessage:n.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ce.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),r=0,a=0,o=l()(Ce),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,(0,h.RF)({uid:u.uid});case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的索引，").concat(a," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),rt=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ce.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),r=0,a=0,o=l()(Ce),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,(0,h.YO)({uid:u.uid});case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的向量索引，").concat(a," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),at=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:q.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,(0,h.L0)({kbUid:null==de?void 0:de.uid,categoryUid:(null==fe?void 0:fe.uid)===Y.zBg?"":null==fe?void 0:fe.uid,orgUid:null==ce?void 0:ce.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:q.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,(0,h.Bv)({kbUid:null==de?void 0:de.uid,categoryUid:(null==fe?void 0:fe.uid)===Y.zBg?"":null==fe?void 0:fe.uid,orgUid:null==ce?void 0:ce.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ot=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(Y.LA8),s=o()({categoryUid:(null==fe?void 0:fe.uid)===Y.zBg?"":null==fe?void 0:fe.uid,kbUid:null==de?void 0:de.uid,orgUid:(null==ce?void 0:ce.uid)||"",accessToken:a||"",exportType:t},Ne),"current"===t?(s.pageNumber=String(ae-1),s.pageSize=String(le)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,N.kG)()+"/api/v1/faq/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),it={selectedRowKeys:ke,onChange:function(e,t){je(e),Ue(t)}},lt=function(){var e=f()(c()().mark((function e(r,s,i){var l,u,d,f,p,g,x,v,y,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),l=r.current,u=r.pageSize,d=a()(r,we),se(l),ue(u),Ve(d),f=void 0,p=void 0,s&&Object.keys(s).length>0&&(g=Object.keys(s)[0],f=g,p="ascend"===s[g]?"ascend":"descend"),x=t?void 0:(null==fe?void 0:fe.uid)===Y.zBg?"":null==fe?void 0:fe.uid,v=t||null==de?void 0:de.uid,y=o()(o()({pageNumber:l-1,pageSize:u,categoryUid:x,kbUid:v,orgUid:null==ce?void 0:ce.uid,superUser:t},d),{},{sortBy:f,sortDirection:p}),e.next=13,(0,h.pf)(y);case 13:return M=e.sent,console.log("queryFaqsByOrg response:",y,M),m.yw.destroy(),200===M.code?Ee(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ut=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return ot("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Q.Z,{onModelStatusChange:function(e){Fe(e),ze(!1)}}),(0,ve.jsx)(U.Z,{columns:Ke,actionRef:s,cardBordered:!0,rowSelection:it,request:lt,scroll:{x:2300},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){se(e),ue(t)}},dateFormatter:"string",headerTitle:r(null==de?void 0:de.name)+" - 常见问题",tooltip:Le?"正在检查嵌入式模型...":qe?"所添加FAQ内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return t?[]:function(){var e=[];(0,N.Ox)()||e.push((0,ve.jsx)(E.ZP,{icon:(0,ve.jsx)(M.Z,{}),type:"primary",onClick:_e,disabled:Le,children:n.formatMessage({id:"create"})},"create"),(0,ve.jsx)(O.Z,{title:n.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,ve.jsx)(X.Z,{currentKbase:de,currentOrg:ce,embeddingModelExists:qe,checkingEmbeddingModel:Le})},"chat"));var t=[];ke.length>0&&t.push({key:"batchDelete",icon:(0,ve.jsx)(w.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete"})+" (".concat(ke.length,")"),onClick:function(){q.Z.confirm({title:n.formatMessage({id:"batch.deleteTip"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm"})," ").concat(ke.length," ").concat(n.formatMessage({id:"items"}),"?"),onOk:Je,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,ve.jsx)(b.Z,{}),label:n.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(ke.length,")"),onClick:function(){return Xe(!0)}},{key:"batchDisable",icon:(0,ve.jsx)(k.Z,{}),label:n.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(ke.length,")"),onClick:function(){return Xe(!1)}},{key:"batchUpdateIndex",icon:(0,ve.jsx)(v.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(ke.length,")"),onClick:nt},{key:"batchUpdateVectorIndex",icon:(0,ve.jsx)(v.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(ke.length,")"),onClick:rt}),t.push({key:"deleteAll",icon:(0,ve.jsx)(j.Z,{}),danger:!0,label:n.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){q.Z.confirm({title:n.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:n.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:Qe,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,ve.jsx)(v.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:at},{key:"updateAllVectorIndex",icon:(0,ve.jsx)(v.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:st});var r=[{key:"import",icon:(0,ve.jsx)(S.Z,{}),label:n.formatMessage({id:"import"}),onClick:et,disabled:Le},{key:"export-current",icon:(0,ve.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ot("current")}}];return Te>0&&(Te<=1e3?r.push({key:"export-all",icon:(0,ve.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Te,"条)"),onClick:function(){return ot("all")}}):r.push({key:"export-range",icon:(0,ve.jsx)(Z.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Te,"条)"),children:ut(Te)})),r.push({key:"download",icon:(0,ve.jsx)(C.Z,{}),label:n.formatMessage({id:"download.template"}),onClick:function(){return(0,N.IY)()}}),e.push((0,ve.jsx)(P.Z,{menu:{items:r},placement:"bottom",children:(0,ve.jsxs)(E.ZP,{type:"primary",children:[n.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,ve.jsx)(y.Z,{})]})},"importExport")),t.length>0&&e.push((0,ve.jsx)(P.Z,{menu:{items:t},placement:"bottom",children:(0,ve.jsxs)(E.ZP,{type:ke.length>0?"primary":"default",danger:ke.length>0,children:[ke.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ke.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ve.jsx)(y.Z,{})]})},"batchOperations")),e}()}}),(0,ve.jsx)(Me,{isEdit:d,open:ee,faq:G,onClose:function(){return te(!1)},onSubmit:$e}),he&&(0,ve.jsx)(B.Z,{type:Y.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:he,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),xe(!1),null==s||s.current.reload(),tt()},handleCancel:function(){console.log("handleUploadDragCancel"),xe(!1),null==s||s.current.reload()}})]})}},86300:function(e,t,n){n.d(t,{Z:function(){return Me}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(6844),x=n(19736);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/file/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/file/update",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/file/delete",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/file/delete/all",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/file/rechunk",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=n(84905),A=n(47598),I=n(56773),T=n(14888),E=n(14695),P=n(71529),O=n(92110),q=n(59304),F=n(21407),D=n(54881),R=n(10162),L=n(58275),z=n(11090),Y=n(2484),B=n(67412),N=n(46141),V=n(5089),H=n(66810),J=n(1691),X=n(3925),Q=n(77359),K=n(71277),G=n(44194),W=n(96596),_=n.n(W),$=n(34718),ee=n(44679),te=n(65819),ne=n(88165),re=n(27858),ae=n(27942),se=n(76711),oe=n.n(se),ie=n(30064),le=n(68263),ue=n(86684),ce=n(13847),de=n(93189),fe=n(61689),pe=n(9428),ge=n(48769),me=n(55785),he=n(14377),xe=n(31549),ve=function(e){var t=e.isEdit,n=void 0===t||t,r=e.file,a=e.open,s=e.onClose,i=e.onSubmit,l=ie.A.useForm(),u=g()(l,1)[0],d=(0,I.j)((function(e){return e.currentKbase})),p=(0,T.u)((function(e){return e.currentOrg})),m=(0,A.v)((function(e){return e.categorySelectOptions})),h=(0,G.useState)(),x=g()(h,2),v=x[0],y=x[1],M=(0,G.useState)([]),w=g()(M,2),b=w[0],k=w[1],j=(0,G.useState)(!1),S=g()(j,2),Z=S[0],C=S[1],U=(0,G.useState)(""),E=g()(U,2),P=E[0],O=E[1],q=(0,G.useState)(!1),F=g()(q,2),D=F[0],L=F[1],z=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},Y=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,L(!0),e.next=4,u.validateFields();case 4:t=e.sent,n=o()(o()(o()({},r),t),{},{categoryUid:v,tagList:z(b),kbUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid}),console.log("submit",n),i(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),de.ZP.error("请检查表单填写是否正确");case 14:return e.prev=14,L(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=P.trim();e&&!b.includes(e)&&k([].concat(oe()(b),[e])),C(!1),O("")},N=function(){C(!1),O("")};return(0,G.useEffect)((function(){if(n)u.setFieldsValue({uid:null==r?void 0:r.uid,fileName:null==r?void 0:r.fileName,content:null==r?void 0:r.content,categoryUid:null==r?void 0:r.categoryUid,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled}),y(null==r?void 0:r.categoryUid),k(z((null==r?void 0:r.tagList)||[]));else{if(u.setFieldsValue({fileName:"",content:"",enabled:!0}),m&&m.length>0){var e=m[0].value;u.setFieldValue("categoryUid",e),y(e)}k([]),C(!1),O("")}}),[n,r,u,m]),(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)(fe.Z,{title:n?"编辑文件":"添加文件",onClose:s,open:a,width:600,extra:(0,xe.jsxs)(pe.Z,{children:[(0,xe.jsx)(X.ZP,{onClick:s,children:"取消"}),(0,xe.jsx)(X.ZP,{type:"primary",onClick:Y,loading:D,children:"提交"})]}),footer:null,children:(0,xe.jsxs)(ie.A,{form:u,name:"fileForm",submitter:!1,children:[(0,xe.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:m,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("file category selected ".concat(e)),y(e)}}}),(0,xe.jsx)(ue.Z,{label:"文件名称",name:"fileName",rules:[{required:!0,message:"请输入文件名称"}],placeholder:"请输入文件名称"}),(0,xe.jsx)(ce.Z,{label:"文件内容",name:"content",rules:[{required:!0,message:"请输入文件内容"}],placeholder:"请输入文件内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"文件的文本内容，用于知识库检索"}),(0,xe.jsx)(ie.A.Item,{label:"标签",name:"tagList",tooltip:"为文件添加标签，便于分类和检索",children:(0,xe.jsxs)("div",{style:{minHeight:"32px"},children:[(0,xe.jsx)(pe.Z,{wrap:!0,style:{marginBottom:8},children:z(b).map((function(e,t){return(0,xe.jsx)(H.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void k(z(b.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),Z?(0,xe.jsxs)(pe.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)(ge.Z,{value:P,onChange:function(e){O(e.target.value)},onKeyDown:function(e){"Enter"===e.key?B():"Escape"===e.key&&N()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,xe.jsx)(X.ZP,{type:"primary",size:"small",icon:(0,xe.jsx)(me.Z,{}),onClick:B,disabled:!P.trim(),children:"保存"}),(0,xe.jsx)(X.ZP,{size:"small",icon:(0,xe.jsx)(he.Z,{}),onClick:N,children:"取消"})]}):(0,xe.jsx)(X.ZP,{type:"dashed",onClick:function(){C(!0),O("")},icon:(0,xe.jsx)(R.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),!1]})})})},ye=["current","pageSize"],Me=function(e){var t=e.superUser,n=(0,x.useIntl)(),r=(0,G.useRef)(),s=(0,ee.Z)().translateString,i=(0,G.useState)(1),u=g()(i,2),d=u[0],p=u[1],y=(0,G.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,T.u)((function(e){return e.currentOrg})),W=(0,I.j)((function(e){return e.currentKbase})),se=(0,A.v)((function(e){return e.currentCategory})),oe=(0,A.v)((function(e){return e.categorySelectOptions})),ie=(0,G.useState)(!1),le=g()(ie,2),ue=le[0],ce=le[1],de=(0,G.useState)(!1),fe=g()(de,2),pe=fe[0],ge=fe[1],me=(0,G.useState)([]),he=g()(me,2),Me=he[0],we=he[1],be=(0,G.useState)([]),ke=g()(be,2),je=ke[0],Se=ke[1],Ze=(0,G.useState)(!1),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,G.useState)(!1),Te=g()(Ie,2),Ee=Te[0],Pe=Te[1],Oe=(0,G.useState)({}),qe=g()(Oe,2),Fe=qe[0],De=qe[1],Re=(0,G.useState)(0),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=N.Z.useModal(),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,G.useState)(!1),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],Ge=(0,G.useState)(void 0),We=g()(Ge,2),_e=We[0],$e=We[1],et=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(t);case 2:200===e.sent.code?(null==r||r.current.reload(),m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(n.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleFileDrawerSubmit",t),m.yw.success(n.formatMessage({id:"update.success",defaultMessage:"更新成功"})),Ke(!1),$e(void 0),e.next=6,M(t);case 6:200===e.sent.code?(null==r||r.current.reload(),m.yw.success(n.formatMessage({id:"update.success",defaultMessage:"更新成功"}))):m.yw.error(n.formatMessage({id:"update.error",defaultMessage:"更新失败"}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(t){var a,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"rechunking",defaultMessage:"正在重新切块..."})),e.prev=1,a={uid:t.uid},e.next=5,Z(a);case 5:s=e.sent,console.log("rechunk response",s,a),m.yw.destroy(),200===s.code?(m.yw.success(n.formatMessage({id:"rechunk.success",defaultMessage:"重新切块成功"})),null===(o=r.current)||void 0===o||o.reload()):m.yw.error(s.message||n.formatMessage({id:"rechunk.failed",defaultMessage:"重新切块失败"})),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"rechunk.error",defaultMessage:"重新切块过程发生错误"})),console.error("重新切块错误:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),rt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,xe.jsx)(x.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",ellipsis:!0,copyable:!0,fixed:"left",tooltip:n.formatMessage({id:"llm.file.fileName.tooltip"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.fileName;null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)("span",{style:{marginRight:4},children:o}),(0,xe.jsx)(V.Z.Text,{copyable:{text:(null==t?void 0:t.fileName)||""}})]})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"fileUrl",defaultMessage:"File URL"}),dataIndex:"fileUrl",ellipsis:!0,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.file.fileUrl.tooltip"}),render:function(e,t){return t.fileUrl?(0,xe.jsxs)("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,xe.jsx)(P.Z,{})," ",n.formatMessage({id:"view.file"})]}):"-"}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,tooltip:n.formatMessage({id:"llm.file.tags.tooltip"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(O.Z,{})," ",null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,xe.jsx)(H.Z,{children:e},e)}))]}):"-"}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:n.formatMessage({id:"enabled"}),status:"Success"},false:{text:n.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,tooltip:n.formatMessage({id:"llm.file.enabled.tooltip"})},{title:(0,xe.jsx)(x.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",ellipsis:!0,hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.file.category.tooltip"}),render:function(e,t){var n=oe.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,xe.jsx)(H.Z,{color:"blue",children:n.label}):(0,xe.jsx)(H.Z,{color:"default",children:"未分类"})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.file.createdAt.tooltip"}),render:function(e,t){return _()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.file.updatedAt.tooltip"}),render:function(e,t){return t.updatedAt?_()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),key:"option",valueType:"option",width:140,fixed:"right",render:function(e,t){return[(0,xe.jsx)(J.Z,{title:n.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,xe.jsx)(X.ZP,{type:"text",size:"small",icon:(0,xe.jsx)(q.Z,{}),onClick:function(){return function(e){$e(e),Ke(!0)}(t)}})},"edit"),(0,xe.jsx)(J.Z,{title:n.formatMessage({id:"rechunk",defaultMessage:"重新切块"}),children:(0,xe.jsx)(X.ZP,{type:"text",size:"small",icon:(0,xe.jsx)(F.Z,{}),onClick:function(){return nt(t)}})},"rechunk"),(0,xe.jsx)(Q.Z,{title:n.formatMessage({id:"deleteTip"}),description:"".concat(n.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.fileName,"】？"),onConfirm:function(){return et(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,xe.jsx)(J.Z,{title:n.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,xe.jsx)(X.ZP,{type:"text",size:"small",icon:(0,xe.jsx)(D.Z,{}),danger:!0})})},"delete")]}}],at=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==je.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=l()(je),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,b(u);case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),we([]),Se([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=o()({categoryUid:(null==se?void 0:se.uid)===h.zBg?"":null==se?void 0:se.uid,kbUid:null==W?void 0:W.uid,orgUid:(null==C?void 0:C.uid)||"",accessToken:a||"",exportType:t},Fe),"current"===t?(s.pageNumber=d-1,s.pageSize=k):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,te.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ot=function(){var e=f()(c()().mark((function e(){var t,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ze){e.next=3;break}return m.yw.warning(n.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==se?void 0:se.uid)===h.zBg?"":null==se?void 0:se.uid,kbUid:null==W?void 0:W.uid,orgUid:null==C?void 0:C.uid},e.next=8,j(t);case 8:a=e.sent,console.log("handleDeleteAllConfirm response:",a,t),200===a.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=r.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||n.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),it=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return st("range",r,n)}})},s=0;s<r;s++)a();return t};(0,G.useEffect)((function(){var e;null==r||null===(e=r.current)||void 0===e||e.reload()}),[W,se]),(0,G.useEffect)((function(){return E.Z.on(h.YwV,(function(e){var t;null==r||null===(t=r.current)||void 0===t||t.reload()})),function(){E.Z.off(h.YwV)}}),[]);var lt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ne.HK)(h.QPQ,null==C?void 0:C.uid,null==W?void 0:W.uid,h.whQ,{showLoading:!0,loadingMessage:n.formatMessage({id:"loading"}),errorMessage:n.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(re.Z,{onModelStatusChange:function(e){Ae(e),Pe(!1)}}),(0,xe.jsx)(B.Z,{columns:rt,actionRef:r,cardBordered:!0,rowSelection:{selectedRowKeys:Me,onChange:function(e,t){we(e),Se(t)}},scroll:{x:1800},request:function(){var e=f()(c()().mark((function e(n,r,s){var i,l,u,d,f,g,x,y,M,w;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.current,l=n.pageSize,u=a()(n,ye),p(i),S(l),De(u),d=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],d=g,f="ascend"===r[g]?"ascend":"descend"),x=t?void 0:(null==se?void 0:se.uid)===h.zBg?"":null==se?void 0:se.uid,y=t||null==W?void 0:W.uid,M=o()(o()({pageNumber:i-1,pageSize:l,categoryUid:x,kbUid:y,orgUid:null==C?void 0:C.uid,superUser:t},u),{},{sortBy:d,sortDirection:f}),e.next=12,v(M);case 12:return 200===(w=e.sent).code?(console.log("queryFilesByOrg response:",M,w),Ye(null==w?void 0:w.data.totalElements)):m.yw.error(w.message),e.abrupt("return",{data:null==w?void 0:w.data.content,success:!0,total:null==w?void 0:w.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:s(null==W?void 0:W.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:t?function(){return[]}:function(){var e=[(0,xe.jsx)(X.ZP,{icon:(0,xe.jsx)(R.Z,{}),type:"primary",onClick:function(){return(0,re.w)((function(){return ce(!0)}),Ue,Ee)},disabled:Ee||!Ue,children:n.formatMessage({id:"upload",defaultMessage:"File"})},"upload"),(0,xe.jsx)(ae.Z,{currentKbase:W,currentOrg:C,embeddingModelExists:Ue,checkingEmbeddingModel:Ee||!Ue},"chat")],t=[];Me.length>0&&t.push({key:"batchDelete",icon:(0,xe.jsx)(D.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete"})+" (".concat(Me.length,")"),onClick:function(){Ve.confirm({title:n.formatMessage({id:"batch.deleteTip"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm"})," ").concat(Me.length," ").concat(n.formatMessage({id:"items"}),"?"),onOk:at,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}}),t.push({key:"deleteAll",icon:(0,xe.jsx)(L.Z,{}),danger:!0,label:n.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Ve.confirm({title:n.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:n.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文件数据吗？此操作不可恢复!"}),onOk:ot,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,xe.jsx)(z.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return st("current")}}];return ze>0&&(ze<=1e3?r.push({key:"export-all",icon:(0,xe.jsx)(z.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ze,"条)"),onClick:function(){return st("all")}}):r.push({key:"export-range",icon:(0,xe.jsx)(z.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ze,"条)"),children:it(ze)})),e.push((0,xe.jsx)(K.Z,{menu:{items:r},placement:"bottom",children:(0,xe.jsxs)(X.ZP,{type:"primary",children:[n.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,xe.jsx)(Y.Z,{})]})},"exportDropdown")),t.length>0&&e.push((0,xe.jsx)(K.Z,{menu:{items:t},placement:"bottom",children:(0,xe.jsxs)(X.ZP,{type:Me.length>0?"primary":"default",danger:Me.length>0,children:[Me.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Me.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,xe.jsx)(Y.Z,{})]})},"batchOperations")),e}}),ue&&(0,xe.jsx)($.Z,{type:h.n1c,acceptType:"*",isModalOpen:ue,handleSubmit:function(e){ce(!1),null==r||r.current.reload(),lt()},handleCancel:function(){ce(!1),null==r||r.current.reload()}}),pe&&(0,xe.jsx)(U.Z,{type:h.ACv,open:pe,onClose:function(){return ge(!1)}}),Qe&&(0,xe.jsx)(ve,{file:_e,open:Qe,onClose:function(){Ke(!1),$e(void 0)},onSubmit:tt}),He]})}},42532:function(e,t,n){n.d(t,{Z:function(){return Pe}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(6844),x=n(19736);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/create",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/update",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/delete",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/deleteAll",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return q.apply(this,arguments)}function q(){return(q=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return D.apply(this,arguments)}function D(){return D=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return(L=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/text/enable",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=n(14888),Y=n(77274),B=n(15722),N=n(2484),V=n(10162),H=n(54881),J=n(93689),X=n(40439),Q=n(58275),K=n(30617),G=n(11090),W=n(61107),_=n(67412),$=n(46141),ee=n(66810),te=n(3925),ne=n(71277),re=n(1691),ae=n(44194),se=n(96596),oe=n.n(se),ie=n(76711),le=n.n(ie),ue=n(11591),ce=n(47598),de=n(56773),fe=n(58087),pe=n(55785),ge=n(30064),me=n(52491),he=n(86684),xe=n(13847),ve=n(61689),ye=n(9428),Me=n(48769),we=n(5089),be=n(71876),ke=n(14377),je=n(31549),Se=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,s=e.onSubmit,i=ge.A.useForm(),u=g()(i,1)[0],d=(0,ae.useState)(""),p=g()(d,2),x=(p[0],p[1]),v=(0,z.u)((function(e){return e.currentOrg})),y=(0,ce.v)((function(e){return e.categorySelectOptions})),M=(0,ce.v)((function(e){return e.categoryTreeOptions})),w=(0,ae.useState)(),b=g()(w,2),k=b[0],j=b[1],S=(0,de.j)((function(e){return e.currentKbase})),Z=(0,ae.useState)([]),C=g()(Z,2),U=C[0],A=C[1],I=(0,ae.useState)(!1),T=g()(I,2),E=T[0],P=T[1],O=(0,ae.useState)(""),q=g()(O,2),D=q[0],R=q[1],L=(0,ae.useState)([]),Y=g()(L,2),B=Y[0],N=Y[1],H=(0,ae.useState)(!1),J=g()(H,2),X=J[0],Q=J[1],K=(0,ae.useState)(new Set),G=g()(K,2),W=G[0],_=G[1],$=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ne=function(){var e=f()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.getFieldValue("title"),n=u.getFieldValue("content"),t&&n){e.next=5;break}return m.yw.warning("请先填写标题和内容"),e.abrupt("return");case 5:return Q(!0),e.prev=6,r={title:t,content:n,orgUid:null==v?void 0:v.uid},e.next=10,F(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(m.yw.success("常见问题生成成功"),N(null==a?void 0:a.data),_(new Set)):(N([]),m.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),m.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,Q(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}();(0,ae.useEffect)((function(){if(r){if(t)u.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid}),x((null==n?void 0:n.content)||""),j(null==n?void 0:n.categoryUid),A($((null==n?void 0:n.tagList)||[]));else{u.resetFields();var e=function e(t){var n,r=l()(t||[]);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.key!==h.zBg)return a.key;var s=e(a.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(M||[]);if(e)u.setFieldValue("categoryUid",e),j(e);else if(y&&y.length>0){var a=y[0].value;u.setFieldValue("categoryUid",a),j(a)}A([]),P(!1),R("")}N([]),_(new Set)}}),[r,t,n,u,y,M]);var se=function(){var e=D.trim();if(e&&!U.includes(e)){var t=$([].concat(le()(U),[e]));A(t)}P(!1),R("")},oe=function(){P(!1),R("")},ie=function(){var e=f()(c()().mark((function e(t,n){var r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!W.has(n)){e.next=4;break}return m.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=o()(o()({},t),{},{categoryUid:k||u.getFieldValue("categoryUid"),kbUid:null==S?void 0:S.uid,orgUid:null==v?void 0:v.uid,type:"TEXT"}),m.yw.loading("正在保存常见问题..."),e.next=8,(0,ue.kh)(r);case 8:200===(a=e.sent).code?((s=new Set(W)).add(n),_(s),m.yw.success("常见问题保存成功")):m.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),m.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(ve.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,je.jsxs)(ye.Z,{children:[(0,je.jsx)(te.ZP,{onClick:a,children:"取消"}),(0,je.jsx)(te.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=o()(o()({},e),{},{categoryUid:k,tagList:$(U),kbUid:null==S?void 0:S.uid,orgUid:null==v?void 0:v.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"}),(0,je.jsx)(te.ZP,{onClick:ne,type:"default",loading:X,icon:(0,je.jsx)(fe.Z,{}),children:"智能生成常见问题"})]}),children:(0,je.jsxs)(ge.A,{form:u,submitter:{render:function(){return null}},children:[(0,je.jsx)(me.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==h.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(M||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),j(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,je.jsx)(he.Z,{label:"标题",name:"title",rules:[{required:!0}]}),(0,je.jsx)(ge.A.Item,{label:"标签",name:"tagList",tooltip:"为文本添加标签，便于分类和检索",children:(0,je.jsxs)("div",{style:{minHeight:"32px"},children:[(0,je.jsx)(ye.Z,{wrap:!0,style:{marginBottom:8},children:$(U).map((function(e,t){return(0,je.jsx)(ee.Z,{closable:!0,color:"blue",onClose:function(){return t=e,n=$(U.filter((function(e){return e!==t}))),void A(n);var t,n},style:{marginBottom:4},children:e},t)}))}),E?(0,je.jsxs)(ye.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,je.jsx)(Me.Z,{value:D,onChange:function(e){R(e.target.value)},onKeyDown:function(e){"Enter"===e.key?se():"Escape"===e.key&&oe()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,je.jsx)(te.ZP,{type:"primary",size:"small",icon:(0,je.jsx)(pe.Z,{}),onClick:se,disabled:!D.trim(),children:"保存"}),(0,je.jsx)(te.ZP,{size:"small",icon:(0,je.jsx)(ke.Z,{}),onClick:oe,children:"取消"})]}):(0,je.jsx)(te.ZP,{type:"dashed",onClick:function(){P(!0),R("")},icon:(0,je.jsx)(V.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,je.jsx)(xe.Z,{label:"内容",name:"content",rules:[{required:!0}]}),B.length>0&&(0,je.jsxs)("div",{style:{marginTop:16},children:[(0,je.jsx)(we.Z.Title,{level:5,children:"常见问题列表"}),(0,je.jsx)(be.Z,{bordered:!0,dataSource:B,renderItem:function(e,t){return(0,je.jsx)(be.Z.Item,{actions:[(0,je.jsx)(re.Z,{title:W.has(t)?"已保存":"保存到常见问题库",children:(0,je.jsx)(te.ZP,{type:W.has(t)?"default":"primary",icon:(0,je.jsx)(pe.Z,{}),size:"small",disabled:W.has(t),onClick:function(){return ie(e,t)},children:W.has(t)?"已保存":"保存"})},"save")],children:(0,je.jsx)(be.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})})},Ze=n(44679),Ce=n(65819),Ue=n(27858),Ae=n(27942),Ie=n(34718),Te=n(88165),Ee=["current","pageSize"],Pe=function(e){var t=e.superUser,n=(0,x.useIntl)(),r=(0,ae.useRef)(),s=(0,Ze.Z)().translateString,i=(0,ae.useState)(1),u=g()(i,2),d=u[0],p=u[1],y=(0,ae.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,z.u)((function(e){return e.currentOrg})),A=(0,de.j)((function(e){return e.currentKbase})),T=(0,ce.v)((function(e){return e.currentCategory})),P=(0,ce.v)((function(e){return e.categorySelectOptions})),q=(0,ae.useState)(!1),F=g()(q,2),D=F[0],L=F[1],se=(0,ae.useState)({}),ie=g()(se,2),le=ie[0],ue=ie[1],fe=(0,ae.useState)(!1),pe=g()(fe,2),ge=pe[0],me=pe[1],he=$.Z.useModal(),xe=g()(he,2),ve=xe[0],ye=xe[1],Me=(0,ae.useState)([]),we=g()(Me,2),be=we[0],ke=we[1],Pe=(0,ae.useState)([]),Oe=g()(Pe,2),qe=Oe[0],Fe=Oe[1],De=(0,ae.useState)(!1),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,ae.useState)(!1),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=(0,ae.useState)({}),Je=g()(He,2),Xe=Je[0],Qe=Je[1],Ke=(0,ae.useState)(0),Ge=g()(Ke,2),We=Ge[0],_e=Ge[1],$e=(0,ae.useState)(!1),et=g()($e,2),tt=et[0],nt=et[1],rt=function(){var e=f()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteText:",t),e.next=3,j(t);case 3:a=e.sent,console.log("deleteMember:",a),200===a.code?(m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),r.current.reload()):m.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),at=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=l()(qe),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,j(u);case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ke([]),Fe([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),st=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,je.jsx)(x.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,fixed:"left",tooltip:n.formatMessage({id:"llm.text.title.tooltip",defaultMessage:"文档的标题"})},{title:(0,je.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0,copyable:!0,tooltip:n.formatMessage({id:"llm.text.content.tooltip",defaultMessage:"文档的具体内容"})},{title:(0,je.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.text.status.tooltip",defaultMessage:"文档索引处理状态"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,je.jsx)(ee.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,je.jsx)(x.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.text.vectorStatus.tooltip",defaultMessage:"文档向量化处理状态"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,je.jsx)(ee.Z,{color:a,icon:(0,je.jsx)(Y.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,je.jsx)(x.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.text.category.tooltip",defaultMessage:"文档所属的分类"}),render:function(e,t){var n=P.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,je.jsx)(ee.Z,{color:"blue",children:n.label}):(0,je.jsx)(ee.Z,{color:"default",children:"未分类"})}},{title:(0,je.jsx)(x.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"llm.text.tags.tooltip",defaultMessage:"文档的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,je.jsxs)("div",{children:[r.map((function(e,t){return(0,je.jsx)(ee.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,je.jsxs)(ee.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,je.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.text.createdAt.tooltip",defaultMessage:"文档创建的时间"}),render:function(e,t){return oe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,je.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.text.updatedAt.tooltip",defaultMessage:"文档最后更新的时间"}),render:function(e,t){return t.updatedAt?oe()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],ot=[].concat(st,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,je.jsx)("a",{onClick:function(){ue(t),me(!0),L(!0)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,je.jsx)(te.ZP,{type:"link",onClick:function(){return function(e){ve.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,je.jsx)(B.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.title,"】？"),onOk:function(){rt(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(t)},danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete"),(0,je.jsx)(ne.Z,{menu:{items:[{key:"updateIndex",label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return ut(t)}},{key:"updateVectorIndex",label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return ct(t)}}]},placement:"bottomRight",children:(0,je.jsxs)(te.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,je.jsx)(N.Z,{})]})},"indexOperations")]}}]);(0,ae.useEffect)((function(){var e;null==r||null===(e=r.current)||void 0===e||e.reload()}),[A,T]);var it=function(){var e=f()(c()().mark((function e(t){var n,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:n=e.sent,console.log("handleCreateText response:",n),200===n.code?(null===(a=r.current)||void 0===a||a.reload(),L(!1)):m.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=f()(c()().mark((function e(t){var n,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==le?void 0:le.uid,e.next=3,b(t);case 3:n=e.sent,console.log("handleUpdateText response:",n),200===n.code?(null===(a=r.current)||void 0===a||a.reload(),L(!1)):m.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ut=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,U({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ct=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,I({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),dt=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=l()(qe),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,U({uid:u.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ft=function(){var e=f()(c()().mark((function e(){var t,a,s,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=l()(qe),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,I({uid:u.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),pt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,E({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,O({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),mt=function(){Le?Ne?m.yw.info("正在检查模型状态，请稍后再试"):(L(!0),me(!1),ue({})):ve.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},ht=function(){var e=f()(c()().mark((function e(){var t,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==We){e.next=3;break}return m.yw.warning(n.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:null==C?void 0:C.uid},e.next=8,Z(t);case 8:a=e.sent,console.log("handleDeleteAllConfirm response:",a,t),200===a.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=r.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||n.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),xt=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=o()({categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:null==C?void 0:C.uid,accessToken:a||"",exportType:t},Xe),"current"===t?(s.pageNumber=String(d-1),s.pageSize=String(k)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,Ce.kG)()+"/api/v1/llm/text/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),vt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Te.HK)(h.QPQ,null==C?void 0:C.uid,null==A?void 0:A.uid,h.whQ,{showLoading:!0,loadingMessage:n.formatMessage({id:"loading"}),errorMessage:n.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),yt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Le){e.next=3;break}return ve.confirm({title:n.formatMessage({id:"warning",defaultMessage:"警告"}),content:n.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响向量检索质量。是否继续？"}),okText:n.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){nt(!0)}}),e.abrupt("return");case 3:if(!Ne){e.next=6;break}return m.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 6:nt(!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Mt={selectedRowKeys:be,onChange:function(e,t){ke(e),Fe(t)}},wt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return xt("range",r,n)}})},s=0;s<r;s++)a();return t},bt=function(){var e=f()(c()().mark((function e(t){var a,s,o,i,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.noselection",defaultMessage:"请选择要处理的项目"})),e.abrupt("return");case 3:m.yw.loading(t?n.formatMessage({id:"enabling",defaultMessage:"正在启用..."}):n.formatMessage({id:"disabling",defaultMessage:"正在禁用..."})),s=0,o=0,i=l()(qe),e.prev=7,i.s();case 9:if((u=i.n()).done){e.next=23;break}return d=u.value,e.prev=11,e.next=14,R({uid:d.uid,enabled:t});case 14:200===e.sent.code?s++:o++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),o++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===o?m.yw.success(t?n.formatMessage({id:"batch.enable.success",defaultMessage:"成功启用 {count} 条记录"},{count:s}):n.formatMessage({id:"batch.disable.success",defaultMessage:"成功禁用 {count} 条记录"},{count:s})):m.yw.warning(t?n.formatMessage({id:"batch.enable.partial",defaultMessage:"启用了 {success} 条记录，{fail} 条记录启用失败"},{success:s,fail:o}):n.formatMessage({id:"batch.disable.partial",defaultMessage:"禁用了 {success} 条记录，{fail} 条记录禁用失败"},{success:s,fail:o})),ke([]),Fe([]),null===(a=r.current)||void 0===a||a.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(t){return e.apply(this,arguments)}}();return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ue.Z,{onModelStatusChange:function(e){ze(e),Ve(!1)}}),(0,je.jsx)(_.Z,{columns:ot,actionRef:r,cardBordered:!0,rowSelection:Mt,scroll:{x:1500},sticky:!0,request:function(){var e=f()(c()().mark((function e(r,s,i){var l,u,d,f,g,x,y,M,w,b;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",r,s,i),m.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),l=r.current,u=r.pageSize,d=a()(r,Ee),p(l),S(u),Qe(d),f=void 0,g=void 0,s&&Object.keys(s).length>0&&(x=Object.keys(s)[0],f=x,g="ascend"===s[x]?"ascend":"descend"),y=t?void 0:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,M=t||null==A?void 0:A.uid,w=o()(o()({pageNumber:l-1,pageSize:u,categoryUid:y,kbUid:M,orgUid:null==C?void 0:C.uid,superUser:t},d),{},{sortBy:f,sortDirection:g}),e.next=14,v(w);case 14:return b=e.sent,console.log("queryTextsByOrg response:",w,b),m.yw.destroy(),200===b.code?_e(null==b?void 0:b.data.totalElements):m.yw.error(b.message),e.abrupt("return",{data:null==b?void 0:b.data.content,success:!0,total:null==b?void 0:b.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:s(null==A?void 0:A.name)+" - 文本列表",tooltip:Ne?"正在检查嵌入式模型...":Le?"所添加文本内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return t?[]:function(){var e=[];(0,Ce.Ox)()||e.push((0,je.jsx)(te.ZP,{icon:(0,je.jsx)(V.Z,{}),type:"primary",onClick:mt,disabled:Ne,children:n.formatMessage({id:"create"})},"create"),(0,je.jsx)(re.Z,{title:n.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,je.jsx)(Ae.Z,{currentKbase:A,currentOrg:C,embeddingModelExists:Le,checkingEmbeddingModel:Ne})},"chat"));var t=[];be.length>0&&t.push({key:"batchDelete",icon:(0,je.jsx)(H.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete"})+" (".concat(be.length,")"),onClick:function(){$.Z.confirm({title:n.formatMessage({id:"batch.deleteTip"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm"})," ").concat(be.length," ").concat(n.formatMessage({id:"items"}),"?"),onOk:at,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,je.jsx)(J.Z,{}),label:n.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(be.length,")"),onClick:function(){return bt(!0)}},{key:"batchDisable",icon:(0,je.jsx)(X.Z,{}),label:n.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(be.length,")"),onClick:function(){return bt(!1)}},{key:"batchUpdateIndex",icon:(0,je.jsx)(Y.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(be.length,")"),onClick:dt},{key:"batchUpdateVectorIndex",icon:(0,je.jsx)(Y.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(be.length,")"),onClick:ft}),t.push({key:"deleteAll",icon:(0,je.jsx)(Q.Z,{}),danger:!0,label:n.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){$.Z.confirm({title:n.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:n.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文本数据吗？此操作不可恢复!"}),onOk:ht,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,je.jsx)(Y.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:pt},{key:"updateAllVectorIndex",icon:(0,je.jsx)(Y.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:gt});var r=[{key:"import",icon:(0,je.jsx)(K.Z,{}),label:n.formatMessage({id:"import"}),onClick:yt,disabled:Ne},{key:"export-current",icon:(0,je.jsx)(G.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xt("current")}}];return We>0&&(We<=1e3?r.push({key:"export-all",icon:(0,je.jsx)(G.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(We,"条)"),onClick:function(){return xt("all")}}):r.push({key:"export-range",icon:(0,je.jsx)(G.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(We,"条)"),children:wt(We)})),r.push({key:"download",icon:(0,je.jsx)(W.Z,{}),label:n.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,Ce.LG)()}}),e.push((0,je.jsx)(ne.Z,{menu:{items:r},placement:"bottom",children:(0,je.jsxs)(te.ZP,{type:"primary",children:[n.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,je.jsx)(N.Z,{})]})},"importExport")),t.length>0&&e.push((0,je.jsx)(ne.Z,{menu:{items:t},placement:"bottom",children:(0,je.jsxs)(te.ZP,{type:be.length>0?"primary":"default",danger:be.length>0,children:[be.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(be.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,je.jsx)(N.Z,{})]})},"batchOperations")),e}()}}),D&&(0,je.jsx)(Se,{isEdit:ge,open:D,text:le,onClose:function(){L(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),ge?lt(e):it(e)}}),tt&&(0,je.jsx)(Ie.Z,{type:h.pBv,acceptType:".xlsx,.xls,.csv",isModalOpen:tt,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),nt(!1),null==r||r.current.reload(),vt()},handleCancel:function(){console.log("handleUploadDragCancel"),nt(!1),null==r||r.current.reload()}}),ye]})}},78995:function(e,t,n){n.d(t,{Z:function(){return Se}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(6844),x=n(19736);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/create",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/update",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/delete",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/crawl",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return q.apply(this,arguments)}function q(){return(q=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/webpage/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=n(14888),D=n(77274),R=n(7358),L=n(15722),z=n(61107),Y=n(2484),B=n(10162),N=n(54881),V=n(11090),H=n(67412),J=n(46141),X=n(5089),Q=n(66810),K=n(31543),G=n(3925),W=n(77359),_=n(71277),$=n(1691),ee=n(44194),te=n(96596),ne=n.n(te),re=n(76711),ae=n.n(re),se=n(56773),oe=n(47598),ie=n(30064),le=n(52491),ue=n(86684),ce=n(13847),de=n(93189),fe=n(61689),pe=n(9428),ge=n(48769),me=n(55785),he=n(14377),xe=n(31549),ve=function(e){var t=e.isEdit,n=e.webpage,r=e.open,a=e.onClose,s=e.onSubmit,i=ie.A.useForm(),u=g()(i,1)[0],d=(0,se.j)((function(e){return e.currentKbase})),p=(0,F.u)((function(e){return e.currentOrg})),m=(0,oe.v)((function(e){return e.categorySelectOptions})),x=(0,oe.v)((function(e){return e.categoryTreeOptions})),v=(0,ee.useState)(),y=g()(v,2),M=y[0],w=y[1],b=(0,ee.useState)([]),k=g()(b,2),j=k[0],S=k[1],Z=(0,ee.useState)(!1),C=g()(Z,2),U=C[0],A=C[1],I=(0,ee.useState)(""),T=g()(I,2),E=T[0],P=T[1],O=(0,ee.useState)(!1),q=g()(O,2),D=q[0],R=q[1],L=(0,ee.useState)(""),z=g()(L,2),Y=(z[0],z[1]),N=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},V=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(!0),e.next=4,u.validateFields();case 4:t=e.sent,!(n=t.url)||n.startsWith("http://")||n.startsWith("https://")||(n="https://".concat(n)),r=o()(o()({},t),{},{url:n,categoryUid:M,tagList:N(j),kbUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid}),console.log("submit",r),s(r),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),de.ZP.error("请检查表单填写是否正确");case 16:return e.prev=16,R(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=u.getFieldValue("url");if(e){var t=e;e.startsWith("http://")||e.startsWith("https://")||(t="https://".concat(e)),Y(t),window.open(t,"_blank")}else de.ZP.warning("请输入网址")},J=function(){var e=E.trim();e&&!j.includes(e)&&S([].concat(ae()(j),[e])),A(!1),P("")},X=function(){A(!1),P("")};return(0,ee.useEffect)((function(){if(t)u.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,url:null==n?void 0:n.url,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid}),w(null==n?void 0:n.categoryUid),S(N((null==n?void 0:n.tagList)||[]));else{u.setFieldsValue({title:"",url:"",content:"",description:""});var e=function e(t){var n,r=l()(t||[]);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.key!==h.zBg)return a.key;var s=e(a.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(x||[]);if(e)u.setFieldValue("categoryUid",e),w(e);else if(m&&m.length>0){var r=m[0].value;u.setFieldValue("categoryUid",r),w(r)}S([]),A(!1),P("")}}),[t,n,u,m,x]),(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)(fe.Z,{title:t?"编辑网页":"添加网页",onClose:a,open:r,width:600,extra:(0,xe.jsxs)(pe.Z,{children:[(0,xe.jsx)(G.ZP,{onClick:a,children:"取消"}),(0,xe.jsx)(G.ZP,{type:"primary",onClick:V,loading:D,children:"提交"})]}),footer:null,children:(0,xe.jsxs)(ie.A,{form:u,name:"webpageForm",submitter:!1,children:[(0,xe.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==h.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(x||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("webpage category selected ".concat(e)),w(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,xe.jsx)(ue.Z,{label:"名称",name:"title",rules:[{required:!0,message:"请输入网页名称"}],placeholder:"请输入网页名称"}),(0,xe.jsx)(ue.Z,{label:"URL",name:"url",rules:[{required:!0,message:"请输入网页地址"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,message:"请输入有效的网址"}],placeholder:"请输入网址，例如：www.example.com",renderFormItem:function(e,t){var n;return(0,xe.jsxs)(pe.Z.Compact,{block:!0,children:[null===(n=t.defaultRender)||void 0===n?void 0:n.call(t,e),(0,xe.jsx)(G.ZP,{type:"link",onClick:H,children:"预览"})]})},tooltip:"支持 http 或 https 开头的网址"}),t&&(0,xe.jsx)(ce.Z,{label:"内容",name:"content",placeholder:"网页内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"网页的文本内容，用于知识库检索"}),(0,xe.jsx)(ie.A.Item,{label:"标签",name:"tagList",tooltip:"为网页添加标签，便于分类和检索",children:(0,xe.jsxs)("div",{style:{minHeight:"32px"},children:[(0,xe.jsx)(pe.Z,{wrap:!0,style:{marginBottom:8},children:N(j).map((function(e,t){return(0,xe.jsx)(Q.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void S(N(j.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),U?(0,xe.jsxs)(pe.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)(ge.Z,{value:E,onChange:function(e){P(e.target.value)},onKeyDown:function(e){"Enter"===e.key?J():"Escape"===e.key&&X()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,xe.jsx)(G.ZP,{type:"primary",size:"small",icon:(0,xe.jsx)(me.Z,{}),onClick:J,disabled:!E.trim(),children:"保存"}),(0,xe.jsx)(G.ZP,{size:"small",icon:(0,xe.jsx)(he.Z,{}),onClick:X,children:"取消"})]}):(0,xe.jsx)(G.ZP,{type:"dashed",onClick:function(){A(!0),P("")},icon:(0,xe.jsx)(B.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,xe.jsx)(ce.Z,{label:"描述",name:"description",placeholder:"请输入网页描述",fieldProps:{maxLength:500,showCount:!0}})]})})})},ye=n(65819),Me=n(27858),we=n(27942),be=n(44679),ke=n(90104),je=["current","pageSize"],Se=function(e){var t=e.superUser,n=(0,x.useIntl)(),r=(0,be.Z)().translateString,s=(0,ee.useRef)(),i=(0,ee.useState)(1),u=g()(i,2),d=u[0],p=u[1],y=(0,ee.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,F.u)((function(e){return e.currentOrg})),A=(0,se.j)((function(e){return e.currentKbase})),T=(0,oe.v)((function(e){return e.currentCategory})),P=(0,oe.v)((function(e){return e.categorySelectOptions})),q=(0,ee.useState)(!1),te=g()(q,2),re=te[0],ae=te[1],ie=(0,ee.useState)({}),le=g()(ie,2),ue=le[0],ce=le[1],de=(0,ee.useState)(!1),fe=g()(de,2),pe=fe[0],ge=fe[1],me=J.Z.useModal(),he=g()(me,2),Se=(he[0],he[1]),Ze=(0,ee.useState)(!1),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,ee.useState)(!1),Te=g()(Ie,2),Ee=Te[0],Pe=Te[1],Oe=(0,ee.useState)({}),qe=g()(Oe,2),Fe=qe[0],De=qe[1],Re=(0,ee.useState)(0),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,ee.useState)([]),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,ee.useState)([]),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],Ge=function(){var e=f()(c()().mark((function e(t){var r,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content&&""!==t.content.trim()){e.next=3;break}return m.yw.warning(n.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=4,r={uid:t.uid},e.next=8,U(r);case 8:a=e.sent,console.log("更新索引响应:",a,r),m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(o=s.current)||void 0===o||o.reload()):m.yw.error(a.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=f()(c()().mark((function e(t){var r,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content&&""!==t.content.trim()){e.next=3;break}return m.yw.warning(n.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=4,r={uid:t.uid},e.next=8,I(r);case 8:a=e.sent,console.log("更新向量索引响应:",a,r),m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(o=s.current)||void 0===o||o.reload()):m.yw.error(a.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),_e=function(){var e=f()(c()().mark((function e(t){var r,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"crawling.content",defaultMessage:"正在抓取网页内容..."})),e.prev=1,r={uid:t.uid},e.next=5,Z(r);case 5:a=e.sent,console.log("抓取网页内容响应:",a,r),m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"crawl.content.success",defaultMessage:"网页内容抓取已触发"})),null===(o=s.current)||void 0===o||o.reload()):m.yw.error(a.message||n.formatMessage({id:"crawl.content.failed",defaultMessage:"网页内容抓取失败"})),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"crawl.content.error",defaultMessage:"抓取网页内容过程发生错误"})),console.error("抓取网页内容错误:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),$e=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,xe.jsx)(x.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"title",copyable:!0,tooltip:n.formatMessage({id:"webpage.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.title}),(0,xe.jsx)(X.Z.Text,{copyable:{text:(null==t?void 0:t.title)||""}})]})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:n.formatMessage({id:"webpage.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,xe.jsx)(X.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"webpage.category.tooltip",defaultMessage:"网页内容所属的分类"}),render:function(e,t){var n=P.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,xe.jsx)(Q.Z,{color:"blue",children:n.label}):(0,xe.jsx)(Q.Z,{color:"default",children:"未分类"})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"webpage.status.tooltip",defaultMessage:"网页索引状态"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="processing"),(0,xe.jsx)(Q.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat(r.toLowerCase()),defaultMessage:r})})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"webpage.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="warning"),r?(0,xe.jsx)(Q.Z,{color:a,icon:(0,xe.jsx)(D.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase()),defaultMessage:r})}):"-"}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:n.formatMessage({id:"webpage.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,xe.jsx)(x.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"webpage.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,xe.jsxs)("div",{children:[r.map((function(e,t){return(0,xe.jsx)(Q.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,xe.jsxs)(Q.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,copyable:!0,width:300,tooltip:n.formatMessage({id:"webpage.content.tooltip",defaultMessage:"爬取的网页内容摘要"}),render:function(e,t){var r=t.content||"-",a=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ke.TE)(t);case 2:e.sent.success?m.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):m.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,xe.jsx)(K.Z,{content:(0,xe.jsxs)("div",{children:[(0,xe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,xe.jsx)("span",{children:n.formatMessage({id:"webpage.content.preview",defaultMessage:"网页内容预览"})}),(0,xe.jsx)(G.ZP,{type:"text",icon:(0,xe.jsx)(R.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,xe.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:n.formatMessage({id:"webpage.content",defaultMessage:"网页内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,xe.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:n.formatMessage({id:"webpage.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,xe.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:n.formatMessage({id:"webpage.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?ne()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],et=[].concat($e,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,xe.jsx)("a",{onClick:function(){ce(t),ge(!0),ae(!0)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,xe.jsx)(W.Z,{title:n.formatMessage({id:"deleteTip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.title,"】？"),onConfirm:function(){return tt(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),icon:(0,xe.jsx)(L.Z,{style:{color:"red"}}),children:(0,xe.jsx)(G.ZP,{type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete"),(0,xe.jsx)(_.Z,{menu:{items:[{key:"crawlContent",icon:(0,xe.jsx)(z.Z,{}),label:n.formatMessage({id:"crawl.content",defaultMessage:"抓取内容"}),onClick:function(){return _e(t)}},{key:"updateIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Ge(t)}},{key:"updateVectorIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return We(t)}}]},placement:"bottomRight",children:(0,xe.jsx)($.Z,{title:n.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),children:(0,xe.jsxs)(G.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),(0,xe.jsx)(Y.Z,{})]})})},"indexOperations")]}}]);(0,ee.useEffect)((function(){var e;null==s||null===(e=s.current)||void 0===e||e.reload()}),[A,T]);var tt=function(){var e=f()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t);case 2:200===(r=e.sent).code?(m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),s.current.reload()):m.yw.error(r.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:200===(n=e.sent).code?(null===(r=s.current)||void 0===r||r.reload(),ae(!1)):m.yw.error(n.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),rt=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==ue?void 0:ue.uid,e.next=3,b(t);case 3:200===(n=e.sent).code?(null===(r=s.current)||void 0===r||r.reload(),ae(!1)):m.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),at=function(){Ue?Ee?m.yw.info("正在检查模型状态，请稍后再试"):(ae(!0),ge(!1),ce({})):J.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},st=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,a=0,o=l()(Qe),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,j(u);case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:r})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:r,fail:a})),He([]),Ke([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ot=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:if(r=Qe.filter((function(e){return!e.content||""===e.content.trim()})),!(r.length>0)){e.next=7;break}return m.yw.warning(n.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(r.length,"条记录)")),e.abrupt("return");case 7:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,o=0,i=l()(Qe),e.prev=11,i.s();case 13:if((u=i.n()).done){e.next=27;break}return d=u.value,e.prev=15,e.next=18,U({uid:d.uid});case 18:200===e.sent.code?a++:o++,e.next=25;break;case 22:e.prev=22,e.t0=e.catch(15),o++;case 25:e.next=13;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(11),i.e(e.t1);case 32:return e.prev=32,i.f(),e.finish(32);case 35:m.yw.destroy(),0===o?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(o," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 38:case"end":return e.stop()}}),e,null,[[11,29,32,35],[15,22]])})));return function(){return e.apply(this,arguments)}}(),it=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Qe.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:if(r=Qe.filter((function(e){return!e.content||""===e.content.trim()})),!(r.length>0)){e.next=7;break}return m.yw.warning(n.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(r.length,"条记录)")),e.abrupt("return");case 7:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,o=0,i=l()(Qe),e.prev=11,i.s();case 13:if((u=i.n()).done){e.next=27;break}return d=u.value,e.prev=15,e.next=18,I({uid:d.uid});case 18:200===e.sent.code?a++:o++,e.next=25;break;case 22:e.prev=22,e.t0=e.catch(15),o++;case 25:e.next=13;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(11),i.e(e.t1);case 32:return e.prev=32,i.f(),e.finish(32);case 35:m.yw.destroy(),0===o?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(o," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 38:case"end":return e.stop()}}),e,null,[[11,29,32,35],[15,22]])})));return function(){return e.apply(this,arguments)}}(),lt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,E({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ut=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,O({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ct=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=localStorage.getItem(h.LA8),s=o()({categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:(null==C?void 0:C.uid)||"",accessToken:a||"",exportType:t},Fe),"current"===t?(s.pageNumber=d-1,s.pageSize=k):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,ye.kG)()+"/api/v1/webpage/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),dt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return ct("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Me.Z,{onModelStatusChange:function(e){Ae(e),Pe(!1)}}),(0,xe.jsx)(H.Z,{columns:et,actionRef:s,cardBordered:!0,scroll:{x:2200},rowSelection:{selectedRowKeys:Ve,onChange:function(e,t){He(e),Ke(t)}},request:function(){var e=f()(c()().mark((function e(n,r,s){var i,l,u,d,f,g,x,y,M,w;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.current,l=n.pageSize,u=a()(n,je),p(i),S(l),De(u),d=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],d=g,f="ascend"===r[g]?"ascend":"descend"),x=t?void 0:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,y=t||null==A?void 0:A.uid,M=o()(o()({pageNumber:i-1,pageSize:l,categoryUid:x,kbUid:y,orgUid:null==C?void 0:C.uid,superUser:t},u),{},{sortBy:d,sortDirection:f}),e.next=12,v(M);case 12:return w=e.sent,console.log("queryWebpagesByOrg: ",w,M),200===w.code?Ye(null==w?void 0:w.data.totalElements):m.yw.error(w.message),e.abrupt("return",{data:null==w?void 0:w.data.content,success:!0,total:null==w?void 0:w.data.totalElements});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:r(null==A?void 0:A.name)+" - 网页爬虫",tooltip:Ee?"正在检查嵌入式模型...":Ue?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:t?function(){return[]}:function(){var e=[(0,xe.jsx)(G.ZP,{type:"primary",icon:(0,xe.jsx)(B.Z,{}),onClick:function(){return(0,Me.w)(at,Ue,Ee)},disabled:Ee||!Ue,children:n.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,xe.jsx)(we.Z,{currentKbase:A,currentOrg:C,embeddingModelExists:Ue,checkingEmbeddingModel:Ee||!Ue},"chat")],t=[];Ve.length>0&&t.push({key:"batchDelete",icon:(0,xe.jsx)(N.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Ve.length,")"),onClick:function(){}},{key:"batchUpdateIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Ve.length,")"),onClick:ot},{key:"batchUpdateVectorIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Ve.length,")"),onClick:it}),t.push({key:"updateAllIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:lt},{key:"updateAllVectorIndex",icon:(0,xe.jsx)(D.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:ut});var r=[{key:"export-current",icon:(0,xe.jsx)(V.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ct("current")}}];return ze>0&&(ze<=1e3?r.push({key:"export-all",icon:(0,xe.jsx)(V.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ze,"条)"),onClick:function(){return ct("all")}}):r.push({key:"export-range",icon:(0,xe.jsx)(V.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ze,"条)"),children:dt(ze)})),e.push((0,xe.jsx)(_.Z,{menu:{items:r},placement:"bottom",children:(0,xe.jsxs)(G.ZP,{type:"primary",icon:(0,xe.jsx)(V.Z,{}),children:[n.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,xe.jsx)(Y.Z,{})]})},"exportDropdown")),t.length>0&&e.push((0,xe.jsx)(W.Z,{title:n.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(n.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(Ve.length," ").concat(n.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:st,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),icon:(0,xe.jsx)(L.Z,{style:{color:"red"}}),disabled:0===Ve.length,children:(0,xe.jsx)(_.Z,{menu:{items:t},placement:"bottom",children:(0,xe.jsxs)(G.ZP,{type:Ve.length>0?"primary":"default",danger:Ve.length>0,children:[Ve.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Ve.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,xe.jsx)(Y.Z,{})]})},"batchOperations")},"batchDeleteConfirm")),e}}),re&&(0,xe.jsx)(ve,{isEdit:pe,open:re,webpage:ue,onClose:function(){ae(!1)},onSubmit:function(e){pe?rt(e):nt(e)}}),Se]})}},81703:function(e,t,n){n.d(t,{Z:function(){return de}});var r=n(84176),a=n.n(r),s=n(73193),o=n.n(s),i=n(86222),l=n.n(i),u=n(90819),c=n.n(u),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(93527),h=n(6844),x=n(19736);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/create",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/update",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/delete",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/llm/website/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=n(14888),q=n(77274),F=n(15722),D=n(2484),R=n(10162),L=n(54881),z=n(11090),Y=n(67412),B=n(46141),N=n(5089),V=n(66810),H=n(77359),J=n(3925),X=n(71277),Q=n(1691),K=n(44194),G=n(96596),W=n.n(G),_=n(56773),$=n(30064),ee=n(86684),te=n(13847),ne=n(61689),re=n(31549),ae=function(e){var t=e.isEdit,n=e.website,r=e.open,a=e.onClose,s=e.onSubmit,i=$.A.useForm(),l=g()(i,1)[0],u=(0,_.j)((function(e){return e.currentKbase})),d=(0,O.u)((function(e){return e.currentOrg})),p=(0,K.useState)(!1),m=g()(p,2),h=m[0],x=m[1],v=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x(!0),e.next=4,l.validateFields();case 4:t=e.sent,n=o()(o()({},t),{},{kbUid:null==u?void 0:u.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",n),s(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0);case 13:return e.prev=13,e.finish(13);case 15:case"end":return e.stop()}}),e,null,[[0,10,13,15]])})));return function(){return e.apply(this,arguments)}}();return(0,K.useEffect)((function(){t?l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,url:null==n?void 0:n.url,description:null==n?void 0:n.description}):l.setFieldsValue({name:"",url:"",content:""})}),[t,n,l]),(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(ne.Z,{title:"标签",onClose:a,open:r,width:600,extra:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(J.ZP,{onClick:a,style:{marginRight:8},children:"取消"}),(0,re.jsx)(J.ZP,{type:"primary",onClick:v,loading:h,children:"提交"})]}),footer:null,children:(0,re.jsxs)($.A,{form:l,name:"tagForm",submitter:!1,children:[(0,re.jsx)(ee.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,re.jsx)(ee.Z,{label:"URL",name:"url",rules:[{required:!0,pattern:/^https?:\/\/[^\s]+$/}]}),(0,re.jsx)(te.Z,{label:"描述",name:"description"})]})})})},se=n(47598),oe=n(65819),ie=n(27858),le=n(27942),ue=n(44679),ce=["current","pageSize"],de=function(e){var t=e.superUser,n=(0,x.useIntl)(),r=(0,ue.Z)().translateString,s=(0,K.useRef)(),i=(0,K.useState)(1),u=g()(i,2),d=u[0],p=u[1],y=(0,K.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,O.u)((function(e){return e.currentOrg})),A=(0,_.j)((function(e){return e.currentKbase})),T=(0,se.v)((function(e){return e.currentCategory})),P=(0,se.v)((function(e){return e.categorySelectOptions})),G=(0,K.useState)(!1),$=g()(G,2),ee=$[0],te=$[1],ne=(0,K.useState)({}),de=g()(ne,2),fe=de[0],pe=de[1],ge=(0,K.useState)(!1),me=g()(ge,2),he=me[0],xe=me[1],ve=B.Z.useModal(),ye=g()(ve,2),Me=(ye[0],ye[1]),we=(0,K.useState)(!1),be=g()(we,2),ke=be[0],je=be[1],Se=(0,K.useState)(!1),Ze=g()(Se,2),Ce=Ze[0],Ue=Ze[1],Ae=(0,K.useState)({}),Ie=g()(Ae,2),Te=Ie[0],Ee=Ie[1],Pe=(0,K.useState)(0),Oe=g()(Pe,2),qe=Oe[0],Fe=Oe[1],De=(0,K.useState)([]),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,K.useState)([]),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=function(){var e=f()(c()().mark((function e(t){var r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,Z({uid:t.uid});case 4:r=e.sent,m.yw.destroy(),200===r.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(a=s.current)||void 0===a||a.reload()):m.yw.error(r.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),Je=function(){var e=f()(c()().mark((function e(t){var r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,U({uid:t.uid});case 4:r=e.sent,m.yw.destroy(),200===r.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(a=s.current)||void 0===a||a.reload()):m.yw.error(r.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),Xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,re.jsx)(x.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,tooltip:n.formatMessage({id:"website.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,re.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,re.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.name}),(0,re.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:n.formatMessage({id:"website.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,re.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,re.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,re.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"website.status.tooltip",defaultMessage:"网页索引状态"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="processing"),(0,re.jsx)(V.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat(r.toLowerCase()),defaultMessage:r})})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"website.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="warning"),r?(0,re.jsx)(V.Z,{color:a,icon:(0,re.jsx)(q.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase()),defaultMessage:r})}):"-"}},{title:(0,re.jsx)(x.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:n.formatMessage({id:"website.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,re.jsx)(x.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"website.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,re.jsxs)("div",{children:[r.map((function(e,t){return(0,re.jsx)(V.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,re.jsxs)(V.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,width:300,tooltip:n.formatMessage({id:"website.content.tooltip",defaultMessage:"爬取的网页内容摘要"})},{title:(0,re.jsx)(x.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:100,tooltip:n.formatMessage({id:"website.category.tooltip",defaultMessage:"网页内容所属的分类类型"}),render:function(e,t){var n=P.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,re.jsx)(V.Z,{children:null==n?void 0:n.label})}},{title:(0,re.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:n.formatMessage({id:"website.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return W()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,re.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:n.formatMessage({id:"website.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?W()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Qe=[].concat(Xe,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,re.jsx)("a",{onClick:function(){pe(t),xe(!0),te(!0)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,re.jsx)(H.Z,{title:n.formatMessage({id:"deleteTip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onConfirm:function(){return Ke(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),icon:(0,re.jsx)(F.Z,{style:{color:"red"}}),children:(0,re.jsx)(J.ZP,{type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete"),(0,re.jsx)(X.Z,{menu:{items:[{key:"updateIndex",label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return He(t)}},{key:"updateVectorIndex",label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Je(t)}}]},placement:"bottomRight",children:(0,re.jsx)(Q.Z,{title:n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,re.jsxs)(J.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,re.jsx)(D.Z,{})]})})},"indexOperations")]}}]);(0,K.useEffect)((function(){var e;null==s||null===(e=s.current)||void 0===e||e.reload()}),[A,T]);var Ke=function(){var e=f()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t);case 2:200===(r=e.sent).code?(m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),s.current.reload()):m.yw.error(r.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:200===(n=e.sent).code?(null===(r=s.current)||void 0===r||r.reload(),te(!1)):m.yw.error(n.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==fe?void 0:fe.uid,e.next=3,b(t);case 3:200===(n=e.sent).code?(null===(r=s.current)||void 0===r||r.reload(),te(!1)):m.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_e=function(){ke?Ce?m.yw.info("正在检查模型状态，请稍后再试"):(te(!0),xe(!1),pe({})):B.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},$e=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ne.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,a=0,o=l()(Ne),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,j(u);case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:r})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:r,fail:a})),ze([]),Ve([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),et=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ne.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),r=0,a=0,o=l()(Ne),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,Z({uid:u.uid});case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的索引，").concat(a," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),tt=function(){var e=f()(c()().mark((function e(){var t,r,a,o,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ne.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),r=0,a=0,o=l()(Ne),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return u=i.value,e.prev=11,e.next=14,U({uid:u.uid});case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的向量索引，").concat(a," 条记录更新失败")})),null===(t=s.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,I({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),rt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,E({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(r=s.current)||void 0===r||r.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),at=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=localStorage.getItem(h.LA8),s=o()({categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:(null==C?void 0:C.uid)||"",accessToken:a||"",exportType:t},Te),"current"===t?(s.pageNumber=d-1,s.pageSize=k):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,oe.kG)()+"/api/v1/website/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),st=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return at("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(ie.Z,{onModelStatusChange:function(e){je(e),Ue(!1)}}),(0,re.jsx)(Y.Z,{columns:Qe,actionRef:s,cardBordered:!0,scroll:{x:2e3},rowSelection:{selectedRowKeys:Le,onChange:function(e,t){ze(e),Ve(t)}},request:function(){var e=f()(c()().mark((function e(n,r,s){var i,l,u,d,f,g,x,y,M,w;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.current,l=n.pageSize,u=a()(n,ce),p(i),S(l),Ee(u),d=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],d=g,f="ascend"===r[g]?"ascend":"descend"),x=t?void 0:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,y=t||null==A?void 0:A.uid,M=o()(o()({pageNumber:i-1,pageSize:l,categoryUid:x,kbUid:y,orgUid:null==C?void 0:C.uid,superUser:t},u),{},{sortBy:d,sortDirection:f}),e.next=12,v(M);case 12:return w=e.sent,console.log("queryWebsitesByOrg: ",w),200===w.code?Fe(null==w?void 0:w.data.totalElements):m.yw.error(w.message),e.abrupt("return",{data:null==w?void 0:w.data.content,success:!0,total:null==w?void 0:w.data.totalElements});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:r(null==A?void 0:A.name)+" - 网页爬虫",tooltip:Ce?"正在检查嵌入式模型...":ke?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:t?function(){return[]}:function(){var e=[(0,re.jsx)(J.ZP,{type:"primary",icon:(0,re.jsx)(R.Z,{}),onClick:function(){return(0,ie.w)(_e,ke,Ce)},disabled:Ce||!ke,children:n.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,re.jsx)(le.Z,{currentKbase:A,currentOrg:C,embeddingModelExists:ke,checkingEmbeddingModel:Ce||!ke},"chat")],t=[];Le.length>0&&t.push({key:"batchDelete",icon:(0,re.jsx)(L.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Le.length,")"),onClick:function(){}},{key:"batchUpdateIndex",icon:(0,re.jsx)(q.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Le.length,")"),onClick:et},{key:"batchUpdateVectorIndex",icon:(0,re.jsx)(q.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Le.length,")"),onClick:tt}),t.push({key:"updateAllIndex",icon:(0,re.jsx)(q.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:nt},{key:"updateAllVectorIndex",icon:(0,re.jsx)(q.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:rt});var r=[{key:"export-current",icon:(0,re.jsx)(z.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return at("current")}}];return qe>0&&(qe<=1e3?r.push({key:"export-all",icon:(0,re.jsx)(z.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(qe,"条)"),onClick:function(){return at("all")}}):r.push({key:"export-range",icon:(0,re.jsx)(z.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(qe,"条)"),children:st(qe)})),e.push((0,re.jsx)(X.Z,{menu:{items:r},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:"primary",icon:(0,re.jsx)(z.Z,{}),children:[n.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,re.jsx)(D.Z,{})]})},"exportDropdown")),t.length>0&&e.push((0,re.jsx)(H.Z,{title:n.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(n.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(Le.length," ").concat(n.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:$e,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),icon:(0,re.jsx)(F.Z,{style:{color:"red"}}),disabled:0===Le.length,children:(0,re.jsx)(X.Z,{menu:{items:t},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:Le.length>0?"primary":"default",danger:Le.length>0,children:[Le.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Le.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,re.jsx)(D.Z,{})]})},"batchOperations")},"batchDeleteConfirm")),e}}),ee&&(0,re.jsx)(ae,{isEdit:he,open:ee,website:fe,onClose:function(){te(!1)},onSubmit:function(e){he?We(e):Ge(e)}}),Me]})}}}]);