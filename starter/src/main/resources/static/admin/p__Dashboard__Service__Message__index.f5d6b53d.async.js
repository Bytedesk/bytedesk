"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2949],{28196:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});var s=t(76711),r=t.n(s),n=t(36111),i=t(21600),l=t(94976),o=t(4628),d=t(59094),u=t(48032),c=t(58620),g=t(35517),f=t(82485),m=t(85977),p=t(73193),M=t.n(p),v=t(84176),h=t.n(v),y=t(90819),b=t.n(y),x=t(89933),w=t.n(x),k=t(43388);function A(e){return j.apply(this,arguments)}function j(){return(j=w()(b()().mark((function e(a){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/taboo/message/query/org",{method:"GET",params:M()(M()({},a),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return E.apply(this,arguments)}function E(){return(E=w()(b()().mark((function e(a){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/taboo/message/delete",{method:"POST",data:M()(M()({},a),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=t(74171),C=t(34512),T=t(90581),U=t(43275),O=t(44194),Z=t(67242),q=t(31549),F=["current"],D=function(){var e,a,t,s,n,i=(0,o.useIntl)(),d=(0,O.useRef)(),u=(0,I.u)((function(e){return e.currentOrg})),c=(0,o.useAccess)(),g=null==c||null===(e=c.getModulePermission)||void 0===e?void 0:e.call(c,m.MY.TABOO_MESSAGE),f=null!==(a=null==g||null===(t=g.canRead)||void 0===t?void 0:t.call(g))&&void 0!==a&&a,p=null!==(s=null==g||null===(n=g.canDelete)||void 0===n?void 0:n.call(g))&&void 0!==s&&s,v=function(){var e=w()(b()().mark((function e(a){var t,s;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return k.yw.warning(i.formatMessage({id:"tabooMessage.permission.delete.denied",defaultMessage:"无权限：删除敏感词消息"})),e.abrupt("return");case 3:if(null!=a&&a.uid){e.next=6;break}return k.yw.warning(i.formatMessage({id:"tabooMessage.uid.missing",defaultMessage:"缺少UID，无法删除"})),e.abrupt("return");case 6:return k.yw.loading(i.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=7,e.next=10,S({uid:a.uid,orgUid:(null==a?void 0:a.orgUid)||(null==u?void 0:u.uid)});case 10:t=e.sent,k.yw.destroy(),200===(null==t?void 0:t.code)?(k.yw.success(i.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==d||null===(s=d.current)||void 0===s||s.reload()):k.yw.error((null==t?void 0:t.message)||i.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),k.yw.destroy(),k.yw.error(i.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(a){return e.apply(this,arguments)}}(),y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,q.jsx)(o.FormattedMessage,{id:"tabooMessage.content",defaultMessage:"原始内容"}),dataIndex:"content",ellipsis:!0,copyable:!0,search:!0},{title:(0,q.jsx)(o.FormattedMessage,{id:"tabooMessage.replacedContent",defaultMessage:"替换后内容"}),dataIndex:"replacedContent",ellipsis:!0,copyable:!0,hideInSearch:!0},{title:(0,q.jsx)(o.FormattedMessage,{id:"tabooMessage.tabooWordList",defaultMessage:"命中敏感词"}),dataIndex:"tabooWordList",hideInSearch:!0,render:function(e,a){var t=(null==a?void 0:a.tabooWordList)||[];return t.length?(0,q.jsx)(q.Fragment,{children:t.map((function(e){return(0,q.jsx)(T.Z,{children:e},e)}))}):"-"}},{title:(0,q.jsx)(o.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,q.jsx)(o.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:i.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,a){var t=r()(f?[(0,q.jsx)("a",{onClick:function(){!function(e){var a;if(f){console.log("handleShowChatHistory",e);var t=null==e?void 0:e.threadUid,s=(null==e?void 0:e.orgUid)||(null==u?void 0:u.uid);if(t)if(s){var r={chatConfig:{org:s,t:l.CCt,sid:t}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)}else k.yw.warning(i.formatMessage({id:"org.missing",defaultMessage:"缺少组织信息，无法查看历史会话"}));else k.yw.warning(i.formatMessage({id:"tabooMessage.threadUid.missing",defaultMessage:"缺少会话UID，无法查看历史会话"}))}else k.yw.warning(i.formatMessage({id:"tabooMessage.permission.read.denied",defaultMessage:"无权限：查看敏感词消息"}))}(a)},children:i.formatMessage({id:"view",defaultMessage:"View"})},"view")]:[]);return p&&t.push((0,q.jsx)(U.Z,{title:i.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:i.formatMessage({id:"deleteAffirm",defaultMessage:"确定要删除吗？"}),onConfirm:function(){return v(a)},okText:i.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:i.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,q.jsx)("a",{style:{color:"red",marginLeft:8},children:i.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),t}}];return(0,q.jsx)(C.Z,{columns:y,actionRef:d,cardBordered:!0,request:function(){var e=w()(b()().mark((function e(a){var t,s,r,n,i,l,o;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=a).current,i=h()(r,F),l=M()({pageNumber:(null!=n?n:1)-1,orgUid:null==u?void 0:u.uid},i),e.next=4,A(l);case 4:return o=e.sent,Z.Z.debug("queryTabooMessagesByOrg response:",o,l),200!==o.code&&k.yw.error(o.message),e.abrupt("return",{data:null==o||null===(t=o.data)||void 0===t?void 0:t.content,success:!0,total:null==o||null===(s=o.data)||void 0===s?void 0:s.totalElements});case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:i.formatMessage({id:"taboo.messages",defaultMessage:"敏感词消息"})})},G=function(){var e,a,t,s,p,M,v,h,y,b,x=(0,o.useIntl)(),w=(0,o.useAccess)(),k=null!==(e=null==w||null===(a=w.hasAnyModulePermission)||void 0===a?void 0:a.call(w,m.MY.MESSAGE))&&void 0!==e&&e,A=null!==(t=null==w||null===(s=w.hasAnyModulePermission)||void 0===s?void 0:s.call(w,m.MY.MESSAGE_LEAVE))&&void 0!==t&&t,j=null!==(p=null==w||null===(M=w.hasAnyModulePermission)||void 0===M?void 0:M.call(w,m.MY.MESSAGE_RATING))&&void 0!==p&&p,S=null!==(v=null==w||null===(h=w.hasAnyModulePermission)||void 0===h?void 0:h.call(w,m.MY.TABOO_MESSAGE))&&void 0!==v&&v,E=r()(k?[{key:"message",label:x.formatMessage({id:"message.tab.all"}),children:(0,q.jsx)(n.Z,{type:l.Nqz})}]:[]);if((0,c.OJ)()&&E.push.apply(E,r()(A?[{key:"messageLeave",label:x.formatMessage({id:"message.tab.leave"}),children:(0,q.jsx)(d.Z,{})}]:[]).concat(r()(j?[{key:"messageRating",label:x.formatMessage({id:"message.tab.rating"}),children:(0,q.jsx)(u.Z,{superUser:!1})}]:[]))),(0,c.Ox)()||E.push.apply(E,r()(k?[{key:"message.group",label:x.formatMessage({id:"message.tab.group"}),children:(0,q.jsx)(g.Z,{type:l.Nqz,superUser:!1})},{key:"message.member",label:x.formatMessage({id:"message.tab.member"}),children:(0,q.jsx)(f.Z,{type:l.Nqz,superUser:!1})}]:[])),E.push.apply(E,r()(S?[{key:"tabooMessage",label:x.formatMessage({id:"taboo.messages",defaultMessage:"敏感词消息"}),children:(0,q.jsx)(D,{})}]:[])),0===E.length)return null;var I=String(null!==(y=null===(b=E[0])||void 0===b?void 0:b.key)&&void 0!==y?y:"message");return(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(i.Z,{defaultActiveKey:I,items:E,style:{margin:10}})})}}}]);