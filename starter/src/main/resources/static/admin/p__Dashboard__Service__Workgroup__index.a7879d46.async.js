"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{96845:function(e,t,n){n.d(t,{$l:function(){return p},M8:function(){return w},Xd:function(){return x},gf:function(){return M},lg:function(){return f},lz:function(){return b},p0:function(){return c}});var r=n(90819),o=n.n(r),i=n(73193),a=n.n(i),s=n(89933),l=n.n(s),u=n(36265),d=n(5861);function c(e){return g.apply(this,arguments)}function g(){return(g=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/query/org",{method:"GET",params:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return v.apply(this,arguments)}function v(){return(v=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/create",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/avatar",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/kbUid",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/prompt/text",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return j.apply(this,arguments)}function j(){return(j=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/delete",{method:"POST",data:a()(a()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},65307:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ce}});var r=n(44194),o=n(73120),i=n(5861),a=n(76711),s=n.n(a),l=n(89957),u=n.n(l),d=n(90819),c=n.n(d),g=n(89933),f=n.n(g),v=n(73193),p=n.n(v),m=n(45332),b=n.n(m),h=n(33154),x=n(2157),k=n(76185),w=n(33122),S=n(92011),M=n(11258),j=n(96082),y=n(95111),T=n(44877),R=n(88565),Z=n(6430),C=n(12715),F=n(47192),P=n(80597),L=n(6639),A=n(38086),W=n(33551),q=n(86775),U=n(55279),E=n(6992),O=n(41881),I=n(91768),J=n(28172),K=n(35911),z=n(90417),V=n(67878),D=n(5286),N=n(41168),Q=n(71865),X=n(76071),B=n(74494),H=n(36265),G=n(28902),$=n(93458),Y=n(61401),_=(n(14368),n(43769),n(74008)),ee=n(20427),te=n(62742),ne=n(12745),re=n(21035),oe=n(98896),ie=n(10154),ae=n.n(ie),se=n(96845),le=n(31661),ue=n(40845),de=n(53380),ce=n(67913),ge=n(2685),fe=n(42539),ve=n(31549),pe=function(e){var t=e.variant,n=e.robotRoutingSettings,o=e.onRobotRoutingSettingsChange,i=ue.A.useForm(),a=b()(i,1)[0],s=(0,r.useRef)(!1),l=(0,r.useState)([]),u=b()(l,2),d=u[0],g=u[1],v=(0,Q.u)((function(e){return e.currentOrg})),p=(0,le.Z)().translateString,m=(0,r.useMemo)((function(){var e;return null!==(e=null==n?void 0:n.draft)&&void 0!==e?e:null==n?void 0:n.live}),[n]);(0,r.useEffect)((function(){var e,n;if("workgroup"===t){var r=null!==(e=null==m?void 0:m.robotUid)&&void 0!==e?e:null==m||null===(n=m.robot)||void 0===n?void 0:n.uid;a.setFieldsValue({defaultRobot:null==m?void 0:m.defaultRobot,offlineRobot:null==m?void 0:m.offlineRobot,nonWorktimeRobot:null==m?void 0:m.nonWorktimeRobot,robotUid:r})}}),[t,m,a]);var h=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.current){e.next=3;break}return fe.Z.debug("isLoading: 1",s.current),e.abrupt("return");case 3:return s.current=!0,D.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:H.f4h,orgUid:null==v?void 0:v.uid},e.next=8,(0,se.p0)(t);case 8:n=e.sent,fe.Z.debug("queryRobotsByOrg: ",n),200===n.code?g(null==n||null===(r=n.data)||void 0===r?void 0:r.content):D.yw.error(n.message),s.current=!1,D.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){h()}),[]);var x=function(){var e;null===(e=a.validateFields)||void 0===e||e.call(a,["robotUid"]).catch((function(){return null}))},k=function(e){return function(t){var n,r=!(null==t||null===(n=t.target)||void 0===n||!n.checked);null==o||o(ae()({},e,r)),x()}};return(0,ve.jsx)(ue.A,{form:a,style:{marginLeft:"20px"},submitter:!1,children:"workgroup"===t&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(de.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:k("defaultRobot")}}),(0,ve.jsx)(de.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:k("offlineRobot")}}),(0,ve.jsx)(de.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:k("nonWorktimeRobot")}}),(0,ve.jsx)(ce.Z,{name:["defaultRobot","offlineRobot","nonWorktimeRobot"],children:function(e){var t=e.defaultRobot,n=e.offlineRobot,r=e.nonWorktimeRobot,i=!!(t||n||r);return(0,ve.jsx)(ge.Z,{name:"robotUid",label:"客服机器人",width:"md",options:d.map((function(e){return{value:e.uid,label:p(e.nickname)}})),rules:[{validator:function(e,t){return i&&!t?Promise.reject(new Error("请选择客服机器人")):Promise.resolve()}}],fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){null==o||o({robotUid:null!=e?e:void 0}),x()}}})}})]})})},me=(n(9290),n(8366)),be=n(29352),he=n(63642),xe=function(){var e=he.Z.useForm(),t=b()(e,1)[0],n=(0,i.useIntl)(),o=(0,G.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),a=o.currentWorkgroupSettings,s=o.setCurrentWorkgroupSettings,l=(0,r.useState)(H.vXk),u=b()(l,2),d=u[0],c=u[1];(0,r.useEffect)((function(){if(a){var e=a;c(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[a]);return(0,ve.jsx)("div",{children:(0,ve.jsxs)(ue.A,{form:t,submitter:!1,children:[(0,ve.jsx)(be.Z.Group,{name:"routingMode",label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:H.vXk},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:H.ZD$},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:H.owQ},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:H.e2F},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:H.zWk},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:H.HQF},{label:(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:H.WDq}],fieldProps:{value:d,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),c(e.target.value)}(e),t=e.target.value,a&&s(p()(p()({},a),{},{routingMode:t}))}}}),(0,ve.jsxs)(ue.A.Item,{children:[d===H.vXk&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),d===H.ZD$&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),d===H.owQ&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),d===H.e2F&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),d===H.zWk&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),d===H.HQF&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),d===H.JEC&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),d===H.WDq&&(0,ve.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},ke=n(11575),we=n(74491),Se=n(13437),Me=n(44565),je=function(e){var t=e.robotToAgentSettings,n=e.onRobotToAgentSettingsChange,o=(0,i.useIntl)(),a=ue.A.useForm(),s=b()(a,1)[0],l=(0,r.useRef)(!1),u=(0,r.useMemo)((function(){return null!=t?t:{}}),[t]),d=(0,r.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==u?void 0:u.draft)&&void 0!==t?t:null==u?void 0:u.live)&&void 0!==e?e:void 0}),[null==u?void 0:u.draft,null==u?void 0:u.live]),c=o.formatMessage({id:"robot.to.agent.manual.label.default",defaultMessage:"转人工客服"}),g=(0,r.useCallback)((function(e){return Array.from(new Set((null!=e?e:[]).map((function(e){return(null!=e?e:"").trim()})).filter((function(e){return e.length>0}))))}),[]),f=(0,r.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==n||n(e))}),[n]);(0,r.useEffect)((function(){var e,t,n,r,o,i,a,u,g;l.current=!0,s.setFieldsValue({enabled:null===(e=null==d?void 0:d.enabled)||void 0===e||e,keywordTriggerEnabled:null===(t=null==d?void 0:d.keywordTriggerEnabled)||void 0===t||t,triggerKeywords:null!==(n=null==d?void 0:d.triggerKeywords)&&void 0!==n?n:[],minConfidence:null!==(r=null==d?void 0:d.minConfidence)&&void 0!==r?r:65,maxRobotRepliesBeforeTransfer:null!==(o=null==d?void 0:d.maxRobotRepliesBeforeTransfer)&&void 0!==o?o:3,autoTransferDelaySeconds:null!==(i=null==d?void 0:d.autoTransferDelaySeconds)&&void 0!==i?i:0,cooldownSeconds:null!==(a=null==d?void 0:d.cooldownSeconds)&&void 0!==a?a:90,allowVisitorManualTransfer:null===(u=null==d?void 0:d.allowVisitorManualTransfer)||void 0===u||u,manualTransferLabel:null!==(g=null==d?void 0:d.manualTransferLabel)&&void 0!==g?g:c}),l.current=!1}),[d,s,c]);var v=(0,r.useCallback)((function(e){if(!l.current){var t=p()({},e);if("triggerKeywords"in e){var n=g(e.triggerKeywords);t.triggerKeywords=n,n.length!==(e.triggerKeywords||[]).length&&(l.current=!0,s.setFieldsValue({triggerKeywords:n}),l.current=!1)}if("manualTransferLabel"in e&&"string"==typeof e.manualTransferLabel){var r=e.manualTransferLabel.trim();t.manualTransferLabel=r,r!==e.manualTransferLabel&&(l.current=!0,s.setFieldsValue({manualTransferLabel:r}),l.current=!1)}f(t)}}),[f,s,g]),m=(0,r.useCallback)((function(e){var t=e.keys;return(0,ve.jsx)(we.Z,{type:"generic",keys:t,live:null==u?void 0:u.live,draft:null==u?void 0:u.draft})}),[null==u?void 0:u.draft,null==u?void 0:u.live]);return(0,ve.jsxs)(ue.A,{layout:"vertical",form:s,submitter:!1,style:{marginLeft:"20px",maxWidth:640},onValuesChange:v,children:[(0,ve.jsx)(Se.Z,{width:"md",name:"enabled",label:(0,ve.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.enabled",defaultMessage:"启用机器人转人工策略"}),(0,ve.jsx)(m,{keys:["enabled"]})]})}),(0,ve.jsx)(ce.Z,{name:["enabled"],children:function(e){var t=!1===e.enabled;return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Se.Z,{width:"md",name:"keywordTriggerEnabled",label:(0,ve.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keyword.trigger",defaultMessage:"允许关键词触发"}),(0,ve.jsx)(m,{keys:["keywordTriggerEnabled"]})]}),tooltip:o.formatMessage({id:"robot.to.agent.keyword.trigger.tip",defaultMessage:"访客发送关键词时立即转人工"}),fieldProps:{disabled:t}}),(0,ve.jsx)(ge.Z,{width:"lg",name:"triggerKeywords",label:(0,ve.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keywords",defaultMessage:"转人工关键词"}),(0,ve.jsx)(m,{keys:["triggerKeywords"]})]}),fieldProps:{mode:"tags",tokenSeparators:[",","，"," ",";","；","\n"],disabled:t||!1===s.getFieldValue("keywordTriggerEnabled"),placeholder:o.formatMessage({id:"robot.to.agent.keywords.placeholder",defaultMessage:"输入关键词并回车确认，可粘贴多个"})},extra:o.formatMessage({id:"robot.to.agent.keywords.extra",defaultMessage:"直接输入关键词，然后回车确认，可设置多个关键词"})}),(0,ve.jsx)(Se.Z,{width:"md",name:"allowVisitorManualTransfer",label:(0,ve.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.transfer",defaultMessage:"允许访客手动转人工"}),(0,ve.jsx)(m,{keys:["allowVisitorManualTransfer"]})]}),fieldProps:{disabled:t}}),(0,ve.jsx)(ce.Z,{name:["allowVisitorManualTransfer"],children:function(e){return!1!==e.allowVisitorManualTransfer?(0,ve.jsx)(Me.Z,{width:"lg",name:"manualTransferLabel",label:(0,ve.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.label",defaultMessage:"手动转人工按钮文案"}),(0,ve.jsx)(m,{keys:["manualTransferLabel"]})]}),fieldProps:{maxLength:20,disabled:t},placeholder:o.formatMessage({id:"robot.to.agent.manual.label.placeholder",defaultMessage:"如：转人工客服"})}):null}})]})}})]})},ye=n(87523),Te="tips",Re=function(){var e=(0,i.useIntl)(),t=(0,Q.u)((function(e){return e.currentOrg})),n=(0,X.Z)().leftSiderStyle,a=(0,B.Z)().isDarkMode,l=(0,r.useState)(!1),d=b()(l,2),g=d[0],v=d[1],m=(0,r.useState)([]),H=b()(m,2),ie=H[0],ae=H[1],se=(0,r.useState)(),le=b()(se,2),ue=le[0],de=le[1],ce=(0,r.useState)(""),ge=b()(ce,2),be=ge[0],he=ge[1],we=(0,r.useState)(Te),Se=b()(we,2),Me=Se[0],Re=Se[1],Ze=(0,r.useState)(!1),Ce=b()(Ze,2),Fe=Ce[0],Pe=Ce[1],Le=(0,r.useState)(null),Ae=b()(Le,2),We=Ae[0],qe=Ae[1],Ue=(0,r.useMemo)((function(){return ie.find((function(e){return e.uid===ue}))||null}),[ie,ue]),Ee=(0,r.useState)(!1),Oe=b()(Ee,2),Ie=Oe[0],Je=Oe[1],Ke=(0,r.useState)(!1),ze=b()(Ke,2),Ve=ze[0],De=ze[1],Ne=(0,r.useState)(!1),Qe=b()(Ne,2),Xe=Qe[0],Be=Qe[1],He=(0,r.useRef)(""),Ge=(0,G.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),$e=Ge.setCurrentWorkgroupSettings,Ye=Ge.currentWorkgroupSettings,_e=(0,r.useMemo)((function(){var e;return null!==(e=null!=Ye?Ye:Ue)&&void 0!==e?e:null}),[Ye,Ue]),et=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftServiceSettings||Ye.serviceSettings||{};$e(p()(p()({},Ye),{},{draftServiceSettings:p()(p()({},t),e)}))}}),[Ye,$e]),tt=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftInviteSettings||Ye.inviteSettings||{};$e(p()(p()({},Ye),{},{draftInviteSettings:p()(p()({},t),e)}))}}),[Ye,$e]),nt=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftMessageLeaveSettings||Ye.messageLeaveSettings||{};$e(p()(p()({},Ye),{},{draftMessageLeaveSettings:p()(p()({},t),e)}))}}),[Ye,$e]),rt=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftWorktimeSettings||Ye.worktimeSettings||{};$e(p()(p()({},Ye),{},{draftWorktimeSettings:p()(p()({},t),e)}))}}),[Ye,$e]),ot=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftRobotRoutingSettings||Ye.robotRoutingSettings||{};$e(p()(p()({},Ye),{},{draftRobotRoutingSettings:p()(p()({},t),e)}))}}),[Ye,$e]),it=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftQueueSettings||Ye.queueSettings||{};$e(p()(p()({},Ye),{},{draftQueueSettings:p()(p()({},t),e)}))}}),[Ye,$e]),at=(0,r.useCallback)((function(e){if(Ye){var t=Ye.draftRobotToAgentSettings||Ye.robotToAgentSettings||{};$e(p()(p()({},Ye),{},{draftRobotToAgentSettings:p()(p()({},t),e)}))}}),[Ye,$e]),st=(0,r.useMemo)((function(){if(!be)return ie;var e=be.toLowerCase();return ie.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[ie,be]),lt=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var o,i,a,s,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,i=(null!=n?n:"").trim(),a={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:i||void 0},e.next=8,(0,N.zc)(a);case 8:s=e.sent,fe.Z.debug("加载工作组配置模板列表: ",null==s?void 0:s.data,a),l=(null==s||null===(o=s.data)||void 0===o?void 0:o.content)||[],ae(l),!(l.length>0)||ue&&l.some((function(e){return e.uid===ue}))||(de(l[0].uid),null!=r&&r.keepActive||Re(Te));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,ue]),ut=(0,r.useCallback)((function(e){lt(null!=e?e:be)}),[lt,be]);(0,r.useEffect)((function(){lt(be)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){Ue?($e(Ue),He.current=JSON.stringify(null!=Ue?Ue:{}),Be(!1)):($e(null),He.current=JSON.stringify({}),Be(!1))}),[null==Ue?void 0:Ue.uid]),(0,r.useEffect)((function(){if(Ue)try{var e=JSON.stringify(null!=Ye?Ye:{});Be(e!==He.current)}catch(e){Be(!0)}}),[Ye,null==Ue?void 0:Ue.uid]);var dt=function(){var n=f()(c()().mark((function n(r){var o,i,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=null!=r?r:Ue)&&o.uid){n.next=3;break}return n.abrupt("return");case 3:return i={uid:o.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,N.zN)(i);case 6:(a=n.sent)&&200===a.code?(D.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),lt(be)):D.yw.error((null==a?void 0:a.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ct=function(){var n=f()(c()().mark((function n(r,o){var i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,N.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:o});case 3:(i=n.sent)&&200===i.code?(D.yw.success(e.formatMessage({id:o?"common.enabled":"common.disabled",defaultMessage:o?"已启用":"已停用"})),lt(be)):D.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),D.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),gt=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},ft=function(e){return!e||"object"!==u()(e)||0===Object.keys(e).length},vt=function(e){if(e){var t=gt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputPreviewEnabled","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil","inputAssociationKbUid"]),n=function(e){if(e)return gt(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return p()(p()({},t),n?{toolbar:n}:{})}},pt=function(e){if(e)return gt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},mt=function(e){if(e)return gt(e,["name","description","color","order"])},bt=function(e){if(e)return gt(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},ht=function(e){if(e)return gt(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},xt=function(e){if(e){var t=gt(e,["enabled","keywordTriggerEnabled","triggerKeywords","minConfidence","maxRobotRepliesBeforeTransfer","autoTransferDelaySeconds","cooldownSeconds","allowVisitorManualTransfer","manualTransferLabel"]),n=p()({},t);return Array.isArray(n.triggerKeywords)&&(n.triggerKeywords=Array.from(new Set(n.triggerKeywords.map((function(e){return(e||"").trim()})).filter((function(e){return e.length>0}))))),"string"==typeof n.manualTransferLabel&&(n.manualTransferLabel=n.manualTransferLabel.trim()),n}},kt=function(e){var t,n;if(e){var r=gt(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),o=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return p()(p()({},r),o?{robotUid:o}:{})}},wt=function(e){if(e)return gt(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},St=function(){var n=f()(c()().mark((function n(){var r,o,i,a,s,l,u,d,g,f,v,m,b,h;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ue&&Ue.uid){n.next=3;break}return D.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Je(!0),n.prev=4,r=Ye&&Ye.uid===Ue.uid?Ye:Ue,i=vt((o=function(e,t){return p()(p()({},e||{}),t||{})})(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),a=pt(o(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),s=mt(o(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),l=bt(o(null==r?void 0:r.messageLeaveSettings,null==r?void 0:r.draftMessageLeaveSettings)),u=wt(o(null==r?void 0:r.worktimeSettings,null==r?void 0:r.draftWorktimeSettings)),d=kt(o(null==r?void 0:r.robotRoutingSettings,null==r?void 0:r.draftRobotRoutingSettings)),g=ht(o(null==r?void 0:r.queueSettings,null==r?void 0:r.draftQueueSettings)),f=xt(o(null==r?void 0:r.robotToAgentSettings,null==r?void 0:r.draftRobotToAgentSettings)),v=p()(p()(p()(p()(p()(p()(p()(p()({uid:Ue.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode},ft(i)?{}:{serviceSettings:i}),ft(a)?{}:{inviteSettings:a}),ft(s)?{}:{intentionSettings:s}),ft(l)?{}:{messageLeaveSettings:l}),ft(u)?{}:{worktimeSettings:u}),ft(d)?{}:{robotRoutingSettings:d}),ft(g)?{}:{queueSettings:g}),ft(f)?{}:{robotToAgentSettings:f}),n.next=18,(0,N.Y2)(v);case 18:m=n.sent,console.log("保存工作组配置模板: ",m,v),m&&200===m.code?(D.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),He.current=JSON.stringify(null!==(b=null!==(h=null==m?void 0:m.data)&&void 0!==h?h:r)&&void 0!==b?b:{}),Be(!1),lt(be,{keepActive:!0})):D.yw.error((null==m?void 0:m.message)||"保存失败"),n.next=27;break;case 23:n.prev=23,n.t0=n.catch(4),console.error("保存失败:",n.t0),D.yw.error("保存失败");case 27:return n.prev=27,Je(!1),n.finish(27);case 30:case"end":return n.stop()}}),n,null,[[4,23,27,30]])})));return function(){return n.apply(this,arguments)}}(),Mt=function(){var n=f()(c()().mark((function n(){var r,o,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ue&&Ue.uid){n.next=3;break}return D.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(De(!0),n.prev=4,!Xe){n.next=8;break}return n.next=8,St();case 8:return r={uid:Ue.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,N.Dm)(r);case 11:(o=n.sent)&&200===o.code?(D.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),He.current=JSON.stringify(null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{}),Be(!1),lt(be)):D.yw.error((null==o?void 0:o.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),D.yw.error("发布失败");case 19:return n.prev=19,De(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),jt=(0,r.useMemo)((function(){return null!=Ue&&Ue.uid?[{key:"tips",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(R.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,ve.jsx)(te.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},onServiceSettingsChange:et})},{key:"service",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(Z.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"})]}),children:(0,ve.jsx)(ee.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},onServiceSettingsChange:et})}].concat(s()((0,ye.OJ)()?[{key:"inputAssociation",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(C.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.settings.input.association",defaultMessage:"输入联想"})]}),children:(0,ve.jsx)($.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},onServiceSettingsChange:et})}]:[]),s()((0,ye.OJ)()?[{key:"rate",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(F.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,ve.jsx)(oe.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},onServiceSettingsChange:et})}]:[]),[{key:"robot",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(P.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"robot",defaultMessage:"Robot"})]}),children:(0,ve.jsx)(pe,{variant:"workgroup",robotRoutingSettings:{live:null==_e?void 0:_e.robotRoutingSettings,draft:null==_e?void 0:_e.draftRobotRoutingSettings},onRobotRoutingSettingsChange:ot})}],s()((0,ye.OJ)()?[{key:"robotToAgent",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(L.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"robotToAgent",defaultMessage:"Robot to Agent"})]}),children:(0,ve.jsx)(je,{variant:"workgroup",robotToAgentSettings:{live:null==_e?void 0:_e.robotToAgentSettings,draft:null==_e?void 0:_e.draftRobotToAgentSettings},onRobotToAgentSettingsChange:at})}]:[]),s()((0,ye.OJ)()?[{key:"messageLeave",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(A.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,ve.jsx)(ne.Z,{variant:"workgroup",messageLeaveSettings:{live:null==_e?void 0:_e.messageLeaveSettings,draft:null==_e?void 0:_e.draftMessageLeaveSettings},onMessageLeaveSettingsChange:nt})}]:[]),s()((0,ye.OJ)()?[{key:"queue",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(ke.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"workgroup.settings.queue",defaultMessage:"排队设置"})]}),children:(0,ve.jsx)(me.Z,{variant:"workgroup",queueSettings:{live:null==_e?void 0:_e.queueSettings,draft:null==_e?void 0:_e.draftQueueSettings},onQueueSettingsChange:it})}]:[]),s()([]),s()((0,ye.OJ)()?[{key:"toolbar",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(W.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,ve.jsx)(_.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},settingsUid:Ue.uid,isActive:"toolbar"===Me,onServiceSettingsChange:et})}]:[]),s()((0,ye.OJ)()?[{key:"right",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(q.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,ve.jsx)(Y.Z,{variant:"workgroup",serviceSettings:{live:null==_e?void 0:_e.serviceSettings,draft:null==_e?void 0:_e.draftServiceSettings},onServiceSettingsChange:et,settingsUid:Ue.uid,isActive:"right"===Me})}]:[]),s()([]),[{key:"route",label:(0,ve.jsxs)("span",{children:[(0,ve.jsx)(U.Z,{})," ",(0,ve.jsx)(i.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"})]}),children:(0,ve.jsx)(xe,{})}],s()([])):[]}),[null==Ue?void 0:Ue.uid,_e,e,et,tt,nt,ot,at,rt,it,Me]);return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsxs)(h.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ve.jsx)(h.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,ve.jsxs)(V.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,ve.jsx)(x.ZP,{size:"small",icon:(0,ve.jsx)(E.Z,{}),type:"primary",onClick:function(){qe(null),Pe(!0)},children:(0,ve.jsx)(i.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,ve.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ve.jsxs)(k.Z.Compact,{style:{width:"100%"},children:[(0,ve.jsx)(w.Z,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:be,onChange:function(e){return he(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;he(t),ut(t)},allowClear:!0,size:"middle"}),(0,ve.jsx)(x.ZP,{type:"primary",icon:(0,ve.jsx)(C.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return ut()}})]})}),(0,ve.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ve.jsx)(S.Z,{dataSource:st,locale:{emptyText:(0,ve.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ve.jsx)(S.Z.Item,{style:ue===e.uid?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return de(e.uid)},children:(0,ve.jsx)(S.Z.Item.Meta,{title:(0,ve.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ve.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ve.jsx)(k.Z,{size:4,children:e.isDefault?(0,ve.jsx)(j.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ve.jsx)("div",{style:{color:a?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ve.jsx)(h.Z.Panel,{children:Ue?(0,ve.jsx)(V.Z,{title:(0,ve.jsxs)(k.Z,{children:[(0,ve.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",Ue.name||Ue.uid]}),(0,ve.jsx)(y.Z,{checked:!!Ue.enabled,onChange:function(e){return ct(Ue.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ve.jsx)(x.ZP,{size:"small",icon:(0,ve.jsx)(O.Z,{}),onClick:function(e){var t;e.stopPropagation(),qe(null!=(t=Ue)?t:Ue),Pe(!0)},children:"编辑"}),(0,ve.jsx)(T.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),dt(Ue)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ve.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,ve.jsx)(I.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),Ue.isDefault?(0,ve.jsx)(j.Z,{color:"blue",children:"默认"}):null]}),extra:(0,ve.jsxs)(k.Z,{children:[(0,ve.jsx)(T.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Mt()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ve.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ve,type:"default",icon:(0,ve.jsx)(J.Z,{}),children:(0,ve.jsx)(i.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ve.jsx)(x.ZP,{onClick:function(){Ue&&($e(Ue),He.current=JSON.stringify(null!=Ue?Ue:{}),Be(!1))},disabled:!Xe,icon:(0,ve.jsx)(K.Z,{}),children:(0,ve.jsx)(i.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ve.jsx)(x.ZP,{type:"primary",loading:Ie,onClick:St,disabled:!Xe,icon:(0,ve.jsx)(z.Z,{}),children:(0,ve.jsx)(i.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ve.jsx)(o.Z,{activeKey:Me,onChange:Re,items:jt})}):(0,ve.jsx)(V.Z,{children:(0,ve.jsx)(M.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,ve.jsx)(re.Z,{open:Fe,onOpenChange:Pe,orgUid:(null==t?void 0:t.uid)||"",record:We,onSuccess:function(){Pe(!1),lt(be)}})]})},Ze=n(20753),Ce=function(){return(0,ve.jsx)(o.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,ve.jsx)(i.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,ve.jsx)(Ze.Z,{})},{key:"settings",label:(0,ve.jsx)(i.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,ve.jsx)(Re,{})}]})}}}]);