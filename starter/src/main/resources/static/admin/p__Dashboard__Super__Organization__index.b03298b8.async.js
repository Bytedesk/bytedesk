"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{22014:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(38404),s=a(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},n=a(5901),i=function(e,t){return s.createElement(n.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var d=s.forwardRef(i)},40391:function(e,t,a){a.d(t,{Z:function(){return w}});var r=a(80627),s=a(93683),o=a(44194),n=a(84729),i=a(69983),d=a(31549),l=["proFieldProps","fieldProps"],u="date",g=o.forwardRef((function(e,t){var a=e.proFieldProps,g=e.fieldProps,c=(0,s.Z)(e,l),f=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,valueType:u,fieldProps:(0,r.Z)({getPopupContainer:f.getPopupContainer},g),proFieldProps:a,filedConfig:{valueType:u,customLightMode:!0}},c))})),c=["proFieldProps","fieldProps"],f="dateMonth",p=o.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,c),g=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,valueType:f,fieldProps:(0,r.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:f,customLightMode:!0}},u))})),m=["fieldProps"],v="dateQuarter",h=o.forwardRef((function(e,t){var a=e.fieldProps,l=(0,s.Z)(e,m),u=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,valueType:v,fieldProps:(0,r.Z)({getPopupContainer:u.getPopupContainer},a),filedConfig:{valueType:v,customLightMode:!0}},l))})),M=["proFieldProps","fieldProps"],y="dateWeek",x=o.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,M),g=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,valueType:y,fieldProps:(0,r.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:y,customLightMode:!0}},u))})),b=["proFieldProps","fieldProps"],S="dateYear",Z=o.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,b),g=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,valueType:S,fieldProps:(0,r.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:S,customLightMode:!0}},u))})),j=g;j.Week=x,j.Month=p,j.Quarter=h,j.Year=Z,j.displayName="ProFormComponent";var w=j},30880:function(e,t,a){var r=a(80627),s=a(93683),o=a(44194),n=a(84729),i=a(69983),d=a(31549),l=["fieldProps","proFieldProps"],u="dateTime",g=o.forwardRef((function(e,t){var a=e.fieldProps,g=e.proFieldProps,c=(0,s.Z)(e,l),f=(0,o.useContext)(n.Z);return(0,d.jsx)(i.Z,(0,r.Z)({ref:t,fieldProps:(0,r.Z)({getPopupContainer:f.getPopupContainer},a),valueType:u,proFieldProps:g,filedConfig:{valueType:u,customLightMode:!0}},c))}));t.Z=g},17455:function(e,t,a){var r=a(80627),s=a(93683),o=a(68422),n=a(44194),i=a(84729),d=a(69983),l=a(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],g=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],c=function(e,t){var a=e.fieldProps,g=e.children,c=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,M=e.options,y=(0,s.Z)(e,u),x=(0,n.useContext)(i.Z);return(0,l.jsx)(d.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(m),request:v,params:c,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:M,mode:p,showSearch:h,getPopupContainer:x.getPopupContainer},a),ref:t,proFieldProps:f},y),{},{children:g}))},f=n.forwardRef((function(e,t){var a=e.fieldProps,u=e.children,c=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.options,M=(0,s.Z)(e,g),y=(0,r.Z)({options:h,mode:p||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),x=(0,n.useContext)(i.Z);return(0,l.jsx)(d.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(m),request:v,params:c,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:x.getPopupContainer},y),ref:t,proFieldProps:f},M),{},{children:u}))})),p=n.forwardRef(c);p.SearchSelect=f,p.displayName="ProFormComponent",t.Z=p},74056:function(e,t,a){var r=a(80627),s=a(93683),o=a(44194),n=a(69983),i=a(31549),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],l=o.forwardRef((function(e,t){var a=e.fieldProps,o=e.unCheckedChildren,l=e.checkedChildren,u=e.proFieldProps,g=(0,s.Z)(e,d);return(0,i.jsx)(n.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:o,checkedChildren:l},a),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},g))}));t.Z=l},43420:function(e,t,a){a.d(t,{G:function(){return f}});var r=a(73193),s=a.n(r),o=(a(44194),a(6960)),n=a(27353),i=a(96596),d=a.n(i),l=a(97765),u=a(50884),g=a(61476),c=a(31549),f=function(e){var t=e.children,a=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:n.IrL,categoryUid:"",kbUid:"",channel:n.XtJ},f={name:"file",accept:"image/*",action:(0,g.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(n.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var t=d()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=t,i.fileType=e.type,l.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var t,s=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;a(s),u.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,c.jsx)(o.Z,s()(s()({},f),{},{children:t}))}},90938:function(e,t,a){var r=a(96775);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},14863:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});var r=a(90938),s=a(44828),o=a(44194),n=a(73193),i=a.n(n),d=a(84176),l=a.n(d),u=a(90819),g=a.n(u),c=a(89933),f=a.n(c),p=a(76711),m=a.n(p),v=a(45332),h=a.n(v),M=a(50884),y=a(65468),x=a(6992),b=a(77601),S=a(30235),Z=a(70937),j=a(90883),w=a(28520),C=a(97588),P=a(67186),F=a(83788),I=a(74056),k=a(40391),E=a(17455),T=a(30880),R=a(69159),D=a(19058),z=a(46206),Y=a(41455),U=a(46589),L=a(83801),N=a(13172),B=a(31789),O=a(2290),A=a(43420),H=a(22014),V=a(54148),q=a(96596),_=a.n(q),W=a(31549),G=function(e){var t,a,r,s,n=e.isEdit,d=e.org,l=e.open,u=e.onClose,c=e.onSubmit,p=R.Z.useForm(),v=h()(p,1)[0],y=(0,O.useIntl)(),x=(0,O.useAccess)(),b=!0===(null==x||null===(t=x.isWeiyu)||void 0===t?void 0:t.call(x)),S=(0,w.u)((function(e){return e.currentOrg})),Z=(0,o.useState)(""),q=h()(Z,2),G=q[0],J=q[1],K=(0,o.useState)(""),Q=h()(K,2),$=Q[0],X=Q[1],ee=(0,o.useState)([]),te=h()(ee,2),ae=te[0],re=te[1],se=new Set(["df_fa_uid","df_sys_uid"]),oe=function(e){var t,a,r=null==e||null===(t=e.nickname)||void 0===t?void 0:t.toString().trim(),s=null==e||null===(a=e.username)||void 0===a?void 0:a.toString().trim();return r||s||y.formatMessage({id:"pages.user.displayName.empty",defaultMessage:"未命名用户"})},ne=function(e){var t,a,r=null==e||null===(t=e.mobile)||void 0===t?void 0:t.toString().trim(),s=null==e||null===(a=e.email)||void 0===a?void 0:a.toString().trim();return r||s||y.formatMessage({id:"pages.user.contact.empty",defaultMessage:"未绑定手机号/邮箱"})};(0,o.useEffect)((function(){if(n){var e;v.setFieldsValue(i()(i()({name:null==d?void 0:d.name,logo:null==d?void 0:d.logo,code:null==d?void 0:d.code,description:null==d?void 0:d.description},b?{customServerEnabled:null==d?void 0:d.customServerEnabled,customServerHost:null==d?void 0:d.customServerHost}:{}),{},{verifiedType:null==d?void 0:d.verifiedType,identityType:null==d?void 0:d.identityType,identityImage:null==d?void 0:d.identityImage,identityNumber:null==d?void 0:d.identityNumber,verifyDate:null!=d&&d.verifyDate?_()(d.verifyDate):void 0,verifyStatus:null==d?void 0:d.verifyStatus,rejectReason:null==d?void 0:d.rejectReason,vip:null==d?void 0:d.vip,vipExpireDate:null==d?void 0:d.vipExpireDate,userUid:null==d||null===(e=d.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==d?void 0:d.enabled)}))}else{v.resetFields();var t=_()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");v.setFieldsValue(i()({verifyStatus:"UNVERIFIED",vip:!0,vipExpireDate:t,enabled:!0},b?{customServerEnabled:!1,customServerHost:""}:{}))}}),[l,b]),(0,o.useEffect)((function(){null!=d&&d.logo?J(d.logo):J("")}),[null==d?void 0:d.logo]),(0,o.useEffect)((function(){null!=d&&d.identityImage?X(d.identityImage):X("")}),[null==d?void 0:d.identityImage]),(0,o.useEffect)((function(){var e=function(){var e=f()(g()().mark((function e(){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||null==S||!S.uid){e.next=4;break}return e.next=3,le();case 3:n&&null!=d&&d.user&&(t={label:"".concat(oe(d.user)," (").concat(ne(d.user),") - ").concat(y.formatMessage({id:"pages.org.admin.current",defaultMessage:"当前管理员"})),value:d.user.uid},re((function(e){return e.some((function(e){return e.value===t.value}))?e:[t].concat(m()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[l,null==S?void 0:S.uid,n,null==d?void 0:d.user]);var ie,de,le=function(){var e=f()(g()().mark((function e(t){var a,r,s,o,n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:20,searchText:t||"",orgUid:null==S?void 0:S.uid},console.log("Loading users with params:",r),e.next=5,(0,V.pz)(r);case 5:if(s=e.sent,console.log("loadUsers response:",s),200!==s.code||null==s||null===(a=s.data)||void 0===a||!a.content){e.next=12;break}return o=null==s?void 0:s.data.content.filter((function(e){if(null!=e&&e.uid&&se.has(e.uid))return!1;var t=e.currentOrganization&&e.currentOrganization.uid;return t&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!t})),n=o.map((function(e){return{label:"".concat(oe(e)," (").concat(ne(e),")"),value:e.uid}})),re(n),e.abrupt("return",n);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 17:return e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),ue=[{label:y.formatMessage({id:"pages.org.verifiedType.personal",defaultMessage:"个人认证"}),value:"PERSONAL"},{label:y.formatMessage({id:"pages.org.verifiedType.company",defaultMessage:"企业认证"}),value:"COMPANY"},{label:y.formatMessage({id:"pages.org.verifiedType.government",defaultMessage:"政府认证"}),value:"GOVERNMENT"},{label:y.formatMessage({id:"pages.org.verifiedType.institution",defaultMessage:"机构认证"}),value:"INSTITUTION"},{label:y.formatMessage({id:"pages.org.verifiedType.industry",defaultMessage:"行业认证"}),value:"INDUSTRY"},{label:y.formatMessage({id:"pages.org.verifiedType.nonProfit",defaultMessage:"非营利组织认证"}),value:"NON_PROFIT"},{label:y.formatMessage({id:"pages.org.verifiedType.others",defaultMessage:"其他认证"}),value:"OTHERS"}],ge=[{label:y.formatMessage({id:"pages.org.identityType.businessLicense",defaultMessage:"营业执照"}),value:"COMPANY_LICENSE"},{label:y.formatMessage({id:"pages.org.identityType.idCard",defaultMessage:"身份证"}),value:"ID_CARD"},{label:y.formatMessage({id:"pages.org.identityType.passport",defaultMessage:"护照"}),value:"PASSPORT"},{label:y.formatMessage({id:"pages.org.identityType.driverLicense",defaultMessage:"驾驶证"}),value:"DRIVER_LICENSE"},{label:y.formatMessage({id:"pages.org.identityType.others",defaultMessage:"其他"}),value:"OTHER"}],ce=[{label:y.formatMessage({id:"pages.org.verifyStatus.unverified",defaultMessage:"未认证"}),value:"UNVERIFIED"},{label:y.formatMessage({id:"pages.org.verifyStatus.verified",defaultMessage:"已认证"}),value:"VERIFIED"},{label:y.formatMessage({id:"pages.org.verifyStatus.verifying",defaultMessage:"认证中"}),value:"VERIFYING"}];return(0,W.jsx)(D.Z,{title:n?(0,W.jsx)(O.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,W.jsx)(O.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:u,open:l,width:600,extra:(0,W.jsxs)(z.Z,{children:[(0,W.jsx)(j.ZP,{onClick:u,children:(0,W.jsx)(O.FormattedMessage,{id:"pages.common.cancel"})}),(0,W.jsx)(j.ZP,{onClick:function(){v.validateFields().then((function(e){c(i()(i()(i()({},d),e),{},{logo:G,orgUid:null==S?void 0:S.uid}))})).catch((function(e){console.log("Form errors:",e),M.yw.error(y.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,W.jsx)(O.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,W.jsxs)(C.A,{form:v,submitter:!1,children:[(0,W.jsx)(P.Z,{name:"name",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:y.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,W.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,W.jsx)("div",{style:{marginBottom:"8px"},children:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,W.jsxs)(Y.Z,{gutter:[16,16],align:"middle",children:[(0,W.jsx)(U.Z,{children:(0,W.jsx)(L.Z,{src:G,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,W.jsx)(U.Z,{children:(0,W.jsx)(A.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),J(e),v.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,W.jsx)(j.ZP,{type:"primary",icon:(0,W.jsx)(H.Z,{}),size:"small",children:y.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,W.jsx)(P.Z,{name:"code",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:y.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,W.jsx)(F.Z,{name:"description",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:y.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),b&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(I.Z,{name:"customServerEnabled",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.customServerEnabled",defaultMessage:"启用自定义服务器"}),checkedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.switch.on",defaultMessage:"开启"}),unCheckedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.switch.off",defaultMessage:"关闭"})}),(0,W.jsx)(P.Z,{name:"customServerHost",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.customServerHost",defaultMessage:"自定义服务器域名/IP"}),placeholder:y.formatMessage({id:"pages.org.customServerHost.placeholder",defaultMessage:"例如：im.example.com 或 10.0.0.8"}),rules:[function(e){var t,a=e.getFieldValue;return{validator:(t=f()(g()().mark((function e(t,r){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Boolean(a("customServerEnabled"))){e.next=3;break}return e.abrupt("return");case 3:if("string"==typeof r&&0!==r.trim().length){e.next=5;break}throw new Error(y.formatMessage({id:"pages.org.customServerHost.required",defaultMessage:"启用自定义服务器后请填写域名/IP"}));case 5:case"end":return e.stop()}}),e)}))),function(e,a){return t.apply(this,arguments)})}}]})]}),(0,W.jsx)(I.Z,{name:"vip",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,W.jsx)(k.Z,{name:"vipExpireDate",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:y.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var t=new Date(e);return t.setHours(0,0,0,0),t.toISOString()}return e}}),(0,W.jsx)(E.Z,{name:"userUid",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:y.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==d||null===(a=d.user)||void 0===a?void 0:a.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(de=f()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",t),e.next=3,le(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return de.apply(this,arguments)}),onFocus:(ie=f()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,le();case 3:case"end":return e.stop()}}),e)}))),function(){return ie.apply(this,arguments)}),options:ae}}),(0,W.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,W.jsx)(I.Z,{name:"enabled",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==d||null===(r=d.user)||void 0===r?void 0:r.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==d?void 0:d.enabled),title:!0===(null==d||null===(s=d.user)||void 0===s?void 0:s.superUser)?y.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,W.jsx)(N.Z,{defaultActiveKey:[],items:[{key:"1",label:y.formatMessage({id:"pages.org.verificationInfo",defaultMessage:"认证信息"}),children:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(E.Z,{name:"verifiedType",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:ue,placeholder:y.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,W.jsx)(E.Z,{name:"identityType",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:ge,placeholder:y.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,W.jsx)(P.Z,{name:"identityImage",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:y.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"}),fieldProps:{onChange:function(e){var t;X((null==e||null===(t=e.target)||void 0===t?void 0:t.value)||"")}},addonAfter:(0,W.jsx)(A.G,{onSuccess:function(e){console.log("handleIdentityImageUploadSuccess:",e),X(e),v.setFieldValue("identityImage",e)},onError:function(e){console.log("handleIdentityImageUploadError:",e)},children:(0,W.jsx)(j.ZP,{icon:(0,W.jsx)(H.Z,{}),size:"small",children:y.formatMessage({id:"pages.common.upload",defaultMessage:"上传"})})})}),(0,W.jsx)("div",{style:{marginTop:"-8px",marginBottom:"16px"},children:$?(0,W.jsx)(B.Z,{src:$,width:180,style:{border:"1px solid #f0f0f0",borderRadius:6}}):(0,W.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.identityImage.tip",defaultMessage:"可粘贴图片URL或点击上传"})})}),(0,W.jsx)(P.Z,{name:"identityNumber",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:y.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,W.jsx)(T.Z,{name:"verifyDate",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:y.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请选择认证时间"}),fieldProps:{format:"YYYY-MM-DD HH:mm:ss",showNow:!0},transform:function(e){return e?e.toDate().toISOString():e}}),(0,W.jsx)(E.Z,{name:"verifyStatus",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:ce,placeholder:y.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,W.jsx)(F.Z,{name:"rejectReason",label:(0,W.jsx)(O.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:y.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},J=a(7603),K=a(58709),Q=a(21002),$=a(27353),X=a(79865),ee=a(1670),te=a(97765),ae=a(61476),re=["current","pageSize"],se=function(){var e,t=(0,O.useIntl)(),a=(0,O.useAccess)(),r=!0===(null==a||null===(e=a.isWeiyu)||void 0===e?void 0:e.call(a)),s=(0,o.useRef)(),n=(0,Q.Z)().translateString,d=(0,o.useState)(!0),u=h()(d,2),c=u[0],p=u[1],v=(0,o.useState)(),C=h()(v,2),P=C[0],F=C[1],I=(0,o.useState)(!1),k=h()(I,2),E=k[0],T=k[1],R=(0,o.useState)(1),D=h()(R,2),z=(D[0],D[1]),Y=(0,o.useState)(10),U=h()(Y,2),L=U[0],N=U[1],B=(0,w.u)((function(e){return e.currentOrg})),A=(0,K.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),H=A.setRoleResult,V=A.setRoleResultPlatform,q=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:t.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:t.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,t){return t.logo?(0,W.jsx)("img",{src:t.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:t.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:t.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0}].concat(m()(r?[{title:t.formatMessage({id:"pages.org.customServerEnabled",defaultMessage:"自定义服务器"}),dataIndex:"customServerEnabled",hideInSearch:!0,render:function(e,a){return a.customServerEnabled?t.formatMessage({id:"pages.switch.on",defaultMessage:"开启"}):t.formatMessage({id:"pages.switch.off",defaultMessage:"关闭"})},valueEnum:{true:{text:t.formatMessage({id:"pages.switch.on",defaultMessage:"开启"}),status:"Success"},false:{text:t.formatMessage({id:"pages.switch.off",defaultMessage:"关闭"}),status:"Default"}}},{title:t.formatMessage({id:"pages.org.customServerHost",defaultMessage:"服务器域名/IP"}),dataIndex:"customServerHost",hideInSearch:!0,ellipsis:!0}]:[]),[{title:t.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,t){return(0,ee._i)(t.verifiedType)}},{title:t.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,t){return(0,ee.Cy)(t.verifyStatus)}},{title:t.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,t){return t.verifyDate?_()(t.verifyDate).format("YYYY-MM-DD"):""}},{title:t.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(e,a){return a.vip?t.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):t.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:t.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:t.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:t.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,t){return t.vipExpireDate?_()(t.vipExpireDate).format("YYYY-MM-DD"):""}},{title:t.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(e,a){return!1===a.enabled?t.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):t.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:t.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:t.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:t.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,t){return t.user?(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{children:t.user.nickname||t.user.username}),(0,W.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:t.user.email})]}):"-"}},{title:t.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.createdAt?_()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:t.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.updatedAt?_()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}]),se=[].concat(m()(q),[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,a,r,s){var n,i=!0===(null===(n=a.user)||void 0===n?void 0:n.superUser);return[(0,W.jsx)("a",{onClick:function(){ie(a)},children:t.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,W.jsxs)(o.Fragment,{children:[(0,W.jsx)(S.Z,{type:"vertical"},"divider"),(0,W.jsx)(Z.Z,{title:t.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:a.name||a.code}),onConfirm:function(){return de(a)},okText:t.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:t.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,W.jsx)("a",{children:t.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),oe=(0,J.v)((function(e){return e.currentCategory})),ne=function(){F(void 0),p(!1),T(!0)},ie=function(e){F(e),p(!0),T(!0)},de=function(){var e=f()(g()().mark((function e(a){var r,o,i;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==(null===(r=a.user)||void 0===r?void 0:r.superUser)){e.next=3;break}return M.yw.error(t.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),e.abrupt("return");case 3:return M.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading"})),e.prev=4,e.next=7,(0,X.FR)({uid:a.uid});case 7:o=e.sent,M.yw.destroy(),200===o.code?(M.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=s.current)||void 0===i||i.reloadAndRest()):M.yw.error(n(o.message)||t.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),M.yw.destroy(),M.yw.error(t.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),le=function(){var e=f()(g()().mark((function e(a){var r,o,n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(te.Z.debug("handleSubmitDrawer",a),!c||!0!==(null==P||null===(r=P.user)||void 0===r?void 0:r.superUser)||!1!==a.enabled){e.next=4;break}return M.yw.error(t.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),e.abrupt("return");case 4:if(c?M.yw.loading(t.formatMessage({id:"updating"})):M.yw.loading(t.formatMessage({id:"creating"})),!c){e.next=11;break}return e.next=8,(0,X.jM)(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,X.c5)(a);case 13:e.t0=e.sent;case 14:o=e.t0,te.Z.debug("createOrg response:",a,o),200===o.code?(M.yw.destroy(),M.yw.success(c?t.formatMessage({id:"update.success",defaultMessage:"Update successful"}):t.formatMessage({id:"create.success",defaultMessage:"Create successful"})),T(!1),null===(n=s.current)||void 0===n||n.reloadAndRest()):(M.yw.destroy(),M.yw.error(o.message));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=f()(g()().mark((function e(){var a,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading..."})),a={pageNumber:0,pageSize:100,orgUid:null==B?void 0:B.uid},e.next=4,(0,y.E9)(a);case 4:r=e.sent,te.Z.debug("queryRolesByOrg response ",r),200===r.code?(M.yw.destroy(),H(r)):(M.yw.destroy(),M.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=f()(g()().mark((function e(){var a,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading..."})),a={pageNumber:0,pageSize:100,level:$.Hxq},e.next=4,(0,y.E9)(a);case 4:r=e.sent,te.Z.debug("queryRolesBySuper response ",r),200===r.code?(M.yw.destroy(),V(r)):(M.yw.destroy(),M.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){ue(),ge()}),[]),(0,o.useEffect)((function(){var e;te.Z.debug("currentCategory:",oe),null===(e=s.current)||void 0===e||e.reloadAndRest()}),[oe]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(b.Z,{columns:se,actionRef:s,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=f()(g()().mark((function e(a,r,s){var o,d,u,c,f,p,m,v;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te.Z.debug("request:",a,r,s),M.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading"})),o=a.current,d=a.pageSize,u=l()(a,re),z(o),N(d),c=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],c=p,f="ascend"===r[p]?"ascend":"descend"),m=i()({pageNumber:o-1,pageSize:d,superUser:!0,sortBy:c,sortDirection:f},u),e.next=11,(0,X.$S)(m);case 11:return v=e.sent,te.Z.debug("getAllOrgs response:",m,v),M.yw.destroy(),200===v.code||M.yw.error(n(v.message)),e.abrupt("return",{data:null==v?void 0:v.data.content,success:!0,total:null==v?void 0:v.data.totalElements});case 16:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:L,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){te.Z.debug("pagination onChange:",e,t),z(e),N(t)}},dateFormatter:"string",headerTitle:t.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,W.jsx)(j.ZP,{icon:(0,W.jsx)(x.Z,{}),type:"primary",onClick:ne,disabled:!(0,ae.OJ)(),children:t.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),E&&(0,W.jsx)(G,{isEdit:c,open:E,org:P,onClose:function(){T(!1)},onSubmit:le})]})},oe=s.Z.Content,ne=function(){var e=(0,r.Z)().contentStyle;return(0,W.jsx)(s.Z,{children:(0,W.jsx)(s.Z,{children:(0,W.jsx)(oe,{style:e,children:(0,W.jsx)(se,{})})})})}},7603:function(e,t,a){a.d(t,{v:function(){return p}});var r=a(86222),s=a.n(r),o=a(73193),n=a.n(o),i=a(76711),d=a.n(i),l=a(27353),u=a(26557),g=a(26407),c=a(20744),f=a(97765);var p=(0,u.Ue)()((0,g.mW)((0,g.tJ)((0,c.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:l.zBg,name:l.zBg},setCategoryResult:function(t){var a=function(e){var t,a=[];return function e(t,r){t&&0!==t.length&&t.forEach((function(t){if(t&&t.uid&&t.uid!==l.zBg){var s=r?"".concat(r," / ").concat(t.name):t.name||"";a.push({label:s,value:t.uid}),t.children&&t.children.length>0&&e(t.children,s)}}))}((null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[]),a}(t),r=function(e){var t,a=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],r=function e(t){var a={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(a.children=t.children.map((function(t){return e(t)}))),a};return a.filter((function(e){return e&&e.uid&&e.uid!==l.zBg})).map((function(e){return r(e)}))}(t),s=[{title:l.zBg,key:l.zBg}].concat(d()(r)),o={uid:l.zBg,name:l.zBg},i=n()(n()({},t),{},{data:n()(n()({},t.data),{},{content:[o].concat(d()(t.data.content))})});e({categoryResult:i,categoryTreeOptions:s,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:l.zBg,name:l.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){f.Z.log("resetDefaultCategory"),e({currentCategory:{uid:l.zBg,name:l.zBg}})},setCurrentCategoryUid:function(a){if(a!==l.zBg){var r=function e(t,a){if(t&&0!==t.length){var r,o=s()(t);try{for(o.s();!(r=o.n()).done;){var n=r.value;if((null==n?void 0:n.uid)===a)return n;var i=e(null==n?void 0:n.children,a);if(i)return i}}catch(e){o.e(e)}finally{o.f()}}}(t().categoryResult.data.content,a);e({currentCategory:null!=r?r:{uid:l.zBg,name:l.zBg}})}else e({currentCategory:{uid:l.zBg,name:l.zBg}})},deleteCategoryCache:function(){return e({},!0)}}})),{name:l.OMm})))}}]);