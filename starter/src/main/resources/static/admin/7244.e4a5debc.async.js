"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7244],{43867:function(e,t,a){a.d(t,{$Z:function(){return g},HE:function(){return m},W5:function(){return d}});var n=a(90819),r=a.n(n),s=a(73193),o=a.n(s),i=a(89933),c=a.n(i),l=a(55735),u=a(41159);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/message/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=c()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/message/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=c()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/message/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},97244:function(e,t,a){var n=a(84176),r=a.n(n),s=a(73193),o=a.n(s),i=a(86222),c=a.n(i),l=a(90819),u=a.n(l),d=a(89933),f=a.n(d),g=a(45332),p=a.n(g),m=a(86803),h=a(43867),x=a(76750),M=a(40612),y=a(55735),v=a(36310),w=a(88721),k=a(54881),b=a(11090),S=a(2484),j=a(48524),Z=a(41159),T=a(61355),I=a(53530),F=a(96485),C=a(75365),A=a(44194),E=a(31549),O=["current","pageSize"];t.Z=function(e){var t=e.type,a=(0,Z.useIntl)(),n=(0,A.useRef)(),s=(0,x.Z)().translateString,i=(0,M.u)((function(e){return e.currentOrg})),l=(0,A.useState)(1),d=p()(l,2),g=d[0],D=d[1],P=(0,A.useState)(10),R=p()(P,2),q=R[0],W=R[1],z=(0,A.useState)([]),L=p()(z,2),N=L[0],U=L[1],V=(0,A.useState)([]),B=p()(V,2),$=B[0],G=B[1],H=(0,A.useState)(0),K=p()(H,2),_=K[0],J=K[1],Q=(0,A.useState)({}),X=p()(Q,2),Y=X[0],ee=X[1],te=function(){var e=f()(u()().mark((function e(t){var r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=2,e.next=5,(0,h.$Z)({uid:t.uid});case 5:r=e.sent,m.yw.destroy(),200===r.code?(m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==n||null===(s=n.current)||void 0===s||s.reload()):m.yw.error(r.message||a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,E.jsx)(Z.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,E.jsx)(Z.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,ellipsis:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:s(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,E.jsx)(Z.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,E.jsx)(Z.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,w.ng)(null==t?void 0:t.status)}},{title:(0,E.jsx)(Z.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,w.OI)(t.type)}},{title:(0,E.jsx)(Z.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.client.tooltip"}),render:function(e,t){return(0,w.qF)(t.client)}},{title:(0,E.jsx)(Z.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,E.jsx)(Z.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,n,r){return[(0,E.jsx)("a",{onClick:function(){!function(e){var t,a;console.log("handleShowChatHistory",e);var n={chatConfig:{org:null==i?void 0:i.uid,t:y.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(n)}(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,E.jsx)(T.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return te(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],ne=function(){var e=f()(u()().mark((function e(){var t,r,s,o,i,l;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==$.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,s=0,o=c()($),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return l=i.value,e.prev=11,e.next=14,(0,h.$Z)({uid:l.uid});case 14:200===e.sent.code?r++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:s})),U([]),G([]),null===(t=n.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=f()(u()().mark((function e(a,n,r){var s,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,n,r),s=localStorage.getItem(y.LA8),c=o()({componentType:t,orgUid:(null==i?void 0:i.uid)||"",accessToken:s||"",exportType:a},Y),"current"===a?(c.pageNumber=String(g-1),c.pageSize=String(q)):"all"===a?(c.pageNumber="0",c.pageSize="1000"):"range"===a&&void 0!==n&&void 0!==r&&(c.pageNumber=String(n),c.pageSize=String(r)),window.open((0,v.kG)()+"/api/v1/message/export?"+new URLSearchParams(c).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),se=function(e){for(var t=[],a=1e3,n=Math.ceil(e/a),r=function(){var n=s,r=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return re("range",n,a)}})},s=0;s<n;s++)r();return t},oe={selectedRowKeys:N,onChange:function(e,t){U(e),G(t)}};return(0,E.jsx)(j.Z,{columns:ae,actionRef:n,cardBordered:!0,rowSelection:oe,scroll:{x:1500},request:function(){var e=f()(u()().mark((function e(a,n,s){var c,l,d,f,g,p,x,M;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,n,s),c=a.current,l=a.pageSize,d=r()(a,O),D(c),W(l),ee(d),f=void 0,g=void 0,n&&Object.keys(n).length>0&&(p=Object.keys(n)[0],f=p,g="ascend"===n[p]?"ascend":"descend"),x=o()(o()({pageNumber:c-1,pageSize:l,componentType:t,orgUid:null==i?void 0:i.uid},d),{},{sortBy:f,sortDirection:g}),e.next=11,(0,h.W5)(x);case 11:return M=e.sent,console.log("getAllMessages response:",x,M),200===M.code?J(M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){D(e),W(t)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];N.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(k.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(N.length,")"),onClick:function(){I.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(N.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ne,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var n=[{key:"export-current",icon:(0,E.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return re("current")}}];return _>0&&(_<=1e3?n.push({key:"export-all",icon:(0,E.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_,"条)"),onClick:function(){return re("all")}}):n.push({key:"export-range",icon:(0,E.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_,"条)"),children:se(_)})),e.push((0,E.jsx)(F.Z,{menu:{items:n},placement:"bottom",children:(0,E.jsxs)(C.ZP,{type:"primary",icon:(0,E.jsx)(b.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(S.Z,{})]})},"export")),t.length>0&&e.push((0,E.jsx)(F.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(C.ZP,{type:N.length>0?"primary":"default",danger:N.length>0,children:[N.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(N.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(S.Z,{})]})},"batchOperations")),e}()}})}},76750:function(e,t,a){var n=a(55735),r=a(65461),s=a(41159);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,r.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,r.aS)(t,10)}}}}}]);