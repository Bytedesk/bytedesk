"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{91825:function(e,t,r){var n=r(94433),o=r(38956),s=r(57343),i=r(4342),a=r(44194),l=r(55870),u=r(9953),d=r(31549),g=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],c=a.forwardRef((function(e,t){var r=e.fieldProps,i=e.options,a=e.radioType,l=e.layout,c=e.proFieldProps,f=e.valueEnum,v=(0,o.Z)(e,g);return(0,d.jsx)(u.Z,(0,n.Z)((0,n.Z)({valueType:"button"===a?"radioButton":"radio",ref:t,valueEnum:(0,s.h)(f,void 0)},v),{},{fieldProps:(0,n.Z)({options:i,layout:l},r),proFieldProps:c,filedConfig:{customLightMode:!0}}))})),f=a.forwardRef((function(e,t){var r=e.fieldProps,o=e.children;return(0,d.jsx)(i.ZP,(0,n.Z)((0,n.Z)({},r),{},{ref:t,children:o}))})),v=(0,l.G)(f,{valuePropName:"checked",ignoreWidth:!0});v.Group=c,v.Button=i.ZP.Button,v.displayName="ProFormComponent",t.Z=v},8099:function(e,t,r){r.r(t),r.d(t,{default:function(){return Xe}});var n=r(76711),o=r.n(n),s=r(45332),i=r.n(s),a=r(44194),l=r(21600),u=r(4628),d=r(89957),g=r.n(d),c=r(90819),f=r.n(c),v=r(89933),p=r.n(v),m=r(73193),h=r.n(m),b=r(81581),x=r(69533),M=r(30310),k=r(1282),w=r(83281),S=r(96955),y=r(90581),j=r(12461),T=r(43275),R=r(27729),Z=r(82878),C=r(29337),A=r(68779),F=r(90727),L=r(12322),E=r(58087),P=r(83910),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656zM304.8 524h50.7c3.7 0 6.8-3 6.8-6.8v-78.9c0-19.7 15.9-35.6 35.5-35.6h205.7v53.4c0 5.7 6.5 8.8 10.9 5.3l109.1-85.7c3.5-2.7 3.5-8 0-10.7l-109.1-85.7c-4.4-3.5-10.9-.3-10.9 5.3V338H397.7c-55.1 0-99.7 44.8-99.7 100.1V517c0 4 3 7 6.8 7zm-4.2 134.9l109.1 85.7c4.4 3.5 10.9.3 10.9-5.3v-53.4h205.7c55.1 0 99.7-44.8 99.7-100.1v-78.9c0-3.7-3-6.8-6.8-6.8h-50.7c-3.7 0-6.8 3-6.8 6.8v78.9c0 19.7-15.9 35.6-35.5 35.6H420.6V568c0-5.7-6.5-8.8-10.9-5.3l-109.1 85.7c-3.5 2.5-3.5 7.8 0 10.5z"}}]},name:"interaction",theme:"outlined"},O=r(54183),N=function(e,t){return a.createElement(O.Z,(0,P.Z)({},e,{ref:t,icon:I}))};var W=a.forwardRef(N),U=r(31806),D=r(34600),q=r(56482),V=r(94322),z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},K=function(e,t){return a.createElement(O.Z,(0,P.Z)({},e,{ref:t,icon:z}))};var B=a.forwardRef(K),H=r(10162),_=r(59304),G=r(54881),J=r(47944),Q=r(4317),Y=r(80556),X=r(55785),$=r(97135),ee=r(43388),te=r(11810),re=r(74171),ne=r(21850),oe=r(25553),se=r(94976),ie=r(39325),ae=r(95093),le=r(1596),ue=(r(94147),r(77500)),de=r(12608),ge=r(27501),ce=r(83610),fe=r(84895),ve=r(25780),pe=r(42e3),me=r(10154),he=r.n(me),be=r(56862),xe=r(88722),Me=r(99036),ke=r(98907),we=r(96695),Se=r(59005),ye=r(67242),je=r(31549),Te=function(e){var t=e.variant,r=e.robotRoutingSettings,n=e.onRobotRoutingSettingsChange,o=Me.A.useForm(),s=i()(o,1)[0],l=(0,a.useRef)(!1),u=(0,a.useState)([]),d=i()(u,2),g=d[0],c=d[1],v=(0,re.u)((function(e){return e.currentOrg})),m=(0,xe.Z)().translateString,h=(0,a.useMemo)((function(){var e;return null!==(e=null==r?void 0:r.draft)&&void 0!==e?e:null==r?void 0:r.live}),[r]);(0,a.useEffect)((function(){var e,r;if("workgroup"===t){var n=null!==(e=null==h?void 0:h.robotUid)&&void 0!==e?e:null==h||null===(r=h.robot)||void 0===r?void 0:r.uid;s.setFieldsValue({defaultRobot:null==h?void 0:h.defaultRobot,offlineRobot:null==h?void 0:h.offlineRobot,nonWorktimeRobot:null==h?void 0:h.nonWorktimeRobot,robotUid:n})}}),[t,h,s]);var b=function(){var e=p()(f()().mark((function e(){var t,r,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.current){e.next=3;break}return ye.Z.debug("isLoading: 1",l.current),e.abrupt("return");case 3:return l.current=!0,ee.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:se.f4h,orgUid:null==v?void 0:v.uid},e.next=8,(0,be.p0)(t);case 8:r=e.sent,ye.Z.debug("queryRobotsByOrg: ",r),200===r.code?c(null==r||null===(n=r.data)||void 0===n?void 0:n.content):ee.yw.error(r.message),l.current=!1,ee.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){b()}),[]);var x=function(){var e;null===(e=s.validateFields)||void 0===e||e.call(s,["robotUid"]).catch((function(){return null}))},M=function(e){return function(t){var r,o=!(null==t||null===(r=t.target)||void 0===r||!r.checked);null==n||n(he()({},e,o)),x()}};return(0,je.jsx)(Me.A,{form:s,style:{marginLeft:"20px"},submitter:!1,children:"workgroup"===t&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(ke.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:M("defaultRobot")}}),(0,je.jsx)(ke.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:M("offlineRobot")}}),(0,je.jsx)(ke.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:M("nonWorktimeRobot")}}),(0,je.jsx)(we.Z,{name:["defaultRobot","offlineRobot","nonWorktimeRobot"],children:function(e){var t=e.defaultRobot,r=e.offlineRobot,o=e.nonWorktimeRobot,s=!!(t||r||o);return(0,je.jsx)(Se.Z,{name:"robotUid",label:"客服机器人",width:"md",options:g.map((function(e){return{value:e.uid,label:m(e.nickname)}})),rules:[{validator:function(e,t){return s&&!t?Promise.reject(new Error("请选择客服机器人")):Promise.resolve()}}],fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){null==n||n({robotUid:null!=e?e:void 0}),x()}}})}})]})})},Re=(r(92822),r(64587)),Ze=r(91825),Ce=r(69705),Ae=function(){var e=Ce.Z.useForm(),t=i()(e,1)[0],r=(0,u.useIntl)(),n=(0,ie.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),o=n.currentWorkgroupSettings,s=n.setCurrentWorkgroupSettings,l=(0,a.useState)(se.vXk),d=i()(l,2),g=d[0],c=d[1];(0,a.useEffect)((function(){if(o){var e=o;c(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[o]);return(0,je.jsx)("div",{children:(0,je.jsxs)(Me.A,{form:t,submitter:!1,children:[(0,je.jsx)(Ze.Z.Group,{name:"routingMode",label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:se.vXk},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:se.ZD$},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:se.owQ},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:se.e2F},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:se.zWk},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:se.HQF},{label:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:se.WDq}],fieldProps:{value:g,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),c(e.target.value)}(e),t=e.target.value,o&&s(h()(h()({},o),{},{routingMode:t}))}}}),(0,je.jsxs)(Me.A.Item,{children:[g===se.vXk&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.roundRobin.desc"})}),g===se.ZD$&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.leastActive.desc"})}),g===se.owQ&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.random.desc"})}),g===se.e2F&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),g===se.zWk&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.consistentHash.desc"})}),g===se.HQF&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),g===se.JEC&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.broadcast.desc"})}),g===se.WDq&&(0,je.jsx)("p",{children:r.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},Fe=r(58791),Le=r(66441),Ee=r(50628),Pe=r(86702),Ie=function(e){var t=e.robotToAgentSettings,r=e.onRobotToAgentSettingsChange,n=(0,u.useIntl)(),o=Me.A.useForm(),s=i()(o,1)[0],l=(0,a.useRef)(!1),d=(0,a.useMemo)((function(){return null!=t?t:{}}),[t]),g=(0,a.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==d?void 0:d.draft)&&void 0!==t?t:null==d?void 0:d.live)&&void 0!==e?e:void 0}),[null==d?void 0:d.draft,null==d?void 0:d.live]),c=n.formatMessage({id:"robot.to.agent.manual.label.default",defaultMessage:"转人工客服"}),f=(0,a.useCallback)((function(e){return Array.from(new Set((null!=e?e:[]).map((function(e){return(null!=e?e:"").trim()})).filter((function(e){return e.length>0}))))}),[]),v=(0,a.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==r||r(e))}),[r]);(0,a.useEffect)((function(){var e,t,r,n,o,i,a,u,d;l.current=!0,s.setFieldsValue({enabled:null===(e=null==g?void 0:g.enabled)||void 0===e||e,keywordTriggerEnabled:null===(t=null==g?void 0:g.keywordTriggerEnabled)||void 0===t||t,triggerKeywords:null!==(r=null==g?void 0:g.triggerKeywords)&&void 0!==r?r:[],minConfidence:null!==(n=null==g?void 0:g.minConfidence)&&void 0!==n?n:65,maxRobotRepliesBeforeTransfer:null!==(o=null==g?void 0:g.maxRobotRepliesBeforeTransfer)&&void 0!==o?o:3,autoTransferDelaySeconds:null!==(i=null==g?void 0:g.autoTransferDelaySeconds)&&void 0!==i?i:0,cooldownSeconds:null!==(a=null==g?void 0:g.cooldownSeconds)&&void 0!==a?a:90,allowVisitorManualTransfer:null===(u=null==g?void 0:g.allowVisitorManualTransfer)||void 0===u||u,manualTransferLabel:null!==(d=null==g?void 0:g.manualTransferLabel)&&void 0!==d?d:c}),l.current=!1}),[g,s,c]);var p=(0,a.useCallback)((function(e){if(!l.current){var t=h()({},e);if("triggerKeywords"in e){var r=f(e.triggerKeywords);t.triggerKeywords=r,r.length!==(e.triggerKeywords||[]).length&&(l.current=!0,s.setFieldsValue({triggerKeywords:r}),l.current=!1)}if("manualTransferLabel"in e&&"string"==typeof e.manualTransferLabel){var n=e.manualTransferLabel.trim();t.manualTransferLabel=n,n!==e.manualTransferLabel&&(l.current=!0,s.setFieldsValue({manualTransferLabel:n}),l.current=!1)}v(t)}}),[v,s,f]),m=(0,a.useCallback)((function(e){var t=e.keys;return(0,je.jsx)(Le.Z,{type:"generic",keys:t,live:null==d?void 0:d.live,draft:null==d?void 0:d.draft})}),[null==d?void 0:d.draft,null==d?void 0:d.live]);return(0,je.jsxs)(Me.A,{layout:"vertical",form:s,submitter:!1,style:{marginLeft:"20px",maxWidth:640},onValuesChange:p,children:[(0,je.jsx)(Ee.Z,{width:"md",name:"enabled",label:(0,je.jsxs)("span",{children:[n.formatMessage({id:"robot.to.agent.enabled",defaultMessage:"启用机器人转人工策略"}),(0,je.jsx)(m,{keys:["enabled"]})]})}),(0,je.jsx)(we.Z,{name:["enabled"],children:function(e){var t=!1===e.enabled;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ee.Z,{width:"md",name:"keywordTriggerEnabled",label:(0,je.jsxs)("span",{children:[n.formatMessage({id:"robot.to.agent.keyword.trigger",defaultMessage:"允许关键词触发"}),(0,je.jsx)(m,{keys:["keywordTriggerEnabled"]})]}),tooltip:n.formatMessage({id:"robot.to.agent.keyword.trigger.tip",defaultMessage:"访客发送关键词时立即转人工"}),fieldProps:{disabled:t}}),(0,je.jsx)(Se.Z,{width:"lg",name:"triggerKeywords",label:(0,je.jsxs)("span",{children:[n.formatMessage({id:"robot.to.agent.keywords",defaultMessage:"转人工关键词"}),(0,je.jsx)(m,{keys:["triggerKeywords"]})]}),fieldProps:{mode:"tags",tokenSeparators:[",","，"," ",";","；","\n"],disabled:t||!1===s.getFieldValue("keywordTriggerEnabled"),placeholder:n.formatMessage({id:"robot.to.agent.keywords.placeholder",defaultMessage:"输入关键词并回车确认，可粘贴多个"})},extra:n.formatMessage({id:"robot.to.agent.keywords.extra",defaultMessage:"直接输入关键词，然后回车确认，可设置多个关键词"})}),(0,je.jsx)(Ee.Z,{width:"md",name:"allowVisitorManualTransfer",label:(0,je.jsxs)("span",{children:[n.formatMessage({id:"robot.to.agent.manual.transfer",defaultMessage:"允许访客手动转人工"}),(0,je.jsx)(m,{keys:["allowVisitorManualTransfer"]})]}),fieldProps:{disabled:t}}),(0,je.jsx)(we.Z,{name:["allowVisitorManualTransfer"],children:function(e){return!1!==e.allowVisitorManualTransfer?(0,je.jsx)(Pe.Z,{width:"lg",name:"manualTransferLabel",label:(0,je.jsxs)("span",{children:[n.formatMessage({id:"robot.to.agent.manual.label",defaultMessage:"手动转人工按钮文案"}),(0,je.jsx)(m,{keys:["manualTransferLabel"]})]}),fieldProps:{maxLength:20,disabled:t},placeholder:n.formatMessage({id:"robot.to.agent.manual.label.placeholder",defaultMessage:"如：转人工客服"})}):null}})]})}})]})},Oe=(r(92029),r(58620)),Ne=r(85977),We="tips",Ue=function(){var e,t,r,n,s,d,c,v,m=(0,u.useIntl)(),P=(0,u.useAccess)(),I=(0,re.u)((function(e){return e.currentOrg})),O=(0,ne.Z)().leftSiderStyle,N=(0,oe.Z)().isDarkMode,z=(0,a.useState)(!1),K=i()(z,2),se=K[0],me=K[1],he=(0,a.useState)([]),be=i()(he,2),xe=be[0],Me=be[1],ke=(0,a.useState)(),we=i()(ke,2),Se=we[0],Ze=we[1],Ce=(0,a.useState)(""),Le=i()(Ce,2),Ee=Le[0],Pe=Le[1],Ue=(0,a.useState)(We),De=i()(Ue,2),qe=De[0],Ve=De[1],ze=(0,a.useState)(!1),Ke=i()(ze,2),Be=Ke[0],He=Ke[1],_e=(0,a.useState)(null),Ge=i()(_e,2),Je=Ge[0],Qe=Ge[1],Ye=(0,a.useState)(!1),Xe=i()(Ye,2),$e=Xe[0],et=Xe[1],tt=(0,a.useMemo)((function(){return xe.find((function(e){return e.uid===Se}))||null}),[xe,Se]),rt=(0,a.useState)(!1),nt=i()(rt,2),ot=nt[0],st=nt[1],it=(0,a.useState)(!1),at=i()(it,2),lt=at[0],ut=at[1],dt=(0,a.useState)(!1),gt=i()(dt,2),ct=gt[0],ft=gt[1],vt=(0,a.useRef)(""),pt=(0,ie.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),mt=pt.setCurrentWorkgroupSettings,ht=pt.currentWorkgroupSettings,bt=(0,a.useMemo)((function(){var e;return null!==(e=null!=ht?ht:tt)&&void 0!==e?e:null}),[ht,tt]),xt=(0,a.useMemo)((function(){var e;return null==P||null===(e=P.getModulePermission)||void 0===e?void 0:e.call(P,Ne.MY.WORKGROUP_SETTINGS)}),[P]),Mt=null!==(e=null==xt||null===(t=xt.canRead)||void 0===t?void 0:t.call(xt))&&void 0!==e&&e,kt=null!==(r=null==xt||null===(n=xt.canCreate)||void 0===n?void 0:n.call(xt))&&void 0!==r&&r,wt=null!==(s=null==xt||null===(d=xt.canUpdate)||void 0===d?void 0:d.call(xt))&&void 0!==s&&s,St=null!==(c=null==xt||null===(v=xt.canDelete)||void 0===v?void 0:v.call(xt))&&void 0!==c&&c,yt=(0,a.useRef)(!1),jt=(0,a.useCallback)((function(e,t){ee.yw.warning(m.formatMessage({id:e,defaultMessage:t}))}),[m]),Tt=(0,a.useCallback)((function(e){if(ht){var t=ht.draftServiceSettings||ht.serviceSettings||{};mt(h()(h()({},ht),{},{draftServiceSettings:h()(h()({},t),e)}))}}),[ht,mt]),Rt=(0,a.useCallback)((function(e){if(ht){var t=ht.draftTriggerSettings||ht.triggerSettings||{};mt(h()(h()({},ht),{},{draftTriggerSettings:h()(h()({},t),e)}))}}),[ht,mt]),Zt=(0,a.useCallback)((function(e){if(ht){var t=ht.draftInviteSettings||ht.inviteSettings||{};mt(h()(h()({},ht),{},{draftInviteSettings:h()(h()({},t),e)}))}}),[ht,mt]),Ct=(0,a.useCallback)((function(e){if(ht){var t=ht.draftIntentionSettings||ht.intentionSettings||{};mt(h()(h()({},ht),{},{draftIntentionSettings:h()(h()({},t),e)}))}}),[ht,mt]),At=(0,a.useCallback)((function(e){if(ht){var t=ht.draftEmotionSettings||ht.emotionSettings||{};mt(h()(h()({},ht),{},{draftEmotionSettings:h()(h()({},t),e)}))}}),[ht,mt]),Ft=((0,a.useCallback)((function(e){if(ht){var t=ht.draftSummarySettings||ht.summarySettings||{};mt(h()(h()({},ht),{},{draftSummarySettings:h()(h()({},t),e)}))}}),[ht,mt]),(0,a.useCallback)((function(e){if(ht){var t=ht.draftMessageLeaveSettings||ht.messageLeaveSettings||{};mt(h()(h()({},ht),{},{draftMessageLeaveSettings:h()(h()({},t),e)}))}}),[ht,mt])),Lt=(0,a.useCallback)((function(e){if(ht){var t=ht.draftWorktimeSettings||ht.worktimeSettings||{};mt(h()(h()({},ht),{},{draftWorktimeSettings:h()(h()({},t),e)}))}}),[ht,mt]),Et=(0,a.useCallback)((function(e){if(ht){var t=ht.draftRobotRoutingSettings||ht.robotRoutingSettings||{};mt(h()(h()({},ht),{},{draftRobotRoutingSettings:h()(h()({},t),e)}))}}),[ht,mt]),Pt=(0,a.useCallback)((function(e){if(ht){var t=ht.draftQueueSettings||ht.queueSettings||{};mt(h()(h()({},ht),{},{draftQueueSettings:h()(h()({},t),e)}))}}),[ht,mt]),It=(0,a.useCallback)((function(e){if(ht){var t=ht.draftRobotToAgentSettings||ht.robotToAgentSettings||{};mt(h()(h()({},ht),{},{draftRobotToAgentSettings:h()(h()({},t),e)}))}}),[ht,mt]),Ot=(0,a.useMemo)((function(){if(!Ee)return xe;var e=Ee.toLowerCase();return xe.filter((function(t){var r=(t.name||t.uid||"").toLowerCase(),n=(t.description||"").toLowerCase();return r.includes(e)||n.includes(e)}))}),[xe,Ee]),Nt=(0,a.useCallback)(function(){var e=p()(f()().mark((function e(t,r){var n,o,s,i,a;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=I&&I.uid){e.next=2;break}return e.abrupt("return");case 2:if(Mt){e.next=10;break}return yt.current||(yt.current=!0,jt("settings.no.permission.read","没有查看权限")),Me([]),Ze(void 0),mt(null),vt.current=JSON.stringify({}),ft(!1),e.abrupt("return");case 10:return me(!0),e.prev=11,o=(null!=t?t:"").trim(),s={orgUid:I.uid,pageNumber:0,pageSize:100,searchText:o||void 0},e.next=16,(0,te.zc)(s);case 16:i=e.sent,ye.Z.debug("加载工作组配置模板列表: ",null==i?void 0:i.data,s),a=(null==i||null===(n=i.data)||void 0===n?void 0:n.content)||[],Me(a),!(a.length>0)||Se&&a.some((function(e){return e.uid===Se}))||(Ze(a[0].uid),null!=r&&r.keepActive||Ve(We));case 21:return e.prev=21,me(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[11,,21,24]])})));return function(t,r){return e.apply(this,arguments)}}(),[Mt,null==I?void 0:I.uid,Se,mt,jt]),Wt=(0,a.useCallback)((function(e){Nt(null!=e?e:Ee)}),[Nt,Ee]);(0,a.useEffect)((function(){Nt(Ee)}),[null==I?void 0:I.uid]),(0,a.useEffect)((function(){tt?(mt(tt),vt.current=JSON.stringify(null!=tt?tt:{}),ft(!1)):(mt(null),vt.current=JSON.stringify({}),ft(!1))}),[tt]),(0,a.useEffect)((function(){if(tt)try{var e=JSON.stringify(null!=ht?ht:{});ft(e!==vt.current)}catch(e){ft(!0)}}),[ht,null==tt?void 0:tt.uid]);var Ut=function(){var e=p()(f()().mark((function e(t){var r,n,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(St){e.next=3;break}return jt("settings.no.permission.delete","没有删除权限"),e.abrupt("return");case 3:if(null!=(r=null!=t?t:tt)&&r.uid){e.next=6;break}return e.abrupt("return");case 6:return n={uid:r.uid,orgUid:null==I?void 0:I.uid,pageNumber:0,pageSize:100},e.next=9,(0,te.zN)(n);case 9:(o=e.sent)&&200===o.code?(ee.yw.success(m.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Nt(Ee)):ee.yw.error((null==o?void 0:o.message)||m.formatMessage({id:"delete.error",defaultMessage:"删除失败"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Dt=function(){var e=p()(f()().mark((function e(t,r){var n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wt){e.next=3;break}return jt("settings.no.permission.update","没有更新权限"),e.abrupt("return");case 3:return e.prev=3,e.next=6,(0,te.Y2)({uid:t,orgUid:null==I?void 0:I.uid,enabled:r});case 6:(n=e.sent)&&200===n.code?(ee.yw.success(m.formatMessage({id:r?"common.enabled":"common.disabled",defaultMessage:r?"已启用":"已停用"})),Nt(Ee)):ee.yw.error((null==n?void 0:n.message)||m.formatMessage({id:"operation.failed",defaultMessage:"操作失败"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("切换启用状态失败:",e.t0),ee.yw.error(m.formatMessage({id:"operation.failed",defaultMessage:"操作失败"}));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,r){return e.apply(this,arguments)}}(),qt=function(e,t){if(e){var r={};return t.forEach((function(t){void 0!==e[t]&&(r[t]=e[t])})),r}},Vt=function(e){return!e||"object"!==g()(e)||0===Object.keys(e).length},zt=function(e){if(e){var t=qt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputPreviewEnabled","inputPreviewAlwaysShow","inputPreviewShowSeconds","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","requireLogin","showLogo","validateUntil","inputAssociationKbUid"]),r=function(e){if(e)return qt(e,["smile","upload","image","file","uploadRobot","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return h()(h()({},t),r?{toolbar:r}:{})}},Kt=function(e){if(e){var t=null==e?void 0:e.triggers;return Array.isArray(t)?{uid:null==e?void 0:e.uid,triggers:t.map((function(e){return{uid:null==e?void 0:e.uid,triggerKey:null==e?void 0:e.triggerKey,enabled:null==e?void 0:e.enabled,type:null==e?void 0:e.type,name:null==e?void 0:e.name,description:null==e?void 0:e.description,config:null==e?void 0:e.config}}))}:qt(e,["uid"])}},Bt=function(e){if(e)return qt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ht=function(e){if(e)return qt(e,["name","description","color","order","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},_t=function(e){if(e)return qt(e,["name","description","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},Gt=function(e){if(e)return qt(e,["name","description","defaultTemplate","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},Jt=function(e){if(e)return qt(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},Qt=function(e){if(e)return qt(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},Yt=function(e){if(e){var t=qt(e,["enabled","keywordTriggerEnabled","triggerKeywords","minConfidence","maxRobotRepliesBeforeTransfer","autoTransferDelaySeconds","cooldownSeconds","allowVisitorManualTransfer","manualTransferLabel"]),r=h()({},t);return Array.isArray(r.triggerKeywords)&&(r.triggerKeywords=Array.from(new Set(r.triggerKeywords.map((function(e){return(e||"").trim()})).filter((function(e){return e.length>0}))))),"string"==typeof r.manualTransferLabel&&(r.manualTransferLabel=r.manualTransferLabel.trim()),r}},Xt=function(e){var t,r;if(e){var n=qt(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),o=null!==(t=e.robotUid)&&void 0!==t?t:null===(r=e.robot)||void 0===r?void 0:r.uid;return h()(h()({},n),o?{robotUid:o}:{})}},$t=function(e){if(e)return qt(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},er=function(){var e=p()(f()().mark((function e(){var t,r,n,o,s,i,a,l,u,d,g,c,v,p,b,x,M;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wt){e.next=3;break}return jt("settings.no.permission.update","没有更新权限"),e.abrupt("return");case 3:if(null!=tt&&tt.uid){e.next=6;break}return ee.yw.warning(m.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),e.abrupt("return");case 6:return st(!0),e.prev=7,t=ht&&ht.uid===tt.uid?ht:tt,n=zt((r=function(e,t){return h()(h()({},e||{}),t||{})})(null==t?void 0:t.serviceSettings,null==t?void 0:t.draftServiceSettings)),o=Kt(r(null==t?void 0:t.triggerSettings,null==t?void 0:t.draftTriggerSettings)),s=Bt(r(null==t?void 0:t.inviteSettings,null==t?void 0:t.draftInviteSettings)),i=Ht(r(null==t?void 0:t.intentionSettings,null==t?void 0:t.draftIntentionSettings)),a=_t(r(null==t?void 0:t.emotionSettings,null==t?void 0:t.draftEmotionSettings)),l=Gt(r(null==t?void 0:t.summarySettings,null==t?void 0:t.draftSummarySettings)),u=Jt(r(null==t?void 0:t.messageLeaveSettings,null==t?void 0:t.draftMessageLeaveSettings)),d=$t(r(null==t?void 0:t.worktimeSettings,null==t?void 0:t.draftWorktimeSettings)),g=Xt(r(null==t?void 0:t.robotRoutingSettings,null==t?void 0:t.draftRobotRoutingSettings)),c=Qt(r(null==t?void 0:t.queueSettings,null==t?void 0:t.draftQueueSettings)),v=Yt(r(null==t?void 0:t.robotToAgentSettings,null==t?void 0:t.draftRobotToAgentSettings)),p=h()(h()(h()(h()(h()(h()(h()(h()(h()(h()(h()({uid:tt.uid,orgUid:null==I?void 0:I.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,isDefault:null==t?void 0:t.isDefault,enabled:null==t?void 0:t.enabled,routingMode:null==t?void 0:t.routingMode},Vt(n)?{}:{serviceSettings:n}),Vt(o)?{}:{triggerSettings:o}),Vt(s)?{}:{inviteSettings:s}),Vt(i)?{}:{intentionSettings:i}),Vt(a)?{}:{emotionSettings:a}),Vt(l)?{}:{summarySettings:l}),Vt(u)?{}:{messageLeaveSettings:u}),Vt(d)?{}:{worktimeSettings:d}),Vt(g)?{}:{robotRoutingSettings:g}),Vt(c)?{}:{queueSettings:c}),Vt(v)?{}:{robotToAgentSettings:v}),e.next=24,(0,te.Y2)(p);case 24:b=e.sent,console.log("保存工作组配置模板: ",b,p),b&&200===b.code?(ee.yw.success(m.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),vt.current=JSON.stringify(null!==(x=null!==(M=null==b?void 0:b.data)&&void 0!==M?M:t)&&void 0!==x?x:{}),ft(!1),Nt(Ee,{keepActive:!0})):ee.yw.error((null==b?void 0:b.message)||m.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=33;break;case 29:e.prev=29,e.t0=e.catch(7),console.error("保存失败:",e.t0),ee.yw.error(m.formatMessage({id:"save.failed",defaultMessage:"保存失败"}));case 33:return e.prev=33,st(!1),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[7,29,33,36]])})));return function(){return e.apply(this,arguments)}}(),tr=function(){var e=p()(f()().mark((function e(){var t,r,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wt){e.next=3;break}return jt("settings.no.permission.publish","没有发布权限"),e.abrupt("return");case 3:if(null!=tt&&tt.uid){e.next=6;break}return ee.yw.warning(m.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),e.abrupt("return");case 6:if(ut(!0),e.prev=7,!ct){e.next=11;break}return e.next=11,er();case 11:return t={uid:tt.uid,orgUid:null==I?void 0:I.uid},e.next=14,(0,te.Dm)(t);case 14:(r=e.sent)&&200===r.code?(ee.yw.success(m.formatMessage({id:"common.published",defaultMessage:"发布成功"})),vt.current=JSON.stringify(null!==(n=null==r?void 0:r.data)&&void 0!==n?n:{}),ft(!1),Nt(Ee)):ee.yw.error((null==r?void 0:r.message)||m.formatMessage({id:"publish.failed",defaultMessage:"发布失败"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("发布失败:",e.t0),ee.yw.error(m.formatMessage({id:"publish.failed",defaultMessage:"发布失败"}));case 22:return e.prev=22,ut(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),rr=(0,a.useMemo)((function(){return null!=tt&&tt.uid?[{key:"tips",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(C.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,je.jsx)(ce.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},onServiceSettingsChange:Tt})},{key:"service",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(A.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"})]}),children:(0,je.jsx)(ge.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},onServiceSettingsChange:Tt})}].concat(o()((0,Oe.OJ)()?[{key:"inputAssociation",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(F.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"workgroup.settings.input.association",defaultMessage:"输入联想"})]}),children:(0,je.jsx)(ae.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},onServiceSettingsChange:Tt})}]:[]),o()((0,Oe.OJ)()?[{key:"rate",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(L.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,je.jsx)(pe.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},onServiceSettingsChange:Tt})}]:[]),[{key:"robot",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(E.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"robot",defaultMessage:"Robot"})]}),children:(0,je.jsx)(Te,{variant:"workgroup",robotRoutingSettings:{live:null==bt?void 0:bt.robotRoutingSettings,draft:null==bt?void 0:bt.draftRobotRoutingSettings},onRobotRoutingSettingsChange:Et})}],o()([]),o()((0,Oe.OJ)()?[{key:"robotToAgent",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(W,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"robotToAgent",defaultMessage:"Robot to Agent"})]}),children:(0,je.jsx)(Ie,{variant:"workgroup",robotToAgentSettings:{live:null==bt?void 0:bt.robotToAgentSettings,draft:null==bt?void 0:bt.draftRobotToAgentSettings},onRobotToAgentSettingsChange:It})}]:[]),o()((0,Oe.OJ)()?[{key:"messageLeave",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(U.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"workgroup.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,je.jsx)(fe.Z,{variant:"workgroup",messageLeaveSettings:{live:null==bt?void 0:bt.messageLeaveSettings,draft:null==bt?void 0:bt.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Ft})}]:[]),o()((0,Oe.OJ)()?[{key:"queue",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(Fe.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"workgroup.settings.queue",defaultMessage:"排队设置"})]}),children:(0,je.jsx)(Re.Z,{variant:"workgroup",queueSettings:{live:null==bt?void 0:bt.queueSettings,draft:null==bt?void 0:bt.draftQueueSettings},onQueueSettingsChange:Pt})}]:[]),o()([]),o()((0,Oe.OJ)()?[{key:"toolbar",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(D.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,je.jsx)(de.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},settingsUid:tt.uid,isActive:"toolbar"===qe,onServiceSettingsChange:Tt})}]:[]),o()((0,Oe.OJ)()?[{key:"right",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(q.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,je.jsx)(le.Z,{variant:"workgroup",serviceSettings:{live:null==bt?void 0:bt.serviceSettings,draft:null==bt?void 0:bt.draftServiceSettings},onServiceSettingsChange:Tt,settingsUid:tt.uid,isActive:"right"===qe})}]:[]),o()((0,Oe.OJ)()?[{key:"trigger",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(V.Z,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"})]}),children:(0,je.jsx)(ue.Z,{variant:"workgroup",triggerSettings:{live:null==bt?void 0:bt.triggerSettings,draft:null==bt?void 0:bt.draftTriggerSettings},onTriggerSettingsChange:Rt})}]:[]),[{key:"route",label:(0,je.jsxs)("span",{children:[(0,je.jsx)(B,{})," ",(0,je.jsx)(u.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"})]}),children:(0,je.jsx)(Ae,{})}],o()([])):[]}),[null==tt?void 0:tt.uid,bt,m,Tt,Rt,Zt,Ft,Ct,At,Et,It,Lt,Pt,qe]);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(b.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,je.jsx)(b.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:O,children:(0,je.jsxs)($.Z,{title:m.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:kt?(0,je.jsx)(x.ZP,{size:"small",icon:(0,je.jsx)(H.Z,{}),type:"primary",onClick:function(){kt?(Qe(null),He(!0)):jt("settings.no.permission.create","没有新建权限")},children:(0,je.jsx)(u.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}):null,bodyStyle:{padding:8},loading:se,children:[(0,je.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,je.jsxs)(M.Z.Compact,{style:{width:"100%"},children:[(0,je.jsx)(k.Z,{placeholder:m.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:Ee,onChange:function(e){return Pe(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;Pe(t),Wt(t)},allowClear:!0,size:"middle"}),(0,je.jsx)(x.ZP,{type:"primary",icon:(0,je.jsx)(F.Z,{}),"aria-label":m.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return Wt()}})]})}),(0,je.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,je.jsx)(w.Z,{dataSource:Ot,locale:{emptyText:(0,je.jsx)(S.Z,{description:m.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:S.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,je.jsx)(w.Z.Item,{style:Se===e.uid?{backgroundColor:N?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Ze(e.uid)},children:(0,je.jsx)(w.Z.Item.Meta,{title:(0,je.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,je.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,je.jsx)(M.Z,{size:4,children:e.isDefault?(0,je.jsx)(y.Z,{color:"blue",children:(0,je.jsx)(u.FormattedMessage,{id:"pages.common.default",defaultMessage:"默认"})}):null})]}),description:e.description?(0,je.jsx)("div",{style:{color:N?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,je.jsx)(b.Z.Panel,{children:tt?(0,je.jsx)($.Z,{title:(0,je.jsxs)(M.Z,{children:[(0,je.jsxs)("span",{children:[m.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",tt.name||tt.uid]}),(0,je.jsx)(j.Z,{checked:!!tt.enabled,onChange:function(e){return Dt(tt.uid,e)},checkedChildren:m.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:m.formatMessage({id:"common.disabled",defaultMessage:"停用"}),disabled:!wt}),wt?(0,je.jsx)(x.ZP,{size:"small",icon:(0,je.jsx)(_.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=tt,wt?(Qe(null!=t?t:tt),He(!0)):jt("settings.no.permission.update","没有更新权限")},children:(0,je.jsx)(u.FormattedMessage,{id:"pages.common.edit",defaultMessage:"编辑"})}):null,St?(0,je.jsx)(T.Z,{title:m.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ut(tt)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:m.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:m.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,je.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,je.jsx)(G.Z,{}),onClick:function(e){e.stopPropagation()},children:(0,je.jsx)(u.FormattedMessage,{id:"pages.common.delete",defaultMessage:"删除"})})}):null,tt.isDefault?(0,je.jsx)(y.Z,{color:"blue",children:(0,je.jsx)(u.FormattedMessage,{id:"pages.common.default",defaultMessage:"默认"})}):null]}),extra:(0,je.jsxs)(M.Z,{children:[(0,je.jsx)(T.Z,{title:m.formatMessage({id:"settings.publish.online.title",defaultMessage:"发布到线上环境"}),description:m.formatMessage({id:"settings.publish.online.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:m.formatMessage({id:"settings.publish.online.ok",defaultMessage:"继续发布"}),cancelText:m.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),tr()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,je.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:lt,type:"default",icon:(0,je.jsx)(J.Z,{}),disabled:!wt,children:(0,je.jsx)(u.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,je.jsx)(x.ZP,{onClick:function(e){e.stopPropagation(),et(!0)},type:"default",icon:(0,je.jsx)(Q.Z,{}),disabled:!wt,children:(0,je.jsx)(u.FormattedMessage,{id:"settings.gray.publish",defaultMessage:"灰度发布"})}),(0,je.jsx)(x.ZP,{onClick:function(){tt&&(mt(tt),vt.current=JSON.stringify(null!=tt?tt:{}),ft(!1))},disabled:!ct||!wt,icon:(0,je.jsx)(Y.Z,{}),children:(0,je.jsx)(u.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,je.jsx)(x.ZP,{type:"primary",loading:ot,onClick:er,disabled:!ct||!wt,icon:(0,je.jsx)(X.Z,{}),children:(0,je.jsx)(u.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,je.jsx)(l.Z,{activeKey:qe,onChange:Ve,items:rr})}):(0,je.jsx)($.Z,{children:(0,je.jsx)(S.Z,{description:m.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,je.jsx)(ve.Z,{open:Be,onOpenChange:He,orgUid:(null==I?void 0:I.uid)||"",record:Je,onSuccess:function(){He(!1),Nt(Ee)}}),(0,je.jsxs)(R.Z,{title:m.formatMessage({id:"settings.gray.publish.title",defaultMessage:"灰度发布说明"}),open:$e,onCancel:function(){return et(!1)},footer:[(0,je.jsx)(x.ZP,{onClick:function(){return et(!1)},children:(0,je.jsx)(u.FormattedMessage,{id:"common.close",defaultMessage:"关闭"})},"close"),(0,je.jsx)(x.ZP,{type:"primary",onClick:function(){et(!1),u.history.push("/service/channel")},children:(0,je.jsx)(u.FormattedMessage,{id:"settings.gray.publish.go.channel",defaultMessage:"前往渠道页面获取链接"})},"go")],children:[(0,je.jsx)(Z.Z.Paragraph,{children:(0,je.jsx)(u.FormattedMessage,{id:"settings.gray.publish.p1",defaultMessage:"灰度发布用于测试当前草稿（draft）配置，点击保存，但未点击发布，不会影响线上环境。"})}),(0,je.jsx)(Z.Z.Paragraph,{children:(0,je.jsx)(u.FormattedMessage,{id:"settings.gray.publish.p2",defaultMessage:"在渠道页面生成链接时勾选“灰度测试”，链接会追加 {draft1}；嵌入式脚本会在 {chatConfig} 中增加 {draftTrue}。",values:{draft1:(0,je.jsx)(Z.Z.Text,{code:!0,children:"draft=1"}),chatConfig:(0,je.jsx)(Z.Z.Text,{code:!0,children:"chatConfig"}),draftTrue:(0,je.jsx)(Z.Z.Text,{code:!0,children:"draft: true"})}})})]})]})},De=r(65669),qe=r(68177),Ve=r(69174),ze=r(28582),Ke=r(79658);function Be(e){return He.apply(this,arguments)}function He(){return(He=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workgroup/routing/state",{method:"GET",params:h()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workgroup/routing/state/refresh",{method:"POST",params:h()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Je={ROUND_ROBIN:{labelId:"workgroup.routing.mode.ROUND_ROBIN.label",descId:"workgroup.routing.mode.ROUND_ROBIN.desc",defaultLabel:"Round Robin",defaultDesc:"Round-robin: assign in a fixed order for fairness; best for agents with similar capability (reconnect may re-queue)."},LEAST_ACTIVE:{labelId:"workgroup.routing.mode.LEAST_ACTIVE.label",descId:"workgroup.routing.mode.LEAST_ACTIVE.desc",defaultLabel:"Least Active",defaultDesc:"Least-active: prefer the agent with the fewest active conversations for better load balancing."},RANDOM:{labelId:"workgroup.routing.mode.RANDOM.label",descId:"workgroup.routing.mode.RANDOM.desc",defaultLabel:"Random",defaultDesc:"Random: pick an agent randomly; simplest rule, good for temporary/simple scenarios."},WEIGHTED_RANDOM:{labelId:"workgroup.routing.mode.WEIGHTED_RANDOM.label",descId:"workgroup.routing.mode.WEIGHTED_RANDOM.desc",defaultLabel:"Weighted Random",defaultDesc:"Weighted random: assign based on weights (e.g., rating/skill), giving better agents more chances."},CONSISTENT_HASH:{labelId:"workgroup.routing.mode.CONSISTENT_HASH.label",descId:"workgroup.routing.mode.CONSISTENT_HASH.desc",defaultLabel:"Consistent Hash",defaultDesc:"Consistent hash: try to route the same visitor to the same agent to improve continuity."},FASTEST_RESPONSE:{labelId:"workgroup.routing.mode.FASTEST_RESPONSE.label",descId:"workgroup.routing.mode.FASTEST_RESPONSE.desc",defaultLabel:"Fastest Response",defaultDesc:"Fastest response: prefer the fastest-responding agent to improve response experience."},BROADCAST:{labelId:"workgroup.routing.mode.BROADCAST.label",descId:"workgroup.routing.mode.BROADCAST.desc",defaultLabel:"Broadcast",defaultDesc:"Broadcast: notify all agents and let them pick up / accept the conversation."},RECENT:{labelId:"workgroup.routing.mode.RECENT.label",descId:"workgroup.routing.mode.RECENT.desc",defaultLabel:"Recent",defaultDesc:"Recent-first: prefer the agent who recently served this visitor (closer to historical relationship)."},LLM:{labelId:"workgroup.routing.mode.LLM.label",descId:"workgroup.routing.mode.LLM.desc",defaultLabel:"LLM",defaultDesc:"LLM: use an LLM to decide routing based on skills/history and other signals."},MANUAL:{labelId:"workgroup.routing.mode.MANUAL.label",descId:"workgroup.routing.mode.MANUAL.desc",defaultLabel:"Manual",defaultDesc:"Manual: manually accept or explicitly assign an agent."}},Qe=Z.Z.Text,Ye=function(e){var t,r=e.isActive,n=void 0!==r&&r,o=(0,u.useIntl)(),s=(0,re.u)((function(e){return e.currentOrg})),l=(0,a.useState)([]),d=i()(l,2),g=d[0],c=d[1],v=(0,a.useState)(void 0),m=i()(v,2),h=m[0],b=m[1],k=(0,a.useState)(null),S=i()(k,2),j=S[0],T=S[1],R=(0,a.useState)(!1),Z=i()(R,2),C=Z[0],A=Z[1],F=(0,a.useMemo)((function(){return(g||[]).filter((function(e){return!(null==e||!e.uid)})).map((function(e){return{label:e.nickname||e.uid,value:e.uid}}))}),[g]),L=function(){var e=p()(f()().mark((function e(){var t,r,n,o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={orgUid:s.uid,pageNumber:0,pageSize:200},e.next=6,(0,Ke.LE)(t);case 6:r=e.sent,ye.Z.debug("fetchWorkgroups resp:",r),200===(null==r?void 0:r.code)&&(i=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],c(i),!h&&null!=i&&null!==(o=i[0])&&void 0!==o&&o.uid&&b(i[0].uid)),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=p()(f()().mark((function e(t){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return A(!0),e.prev=3,e.next=6,Be({workgroupUid:t});case 6:r=e.sent,ye.Z.debug("fetchRoutingState resp:",r,t),200===(null==r?void 0:r.code)?T(r.data):(T(null),ee.yw.error((null==r?void 0:r.message)||o.formatMessage({id:"workgroup.routing.state.fetch.failed",defaultMessage:"Failed to fetch routing state"}))),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),T(null),ee.yw.error(o.formatMessage({id:"workgroup.routing.state.fetch.failed",defaultMessage:"Failed to fetch routing state"}));case 15:return e.prev=15,A(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=p()(f()().mark((function e(t){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return A(!0),e.prev=3,e.next=6,_e({workgroupUid:t});case 6:r=e.sent,ye.Z.debug("manualRefreshRoutingState resp:",r,t),200===(null==r?void 0:r.code)?(T(r.data),ee.yw.success(o.formatMessage({id:"workgroup.routing.refresh.success",defaultMessage:"Routing queue refreshed"}))):(T(null),ee.yw.error((null==r?void 0:r.message)||o.formatMessage({id:"workgroup.routing.refresh.failed",defaultMessage:"Failed to refresh routing queue"}))),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),T(null),ee.yw.error(o.formatMessage({id:"workgroup.routing.refresh.failed",defaultMessage:"Failed to refresh routing queue"}));case 15:return e.prev=15,A(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,11,15,18]])})));return function(t){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){n&&L()}),[null==s?void 0:s.uid,n]),(0,a.useEffect)((function(){if(h&&n){E(h);var e=window.setInterval((function(){n&&E(h)}),1e4);return function(){return window.clearInterval(e)}}}),[h,n]);var I=(null==j?void 0:j.nextAgentUid)||(null==j||null===(t=j.nextAgent)||void 0===t?void 0:t.uid),O=(null==j?void 0:j.availableAgents)||[],N=((null==j?void 0:j.routingMode)||"").toUpperCase(),W=(0,a.useMemo)((function(){var e=Je[N];if(e)return{label:o.formatMessage({id:e.labelId,defaultMessage:e.defaultLabel}),desc:o.formatMessage({id:e.descId,defaultMessage:e.defaultDesc})}}),[o,N]);return(0,je.jsx)(qe.Z,{title:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.title",defaultMessage:"Workgroup Routing"}),extra:(0,je.jsx)(M.Z,{children:(0,je.jsx)(x.ZP,{onClick:function(){return P(h)},loading:C,children:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.refresh",defaultMessage:"Refresh"})})}),children:(0,je.jsxs)(M.Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,je.jsxs)(M.Z,{wrap:!0,children:[(0,je.jsxs)(Qe,{children:[(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.workgroup",defaultMessage:"Workgroup"}),"："]}),(0,je.jsx)(Ve.Z,{style:{minWidth:260},options:F,value:h,onChange:function(e){return b(e)},placeholder:o.formatMessage({id:"workgroup.routing.workgroup.placeholder",defaultMessage:"Please select a workgroup"})}),(0,je.jsxs)(Qe,{children:[(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.mode",defaultMessage:"Routing Mode"}),"："]}),(0,je.jsx)(y.Z,{children:(null==W?void 0:W.label)||(null==j?void 0:j.routingMode)||"-"}),null!=W&&W.desc?(0,je.jsx)(Qe,{type:"secondary",children:W.desc}):null,(0,je.jsx)(Qe,{type:"secondary",children:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.tip.editPolicy",defaultMessage:"To change the routing strategy, go to: Workgroup Settings - Routing Settings."})}),(0,je.jsxs)(Qe,{children:[(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.nextAgent",defaultMessage:"Next Agent"}),"："]}),null!=j&&j.nextAgent?(0,je.jsxs)(M.Z,{children:[(0,je.jsx)(ze.Z,{src:j.nextAgent.avatar,size:"small"}),(0,je.jsx)(Qe,{children:j.nextAgent.nickname||j.nextAgent.uid})]}):(0,je.jsx)(Qe,{type:"secondary",children:"-"})]}),(0,je.jsx)(w.Z,{loading:C,header:(0,je.jsx)(Qe,{children:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.availableAgents",defaultMessage:"Available agents (online and ready)"})}),dataSource:O,renderItem:function(e){var t=!!I&&(null==e?void 0:e.uid)===I;return(0,je.jsx)(w.Z.Item,{children:(0,je.jsxs)(M.Z,{children:[(0,je.jsx)(ze.Z,{src:null==e?void 0:e.avatar}),(0,je.jsx)(Qe,{children:(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)}),t&&(0,je.jsx)(y.Z,{children:(0,je.jsx)(u.FormattedMessage,{id:"workgroup.routing.next",defaultMessage:"NEXT"})})]})})}})]})})},Xe=function(){var e,t,r,n,s,d,g,c=(0,u.useAccess)(),f=null!==(e=null==c||null===(t=c.hasAnyModulePermission)||void 0===t?void 0:t.call(c,Ne.MY.WORKGROUP))&&void 0!==e&&e,v=null!==(r=null==c||null===(n=c.hasAnyModulePermission)||void 0===n?void 0:n.call(c,Ne.MY.WORKGROUP_SETTINGS))&&void 0!==r&&r,p=null!==(s=null==c||null===(d=c.hasAnyModulePermission)||void 0===d?void 0:d.call(c,Ne.MY.WORKGROUP_ROUTING))&&void 0!==s&&s,m=null!==(g=(0,a.useMemo)((function(){var e=[];return f&&e.push("table"),v&&e.push("settings"),p&&e.push("routing"),e}),[f,v,p])[0])&&void 0!==g?g:"table",h=(0,a.useState)(m),b=i()(h,2),x=b[0],M=b[1],k=(0,a.useMemo)((function(){return[].concat(o()(f?[{key:"table",label:(0,je.jsx)(u.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,je.jsx)(De.Z,{})}]:[]),o()(v?[{key:"settings",label:(0,je.jsx)(u.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,je.jsx)(Ue,{})}]:[]),o()(p?[{key:"routing",label:(0,je.jsx)(u.FormattedMessage,{id:"menu.workgroup.routing",defaultMessage:"Workgroup Routing"}),children:(0,je.jsx)(Ye,{isActive:"routing"===x})}]:[]))}),[x,f,p,v]);return 0===k.length?null:(0,je.jsx)(l.Z,{activeKey:x,onChange:function(e){return M(e)},style:{padding:"10px"},items:k})}}}]);