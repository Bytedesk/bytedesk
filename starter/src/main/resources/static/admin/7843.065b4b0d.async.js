"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7843],{15079:function(e,t,a){var n=a(90819),r=a.n(n),s=a(89933),o=a.n(s),l=a(45332),i=a.n(l),d=a(28520),u=a(27353),c=a(97588),f=a(67186),g=a(17455),p=a(2290),m=a(35746),v=a(69159),h=a(83801),M=a(90883),b=a(46206),x=a(25456),y=a(44194),w=a(48301),k=a(80650),S=a(6992),j=a(43420),C=a(22014),I=a(31549);t.Z=function(e){var t=e.open,a=e.onClose,n=e.onSubmit,s=e.defaultType,l=(0,p.useIntl)(),Z=c.A.useForm(),T=i()(Z,1)[0],U=(0,d.u)((function(e){return e.currentOrg})),E=(0,y.useState)(!1),P=i()(E,2),A=P[0],R=P[1],F=(0,y.useState)(!1),O=i()(F,2),K=O[0],D=O[1],B=(0,y.useState)(0),N=i()(B,2),Q=N[0],z=N[1],q=(0,y.useState)([]),L=i()(q,2),W=L[0],V=L[1],G=(0,y.useState)([]),H=i()(G,2),_=H[0],J=H[1],Y=(0,y.useState)(""),X=i()(Y,2),$=X[0],ee=X[1],te=(0,y.useCallback)(function(){var e=o()(r()().mark((function e(t){var a,n,s,o,l;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),e.prev=1,n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==U?void 0:U.uid,searchText:t||""},e.next=5,(0,w.VW)(n);case 5:return s=e.sent,console.log("queryRobotSettingsByOrg response:",s,n),o=(null==s||null===(a=s.data)||void 0===a?void 0:a.content)||[],V(o),!T.getFieldValue("settingsUid")&&o.length>0&&T.setFieldsValue({settingsUid:o[0].uid}),l=o.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),J(l),e.abrupt("return",l);case 13:return e.prev=13,D(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==U?void 0:U.uid,T]);(0,y.useEffect)((function(){t&&te()}),[t,Q,te]);var ae=function(){console.log("handleSaveRobot"),T.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==U?void 0:U.uid,avatar:e.avatar||$};console.log("robotObject:",t),n(t),T.resetFields(),ee("")})).catch((function(e){console.log("Form errors:",e)}))};(0,y.useEffect)((function(){console.log("RobotForm useEffect"),t&&(T.resetFields(),T.setFieldsValue({type:s||u.f4h}),ee(""))}),[t,T,s]);var ne=function(){var e=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),ee(t),T.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,I.jsx)("div",{children:(0,I.jsxs)(m.Z,{title:l.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:l.formatMessage({id:"save",defaultMessage:"Save"}),onOk:ae,onCancel:function(){T.resetFields(),a()},children:[(0,I.jsxs)(c.A,{form:T,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,I.jsx)(v.Z.Item,{name:"avatarUpload",label:l.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,I.jsxs)(j.G,{onSuccess:ne,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,I.jsx)(h.Z,{src:$}),(0,I.jsx)(M.ZP,{icon:(0,I.jsx)(C.Z,{}),style:{marginLeft:12},children:l.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,I.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,I.jsx)(c.A.Item,{label:l.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:l.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,I.jsxs)(b.Z.Compact,{block:!0,children:[(0,I.jsx)(x.Z,{showSearch:!0,allowClear:!0,placeholder:l.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),options:_,loading:K,filterOption:!1,onSearch:function(e){return te(e)},onFocus:function(){return te()},notFoundContent:0===W.length?(0,I.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,I.jsx)("div",{style:{marginBottom:8,color:"#999"},children:l.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,I.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,I.jsx)(S.Z,{}),onClick:function(){return R(!0)},children:l.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0}),(0,I.jsx)(M.ZP,{size:"small",icon:(0,I.jsx)(S.Z,{}),onClick:function(){return R(!0)},title:l.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:l.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,I.jsx)(f.Z,{label:l.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:l.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return ae()}}}),(0,I.jsx)(g.Z,{label:l.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:l.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:l.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb}],rules:[{required:!0,message:l.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:l.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,I.jsx)(k.Z,{open:A,onOpenChange:R,orgUid:(null==U?void 0:U.uid)||"",record:null,onSuccess:function(){R(!1),z((function(e){return e+1}))}})]})})}},57843:function(e,t,a){a.d(t,{Z:function(){return P}});var n=a(73193),r=a.n(n),s=a(90819),o=a.n(s),l=a(89933),i=a.n(l),d=a(45332),u=a.n(d),c=a(44194),f=a(2290),g=a(77601),p=a(83801),m=a(38623),v=a(70937),h=a(90883),M=a(50884),b=a(24471),x=a(26168),y=a(77129),w=a(28520),k=a(27318),S=a(27353),j=a(51011),C=a(15079),I=a(35746),Z=a(97765),T=a(36651),U=a(31549),E=function(e){var t,a=e.open,n=e.record,s=e.value,l=e.onClose,d=e.onSaved,g=(0,f.useIntl)(),p=(0,w.u)((function(e){return e.currentOrg})),m=(0,c.useState)(s||(null==n||null===(t=n.llm)||void 0===t?void 0:t.prompt)||""),v=u()(m,2),x=v[0],y=v[1],k=(0,c.useState)(!1),S=u()(k,2),j=S[0],C=S[1];(0,c.useEffect)((function(){var e,t;y(null!==(e=null!=s?s:null==n||null===(t=n.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[a,s,null==n?void 0:n.uid]);var E=function(){var e=i()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(x||"");case 3:M.yw.success(g.formatMessage({id:"copy.success",defaultMessage:"复制成功"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),M.yw.error(g.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=i()(o()().mark((function e(){var t,a,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.uid){e.next=3;break}return null==l||l(),e.abrupt("return");case 3:return e.prev=3,M.yw.loading(g.formatMessage({id:"saving",defaultMessage:"Saving..."})),a={uid:(t=n).uid,prompt:x,llm:r()(r()({},t.llm||{}),{},{prompt:x})},e.next=9,(0,b.M8)(a);case 9:s=e.sent,Z.Z.debug("PromptEditModal handleSave updated robot prompt:",s,a),M.yw.destroy(),200===(null==s?void 0:s.code)?(M.yw.success(g.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d()):M.yw.error((null==s?void 0:s.message)||g.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),M.yw.destroy(),M.yw.error(g.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(I.Z,{open:a,title:g.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),onCancel:l,footer:[(0,U.jsx)(h.ZP,{onClick:function(){null!=p&&p.uid?C(!0):M.yw.warning(g.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"}))},children:g.formatMessage({id:"prompt.select",defaultMessage:"选择提示词"})},"choose"),(0,U.jsx)(h.ZP,{onClick:E,children:g.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,U.jsx)(h.ZP,{type:"primary",onClick:P,children:g.formatMessage({id:"save",defaultMessage:"保存"})},"save"),(0,U.jsx)(h.ZP,{onClick:l,children:g.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:(0,U.jsx)("div",{children:(0,U.jsx)("textarea",{value:x,onChange:function(e){return y(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:g.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})})})}),(0,U.jsx)(T.Z,{open:j,orgUid:null==p?void 0:p.uid,onClose:function(){return C(!1)},onSelect:function(e){null!=e&&e.systemPrompt?(y(e.systemPrompt),M.yw.success(g.formatMessage({id:"success",defaultMessage:"已替换提示词"})),C(!1)):M.yw.warning(g.formatMessage({id:"prompt.system.empty",defaultMessage:"该提示词没有系统提示词"}))}})]})},P=function(e){var t,a,n,s,l,d,I,T,P=e.superUser,A=e.robotType,R=void 0===A?S.f4h:A,F=(0,f.useIntl)(),O=(0,f.useAccess)(),K=(0,c.useRef)(),D=(0,w.u)((function(e){return e.currentOrg})),B=(0,c.useState)(!1),N=u()(B,2),Q=N[0],z=N[1],q=(0,c.useState)(!1),L=u()(q,2),W=L[0],V=L[1],G=(0,c.useState)(null),H=u()(G,2),_=H[0],J=H[1],Y=(0,c.useState)(!1),X=u()(Y,2),$=X[0],ee=X[1],te=(0,c.useState)(""),ae=u()(te,2),ne=ae[0],re=ae[1],se=(0,c.useState)(null),oe=u()(se,2),le=oe[0],ie=oe[1],de=(0,c.useState)({}),ue=u()(de,2),ce=ue[0],fe=ue[1],ge=(0,c.useState)({}),pe=u()(ge,2),me=pe[0],ve=pe[1],he=(0,c.useMemo)((function(){var e;return null==O||null===(e=O.getModulePermission)||void 0===e?void 0:e.call(O,k.MY.ROBOT)}),[O]),Me=null!==(t=null==he||null===(a=he.canRead)||void 0===a?void 0:a.call(he))&&void 0!==t&&t,be=null!==(n=null==he||null===(s=he.canCreate)||void 0===s?void 0:s.call(he))&&void 0!==n&&n,xe=null!==(l=null==he||null===(d=he.canUpdate)||void 0===d?void 0:d.call(he))&&void 0!==l&&l,ye=null!==(I=null==he||null===(T=he.canDelete)||void 0===T?void 0:T.call(he))&&void 0!==I&&I,we=(0,c.useRef)(!1),ke=function(e,t){M.yw.warning(F.formatMessage({id:e,defaultMessage:t}))};c.useEffect((function(){var e=function(){var e=i()(o()().mark((function e(){var t,a,n,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==D?void 0:D.uid,level:S.whQ},e.next=4,(0,x.mK)(t);case 4:a=e.sent,Z.Z.debug("RobotTable loadProviders response:",a,t),200===(null==a?void 0:a.code)&&(r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],s={},r.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(s[e.uid]=t)})),fe(s)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=D&&D.uid?e():fe({})}),[null==D?void 0:D.uid]),c.useEffect((function(){var e=function(){var e=i()(o()().mark((function e(){var t,a,n,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,orgUid:null==D?void 0:D.uid,searchText:""},e.next=4,(0,y.AP)(t);case 4:a=e.sent,Z.Z.debug("RobotTable loadKbases response:",a,t),200===(null==a?void 0:a.code)&&(r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],s={},r.forEach((function(e){null!=e&&e.uid&&(s[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),ve(s)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=D&&D.uid?e():ve({})}),[null==D?void 0:D.uid]);var Se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:F.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:F.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,U.jsx)(p.Z,{src:null==t?void 0:t.avatar})}},{title:F.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(e,t){var a=null==t?void 0:t.type,n=a===S.Qeb?"green":a===S.f4h?"blue":"purple",r=a===S.f4h?F.formatMessage({id:S.f4h,defaultMessage:"Service"}):a===S.Qeb?F.formatMessage({id:S.Qeb,defaultMessage:"Chat"}):a===S.wG_?F.formatMessage({id:S.wG_,defaultMessage:"Marketing"}):F.formatMessage({id:a||"unknown",defaultMessage:a||"-"});return(0,U.jsx)(m.Z,{color:n,children:r})},hideInSearch:!0},{title:F.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:F.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){if((null==t?void 0:t.type)===S.Qeb){var a,n,r=!(null==t||null===(a=t.llm)||void 0===a||!a.textModel);return(0,U.jsx)("a",{onClick:function(){xe?(J(t),z(!0)):ke("robot.permission.update.denied","无权限：编辑机器人")},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(n=t.llm)||void 0===n?void 0:n.textModel)||F.formatMessage({id:"robot.llm.configured",defaultMessage:"模型已配置"}):F.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"未配置模型，点击配置"})})}return null!=t&&t.settings?(0,U.jsx)("a",{onClick:function(){xe?(J(t),z(!0)):ke("robot.permission.update.denied","无权限：编辑机器人")},children:t.settings.name||F.formatMessage({id:"robot.settings.configured",defaultMessage:"已配置"})}):(0,U.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){xe?(J(t),z(!0)):ke("robot.permission.update.denied","无权限：编辑机器人")},children:F.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:F.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(e,t){var a,n=null==t||null===(a=t.llm)||void 0===a?void 0:a.prompt;return n?(0,U.jsx)("a",{onClick:function(){Me?(re(n),ie(t),ee(!0)):ke("robot.permission.read.denied","无权限：查看机器人")},children:F.formatMessage({id:"view",defaultMessage:"查看"})}):"-"}},{title:F.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"文本模型提供商"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var a,n,r=null==t||null===(a=t.llm)||void 0===a?void 0:a.textProviderUid;return r&&ce[r]?ce[r]:(null==t||null===(n=t.llm)||void 0===n?void 0:n.textProvider)||"-"}},{title:F.formatMessage({id:"pages.prompt.model",defaultMessage:"模型"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var a;return(null==t||null===(a=t.llm)||void 0===a?void 0:a.textModel)||"-"}},{title:F.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,t){var a;return null!=t&&null!==(a=t.llm)&&void 0!==a&&a.enabled?"是":"否"}},{title:F.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库搜索结果为空时用LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,t){var a;return null!=t&&null!==(a=t.llm)&&void 0!==a&&a.useLlmWhenKbEmpty?"是":"否"}},{title:F.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:F.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var a,n,r;return 0===(null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)?"0":null!==(n=null==t||null===(r=t.llm)||void 0===r?void 0:r.temperature)&&void 0!==n?n:"-"}},{title:F.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var a,n;return null!==(a=null==t||null===(n=t.llm)||void 0===n?void 0:n.topK)&&void 0!==a?a:"-"}},{title:F.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"知识库启用"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"是":"否"}},{title:F.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"是":"否"}},{title:F.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,t){var a,n=null==t||null===(a=t.llm)||void 0===a?void 0:a.searchType;return n===S.ccx?"全文":n===S.DGp?"向量":n===S.rk3?"混合":null!=n?n:"-"}},{title:F.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,t){var a=null==t?void 0:t.kbUid;return a?me[a]||a:"-"}},{title:F.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:F.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:F.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){var a=[];return Me&&(a.push((0,U.jsx)("a",{onClick:function(){return function(e){var t;if(Me)if(e&&e.uid){var a={chatConfig:{org:null==D?void 0:D.uid,t:S.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}else M.yw.error(F.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}));else ke("robot.permission.read.denied","无权限：查看机器人")}(t)},children:F.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test")),a.push((0,U.jsx)("a",{onClick:function(){return f.history.push("/service/channel")},children:F.formatMessage({id:"robot.get.code",defaultMessage:"获取机器人代码"})},"code"))),xe&&a.push((0,U.jsx)("a",{onClick:function(){J(t),z(!0)},children:F.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")),ye&&a.push((0,U.jsx)(v.Z,{title:F.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(F.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:i()(o()().mark((function e(){var a,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye){e.next=3;break}return ke("robot.permission.delete.denied","无权限：删除机器人"),e.abrupt("return");case 3:return M.yw.loading(F.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=4,e.next=7,(0,b.gf)(t);case 7:a=e.sent,M.yw.destroy(),200===(null==a?void 0:a.code)?(M.yw.success(F.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=K.current)||void 0===n||n.reload()):M.yw.error((null==a?void 0:a.message)||"Delete failed"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),M.yw.destroy(),M.yw.error("Delete error");case 16:case"end":return e.stop()}}),e,null,[[4,12]])}))),okText:F.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:F.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,U.jsx)("a",{children:F.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),a}},{title:F.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(g.Z,{columns:Se,actionRef:K,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){var e=[];return be&&e.push((0,U.jsx)(h.ZP,{type:"primary",onClick:function(){be?(J(null),V(!0)):ke("robot.permission.create.denied","无权限：创建机器人")},children:F.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")),e},request:function(){var e=i()(o()().mark((function e(t,a){var n,s,l,i,d,c,f,g,p,m,v,h,M,x,y,w,k,j,C,I,T,U,E;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Me){e.next=3;break}return we.current||(we.current=!0,ke("robot.permission.read.denied","无权限：查看机器人")),e.abrupt("return",{data:[],total:0,success:!1});case 3:return i=(null!==(n=null==t?void 0:t.current)&&void 0!==n?n:1)-1,d=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,c=null!==(l=null==t?void 0:t.searchText)&&void 0!==l?l:"",f=R,(m=Object.entries(a||{})).length>0&&(v=m[0],h=u()(v,2),M=h[0],(x=h[1])&&(g=M,p="ascend"===x?"ascend":"descend")),y=r()(r()({pageNumber:i,pageSize:d,categoryUid:"",level:S.whQ,type:f,orgUid:null==D?void 0:D.uid,searchText:c,superUser:P},g?{sortBy:g}:{}),p?{sortDirection:p}:{}),e.prev=10,e.next=13,(0,b.p0)(y);case 13:if(w=e.sent,Z.Z.debug("RobotTable queryRobotsByOrg response:",w,y),200!==(null==w?void 0:w.code)){e.next=19;break}return U=(null==w||null===(k=w.data)||void 0===k?void 0:k.content)||[],E=null!==(j=null!==(C=null==w||null===(I=w.data)||void 0===I?void 0:I.totalElements)&&void 0!==C?C:null==w||null===(T=w.data)||void 0===T?void 0:T.numberOfElements)&&void 0!==j?j:U.length,e.abrupt("return",{data:U,total:E,success:!0});case 19:return e.abrupt("return",{data:[],total:0,success:!1});case 22:return e.prev=22,e.t0=e.catch(10),e.abrupt("return",{data:[],total:0,success:!1});case 25:case"end":return e.stop()}}),e,null,[[10,22]])})));return function(t,a){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:F.formatMessage({id:"robot",defaultMessage:"Robot"})}),Q&&(0,U.jsx)(j.Z,{open:Q,record:_,onClose:function(){return z(!1)},onSuccess:function(){var e;return null===(e=K.current)||void 0===e?void 0:e.reload()}}),W&&(0,U.jsx)(C.Z,{open:W,onClose:function(){return V(!1)},defaultType:R,onSubmit:function(){var e=i()(o()().mark((function e(t){var a,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be){e.next=3;break}return ke("robot.permission.create.denied","无权限：创建机器人"),e.abrupt("return");case 3:return M.yw.loading(F.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=4,e.next=7,(0,b.lg)(t);case 7:a=e.sent,M.yw.destroy(),200===(null==a?void 0:a.code)?(M.yw.success(F.formatMessage({id:"create.success",defaultMessage:"Create success"})),V(!1),null===(n=K.current)||void 0===n||n.reload()):M.yw.error((null==a?void 0:a.message)||F.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),M.yw.destroy(),M.yw.error(F.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()}),(0,U.jsx)(E,{open:$,record:le,value:ne,onClose:function(){return ee(!1)},onSaved:function(){var e;ee(!1),ie(null),null===(e=K.current)||void 0===e||e.reload()}})]})}}}]);