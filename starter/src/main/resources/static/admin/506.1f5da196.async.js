"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[506],{35912:function(e,t,n){n.d(t,{$l:function(){return h},M8:function(){return y},Xd:function(){return x},gf:function(){return k},lg:function(){return f},lz:function(){return v},p0:function(){return d}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),u=n(89933),i=n.n(u),c=n(6844),l=n(19736);function d(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/query/org",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/create",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/avatar",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/kbUid",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return w.apply(this,arguments)}function w(){return(w=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/prompt/text",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},29195:function(e,t,n){n.d(t,{KF:function(){return x},VW:function(){return d},ZJ:function(){return f},r$:function(){return v},sK:function(){return h}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),u=n(89933),i=n.n(u),c=n(6844),l=n(19736);function d(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/settings/query/org",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/settings/create",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/settings/update",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/settings/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/settings/publish",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},68972:function(e,t,n){var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),u=n(89933),i=n.n(u),c=n(45332),l=n.n(c),d=n(44194),p=n(58867),f=n(46141),m=n(48769),h=n(65513),g=n(19736),v=n(93527),b=n(29195),x=n(31549);t.Z=function(e){var t=e.open,n=e.onOpenChange,r=e.orgUid,s=e.record,u=e.onSuccess,c=(0,g.useIntl)(),M=p.Z.useForm(),y=l()(M,1)[0];(0,d.useEffect)((function(){var e,n;t&&(s?y.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(y.resetFields(),y.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,y]);var w=function(){var e=i()(a()().mark((function e(){var t,i,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.validateFields();case 3:if(t=e.sent,i=o()(o()({},t),{},{orgUid:r,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,b.sK)(i);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,b.ZJ)(i);case 13:e.t0=e.sent;case 14:(l=e.t0)&&200===l.code?(v.yw.success(c.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==u||u(),n(!1)):v.yw.error((null==l?void 0:l.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,x.jsx)(f.Z,{title:(0,x.jsx)(g.FormattedMessage,{id:null!=s&&s.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:w,onCancel:function(){return n(!1)},okText:(0,x.jsx)(g.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,x.jsx)(g.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,x.jsxs)(p.Z,{form:y,layout:"vertical",preserve:!1,children:[(0,x.jsx)(p.Z.Item,{name:"name",label:(0,x.jsx)(g.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:c.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,x.jsx)(m.Z,{placeholder:c.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,x.jsx)(p.Z.Item,{name:"description",label:(0,x.jsx)(g.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,x.jsx)(m.Z.TextArea,{rows:3,placeholder:c.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,x.jsx)(p.Z.Item,{name:"enabled",label:(0,x.jsx)(g.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,x.jsx)(h.Z,{})})]})})}},95702:function(e,t,n){var r=n(90819),a=n.n(r),s=n(89933),o=n.n(s),u=n(45332),i=n.n(u),c=n(14888),l=n(6844),d=n(30064),p=n(86684),f=n(68263),m=n(19736),h=n(46141),g=n(58867),v=n(65100),b=n(3925),x=n(9428),M=n(29589),y=n(44194),w=n(29195),k=n(68972),j=n(10162),S=n(54605),Z=n(59908),F=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=(0,m.useIntl)(),u=d.A.useForm(),q=i()(u,1)[0],C=(0,c.u)((function(e){return e.currentOrg})),O=(0,y.useState)(!1),T=i()(O,2),P=T[0],U=T[1],J=(0,y.useState)(!1),X=i()(J,2),E=X[0],V=X[1],I=(0,y.useState)(0),R=i()(I,2),A=R[0],N=R[1],z=(0,y.useState)([]),D=i()(z,2),G=D[0],K=D[1],W=(0,y.useState)([]),B=i()(W,2),Q=B[0],$=B[1],H=(0,y.useState)(""),L=i()(H,2),Y=L[0],_=L[1],ee=(0,y.useCallback)(function(){var e=o()(a()().mark((function e(t){var n,r,s,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==C?void 0:C.uid,searchText:t||""},e.next=5,(0,w.VW)(r);case 5:return s=e.sent,console.log("queryRobotSettingsByOrg response:",s,r),o=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],K(o),!q.getFieldValue("settingsUid")&&o.length>0&&q.setFieldsValue({settingsUid:o[0].uid}),u=o.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),$(u),e.abrupt("return",u);case 13:return e.prev=13,V(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==C?void 0:C.uid,q]);(0,y.useEffect)((function(){t&&ee()}),[t,A,ee]);var te=function(){console.log("handleSaveRobot"),q.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==C?void 0:C.uid,avatar:e.avatar||Y};console.log("robotObject:",t),r(t),q.resetFields(),_("")})).catch((function(e){console.log("Form errors:",e)}))};(0,y.useEffect)((function(){console.log("RobotForm useEffect"),t&&(q.resetFields(),q.setFieldsValue({type:l.f4h}),_(""))}),[t,q]);var ne=function(){var e=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),_(t),q.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,F.jsx)("div",{children:(0,F.jsxs)(h.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:te,onCancel:function(){q.resetFields(),n()},children:[(0,F.jsxs)(d.A,{form:q,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,F.jsx)(g.Z.Item,{name:"avatarUpload",label:s.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,F.jsxs)(S.G,{onSuccess:ne,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,F.jsx)(v.Z,{src:Y}),(0,F.jsx)(b.ZP,{icon:(0,F.jsx)(Z.Z,{}),style:{marginLeft:12},children:s.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,F.jsx)(p.Z,{name:"avatar",hidden:!0}),(0,F.jsx)(d.A.Item,{label:s.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:s.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,F.jsxs)(x.Z.Compact,{block:!0,children:[(0,F.jsx)(M.Z,{showSearch:!0,allowClear:!0,placeholder:s.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),options:Q,loading:E,filterOption:!1,onSearch:function(e){return ee(e)},onFocus:function(){return ee()},notFoundContent:0===G.length?(0,F.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,F.jsx)("div",{style:{marginBottom:8,color:"#999"},children:s.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,F.jsx)(b.ZP,{size:"small",type:"primary",icon:(0,F.jsx)(j.Z,{}),onClick:function(){return U(!0)},children:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0}),(0,F.jsx)(b.ZP,{size:"small",icon:(0,F.jsx)(j.Z,{}),onClick:function(){return U(!0)},title:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:s.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,F.jsx)(p.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return te()}}}),(0,F.jsx)(f.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:l.f4h,defaultMessage:"Service"}),value:l.f4h},{label:s.formatMessage({id:l.Qeb,defaultMessage:"Chat"}),value:l.Qeb}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,F.jsx)(k.Z,{open:P,onOpenChange:U,orgUid:(null==C?void 0:C.uid)||"",record:null,onSuccess:function(){U(!1),N((function(e){return e+1}))}})]})})}}}]);