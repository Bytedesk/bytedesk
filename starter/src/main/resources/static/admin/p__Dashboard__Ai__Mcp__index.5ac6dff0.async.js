"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2804],{28031:function(e,t,r){r.d(t,{Z:function(){return l}});var a=r(83910),s=r(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=r(5901),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var l=s.forwardRef(o)},59853:function(e,t,r){var a=r(94433),s=r(38956),n=r(44194),i=r(46659),o=r(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],c=n.forwardRef((function(e,t){var r=e.fieldProps,n=e.unCheckedChildren,c=e.checkedChildren,d=e.proFieldProps,u=(0,s.Z)(e,l);return(0,o.jsx)(i.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:n,checkedChildren:c},r),ref:t,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},u))}));t.Z=c},26608:function(e,t,r){var a=r(94433),s=r(38956),n=r(44194),i=r(46659),o=r(31549),l=["fieldProps","proFieldProps"],c=function(e,t){var r=e.fieldProps,n=e.proFieldProps,c=(0,s.Z)(e,l);return(0,o.jsx)(i.Z,(0,a.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:n},c))};t.Z=n.forwardRef(c)},20441:function(e,t,r){r.r(t),r.d(t,{default:function(){return ae}});var a=r(88130),s=r(38552),n=r(68992),i=r(84176),o=r.n(i),l=r(73193),c=r.n(l),d=r(90819),u=r.n(d),p=r(89933),f=r.n(p),g=r(45332),m=r.n(g),v=r(54596),h=r(62954),M=r(72264),x=r(77902),y=r(6237),C=r(44194),S=r(62395),b=r(41881),w=r(83381),j=r(91768),Z=r(6992),k=r(28031),P=r(80503),T=r(45634),O=r.n(T),I=r(77643),U=r(77686),N=r(99754);function z(e){return J.apply(this,arguments)}function J(){return(J=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/mcp/server/query/org",{method:"GET",params:c()(c()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return F.apply(this,arguments)}function F(){return(F=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/mcp/server/create",{method:"POST",data:c()(c()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return E.apply(this,arguments)}function E(){return(E=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/mcp/server/update",{method:"POST",data:c()(c()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return H.apply(this,arguments)}function H(){return(H=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/mcp/server/delete",{method:"POST",data:c()(c()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=r(87005),V=r(89007),Y=r(50447),D=r(47268),L=r(26608),X=r(59853),G=r(41059),Q=r(89654),K=r(31549),W=function(e){var t=e.isEdit,r=e.mcpServer,a=e.open,s=e.level,n=e.onClose,i=e.onSubmit,o=V.A.useForm(),l=m()(o,1)[0],c=(0,S.useIntl)(),d=(0,U.u)((function(e){return e.currentOrg})),u=(0,I.v)((function(e){return e.currentCategory})),p=(0,I.v)((function(e){return e.categorySelectOptions}));(0,C.useEffect)((function(){if(t&&r&&l){var e={};if(r.serverConfig)try{e="string"==typeof r.serverConfig?JSON.parse(r.serverConfig):r.serverConfig}catch(e){console.error("Failed to parse serverConfig:",e)}l.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,serverType:null==r?void 0:r.type,status:null==r?void 0:r.status,enabled:null==r?void 0:r.enabled,categoryUid:(null==r?void 0:r.categoryUid)||(null==u?void 0:u.uid),serverConfig:JSON.stringify(e,null,2)})}else{l.resetFields();var a=p&&p.length>0?p[0].value:void 0;l.setFieldsValue({categoryUid:a,enabled:!0,status:"INACTIVE",serverConfig:JSON.stringify({serverVersion:"1.0.0",protocol:"http",connectionTimeout:3e4,readTimeout:6e4,maxRetries:3,autoStart:!1},null,2)})}}),[r,t,l,u,p]);return(0,K.jsx)(G.Z,{title:t?c.formatMessage({id:"pages.mcp.edit",defaultMessage:"编辑MCP服务器"}):c.formatMessage({id:"pages.mcp.create",defaultMessage:"创建MCP服务器"}),width:600,open:a,onClose:n,extra:(0,K.jsxs)(Q.Z,{children:[(0,K.jsx)(M.ZP,{onClick:n,children:c.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,K.jsx)(M.ZP,{type:"primary",onClick:function(){l.validateFields().then((function(e){var a;console.log("Form values:",e);var n={};if(e.serverConfig)try{n=JSON.parse(e.serverConfig)}catch(e){return void console.error("Invalid JSON in serverConfig:",e)}var o=p&&p.length>0?p[0].value:void 0,l={uid:t?null==r?void 0:r.uid:"",name:e.name,description:e.description,serverType:e.serverType,status:e.status,enabled:null===(a=e.enabled)||void 0===a||a,categoryUid:e.categoryUid||o,serverConfig:JSON.stringify(n),level:s,orgUid:null==d?void 0:d.uid};console.log("mcpServerObject:",l),i(l)})).catch((function(e){console.log("Form errors:",e)}))},children:c.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,K.jsxs)(V.A,{form:l,layout:"vertical",submitter:!1,children:[(0,K.jsx)(Y.Z,{name:"categoryUid",label:c.formatMessage({id:"pages.mcp.categoryUid",defaultMessage:"分类"}),placeholder:c.formatMessage({id:"pages.mcp.categoryUid.placeholder",defaultMessage:"请选择分类"}),tooltip:c.formatMessage({id:"pages.mcp.categoryUid.tooltip",defaultMessage:"MCP服务器所属分类"}),options:p,rules:[{required:!0,message:c.formatMessage({id:"pages.mcp.categoryUid.required",defaultMessage:"请选择分类"})}]}),(0,K.jsx)(D.Z,{name:"name",label:c.formatMessage({id:"pages.mcp.name",defaultMessage:"名称"}),placeholder:c.formatMessage({id:"pages.mcp.name.placeholder",defaultMessage:"请输入MCP服务器名称"}),rules:[{required:!0,message:c.formatMessage({id:"pages.mcp.name.required",defaultMessage:"请输入名称"})}]}),(0,K.jsx)(L.Z,{name:"description",label:c.formatMessage({id:"pages.mcp.description",defaultMessage:"描述"}),placeholder:c.formatMessage({id:"pages.mcp.description.placeholder",defaultMessage:"请输入MCP服务器描述"}),rows:3}),(0,K.jsx)(L.Z,{name:"serverConfig",label:c.formatMessage({id:"pages.mcp.serverConfig",defaultMessage:"服务器配置"}),placeholder:c.formatMessage({id:"pages.mcp.serverConfig.placeholder",defaultMessage:"请输入JSON格式的服务器配置"}),rows:20,tooltip:c.formatMessage({id:"pages.mcp.serverConfig.tooltip",defaultMessage:"包含服务器版本、URL、认证、超时、能力等配置的JSON字符串"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();try{return JSON.parse(t),Promise.resolve()}catch(e){return Promise.reject(new Error(c.formatMessage({id:"mcp.serverConfig.validation.json",defaultMessage:"请输入有效的JSON格式"})))}}}]}),(0,K.jsx)(X.Z,{name:"enabled",label:c.formatMessage({id:"pages.mcp.enabled",defaultMessage:"启用状态"}),checkedChildren:c.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:c.formatMessage({id:"disabled",defaultMessage:"禁用"}),initialValue:!0})]})})},$=r(61489),_=r(46130),ee=["current","pageSize","prompt"],te=function(e){var t=e.level,r=(e.type,(0,C.useRef)()),a=(0,S.useIntl)(),s=(0,C.useState)(!0),i=m()(s,2),l=i[0],d=i[1],p=(0,N.Z)().translateString,g=(0,C.useState)(1),T=m()(g,2),J=T[0],F=T[1],E=(0,C.useState)(10),H=m()(E,2),V=H[0],Y=H[1],D=(0,C.useState)(!1),L=m()(D,2),X=L[0],G=L[1],Q=(0,C.useState)([]),te=m()(Q,2),re=(te[0],te[1]),ae=(0,C.useState)({}),se=m()(ae,2),ne=se[0],ie=se[1],oe=(0,I.v)((function(e){return e.currentCategory})),le=(0,U.u)((function(e){return e.currentOrg})),ce=(0,C.useState)(0),de=m()(ce,2),ue=de[0],pe=de[1],fe=(0,C.useState)({}),ge=m()(fe,2),me=ge[0],ve=ge[1],he=function(){var e=f()(u()().mark((function e(t){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,R(t);case 3:200===(s=e.sent).code?($.yw.success(a.formatMessage({id:"delete.success"})),null===(n=r.current)||void 0===n||n.reload()):$.yw.error(s.message||a.formatMessage({id:"delete.error"}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=f()(u()().mark((function e(t){var s,n,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=7;break}return e.next=3,q(t);case 3:200===(s=e.sent).code?($.yw.success(a.formatMessage({id:"update.success"})),G(!1),null===(n=r.current)||void 0===n||n.reload()):$.yw.error(s.message||a.formatMessage({id:"update.error"})),e.next=11;break;case 7:return e.next=9,A(t);case 9:200===(i=e.sent).code?($.yw.success(a.formatMessage({id:"create.success"})),G(!1),null===(o=r.current)||void 0===o||o.reload()):$.yw.error(i.message||a.formatMessage({id:"create.error"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){d(!1),ie({}),G(!0)};(0,C.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.reload()}),[oe]);var ye=function(){var e=f()(u()().mark((function e(r,a,s){var i,o,l;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),i=localStorage.getItem(n.LA8),o=c()({categoryUid:(null==oe?void 0:oe.uid)===n.zBg?"":null==oe?void 0:oe.uid,orgUid:t===n.Hxq?"":null==le?void 0:le.uid,level:t,accessToken:i||"",exportType:r},me),"current"===r?(o.pageNumber=String(J-1),o.pageSize=String(V)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),l=Object.fromEntries(Object.entries(o).filter((function(e){var t=m()(e,2),r=(t[0],t[1]);return null!=r})).map((function(e){var t=m()(e,2),r=t[0],a=t[1];return[r,String(a)]}))),_.Z.debug("Export MCP Servers url:",(0,B.kG)()+"/api/v1/mcp/server/export?"+new URLSearchParams(l).toString()),window.open((0,B.kG)()+"/api/v1/mcp/server/export?"+new URLSearchParams(l).toString());case 7:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),Ce=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ye("range",a,r)}})},n=0;n<a;n++)s();return t},Se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:a.formatMessage({id:"pages.mcp.uid",defaultMessage:"UID"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",width:180,copyable:!0,ellipsis:!0},{title:a.formatMessage({id:"pages.mcp.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:200,copyable:!0,ellipsis:!0,tooltip:a.formatMessage({id:"pages.mcp.name.tooltip",defaultMessage:"MCP服务器的名称"})},{title:a.formatMessage({id:"pages.mcp.description",defaultMessage:"描述"}),dataIndex:"description",width:250,copyable:!0,ellipsis:!0,tooltip:a.formatMessage({id:"pages.mcp.description.tooltip",defaultMessage:"MCP服务器的功能描述"})},{title:a.formatMessage({id:"pages.mcp.enabled",defaultMessage:"启用状态"}),dataIndex:"enabled",hideInSearch:!0,width:100,tooltip:a.formatMessage({id:"pages.mcp.enabled.tooltip",defaultMessage:"是否启用该MCP服务器"}),render:function(e,t){return t.enabled?"已启用":"已禁用"}},{title:a.formatMessage({id:"pages.mcp.serverConfig",defaultMessage:"服务器配置"}),dataIndex:"serverConfig",hideInSearch:!0,width:200,ellipsis:!0,tooltip:a.formatMessage({id:"pages.mcp.serverConfig.tooltip",defaultMessage:"MCP服务器的配置信息"}),render:function(e,t){if(!t.serverConfig)return"-";try{var r="string"==typeof t.serverConfig?JSON.parse(t.serverConfig):t.serverConfig,a=[r.serverUrl&&"URL: ".concat(r.serverUrl),r.host&&"Host: ".concat(r.host),r.port&&"Port: ".concat(r.port)].filter(Boolean).join(", ");return(0,K.jsx)(h.Z,{title:(0,K.jsx)("pre",{children:JSON.stringify(r,null,2)}),children:(0,K.jsx)("span",{children:a||"查看配置"})})}catch(e){return(0,K.jsx)(h.Z,{title:String(t.serverConfig),children:(0,K.jsx)("span",{children:"配置信息"})})}}},{title:a.formatMessage({id:"pages.mcp.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:a.formatMessage({id:"pages.mcp.createdAt.tooltip",defaultMessage:"MCP服务器创建的时间"}),render:function(e,t){return t.createdAt?O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:a.formatMessage({id:"pages.mcp.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:a.formatMessage({id:"pages.mcp.updatedAt.tooltip",defaultMessage:"MCP服务器最后更新的时间"}),render:function(e,t){return t.updatedAt?O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:a.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:a.formatMessage({id:"pages.mcp.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,K.jsx)(h.Z,{title:a.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,K.jsx)(M.ZP,{type:"text",size:"small",icon:(0,K.jsx)(b.Z,{}),onClick:function(){return function(e){d(!0),ie(e),G(!0)}(t)}})},"edit"),(0,K.jsx)(x.Z,{title:a.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(p(t.name),"】？"),onConfirm:function(){return he(t)},okText:a.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:a.formatMessage({id:"cancel",defaultMessage:"取消"}),icon:(0,K.jsx)(w.Z,{style:{color:"red"}}),children:(0,K.jsx)(h.Z,{title:a.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,K.jsx)(M.ZP,{type:"text",size:"small",danger:!0,icon:(0,K.jsx)(j.Z,{})})})},"delete")]}}],be=function(){var e=f()(u()().mark((function e(r,s,i){var l,d,p,f,g,m,v,h,M,x,y,C;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.current,r.pageSize,r.prompt,l=o()(r,ee),ve({name:r.name,description:r.description}),d=r.current?r.current-1:0,p=r.pageSize||10,F(r.current||1),Y(p),f="createdAt",g="desc",s&&Object.keys(s).length>0&&(m=Object.keys(s)[0],f=m,g="ascend"===s[m]?"asc":"desc"),v=c()({pageNumber:d,pageSize:p,sortBy:f,sortDirection:g,level:t,orgUid:null==le?void 0:le.uid,categoryUid:(null==oe?void 0:oe.uid)===n.zBg?"":null==oe?void 0:oe.uid},l),e.prev=10,e.next=13,z(v);case 13:if(h=e.sent,_.Z.debug("queryMcpServersByOrg:",h,v),200!==h.code){e.next=22;break}return C=(null===(M=h.data)||void 0===M?void 0:M.content)||[],re(C),pe((null===(x=h.data)||void 0===x?void 0:x.totalElements)||0),e.abrupt("return",{data:C,success:!0,total:(null===(y=h.data)||void 0===y?void 0:y.totalElements)||0});case 22:return $.yw.error(h.message||a.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 24:e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(10),console.error("查询MCP服务器失败:",e.t0),$.yw.error(a.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 31:case"end":return e.stop()}}),e,null,[[10,26]])})));return function(t,r,a){return e.apply(this,arguments)}}();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(v.Z,{headerTitle:a.formatMessage({id:"pages.mcp.title",defaultMessage:"MCP服务器管理"}),actionRef:r,rowKey:"uid",search:{labelWidth:"auto"},toolBarRender:function(){return e=[(0,K.jsx)(M.ZP,{type:"primary",icon:(0,K.jsx)(Z.Z,{}),onClick:xe,children:a.formatMessage({id:"create.mcp",defaultMessage:"新建MCP服务器"})},"create")],t=[{key:"export-current",icon:(0,K.jsx)(k.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}],ue>0&&(ue<=1e3?t.push({key:"export-all",icon:(0,K.jsx)(k.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ue,"条)"),onClick:function(){return ye("all")}}):t.push({key:"export-range",icon:(0,K.jsx)(k.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ue,"条)"),children:Ce(ue)})),e.push((0,K.jsx)(y.Z,{menu:{items:t},placement:"bottom",children:(0,K.jsxs)(M.ZP,{type:"primary",icon:(0,K.jsx)(k.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"导出"}),(0,K.jsx)(P.Z,{})]})},"export")),e;var e,t},request:be,columns:Se,scroll:{x:"max-content"},pagination:{pageSize:V,current:J,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e," ").concat(a.formatMessage({id:"items",defaultMessage:"条"}))}},options:{setting:{listsHeight:400}},size:"small"}),X&&(0,K.jsx)(W,{isEdit:l,mcpServer:ne,open:X,level:t,onClose:function(){return G(!1)},onSubmit:Me})]})},re=r(92066),ae=function(){var e=(0,s.Z)(),t=e.leftSiderStyle,r=e.contentStyle;return(0,K.jsxs)(a.Z,{style:{height:"100%"},children:[(0,K.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,K.jsx)(re.Z,{type:n.hnV,level:n.whQ,showKbase:!1})}),(0,K.jsx)(a.Z.Panel,{style:r,children:(0,K.jsx)(te,{level:n.whQ})})]})}}}]);