"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9604],{78135:function(e,t,r){r.d(t,{EA:function(){return l},Gc:function(){return m},S8:function(){return f},jn:function(){return h}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(68992),u=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/delete",{method:"POST",data:{uid:t,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},41381:function(e,t,r){r.d(t,{$T:function(){return f},Fx:function(){return l},QE:function(){return h},ic:function(){return m}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(68992),u=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/delete",{method:"POST",data:{uid:t,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},60028:function(e,t,r){r.d(t,{Lp:function(){return m},Pn:function(){return h},c5:function(){return v},ln:function(){return f},p:function(){return l}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(68992),u=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/query/org",{method:"GET",params:i()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete/all",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},29049:function(e,t,r){r.d(t,{bU:function(){return m},eT:function(){return l},oH:function(){return h},x:function(){return f}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(68992),u=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},80738:function(e,t,r){r.d(t,{A_:function(){return h},PJ:function(){return f},mY:function(){return m},vf:function(){return l}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(68992),u=r(62395);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/update/tagList",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95091:function(e,t,r){r.d(t,{Z:function(){return X}});var a=r(84176),s=r.n(a),n=r(73193),i=r.n(n),o=r(90819),c=r.n(o),d=r(89933),u=r.n(d),l=r(45332),p=r.n(l),f=r(61489),g=r(66248),m=r(29049),x=r(77686),h=r(87005),M=r(68992),v=r(83381),b=r(43837),j=r(41881),k=r(91768),y=r(28031),w=r(6992),F=r(80503),S=r(54596),I=r(62395),Z=r(33633),T=r(89654),A=r(62954),L=r(72264),P=r(6237),U=r(45634),C=r.n(U),O=r(44194),N=r(89007),R=r(47268),B=r(26608),E=r(70878),Y=r(69650),q=r(41059),D=r(31549),z=function(e){var t,r=e.isEdit,a=e.browse,s=e.open,n=e.onClose,o=e.onSubmit,c=(0,I.useIntl)(),d=E.Z.useForm(),u=p()(d,1)[0],l=Y.Z.Text;(0,O.useEffect)((function(){var e;s&&(r&&a?u.setFieldsValue({url:a.url||"",title:a.title||"",referrer:a.referrer||"",ipAddress:a.ipAddress||"",deviceType:a.deviceType||"",operatingSystem:a.operatingSystem||"",browser:a.browser||"",screenResolution:a.screenResolution||"",duration:a.duration||"",pageLoadTime:a.pageLoadTime||"",geoLocation:a.geoLocation||"",sessionId:a.sessionId||"",userAgent:a.userAgent||"",utmSource:a.utmSource||"",utmMedium:a.utmMedium||"",utmCampaign:a.utmCampaign||"",status:(null===(e=a.visitor)||void 0===e?void 0:e.status)||"",eventData:a.eventData||""}):u.resetFields())}),[s,r,a,u]);var f=r?c.formatMessage({id:"browse.edit",defaultMessage:"编辑客户"}):c.formatMessage({id:"browse.create",defaultMessage:"新增客户"}),g=a&&!r,m=g?null:(0,D.jsxs)(T.Z,{children:[(0,D.jsx)(L.ZP,{onClick:n,children:(0,D.jsx)(I.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,D.jsx)(L.ZP,{type:"primary",onClick:function(){u.validateFields().then((function(e){var t=i()(i()({},e),r&&a?{uid:a.uid}:{});o(t)}))},children:(0,D.jsx)(I.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)(q.Z,{title:f,onClose:n,open:s,width:500,extra:m,children:g&&a?(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"url",defaultMessage:"URL"}),":"]})," ",a.url||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"title",defaultMessage:"标题"}),":"]})," ",a.title||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),":"]})," ",a.referrer||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),":"]})," ",a.ipAddress||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),":"]})," ",a.deviceType||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"}),":"]})," ",a.operatingSystem||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),":"]})," ",a.browser||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),":"]})," ",a.screenResolution||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),":"]})," ",a.duration?"".concat(a.duration,"秒"):"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间"}),":"]})," ",a.pageLoadTime?"".concat(a.pageLoadTime,"毫秒"):"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),":"]})," ",a.geoLocation||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"}),":"]})," ",a.sessionId||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"}),":"]})," ",a.userAgent||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"}),":"]})," ",a.utmSource||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"}),":"]})," ",a.utmMedium||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"}),":"]})," ",a.utmCampaign||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),":"]})," ",(null===(t=a.visitor)||void 0===t?void 0:t.status)||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),":"]})," ",a.eventData||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",a.createdAt||"-"]}),(0,D.jsxs)("div",{style:{marginBottom:16},children:[(0,D.jsxs)(l,{strong:!0,children:[(0,D.jsx)(I.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",a.updatedAt||"-"]})]}):(0,D.jsxs)(N.A,{form:u,name:"browseForm",submitter:!1,children:[(0,D.jsx)(R.Z,{name:"url",label:(0,D.jsx)(I.FormattedMessage,{id:"url",defaultMessage:"URL"}),rules:[{required:!0,message:"请输入访问的URL"}]}),(0,D.jsx)(R.Z,{name:"title",label:(0,D.jsx)(I.FormattedMessage,{id:"title",defaultMessage:"标题"}),rules:[{required:!0,message:"请输入页面标题"}]}),(0,D.jsx)(R.Z,{name:"referrer",label:(0,D.jsx)(I.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),placeholder:"来源页面URL"}),(0,D.jsx)(R.Z,{name:"ipAddress",label:(0,D.jsx)(I.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"})}),(0,D.jsx)(R.Z,{name:"deviceType",label:(0,D.jsx)(I.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),placeholder:"desktop/mobile/tablet"}),(0,D.jsx)(R.Z,{name:"operatingSystem",label:(0,D.jsx)(I.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"})}),(0,D.jsx)(R.Z,{name:"browser",label:(0,D.jsx)(I.FormattedMessage,{id:"browser",defaultMessage:"浏览器"})}),(0,D.jsx)(R.Z,{name:"screenResolution",label:(0,D.jsx)(I.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),placeholder:"如 1920x1080"}),(0,D.jsx)(R.Z,{name:"duration",label:(0,D.jsx)(I.FormattedMessage,{id:"duration",defaultMessage:"停留时长(秒)"}),fieldProps:{type:"number"}}),(0,D.jsx)(R.Z,{name:"pageLoadTime",label:(0,D.jsx)(I.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间(毫秒)"}),fieldProps:{type:"number"}}),(0,D.jsx)(R.Z,{name:"geoLocation",label:(0,D.jsx)(I.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"})}),(0,D.jsx)(R.Z,{name:"sessionId",label:(0,D.jsx)(I.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"})}),(0,D.jsx)(B.Z,{name:"userAgent",label:(0,D.jsx)(I.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"})}),(0,D.jsx)(R.Z,{name:"utmSource",label:(0,D.jsx)(I.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"})}),(0,D.jsx)(R.Z,{name:"utmMedium",label:(0,D.jsx)(I.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"})}),(0,D.jsx)(R.Z,{name:"utmCampaign",label:(0,D.jsx)(I.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"})}),(0,D.jsx)(R.Z,{name:"status",label:(0,D.jsx)(I.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),placeholder:"默认为 ONLINE"}),(0,D.jsx)(B.Z,{name:"eventData",label:(0,D.jsx)(I.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),placeholder:"JSON格式的事件信息"})]})})})},J=["current","pageSize"],H=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(I.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(I.FormattedMessage,{id:"url",defaultMessage:"URL"}),dataIndex:"url",copyable:!0,ellipsis:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.url.tooltip",defaultMessage:"访问的URL地址"}),render:function(e,t){return t.url?(0,D.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.url}):"-"}},{title:(0,D.jsx)(I.FormattedMessage,{id:"title",defaultMessage:"标题"}),dataIndex:"title",ellipsis:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.title.tooltip",defaultMessage:"页面标题"})},{title:(0,D.jsx)(I.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),dataIndex:"referrer",ellipsis:!0,hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.referrer.tooltip",defaultMessage:"来源页面URL"}),render:function(e,t){return t.referrer?(0,D.jsx)("a",{href:t.referrer,target:"_blank",rel:"noopener noreferrer",children:t.referrer}):"-"}},{title:(0,D.jsx)(I.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),dataIndex:"deviceType",hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.deviceType.tooltip",defaultMessage:"设备类型(desktop/mobile/tablet)"})},{title:(0,D.jsx)(I.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),dataIndex:"browser",hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.browser.tooltip",defaultMessage:"浏览器类型"})},{title:(0,D.jsx)(I.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),dataIndex:"duration",hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.duration.tooltip",defaultMessage:"停留时长(秒)"}),render:function(e,t){return t.duration?"".concat(t.duration,"秒"):"-"}},{title:(0,D.jsx)(I.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),dataIndex:"ipAddress",copyable:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.ipAddress.tooltip",defaultMessage:"访客IP地址"})},{title:(0,D.jsx)(I.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),dataIndex:"geoLocation",hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.geoLocation.tooltip",defaultMessage:"访客地理位置"})},{title:(0,D.jsx)(I.FormattedMessage,{id:"status",defaultMessage:"状态"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.status.tooltip",defaultMessage:"访客状态"}),render:function(e,t){var r,a,s;return"ONLINE"===(null===(r=t.visitor)||void 0===r?void 0:r.status)?(0,D.jsx)(Z.Z,{color:"green",children:(0,D.jsx)(I.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===(null===(a=t.visitor)||void 0===a?void 0:a.status)?(0,D.jsx)(Z.Z,{color:"red",children:(0,D.jsx)(I.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===(null===(s=t.visitor)||void 0===s?void 0:s.status)?(0,D.jsx)(Z.Z,{color:"black",children:(0,D.jsx)(I.FormattedMessage,{id:"visitor.status.blocked"})}):(0,D.jsx)(Z.Z,{color:"default",children:(0,D.jsx)(I.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,D.jsx)(I.FormattedMessage,{id:"createdAt",defaultMessage:"访问时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(I.FormattedMessage,{id:"browse.createdAt.tooltip",defaultMessage:"访问时间"}),render:function(e,t,r,a){return C()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],X=function(e){var t=e.superUser,r=(0,I.useIntl)(),a=(0,O.useRef)(),n=(0,O.useState)(1),o=p()(n,2),d=o[0],l=o[1],Z=(0,O.useState)(10),U=p()(Z,2),C=U[0],N=U[1],R=(0,x.u)((function(e){return e.currentOrg})),B=(0,O.useState)({}),E=p()(B,2),Y=E[0],q=E[1],X=(0,O.useState)(0),G=p()(X,2),K=G[0],V=G[1],Q=(0,O.useState)([]),W=p()(Q,2),$=W[0],_=W[1],ee=(0,O.useState)([]),te=p()(ee,2),re=(te[0],te[1]),ae=(0,O.useState)(!1),se=p()(ae,2),ne=se[0],ie=se[1],oe=(0,O.useState)(!1),ce=p()(oe,2),de=ce[0],ue=ce[1],le=(0,O.useState)(),pe=p()(le,2),fe=pe[0],ge=pe[1],me=function(){var e=u()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!de||!fe){e.next=7;break}return e.next=4,(0,m.bU)(i()(i()({},t),{},{uid:fe.uid,orgUid:null==R?void 0:R.uid}));case 4:s=e.sent,e.next=10;break;case 7:return e.next=9,(0,m.x)(i()(i()({},t),{},{orgUid:null==R?void 0:R.uid}));case 9:s=e.sent;case 10:200===s.code?(f.yw.success(de?r.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):r.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),ie(!1),null===(n=a.current)||void 0===n||n.reload()):f.yw.error(s.message||r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),f.yw.error(r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),xe=function(){ge(void 0),ue(!1),ie(!0)},he=[].concat(H,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,t){return(0,D.jsxs)(T.Z,{children:[(0,D.jsx)(A.Z,{title:r.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,D.jsx)(L.ZP,{type:"text",icon:(0,D.jsx)(b.Z,{}),onClick:function(){return function(e){ge(e),ue(!1),ie(!0)}(t)}})}),(0,D.jsx)(A.Z,{title:r.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,D.jsx)(L.ZP,{type:"text",icon:(0,D.jsx)(j.Z,{}),onClick:function(){return function(e){ge(e),ue(!0),ie(!0)}(t)}})}),(0,D.jsx)(A.Z,{title:r.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,D.jsx)(L.ZP,{type:"text",danger:!0,icon:(0,D.jsx)(k.Z,{}),onClick:function(){return function(e){var t;g.Z.confirm({title:r.formatMessage({id:"browse.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,D.jsx)(v.Z,{}),content:r.formatMessage({id:"browse.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(t=u()(c()().mark((function t(){var s,n;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,m.oH)({uid:e.uid,orgUid:null==R?void 0:R.uid});case 3:200===(s=t.sent).code?(f.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=a.current)||void 0===n||n.reload()):f.yw.error(s.message||r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("删除客户出错:",t.t0),f.yw.error(r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(){return t.apply(this,arguments)})})}(t)}})})]})}}]),Me=function(){var e=u()(c()().mark((function e(t,r,a){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,r,a),s=localStorage.getItem(M.LA8),n=i()({orgUid:(null==R?void 0:R.uid)||"",accessToken:s||"",exportType:t},Y),"current"===t?(n.pageNumber=String(d-1),n.pageSize=String(C)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==r&&void 0!==a&&(n.pageNumber=String(r),n.pageSize=String(a)),window.open((0,h.kG)()+"/api/v1/browse/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return Me("range",a,r)}})},n=0;n<a;n++)s();return t},be={selectedRowKeys:$,onChange:function(e,t){_(e),re(t)}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(S.Z,{columns:he,actionRef:a,cardBordered:!0,rowSelection:be,scroll:{x:2500},request:function(){var e=u()(c()().mark((function e(r,a,n){var o,d,u,p,g,x,h,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,u=s()(r,J),l(o),N(d),q(u),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,g="ascend"===a[x]?"ascend":"descend"),h=i()(i()({pageNumber:o-1,pageSize:d,orgUid:null==R?void 0:R.uid,superUser:t},u),{},{sortBy:p,sortDirection:g}),e.next=10,(0,m.eT)(h);case 10:return M=e.sent,console.log("queryBrowsesByOrg response:",M,h),200===M.code?V(M.data.totalElements):f.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),N(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"浏览列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,D.jsx)(y.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}],K>0&&(K<=1e3?e.push({key:"export-all",icon:(0,D.jsx)(y.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(K,"条)"),onClick:function(){return Me("all")}}):e.push({key:"export-range",icon:(0,D.jsx)(y.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(K,"条)"),children:ve(K)})),[(0,D.jsx)(L.ZP,{type:"primary",icon:(0,D.jsx)(w.Z,{}),onClick:xe,children:r.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,D.jsx)(P.Z,{menu:{items:e},placement:"bottom",children:(0,D.jsxs)(L.ZP,{type:"primary",icon:(0,D.jsx)(y.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,D.jsx)(F.Z,{})]})},"exportOperations")];var e}}),(0,D.jsx)(z,{isEdit:de,browse:fe,open:ne,onClose:function(){return ie(!1)},onSubmit:me})]})}},70527:function(e,t,r){r.d(t,{Z:function(){return E}});var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),c=r.n(o),d=r(10154),u=r.n(d),l=r(73193),p=r.n(l),f=r(89933),g=r.n(f),m=r(45332),x=r.n(m),h=r(61489),M=r(68992),v=r(62395);function b(e){return j.apply(this,arguments)}function j(){return(j=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/query/org",{method:"GET",params:p()(p()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return y.apply(this,arguments)}function y(){return(y=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/delete",{method:"POST",data:{uid:t,channel:M.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(77686),F=r(87005),S=r(91768),I=r(80503),Z=r(28031),T=r(54596),A=r(77902),L=r(72264),P=r(66248),U=r(6237),C=r(45634),O=r.n(C),N=r(44194),R=r(31549),B=["current","pageSize"],E=function(e){var t=e.superUser,r=(0,v.useIntl)(),a=(0,N.useRef)(),n=(0,w.u)((function(e){return e.currentOrg})),o=(0,N.useState)(1),d=x()(o,2),l=d[0],f=d[1],m=(0,N.useState)(10),j=x()(m,2),y=j[0],C=j[1],E=(0,N.useState)({}),Y=x()(E,2),q=Y[0],D=Y[1],z=(0,N.useState)(0),J=x()(z,2),H=J[0],X=J[1],G=(0,N.useState)([]),K=x()(G,2),V=K[0],Q=K[1],W=(0,N.useState)([]),$=x()(W,2),_=$[0],ee=$[1],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp"}),dataIndex:"blockIp",tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp.tooltip"}),valueEnum:{true:{text:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.yes"}),status:"Error"},false:{text:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.no"}),status:"Default"}}},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.reason"}),dataIndex:"reason",copyable:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.reason.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.startTime.tooltip"}),render:function(e,t){return t.startTime?O()(t.startTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.endTime.tooltip"}),render:function(e,t){return t.endTime?O()(t.endTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"message.createdAt.tooltip"}),render:function(e,t){return t.createdAt?O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],re=[].concat(te,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,R.jsx)(A.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.blackNickname,"】？"),onConfirm:function(){return se(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,R.jsx)(L.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackIp.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),ae=function(){var e=g()(c()().mark((function e(r,a,s){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),i=localStorage.getItem(M.LA8),o=p()({orgUid:t?"":(null==n?void 0:n.uid)||"",accessToken:i||"",exportType:r},Object.entries(q).reduce((function(e,t){var r=x()(t,2),a=r[0],s=r[1];return p()(p()({},e),{},u()({},a,"string"==typeof s?s:String(s)))}),{})),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(y)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,F.kG)()+"/api/v1/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),se=function(){var e=g()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,k(t.uid);case 4:s=e.sent,console.log("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),h.yw.success(r.formatMessage({id:"unblock.success"}))):h.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),h.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=g()(c()().mark((function e(){var t,s,n,o,d,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==_.length){e.next=3;break}return h.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:h.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()(_),e.prev=7,o.s();case 9:if((d=o.n()).done){e.next=23;break}return u=d.value,e.prev=11,e.next=14,k(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:h.yw.destroy(),0===n?h.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):h.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),Q([]),ee([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ie=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ae("range",a,r)}})},n=0;n<a;n++)s();return t},oe={selectedRowKeys:V,onChange:function(e,t){Q(e),ee(t)}};return(0,R.jsx)(T.Z,{columns:re,actionRef:a,cardBordered:!0,rowSelection:oe,scroll:{x:2e3},request:function(){var e=g()(c()().mark((function e(r,a,i){var o,d,u,l,g,m,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,u=s()(r,B),f(o),C(d),D(u),l=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],l=m,g="ascend"===a[m]?"ascend":"descend"),x=p()(p()({pageNumber:r.current-1,pageSize:d,orgUid:null==n?void 0:n.uid,superUser:t},u),{},{sortBy:l,sortDirection:g}),e.next=10,b(x);case 10:return M=e.sent,console.log("queryBlacks response:",M,x),200===M.code?X(M.data.totalElements):h.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),C(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.black.list"}),toolBarRender:function(){return function(){var e=[],t=[];V.length>0&&(t.push({key:"batchUnblock",icon:(0,R.jsx)(S.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(V.length,")"),onClick:function(){P.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(V.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:ne,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,R.jsx)(U.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(L.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",V.length,")",(0,R.jsx)(I.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,R.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ae("current")}}];return H>0&&(H<=1e3?a.push({key:"export-all",icon:(0,R.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(H,"条)"),onClick:function(){return ae("all")}}):a.push({key:"export-range",icon:(0,R.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(H,"条)"),children:ie(H)})),e.push((0,R.jsx)(U.Z,{menu:{items:a},placement:"bottom",children:(0,R.jsxs)(L.ZP,{type:"primary",icon:(0,R.jsx)(Z.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,R.jsx)(I.Z,{})]})},"exportOperations")),e}()}})}},12380:function(e,t,r){r.d(t,{Z:function(){return B}});var a=r(84176),s=r.n(a),n=r(90819),i=r.n(n),o=r(73193),c=r.n(o),d=r(89933),u=r.n(d),l=r(45332),p=r.n(l),f=r(61489),g=r(80738),m=r(77686),x=r(87005),h=r(68992),M=r(74039),v=r(28031),b=r(80503),j=r(54596),k=r(62395),y=r(33633),w=r(6237),F=r(72264),S=r(45634),I=r.n(S),Z=r(44194),T=r(70878),A=r(41059),L=r(89654),P=r(78380),U=r(60028),C=r(99754),O=r(31549),N=function(e){var t=e.open,r=e.onClose,a=e.onSubmit,s=e.visitor,n=e.orgUid,o=(0,k.useIntl)(),c=(0,C.Z)().translateString,d=T.Z.useForm(),l=p()(d,1)[0],m=(0,Z.useState)([]),x=p()(m,2),M=x[0],v=x[1],b=(0,Z.useState)(!1),j=p()(b,2),y=j[0],w=j[1],S=(0,Z.useMemo)((function(){var e;return 1===(null==s||null===(e=s.tagList)||void 0===e?void 0:e.length)&&""===s.tagList[0]?[]:(null==s?void 0:s.tagList)||[]}),[null==s?void 0:s.tagList]);(0,Z.useEffect)((function(){t&&n&&I()}),[t,n]),(0,Z.useEffect)((function(){t&&s&&l.setFieldsValue({tagList:S})}),[t,s,S,l]);var I=function(){var e=u()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,U.p)({orgUid:n,type:h.IuT});case 3:200===(t=e.sent).code?v(t.data.content||[]):f.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),f.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,w(!0),e.next=6,l.validateFields();case 6:return t=e.sent,e.next=9,(0,g.mY)({uid:s.uid,tagList:t.tagList||[],orgUid:s.orgUid});case 9:200===(n=e.sent).code?(f.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),a(),r()):f.yw.error(n.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),f.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,w(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,O.jsx)(A.Z,{title:o.formatMessage({id:"edit.visitor",defaultMessage:"编辑访客"}),placement:"right",onClose:r,open:t,width:400,extra:(0,O.jsxs)(L.Z,{children:[(0,O.jsx)(F.ZP,{onClick:r,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,O.jsx)(F.ZP,{type:"primary",onClick:N,loading:y,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,O.jsx)(T.Z,{form:l,layout:"vertical",initialValues:{tagList:S},children:(0,O.jsx)(T.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,O.jsx)(P.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:M.map((function(e){return{label:c(e.name),value:e.name}})),filterOption:function(e,t){var r;return(null!==(r=null==t?void 0:t.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())}})})})})},R=["current","pageSize"],B=function(e){var t=e.superUser,r=(0,k.useIntl)(),a=(0,Z.useRef)(),n=(0,m.u)((function(e){return e.currentOrg})),o=(0,Z.useState)(1),d=p()(o,2),l=d[0],S=d[1],T=(0,Z.useState)(10),A=p()(T,2),L=A[0],P=A[1],U=(0,Z.useState)({}),C=p()(U,2),B=C[0],E=C[1],Y=(0,Z.useState)(0),q=p()(Y,2),D=q[0],z=q[1],J=(0,Z.useState)([]),H=p()(J,2),X=H[0],G=H[1],K=(0,Z.useState)([]),V=p()(K,2),Q=(V[0],V[1]),W=(0,Z.useState)(!1),$=p()(W,2),_=$[0],ee=$[1],te=(0,Z.useState)(null),re=p()(te,2),ae=re[0],se=re[1],ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,O.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.nickname"}),dataIndex:"nickname",copyable:!0,width:250,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.nickname.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ip"}),dataIndex:"ip",copyable:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ip.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ipLocation"}),dataIndex:"ipLocation",copyable:!0,width:250,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ipLocation.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.tooltip"}),render:function(e,t){return"ONLINE"===t.status?(0,O.jsx)(y.Z,{color:"green",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===t.status?(0,O.jsx)(y.Z,{color:"red",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===t.status?(0,O.jsx)(y.Z,{color:"black",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.blocked"})}):(0,O.jsx)(y.Z,{color:"default",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.vipLevel"}),dataIndex:"vipLevel",copyable:!0,hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.vipLevel.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.channel"}),dataIndex:"client",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.channel.tooltip"}),render:function(e,t){return(0,M.YG)(t.channel)}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.tagList"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.tagList.tooltip"}),render:function(e,t){var r;return null==t||null===(r=t.tagList)||void 0===r?void 0:r.map((function(e,t){return(0,O.jsx)(y.Z,{color:"green",style:{marginRight:4},children:e},t)}))}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,fixed:"right",tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.updatedAt.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:I()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")})}}],ie=[].concat(ne,[{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",fixed:"right",width:100,render:function(e,t){return[(0,O.jsx)("a",{onClick:function(){se(t),ee(!0)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]}}]),oe=function(){var e=u()(i()().mark((function e(r,a,s){var o,d;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),o=localStorage.getItem(h.LA8),d=c()({orgUid:t?"":null==n?void 0:n.uid,accessToken:o||"",exportType:r},B),"current"===r?(d.pageNumber=String(l-1),d.pageSize=String(L)):"all"===r?(d.pageNumber="0",d.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(d.pageNumber=String(a),d.pageSize=String(s)),window.open((0,x.kG)()+"/api/v1/visitor/export?"+new URLSearchParams(d).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return oe("range",a,r)}})},n=0;n<a;n++)s();return t},de={selectedRowKeys:X,onChange:function(e,t){G(e),Q(t)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.Z,{columns:ie,actionRef:a,cardBordered:!0,rowSelection:de,scroll:{x:1800},request:function(){var e=u()(i()().mark((function e(r,a,o){var d,u,l,p,m,x,h,M;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=r.current,u=r.pageSize,l=s()(r,R),S(d),P(u),E(l),p=void 0,m=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,m="ascend"===a[x]?"ascend":"descend"),h=c()(c()({pageNumber:r.current-1,pageSize:u,orgUid:null==n?void 0:n.uid,superUser:t},l),{},{sortBy:p,sortDirection:m}),e.next=10,(0,g.vf)(h);case 10:return M=e.sent,console.log("queryVisitorsByOrg response:",M,h),200===M.code?z(M.data.totalElements):f.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){S(e),P(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.list"}),toolBarRender:function(){return e=[{key:"export-current",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return oe("current")}}],D>0&&(D<=1e3?e.push({key:"export-all",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(D,"条)"),onClick:function(){return oe("all")}}):e.push({key:"export-range",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(D,"条)"),children:ce(D)})),[(0,O.jsx)(w.Z,{menu:{items:e},placement:"bottom",children:(0,O.jsxs)(F.ZP,{type:"primary",icon:(0,O.jsx)(v.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(b.Z,{})]})},"exportOperations")];var e}}),(0,O.jsx)(N,{open:_,onClose:function(){ee(!1),se(null)},onSubmit:function(){var e;null===(e=a.current)||void 0===e||e.reload()},visitor:ae,orgUid:(null==ae?void 0:ae.orgUid)||(null==n?void 0:n.uid)})]})}},94240:function(e,t,r){var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),c=r.n(o),d=r(73193),u=r.n(d),l=r(89933),p=r.n(l),f=r(45332),g=r.n(f),m=r(61489),x=r(78135),h=r(77686),M=r(87005),v=r(68992),b=r(41881),j=r(6992),k=r(91768),y=r(80503),w=r(28031),F=r(54596),S=r(62395),I=r(72264),Z=r(77902),T=r(66248),A=r(6237),L=r(45634),P=r.n(L),U=r(44194),C=r(92891),O=r(31549),N=["current","pageSize"];t.Z=function(e){var t=e.superUser,r=(0,S.useIntl)(),a=(0,U.useRef)(),n=(0,h.u)((function(e){return e.currentOrg})),o=(0,U.useState)(1),d=g()(o,2),l=d[0],f=d[1],L=(0,U.useState)(10),R=g()(L,2),B=R[0],E=R[1],Y=(0,U.useState)({}),q=g()(Y,2),D=q[0],z=q[1],J=(0,U.useState)(0),H=g()(J,2),X=H[0],G=H[1],K=(0,U.useState)([]),V=g()(K,2),Q=V[0],W=V[1],$=(0,U.useState)([]),_=g()($,2),ee=_[0],te=_[1],re=(0,U.useState)(!1),ae=g()(re,2),se=ae[0],ne=ae[1],ie=(0,U.useState)(),oe=g()(ie,2),ce=oe[0],de=oe[1],ue=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,O.jsx)(S.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.ip"}),dataIndex:"ip",copyable:!0,width:150,tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.ip.tooltip"})},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.reason"}),dataIndex:"reason",tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.reason.tooltip"})},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.startTime.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:P()(t.startTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.endTime.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:P()(t.endTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.userNickname"}),dataIndex:"userNickname",tooltip:(0,O.jsx)(S.FormattedMessage,{id:"visitor.blackIp.userNickname.tooltip"})},{title:(0,O.jsx)(S.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,O.jsx)(S.FormattedMessage,{id:"message.createdAt.tooltip"})}],le=[].concat(ue,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,O.jsx)(I.ZP,{size:"small",type:"link",icon:(0,O.jsx)(b.Z,{}),onClick:function(){return ge(t)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,O.jsx)(Z.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return fe(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,O.jsx)(I.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackIp.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),pe=function(){var e=p()(c()().mark((function e(r,a,s){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),i=localStorage.getItem(v.LA8),o=u()({orgUid:t?"":null==n?void 0:n.uid,accessToken:i||"",exportType:r},D),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(B)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,M.kG)()+"/api/v1/ip/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),fe=function(){var e=p()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,(0,x.jn)(t.uid);case 4:s=e.sent,console.log("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),m.yw.success(r.formatMessage({id:"unblock.success"}))):m.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ge=function(e){de(e),ne(!0)},me=function(){de(void 0),ne(!0)},xe=function(){var e=p()(c()().mark((function e(){var t,s,n,o,d,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ee.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()(ee),e.prev=7,o.s();case 9:if((d=o.n()).done){e.next=23;break}return u=d.value,e.prev=11,e.next=14,(0,x.jn)(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===n?m.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):m.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),W([]),te([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),he=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return pe("range",a,r)}})},n=0;n<a;n++)s();return t},Me={selectedRowKeys:Q,onChange:function(e,t){W(e),te(t)}};return(0,O.jsxs)(U.Fragment,{children:[(0,O.jsx)(F.Z,{columns:le,actionRef:a,cardBordered:!0,rowSelection:Me,scroll:{x:2e3},request:function(){var e=p()(c()().mark((function e(r,a,i){var o,d,l,p,g,h,M,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,l=s()(r,N),f(o),E(d),z(l),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(h=Object.keys(a)[0],p=h,g="ascend"===a[h]?"ascend":"descend"),M=u()(u()({pageNumber:r.current-1,pageSize:d,orgUid:null==n?void 0:n.uid},l),{},{sortBy:p,sortDirection:g,superUser:t}),e.next=10,(0,x.EA)(M);case 10:return v=e.sent,console.log("queryIpBlacklists response:",v,M),200===v.code?G(v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),E(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.blackIp.list"}),toolBarRender:function(){return function(){var e=[];e.push((0,O.jsx)(I.ZP,{type:"primary",icon:(0,O.jsx)(j.Z,{}),onClick:me,children:r.formatMessage({id:"visitor.blackIp.add",defaultMessage:"添加黑名单IP"})},"add"));var t=[];Q.length>0&&(t.push({key:"batchUnblock",icon:(0,O.jsx)(k.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(Q.length,")"),onClick:function(){T.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(Q.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:xe,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,O.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,O.jsxs)(I.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",Q.length,")",(0,O.jsx)(y.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,O.jsx)(w.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return pe("current")}}];return X>0&&(X<=1e3?a.push({key:"export-all",icon:(0,O.jsx)(w.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return pe("all")}}):a.push({key:"export-range",icon:(0,O.jsx)(w.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:he(X)})),e.push((0,O.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,O.jsxs)(I.ZP,{type:"primary",icon:(0,O.jsx)(w.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(y.Z,{})]})},"exportOperations")),e}()}}),(0,O.jsx)(C.Z,{visible:se,onClose:function(){return ne(!1)},onSuccess:function(){var e;null===(e=a.current)||void 0===e||e.reload()},type:"black",editData:ce,superUser:t})]})}},92891:function(e,t,r){var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(45332),u=r.n(d),l=r(61489),p=r(78135),f=r(41381),g=r(77686),m=r(62395),x=r(35079),h=r(13243),M=r(70878),v=r(41059),b=r(89654),j=r(72264),k=r(45634),y=r.n(k),w=r(44194),F=r(31549),S=x.default.RangePicker,I=h.Z.TextArea;t.Z=function(e){var t=e.visible,r=e.onClose,a=e.onSuccess,n=e.type,o=e.editData,d=e.superUser,x=(0,m.useIntl)(),k=M.Z.useForm(),Z=u()(k,1)[0],T=(0,g.u)((function(e){return e.currentOrg})),A=!(null==o||!o.uid),L=A?x.formatMessage({id:"visitor.".concat(n,"Ip.edit"),defaultMessage:"编辑".concat("black"===n?"黑名单":"白名单","IP")}):x.formatMessage({id:"visitor.".concat(n,"Ip.add"),defaultMessage:"添加".concat("black"===n?"黑名单":"白名单","IP")});(0,w.useEffect)((function(){if(t)if(A&&o){var e={ip:o.ip};if("black"===n){var r=o;e.reason=r.reason,e.blackNickname=r.blackNickname,e.userNickname=r.userNickname,r.startTime&&r.endTime&&(e.timeRange=[y()(r.startTime),y()(r.endTime)])}else{var a=o;e.description=a.description}Z.setFieldsValue(e)}else Z.resetFields()}),[t,o,A,n,Z]);var P=function(){var e=c()(s()().mark((function e(){var t,c,u,g,m;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.validateFields();case 3:if(t=e.sent,c={ip:t.ip,orgUid:null==T?void 0:T.uid,superUser:d},"black"!==n){e.next=19;break}if(g=i()(i()({},c),{},{reason:t.reason,blackNickname:t.blackNickname,userNickname:t.userNickname}),t.timeRange&&2===t.timeRange.length&&(g.startTime=t.timeRange[0].format("YYYY-MM-DD HH:mm:ss"),g.endTime=t.timeRange[1].format("YYYY-MM-DD HH:mm:ss")),!A){e.next=14;break}return e.next=11,(0,p.Gc)(i()(i()({},g),{},{uid:o.uid}));case 11:u=e.sent,e.next=17;break;case 14:return e.next=16,(0,p.S8)(g);case 16:u=e.sent;case 17:e.next=29;break;case 19:if(m=i()(i()({},c),{},{description:t.description}),!A){e.next=26;break}return e.next=23,(0,f.ic)(i()(i()({},m),{},{uid:o.uid}));case 23:u=e.sent,e.next=29;break;case 26:return e.next=28,(0,f.$T)(m);case 28:u=e.sent;case 29:200===u.code?(l.yw.success(x.formatMessage({id:A?"update.success":"create.success",defaultMessage:A?"更新成功":"创建成功"})),a(),r()):l.yw.error(u.message||x.formatMessage({id:A?"update.error":"create.error",defaultMessage:A?"更新失败":"创建失败"})),e.next=36;break;case 32:e.prev=32,e.t0=e.catch(0),console.error("Submit error:",e.t0),l.yw.error(x.formatMessage({id:"submit.error",defaultMessage:"提交失败"}));case 36:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(){return e.apply(this,arguments)}}();return(0,F.jsx)(v.Z,{title:L,width:600,open:t,onClose:r,footer:(0,F.jsxs)(b.Z,{children:[(0,F.jsx)(j.ZP,{onClick:r,children:x.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,F.jsx)(j.ZP,{type:"primary",onClick:P,children:x.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,F.jsxs)(M.Z,{form:Z,layout:"vertical",initialValues:{timeRange:[y()(),y()().add(1,"year")]},children:[(0,F.jsx)(M.Z.Item,{name:"ip",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.".concat(n,"Ip.ip")}),rules:[{validator:function(e,t){if(!t)return Promise.reject(new Error(x.formatMessage({id:"ip.required",defaultMessage:"请输入IP地址"})));return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)?Promise.resolve():Promise.reject(new Error(x.formatMessage({id:"ip.invalid",defaultMessage:"请输入有效的IP地址"})))}}],tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.".concat(n,"Ip.ip.tooltip")}),help:x.formatMessage({id:"ip.format.help",defaultMessage:"格式：xxx.xxx.xxx.xxx（如：192.168.1.1）"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"ip.placeholder",defaultMessage:"请输入IP地址"})})}),"black"===n?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(M.Z.Item,{name:"reason",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.reason"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.reason.tooltip"}),children:(0,F.jsx)(I,{rows:3,placeholder:x.formatMessage({id:"reason.placeholder",defaultMessage:"请输入封禁原因"})})}),(0,F.jsx)(M.Z.Item,{name:"blackNickname",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.black.nickname"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.black.nickname.tooltip"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"blackNickname.placeholder",defaultMessage:"请输入被封禁用户昵称"})})}),(0,F.jsx)(M.Z.Item,{name:"userNickname",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.userNickname"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.userNickname.tooltip"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"userNickname.placeholder",defaultMessage:"请输入操作员昵称"})})}),(0,F.jsx)(M.Z.Item,{name:"timeRange",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.timeRange",defaultMessage:"封禁时间范围"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.timeRange.tooltip",defaultMessage:"设置IP封禁的时间范围"}),children:(0,F.jsx)(S,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:[x.formatMessage({id:"startTime.placeholder",defaultMessage:"开始时间"}),x.formatMessage({id:"endTime.placeholder",defaultMessage:"结束时间"})]})})]}):(0,F.jsx)(M.Z.Item,{name:"description",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.white.description"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.white.description.tooltip"}),children:(0,F.jsx)(I,{rows:3,placeholder:x.formatMessage({id:"description.placeholder",defaultMessage:"请输入白名单描述"})})})]})})}}}]);