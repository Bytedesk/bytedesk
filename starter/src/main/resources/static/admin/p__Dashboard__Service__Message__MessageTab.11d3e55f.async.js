"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8166],{39817:function(e,t,a){a.r(t),a.d(t,{default:function(){return xe}});var s=a(31699),r=a(8247),n=a(55735),i=a(73193),o=a.n(i),l=a(84176),d=a.n(l),u=a(90819),c=a.n(u),g=a(89933),p=a.n(g),m=a(45332),f=a.n(m),x=a(86803),h=a(76750),M=a(40612),y=a(44521),v=a(11090),j=a(81947),w=a(30921),F=a(29266),b=a(75365),I=a(44194);function k(e){return S.apply(this,arguments)}function S(){return(S=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/robot/message/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=a(31549),A=["current","pageSize"],R={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},C=function(){var e=(0,w.useIntl)(),t=(0,I.useRef)(),a=(0,h.Z)().translateString,s=(0,M.u)((function(e){return e.currentOrg})),r=(0,I.useState)(1),i=f()(r,2),l=i[0],u=i[1],g=(0,I.useState)(10),m=f()(g,2),S=m[0],C=m[1],E=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var s;return(0,T.jsx)(T.Fragment,{children:a(null==t||null===(s=t.user)||void 0===s?void 0:s.nickname)})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var s;return(0,T.jsx)(T.Fragment,{children:a(null==t||null===(s=t.robot)||void 0===s?void 0:s.nickname)})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.answer.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=R[a]||{text:a,color:"default"};return(0,T.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,T.jsx)(T.Fragment,{children:t.rateDownTagList.map((function(e){return(0,T.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:80,fixed:"right",render:function(t,a,s,r){return[(0,T.jsx)("a",{onClick:function(){Z(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}],Z=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==s?void 0:s.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},U=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",l,S),t=localStorage.getItem(n.LA8),window.open((0,y.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams({orgUid:(null==s?void 0:s.uid)||"",pageNumber:String(l-1),pageSize:String(S),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsx)(j.Z,{columns:E,actionRef:t,cardBordered:!0,scroll:{x:2e3},request:function(){var e=p()(c()().mark((function e(t,a,r){var n,i,l,g,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,i=t.pageSize,l=d()(t,A),u(n),C(i),g=o()({pageNumber:n-1,pageSize:i,orgUid:null==s?void 0:s.uid},l),e.next=7,k(g);case 7:return p=e.sent,console.log("getAllRobotMessages response:",g,p),200===p.code||x.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return[(0,T.jsx)(b.ZP,{icon:(0,T.jsx)(v.Z,{}),type:"primary",onClick:U,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})},E=a(10154),Z=a.n(E);function U(e){return q.apply(this,arguments)}function q(){return(q=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/message/leave/query/org",{method:"GET",params:o()(o()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return N.apply(this,arguments)}function N(){return(N=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/message/leave/reply",{method:"POST",data:o()(o()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=a(28977),L=a.n(B),Y=a(88721),P=a(76711),z=a.n(P),H=a(10162),_=a(36693),O=a(69169),G=a(32350),K=a(32327),V=a(57178),W=a(73442),Q=a(3849),J=a(62673),$=a(32943),X=a(30348),ee=a(53530),te=a(43409),ae=K.Z.Title,se=K.Z.Paragraph,re=K.Z.Text,ne=function(e){var t,a=e.visible,s=e.onClose,r=e.messageLeave,i=e.onSuccess,l=(0,w.useIntl)(),d=V.Z.useForm(),u=f()(d,1)[0],g=(0,I.useState)(!1),m=f()(g,2),h=m[0],M=m[1],v=(0,I.useState)(!1),j=f()(v,2),F=j[0],k=j[1],S=(0,I.useState)([]),A=f()(S,2),R=A[0],C=A[1],E=(0,I.useState)([]),Z=f()(E,2),U=Z[0],q=Z[1],N=(0,I.useState)(!1),B=f()(N,2),P=B[0],K=B[1],ne=(0,I.useState)(""),ie=f()(ne,2),oe=ie[0],le=ie[1],de=(0,I.useState)(""),ue=f()(de,2),ce=ue[0],ge=ue[1];(0,I.useEffect)((function(){if(r&&r.reply)if(u.setFieldsValue({reply:r.reply}),k(!0),r.replyImages&&r.replyImages.length>0){var e=r.replyImages.filter((function(e){return""!==e}));q(e),C(e.map((function(e,t){return{uid:"-".concat(t),name:"image-".concat(t,".png"),status:"done",url:e,thumbUrl:e}})))}else q([]),C([]);else u.resetFields(),k(!1),q([]),C([])}),[r,u]);var pe=function(){var e=p()(c()().mark((function e(t){var a,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),a={uid:r.uid,reply:t.reply,replyImages:U,orgUid:r.orgUid},e.next=7,D(a);case 7:n=e.sent,console.log("回复留言:",n.data),200===n.code?(x.yw.success(l.formatMessage({id:"reply.success",defaultMessage:"回复成功"})),u.resetFields(),q([]),C([]),i(),s()):x.yw.error(n.message||l.formatMessage({id:"reply.failed",defaultMessage:"回复失败"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("回复留言出错:",e.t0),x.yw.error(l.formatMessage({id:"reply.error",defaultMessage:"回复出错"}));case 16:return e.prev=16,M(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(t){return e.apply(this,arguments)}}(),me=function(e){return!e||0===e.length||1===e.length&&""===e[0]?null:(0,T.jsxs)("div",{style:{marginTop:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"images",defaultMessage:"图片"}),":"]}),(0,T.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:e.map((function(e,t){return e?(0,T.jsx)("img",{src:e,alt:"留言图片",style:{width:"100px",height:"100px",objectFit:"cover",cursor:"pointer"},onClick:function(){return fe({url:e,uid:"img-".concat(t),name:"图片 ".concat(t+1)})}},t):null}))})]})},fe=function(){var e=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le(t.url||t.thumbUrl),K(!0),ge(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=(0,T.jsx)(b.ZP,{icon:(0,T.jsx)(H.Z,{}),children:(0,T.jsx)(w.FormattedMessage,{id:"upload",defaultMessage:"上传"})}),he={name:"file",accept:"image/*",action:(0,y.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(n.LA8)},listType:"picture-card",fileList:R,onPreview:fe,onChange:function(e){var t=z()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var a=e.file.response.data.fileUrl;U.includes(a)||q((function(e){return[].concat(z()(e),[a])})),x.yw.success(l.formatMessage({id:"upload.success",defaultMessage:"上传 {filename} 成功"},{filename:e.file.name}))}else x.yw.error(l.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name})+": ".concat(e.file.response.message));else"error"===e.file.status&&x.yw.error(l.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name}));t=t.map((function(e){return e.response&&200===e.response.code?o()(o()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),C(t)},data:function(e){var t=L()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return console.log("uploadProps",t),{file:e,fileName:t,fileType:e.type,isAvatar:"false",kbType:n.IrL,categoryUid:"",kbUid:"",client:n.bVn}},onRemove:function(e){if(console.log("onRemove",e),"done"===e.status&&e.response&&e.response.data){var t=e.response.data.fileUrl;q((function(e){return e.filter((function(e){return e!==t}))}))}return e.url&&q((function(t){return t.filter((function(t){return t!==e.url}))})),!0}};return(0,T.jsx)(W.Z,{title:l.formatMessage({id:"leave.message.reply",defaultMessage:"回复留言"}),width:600,placement:"right",onClose:s,open:a,styles:{body:{paddingBottom:80}},extra:(0,T.jsx)(Q.Z,{children:(0,T.jsx)(b.ZP,{onClick:s,children:(0,T.jsx)(w.FormattedMessage,{id:"cancel",defaultMessage:"取消"})})}),children:r&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(J.Z,{bordered:!1,style:{marginBottom:"20px"},children:[(0,T.jsx)(ae,{level:5,children:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.details",defaultMessage:"留言详情"})}),(0,T.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",(null===(t=r.user)||void 0===t?void 0:t.nickname)||"-"]}),(0,T.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"contact",defaultMessage:"联系方式"}),":"]})," ",r.contact||"-"]}),(0,T.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"content",defaultMessage:"内容"}),":"]}),(0,T.jsx)(se,{style:{marginTop:"8px"},children:r.content})]}),me(r.images||[]),r.reply&&(0,T.jsxs)("div",{style:{marginTop:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"replied.content",defaultMessage:"回复内容"}),":"]}),(0,T.jsx)(se,{style:{marginTop:"8px"},children:r.reply})]}),r.replyImages&&r.replyImages.length>0&&(0,T.jsxs)("div",{style:{marginTop:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),":"]}),me(r.replyImages||[])]}),(0,T.jsxs)("div",{style:{marginTop:"10px"},children:[(0,T.jsxs)(re,{strong:!0,children:[(0,T.jsx)(w.FormattedMessage,{id:"status",defaultMessage:"状态"}),":"]})," ",(0,Y.It)(r.status)]})]}),F&&(0,T.jsx)($.Z,{type:"warning",showIcon:!0,message:l.formatMessage({id:"reply.exists.warning",defaultMessage:"已回复，继续回复仅更新已有回复"}),style:{marginBottom:"16px"}}),(0,T.jsxs)(O.A,{form:u,onFinish:pe,submitter:{render:function(e,t){return(0,T.jsx)("div",{style:{textAlign:"right",marginTop:"24px"},children:(0,T.jsx)(b.ZP,{type:"primary",icon:(0,T.jsx)(_.Z,{}),loading:h,onClick:function(){return u.submit()},children:(0,T.jsx)(w.FormattedMessage,{id:"reply",defaultMessage:"回复"})})})}},children:[(0,T.jsx)(G.Z,{name:"reply",label:l.formatMessage({id:"reply.content",defaultMessage:"回复内容"}),placeholder:l.formatMessage({id:"please.enter.reply",defaultMessage:"请输入回复内容"}),rules:[{required:!0,message:l.formatMessage({id:"reply.content.required",defaultMessage:"请输入回复内容"})}],fieldProps:{rows:6}}),(0,T.jsxs)(V.Z.Item,{label:l.formatMessage({id:"reply.images",defaultMessage:"回复图片"}),children:[(0,T.jsx)(X.Z,o()(o()({},he),{},{children:xe})),(0,T.jsx)(ee.Z,{open:P,title:ce,footer:null,onCancel:function(){return K(!1)},children:(0,T.jsx)(te.Z,{alt:"预览图片",style:{width:"100%"},src:oe})})]})]})]})})},ie=["current","pageSize"],oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,T.jsx)(T.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.contact.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,ellipsis:!0,width:300,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.content.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.images.tooltip"}),render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,T.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,T.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,T.jsx)(w.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,width:120,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.status.tooltip"}),valueType:"select",valueEnum:Z()(Z()(Z()(Z()(Z()(Z()(Z()(Z()(Z()({},n.d23,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),n.m7i,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),n.d3_,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),n.oLW,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),n.KBB,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),n.v3R,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),n.uke,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),n.fEl,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),n.K0y,{text:(0,T.jsx)(w.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,Y.It)(t.status)}},{title:(0,T.jsx)(w.FormattedMessage,{id:"reply",defaultMessage:"Reply"}),dataIndex:"reply",copyable:!0,hideInSearch:!0,ellipsis:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.reply.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),dataIndex:"replyImages",copyable:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.replyImages.tooltip"}),render:function(e,t,a,s){return!t.replyImages||0===t.replyImages.length||1===t.replyImages.length&&""===t.replyImages[0]?(0,T.jsx)("span",{children:"-"}):t.replyImages.map((function(e,t){return e?(0,T.jsx)("img",{src:e,alt:"reply image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,T.jsx)(w.FormattedMessage,{id:"reply.user",defaultMessage:"回复人员"}),dataIndex:"replyUserNickname",hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.replyUser.tooltip"}),render:function(e,t){var a;return(0,T.jsx)(T.Fragment,{children:(null==t||null===(a=t.replyUser)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"repliedAt",defaultMessage:"回复时间"}),key:"repliedAt",dataIndex:"repliedAt",sorter:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.repliedAt.tooltip"}),render:function(e,t,a,s){return t.repliedAt?L()(t.repliedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,T.jsx)(w.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.createdAt.tooltip"}),render:function(e,t,a,s){return L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,T.jsx)(w.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"leave.message.updatedAt.tooltip"}),render:function(e,t,a,s){return t.updatedAt?L()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],le=function(){var e=(0,w.useIntl)(),t=(0,I.useRef)(),a=(0,I.useState)(1),s=f()(a,2),r=s[0],i=s[1],l=(0,I.useState)(10),u=f()(l,2),g=u[0],m=u[1],h=(0,M.u)((function(e){return e.currentOrg})),F=(0,I.useState)(!1),k=f()(F,2),S=k[0],A=k[1],R=(0,I.useState)(),C=f()(R,2),E=C[0],Z=C[1],q=[].concat(oe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,a,s,r){return[(0,T.jsx)("a",{onClick:function(){D(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,T.jsx)("a",{onClick:function(){N(a)},children:e.formatMessage({id:"handle",defaultMessage:"Handle"})},"handle")]}}]),D=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==h?void 0:h.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},N=function(e){console.log("handleProcess",e),Z(e),A(!0)},B=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,g),t=localStorage.getItem(n.LA8),window.open((0,y.kG)()+"/api/v1/message/leave/export?"+new URLSearchParams({orgUid:(null==h?void 0:h.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(j.Z,{columns:q,actionRef:t,cardBordered:!0,scroll:{x:2300},request:function(){var e=p()(c()().mark((function e(t,a,s){var r,n,l,u,g;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,l=d()(t,ie),i(r),m(n),u=o()({pageNumber:r-1,pageSize:n,orgUid:null==h?void 0:h.uid},l),e.next=6,U(u);case 6:return g=e.sent,console.log("queryLeaveMsgsByOrg response:",g,u),200===g.code||x.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"留言记录",toolBarRender:function(){return[(0,T.jsx)(b.ZP,{icon:(0,T.jsx)(v.Z,{}),type:"primary",onClick:B,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),(0,T.jsx)(ne,{visible:S,onClose:function(){A(!1)},messageLeave:E,onSuccess:function(){var e;null===(e=t.current)||void 0===e||e.reload()}})]})};function de(e){return ue.apply(this,arguments)}function ue(){return(ue=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/message/rating/query/org",{method:"GET",params:o()(o()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=["current","pageSize"],ge={ROBOT:{text:"机器人",color:"blue"},AGENT:{text:"人工客服",color:"green"},FAQ:{text:"常见问题",color:"purple"}},pe={RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},me=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.answer.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,ellipsis:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.question.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.fromType"}),dataIndex:"fromType",ellipsis:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.fromType.tooltip"}),render:function(e,t){var a=t.fromType||"",s=ge[a]||{text:a,color:"default"};return(0,T.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=pe[a]||{text:a,color:"default"};return(0,T.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.tags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,T.jsx)(T.Fragment,{children:t.rateDownTagList.map((function(e){return(0,T.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.reason.tooltip"})},{title:(0,T.jsx)(w.FormattedMessage,{id:"faq.rating.user",defaultMessage:"用户"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t){var a;return(0,T.jsx)(T.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,T.jsx)(w.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,T.jsx)(w.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,s){return t.createdAt?L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],fe=function(){var e=(0,w.useIntl)(),t=(0,I.useRef)(),a=(0,I.useState)(1),s=f()(a,2),r=s[0],i=s[1],l=(0,I.useState)(10),u=f()(l,2),g=u[0],m=u[1],h=(0,M.u)((function(e){return e.currentOrg})),F=[].concat(me,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,a,s,r){return[(0,T.jsx)("a",{onClick:function(){k(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"view")]}}]),k=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==h?void 0:h.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},S=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,g),t=localStorage.getItem(n.LA8),window.open((0,y.kG)()+"/api/v1/message/rating/export?"+new URLSearchParams({orgUid:(null==h?void 0:h.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(j.Z,{columns:F,actionRef:t,cardBordered:!0,scroll:{x:2e3},request:function(){var e=p()(c()().mark((function e(t,a,s){var r,n,l,u,g;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,l=d()(t,ce),i(r),m(n),u=o()({pageNumber:r-1,pageSize:n,orgUid:null==h?void 0:h.uid},l),e.next=6,de(u);case 6:return g=e.sent,console.log("queryMessageRatingsByOrg response:",g,u),200!==g.code&&x.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"评价记录",toolBarRender:function(){return[(0,T.jsx)(b.ZP,{icon:(0,T.jsx)(v.Z,{}),type:"primary",onClick:S,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})})},xe=function(){var e=(0,w.useIntl)().formatMessage,t=[{key:"message",label:e({id:"message.tab.all"}),children:(0,T.jsx)(s.Z,{type:n.Nqz})}];return(0,y.OJ)()&&t.push({key:"messageLeave",label:e({id:"message.tab.leave"}),children:(0,T.jsx)(le,{})},{key:"robotMessage",label:e({id:"message.tab.robot"}),children:(0,T.jsx)(C,{})},{key:"messageRating",label:e({id:"message.tab.rating"}),children:(0,T.jsx)(fe,{})}),(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(r.Z,{defaultActiveKey:"message",items:t,style:{margin:10}})})}}}]);