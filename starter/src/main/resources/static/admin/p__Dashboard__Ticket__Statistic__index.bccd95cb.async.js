"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3280],{24170:function(t,e,n){n.d(e,{Lr:function(){return R},_t:function(){return l},i8:function(){return w},n1:function(){return x},sE:function(){return v},tY:function(){return p},x_:function(){return g}});var r=n(90819),a=n.n(r),i=n(73193),u=n.n(i),s=n(89933),c=n.n(s),o=n(55735),d=n(30921);function l(t){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/query/org",{method:"GET",params:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/query/detail",{method:"GET",params:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/create",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return k.apply(this,arguments)}function k(){return(k=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update/avatar",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t){return j.apply(this,arguments)}function j(){return(j=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update/autoreply",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(t){return b.apply(this,arguments)}function b(){return(b=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/delete",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},11603:function(t,e,n){n.d(e,{If:function(){return v},dF:function(){return l},j4:function(){return g},v$:function(){return p}});var r=n(90819),a=n.n(r),i=n(73193),u=n.n(i),s=n(89933),c=n.n(s),o=n(55735),d=n(30921);function l(t){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/query/org",{method:"GET",params:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/create",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/update",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/delete",{method:"POST",data:u()(u()({},e),{},{client:o.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},76750:function(t,e,n){var r=n(55735),a=n(65461),i=n(30921);e.Z=function(){var t=(0,i.useIntl)();return{translateString:function(e){return null==e?e:e&&(null!=e&&e.startsWith(r.VoP)||null!=e&&e.startsWith("ROLE_"))?t.formatMessage({id:e,defaultMessage:e}):e},translateStringTranct:function(e){return null==e?e:null!=e&&e.startsWith(r.VoP)||null!=e&&e.startsWith("ROLE_")?(0,a.aS)(t.formatMessage({id:e,defaultMessage:e}),10):(0,a.aS)(e,10)}}}},81214:function(t,e,n){n.r(e),n.d(e,{default:function(){return H}});var r=n(90819),a=n.n(r),i=n(89933),u=n.n(i),s=n(45332),c=n.n(s),o=n(44194),d=n(98123),l=n(44781),f=n(62673),p=n(3849),m=n(67402),g=n(88996),h=n(75365),v=n(88201),y=n(5602),x=n(59485),k=n(7875),w=n(23515),j=n(97413),R=n(60262),b=n(74840),M=n(61107),S=n(80556),D=n(30921),Z=n(5939),O=n(73193),T=n.n(O),A=n(55735);function F(t){return q.apply(this,arguments)}function q(){return(q=u()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,D.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:T()(T()({},e),{},{client:A.bVn})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var E=n(86803),Y=n(40612),U=n(1902),C=n(24170),P=n(76750),V=n(28977),I=n.n(V),B=n(11603),W=n(53782),z=n(31549),_=d.default.RangePicker,G=l.Z.Option,H=function(){var t,e,n=(0,D.useIntl)(),r=(0,P.Z)().translateStringTranct,i=(0,o.useState)(I()().startOf("day")),s=c()(i,2),d=s[0],O=s[1],T=(0,o.useState)(I()().endOf("day")),q=c()(T,2),V=q[0],H=q[1],N=(0,o.useState)("today"),L=c()(N,2),J=L[0],K=L[1],X=(0,o.useState)(A.AOk),$=c()(X,2),Q=$[0],tt=$[1],et=(0,o.useState)(),nt=c()(et,2),rt=nt[0],at=nt[1],it=(0,o.useState)(),ut=c()(it,2),st=ut[0],ct=ut[1],ot=(0,Y.u)((function(t){return t.currentOrg})),dt=(0,U.E)((function(t){return t})),lt=dt.agentResult,ft=dt.setAgentResult,pt=(0,W.H)((function(t){return t})),mt=pt.departmentResult,gt=pt.setDepartmentResult,ht=(0,o.useState)(),vt=c()(ht,2),yt=vt[0],xt=vt[1],kt=(0,o.useState)(A.OwA),wt=c()(kt,2),jt=wt[0],Rt=wt[1],bt=(0,o.useState)(!1),Mt=c()(bt,2),St=Mt[0],Dt=Mt[1],Zt=[{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,o.useEffect)((function(){if("custom"===J)O(d),H(V),Rt(A.dd4);else{var t=I()();"today"===J?(O(t),H(t),Rt(A.OwA)):"yesterday"===J?(O(t.subtract(1,"day")),H(t.subtract(1,"day")),Rt(A.OwA)):"week"===J?(O(t.startOf("week")),H(t.endOf("week")),Rt(A.dd4)):"lastWeek"===J?(O(t.subtract(1,"week").startOf("week")),H(t.subtract(1,"week").endOf("week")),Rt(A.dd4)):"month"===J&&(O(t.startOf("month")),H(t.endOf("month")),Rt(A.dd4))}}),[J]);var Ot=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={pageNumber:0,pageSize:100,orgUid:null==ot?void 0:ot.uid},t.next=4,(0,B.dF)(e);case 4:n=t.sent,console.log("queryDepartmentsByOrg:",n,e),200===n.code?(E.yw.destroy(),gt(n),n.data.content.length>0&&ct(n.data.content[0].uid)):(E.yw.destroy(),E.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Tt=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={pageNumber:0,pageSize:50,orgUid:null==ot?void 0:ot.uid},t.next=4,(0,C._t)(e);case 4:n=t.sent,console.log("fetchAllAgents: ",n),200===n.code?(E.yw.destroy(),ft(n),n.data.content.length>0&&at(n.data.content[0].uid)):(E.yw.destroy(),E.yw.error(r(n.message))),console.log("queryAllAgents response",n);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),At=function(){var t=u()(a()().mark((function t(){var e,r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Dt(!0),t.prev=1,E.yw.loading("loading"),e={type:Q,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==V?void 0:V.format("YYYY-MM-DD 23:59:59"),departmentUid:st,assigneeUid:rt,orgUid:null==ot?void 0:ot.uid},t.next=6,F(e);case 6:r=t.sent,console.log("queryStatisticTicketByDate response",r,e),200===r.code?(E.yw.destroy(),xt(r.data)):(E.yw.destroy(),E.yw.error(r.message)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),E.yw.error(n.formatMessage({id:"ticket.message.operation.failed"}));case 14:return t.prev=14,Dt(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),Ft=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={type:Q,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==V?void 0:V.format("YYYY-MM-DD 23:59:59"),departmentUid:st,assigneeUid:rt,orgUid:null==ot?void 0:ot.uid},t.next=4,F(e);case 4:n=t.sent,console.log("queryStatisticTicketByDate response",n,e),200===n.code?E.yw.destroy():(E.yw.destroy(),E.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){Ot(),Tt()}),[]),(0,o.useEffect)((function(){At()}),[Q,rt,st]),(0,o.useEffect)((function(){Ft()}),[jt,Q,rt,st]),(0,o.useEffect)((function(){At()}),[d,V]);var qt=[{title:n.formatMessage({id:"ticket.statistic.total"}),value:(null==yt?void 0:yt.totalTickets)||0,icon:(0,z.jsx)(w.Z,{}),color:"#1890ff"},{title:n.formatMessage({id:"ticket.statistic.resolved"}),value:(null==yt?void 0:yt.resolvedTickets)||0,icon:(0,z.jsx)(j.Z,{}),color:"#52c41a"},{title:n.formatMessage({id:"ticket.statistic.resolution.rate"}),value:"".concat((null==yt?void 0:yt.resolvedTickets)/(null==yt?void 0:yt.totalTickets)||0,"%"),icon:(0,z.jsx)(R.Z,{}),color:"#722ed1"},{title:n.formatMessage({id:"ticket.statistic.satisfaction"}),value:"".concat((null==yt?void 0:yt.customerSatisfactionRate)||0,"%"),icon:(0,z.jsx)(b.Z,{}),color:"#fa8c16"}];return(0,z.jsxs)("div",{style:{padding:16},children:[(0,z.jsx)(f.Z,{style:{marginBottom:16},children:(0,z.jsxs)(p.Z,{direction:"vertical",style:{width:"100%"},children:[(0,z.jsxs)(p.Z,{wrap:!0,children:[(0,z.jsx)(m.ZP.Group,{value:J,onChange:function(t){return K(t.target.value)},children:Zt.map((function(t){return(0,z.jsx)(m.ZP.Button,{value:t.value,children:t.label},t.value)}))}),"custom"===J&&(0,z.jsx)(_,{value:[d,V],onChange:function(t){O(t[0]),H(t[1])}})]}),(0,z.jsxs)(p.Z,{wrap:!0,children:[(0,z.jsxs)(l.Z,{placeholder:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.type"}),style:{width:200},value:Q,onChange:function(t){return tt(t)},children:[(0,z.jsx)(G,{value:A.AOk,children:(0,z.jsx)(D.FormattedMessage,{id:"i18n.all"})}),(0,z.jsx)(G,{value:A.pHh,children:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.agent"})}),(0,z.jsx)(G,{value:A.j0X,children:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.department"})})]}),Q===A.pHh&&(0,z.jsx)(l.Z,{placeholder:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.agent"}),style:{width:200},value:rt,onChange:function(t){return at(t)},children:null===(t=lt.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(t){return(0,z.jsx)(G,{value:null==t?void 0:t.uid,children:r(null==t?void 0:t.nickname)},null==t?void 0:t.uid)}))}),Q===A.j0X&&(0,z.jsx)(l.Z,{placeholder:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.department"}),style:{width:200},value:st,onChange:function(t){return ct(t)},children:null===(e=mt.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(t){return(0,z.jsx)(G,{value:null==t?void 0:t.uid,children:r(null==t?void 0:t.name)},null==t?void 0:t.uid)}))}),(0,z.jsx)(g.Z,{title:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.export"}),children:(0,z.jsx)(h.ZP,{icon:(0,z.jsx)(M.Z,{}),onClick:function(){E.yw.warning("TODO: 待实现")},children:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.export"})})}),(0,z.jsx)(g.Z,{title:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.refresh"}),children:(0,z.jsx)(h.ZP,{icon:(0,z.jsx)(S.Z,{}),onClick:function(){return At()},children:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.filter.refresh"})})}),!1]})]})}),(0,z.jsx)(v.Z,{gutter:16,style:{marginBottom:24},children:qt.map((function(t){return(0,z.jsx)(y.Z,{span:6,children:(0,z.jsx)(f.Z,{loading:St,children:(0,z.jsx)(x.Z,{title:t.title,value:t.value,prefix:o.cloneElement(t.icon,{style:{color:t.color}}),valueStyle:{color:t.color}})})},t.title)}))}),(0,z.jsx)(f.Z,{title:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.trend"}),style:{marginBottom:24,height:300},loading:St,children:(0,z.jsx)(Z.Z,{data:[],xField:"date",yField:"value",seriesField:"type",legend:{position:"top"},meta:{type:{formatter:function(t){return n.formatMessage({id:"ticket.statistic.type.".concat(t)})}}}})}),(0,z.jsx)(f.Z,{title:(0,z.jsx)(D.FormattedMessage,{id:"ticket.statistic.agent.performance"}),loading:St,children:(0,z.jsx)(k.Z,{columns:[{title:n.formatMessage({id:"ticket.statistic.agent.name"}),dataIndex:"assigneeName",key:"assigneeName"},{title:n.formatMessage({id:"ticket.statistic.agent.tickets"}),dataIndex:"assigneeTickets",key:"assigneeTickets",sorter:!0},{title:n.formatMessage({id:"ticket.statistic.agent.resolution"}),dataIndex:"assigneeResolutionRate",key:"assigneeResolutionRate",render:function(t){return"".concat(t,"%")},sorter:!0},{title:n.formatMessage({id:"ticket.statistic.agent.satisfaction"}),dataIndex:"customerSatisfactionRate",key:"customerSatisfactionRate",render:function(t){return"".concat(t,"%")},sorter:!0}],rowKey:"assigneeUid",pagination:!1})})]})}},1902:function(t,e,n){n.d(e,{E:function(){return l}});var r=n(73193),a=n.n(r),i=n(76711),u=n.n(i),s=n(55735),c=n(44435),o=n(83642),d=n(83890),l=(0,c.Ue)()((0,o.mW)((0,o.tJ)((0,d.n)((function(t,e){return{agentResult:{data:{content:[]}},currentAgent:{uid:"",orgUid:""},insertAgent:function(e){t((function(t){t.agentResult.data.content.unshift(e)}))},updateAgent:function(e){t((function(t){var n=t.agentResult.data.content,r=n.findIndex((function(t){return t.uid===e.uid}));-1!==r?n[r]=e:console.warn("Agent with uid ".concat(e.uid," not found."))}))},setAgentResult:function(n){var r;(t({agentResult:n}),""===e().currentAgent.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&t({currentAgent:n.data.content[0]}))},setCurrentAgent:function(n){var r=e().agentResult.data.content,i=r.findIndex((function(t){return t.uid===n.uid}));if(-1!==i){var s=[].concat(u()(r.slice(0,i)),[n],u()(r.slice(i+1))),c=a()(a()({},e().agentResult),{},{data:{content:s}});t({agentResult:c,currentAgent:n})}else console.warn("Agent with the specified uid not found."),t({currentAgent:n})},deleteCurrentAgent:function(n){var r=e().agentResult.data.content,i=r.findIndex((function(t){return t.uid===n}));-1!==i?t({agentResult:a()(a()({},e().agentResult),{},{data:{content:[].concat(u()(r.slice(0,i)),u()(r.slice(i+1)))}})}):console.warn("Agent not found in cache:",n),e().currentAgent.uid===n&&t({currentAgent:{uid:"",orgUid:""}})},deleteAgentCache:function(){return t({},!0)}}})),{name:s.zzK})))},53782:function(t,e,n){n.d(e,{H:function(){return p}});var r=n(86222),a=n.n(r),i=n(76711),u=n.n(i),s=n(73193),c=n.n(s),o=n(55735),d=n(44435),l=n(83642),f=n(83890),p=(0,d.Ue)()((0,l.mW)((0,l.tJ)((0,f.n)((function(t,e){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:o.zBg,nickname:o.zBg},insertDepartment:function(e){t((function(t){var n=t.departmentResult.data.content;if(e.parentUid){var r=n.find((function(t){return t.uid===e.parentUid}));r&&(r.children||(r.children=[]),r.children.push(e))}else n.push(e)}))},upgradeDepartment:function(e){t((function(t){var n=t.departmentResult.data.content,r=n.findIndex((function(t){return t.uid===e.uid}));-1!==r?n[r]=e:n.forEach((function(t){if(t.children){var n=t.children.findIndex((function(t){return t.uid===e.uid}));-1!==n&&(t.children[n]=e)}}))}))},setDepartmentResult:function(n){var r,a={uid:o.zBg,name:o.zBg};(t({departmentResult:c()(c()({},n),{},{data:{content:[a].concat(u()(n.data.content))}})}),""===e().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&t({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=e().departmentResult.data.content,a=r.findIndex((function(t){return t.uid===n.uid}));if(-1!==a){var i=[].concat(u()(r.slice(0,a)),[n],u()(r.slice(a+1))),s=c()(c()({},e().departmentResult),{},{data:{content:i}});t({departmentResult:s,currentDepartment:n})}else console.warn("Department with the specified uid not found."),t({currentDepartment:n})},removeDepartment:function(n){t((function(t){var e=t.departmentResult.data.content;t.departmentResult.data.content=function t(e,n){return e.filter((function(e){return e.uid!==n&&(e.children&&(e.children=t(e.children,n)),!0)}))}(e,n)})),e().currentDepartment.uid===n&&t({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,i,u=null===(r=e().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(t){return t.uid===n}));if(u)t({currentDepartment:u});else{!function e(r){var i,u=a()(r);try{for(u.s();!(i=u.n()).done;){var s=i.value;if(s.uid===n)return void t({currentDepartment:s});s.children&&s.children.length>0&&e(s.children)}}catch(t){u.e(t)}finally{u.f()}}((null===(i=e().departmentResult)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.content)||[])}},deleteDepartmentCache:function(){return t({},!0)}}})),{name:o.xY_})))}}]);