"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{22014:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},i=n(5901),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},79481:function(e,t,n){var r=n(94433),a=n(38956),s=n(44194),i=n(46659),o=n(31549),l=["fieldProps","request","params","proFieldProps"],u=function(e,t){var n=e.fieldProps,s=e.request,u=e.params,d=e.proFieldProps,c=(0,a.Z)(e,l);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:u,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(u);t.Z=d},6090:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return h},hS:function(){return p},z_:function(){return c}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(68992),d=n(62395);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},65041:function(e,t,n){n.d(t,{G:function(){return g}});var r=n(73193),a=n.n(r),s=(n(44194),n(2348)),i=n(68992),o=n(45634),l=n.n(o),u=n(46130),d=n(61489),c=n(87005),f=n(31549),g=function(e){var t=e.children,n=e.onSuccess,r=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,u.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),d.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(s.Z,a()(a()({},g),{},{children:t}))}},80690:function(e,t,n){n.r(t),n.d(t,{default:function(){return fe}});var r=n(44194),a=n(44528),s=n(62395),i=n(76711),o=n.n(i),l=n(73193),u=n.n(l),d=n(90819),c=n.n(d),f=n(89933),g=n.n(f),m=n(45332),p=n.n(m),v=n(88130),h=n(72264),x=n(13243),M=n(60593),b=n(42876),y=n(89654),w=n(33633),j=n(15065),k=n(77902),S=n(6992),Z=n(41881),C=n(91768),U=n(66759),F=n(61489),I=n(18313),P=n(77686),T=n(38552),A=n(70097),O=n(68992),q=n(91733),z=n(84005),N=(n(98257),n(30394)),E=(n(57648),n(23968),n(70878)),R=n(66248),D=n(31549),L=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,i=e.record,o=e.onSuccess,l=(0,s.useIntl)(),d=E.Z.useForm(),f=p()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(i?f.setFieldsValue({name:i.name||"",description:i.description||"",enabled:null===(e=i.enabled)||void 0===e||e,isDefault:null!==(n=i.isDefault)&&void 0!==n&&n}):(f.resetFields(),f.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,i,f]);var m=function(){var e=g()(c()().mark((function e(){var t,r,s,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.validateFields();case 3:if(t=e.sent,r=u()(u()({},t),{},{orgUid:a,uid:null==i?void 0:i.uid}),null==i||!i.uid){e.next=11;break}return e.next=8,(0,I.wU)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,I.IH)(r);case 13:e.t0=e.sent;case 14:(s=e.t0)&&200===s.code?(d=s.data||{},F.yw.success(l.formatMessage({id:null!=i&&i.uid?"common.updated":"common.created",defaultMessage:null!=i&&i.uid?"更新成功":"创建成功"})),null==o||o(d),n(!1)):F.yw.error((null==s?void 0:s.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,D.jsx)(R.Z,{title:(0,D.jsx)(s.FormattedMessage,{id:null!=i&&i.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=i&&i.uid?"编辑模板":"新建模板"}),open:t,onOk:m,onCancel:function(){n(!1)},okText:(0,D.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,D.jsx)(s.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,D.jsxs)(E.Z,{form:f,layout:"vertical",preserve:!1,children:[(0,D.jsx)(E.Z.Item,{name:"name",label:(0,D.jsx)(s.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,D.jsx)(x.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,D.jsx)(E.Z.Item,{name:"description",label:(0,D.jsx)(s.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,D.jsx)(x.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,D.jsx)(E.Z.Item,{name:"enabled",label:(0,D.jsx)(s.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,D.jsx)(j.Z,{})})]})})},V=n(51898),B=n(28672),J=n(65448),_="welcome",H=function(){var e=(0,s.useIntl)(),t=(0,P.u)((function(e){return e.currentOrg})),n=(0,T.Z)(),i=n.leftSiderStyle,l=(n.contentStyle,(0,A.Z)().isDarkMode),d=(0,r.useState)(!1),f=p()(d,2),m=f[0],E=f[1],R=(0,r.useState)([]),H=p()(R,2),K=H[0],W=H[1],X=(0,r.useState)(),G=p()(X,2),Y=G[0],$=G[1],Q=(0,r.useState)(""),ee=p()(Q,2),te=ee[0],ne=ee[1],re=(0,r.useState)(_),ae=p()(re,2),se=ae[0],ie=ae[1],oe=(0,r.useState)(!1),le=p()(oe,2),ue=le[0],de=le[1],ce=(0,r.useState)(null),fe=p()(ce,2),ge=fe[0],me=fe[1],pe=(0,r.useMemo)((function(){return K.find((function(e){return e.uid===Y}))||null}),[K,Y]),ve=(0,r.useState)(!1),he=p()(ve,2),xe=he[0],Me=he[1],be=(0,r.useState)(!1),ye=p()(be,2),we=ye[0],je=ye[1],ke=(0,q.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),Se=ke.setCurrentAgentSettings,Ze=ke.currentAgentSettings,Ce=(0,r.useState)(!1),Ue=p()(Ce,2),Fe=Ue[0],Ie=Ue[1],Pe=(0,r.useRef)(""),Te=(0,r.useMemo)((function(){if(!te)return K;var e=te.toLowerCase();return K.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[K,te]),Ae=(0,r.useCallback)(function(){var e=g()(c()().mark((function e(n,r){var a,s,i,o,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return E(!0),e.prev=3,s=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=8,(0,I.u9)(i);case 8:o=e.sent,console.log("查询客服配置模板列表结果：",o,i),l=(null==o||null===(a=o.data)||void 0===a?void 0:a.content)||[],W(l),!(l.length>0)||Y&&l.some((function(e){return e.uid===Y}))||($(l[0].uid),null!=r&&r.keepActive||ie(_));case 13:return e.prev=13,E(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,Y]);(0,r.useEffect)((function(){Ae(te)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){pe?(Se(pe),Pe.current=JSON.stringify(null!=pe?pe:{}),Ie(!1)):(Se(null),Pe.current=JSON.stringify({}),Ie(!1))}),[Y]),(0,r.useEffect)((function(){if(pe)try{var e=JSON.stringify(null!=Ze?Ze:{});Ie(e!==Pe.current)}catch(e){Ie(!0)}}),[Ze,null==pe?void 0:pe.uid]);var Oe=function(){var n=g()(c()().mark((function n(r){var a,s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:pe)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,I.SJ)(s);case 6:i=n.sent,console.log("删除客服配置模板结果：",i,s),i&&200===i.code?(F.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Ae(te)):F.yw.error((null==i?void 0:i.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),qe=function(){var n=g()(c()().mark((function n(r,a){var s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:r,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,I.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,I.iO)(s);case 10:n.t0=n.sent;case 11:(i=n.t0)&&200===i.code?(F.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),Ae(te)):F.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),F.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),ze=function(){var n=g()(c()().mark((function n(){var r,a,s,i,o,l,d,f,g,m;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return F.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Me(!0),n.prev=4,r=Ze&&Ze.uid===pe.uid?Ze:pe,(a=JSON.parse(JSON.stringify(r||{}))).serviceSettings&&(s=a.serviceSettings,i=s.welcomeKbUid,o=s.welcomeFaqUids,l=s.welcomeTip,a.draftServiceSettings=u()(u()(u()(u()(u()({},a.draftServiceSettings||{}),a.serviceSettings||{}),i?{welcomeKbUid:i}:{}),Array.isArray(o)?{welcomeFaqUids:o}:{}),"string"==typeof l?{welcomeTip:l}:{})),d=u()({uid:pe.uid,orgUid:null==t?void 0:t.uid},a),n.next=11,(0,I.wU)(d);case 11:f=n.sent,console.log("保存客服配置模板结果：",f,d),f&&200===f.code?(F.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Pe.current=JSON.stringify(null!==(g=null!==(m=f.data)&&void 0!==m?m:r)&&void 0!==g?g:{}),Ie(!1),Ae(te,{keepActive:!0})):F.yw.error((null==f?void 0:f.message)||"保存失败"),n.next=20;break;case 16:n.prev=16,n.t0=n.catch(4),console.error("保存失败:",n.t0),F.yw.error("保存失败");case 20:return n.prev=20,Me(!1),n.finish(20);case 23:case"end":return n.stop()}}),n,null,[[4,16,20,23]])})));return function(){return n.apply(this,arguments)}}(),Ne=function(){var n=g()(c()().mark((function n(){var r,a,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return F.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(je(!0),n.prev=4,!Fe){n.next=8;break}return n.next=8,ze();case 8:return r={uid:pe.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,I.Xy)(r);case 11:(a=n.sent)&&200===a.code?(F.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Pe.current=JSON.stringify(null!==(s=a.data)&&void 0!==s?s:{}),Ie(!1),Ae(te)):F.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),F.yw.error("发布失败");case 19:return n.prev=19,je(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Ee=(0,r.useMemo)((function(){return null!=pe&&pe.uid?[{key:"welcome",label:(0,D.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,D.jsx)(J.Z,{type:O.Njn,settingsUid:pe.uid})},{key:"tips",label:(0,D.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"}),children:(0,D.jsx)(B.Z,{type:O.Njn,settingsUid:pe.uid})},{key:"service",label:(0,D.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"}),children:(0,D.jsx)(V.Z,{type:O.Njn,settingsUid:pe.uid})},{key:"rate",label:(0,D.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,D.jsx)(z.Z,{type:O.Njn,settingsUid:pe.uid})}].concat(o()([]),[{key:"right",label:(0,D.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,D.jsx)(N.Z,{type:O.Njn,settingsUid:pe.uid})}],o()([]),o()([])):[]}),[null==pe?void 0:pe.uid,e]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,D.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:i,children:(0,D.jsxs)(U.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,D.jsx)(h.ZP,{size:"small",icon:(0,D.jsx)(S.Z,{}),type:"primary",onClick:function(){me(null),de(!0)},children:(0,D.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:m,children:[(0,D.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,D.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:te,onChange:function(e){return ne(e.target.value)},onSearch:function(e){ne(e),Ae(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,D.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,D.jsx)(M.Z,{dataSource:Te,locale:{emptyText:(0,D.jsx)(b.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:b.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,D.jsx)(M.Z.Item,{style:Y===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return $(e.uid)},children:(0,D.jsx)(M.Z.Item.Meta,{title:(0,D.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,D.jsx)(y.Z,{size:4,children:e.isDefault?(0,D.jsx)(w.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,D.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,D.jsx)(v.Z.Panel,{children:pe?(0,D.jsx)(U.Z,{title:(0,D.jsxs)(y.Z,{children:[(0,D.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",pe.name||pe.uid]}),(0,D.jsx)(j.Z,{checked:pe.enabled,onChange:function(e){return qe(pe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,D.jsx)(h.ZP,{size:"small",icon:(0,D.jsx)(Z.Z,{}),onClick:function(e){var t;e.stopPropagation(),me(null!=(t=pe)?t:pe),de(!0)},children:"编辑"}),(0,D.jsx)(k.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Oe(pe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,D.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,D.jsx)(C.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),pe.isDefault?(0,D.jsx)(w.Z,{color:"blue",children:"默认"}):null]}),extra:(0,D.jsxs)(y.Z,{children:[(0,D.jsx)(k.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ne()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,D.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:we,type:"default",children:(0,D.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,D.jsx)(h.ZP,{onClick:function(){pe&&(Se(pe),Pe.current=JSON.stringify(null!=pe?pe:{}),Ie(!1))},disabled:!Fe,children:(0,D.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,D.jsx)(h.ZP,{type:"primary",loading:xe,onClick:ze,disabled:!Fe,children:(0,D.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,D.jsx)(a.Z,{activeKey:se,onChange:ie,items:Ee,style:{minHeight:"calc(100vh - 280px)"}})}):(0,D.jsx)(U.Z,{children:(0,D.jsx)(b.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,D.jsx)(L,{open:ue,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:ge,onSuccess:function(){de(!1),Ae(te)}})]})},K=n(54596),W=n(27401),X=n(6677),G=n(2915),Y=n(89007),$=n(50447),Q=n(47268),ee=n(26608),te=n(22014),ne=n(6090),re=n(65041),ae=function(e){var t,n,a=e.open,i=e.record,l=e.onClose,d=e.onSuccess,f=(0,s.useIntl)(),m=(0,P.u)((function(e){return e.currentOrg})),v=(0,r.useState)(!1),x=p()(v,2),M=x[0],b=x[1],y=(0,r.useState)([]),w=p()(y,2),j=w[0],k=w[1],Z=(0,r.useState)(!1),C=p()(Z,2),U=C[0],T=C[1],A=(0,r.useState)((null==i?void 0:i.avatar)||""),O=p()(A,2),q=O[0],z=O[1],N=(0,r.useState)(0),E=p()(N,2),R=E[0],V=E[1],B=(0,r.useRef)(),J=(0,r.useMemo)((function(){return!(null==i||!i.uid)}),[i]),_=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z(t),F.yw.success(f.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=(0,r.useCallback)(function(){var e=g()(c()().mark((function e(t){var n,r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==m?void 0:m.uid,searchText:t||""},e.next=5,(0,I.u9)(r);case 5:return a=e.sent,console.log("queryAgentSettingsByOrg request:",r,a),s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],k(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 10:return e.prev=10,T(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[1,,10,13]])})));return function(t){return e.apply(this,arguments)}}(),[null==m?void 0:m.uid]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(G.a,{open:a,onOpenChange:function(e){e||l()},title:J?f.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):f.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:B,initialValues:J?{nickname:null==i?void 0:i.nickname,email:null==i?void 0:i.email,mobile:null==i?void 0:i.mobile,description:null==i?void 0:i.description,memberUid:(null==i||null===(t=i.member)||void 0===t?void 0:t.uid)||(null==i?void 0:i.memberUid),settingsUid:null==i||null===(n=i.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:f.formatMessage({id:"save",defaultMessage:"保存"}),resetText:f.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return l()}}},onFinish:function(){var e=g()(c()().mark((function e(t){var n,r,a,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F.yw.loading(f.formatMessage({id:J?"updating":"creating",defaultMessage:J?"Updating":"Creating"})),!J){e.next=10;break}return a=u()(u()(u()({},i),t),{},{avatar:q||(null==i?void 0:i.avatar)}),e.next=6,(0,X.sE)(a);case 6:r=e.sent,console.log("updateAgent payload:",a,r),e.next=15;break;case 10:return s={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==m?void 0:m.uid,avatar:q},e.next=13,(0,X.x_)(s);case 13:r=e.sent,console.log("createAgent payload:",s,r);case 15:if(F.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=23;break}return F.yw.success(f.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(r.data),l(),e.abrupt("return",!0);case 23:return F.yw.error((null===(o=r)||void 0===o?void 0:o.message)||f.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),F.yw.destroy(),F.yw.error(f.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,D.jsx)(Y.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:f.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,D.jsxs)(re.G,{onSuccess:_,onError:function(e){F.yw.error(String(e))},children:[(0,D.jsx)(W.Z,{src:q||(null==i?void 0:i.avatar)}),(0,D.jsxs)(h.ZP,{icon:(0,D.jsx)(te.Z,{}),children:[" ",f.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,D.jsx)($.Z,{name:"memberUid",label:f.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:f.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:J,rules:J?[]:[{required:!0,message:f.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=g()(c()().mark((function e(t){var n,r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.keyWords,e.next=3,(0,ne.z_)({pageNumber:0,pageSize:20,orgUid:null==m?void 0:m.uid,searchText:r||""});case 3:return a=e.sent,s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,D.jsx)($.Z,{name:"settingsUid",label:f.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),placeholder:f.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),rules:[{required:!0,message:f.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:R},request:function(){var e=g()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",H(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:U,notFoundContent:0===j.length?(0,D.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,D.jsx)("div",{style:{marginBottom:8,color:"#999"},children:f.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,D.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,D.jsx)(S.Z,{}),onClick:function(){return b(!0)},children:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,D.jsx)(h.ZP,{size:"small",icon:(0,D.jsx)(S.Z,{}),onClick:function(){return b(!0)},title:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"}),children:f.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,D.jsx)(Q.Z,{name:"nickname",label:f.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.nickname.required"})}]}),(0,D.jsx)(Q.Z,{name:"email",label:f.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.email.required"})}]}),(0,D.jsx)(Q.Z,{name:"mobile",label:f.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.mobile.required"})}]}),(0,D.jsx)(ee.Z,{name:"description",label:f.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,D.jsx)(L,{open:M,onOpenChange:b,orgUid:(null==m?void 0:m.uid)||"",record:null,onSuccess:function(e){var t;b(!1),k((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(o()(t))})),V((function(e){return e+1})),null===(t=B.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},se=n(83767),ie=n(66675),oe=n(97117),le=n(79481),ue=n(12715),de=function(e){var t=e.open,n=e.onClose,a=e.onSubmit,s=oe.ZP.useForm(),i=p()(s,1)[0],l=(0,P.u)((function(e){return e.currentOrg})),d=(0,se.Z)((function(e){return e.memberResult})),f=(0,se.Z)((function(e){return e.setMemberResult})),m=(0,ie.E)((function(e){return e.agentResult})),v=(0,r.useState)(0),M=p()(v,2),b=M[0],y=M[1],w=(0,r.useState)(""),j=p()(w,2),k=j[0],S=j[1],Z=(0,r.useState)(!1),C=p()(Z,2),U=C[0],F=C[1],T=(0,r.useState)([]),A=p()(T,2),O=A[0],q=A[1],z=(0,r.useRef)(null),N=(0,r.useState)(0),E=p()(N,2),L=E[0],V=E[1],B=(0,r.useState)(!0),J=p()(B,2),_=J[0],H=J[1],K=(0,r.useState)(!1),W=p()(K,2),X=W[0],G=W[1],Y=(0,r.useState)(0),ee=p()(Y,2),te=ee[0],re=ee[1],ae=(0,r.useState)(!0),de=p()(ae,2),ce=de[0],fe=de[1],ge=(0,r.useState)(!1),me=p()(ge,2),pe=me[0],ve=me[1],he=(0,r.useState)(!1),xe=p()(he,2),Me=xe[0],be=xe[1],ye=(0,r.useState)([]),we=p()(ye,2),je=we[0],ke=we[1];(0,r.useEffect)((function(){var e;t&&(console.log("Modal opened, current agent data:",m),console.log("Current member data:",d),null!=d&&null!==(e=d.data)&&void 0!==e&&e.content&&0!==d.data.content.length||g()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==l?void 0:l.uid},e.next=4,(0,ne.z_)(n);case 4:r=e.sent,console.log("Init load members response:",r,n),(a=(null==r||null===(t=r.data)||void 0===t?void 0:t.content)||[]).length>0&&f(u()(u()({},d),{},{data:u()(u()({},null==d?void 0:d.data),{},{content:a})})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Init load members failed:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),g()(c()().mark((function e(){var t,n,r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,be(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==l?void 0:l.uid,searchText:""},e.next=5,(0,I.u9)(n);case 5:r=e.sent,a=(null==r||null===(t=r.data)||void 0===t?void 0:t.content)||[],s=a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),ke(s),!i.getFieldValue("settingsUid")&&s.length>0&&i.setFieldsValue({settingsUid:s[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,be(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))())}),[t,m,d]),(0,r.useEffect)((function(){return function(){z.current&&clearTimeout(z.current)}}),[]);var Se=(0,r.useMemo)((function(){var e=m.data.content.map((function(e){var t;return(null===(t=e.member)||void 0===t?void 0:t.uid)||e.memberUid})).filter((function(e){return e}));return console.log("Existing agent member UIDs:",e),console.log("Agent result data:",m.data.content),e}),[m]),Ze=(0,r.useMemo)((function(){var e,t,n,r=[],a=k.trim()?O:(null==d||null===(e=d.data)||void 0===e?void 0:e.content)||[];console.log("Total members:",a.length),console.log("Existing agent member UIDs:",Se),console.log("Using search results:",!!k.trim());for(var s=0;s<a.length;s++){var i=a[s];if(Se.includes(i.uid))console.log("Filtering out member:",i.nickname,i.uid);else{var o={title:"",value:"",children:[]};(n=o).title=(t=i).nickname,n.value=t.uid,r.push(o)}}return console.log("Filtered tree data:",r),r}),[d,O,k,Se]),Ce=function(){var e=g()(c()().mark((function e(t){var n,r,a,s,i=arguments;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],console.log("handleSearch:",t,"isLoadMore:",n),t.trim()||n){e.next=7;break}return q([]),V(0),H(!0),e.abrupt("return");case 7:return n?G(!0):F(!0),e.prev=8,r={pageNumber:n?L+1:0,pageSize:20,orgUid:null==l?void 0:l.uid,searchText:t.trim()},e.next=12,(0,ne.z_)(r);case 12:a=e.sent,console.log("handleSearch Search members response:",a,r),200===a.code?(s=a.data.content||[],n?(q((function(e){return[].concat(o()(e),o()(s))})),V(L+1)):(q(s),V(0)),H(!a.data.last)):(console.error("handleSearch Search failed:",a.message),n||q([])),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),console.error("Search error:",e.t0),n||q([]);case 21:return e.prev=21,n?G(!1):F(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[8,17,21,24]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(e){var t=e.target.value;S(t),z.current&&clearTimeout(z.current),t.trim()?z.current=setTimeout((function(){Ce(t)}),300):(q([]),V(0),H(!0))},Fe=function(){Ce(k)},Ie=function(){!X&&_&&k.trim()&&Ce(k,!0)},Pe=function(){var e=g()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe||!ce){e.next=17;break}return ve(!0),e.prev=2,t={pageNumber:te+1,pageSize:20,orgUid:null==l?void 0:l.uid},e.next=6,(0,ne.z_)(t);case 6:n=e.sent,console.log("Load more all members response:",n),200===n.code&&(r=n.data.content||[],a=[].concat(o()(d.data.content),o()(r)),f(u()(u()({},d),{},{data:u()(u()({},d.data),{},{content:a})})),re(te+1),fe(!n.data.last)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 14:return e.prev=14,ve(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(){return e.apply(this,arguments)}}();return(0,D.jsx)("div",{children:(0,D.jsx)(R.Z,{title:"创建客服",open:t,forceRender:!0,onOk:function(){console.log("handleOk"),i.validateFields().then((function(e){var t;console.log("form values:",e);var n=i.getFieldValue("memberUids"),r=i.getFieldValue("nickname"),s=i.getFieldValue("email"),o=i.getFieldValue("mobile"),u=i.getFieldValue("settingsUid"),c=k.trim()?O:(null==d||null===(t=d.data)||void 0===t?void 0:t.content)||[],f=[];if(1===n.length){var g={nickname:r,email:s,mobile:o,memberUid:n[0],orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(g)}else n.forEach((function(e){var t=c.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(n)}}));console.log("agents:",f),a(f)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,D.jsxs)(oe.ZP,{form:i,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,D.jsx)($.Z,{label:"客服配置",name:"settingsUid",tooltip:"为本次创建的客服指定配置模板",rules:[{required:!0,message:"请选择客服配置!"}],fieldProps:{options:je,loading:Me,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:"请选择客服配置"}}),(0,D.jsx)(le.Z,{label:"绑定成员",name:"memberUids",tooltip:"请先到组织-》成员-》创建成员，已创建过客服的成员将被过滤",rules:[{required:!0,message:"请选择成员!"}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:"请选择成员（可多选）",onChange:function(e){var t;console.log("onTreeSelectChange:",e),y(e.length);var n=k.trim()?O:(null==d||null===(t=d.data)||void 0===t?void 0:t.content)||[];if(0===e.length)i.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===e.length){var r=n.find((function(t){return t.uid===e[0]}));r&&i.setFieldsValue({nickname:r.nickname||"",email:r.email||"",mobile:r.mobile||""})}else{var a=n.filter((function(t){return e.includes(t.uid)})),s=a.map((function(e){return e.nickname})).filter(Boolean).join(", "),o=a.map((function(e){return e.email})).filter(Boolean).join(", "),l=a.map((function(e){return e.mobile})).filter(Boolean).join(", ");i.setFieldsValue({nickname:s,email:o,mobile:l})}},treeData:Ze,variant:"outlined",dropdownRender:function(e){return(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,D.jsx)(x.Z,{placeholder:"搜索成员",value:k,onChange:Ue,onPressEnter:function(){return Fe()},suffix:(0,D.jsx)(ue.Z,{onClick:Fe,style:{cursor:"pointer",color:U?"#1890ff":void 0},spin:U}),allowClear:!0,size:"small"})}),e,(k.trim()?_:ce)&&(0,D.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,D.jsx)(h.ZP,{type:"link",size:"small",loading:k.trim()?X:pe,onClick:k.trim()?Ie:Pe,disabled:k.trim()?X:pe,children:(k.trim()?X:pe)?"加载中...":"加载更多"})})]})}}}),(0,D.jsx)(Q.Z,{label:"昵称",name:"nickname",disabled:b>1,tooltip:b>1?"多选模式下昵称将自动从选中的成员信息中获取":"昵称将自动从选中的成员信息中获取"}),(0,D.jsx)(Q.Z,{label:"邮箱",name:"email",disabled:b>1,tooltip:b>1?"多选模式下邮箱将自动从选中的成员信息中获取":"邮箱将自动从选中的成员信息中获取"}),(0,D.jsx)(Q.Z,{label:"手机号",name:"mobile",disabled:b>1,tooltip:b>1?"多选模式下手机号将自动从选中的成员信息中获取":"手机号将自动从选中的成员信息中获取"})]})})})},ce=function(){var e=(0,s.useIntl)(),t=(0,r.useRef)(),n=(0,P.u)((function(e){return e.currentOrg})),a=(0,r.useState)(!1),i=p()(a,2),o=i[0],l=i[1],u=(0,r.useState)(!1),d=p()(u,2),f=d[0],m=d[1],v=(0,r.useState)(null),x=p()(v,2),M=x[0],b=x[1],y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,D.jsx)(W.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0},{title:e.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,D.jsx)("a",{onClick:function(){b(n),l(!0)},children:n.settings.name||e.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,D.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){b(n),l(!0)},children:e.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(t,n){switch(null==n?void 0:n.status){case O.Ra4:return(0,D.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case O.tU$:return(0,D.jsx)(w.Z,{color:"orange",children:e.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case O.LZ1:default:return(0,D.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:e.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(t,n){return null!=n&&n.connected?(0,D.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,D.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,D.jsx)("a",{onClick:function(){return s.history.push("/service/channel")},children:e.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,D.jsx)("a",{onClick:function(){b(r),l(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,D.jsx)(k.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:g()(c()().mark((function n(){var a,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return F.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,X.Lr)(r);case 4:a=n.sent,F.yw.destroy(),200===(null==a?void 0:a.code)?(F.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=t.current)||void 0===s||s.reload()):F.yw.error((null==a?void 0:a.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),F.yw.destroy(),F.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,D.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(K.Z,{columns:y,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,D.jsx)(h.ZP,{type:"primary",onClick:function(){b(null),m(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=g()(c()().mark((function e(t,r){var a,s,i,o,l,u,d,f,g,m,p,v,h,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(a=null==t?void 0:t.current)&&void 0!==a?a:1)-1,l=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,u=null!==(i=null==t?void 0:t.searchText)&&void 0!==i?i:"",d={pageNumber:o,pageSize:l,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:u},e.prev=4,e.next=7,(0,X._t)(d);case 7:if(f=e.sent,console.log("queryAgentsByOrg response:",f,d),200!==(null==f?void 0:f.code)){e.next=13;break}return x=(null==f||null===(g=f.data)||void 0===g?void 0:g.content)||[],M=null!==(m=null!==(p=null==f||null===(v=f.data)||void 0===v?void 0:v.totalElements)&&void 0!==p?p:null==f||null===(h=f.data)||void 0===h?void 0:h.numberOfElements)&&void 0!==m?m:x.length,e.abrupt("return",{data:x,total:M,success:!0});case 13:return e.abrupt("return",{data:[],total:0,success:!1});case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent",defaultMessage:"Agent"})}),o&&(0,D.jsx)(ae,{open:o,record:M,onClose:function(){return l(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),f&&(0,D.jsx)(de,{open:f,onClose:function(){return m(!1)},onSubmit:function(){var n=g()(c()().mark((function n(r){var a,s,i,o;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return F.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,Promise.allSettled(r.map((function(e){return(0,X.x_)(e)})));case 4:a=n.sent,F.yw.destroy(),s=a.filter((function(e){var t;return"fulfilled"===e.status&&200===(null===(t=e.value)||void 0===t?void 0:t.code)})).length,i=a.length-s,s>0&&(F.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(s,")")),m(!1),null===(o=t.current)||void 0===o||o.reload()),i>0&&F.yw.warning(e.formatMessage({id:"create.partial.fail",defaultMessage:"Some items failed to create"})+" (".concat(i,")")),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(1),F.yw.destroy(),F.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 16:case"end":return n.stop()}}),n,null,[[1,12]])})));return function(e){return n.apply(this,arguments)}}()})]})},fe=function(){return(0,D.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,D.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,D.jsx)(ce,{})},{key:"settings",label:(0,D.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,D.jsx)(H,{})}]})}},83767:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(68992),a=n(58063),s=n(66266),i=n(31403),o=(0,a.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);