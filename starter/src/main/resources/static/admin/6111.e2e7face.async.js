"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6111],{95437:function(e,t,a){a.d(t,{$Z:function(){return p},W5:function(){return u}});var n=a(90819),r=a.n(n),s=a(73193),o=a.n(s),i=a(89933),l=a.n(i),d=a(94976),c=a(4628);a(67242);function u(e){return g.apply(this,arguments)}function g(){return(g=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/message/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/message/delete",{method:"POST",data:o()(o()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36111:function(e,t,a){var n=a(84176),r=a.n(n),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),p=a(45332),f=a.n(p),m=a(43388),h=a(95437),x=a(88722),M=a(74171),v=a(94976),y=a(58620),w=a(16658),b=a(54881),k=a(11090),S=a(2484),j=a(44565),Z=a(4628),C=a(43275),I=a(27729),T=a(28508),F=a(69533),A=a(44194),E=a(85977),D=a(31549),O=["current","pageSize"];t.Z=function(e){var t,a,n,s,i,d,u=e.type,p=e.superUser,R=(0,Z.useIntl)(),U=(0,A.useRef)(),z=(0,x.Z)().translateString,P=(0,M.u)((function(e){return e.currentOrg})),q=(0,Z.useAccess)(),N=(0,A.useMemo)((function(){var e;return null==q||null===(e=q.getModulePermission)||void 0===e?void 0:e.call(q,E.MY.MESSAGE)}),[q]),B=null!==(t=null==N||null===(a=N.canRead)||void 0===a?void 0:a.call(N))&&void 0!==t&&t,G=null!==(n=null==N||null===(s=N.canDelete)||void 0===s?void 0:s.call(N))&&void 0!==n&&n,L=null!==(i=null==N||null===(d=N.canExport)||void 0===d?void 0:d.call(N))&&void 0!==i&&i,W=function(e,t){m.yw.warning(R.formatMessage({id:e,defaultMessage:t}))},$=(0,A.useState)(1),J=f()($,2),K=J[0],Y=J[1],H=(0,A.useState)(10),Q=f()(H,2),V=Q[0],X=Q[1],_=(0,A.useState)([]),ee=f()(_,2),te=ee[0],ae=ee[1],ne=(0,A.useState)([]),re=f()(ne,2),se=re[0],oe=re[1],ie=(0,A.useState)(0),le=f()(ie,2),de=le[0],ce=le[1],ue=(0,A.useState)({}),ge=f()(ue,2),pe=ge[0],fe=ge[1],me=function(){var e=g()(c()().mark((function e(t){var a,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return W("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:return console.log("handleDeleteConfirm",t),m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=5,e.next=8,(0,h.$Z)({uid:t.uid});case 8:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(R.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==U||null===(n=U.current)||void 0===n||n.reload()):m.yw.error(a.message||R.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),m.yw.destroy(),m.yw.error(R.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(Z.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(Z.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,ellipsis:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,D.jsx)(D.Fragment,{children:z(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,D.jsx)(Z.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,D.jsx)(Z.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,w.ng)(null==t?void 0:t.status)}},{title:(0,D.jsx)(Z.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,w.OI)(t.type)}},{title:(0,D.jsx)(Z.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,w.YG)(t.channel)}},{title:(0,D.jsx)(Z.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(Z.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:R.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,n){var r=[(0,D.jsx)("a",{onClick:function(){!function(e){var t,a,n;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:v.CCt,sid:null==e||null===(a=e.thread)||void 0===a?void 0:a.uid}};null===(n=window.bytedesk)||void 0===n||n.showChat(r)}(t)},children:R.formatMessage({id:"view",defaultMessage:"View"})},"editable")];return G&&r.push((0,D.jsx)(C.Z,{title:R.formatMessage({id:"deleteTip"}),description:"".concat(R.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return me(t)},okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"}),children:(0,D.jsx)("a",{style:{color:"red",marginLeft:8},children:R.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),r}}],xe=function(){var e=g()(c()().mark((function e(){var t,a,n,r,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return W("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:if(0!==se.length){e.next=6;break}return m.yw.warning(R.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,n=0,r=l()(se),e.prev=10,r.s();case 12:if((s=r.n()).done){e.next=26;break}return o=s.value,e.prev=14,e.next=17,(0,h.$Z)({uid:o.uid});case 17:200===e.sent.code?a++:n++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),n++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),r.e(e.t1);case 31:return e.prev=31,r.f(),e.finish(31);case 34:m.yw.destroy(),0===n?m.yw.success(R.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(R.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:n})),ae([]),oe([]),null===(t=U.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=g()(c()().mark((function e(t,a,n){var r,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=3;break}return W("message.permission.export.denied","无权限：导出消息"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,n),r=localStorage.getItem(v.LA8),s=o()({componentType:u,orgUid:(null==P?void 0:P.uid)||"",accessToken:r||"",exportType:t},pe),"current"===t?(s.pageNumber=String(K-1),s.pageSize=String(V)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==n&&(s.pageNumber=String(a),s.pageSize=String(n)),window.open((0,y.kG)()+"/api/v1/message/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],a=1e3,n=Math.ceil(e/a),r=function(){var n=s,r=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return Me("range",n,a)}})},s=0;s<n;s++)r();return t},ye={selectedRowKeys:te,onChange:function(e,t){ae(e),oe(t)}};return(0,D.jsx)(j.Z,{columns:he,actionRef:U,cardBordered:!0,rowSelection:ye,scroll:{x:1500},request:function(){var e=g()(c()().mark((function e(t,a,n){var s,i,l,d,g,f,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=4;break}return W("message.permission.read.denied","无权限：查看消息"),ce(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return console.log("request:",t,a,n),s=t.current,i=t.pageSize,l=r()(t,O),Y(s),X(i),fe(l),d=void 0,g=void 0,a&&Object.keys(a).length>0&&(f=Object.keys(a)[0],d=f,g="ascend"===a[f]?"ascend":"descend"),x=o()(o()({pageNumber:s-1,pageSize:i,componentType:u,orgUid:null==P?void 0:P.uid,superUser:p},l),{},{sortBy:d,sortDirection:g}),e.next=15,(0,h.W5)(x);case 15:return M=e.sent,console.log("getAllMessages response:",x,M),200===M.code?ce(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){Y(e),X(t)}},dateFormatter:"string",headerTitle:R.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];if(G&&te.length>0&&t.push({key:"batchDelete",icon:(0,D.jsx)(b.Z,{}),danger:!0,label:R.formatMessage({id:"batch.delete"})+" (".concat(te.length,")"),onClick:function(){I.Z.confirm({title:R.formatMessage({id:"batch.deleteTip"}),content:"".concat(R.formatMessage({id:"batch.deleteAffirm"})," ").concat(te.length," ").concat(R.formatMessage({id:"items"}),"?"),onOk:xe,okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"})})}}),L){var a=[{key:"export-current",icon:(0,D.jsx)(k.Z,{}),label:R.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];de>0&&(de<=1e3?a.push({key:"export-all",icon:(0,D.jsx)(k.Z,{}),label:R.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(de,"条)"),onClick:function(){return Me("all")}}):a.push({key:"export-range",icon:(0,D.jsx)(k.Z,{}),label:R.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(de,"条)"),children:ve(de)})),e.push((0,D.jsx)(T.Z,{menu:{items:a},placement:"bottom",children:(0,D.jsxs)(F.ZP,{type:"primary",icon:(0,D.jsx)(k.Z,{}),children:[R.formatMessage({id:"export",defaultMessage:"Export"}),(0,D.jsx)(S.Z,{})]})},"export"))}return t.length>0&&e.push((0,D.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(F.ZP,{type:te.length>0?"primary":"default",danger:te.length>0,children:[te.length>0?R.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(te.length,")"):R.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,D.jsx)(S.Z,{})]})},"batchOperations")),e}()}})}}}]);