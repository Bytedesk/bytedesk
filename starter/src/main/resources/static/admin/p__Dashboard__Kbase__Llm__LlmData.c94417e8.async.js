"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{58275:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},47944:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},61353:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}},{tag:"path",attrs:{d:"M894 345a343.92 343.92 0 00-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4a31.95 31.95 0 0040.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1A367.31 367.31 0 00729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"}},{tag:"path",attrs:{d:"M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}}]},name:"comment",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},42085:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},71529:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},2484:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},58087:function(e,t,n){var r=n(11757),a=n(44194),s=n(15323),o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s.Z}))},l=a.forwardRef(i);t.Z=l},79907:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(35175),i=n(31549),l=["fieldProps","min","proFieldProps","max"],u=function(e,t){var n=e.fieldProps,s=e.min,u=e.proFieldProps,c=e.max,d=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"digit",fieldProps:(0,r.Z)({min:s,max:c},n),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:u},d))},c=s.forwardRef(u);t.Z=c},65895:function(e,t,n){var r=n(17082),a=n(73457),s=n(82308),o=n(67402),i=n(44194),l=n(69088),u=n(35175),c=n(31549),d=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],f=i.forwardRef((function(e,t){var n=e.fieldProps,o=e.options,i=e.radioType,l=e.layout,f=e.proFieldProps,g=e.valueEnum,p=(0,a.Z)(e,d);return(0,c.jsx)(u.Z,(0,r.Z)((0,r.Z)({valueType:"button"===i?"radioButton":"radio",ref:t,valueEnum:(0,s.h)(g,void 0)},p),{},{fieldProps:(0,r.Z)({options:o,layout:l},n),proFieldProps:f,filedConfig:{customLightMode:!0}}))})),g=i.forwardRef((function(e,t){var n=e.fieldProps,a=e.children;return(0,c.jsx)(o.ZP,(0,r.Z)((0,r.Z)({},n),{},{ref:t,children:a}))})),p=(0,l.G)(g,{valuePropName:"checked",ignoreWidth:!0});p.Group=f,p.Button=o.ZP.Button,p.displayName="ProFormComponent",t.Z=p},48708:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(35175),i=n(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=s.forwardRef((function(e,t){var n=e.fieldProps,s=e.unCheckedChildren,u=e.checkedChildren,c=e.proFieldProps,d=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:s,checkedChildren:u},n),ref:t,valuePropName:"checked",proFieldProps:c,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=u},32350:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(35175),i=n(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var n=e.fieldProps,s=e.proFieldProps,u=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:s},u))};t.Z=s.forwardRef(u)},92053:function(e,t,n){n.d(t,{G9:function(){return b},J$:function(){return k},N6:function(){return M},VM:function(){return u},c8:function(){return d},gF:function(){return m},rg:function(){return g},sF:function(){return x}});var r=n(90819),a=n.n(r),s=n(89933),o=n.n(s),i=n(55735),l=n(30921);function u(){return c.apply(this,arguments)}function c(){return(c=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/library/models/"+t+"/details",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/models/"+t+"/details",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/models/pull",{method:"POST",params:{client:i.bVn},data:{model:t}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/models/delete",{method:"POST",params:{client:i.bVn},data:{model:t}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return j.apply(this,arguments)}function j(){return(j=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/embedding-model/exists",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},80876:function(e,t,n){var r=n(45332),a=n.n(r),s=n(40612),o=n(55735),i=n(69169),l=n(4499),u=n(84881),c=n(30921),d=n(53530),f=n(44194),g=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,p=(0,c.useIntl)(),m=i.A.useForm(),h=a()(m,1)[0],x=(0,s.u)((function(e){return e.currentOrg})),v=function(){console.log("handleSaveRobot"),h.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},kbEnabled:!1,orgUid:null==x?void 0:x.uid};console.log("robotObject:",t),r(t),h.resetFields()})).catch((function(e){console.log("Form errors:",e)}))};return(0,f.useEffect)((function(){console.log("RobotForm useEffect"),t&&(h.resetFields(),h.setFieldsValue({type:o.f4h}))}),[t,h]),(0,g.jsx)("div",{children:(0,g.jsx)(d.Z,{title:p.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:p.formatMessage({id:"save",defaultMessage:"Save"}),onOk:v,onCancel:function(){h.resetFields(),n()},children:(0,g.jsxs)(i.A,{form:h,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,g.jsx)(l.Z,{label:p.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:p.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return v()}}}),(0,g.jsx)(u.Z,{label:p.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:p.formatMessage({id:o.f4h,defaultMessage:"Service"}),value:o.f4h}],rules:[{required:!0,message:p.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:p.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})}},76621:function(e,t,n){n.r(t),n.d(t,{default:function(){return Nt}});var r=n(96865),a=n(75574),s=n(55735),o=n(95160),i=n(44194),l=n(8247),u=n(30921),c=n(84176),d=n.n(c),f=n(73193),g=n.n(f),p=n(86222),m=n.n(p),h=n(76711),x=n.n(h),v=n(90819),M=n.n(v),y=n(89933),b=n.n(y),w=n(45332),k=n.n(w),j=n(86803);function S(e){return Z.apply(this,arguments)}function Z(){return(Z=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/file/query/org",{method:"GET",params:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return A.apply(this,arguments)}function A(){return(A=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/file/delete",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return U.apply(this,arguments)}function U(){return(U=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/file/delete/all",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=n(76750),q=n(6397),E=n(40612),I=n(51239),P=n(36310),R=n(73442),O=n(3849),D=n(75365),L=n(80601),V=n(31549),z=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,T.Z)().translateString,s=(0,q.j)((function(e){return e.currentKbase})),o=(0,I.L)((function(e){return e.userInfo})),l=(0,E.u)((function(e){return e.currentOrg})),u=(0,i.useState)(""),c=k()(u,2),d=c[0],f=c[1],g=(0,i.useState)(!1),p=k()(g,2),m=p[0],h=p[1],x=function(){console.log("refresh"),h(!1);var e=(0,P.Cn)()+"?org="+encodeURIComponent(null==l?void 0:l.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==s?void 0:s.uid)+"&uid="+encodeURIComponent(null==o?void 0:o.uid)+"&nickname="+encodeURIComponent(null==o?void 0:o.nickname)+"&avatar="+encodeURIComponent(null==o?void 0:o.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,i.useEffect)((function(){x()}),[s]);return(0,V.jsx)(V.Fragment,{children:(0,V.jsxs)(R.Z,{title:a(null==s?void 0:s.name),onClose:function(){r&&r()},open:n,extra:(0,V.jsxs)(O.Z,{children:[(0,V.jsx)(D.ZP,{onClick:function(){window.open(d)},children:"新窗口"}),(0,V.jsx)(D.ZP,{onClick:function(){console.log("restart"),x()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,V.jsx)(L.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,V.jsx)("iframe",{id:"chat-iframe",src:d,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},Y=n(90838),B=n(69114),N=n(71529),H=n(11757),K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"},G=n(54183),Q=function(e,t){return i.createElement(G.Z,(0,H.Z)({},e,{ref:t,icon:K}))};var W=i.forwardRef(Q),_=n(10162),J=n(54881),$=n(58275),X=n(11090),ee=n(2484),te=n(81947),ne=n(53530),re=n(32327),ae=n(29266),se=n(61355),oe=n(96485),ie=n(28977),le=n.n(ie),ue=n(27650),ce=n(28425),de=n(72608),fe=n(32943),ge=n(92053),pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?de.ZP.info("正在检查模型状态，请稍后再试"):t?e():ne.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},me=function(e){var t=e.onModelStatusChange,n=(0,u.useIntl)(),r=(0,i.useState)(!1),a=k()(r,2),s=a[0],o=a[1],l=(0,i.useState)(!1),c=k()(l,2),d=c[0],f=c[1],g=(0,i.useState)(!1),p=k()(g,2),m=(p[0],p[1],function(){var e=b()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f(!0),null==t||t(!1),e.next=5,(0,ge.J$)();case 5:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(o(n.data),null==t||t(n.data)):(o(!1),null==t||t(!1)),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("检查嵌入式模型失败:",e.t0),o(!1),null==t||t(!1);case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,10,15,18]])})));return function(){return e.apply(this,arguments)}}());return(0,i.useEffect)((function(){m()}),[]),d?(0,V.jsx)(fe.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):s?null:(0,V.jsx)(fe.Z,{type:"warning",showIcon:!0,message:(0,V.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,V.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型bge-m3:latest，用于知识库向量检索"}),style:{marginBottom:16}})},he=n(61353),xe=n(66916),ve=n(80876),Me=n(44781),ye=n(38775),be="CREATE_NEW_ROBOT",we=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,s=e.currentKbaseUid,o=e.onOk,i=e.onCancel,l=e.onChange,c=(0,u.useIntl)();return console.log("RobotSelectModal rendering with:",{robotList:r,selectedRobotUid:a,currentKbaseUid:s}),(0,V.jsx)(ne.Z,{title:c.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:o,onCancel:i,okText:c.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:c.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,V.jsx)(L.Z,{spinning:n,children:(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsx)("p",{children:c.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,V.jsxs)(Me.Z,{style:{width:"100%"},placeholder:c.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:l,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(s));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===s,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,V.jsx)(Me.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,V.jsx)(Me.Z.Option,{value:"divider",disabled:!0,children:(0,V.jsx)(ye.Z,{style:{margin:"4px 0"}})}),(0,V.jsx)(Me.Z.Option,{value:be,label:c.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,V.jsxs)("div",{style:{color:"#1890ff"},children:[(0,V.jsx)(_.Z,{})," ",c.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},ke=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,a=e.checkingEmbeddingModel,o=(0,u.useIntl)(),l=(0,i.useState)(!1),c=k()(l,2),d=c[0],f=c[1],p=(0,i.useState)(!1),m=k()(p,2),h=m[0],v=m[1],y=(0,i.useState)(!1),w=k()(y,2),S=w[0],Z=w[1],C=(0,i.useState)(),A=k()(C,2),F=(A[0],A[1]),U=(0,i.useState)([]),T=k()(U,2),q=T[0],E=T[1],I=(0,i.useState)(""),P=k()(I,2),R=P[0],O=P[1],L=function(){var e=b()(M()().mark((function e(r){var a,i,l,u;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(!0),e.prev=1,a={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:s.whQ,type:s.f4h,orgUid:null==n?void 0:n.uid},console.log("Fetching robots with params:",a),e.next=6,(0,xe.p0)(a);case 6:if(i=e.sent,console.log("queryRobotsByOrg response:",i),200!==i.code){e.next=16;break}return l=i.data.content||[],u=l.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),E(u),r&&u.length>0&&F(u[0]),e.abrupt("return",u);case 16:return j.yw.error(i.message),e.abrupt("return",[]);case 18:e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),j.yw.error(o.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 25:return e.prev=25,Z(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,20,25,28]])})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=b()(M()().mark((function e(){var n,r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R&&null!=t&&t.uid){e.next=3;break}return j.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return j.yw.loading(o.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:R,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,xe.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r),200!==r.code){e.next=18;break}return j.yw.destroy(),j.yw.success(o.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=r.data,F(a),e.abrupt("return",!0);case 18:return j.yw.destroy(),j.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),j.yw.destroy(),j.yw.error(o.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=b()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),r){e.next=4;break}return ne.Z.confirm({title:o.formatMessage({id:"warning",defaultMessage:"警告"}),content:o.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=b()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 4:if(!a){e.next=7;break}return j.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 7:return e.next=9,B();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=b()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return j.yw.error(o.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 3:return j.yw.loading(o.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=6,L(!0);case 6:if(n=e.sent,j.yw.destroy(),!(n.length>0)){e.next=12;break}n.length>1?(E(n),O(""),f(!0)):N(n[0]),e.next=20;break;case 12:return e.next=14,L(!1);case 14:if(0!==e.sent.length){e.next=18;break}return j.yw.info(o.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 18:O(""),f(!0);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:s.xtN,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else j.yw.error(o.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},H=function(){var e=b()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R){e.next=3;break}return j.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=q.find((function(e){return e.uid===R})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return ne.Z.confirm({title:o.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:o.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=b()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:e.sent&&(f(!1),N(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,z();case 9:e.sent&&(f(!1),n&&N(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=b()(M()().mark((function e(n){var r,a,s,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,j.yw.loading(o.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=g()(g()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,xe.lg)(r);case 7:if(a=e.sent,console.log("Create robot response:",a),200!==a.code){e.next=29;break}if(j.yw.destroy(),j.yw.success(o.formatMessage({id:"create.success",defaultMessage:"创建成功"})),v(!1),s=a.data,console.log("New robot data:",s),null==s||!s.uid){e.next=23;break}O(s.uid),F(s),E((function(e){var t=[s].concat(x()(e));return console.log("Updated robot list:",t),t})),f(!1),N(s),e.next=27;break;case 23:return e.next=25,L(!1);case 25:i=e.sent,console.log("Fetched all robots after creation:",i);case 27:e.next=31;break;case 29:j.yw.destroy(),j.yw.error(a.message||o.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),j.yw.destroy(),j.yw.error(o.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(D.ZP,{icon:(0,V.jsx)(he.Z,{}),type:"primary",onClick:Y,disabled:a,children:o.formatMessage({id:"chat.test"})}),(0,V.jsx)(we,{visible:d,loading:S,robotList:q,selectedRobotUid:R,currentKbaseUid:null==t?void 0:t.uid,onOk:H,onCancel:function(){return f(!1)},onChange:function(e){e===be?(v(!0),O("")):O(e)}}),h&&(0,V.jsx)(ve.Z,{open:h,onClose:function(){return v(!1)},onSubmit:K})]})},je=n(69169),Se=n(4499),Ze=n(32350),Ce=function(e){var t=e.isEdit,n=e.file,r=e.open,a=e.onClose,s=e.onSubmit,o=je.A.useForm(),l=k()(o,1)[0],u=(0,E.u)((function(e){return e.currentOrg}));return(0,i.useEffect)((function(){t&&n?l.setFieldsValue({uid:null==n?void 0:n.uid,fileName:null==n?void 0:n.fileName,content:null==n?void 0:n.content}):l.setFieldsValue({fileName:"",content:""})}),[t,n,l]),(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(R.Z,{title:"编辑文件",onClose:a,open:r,children:(0,V.jsxs)(je.A,{form:l,name:"fileForm",onFinish:function(){console.log("handleSubmit"),l.validateFields().then((function(e){var t=g()(g()({},e),{},{uid:null==n?void 0:n.uid,orgUid:null==u?void 0:u.uid});console.log("submit",t),s(t)}))},children:[(0,V.jsx)(Se.Z,{label:"文件名称",name:"fileName",rules:[{required:!0}]}),(0,V.jsx)(Ze.Z,{label:"文件内容",name:"content",rules:[{required:!0}]})]})})})},Ae=["current","pageSize"],Fe=function(){var e=(0,u.useIntl)(),t=((0,u.useNavigate)(),(0,i.useRef)()),n=(0,T.Z)().translateString,r=(0,i.useState)(1),a=k()(r,2),o=a[0],l=a[1],c=(0,i.useState)(10),f=k()(c,2),p=f[0],h=f[1],v=(0,E.u)((function(e){return e.currentOrg})),y=(0,q.j)((function(e){return e.currentKbase})),w=(0,Y.v)((function(e){return e.currentCategory})),Z=(0,i.useState)(!1),A=k()(Z,2),U=A[0],I=A[1],R=(0,i.useState)(!1),O=k()(R,2),L=O[0],H=O[1],K=(0,i.useState)([]),G=k()(K,2),Q=G[0],ie=G[1],de=(0,i.useState)([]),fe=k()(de,2),ge=fe[0],he=fe[1],xe=(0,i.useState)(!1),ve=k()(xe,2),Me=ve[0],ye=ve[1],be=(0,i.useState)(!1),we=k()(be,2),je=we[0],Se=we[1],Ze=(0,i.useState)({}),Fe=k()(Ze,2),Ue=Fe[0],Te=Fe[1],qe=(0,i.useState)(0),Ee=k()(qe,2),Ie=Ee[0],Pe=Ee[1],Re=ne.Z.useModal(),Oe=k()(Re,2),De=Oe[0],Le=Oe[1],Ve=(0,i.useState)(!1),ze=k()(Ve,2),Ye=ze[0],Be=ze[1],Ne=(0,i.useState)(void 0),He=k()(Ne,2),Ke=He[0],Ge=He[1],Qe=function(){var n=b()(M()().mark((function n(r){return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,C(r);case 2:200===n.sent.code?(null==t||t.current.reload(),j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):j.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),We=function(){var n=b()(M()().mark((function n(r){var a;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("handleFileDrawerSubmit",r),j.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"})),Be(!1),Ge(void 0),null==t||null===(a=t.current)||void 0===a||a.reload();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),_e=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,V.jsx)(u.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.file.fileName.tooltip"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.fileName;null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,V.jsx)("span",{style:{marginRight:4},children:o}),(0,V.jsx)(re.Z.Text,{copyable:{text:(null==t?void 0:t.fileName)||""}})]})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"fileUrl",defaultMessage:"File URL"}),dataIndex:"fileUrl",ellipsis:!0,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.fileUrl.tooltip"}),render:function(t,n){return n.fileUrl?(0,V.jsxs)("a",{href:n.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,V.jsx)(N.Z,{})," ",e.formatMessage({id:"view.file"})]}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.file.status.tooltip"}),render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,V.jsx)(ae.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}}].concat(x()([]),[{title:(0,V.jsx)(u.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.tags.tooltip"}),render:function(e,t){return t.tagList&&0!==t.tagList.length?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(W,{})," ",t.tagList.map((function(e){return(0,V.jsx)(ae.Z,{children:e},e)}))]}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:e.formatMessage({id:"enabled"}),status:"Success"},false:{text:e.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.enabled.tooltip"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"categoryUid",defaultMessage:"Category"}),dataIndex:"categoryUid",ellipsis:!0,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.category.tooltip"}),render:function(e,t){return t.categoryUid||"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.createdAt.tooltip"}),render:function(e,t){return le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,V.jsx)(u.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.updatedAt.tooltip"}),render:function(e,t){return t.updatedAt?le()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),key:"option",valueType:"option",width:120,fixed:"right",render:function(t,n){return[(0,V.jsx)(D.ZP,{type:"link",onClick:function(){return function(e){Ge(e),Be(!0)}(n)},children:e.formatMessage({id:"edit"})},"edit"),(0,V.jsx)(se.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return Qe(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,V.jsx)(D.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}]),Je=function(){var n=b()(M()().mark((function n(){var r,a,s,o,i,l;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ge.length){n.next=3;break}return j.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ge),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,C(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:j.yw.destroy(),0===s?j.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):j.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ie([]),he([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),$e=function(){var e=b()(M()().mark((function e(t,n,r){var a,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=g()({categoryUid:(null==w?void 0:w.uid)===s.zBg?"":null==w?void 0:w.uid,kbUid:null==y?void 0:y.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:a||"",exportType:t},Ue),"current"===t?(i.pageNumber=o-1,i.pageSize=p):"all"===t?(i.pageNumber=0,i.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=n,i.pageSize=r),window.open((0,P.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams(Object.entries(i).reduce((function(e,t){var n=k()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Xe=function(){var n=b()(M()().mark((function n(){var r,a,o;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ie){n.next=3;break}return j.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return j.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==w?void 0:w.uid)===s.zBg?"":null==w?void 0:w.uid,kbUid:null==y?void 0:y.uid,orgUid:null==v?void 0:v.uid},n.next=8,F(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(j.yw.destroy(),j.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),j.yw.destroy(),j.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),et=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return $e("range",r,n)}})},s=0;s<r;s++)a();return t};(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[y,w]),(0,i.useEffect)((function(){return B.Z.on(s.YwV,(function(e){var n;null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){B.Z.off(s.YwV)}}),[]);var tt=function(){var t=b()(M()().mark((function t(){return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ce.HK)(s.QPQ,null==v?void 0:v.uid,null==y?void 0:y.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(me,{onModelStatusChange:function(e){ye(e),Se(!1)}}),(0,V.jsx)(te.Z,{columns:_e,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:Q,onChange:function(e,t){ie(e),he(t)}},scroll:{x:1800},request:function(){var e=b()(M()().mark((function e(t,n,r){var a,o,i,u,c,f,p,m;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,o=t.pageSize,i=d()(t,Ae),l(a),h(o),Te(i),u=void 0,c=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],u=f,c="ascend"===n[f]?"ascend":"descend"),p=g()(g()({pageNumber:a-1,pageSize:o,categoryUid:(null==w?void 0:w.uid)===s.zBg?"":null==w?void 0:w.uid,kbUid:null==y?void 0:y.uid,orgUid:null==v?void 0:v.uid},i),{},{sortBy:u,sortDirection:c}),e.next=10,S(p);case 10:return 200===(m=e.sent).code?(console.log("queryFilesByOrg response:",p,m),Pe(m.data.totalElements)):j.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==y?void 0:y.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:function(){var t=[(0,V.jsx)(D.ZP,{icon:(0,V.jsx)(_.Z,{}),type:"primary",onClick:function(){return pe((function(){return I(!0)}),Me,je)},disabled:je||!Me,children:e.formatMessage({id:"upload",defaultMessage:"File"})},"upload"),(0,V.jsx)(ke,{currentKbase:y,currentOrg:v,embeddingModelExists:Me,checkingEmbeddingModel:je||!Me},"chat")],n=[];Q.length>0&&n.push({key:"batchDelete",icon:(0,V.jsx)(J.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(Q.length,")"),onClick:function(){De.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(Q.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Je,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,V.jsx)($.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){De.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文件数据吗？此操作不可恢复!"}),onOk:Xe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return $e("current")}}];return Ie>0&&(Ie<=1e3?r.push({key:"export-all",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ie,"条)"),onClick:function(){return $e("all")}}):r.push({key:"export-range",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ie,"条)"),children:et(Ie)})),t.push((0,V.jsx)(oe.Z,{menu:{items:r},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,V.jsx)(ee.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,V.jsx)(oe.Z,{menu:{items:n},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:Q.length>0?"primary":"default",danger:Q.length>0,children:[Q.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Q.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,V.jsx)(ee.Z,{})]})},"batchOperations")),t}}),U&&(0,V.jsx)(ue.Z,{type:s.n1c,acceptType:"*",isModalOpen:U,handleSubmit:function(e){I(!1),null==t||t.current.reload(),tt()},handleCancel:function(){I(!1),null==t||t.current.reload()}}),L&&(0,V.jsx)(z,{type:s.xtN,open:L,onClose:function(){return H(!1)}}),Ye&&(0,V.jsx)(Ce,{isEdit:!0,file:Ke,open:Ye,onClose:function(){Be(!1),Ge(void 0)},onSubmit:We}),Le]})};function Ue(e){return Te.apply(this,arguments)}function Te(){return(Te=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/query/org",{method:"GET",params:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/create",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/update",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/delete",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e){return Le.apply(this,arguments)}function Le(){return(Le=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/deleteAll",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){return ze.apply(this,arguments)}function ze(){return(ze=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/updateIndex",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(e){return Be.apply(this,arguments)}function Be(){return(Be=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/text/updateVectorIndex",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=n(77274),He=n(15722),Ke=n(30617),Ge=n(61107),Qe=n(84881),We=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,s=e.onSubmit,o=je.A.useForm(),l=k()(o,1)[0],u=(0,i.useState)(""),c=k()(u,2),d=(c[0],c[1]),f=(0,E.u)((function(e){return e.currentOrg})),p=(0,Y.v)((function(e){return e.categorySelectOptions})),m=(0,i.useState)(),h=k()(m,2),x=h[0],v=h[1],M=(0,q.j)((function(e){return e.currentKbase}));(0,i.useEffect)((function(){if(t)l.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,content:null==n?void 0:n.content,categoryUid:n.categoryUid}),d((null==n?void 0:n.content)||"");else if(l.resetFields(),p&&p.length>0){var e=p[0].value;l.setFieldValue("categoryUid",e),v(e)}}),[t,n,l,p]);return(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(R.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,V.jsxs)(O.Z,{children:[(0,V.jsx)(D.ZP,{onClick:a,children:"取消"}),(0,V.jsx)(D.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){var t=g()(g()({},e),{},{categoryUid:x,kbUid:null==M?void 0:M.uid,orgUid:null==f?void 0:f.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"})]}),children:(0,V.jsxs)(je.A,{form:l,submitter:{render:function(){return null}},children:[(0,V.jsx)(Qe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:p,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)}}}),(0,V.jsx)(Se.Z,{label:"标题",name:"name",rules:[{required:!0}]}),(0,V.jsx)(Ze.Z,{label:"内容",name:"content",rules:[{required:!0}]})]})})})},_e=["current","pageSize"],Je=function(){var e=(0,u.useIntl)(),t=(0,i.useRef)(),n=(0,T.Z)().translateString,r=(0,i.useState)(1),a=k()(r,2),o=a[0],l=a[1],c=(0,i.useState)(10),f=k()(c,2),p=f[0],h=f[1],x=(0,E.u)((function(e){return e.currentOrg})),v=(0,q.j)((function(e){return e.currentKbase})),y=(0,Y.v)((function(e){return e.currentCategory})),w=(0,Y.v)((function(e){return e.categorySelectOptions})),S=(0,i.useState)(!1),Z=k()(S,2),C=Z[0],A=Z[1],F=(0,i.useState)({}),U=k()(F,2),I=U[0],R=U[1],O=(0,i.useState)(!1),L=k()(O,2),z=L[0],B=L[1],N=ne.Z.useModal(),H=k()(N,2),K=H[0],G=H[1],Q=(0,i.useState)([]),W=k()(Q,2),re=W[0],se=W[1],ie=(0,i.useState)([]),de=k()(ie,2),fe=de[0],ge=de[1],he=(0,i.useState)(!1),xe=k()(he,2),ve=xe[0],Me=xe[1],ye=(0,i.useState)(!1),be=k()(ye,2),we=be[0],je=be[1],Se=(0,i.useState)({}),Ze=k()(Se,2),Ce=Ze[0],Ae=Ze[1],Fe=(0,i.useState)(0),Te=k()(Fe,2),Ee=Te[0],Pe=Te[1],Oe=(0,i.useState)(!1),Le=k()(Oe,2),ze=Le[0],Be=Le[1],Qe=function(){var n=b()(M()().mark((function n(r){var a;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,Re(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):j.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Je=function(){var n=b()(M()().mark((function n(){var r,a,s,o,i,l;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==fe.length){n.next=3;break}return j.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(fe),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Re(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:j.yw.destroy(),0===s?j.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):j.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),se([]),ge([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),$e=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,V.jsx)(u.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.text.title.tooltip",defaultMessage:"文档的标题"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"llm.text.content.tooltip",defaultMessage:"文档的具体内容"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.status.tooltip",defaultMessage:"文档索引处理状态"}),render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,V.jsx)(ae.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.vectorStatus.tooltip",defaultMessage:"文档向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,V.jsx)(ae.Z,{color:a,icon:(0,V.jsx)(Ne.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.category.tooltip",defaultMessage:"文档所属的分类"}),render:function(e,t){var n=w.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,V.jsx)(ae.Z,{children:null==n?void 0:n.label})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.createdAt.tooltip",defaultMessage:"文档创建的时间"}),render:function(e,t){return le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,V.jsx)(u.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.updatedAt.tooltip",defaultMessage:"文档最后更新的时间"}),render:function(e,t){return t.updatedAt?le()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Xe=[].concat($e,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,V.jsx)("a",{onClick:function(){R(n),B(!0),A(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,V.jsx)(D.ZP,{type:"link",onClick:function(){return function(t){K.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,V.jsx)(He.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.title,"】？"),onOk:function(){Qe(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete"),(0,V.jsx)(oe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return nt(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return rt(n)}}]},placement:"bottomRight",children:(0,V.jsxs)(D.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,V.jsx)(ee.Z,{})]})},"indexOperations")]}}]);(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[v,y]);var et=function(){var e=b()(M()().mark((function e(n){var r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),A(!1)):j.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=b()(M()().mark((function e(n){var r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,e.next=3,Ie(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),A(!1)):j.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var n=b()(M()().mark((function n(r){var a,s;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,Ve({uid:r.uid});case 4:a=n.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),rt=function(){var n=b()(M()().mark((function n(r){var a,s;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,Ye({uid:r.uid});case 4:a=n.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),at=function(){ve?we?j.yw.info("正在检查模型状态，请稍后再试"):(A(!0),B(!1),R({})):K.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},st=function(){var n=b()(M()().mark((function n(){var r,a,o;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ee){n.next=3;break}return j.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return j.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:null==x?void 0:x.uid},n.next=8,De(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(j.yw.destroy(),j.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),j.yw.destroy(),j.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),ot=function(){var e=b()(M()().mark((function e(t,n,r){var a,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=g()({categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:(null==x?void 0:x.uid)||"",accessToken:a||"",exportType:t},Ce),"current"===t?(i.pageNumber=String(o-1),i.pageSize=String(p)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=String(n),i.pageSize=String(r)),window.open((0,P.kG)()+"/api/v1/llm/text/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),it=function(){var t=b()(M()().mark((function t(){return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ce.HK)(s.QPQ,null==x?void 0:x.uid,null==v?void 0:v.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),lt=function(){var t=b()(M()().mark((function t(){return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ve){t.next=3;break}return K.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响向量检索质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){Be(!0)}}),t.abrupt("return");case 3:if(!we){t.next=6;break}return j.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:Be(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ut={selectedRowKeys:re,onChange:function(e,t){se(e),ge(t)}},ct=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return ot("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(me,{onModelStatusChange:function(e){Me(e),je(!1)}}),(0,V.jsx)(te.Z,{columns:Xe,actionRef:t,cardBordered:!0,rowSelection:ut,scroll:{x:1500},sticky:!0,request:function(){var t=b()(M()().mark((function t(n,r,a){var o,i,u,c,f,p,m,b;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),j.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,u=d()(n,_e),l(o),h(i),Ae(u),c=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],c=p,f="ascend"===r[p]?"ascend":"descend"),m=g()(g()({pageNumber:o-1,pageSize:i,categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:null==x?void 0:x.uid},u),{},{sortBy:c,sortDirection:f}),t.next=12,Ue(m);case 12:return b=t.sent,console.log("queryTextsByOrg response:",m,b),j.yw.destroy(),200===b.code?Pe(b.data.totalElements):j.yw.error(b.message),t.abrupt("return",{data:b.data.content,success:!0,total:b.data.totalElements});case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==v?void 0:v.name)+" - 文本列表",tooltip:we?"正在检查嵌入式模型...":ve?"所添加文本内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[(0,V.jsx)(D.ZP,{type:"primary",icon:(0,V.jsx)(_.Z,{}),onClick:function(){return pe(at,ve,we)},disabled:we,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,V.jsx)(ke,{currentKbase:v,currentOrg:x,embeddingModelExists:ve,checkingEmbeddingModel:we},"chat")],n=[];re.length>0&&n.push({key:"batchDelete",icon:(0,V.jsx)(J.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(re.length,")"),onClick:function(){K.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(re.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Je,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,V.jsx)($.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){K.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文本数据吗？此操作不可恢复!"}),onOk:st,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"import",icon:(0,V.jsx)(Ke.Z,{}),label:e.formatMessage({id:"import"}),onClick:lt,disabled:we},{key:"export-current",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ot("current")}}];return Ee>0&&(Ee<=1e3?r.push({key:"export-all",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ee,"条)"),onClick:function(){return ot("all")}}):r.push({key:"export-range",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ee,"条)"),children:ct(Ee)})),r.push({key:"download",icon:(0,V.jsx)(Ge.Z,{}),label:e.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,P.LG)()}}),t.push((0,V.jsx)(oe.Z,{menu:{items:r},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,V.jsx)(ee.Z,{})]})},"importExport")),n.length>0&&t.push((0,V.jsx)(oe.Z,{menu:{items:n},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:re.length>0?"primary":"default",danger:re.length>0,children:[re.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(re.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,V.jsx)(ee.Z,{})]})},"batchOperations")),t}()}}),C&&(0,V.jsx)(We,{isEdit:z,open:C,text:I,onClose:function(){A(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),z?tt(e):et(e)}}),ze&&(0,V.jsx)(ue.Z,{type:s.pBv,acceptType:".xlsx,.xls,.csv",isModalOpen:ze,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Be(!1),null==t||t.current.reload(),it()},handleCancel:function(){console.log("handleUploadDragCancel"),Be(!1),null==t||t.current.reload()}}),G]})};function $e(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/query/org",{method:"GET",params:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e){return tt.apply(this,arguments)}function tt(){return(tt=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/update",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){return rt.apply(this,arguments)}function rt(){return(rt=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/delete",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e){return st.apply(this,arguments)}function st(){return(st=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/delete/all",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e){return it.apply(this,arguments)}function it(){return(it=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/updateIndex",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e){return ut.apply(this,arguments)}function ut(){return(ut=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/llm/chunk/updateVectorIndex",{method:"POST",data:g()(g()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=function(e){var t=e.isEdit,n=e.chunk,r=e.open,a=e.onClose,s=e.onSubmit,o=je.A.useForm(),l=k()(o,1)[0],c=(0,u.useIntl)(),d=(0,E.u)((function(e){return e.currentOrg})),f=(0,q.j)((function(e){return e.currentKbase})),p=(0,Y.v)((function(e){return e.currentCategory}));return(0,i.useEffect)((function(){t&&n?l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content}):l.setFieldsValue({name:"",content:""})}),[t,n,l]),(0,V.jsx)(R.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,V.jsxs)(O.Z,{children:[(0,V.jsx)(D.ZP,{onClick:a,children:"取消"}),(0,V.jsx)(D.ZP,{onClick:function(){l.validateFields().then((function(e){var t=g()(g()({},e),{},{orgUid:null==d?void 0:d.uid,kbUid:null==f?void 0:f.uid,categoryUid:null==p?void 0:p.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"})]}),children:(0,V.jsxs)(je.A,{form:l,name:"chunkForm",submitter:!1,children:[(0,V.jsx)(Se.Z,{label:c.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0}]}),(0,V.jsx)(Ze.Z,{label:c.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0}],fieldProps:{rows:6}})]})})},dt=["current","pageSize"],ft=function(){var e=(0,u.useIntl)(),t=(0,i.useRef)(),n=(0,T.Z)().translateString,r=(0,i.useState)(1),a=k()(r,2),o=a[0],l=a[1],c=(0,i.useState)(10),f=k()(c,2),p=f[0],h=f[1],x=(0,E.u)((function(e){return e.currentOrg})),v=(0,q.j)((function(e){return e.currentKbase})),y=(0,Y.v)((function(e){return e.currentCategory})),w=(0,Y.v)((function(e){return e.categorySelectOptions})),S=(0,i.useState)(!1),Z=k()(S,2),C=Z[0],A=Z[1],F=(0,i.useState)(!1),U=k()(F,2),I=U[0],R=U[1],O=(0,i.useState)(),L=k()(O,2),N=L[0],H=L[1],K=(0,i.useState)([]),G=k()(K,2),Q=G[0],W=G[1],_=(0,i.useState)([]),ie=k()(_,2),ue=ie[0],ce=ie[1],de=(0,i.useState)(!1),fe=k()(de,2),ge=fe[0],pe=fe[1],he=(0,i.useState)(!1),xe=k()(he,2),ve=xe[0],Me=xe[1],ye=(0,i.useState)({}),be=k()(ye,2),we=be[0],je=be[1],Se=(0,i.useState)(0),Ze=k()(Se,2),Ce=Ze[0],Ae=Ze[1],Fe=ne.Z.useModal(),Ue=k()(Fe,2),Te=Ue[0],qe=Ue[1],Ee=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0,fixed:"left"},{title:(0,V.jsx)(u.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.chunk.name.tooltip",defaultMessage:"拆分后的内容块名称"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.name;null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,V.jsx)("span",{style:{marginRight:4},children:o}),(0,V.jsx)(re.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,tooltip:e.formatMessage({id:"llm.chunk.content.tooltip",defaultMessage:"拆分后的内容块具体内容"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.status.tooltip",defaultMessage:"拆分内容的处理状态，主要用于全文检索"}),render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,V.jsx)(ae.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.vectorStatus.tooltip",defaultMessage:"拆分内容的向量化处理状态，主要用于向量存储和检索"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,V.jsx)(ae.Z,{color:a,icon:(0,V.jsx)(Ne.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,tooltip:e.formatMessage({id:"llm.chunk.tags.tooltip",defaultMessage:"拆分内容的标签，用于分类和搜索"}),render:function(e,t){return null!=t&&t.tagList&&0!==t.tagList.length?(0,V.jsx)(V.Fragment,{children:t.tagList.map((function(e){return(0,V.jsx)(ae.Z,{color:"blue",style:{marginBottom:4},children:e},e)}))}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:100,tooltip:e.formatMessage({id:"llm.chunk.category.tooltip",defaultMessage:"拆分内容所属的分类"}),render:function(e,t){var n=w.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,V.jsx)(ae.Z,{children:null==n?void 0:n.label})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.createdAt.tooltip",defaultMessage:"拆分内容创建的时间"}),render:function(e,t){return le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,V.jsx)(u.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.updatedAt.tooltip",defaultMessage:"拆分内容最后更新的时间"}),render:function(e,t){return t.updatedAt?le()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Ie=function(){var n=b()(M()().mark((function n(r){var a;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,nt(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):j.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Pe=function(){var n=b()(M()().mark((function n(){var r,a,s,o,i,l;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ue.length){n.next=3;break}return j.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ue),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,nt(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:j.yw.destroy(),0===s?j.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):j.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),W([]),ce([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Re=function(){var n=b()(M()().mark((function n(r){var a,s;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!N){n.next=7;break}return n.next=4,et(g()(g()({},r),{},{uid:N.uid}));case 4:a=n.sent,n.next=7;break;case 7:200===a.code?(j.yw.success(e.formatMessage({id:N?"update.success":"add.success",defaultMessage:N?"Update Success":"Add Success"})),R(!1),null==t||null===(s=t.current)||void 0===s||s.reload()):j.yw.error(a.message),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),j.yw.error(e.formatMessage({id:N?"update.error":"add.error",defaultMessage:N?"Update Error":"Add Error"}));case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}(),Oe=[].concat(Ee,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,V.jsx)("a",{onClick:function(){return function(e){H(e),R(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,V.jsx)(se.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return Ie(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,V.jsx)(D.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,V.jsx)(oe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return De(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Le(n)}}]},placement:"bottomRight",children:(0,V.jsxs)(D.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,V.jsx)(ee.Z,{})]})},"indexOperations")]}}]),De=function(){var n=b()(M()().mark((function n(r){var a,s;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,ot({uid:r.uid});case 4:a=n.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Le=function(){var n=b()(M()().mark((function n(r){var a,s;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,lt({uid:r.uid});case 4:a=n.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[v,y]),(0,i.useEffect)((function(){return B.Z.on(s.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){B.Z.off(s.YwV)}}),[]);var Ve=function(){var e=b()(M()().mark((function e(t,n,r){var a,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=g()({categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:(null==x?void 0:x.uid)||"",accessToken:a||"",exportType:t},we),"current"===t?(i.pageNumber=o-1,i.pageSize=p):"all"===t?(i.pageNumber=0,i.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=n,i.pageSize=r),window.open((0,P.kG)()+"/api/v1/llm/chunk/export?"+new URLSearchParams(Object.entries(i).reduce((function(e,t){var n=k()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ze=function(){var n=b()(M()().mark((function n(){var r,a,o;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ce){n.next=3;break}return j.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return j.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:null==x?void 0:x.uid},n.next=8,at(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(j.yw.destroy(),j.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),j.yw.destroy(),j.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),Ye=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Ve("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(me,{onModelStatusChange:function(e){pe(e),Me(!1)}}),(0,V.jsx)(te.Z,{columns:Oe,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:Q,onChange:function(e,t){W(e),ce(t)}},scroll:{x:2e3},request:function(){var e=b()(M()().mark((function e(t,n,r){var a,o,i,u,c,f,p,m;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,o=t.pageSize,i=d()(t,dt),l(a),h(o),je(i),u=void 0,c=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],u=f,c="ascend"===n[f]?"ascend":"descend"),p=g()(g()({pageNumber:a-1,pageSize:o,categoryUid:(null==y?void 0:y.uid)===s.zBg?"":null==y?void 0:y.uid,kbUid:null==v?void 0:v.uid,orgUid:null==x?void 0:x.uid},i),{},{sortBy:u,sortDirection:c}),e.next=11,$e(p);case 11:return m=e.sent,console.log("queryChunksByOrg response:",m,p),200===m.code?Ae(m.data.totalElements):j.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==v?void 0:v.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:function(){var t=[(0,V.jsx)(ke,{currentKbase:v,currentOrg:x,embeddingModelExists:ge,checkingEmbeddingModel:ve||!ge},"chat")],n=[];Q.length>0&&n.push({key:"batchDelete",icon:(0,V.jsx)(J.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(Q.length,")"),onClick:function(){Te.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(Q.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Pe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,V.jsx)($.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Te.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有拆分数据吗？此操作不可恢复!"}),onOk:ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ve("current")}}];return Ce>0&&(Ce<=1e3?r.push({key:"export-all",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ce,"条)"),onClick:function(){return Ve("all")}}):r.push({key:"export-range",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ce,"条)"),children:Ye(Ce)})),t.push((0,V.jsx)(oe.Z,{menu:{items:r},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,V.jsx)(ee.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,V.jsx)(oe.Z,{menu:{items:n},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:Q.length>0?"primary":"default",danger:Q.length>0,children:[Q.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Q.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,V.jsx)(ee.Z,{})]})},"batchOperations")),t}}),C&&(0,V.jsx)(z,{type:s.xtN,open:C,onClose:function(){return A(!1)}}),(0,V.jsx)(ct,{isEdit:!!N,chunk:N,open:I,onClose:function(){return R(!1)},onSubmit:Re}),qe]})},gt=n(99885),pt=n(93689),mt=n(40439),ht=n(88996),xt=n(62577),vt=n(39755),Mt=n(79907),yt=n(65895),bt=n(17082),wt=n(73457),kt=n(42965),jt=n(63653),St=n(35175),Zt=["fieldProps","proFieldProps"],Ct="dateRange",At=i.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,a=(0,wt.Z)(e,Zt),s=(0,i.useContext)(jt.Z);return(0,V.jsx)(St.Z,(0,bt.Z)({ref:t,fieldProps:(0,bt.Z)({getPopupContainer:s.getPopupContainer},n),valueType:Ct,proFieldProps:r,filedConfig:{valueType:Ct,customLightMode:!0,lightFilterLabelFormatter:function(e){return(0,kt.c)(e,(null==n?void 0:n.format)||"YYYY-MM-DD")}}},a))})),Ft=n(48708),Ut=n(30348),Tt=n(20045),qt=n(62673),Et=n(52288),It=n(58087),Pt=n(65461),Rt=n(51990),Ot=["key"],Dt=function(e){var t=e.isEdit,n=e.faq,r=e.open,a=e.onClose,o=e.onSubmit,l=je.A.useForm(),u=k()(l,1)[0],c=((0,T.Z)().translateString,(0,i.useState)("")),f=k()(c,2),p=f[0],m=f[1],h=(0,i.useState)(""),v=k()(h,2),y=v[0],w=v[1],S=(0,i.useState)(""),Z=k()(S,2),C=Z[0],A=Z[1],F=(0,E.u)((function(e){return e.currentOrg})),U=(0,q.j)((function(e){return e.currentKbase})),I=(0,Y.v)((function(e){return e.categorySelectOptions})),L=(0,Y.v)((function(e){return e.currentCategory})),z=(0,i.useState)(),B=k()(z,2),N=(B[0],B[1]),H=(0,i.useState)([]),K=k()(H,2),G=K[0],Q=K[1],W=(0,i.useState)(!1),J=k()(W,2),$=J[0],X=J[1],ee=(0,i.useState)(""),te=k()(ee,2),re=te[0],se=te[1],oe=(0,i.useRef)(null),ie=(0,i.useState)([]),ue=k()(ie,2),ce=(ue[0],ue[1]),de=(0,i.useState)([]),fe=k()(de,2),ge=fe[0],pe=fe[1],me=(0,i.useState)(!0),he=k()(me,2),xe=he[0],ve=he[1],Me=(0,i.useState)("permanent"),be=k()(Me,2),we=be[0],ke=be[1],Ce=(0,i.useState)([]),Ae=k()(Ce,2),Fe=Ae[0],Ue=Ae[1],Te=(0,i.useState)(!1),qe=k()(Te,2),Ee=(qe[0],qe[1],(0,i.useState)([])),Ie=k()(Ee,2),Pe=Ie[0],Re=Ie[1],Oe=(0,i.useState)([]),De=k()(Oe,2),Le=De[0],Ve=De[1],ze=(0,i.useState)(!1),Ye=k()(ze,2),Be=Ye[0],Ne=Ye[1],He=(0,i.useState)(""),Ke=k()(He,2),Ge=Ke[0],We=Ke[1],_e=(0,i.useState)(""),Je=k()(_e,2),$e=Je[0],Xe=Je[1],et=(0,i.useState)([]),tt=k()(et,2),nt=tt[0],rt=tt[1],at=(0,i.useState)([]),st=k()(at,2),ot=st[0],it=st[1],lt=(0,i.useState)(!1),ut=k()(lt,2),ct=ut[0],dt=ut[1];(0,i.useEffect)((function(){var e=function(){var e=b()(M()().mark((function e(){var t,r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,j.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==L?void 0:L.uid)===s.zBg?"":null==L?void 0:L.uid,kbUid:null==U?void 0:U.uid,orgUid:null==F?void 0:F.uid},e.next=5,(0,gt.pf)(t);case 5:r=e.sent,console.log("获取FAQ列表响应:",t,r),j.yw.destroy(),200===r.code?(a=r.data.content.map((function(e){return{label:e.question,value:e.uid}})),pe(a.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):j.yw.error(r.message||"加载常见问题失败"),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),j.yw.destroy(),j.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();r&&e()}),[r,null==U?void 0:U.uid,null==F?void 0:F.uid,null==L?void 0:L.uid,null==n?void 0:n.uid]),(0,i.useEffect)((function(){if(t){var e,r,a,s,o,i=Array.isArray(null==n?void 0:n.questionList)?n.questionList.map((function(e){return"string"==typeof e?e:String(e)})).filter((function(e){return""!==e.trim()})):[];if(u.setFieldsValue({question:null==n?void 0:n.question,questionList:i,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==U?void 0:U.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateType:"permanent",dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[le()(n.startDate),le()(n.endDate)]:void 0}),m((null==n?void 0:n.answer)||""),w((null==n?void 0:n.answerHtml)||""),A((null==n?void 0:n.answerMarkdown)||""),Q((null==n||null===(r=n.tagList)||void 0===r?void 0:r.filter((function(e){return e&&""!==e.trim()})))||[]),ce((null==n||null===(a=n.relatedFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]),ve(!1!==(null==n?void 0:n.enabled)),Ue(i),null!=n&&null!==(s=n.images)&&void 0!==s&&s.length&&n.images.some((function(e){return e&&""!==e.trim()}))){var l=n.images.filter((function(e){return e&&""!==e.trim()})),c=l.map((function(e,t){return{uid:"-".concat(t+1),name:"image_".concat(t+1,".jpg"),status:"done",url:e,thumbUrl:e}}));Re(c),Ve(l)}else Re([]),Ve([]);if(null!=n&&null!==(o=n.attachments)&&void 0!==o&&o.length&&n.attachments.some((function(e){return e&&""!==e.trim()}))){var d=n.attachments.filter((function(e){return e&&""!==e.trim()})),f=d.map((function(e,t){var n=e.substring(e.lastIndexOf("/")+1);return{uid:"-".concat(t+1),name:n||"attachment_".concat(t+1),status:"done",url:e}}));rt(f),it(d)}else rt([]),it([])}else{var g=I.length>0?I[0].value:"";u.setFieldsValue({question:"",questionList:[],answer:"",categoryUid:g,kbUid:null==U?void 0:U.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateType:"permanent",dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),g&&N(g),m(""),w(""),A(""),Q([]),ce([]),ve(!0),Ue([]),Re([]),Ve([]),rt([]),it([])}}),[n,r,I]),(0,i.useEffect)((function(){var e;$&&(null===(e=oe.current)||void 0===e||e.focus())}),[$]);var ft=function(){re&&-1===G.indexOf(re)&&Q([].concat(x()(G),[re])),X(!1),se("")},pt=function(){var e=b()(M()().mark((function e(t){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:We(t.url||t.thumbUrl),Ne(!0),Xe(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mt=(0,V.jsx)(D.ZP,{icon:(0,V.jsx)(_.Z,{}),children:"上传图片"}),ht={name:"file",accept:"image/*",action:(0,P.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},listType:"picture-card",fileList:Pe,onPreview:pt,onChange:function(e){var t=x()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n=e.file.response.data.fileUrl;Ve((function(e){return[].concat(x()(e),[n])})),j.yw.success("上传 ".concat(e.file.name," 成功"))}else j.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&j.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){return e.response&&200===e.response.code?g()(g()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),Re(t)},data:function(e){return{file:e,fileName:le()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:s.IrL,categoryUid:u.getFieldValue("categoryUid")||"",kbUid:(null==U?void 0:U.uid)||"",client:s.bVn}},onRemove:function(e){return e.url&&Ve((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},bt={name:"file",action:(0,P.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},fileList:nt,onChange:function(e){var t=x()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n=e.file.response.data.fileUrl;it((function(e){return[].concat(x()(e),[n])})),j.yw.success("上传 ".concat(e.file.name," 成功"))}else j.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&j.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){return e.response&&200===e.response.code?g()(g()({},e),{},{url:e.response.data.fileUrl}):e})),rt(t)},data:function(e){return{file:e,fileName:le()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:s.IrL,categoryUid:u.getFieldValue("categoryUid")||"",kbUid:(null==U?void 0:U.uid)||"",client:s.bVn}},onRemove:function(e){return e.url&&it((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},wt=function(){var e=b()(M()().mark((function e(){var t,n,r,a,s,o;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=u.getFieldValue("question"))&&""!==t.trim()){e.next=4;break}return j.yw.error("请先输入问题后再生成相似问法"),e.abrupt("return");case 4:return e.prev=4,dt(!0),j.yw.loading("正在智能生成相似问法..."),n={question:t},e.next=10,(0,gt.xb)(n);case 10:r=e.sent,j.yw.destroy(),200===r.code&&Array.isArray(r.data)?(a=r.data.filter((function(e){return e&&""!==e.trim()})),s=Fe.filter((function(e){return e&&""!==e.trim()})),o=x()(s),a.forEach((function(e){o.includes(e)||o.push(e)})),Ue(o),u.setFieldValue("questionList",o),j.yw.success("已成功生成 ".concat(a.length," 条相似问法"))):j.yw.error(r.message||"生成相似问法失败"),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(4),console.error("生成相似问法出错:",e.t0),j.yw.destroy(),j.yw.error("生成相似问法失败");case 20:return e.prev=20,dt(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[4,15,20,23]])})));return function(){return e.apply(this,arguments)}}();return(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(R.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:a,open:r,extra:(0,V.jsxs)(O.Z,{children:[(0,V.jsx)(D.ZP,{onClick:a,children:"取消"}),(0,V.jsx)(D.ZP,{onClick:function(){var e=Fe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));u.setFieldValue("questionList",e),u.validateFields().then((function(e){var t,r;if(console.log("handleSubmit values:",e),"permanent"===e.dateType)t=le()().format("YYYY-MM-DDTHH:mm:ss"),r=le()().add(100,"years").format("YYYY-MM-DDTHH:mm:ss");else{var a=e.dateRange;t=null!=a&&a[0]?a[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=a&&a[1]?a[1].format("YYYY-MM-DDTHH:mm:ss"):void 0}var i=Fe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e})),l=Le.filter((function(e){return e&&""!==e.trim()})),u=ot.filter((function(e){return e&&""!==e.trim()})),c=G.filter((function(e){return e&&""!==e.trim()})),d=g()(g()(g()({},n),e),{},{type:s.PYi,kbUid:null==U?void 0:U.uid,orgUid:null==F?void 0:F.uid,answer:p,answerHtml:y,answerMarkdown:C,questionList:i,answerList:e.answerList||[],tagList:c,relatedFaqUids:e.relatedFaqUids||[],startDate:t,endDate:r,images:l,attachments:u});o(d)})).catch((function(e){console.log("Form errors:",e),j.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,V.jsxs)(je.A,{form:u,submitter:{render:function(){return null}},children:[(0,V.jsx)(Qe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:I,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),N(e)}}}),(0,V.jsx)(Se.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,V.jsx)(xt.u,{name:"questionList",label:(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,V.jsx)("span",{children:"相似问法"}),(0,V.jsx)(D.ZP,{type:"primary",icon:(0,V.jsx)(It.Z,{}),onClick:wt,loading:ct,size:"small",children:"智能生成"})]}),creatorButtonProps:{creatorButtonText:"添加相似问法",icon:(0,V.jsx)(_.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(x()(Fe),[""]);Ue(e),u.setFieldValue("questionList",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var r=u.getFieldValue("questionList")||[],a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):x()(Fe);Ue(a)},onAfterRemove:function(e,t){var n=u.getFieldValue("questionList")||[],r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];Ue(r)},actionRender:function(e,t,n){return[(0,V.jsx)(D.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=x()(Fe);r.splice(n,1),Ue(r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,a=d()(e,Ot);return(0,V.jsx)(Se.Z,g()(g()({},a),{},{placeholder:"请输入相似问法",rules:[{required:!0,message:"请输入相似问法"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:Fe[t]||"",onChange:function(e){var n=x()(Fe);n[t]=e.target.value,Ue(n),u.setFieldValue(["questionList",t],e.target.value)}}}),r)}}),(0,V.jsx)(je.A.Item,{name:"answer",label:"文本答案",children:(0,V.jsx)(Rt.Z,{defaultValue:p,toolbarKeys:(0,Pt.eD)(),style:{height:"200px",width:"600px"},maxLength:16383,onChange:function(e,t,n){console.log("Editor content changed:",e,t,n),m(n),w(e),A(t)}})}),(0,V.jsxs)(je.A.Item,{label:"图片",tooltip:"可以上传多张图片作为回复内容",children:[(0,V.jsx)(Ut.Z,g()(g()({},ht),{},{children:mt})),(0,V.jsx)(ne.Z,{open:Be,title:$e,footer:null,onCancel:function(){return Ne(!1)},children:(0,V.jsx)(Tt.Z,{alt:"预览图片",style:{width:"100%"},src:Ge})})]}),(0,V.jsx)(je.A.Item,{label:"附件",tooltip:"可以上传多个附件作为回复内容",children:(0,V.jsx)(Ut.Z,g()(g()({},bt),{},{children:(0,V.jsx)(D.ZP,{icon:(0,V.jsx)(_.Z,{}),children:"上传附件"})}))}),(0,V.jsxs)(ye.Z,{orientation:"left",children:["扩展答案列表",(0,V.jsx)(D.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,V.jsx)(xt.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,V.jsx)(_.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,r=e.action,a=t.index;return(0,V.jsx)(qt.Z,{size:"small",style:{marginBottom:16},extra:r,children:n},a)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,V.jsx)("div",{children:e})},children:(0,V.jsxs)(vt.UW,{children:[(0,V.jsx)(Mt.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,V.jsx)(Ze.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,V.jsx)(Qe.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:ge,fieldProps:{placeholder:"请选择相关问题"}}),(0,V.jsx)(je.A.Item,{label:"标签",children:(0,V.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[G.map((function(e){return(0,V.jsx)(ae.Z,{closable:!0,onClose:function(){return t=e,n=G.filter((function(e){return e!==t})),void Q(n);var t,n},children:e},e)})),$?(0,V.jsx)(Et.Z,{ref:oe,type:"text",size:"small",style:{width:78},value:re,onChange:function(e){se(e.target.value)},onBlur:ft,onPressEnter:ft}):(0,V.jsxs)(ae.Z,{onClick:function(){X(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,V.jsx)(_.Z,{})," 新标签"]})]})}),(0,V.jsx)(yt.Z.Group,{name:"dateType",label:"有效期设置",options:[{label:"永久有效",value:"permanent"},{label:"自定义日期",value:"custom"}],fieldProps:{onChange:function(e){ke(e.target.value),"permanent"===e.target.value&&u.setFieldValue("dateRange",void 0)},value:we}}),"custom"===we&&(0,V.jsx)(At,{name:"dateRange",label:"有效日期",rules:[{required:"custom"===we,message:"请选择有效日期范围"}],fieldProps:{style:{width:"100%"}}}),(0,V.jsx)(Ft.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:xe,onChange:function(e){ve(e)}}})]})})})},Lt=["current","pageSize"],Vt=function(){var e=(0,u.useIntl)(),t=(0,T.Z)().translateString,n=(0,i.useRef)(),r=(0,i.useState)(!0),a=k()(r,2),o=a[0],l=a[1],c=(0,i.useState)(),f=k()(c,2),p=f[0],h=f[1],x=(0,i.useState)(!1),v=k()(x,2),y=v[0],w=v[1],S=(0,i.useState)(1),Z=k()(S,2),C=Z[0],A=Z[1],F=(0,i.useState)(10),U=k()(F,2),I=U[0],R=U[1],O=(0,E.u)((function(e){return e.currentOrg})),L=(0,q.j)((function(e){return e.currentKbase})),z=(0,Y.v)((function(e){return e.currentCategory})),B=(0,Y.v)((function(e){return e.categorySelectOptions})),N=(0,i.useState)(!1),H=k()(N,2),K=H[0],G=H[1],Q=(0,i.useState)([]),W=k()(Q,2),re=W[0],ie=W[1],de=(0,i.useState)([]),fe=k()(de,2),ge=fe[0],pe=fe[1],he=(0,i.useState)(0),xe=k()(he,2),ve=xe[0],Me=xe[1],ye=(0,i.useState)(!1),be=k()(ye,2),we=be[0],je=be[1],Se=(0,i.useState)(!1),Ze=k()(Se,2),Ce=Ze[0],Ae=Ze[1],Fe=(0,i.useState)({}),Ue=k()(Fe,2),Te=Ue[0],qe=Ue[1],Ee=function(){var t=b()(M()().mark((function t(r){var a;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,(0,gt.Yg)(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):j.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ie=function(){var t=b()(M()().mark((function t(){var r,a,s,o,i,l;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ge.length){t.next=3;break}return j.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ge),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,gt.Yg)(l);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:j.yw.destroy(),0===s?j.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):j.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ie([]),pe([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Pe=function(){var t=b()(M()().mark((function t(r){var a,s,o,i,l,u;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ge.length){t.next=3;break}return j.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),t.abrupt("return");case 3:j.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):e.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),s=0,o=0,i=m()(ge),t.prev=7,i.s();case 9:if((l=i.n()).done){t.next=23;break}return u=l.value,t.prev=11,t.next=14,(0,gt.kv)({uid:u.uid,enabled:r});case 14:200===t.sent.code?s++:o++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),o++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),i.e(t.t1);case 28:return t.prev=28,i.f(),t.finish(28);case 31:j.yw.destroy(),0===o?j.yw.success(r?e.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:s})):j.yw.warning(r?e.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:s,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:s,fail:o})),ie([]),pe([]),null===(a=n.current)||void 0===a||a.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(e){return t.apply(this,arguments)}}(),Re=function(){var t=b()(M()().mark((function t(){var r,a,o;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ve){t.next=3;break}return j.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),t.abrupt("return");case 3:return j.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),t.prev=4,r={categoryUid:(null==z?void 0:z.uid)===s.zBg?"":null==z?void 0:z.uid,kbUid:null==L?void 0:L.uid,orgUid:null==O?void 0:O.uid},t.next=8,(0,gt.QB)(r);case 8:200===(a=t.sent).code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=n.current)||void 0===o||o.reloadAndRest()):(j.yw.destroy(),j.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),j.yw.destroy(),j.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),Oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.question.tooltip",defaultMessage:"常见问题的问题内容"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"questionList",width:200,ellipsis:!0,search:!1,tooltip:e.formatMessage({id:"faq.similar.questions.tooltip",defaultMessage:"表达相同意思的其他问法"}),render:function(e,t){if(!t.questionList||0===t.questionList.length)return"-";var n=t.questionList.length>3,r=t.questionList.slice(0,3);return(0,V.jsxs)("div",{children:[r.map((function(e,t){return(0,V.jsx)(ae.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),n&&(0,V.jsxs)(ae.Z,{color:"orange",children:["+",t.questionList.length-3]})]})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.answer.tooltip",defaultMessage:"常见问题的回答内容"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.status.tooltip",defaultMessage:"问题处理状态"}),render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,V.jsx)(ae.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.vectorStatus.tooltip",defaultMessage:"向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,V.jsx)(ae.Z,{color:a,icon:(0,V.jsx)(Ne.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.clickCount.tooltip",defaultMessage:"问题被点击的次数"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.upCount.tooltip",defaultMessage:"问题被点赞的次数"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.downCount.tooltip",defaultMessage:"问题被踩的次数"})},{title:(0,V.jsx)(u.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.category.tooltip",defaultMessage:"问题所属的分类"}),render:function(e,t){var n=B.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,V.jsx)(ae.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:B.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.tags",defaultMessage:"标签"}),dataIndex:"tagList",width:150,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.tags.tooltip",defaultMessage:"用于分类和搜索的标签"}),render:function(e,t){if(!t.tagList||0===t.tagList.length)return"-";var n=t.tagList.length>3,r=t.tagList.slice(0,3);return(0,V.jsxs)("div",{children:[r.map((function(e,t){return(0,V.jsx)(ae.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,V.jsxs)(ae.Z,{color:"orange",children:["+",t.tagList.length-3]})]})}},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.isValid.tooltip",defaultMessage:"问题是否有效可用"}),valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.startDate.tooltip",defaultMessage:"问题生效的开始时间"}),render:function(e,t){return t.startDate?le()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.endDate.tooltip",defaultMessage:"问题失效的结束时间"}),render:function(e,t){return t.endDate?le()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,V.jsx)(u.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.createdAt.tooltip",defaultMessage:"问题创建的时间"}),render:function(e,t){return le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,V.jsx)(u.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.updatedAt.tooltip",defaultMessage:"问题最后更新的时间"}),render:function(e,t){return t.updatedAt?le()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,V.jsx)("a",{onClick:function(){!function(e){console.log("showEditDrawer",e),h(e),l(!0),w(!0)}(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,V.jsx)(se.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return Ee(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,V.jsx)(D.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete"),(0,V.jsx)(oe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return De(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Le(n)}}]},placement:"bottomRight",children:(0,V.jsx)(ht.Z,{title:e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,V.jsxs)(D.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,V.jsx)(ee.Z,{})]})})},"indexOperations")]}}],De=function(){var t=b()(M()().mark((function t(r){var a,s;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),t.prev=1,t.next=4,(0,gt.RF)({uid:r.uid});case 4:a=t.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Le=function(){var t=b()(M()().mark((function t(r){var a,s;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),t.prev=1,t.next=4,(0,gt.YO)({uid:r.uid});case 4:a=t.sent,j.yw.destroy(),200===a.code?(j.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):j.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),j.yw.destroy(),j.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Ve=function(){we?Ce?j.yw.info("正在检查模型状态，请稍后再试"):(h(void 0),l(!1),w(!0)):ne.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){h(void 0),l(!1),w(!0)}})},ze=function(){var t=b()(M()().mark((function t(r){var a,s;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),o?j.yw.loading(e.formatMessage({id:"updating"})):j.yw.loading(e.formatMessage({id:"creating"})),!o){t.next=8;break}return t.next=5,(0,gt.y)(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,gt.kh)(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createFaq response:",r,a),200===a.code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),w(!1),null===(s=n.current)||void 0===s||s.reloadAndRest()):(j.yw.destroy(),j.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ye=function(){var t=b()(M()().mark((function t(){return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(we){t.next=3;break}return ne.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){G(!0)}}),t.abrupt("return");case 3:if(!Ce){t.next=6;break}return j.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:G(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[L,z]);var Be=function(){var t=b()(M()().mark((function t(){return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ce.HK)(s.QPQ,null==O?void 0:O.uid,null==L?void 0:L.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),He=function(){var e=b()(M()().mark((function e(t,n,r){var a,o;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),o=g()({categoryUid:(null==z?void 0:z.uid)===s.zBg?"":null==z?void 0:z.uid,kbUid:null==L?void 0:L.uid,orgUid:(null==O?void 0:O.uid)||"",accessToken:a||"",exportType:t},Te),"current"===t?(o.pageNumber=String(C-1),o.pageSize=String(I)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=String(n),o.pageSize=String(r)),window.open((0,P.kG)()+"/api/v1/faq/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Qe={selectedRowKeys:re,onChange:function(e,t){ie(e),pe(t)}},We=function(){var t=b()(M()().mark((function t(n,r,a){var o,i,l,u,c,f,p,m;return M()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),j.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,l=d()(n,Lt),A(o),R(i),qe(l),u=void 0,c=void 0,r&&Object.keys(r).length>0&&(f=Object.keys(r)[0],u=f,c="ascend"===r[f]?"ascend":"descend"),p=g()(g()({pageNumber:o-1,pageSize:i,categoryUid:(null==z?void 0:z.uid)===s.zBg?"":null==z?void 0:z.uid,kbUid:null==L?void 0:L.uid,orgUid:null==O?void 0:O.uid},l),{},{sortBy:u,sortDirection:c}),t.next=12,(0,gt.pf)(p);case 12:return m=t.sent,console.log("queryFaqsByOrg response:",p,m),j.yw.destroy(),200===m.code?Me(m.data.totalElements):j.yw.error(m.message),t.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),_e=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return He("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(me,{onModelStatusChange:function(e){je(e),Ae(!1)}}),(0,V.jsx)(te.Z,{columns:Oe,actionRef:n,cardBordered:!0,rowSelection:Qe,request:We,scroll:{x:2300},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){A(e),R(t)}},dateFormatter:"string",headerTitle:t(null==L?void 0:L.name)+" - 常见问题",tooltip:Ce?"正在检查嵌入式模型...":we?"所添加FAQ内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[];(0,P.Ox)()||t.push((0,V.jsx)(D.ZP,{icon:(0,V.jsx)(_.Z,{}),type:"primary",onClick:Ve,disabled:Ce,children:e.formatMessage({id:"create"})},"create"),(0,V.jsx)(ht.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,V.jsx)(ke,{currentKbase:L,currentOrg:O,embeddingModelExists:we,checkingEmbeddingModel:Ce})},"chat"));var n=[];re.length>0&&n.push({key:"batchDelete",icon:(0,V.jsx)(J.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(re.length,")"),onClick:function(){ne.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(re.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ie,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,V.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(re.length,")"),onClick:function(){return Pe(!0)}},{key:"batchDisable",icon:(0,V.jsx)(mt.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(re.length,")"),onClick:function(){return Pe(!1)}}),n.push({key:"deleteAll",icon:(0,V.jsx)($.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){ne.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:Re,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"import",icon:(0,V.jsx)(Ke.Z,{}),label:e.formatMessage({id:"import"}),onClick:Ye,disabled:Ce},{key:"export-current",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return He("current")}}];return ve>0&&(ve<=1e3?r.push({key:"export-all",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ve,"条)"),onClick:function(){return He("all")}}):r.push({key:"export-range",icon:(0,V.jsx)(X.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ve,"条)"),children:_e(ve)})),r.push({key:"download",icon:(0,V.jsx)(Ge.Z,{}),label:e.formatMessage({id:"download.template"}),onClick:function(){return(0,P.IY)()}}),t.push((0,V.jsx)(oe.Z,{menu:{items:r},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,V.jsx)(ee.Z,{})]})},"importExport")),n.length>0&&t.push((0,V.jsx)(oe.Z,{menu:{items:n},placement:"bottom",children:(0,V.jsxs)(D.ZP,{type:re.length>0?"primary":"default",danger:re.length>0,children:[re.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(re.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,V.jsx)(ee.Z,{})]})},"batchOperations")),t}()}}),(0,V.jsx)(Dt,{isEdit:o,open:y,faq:p,onClose:function(){return w(!1)},onSubmit:ze}),K&&(0,V.jsx)(ue.Z,{type:s.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:K,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),G(!1),null==n||n.current.reload(),Be()},handleCancel:function(){console.log("handleUploadDragCancel"),G(!1),null==n||n.current.reload()}})]})};var zt=function(){var e=(0,u.useIntl)(),t=(0,i.useMemo)((function(){var t=[{key:"faq",label:e.formatMessage({id:"pages.robot.kb.faq",defaultMessage:"Q&A"}),children:(0,V.jsx)(Vt,{})}];return(0,P.Ox)()||t.push({key:"text",label:e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,V.jsx)(Je,{})},{key:"file",label:e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,V.jsx)(Fe,{})},{key:"split",label:e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"}),children:(0,V.jsx)(ft,{})}),t}),[e]);return(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(l.Z,{items:t})})},Yt=a.Z.Sider,Bt=a.Z.Content,Nt=function(){var e=(0,r.Z)(),t=e.leftSiderWidth,n=e.leftSiderStyle,i=e.contentStyle;return(0,V.jsx)("div",{children:(0,V.jsxs)(a.Z,{children:[(0,V.jsx)(Yt,{width:t,style:n,children:(0,V.jsx)(o.Z,{type:s.QPQ})}),(0,V.jsx)(a.Z,{children:(0,V.jsx)(Bt,{style:i,children:(0,V.jsx)(zt,{})})})]})})}}}]);