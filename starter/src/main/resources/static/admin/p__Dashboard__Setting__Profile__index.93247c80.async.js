"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9290],{88678:function(e,n,a){a.d(n,{Z:function(){return w}});var r=a(90819),t=a.n(r),s=a(89933),o=a.n(s),i=a(45332),c=a.n(i),u=a(55735),l=a(30921);function d(){return f.apply(this,arguments)}function f(){return(f=o()(t()().mark((function e(){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/kaptcha/api/v1/get",{method:"GET",params:{client:u.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,n){return g.apply(this,arguments)}function g(){return(g=o()(t()().mark((function e(n,a){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:n,captchaCode:a,client:u.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=a(58087),h=a(52288),v=a(44194),x=a(31549),w=function(e){var n=e.onKaptchaChange,a=e.onKaptchaCheck,r=(0,l.useIntl)(),s=(0,v.useState)(),i=c()(s,2),u=i[0],f=i[1],g=(0,v.useState)(),w=c()(g,2),b=w[0],M=w[1],y=function(){var e=o()(t()().mark((function e(){var n;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:200===(n=e.sent).code&&(f(n.data.captchaUid),M(n.data.captchaImage));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=o()(t()().mark((function e(n,r){var s;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(n,r);case 2:s=e.sent,console.log("checkCaptcha response",s),200===s.code?a&&a(!0):a&&a(!1);case 5:case"end":return e.stop()}}),e)})));return function(n,a){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){y()}),[]);return(0,x.jsx)(x.Fragment,{children:b&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(h.Z,{onChange:function(e){n&&(n(u,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?k(u,e.target.value):a&&a(!1))},prefix:(0,x.jsx)(m.Z,{}),placeholder:r.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,x.jsx)("img",{src:b,alt:"captcha",onClick:y})]})})}},6631:function(e,n,a){a.d(n,{G:function(){return f}});var r=a(73193),t=a.n(r),s=(a(44194),a(30348)),o=a(55735),i=a(28977),c=a.n(i),u=a(86803),l=a(36310),d=a(31549),f=function(e){var n=e.children,a=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",client:o.bVn},f={name:"file",accept:"image/*",action:(0,l.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var n=c()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=n,i.fileType=e.type,console.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var n=e.file.response.data.fileUrl;a(n),u.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,d.jsx)(s.Z,t()(t()({},f),{},{children:n}))}},76750:function(e,n,a){var r=a(55735),t=a(65461),s=a(30921);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,t.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,t.aS)(n,10)}}}},87416:function(e,n,a){a.r(n),a.d(n,{default:function(){return R}});var r=a(90819),t=a.n(r),s=a(73193),o=a.n(s),i=a(89933),c=a.n(i),u=a(45332),l=a.n(u),d=a(44194),f=a(84288),p=a(75365),g=a(69169),m=a(4499),h=a(32350),v=a(30921),x=a(59908),w=a(51239),b=a(67318),M=a(86803),y=a(6631),k=a(76750),j=a(65461),C=a(53530),Z=a(31549),P=function(e){var n=e.open,a=e.onClose,r=(0,v.useIntl)(),s=(0,k.Z)().translateString;return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(C.Z,{title:r.formatMessage({id:"pages.settings.reset.password",defaultMessage:"重置密码"}),forceRender:!0,open:n,footer:null,onCancel:function(){a()},children:(0,Z.jsxs)(g.A,{initialValues:{oldPassword:"",newPassword:"",confirmPassword:""},onFinish:function(){var e=c()(t()().mark((function e(n){var r,o;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changePassword:",n),!(n.newPassword.trim().length<6)){e.next=4;break}return M.yw.error("密码最小长度不能小于6"),e.abrupt("return");case 4:if(n.newPassword===n.confirmPassword){e.next=7;break}return M.yw.error("两次输入密码不一致"),e.abrupt("return");case 7:return r={oldPassword:n.oldPassword,newPassword:n.newPassword},e.next=10,(0,b.Cp)(r);case 10:o=e.sent,console.log("changePassword response:",o),200===o.code?(M.yw.success("Password changed successfully!"),a()):M.yw.error(s(o.message));case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,Z.jsx)(m.Z.Password,{name:"oldPassword",label:"原密码(手机号直接登录用户，可以留空)"}),(0,Z.jsx)(m.Z.Password,{name:"newPassword",label:"新密码"}),(0,Z.jsx)(m.Z.Password,{name:"confirmPassword",label:"确认密码"})]})})})},U=a(45739),S=a(88678),F=a(40612),I=a(55735),A=a(40795),V=a(26978),E=a(59129),T=function(e){var n=e.open,a=e.onSubmit,r=e.onClose,s=(0,v.useIntl)(),o=g.A.useForm(),i=l()(o,1)[0],u=(0,k.Z)().translateString,f=(0,w.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),p=f.userInfo,h=f.deviceUid,x=(0,F.u)((function(e){return e.currentOrg})),y=(0,d.useRef)(),j=(0,d.useState)(""),P=l()(j,2),T=P[0],q=P[1],L=(0,d.useState)(""),R=l()(L,2),z=R[0],N=R[1],K=(0,d.useState)(!1),G=l()(K,2),O=G[0],Y=G[1],D=function(){var e=c()(t()().mark((function e(n,a){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",n," captchaValue",a),q(n),N(a);case 3:case"end":return e.stop()}}),e)})));return function(n,a){return e.apply(this,arguments)}}(),W=function(){var e=c()(t()().mark((function e(n){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",n),Y(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=c()(t()().mark((function e(){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.validateFields().then(function(){var e=c()(t()().mark((function e(n){var s,o;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeEmail:",n),(null==p?void 0:p.email)!==n.email){e.next=4;break}return M.yw.error("Email is not changed!"),e.abrupt("return");case 4:return s={email:n.email,code:n.code,platform:I.iw8},e.next=7,(0,b.Uk)(s);case 7:o=e.sent,console.log("changeEmail response:",o),200===o.code?(M.yw.success("Email changed successfully!"),a(n.email),r()):M.yw.error(u(o.message));case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=y.current)||void 0===e||e.endTiming()}),2)};return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(C.Z,{title:s.formatMessage({id:"pages.settings.reset.email",defaultMessage:"重置邮箱"}),forceRender:!0,open:n,footer:null,onCancel:function(){r()},children:(0,Z.jsxs)(g.A,{form:i,onFinish:function(){var e=c()(t()().mark((function e(n){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeEmail:",n),_();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,Z.jsx)(m.Z,{fieldProps:{size:"large",prefix:(0,Z.jsx)(A.Z,{})},name:"email",placeholder:s.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,Z.jsx)(v.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"请输入邮箱！"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,Z.jsx)(g.A.Item,{name:"captchaCode",rules:[],children:(0,Z.jsx)(S.Z,{onKaptchaChange:D,onKaptchaCheck:W})}),(0,Z.jsx)(E.Z,{fieldProps:{size:"large",prefix:(0,Z.jsx)(V.Z,{})},captchaProps:{size:"large",disabled:!O},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,n){return e?"".concat(n," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"email",name:"code",rules:[{required:!0,message:(0,Z.jsx)(v.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:y,onGetCaptcha:function(){var e=c()(t()().mark((function e(n){var a,r;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email:",n),!n){e.next=18;break}if((null==p?void 0:p.email)!==n){e.next=6;break}return M.yw.error("Email is not changed!"),$(),e.abrupt("return");case 6:return a={email:n,type:I.Iju,captchaUid:T,captchaCode:z,deviceUid:h,userUid:null==p?void 0:p.uid,orgUid:null==x?void 0:x.uid,platform:I.iw8},e.next=9,(0,U.O8)(a);case 9:if(r=e.sent,console.log("sendEmailCode",r),200===r.code){e.next=15;break}return M.yw.error(r.message),$(),e.abrupt("return");case 15:M.yw.success(r.message),e.next=19;break;case 18:M.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()})]})})})},q=function(e){var n=e.open,a=e.onSubmit,r=e.onClose,s=(0,v.useIntl)(),o=g.A.useForm(),i=l()(o,1)[0],u=(0,k.Z)().translateString,f=(0,w.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),p=f.userInfo,h=f.deviceUid,x=(0,F.u)((function(e){return e.currentOrg})),y=(0,d.useRef)(),j=(0,d.useState)(""),P=l()(j,2),T=P[0],q=P[1],L=(0,d.useState)(""),R=l()(L,2),z=R[0],N=R[1],K=(0,d.useState)(!1),G=l()(K,2),O=G[0],Y=G[1],D=function(){var e=c()(t()().mark((function e(n,a){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",n," captchaValue",a),q(n),N(a);case 3:case"end":return e.stop()}}),e)})));return function(n,a){return e.apply(this,arguments)}}(),W=function(){var e=c()(t()().mark((function e(n){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",n),Y(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=c()(t()().mark((function e(){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.validateFields().then(function(){var e=c()(t()().mark((function e(n){var s,o;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeMobile:",n),(null==p?void 0:p.mobile)!==n.mobile){e.next=4;break}return M.yw.error("mobile is not changed"),e.abrupt("return");case 4:return s={mobile:n.mobile,code:n.code,platform:I.iw8},e.next=7,(0,b.KF)(s);case 7:o=e.sent,console.log("changeMobile response:",o),200===o.code?(M.yw.success("Mobile changed successfully!"),a(n.mobile),r()):M.yw.error(u(o.message));case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=y.current)||void 0===e||e.endTiming()}),2)};return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(C.Z,{title:s.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"重置手机号"}),forceRender:!0,open:n,footer:null,onCancel:function(){r()},children:(0,Z.jsxs)(g.A,{form:i,onFinish:function(){var e=c()(t()().mark((function e(n){return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeMobile:",n),_();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,Z.jsx)(m.Z,{fieldProps:{size:"large",prefix:(0,Z.jsx)(A.Z,{})},name:"mobile",placeholder:s.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,Z.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,Z.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,Z.jsx)(g.A.Item,{name:"captchaCode",rules:[],children:(0,Z.jsx)(S.Z,{onKaptchaChange:D,onKaptchaCheck:W})}),(0,Z.jsx)(E.Z,{fieldProps:{size:"large",prefix:(0,Z.jsx)(V.Z,{})},captchaProps:{size:"large",disabled:!O},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,n){return e?"".concat(n," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,Z.jsx)(v.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:y,onGetCaptcha:function(){var e=c()(t()().mark((function e(n){var a,r;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",n),!n||11!==n.length){e.next=18;break}if((null==p?void 0:p.mobile)!==n){e.next=6;break}return M.yw.error("mobile is not changed"),$(),e.abrupt("return");case 6:return a={mobile:n,type:I.BG8,captchaUid:T,captchaCode:z,deviceUid:h,userUid:null==p?void 0:p.uid,orgUid:null==x?void 0:x.uid,platform:I.iw8},e.next=9,(0,U.Y7)(a);case 9:if(r=e.sent,console.log("sendMobileCode",r),200===r.code){e.next=15;break}return M.yw.error(r.message),$(),e.abrupt("return");case 15:M.yw.success(r.message),e.next=19;break;case 18:M.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()})]})})})},L={labelCol:{span:8},wrapperCol:{span:8}},R=function(){var e=(0,v.useIntl)(),n=g.A.useForm(),a=l()(n,1)[0],r=(0,k.Z)().translateString,s=(0,w.L)((function(e){return{userInfo:e.userInfo,setUserInfo:e.setUserInfo}})),i=s.userInfo,u=s.setUserInfo,C=(0,d.useState)(""),U=l()(C,2),S=U[0],F=U[1],I=(0,d.useState)(!1),A=l()(I,2),V=A[0],E=A[1],R=(0,d.useState)(!1),z=l()(R,2),N=z[0],K=z[1],G=(0,d.useState)(!1),O=l()(G,2),Y=O[0],D=O[1],W=function(){var n=c()(t()().mark((function n(s){var c,l;return t()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=o()(o()(o()({},i),s),{},{avatar:S}),console.log(c),n.next=4,(0,b.ck)(c);case 4:l=n.sent,console.log("updateProfile response:",l),200===l.code?(M.yw.success(e.formatMessage({id:"update.success"})),l.data.username!==i.username?(0,j.NZ)():(u(l.data),a.setFieldsValue({uid:l.data.uid,username:l.data.username,nickname:r(l.data.nickname),email:l.data.email,mobile:l.data.mobile,description:r(l.data.description)}))):M.yw.error(l.message);case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();(0,d.useEffect)((function(){i&&F(i.avatar)}),[i]);var _=function(){var e=c()(t()().mark((function e(){var n;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.Ai)();case 2:n=e.sent,console.log("handleRefreshProfile getProfile response:",n),200===n.code?(u(n.data),a.setFieldsValue({uid:n.data.uid,username:n.data.username,nickname:r(n.data.nickname),email:n.data.email,mobile:n.data.mobile,description:r(n.data.description)})):M.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,d.useEffect)((function(){_()}),[]),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(g.A,o()(o()({},L),{},{form:a,onFinish:W,children:[(0,Z.jsx)(m.Z,{name:"uid",label:"Uid",rules:[{required:!0}],readonly:!0}),(0,Z.jsx)(g.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:e.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,Z.jsxs)(y.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),F(e)},onError:function(e){console.log("handleUploadError:",e)},children:[(0,Z.jsx)(f.C,{src:S}),(0,Z.jsx)(p.ZP,{icon:(0,Z.jsx)(x.Z,{}),children:e.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,Z.jsx)(m.Z,{name:"username",label:e.formatMessage({id:"username.change.tip",defaultMessage:"Username"}),rules:[{required:!0}]}),(0,Z.jsx)(p.ZP,{onClick:function(){E(!0)},children:e.formatMessage({id:"pages.settings.reset.password",defaultMessage:"重置密码"})}),(0,Z.jsx)(m.Z,{name:"nickname",label:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),rules:[{required:!0}]}),(0,Z.jsx)(m.Z,{name:"email",label:i.emailVerified?e.formatMessage({id:"email.verified",defaultMessage:"Email Verified"}):e.formatMessage({id:"email.unverified",defaultMessage:"email unverified"}),rules:[{type:"email"}],readonly:!0}),(0,Z.jsx)(p.ZP,{onClick:function(){K(!0)},children:e.formatMessage({id:"pages.settings.reset.email",defaultMessage:"重置邮箱"})}),(0,Z.jsx)(m.Z,{name:"mobile",label:i.mobileVerified?e.formatMessage({id:"mobile.verified",defaultMessage:"Mobile Verified"}):e.formatMessage({id:"mobile.unverified",defaultMessage:"mobile unverified"}),readonly:!0}),(0,Z.jsx)(p.ZP,{onClick:function(){D(!0)},children:e.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"重置手机号"})}),(0,Z.jsx)(h.Z,{name:"description",label:e.formatMessage({id:"description",defaultMessage:"Description"})})]})),V&&(0,Z.jsx)(P,{open:V,onClose:function(){E(!1)}}),N&&(0,Z.jsx)(T,{open:N,onSubmit:function(e){K(!1),i.email=e,u(i),a.setFieldValue("email",e)},onClose:function(){K(!1)}}),Y&&(0,Z.jsx)(q,{open:Y,onSubmit:function(e){D(!1),i.mobile=e,u(i),a.setFieldValue("mobile",e)},onClose:function(){D(!1)}})]})}}}]);