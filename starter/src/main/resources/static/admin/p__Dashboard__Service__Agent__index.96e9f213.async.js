"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{4308:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"},s=n(5901),o=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var l=a.forwardRef(o)},82325:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M744 62H280c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h464c35.3 0 64-28.7 64-64V126c0-35.3-28.7-64-64-64zm-8 824H288V134h448v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"mobile",theme:"outlined"},s=n(5901),o=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var l=a.forwardRef(o)},22014:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(83910),a=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=n(5901),o=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var l=a.forwardRef(o)},86772:function(e,t,n){var r=n(94433),a=n(38956),i=n(75477),s=n(941),o=n(44194),l=n(99066),u=n(46659),d=n(31549),c=["options","fieldProps","proFieldProps","valueEnum"],f=o.forwardRef((function(e,t){var n=e.options,s=e.fieldProps,o=e.proFieldProps,l=e.valueEnum,f=(0,a.Z)(e,c);return(0,d.jsx)(u.Z,(0,r.Z)({ref:t,valueType:"checkbox",valueEnum:(0,i.h)(l,void 0),fieldProps:(0,r.Z)({options:n},s),lightProps:(0,r.Z)({labelFormatter:function(){return(0,d.jsx)(u.Z,(0,r.Z)({ref:t,valueType:"checkbox",mode:"read",valueEnum:(0,i.h)(l,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:n},s),proFieldProps:o},f))}},f.lightProps),proFieldProps:o},f))})),p=o.forwardRef((function(e,t){var n=e.fieldProps,a=e.children;return(0,d.jsx)(s.Z,(0,r.Z)((0,r.Z)({ref:t},n),{},{children:a}))})),g=(0,l.G)(p,{valuePropName:"checked"});g.Group=f,t.Z=g},82465:function(e,t,n){var r=n(94433),a=n(38956),i=n(44194),s=n(46659),o=n(31549),l=["fieldProps","min","proFieldProps","max"],u=function(e,t){var n=e.fieldProps,i=e.min,u=e.proFieldProps,d=e.max,c=(0,a.Z)(e,l);return(0,o.jsx)(s.Z,(0,r.Z)({valueType:"digit",fieldProps:(0,r.Z)({min:i,max:d},n),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:u},c))},d=i.forwardRef(u);t.Z=d},50447:function(e,t,n){var r=n(94433),a=n(38956),i=n(75477),s=n(44194),o=n(18758),l=n(46659),u=n(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var n=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,x=e.options,b=(0,a.Z)(e,d),M=(0,s.useContext)(o.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,i.h)(m),request:v,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:x,mode:g,showSearch:h,getPopupContainer:M.getPopupContainer},n),ref:t,proFieldProps:p},b),{},{children:c}))},p=s.forwardRef((function(e,t){var n=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.options,x=(0,a.Z)(e,c),b=(0,r.Z)({options:h,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),M=(0,s.useContext)(o.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,i.h)(m),request:v,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:M.getPopupContainer},b),ref:t,proFieldProps:p},x),{},{children:d}))})),g=s.forwardRef(f);g.SearchSelect=p,g.displayName="ProFormComponent",t.Z=g},59853:function(e,t,n){var r=n(94433),a=n(38956),i=n(44194),s=n(46659),o=n(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=i.forwardRef((function(e,t){var n=e.fieldProps,i=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,a.Z)(e,l);return(0,o.jsx)(s.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:i,checkedChildren:u},n),ref:t,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=u},47268:function(e,t,n){var r=n(32906),a=n(94433),i=n(38956),s=n(92032),o=n(70878),l=n(35068),u=n(21762),d=n(44194),c=n(46659),f=n(31549),p=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",v=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,r.Z)(t,2),i=n[0],u=n[1];return(0,f.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:i,children:e.children}))}})},h=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,i.Z)(e,p);return(0,f.jsx)(c.Z,(0,a.Z)({valueType:m,fieldProps:t,filedConfig:{valueType:m},proFieldProps:n},r))};h.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,s=(0,i.Z)(e,g),o=(0,d.useState)(!1),l=(0,r.Z)(o,2),p=l[0],h=l[1];return null!=t&&t.statusRender&&s.name?(0,f.jsx)(v,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:h,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),h(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),h(!0)}}),proFieldProps:n,filedConfig:{valueType:m}},s))})}):(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:m}},s))},h.displayName="ProFormComponent",t.Z=h},26608:function(e,t,n){var r=n(94433),a=n(38956),i=n(44194),s=n(46659),o=n(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var n=e.fieldProps,i=e.proFieldProps,u=(0,a.Z)(e,l);return(0,o.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:i},u))};t.Z=i.forwardRef(u)},79481:function(e,t,n){var r=n(94433),a=n(38956),i=n(44194),s=n(46659),o=n(31549),l=["fieldProps","request","params","proFieldProps"],u=function(e,t){var n=e.fieldProps,i=e.request,u=e.params,d=e.proFieldProps,c=(0,a.Z)(e,l);return(0,o.jsx)(s.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:i,params:u,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=i.forwardRef(u);t.Z=d},54008:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return h},t5:function(){return m},v_:function(){return p}});var r=n(90819),a=n.n(r),i=n(73193),s=n.n(i),o=n(89933),l=n.n(o),u=n(68992),d=n(62395);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},6090:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return h},hS:function(){return m},z_:function(){return c}});var r=n(90819),a=n.n(r),i=n(73193),s=n.n(i),o=n(89933),l=n.n(o),u=n(68992),d=n(62395);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},65041:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),i=(n(44194),n(2348)),s=n(68992),o=n(45634),l=n.n(o),u=n(46130),d=n(61489),c=n(87005),f=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:s.IrL,categoryUid:"",kbUid:"",channel:s.XtJ},p={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,u.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),d.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(i.Z,a()(a()({},p),{},{children:t}))}},38552:function(e,t,n){var r=n(70097);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},80690:function(e,t,n){n.r(t),n.d(t,{default:function(){return fe}});var r=n(44194),a=n(44528),i=n(62395),s=n(76711),o=n.n(s),l=n(73193),u=n.n(l),d=n(90819),c=n.n(d),f=n(89933),p=n.n(f),g=n(45332),m=n.n(g),v=n(88130),h=n(72264),x=n(13243),b=n(60593),M=n(42876),y=n(89654),w=n(33633),k=n(15065),Z=n(77902),S=n(6992),j=n(41881),P=n(91768),C=n(66759),T=n(61489),F=n(18313),U=n(77686),R=n(38552),q=n(70097),I=n(68992),E=n(91733),A=n(84005),L=(n(98257),n(30394)),N=(n(57648),n(23968),n(70878)),O=n(66248),z=n(31549),D=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,s=e.record,o=e.onSuccess,l=(0,i.useIntl)(),d=N.Z.useForm(),f=m()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(s?f.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(f.resetFields(),f.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,f]);var g=function(){var e=p()(c()().mark((function e(){var t,r,i,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.validateFields();case 3:if(t=e.sent,r=u()(u()({},t),{},{orgUid:a,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,F.wU)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,F.IH)(r);case 13:e.t0=e.sent;case 14:(i=e.t0)&&200===i.code?(d=i.data||{},T.yw.success(l.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==o||o(d),n(!1)):T.yw.error((null==i?void 0:i.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)(O.Z,{title:(0,z.jsx)(i.FormattedMessage,{id:null!=s&&s.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:g,onCancel:function(){n(!1)},okText:(0,z.jsx)(i.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,z.jsx)(i.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,z.jsxs)(N.Z,{form:f,layout:"vertical",preserve:!1,children:[(0,z.jsx)(N.Z.Item,{name:"name",label:(0,z.jsx)(i.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,z.jsx)(x.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,z.jsx)(N.Z.Item,{name:"description",label:(0,z.jsx)(i.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,z.jsx)(x.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,z.jsx)(N.Z.Item,{name:"enabled",label:(0,z.jsx)(i.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,z.jsx)(k.Z,{})})]})})},V=n(51898),B=n(28672),H=n(65448),J="welcome",_=function(){var e=(0,i.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,R.Z)(),s=n.leftSiderStyle,l=(n.contentStyle,(0,q.Z)().isDarkMode),d=(0,r.useState)(!1),f=m()(d,2),g=f[0],N=f[1],O=(0,r.useState)([]),_=m()(O,2),W=_[0],X=_[1],G=(0,r.useState)(),K=m()(G,2),Q=K[0],Y=K[1],$=(0,r.useState)(""),ee=m()($,2),te=ee[0],ne=ee[1],re=(0,r.useState)(J),ae=m()(re,2),ie=ae[0],se=ae[1],oe=(0,r.useState)(!1),le=m()(oe,2),ue=le[0],de=le[1],ce=(0,r.useState)(null),fe=m()(ce,2),pe=fe[0],ge=fe[1],me=(0,r.useMemo)((function(){return W.find((function(e){return e.uid===Q}))||null}),[W,Q]),ve=(0,r.useState)(!1),he=m()(ve,2),xe=he[0],be=he[1],Me=(0,r.useState)(!1),ye=m()(Me,2),we=ye[0],ke=ye[1],Ze=(0,E.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),Se=Ze.setCurrentAgentSettings,je=Ze.currentAgentSettings,Pe=(0,r.useState)(!1),Ce=m()(Pe,2),Te=Ce[0],Fe=Ce[1],Ue=(0,r.useRef)(""),Re=(0,r.useMemo)((function(){if(!te)return W;var e=te.toLowerCase();return W.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[W,te]),qe=(0,r.useCallback)(function(){var e=p()(c()().mark((function e(n,r){var a,i,s,o,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return N(!0),e.prev=3,i=(null!=n?n:"").trim(),s={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:i||void 0},e.next=8,(0,F.u9)(s);case 8:o=e.sent,console.log("查询客服配置模板列表结果：",o,s),l=(null==o||null===(a=o.data)||void 0===a?void 0:a.content)||[],X(l),!(l.length>0)||Q&&l.some((function(e){return e.uid===Q}))||(Y(l[0].uid),null!=r&&r.keepActive||se(J));case 13:return e.prev=13,N(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,Q]);(0,r.useEffect)((function(){qe(te)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){me?(Se(me),Ue.current=JSON.stringify(null!=me?me:{}),Fe(!1)):(Se(null),Ue.current=JSON.stringify({}),Fe(!1))}),[Q]),(0,r.useEffect)((function(){if(me)try{var e=JSON.stringify(null!=je?je:{});Fe(e!==Ue.current)}catch(e){Fe(!0)}}),[je,null==me?void 0:me.uid]);var Ie=function(){var n=p()(c()().mark((function n(r){var a,i,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:me)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return i={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,F.SJ)(i);case 6:s=n.sent,console.log("删除客服配置模板结果：",s,i),s&&200===s.code?(T.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),qe(te)):T.yw.error((null==s?void 0:s.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Ee=function(){var n=p()(c()().mark((function n(r,a){var i,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,i={uid:r,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,F.RB)(i);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,F.iO)(i);case 10:n.t0=n.sent;case 11:(s=n.t0)&&200===s.code?(T.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),qe(te)):T.yw.error((null==s?void 0:s.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),T.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),Ae=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Le=function(e){if(e){var t=Ae(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return Ae(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return u()(u()({},t),n?{toolbar:n}:{})}},Ne=function(e){if(e)return Ae(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Oe=function(e){if(e)return Ae(e,["name","description","color","order"])},ze=function(e){if(e)return Ae(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm","worktimeUids"])},De=function(e){if(e)return Ae(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},Ve=function(e){if(e)return Ae(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},Be=function(e){if(e)return Ae(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},He=function(e){if(e)return Ae(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},Je=function(){var n=p()(c()().mark((function n(){var r,a,i,s,o,l;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=me&&me.uid){n.next=3;break}return T.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return be(!0),n.prev=4,r=je&&je.uid===me.uid?je:me,a={uid:me.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,serviceSettings:Le(null==r?void 0:r.draftServiceSettings),inviteSettings:Ne(null==r?void 0:r.draftInviteSettings),intentionSettings:Oe(null==r?void 0:r.draftIntentionSettings),maxThreadCount:null==r?void 0:r.maxThreadCount,timeoutRemindEnabled:null==r?void 0:r.timeoutRemindEnabled,timeoutRemindTime:null==r?void 0:r.timeoutRemindTime,timeoutRemindTip:null==r?void 0:r.timeoutRemindTip,messageLeaveSettings:ze(null==r?void 0:r.draftMessageLeaveSettings),autoReplySettings:Ve(null==r?void 0:r.draftAutoReplySettings),queueSettings:De(null==r?void 0:r.draftQueueSettings),rateDownSettings:Be(null==r?void 0:r.draftRateDownSettings),agentStatusSettings:He(null==r?void 0:r.draftAgentStatusSettings)},n.next=9,(0,F.wU)(a);case 9:i=n.sent,console.log("保存客服配置模板结果：",i,a),i&&200===i.code?(T.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),l=null!==(s=null!==(o=i.data)&&void 0!==o?o:r)&&void 0!==s?s:{},Ue.current=JSON.stringify(l),Fe(!1),qe(te,{keepActive:!0})):T.yw.error((null==i?void 0:i.message)||"保存失败"),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(4),console.error("保存失败:",n.t0),T.yw.error("保存失败");case 18:return n.prev=18,be(!1),n.finish(18);case 21:case"end":return n.stop()}}),n,null,[[4,14,18,21]])})));return function(){return n.apply(this,arguments)}}(),_e=function(){var n=p()(c()().mark((function n(){var r,a,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=me&&me.uid){n.next=3;break}return T.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ke(!0),n.prev=4,!Te){n.next=8;break}return n.next=8,Je();case 8:return r={uid:me.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,F.Xy)(r);case 11:(a=n.sent)&&200===a.code?(T.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Ue.current=JSON.stringify(null!==(i=a.data)&&void 0!==i?i:{}),Fe(!1),qe(te)):T.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),T.yw.error("发布失败");case 19:return n.prev=19,ke(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),We=(0,r.useMemo)((function(){return null!=me&&me.uid?[{key:"welcome",label:(0,z.jsx)(i.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,z.jsx)(H.Z,{type:I.Njn,settingsUid:me.uid})},{key:"tips",label:(0,z.jsx)(i.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"}),children:(0,z.jsx)(B.Z,{type:I.Njn,settingsUid:me.uid})},{key:"service",label:(0,z.jsx)(i.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"}),children:(0,z.jsx)(V.Z,{type:I.Njn,settingsUid:me.uid})},{key:"rate",label:(0,z.jsx)(i.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,z.jsx)(A.Z,{type:I.Njn,settingsUid:me.uid})}].concat(o()([]),[{key:"right",label:(0,z.jsx)(i.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,z.jsx)(L.Z,{type:I.Njn,settingsUid:me.uid,isActive:"right"===ie})}],o()([]),o()([])):[]}),[null==me?void 0:me.uid,e]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,z.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:s,children:(0,z.jsxs)(C.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(S.Z,{}),type:"primary",onClick:function(){ge(null),de(!0)},children:(0,z.jsx)(i.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,z.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,z.jsx)(x.Z.Search,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:te,onChange:function(e){return ne(e.target.value)},onSearch:function(e){ne(e),qe(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,z.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,z.jsx)(b.Z,{dataSource:Re,locale:{emptyText:(0,z.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,z.jsx)(b.Z.Item,{style:Q===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Y(e.uid)},children:(0,z.jsx)(b.Z.Item.Meta,{title:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,z.jsx)(y.Z,{size:4,children:e.isDefault?(0,z.jsx)(w.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,z.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,z.jsx)(v.Z.Panel,{children:me?(0,z.jsx)(C.Z,{title:(0,z.jsxs)(y.Z,{children:[(0,z.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",me.name||me.uid]}),(0,z.jsx)(k.Z,{checked:me.enabled,onChange:function(e){return Ee(me.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(j.Z,{}),onClick:function(e){var t;e.stopPropagation(),ge(null!=(t=me)?t:me),de(!0)},children:"编辑"}),(0,z.jsx)(Z.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ie(me)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,z.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,z.jsx)(P.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),me.isDefault?(0,z.jsx)(w.Z,{color:"blue",children:"默认"}):null]}),extra:(0,z.jsxs)(y.Z,{children:[(0,z.jsx)(Z.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),_e()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,z.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:we,type:"default",children:(0,z.jsx)(i.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,z.jsx)(h.ZP,{onClick:function(){me&&(Se(me),Ue.current=JSON.stringify(null!=me?me:{}),Fe(!1))},disabled:!Te,children:(0,z.jsx)(i.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,z.jsx)(h.ZP,{type:"primary",loading:xe,onClick:Je,disabled:!Te,children:(0,z.jsx)(i.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,z.jsx)(a.Z,{activeKey:ie,onChange:se,items:We,style:{minHeight:"calc(100vh - 280px)"}})}):(0,z.jsx)(C.Z,{children:(0,z.jsx)(M.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,z.jsx)(D,{open:ue,onOpenChange:de,orgUid:(null==t?void 0:t.uid)||"",record:pe,onSuccess:function(){de(!1),qe(te)}})]})},W=n(54596),X=n(27401),G=n(6677),K=n(2915),Q=n(89007),Y=n(50447),$=n(47268),ee=n(26608),te=n(22014),ne=n(6090),re=n(65041),ae=function(e){var t,n,a=e.open,s=e.record,l=e.onClose,d=e.onSuccess,f=(0,i.useIntl)(),g=(0,U.u)((function(e){return e.currentOrg})),v=(0,r.useState)(!1),x=m()(v,2),b=x[0],M=x[1],y=(0,r.useState)([]),w=m()(y,2),k=w[0],Z=w[1],j=(0,r.useState)(!1),P=m()(j,2),C=P[0],R=P[1],q=(0,r.useState)((null==s?void 0:s.avatar)||""),I=m()(q,2),E=I[0],A=I[1],L=(0,r.useState)(0),N=m()(L,2),O=N[0],V=N[1],B=(0,r.useRef)(),H=(0,r.useMemo)((function(){return!(null==s||!s.uid)}),[s]),J=function(){var e=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(t),T.yw.success(f.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=(0,r.useCallback)(function(){var e=p()(c()().mark((function e(t){var n,r,a,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==g?void 0:g.uid,searchText:t||""},e.next=5,(0,F.u9)(r);case 5:return a=e.sent,console.log("queryAgentSettingsByOrg request:",r,a),i=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],Z(i),e.abrupt("return",i.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 10:return e.prev=10,R(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[1,,10,13]])})));return function(t){return e.apply(this,arguments)}}(),[null==g?void 0:g.uid]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(K.a,{open:a,onOpenChange:function(e){e||l()},title:H?f.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):f.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:B,initialValues:H?{nickname:null==s?void 0:s.nickname,email:null==s?void 0:s.email,mobile:null==s?void 0:s.mobile,description:null==s?void 0:s.description,memberUid:(null==s||null===(t=s.member)||void 0===t?void 0:t.uid)||(null==s?void 0:s.memberUid),settingsUid:null==s||null===(n=s.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:f.formatMessage({id:"save",defaultMessage:"保存"}),resetText:f.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return l()}}},onFinish:function(){var e=p()(c()().mark((function e(t){var n,r,a,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T.yw.loading(f.formatMessage({id:H?"updating":"creating",defaultMessage:H?"Updating":"Creating"})),!H){e.next=10;break}return a=u()(u()(u()({},s),t),{},{avatar:E||(null==s?void 0:s.avatar)}),e.next=6,(0,G.sE)(a);case 6:r=e.sent,console.log("updateAgent payload:",a,r),e.next=15;break;case 10:return i={nickname:t.nickname,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==g?void 0:g.uid,avatar:E},e.next=13,(0,G.x_)(i);case 13:r=e.sent,console.log("createAgent payload:",i,r);case 15:if(T.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=23;break}return T.yw.success(f.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(r.data),l(),e.abrupt("return",!0);case 23:return T.yw.error((null===(o=r)||void 0===o?void 0:o.message)||f.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),T.yw.destroy(),T.yw.error(f.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(Q.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:f.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,z.jsxs)(re.G,{onSuccess:J,onError:function(e){T.yw.error(String(e))},children:[(0,z.jsx)(X.Z,{src:E||(null==s?void 0:s.avatar)}),(0,z.jsxs)(h.ZP,{icon:(0,z.jsx)(te.Z,{}),children:[" ",f.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,z.jsx)(Y.Z,{name:"memberUid",label:f.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:f.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:H,rules:H?[]:[{required:!0,message:f.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=p()(c()().mark((function e(t){var n,r,a,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.keyWords,e.next=3,(0,ne.z_)({pageNumber:0,pageSize:20,orgUid:null==g?void 0:g.uid,searchText:r||""});case 3:return a=e.sent,i=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",i.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,z.jsx)(Y.Z,{name:"settingsUid",label:f.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),placeholder:f.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),rules:[{required:!0,message:f.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:O},request:function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",_(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:C,notFoundContent:0===k.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:f.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(S.Z,{}),onClick:function(){return M(!0)},children:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,z.jsx)(h.ZP,{size:"small",icon:(0,z.jsx)(S.Z,{}),onClick:function(){return M(!0)},title:f.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"}),children:f.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,z.jsx)($.Z,{name:"nickname",label:f.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.nickname.required"})}]}),(0,z.jsx)($.Z,{name:"email",label:f.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.email.required"})}]}),(0,z.jsx)($.Z,{name:"mobile",label:f.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:f.formatMessage({id:"agent.info.mobile.required"})}]}),(0,z.jsx)(ee.Z,{name:"description",label:f.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,z.jsx)(D,{open:b,onOpenChange:M,orgUid:(null==g?void 0:g.uid)||"",record:null,onSuccess:function(e){var t;M(!1),Z((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(o()(t))})),V((function(e){return e+1})),null===(t=B.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},ie=n(83767),se=n(66675),oe=n(97117),le=n(79481),ue=n(12715),de=function(e){var t=e.open,n=e.onClose,a=e.onSubmit,i=oe.ZP.useForm(),s=m()(i,1)[0],l=(0,U.u)((function(e){return e.currentOrg})),d=(0,ie.Z)((function(e){return e.memberResult})),f=(0,ie.Z)((function(e){return e.setMemberResult})),g=(0,se.E)((function(e){return e.agentResult})),v=(0,r.useState)(0),b=m()(v,2),M=b[0],y=b[1],w=(0,r.useState)(""),k=m()(w,2),Z=k[0],S=k[1],j=(0,r.useState)(!1),P=m()(j,2),C=P[0],T=P[1],R=(0,r.useState)([]),q=m()(R,2),I=q[0],E=q[1],A=(0,r.useRef)(null),L=(0,r.useState)(0),N=m()(L,2),D=N[0],V=N[1],B=(0,r.useState)(!0),H=m()(B,2),J=H[0],_=H[1],W=(0,r.useState)(!1),X=m()(W,2),G=X[0],K=X[1],Q=(0,r.useState)(0),ee=m()(Q,2),te=ee[0],re=ee[1],ae=(0,r.useState)(!0),de=m()(ae,2),ce=de[0],fe=de[1],pe=(0,r.useState)(!1),ge=m()(pe,2),me=ge[0],ve=ge[1],he=(0,r.useState)(!1),xe=m()(he,2),be=xe[0],Me=xe[1],ye=(0,r.useState)([]),we=m()(ye,2),ke=we[0],Ze=we[1];(0,r.useEffect)((function(){var e;t&&(console.log("Modal opened, current agent data:",g),console.log("Current member data:",d),null!=d&&null!==(e=d.data)&&void 0!==e&&e.content&&0!==d.data.content.length||p()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==l?void 0:l.uid},e.next=4,(0,ne.z_)(n);case 4:r=e.sent,console.log("Init load members response:",r,n),(a=(null==r||null===(t=r.data)||void 0===t?void 0:t.content)||[]).length>0&&f(u()(u()({},d),{},{data:u()(u()({},null==d?void 0:d.data),{},{content:a})})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Init load members failed:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),p()(c()().mark((function e(){var t,n,r,a,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Me(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==l?void 0:l.uid,searchText:""},e.next=5,(0,F.u9)(n);case 5:r=e.sent,a=(null==r||null===(t=r.data)||void 0===t?void 0:t.content)||[],i=a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),Ze(i),!s.getFieldValue("settingsUid")&&i.length>0&&s.setFieldsValue({settingsUid:i[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,Me(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))())}),[t,g,d]),(0,r.useEffect)((function(){return function(){A.current&&clearTimeout(A.current)}}),[]);var Se=(0,r.useMemo)((function(){var e=g.data.content.map((function(e){var t;return(null===(t=e.member)||void 0===t?void 0:t.uid)||e.memberUid})).filter((function(e){return e}));return console.log("Existing agent member UIDs:",e),console.log("Agent result data:",g.data.content),e}),[g]),je=(0,r.useMemo)((function(){var e,t,n,r=[],a=Z.trim()?I:(null==d||null===(e=d.data)||void 0===e?void 0:e.content)||[];console.log("Total members:",a.length),console.log("Existing agent member UIDs:",Se),console.log("Using search results:",!!Z.trim());for(var i=0;i<a.length;i++){var s=a[i];if(Se.includes(s.uid))console.log("Filtering out member:",s.nickname,s.uid);else{var o={title:"",value:"",children:[]};(n=o).title=(t=s).nickname,n.value=t.uid,r.push(o)}}return console.log("Filtered tree data:",r),r}),[d,I,Z,Se]),Pe=function(){var e=p()(c()().mark((function e(t){var n,r,a,i,s=arguments;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],console.log("handleSearch:",t,"isLoadMore:",n),t.trim()||n){e.next=7;break}return E([]),V(0),_(!0),e.abrupt("return");case 7:return n?K(!0):T(!0),e.prev=8,r={pageNumber:n?D+1:0,pageSize:20,orgUid:null==l?void 0:l.uid,searchText:t.trim()},e.next=12,(0,ne.z_)(r);case 12:a=e.sent,console.log("handleSearch Search members response:",a,r),200===a.code?(i=a.data.content||[],n?(E((function(e){return[].concat(o()(e),o()(i))})),V(D+1)):(E(i),V(0)),_(!a.data.last)):(console.error("handleSearch Search failed:",a.message),n||E([])),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),console.error("Search error:",e.t0),n||E([]);case 21:return e.prev=21,n?K(!1):T(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[8,17,21,24]])})));return function(t){return e.apply(this,arguments)}}(),Ce=function(e){var t=e.target.value;S(t),A.current&&clearTimeout(A.current),t.trim()?A.current=setTimeout((function(){Pe(t)}),300):(E([]),V(0),_(!0))},Te=function(){Pe(Z)},Fe=function(){!G&&J&&Z.trim()&&Pe(Z,!0)},Ue=function(){var e=p()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me||!ce){e.next=17;break}return ve(!0),e.prev=2,t={pageNumber:te+1,pageSize:20,orgUid:null==l?void 0:l.uid},e.next=6,(0,ne.z_)(t);case 6:n=e.sent,console.log("Load more all members response:",n),200===n.code&&(r=n.data.content||[],a=[].concat(o()(d.data.content),o()(r)),f(u()(u()({},d),{},{data:u()(u()({},d.data),{},{content:a})})),re(te+1),fe(!n.data.last)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 14:return e.prev=14,ve(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)("div",{children:(0,z.jsx)(O.Z,{title:"创建客服",open:t,forceRender:!0,onOk:function(){console.log("handleOk"),s.validateFields().then((function(e){var t;console.log("form values:",e);var n=s.getFieldValue("memberUids"),r=s.getFieldValue("nickname"),i=s.getFieldValue("email"),o=s.getFieldValue("mobile"),u=s.getFieldValue("settingsUid"),c=Z.trim()?I:(null==d||null===(t=d.data)||void 0===t?void 0:t.content)||[],f=[];if(1===n.length){var p={nickname:r,email:i,mobile:o,memberUid:n[0],orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(p)}else n.forEach((function(e){var t=c.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==l?void 0:l.uid,settingsUid:u};f.push(n)}}));console.log("agents:",f),a(f)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,z.jsxs)(oe.ZP,{form:s,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,z.jsx)(Y.Z,{label:"客服配置",name:"settingsUid",tooltip:"为本次创建的客服指定配置模板",rules:[{required:!0,message:"请选择客服配置!"}],fieldProps:{options:ke,loading:be,showSearch:!0,filterOption:function(e,t){var n;return null==t||null===(n=t.label)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},placeholder:"请选择客服配置"}}),(0,z.jsx)(le.Z,{label:"绑定成员",name:"memberUids",tooltip:"请先到组织-》成员-》创建成员，已创建过客服的成员将被过滤",rules:[{required:!0,message:"请选择成员!"}],fieldProps:{multiple:!0,treeDefaultExpandAll:!0,placeholder:"请选择成员（可多选）",onChange:function(e){var t;console.log("onTreeSelectChange:",e),y(e.length);var n=Z.trim()?I:(null==d||null===(t=d.data)||void 0===t?void 0:t.content)||[];if(0===e.length)s.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===e.length){var r=n.find((function(t){return t.uid===e[0]}));r&&s.setFieldsValue({nickname:r.nickname||"",email:r.email||"",mobile:r.mobile||""})}else{var a=n.filter((function(t){return e.includes(t.uid)})),i=a.map((function(e){return e.nickname})).filter(Boolean).join(", "),o=a.map((function(e){return e.email})).filter(Boolean).join(", "),l=a.map((function(e){return e.mobile})).filter(Boolean).join(", ");s.setFieldsValue({nickname:i,email:o,mobile:l})}},treeData:je,variant:"outlined",dropdownRender:function(e){return(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,z.jsx)(x.Z,{placeholder:"搜索成员",value:Z,onChange:Ce,onPressEnter:function(){return Te()},suffix:(0,z.jsx)(ue.Z,{onClick:Te,style:{cursor:"pointer",color:C?"#1890ff":void 0},spin:C}),allowClear:!0,size:"small"})}),e,(Z.trim()?J:ce)&&(0,z.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,z.jsx)(h.ZP,{type:"link",size:"small",loading:Z.trim()?G:me,onClick:Z.trim()?Fe:Ue,disabled:Z.trim()?G:me,children:(Z.trim()?G:me)?"加载中...":"加载更多"})})]})}}}),(0,z.jsx)($.Z,{label:"昵称",name:"nickname",disabled:M>1,tooltip:M>1?"多选模式下昵称将自动从选中的成员信息中获取":"昵称将自动从选中的成员信息中获取"}),(0,z.jsx)($.Z,{label:"邮箱",name:"email",disabled:M>1,tooltip:M>1?"多选模式下邮箱将自动从选中的成员信息中获取":"邮箱将自动从选中的成员信息中获取"}),(0,z.jsx)($.Z,{label:"手机号",name:"mobile",disabled:M>1,tooltip:M>1?"多选模式下手机号将自动从选中的成员信息中获取":"手机号将自动从选中的成员信息中获取"})]})})})},ce=function(){var e=(0,i.useIntl)(),t=(0,r.useRef)(),n=(0,U.u)((function(e){return e.currentOrg})),a=(0,r.useState)(!1),s=m()(a,2),o=s[0],l=s[1],u=(0,r.useState)(!1),d=m()(u,2),f=d[0],g=d[1],v=(0,r.useState)(null),x=m()(v,2),b=x[0],M=x[1],y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,z.jsx)(X.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,z.jsx)("a",{onClick:function(){M(n),l(!0)},children:n.settings.name||e.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,z.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){M(n),l(!0)},children:e.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(t,n){switch(null==n?void 0:n.status){case I.Ra4:return(0,z.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case I.tU$:return(0,z.jsx)(w.Z,{color:"orange",children:e.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case I.LZ1:default:return(0,z.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:e.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(t,n){return null!=n&&n.connected?(0,z.jsx)(w.Z,{color:"green",children:e.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,z.jsx)(w.Z,{color:"red",children:e.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,z.jsx)("a",{onClick:function(){return i.history.push("/service/channel")},children:e.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code"),(0,z.jsx)("a",{onClick:function(){M(r),l(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,z.jsx)(Z.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:p()(c()().mark((function n(){var a,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return T.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,G.Lr)(r);case 4:a=n.sent,T.yw.destroy(),200===(null==a?void 0:a.code)?(T.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(i=t.current)||void 0===i||i.reload()):T.yw.error((null==a?void 0:a.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),T.yw.destroy(),T.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,z.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(W.Z,{columns:y,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,z.jsx)(h.ZP,{type:"primary",onClick:function(){M(null),g(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=p()(c()().mark((function e(t,r){var a,i,s,o,l,u,d,f,p,g,m,v,h,x,b;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(a=null==t?void 0:t.current)&&void 0!==a?a:1)-1,l=null!==(i=null==t?void 0:t.pageSize)&&void 0!==i?i:10,u=null!==(s=null==t?void 0:t.searchText)&&void 0!==s?s:"",d={pageNumber:o,pageSize:l,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:u},e.prev=4,e.next=7,(0,G._t)(d);case 7:if(f=e.sent,console.log("queryAgentsByOrg response:",f,d),200!==(null==f?void 0:f.code)){e.next=13;break}return x=(null==f||null===(p=f.data)||void 0===p?void 0:p.content)||[],b=null!==(g=null!==(m=null==f||null===(v=f.data)||void 0===v?void 0:v.totalElements)&&void 0!==m?m:null==f||null===(h=f.data)||void 0===h?void 0:h.numberOfElements)&&void 0!==g?g:x.length,e.abrupt("return",{data:x,total:b,success:!0});case 13:return e.abrupt("return",{data:[],total:0,success:!1});case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent",defaultMessage:"Agent"})}),o&&(0,z.jsx)(ae,{open:o,record:b,onClose:function(){return l(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),f&&(0,z.jsx)(de,{open:f,onClose:function(){return g(!1)},onSubmit:function(){var n=p()(c()().mark((function n(r){var a,i,s,o;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return T.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,Promise.allSettled(r.map((function(e){return(0,G.x_)(e)})));case 4:a=n.sent,T.yw.destroy(),i=a.filter((function(e){var t;return"fulfilled"===e.status&&200===(null===(t=e.value)||void 0===t?void 0:t.code)})).length,s=a.length-i,i>0&&(T.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(i,")")),g(!1),null===(o=t.current)||void 0===o||o.reload()),s>0&&T.yw.warning(e.formatMessage({id:"create.partial.fail",defaultMessage:"Some items failed to create"})+" (".concat(s,")")),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(1),T.yw.destroy(),T.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 16:case"end":return n.stop()}}),n,null,[[1,12]])})));return function(e){return n.apply(this,arguments)}}()})]})},fe=function(){return(0,z.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,z.jsx)(i.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,z.jsx)(ce,{})},{key:"settings",label:(0,z.jsx)(i.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,z.jsx)(_,{})}]})}},83767:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(68992),a=n(58063),i=n(66266),s=n(31403),o=(0,a.Ue)()((0,i.mW)((0,i.tJ)((0,s.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);