"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5387],{76750:function(e,t,n){var a=n(55735),r=n(65461),s=n(41159);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(a.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(a.VoP)||null!=t&&t.startsWith("ROLE_")?(0,r.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,r.aS)(t,10)}}}},74134:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var a=n(41159),r=n(8247),s=n(44194),o=n(84176),l=n.n(o),c=n(73193),u=n.n(c),i=n(86222),d=n.n(i),f=n(90819),p=n.n(f),g=n(89933),m=n.n(g),h=n(45332),x=n.n(h),v=n(86803),M=n(55735);function y(e){return b.apply(this,arguments)}function b(){return(b=m()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/tag/query/org",{method:"GET",params:u()(u()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return k=m()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/tag/create",{method:"POST",data:u()(u()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=m()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/tag/update",{method:"POST",data:u()(u()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return A.apply(this,arguments)}function A(){return A=m()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/tag/delete",{method:"POST",data:u()(u()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function T(e){return C.apply(this,arguments)}function C(){return(C=m()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/tag/delete/all",{method:"POST",data:u()(u()({},t),{},{client:M.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=n(40612),I=n(15722),P=n(10162),E=n(54881),O=n(58275),D=n(11090),q=n(2484),R=n(48524),V=n(53530),Y=n(29266),z=n(61355),U=n(75365),N=n(96485),W=n(69169),B=n(4499),H=n(84881),L=n(73442),K=n(31549),G=function(e){var t=e.isEdit,n=e.tag,a=e.open,r=e.onClose,o=e.onSubmit,l=W.A.useForm(),c=x()(l,1)[0],i=(0,F.u)((function(e){return e.currentOrg})),d=(0,s.useState)([]),f=x()(d,2),p=f[0],g=f[1],m=(0,s.useState)([]),h=x()(m,2),v=h[0],y=h[1];(0,s.useEffect)((function(){t?(c.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,color:null==n?void 0:n.color,type:null==n?void 0:n.type}),y([null==n?void 0:n.color]),g([null==n?void 0:n.type])):c.setFieldsValue({name:"",color:"red",type:M.IuT})}),[t,n,c]);return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(L.Z,{title:"标签",width:600,onClose:r,open:a,children:(0,K.jsxs)(W.A,{form:c,name:"tagForm",onFinish:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var t=u()(u()({},e),{},{orgUid:null==i?void 0:i.uid});console.log("submit",t),o(t)}))},children:[(0,K.jsx)(B.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,K.jsx)(H.Z,{name:"color",label:"颜色",width:"md",options:[{label:"red",value:"red"},{label:"magenta",value:"magenta"},{label:"volcano",value:"volcano"},{label:"orange",value:"orange"},{label:"gold",value:"gold"},{label:"lime",value:"lime"},{label:"green",value:"green"},{label:"cyan",value:"cyan"},{label:"blue",value:"blue"},{label:"geekblue",value:"geekblue"},{label:"purple",value:"purple"},{label:"#f50",value:"#f50"}],fieldProps:{allowClear:!0,placeholder:"请选择颜色",value:v,onChange:function(e){console.log("selected color ".concat(e)),y(e)}}}),(0,K.jsx)(H.Z,{name:"type",label:"类型",width:"md",options:[{label:"会话标签",value:M.bDv},{label:"客户标签",value:M.IuT}],fieldProps:{allowClear:!0,placeholder:"请选择类型",value:p,onChange:function(e){console.log("selected type ".concat(e)),g(e)}}})]})})})},_=n(28977),J=n.n(_),Q=n(36310),X=n(76750),$=["current","pageSize"],ee=function(){var e=(0,a.useIntl)(),t=(0,s.useRef)(),n=(0,X.Z)().translateString,r=(0,s.useState)(1),o=x()(r,2),c=o[0],i=o[1],f=(0,s.useState)(10),g=x()(f,2),h=g[0],b=g[1],k=(0,F.u)((function(e){return e.currentOrg})),j=(0,s.useState)(!1),A=x()(j,2),C=A[0],W=A[1],B=(0,s.useState)({}),H=x()(B,2),L=H[0],_=H[1],ee=(0,s.useState)(!1),te=x()(ee,2),ne=te[0],ae=te[1],re=V.Z.useModal(),se=x()(re,2),oe=se[0],le=se[1],ce=(0,s.useState)([]),ue=x()(ce,2),ie=ue[0],de=ue[1],fe=(0,s.useState)([]),pe=x()(fe,2),ge=pe[0],me=pe[1],he=(0,s.useState)(0),xe=x()(he,2),ve=xe[0],Me=xe[1],ye=(0,s.useState)({}),be=x()(ye,2),we=be[0],ke=be[1],Se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,K.jsx)(a.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150,render:function(e,t){return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(Y.Z,{color:t.color,children:n(t.name)})})}},{title:(0,K.jsx)(a.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,K.jsxs)(K.Fragment,{children:[t.type===M.bDv&&(0,K.jsx)(Y.Z,{color:"blue",children:"会话标签"}),t.type===M.IuT&&(0,K.jsx)(Y.Z,{color:"green",children:"客户标签"})]})}},{title:(0,K.jsx)(a.FormattedMessage,{id:"color",defaultMessage:"Color"}),dataIndex:"color",hideInSearch:!0,width:120,render:function(e,t){return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(Y.Z,{color:t.color,children:t.color})})}},{title:(0,K.jsx)(a.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,a){return J()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,K.jsx)(a.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,a){return J()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],je=[].concat(Se,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,a,r,s){return[(0,K.jsx)("a",{onClick:function(){_(a),ae(!0),W(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,K.jsx)(z.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(a.name),"】？"),onConfirm:function(){return Ze(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,K.jsx)(I.Z,{style:{color:"red"}}),children:(0,K.jsx)(U.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),Ze=function(){var n=m()(p()().mark((function n(a){var r;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteTag:",a),n.next=3,Z(a);case 3:r=n.sent,console.log("deleteMember:",r),200===r.code?(v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):v.yw.error(r.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Ae=function(){var e=m()(p()().mark((function e(n){var a,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(n);case 2:a=e.sent,console.log("handleCreateTag response:",a),200===a.code?(null===(r=t.current)||void 0===r||r.reload(),W(!1)):v.yw.error(a.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Te=function(){var e=m()(p()().mark((function e(n){var a,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,e.next=3,S(n);case 3:a=e.sent,console.log("handleUpdateTag response:",a),200===a.code?(null===(r=t.current)||void 0===r||r.reload(),W(!1)):v.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){W(!0),ae(!1),_({})},Fe=function(){var n=m()(p()().mark((function n(){var a,r,s,o,l,c;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ge.length){n.next=3;break}return v.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),n.abrupt("return");case 3:v.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,s=0,o=d()(ge),n.prev=7,o.s();case 9:if((l=o.n()).done){n.next=23;break}return c=l.value,n.prev=11,n.next=14,Z(c);case 14:200===n.sent.code?r++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:v.yw.destroy(),0===s?v.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:r})):v.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:r,fail:s})),de([]),me([]),null===(a=t.current)||void 0===a||a.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Ie=function(){var n=m()(p()().mark((function n(){var a,r,s;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ve){n.next=3;break}return v.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return v.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,a={orgUid:null==k?void 0:k.uid},n.next=8,T(a);case 8:200===(r=n.sent).code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(v.yw.destroy(),v.yw.error(r.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),v.yw.destroy(),v.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(){return n.apply(this,arguments)}}(),Pe=function(){var e=m()(p()().mark((function e(t,n,a){var r,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,a),r=localStorage.getItem(M.LA8),s=u()({orgUid:(null==k?void 0:k.uid)||"",accessToken:r||"",exportType:t},we),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(h)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==a&&(s.pageNumber=String(n),s.pageSize=String(a)),window.open((0,Q.kG)()+"/api/v1/tag/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Ee=function(e){for(var t=[],n=1e3,a=Math.ceil(e/n),r=function(){var a=s,r=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return Pe("range",a,n)}})},s=0;s<a;s++)r();return t},Oe={selectedRowKeys:ie,onChange:function(e,t){de(e),me(t)}},De=function(){var e=m()(p()().mark((function e(t,n,a){var r,s,o,c,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,s=t.pageSize,o=l()(t,$),i(r),b(s),ke(o),c=u()({pageNumber:r-1,pageSize:s,orgUid:null==k?void 0:k.uid},o),e.next=7,y(c);case 7:return d=e.sent,console.log("queryTagsByOrg response:",d,c),200===d.code?Me(d.data.totalElements):v.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();return(0,K.jsxs)(K.Fragment,{children:[C&&(0,K.jsx)(G,{isEdit:ne,open:C,tag:L,onClose:function(){W(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),ne?Te(e):Ae(e)}}),(0,K.jsx)(R.Z,{columns:je,actionRef:t,cardBordered:!0,rowSelection:Oe,request:De,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){i(e),b(t)}},dateFormatter:"string",headerTitle:"标签列表",toolBarRender:function(){return function(){var t=[(0,K.jsx)(U.ZP,{type:"primary",icon:(0,K.jsx)(P.Z,{}),onClick:Ce,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],n=[];ie.length>0&&n.push({key:"batchDelete",icon:(0,K.jsx)(E.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(ie.length,")"),onClick:function(){oe.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ie.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Fe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,K.jsx)(O.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){oe.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有标签数据吗？此操作不可恢复!"}),onOk:Ie,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,K.jsx)(D.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Pe("current")}}];return ve>0&&(ve<=1e3?a.push({key:"export-all",icon:(0,K.jsx)(D.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ve,"条)"),onClick:function(){return Pe("all")}}):a.push({key:"export-range",icon:(0,K.jsx)(D.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ve,"条)"),children:Ee(ve)})),t.push((0,K.jsx)(N.Z,{menu:{items:a},placement:"bottom",children:(0,K.jsxs)(U.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,K.jsx)(q.Z,{})]})},"importExport")),n.length>0&&t.push((0,K.jsx)(N.Z,{menu:{items:n},placement:"bottom",children:(0,K.jsxs)(U.ZP,{type:ie.length>0?"primary":"default",danger:ie.length>0,children:[ie.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ie.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,K.jsx)(q.Z,{})]})},"batchOperations")),t}()}}),le]})},te=function(){var e=[{key:"tags",label:(0,a.useIntl)().formatMessage({id:"tags.tab.tags"}),children:(0,K.jsx)(ee,{})}];return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(r.Z,{defaultActiveKey:"tags",items:e,style:{padding:"20px"}})})}}}]);