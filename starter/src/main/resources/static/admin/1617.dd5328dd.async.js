"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1617],{84553:function(e,t,n){n.d(t,{Bv:function(){return T},L0:function(){return q},QB:function(){return x},RF:function(){return S},YO:function(){return M},YQ:function(){return P},Yg:function(){return m},kh:function(){return p},kv:function(){return b},pf:function(){return c},y:function(){return v}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),u=n(89933),l=n.n(u),s=n(94976),d=n(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/query/org",{method:"GET",params:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/create",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/update",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return(y=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/delete",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/deleteAll",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/updateIndex",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return C.apply(this,arguments)}function C(){return(C=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/updateVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return R.apply(this,arguments)}function R(){return(R=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/updateAllIndex",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return A.apply(this,arguments)}function A(){return(A=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/updateAllVectorIndex",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/agent/text/faq-similar-questions",{method:"POST",data:o()(o()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},25552:function(e,t,n){n.d(t,{Ck:function(){return m},dv:function(){return x},pw:function(){return b},qL:function(){return p},z4:function(){return v}});var r=n(90819),i=n.n(r),a=n(89933),o=n.n(a),u=n(73193),l=n.n(u),s=n(94976),d=n(4628),c="/api/v1/quickbutton";function f(e){var t;return l()(l()({},e),{},{channel:null!==(t=null==e?void 0:e.channel)&&void 0!==t?t:s.XtJ})}function p(e){return g.apply(this,arguments)}function g(){return(g=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(c,"/query/org"),{method:"GET",params:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(c,"/create"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return(y=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(c,"/update"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(c,"/delete"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(c,"/enable"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95093:function(e,t,n){var r=n(73193),i=n.n(r),a=n(90819),o=n.n(a),u=n(89933),l=n.n(u),s=n(45332),d=n.n(s),c=n(66441),f=n(43388),p=n(13845),g=n(74171),v=n(94976),h=n(99036),m=n(50628),y=n(96695),b=n(48058),w=n(59005),x=n(4628),k=n(44194),S=n(31549);t.Z=function(e){var t=h.A.useForm(),n=d()(t,1)[0],r=(0,x.useIntl)(),a=(0,g.u)((function(e){return e.currentOrg})),u=(0,k.useState)([]),s=d()(u,2),j=s[0],M=s[1],C=(0,k.useRef)(!1),q=(0,k.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),R=(0,k.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==q?void 0:q.draft)&&void 0!==t?t:null==q?void 0:q.live)&&void 0!==e?e:void 0}),[q]);return(0,k.useEffect)((function(){null!=a&&a.uid&&!C.current&&(C.current=!0,l()(o()().mark((function e(){var t,n,r,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,type:v.QPQ,orgUid:a.uid},e.next=3,(0,p.AP)(t);case 3:200===(n=e.sent).code?(i=((null===(r=n.data)||void 0===r?void 0:r.content)||[]).map((function(e){return{label:e.name||e.uid||"",value:e.uid}})),M(i)):f.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})))())}),[null==a?void 0:a.uid]),(0,k.useEffect)((function(){var e,t,r,i;n.setFieldsValue({inputAssociationEnabled:null!==(e=null==R?void 0:R.inputAssociationEnabled)&&void 0!==e&&e,inputPreviewEnabled:null!==(t=null==R?void 0:R.inputPreviewEnabled)&&void 0!==t&&t,inputPreviewAlwaysShow:null!==(r=null==R?void 0:R.inputPreviewAlwaysShow)&&void 0!==r&&r,inputPreviewShowSeconds:null!==(i=null==R?void 0:R.inputPreviewShowSeconds)&&void 0!==i?i:5,inputAssociationKbUid:null==R?void 0:R.inputAssociationKbUid})}),[n,null==R?void 0:R.inputAssociationEnabled,null==R?void 0:R.inputPreviewEnabled,null==R?void 0:R.inputPreviewAlwaysShow,null==R?void 0:R.inputPreviewShowSeconds,null==R?void 0:R.inputAssociationKbUid]),(0,S.jsxs)(h.A,{form:n,submitter:!1,style:{marginLeft:20},children:["robot"!==e.variant&&(0,S.jsx)(m.Z,{name:"inputPreviewEnabled",width:"md",label:(0,S.jsxs)("span",{children:[(0,S.jsx)(x.FormattedMessage,{id:"settings.inputPreview.enable",defaultMessage:"启用访客输入预览"}),(0,S.jsx)(c.Z,{type:"service",keys:["inputPreviewEnabled"],live:null==q?void 0:q.live,draft:null==q?void 0:q.draft})]}),fieldProps:{onChange:function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,i()({inputPreviewEnabled:t},t?{}:{inputPreviewAlwaysShow:!1,inputPreviewShowSeconds:5}))}}}),"robot"!==e.variant&&(0,S.jsx)(y.Z,{name:["inputPreviewEnabled","inputPreviewAlwaysShow"],children:function(t){var n=!0===(null==t?void 0:t.inputPreviewEnabled),r=!0===(null==t?void 0:t.inputPreviewAlwaysShow);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(m.Z,{name:"inputPreviewAlwaysShow",width:"md",disabled:!n,label:(0,S.jsxs)("span",{children:[(0,S.jsx)(x.FormattedMessage,{id:"settings.inputPreview.alwaysShow",defaultMessage:"输入预览一直显示"}),(0,S.jsx)(c.Z,{type:"service",keys:["inputPreviewAlwaysShow"],live:null==q?void 0:q.live,draft:null==q?void 0:q.draft})]}),fieldProps:{onChange:function(t){var n;return null===(n=e.onServiceSettingsChange)||void 0===n?void 0:n.call(e,{inputPreviewAlwaysShow:t})}}}),(0,S.jsx)(b.Z,{name:"inputPreviewShowSeconds",width:"md",hidden:!n||r,min:1,max:600,fieldProps:{precision:0,onChange:function(t){var n;return null===(n=e.onServiceSettingsChange)||void 0===n?void 0:n.call(e,{inputPreviewShowSeconds:"number"==typeof t?t:5})}},label:(0,S.jsxs)("span",{children:[(0,S.jsx)(x.FormattedMessage,{id:"settings.inputPreview.showSeconds",defaultMessage:"输入预览显示时长(秒)"}),(0,S.jsx)(c.Z,{type:"service",keys:["inputPreviewShowSeconds"],live:null==q?void 0:q.live,draft:null==q?void 0:q.draft})]})})]})}}),(0,S.jsx)(m.Z,{name:"inputAssociationEnabled",width:"md",label:(0,S.jsxs)("span",{children:[(0,S.jsx)(x.FormattedMessage,{id:"settings.inputAssociation.enable",defaultMessage:"启用访客输入联想"}),(0,S.jsx)(c.Z,{type:"service",keys:["inputAssociationEnabled"],live:null==q?void 0:q.live,draft:null==q?void 0:q.draft})]}),fieldProps:{onChange:function(t){var n;return null===(n=e.onServiceSettingsChange)||void 0===n?void 0:n.call(e,{inputAssociationEnabled:t})}}}),(0,S.jsx)(w.Z,{name:"inputAssociationKbUid",width:"md",label:(0,S.jsxs)("span",{children:[(0,S.jsx)(x.FormattedMessage,{id:"settings.inputAssociation.kb",defaultMessage:"联想关联知识库"}),(0,S.jsx)(c.Z,{type:"service",keys:["inputAssociationKbUid"],live:null==q?void 0:q.live,draft:null==q?void 0:q.draft})]}),options:j,fieldProps:{allowClear:!0,onChange:function(t){var n;return null===(n=e.onServiceSettingsChange)||void 0===n?void 0:n.call(e,{inputAssociationKbUid:t})}},placeholder:r.formatMessage({id:"choose",defaultMessage:"Choose"})})]})}},94147:function(e,t,n){n(90819),n(89933),n(73193),n(45332),n(1395),n(80106),n(21420),n(94976),n(4628),n(44194),n(57181),n(66441),n(31549)},42e3:function(e,t,n){var r=n(90819),i=n.n(r),a=n(89933),o=n.n(a),u=n(45332),l=n.n(u),s=(n(78112),n(99036)),d=n(50628),c=n(4628),f=n(44194),p=(n(66406),n(88722)),g=n(31549);t.Z=function(e){e.variant;var t=e.serviceSettings,n=e.onServiceSettingsChange,r=(0,c.useIntl)(),a=s.A.useForm(),u=l()(a,1)[0],v=(0,p.Z)().translateString,h=(0,f.useState)(!1),m=l()(h,2),y=(m[0],m[1]),b=(0,f.useState)(""),w=l()(b,2),x=(w[0],w[1]),k=(0,f.useMemo)((function(){var e,n;return null!==(e=null!==(n=null==t?void 0:t.draft)&&void 0!==n?n:null==t?void 0:t.live)&&void 0!==e?e:void 0}),[null==t?void 0:t.draft,null==t?void 0:t.live]);(0,f.useEffect)((function(){var e=!(null==k||!k.showRateBtn),t=v(null==k?void 0:k.inviteRateTip)||"";u.setFieldsValue({showRateBtn:null==k?void 0:k.showRateBtn,autoInviteRate:null==k?void 0:k.autoInviteRate}),y(e),x(t)}),[k,u,v]);var S=function(){var e=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onFinish:",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=o()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("TabRating handleChange autoInviteRate",t),u.setFieldValue("autoInviteRate",t),null==n||n({autoInviteRate:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(s.A,{form:u,onFinish:S,submitter:!1,style:{marginLeft:"20px"},children:[(0,g.jsx)(d.Z,{width:"md",name:"autoInviteRate",label:r.formatMessage({id:"rate.auto.invite.rate"}),tooltip:r.formatMessage({id:"rate.auto.invite.rate.tooltip"}),fieldProps:{onChange:j}}),!1]})})}},1596:function(e,t,n){var r=n(76711),i=n.n(r),a=n(90819),o=n.n(a),u=n(89933),l=n.n(u),s=n(45332),d=n.n(s),c=n(43388),f=n(84553),p=n(13845),g=n(74171),v=n(88722),h=n(94976),m=n(66441),y=n(99036),b=n(50628),w=n(86702),x=n(59005),k=n(15939),S=n(4628),j=n(44194),M=n(21600),C=n(67242),q=n(31549);t.Z=function(e){var t,n,r,a,u=e.variant,s=e.serviceSettings,R=e.onServiceSettingsChange,T=e.agentRightPanelTabs,A=e.onAgentRightPanelTabsChange,P=(e.settingsUid,e.isActive,(0,S.useIntl)()),Z=y.A.useForm(),U=d()(Z,1)[0],I=(0,g.u)((function(e){return e.currentOrg})),F=(0,v.Z)().translateString,K=null==s?void 0:s.live,O=null==s?void 0:s.draft,E=(0,j.useMemo)((function(){var e;return null!==(e=null!=O?O:K)&&void 0!==e?e:{}}),[O,K]),B=(0,j.useState)(),L=d()(B,2),W=L[0],V=L[1],_=(0,j.useState)(),J=d()(_,2),Q=J[0],z=J[1],D=(0,j.useState)(),N=d()(D,2),Y=N[0],X=N[1],H=(0,j.useState)("iframe"),$=d()(H,2),G=$[0],ee=$[1],te=null!==(t=null==T?void 0:T.live)&&void 0!==t?t:[],ne=null!==(n=null==T?void 0:T.draft)&&void 0!==n?n:void 0,re=(0,j.useMemo)((function(){var e;return null!==(e=null!=ne?ne:te)&&void 0!==e?e:[]}),[ne,te]),ie=(0,j.useCallback)(function(){var e=l()(o()().mark((function e(t){var n,r,i,a,u,l,s,d;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||Y){e.next=4;break}return console.log("TabRight: 没有选择知识库，无法获取FAQ"),V(void 0),e.abrupt("return");case 4:return c.yw.loading(P.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:100,orgUid:null==I?void 0:I.uid,kbUid:t||Y},e.prev=6,e.next=9,(0,f.pf)(n);case 9:r=e.sent,C.Z.debug("TabRight.getFaqs response:",n,r),c.yw.destroy(),200===r.code?(i={code:r.code,message:r.message,data:{content:null==r?void 0:r.data.content.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer,kbUid:e.kbUid,orgUid:e.orgUid}})),totalElements:null==r?void 0:r.data.totalElements,totalPages:null==r?void 0:r.data.totalPages,number:null==r?void 0:r.data.number}},V(i),a=t||Y,u=U.getFieldValue("faqUids")||[],a&&u.length>0&&(s=(null==i||null===(l=i.data.content)||void 0===l?void 0:l.map((function(e){return e.uid})))||[],(d=u.filter((function(e){return s.includes(e)}))).length!==u.length&&U.setFieldValue("faqUids",d))):c.yw.error(r.message),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(6),c.yw.destroy(),console.error("TabRight 获取FAQ失败:",e.t0),c.yw.error("获取FAQ失败");case 20:case"end":return e.stop()}}),e,null,[[6,15]])})));return function(t){return e.apply(this,arguments)}}(),[null==I?void 0:I.uid,U,P,Y]),ae=(0,j.useCallback)(l()(o()().mark((function e(){var t,n,r,i,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(P.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:h.QPQ,orgUid:null==I?void 0:I.uid},e.prev=2,e.next=5,(0,p.AP)(t);case 5:n=e.sent,C.Z.debug("TabRight.getKbases response:",t,n),c.yw.destroy(),200===n.code?(i={code:n.code,message:n.message,data:{content:null==n?void 0:n.data.content.map((function(e){return{uid:e.uid,name:e.name,type:e.type,orgUid:e.orgUid}})),totalElements:null==n?void 0:n.data.totalElements,totalPages:null==n?void 0:n.data.totalPages,number:null==n?void 0:n.data.number}},z(i),null!=O&&O.faqKbUid?a=O.faqKbUid:null!=K&&K.faqKbUid?a=K.faqKbUid:(null==i||null===(r=i.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&(a=null==i?void 0:i.data.content[0].uid),a&&(X(a),U.setFieldValue("faqKbUid",a),ie(a))):c.yw.error(n.message),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),c.yw.destroy(),console.error("TabRight 获取知识库失败:",e.t0),c.yw.error("获取知识库失败");case 16:case"end":return e.stop()}}),e,null,[[2,11]])}))),[null==I?void 0:I.uid,U,ie,P,null==O?void 0:O.faqKbUid,null==K?void 0:K.faqKbUid]);(0,j.useEffect)((function(){var e=Array.isArray(null==E?void 0:E.faqs)?(null==E?void 0:E.faqs).map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];U.setFieldsValue({showRightIframe:null==E?void 0:E.showRightIframe,rightIframeUrl:null==E?void 0:E.rightIframeUrl,showFaqs:null==E?void 0:E.showFaqs,faqKbUid:null==E?void 0:E.faqKbUid,faqUids:Array.isArray(null==E?void 0:E.faqUids)?null==E?void 0:E.faqUids:e,agentRightPanelTabs:re}),null!=E&&E.faqKbUid&&E.faqKbUid!==Y&&(X(E.faqKbUid),ie(E.faqKbUid))}),[U,ie,E,re,Y]),(0,j.useEffect)((function(){null!=I&&I.uid&&ae()}),[null==I?void 0:I.uid,ae]);var oe=function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("TabRight handleChange showRightIframe",t),U.setFieldValue("showRightIframe",t),null==R||R({showRightIframe:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("TabRight handleChange showFaqs",t),U.setFieldValue("showFaqs",t),null==R||R({showFaqs:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),le=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.Z,{width:"md",name:"showRightIframe",label:(0,q.jsxs)("span",{children:[P.formatMessage({id:"showRightIframe"}),(0,q.jsx)(m.Z,{type:"service",keys:["showRightIframe"],live:K,draft:O})]}),fieldProps:{onChange:oe}}),(0,q.jsx)(w.Z,{width:"md",name:"rightIframeUrl",label:(0,q.jsxs)("span",{children:[P.formatMessage({id:"rightIframeUrl"}),(0,q.jsx)(m.Z,{type:"service",keys:["rightIframeUrl"],live:K,draft:O})]}),tooltip:P.formatMessage({id:"rightIframeUrl.tooltip",defaultMessage:"可自定义嵌入式广告网址（需以 http:// 或 https:// 开头）"}),extra:P.formatMessage({id:"rightIframeUrl.extra",defaultMessage:"该地址会以 iframe 方式嵌入展示，可用于配置广告/活动页等。"}),placeholder:P.formatMessage({id:"rightIframeUrl.placeholder",defaultMessage:"请输入以 http:// 或 https:// 开头的URL"}),rules:[{type:"url",message:P.formatMessage({id:"rightIframeUrl.invalid",defaultMessage:"请输入有效的URL地址"})},{pattern:/^https?:\/\/[^\s]+$/i,message:P.formatMessage({id:"rightIframeUrl.scheme.required",defaultMessage:"必须以 http:// 或 https:// 开头"})}],fieldProps:{type:"url",inputMode:"url",allowClear:!0}})]}),se=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.Z,{width:"md",name:"showFaqs",label:(0,q.jsxs)("span",{children:[P.formatMessage({id:"faq.show.faqs"}),(0,q.jsx)(m.Z,{type:"service",keys:["showFaqs"],live:K,draft:O})]}),fieldProps:{onChange:ue}}),(0,q.jsx)(x.Z,{name:"faqKbUid",width:"md",label:(0,q.jsxs)("span",{children:[P.formatMessage({id:"faq.kbase.select",defaultMessage:"选择侧边栏常见问题知识库"}),(0,q.jsx)(m.Z,{type:"service",keys:["faqKbUid"],live:K,draft:O})]}),options:null==Q||null===(r=Q.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.map((function(e){return{label:F(e.name),value:e.uid}})),fieldProps:{onChange:function(e){console.log("TabRight selected kbase:",e),X(e),U.setFieldValue("faqUids",[]),ie(e),null==R||R({faqKbUid:e,faqUids:[]})},allowClear:!0,placeholder:P.formatMessage({id:"choose",defaultMessage:"Choose"})}}),(0,q.jsx)(x.Z,{name:"faqUids",width:"md",label:(0,q.jsxs)("span",{children:[P.formatMessage({id:"menu.kbase.faq"}),(0,q.jsx)(m.Z,{type:"service",keys:["faqUids"],live:K,draft:O})]}),tooltip:P.formatMessage({id:"faq.uids.dependency.tooltip",defaultMessage:"FAQ options depend on the knowledge base selected above."}),extra:P.formatMessage({id:"faq.uids.dependency.note",defaultMessage:"Choose a knowledge base first; switching it refreshes the FAQ list and clears current selections."}),options:null==W||null===(a=W.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.map((function(e){return{label:F(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:P.formatMessage({id:"choose",defaultMessage:"Choose"})}})]}),de=(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(k.u,{name:"agentRightPanelTabs",creatorButtonProps:{creatorButtonText:P.formatMessage({id:"agent.rightpanel.tab.add",defaultMessage:"添加 Tab"})},deleteIconProps:{tooltipText:P.formatMessage({id:"delete",defaultMessage:"删除"})},copyIconProps:!1,children:function(){return(0,q.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,q.jsx)(w.Z,{name:"title",width:"md",label:P.formatMessage({id:"agent.rightpanel.tab.title",defaultMessage:"Tab 标题"}),placeholder:P.formatMessage({id:"agent.rightpanel.tab.title.placeholder",defaultMessage:"请输入标题"}),rules:[{required:!0,message:P.formatMessage({id:"required",defaultMessage:"必填"})}]}),(0,q.jsx)(w.Z,{name:"url",width:"xl",label:P.formatMessage({id:"agent.rightpanel.tab.url",defaultMessage:"内嵌 URL"}),placeholder:P.formatMessage({id:"agent.rightpanel.tab.url.placeholder",defaultMessage:"请输入以 http:// 或 https:// 开头的URL"}),rules:[{required:!0,message:P.formatMessage({id:"required",defaultMessage:"必填"})},{type:"url",message:P.formatMessage({id:"rightIframeUrl.invalid",defaultMessage:"请输入有效的URL地址"})},{pattern:/^https?:\/\/[^\s]+$/i,message:P.formatMessage({id:"rightIframeUrl.scheme.required",defaultMessage:"必须以 http:// 或 https:// 开头"})}],fieldProps:{type:"url",inputMode:"url",allowClear:!0}})]})}})});return(0,q.jsx)("div",{style:{padding:"0 16px",height:"100%",overflowY:"auto"},children:(0,q.jsx)(y.A,{form:U,onValuesChange:function(e,t){var n={};Object.prototype.hasOwnProperty.call(e,"rightIframeUrl")&&(n.rightIframeUrl=t.rightIframeUrl),Object.prototype.hasOwnProperty.call(e,"faqUids")&&(n.faqUids=t.faqUids),Object.prototype.hasOwnProperty.call(e,"faqKbUid")&&(n.faqKbUid=t.faqKbUid),Object.keys(n).length>0&&(null==R||R(n)),Object.prototype.hasOwnProperty.call(e,"agentRightPanelTabs")&&(null==A||A(t.agentRightPanelTabs||[]))},submitter:!1,children:(0,q.jsx)(M.Z,{activeKey:G,onChange:ee,items:[{key:"iframe",label:P.formatMessage({id:"showRightIframe",defaultMessage:"右侧iframe"}),children:le},{key:"faq",label:P.formatMessage({id:"faq.show.faqs",defaultMessage:"常见问题"}),children:se}].concat(i()("agent"===u?[{key:"agent-right-panel-tabs",label:P.formatMessage({id:"agent.rightpanel.tabs",defaultMessage:"客服端右侧栏自定义tab"}),children:de}]:[]))})})})}},92029:function(e,t,n){n(90819),n(10154),n(73193),n(89933),n(45332),n(56862),n(88722),n(74171),n(80106),n(94976),n(67242),n(80950),n(44194),n(31549)},27501:function(e,t,n){var r=n(73193),i=n.n(r),a=n(45332),o=n.n(a),u=n(66441),l=n(39325),s=n(94976),d=n(99036),c=n(48058),f=n(98907),p=n(4628),g=n(30310),v=n(1282),h=n(44194),m=n(31549);t.Z=function(e){var t,n=d.A.useForm(),r=o()(n,1)[0],a=(0,p.useIntl)(),y={width:320},b=(0,l.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),w=b.currentRobotSettings,x=b.currentAgentSettings,k=b.currentWorkgroupSettings,S=b.setCurrentRobotSettings,j=b.setCurrentAgentSettings,M=b.setCurrentWorkgroupSettings,C=void 0!==e.variant,q=C?e:null,R=C?q.variant:(t=e.type)===s.Njn?"agent":t===s._X4?"robot":"workgroup",T=(0,h.useMemo)((function(){var e;return C?null!==(e=null==q?void 0:q.serviceSettings)&&void 0!==e?e:{}:"agent"===R?{live:null==x?void 0:x.serviceSettings,draft:null==x?void 0:x.draftServiceSettings}:"robot"===R?{live:null==w?void 0:w.serviceSettings,draft:null==w?void 0:w.draftServiceSettings}:{live:null==k?void 0:k.serviceSettings,draft:null==k?void 0:k.draftServiceSettings}}),[C,q,R,x,w,k]),A=(0,h.useMemo)((function(){var e,t;return"agent"!==R?null:C?null!==(t=null==q?void 0:q.agentMeta)&&void 0!==t?t:null:{maxThreadCount:null==x?void 0:x.maxThreadCount,allowAgentCloseThread:null===(e=null==x?void 0:x.allowAgentCloseThread)||void 0===e||e,timeoutRemindTime:null==x?void 0:x.timeoutRemindTime}}),[R,C,q,x]),P=(0,h.useCallback)((function(e){"agent"===R&&x?j(i()(i()({},x),{},{serviceSettings:i()(i()({},x.serviceSettings),e),draftServiceSettings:i()(i()({},x.draftServiceSettings||{}),e)})):"robot"===R&&w?S(i()(i()({},w),{},{serviceSettings:i()(i()({},w.serviceSettings),e),draftServiceSettings:i()(i()({},w.draftServiceSettings||{}),e)})):"workgroup"===R&&k&&M(i()(i()({},k),{},{serviceSettings:i()(i()({},k.serviceSettings),e),draftServiceSettings:i()(i()({},k.draftServiceSettings||{}),e)}))}),[R,x,w,k,j,S,M]),Z=(0,h.useCallback)((function(e){"agent"===R&&x&&j(i()(i()({},x),e))}),[R,x,j]),U=(0,h.useCallback)((function(e){var t;C?null==q||null===(t=q.onServiceSettingsChange)||void 0===t||t.call(q,e):P(e)}),[C,q,P]),I=(0,h.useCallback)((function(e){var t;"agent"===R&&(C?null==q||null===(t=q.onAgentMetaChange)||void 0===t||t.call(q,e):Z(e))}),[R,C,q,Z]),F=(0,h.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==T?void 0:T.draft)&&void 0!==t?t:null==T?void 0:T.live)&&void 0!==e?e:void 0}),[T]);(0,h.useEffect)((function(){r.setFieldsValue({autoCloseMin:null==F?void 0:F.autoCloseMin,showLogo:null==F?void 0:F.showLogo,requireLogin:null==F?void 0:F.requireLogin})}),[r,F]);return(0,h.useEffect)((function(){var e;"agent"===R&&r.setFieldsValue({maxThreadCount:null==A?void 0:A.maxThreadCount,allowAgentCloseThread:null===(e=null==A?void 0:A.allowAgentCloseThread)||void 0===e||e,timeoutRemindTime:null==A?void 0:A.timeoutRemindTime})}),[r,R,null==A?void 0:A.maxThreadCount,null==A?void 0:A.allowAgentCloseThread,null==A?void 0:A.timeoutRemindTime]),(0,m.jsxs)(d.A,{form:r,submitter:!1,style:{marginLeft:"20px"},children:["agent"===R&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.Z,{width:"md",name:"maxThreadCount",label:a.formatMessage({id:"agent.settings.max.thread"}),tooltip:a.formatMessage({id:"agent.settings.max.thread.tooltip",defaultMessage:"超出此设置数量会自动进入排队队列，需要手动接入"}),min:0,formItemProps:{style:y},fieldProps:{style:{width:"100%"},onChange:function(e){"number"==typeof e&&I({maxThreadCount:e})}}}),(0,m.jsx)(d.A.Item,{label:a.formatMessage({id:"agent.settings.timeout.remind",defaultMessage:"超时提醒时间"}),tooltip:a.formatMessage({id:"agent.settings.timeout.remind.tooltip",defaultMessage:"超过设定时间未回复客户将收到提醒"}),style:y,children:(0,m.jsxs)(g.Z.Compact,{block:!0,children:[(0,m.jsx)(c.Z,{formItemProps:{noStyle:!0},width:"md",name:"timeoutRemindTime",min:1,fieldProps:{style:{width:"100%"},onChange:function(e){"number"==typeof e&&I({timeoutRemindTime:e})}}}),(0,m.jsx)(v.Z,{disabled:!0,value:a.formatMessage({id:"time.minute",defaultMessage:"分钟"}),style:{width:72,textAlign:"center"},readOnly:!0,tabIndex:-1})]})}),(0,m.jsx)(f.Z,{name:"allowAgentCloseThread",width:"md",label:a.formatMessage({id:"agent.settings.allow.close.thread",defaultMessage:"允许客服手动结束会话"}),tooltip:a.formatMessage({id:"agent.settings.allow.close.thread.tooltip",defaultMessage:"关闭后，客服端将隐藏“结束会话”按钮"}),formItemProps:{style:y},fieldProps:{onChange:function(e){I({allowAgentCloseThread:e.target.checked})}}})]}),(0,m.jsx)(c.Z,{width:"md",name:"autoCloseMin",label:(0,m.jsxs)("span",{children:[a.formatMessage({id:"agent.settings.auto.close.time"}),(0,m.jsx)(u.Z,{type:"service",keys:["autoCloseMin"],live:null==T?void 0:T.live,draft:null==T?void 0:T.draft})]}),tooltip:a.formatMessage({id:"agent.settings.auto.close.time.tooltip"}),min:1,formItemProps:{style:y},fieldProps:{style:{width:"100%"},onChange:function(e){"number"==typeof e&&U({autoCloseMin:e})}}}),(0,m.jsx)(f.Z,{name:"requireLogin",width:"md",label:(0,m.jsxs)("span",{children:[a.formatMessage({id:"agent.settings.require.login",defaultMessage:"访客咨询需登录"}),(0,m.jsx)(u.Z,{type:"service",keys:["requireLogin"],live:null==T?void 0:T.live,draft:null==T?void 0:T.draft})]}),tooltip:a.formatMessage({id:"agent.settings.require.login.tooltip",defaultMessage:"开启后，访客必须先登录才能发起咨询"}),formItemProps:{style:y},fieldProps:{onChange:function(e){U({requireLogin:e.target.checked})}}})]})}},83610:function(e,t,n){var r=n(45332),i=n.n(r),a=n(66441),o=n(88722),u=n(78112),l=n(99036),s=n(98907),d=n(4628),c=n(44194),f=n(66406),p=n(31549);t.Z=function(e){var t=l.A.useForm(),n=i()(t,1)[0],r=(0,d.useIntl)(),g=(0,o.Z)().translateString,v=e.variant,h=e.serviceSettings,m=e.onServiceSettingsChange,y=(0,c.useState)(!1),b=i()(y,2),w=b[0],x=b[1],k=(0,c.useState)(""),S=i()(k,2),j=S[0],M=S[1],C=(0,c.useState)(""),q=i()(C,2),R=q[0],T=q[1],A=(0,c.useState)(""),P=i()(A,2),Z=P[0],U=P[1],I=(0,c.useRef)({topTip:"",agentCloseTip:"",autoCloseTip:""}),F=(0,c.useMemo)((function(){return null!=h?h:{}}),[h]),K=(0,c.useCallback)((function(e){null==m||m(e)}),[m]),O=(0,c.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==F?void 0:F.draft)&&void 0!==t?t:null==F?void 0:F.live)&&void 0!==e?e:void 0}),[F]);(0,c.useEffect)((function(){var e=!(null==O||!O.showTopTip);w!==e&&(x(e),n.setFieldValue("showTopTip",e));var t=function(e,t){var r=g(t)||"";I.current[e]!==r&&(I.current[e]=r,"topTip"===e?M(r):"agentCloseTip"===e?T(r):"autoCloseTip"===e&&U(r),n.setFieldValue(e,r))};O?(t("topTip",O.topTip),t("agentCloseTip",O.agentCloseTip),t("autoCloseTip",O.autoCloseTip)):(t("topTip",""),t("agentCloseTip",""),t("autoCloseTip",""))}),[O,n,w,g,v]);var E=(0,c.useCallback)((function(e){I.current.topTip=e,M(e),n.setFieldValue("topTip",e),K({topTip:e})}),[n,K]),B=(0,c.useCallback)((function(e){I.current.agentCloseTip=e,T(e),n.setFieldValue("agentCloseTip",e),K({agentCloseTip:e})}),[n,K]),L=(0,c.useCallback)((function(e){I.current.autoCloseTip=e,U(e),n.setFieldValue("autoCloseTip",e),K({autoCloseTip:e})}),[n,K]);return(0,p.jsxs)(l.A,{form:n,submitter:!1,style:{marginLeft:"20px"},children:[(0,p.jsx)(s.Z,{name:"showTopTip",width:"md",label:(0,p.jsxs)("span",{children:[r.formatMessage({id:"agent.settings.show.top.tip"}),(0,p.jsx)(a.Z,{type:"service",keys:["showTopTip"],live:null==F?void 0:F.live,draft:null==F?void 0:F.draft})]}),fieldProps:{onChange:function(e){x(e.target.checked),e.target.checked&&M(g(null==O?void 0:O.topTip)),K({showTopTip:e.target.checked})}}}),w&&(0,p.jsx)(l.A.Item,{name:"topTip",label:(0,p.jsxs)("span",{children:[r.formatMessage({id:"agent.settings.top.tip"}),(0,p.jsx)(a.Z,{type:"service",keys:["topTip"],live:null==F?void 0:F.live,draft:null==F?void 0:F.draft})]}),rules:[{required:!0,message:r.formatMessage({id:"agent.settings.top.tip.required"})}],children:(0,p.jsx)(f.Z,{placeholder:r.formatMessage({id:"agent.settings.top.tip.placeholder"}),value:j,toolbarKeys:(0,u.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:function(e){return E(e)}},"topTipEditor")}),"agent"===v&&(0,p.jsx)(l.A.Item,{name:"agentCloseTip",label:(0,p.jsxs)("span",{children:[r.formatMessage({id:"agent.settings.agent.close.tip"}),(0,p.jsx)(a.Z,{type:"service",keys:["agentCloseTip"],live:null==F?void 0:F.live,draft:null==F?void 0:F.draft})]}),tooltip:r.formatMessage({id:"agent.settings.agent.close.tip.tooltip"}),rules:[{required:!0,message:r.formatMessage({id:"agent.settings.agent.close.tip.required"})}],children:(0,p.jsx)(f.Z,{placeholder:r.formatMessage({id:"agent.settings.agent.close.tip.placeholder"}),value:R,toolbarKeys:(0,u.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:function(e){return B(e)}},"agentCloseTipEditor")}),(0,p.jsx)(l.A.Item,{name:"autoCloseTip",label:(0,p.jsxs)("span",{children:[r.formatMessage({id:"agent.settings.auto.close.tip"}),(0,p.jsx)(a.Z,{type:"service",keys:["autoCloseTip"],live:null==F?void 0:F.live,draft:null==F?void 0:F.draft})]}),tooltip:r.formatMessage({id:"agent.settings.auto.close.tip.tooltip"}),rules:[{required:!0,message:r.formatMessage({id:"agent.settings.auto.close.tip.required"})}],children:(0,p.jsx)(f.Z,{placeholder:r.formatMessage({id:"agent.settings.auto.close.tip.placeholder"}),value:Z,toolbarKeys:(0,u.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:function(e){return L(e)}},"autoCloseTipEditor")})]})}},12608:function(e,t,n){var r=n(73193),i=n.n(r),a=n(90819),o=n.n(a),u=n(89933),l=n.n(u),s=n(45332),d=n.n(s),c=n(43388),f=n(25552),p=n(74171),g=n(99036),v=n(50628),h=n(59005),m=n(4628),y=n(44194),b=n(26874),w=n(95018),x=n(21600),k=n(88722),S=n(66441),j=n(31549),M=["smile","upload","rate","leavemsg"],C=function(e){var t=Array.isArray(e)?e.filter(Boolean).map((function(e){return String(e)})):[];if(!t.length)return[].concat(M);var n=[];return t.forEach((function(e){var t="image"===e||"file"===e?"upload":e;n.includes(t)||n.push(t)})),n};t.Z=function(e){var t=e.variant,n=e.serviceSettings,r=e.onServiceSettingsChange,a=(0,m.useIntl)(),u=g.A.useForm(),s=d()(u,1)[0],M=(0,k.Z)().translateString,q=(0,p.u)((function(e){return e.currentOrg})),R=(0,y.useState)("toolbar"),T=d()(R,2),A=T[0],P=T[1],Z=(0,y.useState)([]),U=d()(Z,2),I=U[0],F=U[1],K=(0,y.useState)(!1),O=d()(K,2),E=O[0],B=O[1],L=null==n?void 0:n.live,W=null==n?void 0:n.draft,V=(0,y.useMemo)((function(){return null!=W?W:L}),[W,L]),_=(0,y.useCallback)(l()(o()().mark((function e(){var t,n,r,i,u,l,d,p;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=q&&q.uid){e.next=3;break}return F([]),e.abrupt("return");case 3:return B(!0),t=c.yw.loading(a.formatMessage({id:"loading",defaultMessage:"Loading"})),e.prev=5,e.next=8,(0,f.qL)({pageNumber:0,pageSize:200,orgUid:q.uid});case 8:200===(n=e.sent).code?(i=((null==n||null===(r=n.data)||void 0===r?void 0:r.content)||[]).filter((function(e){return Boolean(null==e?void 0:e.uid)})),u=i.sort((function(e,t){var n,r;return(null!==(n=null==e?void 0:e.orderIndex)&&void 0!==n?n:0)-(null!==(r=null==t?void 0:t.orderIndex)&&void 0!==r?r:0)})),F(u),l=new Set(u.map((function(e){return e.uid}))),d=s.getFieldValue("quickButtonUids")||[],(p=d.filter((function(e){return l.has(e)}))).length!==d.length&&s.setFieldValue("quickButtonUids",p)):c.yw.error(n.message||a.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),c.yw.error(a.formatMessage({id:"request.failed",defaultMessage:"Request failed"}));case 15:return e.prev=15,null==t||t(),B(!1),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[5,12,15,19]])}))),[null==q?void 0:q.uid,s,a]);(0,y.useEffect)((function(){_()}),[_]),(0,y.useEffect)((function(){var e,t,n,r,i,a,o,u,l,d;if(V){var c=V.toolbar||{},f=null==V?void 0:V.quickButtons,p=null!==(e=c.upload)&&void 0!==e?e:Boolean(c.image)||Boolean(c.file)||void 0===c.image&&void 0===c.file;s.setFieldsValue({smile:null===(t=c.smile)||void 0===t||t,upload:p,uploadRobot:null===(n=c.uploadRobot)||void 0===n||n,rate:null===(r=c.rate)||void 0===r||r,leavemsg:null===(i=c.leavemsg)||void 0===i||i,orderSelector:null===(a=c.orderSelector)||void 0===a||a,ticket:null===(o=c.ticket)||void 0===o||o,audio:null===(u=c.audio)||void 0===u||u,video:null===(l=c.video)||void 0===l||l,tel:null===(d=c.tel)||void 0===d||d,toolbarOrder:C(c.order),showQuickButtons:V.showQuickButtons,quickButtonUids:Array.isArray(null==V?void 0:V.quickButtonUids)?V.quickButtonUids:Array.isArray(f)?f.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[]})}}),[V,s]);var J=(0,y.useCallback)((function(e){s.setFieldValue("showQuickButtons",e),null==r||r({showQuickButtons:e})}),[s,r]),Q=(0,y.useMemo)((function(){return null!=I&&I.length?I.filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{label:M(e.title)||e.title||e.uid,value:e.uid}})):[]}),[I,M]),z=(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(b.Z,{gutter:[16,16],style:{marginTop:16},children:[(0,j.jsx)(w.Z,{span:12,children:(0,j.jsx)(v.Z,{name:"smile",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"chat.toolbar.emoji",defaultMessage:"Emoji"}),(0,j.jsx)(S.Z,{type:"service",keys:["toolbar"],live:L,draft:W})]}),formItemProps:{style:{marginBottom:8}}})}),(0,j.jsx)(w.Z,{span:12,children:(0,j.jsx)(v.Z,{name:"upload",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"chat.toolbar.upload",defaultMessage:"Upload"}),(0,j.jsx)(S.Z,{type:"service",keys:["toolbar"],live:L,draft:W})]}),formItemProps:{style:{marginBottom:8}}})}),("robot"===t||"workgroup"===t)&&(0,j.jsx)(w.Z,{span:12,children:(0,j.jsx)(v.Z,{name:"uploadRobot",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"chat.toolbar.upload.robot",defaultMessage:"机器人接待显示发送图片/文件"}),(0,j.jsx)(S.Z,{type:"service",keys:["toolbar"],live:L,draft:W})]}),formItemProps:{style:{marginBottom:8}}})}),(0,j.jsx)(w.Z,{span:12,children:(0,j.jsx)(v.Z,{name:"rate",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"chat.toolbar.rate",defaultMessage:"Rate"}),(0,j.jsx)(S.Z,{type:"service",keys:["toolbar"],live:L,draft:W})]}),formItemProps:{style:{marginBottom:8}}})}),(0,j.jsx)(w.Z,{span:12,children:(0,j.jsx)(v.Z,{name:"leavemsg",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"chat.toolbar.leaveMsg",defaultMessage:"Leave Msg"}),(0,j.jsx)(S.Z,{type:"service",keys:["toolbar"],live:L,draft:W})]}),formItemProps:{style:{marginBottom:8}}})})]})}),D=(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(v.Z,{label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"faq.show.quick.buttons"}),(0,j.jsx)(S.Z,{type:"service",keys:["showQuickButtons"],live:L,draft:W})]}),name:"showQuickButtons",width:"md",fieldProps:{onChange:J}}),(0,j.jsx)(h.Z,{name:"quickButtonUids",width:"lg",label:(0,j.jsxs)("span",{children:[a.formatMessage({id:"menu.kbase.quickbutton"}),(0,j.jsx)(S.Z,{type:"service",keys:["quickButtonUids","quickButtons"],live:L,draft:W})]}),options:Q,fieldProps:{mode:"multiple",allowClear:!0,showSearch:!0,optionFilterProp:"label",placeholder:(0,j.jsx)(m.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),loading:E}})]});return(0,j.jsx)("div",{style:{padding:"0 16px",height:"100%",overflowY:"auto"},children:(0,j.jsx)(g.A,{form:s,onValuesChange:function(e,n){var a=["smile","upload","rate","leavemsg"];"robot"!==t&&"workgroup"!==t||a.push("uploadRobot");var o={};a.forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=n[t])}));var u=Object.prototype.hasOwnProperty.call(e,"toolbarOrder"),l={},s=i()(i()({},(null==L?void 0:L.toolbar)||{}),(null==W?void 0:W.toolbar)||{});Object.keys(o).length>0&&(l.toolbar=i()(i()({},s),o)),u&&(l.toolbar=i()(i()({},l.toolbar||s),{},{order:C(n.toolbarOrder||[])})),["showQuickButtons","quickButtonUids"].forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(l[t]=n[t])})),0!==Object.keys(l).length&&(null==r||r(l))},submitter:!1,children:(0,j.jsx)(x.Z,{activeKey:A,onChange:P,items:[{key:"toolbar",label:a.formatMessage({id:"chat.toolbar.settings",defaultMessage:"访客端工具栏设置"}),children:z},{key:"quickButton",label:a.formatMessage({id:"quick.faq.settings",defaultMessage:"访客端快捷按钮设置"}),children:D}]})})})}},77500:function(e,t,n){n.d(t,{Z:function(){return E}});var r=n(76711),i=n.n(r),a=n(73193),o=n.n(a),u=n(45332),l=n.n(u),s=n(66441),d=n(90819),c=n.n(d),f=n(89933),p=n.n(f),g=n(43388),v=n(99036),h=n(50628),m=n(86702),y=n(60241),b=n(30857),w=n(30310),x=n(69533),k=n(44194),S=n(31549),j={enabled:!0,triggerKey:"",config:"{}"},M=function(e){var t=e.open,n=e.record,r=e.onClose,i=e.onSubmit,a=v.A.useForm(),u=l()(a,1)[0],s=!(null==n||!n.uid);return(0,k.useEffect)((function(){t&&u.setFieldsValue(o()(o()({},j),null!=n?n:{}))}),[u,t,n]),(0,S.jsx)(b.Z,{title:s?"编辑触发器":"添加触发器",width:600,open:t,onClose:r,destroyOnHidden:!0,extra:(0,S.jsxs)(w.Z,{children:[(0,S.jsx)(x.ZP,{onClick:r,children:"取消"}),(0,S.jsx)(x.ZP,{type:"primary",onClick:function(){return u.submit()},children:"保存"})]}),children:(0,S.jsxs)(v.A,{form:u,layout:"vertical",submitter:!1,initialValues:j,onFinish:function(){var e=p()(c()().mark((function e(t){var n,r,a,o,u,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(null!==(n=null==t?void 0:t.triggerKey)&&void 0!==n?n:"").trim()){e.next=4;break}return g.yw.error("请填写 Trigger Key"),e.abrupt("return",!1);case 4:u=(null!==(r=null==t?void 0:t.config)&&void 0!==r?r:"{}").toString().trim(),l=u.length>0?u:"{}",e.prev=6,JSON.parse(l),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(6),g.yw.error("配置(JSON) 格式不正确"),e.abrupt("return",!1);case 14:return i({uid:null==t?void 0:t.uid,triggerKey:o,enabled:null===(a=null==t?void 0:t.enabled)||void 0===a||a,type:null==t?void 0:t.type,name:null==t?void 0:t.name,description:null==t?void 0:t.description,config:l}),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,null,[[6,10]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,S.jsx)(h.Z,{name:"enabled",label:"是否启用",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"}}),(0,S.jsx)(m.Z,{name:"triggerKey",label:"Trigger Key",placeholder:"例如：visitor_no_response_proactive_message",rules:[{required:!0,message:"请填写 Trigger Key"}]}),(0,S.jsx)(m.Z,{name:"type",label:"类型（可选）",placeholder:"例如：THREAD/CUSTOMER/TICKET"}),(0,S.jsx)(m.Z,{name:"name",label:"名称（可选）",placeholder:"显示名称"}),(0,S.jsx)(m.Z,{name:"description",label:"描述（可选）",placeholder:"描述信息"}),(0,S.jsx)(y.Z,{name:"config",label:"配置(JSON)",placeholder:'例如：{"noResponseTimeout":300,"proactiveMessage":"您好..."}',fieldProps:{autoSize:{minRows:4,maxRows:10}}})]})})},C=n(94976),q=n(4628);function R(e){return T.apply(this,arguments)}function T(){return(T=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,q.request)("/api/v1/trigger/query/org",{method:"GET",params:o()(o()({},t),{},{channel:C.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=n(67242),P=n(83281),Z=n(82878),U=n(90581),I=function(e){var t=e.open,n=e.orgUid,r=e.onClose,i=e.onSelect,a=(0,k.useState)(!1),o=l()(a,2),u=o[0],s=o[1],d=(0,k.useState)(0),f=l()(d,2),v=f[0],h=f[1],m=(0,k.useState)(10),y=l()(m,2),j=y[0],M=y[1],C=(0,k.useState)([]),q=l()(C,2),T=q[0],I=q[1],F=(0,k.useState)(0),K=l()(F,2),O=K[0],E=K[1],B=(0,k.useCallback)(p()(c()().mark((function e(){var r,i,a,o,u,l,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return s(!0),e.prev=3,u={pageNumber:v,pageSize:j,orgUid:n},e.next=7,R(u);case 7:if(l=e.sent,A.Z.debug("queryTriggersByOrg fetchList:",l,u),200===(null==l?void 0:l.code)){e.next=14;break}return g.yw.error((null==l?void 0:l.message)||"加载触发器列表失败"),I([]),E(0),e.abrupt("return");case 14:d=null!==(r=null==l||null===(i=l.data)||void 0===i?void 0:i.content)&&void 0!==r?r:[],I(d),E(null!==(a=null==l||null===(o=l.data)||void 0===o?void 0:o.totalElements)&&void 0!==a?a:0),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(3),g.yw.error("加载触发器列表失败"),I([]),E(0);case 24:return e.prev=24,s(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[3,19,24,27]])}))),[t,n,v,j]);return(0,k.useEffect)((function(){B()}),[B]),(0,S.jsx)(b.Z,{title:"选择触发器",width:600,open:t,onClose:r,destroyOnHidden:!0,children:(0,S.jsx)(P.Z,{loading:u,dataSource:T,rowKey:function(e){return e.uid||"".concat(e.triggerKey||"","-").concat(e.name||"")},pagination:{current:v+1,pageSize:j,total:O,showSizeChanger:!0,onChange:function(e,t){h(Math.max(0,(null!=e?e:1)-1)),t&&t!==j&&M(t)}},renderItem:function(e){var t=null==e?void 0:e.enabled;return(0,S.jsx)(P.Z.Item,{actions:[(0,S.jsx)(x.ZP,{size:"small",type:"link",onClick:function(){return i({uid:(t=e).uid,triggerKey:t.triggerKey,enabled:t.enabled,type:t.type,name:t.name,description:t.description,config:t.config});var t},children:"选择"},"select")],children:(0,S.jsx)(P.Z.Item.Meta,{title:(0,S.jsxs)(w.Z,{size:8,wrap:!0,children:[(0,S.jsx)(Z.Z.Text,{strong:!0,children:(null==e?void 0:e.name)||"(未命名)"}),(0,S.jsx)(U.Z,{children:t?"启用":"禁用"}),null!=e&&e.type?(0,S.jsx)(U.Z,{children:e.type}):null]}),description:(0,S.jsxs)("div",{children:[null!=e&&e.triggerKey?(0,S.jsxs)(Z.Z.Text,{type:"secondary",children:["Trigger Key：",e.triggerKey]}):null,null!=e&&e.description?(0,S.jsx)("div",{children:e.description}):null]})})})}})})},F=n(74171),K=n(34512),O=n(10390),E=function(e){e.variant;var t=e.triggerSettings,n=e.onTriggerSettingsChange,r=(0,k.useRef)(""),a=(0,k.useRef)(""),u=(0,k.useRef)(!1),d=(0,F.u)((function(e){return e.currentOrg})),c=null==d?void 0:d.uid,f=(0,k.useState)(!1),p=l()(f,2),g=p[0],v=p[1],h=(0,k.useState)(!1),m=l()(h,2),y=m[0],b=m[1],j=(0,k.useState)(null),C=l()(j,2),q=C[0],R=C[1],T=(0,k.useState)(null),A=l()(T,2),P=A[0],E=A[1],B=(0,k.useMemo)((function(){var e,n;return null!==(e=null!==(n=null==t?void 0:t.draft)&&void 0!==n?n:null==t?void 0:t.live)&&void 0!==e?e:{}}),[t]),L=(0,k.useMemo)((function(){var e=null==B?void 0:B.triggers;return Array.isArray(e)?e:[]}),[B]),W=(0,k.useMemo)((function(){var e,n,r,i;return null!==(e=null!==(n=null==t||null===(r=t.draft)||void 0===r?void 0:r.uid)&&void 0!==n?n:null==t||null===(i=t.live)||void 0===i?void 0:i.uid)&&void 0!==e?e:""}),[null==t?void 0:t.draft,null==t?void 0:t.live]),V=(0,k.useCallback)((function(e){var t,n,r;if(!e)return null;var i=(null!==(t=e.triggerKey)&&void 0!==t?t:"").toString().trim(),a=(null!==(n=e.config)&&void 0!==n?n:"{}").toString();return o()(o()({},e.uid?{uid:e.uid}:{}),{},{triggerKey:i,enabled:null===(r=e.enabled)||void 0===r||r,type:e.type,name:e.name,description:e.description,config:a.trim().length>0?a:"{}"})}),[]),_=(0,k.useCallback)((function(e){return e.map((function(e){var t,n,r,i,a,o,u;return[null!==(t=e.uid)&&void 0!==t?t:"",null!==(n=e.triggerKey)&&void 0!==n?n:"",String(null!==(r=e.enabled)&&void 0!==r?r:""),null!==(i=e.type)&&void 0!==i?i:"",null!==(a=e.name)&&void 0!==a?a:"",null!==(o=e.description)&&void 0!==o?o:"",null!==(u=e.config)&&void 0!==u?u:""].join("|")})).join("\n")}),[]),J=(0,k.useMemo)((function(){return{triggers:L.filter((function(e){return!!e})).map((function(e){return V(e)})).filter((function(e){return!!e})).filter((function(e){var t;return(null!==(t=e.triggerKey)&&void 0!==t?t:"").trim().length>0}))}}),[L,V]),Q=(0,k.useCallback)((function(e,t){var n,r,i=(null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:"").toString().trim();if(i)return i;var a=(null!==(r=null==e?void 0:e.triggerKey)&&void 0!==r?r:"").toString().trim();return a?"triggerKey:".concat(a,":").concat(null!=t?t:""):"row:".concat(Date.now(),":").concat(Math.random().toString(16).slice(2))}),[]),z=(0,k.useCallback)((function(e){return(Array.isArray(e)?e:[]).map((function(e,t){return o()(o()({},e),{},{__rowKey:(null==e?void 0:e.__rowKey)||Q(e,t)})}))}),[Q]),D=(0,k.useState)((function(){return z(J.triggers)})),N=l()(D,2),Y=N[0],X=N[1],H=(0,k.useRef)(Y);(0,k.useEffect)((function(){H.current=Y}),[Y]);var $=(0,k.useMemo)((function(){var e;return(null!==(e=J.triggers)&&void 0!==e?e:[]).filter((function(e){var t;return(null!==(t=e.triggerKey)&&void 0!==t?t:"").trim().length>0}))}),[J.triggers]),G=(0,k.useMemo)((function(){return _($)}),[$,_]);(0,k.useEffect)((function(){var e,t=r.current,n=W;if(t!==n)return r.current=n,u.current=!1,a.current=G,void X(z(J.triggers));if(u.current){var i=(null!==(e=H.current)&&void 0!==e?e:[]).filter((function(e){return!!e})).map((function(e){return V(e)})).filter((function(e){return!!e})).filter((function(e){var t;return(null!==(t=e.triggerKey)&&void 0!==t?t:"").trim().length>0}));_(i)===G&&(u.current=!1,a.current!==G&&(a.current=G,X(z(J.triggers))))}else a.current!==G&&(a.current=G,X(z(J.triggers)))}),[G,J.triggers,V,_,W,z]);var ee=(0,k.useCallback)((function(e){var t=e.filter((function(e){return!!e})).map((function(e){return V(e)})).filter((function(e){return!!e})).filter((function(e){var t;return(null!==(t=e.triggerKey)&&void 0!==t?t:"").trim().length>0}));_(t)!==G&&(u.current=!0,null==n||n({triggers:t}))}),[G,V,n,_]),te=(0,k.useCallback)((function(){v(!0)}),[]),ne=(0,k.useCallback)((function(e){var t=Array.isArray(Y)?i()(Y):[],n=null==e?void 0:e.uid,r=null==e?void 0:e.triggerKey;if(!t.some((function(e){var t;return n?(null==e?void 0:e.uid)===n:!!r&&(null!==(t=null==e?void 0:e.triggerKey)&&void 0!==t?t:"").toString()===r.toString()}))){var a=o()(o()({},e),{},{__rowKey:(null==e?void 0:e.__rowKey)||Q(e,t.length)});t.push(a),X(t),ee(t)}v(!1)}),[ee,Q,Y]),re=(0,k.useCallback)((function(e){var t=(Array.isArray(Y)?Y:[])[e];t&&(E(e),R(t),b(!0))}),[Y]),ie=(0,k.useCallback)((function(e){var t=Array.isArray(Y)?i()(Y):[];e<0||e>=t.length||(t.splice(e,1),X(t),ee(t))}),[ee,Y]),ae=(0,k.useCallback)((function(e){var t=Array.isArray(Y)?i()(Y):[];if(null==P){var n=o()(o()({},e),{},{__rowKey:(null==e?void 0:e.__rowKey)||Q(e,t.length)});t.push(n)}else{var r=t[P],a=null==r?void 0:r.uid,u=null==r?void 0:r.__rowKey;t[P]=o()(o()(o()(o()({},r),e),!a||null!=e&&e.uid?{}:{uid:a}),u?{__rowKey:u}:{__rowKey:Q(e,P)})}X(t),b(!1),R(null),E(null),ee(t)}),[P,ee,Q,Y]),oe=(0,k.useMemo)((function(){return[{title:"启用",dataIndex:"enabled",width:80,render:function(e,t){return(0,S.jsx)(U.Z,{children:null!=t&&t.enabled?"启用":"禁用"})}},{title:"Trigger Key",dataIndex:"triggerKey",ellipsis:!0},{title:"类型",dataIndex:"type",width:120,render:function(e,t){return null!=t&&t.type?(0,S.jsx)(U.Z,{children:t.type}):"-"}},{title:"名称",dataIndex:"name",ellipsis:!0},{title:"操作",valueType:"option",width:160,render:function(e,t,n){var r="number"==typeof n?n:-1;return(0,S.jsxs)(w.Z,{size:8,children:[(0,S.jsx)(x.ZP,{size:"small",onClick:function(){return re(r)},children:"编辑"}),(0,S.jsx)(x.ZP,{danger:!0,size:"small",onClick:function(){return ie(r)},children:"删除"})]})}}]}),[re,ie]);return(0,S.jsxs)("div",{children:[g&&(0,S.jsx)(I,{open:g,orgUid:c,onClose:function(){return v(!1)},onSelect:ne}),y&&(0,S.jsx)(M,{open:y,record:q,onClose:function(){b(!1),R(null),E(null)},onSubmit:ae}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,S.jsxs)(w.Z,{size:8,children:[(0,S.jsx)(Z.Z.Text,{strong:!0,children:"触发器列表"}),(0,S.jsx)(s.Z,{type:"generic",keys:["triggers"],live:null==t?void 0:t.live,draft:null==t?void 0:t.draft})]}),(0,S.jsx)(x.ZP,{onClick:te,children:"添加触发器"})]}),(0,S.jsx)(K.Z,{rowKey:function(e){return e.__rowKey},columns:oe,dataSource:Y,search:!1,options:!1,pagination:!1}),(0,S.jsx)(O.Z,{})]})}},66406:function(e,t,n){var r=n(73193),i=n.n(r),a=n(43388),o=n(25553),u=n(58620),l=n(94976),s=n(4628),d=n(53411),c=(n(69055),n(96596)),f=n.n(c),p=n(44194),g=n(31549);t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,c=e.style,v=e.toolbarKeys,h=e.maxLength,m=e.onChange,y=e.options,b=(0,s.useIntl)(),w=(0,o.Z)().isDarkMode,x=(0,p.useRef)(null),k=(0,p.useRef)(null),S=(0,p.useRef)(!1),j=(0,p.useRef)(m);(0,p.useEffect)((function(){j.current=m}),[m]);var M=function(e,t,n){"function"!=typeof j.current||S.current||j.current(e,t,n)};return(0,p.useEffect)((function(){if(x.current){if(!k.current){var e=new d.cW(i()(i()({element:x.current,theme:w?"dark":"light",placeholder:t,content:n,toolbarKeys:v},y||{}),{},{image:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,u=new FormData;return u.append("file",e),u.append("fileName",o),u.append("fileType",e.type),u.append("isAvatar","false"),u.append("kbType",l.QPQ),u.append("categoryUid",""),u.append("kbUid",""),u.append("orgUid",""),u.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:i()({Accept:"application/json"},n),body:u}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){a.yw.destroy(),a.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:o}};e(n)}else a.yw.destroy(),a.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,u=new FormData;return u.append("file",e),u.append("fileName",o),u.append("fileType",e.type),u.append("isAvatar","false"),u.append("kbType",l.QPQ),u.append("categoryUid",""),u.append("kbUid",""),u.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:i()({Accept:"application/json"},n),body:u}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){a.yw.destroy(),a.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else a.yw.destroy(),a.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(l.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,u=new FormData;return u.append("file",e),u.append("fileName",o),u.append("fileType",e.type),u.append("isAvatar","false"),u.append("kbType",l.QPQ),u.append("categoryUid",""),u.append("kbUid",""),u.append("client",l.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:i()({Accept:"application/json"},n),body:u}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){a.yw.destroy(),a.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:o}};e(n)}else a.yw.destroy(),a.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){var t=e.getText(),n=t.length,r="number"==typeof h?h:Number.POSITIVE_INFINITY;if(n>r){var i,o;a.yw.warning(b.formatMessage({id:"character.limit.reached"},{limit:r})||"已达到 ".concat(r," 字符限制"));var u=t.substring(0,r);S.current=!0,setTimeout((function(){k.current&&k.current.setContent(u),S.current=!1}),0),M((null===(i=k.current)||void 0===i?void 0:i.getHtml())||"",(null===(o=k.current)||void 0===o?void 0:o.getMarkdown())||"",u)}else M(e.getHtml(),e.getMarkdown(),e.getText())}}));k.current=e}return function(){k.current&&(k.current.destroy(),k.current=null)}}}),[]),(0,p.useEffect)((function(){k.current&&void 0!==r&&r!==k.current.getHtml()&&(S.current=!0,k.current.setContent(r||"",!1),requestAnimationFrame((function(){S.current=!1})))}),[r]),(0,g.jsx)("div",{ref:x,style:i()({height:"100%"},c)})}},66441:function(e,t,n){n.d(t,{Z:function(){return x}});var r=n(73193),i=n.n(r),a=n(44194),o=n(92351),u=n(90581),l=n(86222),s=n.n(l),d=n(89957),c=n.n(d),f=["welcomeFaqUids","faqUids","quickButtonUids","guessFaqUids","hotFaqUids","shortcutFaqUids","proactiveFaqUids"],p=["welcomeFaqs","faqs","quickButtons","guessFaqs","hotFaqs","shortcutFaqs","proactiveFaqs"];function g(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(e,t){if(!e)return e;if(!t||0===t.length)return e;var n={};return t.forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])})),n}function h(e){var t=e&&g(e)?i()({},e):{};return p.forEach((function(e){t[e]&&(t[e.replace(/s$/,"Uids")]=function(e){if(Array.isArray(e))return e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean).map(String)}(t[e]),delete t[e])})),f.forEach((function(e){t[e]&&(t[e]=function(e){if(!Array.isArray(e))return e;var t=e.slice();return t.every((function(e){return["string","number","boolean"].includes(c()(e))}))?t.map((function(e){return"string"==typeof e?e:String(e)})).sort():t}(t[e]))})),t}function m(e){return e&&g(e)?i()({},e):{}}function y(e){var t=new WeakSet;return JSON.stringify(function e(n){if(null===n||"object"!==c()(n))return n;if(!t.has(n)){if(t.add(n),Array.isArray(n))return n.map((function(t){return e(t)}));var r,i=Object.keys(n).sort(),a={},o=s()(i);try{for(o.s();!(r=o.n()).done;){var u=r.value;a[u]=e(n[u])}}catch(e){o.e(e)}finally{o.f()}return a}}(e))}function b(e,t){return y(e)===y(t)}var w=n(31549),x=function(e){var t=e.hasDiff,n=e.type,r=void 0===n?"service":n,l=e.live,s=e.draft,d=e.keys,c=e.text,f=void 0===c?"草稿未发布":c,p=e.style;return(0,a.useMemo)((function(){if("boolean"==typeof t)return t;if(!l&&!s)return!1;switch(r){case"service":return function(e,t,n){return!b(v(h(e),n),v(h(t),n))}(l,s,d);case"messageLeave":return function(e,t,n){return!b(v(m(e),n),v(m(t),n))}(l,s,d);default:return function(e,t,n){return!b(v(e||{},n),v(t||{},n))}(l,s,d)}}),[t,r,l,s,d])?(0,w.jsx)(o.Z,{title:"string"==typeof f?f:"草稿与线上不一致",children:(0,w.jsx)(u.Z,{color:"orange",style:i()({marginLeft:8,height:20,lineHeight:"18px"},p),children:"Draft"})}):null}},80106:function(e,t,n){n.d(t,{V:function(){return c}});var r=n(73193),i=n.n(r),a=n(76711),o=n.n(a),u=n(94976),l=n(26557),s=n(26407),d=n(20744),c=(0,l.Ue)()((0,s.mW)((0,s.tJ)((0,d.n)((function(e,t){return{robotResult:{data:{content:[]}},currentRobot:{uid:"",nickname:""},llmRobotsByOrg:{},insertRobot:function(t){e((function(e){e.robotResult.data.content.unshift(t)}))},setRobotResult:function(n){e({robotResult:n});var r,i=t().currentRobot;""!==i.uid&&void 0!==i||(null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentRobot:n.data.content[0]})},setCurrentRobot:function(n){var r=t().robotResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var u=[].concat(o()(r.slice(0,a)),[n],o()(r.slice(a+1))),l=i()(i()({},t().robotResult),{},{data:{content:u}});e({robotResult:l,currentRobot:n})}else console.warn("Robot with the specified uid not found."),e({currentRobot:n})},deleteCurrentRobot:function(n){var r=t().robotResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({robotResult:i()(i()({},t().robotResult),{},{data:{content:[].concat(o()(r.slice(0,a)),o()(r.slice(a+1)))}})}):console.warn("Robot not found in cache:",n),t().currentRobot.uid===n&&e({currentRobot:{uid:""}})},getLlmRobotsByOrg:function(e){var n,r;return e&&null!==(n=null===(r=t().llmRobotsByOrg)||void 0===r?void 0:r[e])&&void 0!==n?n:[]},setLlmRobotsByOrg:function(t,n){t&&e((function(e){e.llmRobotsByOrg[t]=Array.isArray(n)?n:[]}))},clearLlmRobotsByOrg:function(t){e(t?function(e){delete e.llmRobotsByOrg[t]}:function(e){e.llmRobotsByOrg={}})},deleteRobotCache:function(){return e({},!0)}}})),{name:u.Eis})))},1395:function(e,t,n){n.d(t,{E:function(){return c}});var r=n(73193),i=n.n(r),a=n(76711),o=n.n(a),u=n(94976),l=n(26557),s=n(26407),d=n(20744),c=(0,l.Ue)()((0,s.mW)((0,s.tJ)((0,d.n)((function(e,t){return{agentResult:{data:{content:[]}},currentAgent:{uid:"",orgUid:""},insertAgent:function(t){e((function(e){e.agentResult.data.content.unshift(t)}))},updateAgent:function(t){e((function(e){var n=e.agentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Agent with uid ".concat(t.uid," not found."))}))},setAgentResult:function(n){var r;(e({agentResult:n}),""===t().currentAgent.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentAgent:n.data.content[0]}))},setCurrentAgent:function(n){var r=t().agentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var u=[].concat(o()(r.slice(0,a)),[n],o()(r.slice(a+1))),l=i()(i()({},t().agentResult),{},{data:{content:u}});e({agentResult:l,currentAgent:n})}else console.warn("Agent with the specified uid not found."),e({currentAgent:n})},deleteCurrentAgent:function(n){var r=t().agentResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({agentResult:i()(i()({},t().agentResult),{},{data:{content:[].concat(o()(r.slice(0,a)),o()(r.slice(a+1)))}})}):console.warn("Agent not found in cache:",n),t().currentAgent.uid===n&&e({currentAgent:{uid:"",orgUid:""}})},deleteAgentCache:function(){return e({},!0)}}})),{name:u.zzK})))},39325:function(e,t,n){n.d(t,{z:function(){return u}});var r=n(94976),i=n(26557),a=n(26407),o=n(20744),u=(0,i.Ue)()((0,a.mW)((0,a.tJ)((0,o.n)((function(e){return{currentAgentSettings:null,currentRobotSettings:null,currentWorkgroupSettings:null,setCurrentAgentSettings:function(t){return e({currentAgentSettings:t})},setCurrentRobotSettings:function(t){return e({currentRobotSettings:t})},setCurrentWorkgroupSettings:function(t){return e({currentWorkgroupSettings:t})},clear:function(){return e({currentAgentSettings:null,currentRobotSettings:null,currentWorkgroupSettings:null})}}})),{name:r.rpR})))},21420:function(e,t,n){n.d(t,{$:function(){return c}});var r=n(73193),i=n.n(r),a=n(76711),o=n.n(a),u=n(94976),l=n(26557),s=n(26407),d=n(20744),c=(0,l.Ue)()((0,s.mW)((0,s.tJ)((0,d.n)((function(e,t){return{workgroupResult:{data:{content:[]}},currentWorkgroup:{uid:"",nickname:"",avatar:"",description:"",orgUid:""},insertWorkgroup:function(t){e((function(e){e.workgroupResult.data.content.unshift(t)}))},updateWorkgroup:function(t){e((function(e){var n=e.workgroupResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Workgroup with uid ".concat(t.uid," not found."))}))},deleteWorkgroup:function(t){e((function(e){var n=e.workgroupResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Workgroup with uid ".concat(t.uid," not found."))}))},setWorkgroupResult:function(n){var r;(e({workgroupResult:n}),""===t().currentWorkgroup.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWorkgroup:n.data.content[0]}))},setCurrentWorkgroup:function(n){var r=t().workgroupResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var u=[].concat(o()(r.slice(0,a)),[n],o()(r.slice(a+1))),l=i()(i()({},t().workgroupResult),{},{data:{content:u}});e({workgroupResult:l,currentWorkgroup:n})}else console.warn("Workgroup with the specified uid not found."),e({currentWorkgroup:n})},deleteCurrentWorkgroup:function(n){var r=t().workgroupResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({workgroupResult:i()(i()({},t().workgroupResult),{},{data:{content:[].concat(o()(r.slice(0,a)),o()(r.slice(a+1)))}})}):console.warn("Workgroup not found in cache:",n),t().currentWorkgroup.uid===n&&e({currentWorkgroup:{uid:"",orgUid:""}})},deleteWorkgroupCache:function(){return e({},!0)}}})),{name:u.b6l})))}}]);