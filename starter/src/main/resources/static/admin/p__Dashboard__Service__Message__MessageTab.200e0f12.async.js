"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8166],{77519:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var s=a(31699),n=a(8247),r=a(55735),i=a(73193),o=a.n(i),u=a(84176),d=a.n(u),l=a(90819),c=a.n(l),g=a(89933),p=a.n(g),f=a(45332),m=a.n(f),x=a(86803),h=a(76750),v=a(40612),M=a(44521),w=a(11090),y=a(81947),b=a(30921),k=a(75365),j=a(44194);function S(e){return F.apply(this,arguments)}function F(){return(F=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/robot/message/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=a(31549),C=["current","pageSize"],A=function(){var e=(0,b.useIntl)(),t=(0,j.useRef)(),a=(0,h.Z)().translateString,s=(0,v.u)((function(e){return e.currentOrg})),n=(0,j.useState)(1),i=m()(n,2),u=i[0],l=i[1],g=(0,j.useState)(10),f=m()(g,2),F=f[0],A=f[1],E=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,I.jsx)(b.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:120,fixed:"left",render:function(e,t){var s;return(0,I.jsx)(I.Fragment,{children:a(null==t||null===(s=t.user)||void 0===s?void 0:s.nickname)})}},{title:(0,I.jsx)(b.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,fixed:"left",render:function(e,t){var s;return(0,I.jsx)(I.Fragment,{children:a(null==t||null===(s=t.robot)||void 0===s?void 0:s.nickname)})}},{title:(0,I.jsx)(b.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0},{title:(0,I.jsx)(b.FormattedMessage,{id:"answer",defaultMessage:"Answer"}),dataIndex:"answer",width:300,ellipsis:!0},{title:(0,I.jsx)(b.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:80,fixed:"right",render:function(t,a,s,n){return[(0,I.jsx)("a",{onClick:function(){q(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}],q=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==s?void 0:s.uid,t:r.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},R=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",u,F),t=localStorage.getItem(r.LA8),window.open((0,M.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams({orgUid:(null==s?void 0:s.uid)||"",pageNumber:String(u-1),pageSize:String(F),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,I.jsx)(y.Z,{columns:E,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=p()(c()().mark((function e(t,a,n){var r,i,u,g,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,n),r=t.current,i=t.pageSize,u=d()(t,C),l(r),A(i),g=o()({pageNumber:r-1,pageSize:i,orgUid:null==s?void 0:s.uid},u),e.next=7,S(g);case 7:return p=e.sent,console.log("getAllRobotMessages response:",g,p),200===p.code||x.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",toolBarRender:function(){return[(0,I.jsx)(k.ZP,{icon:(0,I.jsx)(w.Z,{}),type:"primary",onClick:R,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})},E=a(10154),q=a.n(E);function R(e){return U.apply(this,arguments)}function U(){return(U=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/leavemsg/query/org",{method:"GET",params:o()(o()({},t),{},{client:r.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=a(28977),B=a.n(z),N=a(88721),T=["current","pageSize"],Z=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,I.jsx)(b.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0},{title:(0,I.jsx)(b.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0},{title:(0,I.jsx)(b.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,I.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,I.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,I.jsx)(b.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,valueType:"select",valueEnum:q()(q()(q()(q()(q()(q()(q()(q()(q()({},r.d23,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),r.m7i,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),r.d3_,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),r.oLW,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),r.KBB,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),r.v3R,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),r.uke,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),r.fEl,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),r.K0y,{text:(0,I.jsx)(b.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,N.It)(t.status)}},{title:(0,I.jsx)(b.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,render:function(e,t,a,s){return B()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],L=function(){var e=(0,b.useIntl)(),t=(0,j.useRef)(),a=(0,j.useState)(1),s=m()(a,2),n=s[0],i=s[1],u=(0,j.useState)(10),l=m()(u,2),g=l[0],f=l[1],h=(0,v.u)((function(e){return e.currentOrg})),S=[].concat(Z);S.push({title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:80,fixed:"right",render:function(t,a,s,n){return[(0,I.jsx)("a",{onClick:function(){F(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}});var F=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==h?void 0:h.uid,t:r.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},C=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",n,g),t=localStorage.getItem(r.LA8),window.open((0,M.kG)()+"/api/v1/leavemsg/export?"+new URLSearchParams({orgUid:(null==h?void 0:h.uid)||"",pageNumber:String(n-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,I.jsx)(y.Z,{columns:S,actionRef:t,cardBordered:!0,request:function(){var e=p()(c()().mark((function e(t,a,s){var n,r,u,l,g;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.current,r=t.pageSize,u=d()(t,T),i(n),f(r),l=o()({pageNumber:n-1,pageSize:r,orgUid:null==h?void 0:h.uid},u),e.next=6,R(l);case 6:return g=e.sent,console.log("queryLeaveMsgsByOrg response:",g,l),200===g.code||x.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",toolBarRender:function(){return[(0,I.jsx)(k.ZP,{icon:(0,I.jsx)(w.Z,{}),type:"primary",onClick:C,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})},K=function(){var e=(0,b.useIntl)().formatMessage,t=[{key:"message",label:e({id:"message.tab.all"}),children:(0,I.jsx)(s.Z,{type:r.Nqz})},{key:"robotMessage",label:e({id:"message.tab.robot"}),children:(0,I.jsx)(A,{})},{key:"messageLeave",label:e({id:"message.tab.leave"}),children:(0,I.jsx)(L,{})}];return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(n.Z,{defaultActiveKey:"message",items:t})})}}}]);