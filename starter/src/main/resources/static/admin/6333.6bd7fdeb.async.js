"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6333],{56333:function(e,t,a){a.d(t,{Z:function(){return z}});var n=a(84176),r=a.n(n),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),f=a.n(u),p=a(45332),g=a.n(p),m=a(43388),h=a(4628);function M(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/upload/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/upload/delete",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=a(74171),w=a(58620),b=a(94976),S=a(11090),j=a(2484),T=a(54881),I=a(34512),C=a(27729),A=a(43275),D=a(69533),N=a(28508),Z=a(96596),U=a.n(Z),F=a(44194),R=a(31549),q=["current","pageSize"],z=function(e){var t=e.level,a=e.superUser,n=(0,h.useIntl)(),s=(0,F.useRef)(),i=((0,h.useNavigate)(),(0,F.useState)(1)),d=g()(i,2),u=d[0],p=d[1],x=(0,F.useState)(10),y=g()(x,2),Z=y[0],z=y[1],E=(0,k.u)((function(e){return e.currentOrg})),O=(0,F.useState)({}),P=g()(O,2),B=P[0],H=P[1],Y=(0,F.useState)([]),G=g()(Y,2),J=G[0],K=G[1],L=(0,F.useState)([]),Q=g()(L,2),W=Q[0],V=Q[1],X=(0,F.useState)(0),$=g()(X,2),_=$[0],ee=$[1],te=C.Z.useModal(),ae=g()(te,2),ne=(ae[0],ae[1]),re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(h.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",fixed:"left",tooltip:n.formatMessage({id:"upload.nickname.tooltip",defaultMessage:"上传者的昵称"}),render:function(e,t){return(0,R.jsx)(R.Fragment,{children:(a=null==t?void 0:t.user,n=JSON.parse(a),null==n?void 0:n.nickname)});var a,n}},{title:(0,R.jsx)(h.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",copyable:!0,search:!0,tooltip:n.formatMessage({id:"upload.fileName.tooltip",defaultMessage:"上传的文件名称"})},{title:(0,R.jsx)(h.FormattedMessage,{id:"fileType",defaultMessage:"fileType"}),dataIndex:"fileType",hideInSearch:!0,tooltip:n.formatMessage({id:"upload.fileType.tooltip",defaultMessage:"文件的MIME类型"})},{title:(0,R.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",tooltip:n.formatMessage({id:"upload.status.tooltip",defaultMessage:"文件处理状态"}),hideInSearch:!0},{title:(0,R.jsx)(h.FormattedMessage,{id:"channel",defaultMessage:"Channel"}),dataIndex:"channel",tooltip:n.formatMessage({id:"upload.channel.tooltip",defaultMessage:"上传客户端信息"}),hideInSearch:!0},{title:(0,R.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",width:180,sorter:!0,tooltip:n.formatMessage({id:"upload.updatedAt.tooltip",defaultMessage:"最近更新时间"}),hideInSearch:!0,render:function(e,t,a,n){return U()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],se=function(){var e=f()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,v(t);case 3:a=e.sent,console.log("delete response:",a),200===a.code?(null==s||s.current.reload(),m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(n.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=[].concat(re,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(e,t,a,r){return[(0,R.jsx)("a",{onClick:function(){var e=null==t?void 0:t.fileUrl,a=encodeURIComponent(e);window.open(decodeURIComponent(a))},children:n.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,R.jsx)(A.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.fileName,"】？"),onConfirm:function(){return se(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,R.jsx)(D.ZP,{size:"small",type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),ie=function(){var e=f()(c()().mark((function e(){var t,a,r,o,i,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==W.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,r=0,o=l()(W),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return d=i.value,e.prev=11,e.next=14,v(d);case 14:200===e.sent.code?a++:r++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),r++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===r?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:r})),K([]),V([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=f()(c()().mark((function e(a,n,r){var s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,n,r),s=localStorage.getItem(b.LA8),i=o()({orgUid:t===b.Hxq?"":(null==E?void 0:E.uid)||"",accessToken:s||"",exportType:a},B),"current"===a?(i.pageNumber=String(u-1),i.pageSize=String(Z)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==n&&void 0!==r&&(i.pageNumber=String(n),i.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/upload/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),de=function(e){for(var t=[],a=1e3,n=Math.ceil(e/a),r=function(){var n=s,r=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return le("range",n,a)}})},s=0;s<n;s++)r();return t},ce={selectedRowKeys:J,onChange:function(e,t){K(e),V(t)}};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(I.Z,{columns:oe,actionRef:s,cardBordered:!0,rowSelection:ce,scroll:{x:1800},request:function(){var e=f()(c()().mark((function e(n,s,i){var l,d,u,f,g,h,x,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",n,s,i),l=n.current,d=n.pageSize,u=r()(n,q),p(l),z(d),H(u),f=void 0,g=void 0,s&&Object.keys(s).length>0&&(h=Object.keys(s)[0],f=h,g="ascend"===s[h]?"ascend":"descend"),x=o()(o()({pageNumber:l-1,pageSize:d,categoryUid:"",kbUid:"",orgUid:a||t===b.Hxq?"":null==E?void 0:E.uid,superUser:a},u),{},{sortBy:f,sortDirection:g}),e.next=11,M(x);case 11:return v=e.sent,console.log("getAllUploads response:",v,x),200===v.code?ee(null==v?void 0:v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:null==v?void 0:v.data.content,success:!0,total:null==v?void 0:v.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),z(t)}},dateFormatter:"string",headerTitle:"文档",toolBarRender:function(){return a?[]:[(0,R.jsx)(N.Z,{menu:{items:(e=[{key:"export-current",label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return le("current")}}],_>0&&(_<=1e3?e.push({key:"export-all",label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_,"条)"),onClick:function(){return le("all")}}):e.push({key:"export-range",label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_,"条)"),children:de(_)})),e)},placement:"bottomRight",children:(0,R.jsxs)(D.ZP,{type:"primary",icon:(0,R.jsx)(S.Z,{}),children:[n.formatMessage({id:"export",defaultMessage:"导出"}),(0,R.jsx)(j.Z,{})]})},"exportDropdown"),J.length>0&&(0,R.jsx)(A.Z,{title:n.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(n.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确认删除"})," ").concat(J.length," ").concat(n.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:ie,okText:n.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,R.jsxs)(D.ZP,{danger:!0,icon:(0,R.jsx)(T.Z,{}),children:[n.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})," (",J.length,")"]})},"batchDelete")];var e}}),ne]})}}}]);