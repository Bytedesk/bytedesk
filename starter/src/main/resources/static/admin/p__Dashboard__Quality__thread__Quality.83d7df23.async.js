"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5553],{30022:function(e,t,r){r.d(t,{EP:function(){return l},md:function(){return m},t7:function(){return h}});var n=r(90819),a=r.n(n),i=r(73193),o=r.n(i),s=r(89933),u=r.n(s),c=r(94976),d=r(4628);function l(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/check/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/check/create",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/check/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},91736:function(e,t,r){r.d(t,{LX:function(){return m},T:function(){return l},ay:function(){return y},eY:function(){return h}});var n=r(90819),a=r.n(n),i=r(73193),o=r.n(i),s=r(89933),u=r.n(s),c=r(94976),d=r(4628);function l(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/create",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/update",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/quality/plan/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},16265:function(e,t,r){r.d(t,{C8:function(){return m},E1:function(){return y},WR:function(){return h},nV:function(){return l},wL:function(){return x}});var n=r(90819),a=r.n(n),i=r(73193),o=r.n(i),s=r(89933),u=r.n(s),c=r(94976),d=r(4628);function l(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/queue/member/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/queue/member/intention",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/queue/member/emotion",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/queue/member/summary",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/queue/member/inspection",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},94965:function(e,t,r){r.r(t),r.d(t,{default:function(){return G}});var n=r(73193),a=r.n(n),i=r(84176),o=r.n(i),s=r(90819),u=r.n(s),c=r(89933),d=r.n(c),l=r(45332),f=r.n(l),m=r(44194),p=r(90581),h=r(69533),g=r(80556),y=r(34512),v=r(4628),x=r(16265),M=r(89957),q=r.n(M),b=r(10154),w=r.n(b),k=r(1282),j=r(69174),S=r(82878),C=r(69705),Z=r(30857),F=r(30310),N=r(68177),P=r(10390),I=r(33732),T=r(90297),A=r(91736),O=r(30022),E=r(74171),U=r(94976),V=r(43388),z=r(67242),_=r(31549),J=k.Z.TextArea,X=j.Z.Option,L=S.Z.Title,Y=S.Z.Text,B="quality_plan_selection",W=function(e){var t,r,n,i=e.visible,o=e.onClose,s=e.queueMember,c=e.onSubmit,l=(0,v.useIntl)(),g=C.Z.useForm(),y=f()(g,1)[0],M=(0,m.useState)([]),b=f()(M,2),k=b[0],S=b[1],W=(0,m.useState)(null),D=f()(W,2),H=D[0],R=D[1],G=(0,m.useState)(!1),Q=f()(G,2),K=Q[0],$=Q[1],ee=(0,m.useState)(!1),te=f()(ee,2),re=te[0],ne=te[1],ae=(0,m.useState)({}),ie=f()(ae,2),oe=ie[0],se=ie[1],ue=(0,E.u)((function(e){return e.currentOrg})),ce=function(e){try{localStorage.setItem(B,e)}catch(e){console.error("保存质检方案选择到本地存储失败:",e)}},de=function(){try{return localStorage.getItem(B)}catch(e){return console.error("从本地存储获取质检方案选择失败:",e),null}},le=function(){var e=d()(u()().mark((function e(){var t,r,n,a,i,o,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,A.T)({pageNumber:0,pageSize:100,enabled:!0,orgUid:null==ue?void 0:ue.uid});case 3:200===(t=e.sent).code&&null!=t&&t.data&&(r=(null==t?void 0:t.data.content)||[],S(r),r.length>0&&((n=de())&&r.find((function(e){return e.uid===n}))?a=n:(a=r[0].uid,ce(a)),(i=r.find((function(e){return e.uid===a})))&&(R(i),y.setFieldsValue({qualityPlanUid:a}),s={},null===(o=i.indicators)||void 0===o||o.forEach((function(e){s[e.indicatorName]=0,y.setFieldsValue(w()({},"indicator_".concat(e.indicatorName),0))})),se(s)))),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("获取质检方案失败:",e.t0),V.yw.error(l.formatMessage({id:"quality.plan.fetch.error",defaultMessage:"获取质检方案失败"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),fe=function(e){return e>=90?{level:"excellent",color:"green"}:e>=80?{level:"good",color:"blue"}:e>=70?{level:"average",color:"orange"}:{level:"poor",color:"red"}},me=function(){var e=d()(u()().mark((function e(){var t,r,n,i,d,f,m,p,h,g,v,x;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.validateFields();case 3:if(n=e.sent,H){e.next=7;break}return V.yw.error(l.formatMessage({id:"quality.plan.select.required",defaultMessage:"请选择质检方案"})),e.abrupt("return");case 7:return $(!0),i=0,d=0,f=0,null===(t=H.indicators)||void 0===t||t.forEach((function(e){var t=n["indicator_".concat(e.indicatorName)]||0;e.deduction?(f+=t,i-=t):(d+=t,i+=t)})),i=Math.max(0,i),m=fe(i),p=m.level,h=m.color,g=(null===(r=H.indicators)||void 0===r?void 0:r.map((function(e){return a()(a()({},e),{},{indicatorScore:n["indicator_".concat(e.indicatorName)]||0})})))||[],v={indicators:g,comment:n.comment,qualityPlanUid:H.uid,queueMemberUid:null==s?void 0:s.uid,orgUid:null==ue?void 0:ue.uid},e.next=18,(0,O.md)(v);case 18:if(x=e.sent,console.log("qualityCheckData response",null==x?void 0:x.data,v),200!==x.code){e.next=29;break}return V.yw.success(l.formatMessage({id:"quality.check.create.success",defaultMessage:"质检结果提交成功"})),y.resetFields(),R(null),o(),e.next=27,c(a()(a()({},n),{},{totalScore:i,qualityLevel:p,qualityLevelColor:h,bonusScore:d,deductionScore:f}));case 27:e.next=30;break;case 29:V.yw.error(x.message||l.formatMessage({id:"quality.check.create.error",defaultMessage:"提交失败"}));case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(0),console.error("表单验证失败:",e.t0),V.yw.error(l.formatMessage({id:"quality.check.create.error",defaultMessage:"提交失败，请重试"}));case 36:return e.prev=36,$(!1),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[0,32,36,39]])})));return function(){return e.apply(this,arguments)}}(),pe=function(e){if(!e)return null;if("object"===q()(e))return e;if("string"!=typeof e)return null;var t=e.replace(/```json/gi,"").replace(/```/g,"").trim();try{return JSON.parse(t)}catch(e){return null}},he=function(){var e=d()(u()().mark((function e(){var t,r,n,i,o,c,d,f;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.uid||null!=s&&null!==(t=s.thread)&&void 0!==t&&t.uid){e.next=3;break}return V.yw.warning(l.formatMessage({id:"quality.chat.history.no.thread",defaultMessage:"会话信息不存在"})),e.abrupt("return");case 3:if(null!=H&&H.uid){e.next=6;break}return V.yw.warning(l.formatMessage({id:"quality.plan.select.required",defaultMessage:"请选择质检方案"})),e.abrupt("return");case 6:if(null!=ue&&ue.uid){e.next=9;break}return V.yw.error(l.formatMessage({id:"org.missing",defaultMessage:"组织信息缺失"})),e.abrupt("return");case 9:return ne(!0),e.prev=10,z.Z.debug("Starting autoQueueMemberInspection"),e.next=14,(0,x.wL)({uid:null==s?void 0:s.uid,threadUid:null==s||null===(r=s.thread)||void 0===r?void 0:r.uid,orgUid:null==ue?void 0:ue.uid,qualityPlanUid:H.uid});case 14:if(i=e.sent,z.Z.debug("autoQueueMemberInspection:",i),200===(null==i?void 0:i.code)){e.next=19;break}return V.yw.error((null==i?void 0:i.message)||l.formatMessage({id:"quality.ai.inspect.failed",defaultMessage:"智能质检失败"})),e.abrupt("return");case 19:if(o=pe(null==i?void 0:i.data),c=null==o?void 0:o.indicators,Array.isArray(c)){e.next=24;break}return V.yw.error(l.formatMessage({id:"quality.ai.inspect.invalid",defaultMessage:"智能质检结果解析失败"})),e.abrupt("return");case 24:d=a()({},oe),f={},null===(n=H.indicators)||void 0===n||n.forEach((function(e){var t,r=c.find((function(t){return(null==t?void 0:t.indicatorName)===e.indicatorName})),n=e.indicatorScore||100,a=Number(null!==(t=null==r?void 0:r.score)&&void 0!==t?t:0);Number.isNaN(a)&&(a=0),a=Math.max(0,Math.min(n,Math.round(a))),d[e.indicatorName]=a,f["indicator_".concat(e.indicatorName)]=a})),!y.getFieldValue("comment")&&null!=o&&o.summary&&(f.comment=o.summary),y.setFieldsValue(f),se(d),V.yw.success(l.formatMessage({id:"quality.ai.inspect.success",defaultMessage:"智能质检完成，已回填评分"})),e.next=38;break;case 34:e.prev=34,e.t0=e.catch(10),console.error("智能质检失败:",e.t0),V.yw.error(l.formatMessage({id:"quality.ai.inspect.failed",defaultMessage:"智能质检失败"}));case 38:return e.prev=38,ne(!1),e.finish(38);case 41:case"end":return e.stop()}}),e,null,[[10,34,38,41]])})));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=y.getFieldValue("qualityPlanUid"),t=k.find((function(t){return t.uid===e}));if(y.resetFields(),e&&(y.setFieldsValue({qualityPlanUid:e}),null!=t&&t.indicators)){var r={};t.indicators.forEach((function(e){r[e.indicatorName]=0,y.setFieldsValue(w()({},"indicator_".concat(e.indicatorName),0))})),se(r)}R(null),o()},ye=function(e,t){se((function(r){return a()(a()({},r),{},w()({},e,t))})),y.setFieldsValue(w()({},"indicator_".concat(e),t))};return(0,m.useEffect)((function(){i&&(le(),y.setFieldsValue({comment:""}))}),[i,y]),(0,_.jsx)(Z.Z,{title:l.formatMessage({id:"quality.scoring.review",defaultMessage:"重新质检"}),width:700,open:i,onClose:ge,extra:(0,_.jsxs)(F.Z,{children:[(0,_.jsx)(h.ZP,{onClick:he,loading:re,disabled:!(null!=H&&H.uid&&null!=s&&null!==(t=s.thread)&&void 0!==t&&t.uid),children:l.formatMessage({id:"quality.ai.inspect",defaultMessage:"智能质检"})}),(0,_.jsx)(h.ZP,{onClick:ge,children:l.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,_.jsx)(h.ZP,{type:"primary",onClick:me,loading:K,children:l.formatMessage({id:"submit",defaultMessage:"提交"})})]}),children:s&&(0,_.jsxs)("div",{children:[(0,_.jsx)(N.Z,{title:l.formatMessage({id:"quality.chat.history",defaultMessage:"聊天记录"}),style:{marginBottom:24},children:(0,_.jsx)(h.ZP,{type:"primary",icon:(0,_.jsx)(T.Z,{}),onClick:function(){var e,t,r;if(null!=s&&null!==(e=s.thread)&&void 0!==e&&e.uid){var n={chatConfig:{org:null===(t=s.thread)||void 0===t?void 0:t.orgUid,t:U.CCt,sid:s.thread.uid}};null===(r=window.bytedesk)||void 0===r||r.showChat(n)}else V.yw.warning(l.formatMessage({id:"quality.chat.history.no.thread",defaultMessage:"会话信息不存在"}))},children:l.formatMessage({id:"quality.view.chat.history",defaultMessage:"查看聊天记录"})})}),(0,_.jsxs)(C.Z,{form:y,layout:"vertical",children:[(0,_.jsx)(C.Z.Item,{label:l.formatMessage({id:"quality.plan.select",defaultMessage:"选择质检方案"}),name:"qualityPlanUid",rules:[{required:!0,message:l.formatMessage({id:"quality.plan.select.required",defaultMessage:"请选择质检方案"})}],children:(0,_.jsx)(j.Z,{placeholder:l.formatMessage({id:"quality.plan.select.placeholder",defaultMessage:"请选择质检方案"}),onChange:function(e){var t=k.find((function(t){return t.uid===e}));R(t||null),e&&ce(e);var r=y.getFieldsValue(),n=a()({},r);if(Object.keys(n).forEach((function(e){e.startsWith("indicator_")&&delete n[e]})),y.setFieldsValue(n),se({}),null!=t&&t.indicators){var i={};t.indicators.forEach((function(e){i[e.indicatorName]=0,y.setFieldsValue(w()({},"indicator_".concat(e.indicatorName),0))})),se(i)}},showSearch:!0,filterOption:function(e,t){return((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase())},labelInValue:!1,optionLabelProp:"label",children:k.map((function(e){var t;return(0,_.jsx)(X,{value:e.uid,label:e.name,children:(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{style:{fontWeight:"bold"},children:e.name}),(0,_.jsxs)("div",{style:{fontSize:"12px",color:"#999"},children:[e.description||l.formatMessage({id:"quality.plan.no.description",defaultMessage:"暂无描述"})," (",(null===(t=e.indicators)||void 0===t?void 0:t.length)||0," ",l.formatMessage({id:"quality.plan.indicators.count",defaultMessage:"个指标"}),")"]})]})},e.uid)}))})}),H&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(P.Z,{children:(0,_.jsx)(L,{level:4,children:l.formatMessage({id:"quality.indicators.scoring",defaultMessage:"质检指标评分"})})}),null===(r=H.indicators)||void 0===r?void 0:r.map((function(e,t){return(0,_.jsx)(C.Z.Item,{label:(0,_.jsxs)(F.Z,{children:[(0,_.jsx)("span",{children:e.indicatorName}),e.mandatory&&(0,_.jsx)(p.Z,{color:"red",children:l.formatMessage({id:"quality.indicator.mandatory",defaultMessage:"必检"})}),e.deduction?(0,_.jsx)(p.Z,{color:"red",children:l.formatMessage({id:"quality.indicator.deduction",defaultMessage:"减分项"})}):(0,_.jsx)(p.Z,{color:"green",children:l.formatMessage({id:"quality.indicator.bonus",defaultMessage:"加分项"})}),e.indicatorScore&&(0,_.jsxs)(Y,{type:"secondary",children:["(",l.formatMessage({id:"quality.indicator.max.score",defaultMessage:"满分"}),": ",e.indicatorScore,"分)"]}),(0,_.jsx)(p.Z,{color:e.deduction?"red":"green",style:{marginLeft:"auto"},children:e.deduction?"".concat(l.formatMessage({id:"quality.indicator.current.deduction",defaultMessage:"当前减分"}),": ").concat(oe[e.indicatorName]||0,"分"):"".concat(l.formatMessage({id:"quality.indicator.current.score",defaultMessage:"当前评分"}),": ").concat(oe[e.indicatorName]||0,"分")})]}),name:"indicator_".concat(e.indicatorName),rules:[{required:e.mandatory,message:l.formatMessage({id:"quality.indicator.score.required",defaultMessage:"请评分"})},{validator:function(t,r){return!e.mandatory||null!=r&&""!==r?r<0||r>(e.indicatorScore||100)?Promise.reject(new Error(l.formatMessage({id:"quality.indicator.score.range.error",defaultMessage:"评分范围应为 0-".concat(e.indicatorScore||100," 分")}))):Promise.resolve():Promise.reject(new Error(l.formatMessage({id:"quality.indicator.score.required",defaultMessage:"请评分"})))}}],extra:e.description&&(0,_.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:e.description}),children:(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{style:{marginBottom:8},children:(0,_.jsx)(I.Z,{min:0,max:e.indicatorScore||100,step:1,value:oe[e.indicatorName]||0,onChange:function(t){return ye(e.indicatorName,t)},marks:w()(w()(w()(w()({0:"0"},Math.floor(.25*(e.indicatorScore||100)),"".concat(Math.floor(.25*(e.indicatorScore||100)))),Math.floor(.5*(e.indicatorScore||100)),"".concat(Math.floor(.5*(e.indicatorScore||100)))),Math.floor(.75*(e.indicatorScore||100)),"".concat(Math.floor(.75*(e.indicatorScore||100)))),e.indicatorScore||100,"".concat(e.indicatorScore||100)),tooltip:{formatter:function(t){return e.deduction?"".concat(t,"分(减分)"):"".concat(t,"分")}},keyboard:!1,onChangeComplete:function(t){return ye(e.indicatorName,t)}})}),(0,_.jsx)("div",{style:{textAlign:"center",fontSize:"12px",color:"#666",marginTop:16},children:e.deduction?"".concat(l.formatMessage({id:"quality.indicator.deduction.range",defaultMessage:"减分范围"}),": 0 - ").concat(e.indicatorScore||100," ").concat(l.formatMessage({id:"quality.indicator.score.unit",defaultMessage:"分"})," "):"".concat(l.formatMessage({id:"quality.indicator.score.range",defaultMessage:"评分范围"}),": 0 - ").concat(e.indicatorScore||100," ").concat(l.formatMessage({id:"quality.indicator.score.unit",defaultMessage:"分"}))})]})},t)}))]}),H&&(0,_.jsx)(N.Z,{title:l.formatMessage({id:"quality.total.score.summary",defaultMessage:"评分统计"}),style:{marginBottom:24},children:(0,_.jsx)("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"},children:(n=function(){if(null==H||!H.indicators)return{total:0,bonus:0,deduction:0};var e=0,t=0,r=0;return H.indicators.forEach((function(n){var a=y.getFieldValue("indicator_".concat(n.indicatorName)),i=void 0!==a?a:oe[n.indicatorName]||0;n.deduction?(r+=i,e-=i):(t+=i,e+=i)})),{total:e=Math.max(0,e),bonus:t,deduction:r}}(),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{style:{textAlign:"center"},children:[(0,_.jsx)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:n.total}),(0,_.jsx)("div",{style:{fontSize:"14px",color:"#666"},children:l.formatMessage({id:"quality.total.score",defaultMessage:"总分"})})]}),(0,_.jsxs)("div",{style:{textAlign:"center"},children:[(0,_.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:["+",n.bonus]}),(0,_.jsx)("div",{style:{fontSize:"14px",color:"#666"},children:l.formatMessage({id:"quality.bonus.score",defaultMessage:"正面评分"})})]}),(0,_.jsxs)("div",{style:{textAlign:"center"},children:[(0,_.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ff4d4f"},children:["-",n.deduction]}),(0,_.jsx)("div",{style:{fontSize:"14px",color:"#666"},children:l.formatMessage({id:"quality.deduction.score",defaultMessage:"负面评分"})})]})]}))})}),(0,_.jsx)(C.Z.Item,{label:l.formatMessage({id:"quality.comments",defaultMessage:"质检评语"}),name:"comment",rules:[{required:!0,message:l.formatMessage({id:"quality.comments.required",defaultMessage:"请输入质检评语"})}],children:(0,_.jsx)(J,{rows:4,placeholder:l.formatMessage({id:"quality.comments.placeholder",defaultMessage:"请输入质检评语..."})})})]})]})})},D=r(96596),H=r.n(D),R=["current","pageSize"],G=function(){var e=(0,v.useIntl)(),t=(0,m.useRef)(),r=(0,m.useState)(!1),n=f()(r,2),i=n[0],s=n[1],c=(0,m.useState)(null),l=f()(c,2),M=l[0],q=l[1],b=(0,E.u)((function(e){return e.currentOrg})),w=function(){var e=d()(u()().mark((function e(r){var n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{z.Z.debug("质检结果提交成功:",r),s(!1),null===(n=t.current)||void 0===n||n.reload()}catch(e){console.error("处理质检结果失败:",e)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,_.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:["thread","uid"],key:"threadUid",copyable:!0,fixed:"left",ellipsis:!0,hideInSearch:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.nickname.tooltip"})},{title:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.agent"}),dataIndex:["thread","agentProtobuf","nickname"],key:"agentNickname",ellipsis:!0,hideInSearch:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.agent.tooltip"}),render:function(e,t){var r,n,a=null===(r=t.thread)||void 0===r||null===(r=r.robotProtobuf)||void 0===r?void 0:r.nickname,i=null===(n=t.thread)||void 0===n||null===(n=n.agentProtobuf)||void 0===n?void 0:n.nickname;return a&&i?"".concat(a," / ").concat(i):a||(i||"-")}},{title:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.nickname"}),dataIndex:["thread","user","nickname"],key:"visitorNickname",ellipsis:!0,search:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.nickname.tooltip"}),render:function(e,t){var r;return(null===(r=t.thread)||void 0===r||null===(r=r.user)||void 0===r?void 0:r.nickname)||"-"}},{title:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.qualityChecked"}),dataIndex:"qualityChecked",key:"qualityChecked",hideInSearch:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.qualityChecked.tooltip"}),valueEnum:{true:{text:"已质检",status:"Success"},false:{text:"待质检",status:"Processing"}},render:function(e,t){return(0,_.jsx)(p.Z,{color:t.qualityChecked?"green":"blue",children:t.qualityChecked?"已质检":"待质检"})}},{title:(0,_.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.tooltip.createdAt"}),render:function(e,t,r,n){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,_.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,_.jsx)(v.FormattedMessage,{id:"queue.member.tooltip.updatedAt"}),render:function(e,t,r,n){return H()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:e.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,r,n,a){return[(0,_.jsx)("a",{onClick:function(){!function(e){var t,r,n;z.Z.debug("handleShowChatHistory",e);var a={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:U.CCt,sid:null==e||null===(r=e.thread)||void 0===r?void 0:r.uid}};null===(n=window.bytedesk)||void 0===n||n.showChat(a)}(r)},children:e.formatMessage({id:"view",defaultMessage:"查看"})},"view"),(0,_.jsx)("a",{onClick:function(){!function(e){q(e),s(!0)}(r)},children:e.formatMessage({id:"quality.scoring.review",defaultMessage:"质检"})},"quality")]}}],j=function(){var t=d()(u()().mark((function t(r,n,i){var s,c,d,l,f,m,p,h;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return z.Z.debug("request:",r,n,i),V.yw.loading(e.formatMessage({id:"quality.scoring.loading",defaultMessage:"加载中..."})),s=r.current,c=r.pageSize,d=o()(r,R),l=void 0,f=void 0,n&&Object.keys(n).length>0&&(m=Object.keys(n)[0],l=m,f="ascend"===n[m]?"ascend":"descend"),p=a()(a()({pageNumber:s-1,pageSize:c,qualityChecked:!1},d),{},{sortBy:l,sortDirection:f,orgUid:null==b?void 0:b.uid}),t.prev=7,t.next=10,(0,x.nV)(p);case 10:if(h=t.sent,z.Z.debug("queryQueueMembersByOrg response:",null==h?void 0:h.data,p),V.yw.destroy(),200!==h.code||null==h||!h.data){t.next=17;break}return t.abrupt("return",{data:(null==h?void 0:h.data.content)||[],success:!0,total:(null==h?void 0:h.data.totalElements)||0});case 17:return V.yw.error(h.message||e.formatMessage({id:"quality.scoring.fetch.error",defaultMessage:"获取数据失败"})),t.abrupt("return",{data:[],success:!1,total:0});case 19:t.next=27;break;case 21:return t.prev=21,t.t0=t.catch(7),V.yw.destroy(),V.yw.error(e.formatMessage({id:"quality.scoring.fetch.error",defaultMessage:"获取数据失败"})),console.error("Fetch scoring records error:",t.t0),t.abrupt("return",{data:[],success:!1,total:0});case 27:case"end":return t.stop()}}),t,null,[[7,21]])})));return function(e,r,n){return t.apply(this,arguments)}}();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(y.Z,{columns:k,actionRef:t,cardBordered:!0,request:j,scroll:{x:1200},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10},dateFormatter:"string",headerTitle:e.formatMessage({id:"quality.scoring.management",defaultMessage:"会话质检评分"}),toolBarRender:function(){return(r=[]).push((0,_.jsx)(h.ZP,{icon:(0,_.jsx)(g.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()},children:e.formatMessage({id:"refresh",defaultMessage:"刷新"})},"refresh")),r.push((0,_.jsx)(h.ZP,{type:"primary",children:e.formatMessage({id:"export",defaultMessage:"导出"})},"export")),r;var r}}),(0,_.jsx)(W,{visible:i,onClose:function(){return s(!1)},queueMember:M,onSubmit:w})]})}}}]);