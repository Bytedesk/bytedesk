"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7484],{82863:function(e,n,r){r.d(n,{Jr:function(){return m},LF:function(){return d},Oh:function(){return x},WS:function(){return v}});var t=r(90819),o=r.n(t),i=r(73193),a=r.n(i),s=r(89933),l=r.n(s),u=r(55735),c=r(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return h.apply(this,arguments)}function h(){return(h=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36605:function(e,n,r){r.d(n,{HH:function(){return x},T:function(){return m},fx:function(){return v},mK:function(){return d}});var t=r(90819),o=r.n(t),i=r(73193),a=r.n(i),s=r(89933),l=r.n(s),u=r(55735),c=r(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/query/org",{method:"GET",params:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/create",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/update",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return h.apply(this,arguments)}function h(){return(h=l()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/delete",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92053:function(e,n,r){r.d(n,{V:function(){return u},c:function(){return d}});var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),s=r(55735),l=r(30921);function u(){return c.apply(this,arguments)}function c(){return(c=a()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:s.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=a()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:s.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},66247:function(e,n,r){var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),s=r(45332),l=r.n(s),u=r(44194),c=r(36605),d=r(86803),f=r(23864),m=r(76750),p=r(30921),v=r(53530),g=r(27487),x=r(75365),h=r(9452),y=r(84288),P=r(40612),w=r(55735),k=r(15722),L=r(11490),j=r(17520),b=r(19317),M=r(31549);n.Z=function(e){var n,r,t=e.level,i=(0,f.Z)().isDarkMode,s=(0,p.useIntl)(),Z=(0,m.Z)(),S=Z.translateString,C=Z.translateStringTranct,R=(0,P.u)((function(e){return e.currentOrg})),F=(0,u.useState)(!1),E=l()(F,2),T=E[0],q=E[1],O=(0,u.useState)(!1),U=l()(O,2),I=U[0],K=(U[1],(0,L.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}}))),V=K.llmproviderResult,A=K.currentLlmProvider,D=K.setLlmProviderResult,H=K.insertLlmProvider,z=K.setCurrentLlmProvider,W=K.upgradeLlmProvider,N=K.deleteCurrentLlmProvider,Y=(0,b.$)((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),J=Y.llmproviderResultPlatform,_=Y.currentLlmProviderPlatform,B=Y.setLlmProviderResultPlatform,G=Y.insertLlmProviderPlatform,Q=Y.setCurrentLlmProviderPlatform,$=Y.upgradeLlmProviderPlatform,X=Y.deleteCurrentLlmProviderPlatform,ee=(0,u.useState)(t===w.Hxq),ne=l()(ee,1)[0],re=ne?_:A,te=v.Z.useModal(),oe=l()(te,2),ie=oe[0],ae=oe[1],se=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),d.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,c.HH)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(d.yw.destroy(),d.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ne?X(n.uid):N(n.uid)):(d.yw.destroy(),d.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=a()(o()().mark((function e(){var n,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),n={pageNumber:0,pageSize:50,status:t===w.Hxq?"":w.KY,orgUid:t===w.Hxq?"":null==R?void 0:R.uid,level:t},e.next=4,(0,c.mK)(n);case 4:r=e.sent,console.log("queryLlmProvidersByOrg: ",r),200===r.code?ne?B(r):D(r):d.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){le()}),[]);var ue=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",n),d.yw.loading(s.formatMessage({id:"creating"})),e.next=4,(0,c.T)(n);case 4:r=e.sent,console.log("createLlmProvider:",r),200===r.code?(d.yw.destroy(),d.yw.success(s.formatMessage({id:"create.success",defaultMessage:"create success"})),ne?G(r.data):H(r.data),q(!1)):(d.yw.destroy(),d.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ce=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(s.formatMessage({id:"updating"})),e.next=3,(0,c.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(d.yw.destroy(),d.yw.success(s.formatMessage({id:"update.success",defaultMessage:"update success"})),ne?$(r.data):W(r.data),q(!1)):(d.yw.destroy(),d.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:{margin:10},children:(0,M.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[!1,(0,M.jsx)(x.ZP,{onClick:function(){return function(e){ie.confirm({title:s.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(k.Z,{}),content:"".concat(s.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(S(e.nickname),"】？"),onOk:function(){se(e)},onCancel:function(){},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}(re)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==re?void 0:re.uid),children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,M.jsx)(h.Z,{itemLayout:"horizontal",dataSource:ne?(null==J||null===(n=J.data)||void 0===n?void 0:n.content)||[]:(null==V||null===(r=V.data)||void 0===r?void 0:r.content)||[],renderItem:function(e,n){return(0,M.jsx)(h.Z.Item,{style:(null==re?void 0:re.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return n=e,void(ne?Q(n):z(n));var n},children:(0,M.jsx)(h.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,M.jsx)(y.C,{src:e.logo}),title:(0,M.jsx)(M.Fragment,{children:C(null==e?void 0:e.nickname)}),description:(null==e?void 0:e.status)===w.KY?"上线发布":"未上线"})})}}),T&&(0,M.jsx)(j.Z,{open:T,isEdit:I,level:t,llmProvider:re,onCancel:function(){q(!1)},onSubmit:function(e){I?ce(e):ue(e)}}),ae]})}},23894:function(e,n,r){r.d(n,{Z:function(){return ie}});var t=r(76711),o=r.n(t),i=r(45332),a=r.n(i),s=r(44194),l=r(8247),u=r(73193),c=r.n(u),d=r(86222),f=r.n(d),m=r(90819),p=r.n(m),v=r(89933),g=r.n(v),x=r(86803),h=r(82863),y=r(40612),P=r(55735),w=r(29266),k=r(53530),L=r(84288),j=r(75365),b=r(39042),M=r(38775),Z=r(3849),S=r(9452),C=r(32327),R=r(69169),F=r(4499),E=r(73442),T=r(31549),q=function(e){var n=e.isEdit,r=e.llmmodel,t=e.provider,o=e.open,i=e.level,l=e.onClose,u=e.onSubmit,c=R.A.useForm(),d=a()(c,1)[0],f=(0,y.u)((function(e){return e.currentOrg}));(0,s.useEffect)((function(){n&&r&&d?d.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname}):(console.log("form resetFields"),d.resetFields())}),[r]);return(0,s.useEffect)((function(){}),[r]),(0,T.jsx)("div",{children:(0,T.jsx)(E.Z,{title:n?"编辑模型":"新建模型",width:600,onClose:l,open:o,extra:(0,T.jsxs)(Z.Z,{children:[(0,T.jsx)(j.ZP,{onClick:l,children:"取消"}),(0,T.jsx)(j.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("Form values:",e);var o={uid:n?null==r?void 0:r.uid:"",name:e.name,nickname:e.nickname,providerUid:null==t?void 0:t.uid,level:i,orgUid:null==f?void 0:f.uid};console.log("llmmodelObject:",o),u(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,T.jsxs)(R.A,{form:d,name:"model",submitter:!1,children:[(0,T.jsx)(F.Z,{label:"名称(用于接口调用)",name:"name"}),(0,T.jsx)(F.Z,{label:"昵称(便于记忆)",name:"nickname"})]})})})},O=r(15722),U=r(11090),I=r(10162),K=r(30617),V=r(80556),A=r(30921),D=r(36605),H=r(23864),z=r(76750),W=r(11490),N=r(17520),Y=r(80601),J=r(7875),_=C.Z.Text,B=function(e){var n=e.provider,r=e.open,t=(e.level,e.onClose),o=e.onSubmit,i=e.existingModels,l=void 0===i?[]:i,u=((0,A.useIntl)(),(0,s.useState)(!1)),c=a()(u,2),d=c[0],f=c[1],m=(0,s.useState)([]),v=a()(m,2),y=v[0],k=v[1],L=(0,s.useState)([]),b=a()(L,2),M=b[0],S=b[1],C=function(e){return l.some((function(n){return n.name===e.name}))},R=function(){var e=g()(p()().mark((function e(){var r,t,o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,r={pageNumber:0,pageSize:100,level:P.Hxq,providerName:n.name},e.next=5,(0,h.LF)(r);case 5:t=e.sent,console.log("获取平台模型列表:",t),200===t.code?(o=t.data.content||[],k(o),i=o.filter((function(e){return C(e)})).map((function(e){return e.uid})),S(i)):x.yw.error(t.message||"获取模型列表失败"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),x.yw.error("获取模型列表异常");case 14:return e.prev=14,f(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){r&&R()}),[r]);var F=[{title:"名称",dataIndex:"name",key:"name",render:function(e,n){return(0,T.jsxs)(Z.Z,{children:[e,C(n)&&(0,T.jsx)(w.Z,{color:"green",children:"已存在"})]})}},{title:"别名",dataIndex:"nickname",key:"nickname"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0}],q={selectedRowKeys:M,onChange:function(e){S(e)}};return(0,T.jsxs)(E.Z,{title:"导入".concat(n.nickname,"模型"),width:700,open:r,onClose:t,destroyOnClose:!0,footer:(0,T.jsxs)(Z.Z,{children:[(0,T.jsx)(j.ZP,{onClick:t,children:"取消"}),(0,T.jsxs)(j.ZP,{type:"primary",onClick:function(){if(0!==M.length){var e=y.filter((function(e){return M.includes(e.uid)}));o(e)}else x.yw.warning("请至少选择一个模型")},disabled:0===M.length,children:["导入已选(",M.length,")"]})]}),children:[(0,T.jsxs)(_,{type:"secondary",children:["从平台已有的",n.nickname,"模型中选择并导入到当前组织",l.length>0&&(0,T.jsx)(_,{type:"secondary",style:{marginLeft:8},children:"（已有标签的模型表示已导入到当前组织）"})]}),(0,T.jsx)("div",{style:{marginTop:16},children:(0,T.jsx)(Y.Z,{spinning:d,children:(0,T.jsx)(J.Z,{rowKey:"uid",columns:F,dataSource:y,pagination:{pageSize:10},rowSelection:q,size:"small"})})}),0===y.length&&!d&&(0,T.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,T.jsx)(_,{type:"secondary",children:"没有找到可导入的平台模型"})})]})},G={chat:"blue",embedding:"purple",vision:"green",code:"cyan",reasoning:"orange",text2image:"magenta",image2text:"pink",audio2text:"volcano",text2audio:"geekblue",text2video:"lime",video2text:"gold",default:"default"},Q={chat:(0,T.jsx)(A.FormattedMessage,{id:"model.type.chat",defaultMessage:"对话"}),embedding:(0,T.jsx)(A.FormattedMessage,{id:"model.type.embedding",defaultMessage:"嵌入"}),vision:(0,T.jsx)(A.FormattedMessage,{id:"model.type.vision",defaultMessage:"视觉"}),code:(0,T.jsx)(A.FormattedMessage,{id:"model.type.code",defaultMessage:"代码"}),reasoning:(0,T.jsx)(A.FormattedMessage,{id:"model.type.reasoning",defaultMessage:"推理"}),text2image:(0,T.jsx)(A.FormattedMessage,{id:"model.type.text2image",defaultMessage:"文生图"}),image2text:(0,T.jsx)(A.FormattedMessage,{id:"model.type.image2text",defaultMessage:"图生文"}),audio2text:(0,T.jsx)(A.FormattedMessage,{id:"model.type.audio2text",defaultMessage:"语音转文本"}),text2audio:(0,T.jsx)(A.FormattedMessage,{id:"model.type.text2audio",defaultMessage:"文本转语音"}),text2video:(0,T.jsx)(A.FormattedMessage,{id:"model.type.text2video",defaultMessage:"文生视频"}),video2text:(0,T.jsx)(A.FormattedMessage,{id:"model.type.video2text",defaultMessage:"视频转文本"})},$=function(e){if(!e)return null;var n=G[e.toLowerCase()]||G.default,r=Q[e.toLowerCase()]||e;return(0,T.jsx)(w.Z,{color:n,children:r})},X=function(e){var n=e.provider,r=e.level,t=(0,A.useIntl)(),o=(0,H.Z)().isDarkMode,i=(0,s.useState)(!0),l=a()(i,2),u=l[0],d=l[1],m=(0,z.Z)(),v=m.translateString,w=(m.translateStringTranct,(0,s.useState)()),R=a()(w,2),F=R[0],E=R[1],Y=(0,s.useState)(!1),J=a()(Y,2),_=J[0],G=J[1],Q=(0,s.useState)(!1),X=a()(Q,2),ee=X[0],ne=X[1],re=(0,y.u)((function(e){return e.currentOrg})),te=(0,s.useState)([]),oe=a()(te,2),ie=oe[0],ae=oe[1],se=(0,W.A)((function(e){return e.upgradeLlmProvider})),le=k.Z.useModal(),ue=a()(le,2),ce=ue[0],de=ue[1],fe=(0,s.useState)(!1),me=a()(fe,2),pe=me[0],ve=me[1],ge=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),x.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,h.Oh)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(x.yw.destroy(),x.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),xe()):(x.yw.destroy(),x.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=function(){var e=g()(p()().mark((function e(){var o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestModels"),ae([]),x.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading"})),o={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:null==re?void 0:re.uid,level:r},e.next=6,(0,h.LF)(o);case 6:i=e.sent,console.log("queryLlmModelsByOrg: ",i,o),200===i.code?(ae(i.data.content),x.yw.destroy()):(x.yw.destroy(),x.yw.error(i.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){xe()}),[]);var he=function(){G(!1)},ye=function(){ne(!1)},Pe=function(){var e=g()(p()().mark((function e(n){var r,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",n),!u){e.next=9;break}return e.next=4,(0,h.WS)(n);case 4:r=e.sent,console.log("updateLlmModel:",r),200===r.code?(x.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),xe(),he()):x.yw.error(r.message),e.next=14;break;case 9:return e.next=11,(0,h.Jr)(n);case 11:o=e.sent,console.log("createLlmModel:",o),200===o.code?(x.yw.success(t.formatMessage({id:"create.success",defaultMessage:"create success"})),xe(),he()):x.yw.error(o.message);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),we=function(){var e=g()(p()().mark((function e(t){var o,i,a,s,l,u,c,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",t),t&&0!==t.length){e.next=5;break}return x.yw.warning("没有选择任何模型"),ye(),e.abrupt("return");case 5:if(o=ie.map((function(e){return e.name})),i=t.filter((function(e){return!o.includes(e.name)})),0!==i.length){e.next=11;break}return x.yw.info("所选模型均已存在，无需重复导入"),ye(),e.abrupt("return");case 11:x.yw.loading("正在导入".concat(i.length,"个模型...")),e.prev=12,a=0,s=f()(i),e.prev=15,s.s();case 17:if((l=s.n()).done){e.next=27;break}return u=l.value,c={name:u.name,nickname:u.nickname,description:u.description,providerUid:n.uid,providerName:n.name,orgUid:null==re?void 0:re.uid,level:r},e.next=22,(0,h.Jr)(c);case 22:d=e.sent,console.log("createLlmModel:",d,c),200===d.code&&a++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),s.e(e.t0);case 32:return e.prev=32,s.f(),e.finish(32);case 35:x.yw.destroy(),a>0?(x.yw.success("成功导入".concat(a,"个模型")),xe()):x.yw.warning("没有成功导入任何模型"),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),x.yw.destroy(),x.yw.error("导入模型失败");case 44:ye();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(n){return e.apply(this,arguments)}}(),ke=function(){var e=g()(p()().mark((function e(r){var o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",n),o=c()(c()({},n),{},{status:r?P.KY:P.L2A}),e.next=4,(0,D.fx)(o);case 4:i=e.sent,console.log("updateLlmProvider:",o,i),200===i.code?(x.yw.destroy(),x.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),se(i.data)):(x.yw.destroy(),x.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Le=function(e,n){var r;console.log("list on delete",e),r=e,ce.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,T.jsx)(O.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(v(r.nickname),"】？"),onOk:function(){ge(r)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})},je=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,D.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(x.yw.destroy(),x.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),se(r.data),ve(!1)):(x.yw.destroy(),x.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("h1",{children:[(0,T.jsx)(L.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,T.jsx)(j.ZP,{type:"text",icon:(0,T.jsx)(U.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),r===P.Hxq&&(0,T.jsx)(b.Z,{checkedChildren:"上线发布",unCheckedChildren:"下线调试",defaultChecked:(null==n?void 0:n.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),ke(e)}}),(0,T.jsx)(M.Z,{orientation:"left",children:"模型列表"}),(0,T.jsxs)(Z.Z,{children:[(0,T.jsx)(j.ZP,{icon:(0,T.jsx)(I.Z,{}),type:"primary",onClick:function(){d(!1),G(!0)},children:"添加模型"}),"ollama"!==n.name&&r===P.whQ&&(0,T.jsx)(j.ZP,{icon:(0,T.jsx)(K.Z,{}),onClick:function(){return ne(!0)},children:"导入模型"}),(0,T.jsx)(j.ZP,{icon:(0,T.jsx)(V.Z,{}),onClick:xe,children:"刷新模型"})]}),(0,T.jsx)(S.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:ie,renderItem:function(e,n){return(0,T.jsx)(S.Z.Item,{style:(null==F?void 0:F.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){E(e)},actions:[(0,T.jsx)(j.ZP,{type:"link",onClick:function(){return n=e,console.log("list on edit",n),d(!0),void G(!0);var n},children:t.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,T.jsx)(j.ZP,{type:"link",onClick:function(){return Le(e)},children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,T.jsx)(S.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,T.jsxs)(Z.Z,{children:[(0,T.jsx)("span",{children:e.nickname}),$(e.type)]}),description:(0,T.jsxs)("div",{children:[(0,T.jsx)(C.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,T.jsx)("div",{style:{marginTop:"4px"},children:(0,T.jsx)(C.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}}),_&&(0,T.jsx)(q,{isEdit:u,llmmodel:F,provider:n,open:_,level:r,onClose:he,onSubmit:Pe}),ee&&(0,T.jsx)(B,{provider:n,open:ee,level:r,onClose:ye,onSubmit:we,existingModels:ie}),pe&&(0,T.jsx)(N.Z,{open:pe,isEdit:u,level:r,llmProvider:n,onCancel:function(){return ve(!1)},onSubmit:je}),de]})},ee=r(92053),ne=r(32943),re=r(65461),te=function(e){var n=e.provider,r=e.level,t=(0,A.useIntl)(),o=(0,H.Z)().isDarkMode,i=(0,s.useState)(!1),l=a()(i,2),u=l[0],c=l[1],d=(0,s.useState)(!1),f=a()(d,2),m=f[0],v=f[1],h=(0,s.useState)([]),y=a()(h,2),P=y[0],w=y[1],k=(0,s.useState)(!1),b=a()(k,2),Z=b[0],C=b[1],R=(0,W.A)((function(e){return e.upgradeLlmProvider})),F=(0,s.useState)(),E=a()(F,2),q=E[0],O=E[1],I=function(){var e=g()(p()().mark((function e(){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),console.log("pingOllama"),e.next=4,(0,ee.V)();case 4:n=e.sent,console.log("getOllamaServerStatus: ",n),200===n.code?(v(n.data),c(!1)):(v(!1),c(!1));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=g()(p()().mark((function e(){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,(0,ee.c)();case 3:n=e.sent,console.log("getOllamaLocalModels: ",n),200===n.code&&w(n.data);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){I(),K()};(0,s.useEffect)((function(){z()}),[]);var Y=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,D.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(x.yw.destroy(),x.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),R(r.data),C(!1)):(x.yw.destroy(),x.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("h1",{children:[(0,T.jsx)(L.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,T.jsx)(j.ZP,{type:"text",icon:(0,T.jsx)(U.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),(0,T.jsx)(j.ZP,{icon:(0,T.jsx)(V.Z,{}),loading:u,type:"primary",onClick:z,children:"刷新"}),(0,T.jsx)("br",{}),(0,T.jsx)("br",{}),m?(0,T.jsx)(ne.Z,{message:"Ollama运行中",type:"success"}):(0,T.jsx)(ne.Z,{message:"请首先启动Ollama",type:"error"}),(0,T.jsx)(M.Z,{orientation:"left",children:"本地模型列表"}),(0,T.jsx)(S.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:P,renderItem:function(e,n){return(0,T.jsx)(S.Z.Item,{style:(null==q?void 0:q.name)===e.name?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){O(e)},actions:[],children:(0,T.jsx)(S.Z.Item.Meta,{title:null==e?void 0:e.name,description:(0,re.mr)(null==e?void 0:e.modified_at.toString()),style:{marginLeft:"15px"}})})}}),Z&&(0,T.jsx)(N.Z,{open:Z,isEdit:!0,level:r,llmProvider:n,onCancel:function(){return C(!1)},onSubmit:Y})]})},oe=r(19317),ie=function(e){var n=e.level,r=(0,s.useState)(""),t=a()(r,2),i=t[0],u=t[1],c=(0,s.useState)([]),d=a()(c,2),f=d[0],m=d[1],p=(0,W.A)((function(e){return e.currentLlmProvider})),v=(0,oe.$)((function(e){return e.currentLlmProviderPlatform})),g=(0,s.useState)(n===P.Hxq),x=a()(g,1)[0]?v:p;(0,s.useEffect)((function(){if(x&&x.name)if(console.log("llmProvider: ",x),f.find((function(e){return e.key===x.name})))u(x.name);else{var e=o()(f);"ollama"===x.name?e.push({label:x.nickname||x.name,children:(0,T.jsx)(te,{provider:x,level:n}),key:x.name,closable:!0}):e.push({label:x.nickname||x.name,children:(0,T.jsx)(X,{provider:x,level:n}),key:x.name,closable:!0}),m(e),u(x.name)}}),[x,f]);return 0===f.length?null:(0,T.jsx)(l.Z,{type:"editable-card",onChange:function(e){u(e)},activeKey:i,onEdit:function(e,n){"remove"===n&&function(e){var n=i,r=-1;f.forEach((function(n,t){n.key===e&&(r=t-1)}));var t=f.filter((function(n){return n.key!==e}));t.length&&n===e&&(n=r>=0?t[r].key:t[0].key),m(t),u(n)}(e)},items:f})}},17520:function(e,n,r){var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),s=r(45332),l=r.n(s),u=r(86803),c=r(36605),d=r(40612),f=r(55735),m=r(69169),p=r(84881),v=r(4499),g=r(57178),x=r(53530),h=r(44194),y=r(31549);n.Z=function(e){var n=e.open,r=e.isEdit,t=e.llmProvider,i=e.level,s=e.onCancel,P=e.onSubmit,w=g.Z.useForm(),k=l()(w,1)[0],L=(0,d.u)((function(e){return e.currentOrg})),j=(0,h.useState)([]),b=l()(j,2),M=b[0],Z=b[1],S=(0,h.useState)([]),C=l()(S,2),R=C[0],F=C[1],E=(0,h.useState)(),T=l()(E,2),q=T[0],O=T[1],U=function(){var e=a()(o()().mark((function e(){var n,r,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLlmProviders"),n={pageNumber:0,pageSize:50,status:"",level:f.Hxq},e.next=4,(0,c.mK)(n);case 4:r=e.sent,console.log("queryLlmProvidersByOrg: ",r),200===r.code?Z(null==r||null===(t=r.data)||void 0===t?void 0:t.content):u.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){var e=[];M.forEach((function(n){e.push({label:n.nickname,value:n.name,disabled:n.status!==f.KY})})),F(e)}),[M]),(0,h.useEffect)((function(){i===f.whQ&&U()}),[]),(0,h.useEffect)((function(){r?(O(t),k.setFieldsValue({name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,apiUrl:null==t?void 0:t.apiUrl,apiKey:null==t?void 0:t.apiKey})):k.resetFields()}),[r,t]);return(0,y.jsx)("div",{children:(0,y.jsx)(x.Z,{title:"添加大模型提供商",open:n,forceRender:!0,onOk:function(){k.validateFields().then(function(){var e=a()(o()().mark((function e(n){var i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={uid:r?null==t?void 0:t.uid:"",name:null==q?void 0:q.name,nickname:null==n?void 0:n.nickname,logo:null==q?void 0:q.logo,description:null==q?void 0:q.description,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey,webUrl:null==q?void 0:q.webUrl,status:f.KY,level:f.whQ,orgUid:null==L?void 0:L.uid},console.log("handleSaveLlmProvider:",n,i),P(i);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),u.yw.error("创建角色失败")}))},onCancel:s,children:(0,y.jsxs)(m.A,{form:k,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[i===f.whQ&&(0,y.jsx)(p.Z,{label:"选择大模型提供商",name:"name",options:R,fieldProps:{placeholder:"选择大模型提供商(必选)",allowClear:!0,onChange:function(e){console.log("onParentSelectChange:",e);var n=M.find((function(n){return n.name===e}));O(n),console.log("selectedProvider:",n),k.setFieldsValue({nickname:null==n?void 0:n.nickname,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey})},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,y.jsx)(v.Z,{label:"名称",name:"nickname",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,y.jsx)(v.Z,{label:"ApiUrl",name:"apiUrl",rules:[{required:!0,message:"请输入apiUrl!"}],fieldProps:{onPressEnter:function(e){}}}),"ollama"!==(null==q?void 0:q.name)&&(0,y.jsx)(v.Z.Password,{label:"ApiKey",name:"apiKey",fieldProps:{placeholder:"请输入apiKey",allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){}}})]})})})}},96865:function(e,n,r){var t=r(23864);n.Z=function(){var e=(0,t.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,n,r){var t=r(55735),o=r(65461),i=r(30921);n.Z=function(){var e=(0,i.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(t.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(t.VoP)||null!=n&&n.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,o.aS)(n,10)}}}},11490:function(e,n,r){r.d(n,{A:function(){return d}});var t=r(73193),o=r.n(t),i=r(76711),a=r.n(i),s=r(55735),l=r(44435),u=r(83642),c=r(83890),d=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentLlmProvider:{uid:"",nickname:""},insertLlmProvider:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},upgradeLlmProvider:function(n){e((function(e){var r=e.llmproviderResult.data.content,t=r.findIndex((function(e){return e.uid===n.uid}));-1!==t?r[t]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResult:function(r){e({llmproviderResult:r});var t,o=n().currentLlmProvider;""!==o.uid&&void 0!==o||(null===(t=r.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProvider:r.data.content[0]})},setCurrentLlmProvider:function(r){var t=n().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===r.uid}));if(-1!==i){var s=[].concat(a()(t.slice(0,i)),[r],a()(t.slice(i+1))),l=o()(o()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:l,currentLlmProvider:r})}else e({currentLlmProvider:r})},deleteCurrentLlmProvider:function(r){var t=n().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===r}));-1!==i?e({llmproviderResult:o()(o()({},n().llmproviderResult),{},{data:{content:[].concat(a()(t.slice(0,i)),a()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",r),n().currentLlmProvider.uid===r&&e({currentLlmProvider:{uid:""}})},deleteLlmProviderCache:function(){return e({},!0)}}})),{name:s.ajB})))},19317:function(e,n,r){r.d(n,{$:function(){return d}});var t=r(73193),o=r.n(t),i=r(76711),a=r.n(i),s=r(55735),l=r(44435),u=r(83642),c=r(83890),d=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(n){e((function(e){e.llmproviderResultPlatform.data.content.unshift(n)}))},upgradeLlmProviderPlatform:function(n){e((function(e){var r=e.llmproviderResultPlatform.data.content,t=r.findIndex((function(e){return e.uid===n.uid}));-1!==t?r[t]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResultPlatform:function(r){e({llmproviderResultPlatform:r});var t,o=n().currentLlmProviderPlatform;""!==o.uid&&void 0!==o||(null===(t=r.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProviderPlatform:r.data.content[0]})},setCurrentLlmProviderPlatform:function(r){var t=n().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===r.uid}));if(-1!==i){var s=[].concat(a()(t.slice(0,i)),[r],a()(t.slice(i+1))),l=o()(o()({},n().llmproviderResultPlatform),{},{data:{content:s}});e({llmproviderResultPlatform:l,currentLlmProviderPlatform:r})}else e({currentLlmProviderPlatform:r})},deleteCurrentLlmProviderPlatform:function(r){var t=n().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===r}));-1!==i?e({llmproviderResultPlatform:o()(o()({},n().llmproviderResultPlatform),{},{data:{content:[].concat(a()(t.slice(0,i)),a()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",r),n().currentLlmProviderPlatform.uid===r&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:s.dNm})))}}]);