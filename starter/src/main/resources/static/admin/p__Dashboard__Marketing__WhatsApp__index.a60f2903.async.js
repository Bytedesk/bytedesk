"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3626],{83381:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},28031:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},80503:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(83910),n=a(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},s=a(5901),i=function(e,t){return n.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=n.forwardRef(i)},50447:function(e,t,a){var r=a(94433),n=a(38956),o=a(75477),s=a(44194),i=a(18758),l=a(46659),d=a(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var a=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,w=e.request,v=e.showSearch,h=e.options,M=(0,n.Z)(e,u),y=(0,s.useContext)(i.Z);return(0,d.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(m),request:w,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:h,mode:g,showSearch:v,getPopupContainer:y.getPopupContainer},a),ref:t,proFieldProps:p},M),{},{children:c}))},p=s.forwardRef((function(e,t){var a=e.fieldProps,u=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,w=e.request,v=e.options,h=(0,n.Z)(e,c),M=(0,r.Z)({options:v,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),y=(0,s.useContext)(i.Z);return(0,d.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(m),request:w,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:y.getPopupContainer},M),ref:t,proFieldProps:p},h),{},{children:u}))})),g=s.forwardRef(f);g.SearchSelect=p,g.displayName="ProFormComponent",t.Z=g},47268:function(e,t,a){var r=a(32906),n=a(94433),o=a(38956),s=a(92032),i=a(70878),l=a(35068),d=a(21762),u=a(44194),c=a(46659),f=a(31549),p=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",w=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),a=(0,r.Z)(t,2),o=a[0],d=a[1];return(0,f.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var a,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,n.Z)((0,n.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return d(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(a=e.statusRender)||void 0===a?void 0:a.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:o,children:e.children}))}})},v=function(e){var t=e.fieldProps,a=e.proFieldProps,r=(0,o.Z)(e,p);return(0,f.jsx)(c.Z,(0,n.Z)({valueType:m,fieldProps:t,filedConfig:{valueType:m},proFieldProps:a},r))};v.Password=function(e){var t=e.fieldProps,a=e.proFieldProps,s=(0,o.Z)(e,g),i=(0,u.useState)(!1),l=(0,r.Z)(i,2),p=l[0],v=l[1];return null!=t&&t.statusRender&&s.name?(0,f.jsx)(w,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:(0,n.Z)((0,n.Z)({},(0,d.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var a;null==t||null===(a=t.onBlur)||void 0===a||a.call(t,e),v(!1)},onClick:function(e){var a;null==t||null===(a=t.onClick)||void 0===a||a.call(t,e),v(!0)}}),proFieldProps:a,filedConfig:{valueType:m}},s))})}):(0,f.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:t,proFieldProps:a,filedConfig:{valueType:m}},s))},v.displayName="ProFormComponent",t.Z=v},26608:function(e,t,a){var r=a(94433),n=a(38956),o=a(44194),s=a(46659),i=a(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var a=e.fieldProps,o=e.proFieldProps,d=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:o},d))};t.Z=o.forwardRef(d)},896:function(e,t,a){a.d(t,{$B:function(){return p},Au:function(){return c},_I:function(){return v},rI:function(){return m}});var r=a(90819),n=a.n(r),o=a(73193),s=a.n(o),i=a(89933),l=a.n(i),d=a(68992),u=a(62395);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/query/org",{method:"GET",params:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/create",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return w.apply(this,arguments)}function w(){return(w=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/update",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/workflow/delete",{method:"POST",data:s()(s()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2136:function(e,t,a){a.r(t),a.d(t,{default:function(){return X}});var r=a(44194),n=a(44528),o=a(62395),s=a(84176),i=a.n(s),l=a(73193),d=a.n(l),u=a(90819),c=a.n(u),f=a(89933),p=a.n(f),g=a(45332),m=a.n(g),w=a(66248),v=a(35068),h=a(72264),M=a(6237),y=a(61489),x=a(896),k=a(68992),Z=a(77643),j=a(83381),b=a(32164),S=a(6992),C=a(28031),P=a(80503),T=a(99754),I=a(77686),z=a(54596),B=a(45634),F=a.n(B),A=a(87005),E=a(89007),U=a(50447),R=a(47268),q=a(26608),O=a(41059),D=a(89654),H=a(31549),Y=function(e){var t,a,n=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,u=E.A.useForm(),c=m()(u,1)[0],f=(0,o.useIntl)(),p=(0,I.u)((function(e){return e.currentOrg})),g=(0,r.useState)(),w=m()(g,2),v=w[0],M=w[1],y=(0,Z.v)((function(e){return e.categoryResult})),x=(0,T.Z)().translateString;(0,r.useEffect)((function(){if(n&&s&&c){var e;c.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==y||null===(e=y.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));M(t)}else console.log("form resetFields"),c.resetFields()}),[s,c,n,null==y||null===(t=y.data)||void 0===t?void 0:t.content]);return(0,H.jsx)("div",{children:(0,H.jsx)(O.Z,{title:n?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,H.jsxs)(D.Z,{children:[(0,H.jsx)(h.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,H.jsx)(h.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:n?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==v?void 0:v.uid,orgUid:null==p?void 0:p.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,H.jsxs)(E.A,{form:c,name:"workflow",submitter:!1,children:[(0,H.jsx)(U.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==y||null===(a=y.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:x(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),M(null==y||null===(t=y.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,H.jsx)(R.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,H.jsx)(R.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,H.jsx)(q.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,H.jsx)(q.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},N=a(62134),W=["current","pageSize","content"],L=function(e){var t=e.level,a=(e.type,(0,r.useRef)()),n=(0,o.useIntl)(),s=(0,r.useState)(!0),l=m()(s,2),u=l[0],f=l[1],g=(0,T.Z)().translateString,B=(0,r.useState)(1),E=m()(B,2),U=E[0],R=E[1],q=(0,r.useState)(10),O=m()(q,2),D=O[0],L=O[1],V=(0,r.useState)(!1),J=m()(V,2),_=J[0],X=J[1],G=(0,r.useState)([]),K=m()(G,2),$=(K[0],K[1]),Q=(0,r.useState)({}),ee=m()(Q,2),te=ee[0],ae=ee[1],re=(0,Z.v)((function(e){return e.currentCategory})),ne=(0,I.u)((function(e){return e.currentOrg})),oe=w.Z.useModal(),se=m()(oe,2),ie=se[0],le=se[1],de=(0,r.useState)(0),ue=m()(de,2),ce=ue[0],fe=ue[1],pe=(0,r.useState)({}),ge=m()(pe,2),me=ge[0],we=ge[1],ve=function(){var e=p()(c()().mark((function e(t){var r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,x._I)(t);case 3:200===(r=e.sent).code?(y.yw.destroy(),y.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=a.current)||void 0===o||o.reload()):(y.yw.destroy(),y.yw.error(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=p()(c()().mark((function e(t){var r,o,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=8;break}return y.yw.loading(n.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,x.rI)(t);case 4:200===(r=e.sent).code?(y.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=a.current)||void 0===o||o.reload(),X(!1)):y.yw.error(r.message),e.next=13;break;case 8:return y.yw.loading(n.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,x.$B)(t);case 11:200===(s=e.sent).code?(y.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),X(!1)):y.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var Me=function(){var e=p()(c()().mark((function e(a,r,n){var o,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),o=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,orgUid:t===k.Hxq?"":null==ne?void 0:ne.uid,level:t,accessToken:o||"",exportType:a},me),"current"===a?(s.pageNumber=String(U-1),s.pageSize=String(D)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(s.pageNumber=String(r),s.pageSize=String(n)),window.open((0,A.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=o,n=o*a+1,s=Math.min((o+1)*a,e);t.push({key:"export-".concat(o),label:"".concat(n,"-").concat(s," (").concat(s-n+1,"条)"),onClick:function(){return Me("range",r,a)}})},o=0;o<r;o++)n();return t},xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:n.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:n.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:n.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:n.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:n.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",r=function(){var e=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.TE)(t);case 2:e.sent.success?y.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):y.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,H.jsx)(v.Z,{content:(0,H.jsxs)("div",{children:[(0,H.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,H.jsx)("span",{children:n.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,H.jsx)(h.ZP,{type:"text",icon:(0,H.jsx)(b.Z,{}),onClick:function(e){e.stopPropagation(),r(a)},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,H.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:n.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,H.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:n.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:n.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?F()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:n.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?F()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:n.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,H.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),X(!0)}(t)},children:n.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,H.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,H.jsx)(j.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(g(e.name),"】？"),onOk:function(){ve(e)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e},children:n.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=p()(c()().mark((function e(a,r,o){var s,l,u,f,p,g,m,w,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,u=a.content,f=i()(a,W),R(s),L(l),we(d()(d()({},f),{},{content:u})),p=void 0,g=void 0,r&&Object.keys(r).length>0&&(m=Object.keys(r)[0],p=m,g="ascend"===r[m]?"ascend":"descend"),w=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==ne?void 0:ne.uid,categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,level:t},f),{},{content:u,sortBy:p,sortDirection:g}),e.next=11,(0,x.Au)(w);case 11:if(v=e.sent,console.log("queryWorkflowsByOrg response:",v,w),200!==v.code){e.next=20;break}return y.yw.destroy(),$(v.data.content),fe(v.data.totalElements),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 20:return y.yw.destroy(),y.yw.error(v.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(z.Z,{columns:xe,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){R(e),L(t)}},dateFormatter:"string",headerTitle:n.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,H.jsx)(h.ZP,{type:"primary",onClick:function(){window.open((0,A.HU)(),"_blank")},icon:(0,H.jsx)(S.Z,{}),children:n.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return Me("all")}}):t.push({key:"export-range",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:ye(ce)})),e.push((0,H.jsx)(M.Z,{menu:{items:t},placement:"bottom",children:(0,H.jsxs)(h.ZP,{type:"primary",icon:(0,H.jsx)(C.Z,{}),children:[n.formatMessage({id:"export",defaultMessage:"导出"}),(0,H.jsx)(P.Z,{})]})},"export")),e},request:ke}),_&&(0,H.jsx)(Y,{isEdit:u,workflow:te,level:t,open:_,onClose:function(){return X(!1)},onSubmit:he}),le]})},V=function(e){var t,a,n=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,u=E.A.useForm(),c=m()(u,1)[0],f=(0,o.useIntl)(),p=(0,I.u)((function(e){return e.currentOrg})),g=(0,r.useState)(),w=m()(g,2),v=w[0],M=w[1],y=(0,Z.v)((function(e){return e.categoryResult})),x=(0,T.Z)().translateString;(0,r.useEffect)((function(){if(n&&s&&c){var e;c.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==y||null===(e=y.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));M(t)}else console.log("form resetFields"),c.resetFields()}),[s,c,n,null==y||null===(t=y.data)||void 0===t?void 0:t.content]);return(0,H.jsx)("div",{children:(0,H.jsx)(O.Z,{title:n?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,H.jsxs)(D.Z,{children:[(0,H.jsx)(h.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,H.jsx)(h.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:n?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==v?void 0:v.uid,orgUid:null==p?void 0:p.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,H.jsxs)(E.A,{form:c,name:"workflow",submitter:!1,children:[(0,H.jsx)(U.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==y||null===(a=y.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:x(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),M(null==y||null===(t=y.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,H.jsx)(R.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,H.jsx)(R.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,H.jsx)(q.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,H.jsx)(q.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},J=["current","pageSize","content"],_=function(e){var t=e.level,a=(e.type,(0,r.useRef)()),n=(0,o.useIntl)(),s=(0,r.useState)(!0),l=m()(s,2),u=l[0],f=l[1],g=(0,T.Z)().translateString,B=(0,r.useState)(1),E=m()(B,2),U=E[0],R=E[1],q=(0,r.useState)(10),O=m()(q,2),D=O[0],Y=O[1],W=(0,r.useState)(!1),L=m()(W,2),_=L[0],X=L[1],G=(0,r.useState)([]),K=m()(G,2),$=(K[0],K[1]),Q=(0,r.useState)({}),ee=m()(Q,2),te=ee[0],ae=ee[1],re=(0,Z.v)((function(e){return e.currentCategory})),ne=(0,I.u)((function(e){return e.currentOrg})),oe=w.Z.useModal(),se=m()(oe,2),ie=se[0],le=se[1],de=(0,r.useState)(0),ue=m()(de,2),ce=ue[0],fe=ue[1],pe=(0,r.useState)({}),ge=m()(pe,2),me=ge[0],we=ge[1],ve=function(){var e=p()(c()().mark((function e(t){var r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,x._I)(t);case 3:200===(r=e.sent).code?(y.yw.destroy(),y.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=a.current)||void 0===o||o.reload()):(y.yw.destroy(),y.yw.error(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=p()(c()().mark((function e(t){var r,o,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=8;break}return y.yw.loading(n.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,x.rI)(t);case 4:200===(r=e.sent).code?(y.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=a.current)||void 0===o||o.reload(),X(!1)):y.yw.error(r.message),e.next=13;break;case 8:return y.yw.loading(n.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,x.$B)(t);case 11:200===(s=e.sent).code?(y.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),X(!1)):y.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var Me=function(){var e=p()(c()().mark((function e(a,r,n){var o,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),o=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,orgUid:t===k.Hxq?"":null==ne?void 0:ne.uid,level:t,accessToken:o||"",exportType:a},me),"current"===a?(s.pageNumber=String(U-1),s.pageSize=String(D)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(s.pageNumber=String(r),s.pageSize=String(n)),window.open((0,A.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=o,n=o*a+1,s=Math.min((o+1)*a,e);t.push({key:"export-".concat(o),label:"".concat(n,"-").concat(s," (").concat(s-n+1,"条)"),onClick:function(){return Me("range",r,a)}})},o=0;o<r;o++)n();return t},xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:n.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:n.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:n.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:n.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:n.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",r=function(){var e=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.TE)(t);case 2:e.sent.success?y.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):y.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,H.jsx)(v.Z,{content:(0,H.jsxs)("div",{children:[(0,H.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,H.jsx)("span",{children:n.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,H.jsx)(h.ZP,{type:"text",icon:(0,H.jsx)(b.Z,{}),onClick:function(e){e.stopPropagation(),r(a)},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,H.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:n.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,H.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:n.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:n.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?F()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:n.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?F()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:n.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,H.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),X(!0)}(t)},children:n.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,H.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,H.jsx)(j.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(g(e.name),"】？"),onOk:function(){ve(e)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e},children:n.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=p()(c()().mark((function e(a,r,o){var s,l,u,f,p,g,m,w,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,u=a.content,f=i()(a,J),R(s),Y(l),we(d()(d()({},f),{},{content:u})),p=void 0,g=void 0,r&&Object.keys(r).length>0&&(m=Object.keys(r)[0],p=m,g="ascend"===r[m]?"ascend":"descend"),w=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==ne?void 0:ne.uid,categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,level:t},f),{},{content:u,sortBy:p,sortDirection:g}),e.next=11,(0,x.Au)(w);case 11:if(v=e.sent,console.log("queryWorkflowsByOrg response:",v,w),200!==v.code){e.next=20;break}return y.yw.destroy(),$(v.data.content),fe(v.data.totalElements),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 20:return y.yw.destroy(),y.yw.error(v.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(z.Z,{columns:xe,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){R(e),Y(t)}},dateFormatter:"string",headerTitle:n.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,H.jsx)(h.ZP,{type:"primary",onClick:function(){window.open((0,A.HU)(),"_blank")},icon:(0,H.jsx)(S.Z,{}),children:n.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return Me("all")}}):t.push({key:"export-range",icon:(0,H.jsx)(C.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:ye(ce)})),e.push((0,H.jsx)(M.Z,{menu:{items:t},placement:"bottom",children:(0,H.jsxs)(h.ZP,{type:"primary",icon:(0,H.jsx)(C.Z,{}),children:[n.formatMessage({id:"export",defaultMessage:"导出"}),(0,H.jsx)(P.Z,{})]})},"export")),e},request:ke}),_&&(0,H.jsx)(V,{isEdit:u,workflow:te,level:t,open:_,onClose:function(){return X(!1)},onSubmit:he}),le]})},X=(n.Z.TabPane,function(e){var t=e.level,a=void 0===t?"org":t,r=(0,o.useIntl)(),s=[{key:"template",label:r.formatMessage({id:"pages.whatsapp.template.tab",defaultMessage:"WhatsApp 模板"}),children:(0,H.jsx)(L,{level:a,type:"whatsapp"})},{key:"send",label:r.formatMessage({id:"pages.whatsapp.send.tab",defaultMessage:"发送记录"}),children:(0,H.jsx)(_,{level:a,type:"whatsapp"})}];return(0,H.jsx)("div",{children:(0,H.jsx)(n.Z,{defaultActiveKey:"template",items:s,style:{padding:"10px"}})})})},77643:function(e,t,a){a.d(t,{v:function(){return f}});var r=a(73193),n=a.n(r),o=a(76711),s=a.n(o),i=a(68992),l=a(58063),d=a(66266),u=a(31403),c=a(46130);var f=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,u.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(t){var a=function(e){var t=[];return e.data.content.forEach((function(e){var a={label:e.name,value:e.uid};t.push(a)})),t}(t),r=function(e){var t,a=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],r=function e(t){var a={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(a.children=t.children.map((function(t){return e(t)}))),a};return a.filter((function(e){return e&&e.uid&&e.uid!==i.zBg})).map((function(e){return r(e)}))}(t),o=[{title:i.zBg,key:i.zBg}].concat(s()(r)),l={uid:i.zBg,name:i.zBg},d=n()(n()({},t),{},{data:n()(n()({},t.data),{},{content:[l].concat(s()(t.data.content))})});e({categoryResult:d,categoryTreeOptions:o,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){c.Z.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(a){var r=t().categoryResult.data.content.find((function(e){return e.uid===a}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);