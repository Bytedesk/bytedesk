"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5714],{99885:function(e,t,n){n.d(t,{QB:function(){return w},Yg:function(){return y},kh:function(){return p},kv:function(){return x},pf:function(){return d},y:function(){return g}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/query/org",{method:"GET",params:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/create",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/update",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/delete",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,client:u.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/deleteAll",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},27522:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return y},t5:function(){return g},v_:function(){return p}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),o=n(89933),l=n.n(o),u=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51990:function(e,t,n){var a=n(73193),r=n.n(a),s=n(84176),i=n.n(s),o=n(86803),l=n(23864),u=n(44521),c=n(55735),d=n(30921),f=n(82421),p=(n(27015),n(28977)),m=n.n(p),g=n(44194),h=n(31549),y=["placeholder","defaultValue","value","style","toolbarKeys","onChange","options"];t.Z=function(e){var t=e.placeholder,n=e.defaultValue,a=e.value,s=e.style,p=e.toolbarKeys,v=e.onChange,x=(e.options,i()(e,y)),b=((0,d.useIntl)(),(0,l.Z)().isDarkMode),w=(0,g.useRef)(null),M=(0,g.useRef)(null);return(0,g.useEffect)((function(){if(w.current){if(!M.current){var e=new f.cW({element:w.current,theme:b?"dark":"light",placeholder:t,content:n,toolbarKeys:p,image:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(c.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var s=m()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",s),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",c.bE7),i.append("categoryUid",""),i.append("kbUid",""),i.append("orgUid",""),i.append("client",c.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){o.yw.destroy(),o.yw.success("".concat(s," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:s}};e(n)}else o.yw.destroy(),o.yw.error("".concat(s," 上传失败"))})).catch((function(e){a(e)}))}))}},video:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(c.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var s=m()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",s),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",c.bE7),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",c.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){o.yw.destroy(),o.yw.success("".concat(s," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else o.yw.destroy(),o.yw.error("".concat(s," 上传失败"))})).catch((function(e){a(e)}))}))}},attachment:{uploadUrl:(0,u.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(c.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var s=m()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("fileName",s),i.append("fileType",e.type),i.append("isAvatar","false"),i.append("kbType",c.bE7),i.append("categoryUid",""),i.append("kbUid",""),i.append("client",c.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){o.yw.destroy(),o.yw.success("".concat(s," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:s}};e(n)}else o.yw.destroy(),o.yw.error("".concat(s," 上传失败"))})).catch((function(e){a(e)}))}))}},onChange:function(e){"function"==typeof v&&v(e.getHtml(),e.getMarkdown())}});M.current=e}return function(){M.current&&(M.current.destroy(),M.current=null)}}}),[]),(0,g.useEffect)((function(){M.current&&a!==M.current.getHtml()&&M.current.setContent(a||"")}),[a]),(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("div",r()(r()({ref:w},x),{},{style:r()({height:"100%"},s)}))})}},91842:function(e,t,n){n.r(t),n.d(t,{default:function(){return ke}});var a=n(96865),r=n(75574),s=n(95160),i=n(55735),o=n(73193),l=n.n(o),u=n(84176),c=n.n(u),d=n(86222),f=n.n(d),p=n(90819),m=n.n(p),g=n(89933),h=n.n(g),y=n(45332),v=n.n(y),x=n(86803),b=n(99885),w=n(40612),M=n(10162),k=n(54881),j=n(93689),S=n(40439),q=n(58275),Z=n(2484),L=n(30617),A=n(11090),C=n(61107),D=n(81947),U=n(29266),T=n(61355),F=n(75365),P=n(53530),I=n(96485),Y=n(44194),E=n(90838),V=n(30921),O=n(76750),R=n(6397),H=n(27650),B=n(44521),Q=n(28977),z=n.n(Q),K=n(29078),N=n(31549),_=function(e){var t=e.content,n=K.Z.sanitize(t,{ALLOWED_TAGS:["p","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","a","strong","em","b","i","img","blockquote","code","pre"],ALLOWED_ATTR:["href","target","src","alt","style","class"]});return(0,N.jsx)("div",{className:"RichText",dangerouslySetInnerHTML:{__html:n}})},W=n(76711),G=n.n(W),$=n(69169),J=n(84881),X=n(4499),ee=n(62577),te=n(39755),ne=n(79907),ae=n(32350),re=n(44190),se=n(48708),ie=n(32327),oe=n(73442),le=n(3849),ue=n(38775),ce=n(62673),de=n(52288),fe=n(65461),pe=n(51990),me=n(27522),ge=["key"],he=(ie.Z.Text,function(e){var t=e.isEdit,n=e.faq,a=e.open,r=e.onClose,s=e.onSubmit,o=$.A.useForm(),u=v()(o,1)[0],d=(0,O.Z)().translateString,f=(0,Y.useState)(""),p=v()(f,2),g=p[0],y=p[1],k=(0,w.u)((function(e){return e.currentOrg})),j=(0,R.j)((function(e){return e.currentKbase})),S=(0,E.v)((function(e){return e.categorySelectOptions})),q=(0,E.v)((function(e){return e.currentCategory})),Z=(0,Y.useState)(),L=v()(Z,2),A=(L[0],L[1]),C=(0,Y.useState)([]),D=v()(C,2),T=D[0],P=D[1],I=(0,Y.useState)(!1),V=v()(I,2),H=V[0],B=V[1],Q=(0,Y.useState)(""),K=v()(Q,2),_=K[0],W=K[1],ie=(0,Y.useRef)(null),he=(0,Y.useState)([]),ye=v()(he,2),ve=(ye[0],ye[1]),xe=(0,Y.useState)([]),be=v()(xe,2),we=be[0],Me=be[1],ke=(0,Y.useState)(!0),je=v()(ke,2),Se=je[0],qe=je[1],Ze=(0,Y.useState)(!1),Le=v()(Ze,2),Ae=(Le[0],Le[1]),Ce=(0,Y.useState)(""),De=v()(Ce,2),Ue=(De[0],De[1]),Te=(0,Y.useState)([]),Fe=v()(Te,2),Pe=(Fe[0],Fe[1]),Ie=(0,Y.useState)(!1),Ye=v()(Ie,2),Ee=(Ye[0],Ye[1]),Ve=(0,Y.useState)([]),Oe=v()(Ve,2),Re=Oe[0],He=Oe[1],Be=(0,Y.useState)(!1),Qe=v()(Be,2);Qe[0],Qe[1];(0,Y.useEffect)((function(){var e=function(){var e=h()(m()().mark((function e(){var t,a,r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==q?void 0:q.uid)===i.zBg?"":null==q?void 0:q.uid,kbUid:null==j?void 0:j.uid,orgUid:null==k?void 0:k.uid},e.next=5,(0,b.pf)(t);case 5:a=e.sent,console.log("获取FAQ列表响应:",t,a),x.yw.destroy(),200===a.code?(r=a.data.content.map((function(e){return{label:e.question,value:e.uid}})),Me(r.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):x.yw.error(a.message||"加载常见问题失败"),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),x.yw.destroy(),x.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();a&&e()}),[a,null==j?void 0:j.uid,null==k?void 0:k.uid,null==q?void 0:q.uid,null==n?void 0:n.uid]),(0,Y.useEffect)((function(){var e=function(){var e=h()(m()().mark((function e(){var t,n,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x.yw.loading("正在加载LLM知识库列表..."),t={pageNumber:0,pageSize:100,type:"llm",orgUid:null==k?void 0:k.uid},e.next=5,(0,me.AP)(t);case 5:n=e.sent,console.log("获取LLM知识库列表响应:",n),x.yw.destroy(),200===n.code?(a=n.data.content.map((function(e){return{label:d(e.name),value:e.uid}})),Pe(a)):x.yw.error(n.message||"加载LLM知识库失败"),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),x.yw.destroy(),x.yw.error("加载LLM知识库列表失败"),console.error("获取LLM知识库列表出错:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();a&&e()}),[a,null==k?void 0:k.uid]),(0,Y.useEffect)((function(){if(t){var e,a,r,s=Array.isArray(null==n?void 0:n.questionList)?n.questionList.map((function(e){return"string"==typeof e?e:String(e)})):[];u.setFieldsValue({type:null==n?void 0:n.type,question:null==n?void 0:n.question,questionList:s,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==j?void 0:j.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[z()(n.startDate),z()(n.endDate)]:void 0,autoSyncLlmQa:(null==n?void 0:n.autoSyncLlmQa)||!1,llmQaKbUid:(null==n?void 0:n.llmQaKbUid)||""}),y((null==n?void 0:n.answer)||""),P((null==n||null===(a=n.tagList)||void 0===a?void 0:a.filter((function(e){return""!==e})))||[]),ve((null==n||null===(r=n.relatedFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]),qe(!1!==(null==n?void 0:n.enabled)),Ae((null==n?void 0:n.autoSyncLlmQa)||!1),Ue((null==n?void 0:n.llmQaKbUid)||""),Ee((null==n?void 0:n.llmQaSynced)||!1),He(s)}else u.setFieldsValue({type:i.PYi,question:"",questionList:[],answer:"",categoryUid:"",kbUid:null==j?void 0:j.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),y(""),P([]),ve([]),qe(!0),Ae(!1),Ue(""),He([])}),[n,a]),(0,Y.useEffect)((function(){var e;H&&(null===(e=ie.current)||void 0===e||e.focus())}),[H]);var ze=function(){_&&-1===T.indexOf(_)&&P([].concat(G()(T),[_])),B(!1),W("")};return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(oe.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:r,open:a,extra:(0,N.jsxs)(le.Z,{children:[(0,N.jsx)(F.ZP,{onClick:r,children:"取消"}),(0,N.jsx)(F.ZP,{onClick:function(){var e=Re.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));u.setFieldValue("questionList",e),u.validateFields().then((function(t){console.log("handleSubmit values:",t);var a=t.dateRange,r=null!=a&&a[0]?a[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,i=null!=a&&a[1]?a[1].format("YYYY-MM-DDTHH:mm:ss"):void 0;s(l()(l()(l()({},n),t),{},{kbUid:null==j?void 0:j.uid,orgUid:null==k?void 0:k.uid,answer:g,questionList:e,answerList:t.answerList,tagList:T,relatedFaqUids:t.relatedFaqUids,startDate:r,endDate:i,enabled:t.enabled,autoSyncLlmQa:t.autoSyncLlmQa,llmQaKbUid:t.llmQaKbUid}))})).catch((function(e){console.log("Form errors:",e),x.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,N.jsxs)($.A,{form:u,submitter:{render:function(){return null}},children:[(0,N.jsx)(J.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:S,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),A(e)}}}),(0,N.jsx)(J.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:i.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){}}}),(0,N.jsx)(X.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,N.jsx)(ee.u,{name:"questionList",label:"相似问法",creatorButtonProps:{creatorButtonText:"添加相似问题",icon:(0,N.jsx)(M.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(G()(Re),[""]);He(e),u.setFieldValue("questionList",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var a=u.getFieldValue("questionList")||[],r=Array.isArray(a)?a.map((function(e){return"string"==typeof e?e:""})):G()(Re);He(r)},onAfterRemove:function(e,t){var n=u.getFieldValue("questionList")||[],a=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];He(a)},actionRender:function(e,t,n){return[(0,N.jsx)(F.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,a=G()(Re);a.splice(n,1),He(a),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var a=e.key,r=c()(e,ge);return(0,N.jsx)(X.Z,l()(l()({},r),{},{placeholder:"请输入相似问题",rules:[{required:!0,message:"请输入相似问题"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:Re[t]||"",onChange:function(e){var n=G()(Re);n[t]=e.target.value,He(n),u.setFieldValue(["questionList",t],e.target.value)}}}),a)}}),(0,N.jsx)($.A.Item,{name:"answer",label:"基础答案",children:(0,N.jsx)(pe.Z,{value:g,toolbarKeys:(0,fe.eD)(),style:{height:"200px",width:"600px"},onChange:function(e){y(e)}})}),(0,N.jsxs)(ue.Z,{orientation:"left",children:["扩展答案列表",(0,N.jsx)(F.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,N.jsx)(ee.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,N.jsx)(M.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,a=e.action,r=t.index;return(0,N.jsx)(ce.Z,{size:"small",style:{marginBottom:16},extra:a,children:n},r)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,N.jsx)("div",{children:e})},children:(0,N.jsxs)(te.UW,{children:[(0,N.jsx)(ne.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,N.jsx)(ae.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,N.jsx)(J.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:we,fieldProps:{placeholder:"请选择相关问题"}}),(0,N.jsx)($.A.Item,{label:"标签",children:(0,N.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[T.map((function(e){return(0,N.jsx)(U.Z,{closable:!0,onClose:function(){return t=e,n=T.filter((function(e){return e!==t})),void P(n);var t,n},children:e},e)})),H?(0,N.jsx)(de.Z,{ref:ie,type:"text",size:"small",style:{width:78},value:_,onChange:function(e){W(e.target.value)},onBlur:ze,onPressEnter:ze}):(0,N.jsxs)(U.Z,{onClick:function(){B(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,N.jsx)(M.Z,{})," 新标签"]})]})}),(0,N.jsx)(re.Z,{name:"dateRange",label:"有效日期",fieldProps:{style:{width:"100%"}}}),(0,N.jsx)(se.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:Se,onChange:function(e){qe(e)}}}),!1]})})})}),ye=n(28425),ve=n(88721),xe=["current","pageSize"],be=function(){var e=(0,V.useIntl)(),t=(0,O.Z)().translateString,n=(0,Y.useRef)(),a=(0,Y.useState)(!0),r=v()(a,2),s=r[0],o=r[1],u=(0,Y.useState)(),d=v()(u,2),p=d[0],g=d[1],y=(0,Y.useState)(!1),Q=v()(y,2),K=Q[0],W=Q[1],G=(0,Y.useState)(1),$=v()(G,2),J=$[0],X=$[1],ee=(0,Y.useState)(10),te=v()(ee,2),ne=te[0],ae=te[1],re=(0,w.u)((function(e){return e.currentOrg})),se=(0,R.j)((function(e){return e.currentKbase})),ie=(0,E.v)((function(e){return e.currentCategory})),oe=(0,E.v)((function(e){return e.categorySelectOptions})),le=(0,Y.useState)(!1),ue=v()(le,2),ce=ue[0],de=ue[1],fe=(0,Y.useState)([]),pe=v()(fe,2),me=pe[0],ge=pe[1],be=(0,Y.useState)([]),we=v()(be,2),Me=we[0],ke=we[1],je=(0,Y.useState)(0),Se=v()(je,2),qe=Se[0],Ze=Se[1],Le=function(){var t=h()(m()().mark((function t(a){var r;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(a),t.next=3,(0,b.Yg)(a);case 3:r=t.sent,console.log("delete response:",r),200===r.code?(null==n||n.current.reload(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ae=function(){var t=h()(m()().mark((function t(){var a,r,s,i,o,l;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Me.length){t.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,s=0,i=f()(Me),t.prev=7,i.s();case 9:if((o=i.n()).done){t.next=23;break}return l=o.value,t.prev=11,t.next=14,(0,b.Yg)(l);case 14:200===t.sent.code?r++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),i.e(t.t1);case 28:return t.prev=28,i.f(),t.finish(28);case 31:x.yw.destroy(),0===s?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:s})),ge([]),ke([]),null===(a=n.current)||void 0===a||a.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Ce=function(){var t=h()(m()().mark((function t(a){var r,s,i,o,l,u;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Me.length){t.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),t.abrupt("return");case 3:x.yw.loading(a?e.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):e.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),s=0,i=0,o=f()(Me),t.prev=7,o.s();case 9:if((l=o.n()).done){t.next=23;break}return u=l.value,t.prev=11,t.next=14,(0,b.kv)({uid:u.uid,enabled:a});case 14:200===t.sent.code?s++:i++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),i++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:x.yw.destroy(),0===i?x.yw.success(a?e.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:s})):x.yw.warning(a?e.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:s,fail:i}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:s,fail:i})),ge([]),ke([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(e){return t.apply(this,arguments)}}(),De=function(){var t=h()(m()().mark((function t(){var a,r,s;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==qe){t.next=3;break}return x.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),t.abrupt("return");case 3:return x.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),t.prev=4,a={categoryUid:(null==ie?void 0:ie.uid)===i.zBg?"":null==ie?void 0:ie.uid,kbUid:null==se?void 0:se.uid,orgUid:null==re?void 0:re.uid},t.next=8,(0,b.QB)(a);case 8:200===(r=t.sent).code?(x.yw.destroy(),x.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=n.current)||void 0===s||s.reloadAndRest()):(x.yw.destroy(),x.yw.error(r.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),x.yw.destroy(),x.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),Ue=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"questionList",width:200,ellipsis:!0,search:!1,render:function(e,t){if(!t.questionList||0===t.questionList.length)return"-";var n=t.questionList.length>3,a=t.questionList.slice(0,3);return(0,N.jsxs)("div",{children:[a.map((function(e,t){return(0,N.jsx)(U.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),n&&(0,N.jsxs)(U.Z,{color:"orange",children:["+",t.questionList.length-3]})]})}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,render:function(e,t){return(0,N.jsx)(_,{content:null==t?void 0:t.answer})}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.type"}),dataIndex:"type",width:100,render:function(e,t){return(0,ve.OI)(t.type)},valueEnum:{text:{text:e.formatMessage({id:"faq.type.text"})},image:{text:e.formatMessage({id:"faq.type.image"})},video:{text:e.formatMessage({id:"faq.type.video"})},file:{text:e.formatMessage({id:"faq.type.file"})}}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,N.jsx)(V.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,render:function(e,t){var n=oe.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,N.jsx)(U.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:oe.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.startDate?z()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.endDate?z()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,N.jsx)(V.FormattedMessage,{id:"faq.updatedAt"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,a,r){return[(0,N.jsx)("a",{onClick:function(){Fe(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,N.jsx)(T.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return Le(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,N.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}],Te=function(){g(void 0),o(!1),W(!0)},Fe=function(e){g(e),o(!0),W(!0)},Pe=function(){var t=h()(m()().mark((function t(a){var r,i;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",a),s?x.yw.loading(e.formatMessage({id:"updating"})):x.yw.loading(e.formatMessage({id:"creating"})),!s){t.next=8;break}return t.next=5,(0,b.y)(a);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,b.kh)(a);case 10:t.t0=t.sent;case 11:r=t.t0,console.log("createFaq response:",a,r),200===r.code?(x.yw.destroy(),x.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),W(!1),null===(i=n.current)||void 0===i||i.reloadAndRest()):(x.yw.destroy(),x.yw.error(r.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ie=function(){var e=h()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleImport"),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,Y.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[se,ie]);var Ye=function(){var t=h()(m()().mark((function t(){return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ye.HK)(i.QPQ,null==re?void 0:re.uid,null==se?void 0:se.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ee=function(){var e=h()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",J,ne),t=localStorage.getItem(i.LA8),window.open((0,B.kG)()+"/api/v1/faq/export?"+new URLSearchParams({pageNumber:String(J-1),pageSize:String(ne),categoryUid:(null==ie?void 0:ie.uid)===i.zBg?"":null==ie?void 0:ie.uid,kbUid:null==se?void 0:se.uid,orgUid:(null==re?void 0:re.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve={selectedRowKeys:me,onChange:function(e,t){ge(e),ke(t)}},Oe=function(){var t=h()(m()().mark((function t(n,a,r){var s,o,u,d,f;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,a,r),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=n.current,o=n.pageSize,u=c()(n,xe),X(s),ae(o),d=l()({pageNumber:s-1,pageSize:o,categoryUid:(null==ie?void 0:ie.uid)===i.zBg?"":null==ie?void 0:ie.uid,kbUid:null==se?void 0:se.uid,orgUid:null==re?void 0:re.uid},u),t.next=8,(0,b.pf)(d);case 8:return f=t.sent,console.log("queryFaqsByOrg response:",d,f),x.yw.destroy(),200===f.code?Ze(f.data.totalElements):x.yw.error(f.message),t.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}();return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(D.Z,{columns:Ue,actionRef:n,cardBordered:!0,rowSelection:Ve,request:Oe,scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){X(e),ae(t)}},dateFormatter:"string",headerTitle:t(null==se?void 0:se.name)+" - 常见问题",tooltip:"所添加FAQ内容会自动添加到 '拆分' 列表中 ",toolBarRender:function(){return function(){var t=[(0,N.jsx)(F.ZP,{icon:(0,N.jsx)(M.Z,{}),type:"primary",onClick:Te,children:e.formatMessage({id:"create"})},"create")],n=[];me.length>0&&n.push({key:"batchDelete",icon:(0,N.jsx)(k.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(me.length,")"),onClick:function(){P.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(me.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ae,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,N.jsx)(j.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(me.length,")"),onClick:function(){return Ce(!0)}},{key:"batchDisable",icon:(0,N.jsx)(S.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(me.length,")"),onClick:function(){return Ce(!1)}}),n.push({key:"deleteAll",icon:(0,N.jsx)(q.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){P.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:De,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.length>0&&t.push((0,N.jsx)(I.Z,{menu:{items:n},placement:"bottom",children:(0,N.jsxs)(F.ZP,{type:me.length>0?"primary":"default",danger:me.length>0,children:[me.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(me.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(Z.Z,{})]})},"batchOperations"));var a=[{key:"import",icon:(0,N.jsx)(L.Z,{}),label:e.formatMessage({id:"import"}),onClick:Ie},{key:"export",icon:(0,N.jsx)(A.Z,{}),label:e.formatMessage({id:"export"}),onClick:Ee},{key:"download",icon:(0,N.jsx)(C.Z,{}),label:e.formatMessage({id:"download.template"}),onClick:function(){return(0,B.IY)()}}];return t.push((0,N.jsx)(I.Z,{menu:{items:a},placement:"bottom",children:(0,N.jsxs)(F.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,N.jsx)(Z.Z,{})]})},"importExport")),t}()}}),(0,N.jsx)(he,{isEdit:s,open:K,faq:p,onClose:function(){return W(!1)},onSubmit:Pe}),ce&&(0,N.jsx)(H.Z,{type:i.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:ce,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),de(!1),null==n||n.current.reload(),Ye()},handleCancel:function(){console.log("handleUploadDragCancel"),de(!1),null==n||n.current.reload()}})]})},we=r.Z.Sider,Me=r.Z.Content,ke=function(){var e=(0,a.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,N.jsx)("div",{children:(0,N.jsxs)(r.Z,{children:[(0,N.jsx)(we,{style:t,children:(0,N.jsx)(s.Z,{type:i.bE7})}),(0,N.jsx)(r.Z,{children:(0,N.jsx)(Me,{style:n,children:(0,N.jsx)(be,{})})})]})})}}}]);