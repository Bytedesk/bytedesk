"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8384],{80556:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(11757),a=t(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},o=t(54183),s=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:i}))};var l=a.forwardRef(s)},32350:function(e,n,t){var r=t(17082),a=t(73457),i=t(44194),o=t(35175),s=t(31549),l=["fieldProps","proFieldProps"],u=function(e,n){var t=e.fieldProps,i=e.proFieldProps,u=(0,a.Z)(e,l);return(0,s.jsx)(o.Z,(0,r.Z)({ref:n,valueType:"textarea",fieldProps:t,proFieldProps:i},u))};n.Z=i.forwardRef(u)},27522:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return b},t5:function(){return v},v_:function(){return p}});var r=t(90819),a=t.n(r),i=t(73193),o=t.n(i),s=t(89933),l=t.n(s),u=t(55735),c=t(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},40679:function(e,n,t){var r=t(10154),a=t.n(r),i=t(73193),o=t.n(i),s=t(90819),l=t.n(s),u=t(89933),c=t.n(u),d=t(45332),f=t.n(d),p=t(86803),m=t(82863),v=t(92053),g=t(76750),b=t(55735),h=t(88721),x=t(32327),y=t(62673),k=t(40269),w=t(3849),j=t(73442),Z=t(75365),M=t(8247),C=t(30921),K=t(44194),P=t(31549),S=x.Z.Text,F=K.memo((function(e){var n,t=e.visible,r=e.onCancel,i=e.onOk,s=e.initialProvider,u=e.initialModel,d=e.initialModelLabel,F=e.providers,T=e.currentOrgUid,R=e.existingProviderModels,L=void 0===R?{}:R,E=e.onModelsLoaded,H=e.allowedModelTypes,V=void 0===H?[]:H,O=(0,C.useIntl)(),q=(0,g.Z)().translateString,I=(0,K.useState)(s||""),N=f()(I,2),A=N[0],U=N[1],z=(0,K.useState)(L),Q=f()(z,2),_=Q[0],D=Q[1],B=(0,K.useState)(s||""),J=f()(B,2),W=J[0],G=J[1],X=(0,K.useState)(u||""),Y=f()(X,2),$=Y[0],ee=Y[1],ne=(0,K.useState)(d||""),te=f()(ne,2),re=te[0],ae=te[1],ie=(0,K.useState)(!1),oe=f()(ie,2),se=oe[0],le=oe[1];(0,K.useEffect)((function(){G(s),ee(u),ae(d),U(s)}),[s,u,d,t]),(0,K.useEffect)((function(){if(t&&A&&!_[A]&&!se){le(!0),p.yw.loading({content:O.formatMessage({id:"loading"}),key:"modelLoading"});var e=F.find((function(e){return e.name===A}));e&&("ollama"===e.name?fe():me(e))}}),[t,A,F]);var ue=(0,K.useCallback)((function(){W&&$&&i(W,$,re)}),[W,$,re,i]),ce=(0,K.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(n){return e.toLowerCase().includes(n.toLowerCase())}))}),[]),de=(0,K.useCallback)((function(e){return e?e.filter((function(e){return!ce(e.value)&&(!V||0===V.length||(!e.type||V.includes(e.type)))})):[]}),[V,ce]),fe=function(){var e=c()(l()().mark((function e(){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,v.VM)();case 3:200===(n=e.sent).code&&n.data?pe():(p.yw.error(n.message),p.yw.destroy("modelLoading"),le(!1)),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),p.yw.error(O.formatMessage({id:"error"})),p.yw.destroy("modelLoading"),le(!1);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=c()(l()().mark((function e(){var n,t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,v.c8)();case 3:200===(n=e.sent).code?(t=n.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),r=de(t),D((function(e){return o()(o()({},e),{},{ollama:r})})),E&&E("ollama",r)):p.yw.error(n.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),p.yw.error(O.formatMessage({id:"error"}));case 11:return e.prev=11,p.yw.destroy("modelLoading"),le(!1),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,7,11,15]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=c()(l()().mark((function e(n){var t,r,i,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:T,level:b.whQ},e.next=4,(0,m.LF)(t);case 4:200===(r=e.sent).code?(i=r.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:n.name}})),s=de(i),D((function(e){return o()(o()({},e),{},a()({},n.name,s))})),E&&E(n.name,s)):p.yw.error(r.message),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),p.yw.error(O.formatMessage({id:"error"}));case 12:return e.prev=12,p.yw.destroy("modelLoading"),le(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[0,8,12,16]])})));return function(n){return e.apply(this,arguments)}}(),ve=(0,K.useCallback)((function(e,n){G(e),ee(n.value),ae(n.label)}),[]),ge=(0,K.useCallback)((function(e){if(U(e),!_[e]&&!se){le(!0),p.yw.loading({content:O.formatMessage({id:"loading"}),key:"modelLoading"});var n=F.find((function(n){return n.name===e}));n&&("ollama"===n.name?fe():me(n))}}),[F,_,se]),be=K.memo((function(e){var n=e.model,t=e.providerName;return(0,P.jsxs)(y.Z,{hoverable:!0,style:{cursor:"pointer",border:$===n.value&&W===t?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return ve(t,n)},children:[(0,P.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,P.jsx)(x.Z.Title,{level:5,style:{margin:0},children:n.label}),(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[n.type&&(0,P.jsx)("div",{style:{marginBottom:8},children:(0,h.Rb)(n.type)}),$===n.value&&W===t&&(0,P.jsx)(k.Z,{status:"processing",text:"已选"})]})]}),n.description&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(x.Z.Text,{type:"secondary",children:null==n?void 0:n.value}),(0,P.jsx)(x.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:n.description})]})]},n.value)}),(function(e,n){return e.model.value===n.model.value&&e.providerName===n.providerName&&($===e.model.value&&W===e.providerName)===($===n.model.value&&W===n.providerName)})),he=(0,K.useMemo)((function(){return F.map((function(e){var n,t;return{key:e.name,label:q(e.nickname),children:(0,P.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,P.jsxs)(w.Z,{direction:"vertical",style:{width:"100%"},children:[se&&A===e.name&&!_[e.name]?(0,P.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,P.jsx)(S,{type:"secondary",children:"加载模型中..."})}):(!_[e.name]||0===(null===(n=_[e.name])||void 0===n?void 0:n.length))&&(0,P.jsx)(S,{type:"secondary",children:"暂无可用模型"}),(0,P.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(t=_[e.name])||void 0===t?void 0:t.map((function(n){return(0,P.jsx)(be,{model:n,providerName:e.name},n.value)}))})]})})}}))}),[F,_,A,se,$,W,q]);return(0,P.jsx)(j.Z,{title:"选择AI模型",open:t,onClose:r,width:700,destroyOnClose:!1,footer:(0,P.jsxs)("div",{style:{textAlign:"right"},children:[(0,P.jsx)(Z.ZP,{onClick:r,style:{marginRight:8},children:"取消"}),(0,P.jsx)(Z.ZP,{onClick:ue,type:"primary",children:"确定"})]}),children:F.length>0&&(0,P.jsx)(M.Z,{activeKey:A||(null===(n=F[0])||void 0===n?void 0:n.name),onChange:ge,items:he,destroyInactiveTabPane:!1})})}),(function(e,n){return e.visible===n.visible&&e.initialProvider===n.initialProvider&&e.initialModel===n.initialModel&&e.initialModelLabel===n.initialModelLabel}));n.Z=F},58384:function(e,n,t){t.d(n,{Z:function(){return Q}});var r=t(90819),a=t.n(r),i=t(89933),o=t.n(i),s=t(45332),l=t.n(s),u=t(53530),c=t(27487),d=t(75365),f=t(96485),p=t(9452),m=t(44194),v=t(10154),g=t.n(v),b=t(73193),h=t.n(b),x=t(86803),y=t(76750),k=t(40612),w=t(55735),j=t(69169),Z=t(84881),M=t(4499),C=t(32350),K=t(32327),P=t(62673),S=t(40679),F=t(36605),T=t(31549),R=function(e){var n,t=e.open,r=e.isEdit,i=e.type,s=e.kbase,c=e.onCancel,d=e.onSubmit,f=j.A.useForm(),p=l()(f,1)[0],v=(0,y.Z)().translateString,b=(0,k.u)((function(e){return e.currentOrg})),R=(0,m.useRef)(null),L=(0,m.useState)([]),E=l()(L,2),H=E[0],V=E[1],O=(0,m.useState)({}),q=l()(O,2),I=q[0],N=q[1],A=(0,m.useState)(!1),U=l()(A,2),z=U[0],Q=U[1],_="ollama",D="bge-m3:latest",B=(0,m.useState)((null==s?void 0:s.embeddingProvider)||_),J=l()(B,2),W=J[0],G=J[1],X=(0,m.useState)((null==s?void 0:s.embeddingModel)||D),Y=l()(X,2),$=Y[0],ee=Y[1],ne=(0,m.useState)(""),te=l()(ne,2),re=te[0],ae=te[1];(0,m.useEffect)((function(){r?(p.setFieldsValue({name:v(null==s?void 0:s.name)}),p.setFieldsValue({headline:v(null==s?void 0:s.headline)}),p.setFieldsValue({footerHtml:v(null==s?void 0:s.footerHtml)}),p.setFieldsValue({descriptionHtml:v(null==s?void 0:s.descriptionHtml)}),p.setFieldsValue({language:null==s?void 0:s.language}),null!=s&&s.embeddingProvider&&(G(s.embeddingProvider),p.setFieldsValue({embeddingProvider:s.embeddingProvider})),null!=s&&s.embeddingModel&&(ee(s.embeddingModel),p.setFieldsValue({embeddingModel:s.embeddingModel}))):(p.resetFields(),p.setFieldsValue({language:"ZH_CN"}),p.setFieldsValue({embeddingProvider:_,embeddingModel:D})),t&&setTimeout((function(){var e;null===(e=R.current)||void 0===e||e.focus()}),100)}),[t,r,s]),(0,m.useEffect)((function(){t&&i===w.QPQ&&ie()}),[t,i]),(0,m.useEffect)((function(){if(W&&$&&I[W]){var e=I[W].find((function(e){return e.value===$}));e&&ae(e.label)}}),[I,W,$]);var ie=function(){var e=o()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==b?void 0:b.uid,level:w.whQ},e.next=4,(0,F.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t.data,n),200===t.code?(r=t.data.content||[],V(r)):x.yw.error(t.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),oe=(0,m.useCallback)((function(){}),[]),se=(0,m.useCallback)((function(){Q(!1)}),[]),le=(0,m.useCallback)((function(e,n,t){G(e),ee(n),ae(t),p.setFieldValue("embeddingProvider",e),p.setFieldValue("embeddingModel",n),Q(!1)}),[p]),ue=(0,m.useCallback)((function(e,n){N((function(t){return h()(h()({},t),{},g()({},e,n))}))}),[]),ce=function(){p.validateFields().then(function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:r?null==s?void 0:s.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:i,language:n.language,embeddingProvider:n.embeddingProvider||_,embeddingModel:n.embeddingModel||D,orgUid:null==b?void 0:b.uid},d(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),x.yw.error("创建知识库失败")}))},de=function(e){"Enter"===e.key&&ce()};return(0,T.jsxs)("div",{children:[(0,T.jsx)(u.Z,{title:"新建知识库",open:t,forceRender:!0,onOk:ce,onCancel:c,children:(0,T.jsxs)(j.A,{form:p,submitter:!1,children:[(0,T.jsx)(Z.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,T.jsx)(M.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称",ref:R}}),i===w.VX&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(M.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称"}}),(0,T.jsx)(C.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,T.jsx)(C.Z,{label:"描述",name:"descriptionHtml"}),i===w.QPQ&&(0,T.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,T.jsx)(K.Z.Text,{strong:!0,style:{marginRight:"8px"},children:"嵌入模型选择："}),(0,T.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,T.jsx)(P.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:oe,children:W&&$?(0,T.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,T.jsxs)("div",{children:[(0,T.jsx)(K.Z.Text,{type:"secondary",children:"供应商："}),(0,T.jsx)(K.Z.Text,{strong:!0,children:v((null===(n=H.find((function(e){return e.name===W})))||void 0===n?void 0:n.nickname)||W)}),(0,T.jsx)("br",{}),(0,T.jsx)(K.Z.Text,{type:"secondary",children:"模型："}),(0,T.jsx)(K.Z.Text,{strong:!0,children:re||$})]})}):(0,T.jsx)("div",{style:{textAlign:"center"}})})}),(0,T.jsxs)("div",{style:{display:"none"},children:[(0,T.jsx)(Z.Z,{name:"embeddingProvider",width:"lg"}),(0,T.jsx)(Z.Z,{name:"embeddingModel",width:"lg"})]})]})]})}),i===w.QPQ&&(0,T.jsx)(S.Z,{visible:z,onCancel:se,onOk:le,initialProvider:W,initialModel:$,initialModelLabel:re,providers:H,currentOrgUid:null==b?void 0:b.uid,existingProviderModels:I,onModelsLoaded:ue,allowedModelTypes:[w.xTq]})]})},L=t(27522),E=t(6397),H=t(23864),V=t(30921),O=t(15722),q=t(82669),I=t(80556),N=t(59304),A=t(54881),U=t(2484),z=u.Z.confirm,Q=function(e){var n=e.type,t=(0,V.useIntl)(),r=(0,m.useState)(!1),i=l()(r,2),s=i[0],u=i[1],v=(0,m.useRef)(!1),g=(0,m.useState)(!1),b=l()(g,2),h=b[0],j=b[1],Z=(0,H.Z)().isDarkMode,M=(0,y.Z)().translateString,C=(0,k.u)((function(e){return e.currentOrg})),K=(0,m.useState)(!0),P=l()(K,2),S=P[0],F=P[1],Q=(0,E.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),_=Q.kbaseResult,D=Q.currentKbase,B=Q.insertKbase,J=Q.updateLocalKbase,W=Q.setKbaseResult,G=Q.setCurrentKbase,X=Q.removeKbase,Y=function(){var e=o()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.current){e.next=3;break}return console.log("isLoading: 1",v.current),e.abrupt("return");case 3:return v.current=!0,u(!0),x.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==C?void 0:C.uid},e.next=9,(0,L.AP)(t);case 9:r=e.sent,console.log("queryKbasesByOrg: ",r),200===r.code?(x.yw.destroy(),W(r)):(x.yw.destroy(),x.yw.error(r.message)),v.current=!1,u(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){console.log("useEffect"),Y()}),[]);var $=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",x.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,L.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(B(r.data),G(r.data),x.yw.success({content:"创建成功！",key:t,duration:2}),j(!1)):(console.log("create kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",x.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,L.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(J(r.data),G(r.data),x.yw.success({content:"更新成功！",key:t,duration:2}),j(!1)):(console.log("update kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ne=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",D),F(!0),j(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S?ee(n):$(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=o()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==_.data.content.length){e.next=4;break}return x.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,L._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(X(n.uid),Y()):(console.log("handleDeleteKbase: ",r),x.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(e){return n!==w._FS?M(e.descriptionHtml):e.level===w.Hxq?"全平台客服可见":e.level===w.whQ?"本组织客服可见":e.level===w.fyH?"本客服可见":M(e.descriptionHtml)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(c.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,T.jsxs)(c.Z,{gap:"small",children:[(0,T.jsx)(d.ZP,{type:"primary",size:"small",icon:(0,T.jsx)(q.Z,{}),onClick:function(){console.log("new kb"),F(!1),j(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,T.jsx)(d.ZP,{size:"small",icon:(0,T.jsx)(I.Z,{spin:s}),onClick:Y,loading:s,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==D?void 0:D.uid)&&(0,T.jsx)(f.Z,{menu:{items:[{key:"edit",icon:(0,T.jsx)(N.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ne},{key:"delete",icon:(0,T.jsx)(A.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){z({title:t.formatMessage({id:"deleteTip"}),icon:(0,T.jsx)(O.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(e.name),"】？"),onOk:function(){re(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(D)}}]},children:(0,T.jsx)(d.ZP,{size:"small",icon:(0,T.jsx)(U.Z,{})})})]}),(0,T.jsx)(p.Z,{itemLayout:"horizontal",dataSource:_.data.content,renderItem:function(e,n){return(0,T.jsx)(p.Z.Item,{style:D.uid===e.uid?{backgroundColor:Z?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){G(e)},children:(0,T.jsx)(p.Z.Item.Meta,{style:{marginLeft:"10px"},title:M(e.name),description:ae(e)})})}}),h&&(0,T.jsx)(R,{open:h,isEdit:S,type:n,kbase:D,onSubmit:te,onCancel:function(){j(!1)}})]})}},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),i=t(76711),o=t.n(i),s=t(55735),l=t(44435),u=t(83642),c=t(83890),d=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,i=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==i){var s=[].concat(o()(r.slice(0,i)),[t],o()(r.slice(i+1))),l=a()(a()({},n().kbaseResult),{},{data:{content:s}});e({kbaseResult:l,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,i=r.findIndex((function(e){return e.uid===t}));-1!==i?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,i)),o()(r.slice(i+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:s.wKE})))}}]);