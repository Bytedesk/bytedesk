"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{12201:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(38404),s=n(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},a=n(5901),o=function(e,t){return s.createElement(a.Z,(0,i.Z)({},e,{ref:t,icon:r}))};var l=s.forwardRef(o)},54681:function(e,t,n){var i=n(90819),s=n.n(i),r=n(89933),a=n.n(r),o=n(45332),l=n.n(o),u=n(64273),d=n(50884),c=n(92936),g=n(77129),f=n(21002),v=n(28520),m=n(27353),p=n(54685),h=n(97588),b=n(17455),x=n(2290),S=n(44194),M=n(53478),y=n(97765),w=n(31549);t.Z=function(e){var t,n,i,r,o=h.A.useForm(),j=l()(o,1)[0],C=(0,x.useIntl)(),k=(0,f.Z)().translateString,Z=(0,v.u)((function(e){return e.currentOrg})),T=(0,S.useState)(),F=l()(T,2),U=F[0],q=F[1],P=(0,S.useState)(),A=l()(P,2),R=A[0],I=A[1],K=(0,S.useState)(),E=l()(K,2),O=E[0],z=E[1],D=(0,S.useState)(""),N=l()(D,2),B=N[0],L=N[1],J=(0,S.useRef)(!1),_=(0,S.useRef)(),V=(0,S.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),H=(0,S.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),W=(0,S.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,S.useCallback)((function(e){j.setFieldValue("welcomeTip",e),W({welcomeTip:e})}),[j,W]);(0,S.useEffect)((function(){if(null!=Z&&Z.uid&&(_.current!==Z.uid&&(_.current=Z.uid,J.current=!1),!J.current)){J.current=!0;var e=function(){var e=a()(s()().mark((function e(){var t,n,i,r,a,o,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(C.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:Z.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(I(n),a=(null==n||null===(i=n.data)||void 0===i?void 0:i.content)||[],o=null==H?void 0:H.welcomeKbUid,(l=o||O||(null===(r=a[0])||void 0===r?void 0:r.uid))&&(z(l),j.setFieldValue("welcomeKbUid",l),o!==l&&W({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==Z?void 0:Z.uid,C,null==H?void 0:H.welcomeKbUid,O,j,W]),(0,S.useEffect)((function(){if(null!=Z&&Z.uid&&O){var e=function(){var e=a()(s()().mark((function e(){var t,n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(C.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:Z.uid,kbUid:O},e.next=4,(0,c.pf)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?q(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==Z?void 0:Z.uid,O,C]),(0,S.useEffect)((function(){if(H){var e=null==H?void 0:H.welcomeFaqs,t=Array.isArray(H.welcomeFaqUids)?H.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==U||null===(t=U.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==H?void 0:H.welcomeFaqUids,H]);var G=(0,S.useCallback)((function(e){z(e),j.setFieldValue("welcomeFaqUids",[]),W({welcomeKbUid:e,welcomeFaqUids:[]})}),[W,j]);return(0,S.useEffect)((function(){var e=k(null==H?void 0:H.welcomeTip);void 0!==e&&B!==e&&L(e),null!=H&&H.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",H.welcomeKbUid),O!==H.welcomeKbUid&&z(H.welcomeKbUid))}),[k,null==H?void 0:H.welcomeTip,null==H?void 0:H.welcomeKbUid,B,j,O,null==R||null===(n=R.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,w.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,w.jsx)(h.A.Item,{name:"welcomeTip",label:(0,w.jsxs)("span",{children:[C.formatMessage({id:"agent.settings.welcome.tip"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:C.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:C.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,w.jsx)(M.Z,{placeholder:C.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:B,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,w.jsx)(b.Z,{name:"welcomeKbUid",width:"md",label:(0,w.jsxs)("span",{children:[C.formatMessage({id:"menu.kbase.select",defaultMessage:"é€‰æ‹©çŒœä½ æƒ³é—®çŸ¥è¯†åº“"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==R||null===(i=R.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:k(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,w.jsx)(b.Z,{name:"welcomeFaqUids",width:"md",label:(0,w.jsxs)("span",{children:[C.formatMessage({id:"menu.kbase.faq.welcome"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==U||null===(r=U.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.map((function(e){return{label:k(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return W({welcomeFaqUids:e})}}})]})}},49673:function(e,t,n){n.r(t),n.d(t,{default:function(){return ge}});var i=n(44194),s=n(10820),r=n(2290),a=n(76711),o=n.n(a),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),v=n(45332),m=n.n(v),p=n(15911),h=n(90883),b=n(46206),x=n(31461),S=n(2887),M=n(18464),y=n(38623),w=n(50693),j=n(70937),C=n(35746),k=n(64724),Z=n(12201),T=n(88565),F=n(6430),U=n(12715),q=n(47192),P=n(33551),A=n(86775),R=n(65794),I=n(6992),K=n(41881),E=n(91768),O=n(28172),z=n(66556),D=n(35911),N=n(90417),B=n(9848),L=n(50884),J=n(48301),_=n(28520),V=n(90938),H=n(96775),W=n(32461),Y=n(27318),G=n(62210),Q=n(21525),$=(n(10463),n(2533)),X=n(30722),ee=n(17345),te=n(69897),ne=n(54681),ie=(n(64273),n(31549)),se=n(80650),re=n(26809),ae=(n(30881),n(97765)),oe=n(61476),le="welcome",ue=function(){var e,t,n,a,l,d,g,v,ue=(0,r.useIntl)(),de=(0,r.useAccess)(),ce=(0,_.u)((function(e){return e.currentOrg})),ge=(0,V.Z)().leftSiderStyle,fe=(0,H.Z)().isDarkMode,ve=(0,i.useState)(!1),me=m()(ve,2),pe=me[0],he=me[1],be=(0,i.useState)([]),xe=m()(be,2),Se=xe[0],Me=xe[1],ye=(0,i.useState)(),we=m()(ye,2),je=we[0],Ce=we[1],ke=(0,i.useState)(""),Ze=m()(ke,2),Te=Ze[0],Fe=Ze[1],Ue=(0,i.useState)(le),qe=m()(Ue,2),Pe=qe[0],Ae=qe[1],Re=(0,i.useState)(!1),Ie=m()(Re,2),Ke=Ie[0],Ee=Ie[1],Oe=(0,i.useState)(null),ze=m()(Oe,2),De=ze[0],Ne=ze[1],Be=(0,i.useState)(!1),Le=m()(Be,2),Je=Le[0],_e=Le[1],Ve=(0,i.useMemo)((function(){return Se.find((function(e){return e.uid===je}))||null}),[Se,je]),He=(0,i.useState)(!1),We=m()(He,2),Ye=We[0],Ge=We[1],Qe=(0,i.useState)(!1),$e=m()(Qe,2),Xe=$e[0],et=$e[1],tt=(0,i.useState)(!1),nt=m()(tt,2),it=nt[0],st=nt[1],rt=(0,i.useRef)(""),at=(0,W.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),ot=at.setCurrentRobotSettings,lt=at.currentRobotSettings,ut=(0,i.useMemo)((function(){var e;return null!==(e=null!=lt?lt:Ve)&&void 0!==e?e:null}),[lt,Ve]),dt=(0,i.useMemo)((function(){var e;return null==de||null===(e=de.getModulePermission)||void 0===e?void 0:e.call(de,Y.MY.ROBOT_SETTINGS)}),[de]),ct=null!==(e=null==dt||null===(t=dt.canRead)||void 0===t?void 0:t.call(dt))&&void 0!==e&&e,gt=null!==(n=null==dt||null===(a=dt.canCreate)||void 0===a?void 0:a.call(dt))&&void 0!==n&&n,ft=null!==(l=null==dt||null===(d=dt.canUpdate)||void 0===d?void 0:d.call(dt))&&void 0!==l&&l,vt=null!==(g=null==dt||null===(v=dt.canDelete)||void 0===v?void 0:v.call(dt))&&void 0!==g&&g,mt=(0,i.useRef)(!1),pt=function(e,t){L.yw.warning(ue.formatMessage({id:e,defaultMessage:t}))},ht=(0,i.useCallback)((function(e){if(lt){var t=lt.draftServiceSettings||lt.serviceSettings||{};ot(f()(f()({},lt),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[lt,ot]),bt=(0,i.useCallback)((function(e){if(lt){var t=lt.draftTriggerSettings||lt.triggerSettings||{};ot(f()(f()({},lt),{},{draftTriggerSettings:f()(f()({},t),e)}))}}),[lt,ot]),xt=((0,i.useCallback)((function(e){if(lt){var t=lt.draftSummarySettings||lt.summarySettings||{};ot(f()(f()({},lt),{},{draftSummarySettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,i.useCallback)((function(e){if(lt){var t=lt.draftInviteSettings||lt.inviteSettings||{};ot(f()(f()({},lt),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[lt,ot])),St=((0,i.useCallback)((function(e){if(lt){var t=lt.draftIntentionSettings||lt.intentionSettings||{};ot(f()(f()({},lt),{},{draftIntentionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,i.useCallback)((function(e){if(lt){var t=lt.draftEmotionSettings||lt.emotionSettings||{};ot(f()(f()({},lt),{},{draftEmotionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,i.useCallback)((function(e){var t;if(lt){var n=lt.draftToolsSettings||lt.toolsSettings||{};ot(f()(f()({},lt),{},{draftToolsSettings:f()(f()(f()({},n),e),{},{toolConfigs:null!==(t=e.toolConfigs)&&void 0!==t?t:n.toolConfigs})}))}}),[lt,ot]),(0,i.useMemo)((function(){if(!Te)return Se;var e=Te.toLowerCase();return Se.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[Se,Te])),Mt=(0,i.useCallback)(function(){var e=c()(u()().mark((function e(t,n){var i,s,r,a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=ce&&ce.uid){e.next=2;break}return e.abrupt("return");case 2:if(ct){e.next=9;break}return mt.current||(mt.current=!0,pt("robot_settings.permission.read.denied","æ— æƒé™ï¼šæŸ¥çœ‹æœºå™¨äººé…ç½®")),Me([]),Ce(void 0),ot(null),st(!1),e.abrupt("return");case 9:return he(!0),e.prev=10,s=(null!=t?t:"").trim(),r={orgUid:ce.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=15,(0,J.VW)(r);case 15:a=e.sent,ae.Z.debug("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",a,r),o=(null==a||null===(i=a.data)||void 0===i?void 0:i.content)||[],Me(o),!(o.length>0)||je&&o.some((function(e){return e.uid===je}))||(Ce(o[0].uid),null!=n&&n.keepActive||Ae(le));case 20:return e.prev=20,he(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[10,,20,23]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==ce?void 0:ce.uid,je,ct,ot]),yt=(0,i.useCallback)((function(e){Mt(null!=e?e:Te)}),[Mt,Te]);(0,i.useEffect)((function(){Mt(Te)}),[null==ce?void 0:ce.uid]),(0,i.useEffect)((function(){Ve?(ot(Ve),rt.current=JSON.stringify(null!=Ve?Ve:{}),st(!1)):(ot(null),rt.current=JSON.stringify({}),st(!1))}),[Ve]),(0,i.useEffect)((function(){if(Ve)try{var e,t,n=JSON.stringify(null!=lt?lt:{}),i=n!==rt.current;ae.Z.debug("ğŸ” [Dirty Check]",{isDirty:i,selectedUid:null==Ve?void 0:Ve.uid,currentWelcomeTip:(null==lt||null===(e=lt.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==lt||null===(t=lt.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:rt.current.length,nowLength:n.length}),st(i)}catch(e){st(!0)}}),[lt,null==Ve?void 0:Ve.uid]);var wt=function(){var e=c()(u()().mark((function e(t){var n,i,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vt){e.next=3;break}return pt("robot_settings.permission.delete.denied","æ— æƒé™ï¼šåˆ é™¤æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=(n=null!=t?t:Ve)&&n.uid){e.next=6;break}return e.abrupt("return");case 6:return i={uid:n.uid,orgUid:null==ce?void 0:ce.uid,pageNumber:0,pageSize:100},e.next=9,(0,J.r$)(i);case 9:(s=e.sent)&&200===s.code?(L.yw.success(ue.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),Mt(Te)):L.yw.error((null==s?void 0:s.message)||ue.formatMessage({id:"delete.error",defaultMessage:"åˆ é™¤å¤±è´¥"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=c()(u()().mark((function e(t,n){var i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return pt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:return e.prev=3,e.next=6,(0,J.sK)({uid:t,orgUid:null==ce?void 0:ce.uid,enabled:n});case 6:(i=e.sent)&&200===i.code?(L.yw.success(ue.formatMessage({id:n?"common.enabled":"common.disabled",defaultMessage:n?"å·²å¯ç”¨":"å·²åœç”¨"})),Mt(Te)):L.yw.error((null==i?void 0:i.message)||ue.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",e.t0),L.yw.error(ue.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"}));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}(),Ct=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},kt=function(e){if(e){var t=Ct(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputAssociationKbUid","inputPreviewEnabled","inputPreviewAlwaysShow","inputPreviewShowSeconds","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","requireLogin","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var s=null==e?void 0:e[i];if(Array.isArray(s)){var r=s.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);r.length>0&&(t[n]=r)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickButtonUids","quickButtons"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs");var i=function(e){if(e)return Ct(e,["smile","upload","image","file","uploadRobot","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},Zt=function(e){if(e){var t=null==e?void 0:e.triggers;return Array.isArray(t)?{uid:null==e?void 0:e.uid,triggers:t.map((function(e){return{uid:null==e?void 0:e.uid,triggerKey:null==e?void 0:e.triggerKey,enabled:null==e?void 0:e.enabled,type:null==e?void 0:e.type,name:null==e?void 0:e.name,description:null==e?void 0:e.description,config:null==e?void 0:e.config}}))}:Ct(e,["uid"])}},Tt=function(e){if(e)return Ct(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ft=function(e){if(e)return Ct(e,["name","description","color","order","robotUid","enabled","executionTiming"])},Ut=function(e){if(e)return Ct(e,["name","description","robotUid","enabled","executionTiming"])},qt=function(e){if(e)return Ct(e,["name","description","defaultTemplate","robotUid","enabled","executionTiming"])},Pt=function(e){if(e)return Ct(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},At=function(e){if(e){var t=Ct(e,["enabled","invocationMode","toolChoice","maxToolInvocations","defaultToolPrompt"]);return e.toolConfigs&&(t.toolConfigs=e.toolConfigs.map((function(e){return Ct(e,["key","name","description","category","icon","enabled","bindingType","beanName","className","methodName","endpoint","inputSchema","outputSchema","systemPrompt","orderIndex","requiresApproval","metadata"])}))),t}},Rt=function(){var e=c()(u()().mark((function e(){var t,n,i,s,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return pt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=Ve&&Ve.uid){e.next=6;break}return L.yw.warning(ue.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:return Ge(!0),e.prev=7,t=lt&&lt.uid===Ve.uid?lt:Ve,n=function(e,t){return f()(f()({},e||{}),t||{})},i={uid:Ve.uid,orgUid:null==ce?void 0:ce.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,isDefault:null==t?void 0:t.isDefault,enabled:null==t?void 0:t.enabled,serviceSettings:kt(n(null==t?void 0:t.serviceSettings,null==t?void 0:t.draftServiceSettings)),triggerSettings:Zt(n(null==t?void 0:t.triggerSettings,null==t?void 0:t.draftTriggerSettings)),inviteSettings:Tt(n(null==t?void 0:t.inviteSettings,null==t?void 0:t.draftInviteSettings)),intentionSettings:Ft(n(null==t?void 0:t.intentionSettings,null==t?void 0:t.draftIntentionSettings)),emotionSettings:Ut(n(null==t?void 0:t.emotionSettings,null==t?void 0:t.draftEmotionSettings)),summarySettings:qt(n(null==t?void 0:t.summarySettings,null==t?void 0:t.draftSummarySettings)),rateDownSettings:Pt(n(null==t?void 0:t.rateDownSettings,null==t?void 0:t.draftRateDownSettings)),toolsSettings:At(n(null==t?void 0:t.toolsSettings,null==t?void 0:t.draftToolsSettings))},e.next=13,(0,J.sK)(i);case 13:s=e.sent,ae.Z.debug("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",s,i),s&&200===s.code?(L.yw.success(ue.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),rt.current=JSON.stringify(null!==(r=null!==(a=null==s?void 0:s.data)&&void 0!==a?a:t)&&void 0!==r?r:{}),st(!1),Mt(Te)):L.yw.error((null==s?void 0:s.message)||ue.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("ä¿å­˜å¤±è´¥:",e.t0),L.yw.error(ue.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"}));case 22:return e.prev=22,Ge(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),It=function(){var e=c()(u()().mark((function e(){var t,n,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return pt("robot_settings.permission.update.denied","æ— æƒé™ï¼šå‘å¸ƒæœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=Ve&&Ve.uid){e.next=6;break}return L.yw.warning(ue.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:if(et(!0),e.prev=7,!it){e.next=11;break}return e.next=11,Rt();case 11:return t={uid:Ve.uid,orgUid:null==ce?void 0:ce.uid},e.next=14,(0,J.KF)(t);case 14:(n=e.sent)&&200===n.code?(L.yw.success(ue.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),rt.current=JSON.stringify(null!==(i=null==n?void 0:n.data)&&void 0!==i?i:{}),st(!1),Mt(Te,{keepActive:!0})):L.yw.error((null==n?void 0:n.message)||ue.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("å‘å¸ƒå¤±è´¥:",e.t0),L.yw.error(ue.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"}));case 22:return e.prev=22,et(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),Kt=(0,i.useMemo)((function(){return null!=Ve&&Ve.uid?[{key:"welcome",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(Z.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"})]}),children:(0,ie.jsx)(ne.Z,{serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht})},{key:"tips",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(T.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"})]}),children:(0,ie.jsx)(te.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht})},{key:"service",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(F.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"})]}),children:(0,ie.jsx)(ee.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht})}].concat(o()([]),o()((0,oe.OJ)()?[{key:"inputAssociation",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(U.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"robot.settings.input.association",defaultMessage:"è¾“å…¥è”æƒ³"})]}),children:(0,ie.jsx)(G.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht})}]:[]),o()((0,oe.OJ)()?[{key:"rate",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(q.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,ie.jsx)(re.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht})}]:[]),o()((0,oe.OJ)()?[{key:"toolbar",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(P.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,ie.jsx)(X.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},settingsUid:Ve.uid,isActive:"toolbar"===Pe,onServiceSettingsChange:ht})}]:[]),o()((0,oe.OJ)()?[{key:"right",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(A.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,ie.jsx)(Q.Z,{variant:"robot",serviceSettings:{live:null==ut?void 0:ut.serviceSettings,draft:null==ut?void 0:ut.draftServiceSettings},onServiceSettingsChange:ht,settingsUid:Ve.uid,isActive:"right"===Pe})}]:[]),o()((0,oe.OJ)()?[{key:"trigger",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(R.Z,{})," ",(0,ie.jsx)(r.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"})]}),children:(0,ie.jsx)($.Z,{variant:"robot",triggerSettings:{live:null==ut?void 0:ut.triggerSettings,draft:null==ut?void 0:ut.draftTriggerSettings},onTriggerSettingsChange:bt})}]:[]),o()([]),o()([])):[]}),[null==Ve?void 0:Ve.uid,ut,ht,bt,xt,ue,Pe]);return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ie.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:ge,children:(0,ie.jsxs)(B.Z,{title:ue.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:gt?(0,ie.jsx)(h.ZP,{size:"small",icon:(0,ie.jsx)(I.Z,{}),type:"primary",onClick:function(){gt?(Ne(null),Ee(!0)):pt("robot_settings.permission.create.denied","æ— æƒé™ï¼šåˆ›å»ºæœºå™¨äººé…ç½®")},children:(0,ie.jsx)(r.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}):null,bodyStyle:{padding:8},loading:pe,children:[(0,ie.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ie.jsxs)(b.Z.Compact,{style:{width:"100%"},children:[(0,ie.jsx)(x.Z,{placeholder:ue.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:Te,onChange:function(e){return Fe(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;Fe(t),yt(t)},allowClear:!0,size:"middle"}),(0,ie.jsx)(h.ZP,{type:"primary",icon:(0,ie.jsx)(U.Z,{}),"aria-label":ue.formatMessage({id:"common.search",defaultMessage:"æœç´¢"}),onClick:function(){return yt()}})]})}),(0,ie.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ie.jsx)(S.Z,{dataSource:St,locale:{emptyText:(0,ie.jsx)(M.Z,{description:ue.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ie.jsx)(S.Z.Item,{style:je===e.uid?{backgroundColor:fe?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Ce(e.uid)},children:(0,ie.jsx)(S.Z.Item.Meta,{title:(0,ie.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ie.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ie.jsx)(b.Z,{size:4,children:e.isDefault?(0,ie.jsx)(y.Z,{color:"blue",children:(0,ie.jsx)(r.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null})]}),description:e.description?(0,ie.jsx)("div",{style:{color:fe?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ie.jsx)(p.Z.Panel,{children:Ve?(0,ie.jsx)(B.Z,{title:(0,ie.jsxs)(b.Z,{children:[(0,ie.jsxs)("span",{children:[ue.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",Ve.name||Ve.uid]}),(0,ie.jsx)(w.Z,{checked:!!Ve.enabled,onChange:function(e){return jt(Ve.uid,e)},disabled:!ft,checkedChildren:ue.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:ue.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),ft?(0,ie.jsx)(h.ZP,{size:"small",icon:(0,ie.jsx)(K.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=Ve,ft?(Ne(null!=t?t:Ve),Ee(!0)):pt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®")},children:(0,ie.jsx)(r.FormattedMessage,{id:"pages.common.edit",defaultMessage:"ç¼–è¾‘"})}):null,vt?(0,ie.jsx)(j.Z,{title:ue.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),wt(Ve)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:ue.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:ue.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,ie.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,ie.jsx)(E.Z,{}),onClick:function(e){e.stopPropagation()},children:(0,ie.jsx)(r.FormattedMessage,{id:"pages.common.delete",defaultMessage:"åˆ é™¤"})})}):null,Ve.isDefault?(0,ie.jsx)(y.Z,{color:"blue",children:(0,ie.jsx)(r.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null]}),extra:(0,ie.jsxs)(b.Z,{children:[(0,ie.jsx)(j.Z,{title:ue.formatMessage({id:"settings.publish.online.title",defaultMessage:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ"}),description:ue.formatMessage({id:"settings.publish.online.desc",defaultMessage:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ"}),okText:ue.formatMessage({id:"settings.publish.online.ok",defaultMessage:"ç»§ç»­å‘å¸ƒ"}),cancelText:ue.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),It()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ie.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Xe,disabled:!ft,type:"default",icon:(0,ie.jsx)(O.Z,{}),children:(0,ie.jsx)(r.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,ie.jsx)(h.ZP,{onClick:function(e){e.stopPropagation(),_e(!0)},disabled:!ft,type:"default",icon:(0,ie.jsx)(z.Z,{}),children:(0,ie.jsx)(r.FormattedMessage,{id:"settings.gray.publish",defaultMessage:"ç°åº¦å‘å¸ƒ"})}),(0,ie.jsx)(h.ZP,{onClick:function(){Ve&&(ot(Ve),rt.current=JSON.stringify(null!=Ve?Ve:{}),st(!1))},disabled:!it||!ft,icon:(0,ie.jsx)(D.Z,{}),children:(0,ie.jsx)(r.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,ie.jsx)(h.ZP,{type:"primary",loading:Ye,onClick:Rt,disabled:!it||!ft,icon:(0,ie.jsx)(N.Z,{}),children:(0,ie.jsx)(r.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,ie.jsx)(s.Z,{activeKey:Pe,onChange:Ae,items:Kt})}):(0,ie.jsx)(B.Z,{children:(0,ie.jsx)(M.Z,{description:ue.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,ie.jsx)(se.Z,{open:Ke,onOpenChange:Ee,orgUid:(null==ce?void 0:ce.uid)||"",record:De,onSuccess:function(){Ee(!1),Mt(Te)}}),(0,ie.jsxs)(C.Z,{title:ue.formatMessage({id:"settings.gray.publish.title",defaultMessage:"ç°åº¦å‘å¸ƒè¯´æ˜"}),open:Je,onCancel:function(){return _e(!1)},footer:[(0,ie.jsx)(h.ZP,{onClick:function(){return _e(!1)},children:(0,ie.jsx)(r.FormattedMessage,{id:"common.close",defaultMessage:"å…³é—­"})},"close"),(0,ie.jsx)(h.ZP,{type:"primary",onClick:function(){_e(!1),r.history.push("/service/channel")},children:(0,ie.jsx)(r.FormattedMessage,{id:"settings.gray.publish.go.channel",defaultMessage:"å‰å¾€æ¸ é“é¡µé¢è·å–é“¾æ¥"})},"go")],children:[(0,ie.jsx)(k.Z.Paragraph,{children:(0,ie.jsx)(r.FormattedMessage,{id:"settings.gray.publish.p1",defaultMessage:"ç°åº¦å‘å¸ƒç”¨äºæµ‹è¯•å½“å‰è‰ç¨¿ï¼ˆdraftï¼‰é…ç½®ï¼Œç‚¹å‡»ä¿å­˜ï¼Œä½†æœªç‚¹å‡»å‘å¸ƒï¼Œä¸ä¼šå½±å“çº¿ä¸Šç¯å¢ƒã€‚"})}),(0,ie.jsx)(k.Z.Paragraph,{children:(0,ie.jsx)(r.FormattedMessage,{id:"settings.gray.publish.p2",defaultMessage:"åœ¨æ¸ é“é¡µé¢ç”Ÿæˆé“¾æ¥æ—¶å‹¾é€‰â€œç°åº¦æµ‹è¯•â€ï¼Œé“¾æ¥ä¼šè¿½åŠ  {draft1}ï¼›åµŒå…¥å¼è„šæœ¬ä¼šåœ¨ {chatConfig} ä¸­å¢åŠ  {draftTrue}ã€‚",values:{draft1:(0,ie.jsx)(k.Z.Text,{code:!0,children:"draft=1"}),chatConfig:(0,ie.jsx)(k.Z.Text,{code:!0,children:"chatConfig"}),draftTrue:(0,ie.jsx)(k.Z.Text,{code:!0,children:"draft: true"})}})})]})]})},de=n(57843),ce=n(27353),ge=function(){var e,t,n,a,o,l,u,d,c=(0,r.useAccess)(),g=null!==(e=null==c||null===(t=c.hasAnyModulePermission)||void 0===t?void 0:t.call(c,Y.MY.ROBOT))&&void 0!==e&&e,f=null!==(n=null==c||null===(a=c.hasAnyModulePermission)||void 0===a?void 0:a.call(c,Y.MY.ROBOT_SETTINGS))&&void 0!==n&&n,v=null!==(o=null==c||null===(l=c.hasAnyModulePermission)||void 0===l?void 0:l.call(c,Y.MY.PROMPT))&&void 0!==o&&o,m=!g&&!f&&v,p=[];if(g&&p.push({key:"table",label:(0,ie.jsx)(r.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,ie.jsx)(de.Z,{robotType:ce.f4h})}),f&&p.push({key:"settings",label:(0,ie.jsx)(r.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,ie.jsx)(ue,{})}),(0,i.useEffect)((function(){m&&r.history.replace("/ai/prompt")}),[m]),0===p.length)return null;var h=String(null!==(u=null===(d=p[0])||void 0===d?void 0:d.key)&&void 0!==u?u:"table");return(0,ie.jsx)(s.Z,{defaultActiveKey:h,style:{padding:"10px"},items:p})}}}]);