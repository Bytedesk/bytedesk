"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{31806:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},r=n(54183),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},58791:function(e,t,n){var i=n(83910),a=n(44194),s=n(85333),r=n(54183),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s.Z}))},l=a.forwardRef(o);t.Z=l},33798:function(e,t,n){var i=n(90819),a=n.n(i),s=n(89933),r=n.n(s),o=n(45332),l=n.n(o),u=n(74341),d=n(93527),c=n(11591),g=n(67559),f=n(44679),v=n(14888),m=n(6844),p=n(90104),h=n(30064),x=n(68263),S=n(19736),w=n(44194),M=n(53816),y=n(36125),b=n(31549);t.Z=function(e){var t,n,i,s,o=h.A.useForm(),j=l()(o,1)[0],k=(0,S.useIntl)(),Z=(0,f.Z)().translateString,F=(0,v.u)((function(e){return e.currentOrg})),C=(0,w.useState)(),T=l()(C,2),q=T[0],U=T[1],A=(0,w.useState)(),L=l()(A,2),R=L[0],E=L[1],I=(0,w.useState)(),P=l()(I,2),z=P[0],B=P[1],N=(0,w.useState)(""),O=l()(N,2),K=O[0],D=O[1],W=(0,w.useRef)(!1),J=(0,w.useRef)(),V=(0,w.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),Q=(0,w.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),H=(0,w.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,w.useCallback)((function(e){j.setFieldValue("welcomeTip",e),H({welcomeTip:e})}),[j,H]);(0,w.useEffect)((function(){if(null!=F&&F.uid&&(J.current!==F.uid&&(J.current=F.uid,W.current=!1),!W.current)){W.current=!0;var e=function(){var e=r()(a()().mark((function e(){var t,n,i,s,r,o,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:F.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(E(n),r=(null==n||null===(i=n.data)||void 0===i?void 0:i.content)||[],o=null==Q?void 0:Q.welcomeKbUid,(l=o||z||(null===(s=r[0])||void 0===s?void 0:s.uid))&&(B(l),j.setFieldValue("welcomeKbUid",l),o!==l&&H({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,k,null==Q?void 0:Q.welcomeKbUid,z,j,H]),(0,w.useEffect)((function(){if(null!=F&&F.uid&&z){var e=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:F.uid,kbUid:z},e.next=4,(0,c.pf)(t);case 4:n=e.sent,y.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?U(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,z,k]),(0,w.useEffect)((function(){if(Q){var e=null==Q?void 0:Q.welcomeFaqs,t=Array.isArray(Q.welcomeFaqUids)?Q.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==q||null===(t=q.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==Q?void 0:Q.welcomeFaqUids,Q]);var G=(0,w.useCallback)((function(e){B(e),j.setFieldValue("welcomeFaqUids",[]),H({welcomeKbUid:e,welcomeFaqUids:[]})}),[H,j]);return(0,w.useEffect)((function(){var e=Z(null==Q?void 0:Q.welcomeTip);void 0!==e&&K!==e&&D(e),null!=Q&&Q.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",Q.welcomeKbUid),z!==Q.welcomeKbUid&&B(Q.welcomeKbUid))}),[Z,null==Q?void 0:Q.welcomeTip,null==Q?void 0:Q.welcomeKbUid,K,j,z,null==R||null===(n=R.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,b.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,b.jsx)(h.A.Item,{name:"welcomeTip",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,b.jsx)(M.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:K,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,b.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==R||null===(i=R.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:Z(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,b.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,b.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,b.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,b.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==q||null===(s=q.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:Z(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,b.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return H({welcomeFaqUids:e})}}})]})}},33949:function(e,t,n){n.r(t),n.d(t,{default:function(){return he}});var i=n(44194),a=n(31167),s=n(19736),r=n(76711),o=n.n(r),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),v=n(45332),m=n.n(v),p=n(85255),h=n(3925),x=n(9428),S=n(48769),w=n(71876),M=n(12792),y=n(66810),b=n(65513),j=n(77359),k=n(74840),Z=n(29337),F=n(68779),C=n(12322),T=n(31806),q=n(34600),U=n(56482),A=n(10162),L=n(59304),R=n(54881),E=n(47944),I=n(80556),P=n(55785),z=n(79866),B=n(93527),N=n(50989),O=n(14888),K=n(88449),D=n(26710),W=n(6844),J=n(61952),V=n(21914),Q=(n(47460),n(2061)),H=(n(15012),n(42670)),Y=n(89105),G=n(23312),X=n(1725),_=n(33798),$=n(20585),ee=(n(81005),n(35165)),te=n(58791),ne=n(36125),ie=n(65819),ae=n(31549),se=function(){var e=(0,s.useIntl)(),t=(0,O.u)((function(e){return e.currentOrg})),n=(0,K.Z)(),r=n.leftSiderStyle,l=(n.contentStyle,(0,D.Z)().isDarkMode),d=(0,i.useState)(!1),g=m()(d,2),v=g[0],W=g[1],se=(0,i.useState)([]),re=m()(se,2),oe=re[0],le=re[1],ue=(0,i.useState)(),de=m()(ue,2),ce=de[0],ge=de[1],fe=(0,i.useState)(""),ve=m()(fe,2),me=ve[0],pe=ve[1],he=(0,i.useState)("tips"),xe=m()(he,2),Se=xe[0],we=xe[1],Me=(0,i.useState)(!1),ye=m()(Me,2),be=ye[0],je=ye[1],ke=(0,i.useState)(null),Ze=m()(ke,2),Fe=Ze[0],Ce=Ze[1],Te=(0,i.useMemo)((function(){return oe.find((function(e){return e.uid===ce}))||null}),[oe,ce]),qe=(0,i.useState)(!1),Ue=m()(qe,2),Ae=Ue[0],Le=Ue[1],Re=(0,i.useState)(!1),Ee=m()(Re,2),Ie=Ee[0],Pe=Ee[1],ze=(0,J.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),Be=ze.setCurrentAgentSettings,Ne=ze.currentAgentSettings,Oe=(0,i.useState)(!1),Ke=m()(Oe,2),De=Ke[0],We=Ke[1],Je=(0,i.useRef)(""),Ve=(0,i.useMemo)((function(){var e;return null!==(e=null!=Ne?Ne:Te)&&void 0!==e?e:null}),[Ne,Te]),Qe=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftServiceSettings||Ne.serviceSettings||{};Be(f()(f()({},Ne),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[Ne,Be]),He=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftInviteSettings||Ne.inviteSettings||{};Be(f()(f()({},Ne),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[Ne,Be]),Ye=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftMessageLeaveSettings||Ne.messageLeaveSettings||{};Be(f()(f()({},Ne),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[Ne,Be]),Ge=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftWorktimeSettings||Ne.worktimeSettings||{};Be(f()(f()({},Ne),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[Ne,Be]),Xe=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftQueueSettings||Ne.queueSettings||{};Be(f()(f()({},Ne),{},{draftQueueSettings:f()(f()({},t),e)}))}}),[Ne,Be]),_e=(0,i.useCallback)((function(e){Ne&&Be(f()(f()({},Ne),e))}),[Ne,Be]),$e=(0,i.useMemo)((function(){if(!me)return oe;var e=me.toLowerCase();return oe.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[oe,me]),et=(0,i.useCallback)(function(){var e=c()(u()().mark((function e(n,i){var a,s,r,o,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return W(!0),a="welcome",e.prev=4,r=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=9,(0,N.u9)(o);case 9:l=e.sent,ne.Z.debug("加载客服配置模板列表: ",l,o),d=(null==l||null===(s=l.data)||void 0===s?void 0:s.content)||[],le(d),!(d.length>0)||ce&&d.some((function(e){return e.uid===ce}))||(ge(d[0].uid),null!=i&&i.keepActive||we(a));case 14:return e.prev=14,W(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[4,,14,17]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,ce]);(0,i.useEffect)((function(){et(me)}),[null==t?void 0:t.uid]),(0,i.useEffect)((function(){Te?(Be(Te),Je.current=JSON.stringify(null!=Te?Te:{}),We(!1)):(Be(null),Je.current=JSON.stringify({}),We(!1))}),[ce]),(0,i.useEffect)((function(){if(Te)try{var e=JSON.stringify(null!=Ne?Ne:{});We(e!==Je.current)}catch(e){We(!0)}}),[Ne,null==Te?void 0:Te.uid]);var tt=function(){var n=c()(u()().mark((function n(i){var a,s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=i?i:Te)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,N.SJ)(s);case 6:r=n.sent,console.log("删除客服配置模板结果：",r,s),r&&200===r.code?(B.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),et(me)):B.yw.error((null==r?void 0:r.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),nt=function(){var n=c()(u()().mark((function n(i,a){var s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:i,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,N.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,N.iO)(s);case 10:n.t0=n.sent;case 11:(r=n.t0)&&200===r.code?(B.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),et(me)):B.yw.error((null==r?void 0:r.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),B.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),it=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},at=function(e){if(e){var t=it(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var a=null==e?void 0:e[i];if(Array.isArray(a)){var s=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickButtonUids","quickButtons"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var i=function(e){if(e)return it(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},st=function(e){if(e)return it(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},rt=function(e){if(e)return it(e,["name","description","color","order"])},ot=function(e){if(e)return it(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},lt=function(e){if(e)return it(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},ut=function(e){if(e)return it(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},dt=function(e){if(e)return it(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},ct=function(e){if(e)return it(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},gt=function(e){if(e)return it(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},ft=function(){var n=c()(u()().mark((function n(){var i,a,s,r,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Te&&Te.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Le(!0),n.prev=4,i=Ne&&Ne.uid===Te.uid?Ne:Te,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:Te.uid,orgUid:null==t?void 0:t.uid,name:null==i?void 0:i.name,description:null==i?void 0:i.description,isDefault:null==i?void 0:i.isDefault,enabled:null==i?void 0:i.enabled,serviceSettings:at(a(null==i?void 0:i.serviceSettings,null==i?void 0:i.draftServiceSettings)),inviteSettings:st(a(null==i?void 0:i.inviteSettings,null==i?void 0:i.draftInviteSettings)),intentionSettings:rt(a(null==i?void 0:i.intentionSettings,null==i?void 0:i.draftIntentionSettings)),maxThreadCount:null==i?void 0:i.maxThreadCount,timeoutRemindEnabled:null==i?void 0:i.timeoutRemindEnabled,timeoutRemindTime:null==i?void 0:i.timeoutRemindTime,timeoutRemindTip:null==i?void 0:i.timeoutRemindTip,messageLeaveSettings:ot(a(null==i?void 0:i.messageLeaveSettings,null==i?void 0:i.draftMessageLeaveSettings)),worktimeSettings:ut(a(null==i?void 0:i.worktimeSettings,null==i?void 0:i.draftWorktimeSettings)),autoReplySettings:dt(a(null==i?void 0:i.autoReplySettings,null==i?void 0:i.draftAutoReplySettings)),queueSettings:lt(a(null==i?void 0:i.queueSettings,null==i?void 0:i.draftQueueSettings)),rateDownSettings:ct(a(null==i?void 0:i.rateDownSettings,null==i?void 0:i.draftRateDownSettings)),agentStatusSettings:gt(a(null==i?void 0:i.agentStatusSettings,null==i?void 0:i.draftAgentStatusSettings))},n.next=10,(0,N.wU)(s);case 10:r=n.sent,console.log("保存客服配置模板结果：",r,s),r&&200===r.code?(B.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),d=null!==(o=null!==(l=null==r?void 0:r.data)&&void 0!==l?l:i)&&void 0!==o?o:{},Je.current=JSON.stringify(d),We(!1),et(me,{keepActive:!0})):B.yw.error((null==r?void 0:r.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),B.yw.error("保存失败");case 19:return n.prev=19,Le(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),vt=function(){var n=c()(u()().mark((function n(){var i,a,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Te&&Te.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Pe(!0),n.prev=4,!De){n.next=8;break}return n.next=8,ft();case 8:return i={uid:Te.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,N.Xy)(i);case 11:(a=n.sent)&&200===a.code?(B.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Je.current=JSON.stringify(null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{}),We(!1),et(me)):B.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),B.yw.error("发布失败");case 19:return n.prev=19,Pe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),mt=(0,i.useMemo)((function(){return null!=Te&&Te.uid?[{key:"welcome",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(k.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,ae.jsx)(_.Z,{serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})},{key:"tips",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(Z.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,ae.jsx)(X.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})},{key:"service",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(F.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,ae.jsx)(G.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},agentMeta:{maxThreadCount:null==Ve?void 0:Ve.maxThreadCount,timeoutRemindTime:null==Ve?void 0:Ve.timeoutRemindTime},onServiceSettingsChange:Qe,onAgentMetaChange:_e})}].concat(o()((0,ie.OJ)()?[{key:"rate",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(C.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,ae.jsx)(V.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})}]:[]),o()((0,ie.OJ)()?[{key:"messageLeave",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(T.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"agent.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,ae.jsx)($.Z,{variant:"agent",messageLeaveSettings:{live:null==Ve?void 0:Ve.messageLeaveSettings,draft:null==Ve?void 0:Ve.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Ye})}]:[]),o()((0,ie.OJ)()?[{key:"queue",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(te.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"agent.settings.queue",defaultMessage:"排队设置"})]}),children:(0,ae.jsx)(ee.Z,{variant:"agent",queueSettings:{live:null==Ve?void 0:Ve.queueSettings,draft:null==Ve?void 0:Ve.draftQueueSettings},onQueueSettingsChange:Xe})}]:[]),o()([]),o()((0,ie.OJ)()?[{key:"toolbar",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(q.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,ae.jsx)(H.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},settingsUid:Te.uid,isActive:"toolbar"===Se,onServiceSettingsChange:Qe})}]:[]),o()((0,ie.OJ)()?[{key:"right",label:(0,ae.jsxs)("span",{children:[(0,ae.jsx)(U.Z,{})," ",(0,ae.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,ae.jsx)(Q.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe,settingsUid:Te.uid,isActive:"right"===Se})}]:[]),o()([]),o()([])):[]}),[null==Te?void 0:Te.uid,Ve,Qe,He,Ye,Ge,Xe,e,Se]);return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ae.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,ae.jsxs)(z.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,ae.jsx)(h.ZP,{size:"small",icon:(0,ae.jsx)(A.Z,{}),type:"primary",onClick:function(){Ce(null),je(!0)},children:(0,ae.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:v,children:[(0,ae.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ae.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ae.jsx)(S.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:me,onChange:function(e){return pe(e.target.value)},onPressEnter:function(e){et(me)},allowClear:!0,size:"middle"}),(0,ae.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return et(me)},children:"搜索"})]})}),(0,ae.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ae.jsx)(w.Z,{dataSource:$e,locale:{emptyText:(0,ae.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ae.jsx)(w.Z.Item,{style:ce===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ge(e.uid)},children:(0,ae.jsx)(w.Z.Item.Meta,{title:(0,ae.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ae.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ae.jsx)(x.Z,{size:4,children:e.isDefault?(0,ae.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ae.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ae.jsx)(p.Z.Panel,{children:Te?(0,ae.jsx)(z.Z,{title:(0,ae.jsxs)(x.Z,{children:[(0,ae.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",Te.name||Te.uid]}),(0,ae.jsx)(b.Z,{checked:Te.enabled,onChange:function(e){return nt(Te.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ae.jsx)(h.ZP,{size:"small",icon:(0,ae.jsx)(L.Z,{}),onClick:function(e){var t;e.stopPropagation(),Ce(null!=(t=Te)?t:Te),je(!0)},children:"编辑"}),(0,ae.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),tt(Te)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ae.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,ae.jsx)(R.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),Te.isDefault?(0,ae.jsx)(y.Z,{color:"blue",children:"默认"}):null]}),extra:(0,ae.jsxs)(x.Z,{children:[(0,ae.jsx)(j.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),vt()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ae.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ie,type:"default",icon:(0,ae.jsx)(E.Z,{}),children:(0,ae.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ae.jsx)(h.ZP,{onClick:function(){Te&&(Be(Te),Je.current=JSON.stringify(null!=Te?Te:{}),We(!1))},disabled:!De,icon:(0,ae.jsx)(I.Z,{}),children:(0,ae.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ae.jsx)(h.ZP,{type:"primary",loading:Ae,onClick:ft,disabled:!De,icon:(0,ae.jsx)(P.Z,{}),children:(0,ae.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ae.jsx)(a.Z,{activeKey:Se,onChange:we,items:mt,style:{minHeight:"calc(100vh - 280px)"}})}):(0,ae.jsx)(z.Z,{children:(0,ae.jsx)(M.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,ae.jsx)(Y.Z,{open:be,onOpenChange:je,orgUid:(null==t?void 0:t.uid)||"",record:Fe,onSuccess:function(){je(!1),et(me)}})]})},re=n(73693),oe=n(84176),le=n.n(oe);function ue(e){return de.apply(this,arguments)}function de(){return(de=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/agent/status/query/org",{method:"GET",params:f()(f()({},t),{},{channel:W.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=n(67412),ge=n(61107),fe=n(96596),ve=n.n(fe),me=["current","pageSize"],pe=function(){var e=(0,s.useIntl)(),t=(0,i.useRef)(),n=(0,i.useState)(1),a=m()(n,2),r=a[0],o=a[1],l=(0,i.useState)(10),d=m()(l,2),g=d[0],v=d[1],p=(0,O.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,ae.jsx)(s.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,ae.jsx)(s.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,ae.jsx)(ae.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,ae.jsx)(s.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,ae.jsx)(s.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,ae.jsx)(y.Z,{color:"green",children:(0,ae.jsx)(s.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,ae.jsx)(y.Z,{color:"red",children:(0,ae.jsx)(s.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,ae.jsx)(y.Z,{color:"orange",children:(0,ae.jsx)(s.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,ae.jsx)(s.FormattedMessage,{id:"agent.status.duration",defaultMessage:"Duration"}),dataIndex:"durationSeconds",hideInSearch:!0,tooltip:(0,ae.jsx)(s.FormattedMessage,{id:"agent.tooltip.duration",defaultMessage:"Time spent before next status"}),render:function(e,t){return function(e){if(null==e)return"-";var t=Math.max(0,Math.floor(e)),n=Math.floor(t/86400),i=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),s=t%60,r=[];return n>0&&r.push("".concat(n,"d")),(i>0||n>0)&&r.push("".concat(i,"h")),(a>0||i>0||n>0)&&r.push("".concat(a,"m")),r.push("".concat(s,"s")),r.join(" ")}(t.durationSeconds)}},{title:(0,ae.jsx)(s.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,ae.jsx)(s.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,i){return ve()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],S=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ne.Z.debug("handleExportExcel",r,g),t=localStorage.getItem(W.LA8),window.open((0,ie.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==p?void 0:p.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ae.jsx)(ce.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,i){var a,s,r,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ne.Z.debug("request:",t,n,i),a=t.current,s=t.pageSize,r=le()(t,me),o(a),v(s),l=f()({pageNumber:a-1,pageSize:s,orgUid:null==p?void 0:p.uid},r),e.next=7,ue(l);case 7:return d=e.sent,ne.Z.debug("queryAgentStatusByOrg response:",l,d),200===d.code||B.yw.error(d.message),e.abrupt("return",{data:null==d?void 0:d.data.content,success:!0,total:null==d?void 0:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){o(e),v(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,ae.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,ae.jsx)(I.Z,{}),children:(0,ae.jsx)(s.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,ae.jsx)(h.ZP,{onClick:S,type:"primary",icon:(0,ae.jsx)(ge.Z,{}),children:(0,ae.jsx)(s.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},he=function(){return(0,ae.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,ae.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,ae.jsx)(re.Z,{})},{key:"settings",label:(0,ae.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,ae.jsx)(se,{})},{key:"agentStatus",label:(0,ae.jsx)(s.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,ae.jsx)(pe,{})}]})}}}]);