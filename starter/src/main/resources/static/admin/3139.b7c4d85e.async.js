"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3139],{83139:function(e,n,t){t.d(n,{Z:function(){return L}});var r=t(90819),a=t.n(r),s=t(89933),o=t.n(s),i=t(45332),l=t.n(i),d=t(53530),u=t(9452),c=t(44194),f=t(10154),g=t.n(f),b=t(73193),m=t.n(b),p=t(86803),v=t(76750),h=t(40612),x=t(55735),y=t(69169),k=t(84881),w=t(4499),K=t(32350),j=t(32327),M=t(62673),Z=t(40679),C=t(36605),P=t(31549),R=function(e){var n,t=e.open,r=e.isEdit,s=e.type,i=e.kbase,u=e.onCancel,f=e.onSubmit,b=y.A.useForm(),R=l()(b,1)[0],F=(0,v.Z)().translateString,S=(0,h.u)((function(e){return e.currentOrg})),E=(0,c.useRef)(null),H=(0,c.useState)([]),T=l()(H,2),V=T[0],I=T[1],z=(0,c.useState)({}),D=l()(z,2),L=D[0],q=D[1],O=(0,c.useState)(!1),Q=l()(O,2),N=Q[0],U=Q[1],B="ollama",_="bge-m3:latest",A=(0,c.useState)((null==i?void 0:i.embeddingProvider)||B),J=l()(A,2),W=J[0],X=J[1],G=(0,c.useState)((null==i?void 0:i.embeddingModel)||_),Y=l()(G,2),$=Y[0],ee=Y[1],ne=(0,c.useState)(""),te=l()(ne,2),re=te[0],ae=te[1];(0,c.useEffect)((function(){r?(R.setFieldsValue({name:F(null==i?void 0:i.name)}),R.setFieldsValue({headline:F(null==i?void 0:i.headline)}),R.setFieldsValue({footerHtml:F(null==i?void 0:i.footerHtml)}),R.setFieldsValue({descriptionHtml:F(null==i?void 0:i.descriptionHtml)}),R.setFieldsValue({language:null==i?void 0:i.language}),null!=i&&i.embeddingProvider&&(X(i.embeddingProvider),R.setFieldsValue({embeddingProvider:i.embeddingProvider})),null!=i&&i.embeddingModel&&(ee(i.embeddingModel),R.setFieldsValue({embeddingModel:i.embeddingModel}))):(R.resetFields(),R.setFieldsValue({language:"ZH_CN"}),R.setFieldsValue({embeddingProvider:B,embeddingModel:_})),t&&setTimeout((function(){var e;null===(e=E.current)||void 0===e||e.focus()}),100)}),[t,r,i]),(0,c.useEffect)((function(){t&&s===x.QPQ&&se()}),[t,s]),(0,c.useEffect)((function(){if(W&&$&&L[W]){var e=L[W].find((function(e){return e.value===$}));e&&ae(e.label)}}),[L,W,$]);var se=function(){var e=o()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==S?void 0:S.uid,level:x.whQ},e.next=4,(0,C.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t.data,n),200===t.code?(r=t.data.content||[],I(r)):p.yw.error(t.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),oe=(0,c.useCallback)((function(){}),[]),ie=(0,c.useCallback)((function(){U(!1)}),[]),le=(0,c.useCallback)((function(e,n,t){X(e),ee(n),ae(t),R.setFieldValue("embeddingProvider",e),R.setFieldValue("embeddingModel",n),U(!1)}),[R]),de=(0,c.useCallback)((function(e,n){q((function(t){return m()(m()({},t),{},g()({},e,n))}))}),[]),ue=function(){R.validateFields().then(function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:r?null==i?void 0:i.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:s,language:n.language,embeddingProvider:n.embeddingProvider||B,embeddingModel:n.embeddingModel||_,orgUid:null==S?void 0:S.uid},f(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),p.yw.error("创建知识库失败")}))},ce=function(e){"Enter"===e.key&&ue()};return(0,P.jsxs)("div",{children:[(0,P.jsx)(d.Z,{title:"新建知识库",open:t,forceRender:!0,onOk:ue,onCancel:u,children:(0,P.jsxs)(y.A,{form:R,submitter:!1,children:[(0,P.jsx)(k.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,P.jsx)(w.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:ce,placeholder:"请输入名称",ref:E}}),s===x.VX&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(w.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:ce,placeholder:"请输入名称"}}),(0,P.jsx)(K.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,P.jsx)(K.Z,{label:"描述",name:"descriptionHtml"}),s===x.QPQ&&(0,P.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,P.jsx)(j.Z.Text,{strong:!0,style:{marginRight:"8px"},children:"嵌入模型选择："}),(0,P.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,P.jsx)(M.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:oe,children:W&&$?(0,P.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,P.jsxs)("div",{children:[(0,P.jsx)(j.Z.Text,{type:"secondary",children:"供应商："}),(0,P.jsx)(j.Z.Text,{strong:!0,children:F((null===(n=V.find((function(e){return e.name===W})))||void 0===n?void 0:n.nickname)||W)}),(0,P.jsx)("br",{}),(0,P.jsx)(j.Z.Text,{type:"secondary",children:"模型："}),(0,P.jsx)(j.Z.Text,{strong:!0,children:re||$})]})}):(0,P.jsx)("div",{style:{textAlign:"center"}})})}),(0,P.jsxs)("div",{style:{display:"none"},children:[(0,P.jsx)(k.Z,{name:"embeddingProvider",width:"lg"}),(0,P.jsx)(k.Z,{name:"embeddingModel",width:"lg"})]})]})]})}),s===x.QPQ&&(0,P.jsx)(Z.Z,{visible:N,onCancel:ie,onOk:le,initialProvider:W,initialModel:$,initialModelLabel:re,providers:V,currentOrgUid:null==S?void 0:S.uid,existingProviderModels:L,onModelsLoaded:de,allowedModelTypes:[x.xTq]})]})},F=t(27522),S=t(6397),E=t(23864),H=t(30921),T=t(15722),V=t(27487),I=t(75365),z=function(e){var n=e.currentKbase,t=e.handleNewKbase,r=e.handleEditKbase,a=e.showDeleteConfirmModel,s=(0,H.useIntl)();return(0,P.jsx)("div",{children:(0,P.jsxs)(V.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[(0,P.jsx)(I.ZP,{size:"small",type:"primary",onClick:t,children:s.formatMessage({id:"createKb",defaultMessage:"Create Knowledge Base"})}),""!==(null==n?void 0:n.uid)&&(null==n?void 0:n.uid)!==x.zBg&&(0,P.jsx)(I.ZP,{size:"small",onClick:r,children:s.formatMessage({id:"edit",defaultMessage:"Edit"})}),""!==(null==n?void 0:n.uid)&&(null==n?void 0:n.uid)!==x.zBg&&(0,P.jsx)(I.ZP,{onClick:function(){return a(n)},size:"small",style:{float:"right"},danger:!0,children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})})},D=d.Z.confirm,L=function(e){var n=e.type,t=(0,H.useIntl)(),r=(0,c.useRef)(!1),s=(0,c.useState)(!1),i=l()(s,2),d=i[0],f=i[1],g=(0,E.Z)().isDarkMode,b=(0,v.Z)().translateString,m=(0,h.u)((function(e){return e.currentOrg})),y=(0,c.useState)(!0),k=l()(y,2),w=k[0],K=k[1],j=(0,S.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),M=j.kbaseResult,Z=j.currentKbase,C=j.insertKbase,V=j.updateLocalKbase,I=j.setKbaseResult,L=j.setCurrentKbase,q=j.removeKbase,O=function(){var e=o()(a()().mark((function e(){var t,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,p.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==m?void 0:m.uid},e.next=8,(0,F.AP)(t);case 8:s=e.sent,console.log("queryKbasesByOrg: ",s),200===s.code?(p.yw.destroy(),I(s)):(p.yw.destroy(),p.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){console.log("useEffect"),O()}),[]);var Q=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w?U(n):N(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",p.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,F.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(C(r.data),L(r.data),p.yw.success({content:"创建成功！",key:t,duration:2}),f(!1)):(console.log("create kb failed",r),p.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),U=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",p.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,F.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(V(r.data),L(r.data),p.yw.success({content:"更新成功！",key:t,duration:2}),f(!1)):(console.log("update kb failed",r),p.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),B=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",Z),K(!0),f(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=o()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==M.data.content.length){e.next=4;break}return p.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,F._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200==r.code?(q(n.uid),O()):(console.log("handleDeleteKbase: ",r),p.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),A=function(e){return n!=x._FS?b(e.descriptionHtml):e.level===x.Hxq?"全平台客服可见":e.level===x.whQ?"本组织客服可见":e.level===x.fyH?"本客服可见":b(e.descriptionHtml)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(z,{currentKbase:Z,handleNewKbase:function(){console.log("new kb"),K(!1),f(!0)},handleEditKbase:B,showDeleteConfirmModel:function(e){D({title:t.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(T.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(b(e.name),"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}}),(0,P.jsx)(u.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,P.jsx)(u.Z.Item,{style:Z.uid===e.uid?{backgroundColor:g?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){L(e)},children:(0,P.jsx)(u.Z.Item.Meta,{style:{marginLeft:"10px"},title:b(e.name),description:A(e)})})}}),d&&(0,P.jsx)(R,{open:d,isEdit:w,type:n,kbase:Z,onSubmit:Q,onCancel:function(){f(!1)}})]})}},6397:function(e,n,t){t.d(n,{j:function(){return c}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(55735),l=t(44435),d=t(83642),u=t(83890),c=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,u.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),l=a()(a()({},n().kbaseResult),{},{data:{content:i}});e({kbaseResult:l,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))}}]);