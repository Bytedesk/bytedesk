"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6021],{63331:function(e,t,r){r.r(t),r.d(t,{default:function(){return F}});var a=r(90938),s=r(10820),n=r(15911),i=r(44194),u=r(6751),o=r(76711),l=r.n(o),d=r(90819),c=r.n(d),f=r(89933),p=r.n(f),h=r(45332),v=r.n(h),g=r(50884),m=r(72300),x=r(21002),y=r(97765),M=r(2290),w=r(69159),b=r(19058),Z=r(46206),j=r(90883),k=r(31461),S=r(31549),A=function(e){var t=e.open,r=e.authority,a=e.onClose,s=e.onUpdated,n=(0,M.useIntl)(),u=(0,x.Z)().translateString,o=w.Z.useForm(),l=v()(o,1)[0];(0,i.useEffect)((function(){t&&r&&l.setFieldsValue({uid:r.uid,value:r.value,name:u(r.name),description:u(r.description)}),t||l.resetFields()}),[t,r,l]);var d=function(){var e=p()(c()().mark((function e(){var t,i,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return g.yw.warning(n.formatMessage({id:"authority.select.required",defaultMessage:"请先选择权限"})),e.abrupt("return");case 3:return e.prev=3,e.next=6,l.validateFields();case 6:return t=e.sent,i={uid:r.uid,name:t.name,description:t.description},g.yw.loading(n.formatMessage({id:"updating"})),e.next=11,(0,m.Qz)(i);case 11:if(u=e.sent,g.yw.destroy(),200===(null==u?void 0:u.code)){e.next=16;break}return g.yw.error(null==u?void 0:u.message),e.abrupt("return");case 16:g.yw.success(n.formatMessage({id:"update.success"})),null==s||s(),a(),e.next=28;break;case 21:if(e.prev=21,e.t0=e.catch(3),y.Z.error("failed to update authority",e.t0),g.yw.destroy(),null===e.t0||void 0===e.t0||!e.t0.errorFields){e.next=27;break}return e.abrupt("return");case 27:g.yw.error(n.formatMessage({id:"update.failed",defaultMessage:"更新失败"}));case 28:case"end":return e.stop()}}),e,null,[[3,21]])})));return function(){return e.apply(this,arguments)}}();return(0,S.jsx)(b.Z,{title:n.formatMessage({id:"authority.edit",defaultMessage:"编辑权限"}),open:t,onClose:a,width:520,destroyOnHidden:!0,extra:(0,S.jsxs)(Z.Z,{size:8,children:[(0,S.jsx)(j.ZP,{onClick:a,children:n.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,S.jsx)(j.ZP,{type:"primary",onClick:d,children:n.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,S.jsxs)(w.Z,{form:l,layout:"vertical",children:[(0,S.jsx)(w.Z.Item,{label:"UID",name:"uid",children:(0,S.jsx)(k.Z,{disabled:!0})}),(0,S.jsx)(w.Z.Item,{label:n.formatMessage({id:"authority.value",defaultMessage:"权限值"}),name:"value",children:(0,S.jsx)(k.Z,{disabled:!0})}),(0,S.jsx)(w.Z.Item,{label:n.formatMessage({id:"authority.name",defaultMessage:"权限名称"}),name:"name",rules:[{required:!0,message:n.formatMessage({id:"authority.name.required",defaultMessage:"请输入权限名称"})}],children:(0,S.jsx)(k.Z,{placeholder:u("请输入权限名称")})}),(0,S.jsx)(w.Z.Item,{label:n.formatMessage({id:"authority.description",defaultMessage:"权限描述"}),name:"description",rules:[{required:!0,message:n.formatMessage({id:"authority.description.required",defaultMessage:"请输入权限描述"})}],children:(0,S.jsx)(k.Z.TextArea,{autoSize:{minRows:3,maxRows:6},placeholder:u("请输入权限描述")})})]})})},I=r(1670),T=r(77601),C=r(64724),q=r(70937),z=r(18464),U=function(e){if("string"==typeof e){var t=e.trim();return t.length>0?t:void 0}},B=function(){var e=(0,M.useIntl)(),t=(0,x.Z)().translateString,r=(0,i.useRef)(),a=(0,i.useState)(!1),s=v()(a,2),n=s[0],u=s[1],o=(0,i.useState)(void 0),d=v()(o,2),f=d[0],h=d[1],w=(0,i.useState)(!1),b=v()(w,2),B=b[0],R=b[1],F=(0,i.useState)(""),P=v()(F,2),D=P[0],E=P[1],L=(0,i.useState)(""),O=v()(L,2),K=O[0],N=O[1],Q=function(){var e,t,a,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];s&&"function"==typeof(null===(e=r.current)||void 0===e?void 0:e.reloadAndRest)?null===(a=r.current)||void 0===a||a.reloadAndRest():null===(t=r.current)||void 0===t||t.reload()};(0,i.useEffect)((function(){var e=(D||"").trim(),t=(K||"").trim();if(e&&e!==t){var r=window.setTimeout((function(){N(e),Q(!0)}),300);return function(){window.clearTimeout(r)}}}),[300,D]);var H,J=function(){var t=p()(c()().mark((function t(){var a,s;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R(!0),t.prev=1,t.next=4,(0,m.vj)();case 4:if(s=t.sent,y.Z.debug("AuthoritiesTable resetAuthoritiesLevel resp:",s),200===(null==s?void 0:s.code)){t.next=9;break}return g.yw.error(null==s?void 0:s.message),t.abrupt("return");case 9:g.yw.success(e.formatMessage({id:"authority.reset.success",defaultMessage:"重置成功"})),null===(a=r.current)||void 0===a||a.reload(),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(1),y.Z.error("AuthoritiesTable failed to resetAuthoritiesLevel",t.t0),g.yw.error(e.formatMessage({id:"authority.reset.failed",defaultMessage:"重置失败，请稍后再试"}));case 17:return t.prev=17,R(!1),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[1,13,17,20]])})));return function(){return t.apply(this,arguments)}}(),V=(0,i.useMemo)((function(){return[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",search:!1},{title:e.formatMessage({id:"authority.name",defaultMessage:"权限名称"}),dataIndex:"name",ellipsis:!0,search:!1,fixed:"left",render:function(e,r){var a=t(r.name);return(0,S.jsx)(C.Z.Text,{copyable:{text:a||""},children:a})}},{title:"UID",dataIndex:"uid",width:220,ellipsis:!0,search:!1,render:function(e,t){return(0,S.jsx)(C.Z.Text,{copyable:{text:t.uid||""},children:t.uid})}},{title:e.formatMessage({id:"authority.value",defaultMessage:"权限值"}),dataIndex:"value",width:220,ellipsis:!0,render:function(e,t){return(0,S.jsx)(C.Z.Text,{copyable:{text:t.value||""},children:t.value})}},{title:e.formatMessage({id:"authority.description",defaultMessage:"权限描述"}),dataIndex:"description",ellipsis:!0,render:function(e,r){var a=r.description||"",s=t(a)||"";return s&&s!==a?s:t(r.name)||""||r.value||"-"}},{title:e.formatMessage({id:"level",defaultMessage:"级别"}),dataIndex:"level",width:140,ellipsis:!0,search:!1,render:function(e,t){var r=null==t?void 0:t.level;return(0,I.Xf)(r)}},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",width:120,fixed:"right",render:function(t,r){return[(0,S.jsx)(j.ZP,{type:"link",onClick:function(){h(r),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]}}]}),[e,t]),X=function(e,r){var a=(r||"").trim().toLowerCase();if(!a)return!0;var s=t(e.name)||"",n=t(e.description)||"";return[e.uid||"",e.name||"",s,e.value||"",e.description||"",n,e.level||""].filter(Boolean).join(" ").toLowerCase().includes(a)},G=function(){var e=p()(c()().mark((function e(t,r){var a,s,n,i,u,o,d,f,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=200,s=200,n=[],i=0;case 4:if(!(i<s)){e.next=19;break}return d={pageNumber:i,pageSize:a,sortBy:t||void 0,sortDirection:r,superUser:!0},e.next=8,(0,m.SA)(d);case 8:if(200===(null==(f=e.sent)?void 0:f.code)){e.next=11;break}throw new Error((null==f?void 0:f.message)||"query failed");case 11:if(p=(null==f||null===(u=f.data)||void 0===u?void 0:u.content)||[],n.push.apply(n,l()(p)),!(Boolean(null==f||null===(o=f.data)||void 0===o?void 0:o.last)||p.length<a)){e.next=16;break}return e.abrupt("break",19);case 16:i+=1,e.next=4;break;case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(T.Z,{columns:V,actionRef:r,rowKey:function(e){return e.uid||e.name||""},cardBordered:!0,scroll:{x:1500},toolBarRender:function(){return[(0,S.jsxs)(Z.Z,{size:8,children:[(0,S.jsx)(k.Z.Search,{allowClear:!0,placeholder:e.formatMessage({id:"authority.search.placeholder",defaultMessage:"搜索权限（名称/值/描述/UID）"}),value:D,onSearch:function(e){var t=e||"";E(t),N(t.trim()),Q(!0)},onChange:function(e){var t=e.target.value||"";E(t),t||(N(""),Q(!0))},style:{width:360}}),(0,S.jsx)(q.Z,{title:e.formatMessage({id:"authority.reset.confirm.title",defaultMessage:"重置权限？"}),description:e.formatMessage({id:"authority.reset.confirm.desc",defaultMessage:"将按默认规则重置权限，继续？"}),okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),onConfirm:J,disabled:B,children:(0,S.jsx)(j.ZP,{loading:B,children:e.formatMessage({id:"authority.reset.button",defaultMessage:"重置权限"})})})]},"actions")]},options:{reload:(H=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=r.current)||void 0===t||t.reload();case 1:case"end":return e.stop()}}),e)}))),function(){return H.apply(this,arguments)}),density:!0,setting:!0},search:!1,headerTitle:e.formatMessage({id:"authority.list.all",defaultMessage:"全部权限"}),pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSize:10},params:{keyword:K},request:function(){var t=p()(c()().mark((function t(r,a){var s,n,i,u,o,l,d,f,p,h,v,x,M,w,b,Z;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=r.current||1,n=r.pageSize||10,i=Object.keys(a||{})[0],u=i?"ascend"===(null==a?void 0:a[i])?"ascend":"descend":void 0,o=null==r?void 0:r.keyword,!(l=U(o))){t.next=22;break}return t.prev=7,t.next=10,G(i,u);case 10:return d=t.sent,f=d.filter((function(e){return X(e,l)})),p=(s-1)*n,h=f.slice(p,p+n),t.abrupt("return",{data:h,success:!0,total:f.length});case 17:return t.prev=17,t.t0=t.catch(7),y.Z.error("AuthoritiesTable failed to fetchAllAuthorities",t.t0),g.yw.error(e.formatMessage({id:"query.failed",defaultMessage:"查询失败"})),t.abrupt("return",{data:[],success:!1,total:0});case 22:return v={pageNumber:s-1,pageSize:n,sortBy:i||void 0,sortDirection:u,superUser:!0},t.prev=23,t.next=26,(0,m.SA)(v);case 26:if(w=t.sent,y.Z.debug("RoleAllAuthoritiesTable queryAuthoritiesByOrg resp:",w,v),200===(null==w?void 0:w.code)){t.next=31;break}return g.yw.error(null==w?void 0:w.message),t.abrupt("return",{data:[],success:!1,total:0});case 31:return b=(null==w||null===(x=w.data)||void 0===x?void 0:x.content)||[],Z=(null==w||null===(M=w.data)||void 0===M?void 0:M.totalElements)||0,t.abrupt("return",{data:b,success:!0,total:Z});case 36:return t.prev=36,t.t1=t.catch(23),g.yw.error(e.formatMessage({id:"query.failed",defaultMessage:"查询失败"})),t.abrupt("return",{data:[],success:!1,total:0});case 40:case"end":return t.stop()}}),t,null,[[7,17],[23,36]])})));return function(e,r){return t.apply(this,arguments)}}(),locale:{emptyText:(0,S.jsx)(z.Z,{description:e.formatMessage({id:"authority.empty",defaultMessage:"暂无权限数据"})})}}),n&&(0,S.jsx)(A,{open:n,authority:f,onClose:function(){u(!1),h(void 0)},onUpdated:function(){Q()}})]})},R=r(85499),F=function(){var e=(0,a.Z)(),t=e.leftSiderStyle,r=e.contentStyle;return(0,S.jsx)(s.Z,{defaultActiveKey:"role",style:{height:"100%",padding:"10px"},items:[{key:"role",label:"角色权限",children:(0,S.jsxs)(n.Z,{style:{height:"100%"},children:[(0,S.jsx)(n.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,S.jsx)(u.Z,{superUser:!0})}),(0,S.jsx)(n.Z.Panel,{style:r,children:(0,S.jsx)(R.Z,{superUser:!0})})]})},{key:"authorities",label:"全部权限",children:(0,S.jsx)(B,{})}]})}}}]);