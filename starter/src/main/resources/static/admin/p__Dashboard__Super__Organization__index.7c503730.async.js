"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{22014:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(83910),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=r(5901),i=function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var l=a.forwardRef(i)},86469:function(e,t,r){r.d(t,{Z:function(){return R}});var n=r(94433),a=r(38956),o=r(44194),s=r(50079),i=r(85973),l=r(31549),u=["proFieldProps","fieldProps"],d="date",c=o.forwardRef((function(e,t){var r=e.proFieldProps,c=e.fieldProps,f=(0,a.Z)(e,u),p=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,n.Z)({ref:t,valueType:d,fieldProps:(0,n.Z)({getPopupContainer:p.getPopupContainer},c),proFieldProps:r,filedConfig:{valueType:d,customLightMode:!0}},f))})),f=["proFieldProps","fieldProps"],p="dateMonth",g=o.forwardRef((function(e,t){var r=e.proFieldProps,u=e.fieldProps,d=(0,a.Z)(e,f),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,n.Z)({ref:t,valueType:p,fieldProps:(0,n.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:r,filedConfig:{valueType:p,customLightMode:!0}},d))})),m=["fieldProps"],v="dateQuarter",h=o.forwardRef((function(e,t){var r=e.fieldProps,u=(0,a.Z)(e,m),d=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,n.Z)({ref:t,valueType:v,fieldProps:(0,n.Z)({getPopupContainer:d.getPopupContainer},r),filedConfig:{valueType:v,customLightMode:!0}},u))})),y=["proFieldProps","fieldProps"],x="dateWeek",M=o.forwardRef((function(e,t){var r=e.proFieldProps,u=e.fieldProps,d=(0,a.Z)(e,y),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,n.Z)({ref:t,valueType:x,fieldProps:(0,n.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:r,filedConfig:{valueType:x,customLightMode:!0}},d))})),P=["proFieldProps","fieldProps"],Z="dateYear",b=o.forwardRef((function(e,t){var r=e.proFieldProps,u=e.fieldProps,d=(0,a.Z)(e,P),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,n.Z)({ref:t,valueType:Z,fieldProps:(0,n.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:r,filedConfig:{valueType:Z,customLightMode:!0}},d))})),w=c;w.Week=M,w.Month=g,w.Quarter=h,w.Year=b,w.displayName="ProFormComponent";var R=w},2685:function(e,t,r){var n=r(94433),a=r(38956),o=r(28273),s=r(44194),i=r(50079),l=r(85973),u=r(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var r=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,y=e.options,x=(0,a.Z)(e,d),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(m),request:v,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:y,mode:g,showSearch:h,getPopupContainer:M.getPopupContainer},r),ref:t,proFieldProps:p},x),{},{children:c}))},p=s.forwardRef((function(e,t){var r=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,v=e.request,h=e.options,y=(0,a.Z)(e,c),x=(0,n.Z)({options:h,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(m),request:v,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:M.getPopupContainer},x),ref:t,proFieldProps:p},y),{},{children:d}))})),g=s.forwardRef(f);g.SearchSelect=p,g.displayName="ProFormComponent",t.Z=g},13437:function(e,t,r){var n=r(94433),a=r(38956),o=r(44194),s=r(85973),i=r(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=o.forwardRef((function(e,t){var r=e.fieldProps,o=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,a.Z)(e,l);return(0,i.jsx)(s.Z,(0,n.Z)({valueType:"switch",fieldProps:(0,n.Z)({unCheckedChildren:o,checkedChildren:u},r),ref:t,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=u},44565:function(e,t,r){var n=r(32906),a=r(94433),o=r(38956),s=r(92032),i=r(63642),l=r(9134),u=r(21762),d=r(44194),c=r(85973),f=r(31549),p=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",v=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,n.Z)(t,2),o=r[0],u=r[1];return(0,f.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,n=t.getFieldValue(e.name||[]);return(0,f.jsx)(l.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,n),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:o,children:e.children}))}})},h=function(e){var t=e.fieldProps,r=e.proFieldProps,n=(0,o.Z)(e,p);return(0,f.jsx)(c.Z,(0,a.Z)({valueType:m,fieldProps:t,filedConfig:{valueType:m},proFieldProps:r},n))};h.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,s=(0,o.Z)(e,g),i=(0,d.useState)(!1),l=(0,n.Z)(i,2),p=l[0],h=l[1];return null!=t&&t.statusRender&&s.name?(0,f.jsx)(v,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:h,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),h(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),h(!0)}}),proFieldProps:r,filedConfig:{valueType:m}},s))})}):(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:m}},s))},h.displayName="ProFormComponent",t.Z=h},60857:function(e,t,r){var n=r(94433),a=r(38956),o=r(44194),s=r(85973),i=r(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var r=e.fieldProps,o=e.proFieldProps,u=(0,a.Z)(e,l);return(0,i.jsx)(s.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:o},u))};t.Z=o.forwardRef(u)},49504:function(e,t,r){r.d(t,{Cd:function(){return x},E9:function(){return c},Rd:function(){return h},fA:function(){return p},ul:function(){return m}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),l=r.n(i),u=r(36265),d=r(5861);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/reset/level",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},59878:function(e,t,r){r.d(t,{G:function(){return p}});var n=r(73193),a=r.n(n),o=(r(44194),r(41770)),s=r(36265),i=r(96596),l=r.n(i),u=r(42539),d=r(5286),c=r(87523),f=r(31549),p=function(e){var t=e.children,r=e.onSuccess,n=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:s.IrL,categoryUid:"",kbUid:"",channel:s.XtJ},p={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=t,i.fileType=e.type,u.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t,a=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;r(a),d.yw.success("".concat(e.file.name," 上传成功"))}else n(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),n(e.file))}};return(0,f.jsx)(o.Z,a()(a()({},p),{},{children:t}))}},76071:function(e,t,r){var n=r(74494);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},44749:function(e,t,r){r.r(t),r.d(t,{default:function(){return ae}});var n=r(76071),a=r(22273),o=r(44194),s=r(73193),i=r.n(s),l=r(84176),u=r.n(l),d=r(90819),c=r.n(d),f=r(89933),p=r.n(f),g=r(45332),m=r.n(g),v=r(5286),h=r(49504),y=r(6992),x=r(31362),M=r(8651),P=r(44877),Z=r(2157),b=r(76711),w=r.n(b),R=r(71865),C=r(40845),j=r(44565),S=r(60857),F=r(13437),k=r(86469),T=r(2685),D=r(63642),I=r(19095),z=r(76185),E=r(46435),U=r(63889),B=r(44423),Y=r(72884),L=r(5861),A=r(59878),O=r(22014),q=r(96943),N=r(96596),H=r.n(N),J=r(31549),V=function(e){var t,r,n,a=e.isEdit,s=e.org,l=e.open,u=e.onClose,d=e.onSubmit,f=D.Z.useForm(),g=m()(f,1)[0],h=(0,L.useIntl)(),y=(0,R.u)((function(e){return e.currentOrg})),x=(0,o.useState)(""),M=m()(x,2),P=M[0],b=M[1],N=(0,o.useState)([]),V=m()(N,2),W=V[0],X=V[1];(0,o.useEffect)((function(){if(a){var e;g.setFieldsValue({name:null==s?void 0:s.name,logo:null==s?void 0:s.logo,code:null==s?void 0:s.code,description:null==s?void 0:s.description,verifiedType:null==s?void 0:s.verifiedType,identityType:null==s?void 0:s.identityType,identityImage:null==s?void 0:s.identityImage,identityNumber:null==s?void 0:s.identityNumber,verifyDate:null==s?void 0:s.verifyDate,verifyStatus:null==s?void 0:s.verifyStatus,rejectReason:null==s?void 0:s.rejectReason,vip:null==s?void 0:s.vip,vipExpireDate:null==s?void 0:s.vipExpireDate,userUid:null==s||null===(e=s.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==s?void 0:s.enabled)})}else{g.resetFields();new Date;var t=H()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");g.setFieldsValue({verifyStatus:"未认证",vip:!0,vipExpireDate:t,enabled:!0})}}),[l]),(0,o.useEffect)((function(){null!=s&&s.logo?b(s.logo):b("")}),[null==s?void 0:s.logo]),(0,o.useEffect)((function(){var e=function(){var e=p()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||null==y||!y.uid){e.next=4;break}return e.next=3,Q();case 3:a&&null!=s&&s.user&&(t={label:"".concat(s.user.nickname||s.user.username," (").concat(s.user.mobile||s.user.email,") - 当前管理员"),value:s.user.uid},X((function(e){return e.some((function(e){return e.value===t.value}))?e:[t].concat(w()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[l,null==y?void 0:y.uid,a,null==s?void 0:s.user]);var G,K,Q=function(){var e=p()(c()().mark((function e(t){var r,n,a,o,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:20,searchText:t||"",orgUid:null==y?void 0:y.uid},console.log("Loading users with params:",n),e.next=5,(0,q.pz)(n);case 5:if(a=e.sent,console.log("loadUsers response:",a),200!==a.code||null==a||null===(r=a.data)||void 0===r||!r.content){e.next=15;break}return o=null==a?void 0:a.data.content.filter((function(e){var t=e.currentOrganization&&e.currentOrganization.uid;return t&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!t})),s=o.map((function(e){return{label:"".concat(e.nickname||e.username," (").concat(e.mobile||e.email,")"),value:e.uid}})),console.log("Total users:",null==a?void 0:a.data.content.length),console.log("Available users (no organization):",o.length),console.log("Generated user options:",s),X(s),e.abrupt("return",s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}();return(0,J.jsx)(I.Z,{title:a?(0,J.jsx)(L.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,J.jsx)(L.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:u,open:l,width:600,extra:(0,J.jsxs)(z.Z,{children:[(0,J.jsx)(Z.ZP,{onClick:u,children:(0,J.jsx)(L.FormattedMessage,{id:"pages.common.cancel"})}),(0,J.jsx)(Z.ZP,{onClick:function(){g.validateFields().then((function(e){d(i()(i()(i()({},s),e),{},{logo:P,orgUid:null==y?void 0:y.uid}))})).catch((function(e){console.log("Form errors:",e),v.yw.error(h.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,J.jsx)(L.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,J.jsxs)(C.A,{form:g,submitter:!1,children:[(0,J.jsx)(j.Z,{name:"name",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,J.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,J.jsx)("div",{style:{marginBottom:"8px"},children:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,J.jsxs)(E.Z,{gutter:[16,16],align:"middle",children:[(0,J.jsx)(U.Z,{children:(0,J.jsx)(B.Z,{src:P,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,J.jsx)(U.Z,{children:(0,J.jsx)(A.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),b(e),g.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,J.jsx)(Z.ZP,{type:"primary",icon:(0,J.jsx)(O.Z,{}),size:"small",children:h.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,J.jsx)(j.Z,{name:"code",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,J.jsx)(S.Z,{name:"description",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:h.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,J.jsx)(F.Z,{name:"vip",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,J.jsx)(k.Z,{name:"vipExpireDate",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:h.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var t=new Date(e);return t.setHours(0,0,0,0),t.toISOString()}return e}}),(0,J.jsx)(T.Z,{name:"userUid",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:h.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(K=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",t),e.next=3,Q(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)}),onFocus:(G=p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,Q();case 3:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)}),options:W}}),(0,J.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,J.jsx)(F.Z,{name:"enabled",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==s||null===(r=s.user)||void 0===r?void 0:r.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==s?void 0:s.enabled),title:!0===(null==s||null===(n=s.user)||void 0===n?void 0:n.superUser)?h.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,J.jsx)(Y.Z,{defaultActiveKey:[],items:[{key:"1",label:"认证信息",children:(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(T.Z,{name:"verifiedType",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:[{label:"企业认证",value:"企业认证"},{label:"个人认证",value:"个人认证"},{label:"政府事业单位认证",value:"政府事业单位认证"}],placeholder:h.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,J.jsx)(T.Z,{name:"identityType",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:[{label:"营业执照",value:"营业执照"},{label:"身份证",value:"身份证"},{label:"护照",value:"护照"},{label:"其他",value:"其他"}],placeholder:h.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,J.jsx)(j.Z,{name:"identityImage",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:h.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,J.jsx)(j.Z,{name:"identityNumber",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:h.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,J.jsx)(j.Z,{name:"verifyDate",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:h.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请输入认证时间"})}),(0,J.jsx)(T.Z,{name:"verifyStatus",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:[{label:"未认证",value:"未认证"},{label:"已认证",value:"已认证"},{label:"审核中",value:"审核中"},{label:"审核失败",value:"审核失败"}],placeholder:h.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,J.jsx)(S.Z,{name:"rejectReason",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:h.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},W=r(65717),X=r(53432),G=r(31661),K=r(36265),Q=r(95674),_=r(50022),$=r(42539),ee=r(87523),te=["current","pageSize"],re=function(){var e=(0,L.useIntl)(),t=(0,o.useRef)(),r=(0,G.Z)().translateString,n=(0,o.useState)(!0),a=m()(n,2),s=a[0],l=a[1],d=(0,o.useState)(),f=m()(d,2),g=f[0],b=f[1],w=(0,o.useState)(!1),C=m()(w,2),j=C[0],S=C[1],F=(0,o.useState)(1),k=m()(F,2),T=(k[0],k[1]),D=(0,o.useState)(10),I=m()(D,2),z=I[0],E=I[1],U=(0,R.u)((function(e){return e.currentOrg})),B=(0,X.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),Y=B.setRoleResult,A=B.setRoleResultPlatform,O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,t){return t.logo?(0,J.jsx)("img",{src:t.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,t){return(0,_._i)(t.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,t){return(0,_.Cy)(t.verifyStatus)}},{title:e.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,t){return t.verifyDate?H()(t.verifyDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(t,r){return r.vip?e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,t){return t.vipExpireDate?H()(t.vipExpireDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(t,r){return!1===r.enabled?e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,t){return t.user?(0,J.jsxs)("div",{children:[(0,J.jsx)("div",{children:t.user.nickname||t.user.username}),(0,J.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:t.user.email})]}):"-"}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.createdAt?H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.updatedAt?H()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],q=[].concat(O,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,r,n,a){var s,i=!0===(null===(s=r.user)||void 0===s?void 0:s.superUser);return[(0,J.jsx)("a",{onClick:function(){ne(r)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,J.jsxs)(o.Fragment,{children:[(0,J.jsx)(M.Z,{type:"vertical"},"divider"),(0,J.jsx)(P.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:r.name||r.code}),onConfirm:function(){return ae(r)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,J.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),N=(0,W.v)((function(e){return e.currentCategory})),re=function(){b(void 0),l(!1),S(!0)},ne=function(e){b(e),l(!0),S(!0)},ae=function(){var n=p()(c()().mark((function n(a){var o,s,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!0!==(null===(o=a.user)||void 0===o?void 0:o.superUser)){n.next=3;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),n.abrupt("return");case 3:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.prev=4,n.next=7,(0,Q.FR)({uid:a.uid});case 7:s=n.sent,v.yw.destroy(),200===s.code?(v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=t.current)||void 0===i||i.reloadAndRest()):v.yw.error(r(s.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),v.yw.destroy(),v.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(e){return n.apply(this,arguments)}}(),oe=function(){var r=p()(c()().mark((function r(n){var a,o,i;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if($.Z.debug("handleSubmitDrawer",n),!s||!0!==(null==g||null===(a=g.user)||void 0===a?void 0:a.superUser)||!1!==n.enabled){r.next=4;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),r.abrupt("return");case 4:if(s?v.yw.loading(e.formatMessage({id:"updating"})):v.yw.loading(e.formatMessage({id:"creating"})),!s){r.next=11;break}return r.next=8,(0,Q.jM)(n);case 8:r.t0=r.sent,r.next=14;break;case 11:return r.next=13,(0,Q.c5)(n);case 13:r.t0=r.sent;case 14:o=r.t0,$.Z.debug("createOrg response:",n,o),200===o.code?(v.yw.destroy(),v.yw.success(s?e.formatMessage({id:"update.success",defaultMessage:"Update successful"}):e.formatMessage({id:"create.success",defaultMessage:"Create successful"})),S(!1),null===(i=t.current)||void 0===i||i.reloadAndRest()):(v.yw.destroy(),v.yw.error(o.message));case 17:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),se=function(){var t=p()(c()().mark((function t(){var r,n;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,orgUid:null==U?void 0:U.uid},t.next=4,(0,h.E9)(r);case 4:n=t.sent,$.Z.debug("queryRolesByOrg response ",n),200===n.code?(v.yw.destroy(),Y(n)):(v.yw.destroy(),v.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ie=function(){var t=p()(c()().mark((function t(){var r,n;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,level:K.Hxq},t.next=4,(0,h.E9)(r);case 4:n=t.sent,$.Z.debug("queryRolesBySuper response ",n),200===n.code?(v.yw.destroy(),A(n)):(v.yw.destroy(),v.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,o.useEffect)((function(){se(),ie()}),[]),(0,o.useEffect)((function(){var e;$.Z.debug("currentCategory:",N),null===(e=t.current)||void 0===e||e.reloadAndRest()}),[N]),(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(x.Z,{columns:q,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=p()(c()().mark((function t(n,a,o){var s,l,d,f,p;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return $.Z.debug("request:",n,a,o),v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=n.current,l=n.pageSize,d=u()(n,te),T(s),E(l),f=i()({pageNumber:s-1,pageSize:l},d),t.next=8,(0,Q.A8)(f);case 8:return p=t.sent,$.Z.debug("getAllOrgs response:",f,p),v.yw.destroy(),200===p.code||v.yw.error(r(p.message)),t.abrupt("return",{data:null==p?void 0:p.data.content,success:!0,total:null==p?void 0:p.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:z,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){$.Z.debug("pagination onChange:",e,t),T(e),E(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,J.jsx)(Z.ZP,{icon:(0,J.jsx)(y.Z,{}),type:"primary",onClick:re,disabled:!(0,ee.OJ)(),children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),j&&(0,J.jsx)(V,{isEdit:s,open:j,org:g,onClose:function(){S(!1)},onSubmit:oe})]})},ne=a.Z.Content,ae=function(){var e=(0,n.Z)().contentStyle;return(0,J.jsx)(a.Z,{children:(0,J.jsx)(a.Z,{children:(0,J.jsx)(ne,{style:e,children:(0,J.jsx)(re,{})})})})}},65717:function(e,t,r){r.d(t,{v:function(){return g}});var n=r(86222),a=r.n(n),o=r(73193),s=r.n(o),i=r(76711),l=r.n(i),u=r(36265),d=r(74543),c=r(21152),f=r(72083),p=r(42539);var g=(0,d.Ue)()((0,c.mW)((0,c.tJ)((0,f.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:u.zBg,name:u.zBg},setCategoryResult:function(t){var r=function(e){var t,r=[];return function e(t,n){t&&0!==t.length&&t.forEach((function(t){if(t&&t.uid&&t.uid!==u.zBg){var a=n?"".concat(n," / ").concat(t.name):t.name||"";r.push({label:a,value:t.uid}),t.children&&t.children.length>0&&e(t.children,a)}}))}((null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[]),r}(t),n=function(e){var t,r=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],n=function e(t){var r={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(r.children=t.children.map((function(t){return e(t)}))),r};return r.filter((function(e){return e&&e.uid&&e.uid!==u.zBg})).map((function(e){return n(e)}))}(t),a=[{title:u.zBg,key:u.zBg}].concat(l()(n)),o={uid:u.zBg,name:u.zBg},i=s()(s()({},t),{},{data:s()(s()({},t.data),{},{content:[o].concat(l()(t.data.content))})});e({categoryResult:i,categoryTreeOptions:a,categorySelectOptions:r}),0===t.data.content.length&&e({currentCategory:{uid:u.zBg,name:u.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var r=e.categoryResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){p.Z.log("resetDefaultCategory"),e({currentCategory:{uid:u.zBg,name:u.zBg}})},setCurrentCategoryUid:function(r){if(r!==u.zBg){var n=function e(t,r){if(t&&0!==t.length){var n,o=a()(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;if((null==s?void 0:s.uid)===r)return s;var i=e(null==s?void 0:s.children,r);if(i)return i}}catch(e){o.e(e)}finally{o.f()}}}(t().categoryResult.data.content,r);e({currentCategory:null!=n?n:{uid:u.zBg,name:u.zBg}})}else e({currentCategory:{uid:u.zBg,name:u.zBg}})},deleteCategoryCache:function(){return e({},!0)}}})),{name:u.OMm})))},53432:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(73193),a=r.n(n),o=r(76711),s=r.n(o),i=r(36265),l=r(74543),u=r(21152),d=r(72083),c=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},currentRolePlatform:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},roleResultPlatform:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},insertRolePlatform:function(t){e((function(e){e.roleResultPlatform.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var r=e.roleResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},upgradeRolePlatform:function(t){e((function(e){var r=e.roleResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(r){var n;(e({roleResult:r}),""===t().currentRole.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRole:r.data.content[0]}))},setRoleResultPlatform:function(r){var n;(e({roleResultPlatform:r}),""===t().currentRolePlatform.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRolePlatform:r.data.content[0]}))},setCurrentRole:function(r){var n=t().roleResult.data.content,o=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==o){var i=[].concat(s()(n.slice(0,o)),[r],s()(n.slice(o+1))),l=a()(a()({},t().roleResult),{},{data:{content:i}});e({roleResult:l,currentRole:r})}else console.warn("Role with the specified uid not found."),e({currentRole:r})},setCurrentRolePlatform:function(r){var n=t().roleResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==o){var i=[].concat(s()(n.slice(0,o)),[r],s()(n.slice(o+1))),l=a()(a()({},t().roleResultPlatform),{},{data:{content:i}});e({roleResultPlatform:l,currentRolePlatform:r})}else console.warn("Role with the specified uid not found."),e({currentRolePlatform:r})},removeRole:function(r){var n=t().roleResult.data.content,o=n.findIndex((function(e){return e.uid===r}));-1!==o?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,o)),s()(n.slice(o+1)))}})}):console.warn("Role not found in cache:",r),t().currentRole.uid===r&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},removeRolePlatform:function(r){var n=t().roleResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r}));-1!==o?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,o)),s()(n.slice(o+1)))}})}):console.warn("Role not found in cache:",r),t().currentRolePlatform.uid===r&&e({currentRolePlatform:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:i.uaR})))}}]);