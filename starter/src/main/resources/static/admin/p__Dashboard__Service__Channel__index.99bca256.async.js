"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{96865:function(e,n,t){var r=t(23864);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,n,t){var r=t(55735),a=t(65461),s=t(30921);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},69619:function(e,n,t){t.r(n),t.d(n,{default:function(){return Vn}});var r=t(96865),a=t(75574),s=t(45332),i=t.n(s),o=t(23864),l=t(73193),c=t.n(l),u=t(76711),d=t.n(u),p=t(55735),f=t(44435),h=t(83642),m=t(83890),g=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:i,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),x=t(9452),y=t(44194),v=t(36310),j=t(31549),b=[{name:"web",nickname:"网站/H5"},{name:"npm",nickname:"Npm包"}],w=function(){var e=(0,o.Z)().isDarkMode,n=(0,y.useState)([]),t=i()(n,2),r=t[0],a=t[1],s=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),l=s.currentChannel,c=s.setCurrentChannel;return(0,y.useEffect)((function(){var e=[].concat(b);(0,v.Ox)()||e.push({name:"app",nickname:"App应用"},{name:"wechat-app",nickname:"微信应用"}),a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,j.jsx)(x.Z.Item,{style:(null==l?void 0:l.name)===n.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){c(n)},children:(0,j.jsx)(x.Z.Item.Meta,{title:(0,j.jsx)("div",{style:{marginLeft:10},children:n.nickname})})})}})})},k=t(8247),A=t(30921),Z=function(){var e=(0,A.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(A.Access,{accessible:e.canDebug(),fallback:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(A.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},C=t(90819),M=t.n(C),S=t(89933),R=t.n(S),I=t(10154),P=t.n(I),E=t(86803);function W(e){return T.apply(this,arguments)}function T(){return(T=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return q.apply(this,arguments)}function q(){return(q=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return B.apply(this,arguments)}function B(){return(B=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return K.apply(this,arguments)}function K(){return(K=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return z.apply(this,arguments)}function z(){return(z=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return O.apply(this,arguments)}function O(){return(O=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=t(40612),_=t(15722),G=t(82669),H=t(53530),Y=t(27487),J=t(75365),X=t(76750),Q=t(72614),$=t(95490),ee=t(69169),ne=t(4499),te=t(84881),re=t(73442),ae=t(3849),se="MP",ie="MINI",oe="WORK",le="KEFU",ce=function(e){var n,t=e.isEdit,r=e.wechatApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ee.A.useForm(),p=i()(d,1)[0],f=(0,X.Z)().translateStringTranct,h=(0,N.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],b=(0,$.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),w=b.workgroupResult,k=b.setWorkgroupResult,A=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||oe,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==w||null===(e=w.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?w.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:oe,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,w]);var Z=function(){var e=R()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=4,(0,Q.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(E.yw.destroy(),k(t)):(E.yw.destroy(),E.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){Z()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(re.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(J.ZP,{type:"primary",onClick:A,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(ee.A,{form:p,name:"wechatWorkForm",onFinish:A,submitter:!1,children:[(0,j.jsx)(ne.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ne.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(te.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:se},{label:"微信小程序",value:ie},{label:"企业微信",value:oe},{label:"微信客服",value:le}],fieldProps:{defaultValue:oe},rules:[{required:!0}]}),(0,j.jsx)(ee.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ne.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===oe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(ee.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ne.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===oe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ne.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),E.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ne.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),E.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(te.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"客服技能组",name:"workgroupUid",options:null==w||null===(n=w.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},ue=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:i,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),de=P()(P()(P()(P()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),pe=function(){var e=(0,A.useIntl)(),n=(0,y.useRef)(!1),t=(0,X.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,y.useState)(!1),s=i()(a,2),l=s[0],c=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),g=m[0],v=m[1],b=(0,N.u)((function(e){return e.currentOrg})),w=ue((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),k=w.wechatAppResult,Z=w.currentWechatApp,C=w.setWechatAppResult,S=w.insertWechatApp,I=w.setCurrentWechatApp,P=w.deleteCurrentWechatApp,T=H.Z.useModal(),F=i()(T,2),q=F[0],B=F[1],K=function(){var n=R()(M()().mark((function n(t){var r;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete wechatApp",t),E.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,U(t);case 4:r=n.sent,console.log("delete wechatApp response",r),200===r.code?(E.yw.destroy(),E.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),P(t.uid)):(E.yw.destroy(),E.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),z=function(){var e=R()(M()().mark((function e(){var t,r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,E.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=8,W(t);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(E.yw.destroy(),C(r)):(E.yw.destroy(),E.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){f(!0),c(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var L=function(){var e=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),v(!0),e.prev=2,!p){e.next=8;break}return e.next=6,Q(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,v(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=R()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.yw.loading("正在创建..."),e.next=3,V(n);case 3:t=e.sent,E.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(S(t.data),I(t.data),c(!1),E.yw.success("创建成功")):E.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Q=function(){var e=R()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==Z?void 0:Z.uid,E.yw.loading("正在更新..."),e.next=4,D(n);case 4:t=e.sent,E.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(I(t.data),c(!1),E.yw.success("更新成功")):E.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(Y.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(J.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(G.Z,{}),onClick:function(){c(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){f(!0),c(!0)},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,j.jsx)(J.ZP,{size:"small",danger:!0,onClick:function(){return n=Z,void q.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(_.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){K(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:k.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:Z.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){I(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[t(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",de[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:t(null==e?void 0:e.description)})})}}),l&&(0,j.jsx)(ce,{isEdit:p,open:l,loading:g,wechatApp:Z,onClose:function(){c(!1)},onSubmit:L}),B]})},fe=t(32327),he=t(62673),me=t(73589),ge=t(29266),xe=t(19116),ye=t(88996),ve=t(38775),je=t(83337),be=t(34600),we=t(15892),ke=t(54800),Ae=t(59304),Ze=t(80556),Ce=t(5716),Me=t(90297),Se=t(34545),Re=t(28977),Ie=t.n(Re),Pe=fe.Z.Text,Ee=fe.Z.Paragraph,We=P()(P()(P()(P()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Te=P()(P()(P()(P()({},p.a4q,(0,j.jsx)(je.Z,{})),p.qRy,(0,j.jsx)(be.Z,{})),p._oo,(0,j.jsx)(we.Z,{})),p.rWo,(0,j.jsx)(ke.Z,{})),Fe={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},qe={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ve=function(){var e,n=(0,A.useIntl)(),t=ue((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=t.currentWechatApp,a=t.refreshCurrentWechatApp,s=(0,y.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),g=m[0],x=m[1],b=(0,y.useState)(!1),w=i()(b,2),k=w[0],Z=w[1],C=(0,y.useState)(!1),S=i()(C,2),I=(S[0],S[1],(0,y.useState)(!1)),P=i()(I,2),W=P[0],T=P[1],q=(0,y.useState)(!1),V=i()(q,2),B=V[0],D=V[1],K=function(e,n){return e?n?e:"******":"-"},U=function(){var e=R()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return E.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return T(!0),e.prev=4,e.next=7,L({uid:r.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(E.yw.success("AccessToken 刷新成功"),a&&a(n.data)):E.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),E.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,T(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=R()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return E.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return D(!0),e.prev=4,e.next=7,F({uid:r.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(t=n.data,E.yw.success("应用详情刷新成功"),a&&a(t)):E.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),E.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,D(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(he.Z,{title:(0,j.jsxs)(ae.Z,{children:[Te[r.type]||(0,j.jsx)(je.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(ge.Z,{color:"blue",children:We[r.type]||r.type})]}),extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(Ae.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(Ze.Z,{}),onClick:z,loading:B,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(xe.Z,{bordered:!0,column:1,children:[(0,j.jsx)(xe.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Pe,{copyable:!0,children:r.uid})}),(0,j.jsx)(xe.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(xe.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(ge.Z,{color:"blue",children:We[r.type]||r.type})}),(0,j.jsx)(xe.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(Pe,{copyable:!0,children:r.appId})}),(0,j.jsx)(xe.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!p&&{text:r.appSecret||""},children:K(r.appSecret,p)}),(0,j.jsx)(ye.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(J.ZP,{type:"text",icon:p?(0,j.jsx)(Ce.Z,{}):(0,j.jsx)(Me.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,j.jsx)(xe.Z.Item,{label:"加密模式",children:(0,j.jsx)(ge.Z,{color:qe[r.encryptMode]||"default",children:Fe[r.encryptMode]||r.encryptMode})}),(0,j.jsx)(xe.Z.Item,{label:"URL",children:(0,j.jsx)(Pe,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+r.uid})}),(0,j.jsx)(xe.Z.Item,{label:"Token",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!g&&{text:r.token||""},children:K(r.token,g)}),(0,j.jsx)(ye.Z,{title:g?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:g?(0,j.jsx)(Ce.Z,{}):(0,j.jsx)(Me.Z,{}),onClick:function(){return x(!g)},size:"small"})})]})}),(0,j.jsx)(xe.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!k&&{text:r.encodingAesKey||""},children:K(r.encodingAesKey,k)}),(0,j.jsx)(ye.Z,{title:k?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(J.ZP,{type:"text",icon:k?(0,j.jsx)(Ce.Z,{}):(0,j.jsx)(Me.Z,{}),onClick:function(){return Z(!k)},size:"small"})})]})}),(0,j.jsx)(xe.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!l&&{text:r.accessToken||""},children:K(r.accessToken,l)}),(0,j.jsx)(ye.Z,{title:l?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:l?(0,j.jsx)(Ce.Z,{}):(0,j.jsx)(Me.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,j.jsx)(ye.Z,{title:"刷新AccessToken",children:(0,j.jsx)(J.ZP,{type:"primary",icon:(0,j.jsx)(Se.Z,{}),onClick:U,size:"small",loading:W,children:"刷新Token"})})]})}),(0,j.jsx)(xe.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Ie()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,j.jsx)(xe.Z.Item,{label:n.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(Ee,{children:r.description})}),(0,j.jsx)(xe.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ie()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(fe.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(Ee,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先在左侧列表选择一个微信应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})})},Be=function(e){console.log(e)},De=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Ve,{})}],Ke=function(){var e=(0,y.useState)(De),n=i()(e,2),t=n[0],r=n[1];return(0,y.useEffect)((function(){var e=[].concat(De);r(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(k.Z,{defaultActiveKey:"agent",items:t,onChange:Be})})},Ue=a.Z.Sider,ze=a.Z.Content,Le=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Ue,{width:t,style:n,children:(0,j.jsx)(pe,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(ze,{children:(0,j.jsx)(Ke,{})})})]})},Oe=t(24170),Ne=t(91723),_e=t(67402),Ge=t(71529),He=function(e){var n=e.platform,t=void 0===n?"react":n,r=(0,A.useIntl)(),a=(0,y.useState)(t),s=i()(a,2),o=s[0],l=s[1],c=o.charAt(0).toUpperCase()+o.slice(1),u="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(c);return(0,j.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,j.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsx)("h2",{children:(0,j.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:r.formatMessage({id:"install.guide.github"})})}),(0,j.jsx)(J.ZP,{type:"primary",icon:(0,j.jsx)(Ge.Z,{}),href:"".concat("https://www.weiyuai.cn/docs/zh-CN/docs/channel/").concat("vanilla"===o?"web":o),target:"_blank",children:r.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,j.jsx)(ve.Z,{orientation:"left",children:"选择框架"}),(0,j.jsx)(_e.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){l(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,j.jsx)("h2",{children:r.formatMessage({id:"install.guide.steps"})}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step1.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(r.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step2.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step3.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(r.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(r.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step4.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(u," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(r.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step5.title"})}),(0,j.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",r.formatMessage({id:"install.guide.step5.show"})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",r.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},Ye=t(1902),Je=fe.Z.Title,Xe=fe.Z.Text,Qe=function(e){var n=e.channel,t=((0,y.useRef)(!1),(0,X.Z)().translateString),r=g((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),a=r.currentType,s=r.setCurrentType,o=(0,N.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,Ye.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,f=c.setAgentResult,h=c.setCurrentAgent,m=(0,y.useState)([]),x=i()(m,2),v=x[0],b=x[1],w=(0,$.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),k=w.workgroupResult,A=w.currentWorkgroup,Z=w.setWorkgroupResult,C=w.setCurrentWorkgroup,S=(0,y.useState)(null==d?void 0:d.uid),I=i()(S,2),P=I[0],W=I[1],T=(0,y.useState)(null==A?void 0:A.uid),F=i()(T,2),q=F[0],V=F[1],B=(0,y.useState)([]),D=i()(B,2),K=D[0],U=D[1],z=function(){var e=R()(M()().mark((function e(){var n,r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,Oe._t)(n);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(E.yw.destroy(),f(r),r.data.content.length>0&&(h(r.data.content[0]),W(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),b(a)):(E.yw.destroy(),E.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=R()(M()().mark((function e(){var n,r,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,Q.LE)(n);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(E.yw.destroy(),Z(r),r.data.content.length>0&&(C(r.data.content[0]),V(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),U(a)):(E.yw.destroy(),E.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z(),L()}),[a]);var O=["web","npm","ios","android","flutter","uniapp"].includes((null==n?void 0:n.name)||"");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(_e.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),s(e.target.value)},options:l,defaultValue:a,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)("br",{}),(0,j.jsx)("br",{}),a===p.Njn&&(null==d?void 0:d.uid)&&(0,j.jsx)(_e.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=u.data.content.find((function(n){return n.uid===e.target.value}));h(n)},options:v,defaultValue:P,optionType:"button",buttonStyle:"solid"}),a===p.aZD&&(null==d?void 0:d.uid)&&(0,j.jsx)(_e.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=k.data.content.find((function(n){return n.uid===e.target.value}));C(n)},options:K,defaultValue:q,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(Je,{level:5,children:"组织orgUid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,j.jsx)(Je,{level:5,children:"一对一当前客服Uid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,j.jsx)(Je,{level:5,children:"当前技能组Uid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==A?void 0:A.uid}),(0,j.jsx)(ve.Z,{}),O&&("web"===(null==n?void 0:n.name)?(0,j.jsx)(Ne.Z,{type:p.aZD}):"npm"===(null==n?void 0:n.name)?(0,j.jsx)(He,{}):null)]})};function $e(e){return en.apply(this,arguments)}function en(){return(en=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(e){return tn.apply(this,arguments)}function tn(){return(tn=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rn(e){return an.apply(this,arguments)}function an(){return(an=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e){return on.apply(this,arguments)}function on(){return(on=R()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ln=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().appResult),{},{data:{content:s}});e({appResult:i,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),cn=t(32350),un=function(e){var n=e.open,t=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,o=(0,A.useIntl)(),l=ee.A.useForm(),u=i()(l,1)[0],d=(0,N.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,y.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,j.jsx)(re.Z,{title:t?o.formatMessage({id:"edit",defaultMessage:"编辑应用"}):o.formatMessage({id:"add",defaultMessage:"添加应用"}),width:400,open:n,onClose:a,maskClosable:!1,footer:(0,j.jsxs)("div",{style:{textAlign:"right"},children:[(0,j.jsx)(J.ZP,{onClick:a,style:{marginRight:8},children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,j.jsx)(J.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});s(n)}))},type:"primary",children:o.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,j.jsxs)(ee.A,{form:u,layout:"vertical",submitter:!1,children:[(0,j.jsx)(ne.Z,{name:"name",label:o.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:o.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:o.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,j.jsx)(te.Z,{name:"appPlatform",label:o.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:o.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:o.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,j.jsx)(ne.Z,{name:"appPackage",label:o.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:o.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:o.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,j.jsx)(ne.Z,{name:"appKey",label:"App Key",placeholder:o.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,j.jsx)(J.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,j.jsx)(ne.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:o.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,j.jsx)(cn.Z,{name:"description",label:o.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:o.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},dn=function(){var e=(0,A.useIntl)(),n=(0,y.useRef)(!1),t=(0,X.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,y.useState)(!1),s=i()(a,2),l=s[0],c=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,N.u)((function(e){return e.currentOrg})),m=ln((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),g=m.appResult,v=m.currentApp,b=m.setAppResult,w=m.insertApp,k=m.setCurrentApp,Z=m.deleteCurrentApp,C=H.Z.useModal(),S=i()(C,2),I=S[0],P=S[1],W=function(){var n=R()(M()().mark((function n(t){var r;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete app",t),E.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除"})),n.next=4,sn(t);case 4:r=n.sent,console.log("delete app response",r),200===r.code?(E.yw.destroy(),E.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),Z(t.uid)):(E.yw.destroy(),E.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),T=function(){var e=R()(M()().mark((function e(){var t,r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,E.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=8,$e(t);case 8:r=e.sent,console.log("getApps",r),200===r.code?(E.yw.destroy(),b(r)):(E.yw.destroy(),E.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){T()}),[]);var F=function(){var n=R()(M()().mark((function n(t){var r;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,nn(t);case 2:r=n.sent,console.log("handleCreateApp response:",r),200===r.code?(w(r.data),c(!1),E.yw.success(e.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):E.yw.error(r.message);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),q=function(){var n=R()(M()().mark((function n(t){var r;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.uid=null==v?void 0:v.uid,n.next=3,rn(t);case 3:r=n.sent,console.log("handleUpdateApp response:",r),200===r.code?(k(r.data),c(!1),E.yw.success(e.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):E.yw.error(r.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(Y.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(J.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(G.Z,{}),onClick:function(){c(!0),f(!1)},children:e.formatMessage({id:"create",defaultMessage:"新建"})}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){f(!0),c(!0)},disabled:""===(null==v?void 0:v.uid),children:e.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,j.jsx)(J.ZP,{size:"small",danger:!0,onClick:function(){return function(n){I.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(_.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(n.name,"】？"),onOk:function(){W(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(v)},disabled:""===(null==v?void 0:v.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:g.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:v.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){k(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[t(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",t(null==e?void 0:e.appPlatform),")"]})]}),description:t(null==e?void 0:e.description)})})}}),l&&(0,j.jsx)(un,{isEdit:p,open:l,app:v,onClose:function(){c(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?q(e):F(e)}}),P]})},pn=t(2523),fn=t(48006),hn=t(40795),mn=fe.Z.Text,gn=fe.Z.Paragraph,xn={android:(0,j.jsx)(pn.Z,{}),ios:(0,j.jsx)(fn.Z,{}),flutter:(0,j.jsx)(hn.Z,{}),uniapp:(0,j.jsx)(be.Z,{})},yn={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},vn=function(){var e=(0,A.useIntl)(),n=ln().currentApp;return null!=n&&n.uid?(0,j.jsxs)(he.Z,{title:(0,j.jsxs)(ae.Z,{children:[xn[n.appPlatform]||(0,j.jsx)(hn.Z,{}),(0,j.jsx)("span",{children:n.name||"应用详情"}),(0,j.jsx)(ge.Z,{color:"blue",children:yn[n.appPlatform]||n.appPlatform})]}),bordered:!1,children:[(0,j.jsxs)(xe.Z,{bordered:!0,column:1,children:[(0,j.jsx)(xe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(mn,{copyable:!0,children:n.uid})}),(0,j.jsx)(xe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,j.jsx)(xe.Z.Item,{label:"App Key",children:(0,j.jsx)(mn,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,j.jsx)(xe.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,j.jsx)(xe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(gn,{children:n.description})}),(0,j.jsx)(xe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(fe.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(gn,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先选择或创建一个应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})})},jn=t(69079),bn=t(72608),wn=fe.Z.Title,kn=fe.Z.Paragraph,An=fe.Z.Text,Zn=(fe.Z.Link,k.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),Cn=function(){(0,A.useIntl)();var e=ln().currentApp,n=(0,N.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先选择或创建一个应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})});return(0,j.jsxs)(he.Z,{title:"集成指南",bordered:!1,extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(jn.Z,{}),onClick:function(){var n=e.appPlatform,t=Zn[n];t?window.open(t,"_blank"):bn.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(Ge.Z,{}),onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,j.jsxs)(wn,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,j.jsxs)(kn,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(wn,{level:5,children:"1. 基本配置"}),(0,j.jsx)(kn,{children:(0,j.jsxs)("ul",{children:[e.appKey&&(0,j.jsxs)("li",{children:[(0,j.jsx)(An,{strong:!0,children:"App Key:"})," ",(0,j.jsx)(An,{copyable:!0,children:e.appKey})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)(An,{strong:!0,children:"组织ID:"})," ",(0,j.jsx)(An,{copyable:!0,children:null==n?void 0:n.uid})]})]})}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(kn,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},Mn=function(e){console.log(e)},Sn=[{key:"details",label:"应用详情",children:(0,j.jsx)(vn,{})},{key:"integration",label:"集成指南",children:(0,j.jsx)(Cn,{})}],Rn=function(){var e=(0,y.useState)([]),n=i()(e,2),t=n[0],r=n[1];ln((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,y.useEffect)((function(){var e=[].concat(Sn);r(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(k.Z,{defaultActiveKey:"details",items:t,onChange:Mn})})},In=a.Z.Sider,Pn=a.Z.Content,En=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(In,{width:t,style:n,children:(0,j.jsx)(dn,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Pn,{children:(0,j.jsx)(Rn,{})})})]})},Wn=function(e){var n=e.channel,t="web"===(null==n?void 0:n.name)||"npm"===(null==n?void 0:n.name);return(0,j.jsxs)("div",{children:[t&&(0,j.jsx)(Qe,{channel:n}),"app"===(null==n?void 0:n.name)&&(0,j.jsx)(En,{}),"wechat-app"===(null==n?void 0:n.name)&&(0,j.jsx)(Le,{}),"douyin"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"baidu"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"weibo"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"pdd"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"jd"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"qianniu"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"doudian"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"telegram"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"facebook"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"line"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"shopify"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"lazada"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"wordpress"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"opencart"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"magento"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"prestashop"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"dify"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{}),"coze"===(null==n?void 0:n.name)&&(0,j.jsx)(Z,{})]})},Tn=function(){var e=(0,y.useState)(""),n=i()(e,2),t=n[0],r=n[1],a=(0,y.useState)([]),s=i()(a,2),o=s[0],l=s[1],c=g().currentChannel;(0,y.useEffect)((function(){c&&u(c)}),[c]);var u=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&l([].concat(d()(o),[{label:e.nickname,key:n,children:(0,j.jsx)(Wn,{channel:e}),channelInfo:e,closable:!0}])),r(n)};return(0,j.jsx)(k.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),a=o.filter((function(n){return n.key!==e}));if(a.length&&e===t){var s=a[n===a.length?n-1:n].key;r(s)}l(a)}(e)},items:o})},Fn=a.Z.Sider,qn=a.Z.Content,Vn=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Fn,{style:n,children:(0,j.jsx)(w,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(qn,{style:t,children:(0,j.jsx)(Tn,{})})})]})})}}}]);