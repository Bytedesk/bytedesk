"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5160],{32045:function(e,n,t){t.d(n,{XS:function(){return d},k4:function(){return g},uu:function(){return v},yr:function(){return y}});var r=t(90819),a=t.n(r),o=t(73193),s=t.n(o),u=t(89933),i=t.n(u),c=t(55735),l=t(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:s()(s()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:s()(s()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:s()(s()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:s()(s()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95160:function(e,n,t){t.d(n,{Z:function(){return P}});var r=t(90819),a=t.n(r),o=t(89933),s=t.n(o),u=t(45332),i=t.n(u),c=t(15722),l=t(90727),d=t(82669),f=t(80556),g=t(59304),p=t(54881),y=t(2484),h=t(53530),v=t(52288),m=t(75365),w=t(27487),b=t(96485),x=t(79777),k=t(88996),C=t(65837),M=t(86803),j=t(76750),S=t(6397),K=t(40612),Z=t(69169),z=t(4499),R=t(84881),L=t(44194),T=t(90838),U=t(55735),O=t(31549),F=function(e){var n,t=e.open,r=e.level,o=e.type,u=e.isEdit,c=e.onCancel,l=e.onSubmit,d=Z.A.useForm(),f=i()(d,1)[0],g=(0,j.Z)().translateString,p=(0,K.u)((function(e){return e.currentOrg})),y=(0,S.j)((function(e){return e.kbaseResult})),v=(0,S.j)((function(e){return e.currentKbase})),m=(0,T.v)((function(e){return e.currentCategory}));(0,L.useEffect)((function(){u?f.setFieldsValue({name:g(null==m?void 0:m.name)}):f.resetFields(),f.setFieldsValue({kbUid:null==v?void 0:v.uid})}),[t,u]);var w=function(){f.validateFields().then(function(){var e=s()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:u?null==m?void 0:m.uid:"",name:n.name,level:r,type:o,kbUid:n.kbUid,orgUid:null==p?void 0:p.uid},l(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),M.yw.error("创建分类失败")}))};return(0,O.jsx)("div",{children:(0,O.jsx)(h.Z,{title:u?"编辑分类":"创建分类",open:t,forceRender:!0,onOk:w,onCancel:c,getContainer:!1,children:(0,O.jsxs)(Z.A,{form:f,name:"categoryForm",submitter:!1,children:[(0,O.jsx)(z.Z,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&w()},placeholder:"请输入分类名称"}}),o!==U.Kvk&&o!==U.hcJ&&(0,O.jsx)(R.Z,{name:"kbUid",label:"所属知识库",allowClear:!0,options:null==y||null===(n=y.data)||void 0===n?void 0:n.content.map((function(e){return{label:g(e.name),value:e.uid}}))})]})})})},B=t(30921),E=t(28425),P=function(e){var n=e.type,t=e.level,r=(0,B.useIntl)(),o=(0,L.useState)(!0),u=i()(o,2),Z=u[0],z=u[1],R=(0,L.useState)(!1),P=i()(R,2),D=P[0],q=P[1],I=(0,L.useState)(1),A=i()(I,2),N=A[0],V=A[1],X=(0,L.useState)(20),H=i()(X,2),J=H[0],Y=H[1],W=(0,L.useState)(0),G=i()(W,2),Q=G[0],$=G[1],_=(0,L.useState)(""),ee=i()(_,2),ne=ee[0],te=ee[1],re=(0,K.u)((function(e){return e.currentOrg})),ae=(0,S.j)((function(e){return e.currentKbase})),oe=(0,L.useState)(!1),se=i()(oe,2),ue=se[0],ie=se[1],ce=(0,T.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),le=ce.categoryTreeOptions,de=ce.currentCategory,fe=ce.setCurrentCategoryUid,ge=(0,j.Z)(),pe=ge.translateString,ye=ge.translateStringTranct,he=h.Z.useModal(),ve=i()(he,2),me=ve[0],we=ve[1],be=function(){var e=s()(a()().mark((function e(){var o,s,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(!0),o=n===U.FXY||n===U.Kvk,s=o?"":null==ae?void 0:ae.uid,e.next=5,(0,E.HK)(n,null==re?void 0:re.uid,s,t,{showLoading:!0,pageSize:J,pageNumber:N-1,searchName:ne,loadingMessage:r.formatMessage({id:"loading"}),errorMessage:r.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 5:u=e.sent,q(!1),u&&u.data&&$(u.data.totalElements||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=function(e){te(e),V(1),setTimeout((function(){be()}),0)},ke=function(e,n){V(e),n&&n!==J&&Y(n),setTimeout((function(){be()}),0)},Ce=function(){var e=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z(!1),ie(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z(!0),ie(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(){var e=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,E.sT)(n,{showLoading:!0,loadingMessage:r.formatMessage({id:"deleting"}),successMessage:r.formatMessage({id:"delete.success"}),errorMessage:r.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&be();case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Se=function(){var e=s()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={showLoading:!0,loadingMessage:r.formatMessage({id:Z?"updating":"creating"}),successMessage:r.formatMessage({id:Z?"update.success":"create.success"}),errorMessage:r.formatMessage({id:Z?"update.error":"create.error",defaultMessage:Z?"Update failed":"Create failed"})},!Z){e.next=7;break}return e.next=4,(0,E.ht)(n,t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,E.i8)(n,t);case 9:e.t0=e.sent;case 10:e.t0&&(ie(!1),be());case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,L.useEffect)((function(){n!==U.FXY&&(V(1),te(""),be())}),[ae]),(0,L.useEffect)((function(){n!==U.FXY&&n!==U.Kvk||(V(1),te(""),be())}),[]);return(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(Q/J)>1||""!==ne)&&(0,O.jsx)(v.Z,{placeholder:r.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,O.jsx)(l.Z,{}),suffix:(0,O.jsx)(m.ZP,{type:"text",size:"small",icon:(0,O.jsx)(l.Z,{}),onClick:function(){return xe(ne)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,O.jsx)("span",{onClick:function(e){e.stopPropagation(),te(""),V(1),be()}})},value:ne,onChange:function(e){var n=e.target.value;te(n),n||(V(1),setTimeout((function(){be()}),0))},onPressEnter:function(e){return xe(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,O.jsxs)(w.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,O.jsxs)(w.Z,{gap:"small",children:[(0,O.jsx)(m.ZP,{type:"primary",size:"small",icon:(0,O.jsx)(d.Z,{}),onClick:Ce,children:r.formatMessage({id:"create.category"})}),(0,O.jsx)(m.ZP,{size:"small",icon:(0,O.jsx)(f.Z,{spin:D}),onClick:be,loading:D,children:r.formatMessage({id:"refresh"})})]}),""!==(null==de?void 0:de.uid)&&(null==de?void 0:de.uid)!==U.zBg&&(0,O.jsx)(b.Z,{menu:{items:[{key:"edit",icon:(0,O.jsx)(g.Z,{}),label:r.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Me},{key:"delete",icon:(0,O.jsx)(p.Z,{}),label:r.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==U.zBg?me.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,O.jsx)(c.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(pe(e.name),"】？"),onOk:function(){je(e)},onCancel:function(){},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})}):M.yw.error(r.formatMessage({id:"delete.dept.all.error"}))}(de)}}]},children:(0,O.jsx)(m.ZP,{size:"small",icon:(0,O.jsx)(y.Z,{})})})]})]}),(0,O.jsx)(x.Z,{defaultSelectedKeys:[null==de?void 0:de.uid],selectedKeys:[null==de?void 0:de.uid],onSelect:function(e,n){0!==e.length&&fe(e[0].toString())},treeData:le,blockNode:!0,titleRender:function(e){return(0,O.jsx)(k.Z,{title:pe(e.title),children:ye(e.title)})}}),Math.ceil(Q/J)>1&&(0,O.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,O.jsx)(C.Z,{size:"small",current:N,pageSize:J,total:Q,onChange:ke,onShowSizeChange:ke,showSizeChanger:!0,showLessItems:!0}),(0,O.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:r.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:Q})})]}),ue&&(0,O.jsx)(F,{open:ue,type:n,isEdit:Z,onCancel:function(){ie(!1)},onSubmit:Se}),we]})}},28425:function(e,n,t){t.d(n,{HK:function(){return d},ht:function(){return g},i8:function(){return f},sT:function(){return p}});var r=t(90819),a=t.n(r),o=t(89933),s=t.n(o),u=t(86803),i=t(32045),c=t(90838),l=t(55735),d=function(){var e=s()(a()().mark((function e(n,t,r,o,s){var d,f,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=c.v.getState().setCategoryResult,null!=s&&s.showLoading&&u.yw.loading((null==s?void 0:s.loadingMessage)||"Loading..."),f={pageNumber:(null==s?void 0:s.pageNumber)||0,pageSize:(null==s?void 0:s.pageSize)||20,type:n,kbUid:r,orgUid:o===l.Hxq?"":t,level:o,name:(null==s?void 0:s.searchName)||""},e.prev=3,e.next=6,(0,i.XS)(f);case 6:if(g=e.sent,console.log("queryCategoriesByOrg response: ",g,f),200!==g.code){e.next=14;break}return d(g),null!=s&&s.showLoading&&u.yw.destroy(),e.abrupt("return",g);case 14:return null!=s&&s.showLoading&&u.yw.destroy(),u.yw.error(g.message),e.abrupt("return",null);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(3),null!=s&&s.showLoading&&u.yw.destroy(),u.yw.error((null==s?void 0:s.errorMessage)||"Failed to fetch categories"),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(n,t,r,a,o){return e.apply(this,arguments)}}(),f=function(){var e=s()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&u.yw.loading((null==t?void 0:t.loadingMessage)||"Creating..."),e.prev=1,e.next=4,(0,i.k4)(n);case 4:if(r=e.sent,console.log("createCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.success((null==t?void 0:t.successMessage)||"Create Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error((null==t?void 0:t.errorMessage)||"Failed to create category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}(),g=function(){var e=s()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&u.yw.loading((null==t?void 0:t.loadingMessage)||"Updating..."),e.prev=1,e.next=4,(0,i.yr)(n);case 4:if(r=e.sent,console.log("updateCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.success((null==t?void 0:t.successMessage)||"Update Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error((null==t?void 0:t.errorMessage)||"Failed to update category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}(),p=function(){var e=s()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&u.yw.loading((null==t?void 0:t.loadingMessage)||"Deleting..."),e.prev=1,e.next=4,(0,i.uu)(n);case 4:if(r=e.sent,console.log("deleteCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.success((null==t?void 0:t.successMessage)||"Delete Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&u.yw.destroy(),u.yw.error((null==t?void 0:t.errorMessage)||"Failed to delete category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}()},90838:function(e,n,t){t.d(n,{v:function(){return d}});var r=t(76711),a=t.n(r),o=t(73193),s=t.n(o),u=t(55735),i=t(44435),c=t(83642),l=t(83890);var d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,n){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:u.zBg,name:u.zBg},setCategoryResult:function(n){var t=function(e){var n=[];return e.data.content.forEach((function(e){var t={label:e.name,value:e.uid};n.push(t)})),n}(n),r={uid:u.zBg,name:u.zBg},o=s()(s()({},n),{},{data:s()(s()({},n.data),{},{content:[r].concat(a()(n.data.content))})}),i=function(e){var n=[];return e.data.content.forEach((function(e){var t={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(t.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),n.push(t)})),n}(o);e({categoryResult:o,categoryTreeOptions:i,categorySelectOptions:t}),0===n.data.content.length&&e({currentCategory:{uid:u.zBg,name:u.zBg}})},insertCategory:function(n){e((function(e){e.categoryResult.data.content.unshift(n)}))},upgradeCategory:function(n){e((function(e){var t=e.categoryResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Category with uid ".concat(n.uid," not found."))}))},setCurrentCategory:function(n){e({currentCategory:n})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:u.zBg,name:u.zBg}})},setCurrentCategoryUid:function(t){var r=n().categoryResult.data.content.find((function(e){return e.uid===t}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:u.OMm})))},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),o=t(76711),s=t.n(o),u=t(55735),i=t(44435),c=t(83642),l=t(83890),d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==o){var u=[].concat(s()(r.slice(0,o)),[t],s()(r.slice(o+1))),i=a()(a()({},n().kbaseResult),{},{data:{content:u}});e({kbaseResult:i,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t}));-1!==o?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(s()(r.slice(0,o)),s()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:u.wKE})))}}]);