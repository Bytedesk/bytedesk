"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{33798:function(e,t,n){var l=n(90819),a=n.n(l),r=n(89933),i=n.n(r),o=n(45332),s=n.n(o),d=n(74341),u=n(93527),c=n(11591),p=n(67559),f=n(44679),v=n(14888),m=n(6844),g=n(90104),h=n(30064),b=n(68263),x=n(19736),M=n(44194),y=n(53816),k=n(36125),w=n(31549);t.Z=function(e){var t,n,l,r,o=h.A.useForm(),S=s()(o,1)[0],j=(0,x.useIntl)(),C=(0,f.Z)().translateString,T=(0,v.u)((function(e){return e.currentOrg})),Z=(0,M.useState)(),P=s()(Z,2),U=P[0],E=P[1],F=(0,M.useState)(),I=s()(F,2),K=I[0],q=I[1],R=(0,M.useState)(),L=s()(R,2),A=L[0],D=L[1],W=(0,M.useState)(""),N=s()(W,2),O=N[0],z=N[1],Q=(0,M.useRef)(!1),B=(0,M.useRef)(),V=(0,M.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),G=(0,M.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),H=(0,M.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),J=(0,M.useCallback)((function(e){S.setFieldValue("welcomeTip",e),H({welcomeTip:e})}),[S,H]);(0,M.useEffect)((function(){if(null!=T&&T.uid&&(B.current!==T.uid&&(B.current=T.uid,Q.current=!1),!Q.current)){Q.current=!0;var e=function(){var e=i()(a()().mark((function e(){var t,n,l,r,i,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:T.uid},e.next=4,(0,p.AP)(t);case 4:n=e.sent,k.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),u.yw.destroy(),200===n.code?(q(n),i=(null==n||null===(l=n.data)||void 0===l?void 0:l.content)||[],o=null==G?void 0:G.welcomeKbUid,(s=o||A||(null===(r=i[0])||void 0===r?void 0:r.uid))&&(D(s),S.setFieldValue("welcomeKbUid",s),o!==s&&H({welcomeKbUid:s}))):u.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,j,null==G?void 0:G.welcomeKbUid,A,S,H]),(0,M.useEffect)((function(){if(null!=T&&T.uid&&A){var e=function(){var e=i()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(j.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:T.uid,kbUid:A},e.next=4,(0,c.pf)(t);case 4:n=e.sent,k.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),u.yw.destroy(),200===n.code?E(n):u.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,A,j]),(0,M.useEffect)((function(){if(G){var e=null==G?void 0:G.welcomeFaqs,t=Array.isArray(G.welcomeFaqUids)?G.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];S.setFieldValue("welcomeFaqUids",t)}}),[S,null==U||null===(t=U.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==G?void 0:G.welcomeFaqUids,G]);var _=(0,M.useCallback)((function(e){D(e),S.setFieldValue("welcomeFaqUids",[]),H({welcomeKbUid:e,welcomeFaqUids:[]})}),[H,S]);return(0,M.useEffect)((function(){var e=C(null==G?void 0:G.welcomeTip);void 0!==e&&O!==e&&z(e),null!=G&&G.welcomeKbUid&&(S.setFieldValue("welcomeKbUid",G.welcomeKbUid),A!==G.welcomeKbUid&&D(G.welcomeKbUid))}),[C,null==G?void 0:G.welcomeTip,null==G?void 0:G.welcomeKbUid,O,S,A,null==K||null===(n=K.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,w.jsxs)(h.A,{form:S,submitter:!1,style:{marginLeft:"20px"},children:[(0,w.jsx)(h.A.Item,{name:"welcomeTip",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"agent.settings.welcome.tip"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:j.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:j.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,w.jsx)(y.Z,{placeholder:j.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:O,toolbarKeys:(0,g.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:J})}),(0,w.jsx)(b.Z,{name:"welcomeKbUid",width:"md",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.select",defaultMessage:"é€‰æ‹©æ¬¢è¿è¯­å¸¸è§é—®é¢˜çŸ¥è¯†åº“"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==K||null===(l=K.data)||void 0===l||null===(l=l.content)||void 0===l?void 0:l.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return _(e)},allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,w.jsx)(b.Z,{name:"welcomeFaqUids",width:"md",label:(0,w.jsxs)("span",{children:[j.formatMessage({id:"menu.kbase.faq.welcome"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==U||null===(r=U.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return H({welcomeFaqUids:e})}}})]})}},4179:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ke}});var l=n(44194),a=n(31167),r=n(19736),i=n(76711),o=n.n(i),s=n(90819),d=n.n(s),u=n(89933),c=n.n(u),p=n(73193),f=n.n(p),v=n(45332),m=n.n(v),g=n(85255),h=n(3925),b=n(9428),x=n(48769),M=n(71876),y=n(12792),k=n(66810),w=n(65513),S=n(77359),j=n(74840),C=n(29337),T=n(68779),Z=n(12322),P=n(56482),U=n(10162),E=n(90727),F=n(59304),I=n(54881),K=n(47944),q=n(80556),R=n(55785),L=n(79866),A=n(93527),D=n(29195),W=n(14888),N=n(88449),O=n(26710),z=n(61952),Q=n(2061),B=(n(47460),n(15012),n(42670),n(23312)),V=n(1725),G=n(33798),H=n(68972),J=n(21914),_=n(36125),Y=n(31549),$="welcome",X=function(){var e=(0,r.useIntl)(),t=(0,W.u)((function(e){return e.currentOrg})),n=(0,N.Z)().leftSiderStyle,i=(0,O.Z)().isDarkMode,s=(0,l.useState)(!1),u=m()(s,2),p=u[0],v=u[1],X=(0,l.useState)([]),ee=m()(X,2),te=ee[0],ne=ee[1],le=(0,l.useState)(),ae=m()(le,2),re=ae[0],ie=ae[1],oe=(0,l.useState)(""),se=m()(oe,2),de=se[0],ue=se[1],ce=(0,l.useState)($),pe=m()(ce,2),fe=pe[0],ve=pe[1],me=(0,l.useState)(!1),ge=m()(me,2),he=ge[0],be=ge[1],xe=(0,l.useState)(null),Me=m()(xe,2),ye=Me[0],ke=Me[1],we=(0,l.useMemo)((function(){return te.find((function(e){return e.uid===re}))||null}),[te,re]),Se=(0,l.useState)(!1),je=m()(Se,2),Ce=je[0],Te=je[1],Ze=(0,l.useState)(!1),Pe=m()(Ze,2),Ue=Pe[0],Ee=Pe[1],Fe=(0,l.useState)(!1),Ie=m()(Fe,2),Ke=Ie[0],qe=Ie[1],Re=(0,l.useRef)(""),Le=(0,z.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),Ae=Le.setCurrentRobotSettings,De=Le.currentRobotSettings,We=(0,l.useMemo)((function(){var e;return null!==(e=null!=De?De:we)&&void 0!==e?e:null}),[De,we]),Ne=(0,l.useCallback)((function(e){if(De){var t=De.draftServiceSettings||De.serviceSettings||{};Ae(f()(f()({},De),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[De,Ae]),Oe=(0,l.useCallback)((function(e){if(De){var t=De.draftInviteSettings||De.inviteSettings||{};Ae(f()(f()({},De),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[De,Ae]),ze=(0,l.useMemo)((function(){if(!de)return te;var e=de.toLowerCase();return te.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),l=(t.description||"").toLowerCase();return n.includes(e)||l.includes(e)}))}),[te,de]),Qe=(0,l.useCallback)(function(){var e=c()(d()().mark((function e(n,l){var a,r,i,o,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,r=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=8,(0,D.VW)(i);case 8:o=e.sent,_.Z.debug("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",o,i),s=(null==o||null===(a=o.data)||void 0===a?void 0:a.content)||[],ne(s),!(s.length>0)||re&&s.some((function(e){return e.uid===re}))||(ie(s[0].uid),null!=l&&l.keepActive||ve($));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,re]),Be=(0,l.useCallback)((function(e){Qe(null!=e?e:de)}),[Qe,de]);(0,l.useEffect)((function(){Qe(de)}),[null==t?void 0:t.uid]),(0,l.useEffect)((function(){we?(Ae(we),Re.current=JSON.stringify(null!=we?we:{}),qe(!1)):(Ae(null),Re.current=JSON.stringify({}),qe(!1))}),[null==we?void 0:we.uid]),(0,l.useEffect)((function(){if(we)try{var e,t,n=JSON.stringify(null!=De?De:{}),l=n!==Re.current;_.Z.debug("ğŸ” [Dirty Check]",{isDirty:l,selectedUid:null==we?void 0:we.uid,currentWelcomeTip:(null==De||null===(e=De.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==De||null===(t=De.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:Re.current.length,nowLength:n.length}),qe(l)}catch(e){qe(!0)}}),[De,null==we?void 0:we.uid]);var Ve=function(){var n=c()(d()().mark((function n(l){var a,r,i;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=l?l:we)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return r={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,D.r$)(r);case 6:(i=n.sent)&&200===i.code?(A.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),Qe(de)):A.yw.error((null==i?void 0:i.message)||"åˆ é™¤å¤±è´¥");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Ge=function(){var n=c()(d()().mark((function n(l,a){var r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,D.sK)({uid:l,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(r=n.sent)&&200===r.code?(A.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),Qe(de)):A.yw.error((null==r?void 0:r.message)||"æ“ä½œå¤±è´¥"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",n.t0),A.yw.error("æ“ä½œå¤±è´¥");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),He=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},Je=function(e){if(e){var t=He(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,l){if(void 0===t[n]){var a=null==e?void 0:e[l];if(Array.isArray(a)){var r=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);r.length>0&&(t[n]=r)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickFaqUids","quickFaqs"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var l=function(e){if(e)return He(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),l?{toolbar:l}:{})}},_e=function(e){if(e)return He(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ye=function(e){if(e)return He(e,["name","description","color","order"])},$e=function(e){if(e)return He(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Xe=function(){var n=c()(d()().mark((function n(){var l,a,r,i,o,s;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=we&&we.uid){n.next=3;break}return A.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:return Te(!0),n.prev=4,l=De&&De.uid===we.uid?De:we,a=function(e,t){return f()(f()({},e||{}),t||{})},r={uid:we.uid,orgUid:null==t?void 0:t.uid,name:null==l?void 0:l.name,description:null==l?void 0:l.description,isDefault:null==l?void 0:l.isDefault,enabled:null==l?void 0:l.enabled,serviceSettings:Je(a(null==l?void 0:l.serviceSettings,null==l?void 0:l.draftServiceSettings)),inviteSettings:_e(a(null==l?void 0:l.inviteSettings,null==l?void 0:l.draftInviteSettings)),intentionSettings:Ye(a(null==l?void 0:l.intentionSettings,null==l?void 0:l.draftIntentionSettings)),rateDownSettings:$e(a(null==l?void 0:l.rateDownSettings,null==l?void 0:l.draftRateDownSettings))},n.next=10,(0,D.sK)(r);case 10:i=n.sent,_.Z.debug("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",i,r),i&&200===i.code?(A.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),Re.current=JSON.stringify(null!==(o=null!==(s=null==i?void 0:i.data)&&void 0!==s?s:l)&&void 0!==o?o:{}),qe(!1),Qe(de)):A.yw.error((null==i?void 0:i.message)||"ä¿å­˜å¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("ä¿å­˜å¤±è´¥:",n.t0),A.yw.error("ä¿å­˜å¤±è´¥");case 19:return n.prev=19,Te(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),et=function(){var n=c()(d()().mark((function n(){var l,a,r;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=we&&we.uid){n.next=3;break}return A.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),n.abrupt("return");case 3:if(Ee(!0),n.prev=4,!Ke){n.next=8;break}return n.next=8,Xe();case 8:return l={uid:we.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,D.KF)(l);case 11:(a=n.sent)&&200===a.code?(A.yw.success(e.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),Re.current=JSON.stringify(null!==(r=null==a?void 0:a.data)&&void 0!==r?r:{}),qe(!1),Qe(de,{keepActive:!0})):A.yw.error((null==a?void 0:a.message)||"å‘å¸ƒå¤±è´¥"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("å‘å¸ƒå¤±è´¥:",n.t0),A.yw.error("å‘å¸ƒå¤±è´¥");case 19:return n.prev=19,Ee(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),tt=(0,l.useMemo)((function(){return null!=we&&we.uid?[{key:"welcome",label:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(j.Z,{})," ",(0,Y.jsx)(r.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"})]}),children:(0,Y.jsx)(G.Z,{serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"tips",label:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(C.Z,{})," ",(0,Y.jsx)(r.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"})]}),children:(0,Y.jsx)(V.Z,{variant:"robot",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"service",label:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(T.Z,{})," ",(0,Y.jsx)(r.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"})]}),children:(0,Y.jsx)(B.Z,{variant:"robot",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"rate",label:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(Z.Z,{})," ",(0,Y.jsx)(r.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,Y.jsx)(J.Z,{variant:"robot",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:Ne})}].concat(o()([]),[{key:"right",label:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(P.Z,{})," ",(0,Y.jsx)(r.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,Y.jsx)(Q.Z,{variant:"robot",serviceSettings:{live:null==We?void 0:We.serviceSettings,draft:null==We?void 0:We.draftServiceSettings},onServiceSettingsChange:Ne,settingsUid:we.uid,isActive:"right"===fe})}],o()([]),o()([])):[]}),[null==we?void 0:we.uid,We,Ne,Oe,e,fe]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(g.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,Y.jsx)(g.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,Y.jsxs)(L.Z,{title:e.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:(0,Y.jsx)(h.ZP,{size:"small",icon:(0,Y.jsx)(U.Z,{}),type:"primary",onClick:function(){ke(null),be(!0)},children:(0,Y.jsx)(r.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}),bodyStyle:{padding:8},loading:p,children:[(0,Y.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,Y.jsxs)(b.Z.Compact,{style:{width:"100%"},children:[(0,Y.jsx)(x.Z,{placeholder:e.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:de,onChange:function(e){return ue(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;ue(t),Be(t)},allowClear:!0,size:"middle"}),(0,Y.jsx)(h.ZP,{type:"primary",icon:(0,Y.jsx)(E.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"æœç´¢"}),onClick:function(){return Be()}})]})}),(0,Y.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,Y.jsx)(M.Z,{dataSource:ze,locale:{emptyText:(0,Y.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,Y.jsx)(M.Z.Item,{style:re===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ie(e.uid)},children:(0,Y.jsx)(M.Z.Item.Meta,{title:(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Y.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,Y.jsx)(b.Z,{size:4,children:e.isDefault?(0,Y.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null})]}),description:e.description?(0,Y.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,Y.jsx)(g.Z.Panel,{children:we?(0,Y.jsx)(L.Z,{title:(0,Y.jsxs)(b.Z,{children:[(0,Y.jsxs)("span",{children:[e.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",we.name||we.uid]}),(0,Y.jsx)(w.Z,{checked:!!we.enabled,onChange:function(e){return Ge(we.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),(0,Y.jsx)(h.ZP,{size:"small",icon:(0,Y.jsx)(F.Z,{}),onClick:function(e){var t;e.stopPropagation(),ke(null!=(t=we)?t:we),be(!0)},children:"ç¼–è¾‘"}),(0,Y.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ve(we)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,Y.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,Y.jsx)(I.Z,{}),onClick:function(e){e.stopPropagation()},children:"åˆ é™¤"})}),we.isDefault?(0,Y.jsx)(k.Z,{color:"blue",children:"é»˜è®¤"}):null]}),extra:(0,Y.jsxs)(b.Z,{children:[(0,Y.jsx)(S.Z,{title:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ",description:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ",okText:"ç»§ç»­å‘å¸ƒ",cancelText:"å–æ¶ˆ",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),et()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,Y.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ue,type:"default",icon:(0,Y.jsx)(K.Z,{}),children:(0,Y.jsx)(r.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,Y.jsx)(h.ZP,{onClick:function(){we&&(Ae(we),Re.current=JSON.stringify(null!=we?we:{}),qe(!1))},disabled:!Ke,icon:(0,Y.jsx)(q.Z,{}),children:(0,Y.jsx)(r.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,Y.jsx)(h.ZP,{type:"primary",loading:Ce,onClick:Xe,disabled:!Ke,icon:(0,Y.jsx)(R.Z,{}),children:(0,Y.jsx)(r.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,Y.jsx)(a.Z,{activeKey:fe,onChange:ve,items:tt})}):(0,Y.jsx)(L.Z,{children:(0,Y.jsx)(y.Z,{description:e.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,Y.jsx)(H.Z,{open:he,onOpenChange:be,orgUid:(null==t?void 0:t.uid)||"",record:ye,onSuccess:function(){be(!1),Qe(de)}})]})},ee=n(10154),te=n.n(ee),ne=n(86307),le=n(65100),ae=n(35912),re=n(77611),ie=n(67559),oe=n(6844),se=n(27625),de=n(86684),ue=n(13847),ce=n(30064),pe=n(93312),fe=n(68263),ve=n(94433),me=n(38956),ge=n(35865),he=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],be=l.forwardRef((function(e,t){var n=e.fieldProps,l=e.proFieldProps,a=e.min,r=e.max,i=e.step,o=e.marks,s=e.vertical,d=e.range,u=(0,me.Z)(e,he);return(0,Y.jsx)(ge.Z,(0,ve.Z)({valueType:"slider",fieldProps:(0,ve.Z)((0,ve.Z)({},n),{},{min:a,max:r,step:i,marks:o,vertical:s,range:d,style:null==n?void 0:n.style}),ref:t,proFieldProps:l,filedConfig:{ignoreWidth:!0}},u))})),xe=n(5089),Me=n(29589),ye=n(58867),ke=n(51891),we=n(53229),Se=n(59908),je=n(54605),Ce=n(47129),Te=xe.Z.Text,Ze=function(e){var t=e.value,n=e.onChange,l=e.options,a=e.loading,r=e.placeholder,i=e.emptyContent,o=e.onSearch,s=e.onDropdownOpen,d=e.onCreate,u=e.createLabel,c=e.createTitle;return(0,Y.jsxs)(b.Z.Compact,{block:!0,children:[(0,Y.jsx)(Me.Z,{value:t,onChange:function(e){return null==n?void 0:n(e)},options:l,showSearch:!0,filterOption:!1,placeholder:r,loading:a,allowClear:!0,style:{flex:1},notFoundContent:i,onSearch:o,onOpenChange:function(e){e&&s()}}),(0,Y.jsx)(h.ZP,{size:"small",icon:(0,Y.jsx)(U.Z,{}),onClick:d,title:c,children:u})]})},Pe=function(e){var t,n,a,i,o,s,u,p,v,g,b,x,M,y,k,w,S,j,C,T,Z,P,E,F,I,K,q=e.open,R=e.record,L=e.onClose,N=e.onSuccess,O=(0,r.useIntl)(),z=(0,W.u)((function(e){return e.currentOrg})),Q=(0,l.useMemo)((function(){return!(null==R||!R.uid)}),[R]),B=(0,l.useState)(!1),V=m()(B,2),G=V[0],J=V[1],_=(0,l.useState)([]),$=m()(_,2),X=$[0],ee=$[1],ne=(0,l.useState)(!1),ve=m()(ne,2),me=ve[0],ge=ve[1],he=(0,l.useRef)(),xe=(0,l.useState)((null==R?void 0:R.avatar)||""),Me=m()(xe,2),Pe=Me[0],Ue=Me[1],Ee=(0,l.useState)((null==R?void 0:R.type)||oe.f4h),Fe=m()(Ee,2),Ie=Fe[0],Ke=Fe[1],qe=(0,l.useState)((null==R?void 0:R.system)||!1),Re=m()(qe,2),Le=Re[0],Ae=Re[1],De=(0,l.useState)([]),We=m()(De,2),Ne=We[0],Oe=We[1],ze=(0,l.useState)({}),Qe=m()(ze,2),Be=Qe[0],Ve=Qe[1],Ge=(0,l.useState)(!1),He=m()(Ge,2),Je=He[0],_e=He[1],Ye=(0,l.useState)(""),$e=m()(Ye,2),Xe=$e[0],et=$e[1],tt=(0,l.useState)(""),nt=m()(tt,2),lt=nt[0],at=nt[1],rt=(0,l.useState)(""),it=m()(rt,2),ot=it[0],st=it[1],dt=(0,l.useState)(""),ut=m()(dt,2),ct=ut[0],pt=ut[1],ft=(0,l.useState)(!(null==R||null===(t=R.llm)||void 0===t||!t.enabled)),vt=m()(ft,2),mt=vt[0],gt=vt[1],ht=(0,l.useState)(!(null==R||!R.kbEnabled)),bt=m()(ht,2),xt=bt[0],Mt=bt[1],yt=(0,l.useState)(!(null==R||null===(n=R.llm)||void 0===n||!n.useLlmWhenKbEmpty)),kt=m()(yt,2),wt=kt[0],St=kt[1],jt=(0,l.useState)(!1),Ct=m()(jt,2),Tt=Ct[0],Zt=Ct[1],Pt=(0,l.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),Ut=(0,l.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(t):"-"}),[]),Et=(0,l.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),Ft=(0,l.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),It=(0,l.useState)(null==R||null===(a=R.llm)||void 0===a?void 0:a.temperature),Kt=m()(It,2),qt=Kt[0],Rt=Kt[1],Lt=(0,l.useState)(Pt(null==R||null===(i=R.llm)||void 0===i?void 0:i.topP)),At=m()(Lt,2),Dt=At[0],Wt=At[1],Nt=(0,l.useState)(null==R||null===(o=R.llm)||void 0===o?void 0:o.topK),Ot=m()(Nt,2),zt=Ot[0],Qt=Ot[1],Bt=(0,l.useState)(Pt(null==R||null===(s=R.llm)||void 0===s?void 0:s.scoreThreshold)),Vt=m()(Bt,2),Gt=Vt[0],Ht=Vt[1],Jt=(0,l.useState)(null==R||null===(u=R.llm)||void 0===u?void 0:u.maxTokens),_t=m()(Jt,2),Yt=(_t[0],_t[1]),$t=(0,l.useState)(null==R||null===(p=R.llm)||void 0===p?void 0:p.contextMsgCount),Xt=m()($t,2),en=(Xt[0],Xt[1]),tn=(0,l.useCallback)(function(){var e=c()(d()().mark((function e(t){var n,l,a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge(!0),e.prev=1,null!=z&&z.uid){e.next=5;break}return ee([]),e.abrupt("return",[]);case 5:return l={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==z?void 0:z.uid,searchText:t||""},e.next=8,(0,D.VW)(l);case 8:return a=e.sent,r=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],ee(r),e.abrupt("return",r);case 12:return e.prev=12,ge(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(t){return e.apply(this,arguments)}}(),[null==z?void 0:z.uid]);(0,l.useEffect)((function(){var e,t,n,l,a,r,i,o,s,d,u,c,p,f,v,m,g,h,b,x,M,y,k,w,S,j,C,T;if(q){var Z,P,U;if(Ue((null==R?void 0:R.avatar)||""),Ke((null==R?void 0:R.type)||oe.f4h),Ae((null==R?void 0:R.system)||!1),gt(!(null==R||null===(e=R.llm)||void 0===e||!e.enabled)),Mt(!(null==R||!R.kbEnabled)),St(!(null==R||null===(t=R.llm)||void 0===t||!t.useLlmWhenKbEmpty)),null===(n=he.current)||void 0===n||n.setFieldsValue({nickname:null==R?void 0:R.nickname,type:null==R?void 0:R.type,settingsUid:null==R||null===(l=R.settings)||void 0===l?void 0:l.uid,name:null==R?void 0:R.name,categoryUid:null==R?void 0:R.categoryUid,provider:null==R||null===(a=R.llm)||void 0===a?void 0:a.textProvider,model:null==R||null===(r=R.llm)||void 0===r?void 0:r.textModel,prompt:null==R||null===(i=R.llm)||void 0===i?void 0:i.prompt,description:null==R?void 0:R.description,enabled:null==R||null===(o=R.llm)||void 0===o?void 0:o.enabled,enableThinking:null==R||null===(s=R.llm)||void 0===s?void 0:s.enableThinking,enableStreaming:null==R||null===(d=R.llm)||void 0===d?void 0:d.enableStreaming,useLlmWhenKbEmpty:null==R||null===(u=R.llm)||void 0===u?void 0:u.useLlmWhenKbEmpty,temperature:Ft(null==R||null===(c=R.llm)||void 0===c?void 0:c.temperature),topP:Pt(null==R||null===(p=R.llm)||void 0===p?void 0:p.topP),topK:null==R||null===(f=R.llm)||void 0===f?void 0:f.topK,scoreThreshold:Pt(null==R||null===(v=R.llm)||void 0===v?void 0:v.scoreThreshold),maxTokens:null==R||null===(m=R.llm)||void 0===m?void 0:m.maxTokens,contextMsgCount:null==R||null===(g=R.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==R||null===(h=R.llm)||void 0===h?void 0:h.defaultReply,searchType:(null==R||null===(b=R.llm)||void 0===b?void 0:b.searchType)||oe.rk3,kbSourceEnabled:null==R?void 0:R.kbSourceEnabled,kbEnabled:null==R?void 0:R.kbEnabled,kbUid:null==R?void 0:R.kbUid}),null!=R&&R.llm&&(null!=R&&null!==(x=R.llm)&&void 0!==x&&x.textProviderUid||null!=R&&null!==(M=R.llm)&&void 0!==M&&M.textProvider||null!=R&&null!==(y=R.llm)&&void 0!==y&&y.textModel))et((null==R||null===(Z=R.llm)||void 0===Z?void 0:Z.textProvider)||""),at((null==R||null===(P=R.llm)||void 0===P?void 0:P.textProviderUid)||""),st((null==R||null===(U=R.llm)||void 0===U?void 0:U.textModel)||"");else et(""),at(""),st("");Rt(Ft(null==R||null===(k=R.llm)||void 0===k?void 0:k.temperature)),Wt(Pt(null==R||null===(w=R.llm)||void 0===w?void 0:w.topP)),Qt(null==R||null===(S=R.llm)||void 0===S?void 0:S.topK),Ht(Pt(null==R||null===(j=R.llm)||void 0===j?void 0:j.scoreThreshold)),Yt(null==R||null===(C=R.llm)||void 0===C?void 0:C.maxTokens),en(null==R||null===(T=R.llm)||void 0===T?void 0:T.contextMsgCount),Zt(!1)}}),[q,R]);var nn=function(){var e=c()(d()().mark((function e(t){var n,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue(t),!Q||!R){e.next=13;break}return e.prev=2,n={uid:null==R?void 0:R.uid,avatar:t},e.next=6,(0,ae.lz)(n);case 6:200===(null==(l=e.sent)?void 0:l.code)?(A.yw.success(O.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),null==N||N(l.data)):A.yw.error((null==l?void 0:l.message)||O.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),A.yw.error(O.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){q&&Ie===oe.f4h&&tn()}),[q,Ie,tn]);var ln=(0,l.useMemo)((function(){return X.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (é»˜è®¤)":"").concat(e.enabled?"":" (å·²åœç”¨)"),value:e.uid}}))}),[X]),an=(0,l.useRef)(),rn=(0,l.useCallback)((function(e){an.current&&clearTimeout(an.current),an.current=setTimeout((function(){tn(e)}),300)}),[tn]);(0,l.useEffect)((function(){return function(){an.current&&clearTimeout(an.current)}}),[]);var on=(0,l.useCallback)((function(){X.length||tn()}),[X.length,tn]),sn=(0,l.useCallback)(c()(d()().mark((function e(){var t,n,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==z?void 0:z.uid,level:oe.whQ},e.next=4,(0,re.mK)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)&&(a=(null==n||null===(l=n.data)||void 0===l?void 0:l.content)||[],Oe(a),lt&&!Xe&&(r=a.find((function(e){return e.uid===lt})))&&et(r.type),!lt&&Xe&&(i=a.find((function(e){return e.type===Xe})))&&at(i.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==z?void 0:z.uid,lt,Xe]);(0,l.useEffect)((function(){q&&sn()}),[q,sn]);var dn=(0,l.useCallback)((function(){return _e(!0)}),[]),un=(0,l.useCallback)((function(){return _e(!1)}),[]),cn=(0,l.useCallback)((function(e,t){Ve((function(n){return f()(f()({},n),{},te()({},e,t))}))}),[]),pn=(0,l.useCallback)((function(e,t,n){var l,a,r,i=Ne.find((function(t){return t.uid===e})),o=i?i.type:e;et(o),at(e),st(t),pt(n),null===(l=he.current)||void 0===l||l.setFieldsValue({provider:o,model:t});var s=null===(a=he.current)||void 0===a||null===(r=a.getFieldsValue)||void 0===r?void 0:r.call(a);if(s){var d,u,c,p,f,v,m,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U,E,F=(null==R?void 0:R.llm)||{},I=(null!==(d=s.prompt)&&void 0!==d?d:"")!==(null!==(u=F.prompt)&&void 0!==u?u:"")||(e||"")!==(null!==(c=F.textProviderUid)&&void 0!==c?c:"")||(o||s.provider||"")!==(null!==(p=F.textProvider)&&void 0!==p?p:"")||(t||s.model||"")!==(null!==(f=F.textModel)&&void 0!==f?f:"")||!!s.enabled!=!!F.enabled||!!s.enableThinking!=!!F.enableThinking||!!s.enableStreaming!=!!F.enableStreaming||!!s.useLlmWhenKbEmpty!=!!F.useLlmWhenKbEmpty||(null!==(v=s.temperature)&&void 0!==v?v:null)!==(null!==(m=F.temperature)&&void 0!==m?m:null)||(null!==(g=s.topP)&&void 0!==g?g:null)!==(null!==(h=F.topP)&&void 0!==h?h:null)||(null!==(b=s.topK)&&void 0!==b?b:null)!==(null!==(x=F.topK)&&void 0!==x?x:null)||(null!==(M=s.scoreThreshold)&&void 0!==M?M:null)!==(null!==(y=F.scoreThreshold)&&void 0!==y?y:null)||(null!==(k=s.maxTokens)&&void 0!==k?k:null)!==(null!==(w=F.maxTokens)&&void 0!==w?w:null)||(null!==(S=s.contextMsgCount)&&void 0!==S?S:null)!==(null!==(j=F.contextMsgCount)&&void 0!==j?j:null)||(null!==(C=s.defaultReply)&&void 0!==C?C:"")!==(null!==(T=F.defaultReply)&&void 0!==T?T:"")||(null!==(Z=s.searchType)&&void 0!==Z?Z:"")!==(null!==(P=F.searchType)&&void 0!==P?P:""),K=!!s.kbEnabled!=!(null==R||!R.kbEnabled)||!!s.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(U=s.kbUid)&&void 0!==U?U:"")!==(null!==(E=null==R?void 0:R.kbUid)&&void 0!==E?E:"");Zt(I||K)}_e(!1)}),[Ne]);return(0,Y.jsxs)(se.a,{onValuesChange:function(e,t){var n,l,a,r,i,o,s,d,u,c,p,f,v,m,g,h,b,x,M,y,k,w,S,j=(null==R?void 0:R.llm)||{},C=(null!==(n=t.prompt)&&void 0!==n?n:"")!==(null!==(l=j.prompt)&&void 0!==l?l:"")||(lt||"")!==(null!==(a=j.textProviderUid)&&void 0!==a?a:"")||(Xe||t.provider||"")!==(null!==(r=j.textProvider)&&void 0!==r?r:"")||(ot||t.model||"")!==(null!==(i=j.textModel)&&void 0!==i?i:"")||!!t.enabled!=!!j.enabled||!!t.enableThinking!=!!j.enableThinking||!!t.enableStreaming!=!!j.enableStreaming||!!t.useLlmWhenKbEmpty!=!!j.useLlmWhenKbEmpty||(null!==(o=t.temperature)&&void 0!==o?o:null)!==(null!==(s=j.temperature)&&void 0!==s?s:null)||(null!==(d=t.topP)&&void 0!==d?d:null)!==(null!==(u=j.topP)&&void 0!==u?u:null)||(null!==(c=t.topK)&&void 0!==c?c:null)!==(null!==(p=j.topK)&&void 0!==p?p:null)||(null!==(f=t.scoreThreshold)&&void 0!==f?f:null)!==(null!==(v=j.scoreThreshold)&&void 0!==v?v:null)||(null!==(m=t.maxTokens)&&void 0!==m?m:null)!==(null!==(g=j.maxTokens)&&void 0!==g?g:null)||(null!==(h=t.contextMsgCount)&&void 0!==h?h:null)!==(null!==(b=j.contextMsgCount)&&void 0!==b?b:null)||(null!==(x=t.defaultReply)&&void 0!==x?x:"")!==(null!==(M=j.defaultReply)&&void 0!==M?M:"")||(null!==(y=t.searchType)&&void 0!==y?y:"")!==(null!==(k=j.searchType)&&void 0!==k?k:""),T=!!t.kbEnabled!=!(null==R||!R.kbEnabled)||!!t.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(w=t.kbUid)&&void 0!==w?w:"")!==(null!==(S=null==R?void 0:R.kbUid)&&void 0!==S?S:"");Zt(C||T)},open:q,onOpenChange:function(e){e||L()},title:O.formatMessage({id:"robot.edit",defaultMessage:"ç¼–è¾‘æœºå™¨äºº"}),width:560,formRef:he,initialValues:Q?{nickname:null==R?void 0:R.nickname,type:null==R?void 0:R.type,settingsUid:null==R||null===(v=R.settings)||void 0===v?void 0:v.uid,name:null==R?void 0:R.name,categoryUid:null==R?void 0:R.categoryUid,provider:null==R||null===(g=R.llm)||void 0===g?void 0:g.textProvider,model:null==R||null===(b=R.llm)||void 0===b?void 0:b.textModel,prompt:null==R||null===(x=R.llm)||void 0===x?void 0:x.prompt,description:null==R?void 0:R.description,enabled:null==R||null===(M=R.llm)||void 0===M?void 0:M.enabled,enableThinking:null==R||null===(y=R.llm)||void 0===y?void 0:y.enableThinking,enableStreaming:null==R||null===(k=R.llm)||void 0===k?void 0:k.enableStreaming,useLlmWhenKbEmpty:null==R||null===(w=R.llm)||void 0===w?void 0:w.useLlmWhenKbEmpty,temperature:Ft(null==R||null===(S=R.llm)||void 0===S?void 0:S.temperature),topP:Pt(null==R||null===(j=R.llm)||void 0===j?void 0:j.topP),topK:null==R||null===(C=R.llm)||void 0===C?void 0:C.topK,scoreThreshold:Pt(null==R||null===(T=R.llm)||void 0===T?void 0:T.scoreThreshold),maxTokens:null==R||null===(Z=R.llm)||void 0===Z?void 0:Z.maxTokens,contextMsgCount:null==R||null===(P=R.llm)||void 0===P?void 0:P.contextMsgCount,defaultReply:null==R||null===(E=R.llm)||void 0===E?void 0:E.defaultReply,searchType:(null==R||null===(F=R.llm)||void 0===F?void 0:F.searchType)||oe.rk3,kbSourceEnabled:null==R?void 0:R.kbSourceEnabled,kbEnabled:null==R?void 0:R.kbEnabled,kbUid:null==R?void 0:R.kbUid}:{type:oe.f4h,searchType:oe.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.ZP,{style:{marginRight:8},onClick:function(){return L()},children:O.formatMessage({id:"cancel",defaultMessage:"å–æ¶ˆ"})}),(0,Y.jsx)(h.ZP,{type:"primary",onClick:function(){var e,t;return null===(e=he.current)||void 0===e||null===(t=e.submit)||void 0===t?void 0:t.call(e)},children:O.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=c()(d()().mark((function e(t){var n,l,a,r,i,o,s,u,c,p,f,v,m,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U,E,F,I,K;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Q&&null!=R&&R.uid){e.next=4;break}return A.yw.warning(O.formatMessage({id:"robot.edit.only",defaultMessage:"å½“å‰ä»…æ”¯æŒç¼–è¾‘ï¼Œè¯·é€šè¿‡æ–°å»ºå…¥å£åˆ›å»ºæœºå™¨äºº"})),e.abrupt("return",!1);case 4:return T=(null==R?void 0:R.llm)||{},Z=(null!==(n=t.prompt)&&void 0!==n?n:"")!==(null!==(l=T.prompt)&&void 0!==l?l:"")||(lt||"")!==(null!==(a=T.textProviderUid)&&void 0!==a?a:"")||(Xe||t.provider||"")!==(null!==(r=T.textProvider)&&void 0!==r?r:"")||(ot||t.model||"")!==(null!==(i=T.textModel)&&void 0!==i?i:"")||!!t.enabled!=!!T.enabled||!!t.enableThinking!=!!T.enableThinking||!!t.enableStreaming!=!!T.enableStreaming||!!t.useLlmWhenKbEmpty!=!!T.useLlmWhenKbEmpty||(null!==(o=t.temperature)&&void 0!==o?o:null)!==(null!==(s=T.temperature)&&void 0!==s?s:null)||(null!==(u=t.topP)&&void 0!==u?u:null)!==(null!==(c=T.topP)&&void 0!==c?c:null)||(null!==(p=t.topK)&&void 0!==p?p:null)!==(null!==(f=T.topK)&&void 0!==f?f:null)||(null!==(v=t.scoreThreshold)&&void 0!==v?v:null)!==(null!==(m=T.scoreThreshold)&&void 0!==m?m:null)||(null!==(g=t.maxTokens)&&void 0!==g?g:null)!==(null!==(h=T.maxTokens)&&void 0!==h?h:null)||(null!==(b=t.contextMsgCount)&&void 0!==b?b:null)!==(null!==(x=T.contextMsgCount)&&void 0!==x?x:null)||(null!==(M=t.defaultReply)&&void 0!==M?M:"")!==(null!==(y=T.defaultReply)&&void 0!==y?y:"")||(null!==(k=t.searchType)&&void 0!==k?k:"")!==(null!==(w=T.searchType)&&void 0!==w?w:""),P=!!t.kbEnabled!=!(null==R||!R.kbEnabled)||!!t.kbSourceEnabled!=!(null==R||!R.kbSourceEnabled)||(null!==(S=t.kbUid)&&void 0!==S?S:"")!==(null!==(j=null==R?void 0:R.kbUid)&&void 0!==j?j:""),U=Z||P,A.yw.loading(O.formatMessage({id:Q?"updating":"creating",defaultMessage:Q?"Updating":"Creating"})),F={uid:null==R?void 0:R.uid,nickname:t.nickname,name:t.name,type:t.type||oe.f4h,description:t.description,avatar:Pe,settingsUid:t.settingsUid,kbSourceEnabled:t.kbSourceEnabled,kbEnabled:t.kbEnabled,kbUid:t.kbUid,llm:{prompt:t.prompt,textProvider:Xe||t.provider,textProviderUid:lt||void 0,textModel:ot||t.model,enabled:t.enabled,enableThinking:t.enableThinking,enableStreaming:t.enableStreaming,useLlmWhenKbEmpty:t.useLlmWhenKbEmpty,temperature:Ft(t.temperature),topP:Pt(t.topP),topK:t.topK,scoreThreshold:Pt(t.scoreThreshold),maxTokens:t.maxTokens,contextMsgCount:t.contextMsgCount,defaultReply:t.defaultReply,searchType:t.searchType}},e.next=12,(0,ae.$l)(F);case 12:if(E=e.sent,console.log("updateRobot:",E,F),A.yw.destroy(),200!==(null===(C=E)||void 0===C?void 0:C.code)){e.next=23;break}return A.yw.success(O.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),U&&A.yw.info(O.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/çŸ¥è¯†åº“ç›¸å…³é…ç½®å·²æ›´æ–°ï¼Œåˆ·æ–°æˆ–é‡æ–°è¿›å…¥æœºå™¨äººä¼šè¯åç”Ÿæ•ˆ"}),5),null==N||N(null===(I=E)||void 0===I?void 0:I.data),L(),e.abrupt("return",!0);case 23:return A.yw.error((null===(K=E)||void 0===K?void 0:K.message)||O.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),A.yw.destroy(),A.yw.error(O.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,Y.jsx)(ye.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:O.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"å¤´åƒ"}),children:(0,Y.jsxs)(je.G,{onSuccess:nn,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,Y.jsx)(le.Z,{src:Pe}),(0,Y.jsx)(h.ZP,{icon:(0,Y.jsx)(Se.Z,{}),style:{marginLeft:12},children:O.formatMessage({id:"pages.robot.upload",defaultMessage:"ä¸Šä¼ "})})]},"avatar")}),Ie===oe.Qeb&&Le&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(de.Z,{name:"name",hidden:!0,label:O.formatMessage({id:"name",defaultMessage:"åç§°"}),fieldProps:{placeholder:Le&&Ie===oe.Qeb?O.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.placeholder",defaultMessage:"ç³»ç»Ÿä»£ç†ä¸å¯ä¿®æ”¹åç§°"}):void 0},disabled:Le&&Ie===oe.Qeb}),(0,Y.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:-20,marginBottom:10},children:O.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.tip",defaultMessage:"ç³»ç»Ÿå†…ç½®ä»£ç†ï¼Œæ— æ³•ä¿®æ”¹åç§°"})})]}),(0,Y.jsx)(de.Z,{name:"nickname",label:O.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"}),rules:[{required:!0,message:O.formatMessage({id:"nickname",defaultMessage:"æ˜µç§°"})}]}),(0,Y.jsx)(ue.Z,{name:"description",label:O.formatMessage({id:"description",defaultMessage:"æè¿°"})}),Ie===oe.f4h&&(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(ce.A.Item,{name:"settingsUid",label:O.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),rules:[{required:!0,message:O.formatMessage({id:"robot.settings.required",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"})}],children:(0,Y.jsx)(Ze,{options:ln,loading:me,placeholder:O.formatMessage({id:"robot.settings.placeholder",defaultMessage:"è¯·é€‰æ‹©æœºå™¨äººé…ç½®"}),emptyContent:0===ln.length?(0,Y.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,Y.jsx)("div",{style:{marginBottom:8,color:"#999"},children:O.formatMessage({id:"robot.settings.empty",defaultMessage:"æš‚æ— é…ç½®æ¨¡æ¿"})}),(0,Y.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,Y.jsx)(U.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return J(!0)},children:O.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"})})]}):void 0,onSearch:rn,onDropdownOpen:on,onCreate:function(){return J(!0)},createLabel:O.formatMessage({id:"common.new",defaultMessage:"æ–°å»º"}),createTitle:O.formatMessage({id:"robot.settings.create",defaultMessage:"åˆ›å»ºé…ç½®"})})})}),(0,Y.jsx)(pe.Z,{name:"enabled",label:O.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),fieldProps:{onChange:function(e){return gt(e)}}}),mt&&(0,Y.jsxs)(l.Fragment,{children:[(0,Y.jsxs)("div",{children:[(0,Y.jsx)(Te,{style:{marginBottom:8,display:"block"},children:O.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"æ–‡å­—å¯¹è¯æ¨¡å‹æä¾›å•†"})}),(0,Y.jsx)(ke.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:dn,children:(lt||Xe)&&ot?(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Y.jsxs)("div",{children:[(0,Y.jsx)(Te,{type:"secondary",children:O.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"ä¾›åº”å•†ï¼š"})}),(0,Y.jsx)(Te,{strong:!0,children:(null===(I=Ne.find((function(e){return e.uid===lt})))||void 0===I?void 0:I.nickname)||(null===(K=Ne.find((function(e){return e.type===Xe})))||void 0===K?void 0:K.nickname)||Xe}),(0,Y.jsx)("br",{}),(0,Y.jsx)(Te,{type:"secondary",children:O.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"æ¨¡å‹ï¼š"})}),(0,Y.jsx)(Te,{strong:!0,children:ct||ot})]}),(0,Y.jsx)(h.ZP,{type:"primary",children:O.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"æ›´æ¢æ¨¡å‹"})})]}):(0,Y.jsx)("div",{style:{textAlign:"center"},children:(0,Y.jsx)(h.ZP,{type:"primary",children:O.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"é€‰æ‹©AIæ¨¡å‹"})})})}),(0,Y.jsxs)("div",{style:{display:"none"},children:[(0,Y.jsx)(fe.Z,{name:"provider"}),(0,Y.jsx)(fe.Z,{name:"model"})]})]}),(0,Y.jsx)(be,{name:"temperature",label:(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)("span",{children:O.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"})}),(0,Y.jsx)("span",{style:{color:"#999"},children:": "+Ut(qt,2)})]}),tooltip:O.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§ï¼Œå€¼è¶Šé«˜è¾“å‡ºè¶Šéšæœºåˆ›æ–°"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Rt(Ft(e))}}}),(0,Y.jsx)(be,{name:"topP",label:(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)("span",{children:O.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,Y.jsx)("span",{style:{color:"#999"},children:": "+Ut(Dt,2)})]}),tooltip:O.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P é‡‡æ ·é˜ˆå€¼ï¼Œä¿ç•™ç´¯è®¡æ¦‚ç‡è¾¾åˆ°è¯¥å€¼çš„è¯ï¼ŒèŒƒå›´ 0-1ï¼Œå€¼è¶Šå°è¶Šä¿å®ˆ"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Wt(Ft(e))}}}),(0,Y.jsx)(be,{name:"topK",label:(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)("span",{children:O.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,Y.jsx)("span",{style:{color:"#999"},children:": "+Et(zt)})]}),tooltip:O.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"æ£€ç´¢æ—¶è¿”å›çš„ç›¸å…³æ–‡æ¡£æ•°é‡"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Qt(e)}}}),(0,Y.jsx)(be,{name:"scoreThreshold",label:(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)("span",{children:O.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"å¾—åˆ†é˜ˆå€¼"})}),(0,Y.jsx)("span",{style:{color:"#999"},children:": "+Ut(Gt,2)})]}),tooltip:O.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"çŸ¥è¯†åº“å¬å›å‘½ä¸­æ–‡æ¡£çš„æœ€ä½å¾—åˆ†é˜ˆå€¼ï¼Œä½äºæ­¤å€¼ä¸çº³å…¥å‚è€ƒ"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Ht(Ft(e))}}}),!1,(0,Y.jsx)(ue.Z,{name:"prompt",label:O.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})}),(0,Y.jsx)(pe.Z,{name:"useLlmWhenKbEmpty",label:O.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"çŸ¥è¯†åº“ç©ºç»“æœæ—¶ä½¿ç”¨å¤§æ¨¡å‹"}),tooltip:O.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"å¼€å¯åï¼Œå½“çŸ¥è¯†åº“æ²¡æœ‰å‘½ä¸­æ—¶å°†ç»§ç»­è°ƒç”¨å¤§æ¨¡å‹å›ç­”ï¼›å…³é—­åˆ™è¿”å›é»˜è®¤å›å¤"}),fieldProps:{onChange:function(e){return St(e)}}}),!wt&&(0,Y.jsx)(ue.Z,{name:"defaultReply",label:O.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"é»˜è®¤å›å¤"})})]}),(0,Y.jsxs)(l.Fragment,{children:[(0,Y.jsx)(pe.Z,{name:"kbEnabled",label:O.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"å¯ç”¨çŸ¥è¯†åº“"}),fieldProps:{onChange:function(e){return Mt(e)}}}),xt&&(0,Y.jsxs)(l.Fragment,{children:[(0,Y.jsx)(pe.Z,{name:"kbSourceEnabled",label:O.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),tooltip:O.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"å¼€å¯åå°†åœ¨å›å¤ä¸­æ˜¾ç¤ºçŸ¥è¯†åº“å‘½ä¸­æ¥æºï¼Œä¾¿äºè°ƒè¯•ä¸åŒæ£€ç´¢ç±»å‹çš„æœç´¢ç»“æœ"})}),(0,Y.jsx)(fe.Z,{name:"searchType",label:O.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),valueEnum:te()(te()(te()({},oe.ccx,{text:"å…¨æ–‡"}),oe.DGp,{text:"å‘é‡"}),oe.rk3,{text:"æ··åˆ"})}),(0,Y.jsx)(fe.Z,{name:"kbUid",label:O.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),placeholder:O.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"è¯·é€‰æ‹©çŸ¥è¯†åº“"}),showSearch:!0,debounceTime:300,request:function(){var e=c()(d()().mark((function e(t){var n,l,a,r,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:oe.QPQ,orgUid:null==z?void 0:z.uid,searchText:n||""},e.next=5,(0,ie.AP)(a);case 5:return r=e.sent,i=(null==r||null===(l=r.data)||void 0===l?void 0:l.content)||[],e.abrupt("return",i.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()})]})]}),Tt&&(0,Y.jsx)(we.Z,{type:"info",showIcon:!0,message:O.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/çŸ¥è¯†åº“ç›¸å…³é…ç½®å·²æ›´æ–°ï¼Œåˆ·æ–°æˆ–é‡æ–°è¿›å…¥æœºå™¨äººä¼šè¯åç”Ÿæ•ˆ"}),style:{marginBottom:12}}),(0,Y.jsx)(Ce.Z,{visible:Je,onCancel:un,onOk:pn,initialProvider:lt||Xe,initialModel:ot,initialModelLabel:ct,providers:Ne,currentOrgUid:null==z?void 0:z.uid,existingProviderModels:Be,onModelsLoaded:cn,allowedModelTypes:[oe.l55,oe.xZ8,"CHAT"]}),(0,Y.jsx)(H.Z,{open:G,onOpenChange:J,orgUid:(null==z?void 0:z.uid)||"",record:null,onSuccess:function(){J(!1),tn()}})]})},Ue=n(95702),Ee=n(46141),Fe=function(e){var t,n=e.open,a=e.record,i=e.value,o=e.onClose,s=e.onSaved,u=(0,r.useIntl)(),p=(0,l.useState)(i||(null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)||""),v=m()(p,2),g=v[0],b=v[1];(0,l.useEffect)((function(){var e,t;b(null!==(e=null!=i?i:null==a||null===(t=a.llm)||void 0===t?void 0:t.prompt)&&void 0!==e?e:"")}),[n,i,null==a?void 0:a.uid]);var x=function(){var e=c()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(g||"");case 3:A.yw.success(u.formatMessage({id:"copy.success",defaultMessage:"å¤åˆ¶æˆåŠŸ"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),A.yw.error(u.formatMessage({id:"copy.failed",defaultMessage:"å¤åˆ¶å¤±è´¥"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=c()(d()().mark((function e(){var t,n,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return null==o||o(),e.abrupt("return");case 3:return e.prev=3,A.yw.loading(u.formatMessage({id:"saving",defaultMessage:"Saving..."})),n={uid:(t=a).uid,prompt:g,llm:f()(f()({},t.llm||{}),{},{prompt:g})},e.next=9,(0,ae.M8)(n);case 9:l=e.sent,_.Z.debug("PromptEditModal handleSave updated robot prompt:",l,n),A.yw.destroy(),200===(null==l?void 0:l.code)?(A.yw.success(u.formatMessage({id:"save.success",defaultMessage:"ä¿å­˜æˆåŠŸ"})),null==s||s()):A.yw.error((null==l?void 0:l.message)||u.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),A.yw.destroy(),A.yw.error(u.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,Y.jsx)(Ee.Z,{open:n,title:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),onCancel:o,footer:[(0,Y.jsx)(h.ZP,{onClick:x,children:u.formatMessage({id:"copy",defaultMessage:"å¤åˆ¶"})},"copy"),(0,Y.jsx)(h.ZP,{type:"primary",onClick:M,children:u.formatMessage({id:"save",defaultMessage:"ä¿å­˜"})},"save"),(0,Y.jsx)(h.ZP,{onClick:o,children:u.formatMessage({id:"close",defaultMessage:"å…³é—­"})},"close")],children:(0,Y.jsx)("div",{children:(0,Y.jsx)("textarea",{value:g,onChange:function(e){return b(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"})})})})},Ie=function(e){var t=e.superUser,n=(0,r.useIntl)(),a=(0,l.useRef)(),i=(0,W.u)((function(e){return e.currentOrg})),o=(0,l.useState)(!1),s=m()(o,2),u=s[0],p=s[1],v=(0,l.useState)(!1),g=m()(v,2),b=g[0],x=g[1],M=(0,l.useState)(null),y=m()(M,2),w=y[0],j=y[1],C=(0,l.useState)(!1),T=m()(C,2),Z=T[0],P=T[1],U=(0,l.useState)(""),E=m()(U,2),F=E[0],I=E[1],K=(0,l.useState)(null),q=m()(K,2),R=q[0],L=q[1],D=(0,l.useState)({}),N=m()(D,2),O=N[0],z=N[1],Q=(0,l.useState)({}),B=m()(Q,2),V=B[0],G=B[1];l.useEffect((function(){var e=function(){var e=c()(d()().mark((function e(){var t,n,l,a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==i?void 0:i.uid,level:oe.whQ},e.next=4,(0,re.mK)(t);case 4:n=e.sent,_.Z.debug("RobotTable loadProviders response:",n,t),200===(null==n?void 0:n.code)&&(a=(null==n||null===(l=n.data)||void 0===l?void 0:l.content)||[],r={},a.forEach((function(e){var t=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(r[e.uid]=t)})),z(r)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=i&&i.uid?e():z({})}),[null==i?void 0:i.uid]),l.useEffect((function(){var e=function(){var e=c()(d()().mark((function e(){var t,n,l,a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:200,orgUid:null==i?void 0:i.uid,searchText:""},e.next=4,(0,ie.AP)(t);case 4:n=e.sent,_.Z.debug("RobotTable loadKbases response:",n,t),200===(null==n?void 0:n.code)&&(a=(null==n||null===(l=n.data)||void 0===l?void 0:l.content)||[],r={},a.forEach((function(e){null!=e&&e.uid&&(r[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),G(r)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=i&&i.uid?e():G({})}),[null==i?void 0:i.uid]);var H=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:n.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,Y.jsx)(le.Z,{src:null==t?void 0:t.avatar})}},{title:n.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(e,t){var l=null==t?void 0:t.type,a=l===oe.Qeb?"green":l===oe.f4h?"blue":"purple",r=l===oe.f4h?n.formatMessage({id:oe.f4h,defaultMessage:"Service"}):l===oe.Qeb?n.formatMessage({id:oe.Qeb,defaultMessage:"Chat"}):l===oe.wG_?n.formatMessage({id:oe.wG_,defaultMessage:"Marketing"}):n.formatMessage({id:l||"unknown",defaultMessage:l||"-"});return(0,Y.jsx)(k.Z,{color:a,children:r})},hideInSearch:!0},{title:n.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:te()(te()(te()({},oe.f4h,{text:n.formatMessage({id:oe.f4h,defaultMessage:"Service"})}),oe.Qeb,{text:n.formatMessage({id:oe.Qeb,defaultMessage:"Chat"})}),oe.wG_,{text:n.formatMessage({id:oe.wG_,defaultMessage:"Marketing"}),disabled:!0}),hideInTable:!0},{title:n.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:n.formatMessage({id:"robot.settings",defaultMessage:"æœºå™¨äººé…ç½®"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){if((null==t?void 0:t.type)===oe.Qeb){var l,a,r=!(null==t||null===(l=t.llm)||void 0===l||!l.textModel);return(0,Y.jsx)("a",{onClick:function(){j(t),p(!0)},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(a=t.llm)||void 0===a?void 0:a.textModel)||n.formatMessage({id:"robot.llm.configured",defaultMessage:"æ¨¡å‹å·²é…ç½®"}):n.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"æœªé…ç½®æ¨¡å‹ï¼Œç‚¹å‡»é…ç½®"})})}return null!=t&&t.settings?(0,Y.jsx)("a",{onClick:function(){j(t),p(!0)},children:t.settings.name||n.formatMessage({id:"robot.settings.configured",defaultMessage:"å·²é…ç½®"})}):(0,Y.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){j(t),p(!0)},children:n.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"æœªé…ç½®ï¼Œç‚¹å‡»é…ç½®"})})}},{title:n.formatMessage({id:"pages.prompt.prompt",defaultMessage:"æç¤ºè¯"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(e,t){var l,a=null==t||null===(l=t.llm)||void 0===l?void 0:l.prompt;return a?(0,Y.jsx)("a",{onClick:function(){I(a),L(t),P(!0)},children:n.formatMessage({id:"view",defaultMessage:"æŸ¥çœ‹"})}):"-"}},{title:n.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"æ–‡æœ¬æ¨¡å‹æä¾›å•†"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,t){var n,l,a=null==t||null===(n=t.llm)||void 0===n?void 0:n.textProviderUid;return a&&O[a]?O[a]:(null==t||null===(l=t.llm)||void 0===l?void 0:l.textProvider)||"-"}},{title:n.formatMessage({id:"pages.prompt.model",defaultMessage:"æ¨¡å‹"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,t){var n;return(null==t||null===(n=t.llm)||void 0===n?void 0:n.textModel)||"-"}},{title:n.formatMessage({id:"pages.prompt.enabled",defaultMessage:"å¯ç”¨å¤§æ¨¡å‹é—®ç­”"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,t){var n;return null!=t&&null!==(n=t.llm)&&void 0!==n&&n.enabled?"æ˜¯":"å¦"}},{title:n.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"çŸ¥è¯†åº“æœç´¢ç»“æœä¸ºç©ºæ—¶ç”¨LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,t){var n;return null!=t&&null!==(n=t.llm)&&void 0!==n&&n.useLlmWhenKbEmpty?"æ˜¯":"å¦"}},{title:n.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:n.formatMessage({id:"pages.prompt.temperature",defaultMessage:"æ¸©åº¦"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,t){var n,l,a;return 0===(null==t||null===(n=t.llm)||void 0===n?void 0:n.temperature)?"0":null!==(l=null==t||null===(a=t.llm)||void 0===a?void 0:a.temperature)&&void 0!==l?l:"-"}},{title:n.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,t){var n,l;return null!==(n=null==t||null===(l=t.llm)||void 0===l?void 0:l.topK)&&void 0!==n?n:"-"}},{title:n.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"çŸ¥è¯†åº“å¯ç”¨"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbEnabled?"æ˜¯":"å¦"}},{title:n.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"æ˜¾ç¤ºçŸ¥è¯†åº“æ¥æº"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,t){return null!=t&&t.kbSourceEnabled?"æ˜¯":"å¦"}},{title:n.formatMessage({id:"pages.prompt.searchType",defaultMessage:"æ£€ç´¢ç±»å‹"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,t){var n,l=null==t||null===(n=t.llm)||void 0===n?void 0:n.searchType;return l===oe.ccx?"å…¨æ–‡":l===oe.DGp?"å‘é‡":l===oe.rk3?"æ··åˆ":null!=l?l:"-"}},{title:n.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"çŸ¥è¯†åº“"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,t){var n=null==t?void 0:t.kbUid;return n?V[n]||n:"-"}},{title:n.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){return[(0,Y.jsx)("a",{onClick:function(){return function(e){var t;if(e&&e.uid){var l={chatConfig:{org:null==i?void 0:i.uid,t:oe.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(l)}else A.yw.error(n.formatMessage({id:"robot.invalid",defaultMessage:"æ— æ•ˆçš„æœºå™¨äºº"}))}(t)},children:n.formatMessage({id:"chat.test",defaultMessage:"æµ‹è¯•"})},"test"),(0,Y.jsx)("a",{onClick:function(){return r.history.push("/service/channel")},children:n.formatMessage({id:"robot.get.code",defaultMessage:"è·å–æœºå™¨äººä»£ç "})},"code"),(0,Y.jsx)("a",{onClick:function(){j(t),p(!0)},children:n.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,Y.jsx)(S.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"åˆ é™¤ç¡®è®¤"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"ç¡®è®¤åˆ é™¤"}),"ã€").concat(null==t?void 0:t.nickname,"ã€‘ï¼Ÿ"),onConfirm:c()(d()().mark((function e(){var l,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,ae.gf)(t);case 4:l=e.sent,A.yw.destroy(),200===(null==l?void 0:l.code)?(A.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(r=a.current)||void 0===r||r.reload()):A.yw.error((null==l?void 0:l.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),A.yw.destroy(),A.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:n.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,Y.jsx)("a",{children:n.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}},{title:n.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ne.Z,{columns:H,actionRef:a,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:oe.f4h}},toolBarRender:function(){return[(0,Y.jsx)(h.ZP,{type:"primary",onClick:function(){j(null),x(!0)},children:n.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=c()(d()().mark((function e(n,l){var a,r,o,s,u,c,p,v,g,h,b,x,M,y,k,w,S,j,C,T,Z,P,U,E;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(null!==(a=null==n?void 0:n.current)&&void 0!==a?a:1)-1,c=null!==(r=null==n?void 0:n.pageSize)&&void 0!==r?r:10,p=null!==(o=null==n?void 0:n.searchText)&&void 0!==o?o:"",v=null!==(s=null==n?void 0:n.type)&&void 0!==s?s:oe.f4h,(b=Object.entries(l||{})).length>0&&(x=b[0],M=m()(x,2),y=M[0],(k=M[1])&&(g=y,h="ascend"===k?"ascend":"descend")),w=f()(f()({pageNumber:u,pageSize:c,categoryUid:"",level:oe.whQ,type:v,orgUid:null==i?void 0:i.uid,searchText:p,superUser:t},g?{sortBy:g}:{}),h?{sortDirection:h}:{}),e.prev=7,e.next=10,(0,ae.p0)(w);case 10:if(S=e.sent,console.log("RobotTable queryRobotsByOrg response:",S,w),200!==(null==S?void 0:S.code)){e.next=16;break}return U=(null==S||null===(j=S.data)||void 0===j?void 0:j.content)||[],E=null!==(C=null!==(T=null==S||null===(Z=S.data)||void 0===Z?void 0:Z.totalElements)&&void 0!==T?T:null==S||null===(P=S.data)||void 0===P?void 0:P.numberOfElements)&&void 0!==C?C:U.length,e.abrupt("return",{data:U,total:E,success:!0});case 16:return e.abrupt("return",{data:[],total:0,success:!1});case 19:return e.prev=19,e.t0=e.catch(7),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:n.formatMessage({id:"robot",defaultMessage:"Robot"})}),u&&(0,Y.jsx)(Pe,{open:u,record:w,onClose:function(){return p(!1)},onSuccess:function(){var e;return null===(e=a.current)||void 0===e?void 0:e.reload()}}),b&&(0,Y.jsx)(Ue.Z,{open:b,onClose:function(){return x(!1)},onSubmit:function(){var e=c()(d()().mark((function e(t){var l,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.yw.loading(n.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=1,e.next=4,(0,ae.lg)(t);case 4:l=e.sent,A.yw.destroy(),200===(null==l?void 0:l.code)?(A.yw.success(n.formatMessage({id:"create.success",defaultMessage:"Create success"})),x(!1),null===(r=a.current)||void 0===r||r.reload()):A.yw.error((null==l?void 0:l.message)||n.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),A.yw.destroy(),A.yw.error(n.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()}),(0,Y.jsx)(Fe,{open:Z,record:R,value:F,onClose:function(){return P(!1)},onSaved:function(){var e;P(!1),L(null),null===(e=a.current)||void 0===e||e.reload()}})]})},Ke=function(){return(0,Y.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,Y.jsx)(r.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,Y.jsx)(Ie,{})},{key:"settings",label:(0,Y.jsx)(r.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,Y.jsx)(X,{})}]})}}}]);