"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2522],{5651:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(11757),o=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},l=n(54183),s=function(e,t){return o.createElement(l.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var i=o.forwardRef(s)},40679:function(e,t,n){var r=n(10154),o=n.n(r),a=n(73193),l=n.n(a),s=n(90819),i=n.n(s),u=n(89933),d=n.n(u),c=n(45332),f=n.n(c),g=n(86803),v=n(82863),m=n(92053),p=n(76750),x=n(55735),h=n(88721),b=n(32327),y=n(62673),C=n(40269),M=n(3849),j=n(73442),k=n(75365),w=n(8247),Z=n(30921),F=n(44194),S=n(31549),q=b.Z.Text,R=F.memo((function(e){var t,n=e.visible,r=e.onCancel,a=e.onOk,s=e.initialProvider,u=e.initialModel,c=e.initialModelLabel,R=e.providers,T=e.currentOrgUid,P=e.existingProviderModels,A=void 0===P?{}:P,U=e.onModelsLoaded,E=e.allowedModelTypes,V=void 0===E?[]:E,L=(0,Z.useIntl)(),I=(0,p.Z)().translateString,O=(0,F.useState)(s||""),N=f()(O,2),z=N[0],B=N[1],W=(0,F.useState)(A),Q=f()(W,2),D=Q[0],K=Q[1],X=(0,F.useState)(s||""),_=f()(X,2),G=_[0],H=_[1],$=(0,F.useState)(u||""),J=f()($,2),Y=J[0],ee=J[1],te=(0,F.useState)(c||""),ne=f()(te,2),re=ne[0],oe=ne[1],ae=(0,F.useState)(!1),le=f()(ae,2),se=le[0],ie=le[1];(0,F.useEffect)((function(){H(s),ee(u),oe(c),B(s)}),[s,u,c,n]),(0,F.useEffect)((function(){if(n&&z&&!D[z]&&!se){ie(!0),g.yw.loading({content:L.formatMessage({id:"loading"}),key:"modelLoading"});var e=R.find((function(e){return e.name===z}));e&&("ollama"===e.name?fe():ve(e))}}),[n,z,R]);var ue=(0,F.useCallback)((function(){G&&Y&&a(G,Y,re)}),[G,Y,re,a]),de=(0,F.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(t){return e.toLowerCase().includes(t.toLowerCase())}))}),[]),ce=(0,F.useCallback)((function(e){return e?e.filter((function(e){return!de(e.value)&&(!V||0===V.length||(!e.type||V.includes(e.type)))})):[]}),[V,de]),fe=function(){var e=d()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.VM)();case 3:200===(t=e.sent).code&&t.data?ge():(g.yw.error(t.message),g.yw.destroy("modelLoading"),ie(!1)),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),g.yw.error(L.formatMessage({id:"error"})),g.yw.destroy("modelLoading"),ie(!1);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=d()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.c8)();case 3:200===(t=e.sent).code?(n=t.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),r=ce(n),K((function(e){return l()(l()({},e),{},{ollama:r})})),U&&U("ollama",r)):g.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),g.yw.error(L.formatMessage({id:"error"}));case 11:return e.prev=11,g.yw.destroy("modelLoading"),ie(!1),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,7,11,15]])})));return function(){return e.apply(this,arguments)}}(),ve=function(){var e=d()(i()().mark((function e(t){var n,r,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:50,providerUid:null==t?void 0:t.uid,orgUid:T,level:x.whQ},e.next=4,(0,v.LF)(n);case 4:200===(r=e.sent).code?(a=r.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:t.name}})),s=ce(a),K((function(e){return l()(l()({},e),{},o()({},t.name,s))})),U&&U(t.name,s)):g.yw.error(r.message),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),g.yw.error(L.formatMessage({id:"error"}));case 12:return e.prev=12,g.yw.destroy("modelLoading"),ie(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[0,8,12,16]])})));return function(t){return e.apply(this,arguments)}}(),me=(0,F.useCallback)((function(e,t){H(e),ee(t.value),oe(t.label)}),[]),pe=(0,F.useCallback)((function(e){if(B(e),!D[e]&&!se){ie(!0),g.yw.loading({content:L.formatMessage({id:"loading"}),key:"modelLoading"});var t=R.find((function(t){return t.name===e}));t&&("ollama"===t.name?fe():ve(t))}}),[R,D,se]),xe=F.memo((function(e){var t=e.model,n=e.providerName;return(0,S.jsxs)(y.Z,{hoverable:!0,style:{cursor:"pointer",border:Y===t.value&&G===n?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return me(n,t)},children:[(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,S.jsx)(b.Z.Title,{level:5,style:{margin:0},children:t.label}),(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[t.type&&(0,S.jsx)("div",{style:{marginBottom:8},children:(0,h.Rb)(t.type)}),Y===t.value&&G===n&&(0,S.jsx)(C.Z,{status:"processing",text:"已选"})]})]}),t.description&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.Z.Text,{type:"secondary",children:null==t?void 0:t.value}),(0,S.jsx)(b.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:t.description})]})]},t.value)}),(function(e,t){return e.model.value===t.model.value&&e.providerName===t.providerName&&(Y===e.model.value&&G===e.providerName)===(Y===t.model.value&&G===t.providerName)})),he=(0,F.useMemo)((function(){return R.map((function(e){var t,n;return{key:e.name,label:I(e.nickname),children:(0,S.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,S.jsxs)(M.Z,{direction:"vertical",style:{width:"100%"},children:[se&&z===e.name&&!D[e.name]?(0,S.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,S.jsx)(q,{type:"secondary",children:"加载模型中..."})}):(!D[e.name]||0===(null===(t=D[e.name])||void 0===t?void 0:t.length))&&(0,S.jsx)(q,{type:"secondary",children:"暂无可用模型"}),(0,S.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(n=D[e.name])||void 0===n?void 0:n.map((function(t){return(0,S.jsx)(xe,{model:t,providerName:e.name},t.value)}))})]})})}}))}),[R,D,z,se,Y,G,I]);return(0,S.jsx)(j.Z,{title:"选择AI模型",open:n,onClose:r,width:700,destroyOnClose:!1,footer:(0,S.jsxs)("div",{style:{textAlign:"right"},children:[(0,S.jsx)(k.ZP,{onClick:r,style:{marginRight:8},children:"取消"}),(0,S.jsx)(k.ZP,{onClick:ue,type:"primary",children:"确定"})]}),children:R.length>0&&(0,S.jsx)(w.Z,{activeKey:z||(null===(t=R[0])||void 0===t?void 0:t.name),onChange:pe,items:he,destroyInactiveTabPane:!1})})}),(function(e,t){return e.visible===t.visible&&e.initialProvider===t.initialProvider&&e.initialModel===t.initialModel&&e.initialModelLabel===t.initialModelLabel}));t.Z=R},50772:function(e,t,n){n(90819),n(73193),n(89933),n(45332),n(24170),n(66916),n(72614),n(1902),n(66310),n(95490),n(55735),n(30921),n(44194),n(31549)},80876:function(e,t,n){var r=n(45332),o=n.n(r),a=n(40612),l=n(55735),s=n(69169),i=n(4499),u=n(84881),d=n(30921),c=n(53530),f=n(44194),g=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,v=(0,d.useIntl)(),m=s.A.useForm(),p=o()(m,1)[0],x=(0,a.u)((function(e){return e.currentOrg})),h=function(){console.log("handleSaveRobot"),p.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},kbEnabled:!1,orgUid:null==x?void 0:x.uid};console.log("robotObject:",t),r(t),p.resetFields()})).catch((function(e){console.log("Form errors:",e)}))};return(0,f.useEffect)((function(){console.log("RobotForm useEffect"),t&&(p.resetFields(),p.setFieldsValue({type:l.f4h}))}),[t,p]),(0,g.jsx)("div",{children:(0,g.jsx)(c.Z,{title:v.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:v.formatMessage({id:"save",defaultMessage:"Save"}),onOk:h,onCancel:function(){p.resetFields(),n()},children:(0,g.jsxs)(s.A,{form:p,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,g.jsx)(i.Z,{label:v.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:v.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return h()}}}),(0,g.jsx)(u.Z,{label:v.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:v.formatMessage({id:l.f4h,defaultMessage:"Service"}),value:l.f4h}],rules:[{required:!0,message:v.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:v.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})}},38588:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ee}});var r=n(75574),o=n(44194),a=n(90819),l=n.n(a),s=n(89933),i=n.n(s),u=n(45332),d=n.n(u),c=n(66310),f=n(53530),g=n(27487),v=n(75365),m=n(9452),p=n(84288),x=n(15722),h=n(82669),b=n(30921),y=n(23864),C=n(80876),M=n(66916),j=n(86803),k=n(40612),w=n(76750),Z=n(55735),F=n(31549),S=function(){var e=(0,y.Z)().isDarkMode,t=(0,b.useIntl)(),n=((0,o.useRef)(!1),(0,w.Z)()),r=n.translateString,a=n.translateStringTranct,s=(0,c.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,insertRobot:e.insertRobot,deleteCurrentRobot:e.deleteCurrentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),u=s.robotResult,S=s.currentRobot,q=s.insertRobot,R=s.deleteCurrentRobot,T=s.setRobotResult,P=s.setCurrentRobot,A=(0,k.u)((function(e){return e.currentOrg})),U=f.Z.useModal(),E=d()(U,2),V=E[0],L=E[1],I=function(){var e=i()(l()().mark((function e(n){var r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),j.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,M.gf)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(j.yw.destroy(),j.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),R(n.uid)):(j.yw.destroy(),j.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=i()(l()().mark((function e(){var t,n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading("loading"),t={pageNumber:0,pageSize:100,categoryUid:"",level:Z.whQ,type:Z.f4h,orgUid:null==A?void 0:A.uid},e.next=4,(0,M.p0)(t);case 4:n=e.sent,console.log("queryRobotsByOrg: ",n,t),200===n.code?(j.yw.destroy(),T(n),r=S&&n.data.content.some((function(e){return e.uid===S.uid})),S&&r||!(n.data.content.length>0)||P(n.data.content[0])):(j.yw.destroy(),j.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){O()}),[]);var N=(0,o.useState)(!1),z=d()(N,2),B=z[0],W=z[1],Q=function(){var e=i()(l()().mark((function e(n){var r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading(t.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=3,(0,M.lg)(n);case 3:r=e.sent,console.log("handleSaveRobot response:",r),200===r.code?(j.yw.destroy(),j.yw.success(t.formatMessage({id:"create.success"})),q(r.data),P(r.data),W(!1)):(j.yw.destroy(),W(!1),j.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(e){return t.formatMessage({id:null==e?void 0:e.type,defaultMessage:null==e?void 0:e.type})};return(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{style:{margin:10},children:(0,F.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[(0,F.jsx)(v.ZP,{size:"small",type:"primary",icon:(0,F.jsx)(h.Z,{}),onClick:function(){W(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,F.jsx)(v.ZP,{size:"small",onClick:O,children:t.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,F.jsx)(v.ZP,{onClick:function(){return function(e){V.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,F.jsx)(x.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(e.nickname),"】？"),onOk:function(){I(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(S)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==S?void 0:S.uid),children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,F.jsx)(m.Z,{itemLayout:"horizontal",dataSource:u.data.content,renderItem:function(t,n){return(0,F.jsx)(m.Z.Item,{style:(null==S?void 0:S.uid)===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(t)},children:(0,F.jsx)(m.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,F.jsx)(p.C,{src:t.avatar}),title:(0,F.jsx)(F.Fragment,{children:a(null==t?void 0:t.nickname)}),description:D(t)})})}}),B&&(0,F.jsx)(C.Z,{open:B,onClose:function(){W(!1)},onSubmit:Q}),L]})},q=n(8247),R=n(35386),T=n(73193),P=n.n(T),A=n(6631),U=n(59908),E=n(69169),V=n(4499),L=n(32350),I=n(16309),O=(n(27015),function(){var e,t=E.A.useForm(),n=d()(t,1)[0],r=(0,b.useIntl)(),a=(0,w.Z)().translateString,s=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),u=s.currentRobot,f=s.setCurrentRobot,g=(0,o.useState)(""),m=d()(g,2),x=m[0],h=m[1],y=(0,o.useState)(a(null==u||null===(e=u.serviceSettings)||void 0===e?void 0:e.welcomeTip)||""),C=d()(y,2),k=C[0],Z=C[1];(0,o.useEffect)((function(){var e;u&&(n.setFieldValue("nickname",a(null==u?void 0:u.nickname)),Z(a(null==u||null===(e=u.serviceSettings)||void 0===e?void 0:e.welcomeTip)),n.setFieldValue("description",a(null==u?void 0:u.description)))}),[u]);var S=function(){var e=i()(l()().mark((function e(t){var n,o,a,s,i,d,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),j.yw.loading(r.formatMessage({id:"updating"})),c=P()(P()({},u),{},{serviceSettings:P()(P()({},u.serviceSettings),{},{welcomeTip:k,welcomeFaqUids:null==u||null===(n=u.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),quickFaqUids:null==u||null===(o=u.serviceSettings)||void 0===o||null===(o=o.quickFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),faqUids:null==u||null===(a=u.serviceSettings)||void 0===a||null===(a=a.faqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==u||null===(s=u.serviceSettings)||void 0===s||null===(s=s.guessFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),hotFaqUids:null==u||null===(i=u.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==u||null===(d=u.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),nickname:t.nickname,description:t.description,avatar:x}),console.log("robotObject:",c),e.next=6,(0,M.$l)(c);case 6:g=e.sent,console.log("updateRobot response:",g),200===g.code?(j.yw.success(r.formatMessage({id:"update.success"})),f(g.data)):j.yw.error(g.message),j.yw.destroy();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=i()(l()().mark((function e(t){var n,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUploadSuccess:",t),h(t),n=P()(P()({},u),{},{avatar:t}),e.next=5,(0,M.lz)(n);case 5:o=e.sent,console.log("updateAvatar response:",o),200===o.code?(j.yw.success(r.formatMessage({id:"update.success"})),f(o.data)):j.yw.error(o.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){h(null==u?void 0:u.avatar)}),[u]),(0,F.jsxs)(E.A,{form:n,style:{marginLeft:"20px"},onFinish:S,children:[(0,F.jsx)(I.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return console.log("Upload event:",e),Array.isArray(e)?e:null==e?void 0:e.fileList},label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,F.jsxs)(A.G,{onSuccess:q,onError:function(e){console.log("handleUploadError:",e)},children:[(0,F.jsx)(p.C,{src:x}),(0,F.jsx)(v.ZP,{icon:(0,F.jsx)(U.Z,{}),children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,F.jsx)(V.Z,{width:"md",name:"nickname",label:r.formatMessage({id:"agent.info.nickname"}),rules:[{required:!0,message:r.formatMessage({id:"agent.info.nickname.required"})}]}),(0,F.jsx)(L.Z,{width:"md",name:"description",label:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})}),N=n(27522),z=n(5651),B=n(48708),W=n(84881),Q=function(){var e=(0,b.useIntl)(),t=(0,b.useNavigate)(),n=E.A.useForm(),r=d()(n,1)[0],a=(0,w.Z)().translateString,s=(0,o.useState)(),u=d()(s,2),f=u[0],g=u[1],m=(0,k.u)((function(e){return e.currentOrg})),p=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),x=p.currentRobot,h=p.setCurrentRobot,y=function(){var t=i()(l()().mark((function t(){var n,r;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,type:Z.QPQ,orgUid:null==m?void 0:m.uid},t.next=4,(0,N.AP)(n);case 4:r=t.sent,console.log("getKeywordBase response:",n,r),j.yw.destroy(),200===r.code?g(r):j.yw.error(r.message);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){y()}),[]),(0,o.useEffect)((function(){r.setFieldValue("kbUid",null==x?void 0:x.kbUid),r.setFieldValue("kbEnabled",null==x?void 0:x.kbEnabled)}),[x]);var C=function(){var t=i()(l()().mark((function t(n){var r,o,a,s,i,u,d;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("onFinish values:",n),u=P()(P()({},x),{},{serviceSettings:P()(P()({},x.serviceSettings),{},{faqUids:null==x||null===(r=x.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==x||null===(o=x.serviceSettings)||void 0===o||null===(o=o.quickFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),guessFaqUids:null==x||null===(a=x.serviceSettings)||void 0===a||null===(a=a.guessFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),hotFaqUids:null==x||null===(s=x.serviceSettings)||void 0===s||null===(s=s.hotFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),shortcutFaqUids:null==x||null===(i=x.serviceSettings)||void 0===i||null===(i=i.shortcutFaqs)||void 0===i?void 0:i.map((function(e){return e.uid}))}),kbUid:n.kbUid,kbEnabled:n.kbEnabled}),console.log("robotObject:",u),t.next=5,(0,M.$l)(u);case 5:d=t.sent,console.log("updateRobot response:",d),200===d.code?(j.yw.destroy(),j.yw.success(e.formatMessage({id:"update.success"})),h(d.data)):(j.yw.destroy(),j.yw.error(d.message));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),S=function(){var e=i()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setFieldValue("kbEnabled",t),e.prev=1,e.next=4,r.validateFields();case 4:n=e.sent,C(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("验证失败:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return(0,F.jsx)("div",{children:(0,F.jsxs)(E.A,{form:r,onFinish:C,children:[(0,F.jsx)(B.Z,{name:"kbEnabled",label:e.formatMessage({id:"robot.kb.enable",defaultMessage:"启用大模型知识库"}),tooltip:e.formatMessage({id:"robot.kb.enable.tooltip",defaultMessage:"开启后，机器人将优先使用知识库回答问题"}),fieldProps:{onChange:S}}),(0,F.jsx)(W.Z,{width:"md",name:"kbUid",label:"大模型知识库",options:null==f?void 0:f.data.content.map((function(e){return{value:e.uid,label:a(e.name)}})),fieldProps:{onChange:function(e){console.log("kbUid:",e)}}}),(0,F.jsx)(E.A.Item,{children:(0,F.jsx)(v.ZP,{icon:(0,F.jsx)(z.Z,{}),onClick:function(){t("/kb/llm/data")},children:"添加大模型知识库"},"github")})]})})},D=n(43705),K=n(71469),X=(n(50796),n(10154)),_=n.n(X),G=n(36605),H=n(82863),$=n(17082),J=n(73457),Y=n(35175),ee=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],te=o.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,o=e.min,a=e.max,l=e.step,s=e.marks,i=e.vertical,u=e.range,d=(0,J.Z)(e,ee);return(0,F.jsx)(Y.Z,(0,$.Z)({valueType:"slider",fieldProps:(0,$.Z)((0,$.Z)({},n),{},{min:o,max:a,step:l,marks:s,vertical:i,range:u,style:null==n?void 0:n.style}),ref:t,proFieldProps:r,filedConfig:{ignoreWidth:!0}},d))})),ne=n(32327),re=n(62673),oe=n(92053),ae=n(40679),le=n(36310),se=(ne.Z.Text,function(){var e,t=(0,b.useIntl)(),n=(0,y.Z)().isDarkMode,r=E.A.useForm(),a=d()(r,1)[0],s=(0,w.Z)().translateString,u=(0,k.u)((function(e){return e.currentOrg})),f=(0,o.useState)([]),g=d()(f,2),m=g[0],p=g[1],x=(0,o.useState)({}),h=d()(x,2),C=h[0],S=h[1],q=(0,o.useState)(!1),R=d()(q,2),T=R[0],A=R[1],U=(0,o.useState)(""),V=d()(U,2),I=V[0],O=V[1],N=(0,o.useState)(""),z=d()(N,2),Q=z[0],D=z[1],K=(0,o.useState)(""),X=d()(K,2),$=X[0],J=X[1],Y=(0,o.useState)(""),ee=d()(Y,2),se=(ee[0],ee[1]),ie=(0,o.useState)(""),ue=d()(ie,2),de=(ue[0],ue[1]),ce=(0,o.useState)(!1),fe=d()(ce,2),ge=fe[0],ve=fe[1],me=(0,o.useState)(""),pe=d()(me,2),xe=pe[0],he=pe[1],be=(0,o.useState)(""),ye=d()(be,2),Ce=ye[0],Me=ye[1],je=(0,o.useState)(""),ke=d()(je,2),we=ke[0],Ze=ke[1],Fe=(0,o.useState)({}),Se=d()(Fe,2),qe=Se[0],Re=Se[1],Te=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),Pe=Te.currentRobot,Ae=Te.setCurrentRobot;(0,o.useEffect)((function(){var e,t,n,r,o,l,i,u,d,c,f,g,v,m,p,x,h,b,y,C,M;a.setFieldValue("enabled",null==Pe||null===(e=Pe.llm)||void 0===e?void 0:e.enabled),a.setFieldValue("streamEnabled",null==Pe||null===(t=Pe.llm)||void 0===t?void 0:t.streamEnabled),a.setFieldValue("topK",null==Pe||null===(n=Pe.llm)||void 0===n?void 0:n.topK),a.setFieldValue("scoreThreshold",null==Pe||null===(r=Pe.llm)||void 0===r?void 0:r.scoreThreshold),a.setFieldValue("provider",null==Pe||null===(o=Pe.llm)||void 0===o?void 0:o.provider),a.setFieldValue("model",null==Pe||null===(l=Pe.llm)||void 0===l?void 0:l.model),a.setFieldValue("temperature",null==Pe||null===(i=Pe.llm)||void 0===i?void 0:i.temperature),a.setFieldValue("topP",null==Pe||null===(u=Pe.llm)||void 0===u?void 0:u.topP),a.setFieldValue("prompt",s(null==Pe||null===(d=Pe.llm)||void 0===d?void 0:d.prompt)),a.setFieldValue("defaultReply",null==Pe||null===(c=Pe.llm)||void 0===c?void 0:c.defaultReply),a.setFieldValue("contextMsgCount",null==Pe||null===(f=Pe.llm)||void 0===f?void 0:f.contextMsgCount),a.setFieldValue("rerankEnabled",null==Pe||null===(g=Pe.llm)||void 0===g?void 0:g.rerankEnabled),a.setFieldValue("rerankProvider",null==Pe||null===(v=Pe.llm)||void 0===v?void 0:v.rerankProvider),a.setFieldValue("rerankModel",null==Pe||null===(m=Pe.llm)||void 0===m?void 0:m.rerankModel),a.setFieldValue("searchType",(null==Pe||null===(p=Pe.llm)||void 0===p?void 0:p.searchType)||"MIXED");var j=(null==Pe||null===(x=Pe.llm)||void 0===x?void 0:x.provider)||"",k=(null==Pe||null===(h=Pe.llm)||void 0===h?void 0:h.model)||"";se((null==Pe||null===(b=Pe.llm)||void 0===b?void 0:b.rerankProvider)||""),de((null==Pe||null===(y=Pe.llm)||void 0===y?void 0:y.rerankModel)||""),O(j),D(k);var w=(null==Pe||null===(C=Pe.llm)||void 0===C?void 0:C.rerankProvider)||"",Z=(null==Pe||null===(M=Pe.llm)||void 0===M?void 0:M.rerankModel)||"";he(w),Me(Z),k&&!$&&J(k)}),[Pe]),(0,o.useEffect)((function(){var e=I,t=Q;if(e&&t&&C[e]){var n=C[e].find((function(e){return e.value===t}));n&&J(n.label)}}),[C,I,Q]),(0,o.useEffect)((function(){var e=xe,t=Ce;if(e&&t&&qe[e]){var n=qe[e].find((function(e){return e.value===t}));n&&Ze(n.label)}}),[qe,xe,Ce]);var Ue=function(){var e=i()(l()().mark((function e(){var t,n,r,o,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==u?void 0:u.uid,level:Z.whQ},e.next=4,(0,G.mK)(t);case 4:n=e.sent,console.log("queryLlmProvidersByOrg response:",n.data,t),200===n.code?(o=n.data.content||[],p(o),(a=null==Pe||null===(r=Pe.llm)||void 0===r?void 0:r.provider)&&(s=o.find((function(e){return e.name===a})))&&("ollama"===s.name?Qe():Ke(s))):j.yw.error(n.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){Ue()}),[]);var Ee=(0,o.useCallback)((function(){A(!0)}),[]),Ve=(0,o.useCallback)((function(){A(!1)}),[]),Le=(0,o.useCallback)((function(e,t,n){O(e),D(t),J(n),a.setFieldValue("provider",e),a.setFieldValue("model",t),A(!1),a.submit()}),[a]),Ie=((0,o.useCallback)((function(){ve(!0)}),[]),(0,o.useCallback)((function(){ve(!1)}),[])),Oe=(0,o.useCallback)((function(e,t,n){he(e),Me(t),Ze(n),a.setFieldValue("rerankProvider",e),a.setFieldValue("rerankModel",t),ve(!1),a.submit()}),[a]),Ne=(0,o.useCallback)((function(e,t){S((function(n){return P()(P()({},n),{},_()({},e,t))}))}),[]),ze=(0,o.useCallback)((function(e,t){Re((function(n){return P()(P()({},n),{},_()({},e,t))}))}),[]),Be=function(){var e=i()(l()().mark((function e(n){var r,o,a,s,i,u,d,c;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.yw.loading(t.formatMessage({id:"updating"})),d=P()(P()({},Pe),{},{serviceSettings:P()(P()({},Pe.serviceSettings),{},{welcomeFaqUids:null==Pe||null===(r=Pe.serviceSettings)||void 0===r||null===(r=r.welcomeFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null===(o=Pe.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})),quickFaqUids:null==Pe||null===(a=Pe.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==Pe||null===(s=Pe.serviceSettings)||void 0===s||null===(s=s.guessFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),hotFaqUids:null==Pe||null===(i=Pe.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==Pe||null===(u=Pe.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),llm:P()(P()({},Pe.llm),{},{enabled:n.enabled,streamEnabled:n.streamEnabled,topK:n.topK,scoreThreshold:n.scoreThreshold,provider:n.provider,model:n.model,temperature:n.temperature,topP:n.topP,prompt:n.prompt,defaultReply:n.defaultReply,contextMsgCount:n.contextMsgCount,rerankEnabled:n.rerankEnabled,rerankProvider:n.rerankProvider,rerankModel:n.rerankModel,searchType:n.searchType})}),e.next=4,(0,M.$l)(d);case 4:200===(c=e.sent).code?(j.yw.destroy(),j.yw.success(t.formatMessage({id:"update.success"})),Ae(c.data)):(j.yw.destroy(),j.yw.error(c.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=(0,o.useCallback)((function(e,t){return[(0,F.jsx)(v.ZP,{type:"default",onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields()},children:"重置"},"reset"),(0,F.jsx)(v.ZP,{type:"primary",onClick:function(){var t;null===(t=e.form)||void 0===t||t.submit()},children:"保存"},"submit")]}),[]),Qe=function(){var e=i()(l()().mark((function e(){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,oe.VM)();case 3:200===(n=e.sent).code&&n.data?De():j.yw.error(n.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),j.yw.error(t.formatMessage({id:"error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=i()(l()().mark((function e(){var n,r,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,oe.c8)();case 3:n=e.sent,console.log("getOllamaLocalModels: ",n.data),200===n.code?(r=n.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),S((function(e){return P()(P()({},e),{},{ollama:r})})),"ollama"===I&&Q&&(o=r.find((function(e){return e.value===Q})))&&J(o.label)):j.yw.error(n.message),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),j.yw.error(t.formatMessage({id:"error"}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=i()(l()().mark((function e(n){var r,o,s,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:50,providerName:null==n?void 0:n.name,orgUid:null==u?void 0:u.uid,level:Z.whQ},e.next=4,(0,H.LF)(r);case 4:o=e.sent,console.log("queryLlmModelsByOrg: ",o.data,r),200===o.code?(s=o.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,providerName:n.name}})),S((function(e){return P()(P()({},e),{},_()({},n.name,s))})),n.name===a.getFieldValue("provider")&&Q&&(i=s.find((function(e){return e.value===Q})))&&J(i.label)):j.yw.error(o.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),j.yw.error(t.formatMessage({id:"error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(E.A,{form:a,size:"large",layout:"vertical",style:{maxWidth:"800px"},submitter:{render:We,submitButtonProps:{size:"large",htmlType:"button"}},onFinish:Be,children:[!(0,le.Ox)()&&(0,F.jsx)(W.Z,{width:"lg",name:"searchType",label:"搜索类型",tooltip:"选择合适的知识库检索方式，不同检索方式适用于不同场景",options:[{label:"全文检索",value:Z.ccx},{label:"向量检索",value:Z.DGp,disabled:!0},{label:"混合检索",value:Z.rk3,disabled:!0}],rules:[{required:!0,message:"请选择搜索类型"}],fieldProps:{dropdownRender:function(e){return(0,F.jsxs)("div",{children:[e,(0,F.jsxs)("div",{style:{padding:"8px 12px"},children:[(0,F.jsx)("div",{style:{borderTop:"1px solid #e8e8e8",margin:"4px 0"}}),(0,F.jsxs)("div",{style:{padding:"8px 0",fontSize:"12px",color:n?"rgba(255, 255, 255, 0.7)":"rgba(0,0,0,0.45)"},children:[(0,F.jsx)("strong",{children:"全文检索："}),"基于关键词匹配，搜索速度快，适合精确查询和简单问答，但可能无法理解语义相关性",(0,F.jsx)("br",{}),(0,F.jsx)("br",{}),(0,F.jsx)("strong",{children:"向量检索："}),"基于语义相似度，能够理解问题的上下文和意图，适合复杂查询和模糊匹配，但计算成本较高",(0,F.jsx)("br",{}),(0,F.jsx)("br",{}),(0,F.jsx)("strong",{children:"混合检索："}),"结合全文检索和向量检索的优势，先用关键词筛选，再通过语义排序，平衡效率和准确性，适合大多数场景"]})]})]})}}}),!1,(0,F.jsx)(B.Z,{width:"lg",name:"enabled",label:"启用对话模型",tooltip:"启用对话模型后，将会关闭关键词。用户在发送消息时，将会直接请求大模型。",fieldProps:{onChange:function(e){setTimeout((function(){a.submit()}),100)}}}),a.getFieldValue("enabled")&&(0,F.jsxs)(F.Fragment,{children:[!1,(0,F.jsx)(L.Z,{width:"lg",name:"prompt",label:"提示词",tooltip:"系统提示词用于指导AI模型的行为和回答方式，设置AI角色定位和回答风格。",placeholder:"请输入提示词",fieldProps:{rows:13,maxLength:16383,showCount:!0},rules:[{required:!0,message:"请输入提示词"},{max:16383,message:"提示词不能超过16383个字符"}]}),(0,F.jsx)(L.Z,{width:"lg",name:"defaultReply",label:"未知问题回复",tooltip:"当AI无法回答用户问题时，系统将返回此回复。注意：修改后仅对新会话生效，已经进行中会话的回复不受影响。",placeholder:"请输入默认回复",fieldProps:{rows:1,maxLength:100,showCount:!0},rules:[{required:!0,message:"请输入默认回复"},{max:100,message:"提示词不能超过100个字符"}]}),(0,F.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,F.jsx)(ne.Z.Text,{strong:!0,style:{marginRight:"8px"},children:"AI 模型选择："}),(0,F.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,F.jsx)(re.Z,{size:"small",style:{width:"100%",maxWidth:"500px",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:Ee,children:I&&Q?(0,F.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,F.jsxs)("div",{children:[(0,F.jsx)(ne.Z.Text,{type:"secondary",children:"供应商："}),(0,F.jsx)(ne.Z.Text,{strong:!0,children:s((null===(e=m.find((function(e){return e.name===I})))||void 0===e?void 0:e.nickname)||I)}),(0,F.jsx)("br",{}),(0,F.jsx)(ne.Z.Text,{type:"secondary",children:"模型："}),(0,F.jsx)(ne.Z.Text,{strong:!0,children:$||Q})]}),(0,F.jsx)(v.ZP,{type:"primary",children:"更换模型"})]}):(0,F.jsx)("div",{style:{textAlign:"center"},children:(0,F.jsx)(v.ZP,{type:"primary",children:"选择AI模型"})})})}),(0,F.jsxs)("div",{style:{display:"none"},children:[(0,F.jsx)(W.Z,{name:"provider",width:"lg"}),(0,F.jsx)(W.Z,{name:"model",width:"lg"})]})]}),(0,F.jsxs)("div",{style:{width:"500px"},children:[(0,F.jsx)(te,{width:"md",label:"温度",name:"temperature",min:0,max:1,step:.1,marks:{0:"精确",.5:"均衡",1:"创造性"},tooltip:"温度参数控制回答的随机性和创造性。值越低(接近0)，回答越确定、一致和可预测，适合需要精确答案的场景；值越高(接近1)，回答越多样化、创造性但可能不那么准确，适合创意性内容生成。",rules:[{required:!0,message:"请输入温度"}]}),(0,F.jsx)(te,{width:"md",label:"Top-P",name:"topP",min:0,max:1,step:.05,marks:{0:"低",.5:"中",1:"高"},tooltip:"核采样参数，与温度不同，它限制模型只考虑概率总和达到设定值P的词汇。设置为0.9表示模型只从占总概率90%的词汇中选择，忽略低概率词。相比温度参数，Top-P在保持回答质量的同时提供更可控的多样性。"}),(0,F.jsx)(te,{width:"md",label:"上下文消息数",name:"contextMsgCount",min:0,max:50,step:1,marks:{0:"0",5:"5",10:"10",15:"15",20:"20",25:"25",30:"30",35:"35",40:"40",45:"45",50:"50"},tooltip:"模型在回答时考虑的历史对话轮数。值越大，模型记忆的对话历史越长，但可能增加响应时间和成本。",rules:[{required:!0,message:"请输入上下文消息数"}]})]})]})]}),(0,F.jsx)(ae.Z,{visible:T,onCancel:Ve,onOk:Le,initialProvider:I,initialModel:Q,initialModelLabel:$,providers:m,currentOrgUid:null==u?void 0:u.uid,existingProviderModels:C,onModelsLoaded:Ne,allowedModelTypes:[Z.JiM]}),(0,F.jsx)(ae.Z,{visible:ge,onCancel:Ie,onOk:Oe,initialProvider:xe,initialModel:Ce,initialModelLabel:we,providers:m,currentOrgUid:null==u?void 0:u.uid,existingProviderModels:qe,onModelsLoaded:ze,allowedModelTypes:[Z.SeQ]})]})}),ie=(n(40058),n(75808)),ue=n(40836),de=n(98473),ce=n(23635),fe=(n(69539),n(50772),function(){var e=(0,b.useIntl)(),t=(0,o.useMemo)((function(){return[{key:"kb",label:(0,F.jsx)(b.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,F.jsx)(Q,{})},{key:"faq",label:(0,F.jsx)(b.FormattedMessage,{id:"menu.kbase.faq",defaultMessage:"FAQ"}),children:(0,F.jsx)(D.Z,{type:Z._X4})},{key:"quickFaqs",label:(0,F.jsx)(b.FormattedMessage,{id:"menu.kbase.quickbutton",defaultMessage:"Quick Button"}),children:(0,F.jsx)(K.Z,{type:Z._X4})},{key:"llm",label:(0,F.jsx)(b.FormattedMessage,{id:"llm",defaultMessage:"LLM"}),children:(0,F.jsx)(se,{})},{key:"rate",label:(0,F.jsx)(b.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,F.jsx)(ce.Z,{type:Z._X4})},{key:"right",label:(0,F.jsx)(b.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,F.jsx)(ue.Z,{type:Z._X4})},{key:"popup",label:(0,F.jsx)(b.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,F.jsx)(ie.Z,{type:Z._X4})},{key:"trigger",label:(0,F.jsx)(b.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"}),children:(0,F.jsx)(de.Z,{type:Z._X4})}]}),[e]);return(0,F.jsx)(q.Z,{tabPosition:"left",items:t})}),ge=n(14238),ve=n(87491),me=n(88996),pe=n(80601),xe=n(88201),he=n(5602),be=n(59485),ye=n(38775),Ce=n(80556),Me=n(40074),je=n(58791),ke=n(61353),we=n(16852),Ze=n(40439),Fe=n(86994),Se=n(58087),qe=n(70185),Re=function(){var e=(0,b.useIntl)(),t=(0,o.useContext)(qe.I).isDarkMode,n=(0,c.V)((function(e){return e.currentRobot})),r=(0,k.u)((function(e){return e.currentOrg})),a=(0,o.useState)(!1),s=d()(a,2),u=s[0],f=s[1],g=(0,o.useState)({totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0}),m=d()(g,2),p=m[0],x=m[1],h=function(){var t=i()(l()().mark((function t(){var o,a,s,i,u,d,c,g,v,m,p,h,b;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("requestQueue"),f(!0),j.yw.info(e.formatMessage({id:"refresh",defaultMessage:"正在刷新队列数据..."})),t.prev=3,o={pageNumber:0,pageSize:100,agentUid:null==n?void 0:n.uid,orgUid:null==r?void 0:r.uid},t.next=7,(0,ve.Wq)(o);case 7:a=t.sent,console.log("queryQueuesByOrg response:",a.data),200==(null==a?void 0:a.code)?(j.yw.destroy(),null!=a&&null!==(s=a.data)&&void 0!==s&&s.content&&a.data.content.length>0?(b=a.data.content.reduce((function(e,t){return e.totalCount+=t.totalCount||0,e.queuingCount+=t.queuingCount||0,e.chattingCount+=t.chattingCount||0,e.offlineCount+=t.offlineCount||0,e.closedCount+=t.closedCount||0,e.leaveMsgCount+=t.leaveMsgCount||0,e.robotToAgentCount+=t.robotToAgentCount||0,e.avgWaitTime=t.avgWaitTime,e.avgResolveTime=t.avgResolveTime,e}),{totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0}),x({totalCount:null!==(i=b.totalCount)&&void 0!==i?i:0,queuingCount:null!==(u=b.queuingCount)&&void 0!==u?u:0,chattingCount:null!==(d=b.chattingCount)&&void 0!==d?d:0,offlineCount:null!==(c=b.offlineCount)&&void 0!==c?c:0,closedCount:null!==(g=b.closedCount)&&void 0!==g?g:0,leaveMsgCount:null!==(v=b.leaveMsgCount)&&void 0!==v?v:0,robotToAgentCount:null!==(m=b.robotToAgentCount)&&void 0!==m?m:0,avgWaitTime:null!==(p=b.avgWaitTime)&&void 0!==p?p:0,avgResolveTime:null!==(h=b.avgResolveTime)&&void 0!==h?h:0})):x({totalCount:0,queuingCount:0,chattingCount:0,offlineCount:0,closedCount:0,leaveMsgCount:0,robotToAgentCount:0,avgWaitTime:0,avgResolveTime:0})):j.yw.error(null==a?void 0:a.message);case 10:return t.prev=10,f(!1),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[3,,10,13]])})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){h()}),[n]);var y={boxShadow:t?"0 4px 8px rgba(255,255,255,0.05)":"0 4px 8px rgba(0,0,0,0.1)",borderRadius:"8px",height:"100%",transition:"transform 0.3s",cursor:"pointer"},C={totalCount:{bg:t?"#0a2642":"#e6f7ff",valueColor:"#1890ff"},queuingCount:{bg:t?"#3b2500":"#fff7e6",valueColor:"#fa8c16"},chattingCount:{bg:t?"#162312":"#f6ffed",valueColor:"#52c41a"},offlineCount:{bg:t?"#1f1f1f":"#fcfcfc",valueColor:t?"#d9d9d9":"#8c8c8c"},closedCount:{bg:t?"#2a0e0d":"#fff1f0",valueColor:"#ff4d4f"},leaveMsgCount:{bg:t?"#230e2c":"#f9f0ff",valueColor:"#722ed1"},robotToAgentCount:{bg:t?"#102039":"#e6fffb",valueColor:"#13c2c2"},avgWaitTime:{bg:t?"#273010":"#fcffe6",valueColor:"#a0d911"},avgResolveTime:{bg:t?"#172b4d":"#f0f5ff",valueColor:"#2f54eb"}};return(0,F.jsxs)("div",{style:{padding:"4px"},children:[(0,F.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,F.jsx)(me.Z,{title:e.formatMessage({id:"refresh",defaultMessage:"刷新数据"}),children:(0,F.jsx)(v.ZP,{type:"primary",icon:(0,F.jsx)(Ce.Z,{}),loading:u,onClick:h,size:"small",children:e.formatMessage({id:"refresh",defaultMessage:"刷新"})})})}),(0,F.jsxs)(pe.Z,{spinning:u,children:[(0,F.jsxs)(xe.Z,{gutter:[16,16],children:[(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.totalCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.totalCount",defaultMessage:"总会话"}),value:p.totalCount,prefix:(0,F.jsx)(Me.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.queuingCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.queuingCount",defaultMessage:"排队中"}),value:p.queuingCount,prefix:(0,F.jsx)(je.Z,{}),valueStyle:{color:"#fa8c16"}})})}),(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.chattingCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.chattingCount",defaultMessage:"会话中"}),value:p.chattingCount,prefix:(0,F.jsx)(ke.Z,{}),valueStyle:{color:"#52c41a"}})})}),(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.offlineCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.offlineCount",defaultMessage:"离线留言"}),value:p.offlineCount,prefix:(0,F.jsx)(we.Z,{}),valueStyle:{color:"#8c8c8c"}})})}),(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.closedCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.closedCount",defaultMessage:"已关闭"}),value:p.closedCount,prefix:(0,F.jsx)(Ze.Z,{}),valueStyle:{color:"#ff4d4f"}})})}),(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.leaveMsgCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.leaveMsgCount",defaultMessage:"留言数"}),value:p.leaveMsgCount,prefix:(0,F.jsx)(Fe.Z,{}),valueStyle:{color:C.leaveMsgCount.valueColor}})})})]}),(0,F.jsx)(ye.Z,{style:{margin:"16px 0",fontSize:"14px"},children:e.formatMessage({id:"queue.additionalStats",defaultMessage:"更多统计"})}),(0,F.jsx)(xe.Z,{gutter:[16,16],children:(0,F.jsx)(he.Z,{xs:24,sm:12,md:8,lg:8,xl:4,children:(0,F.jsx)(re.Z,{style:P()(P()({},y),{},{backgroundColor:C.robotToAgentCount.bg}),hoverable:!0,children:(0,F.jsx)(be.Z,{title:e.formatMessage({id:"queue.robotToAgentCount",defaultMessage:"转人工数"}),value:p.robotToAgentCount,prefix:(0,F.jsx)(Se.Z,{}),valueStyle:{color:C.robotToAgentCount.valueColor}})})})})]})]})},Te=function(){var e=(0,b.useIntl)(),t=(0,o.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,F.jsx)(O,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,F.jsx)(ge.Z,{type:Z._X4})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,F.jsx)(fe,{})},{key:"monitor",label:e.formatMessage({id:"queue.dashboard.title",defaultMessage:"Monitor"}),children:(0,F.jsx)(Re,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,F.jsx)(R.Z,{type:Z._X4})}]}),[e]);return(0,F.jsx)(q.Z,{defaultActiveKey:"basic",items:t})},Pe=n(96865),Ae=r.Z.Sider,Ue=r.Z.Content,Ee=function(){var e=(0,Pe.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,o=e.contentStyle;return(0,F.jsxs)(r.Z,{children:[(0,F.jsx)(Ae,{width:n,style:t,children:(0,F.jsx)(S,{})}),(0,F.jsx)(r.Z,{children:(0,F.jsx)(Ue,{style:o,children:(0,F.jsx)(Te,{})})})]})}}}]);