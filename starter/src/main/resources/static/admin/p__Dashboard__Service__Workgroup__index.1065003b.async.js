"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{32051:function(e,t,n){n.r(t),n.d(t,{default:function(){return oe}});var r=n(44194),s=n(44528),a=n(62395),i=n(76711),o=n.n(i),u=n(73193),l=n.n(u),d=n(90819),c=n.n(d),g=n(89933),f=n.n(g),p=n(45332),m=n.n(p),v=n(88130),x=n(72264),h=n(13243),M=n(60593),k=n(42876),w=n(89654),y=n(33633),j=n(15065),b=n(77902),S=n(6992),Z=n(41881),C=n(91768),F=n(66759),U=n(61489),I=n(34203),P=n(77686),T=n(38552),O=n(70097),z=n(68992),D=n(91733),A=n(30394),E=(n(98257),n(57648),n(23968),n(51898)),N=n(28672),W=n(65448),R=n(70878),q=n(66248),B=n(31549),V=function(e){var t=e.open,n=e.onOpenChange,s=e.orgUid,i=e.record,o=e.onSuccess,u=(0,a.useIntl)(),d=R.Z.useForm(),g=m()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(i?g.setFieldsValue({name:i.name||"",description:i.description||"",enabled:null===(e=i.enabled)||void 0===e||e,isDefault:null!==(n=i.isDefault)&&void 0!==n&&n}):(g.resetFields(),g.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,i,g]);var p=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(t=e.sent,r=l()(l()({},t),{},{orgUid:s,uid:null==i?void 0:i.uid}),null==i||!i.uid){e.next=11;break}return e.next=8,(0,I.Y2)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,I.jT)(r);case 13:e.t0=e.sent;case 14:(a=e.t0)&&200===a.code?(U.yw.success(u.formatMessage({id:null!=i&&i.uid?"common.updated":"common.created",defaultMessage:null!=i&&i.uid?"更新成功":"创建成功"})),null==o||o(),n(!1)):U.yw.error((null==a?void 0:a.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving workgroup settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,B.jsx)(q.Z,{title:(0,B.jsx)(a.FormattedMessage,{id:null!=i&&i.uid?"workgroup.settings.template.edit":"workgroup.settings.template.create",defaultMessage:null!=i&&i.uid?"编辑模板":"新建模板"}),open:t,onOk:p,onCancel:function(){return n(!1)},okText:(0,B.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,B.jsx)(a.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,B.jsxs)(R.Z,{form:g,layout:"vertical",preserve:!1,children:[(0,B.jsx)(R.Z.Item,{name:"name",label:(0,B.jsx)(a.FormattedMessage,{id:"workgroup.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:u.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,B.jsx)(h.Z,{placeholder:u.formatMessage({id:"workgroup.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,B.jsx)(R.Z.Item,{name:"description",label:(0,B.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,B.jsx)(h.Z.TextArea,{rows:3,placeholder:u.formatMessage({id:"workgroup.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,B.jsx)(R.Z.Item,{name:"enabled",label:(0,B.jsx)(a.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,B.jsx)(j.Z,{})})]})})},J=n(84005),L="welcome",H=function(){var e=(0,a.useIntl)(),t=(0,P.u)((function(e){return e.currentOrg})),n=(0,T.Z)().leftSiderStyle,i=(0,O.Z)().isDarkMode,u=(0,r.useState)(!1),d=m()(u,2),g=d[0],p=d[1],R=(0,r.useState)([]),q=m()(R,2),H=q[0],K=q[1],Y=(0,r.useState)(),_=m()(Y,2),G=_[0],Q=_[1],X=(0,r.useState)(""),$=m()(X,2),ee=$[0],te=$[1],ne=(0,r.useState)(L),re=m()(ne,2),se=re[0],ae=re[1],ie=(0,r.useState)(!1),oe=m()(ie,2),ue=oe[0],le=oe[1],de=(0,r.useState)(null),ce=m()(de,2),ge=ce[0],fe=ce[1],pe=(0,r.useMemo)((function(){return H.find((function(e){return e.uid===G}))||null}),[H,G]),me=(0,r.useState)(!1),ve=m()(me,2),xe=ve[0],he=ve[1],Me=(0,r.useState)(!1),ke=m()(Me,2),we=ke[0],ye=ke[1],je=(0,r.useState)(!1),be=m()(je,2),Se=be[0],Ze=be[1],Ce=(0,r.useRef)(""),Fe=(0,D.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Ue=Fe.setCurrentWorkgroupSettings,Ie=Fe.currentWorkgroupSettings,Pe=(0,r.useMemo)((function(){if(!ee)return H;var e=ee.toLowerCase();return H.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[H,ee]),Te=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var s,a,i,o,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return p(!0),e.prev=3,a=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:a||void 0},e.next=8,(0,I.zc)(i);case 8:o=e.sent,console.log("加载工作组配置模板列表: ",o,i),u=(null==o||null===(s=o.data)||void 0===s?void 0:s.content)||[],K(u),!(u.length>0)||G&&u.some((function(e){return e.uid===G}))||(Q(u[0].uid),null!=r&&r.keepActive||ae(L));case 13:return e.prev=13,p(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,G]);(0,r.useEffect)((function(){Te(ee)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){pe?(Ue(pe),Ce.current=JSON.stringify(null!=pe?pe:{}),Ze(!1)):(Ue(null),Ce.current=JSON.stringify({}),Ze(!1))}),[null==pe?void 0:pe.uid]),(0,r.useEffect)((function(){if(pe)try{var e=JSON.stringify(null!=Ie?Ie:{});Ze(e!==Ce.current)}catch(e){Ze(!0)}}),[Ie,null==pe?void 0:pe.uid]);var Oe=function(){var n=f()(c()().mark((function n(r){var s,a,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=null!=r?r:pe)&&s.uid){n.next=3;break}return n.abrupt("return");case 3:return a={uid:s.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,I.zN)(a);case 6:(i=n.sent)&&200===i.code?(U.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Te(ee)):U.yw.error((null==i?void 0:i.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ze=function(){var n=f()(c()().mark((function n(r,s){var a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,I.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:s});case 3:(a=n.sent)&&200===a.code?(U.yw.success(e.formatMessage({id:s?"common.enabled":"common.disabled",defaultMessage:s?"已启用":"已停用"})),Te(ee)):U.yw.error((null==a?void 0:a.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),U.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),De=function(){var n=f()(c()().mark((function n(){var r,s,a,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return U.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return he(!0),n.prev=4,r=Ie&&Ie.uid===pe.uid?Ie:pe,n.next=8,(0,I.Y2)(l()({uid:pe.uid,orgUid:null==t?void 0:t.uid},r));case 8:(s=n.sent)&&200===s.code?(U.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Ce.current=JSON.stringify(null!==(a=null!==(i=s.data)&&void 0!==i?i:r)&&void 0!==a?a:{}),Ze(!1),Te(ee,{keepActive:!0})):U.yw.error((null==s?void 0:s.message)||"保存失败"),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(4),console.error("保存失败:",n.t0),U.yw.error("保存失败");case 16:return n.prev=16,he(!1),n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[4,12,16,19]])})));return function(){return n.apply(this,arguments)}}(),Ae=function(){var n=f()(c()().mark((function n(){var r,s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=pe&&pe.uid){n.next=3;break}return U.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(ye(!0),n.prev=4,!Se){n.next=8;break}return n.next=8,De();case 8:return r={uid:pe.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,I.Dm)(r);case 11:(s=n.sent)&&200===s.code?(U.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Ce.current=JSON.stringify(null!==(a=s.data)&&void 0!==a?a:{}),Ze(!1),Te(ee)):U.yw.error((null==s?void 0:s.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),U.yw.error("发布失败");case 19:return n.prev=19,ye(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Ee=(0,r.useMemo)((function(){return null!=pe&&pe.uid?[{key:"welcome",label:(0,B.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,B.jsx)(W.Z,{type:z.aZD,settingsUid:pe.uid})},{key:"tips",label:(0,B.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"}),children:(0,B.jsx)(N.Z,{type:z.aZD,settingsUid:pe.uid})},{key:"service",label:(0,B.jsx)(a.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"}),children:(0,B.jsx)(E.Z,{type:z.aZD,settingsUid:pe.uid})},{key:"rate",label:(0,B.jsx)(a.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,B.jsx)(J.Z,{type:z.aZD,settingsUid:pe.uid})}].concat(o()([]),[{key:"right",label:(0,B.jsx)(a.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,B.jsx)(A.Z,{type:z.aZD,settingsUid:pe.uid})}],o()([]),o()([])):[]}),[null==pe?void 0:pe.uid,e]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,B.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,B.jsxs)(F.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,B.jsx)(x.ZP,{size:"small",icon:(0,B.jsx)(S.Z,{}),type:"primary",onClick:function(){fe(null),le(!0)},children:(0,B.jsx)(a.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,B.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,B.jsx)(h.Z.Search,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:ee,onChange:function(e){return te(e.target.value)},onSearch:function(e){te(e),Te(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,B.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,B.jsx)(M.Z,{dataSource:Pe,locale:{emptyText:(0,B.jsx)(k.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:k.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,B.jsx)(M.Z.Item,{style:G===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Q(e.uid)},children:(0,B.jsx)(M.Z.Item.Meta,{title:(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,B.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,B.jsx)(w.Z,{size:4,children:e.isDefault?(0,B.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,B.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,B.jsx)(v.Z.Panel,{children:pe?(0,B.jsx)(F.Z,{title:(0,B.jsxs)(w.Z,{children:[(0,B.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",pe.name||pe.uid]}),(0,B.jsx)(j.Z,{checked:!!pe.enabled,onChange:function(e){return ze(pe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,B.jsx)(x.ZP,{size:"small",icon:(0,B.jsx)(Z.Z,{}),onClick:function(e){var t;e.stopPropagation(),fe(null!=(t=pe)?t:pe),le(!0)},children:"编辑"}),(0,B.jsx)(b.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Oe(pe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,B.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,B.jsx)(C.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),pe.isDefault?(0,B.jsx)(y.Z,{color:"blue",children:"默认"}):null]}),extra:(0,B.jsxs)(w.Z,{children:[(0,B.jsx)(b.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ae()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,B.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:we,type:"default",children:(0,B.jsx)(a.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,B.jsx)(x.ZP,{onClick:function(){pe&&(Ue(pe),Ce.current=JSON.stringify(null!=pe?pe:{}),Ze(!1))},disabled:!Se,children:(0,B.jsx)(a.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,B.jsx)(x.ZP,{type:"primary",loading:xe,onClick:De,disabled:!Se,children:(0,B.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,B.jsx)(s.Z,{activeKey:se,onChange:ae,items:Ee})}):(0,B.jsx)(F.Z,{children:(0,B.jsx)(k.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,B.jsx)(V,{open:ue,onOpenChange:le,orgUid:(null==t?void 0:t.uid)||"",record:ge,onSuccess:function(){le(!1),Te(ee)}})]})},K=n(54596),Y=n(27401),_=n(44635),G=n(2915),Q=n(50447),X=n(47268),$=n(26608),ee=function(e){var t,n=e.open,s=e.record,i=e.onClose,o=e.onSuccess,u=(0,a.useIntl)(),d=(0,P.u)((function(e){return e.currentOrg})),g=(0,r.useMemo)((function(){return!(null==s||!s.uid)}),[s]),p=(0,r.useState)(!1),v=m()(p,2),h=v[0],M=v[1],k=(0,r.useState)([]),w=m()(k,2),y=w[0],j=w[1],b=(0,r.useState)(!1),Z=m()(b,2),C=Z[0],F=Z[1],T=(0,r.useState)(0),O=m()(T,2),z=O[0],D=O[1],A=(0,r.useRef)(),E=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==d?void 0:d.uid,searchText:t||""},e.next=5,(0,I.zc)(r);case 5:return s=e.sent,a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],j(a),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,F(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==d?void 0:d.uid]);return(0,B.jsxs)(G.a,{open:n,onOpenChange:function(e){e||i()},title:g?u.formatMessage({id:"workgroup.edit",defaultMessage:"编辑工作组"}):u.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),width:520,formRef:A,initialValues:g?{nickname:null==s?void 0:s.nickname,description:null==s?void 0:s.description,settingsUid:null==s||null===(t=s.settings)||void 0===t?void 0:t.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:u.formatMessage({id:"save",defaultMessage:"保存"}),resetText:u.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return i()}}},onFinish:function(){var e=f()(c()().mark((function e(t){var n,r,a,f,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,U.yw.loading(u.formatMessage({id:g?"updating":"creating",defaultMessage:g?"Updating":"Creating"})),!g){e.next=9;break}return a=l()(l()({},s),t),e.next=6,(0,_.W5)(a);case 6:r=e.sent,e.next=13;break;case 9:return f={nickname:t.nickname,description:t.description,settingsUid:t.settingsUid,orgUid:null==d?void 0:d.uid},e.next=12,(0,_.p0)(f);case 12:r=e.sent;case 13:if(U.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=21;break}return U.yw.success(u.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==o||o(r.data),i(),e.abrupt("return",!0);case 21:return U.yw.error((null===(p=r)||void 0===p?void 0:p.message)||u.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),U.yw.destroy(),U.yw.error(u.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,B.jsx)(Q.Z,{name:"settingsUid",label:u.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),placeholder:u.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),rules:[{required:!0,message:u.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:z},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",E(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:C,notFoundContent:0===y.length?(0,B.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,B.jsx)("div",{style:{marginBottom:8,color:"#999"},children:u.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,B.jsx)(x.ZP,{size:"small",type:"primary",icon:(0,B.jsx)(S.Z,{}),onClick:function(){return M(!0)},children:u.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,B.jsx)(x.ZP,{size:"small",icon:(0,B.jsx)(S.Z,{}),onClick:function(){return M(!0)},title:u.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:u.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,B.jsx)(X.Z,{name:"nickname",label:u.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),rules:[{required:!0,message:u.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,B.jsx)($.Z,{name:"description",label:u.formatMessage({id:"workgroup.info.description",defaultMessage:"描述"})}),(0,B.jsx)(V,{open:h,onOpenChange:M,orgUid:(null==d?void 0:d.uid)||"",record:null,onSuccess:function(){M(!1),D((function(e){return e+1}))}})]})},te=n(99754),ne=n(66675),re=n(89007),se=n(6677),ae=function(e){var t,n=e.open,s=e.onClose,a=e.onSubmit,i=re.A.useForm(),o=m()(i,1)[0],u=(0,te.Z)().translateString,l=(0,P.u)((function(e){return e.currentOrg})),d=(0,ne.E)((function(e){return e.agentResult})),g=(0,ne.E)((function(e){return e.setAgentResult})),p=(0,r.useState)([]),v=m()(p,2),h=v[0],M=v[1],k=(0,r.useState)(!1),w=m()(k,2),y=w[0],j=w[1],b=(0,r.useState)(!1),Z=m()(b,2),C=Z[0],F=Z[1],T=(0,r.useState)(0),O=m()(T,2),z=O[0],D=O[1],A=(0,r.useState)([]),E=m()(A,2),N=E[0],W=E[1];(0,r.useEffect)((function(){n&&(o.setFieldsValue({nickname:"",agents:[]}),M([]))}),[n]);var R=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(t){var n,r,s,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==l?void 0:l.uid,searchText:t||""},e.next=5,(0,I.zc)(r);case 5:return s=e.sent,console.log("queryWorkgroupSettingsByOrg response:",s,r),a=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],W(a),!o.getFieldValue("settingsUid")&&a.length>0&&o.setFieldsValue({settingsUid:a[0].uid}),e.abrupt("return",a.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,F(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==l?void 0:l.uid,o]);(0,r.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=l&&l.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:l.uid},e.next=6,(0,se._t)(t);case 6:200===(null==(r=e.sent)?void 0:r.code)?g(r):null!=r&&r.message&&U.yw.warning(r.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,null==l?void 0:l.uid,g]);return(0,B.jsx)("div",{children:(0,B.jsxs)(q.Z,{title:"创建工作组",open:n,forceRender:!0,onOk:function(){console.log("handleOk"),o.validateFields().then((function(e){console.log("form values:",e);var t={nickname:o.getFieldValue("nickname"),agentUids:o.getFieldValue("agents"),settingsUid:o.getFieldValue("settingsUid"),orgUid:null==l?void 0:l.uid};console.log("workgroup:",t),a(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),s()},children:[(0,B.jsxs)(re.A,{form:o,name:"wgForm",submitter:{render:function(e,t){return(0,B.jsx)(B.Fragment,{})}},children:[(0,B.jsx)(Q.Z,{name:"settingsUid",label:"配置",rules:[{required:!0,message:"请选择配置!"}],placeholder:"请选择配置",showSearch:!0,debounceTime:300,params:{reloadStamp:z},request:function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",R(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:C,notFoundContent:0===N.length?(0,B.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,B.jsx)("div",{style:{marginBottom:8,color:"#999"},children:"暂无配置模板"}),(0,B.jsx)(x.ZP,{size:"small",type:"primary",icon:(0,B.jsx)(S.Z,{}),onClick:function(){return j(!0)},children:"创建配置"})]}):void 0},addonAfter:(0,B.jsx)(x.ZP,{size:"small",icon:(0,B.jsx)(S.Z,{}),onClick:function(){return j(!0)},title:"创建配置",children:"新建"})}),(0,B.jsx)(X.Z,{label:"工作组昵称",name:"nickname",rules:[{required:!0,message:"请输入昵称!"}]}),(0,B.jsx)(Q.Z,{name:"agents",label:"成员",options:((null==d||null===(t=d.data)||void 0===t?void 0:t.content)||[]).map((function(e){return{value:e.uid,label:u(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:"请选择成员",value:h,onChange:function(e){console.log("selected ".concat(e)),M(e)}}})]}),(0,B.jsx)(V,{open:y,onOpenChange:j,orgUid:(null==l?void 0:l.uid)||"",record:null,onSuccess:function(){j(!1),D((function(e){return e+1}))}})]})})},ie=function(){var e=(0,a.useIntl)(),t=(0,r.useRef)(),n=(0,P.u)((function(e){return e.currentOrg})),s=(0,r.useState)(!1),i=m()(s,2),o=i[0],u=i[1],l=(0,r.useState)(!1),d=m()(l,2),g=d[0],p=d[1],v=(0,r.useState)(null),h=m()(v,2),M=h[0],k=h[1],w=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,B.jsx)(Y.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0},{title:e.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,B.jsx)("a",{onClick:function(){k(n),u(!0)},children:n.settings.name||e.formatMessage({id:"workgroup.settings.configured",defaultMessage:"已配置"})}):(0,B.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){k(n),u(!0)},children:e.formatMessage({id:"workgroup.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(n,r){return[(0,B.jsx)("a",{onClick:function(){return a.history.push("/service/channel")},children:e.formatMessage({id:"workgroup.get.code",defaultMessage:"获取工作组代码"})},"code"),(0,B.jsx)("a",{onClick:function(){k(r),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,B.jsx)(b.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==r?void 0:r.nickname,"】？"),onConfirm:f()(c()().mark((function n(){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return U.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,_.zl)(r);case 4:s=n.sent,U.yw.destroy(),200===(null==s?void 0:s.code)?(U.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(a=t.current)||void 0===a||a.reload()):U.yw.error((null==s?void 0:s.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),U.yw.destroy(),U.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,B.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(K.Z,{columns:w,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,B.jsx)(x.ZP,{type:"primary",onClick:function(){k(null),p(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=f()(c()().mark((function e(t){var r,s,a,i,o,u,l,d,g,f,p,m,v,x,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null!==(r=null==t?void 0:t.current)&&void 0!==r?r:1)-1,o=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,u=null!==(a=null==t?void 0:t.searchText)&&void 0!==a?a:"",l={pageNumber:i,pageSize:o,sortDirection:"ascend",orgUid:null==n?void 0:n.uid,searchText:u},e.prev=4,e.next=7,(0,_.LE)(l);case 7:if(200!==(null==(d=e.sent)?void 0:d.code)){e.next=12;break}return x=(null==d||null===(g=d.data)||void 0===g?void 0:g.content)||[],h=null!==(f=null!==(p=null==d||null===(m=d.data)||void 0===m?void 0:m.totalElements)&&void 0!==p?p:null==d||null===(v=d.data)||void 0===v?void 0:v.numberOfElements)&&void 0!==f?f:x.length,e.abrupt("return",{data:x,total:h,success:!0});case 12:return e.abrupt("return",{data:[],total:0,success:!1});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"workgroup",defaultMessage:"Workgroup"})}),o&&(0,B.jsx)(ee,{open:o,record:M,onClose:function(){return u(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),g&&(0,B.jsx)(ae,{open:g,onClose:function(){return p(!1)},onSubmit:function(){var n=f()(c()().mark((function n(r){var s,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return U.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,_.p0)(r);case 4:s=n.sent,U.yw.destroy(),200===(null==s?void 0:s.code)?(U.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),p(!1),null===(a=t.current)||void 0===a||a.reload()):U.yw.error((null==s?void 0:s.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),U.yw.destroy(),U.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()})]})},oe=function(){return(0,B.jsx)(s.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,B.jsx)(a.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,B.jsx)(ie,{})},{key:"settings",label:(0,B.jsx)(a.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,B.jsx)(H,{})}]})}}}]);