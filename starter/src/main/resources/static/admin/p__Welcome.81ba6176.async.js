"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8185],{17208:function(e,t,n){n.d(t,{A8:function(){return l},Kq:function(){return p},RL:function(){return f}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),d=n(55735),c=n(30921);function l(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/org/query",{method:"GET",params:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/org/create",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/org/update",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2041:function(e,t,n){n.d(t,{bN:function(){return m},fk:function(){return c}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),d=n(30921);function c(e){return l.apply(this,arguments)}function l(){return(l=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/query/org",{method:"GET",params:i()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/thread/process/history/activity",{method:"GET",params:i()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return x},hS:function(){return f},z_:function(){return l}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),d=n(55735),c=n(30921);function l(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},32289:function(e,t,n){n.r(t),n.d(t,{default:function(){return de}});var r=n(45332),a=n.n(r),s=n(40612),i=n(65461),o=n(30921),u=n(44194),d=n(90819),c=n.n(d),l=n(89933),m=n.n(l),p=n(53530),g=n(75365),f=n(52288),h=n(86803),x=n(17208),v=n(31549),b=function(e){var t=e.open,n=e.onClose,r=e.onSuccess,s=(0,o.useIntl)(),i=((0,o.useModel)("@@initialState").initialState||{}).userInfo,d=(0,u.useState)(!1),l=a()(d,2),b=l[0],y=l[1],M=(0,u.useState)(""),j=a()(M,2),w=j[0],q=j[1],F=(0,u.useState)(!1),S=a()(F,2),k=S[0],I=S[1],T=function(){var e=m()(c()().mark((function e(){var t,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==w){e.next=3;break}return h.yw.error(s.formatMessage({id:"welcome.message.org.name.required"})),e.abrupt("return");case 3:return y(!0),h.yw.loading(s.formatMessage({id:"welcome.message.org.creating"})),t=null!=i&&i.mobile?null==i?void 0:i.mobile:null==i?void 0:i.email,a={name:w,code:t,description:w+"description"},e.prev=7,e.next=10,(0,x.Kq)(a);case 10:200===(o=e.sent).code?(y(!1),h.yw.destroy(),h.yw.success(s.formatMessage({id:"welcome.message.create.success"})),r(o.data),n()):(y(!1),h.yw.destroy(),h.yw.error(s.formatMessage({id:"welcome.message.create.failed"}))),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(7),y(!1),h.yw.destroy(),h.yw.error(s.formatMessage({id:"welcome.message.create.failed"}));case 19:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)(p.Z,{title:s.formatMessage({id:"welcome.modal.title"}),closable:!1,open:t,onCancel:function(){h.yw.error(s.formatMessage({id:"welcome.message.org.required"}))},maskClosable:!1,footer:[(0,v.jsx)(g.ZP,{type:"primary",onClick:function(){n()},disabled:!0,children:s.formatMessage({id:"welcome.modal.join"})},"join"),(0,v.jsx)(g.ZP,{type:"primary",loading:b,onClick:function(){k?T():(I(!0),y(!1))},children:s.formatMessage({id:"welcome.modal.create"})},"create")],children:[(0,v.jsx)("p",{children:s.formatMessage({id:"welcome.modal.description"})}),k&&(0,v.jsx)(f.Z,{placeholder:s.formatMessage({id:"welcome.modal.input.placeholder"}),value:w,onChange:function(e){return q(e.target.value)},onPressEnter:T,autoFocus:!0})]})},y=function(e){var t=e.open,n=e.onClose,r=(0,o.useIntl)(),a=(0,o.useNavigate)(),s=function(){localStorage.setItem("skipVerification","true"),n()};return(0,v.jsx)(p.Z,{title:r.formatMessage({id:"welcome.verify.modal.title",defaultMessage:"账号验证提示"}),open:t,onCancel:s,footer:[(0,v.jsx)(g.ZP,{onClick:s,children:r.formatMessage({id:"welcome.verify.later",defaultMessage:"稍后验证"})},"later"),(0,v.jsx)(g.ZP,{type:"primary",onClick:function(){n(),a("/setting/certification")},children:r.formatMessage({id:"welcome.verify.now",defaultMessage:"立即验证"})},"now")],children:(0,v.jsx)("p",{children:r.formatMessage({id:"welcome.verify.modal.description",defaultMessage:"您的邮箱和手机号尚未验证，为保障账号安全，建议您尽快完成验证。"})})})},M=n(73589),j=n(8247),w=n(73193),q=n.n(w),F=n(84176),S=n.n(F),k=n(55735);function I(e){return T.apply(this,arguments)}function T(){return(T=m()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/agent/status/query/org",{method:"GET",params:q()(q()({},t),{},{client:k.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=n(76750),A=n(44521),Z=n(81947),O=n(29266),Y=n(28977),z=n.n(Y),N=["current","pageSize"],R=function(){var e=(0,o.useIntl)(),t=(0,u.useRef)(),n=((0,C.Z)().translateString,(0,u.useState)(1)),r=a()(n,2),i=(r[0],r[1]),d=(0,u.useState)(10),l=a()(d,2),p=(l[0],l[1]),g=(0,s.u)((function(e){return e.currentOrg})),f=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,v.jsx)(o.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,render:function(e,t){var n;return(0,v.jsx)(v.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!0,render:function(e,t){return"AVAILABLE"===t.status?(0,v.jsx)(O.Z,{color:"green",children:(0,v.jsx)(o.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,v.jsx)(O.Z,{color:"red",children:(0,v.jsx)(o.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,v.jsx)(O.Z,{color:"orange",children:(0,v.jsx)(o.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,v.jsx)(o.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,render:function(e,t,n,r){return z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}];return(0,v.jsx)(Z.Z,{columns:f,actionRef:t,cardBordered:!0,request:function(){var e=m()(c()().mark((function e(t,n,r){var a,s,o,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,s=t.pageSize,o=S()(t,N),i(a),p(s),u=q()({pageNumber:a-1,pageSize:s,orgUid:null==g?void 0:g.uid},o),e.next=7,I(u);case 7:return d=e.sent,console.log("queryAgentStatusByOrg response:",u,d),200===d.code||h.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"})})},D=n(85916),E=n(44781);n(1902),n(95490),n(24170),n(72614);n(32327).Z.Title,D.default.RangePicker,E.Z.Option;function B(e){return H.apply(this,arguments)}function H(){return(H=m()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("/api/v1/queue/member/query/org",{method:"GET",params:q()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=n(88721),V=n(11090),L=n(2041),U=n(73669),G=n(19981),K=n(80556),Q=n(73442),W=n(80601),J=n(51004),_=function(e){var t=e.thread,n=e.drawerOpen,r=void 0!==n&&n,a=e.onClose,s=(0,o.useIntl)();return(0,v.jsx)(Q.Z,{title:s.formatMessage({id:"thread.process.steps.title",defaultMessage:"会话处理流程"}),placement:"right",closable:!0,onClose:a,open:r,width:500,children:(0,v.jsx)(X,{thread:t,isDrawer:!0})})},X=function(e){var t=e.thread,n=e.isDrawer,r=void 0!==n&&n,i=(0,s.u)((function(e){return e.currentOrg})),d=(0,u.useState)([]),l=a()(d,2),p=l[0],f=l[1],x=(0,u.useState)(!1),b=a()(x,2),y=b[0],j=b[1];(0,o.useIntl)();console.log("currentThread",t,y);var w=(0,G.Z)(),q=w.memberResult,F=w.setMemberResult,S=function(){var e=m()(c()().mark((function e(){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,j(!0),n={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid},e.next=7,(0,L.bN)(n);case 7:r=e.sent,console.log("queryThreadProcessHistoryActivity response:",r.data),200===r.code?f(r.data||[]):(console.log("queryThreadProcessHistoryActivity error:",r.data),h.yw.error(r.message)),j(!1),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Fetch thread history error:",e.t0),h.yw.error("获取工单历史记录失败"),j(!1);case 18:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==i?void 0:i.uid},e.next=4,(0,U.z_)(t);case 4:200===(n=e.sent).code?(h.yw.destroy(),F(n)):h.yw.destroy();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){I()}),[t]);var I=function(){S(),k()},T=function(e){if(!e)return"-";var t=q.data.content.find((function(t){return t.uid===e}));return(null==t?void 0:t.nickname)||""},C=r?{}:{maxHeight:"400px",overflowY:"auto"};return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(W.Z,{spinning:y,children:(0,v.jsxs)("div",{style:C,children:[(0,v.jsx)(g.ZP,{type:"primary",shape:"circle",icon:(0,v.jsx)(K.Z,{}),size:"small",onClick:I,style:{position:"absolute",top:"10px",right:"10px",zIndex:1},title:"刷新"}),(0,v.jsx)(J.Z,{direction:"vertical",size:"small",current:p.length-1,style:{padding:"16px"},items:p.map((function(e,t){var n,r;return{title:(r=null==e?void 0:e.activityName,r||"活动"),description:(0,v.jsxs)("div",{children:[(null==e?void 0:e.assignee)&&(0,v.jsxs)("div",{children:["处理人: ",T(null==e?void 0:e.assignee)||(null==e?void 0:e.assignee)]}),(0,v.jsxs)("div",{children:["处理时间: ",(null===(n=e.startTime)||void 0===n?void 0:n.toLocaleString())||"-"]})]}),status:t===p.length-1?"process":"finish"}}))}),0===p.length&&(0,v.jsx)(M.Z,{description:"请选择工单查看流转过程"})]})})})},$=["current","pageSize"],ee=function(){var e=(0,o.useIntl)(),t=(0,u.useRef)(),n=(0,C.Z)().translateString,r=(0,u.useState)(1),i=a()(r,2),d=i[0],l=i[1],p=(0,u.useState)(10),f=a()(p,2),x=f[0],b=f[1],y=(0,s.u)((function(e){return e.currentOrg})),M=(0,u.useState)(!1),j=a()(M,2),w=j[0],F=j[1],I=(0,u.useState)(),T=a()(I,2),O=T[0],Y=(T[1],[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.nickname"}),dataIndex:"visitorNickname",fixed:"left",width:100,copyable:!0,render:function(e,t){var r;return n(null==t||null===(r=t.thread)||void 0===r||null===(r=r.user)||void 0===r?void 0:r.nickname)}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.number"}),dataIndex:"queueNumber",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.queueNickname"}),dataIndex:"queueNickname",copyable:!0,width:100,hideInSearch:!0,render:function(e,t){var r;return n(null==t||null===(r=t.queue)||void 0===r?void 0:r.nickname)}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robot"}),dataIndex:"robotNickname",copyable:!0,render:function(e,t){var r,a=null==t||null===(r=t.thread)||void 0===r?void 0:r.robot;return n(null==a?void 0:a.nickname)}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.waitTime"}),dataIndex:"waitTime",hideInSearch:!0,render:function(e,t){if(!t.waitTime&&0!==t.waitTime)return"-";var n=Math.floor(t.waitTime/60),r=t.waitTime%60;return n>0?"".concat(n,"分").concat(r,"秒"):"".concat(r,"秒")}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.enqueueTime"}),dataIndex:"enqueueTime",hideInSearch:!0,render:function(e,t){return z()(null==t?void 0:t.visitorEnqueueTime).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.status"}),dataIndex:"status",hideInSearch:!0,render:function(e,t){var n;switch(null==t||null===(n=t.thread)||void 0===n?void 0:n.status){case k.ach:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.new"});case k.j0C:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.roboting"});case k.Q7C:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.offline"});case k.v1N:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.queuing"});case k.hl2:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.chatting"});case k.V1n:return(0,v.jsx)(o.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robotAcceptType"}),dataIndex:"robotAcceptType",hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.robotAcceptType){case"AUTO":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.auto"});case"MANUAL":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.manual"});case"ROBOT":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.robot"});default:return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.unknown"})}}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robotAcceptTime"}),dataIndex:"robotAcceptTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotAcceptTime?z()(null==t?void 0:t.robotAcceptTime).format("YYYY-MM-DD HH:mm:ss"):"未接入"}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robotToAgent"}),dataIndex:"robotToAgent",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.offline.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.offline.no"})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robotToAgentTime"}),dataIndex:"robotToAgentTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?z()(null==t?void 0:t.robotToAgentTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.agent"}),dataIndex:"agentNickname",copyable:!0,render:function(e,t){var r,a=JSON.parse((null==t||null===(r=t.thread)||void 0===r?void 0:r.agent)||"{}");return n(null==a?void 0:a.nickname)}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.offline"}),dataIndex:"agentOffline",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?null!=t&&t.agentOffline?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.offline.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.offline.no"}):"-"}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.agentAcceptType"}),dataIndex:"agentAcceptType",hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.agentAcceptType){case"AUTO":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.auto"});case"MANUAL":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.manual"});case"ROBOT":return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.robot"});default:return(0,v.jsx)(o.FormattedMessage,{id:"queue.member.acceptType.unknown"})}}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.agentAcceptTime"}),dataIndex:"agentAcceptTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.agentAcceptTime?z()(null==t?void 0:t.agentAcceptTime).format("YYYY-MM-DD HH:mm:ss"):"未接入"}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.solved"}),dataIndex:"resolved",hideInSearch:!0,render:function(e,t){return t.resolved?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.solved.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.solved.no"})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.rated"}),dataIndex:"rated",hideInSearch:!0,render:function(e,t){return t.rated?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.rated.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.rated.no"})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.rateAt"}),dataIndex:"rateAt",hideInSearch:!0,render:function(e,t){return null!=t&&t.rateAt?z()(null==t?void 0:t.rateAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.summarized"}),dataIndex:"summarized",hideInSearch:!0,render:function(e,t){return t.summarized?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.summarized.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.summarized.no"})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.visitorMessageCount"}),dataIndex:"visitorMessageCount",hideInSearch:!0,render:function(e,t){return t.visitorMessageCount||0}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.agentMessageCount"}),dataIndex:"agentMessageCount",hideInSearch:!0,render:function(e,t){return t.agentMessageCount||0}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.robotMessageCount"}),dataIndex:"robotMessageCount",hideInSearch:!0,render:function(e,t){return t.robotMessageCount||0}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.leaveMsg"}),dataIndex:"leaveMsg",hideInSearch:!0,render:function(e,t){return t.messageLeave?(0,v.jsx)(o.FormattedMessage,{id:"queue.member.leaveMsg.yes"}):(0,v.jsx)(o.FormattedMessage,{id:"queue.member.leaveMsg.no"})}},{title:(0,v.jsx)(o.FormattedMessage,{id:"client"}),dataIndex:"client",copyable:!0,hideInSearch:!0,render:function(e,t){var n;return(0,P.qF)(null==t||null===(n=t.thread)||void 0===n?void 0:n.client)}}]);Y.push({title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,n,r,a){return[(0,v.jsx)("a",{onClick:function(){N(n)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"view")]}});var N=function(e){var t,n;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==y?void 0:y.uid,t:k.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(n=window.bytedesk)||void 0===n||n.showChat(r)},R=function(){var e=m()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",d,x),t=localStorage.getItem(k.LA8),window.open((0,A.kG)()+"/api/v1/queue/member/export?"+new URLSearchParams({orgUid:(null==y?void 0:y.uid)||"",pageNumber:String(d-1),pageSize:String(x),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Z.Z,{columns:Y,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=m()(c()().mark((function t(n,r,a){var s,i,o,u,d;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=n.current,i=n.pageSize,o=S()(n,$),l(s),b(i),u=q()({pageNumber:s-1,pageSize:i,orgUid:null==y?void 0:y.uid},o),t.next=7,B(u);case 7:return d=t.sent,console.log("queryQueueMembersByOrg response:",u,d),h.yw.destroy(),200===d.code||h.yw.error(d.message),t.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 12:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"queue.member.list"}),toolBarRender:function(){return[(0,v.jsx)(g.ZP,{icon:(0,v.jsx)(V.Z,{}),type:"primary",onClick:R,children:(0,v.jsx)(o.FormattedMessage,{id:"queue.member.export"})},"button")]},columnsState:{persistenceKey:"queue-member-table",defaultValue:{}},options:{setting:{draggable:!0,checkable:!0,checkedReset:!0,extra:[(0,v.jsx)("a",{onClick:function(){var e,n;null===(e=t.current)||void 0===e||null===(n=e.reset)||void 0===n||n.call(e)},children:(0,v.jsx)(o.FormattedMessage,{id:"table.columns.reset"})},"reset")]}}}),(0,v.jsx)(_,{thread:O,drawerOpen:w,onClose:function(){return F(!1)}})]})},te=n(86222),ne=n.n(te),re=n(87491),ae=n(62673),se=n(27927),ie=["current","pageSize"],oe=function(){var e=(0,o.useIntl)(),t=(0,u.useRef)(),n=(0,C.Z)().translateString,r=(0,u.useState)(1),i=a()(r,2),d=i[0],l=i[1],p=(0,u.useState)(10),f=a()(p,2),x=f[0],b=f[1],y=(0,s.u)((function(e){return e.currentOrg})),M=(0,u.useState)([]),j=a()(M,2),w=j[0],F=j[1],I=(0,u.useState)([]),T=a()(I,2),O=T[0],Y=T[1],N=(0,u.useState)(!1),R=a()(N,2),D=R[0],E=R[1],B=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.nickname"}),dataIndex:"nickname",copyable:!0,width:150,fixed:"left",render:function(e,t){return n(null==t?void 0:t.nickname)}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.type"}),dataIndex:"type",hideInSearch:!0,render:function(e,t){switch(t.type){case k.VXt:return(0,v.jsx)(o.FormattedMessage,{id:"queue.type.workgroup"});case k.BOH:return(0,v.jsx)(o.FormattedMessage,{id:"queue.type.agent"});case k.aOw:return(0,v.jsx)(o.FormattedMessage,{id:"queue.type.robot"});default:return(0,v.jsx)(o.FormattedMessage,{id:"queue.type.unknown"})}}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.day"}),dataIndex:"day",valueType:"date",search:{transform:function(e){return z()(e).format("YYYY-MM-DD")}}},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.totalCount"}),dataIndex:"totalCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.robotingCount"}),dataIndex:"robotingCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.offlineCount"}),dataIndex:"offlineCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.leaveMsgCount"}),dataIndex:"leaveMsgCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.robotToAgentCount"}),dataIndex:"robotToAgentCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.queuingCount"}),dataIndex:"queuingCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.chattingCount"}),dataIndex:"chattingCount",hideInSearch:!0},{title:(0,v.jsx)(o.FormattedMessage,{id:"queue.closedCount"}),dataIndex:"closedCount",hideInSearch:!0}],H=function(){var e=m()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",d,x),t=localStorage.getItem(k.LA8),window.open((0,A.kG)()+"/api/v1/queue/export?"+new URLSearchParams({orgUid:(null==y?void 0:y.uid)||"",pageNumber:String(d-1),pageSize:String(x),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Z.Z,{columns:B,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=m()(c()().mark((function t(r,a,s){var i,o,u,d,m,p,g,f,x,v;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),E(!0),i=r.current,o=r.pageSize,u=S()(r,ie),l(i),b(o),d=q()({pageNumber:i-1,pageSize:o,orgUid:null==y?void 0:y.uid},u),t.next=8,(0,re.Wq)(d);case 8:if(m=t.sent,console.log("queryQueuesByOrg response:",d,m),h.yw.destroy(),E(!1),200!==m.code){t.next=37;break}(p=m.data.content.map((function(e){return{day:e.day,totalCount:e.totalCount,nickname:n(e.nickname)}}))).sort((function(e,t){return z()(e.day).diff(z()(t.day))})),F(p),g=[],f=ne()(m.data.content),t.prev=18,v=c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=x.value).threadsCountByHour&&t.threadsCountByHour.length>0&&(r=n(t.nickname),a=t.day||"",t.threadsCountByHour.forEach((function(e,t){g.push({hour:String(t)+"点",count:e,nickname:r,day:a})})));case 2:case"end":return e.stop()}}),e)})),f.s();case 21:if((x=f.n()).done){t.next=25;break}return t.delegateYield(v(),"t0",23);case 23:t.next=21;break;case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(18),f.e(t.t1);case 30:return t.prev=30,f.f(),t.finish(30);case 33:Y(g),console.log("Hourly chart data sample:",g.slice(0,3)),t.next=38;break;case 37:h.yw.error(m.message);case 38:return t.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 39:case"end":return t.stop()}}),t,null,[[18,27,30,33]])})));return function(e,n,r){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"queue.list"}),toolBarRender:function(){return[(0,v.jsx)(g.ZP,{icon:(0,v.jsx)(V.Z,{}),type:"primary",onClick:H,children:(0,v.jsx)(o.FormattedMessage,{id:"queue.export"})},"button")]}}),(0,v.jsx)(ae.Z,{title:e.formatMessage({id:"queue.totalCount.trend",defaultMessage:"总数趋势"}),style:{marginTop:16},children:(0,v.jsx)(W.Z,{spinning:D,children:w.length>0?(0,v.jsx)(se.Z,{data:w,xField:"day",yField:"totalCount",seriesField:"nickname",colorField:"nickname",tooltip:function(e){return{name:e.nickname,title:e.day,value:e.totalCount}}}):(0,v.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:e.formatMessage({id:"noData",defaultMessage:"暂无数据"})})})}),(0,v.jsx)(ae.Z,{title:e.formatMessage({id:"queue.hourly.trend",defaultMessage:"24小时接待人数趋势"}),style:{marginTop:16},children:(0,v.jsx)(W.Z,{spinning:D,children:O.length>0?(0,v.jsx)(se.Z,q()(q()({},{smooth:!0,animation:!1,lineStyle:{lineWidth:100},point:{size:5,style:{lineWidth:15}},state:{active:{style:{shadowBlur:4,stroke:"#000",fill:"red"}}},tooltip:{shared:!0}}),{},{data:O,xField:"hour",yField:"count",seriesField:"nickname",colorField:"nickname",tooltip:function(e){return{name:e.nickname,title:"".concat(e.hour,":00"),value:"".concat(e.count).concat(e.day?" (".concat(e.day,")"):"")}}})):(0,v.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:e.formatMessage({id:"noData",defaultMessage:"暂无数据"})})})})]})},ue=function(){var e=[{key:"queue",label:(0,v.jsx)(o.FormattedMessage,{id:"queue.tab.list"}),children:(0,v.jsx)(oe,{})},{key:"queue_member",label:(0,v.jsx)(o.FormattedMessage,{id:"queue.tab.member"}),children:(0,v.jsx)(ee,{})},{key:"agent_status",label:(0,v.jsx)(o.FormattedMessage,{id:"agent.status.log"}),children:(0,v.jsx)(R,{})}];return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(j.Z,{defaultActiveKey:"queue",items:e,style:{padding:"10px"}})})},de=function(){var e=((0,o.useModel)("@@initialState").initialState||{}).userInfo,t=(0,s.u)((function(e){return e.setCurrentOrg})),n=(0,o.useAccess)();n.canDebug&&console.log("Developing canDebug");var r=(0,u.useState)(!1),d=a()(r,2),c=d[0],l=d[1],m=(0,u.useState)(!1),p=a()(m,2),g=p[0],f=p[1];return(0,u.useEffect)((function(){!function(){if(e){if(!e.currentOrganization)return console.log("before initOrganization",e),void l(!0);console.log("after initOrganization"),t(e.currentOrganization)}}(),"true"!==localStorage.getItem("skipVerification")&&(!e||e.emailVerified||e.mobileVerified||f(!0)),(0,i.Bc)()&&console.log("weiyuaiSaas")}),[e]),(0,v.jsxs)("div",{children:[(0,v.jsx)(o.Access,{accessible:n.canAdmin(),fallback:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(M.Z,{description:"欢迎"})}),children:(0,v.jsx)(ue,{})}),(0,v.jsx)(b,{open:c,onClose:function(){return l(!1)},onSuccess:function(e){t(e),window.location.reload()}}),(0,v.jsx)(y,{open:g,onClose:function(){return f(!1)}})]})}},19981:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(55735),a=n(44435),s=n(83642),i=n(83890),o=(0,a.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);