"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7646],{92936:function(e,t,a){a.d(t,{Bv:function(){return P},L0:function(){return U},QB:function(){return y},RF:function(){return q},YO:function(){return w},YQ:function(){return T},Yg:function(){return b},kh:function(){return p},kv:function(){return x},pf:function(){return c},y:function(){return m}});var r=a(90819),s=a.n(r),n=a(73193),i=a.n(n),o=a(89933),u=a.n(o),d=a(27353),l=a(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return k.apply(this,arguments)}function k(){return(k=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/deleteAll",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return j.apply(this,arguments)}function j(){return(j=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/updateIndex",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return F.apply(this,arguments)}function F(){return(F=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/updateVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return S.apply(this,arguments)}function S(){return(S=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/updateAllIndex",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return Z.apply(this,arguments)}function Z(){return(Z=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/faq/updateAllVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return C.apply(this,arguments)}function C(){return(C=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/agent/text/faq-similar-questions",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77129:function(e,t,a){a.d(t,{AP:function(){return c},_J:function(){return b},t5:function(){return m},v_:function(){return p}});var r=a(90819),s=a.n(r),n=a(73193),i=a.n(n),o=a(89933),u=a.n(o),d=a(27353),l=a(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/kbase/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/kbase/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/kbase/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/kbase/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},37278:function(e,t,a){a.d(t,{Ck:function(){return b},dv:function(){return y},pw:function(){return x},qL:function(){return p},z4:function(){return m}});var r=a(90819),s=a.n(r),n=a(89933),i=a.n(n),o=a(73193),u=a.n(o),d=a(27353),l=a(2290),c="/api/v1/quickbutton";function f(e){var t;return u()(u()({},e),{},{channel:null!==(t=null==e?void 0:e.channel)&&void 0!==t?t:d.XtJ})}function p(e){return g.apply(this,arguments)}function g(){return(g=i()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("".concat(c,"/query/org"),{method:"GET",params:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=i()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("".concat(c,"/create"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return(v=i()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("".concat(c,"/update"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=i()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("".concat(c,"/delete"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return k.apply(this,arguments)}function k(){return(k=i()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("".concat(c,"/enable"),{method:"POST",data:f(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},81838:function(e,t,a){a.d(t,{dI:function(){return p},xg:function(){return c}});var r=a(90819),s=a.n(r),n=a(73193),i=a.n(n),o=a(89933),u=a.n(o),d=a(27353),l=a(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/form/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/form/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},90938:function(e,t,a){var r=a(96775);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},94423:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ve}});var r=a(76711),s=a.n(r),n=a(90938),i=a(44194),o=a(44828),u=a(10820),d=a(2290),l=a(84176),c=a.n(l),f=a(73193),p=a.n(f),g=a(86222),m=a.n(g),h=a(90819),b=a.n(h),v=a(89933),x=a.n(v),M=a(45332),y=a.n(M),k=a(89957),q=a.n(k),j=a(50884),w=a(37278),F=a(21002),U=a(28520),S=a(77601),P=a(35746),Z=a(46206),T=a(48518),C=a(50693),A=a(90883),E=a(56668),O=a(16829),D=a(38722),Q=a(91768),I=a(6992),R=a(80503),V=a(27353),N="/api/v1/goods";function B(e){var t;return p()(p()({},e),{},{channel:null!==(t=null==e?void 0:e.channel)&&void 0!==t?t:V.XtJ})}function L(e){return J.apply(this,arguments)}function J(){return(J=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(N,"/query/org"),{method:"GET",params:B(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return G.apply(this,arguments)}function G(){return(G=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(N,"/create"),{method:"POST",data:B(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return Y.apply(this,arguments)}function Y(){return(Y=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(N,"/update"),{method:"POST",data:B(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return _.apply(this,arguments)}function _(){return(_=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(N,"/delete"),{method:"POST",data:B(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W="/api/v1/order";function H(e){var t;return p()(p()({},e),{},{channel:null!==(t=null==e?void 0:e.channel)&&void 0!==t?t:V.XtJ})}function $(e){return ee.apply(this,arguments)}function ee(){return(ee=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(W,"/query/org"),{method:"GET",params:H(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ae.apply(this,arguments)}function ae(){return(ae=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(W,"/create"),{method:"POST",data:H(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return se.apply(this,arguments)}function se(){return(se=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(W,"/update"),{method:"POST",data:H(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return ie.apply(this,arguments)}function ie(){return(ie=x()(b()().mark((function e(t){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("".concat(W,"/delete"),{method:"POST",data:H(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=a(92936),ue=a(77129),de=a(81838),le=a(61476),ce=a(97588),fe=a(17455),pe=a(67186),ge=a(83788),me=a(74056),he=a(17275),be=a(6960),ve=a(19058),xe=a(96596),Me=a.n(xe),ye=a(31549),ke=be.Z.Dragger,qe=[V.V1U,V.mef,V.ICe,V.Qm,V.Qn,V.Yu1,V.tVi,V.JpA,V.QMK,V.JZh,V.DCc,V.kDq],je=[V.V1U,V.mef,V.ICe,V.Qm,V.Qn,V.Yu1,V.tVi,V.JpA,V.QMK,V.JZh],we=je[0]||V.V1U,Fe=function(e){var t=e.open,a=e.isEdit,r=e.quickbutton,n=e.onClose,o=e.onSubmit,u=ce.A.useForm(),l=y()(u,1)[0],c=(0,d.useIntl)(),f=(0,i.useState)(we),g=y()(f,2),m=g[0],h=g[1],v=(0,U.u)((function(e){return e.currentOrg})),M=(0,F.Z)().translateString,k=(0,i.useState)(".png,.jpg,.jpeg,.gif,.bmp"),w=y()(k,2),S=w[0],P=w[1],T=(0,i.useState)([]),C=y()(T,2),E=C[0],O=C[1],D=(0,i.useState)([]),Q=y()(D,2),I=Q[0],R=Q[1],N=(0,i.useState)([]),B=y()(N,2),J=B[0],z=B[1],G=(0,i.useState)([]),X=y()(G,2),Y=X[0],K=X[1],_=(0,i.useState)([]),W=y()(_,2),H=W[0],ee=W[1],te=(0,i.useState)(!1),ae=y()(te,2),re=ae[0],se=ae[1],ne=(0,i.useState)(!1),ie=y()(ne,2),be=ie[0],xe=ie[1],Fe=(0,i.useState)(!1),Ue=y()(Fe,2),Se=Ue[0],Pe=Ue[1],Ze=(0,i.useState)(!1),Te=y()(Ze,2),Ce=Te[0],Ae=Te[1],Ee=(0,i.useState)(!1),Oe=y()(Ee,2),De=Oe[0],Qe=Oe[1],Ie=(0,i.useState)(),Re=y()(Ie,2),Ve=Re[0],Ne=Re[1],Be=(0,i.useMemo)((function(){return function(e){if(!e)return{};try{var t=JSON.parse(e);return t&&"object"===q()(t)?t:{}}catch(e){return{}}}(null==r?void 0:r.content)}),[null==r?void 0:r.content]),Le=(0,i.useMemo)((function(){return qe.map((function(e){return{value:e,label:c.formatMessage({id:"quickbutton.type.".concat(e),defaultMessage:e}),disabled:!je.includes(e)&&(null==r?void 0:r.type)!==e}}))}),[c,null==r?void 0:r.type]),Je=(0,i.useCallback)((function(){var e,a,s,n,i,o,u,d,c,f,p;if(!t)return l.resetFields(),h(we),Ne(void 0),O([]),R([]),z([]),K([]),void ee([]);var g=(null==r?void 0:r.type)||we;h(g);var m=g===V.mef?null==r?void 0:r.kbUid:void 0;if(Ne(m),g!==V.mef)R([]);else{var b=Be.faqUid;R(b?[{uid:b,question:Be.faqQuestion,answer:Be.faqAnswer}]:[])}var v=Be;l.setFieldsValue({title:null==r?void 0:r.title,subtitle:null==r?void 0:r.subtitle,description:null==r?void 0:r.description,icon:null==r?void 0:r.icon,color:null==r?void 0:r.color,badge:null==r?void 0:r.badge,code:null==r?void 0:r.code,imageUrl:null==r?void 0:r.imageUrl,content:null==r?void 0:r.content,type:g,orderIndex:null!==(e=null==r?void 0:r.orderIndex)&&void 0!==e?e:0,highlight:null!==(a=null==r?void 0:r.highlight)&&void 0!==a&&a,enabled:null===(s=null==r?void 0:r.enabled)||void 0===s||s,kbUid:m,payloadFaqUid:v.faqUid,payloadFaqQuestion:v.faqQuestion,payloadFaqAnswer:v.faqAnswer,payloadUrl:v.url,payloadUrlTarget:null!==(n=null!==(i=v.target)&&void 0!==i?i:v.urlTarget)&&void 0!==n?n:"_blank",payloadFormUid:v.formUid,payloadFormSchema:v.formSchema,payloadImageUrl:null!==(o=v.url)&&void 0!==o?o:v.imageUrl,payloadFileUrl:null!==(u=v.url)&&void 0!==u?u:v.fileUrl,payloadAudioUrl:null!==(d=v.url)&&void 0!==d?d:v.audioUrl,payloadVideoUrl:null!==(c=v.url)&&void 0!==c?c:v.videoUrl,payloadPhoneNumber:v.phoneNumber,payloadEmailAddress:v.emailAddress,payloadEmailSubject:v.emailSubject,payloadEmailBody:v.emailBody,payloadWechatNumber:v.wechatNumber,payloadGoodsUid:null!==(f=v.uid)&&void 0!==f?f:v.goodsUid,payloadOrderUid:null!==(p=v.uid)&&void 0!==p?p:v.orderUid})}),[Be,l,t,r]);(0,i.useEffect)((function(){Je()}),[Je]),(0,i.useEffect)((function(){m===V.Qm?P(".png,.jpg,.jpeg,.gif,.bmp"):m===V.tVi?P(".mp4,.avi,.mov,.wmv"):m===V.Yu1?P(".mp3,.wav,.flac"):m===V.Qn&&P(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}),[m]);var ze=(0,i.useCallback)(x()(b()().mark((function e(){var t,a,r,n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=v&&v.uid){e.next=3;break}return O([]),e.abrupt("return");case 3:return se(!0),e.prev=4,e.next=7,(0,ue.AP)({pageNumber:0,pageSize:100,orgUid:v.uid,type:V.QPQ});case 7:200===(t=e.sent).code?(r=s()((null==t||null===(a=t.data)||void 0===a?void 0:a.content)||[]),(n=l.getFieldValue("kbUid"))&&!r.some((function(e){return(null==e?void 0:e.uid)===n}))&&r.push({uid:n,name:c.formatMessage({id:"quickbutton.kbase.missingOption",defaultMessage:"已删除知识库 ({uid})"},{uid:n})}),O(r)):j.yw.error(t.message||c.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("QuickButtonDrawer.loadKbases",e.t0),j.yw.error(c.formatMessage({id:"quickbutton.kbase.loadError",defaultMessage:"知识库加载失败"}));case 15:return e.prev=15,se(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])}))),[null==v?void 0:v.uid,l,c]),Ge=(0,i.useCallback)(function(){var e=x()(b()().mark((function e(t){var a,r,s,n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&null!=v&&v.uid){e.next=3;break}return R([]),e.abrupt("return");case 3:return xe(!0),e.prev=4,e.next=7,(0,oe.pf)({pageNumber:0,pageSize:200,orgUid:v.uid,kbUid:t});case 7:200===(a=e.sent).code?(s=((null==a||null===(r=a.data)||void 0===r?void 0:r.content)||[]).filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{uid:e.uid,question:e.question,answer:e.answer}})),(n=l.getFieldValue("payloadFaqUid"))&&!s.some((function(e){return e.uid===n}))&&s.push({uid:n,question:Be.faqQuestion||c.formatMessage({id:"quickbutton.faq.missingOption",defaultMessage:"已删除常见问题 ({uid})"},{uid:n}),answer:Be.faqAnswer}),R(s)):j.yw.error(a.message||c.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("QuickButtonDrawer.loadFaqs",e.t0),j.yw.error(c.formatMessage({id:"quickbutton.faq.loadError",defaultMessage:"常见问题加载失败"}));case 15:return e.prev=15,xe(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[null==v?void 0:v.uid,Be.faqAnswer,Be.faqQuestion,l,c]);(0,i.useEffect)((function(){t&&m===V.mef&&ze()}),[ze,t,m]);var Xe=(0,i.useCallback)(x()(b()().mark((function e(){var t,a,r,n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=v&&v.uid){e.next=3;break}return z([]),e.abrupt("return");case 3:return Pe(!0),e.prev=4,e.next=7,(0,de.xg)({pageNumber:0,pageSize:200,orgUid:v.uid});case 7:200===(t=e.sent).code?(r=s()((null==t||null===(a=t.data)||void 0===a?void 0:a.content)||[]),(n=l.getFieldValue("payloadFormUid"))&&!r.some((function(e){return(null==e?void 0:e.uid)===n}))&&r.push({uid:n,name:c.formatMessage({id:"quickbutton.form.missingOption",defaultMessage:"已删除表单 ({uid})"},{uid:n}),status:"PUBLISHED",schema:l.getFieldValue("payloadFormSchema")}),z(r)):j.yw.error(t.message||c.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("QuickButtonDrawer.loadForms",e.t0),j.yw.error(c.formatMessage({id:"quickbutton.form.loadError",defaultMessage:"表单加载失败"}));case 15:return e.prev=15,Pe(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])}))),[null==v?void 0:v.uid,l,c]),Ye=(0,i.useCallback)(x()(b()().mark((function e(){var t,a,r,n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=v&&v.uid){e.next=3;break}return K([]),e.abrupt("return");case 3:return Ae(!0),e.prev=4,e.next=7,L({pageNumber:0,pageSize:200,orgUid:v.uid});case 7:200===(t=e.sent).code?(r=s()((null==t||null===(a=t.data)||void 0===a?void 0:a.content)||[]),(n=l.getFieldValue("payloadGoodsUid"))&&!r.some((function(e){return(null==e?void 0:e.uid)===n}))&&r.push({uid:n,title:c.formatMessage({id:"quickbutton.goods.missingOption",defaultMessage:"已删除商品 ({uid})"},{uid:n})}),K(r.map((function(e){return{uid:e.uid,title:e.title}})))):j.yw.error(t.message||c.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("QuickButtonDrawer.loadGoods",e.t0),j.yw.error(c.formatMessage({id:"quickbutton.goods.loadError",defaultMessage:"商品加载失败"}));case 15:return e.prev=15,Ae(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])}))),[null==v?void 0:v.uid,l,c]),Ke=(0,i.useCallback)(x()(b()().mark((function e(){var t,a,r,n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=v&&v.uid){e.next=3;break}return ee([]),e.abrupt("return");case 3:return Qe(!0),e.prev=4,e.next=7,$({pageNumber:0,pageSize:200,orgUid:v.uid});case 7:200===(t=e.sent).code?(r=s()((null==t||null===(a=t.data)||void 0===a?void 0:a.content)||[]),(n=l.getFieldValue("payloadOrderUid"))&&!r.some((function(e){return(null==e?void 0:e.uid)===n}))&&r.push({uid:n,title:c.formatMessage({id:"quickbutton.order.missingOption",defaultMessage:"已删除订单 ({uid})"},{uid:n})}),ee(r.map((function(e){return{uid:e.uid,title:e.title}})))):j.yw.error(t.message||c.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("QuickButtonDrawer.loadOrders",e.t0),j.yw.error(c.formatMessage({id:"quickbutton.order.loadError",defaultMessage:"订单加载失败"}));case 15:return e.prev=15,Qe(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])}))),[null==v?void 0:v.uid,l,c]);(0,i.useEffect)((function(){t&&m===V.mef&&(Ve?Ge(Ve):R([]))}),[Ge,t,Ve,m]);var _e={name:"file",accept:S,action:(0,le.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(V.LA8)},data:function(e){return function(e){return{fileName:Me()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:V.YjS,categoryUid:"",kbUid:void 0,channel:V.XtJ}}(e)},showUploadList:!1,onChange:function(e){if("uploading"===e.file.status&&j.yw.loading(c.formatMessage({id:"quickbutton.upload.uploading",defaultMessage:"{name} 上传中"},{name:e.file.name})),"done"===e.file.status){var t=e.file.response;if(200===(null==t?void 0:t.code)){var a,r=null==t||null===(a=t.data)||void 0===a?void 0:a.fileUrl;if(r)switch(m){case V.Qm:l.setFieldValue("payloadImageUrl",r);break;case V.Qn:l.setFieldValue("payloadFileUrl",r);break;case V.Yu1:l.setFieldValue("payloadAudioUrl",r);break;case V.tVi:l.setFieldValue("payloadVideoUrl",r)}j.yw.destroy(),j.yw.success(c.formatMessage({id:"quickbutton.upload.success",defaultMessage:"{name} 上传成功"},{name:e.file.name}))}else j.yw.destroy(),j.yw.error(c.formatMessage({id:"quickbutton.upload.fail",defaultMessage:"{name} 上传失败"},{name:e.file.name}))}else"error"===e.file.status&&j.yw.error(c.formatMessage({id:"quickbutton.upload.fail",defaultMessage:"{name} 上传失败"},{name:e.file.name}))}};return(0,ye.jsx)(ve.Z,{title:a?c.formatMessage({id:"quickbutton.drawer.title.edit",defaultMessage:"Edit Quick Button"}):c.formatMessage({id:"quickbutton.drawer.title.create",defaultMessage:"Create Quick Button"}),width:720,open:t,onClose:n,destroyOnHidden:!0,extra:(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{onClick:n,children:(0,ye.jsx)(ye.Fragment,{children:c.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"})})}),(0,ye.jsx)(A.ZP,{type:"primary",onClick:function(){l.validateFields().then((function(e){var t,a,s,n=(e.title||"").trim();if(n){var i,u=e.payloadFaqUid&&m===V.mef?I.find((function(t){return t.uid===e.payloadFaqUid}))||(Be.faqUid===e.payloadFaqUid?{question:Be.faqQuestion,answer:Be.faqAnswer}:void 0):void 0;switch(m){case V.mef:i={faqUid:e.payloadFaqUid,faqQuestion:null==u?void 0:u.question,faqAnswer:null==u?void 0:u.answer};break;case V.V1U:i={url:e.payloadUrl,target:e.payloadUrlTarget||"_blank"};break;case V.ICe:i={formUid:e.payloadFormUid,formSchema:e.payloadFormSchema};break;case V.Qm:i={url:e.payloadImageUrl};break;case V.Qn:i={url:e.payloadFileUrl};break;case V.Yu1:i={url:e.payloadAudioUrl};break;case V.tVi:i={url:e.payloadVideoUrl};break;case V.JpA:i={phoneNumber:e.payloadPhoneNumber};break;case V.QMK:i={emailAddress:e.payloadEmailAddress,emailSubject:e.payloadEmailSubject,emailBody:e.payloadEmailBody};break;case V.JZh:i={wechatNumber:e.payloadWechatNumber};break;case V.kDq:i={uid:e.payloadGoodsUid};break;case V.DCc:i={uid:e.payloadOrderUid};break;default:i=void 0}var d=i?Object.entries(i).filter((function(e){var t=y()(e,2)[1];return null!=t&&""!==t})):[],l=d.length>0?Object.fromEntries(d):void 0,f=l?JSON.stringify(l):void 0;o({uid:null==r?void 0:r.uid,title:n,subtitle:e.subtitle,description:e.description,icon:e.icon,color:e.color,badge:e.badge,code:e.code,imageUrl:e.imageUrl,content:f,type:m,orderIndex:null!==(t=e.orderIndex)&&void 0!==t?t:0,highlight:null!==(a=e.highlight)&&void 0!==a&&a,enabled:null===(s=e.enabled)||void 0===s||s,kbUid:m===V.mef?e.kbUid:void 0})}else j.yw.error(c.formatMessage({id:"quickbutton.title.required",defaultMessage:"Please enter a title"}))})).catch((function(){j.yw.error(c.formatMessage({id:"form.validation.error",defaultMessage:"Please check the form inputs."}))}))},children:(0,ye.jsx)(ye.Fragment,{children:c.formatMessage({id:"pages.common.save",defaultMessage:"Save"})})})]}),children:(0,ye.jsxs)(ce.A,{form:l,layout:"vertical",submitter:!1,children:[(0,ye.jsx)(fe.Z,{name:"type",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.type",defaultMessage:"Type"}),options:Le,rules:[{required:!0,message:c.formatMessage({id:"quickbutton.type.required",defaultMessage:"Please choose a type"})}],fieldProps:{onChange:function(e){h(e),e!==V.mef&&(Ne(void 0),R([]),l.setFieldsValue({kbUid:void 0,payloadFaqUid:void 0,payloadFaqQuestion:void 0,payloadFaqAnswer:void 0})),e!==V.kDq&&l.setFieldsValue({payloadGoodsUid:void 0}),e!==V.DCc&&l.setFieldsValue({payloadOrderUid:void 0}),e!==V.ICe&&l.setFieldsValue({payloadFormUid:void 0,payloadFormSchema:void 0}),e!==V.V1U&&l.setFieldsValue({payloadUrl:void 0,payloadUrlTarget:"_blank"}),e!==V.Qm&&l.setFieldsValue({payloadImageUrl:void 0}),e!==V.Qn&&l.setFieldsValue({payloadFileUrl:void 0}),e!==V.Yu1&&l.setFieldsValue({payloadAudioUrl:void 0}),e!==V.tVi&&l.setFieldsValue({payloadVideoUrl:void 0}),e!==V.JpA&&l.setFieldsValue({payloadPhoneNumber:void 0}),e!==V.QMK&&l.setFieldsValue({payloadEmailAddress:void 0,payloadEmailSubject:void 0,payloadEmailBody:void 0}),e!==V.JZh&&l.setFieldsValue({payloadWechatNumber:void 0}),e===V.Qm?P(".png,.jpg,.jpeg,.gif,.bmp"):e===V.tVi?P(".mp4,.avi,.mov,.wmv"):e===V.Yu1?P(".mp3,.wav,.flac"):e===V.Qn&&P(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,ye.jsx)(pe.Z,{name:"title",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.title",defaultMessage:"Title"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.title.required",defaultMessage:"Please enter a title"})}]}),m===V.mef&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(fe.Z,{name:"kbUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"faq.kbase.select",defaultMessage:"选择常见问题知识库"}),options:E.filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{label:M(e.name)||e.name||e.uid,value:e.uid}})),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.faq.kb.required",defaultMessage:"请选择知识库"})}],fieldProps:{showSearch:!0,allowClear:!0,loading:re,optionFilterProp:"label",placeholder:c.formatMessage({id:"quickbutton.payload.faq.kb.placeholder",defaultMessage:"Select a knowledge base"}),onChange:function(e){Ne(e),l.setFieldsValue({kbUid:e,payloadFaqUid:void 0,payloadFaqQuestion:void 0,payloadFaqAnswer:void 0})},disabled:!(null!=v&&v.uid)}}),(0,ye.jsx)(fe.Z,{name:"payloadFaqUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.faq.uid",defaultMessage:"FAQ Identifier"}),options:I.map((function(e){return{label:M(e.question)||e.question||e.uid,value:e.uid}})),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.faq.uid.required",defaultMessage:"请选择常见问题"})}],fieldProps:{showSearch:!0,allowClear:!0,loading:be,optionFilterProp:"label",placeholder:c.formatMessage({id:"quickbutton.payload.faq.uid.placeholder",defaultMessage:"Select FAQ"}),onChange:function(e){return function(e){if(e){var t=I.find((function(t){return t.uid===e}));l.setFieldsValue({payloadFaqUid:e,payloadFaqQuestion:null==t?void 0:t.question,payloadFaqAnswer:null==t?void 0:t.answer})}else l.setFieldsValue({payloadFaqUid:void 0,payloadFaqQuestion:void 0,payloadFaqAnswer:void 0})}(e)},disabled:!Ve}})]}),m===V.V1U&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.url",defaultMessage:"URL"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.url.required",defaultMessage:"Please input URL"})}]}),(0,ye.jsx)(fe.Z,{name:"payloadUrlTarget",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.urlTarget",defaultMessage:"Open link in"}),options:[{label:c.formatMessage({id:"quickbutton.payload.urlTarget.blank",defaultMessage:"New window"}),value:"_blank"}],fieldProps:{disabled:!0}})]}),m===V.ICe&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(fe.Z,{name:"payloadFormUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.form.uid",defaultMessage:"选择表单"}),options:J.filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{label:M(e.name)||e.name||e.uid,value:e.uid}})),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.form.uid.required",defaultMessage:"请选择表单"})}],fieldProps:{showSearch:!0,allowClear:!0,loading:Se,optionFilterProp:"label",placeholder:c.formatMessage({id:"quickbutton.payload.form.uid.placeholder",defaultMessage:"Select form"}),disabled:!(null!=v&&v.uid),onChange:function(e){return function(e){if(e){var t=J.find((function(t){return t.uid===e}));l.setFieldsValue({payloadFormUid:e,payloadFormSchema:null==t?void 0:t.schema})}else l.setFieldsValue({payloadFormUid:void 0,payloadFormSchema:void 0})}(e)},onDropdownVisibleChange:function(e){e&&Xe()}}}),(0,ye.jsx)(ge.Z,{name:"payloadFormSchema",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.form",defaultMessage:"Form Schema"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.form.required",defaultMessage:"Please input schema"})}],fieldProps:{rows:3,readOnly:!0}})]}),m===V.Qm&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadImageUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.image",defaultMessage:"Image URL"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.image.required",defaultMessage:"Please input image url"})}],fieldProps:{placeholder:c.formatMessage({id:"quickbutton.payload.image.placeholder",defaultMessage:"上传成功后会自动填充（也可手动填写 URL）"})}}),(0,ye.jsxs)(ke,p()(p()({},_e),{},{children:[(0,ye.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ye.jsx)(he.Z,{})}),(0,ye.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"quickbutton.upload.dragger.text",defaultMessage:"点击或拖拽上传文件"})})]}))]}),m===V.Qn&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadFileUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.file",defaultMessage:"File URL"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.file.required",defaultMessage:"Please input file url"})}],fieldProps:{placeholder:c.formatMessage({id:"quickbutton.payload.file.placeholder",defaultMessage:"上传成功后会自动填充（也可手动填写 URL）"})}}),(0,ye.jsxs)(ke,p()(p()({},_e),{},{children:[(0,ye.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ye.jsx)(he.Z,{})}),(0,ye.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"quickbutton.upload.dragger.text",defaultMessage:"点击或拖拽上传文件"})})]}))]}),m===V.Yu1&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadAudioUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.audio",defaultMessage:"Audio URL"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.audio.required",defaultMessage:"Please input audio url"})}],fieldProps:{placeholder:c.formatMessage({id:"quickbutton.payload.audio.placeholder",defaultMessage:"上传成功后会自动填充（也可手动填写 URL）"})}}),(0,ye.jsxs)(ke,p()(p()({},_e),{},{children:[(0,ye.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ye.jsx)(he.Z,{})}),(0,ye.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"quickbutton.upload.dragger.text",defaultMessage:"点击或拖拽上传文件"})})]}))]}),m===V.tVi&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadVideoUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.video",defaultMessage:"Video URL"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.video.required",defaultMessage:"Please input video url"})}],fieldProps:{placeholder:c.formatMessage({id:"quickbutton.payload.video.placeholder",defaultMessage:"上传成功后会自动填充（也可手动填写 URL）"})}}),(0,ye.jsxs)(ke,p()(p()({},_e),{},{children:[(0,ye.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ye.jsx)(he.Z,{})}),(0,ye.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"quickbutton.upload.dragger.text",defaultMessage:"点击或拖拽上传文件"})})]}))]}),m===V.JpA&&(0,ye.jsx)(pe.Z,{name:"payloadPhoneNumber",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.phoneNumber",defaultMessage:"Phone Number"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.phoneNumber.required",defaultMessage:"Please input phone number"})}]}),m===V.QMK&&(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(pe.Z,{name:"payloadEmailAddress",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.emailAddress",defaultMessage:"Email Address"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.emailAddress.required",defaultMessage:"Please input email address"})}]}),(0,ye.jsx)(pe.Z,{name:"payloadEmailSubject",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.emailSubject",defaultMessage:"Email Subject"})}),(0,ye.jsx)(ge.Z,{name:"payloadEmailBody",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.emailBody",defaultMessage:"Email Body"}),fieldProps:{rows:3}})]}),m===V.JZh&&(0,ye.jsx)(pe.Z,{name:"payloadWechatNumber",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.wechatNumber",defaultMessage:"WeChat Number"}),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.wechatNumber.required",defaultMessage:"Please input wechat number"})}]}),m===V.kDq&&(0,ye.jsx)(fe.Z,{name:"payloadGoodsUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.goods.uid",defaultMessage:"选择商品"}),options:Y.filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{label:M(e.title)||e.title||e.uid,value:e.uid}})),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.goods.uid.required",defaultMessage:"请选择商品"})}],fieldProps:{showSearch:!0,allowClear:!0,loading:Ce,optionFilterProp:"label",placeholder:c.formatMessage({id:"quickbutton.payload.goods.uid.placeholder",defaultMessage:"Select goods"}),disabled:!(null!=v&&v.uid),onDropdownVisibleChange:function(e){e&&Ye()}}}),m===V.DCc&&(0,ye.jsx)(fe.Z,{name:"payloadOrderUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.payload.order.uid",defaultMessage:"选择订单"}),options:H.filter((function(e){return Boolean(null==e?void 0:e.uid)})).map((function(e){return{label:M(e.title)||e.title||e.uid,value:e.uid}})),rules:[{required:!0,message:c.formatMessage({id:"quickbutton.payload.order.uid.required",defaultMessage:"请选择订单"})}],fieldProps:{showSearch:!0,allowClear:!0,loading:De,optionFilterProp:"label",placeholder:c.formatMessage({id:"quickbutton.payload.order.uid.placeholder",defaultMessage:"Select order"}),disabled:!(null!=v&&v.uid),onDropdownVisibleChange:function(e){e&&Ke()}}}),(0,ye.jsx)(me.Z,{name:"enabled",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.enabled",defaultMessage:"Enabled"})})]})})},Ue=a(97765),Se=["current","pageSize"],Pe=[V.V1U,V.mef,V.ICe,V.Qm,V.Qn,V.Yu1,V.tVi,V.JpA,V.QMK,V.JZh,V.DCc,V.kDq],Ze=function(){var e=(0,d.useIntl)(),t=(0,i.useRef)(),a=(0,F.Z)().translateString,r=(0,U.u)((function(e){return e.currentOrg})),s=(0,i.useState)(!1),n=y()(s,2),o=n[0],u=n[1],l=(0,i.useState)(!1),f=y()(l,2),g=f[0],h=f[1],v=(0,i.useState)(),M=y()(v,2),k=M[0],V=M[1],N=(0,i.useState)([]),B=y()(N,2),L=B[0],J=B[1],z=(0,i.useState)([]),G=y()(z,2),X=G[0],Y=G[1],K=(0,i.useMemo)((function(){return Pe.reduce((function(t,a){return t[a]={text:e.formatMessage({id:"quickbutton.type.".concat(a),defaultMessage:a})},t}),{})}),[e]),_=(0,i.useCallback)((function(){J([]),Y([])}),[]),W=(0,i.useCallback)((function(){V(void 0),h(!1),u(!0)}),[]),H=(0,i.useCallback)((function(e){V(e),h(!0),u(!0)}),[]),$=(0,i.useCallback)((function(r){var s;P.Z.confirm({title:e.formatMessage({id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),content:e.formatMessage({id:"pages.common.deleteConfirm"},{name:a(r.title)||r.uid}),okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),onOk:(s=x()(b()().mark((function a(){var s,n,i;return b()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),a.next=3,(0,w.pw)({uid:r.uid});case 3:n=a.sent,null==s||s(),200===n.code?(j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),_(),null===(i=t.current)||void 0===i||i.reloadAndRest()):j.yw.error(n.message||e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return a.stop()}}),a)}))),function(){return s.apply(this,arguments)})})}),[e,_,a]),ee=(0,i.useCallback)(function(){var a=x()(b()().mark((function a(r,s){var n,i;return b()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,w.dv)({uid:r.uid,enabled:s});case 2:200===(n=a.sent).code?(j.yw.success(s?e.formatMessage({id:"enable.success",defaultMessage:"Enabled"}):e.formatMessage({id:"disable.success",defaultMessage:"Disabled"})),null===(i=t.current)||void 0===i||i.reload()):j.yw.error(n.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"}));case 4:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}(),[e]),te=(0,i.useCallback)(function(){var a=x()(b()().mark((function a(r){var s,n,i,o,u,d;return b()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==X.length){a.next=2;break}return a.abrupt("return");case 2:n=j.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"Enabling"}):e.formatMessage({id:"disabling",defaultMessage:"Disabling"})),i=0,o=m()(X),a.prev=5,o.s();case 7:if((u=o.n()).done){a.next=15;break}return d=u.value,a.next=11,(0,w.dv)({uid:d.uid,enabled:r});case 11:200===a.sent.code&&(i+=1);case 13:a.next=7;break;case 15:a.next=20;break;case 17:a.prev=17,a.t0=a.catch(5),o.e(a.t0);case 20:return a.prev=20,o.f(),a.finish(20);case 23:null==n||n(),j.yw.success(e.formatMessage({id:r?"quickbutton.batch.enable.result":"quickbutton.batch.disable.result",defaultMessage:r?"Enabled {success}/{total}":"Disabled {success}/{total}"},{success:i,total:X.length})),_(),null===(s=t.current)||void 0===s||s.reloadAndRest();case 27:case"end":return a.stop()}}),a,null,[[5,17,20,23]])})));return function(e){return a.apply(this,arguments)}}(),[e,_,X]),ae=(0,i.useCallback)((function(){var a;0!==X.length&&P.Z.confirm({title:e.formatMessage({id:"batch.deleteTip",defaultMessage:"Delete Selected"}),content:e.formatMessage({id:"batch.deleteAffirm"},{count:X.length}),okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),onOk:(a=x()(b()().mark((function a(){var r,s,n,i,o;return b()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s=j.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n=m()(X),a.prev=2,n.s();case 4:if((i=n.n()).done){a.next=10;break}return o=i.value,a.next=8,(0,w.pw)({uid:o.uid});case 8:a.next=4;break;case 10:a.next=15;break;case 12:a.prev=12,a.t0=a.catch(2),n.e(a.t0);case 15:return a.prev=15,n.f(),a.finish(15);case 18:null==s||s(),_(),null===(r=t.current)||void 0===r||r.reloadAndRest();case 21:case"end":return a.stop()}}),a,null,[[2,12,15,18]])}))),function(){return a.apply(this,arguments)})})}),[e,X,_]),re=(0,i.useCallback)(function(){var a=x()(b()().mark((function a(s){var n,i,o,d;return b()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=r&&r.uid){a.next=3;break}return j.yw.error(e.formatMessage({id:"quickbutton.notice.needOrg",defaultMessage:"Please select an organization first."})),a.abrupt("return");case 3:if(n=p()(p()({},s),{},{orgUid:r.uid}),i=j.yw.loading(e.formatMessage({id:g?"updating":"creating"})),!g){a.next=11;break}return a.next=8,(0,w.Ck)(n);case 8:a.t0=a.sent,a.next=14;break;case 11:return a.next=13,(0,w.z4)(n);case 13:a.t0=a.sent;case 14:o=a.t0,null==i||i(),200===o.code?(j.yw.success(e.formatMessage({id:g?"update.success":"create.success"})),u(!1),null===(d=t.current)||void 0===d||d.reloadAndRest()):j.yw.error(o.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"}));case 17:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),[null==r?void 0:r.uid,e,g]),se=(0,i.useCallback)((function(t){var r=(t.type||"FAQ").toUpperCase(),s=function(e){if(!e)return{};try{var t=JSON.parse(e);return t&&"object"===q()(t)?t:{}}catch(e){return{}}}(t.content);if("FAQ"===r){var n=a(s.faqQuestion)||s.faqQuestion||s.faqUid||"-",i=a(s.faqAnswer)||s.faqAnswer,o=(0,ye.jsxs)(Z.Z,{direction:"vertical",size:4,children:[(0,ye.jsx)("span",{children:n}),i&&(0,ye.jsx)("span",{style:{color:"#999"},children:i})]});return(0,ye.jsx)(T.Z,{title:o,styles:{body:{maxWidth:360}},placement:"topLeft",children:(0,ye.jsx)("span",{children:n})})}if("URL"===r){var u=s.url;return(0,ye.jsx)(Z.Z,{direction:"vertical",size:4,children:u?(0,ye.jsx)("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:u}):(0,ye.jsx)("span",{children:"-"})})}if("FORM"===r){var d=s.formUid?"formUid: ".concat(s.formUid):s.formSchema?e.formatMessage({id:"quickbutton.payload.form",defaultMessage:"Form schema"}):"-";return(0,ye.jsx)("span",{children:d})}if("IMAGE"===r)return(0,ye.jsx)("span",{children:s.url||s.imageUrl||"-"});if("FILE"===r)return(0,ye.jsx)("span",{children:s.url||s.fileUrl||"-"});if("AUDIO"===r)return(0,ye.jsx)("span",{children:s.url||s.audioUrl||"-"});if("VIDEO"===r)return(0,ye.jsx)("span",{children:s.url||s.videoUrl||"-"});if("PHONE_NUMBER"===r)return(0,ye.jsx)("span",{children:s.phoneNumber||"-"});if("EMAILL_ADDRESS"===r){var l=s.emailAddress||"-",c=s.emailSubject,f=s.emailBody,p=(0,ye.jsxs)(Z.Z,{direction:"vertical",size:4,children:[(0,ye.jsx)("span",{children:l}),c&&(0,ye.jsx)("span",{style:{color:"#999"},children:c}),f&&(0,ye.jsx)("span",{style:{color:"#999"},children:f})]});return c||f?(0,ye.jsx)(T.Z,{title:p,styles:{body:{maxWidth:360}},placement:"topLeft",children:(0,ye.jsx)("span",{children:l})}):(0,ye.jsx)("span",{children:l})}return"WECHAT_NUMBER"===r?(0,ye.jsx)("span",{children:s.wechatNumber||"-"}):"GOODS"===r?(0,ye.jsx)("span",{children:s.uid||s.goodsUid||"-"}):"ORDER"===r?(0,ye.jsx)("span",{children:s.uid||s.orderUid||"-"}):(0,ye.jsx)("span",{children:"-"})}),[e,a]),ne=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.title",defaultMessage:"Title"}),dataIndex:"title",render:function(e,t){return a(t.title)||t.title||"-"},copyable:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:K},{title:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueType:"select",search:!1,valueEnum:{true:{text:e.formatMessage({id:"quickreply.enabled.true",defaultMessage:"Enabled"}),status:"Success"},false:{text:e.formatMessage({id:"quickreply.enabled.false",defaultMessage:"Disabled"}),status:"Error"}},render:function(e,t){return(0,ye.jsx)(C.Z,{size:"small",checked:t.enabled,onChange:function(e){return ee(t,e)}})}},{title:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.content",defaultMessage:"Content"}),dataIndex:"content",search:!1,render:function(e,t){return se(t)},width:240},{title:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.updatedAt",defaultMessage:"Updated"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,width:180,search:!1},{title:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:160,render:function(e,t){return(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{type:"link",size:"small",onClick:function(){return H(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}),(0,ye.jsx)(A.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return $(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.delete",defaultMessage:"Delete"})})]})}}],ie={selectedRowKeys:L,onChange:function(e,t){J(e),Y(t)}},oe=[{key:"batchEnable",icon:(0,ye.jsx)(O.Z,{}),label:e.formatMessage({id:"quickbutton.action.batch.enable",defaultMessage:"Enable Selected"})+" (".concat(L.length,")"),onClick:function(){return te(!0)}},{key:"batchDisable",icon:(0,ye.jsx)(D.Z,{}),label:e.formatMessage({id:"quickbutton.action.batch.disable",defaultMessage:"Disable Selected"})+" (".concat(L.length,")"),onClick:function(){return te(!1)}},{key:"batchDelete",icon:(0,ye.jsx)(Q.Z,{}),danger:!0,label:e.formatMessage({id:"quickbutton.action.batch.delete",defaultMessage:"Delete Selected"})+" (".concat(L.length,")"),onClick:ae}];return(0,i.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[null==r?void 0:r.uid]),(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(S.Z,{columns:ne,actionRef:t,rowKey:"uid",cardBordered:!0,rowSelection:ie,search:{labelWidth:"auto"},request:function(){var t=x()(b()().mark((function t(a,s){var n,i,o,u,d,l,f,g,m,h,v;return b()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=r&&r.uid){t.next=2;break}return t.abrupt("return",{data:[],success:!0,total:0});case 2:return o=a.current,u=void 0===o?1:o,d=a.pageSize,l=void 0===d?10:d,f=c()(a,Se),g=s?Object.keys(s)[0]:void 0,m=p()({pageNumber:u-1,pageSize:l,orgUid:r.uid},f),g&&(m.sortBy=g,m.sortDirection="ascend"===s[g]?"ascend":"descend"),t.next=8,(0,w.qL)(m);case 8:if(h=t.sent,Ue.Z.debug("QuickButtonTable queryQuickbuttonsByOrg response:",null==h?void 0:h.data,m),200===h.code){t.next=13;break}return j.yw.error(h.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),t.abrupt("return",{data:[],success:!1,total:0});case 13:return v=(null==h||null===(n=h.data)||void 0===n?void 0:n.content)||[],t.abrupt("return",{data:v,success:!0,total:(null==h||null===(i=h.data)||void 0===i?void 0:i.totalElements)||0});case 15:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),toolBarRender:function(){var e=[(0,ye.jsx)(A.ZP,{type:"primary",icon:(0,ye.jsx)(I.Z,{}),onClick:W,children:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.action.create",defaultMessage:"Create Quick Button"})},"create")];return L.length>0&&e.push((0,ye.jsx)(E.Z,{menu:{items:oe},placement:"bottomRight",children:(0,ye.jsx)(A.ZP,{icon:(0,ye.jsx)(R.Z,{}),children:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.action.batch",defaultMessage:"Batch Actions"})})},"batch")),e},headerTitle:e.formatMessage({id:"quickbutton.list",defaultMessage:"快捷按钮列表"}),tooltip:{title:e.formatMessage({id:"quickbutton.tooltip",defaultMessage:"Create buttons shown above the chat input toolbar."}),placement:"top"},dateFormatter:"string"}),o&&(0,ye.jsx)(Fe,{open:o,isEdit:g,quickbutton:k,onClose:function(){return u(!1)},onSubmit:re})]})},Te=a(42701),Ce=function(e){var t=e.open,a=e.isEdit,r=e.record,s=e.onClose,n=e.onSubmit,o=ce.A.useForm(),u=y()(o,1)[0],l=(0,d.useIntl)(),c=(0,i.useMemo)((function(){return[{label:l.formatMessage({id:"order.status.pending",defaultMessage:"pending"}),value:"pending"},{label:l.formatMessage({id:"order.status.paid",defaultMessage:"paid"}),value:"paid"},{label:l.formatMessage({id:"order.status.shipped",defaultMessage:"shipped"}),value:"shipped"},{label:l.formatMessage({id:"order.status.delivered",defaultMessage:"delivered"}),value:"delivered"}]}),[l]),f=(0,i.useMemo)((function(){var e;return{uid:null==r?void 0:r.uid,title:null==r?void 0:r.title,description:null==r?void 0:r.description,time:null==r?void 0:r.time,status:null==r?void 0:r.status,statusText:null==r?void 0:r.statusText,totalAmount:null==r?void 0:r.totalAmount,paymentMethod:null==r?void 0:r.paymentMethod,extra:null==r?void 0:r.extra,shippingName:null==r?void 0:r.shippingName,shippingPhone:null==r?void 0:r.shippingPhone,shippingAddress:null==r?void 0:r.shippingAddress,goodsUid:null==r?void 0:r.goodsUid,goodsTitle:null==r?void 0:r.goodsTitle,goodsImage:null==r?void 0:r.goodsImage,goodsDescription:null==r?void 0:r.goodsDescription,goodsPrice:null==r?void 0:r.goodsPrice,goodsUrl:null==r?void 0:r.goodsUrl,goodsTagList:null==r||null===(e=r.goodsTagList)||void 0===e?void 0:e.join(","),goodsExtra:null==r?void 0:r.goodsExtra,goodsQuantity:null==r?void 0:r.goodsQuantity}}),[r]);(0,i.useEffect)((function(){t?u.setFieldsValue(f):u.resetFields()}),[u,f,t]);var p=(0,i.useCallback)((function(){u.validateFields().then(function(){var e=x()(b()().mark((function e(t){var a;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a={uid:t.uid,title:(t.title||"").trim(),description:t.description,time:t.time,status:t.status,statusText:t.statusText,totalAmount:t.totalAmount,paymentMethod:t.paymentMethod,extra:t.extra,shippingName:t.shippingName,shippingPhone:t.shippingPhone,shippingAddress:t.shippingAddress,goodsUid:t.goodsUid,goodsTitle:t.goodsTitle,goodsImage:t.goodsImage,goodsDescription:t.goodsDescription,goodsPrice:t.goodsPrice,goodsUrl:t.goodsUrl,goodsTagList:"string"==typeof t.goodsTagList?t.goodsTagList.split(",").map((function(e){return e.trim()})).filter(Boolean):void 0,goodsExtra:t.goodsExtra,goodsQuantity:t.goodsQuantity}).title){e.next=4;break}return j.yw.error(l.formatMessage({id:"order.title.required",defaultMessage:"Please enter a title"})),e.abrupt("return");case 4:return e.next=6,n(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){j.yw.error(l.formatMessage({id:"form.validation.error",defaultMessage:"Please check the form inputs."}))}))}),[u,l,n]);return(0,ye.jsx)(ve.Z,{title:a?l.formatMessage({id:"order.drawer.title.edit",defaultMessage:"Edit Order"}):l.formatMessage({id:"order.drawer.title.create",defaultMessage:"Create Order"}),width:600,open:t,onClose:s,destroyOnHidden:!0,extra:(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{onClick:s,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.cancel",defaultMessage:"Cancel"})}),(0,ye.jsx)(A.ZP,{type:"primary",onClick:p,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.save",defaultMessage:"Save"})})]}),children:(0,ye.jsxs)(ce.A,{form:u,layout:"vertical",submitter:!1,children:[(0,ye.jsx)(pe.Z,{name:"uid",hidden:!0}),(0,ye.jsx)(pe.Z,{name:"title",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.title",defaultMessage:"Title"}),rules:[{required:!0,message:l.formatMessage({id:"order.title.required",defaultMessage:"Please enter a title"})}]}),(0,ye.jsx)(ge.Z,{name:"description",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.description",defaultMessage:"Description"}),fieldProps:{rows:2}}),(0,ye.jsx)(pe.Z,{name:"time",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.time",defaultMessage:"Time"}),fieldProps:{placeholder:l.formatMessage({id:"order.time.placeholder",defaultMessage:"2025-01-01 12:00:00"})}}),(0,ye.jsx)(fe.Z,{name:"status",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.status",defaultMessage:"Status"}),options:c,allowClear:!0}),(0,ye.jsx)(pe.Z,{name:"statusText",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.statusText",defaultMessage:"Status Text"})}),(0,ye.jsx)(Te.Z,{name:"totalAmount",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.totalAmount",defaultMessage:"Total Amount"}),fieldProps:{min:0,precision:2}}),(0,ye.jsx)(pe.Z,{name:"paymentMethod",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.paymentMethod",defaultMessage:"Payment Method"})}),(0,ye.jsx)(ge.Z,{name:"extra",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.extra",defaultMessage:"Extra"}),fieldProps:{rows:3}}),(0,ye.jsx)(pe.Z,{name:"shippingName",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.shipping.name",defaultMessage:"Shipping Name"})}),(0,ye.jsx)(pe.Z,{name:"shippingPhone",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.shipping.phone",defaultMessage:"Shipping Phone"})}),(0,ye.jsx)(ge.Z,{name:"shippingAddress",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.shipping.address",defaultMessage:"Shipping Address"}),fieldProps:{rows:2}}),(0,ye.jsx)(pe.Z,{name:"goodsUid",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.uid",defaultMessage:"Goods UID"})}),(0,ye.jsx)(pe.Z,{name:"goodsTitle",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.title",defaultMessage:"Goods Title"})}),(0,ye.jsx)(pe.Z,{name:"goodsImage",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.image",defaultMessage:"Goods Image"})}),(0,ye.jsx)(ge.Z,{name:"goodsDescription",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.description",defaultMessage:"Goods Description"}),fieldProps:{rows:2}}),(0,ye.jsx)(Te.Z,{name:"goodsPrice",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.price",defaultMessage:"Goods Price"}),fieldProps:{min:0,precision:2}}),(0,ye.jsx)(pe.Z,{name:"goodsUrl",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.url",defaultMessage:"Goods URL"})}),(0,ye.jsx)(pe.Z,{name:"goodsTagList",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.tagList",defaultMessage:"Goods Tags (comma separated)"})}),(0,ye.jsx)(Te.Z,{name:"goodsQuantity",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.quantity",defaultMessage:"Goods Quantity"}),fieldProps:{min:0,precision:0}}),(0,ye.jsx)(ge.Z,{name:"goodsExtra",label:(0,ye.jsx)(d.FormattedMessage,{id:"order.goods.extra",defaultMessage:"Goods Extra"}),fieldProps:{rows:2}})]})})},Ae=["current","pageSize"],Ee=function(){var e=(0,d.useIntl)(),t=(0,i.useRef)(),a=(0,U.u)((function(e){return e.currentOrg})),r=(0,F.Z)().translateString,s=(0,i.useState)(!1),n=y()(s,2),o=n[0],u=n[1],l=(0,i.useState)(!1),f=y()(l,2),g=f[0],m=f[1],h=(0,i.useState)(),v=y()(h,2),M=v[0],k=v[1],q=(0,i.useCallback)((function(){m(!1),k(void 0),u(!0)}),[]),w=(0,i.useCallback)((function(e){m(!0),k(e),u(!0)}),[]),T=(0,i.useCallback)((function(a){var s;P.Z.confirm({title:e.formatMessage({id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),content:r(a.title)||a.title||a.uid,okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),onOk:(s=x()(b()().mark((function r(){var s,n;return b()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ne({uid:a.uid});case 2:200===(s=r.sent).code?(j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null===(n=t.current)||void 0===n||n.reloadAndRest()):j.yw.error(s.message||e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return r.stop()}}),r)}))),function(){return s.apply(this,arguments)})})}),[e,r]),C=(0,i.useMemo)((function(){return[{dataIndex:"index",valueType:"indexBorder"},{title:(0,ye.jsx)(d.FormattedMessage,{id:"order.title",defaultMessage:"Title"}),dataIndex:"title",render:function(e,t){return r(t.title)||t.title||t.uid||"-"},copyable:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"order.status",defaultMessage:"Status"}),dataIndex:"status",width:140},{title:(0,ye.jsx)(d.FormattedMessage,{id:"order.totalAmount",defaultMessage:"Total"}),dataIndex:"totalAmount",valueType:"money",search:!1,width:140},{title:(0,ye.jsx)(d.FormattedMessage,{id:"updatedAt",defaultMessage:"Updated"}),dataIndex:"updatedAt",valueType:"dateTime",search:!1,width:180,sorter:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){return(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{type:"link",size:"small",onClick:function(){return w(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}),(0,ye.jsx)(A.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return T(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.delete",defaultMessage:"Delete"})})]})}}]}),[r]);return(0,i.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[null==a?void 0:a.uid]),(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(S.Z,{columns:C,actionRef:t,rowKey:"uid",cardBordered:!0,search:{labelWidth:"auto"},request:function(){var t=x()(b()().mark((function t(r,s){var n,i,o,u,d,l,f,g,m,h,v,x;return b()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=a&&a.uid){t.next=2;break}return t.abrupt("return",{data:[],success:!0,total:0});case 2:return u=(o=r).current,d=void 0===u?1:u,l=o.pageSize,f=void 0===l?10:l,g=c()(o,Ae),m=s?Object.keys(s)[0]:void 0,h=p()({pageNumber:d-1,pageSize:f,orgUid:a.uid},g),m&&(h.sortBy=m,h.sortDirection="ascend"===s[m]?"ascend":"descend"),t.next=8,$(h);case 8:if(v=t.sent,Ue.Z.debug("OrdersTable queryOrdersByOrg response:",v,h),200===v.code){t.next=13;break}return j.yw.error(v.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),t.abrupt("return",{data:[],success:!1,total:0});case 13:return x=(null==v||null===(n=v.data)||void 0===n?void 0:n.content)||[],t.abrupt("return",{data:x,success:!0,total:(null==v||null===(i=v.data)||void 0===i?void 0:i.totalElements)||0});case 15:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),headerTitle:e.formatMessage({id:"order.list",defaultMessage:"订单列表"}),toolBarRender:function(){return[(0,ye.jsx)(A.ZP,{type:"primary",onClick:q,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.create",defaultMessage:"Create"})},"create")]},dateFormatter:"string"}),o&&(0,ye.jsx)(Ce,{open:o,isEdit:g,record:M,onClose:function(){return u(!1)},onSubmit:function(){var r=x()(b()().mark((function r(s){var n,i,o;return b()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=a&&a.uid){r.next=3;break}return j.yw.error(e.formatMessage({id:"quickbutton.notice.needOrg",defaultMessage:"Please select an organization first."})),r.abrupt("return");case 3:if(n=p()(p()({},s),{},{orgUid:a.uid}),!g){r.next=10;break}return r.next=7,re(n);case 7:r.t0=r.sent,r.next=13;break;case 10:return r.next=12,te(n);case 12:r.t0=r.sent;case 13:200===(i=r.t0).code?(j.yw.success(e.formatMessage({id:g?"update.success":"create.success"})),u(!1),null===(o=t.current)||void 0===o||o.reloadAndRest()):j.yw.error(i.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"}));case 15:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})]})},Oe=function(e){var t=e.open,a=e.isEdit,r=e.record,s=e.onClose,n=e.onSubmit,o=ce.A.useForm(),u=y()(o,1)[0],l=(0,d.useIntl)();(0,i.useEffect)((function(){var e;t?u.setFieldsValue({uid:null==r?void 0:r.uid,title:null==r?void 0:r.title,image:null==r?void 0:r.image,description:null==r?void 0:r.description,price:null==r?void 0:r.price,url:null==r?void 0:r.url,tagList:null==r||null===(e=r.tagList)||void 0===e?void 0:e.join(","),extra:null==r?void 0:r.extra,quantity:null==r?void 0:r.quantity}):u.resetFields()}),[u,t,r]);var c=(0,i.useCallback)((function(){u.validateFields().then(function(){var e=x()(b()().mark((function e(t){var a;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a={uid:t.uid,title:(t.title||"").trim(),image:t.image,description:t.description,price:t.price,url:t.url,tagList:"string"==typeof t.tagList?t.tagList.split(",").map((function(e){return e.trim()})).filter(Boolean):void 0,extra:t.extra,quantity:t.quantity}).title){e.next=4;break}return j.yw.error(l.formatMessage({id:"goods.title.required",defaultMessage:"Please enter a title"})),e.abrupt("return");case 4:return e.next=6,n(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){j.yw.error(l.formatMessage({id:"form.validation.error",defaultMessage:"Please check the form inputs."}))}))}),[u,l,n]);return(0,ye.jsx)(ve.Z,{title:a?l.formatMessage({id:"goods.drawer.title.edit",defaultMessage:"Edit Goods"}):l.formatMessage({id:"goods.drawer.title.create",defaultMessage:"Create Goods"}),width:600,open:t,onClose:s,destroyOnHidden:!0,extra:(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{onClick:s,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.cancel",defaultMessage:"Cancel"})}),(0,ye.jsx)(A.ZP,{type:"primary",onClick:c,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.save",defaultMessage:"Save"})})]}),children:(0,ye.jsxs)(ce.A,{form:u,layout:"vertical",submitter:!1,children:[(0,ye.jsx)(pe.Z,{name:"uid",hidden:!0}),(0,ye.jsx)(pe.Z,{name:"title",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.title",defaultMessage:"Title"}),rules:[{required:!0,message:l.formatMessage({id:"goods.title.required",defaultMessage:"Please enter a title"})}]}),(0,ye.jsx)(pe.Z,{name:"image",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.image",defaultMessage:"Image"})}),(0,ye.jsx)(ge.Z,{name:"description",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.description",defaultMessage:"Description"}),fieldProps:{rows:2}}),(0,ye.jsx)(Te.Z,{name:"price",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.price",defaultMessage:"Price"}),fieldProps:{min:0,precision:2}}),(0,ye.jsx)(pe.Z,{name:"url",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.url",defaultMessage:"URL"})}),(0,ye.jsx)(pe.Z,{name:"tagList",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.tagList",defaultMessage:"Tags (comma separated)"}),fieldProps:{placeholder:l.formatMessage({id:"goods.tagList.placeholder",defaultMessage:"tag1,tag2"})}}),(0,ye.jsx)(Te.Z,{name:"quantity",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.quantity",defaultMessage:"Quantity"}),fieldProps:{min:0,precision:0}}),(0,ye.jsx)(ge.Z,{name:"extra",label:(0,ye.jsx)(d.FormattedMessage,{id:"goods.extra",defaultMessage:"Extra"}),fieldProps:{rows:3}})]})})},De=["current","pageSize"],Qe=function(){var e=(0,d.useIntl)(),t=(0,i.useRef)(),a=(0,U.u)((function(e){return e.currentOrg})),r=(0,F.Z)().translateString,s=(0,i.useState)(!1),n=y()(s,2),o=n[0],u=n[1],l=(0,i.useState)(!1),f=y()(l,2),g=f[0],m=f[1],h=(0,i.useState)(),v=y()(h,2),M=v[0],k=v[1],q=(0,i.useCallback)((function(){m(!1),k(void 0),u(!0)}),[]),w=(0,i.useCallback)((function(e){m(!0),k(e),u(!0)}),[]),T=(0,i.useCallback)((function(a){var s;P.Z.confirm({title:e.formatMessage({id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),content:r(a.title)||a.title||a.uid,okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),onOk:(s=x()(b()().mark((function r(){var s,n;return b()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,K({uid:a.uid});case 2:200===(s=r.sent).code?(j.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null===(n=t.current)||void 0===n||n.reloadAndRest()):j.yw.error(s.message||e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return r.stop()}}),r)}))),function(){return s.apply(this,arguments)})})}),[e,r]),C=(0,i.useMemo)((function(){return[{dataIndex:"index",valueType:"indexBorder"},{title:(0,ye.jsx)(d.FormattedMessage,{id:"goods.title",defaultMessage:"Title"}),dataIndex:"title",render:function(e,t){return r(t.title)||t.title||t.uid||"-"},copyable:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"goods.price",defaultMessage:"Price"}),dataIndex:"price",valueType:"money",search:!1,width:120},{title:(0,ye.jsx)(d.FormattedMessage,{id:"goods.url",defaultMessage:"URL"}),dataIndex:"url",search:!1,render:function(e,t){return t.url?(0,ye.jsx)("a",{href:t.url,target:"_blank",rel:"noreferrer",children:t.url}):"-"},ellipsis:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"updatedAt",defaultMessage:"Updated"}),dataIndex:"updatedAt",valueType:"dateTime",search:!1,width:180,sorter:!0},{title:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){return(0,ye.jsxs)(Z.Z,{children:[(0,ye.jsx)(A.ZP,{type:"link",size:"small",onClick:function(){return w(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}),(0,ye.jsx)(A.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return T(t)},children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.delete",defaultMessage:"Delete"})})]})}}]}),[r]);return(0,i.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[null==a?void 0:a.uid]),(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(S.Z,{columns:C,actionRef:t,rowKey:"uid",cardBordered:!0,search:{labelWidth:"auto"},request:function(){var t=x()(b()().mark((function t(r,s){var n,i,o,u,d,l,f,g,m,h,v,x;return b()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=a&&a.uid){t.next=2;break}return t.abrupt("return",{data:[],success:!0,total:0});case 2:return u=(o=r).current,d=void 0===u?1:u,l=o.pageSize,f=void 0===l?10:l,g=c()(o,De),m=s?Object.keys(s)[0]:void 0,h=p()({pageNumber:d-1,pageSize:f,orgUid:a.uid},g),m&&(h.sortBy=m,h.sortDirection="ascend"===s[m]?"ascend":"descend"),t.next=8,L(h);case 8:if(v=t.sent,Ue.Z.debug("GoodsTable queryGoodsByOrg response:",v,h),200===v.code){t.next=13;break}return j.yw.error(v.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"})),t.abrupt("return",{data:[],success:!1,total:0});case 13:return x=(null==v||null===(n=v.data)||void 0===n?void 0:n.content)||[],t.abrupt("return",{data:x,success:!0,total:(null==v||null===(i=v.data)||void 0===i?void 0:i.totalElements)||0});case 15:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),headerTitle:e.formatMessage({id:"goods.list",defaultMessage:"商品列表"}),toolBarRender:function(){return[(0,ye.jsx)(A.ZP,{type:"primary",onClick:q,children:(0,ye.jsx)(d.FormattedMessage,{id:"pages.common.create",defaultMessage:"Create"})},"create")]},dateFormatter:"string"}),o&&(0,ye.jsx)(Oe,{open:o,isEdit:g,record:M,onClose:function(){return u(!1)},onSubmit:function(){var r=x()(b()().mark((function r(s){var n,i,o;return b()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=a&&a.uid){r.next=3;break}return j.yw.error(e.formatMessage({id:"quickbutton.notice.needOrg",defaultMessage:"Please select an organization first."})),r.abrupt("return");case 3:if(n=p()(p()({},s),{},{orgUid:a.uid}),!g){r.next=10;break}return r.next=7,X(n);case 7:r.t0=r.sent,r.next=13;break;case 10:return r.next=12,z(n);case 12:r.t0=r.sent;case 13:200===(i=r.t0).code?(j.yw.success(e.formatMessage({id:g?"update.success":"create.success"})),u(!1),null===(o=t.current)||void 0===o||o.reloadAndRest()):j.yw.error(i.message||e.formatMessage({id:"request.failed",defaultMessage:"Request failed"}));case 15:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()})]})},Ie=a(27318),Re=o.Z.Content,Ve=function(){var e,t,a,r,i,l,c,f,p=(0,n.Z)().contentStyle,g=(0,d.useAccess)(),m=null!==(e=null==g||null===(t=g.hasAnyModulePermission)||void 0===t?void 0:t.call(g,Ie.MY.QUICK_BUTTON))&&void 0!==e&&e,h=null!==(a=null==g||null===(r=g.hasAnyModulePermission)||void 0===r?void 0:r.call(g,Ie.MY.ORDER))&&void 0!==a&&a,b=null!==(i=null==g||null===(l=g.hasAnyModulePermission)||void 0===l?void 0:l.call(g,Ie.MY.GOODS))&&void 0!==i&&i,v=[].concat(s()(m?[{key:"quickbuttons",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.tab.quickbuttons",defaultMessage:"QuickButton"}),children:(0,ye.jsx)(Ze,{})}]:[]),s()(b?[{key:"goods",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.tab.goods",defaultMessage:"Goods"}),children:(0,ye.jsx)(Qe,{})}]:[]),s()(h?[{key:"orders",label:(0,ye.jsx)(d.FormattedMessage,{id:"quickbutton.tab.orders",defaultMessage:"Orders"}),children:(0,ye.jsx)(Ee,{})}]:[]));if(0===v.length)return null;var x=String(null!==(c=null===(f=v[0])||void 0===f?void 0:f.key)&&void 0!==c?c:"quickbuttons");return(0,ye.jsx)(o.Z,{children:(0,ye.jsx)(Re,{style:p,children:(0,ye.jsx)(u.Z,{defaultActiveKey:x,items:v})})})}}}]);