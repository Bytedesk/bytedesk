"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{59908:function(e,r,t){t.d(r,{Z:function(){return l}});var a=t(77260),s=t(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},n=t(54183),i=function(e,r){return s.createElement(n.Z,(0,a.Z)({},e,{ref:r,icon:o}))};var l=s.forwardRef(i)},59999:function(e,r,t){t.d(r,{Z:function(){return C}});var a=t(39328),s=t(17323),o=t(44194),n=t(32871),i=t(64665),l=t(31549),d=["proFieldProps","fieldProps"],u="date",c=o.forwardRef((function(e,r){var t=e.proFieldProps,c=e.fieldProps,g=(0,s.Z)(e,d),f=(0,o.useContext)(n.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:u,fieldProps:(0,a.Z)({getPopupContainer:f.getPopupContainer},c),proFieldProps:t,filedConfig:{valueType:u,customLightMode:!0}},g))})),g=["proFieldProps","fieldProps"],f="dateMonth",p=o.forwardRef((function(e,r){var t=e.proFieldProps,d=e.fieldProps,u=(0,s.Z)(e,g),c=(0,o.useContext)(n.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:f,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},d),proFieldProps:t,filedConfig:{valueType:f,customLightMode:!0}},u))})),m=["fieldProps"],v="dateQuarter",h=o.forwardRef((function(e,r){var t=e.fieldProps,d=(0,s.Z)(e,m),u=(0,o.useContext)(n.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:v,fieldProps:(0,a.Z)({getPopupContainer:u.getPopupContainer},t),filedConfig:{valueType:v,customLightMode:!0}},d))})),y=["proFieldProps","fieldProps"],M="dateWeek",x=o.forwardRef((function(e,r){var t=e.proFieldProps,d=e.fieldProps,u=(0,s.Z)(e,y),c=(0,o.useContext)(n.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:M,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},d),proFieldProps:t,filedConfig:{valueType:M,customLightMode:!0}},u))})),b=["proFieldProps","fieldProps"],Z="dateYear",w=o.forwardRef((function(e,r){var t=e.proFieldProps,d=e.fieldProps,u=(0,s.Z)(e,b),c=(0,o.useContext)(n.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:Z,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},d),proFieldProps:t,filedConfig:{valueType:Z,customLightMode:!0}},u))})),j=c;j.Week=x,j.Month=p,j.Quarter=h,j.Year=w,j.displayName="ProFormComponent";var C=j},47783:function(e,r,t){var a=t(39328),s=t(17323),o=t(55824),n=t(44194),i=t(32871),l=t(64665),d=t(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],g=function(e,r){var t=e.fieldProps,c=e.children,g=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,y=e.options,M=(0,s.Z)(e,u),x=(0,n.useContext)(i.Z);return(0,d.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:v,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:y,mode:p,showSearch:h,getPopupContainer:x.getPopupContainer},t),ref:r,proFieldProps:f},M),{},{children:c}))},f=n.forwardRef((function(e,r){var t=e.fieldProps,u=e.children,g=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.options,y=(0,s.Z)(e,c),M=(0,a.Z)({options:h,mode:p||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),x=(0,n.useContext)(i.Z);return(0,d.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:v,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:x.getPopupContainer},M),ref:r,proFieldProps:f},y),{},{children:u}))})),p=n.forwardRef(g);p.SearchSelect=f,p.displayName="ProFormComponent",r.Z=p},11137:function(e,r,t){var a=t(39328),s=t(17323),o=t(44194),n=t(64665),i=t(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=o.forwardRef((function(e,r){var t=e.fieldProps,o=e.unCheckedChildren,d=e.checkedChildren,u=e.proFieldProps,c=(0,s.Z)(e,l);return(0,i.jsx)(n.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:o,checkedChildren:d},t),ref:r,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));r.Z=d},92023:function(e,r,t){t.d(r,{G:function(){return f}});var a=t(73193),s=t.n(a),o=(t(44194),t(15435)),n=t(5488),i=t(28977),l=t.n(i),d=t(95660),u=t(5025),c=t(18580),g=t(31549),f=function(e){var r=e.children,t=e.onSuccess,a=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:n.IrL,categoryUid:"",kbUid:"",channel:n.XtJ},f={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(n.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var r=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=r,i.fileType=e.type,d.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var r=e.file.response.data.fileUrl;t(r),u.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,g.jsx)(o.Z,s()(s()({},f),{},{children:r}))}},74424:function(e,r,t){var a=t(24522);r.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},51242:function(e,r,t){t.r(r),t.d(r,{default:function(){return te}});var a=t(74424),s=t(93322),o=t(44194),n=t(73193),i=t.n(n),l=t(84176),d=t.n(l),u=t(90819),c=t.n(u),g=t(89933),f=t.n(g),p=t(45332),m=t.n(p),v=t(5025),h=t(98449),y=t(10162),M=t(81084),x=t(82373),b=t(67652),Z=t(5780),w=t(76711),j=t.n(w),C=t(34599),P=t(32394),S=t(48821),k=t(16331),F=t(11137),D=t(59999),R=t(47783),T=t(20903),I=t(68724),E=t(49616),z=t(78875),Y=t(20228),U=t(45681),L=t(67307),A=t(14870),B=t(92023),O=t(59908),q=t(20467),N=t(28977),H=t.n(N),V=t(31549),W=function(e){var r,t,a,s=e.isEdit,n=e.org,l=e.open,d=e.onClose,u=e.onSubmit,g=T.Z.useForm(),p=m()(g,1)[0],h=(0,A.useIntl)(),y=(0,C.u)((function(e){return e.currentOrg})),M=(0,o.useState)(""),x=m()(M,2),b=x[0],w=x[1],N=(0,o.useState)([]),W=m()(N,2),G=W[0],J=W[1];(0,o.useEffect)((function(){if(s){var e;p.setFieldsValue({name:null==n?void 0:n.name,logo:null==n?void 0:n.logo,code:null==n?void 0:n.code,description:null==n?void 0:n.description,verifiedType:null==n?void 0:n.verifiedType,identityType:null==n?void 0:n.identityType,identityImage:null==n?void 0:n.identityImage,identityNumber:null==n?void 0:n.identityNumber,verifyDate:null==n?void 0:n.verifyDate,verifyStatus:null==n?void 0:n.verifyStatus,rejectReason:null==n?void 0:n.rejectReason,vip:null==n?void 0:n.vip,vipExpireDate:null==n?void 0:n.vipExpireDate,userUid:null==n||null===(e=n.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==n?void 0:n.enabled)})}else{p.resetFields();new Date;var r=H()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");p.setFieldsValue({verifyStatus:"未认证",vip:!0,vipExpireDate:r,enabled:!0})}}),[l]),(0,o.useEffect)((function(){null!=n&&n.logo?w(n.logo):w("")}),[null==n?void 0:n.logo]),(0,o.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||null==y||!y.uid){e.next=4;break}return e.next=3,_();case 3:s&&null!=n&&n.user&&(r={label:"".concat(n.user.nickname||n.user.username," (").concat(n.user.mobile||n.user.email,") - 当前管理员"),value:n.user.uid},J((function(e){return e.some((function(e){return e.value===r.value}))?e:[r].concat(j()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[l,null==y?void 0:y.uid,s,null==n?void 0:n.user]);var K,Q,_=function(){var e=f()(c()().mark((function e(r){var t,a,s,o,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:20,searchText:r||"",orgUid:null==y?void 0:y.uid},console.log("Loading users with params:",a),e.next=5,(0,q.pz)(a);case 5:if(s=e.sent,console.log("loadUsers response:",s),200!==s.code||null===(t=s.data)||void 0===t||!t.content){e.next=15;break}return o=s.data.content.filter((function(e){var r=e.currentOrganization&&e.currentOrganization.uid;return r&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!r})),n=o.map((function(e){return{label:"".concat(e.nickname||e.username," (").concat(e.mobile||e.email,")"),value:e.uid}})),console.log("Total users:",s.data.content.length),console.log("Available users (no organization):",o.length),console.log("Generated user options:",n),J(n),e.abrupt("return",n);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r){return e.apply(this,arguments)}}();return(0,V.jsx)(I.Z,{title:s?(0,V.jsx)(A.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,V.jsx)(A.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:d,open:l,width:600,extra:(0,V.jsxs)(E.Z,{children:[(0,V.jsx)(Z.ZP,{onClick:d,children:(0,V.jsx)(A.FormattedMessage,{id:"pages.common.cancel"})}),(0,V.jsx)(Z.ZP,{onClick:function(){p.validateFields().then((function(e){u(i()(i()(i()({},n),e),{},{logo:b,orgUid:null==y?void 0:y.uid}))})).catch((function(e){console.log("Form errors:",e),v.yw.error(h.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,V.jsx)(A.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,V.jsxs)(P.A,{form:p,submitter:!1,children:[(0,V.jsx)(S.Z,{name:"name",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,V.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,V.jsx)("div",{style:{marginBottom:"8px"},children:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,V.jsxs)(z.Z,{gutter:[16,16],align:"middle",children:[(0,V.jsx)(Y.Z,{children:(0,V.jsx)(U.Z,{src:b,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,V.jsx)(Y.Z,{children:(0,V.jsx)(B.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),w(e),p.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,V.jsx)(Z.ZP,{type:"primary",icon:(0,V.jsx)(O.Z,{}),size:"small",children:h.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,V.jsx)(S.Z,{name:"code",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,V.jsx)(k.Z,{name:"description",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:h.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,V.jsx)(F.Z,{name:"vip",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,V.jsx)(D.Z,{name:"vipExpireDate",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:h.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var r=new Date(e);return r.setHours(0,0,0,0),r.toISOString()}return e}}),(0,V.jsx)(R.Z,{name:"userUid",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:h.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==n||null===(r=n.user)||void 0===r?void 0:r.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(Q=f()(c()().mark((function e(r){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",r),e.next=3,_(r);case 3:case"end":return e.stop()}}),e)}))),function(e){return Q.apply(this,arguments)}),onFocus:(K=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,_();case 3:case"end":return e.stop()}}),e)}))),function(){return K.apply(this,arguments)}),options:G}}),(0,V.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,V.jsx)(F.Z,{name:"enabled",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==n||null===(t=n.user)||void 0===t?void 0:t.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==n?void 0:n.enabled),title:!0===(null==n||null===(a=n.user)||void 0===a?void 0:a.superUser)?h.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,V.jsx)(L.Z,{defaultActiveKey:[],items:[{key:"1",label:"认证信息",children:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(R.Z,{name:"verifiedType",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:[{label:"企业认证",value:"企业认证"},{label:"个人认证",value:"个人认证"},{label:"政府事业单位认证",value:"政府事业单位认证"}],placeholder:h.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,V.jsx)(R.Z,{name:"identityType",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:[{label:"营业执照",value:"营业执照"},{label:"身份证",value:"身份证"},{label:"护照",value:"护照"},{label:"其他",value:"其他"}],placeholder:h.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,V.jsx)(S.Z,{name:"identityImage",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:h.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,V.jsx)(S.Z,{name:"identityNumber",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:h.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,V.jsx)(S.Z,{name:"verifyDate",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:h.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请输入认证时间"})}),(0,V.jsx)(R.Z,{name:"verifyStatus",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:[{label:"未认证",value:"未认证"},{label:"已认证",value:"已认证"},{label:"审核中",value:"审核中"},{label:"审核失败",value:"审核失败"}],placeholder:h.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,V.jsx)(k.Z,{name:"rejectReason",label:(0,V.jsx)(A.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:h.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},G=t(8065),J=t(14383),K=t(18751),Q=t(5488),_=t(82615),X=t(13775),$=["current","pageSize"],ee=function(){var e=(0,A.useIntl)(),r=(0,o.useRef)(),t=(0,K.Z)().translateString,a=(0,o.useState)(!0),s=m()(a,2),n=s[0],l=s[1],u=(0,o.useState)(),g=m()(u,2),p=g[0],w=g[1],j=(0,o.useState)(!1),P=m()(j,2),S=P[0],k=P[1],F=(0,o.useState)(1),D=m()(F,2),R=(D[0],D[1]),T=(0,o.useState)(10),I=m()(T,2),E=I[0],z=I[1],Y=(0,C.u)((function(e){return e.currentOrg})),U=(0,J.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),L=U.setRoleResult,B=U.setRoleResultPlatform,O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,r){return r.logo?(0,V.jsx)("img",{src:r.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,r){return(0,X._i)(r.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,r){return(0,X.Cy)(r.verifyStatus)}},{title:e.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,r){return r.verifyDate?H()(r.verifyDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(r,t){return t.vip?e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,r){return r.vipExpireDate?H()(r.vipExpireDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(r,t){return!1===t.enabled?e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,r){return r.user?(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{children:r.user.nickname||r.user.username}),(0,V.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:r.user.email})]}):"-"}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.createdAt?H()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.updatedAt?H()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],q=[].concat(O,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(r,t,a,s){var n,i=!0===(null===(n=t.user)||void 0===n?void 0:n.superUser);return[(0,V.jsx)("a",{onClick:function(){re(t)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,V.jsxs)(o.Fragment,{children:[(0,V.jsx)(x.Z,{type:"vertical"},"divider"),(0,V.jsx)(b.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:t.name||t.code}),onConfirm:function(){return te(t)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,V.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),N=(0,G.v)((function(e){return e.currentCategory})),ee=function(){w(void 0),l(!1),k(!0)},re=function(e){w(e),l(!0),k(!0)},te=function(){var a=f()(c()().mark((function a(s){var o,n,i;return c()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!0!==(null===(o=s.user)||void 0===o?void 0:o.superUser)){a.next=3;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),a.abrupt("return");case 3:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),a.prev=4,a.next=7,(0,_.FR)({uid:s.uid});case 7:n=a.sent,v.yw.destroy(),200===n.code?(v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=r.current)||void 0===i||i.reloadAndRest()):v.yw.error(t(n.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(4),v.yw.destroy(),v.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",a.t0);case 17:case"end":return a.stop()}}),a,null,[[4,12]])})));return function(e){return a.apply(this,arguments)}}(),ae=function(){var t=f()(c()().mark((function t(a){var s,o,i;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",a),!n||!0!==(null==p||null===(s=p.user)||void 0===s?void 0:s.superUser)||!1!==a.enabled){t.next=4;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),t.abrupt("return");case 4:if(n?v.yw.loading(e.formatMessage({id:"updating"})):v.yw.loading(e.formatMessage({id:"creating"})),!n){t.next=11;break}return t.next=8,(0,_.jM)(a);case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,(0,_.c5)(a);case 13:t.t0=t.sent;case 14:o=t.t0,console.log("createOrg response:",a,o),200===o.code?(v.yw.destroy(),v.yw.success(n?e.formatMessage({id:"update.success",defaultMessage:"Update successful"}):e.formatMessage({id:"create.success",defaultMessage:"Create successful"})),k(!1),null===(i=r.current)||void 0===i||i.reloadAndRest()):(v.yw.destroy(),v.yw.error(o.message));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),se=function(){var r=f()(c()().mark((function r(){var t,a;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,orgUid:null==Y?void 0:Y.uid},r.next=4,(0,h.E9)(t);case 4:a=r.sent,console.log("queryRolesByOrg response ",a),200===a.code?(v.yw.destroy(),L(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),oe=function(){var r=f()(c()().mark((function r(){var t,a;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,level:Q.Hxq},r.next=4,(0,h.E9)(t);case 4:a=r.sent,console.log("queryRolesBySuper response ",a),200===a.code?(v.yw.destroy(),B(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return(0,o.useEffect)((function(){se(),oe()}),[]),(0,o.useEffect)((function(){var e;console.log("currentCategory:",N),null===(e=r.current)||void 0===e||e.reloadAndRest()}),[N]),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(M.Z,{columns:q,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var r=f()(c()().mark((function r(a,s,o){var n,l,u,g,f;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("request:",a,s,o),v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n=a.current,l=a.pageSize,u=d()(a,$),R(n),z(l),g=i()({pageNumber:n-1,pageSize:l},u),r.next=8,(0,_.A8)(g);case 8:return f=r.sent,console.log("getAllOrgs response:",g,f),v.yw.destroy(),200===f.code||v.yw.error(t(f.message)),r.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 13:case"end":return r.stop()}}),r)})));return function(e,t,a){return r.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:E,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,r){console.log("pagination onChange:",e,r),R(e),z(r)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,V.jsx)(Z.ZP,{icon:(0,V.jsx)(y.Z,{}),type:"primary",onClick:ee,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),S&&(0,V.jsx)(W,{isEdit:n,open:S,org:p,onClose:function(){k(!1)},onSubmit:ae})]})},re=s.Z.Content,te=function(){var e=(0,a.Z)().contentStyle;return(0,V.jsx)(s.Z,{children:(0,V.jsx)(s.Z,{children:(0,V.jsx)(re,{style:e,children:(0,V.jsx)(ee,{})})})})}},8065:function(e,r,t){t.d(r,{v:function(){return g}});var a=t(73193),s=t.n(a),o=t(76711),n=t.n(o),i=t(5488),l=t(16894),d=t(45034),u=t(47401),c=t(95660);var g=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,u.n)((function(e,r){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(r){var t=function(e){var r=[];return e.data.content.forEach((function(e){var t={label:e.name,value:e.uid};r.push(t)})),r}(r),a=function(e){var r,t=(null==e||null===(r=e.data)||void 0===r?void 0:r.content)||[],a=function e(r){var t={title:r.name||"",key:r.uid||""};return r.children&&r.children.length>0&&(t.children=r.children.map((function(r){return e(r)}))),t};return t.filter((function(e){return e&&e.uid&&e.uid!==i.zBg})).map((function(e){return a(e)}))}(r),o=[{title:i.zBg,key:i.zBg}].concat(n()(a)),l={uid:i.zBg,name:i.zBg},d=s()(s()({},r),{},{data:s()(s()({},r.data),{},{content:[l].concat(n()(r.data.content))})});e({categoryResult:d,categoryTreeOptions:o,categorySelectOptions:t}),0===r.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(r){e((function(e){e.categoryResult.data.content.unshift(r)}))},upgradeCategory:function(r){e((function(e){var t=e.categoryResult.data.content,a=t.findIndex((function(e){return e.uid===r.uid}));-1!==a?t[a]=r:console.warn("Category with uid ".concat(r.uid," not found."))}))},setCurrentCategory:function(r){e({currentCategory:r})},resetDefaultCategory:function(){c.Z.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(t){var a=r().categoryResult.data.content.find((function(e){return e.uid===t}));e({currentCategory:a})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);