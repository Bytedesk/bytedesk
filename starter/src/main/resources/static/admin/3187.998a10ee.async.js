"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3187],{59908:function(e,l,t){t.d(l,{Z:function(){return i}});var n=t(83910),a=t(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=t(54183),s=function(e,l){return a.createElement(o.Z,(0,n.Z)({},e,{ref:l,icon:r}))};var i=a.forwardRef(s)},43187:function(e,l,t){t.d(l,{Z:function(){return ne}});var n=t(73193),a=t.n(n),r=t(10154),o=t.n(r),s=t(90819),i=t.n(s),d=t(89933),u=t.n(d),c=t(45332),p=t.n(c),m=t(44194),f=t(14906),v=t(89246),g=t(33797),h=t(81739),b=t(63649),M=t(82770),x=t(19433),y=t(75580),k=t(68790),w=t(7704),S=t(98830),j=t(39497),T=t(75864),C=t(89965),E=t(80953),P=t(25784),Z=t(42491),I=t(2250),U=t(94433),K=t(38956),L=t(35074),R=t(31549),A=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],W=m.forwardRef((function(e,l){var t=e.fieldProps,n=e.proFieldProps,a=e.min,r=e.max,o=e.step,s=e.marks,i=e.vertical,d=e.range,u=(0,K.Z)(e,A);return(0,R.jsx)(L.Z,(0,U.Z)({valueType:"slider",fieldProps:(0,U.Z)((0,U.Z)({},t),{},{min:a,max:r,step:o,marks:s,vertical:i,range:d,style:null==t?void 0:t.style}),ref:l,proFieldProps:n,filedConfig:{ignoreWidth:!0}},u))})),F=t(88894),N=t(25197),z=t(83001),D=t(39487),O=t(13847),Q=t(41196),B=t(40110),V=t(70635),G=t(10162),q=t(59908),H=t(2011),_=t(48880),J=z.Z.Text,$=function(e){var l=e.value,t=e.onChange,n=e.options,a=e.loading,r=e.placeholder,o=e.emptyContent,s=e.onSearch,i=e.onDropdownOpen,d=e.onCreate,u=e.createLabel,c=e.createTitle;return(0,R.jsxs)(D.Z.Compact,{block:!0,children:[(0,R.jsx)(O.Z,{value:l,onChange:function(e){return null==t?void 0:t(e)},options:n,showSearch:!0,filterOption:!1,placeholder:r,loading:a,allowClear:!0,style:{flex:1},notFoundContent:o,onSearch:s,onOpenChange:function(e){e&&i()}}),(0,R.jsx)(M.ZP,{size:"small",icon:(0,R.jsx)(G.Z,{}),onClick:d,title:c,children:u})]})},X=function(e){var l,t,n,r,s,d,c,v,h,b,U,K,L,A,z,D,O,X,Y,ee,le,te,ne,ae,re,oe,se=e.open,ie=e.record,de=e.onClose,ue=e.onSuccess,ce=(0,f.useIntl)(),pe=(0,S.u)((function(e){return e.currentOrg})),me=(0,m.useMemo)((function(){return!(null==ie||!ie.uid)}),[ie]),fe=(0,m.useState)(!1),ve=p()(fe,2),ge=ve[0],he=ve[1],be=(0,m.useState)([]),Me=p()(be,2),xe=Me[0],ye=Me[1],ke=(0,m.useState)(!1),we=p()(ke,2),Se=we[0],je=we[1],Te=(0,m.useRef)(),Ce=(0,m.useState)((null==ie?void 0:ie.avatar)||""),Ee=p()(Ce,2),Pe=Ee[0],Ze=Ee[1],Ie=(0,m.useState)((null==ie?void 0:ie.type)||j.f4h),Ue=p()(Ie,2),Ke=Ue[0],Le=Ue[1],Re=(0,m.useState)((null==ie?void 0:ie.system)||!1),Ae=p()(Re,2),We=Ae[0],Fe=Ae[1],Ne=(0,m.useState)([]),ze=p()(Ne,2),De=ze[0],Oe=ze[1],Qe=(0,m.useState)({}),Be=p()(Qe,2),Ve=Be[0],Ge=Be[1],qe=(0,m.useState)(!1),He=p()(qe,2),_e=He[0],Je=He[1],$e=(0,m.useState)(""),Xe=p()($e,2),Ye=Xe[0],el=Xe[1],ll=(0,m.useState)(""),tl=p()(ll,2),nl=tl[0],al=tl[1],rl=(0,m.useState)(""),ol=p()(rl,2),sl=ol[0],il=ol[1],dl=(0,m.useState)(""),ul=p()(dl,2),cl=ul[0],pl=ul[1],ml=(0,m.useState)(!(null==ie||null===(l=ie.llm)||void 0===l||!l.enabled)),fl=p()(ml,2),vl=fl[0],gl=fl[1],hl=(0,m.useState)(!(null==ie||!ie.kbEnabled)),bl=p()(hl,2),Ml=bl[0],xl=bl[1],yl=(0,m.useState)(!(null==ie||null===(t=ie.llm)||void 0===t||!t.useLlmWhenKbEmpty)),kl=p()(yl,2),wl=kl[0],Sl=kl[1],jl=(0,m.useState)(!1),Tl=p()(jl,2),Cl=Tl[0],El=Tl[1],Pl=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),Zl=(0,m.useCallback)((function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(l):"-"}),[]),Il=(0,m.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),Ul=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),Kl=(0,m.useState)(null==ie||null===(n=ie.llm)||void 0===n?void 0:n.temperature),Ll=p()(Kl,2),Rl=Ll[0],Al=Ll[1],Wl=(0,m.useState)(Pl(null==ie||null===(r=ie.llm)||void 0===r?void 0:r.topP)),Fl=p()(Wl,2),Nl=Fl[0],zl=Fl[1],Dl=(0,m.useState)(null==ie||null===(s=ie.llm)||void 0===s?void 0:s.topK),Ol=p()(Dl,2),Ql=Ol[0],Bl=Ol[1],Vl=(0,m.useState)(Pl(null==ie||null===(d=ie.llm)||void 0===d?void 0:d.scoreThreshold)),Gl=p()(Vl,2),ql=Gl[0],Hl=Gl[1],_l=(0,m.useState)(null==ie||null===(c=ie.llm)||void 0===c?void 0:c.maxTokens),Jl=p()(_l,2),$l=(Jl[0],Jl[1]),Xl=(0,m.useState)(null==ie||null===(v=ie.llm)||void 0===v?void 0:v.contextMsgCount),Yl=p()(Xl,2),et=(Yl[0],Yl[1]),lt=(0,m.useCallback)(function(){var e=u()(i()().mark((function e(l){var t,n,a,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(je(!0),e.prev=1,null!=pe&&pe.uid){e.next=5;break}return ye([]),e.abrupt("return",[]);case 5:return n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==pe?void 0:pe.uid,searchText:l||""},e.next=8,(0,F.VW)(n);case 8:return a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],ye(r),e.abrupt("return",r);case 12:return e.prev=12,je(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(l){return e.apply(this,arguments)}}(),[null==pe?void 0:pe.uid]);(0,m.useEffect)((function(){var e,l,t,n,a,r,o,s,i,d,u,c,p,m,f,v,g,h,b,M,x,y,k,w,S,T,C,E;if(se){var P,Z,I;if(Ze((null==ie?void 0:ie.avatar)||""),Le((null==ie?void 0:ie.type)||j.f4h),Fe((null==ie?void 0:ie.system)||!1),gl(!(null==ie||null===(e=ie.llm)||void 0===e||!e.enabled)),xl(!(null==ie||!ie.kbEnabled)),Sl(!(null==ie||null===(l=ie.llm)||void 0===l||!l.useLlmWhenKbEmpty)),null===(t=Te.current)||void 0===t||t.setFieldsValue({nickname:null==ie?void 0:ie.nickname,type:null==ie?void 0:ie.type,settingsUid:null==ie||null===(n=ie.settings)||void 0===n?void 0:n.uid,name:null==ie?void 0:ie.name,categoryUid:null==ie?void 0:ie.categoryUid,provider:null==ie||null===(a=ie.llm)||void 0===a?void 0:a.textProvider,model:null==ie||null===(r=ie.llm)||void 0===r?void 0:r.textModel,prompt:null==ie||null===(o=ie.llm)||void 0===o?void 0:o.prompt,description:null==ie?void 0:ie.description,enabled:null==ie||null===(s=ie.llm)||void 0===s?void 0:s.enabled,enableThinking:null==ie||null===(i=ie.llm)||void 0===i?void 0:i.enableThinking,enableStreaming:null==ie||null===(d=ie.llm)||void 0===d?void 0:d.enableStreaming,useLlmWhenKbEmpty:null==ie||null===(u=ie.llm)||void 0===u?void 0:u.useLlmWhenKbEmpty,temperature:Ul(null==ie||null===(c=ie.llm)||void 0===c?void 0:c.temperature),topP:Pl(null==ie||null===(p=ie.llm)||void 0===p?void 0:p.topP),topK:null==ie||null===(m=ie.llm)||void 0===m?void 0:m.topK,scoreThreshold:Pl(null==ie||null===(f=ie.llm)||void 0===f?void 0:f.scoreThreshold),maxTokens:null==ie||null===(v=ie.llm)||void 0===v?void 0:v.maxTokens,contextMsgCount:null==ie||null===(g=ie.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==ie||null===(h=ie.llm)||void 0===h?void 0:h.defaultReply,searchType:(null==ie||null===(b=ie.llm)||void 0===b?void 0:b.searchType)||j.rk3,kbSourceEnabled:null==ie?void 0:ie.kbSourceEnabled,kbEnabled:null==ie?void 0:ie.kbEnabled,kbUid:null==ie?void 0:ie.kbUid}),null!=ie&&ie.llm&&(null!=ie&&null!==(M=ie.llm)&&void 0!==M&&M.textProviderUid||null!=ie&&null!==(x=ie.llm)&&void 0!==x&&x.textProvider||null!=ie&&null!==(y=ie.llm)&&void 0!==y&&y.textModel))el((null==ie||null===(P=ie.llm)||void 0===P?void 0:P.textProvider)||""),al((null==ie||null===(Z=ie.llm)||void 0===Z?void 0:Z.textProviderUid)||""),il((null==ie||null===(I=ie.llm)||void 0===I?void 0:I.textModel)||"");else el(""),al(""),il("");Al(Ul(null==ie||null===(k=ie.llm)||void 0===k?void 0:k.temperature)),zl(Pl(null==ie||null===(w=ie.llm)||void 0===w?void 0:w.topP)),Bl(null==ie||null===(S=ie.llm)||void 0===S?void 0:S.topK),Hl(Pl(null==ie||null===(T=ie.llm)||void 0===T?void 0:T.scoreThreshold)),$l(null==ie||null===(C=ie.llm)||void 0===C?void 0:C.maxTokens),et(null==ie||null===(E=ie.llm)||void 0===E?void 0:E.contextMsgCount),El(!1)}}),[se,ie]);var tt=function(){var e=u()(i()().mark((function e(l){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ze(l),!me||!ie){e.next=13;break}return e.prev=2,t={uid:null==ie?void 0:ie.uid,avatar:l},e.next=6,(0,y.lz)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?(x.yw.success(ce.formatMessage({id:"update.success",defaultMessage:"更新成功"})),null==ue||ue(n.data)):x.yw.error((null==n?void 0:n.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),x.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(l){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){se&&Ke===j.f4h&&lt()}),[se,Ke,lt]);var nt=(0,m.useMemo)((function(){return xe.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[xe]),at=(0,m.useRef)(),rt=(0,m.useCallback)((function(e){at.current&&clearTimeout(at.current),at.current=setTimeout((function(){lt(e)}),300)}),[lt]);(0,m.useEffect)((function(){return function(){at.current&&clearTimeout(at.current)}}),[]);var ot=(0,m.useCallback)((function(){xe.length||lt()}),[xe.length,lt]),st=(0,m.useCallback)(u()(i()().mark((function e(){var l,t,n,a,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==pe?void 0:pe.uid,level:j.whQ},e.next=4,(0,k.mK)(l);case 4:200===(null==(t=e.sent)?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],Oe(a),nl&&!Ye&&(r=a.find((function(e){return e.uid===nl})))&&el(r.type),!nl&&Ye&&(o=a.find((function(e){return e.type===Ye})))&&al(o.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==pe?void 0:pe.uid,nl,Ye]);(0,m.useEffect)((function(){se&&st()}),[se,st]);var it=(0,m.useCallback)((function(){return Je(!0)}),[]),dt=(0,m.useCallback)((function(){return Je(!1)}),[]),ut=(0,m.useCallback)((function(e,l){Ge((function(t){return a()(a()({},t),{},o()({},e,l))}))}),[]),ct=(0,m.useCallback)((function(e,l,t){var n,a,r,o=De.find((function(l){return l.uid===e})),s=o?o.type:e;el(s),al(e),il(l),pl(t),null===(n=Te.current)||void 0===n||n.setFieldsValue({provider:s,model:l});var i=null===(a=Te.current)||void 0===a||null===(r=a.getFieldsValue)||void 0===r?void 0:r.call(a);if(i){var d,u,c,p,m,f,v,g,h,b,M,x,y,k,w,S,j,T,C,E,P,Z,I,U=(null==ie?void 0:ie.llm)||{},K=(null!==(d=i.prompt)&&void 0!==d?d:"")!==(null!==(u=U.prompt)&&void 0!==u?u:"")||(e||"")!==(null!==(c=U.textProviderUid)&&void 0!==c?c:"")||(s||i.provider||"")!==(null!==(p=U.textProvider)&&void 0!==p?p:"")||(l||i.model||"")!==(null!==(m=U.textModel)&&void 0!==m?m:"")||!!i.enabled!=!!U.enabled||!!i.enableThinking!=!!U.enableThinking||!!i.enableStreaming!=!!U.enableStreaming||!!i.useLlmWhenKbEmpty!=!!U.useLlmWhenKbEmpty||(null!==(f=i.temperature)&&void 0!==f?f:null)!==(null!==(v=U.temperature)&&void 0!==v?v:null)||(null!==(g=i.topP)&&void 0!==g?g:null)!==(null!==(h=U.topP)&&void 0!==h?h:null)||(null!==(b=i.topK)&&void 0!==b?b:null)!==(null!==(M=U.topK)&&void 0!==M?M:null)||(null!==(x=i.scoreThreshold)&&void 0!==x?x:null)!==(null!==(y=U.scoreThreshold)&&void 0!==y?y:null)||(null!==(k=i.maxTokens)&&void 0!==k?k:null)!==(null!==(w=U.maxTokens)&&void 0!==w?w:null)||(null!==(S=i.contextMsgCount)&&void 0!==S?S:null)!==(null!==(j=U.contextMsgCount)&&void 0!==j?j:null)||(null!==(T=i.defaultReply)&&void 0!==T?T:"")!==(null!==(C=U.defaultReply)&&void 0!==C?C:"")||(null!==(E=i.searchType)&&void 0!==E?E:"")!==(null!==(P=U.searchType)&&void 0!==P?P:""),L=!!i.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!i.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(Z=i.kbUid)&&void 0!==Z?Z:"")!==(null!==(I=null==ie?void 0:ie.kbUid)&&void 0!==I?I:"");El(K||L)}Je(!1)}),[De]);return(0,R.jsxs)(T.a,{onValuesChange:function(e,l){var t,n,a,r,o,s,i,d,u,c,p,m,f,v,g,h,b,M,x,y,k,w,S,j=(null==ie?void 0:ie.llm)||{},T=(null!==(t=l.prompt)&&void 0!==t?t:"")!==(null!==(n=j.prompt)&&void 0!==n?n:"")||(nl||"")!==(null!==(a=j.textProviderUid)&&void 0!==a?a:"")||(Ye||l.provider||"")!==(null!==(r=j.textProvider)&&void 0!==r?r:"")||(sl||l.model||"")!==(null!==(o=j.textModel)&&void 0!==o?o:"")||!!l.enabled!=!!j.enabled||!!l.enableThinking!=!!j.enableThinking||!!l.enableStreaming!=!!j.enableStreaming||!!l.useLlmWhenKbEmpty!=!!j.useLlmWhenKbEmpty||(null!==(s=l.temperature)&&void 0!==s?s:null)!==(null!==(i=j.temperature)&&void 0!==i?i:null)||(null!==(d=l.topP)&&void 0!==d?d:null)!==(null!==(u=j.topP)&&void 0!==u?u:null)||(null!==(c=l.topK)&&void 0!==c?c:null)!==(null!==(p=j.topK)&&void 0!==p?p:null)||(null!==(m=l.scoreThreshold)&&void 0!==m?m:null)!==(null!==(f=j.scoreThreshold)&&void 0!==f?f:null)||(null!==(v=l.maxTokens)&&void 0!==v?v:null)!==(null!==(g=j.maxTokens)&&void 0!==g?g:null)||(null!==(h=l.contextMsgCount)&&void 0!==h?h:null)!==(null!==(b=j.contextMsgCount)&&void 0!==b?b:null)||(null!==(M=l.defaultReply)&&void 0!==M?M:"")!==(null!==(x=j.defaultReply)&&void 0!==x?x:"")||(null!==(y=l.searchType)&&void 0!==y?y:"")!==(null!==(k=j.searchType)&&void 0!==k?k:""),C=!!l.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!l.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(w=l.kbUid)&&void 0!==w?w:"")!==(null!==(S=null==ie?void 0:ie.kbUid)&&void 0!==S?S:"");El(T||C)},open:se,onOpenChange:function(e){e||de()},title:ce.formatMessage({id:"robot.edit",defaultMessage:"编辑机器人"}),width:560,formRef:Te,initialValues:me?{nickname:null==ie?void 0:ie.nickname,type:null==ie?void 0:ie.type,settingsUid:null==ie||null===(h=ie.settings)||void 0===h?void 0:h.uid,name:null==ie?void 0:ie.name,categoryUid:null==ie?void 0:ie.categoryUid,provider:null==ie||null===(b=ie.llm)||void 0===b?void 0:b.textProvider,model:null==ie||null===(U=ie.llm)||void 0===U?void 0:U.textModel,prompt:null==ie||null===(K=ie.llm)||void 0===K?void 0:K.prompt,description:null==ie?void 0:ie.description,enabled:null==ie||null===(L=ie.llm)||void 0===L?void 0:L.enabled,enableThinking:null==ie||null===(A=ie.llm)||void 0===A?void 0:A.enableThinking,enableStreaming:null==ie||null===(z=ie.llm)||void 0===z?void 0:z.enableStreaming,useLlmWhenKbEmpty:null==ie||null===(D=ie.llm)||void 0===D?void 0:D.useLlmWhenKbEmpty,temperature:Ul(null==ie||null===(O=ie.llm)||void 0===O?void 0:O.temperature),topP:Pl(null==ie||null===(X=ie.llm)||void 0===X?void 0:X.topP),topK:null==ie||null===(Y=ie.llm)||void 0===Y?void 0:Y.topK,scoreThreshold:Pl(null==ie||null===(ee=ie.llm)||void 0===ee?void 0:ee.scoreThreshold),maxTokens:null==ie||null===(le=ie.llm)||void 0===le?void 0:le.maxTokens,contextMsgCount:null==ie||null===(te=ie.llm)||void 0===te?void 0:te.contextMsgCount,defaultReply:null==ie||null===(ne=ie.llm)||void 0===ne?void 0:ne.defaultReply,searchType:(null==ie||null===(ae=ie.llm)||void 0===ae?void 0:ae.searchType)||j.rk3,kbSourceEnabled:null==ie?void 0:ie.kbSourceEnabled,kbEnabled:null==ie?void 0:ie.kbEnabled,kbUid:null==ie?void 0:ie.kbUid}:{type:j.f4h,searchType:j.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,R.jsxs)("div",{children:[(0,R.jsx)(M.ZP,{style:{marginRight:8},onClick:function(){return de()},children:ce.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,R.jsx)(M.ZP,{type:"primary",onClick:function(){var e,l;return null===(e=Te.current)||void 0===e||null===(l=e.submit)||void 0===l?void 0:l.call(e)},children:ce.formatMessage({id:"save",defaultMessage:"保存"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=u()(i()().mark((function e(l){var t,n,a,r,o,s,d,u,c,p,m,f,v,g,h,b,M,k,w,S,T,C,E,P,Z,I,U,K,L,R,A;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,me&&null!=ie&&ie.uid){e.next=4;break}return x.yw.warning(ce.formatMessage({id:"robot.edit.only",defaultMessage:"当前仅支持编辑，请通过新建入口创建机器人"})),e.abrupt("return",!1);case 4:return Z=(null==ie?void 0:ie.llm)||{},I=(null!==(t=l.prompt)&&void 0!==t?t:"")!==(null!==(n=Z.prompt)&&void 0!==n?n:"")||(nl||"")!==(null!==(a=Z.textProviderUid)&&void 0!==a?a:"")||(Ye||l.provider||"")!==(null!==(r=Z.textProvider)&&void 0!==r?r:"")||(sl||l.model||"")!==(null!==(o=Z.textModel)&&void 0!==o?o:"")||!!l.enabled!=!!Z.enabled||!!l.enableThinking!=!!Z.enableThinking||!!l.enableStreaming!=!!Z.enableStreaming||!!l.useLlmWhenKbEmpty!=!!Z.useLlmWhenKbEmpty||(null!==(s=l.temperature)&&void 0!==s?s:null)!==(null!==(d=Z.temperature)&&void 0!==d?d:null)||(null!==(u=l.topP)&&void 0!==u?u:null)!==(null!==(c=Z.topP)&&void 0!==c?c:null)||(null!==(p=l.topK)&&void 0!==p?p:null)!==(null!==(m=Z.topK)&&void 0!==m?m:null)||(null!==(f=l.scoreThreshold)&&void 0!==f?f:null)!==(null!==(v=Z.scoreThreshold)&&void 0!==v?v:null)||(null!==(g=l.maxTokens)&&void 0!==g?g:null)!==(null!==(h=Z.maxTokens)&&void 0!==h?h:null)||(null!==(b=l.contextMsgCount)&&void 0!==b?b:null)!==(null!==(M=Z.contextMsgCount)&&void 0!==M?M:null)||(null!==(k=l.defaultReply)&&void 0!==k?k:"")!==(null!==(w=Z.defaultReply)&&void 0!==w?w:"")||(null!==(S=l.searchType)&&void 0!==S?S:"")!==(null!==(T=Z.searchType)&&void 0!==T?T:""),U=!!l.kbEnabled!=!(null==ie||!ie.kbEnabled)||!!l.kbSourceEnabled!=!(null==ie||!ie.kbSourceEnabled)||(null!==(C=l.kbUid)&&void 0!==C?C:"")!==(null!==(E=null==ie?void 0:ie.kbUid)&&void 0!==E?E:""),K=I||U,x.yw.loading(ce.formatMessage({id:me?"updating":"creating",defaultMessage:me?"Updating":"Creating"})),R={uid:null==ie?void 0:ie.uid,nickname:l.nickname,name:l.name,type:l.type||j.f4h,description:l.description,avatar:Pe,settingsUid:l.settingsUid,kbSourceEnabled:l.kbSourceEnabled,kbEnabled:l.kbEnabled,kbUid:l.kbUid,llm:{prompt:l.prompt,textProvider:Ye||l.provider,textProviderUid:nl||void 0,textModel:sl||l.model,enabled:l.enabled,enableThinking:l.enableThinking,enableStreaming:l.enableStreaming,useLlmWhenKbEmpty:l.useLlmWhenKbEmpty,temperature:Ul(l.temperature),topP:Pl(l.topP),topK:l.topK,scoreThreshold:Pl(l.scoreThreshold),maxTokens:l.maxTokens,contextMsgCount:l.contextMsgCount,defaultReply:l.defaultReply,searchType:l.searchType}},e.next=12,(0,y.$l)(R);case 12:if(L=e.sent,console.log("updateRobot:",L,R),x.yw.destroy(),200!==(null===(P=L)||void 0===P?void 0:P.code)){e.next=23;break}return x.yw.success(ce.formatMessage({id:"save.success",defaultMessage:"保存成功"})),K&&x.yw.info(ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),5),null==ue||ue(L.data),de(),e.abrupt("return",!0);case 23:return x.yw.error((null===(A=L)||void 0===A?void 0:A.message)||ce.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),x.yw.destroy(),x.yw.error(ce.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(l){return e.apply(this,arguments)}}(),children:[(0,R.jsx)(Q.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:ce.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"头像"}),children:(0,R.jsxs)(H.G,{onSuccess:tt,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,R.jsx)(g.Z,{src:Pe}),(0,R.jsx)(M.ZP,{icon:(0,R.jsx)(q.Z,{}),style:{marginLeft:12},children:ce.formatMessage({id:"pages.robot.upload",defaultMessage:"上传"})})]},"avatar")}),Ke===j.Qeb&&We&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(C.Z,{name:"name",hidden:!0,label:ce.formatMessage({id:"name",defaultMessage:"名称"}),fieldProps:{placeholder:We&&Ke===j.Qeb?ce.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.placeholder",defaultMessage:"系统代理不可修改名称"}):void 0},disabled:We&&Ke===j.Qeb}),(0,R.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:-20,marginBottom:10},children:ce.formatMessage({id:"pages.prompt.systemAgent.nameReadonly.tip",defaultMessage:"系统内置代理，无法修改名称"})})]}),(0,R.jsx)(C.Z,{name:"nickname",label:ce.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:ce.formatMessage({id:"nickname",defaultMessage:"昵称"})}]}),(0,R.jsx)(E.Z,{name:"description",label:ce.formatMessage({id:"description",defaultMessage:"描述"})}),Ke===j.f4h&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(P.A.Item,{name:"settingsUid",label:ce.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),rules:[{required:!0,message:ce.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,R.jsx)($,{options:nt,loading:Se,placeholder:ce.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),emptyContent:0===nt.length?(0,R.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,R.jsx)("div",{style:{marginBottom:8,color:"#999"},children:ce.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,R.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,R.jsx)(G.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return he(!0)},children:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:rt,onDropdownOpen:ot,onCreate:function(){return he(!0)},createLabel:ce.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:ce.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})})}),(0,R.jsx)(Z.Z,{name:"enabled",label:ce.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),fieldProps:{onChange:function(e){return gl(e)}}}),vl&&(0,R.jsxs)(m.Fragment,{children:[(0,R.jsxs)("div",{children:[(0,R.jsx)(J,{style:{marginBottom:8,display:"block"},children:ce.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"文字对话模型提供商"})}),(0,R.jsx)(B.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:it,children:(nl||Ye)&&sl?(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,R.jsxs)("div",{children:[(0,R.jsx)(J,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"供应商："})}),(0,R.jsx)(J,{strong:!0,children:(null===(re=De.find((function(e){return e.uid===nl})))||void 0===re?void 0:re.nickname)||(null===(oe=De.find((function(e){return e.type===Ye})))||void 0===oe?void 0:oe.nickname)||Ye}),(0,R.jsx)("br",{}),(0,R.jsx)(J,{type:"secondary",children:ce.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"模型："})}),(0,R.jsx)(J,{strong:!0,children:cl||sl})]}),(0,R.jsx)(M.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"更换模型"})})]}):(0,R.jsx)("div",{style:{textAlign:"center"},children:(0,R.jsx)(M.ZP,{type:"primary",children:ce.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"选择AI模型"})})})}),(0,R.jsxs)("div",{style:{display:"none"},children:[(0,R.jsx)(I.Z,{name:"provider"}),(0,R.jsx)(I.Z,{name:"model"})]})]}),(0,R.jsx)(W,{name:"temperature",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Zl(Rl,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"控制输出的随机性，值越高输出越随机创新"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Al(Ul(e))}}}),(0,R.jsx)(W,{name:"topP",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Zl(Nl,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P 采样阈值，保留累计概率达到该值的词，范围 0-1，值越小越保守"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return zl(Ul(e))}}}),(0,R.jsx)(W,{name:"topK",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Il(Ql)})]}),tooltip:ce.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"检索时返回的相关文档数量"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Bl(e)}}}),(0,R.jsx)(W,{name:"scoreThreshold",label:(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,R.jsx)("span",{children:ce.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"得分阈值"})}),(0,R.jsx)("span",{style:{color:"#999"},children:": "+Zl(ql,2)})]}),tooltip:ce.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"知识库召回命中文档的最低得分阈值，低于此值不纳入参考"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Hl(Ul(e))}}}),!1,(0,R.jsx)(E.Z,{name:"prompt",label:ce.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})}),(0,R.jsx)(Z.Z,{name:"useLlmWhenKbEmpty",label:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库空结果时使用大模型"}),tooltip:ce.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"开启后，当知识库没有命中时将继续调用大模型回答；关闭则返回默认回复"}),fieldProps:{onChange:function(e){return Sl(e)}}}),!wl&&(0,R.jsx)(E.Z,{name:"defaultReply",label:ce.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"默认回复"})})]}),(0,R.jsxs)(m.Fragment,{children:[(0,R.jsx)(Z.Z,{name:"kbEnabled",label:ce.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"启用知识库"}),fieldProps:{onChange:function(e){return xl(e)}}}),Ml&&(0,R.jsxs)(m.Fragment,{children:[(0,R.jsx)(Z.Z,{name:"kbSourceEnabled",label:ce.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),tooltip:ce.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"开启后将在回复中显示知识库命中来源，便于调试不同检索类型的搜索结果"})}),(0,R.jsx)(I.Z,{name:"searchType",label:ce.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),valueEnum:o()(o()(o()({},j.ccx,{text:"全文"}),j.DGp,{text:"向量"}),j.rk3,{text:"混合"})}),(0,R.jsx)(I.Z,{name:"kbUid",label:ce.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),placeholder:ce.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"请选择知识库"}),showSearch:!0,debounceTime:300,request:function(){var e=u()(i()().mark((function e(l){var t,n,a,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.keyWords,e.prev=1,a={pageNumber:0,pageSize:50,type:j.QPQ,orgUid:null==pe?void 0:pe.uid,searchText:t||""},e.next=5,(0,w.AP)(a);case 5:return r=e.sent,o=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",o.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(l){return e.apply(this,arguments)}}()})]})]}),Cl&&(0,R.jsx)(V.Z,{type:"info",showIcon:!0,message:ce.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),style:{marginBottom:12}}),(0,R.jsx)(_.Z,{visible:_e,onCancel:dt,onOk:ct,initialProvider:nl||Ye,initialModel:sl,initialModelLabel:cl,providers:De,currentOrgUid:null==pe?void 0:pe.uid,existingProviderModels:Ve,onModelsLoaded:ut,allowedModelTypes:[j.l55,j.xZ8,"CHAT"]}),(0,R.jsx)(N.Z,{open:ge,onOpenChange:he,orgUid:(null==pe?void 0:pe.uid)||"",record:null,onSuccess:function(){he(!1),lt()}})]})},Y=t(52575),ee=t(86895),le=t(23753),te=function(e){var l,t=e.open,n=e.record,r=e.value,o=e.onClose,s=e.onSaved,d=(0,f.useIntl)(),c=(0,m.useState)(r||(null==n||null===(l=n.llm)||void 0===l?void 0:l.prompt)||""),v=p()(c,2),g=v[0],h=v[1];(0,m.useEffect)((function(){var e,l;h(null!==(e=null!=r?r:null==n||null===(l=n.llm)||void 0===l?void 0:l.prompt)&&void 0!==e?e:"")}),[t,r,null==n?void 0:n.uid]);var b=function(){var e=u()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(g||"");case 3:x.yw.success(d.formatMessage({id:"copy.success",defaultMessage:"复制成功"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),x.yw.error(d.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=u()(i()().mark((function e(){var l,t,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.uid){e.next=3;break}return null==o||o(),e.abrupt("return");case 3:return e.prev=3,x.yw.loading(d.formatMessage({id:"saving",defaultMessage:"Saving..."})),t={uid:(l=n).uid,prompt:g,llm:a()(a()({},l.llm||{}),{},{prompt:g})},e.next=9,(0,y.M8)(t);case 9:r=e.sent,le.Z.debug("PromptEditModal handleSave updated robot prompt:",r,t),x.yw.destroy(),200===(null==r?void 0:r.code)?(x.yw.success(d.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==s||s()):x.yw.error((null==r?void 0:r.message)||d.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),x.yw.destroy(),x.yw.error(d.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();return(0,R.jsx)(ee.Z,{open:t,title:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),onCancel:o,footer:[(0,R.jsx)(M.ZP,{onClick:b,children:d.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,R.jsx)(M.ZP,{type:"primary",onClick:k,children:d.formatMessage({id:"save",defaultMessage:"保存"})},"save"),(0,R.jsx)(M.ZP,{onClick:o,children:d.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:(0,R.jsx)("div",{children:(0,R.jsx)("textarea",{value:g,onChange:function(e){return h(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:d.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})})})})},ne=function(e){var l=e.superUser,t=(0,f.useIntl)(),n=(0,m.useRef)(),r=(0,S.u)((function(e){return e.currentOrg})),s=(0,m.useState)(!1),d=p()(s,2),c=d[0],T=d[1],C=(0,m.useState)(!1),E=p()(C,2),P=E[0],Z=E[1],I=(0,m.useState)(null),U=p()(I,2),K=U[0],L=U[1],A=(0,m.useState)(!1),W=p()(A,2),F=W[0],N=W[1],z=(0,m.useState)(""),D=p()(z,2),O=D[0],Q=D[1],B=(0,m.useState)(null),V=p()(B,2),G=V[0],q=V[1],H=(0,m.useState)({}),_=p()(H,2),J=_[0],$=_[1],ee=(0,m.useState)({}),ne=p()(ee,2),ae=ne[0],re=ne[1];m.useEffect((function(){var e=function(){var e=u()(i()().mark((function e(){var l,t,n,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:200,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==r?void 0:r.uid,level:j.whQ},e.next=4,(0,k.mK)(l);case 4:t=e.sent,le.Z.debug("RobotTable loadProviders response:",t,l),200===(null==t?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],o={},a.forEach((function(e){var l=(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.type)||(null==e?void 0:e.uid);null!=e&&e.uid&&(o[e.uid]=l)})),$(o)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=r&&r.uid?e():$({})}),[null==r?void 0:r.uid]),m.useEffect((function(){var e=function(){var e=u()(i()().mark((function e(){var l,t,n,a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:200,orgUid:null==r?void 0:r.uid,searchText:""},e.next=4,(0,w.AP)(l);case 4:t=e.sent,le.Z.debug("RobotTable loadKbases response:",t,l),200===(null==t?void 0:t.code)&&(a=(null==t||null===(n=t.data)||void 0===n?void 0:n.content)||[],o={},a.forEach((function(e){null!=e&&e.uid&&(o[e.uid]=(null==e?void 0:e.name)||(null==e?void 0:e.uid))})),re(o)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();null!=r&&r.uid?e():re({})}),[null==r?void 0:r.uid]);var oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:t.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:t.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,l){return(0,R.jsx)(g.Z,{src:null==l?void 0:l.avatar})}},{title:t.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,render:function(e,l){var n=null==l?void 0:l.type,a=n===j.Qeb?"green":n===j.f4h?"blue":"purple",r=n===j.f4h?t.formatMessage({id:j.f4h,defaultMessage:"Service"}):n===j.Qeb?t.formatMessage({id:j.Qeb,defaultMessage:"Chat"}):n===j.wG_?t.formatMessage({id:j.wG_,defaultMessage:"Marketing"}):t.formatMessage({id:n||"unknown",defaultMessage:n||"-"});return(0,R.jsx)(h.Z,{color:a,children:r})},hideInSearch:!0},{title:t.formatMessage({id:"type",defaultMessage:"Type"}),dataIndex:"type",valueType:"select",valueEnum:o()(o()(o()({},j.f4h,{text:t.formatMessage({id:j.f4h,defaultMessage:"Service"})}),j.Qeb,{text:t.formatMessage({id:j.Qeb,defaultMessage:"Chat"})}),j.wG_,{text:t.formatMessage({id:j.wG_,defaultMessage:"Marketing"}),disabled:!0}),hideInTable:!0},{title:t.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:t.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,l){if((null==l?void 0:l.type)===j.Qeb){var n,a,r=!(null==l||null===(n=l.llm)||void 0===n||!n.textModel);return(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},style:{color:r?void 0:"#ff4d4f"},children:r?(null===(a=l.llm)||void 0===a?void 0:a.textModel)||t.formatMessage({id:"robot.llm.configured",defaultMessage:"模型已配置"}):t.formatMessage({id:"robot.llm.unconfigured",defaultMessage:"未配置模型，点击配置"})})}return null!=l&&l.settings?(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},children:l.settings.name||t.formatMessage({id:"robot.settings.configured",defaultMessage:"已配置"})}):(0,R.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){L(l),T(!0)},children:t.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:t.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],width:140,hideInSearch:!0,render:function(e,l){var n,a=null==l||null===(n=l.llm)||void 0===n?void 0:n.prompt;return a?(0,R.jsx)("a",{onClick:function(){Q(a),q(l),N(!0)},children:t.formatMessage({id:"view",defaultMessage:"查看"})}):"-"}},{title:t.formatMessage({id:"pages.prompt.textProvider",defaultMessage:"文本模型提供商"}),dataIndex:["llm","textProvider"],hideInSearch:!0,width:160,render:function(e,l){var t,n,a=null==l||null===(t=l.llm)||void 0===t?void 0:t.textProviderUid;return a&&J[a]?J[a]:(null==l||null===(n=l.llm)||void 0===n?void 0:n.textProvider)||"-"}},{title:t.formatMessage({id:"pages.prompt.model",defaultMessage:"模型"}),dataIndex:["llm","textModel"],hideInSearch:!0,width:180,render:function(e,l){var t;return(null==l||null===(t=l.llm)||void 0===t?void 0:t.textModel)||"-"}},{title:t.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),dataIndex:["llm","enabled"],hideInSearch:!0,width:140,render:function(e,l){var t;return null!=l&&null!==(t=l.llm)&&void 0!==t&&t.enabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库搜索结果为空时用LLM"}),dataIndex:["llm","useLlmWhenKbEmpty"],hideInSearch:!0,width:220,render:function(e,l){var t;return null!=l&&null!==(t=l.llm)&&void 0!==t&&t.useLlmWhenKbEmpty?"是":"否"}},{title:t.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:t.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,render:function(e,l){var t,n,a;return 0===(null==l||null===(t=l.llm)||void 0===t?void 0:t.temperature)?"0":null!==(n=null==l||null===(a=l.llm)||void 0===a?void 0:a.temperature)&&void 0!==n?n:"-"}},{title:t.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,render:function(e,l){var t,n;return null!==(t=null==l||null===(n=l.llm)||void 0===n?void 0:n.topK)&&void 0!==t?t:"-"}},{title:t.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"知识库启用"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,render:function(e,l){return null!=l&&l.kbEnabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),dataIndex:"kbSourceEnabled",hideInSearch:!0,width:120,render:function(e,l){return null!=l&&l.kbSourceEnabled?"是":"否"}},{title:t.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),dataIndex:["llm","searchType"],hideInSearch:!0,width:120,render:function(e,l){var t,n=null==l||null===(t=l.llm)||void 0===t?void 0:t.searchType;return n===j.ccx?"全文":n===j.DGp?"向量":n===j.rk3?"混合":null!=n?n:"-"}},{title:t.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),dataIndex:"kbUid",hideInSearch:!0,width:200,render:function(e,l){var t=null==l?void 0:l.kbUid;return t?ae[t]||t:"-"}},{title:t.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:t.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,l){return[(0,R.jsx)("a",{onClick:function(){return function(e){var l;if(e&&e.uid){var n={chatConfig:{org:null==r?void 0:r.uid,t:j.ACv,sid:e.uid}};null===(l=window.bytedesk)||void 0===l||l.showChat(n)}else x.yw.error(t.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))}(l)},children:t.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,R.jsx)("a",{onClick:function(){return f.history.push("/service/channel")},children:t.formatMessage({id:"robot.get.code",defaultMessage:"获取机器人代码"})},"code"),(0,R.jsx)("a",{onClick:function(){L(l),T(!0)},children:t.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,R.jsx)(b.Z,{title:t.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==l?void 0:l.nickname,"】？"),onConfirm:u()(i()().mark((function e(){var a,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,y.gf)(l);case 4:a=e.sent,x.yw.destroy(),200===(null==a?void 0:a.code)?(x.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(r=n.current)||void 0===r||r.reload()):x.yw.error((null==a?void 0:a.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.destroy(),x.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:t.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:t.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,R.jsx)("a",{children:t.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:t.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(v.Z,{columns:oe,actionRef:n,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},form:{initialValues:{type:j.f4h}},toolBarRender:function(){return[(0,R.jsx)(M.ZP,{type:"primary",onClick:function(){L(null),Z(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=u()(i()().mark((function e(t,n){var o,s,d,u,c,m,f,v,g,h,b,M,x,k,w,S,T,C,E,P,Z,I,U,K;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(null!==(o=null==t?void 0:t.current)&&void 0!==o?o:1)-1,m=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,f=null!==(d=null==t?void 0:t.searchText)&&void 0!==d?d:"",v=null!==(u=null==t?void 0:t.type)&&void 0!==u?u:j.f4h,(b=Object.entries(n||{})).length>0&&(M=b[0],x=p()(M,2),k=x[0],(w=x[1])&&(g=k,h="ascend"===w?"ascend":"descend")),S=a()(a()({pageNumber:c,pageSize:m,categoryUid:"",level:j.whQ,type:v,orgUid:null==r?void 0:r.uid,searchText:f,superUser:l},g?{sortBy:g}:{}),h?{sortDirection:h}:{}),e.prev=7,e.next=10,(0,y.p0)(S);case 10:if(T=e.sent,console.log("RobotTable queryRobotsByOrg response:",T,S),200!==(null==T?void 0:T.code)){e.next=16;break}return U=(null==T||null===(C=T.data)||void 0===C?void 0:C.content)||[],K=null!==(E=null!==(P=null==T||null===(Z=T.data)||void 0===Z?void 0:Z.totalElements)&&void 0!==P?P:null==T||null===(I=T.data)||void 0===I?void 0:I.numberOfElements)&&void 0!==E?E:U.length,e.abrupt("return",{data:U,total:K,success:!0});case 16:return e.abrupt("return",{data:[],total:0,success:!1});case 19:return e.prev=19,e.t0=e.catch(7),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(l,t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:t.formatMessage({id:"robot",defaultMessage:"Robot"})}),c&&(0,R.jsx)(X,{open:c,record:K,onClose:function(){return T(!1)},onSuccess:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.reload()}}),P&&(0,R.jsx)(Y.Z,{open:P,onClose:function(){return Z(!1)},onSubmit:function(){var e=u()(i()().mark((function e(l){var a,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(t.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=1,e.next=4,(0,y.lg)(l);case 4:a=e.sent,x.yw.destroy(),200===(null==a?void 0:a.code)?(x.yw.success(t.formatMessage({id:"create.success",defaultMessage:"Create success"})),Z(!1),null===(r=n.current)||void 0===r||r.reload()):x.yw.error((null==a?void 0:a.message)||t.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),x.yw.destroy(),x.yw.error(t.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(l){return e.apply(this,arguments)}}()}),(0,R.jsx)(te,{open:F,record:G,value:O,onClose:function(){return N(!1)},onSaved:function(){var e;N(!1),q(null),null===(e=n.current)||void 0===e||e.reload()}})]})}}}]);