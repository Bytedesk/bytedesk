"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7284],{40391:function(e,t,a){a.d(t,{Z:function(){return j}});var r=a(80627),n=a(93683),i=a(44194),s=a(84729),o=a(69983),l=a(31549),u=["proFieldProps","fieldProps"],d="date",c=i.forwardRef((function(e,t){var a=e.proFieldProps,c=e.fieldProps,p=(0,n.Z)(e,u),f=(0,i.useContext)(s.Z);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:d,fieldProps:(0,r.Z)({getPopupContainer:f.getPopupContainer},c),proFieldProps:a,filedConfig:{valueType:d,customLightMode:!0}},p))})),p=["proFieldProps","fieldProps"],f="dateMonth",g=i.forwardRef((function(e,t){var a=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,p),c=(0,i.useContext)(s.Z);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:f,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:a,filedConfig:{valueType:f,customLightMode:!0}},d))})),m=["fieldProps"],h="dateQuarter",x=i.forwardRef((function(e,t){var a=e.fieldProps,u=(0,n.Z)(e,m),d=(0,i.useContext)(s.Z);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:h,fieldProps:(0,r.Z)({getPopupContainer:d.getPopupContainer},a),filedConfig:{valueType:h,customLightMode:!0}},u))})),v=["proFieldProps","fieldProps"],M="dateWeek",y=i.forwardRef((function(e,t){var a=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,v),c=(0,i.useContext)(s.Z);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:M,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:a,filedConfig:{valueType:M,customLightMode:!0}},d))})),b=["proFieldProps","fieldProps"],w="dateYear",k=i.forwardRef((function(e,t){var a=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,b),c=(0,i.useContext)(s.Z);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:w,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:a,filedConfig:{valueType:w,customLightMode:!0}},d))})),Z=c;Z.Week=y,Z.Month=g,Z.Quarter=x,Z.Year=k,Z.displayName="ProFormComponent";var j=Z},37267:function(e,t,a){a.d(t,{Az:function(){return c},Bv:function(){return C},DO:function(){return M},L0:function(){return j},RF:function(){return b},Xc:function(){return m},YO:function(){return k},jX:function(){return x},tu:function(){return f}});var r=a(90819),n=a.n(r),i=a(73193),s=a.n(i),o=a(89933),l=a.n(o),u=a(27353),d=a(2290);function c(e){return p.apply(this,arguments)}function p(){return(p=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/query/org",{method:"GET",params:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/create",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/update",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/delete",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/deleteAll",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/updateIndex",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/updateVectorIndex",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return P.apply(this,arguments)}function P(){return(P=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/updateAllIndex",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return S.apply(this,arguments)}function S(){return(S=l()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/article/updateAllVectorIndex",{method:"POST",data:s()(s()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77284:function(e,t,a){a.d(t,{Z:function(){return Q}});var r=a(84176),n=a.n(r),i=a(86222),s=a.n(i),o=a(73193),l=a.n(o),u=a(90819),d=a.n(u),c=a(89933),p=a.n(c),f=a(45332),g=a.n(f),m=a(50884),h=a(37267),x=a(28520),v=a(43837),M=a(91768),y=a(80503),b=a(6992),w=a(28031),k=a(51344),Z=a(77601),j=a(35746),P=a(38623),C=a(90883),S=a(70937),F=a(46206),T=a(56668),A=a(44194),I=a(7603),O=a(27353),D=a(97588),U=a(17455),R=a(67186),E=a(83788),q=a(74056),z=a(40391),X=a(69159),L=a(19058),B=a(31549),J=function(e){var t=e.isEdit,a=e.helpcenter,r=e.open,n=e.onClose,i=e.onSubmit,s=X.Z.useForm(),o=g()(s,1)[0],u=(0,x.u)((function(e){return e.currentOrg})),d=(0,I.v)((function(e){return e.categorySelectOptions}));(0,A.useEffect)((function(){t?o.setFieldsValue({type:null==a?void 0:a.type,title:null==a?void 0:a.title,content:null==a?void 0:a.contentHtml}):o.resetFields()}),[r]);return(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(L.Z,{title:t?"修改":"新建",onClose:n,open:r,extra:(0,B.jsxs)(F.Z,{children:[(0,B.jsx)(C.ZP,{onClick:n,children:"取消"}),(0,B.jsx)(C.ZP,{onClick:function(){console.log("handleSubmit"),o.validateFields().then((function(e){console.log(e),i(l()(l()(l()({},a),e),{},{orgUid:null==u?void 0:u.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,B.jsxs)(D.A,{form:o,initialValues:l()({},a),submitter:{render:function(){return null}},children:[(0,B.jsx)(U.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:d,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e))}}}),(0,B.jsx)(U.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:O.PYi},{label:"图片",value:O.Qm},{label:"视频",value:O.tVi},{label:"音频",value:O.Yu1},{label:"文件",value:O.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e))}}}),(0,B.jsx)(R.Z,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}]}),(0,B.jsx)(E.Z,{label:"摘要",name:"summary"}),(0,B.jsx)(E.Z,{label:"内容",name:"contentHtml"}),(0,B.jsx)(U.Z,{label:"编辑器",name:"editor",options:[{label:"富文本编辑器",value:"richtext"},{label:"Markdown",value:"markdown"}],initialValue:"richtext"}),(0,B.jsx)(q.Z,{label:"是否置顶",name:"top",tooltip:"选择是否将此文章置顶显示"}),(0,B.jsx)(q.Z,{label:"是否需要审核",name:"needAudit",tooltip:"选择此文章是否需要审核才能发布"}),(null==a?void 0:a.needAudit)&&(0,B.jsx)(U.Z,{label:"审核状态",name:"auditStatus",options:[{label:"待审核",value:"pending"},{label:"已通过",value:"approved"},{label:"已驳回",value:"rejected"}],initialValue:"pending"}),(0,B.jsx)(z.Z,{label:"生效开始日期",name:"startDate",tooltip:"文章生效的开始日期，不填则立即生效"}),(0,B.jsx)(z.Z,{label:"生效结束日期",name:"endDate",tooltip:"文章失效的结束日期，不填则永久有效"})]})})})},V=a(2290),N=a(64967),K=a(61476),Y=a(97765),W=a(27318),H=["current","pageSize"],Q=function(e){var t,a,r,i,o,u,c,f,D,U,R=e.superUser,E=(0,V.useIntl)(),q=(0,A.useRef)(),z=(0,A.useState)(!0),X=g()(z,2),L=X[0],Q=(X[1],(0,A.useState)(1)),G=g()(Q,2),$=G[0],_=G[1],ee=(0,A.useState)(10),te=g()(ee,2),ae=te[0],re=te[1],ne=(0,A.useState)(),ie=g()(ne,2),se=ie[0],oe=(ie[1],(0,A.useState)(!1)),le=g()(oe,2),ue=le[0],de=le[1],ce=(0,x.u)((function(e){return e.currentOrg})),pe=(0,N.j)((function(e){return e.currentKbase})),fe=(0,I.v)((function(e){return e.currentCategory})),ge=(0,I.v)((function(e){return e.categorySelectOptions})),me=(0,A.useState)([]),he=g()(me,2),xe=he[0],ve=he[1],Me=(0,A.useState)([]),ye=g()(Me,2),be=ye[0],we=ye[1],ke=(0,A.useState)({}),Ze=g()(ke,2),je=Ze[0],Pe=Ze[1],Ce=(0,A.useState)(0),Se=g()(Ce,2),Fe=Se[0],Te=Se[1],Ae=j.Z.useModal(),Ie=g()(Ae,2),Oe=Ie[0],De=Ie[1],Ue=(0,V.useAccess)(),Re=(0,A.useMemo)((function(){var e;return null==Ue||null===(e=Ue.getModulePermission)||void 0===e?void 0:e.call(Ue,W.MY.ARTICLE)}),[Ue]),Ee=R||null!==(t=null==Re||null===(a=Re.canRead)||void 0===a?void 0:a.call(Re))&&void 0!==t&&t,qe=R||null!==(r=null==Re||null===(i=Re.canCreate)||void 0===i?void 0:i.call(Re))&&void 0!==r&&r,ze=R||null!==(o=null==Re||null===(u=Re.canUpdate)||void 0===u?void 0:u.call(Re))&&void 0!==o&&o,Xe=R||null!==(c=null==Re||null===(f=Re.canDelete)||void 0===f?void 0:f.call(Re))&&void 0!==c&&c,Le=R||null!==(D=null==Re||null===(U=Re.canExport)||void 0===U?void 0:U.call(Re))&&void 0!==D&&D,Be=(0,A.useRef)(!1),Je=function(e,t){m.yw.warning(E.formatMessage({id:e,defaultMessage:t}))},Ve={TEXT:E.formatMessage({id:"pages.article.type.text",defaultMessage:"普通文本"}),MARKDOWN:"Markdown",HTML:E.formatMessage({id:"pages.article.type.html",defaultMessage:"富文本"}),IMAGE:E.formatMessage({id:"pages.article.type.image",defaultMessage:"图片"}),VIDEO:E.formatMessage({id:"pages.article.type.video",defaultMessage:"视频"}),AUDIO:E.formatMessage({id:"pages.article.type.audio",defaultMessage:"音频"}),FILE:E.formatMessage({id:"pages.article.type.file",defaultMessage:"文件"}),LINK:E.formatMessage({id:"pages.article.type.link",defaultMessage:"链接"})},Ne=function(e){if(!e)return E.formatMessage({id:"pages.article.type.default",defaultMessage:"文本"});var t=e.toUpperCase();return Ve[t]||t},Ke=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.title"}),dataIndex:"title",copyable:!0,ellipsis:!0,width:200,fixed:"left",tooltip:{title:E.formatMessage({id:"pages.article.title.tooltip",defaultMessage:"文章的标题"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.summary"}),dataIndex:"summary",ellipsis:!0,width:200,tooltip:{title:E.formatMessage({id:"pages.article.summary.tooltip",defaultMessage:"文章的摘要内容"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.category"}),dataIndex:"categoryUid",hideInSearch:!0,hideInTable:R,width:120,tooltip:{title:E.formatMessage({id:"pages.article.category.tooltip",defaultMessage:"文章所属的分类"})},render:function(e,t){var a=null!=(null==t?void 0:t.categoryUid)?String(t.categoryUid):"",r=ge.find((function(e){return String(e.value)===a})),n=(null==r?void 0:r.label)||"-";return(0,B.jsx)(P.Z,{color:"blue",children:n})},filters:ge.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.type"}),dataIndex:"type",hideInSearch:!0,width:100,tooltip:{title:E.formatMessage({id:"pages.article.type.tooltip",defaultMessage:"文章的内容类型"})},render:function(e,t){return(0,B.jsx)(P.Z,{color:"blue",children:Ne(t.type)})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.top"}),dataIndex:"top",hideInSearch:!0,width:80,tooltip:{title:E.formatMessage({id:"pages.article.top.tooltip",defaultMessage:"文章是否置顶"})},render:function(e,t){return(0,B.jsx)(P.Z,{color:t.top?"orange":"default",children:t.top?(0,B.jsx)(V.FormattedMessage,{id:"pages.article.top.yes",defaultMessage:"置顶"}):(0,B.jsx)(V.FormattedMessage,{id:"pages.article.top.no",defaultMessage:"普通"})})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.readCount"}),dataIndex:"readCount",hideInSearch:!0,width:100,sorter:!0,tooltip:{title:E.formatMessage({id:"pages.article.readCount.tooltip",defaultMessage:"文章被阅读的次数"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.likeCount"}),dataIndex:"likeCount",hideInSearch:!0,width:100,sorter:!0,tooltip:{title:E.formatMessage({id:"pages.article.likeCount.tooltip",defaultMessage:"文章被点赞的次数"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.startDate"}),dataIndex:"startDate",valueType:"date",width:120,hideInSearch:!0,tooltip:{title:E.formatMessage({id:"pages.article.startDate.tooltip",defaultMessage:"文章生效的开始日期"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.endDate"}),dataIndex:"endDate",valueType:"date",width:120,hideInSearch:!0,tooltip:{title:E.formatMessage({id:"pages.article.endDate.tooltip",defaultMessage:"文章失效的结束日期"})}},{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.updatedAt"}),dataIndex:"updatedAt",valueType:"dateTime",width:200,sorter:!0,hideInSearch:!0,tooltip:{title:E.formatMessage({id:"pages.article.updatedAt.tooltip",defaultMessage:"文章最后更新的时间"})}}],Ye=function(){var e=p()(d()().mark((function e(t){var a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe){e.next=3;break}return Je("article.permission.delete.denied","无权限：删除文章"),e.abrupt("return");case 3:return Y.Z.debug("handleDeleteArticle",t),e.next=6,(0,h.jX)(t);case 6:a=e.sent,Y.Z.debug("delete response:",a),200===a.code?(null==q||q.current.reload(),m.yw.success(E.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(E.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=[].concat(Ke,[{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.common.actions"}),valueType:"option",fixed:"right",width:280,render:function(e,t){var a=[];return ze&&a.push((0,B.jsx)(C.ZP,{type:"link",size:"small",onClick:function(){return $e(t)},children:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.edit"})},"edit")),Ee&&a.push((0,B.jsx)(C.ZP,{type:"link",size:"small",icon:(0,B.jsx)(v.Z,{}),onClick:function(){return function(e){Ee?(Y.Z.debug("handlePreviewArticle",e),window.open("/helpcenter/".concat(null==e?void 0:e.kbUid,"/article/").concat(null==e?void 0:e.uid,".html"))):Je("article.permission.read.denied","无权限：查看文章")}(t)},children:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.preview"})},"preview")),ze&&t.needAudit&&"approved"!==t.auditStatus&&a.push((0,B.jsx)(C.ZP,{type:"link",size:"small",onClick:function(){var e=l()(l()({},t),{},{auditStatus:"approved"});He(e)},children:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.approve",defaultMessage:"通过审核"})},"approve")),Xe&&a.push((0,B.jsx)(S.Z,{title:(0,B.jsx)(V.FormattedMessage,{id:"pages.common.deleteTip"}),description:E.formatMessage({id:"pages.common.deleteConfirm"},{name:t.title}),onConfirm:function(){return Ye(t)},okText:(0,B.jsx)(V.FormattedMessage,{id:"pages.common.ok"}),cancelText:(0,B.jsx)(V.FormattedMessage,{id:"pages.common.cancel"}),children:(0,B.jsx)(C.ZP,{type:"link",danger:!0,size:"small",children:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.delete"})})},"delete")),(0,B.jsx)(F.Z,{children:a})}}]),He=function(){var e=p()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y.Z.debug("handleSubmitDrawer",t),!L||ze){e.next=4;break}return Je("article.permission.update.denied","无权限：编辑文章"),e.abrupt("return");case 4:if(L||qe){e.next=7;break}return Je("article.permission.create.denied","无权限：新建文章"),e.abrupt("return");case 7:if(L?m.yw.loading(E.formatMessage({id:"updating"})):m.yw.loading(E.formatMessage({id:"creating"})),!L){e.next=14;break}return e.next=11,(0,h.Xc)(t);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,(0,h.tu)(t);case 16:e.t0=e.sent;case 17:a=e.t0,Y.Z.debug("createArticle response:",t,a),200===a.code?(m.yw.destroy(),m.yw.loading(E.formatMessage({id:"create.success"})),de(!1),null===(r=q.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,A.useEffect)((function(){var e;null===(e=q.current)||void 0===e||e.reloadAndRest()}),[pe,fe]);var Qe=function(){Y.Z.debug("handlePreviewKbase"),Ee?window.open("/helpcenter/".concat(null==pe?void 0:pe.uid)):Je("article.permission.read.denied","无权限：查看文章")},Ge=function(){Y.Z.debug("handleCreateArticle"),qe?window.open((0,K.W1)(null==pe?void 0:pe.uid)):Je("article.permission.create.denied","无权限：新建文章")},$e=function(e){Y.Z.debug("handleEditArticle"),ze?window.open((0,K.OH)(null==e?void 0:e.uid)):Je("article.permission.update.denied","无权限：编辑文章")},_e=function(){var e=p()(d()().mark((function e(){var t,a,r,n,i,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe){e.next=3;break}return Je("article.permission.delete.denied","无权限：删除文章"),e.abrupt("return");case 3:if(0!==be.length){e.next=6;break}return m.yw.warning(E.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 6:m.yw.loading(E.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,r=0,n=s()(be),e.prev=10,n.s();case 12:if((i=n.n()).done){e.next=29;break}if(o=i.value,e.prev=14,null!=o&&o.uid){e.next=18;break}return r++,e.abrupt("continue",27);case 18:return e.next=20,(0,h.jX)({uid:o.uid});case 20:200===e.sent.code?a++:r++,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(14),r++;case 27:e.next=12;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(10),n.e(e.t1);case 34:return e.prev=34,n.f(),e.finish(34);case 37:m.yw.destroy(),0===r?m.yw.success(E.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:a})):m.yw.warning(E.formatMessage({id:"batch.delete.partial",defaultMessage:"成功删除 {success} 条记录，失败 {fail} 条"},{success:a,fail:r})),ve([]),we([]),null===(t=q.current)||void 0===t||t.reloadAndRest();case 42:case"end":return e.stop()}}),e,null,[[10,31,34,37],[14,24]])})));return function(){return e.apply(this,arguments)}}(),et=function(){var e=p()(d()().mark((function e(){var t,a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe){e.next=3;break}return Je("article.permission.delete.denied","无权限：删除文章"),e.abrupt("return");case 3:if(0!==Fe){e.next=6;break}return m.yw.warning(E.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 6:return m.yw.loading(E.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=7,t={categoryUid:(null==fe?void 0:fe.uid)===O.zBg?"":null==fe?void 0:fe.uid,kbUid:null==pe?void 0:pe.uid,orgUid:null==ce?void 0:ce.uid},e.next=11,(0,h.DO)(t);case 11:a=e.sent,Y.Z.debug("handleDeleteAllConfirm response:",a,t),200===a.code?(m.yw.destroy(),m.yw.success(E.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(r=q.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||E.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(7),m.yw.destroy(),m.yw.error(E.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(){return e.apply(this,arguments)}}(),tt=function(){var e=p()(d()().mark((function e(t,a,r){var n,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y.Z.debug("handleExportExcel",t,a,r),Le){e.next=4;break}return Je("article.permission.export.denied","无权限：导出文章"),e.abrupt("return");case 4:n=localStorage.getItem(O.LA8),i=l()({categoryUid:(null==fe?void 0:fe.uid)===O.zBg?"":null==fe?void 0:fe.uid,kbUid:null==pe?void 0:pe.uid,orgUid:(null==ce?void 0:ce.uid)||"",accessToken:n||"",exportType:t},je),"current"===t?(i.pageNumber=String($-1),i.pageSize=String(ae)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(i.pageNumber=String(a),i.pageSize=String(r)),window.open((0,K.kG)()+"/api/v1/article/export?"+new URLSearchParams(i).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),at=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=i,n=i*a+1,s=Math.min((i+1)*a,e);t.push({key:"export-".concat(i),label:"".concat(n,"-").concat(s," (").concat(s-n+1,"条)"),onClick:function(){return tt("range",r,a)}})},i=0;i<r;i++)n();return t},rt={selectedRowKeys:xe,onChange:function(e,t){ve(e),we(t)}};return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(Z.Z,{columns:We,actionRef:q,cardBordered:!0,rowSelection:Xe?rt:void 0,scroll:{x:1500},rowKey:"uid",search:{labelWidth:"auto"},form:{syncToUrl:!0,ignoreRules:!1},pagination:{pageSize:10,onChange:function(e,t){_(e),t&&re(t)}},dateFormatter:"string",headerTitle:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.list"}),toolBarRender:function(){if(R){var e=xe.length,t=[{key:"batchDelete",icon:(0,B.jsx)(M.Z,{}),danger:!0,disabled:!Xe||0===e,label:E.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+(e>0?" (".concat(e,")"):""),onClick:function(){Xe&&0!==e&&Oe.confirm({title:E.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),content:"".concat(E.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除选中的"})," ").concat(e," ").concat(E.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:_e,okText:E.formatMessage({id:"ok"}),cancelText:E.formatMessage({id:"cancel"})})}}];return[(0,B.jsx)(T.Z,{menu:{items:t},placement:"bottomRight",children:(0,B.jsxs)(C.ZP,{type:"primary",danger:!0,disabled:0===e||0===t.length,children:[E.formatMessage({id:"batch.operations",defaultMessage:"批量操作"}),(0,B.jsx)(y.Z,{})]})},"batchOperations")]}var a=[];if(qe&&a.push((0,B.jsx)(C.ZP,{type:"primary",icon:(0,B.jsx)(b.Z,{}),onClick:Ge,children:(0,B.jsx)(V.FormattedMessage,{id:"pages.article.create"})},"create")),Le){var r=[{key:"export-current",icon:(0,B.jsx)(w.Z,{}),label:E.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return tt("current")}}];Fe>0&&(Fe<=1e3?r.push({key:"export-all",icon:(0,B.jsx)(w.Z,{}),label:E.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Fe,"条)"),onClick:function(){return tt("all")}}):r.push({key:"export-range",icon:(0,B.jsx)(w.Z,{}),label:E.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Fe,"条)"),children:at(Fe)})),a.push((0,B.jsx)(T.Z,{menu:{items:r},placement:"bottom",children:(0,B.jsxs)(C.ZP,{type:"primary",icon:(0,B.jsx)(w.Z,{}),children:[(0,B.jsx)(V.FormattedMessage,{id:"pages.article.export"}),(0,B.jsx)(y.Z,{})]})},"exportDropdown"))}Ee&&a.push((0,B.jsx)(C.ZP,{type:"primary",icon:(0,B.jsx)(v.Z,{}),onClick:Qe,children:(0,B.jsx)(V.FormattedMessage,{id:"pages.kbase.preview"})},"preview"));var n=[];return Xe&&xe.length>0&&n.push({key:"batchDelete",icon:(0,B.jsx)(M.Z,{}),danger:!0,label:E.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(xe.length,")"),onClick:function(){Oe.confirm({title:E.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),content:"".concat(E.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除选中的"})," ").concat(xe.length," ").concat(E.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:_e,okText:E.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:E.formatMessage({id:"cancel",defaultMessage:"取消"})})}}),Xe&&n.push({key:"deleteAll",icon:(0,B.jsx)(k.Z,{}),danger:!0,label:E.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Oe.confirm({title:E.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:E.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文章数据吗？此操作不可恢复!"}),onOk:et,okText:E.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:E.formatMessage({id:"cancel",defaultMessage:"取消"})})}}),n.length>0&&a.push((0,B.jsx)(T.Z,{menu:{items:n},placement:"bottom",children:(0,B.jsxs)(C.ZP,{type:xe.length>0?"primary":"default",danger:xe.length>0,children:[xe.length>0?E.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(xe.length,")"):E.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,B.jsx)(y.Z,{})]})},"batchOperations")),a},request:function(){var e=p()(d()().mark((function e(t,a,r){var i,s,o,u,c,p,f,g,m,x;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y.Z.debug("request params:",t,a,r),Ee){e.next=4;break}return Be.current||(Be.current=!0,Je("article.permission.read.denied","无权限：查看文章")),e.abrupt("return",{data:[],success:!0,total:0});case 4:return i=t.current,s=t.pageSize,o=n()(t,H),Pe(o),_(i||1),re(s||10),u=void 0,c=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],u=p,c="ascend"===a[p]?"ascend":"descend"),f=R?void 0:(null==fe?void 0:fe.uid)===O.zBg?"":null==fe?void 0:fe.uid,g=R||null==pe?void 0:pe.uid,m=l()(l()({},o),{},{orgUid:null==ce?void 0:ce.uid,kbUid:g,categoryUid:f,pageNumber:i?i-1:0,pageSize:s||10,superUser:R,sortBy:u,sortDirection:c}),e.next=16,(0,h.Az)(m);case 16:return x=e.sent,Y.Z.debug("queryArticlesByOrg response:",null==x?void 0:x.data,m),200===x.code&&Te(null==x?void 0:x.data.totalElements),e.abrupt("return",{data:null==x?void 0:x.data.content,success:200===x.code,total:null==x?void 0:x.data.totalElements});case 20:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()}),(0,B.jsx)(J,{open:ue,onClose:function(){de(!1)},onSubmit:He,helpcenter:se,isEdit:L}),De]})}}}]);