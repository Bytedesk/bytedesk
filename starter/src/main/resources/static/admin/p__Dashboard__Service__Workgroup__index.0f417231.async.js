"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{35912:function(e,t,n){n.d(t,{$l:function(){return p},M8:function(){return k},Xd:function(){return x},gf:function(){return M},lg:function(){return f},lz:function(){return b},p0:function(){return c}});var r=n(90819),o=n.n(r),a=n(73193),i=n.n(a),s=n(89933),l=n.n(s),u=n(6844),d=n(19736);function c(e){return g.apply(this,arguments)}function g(){return(g=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/query/org",{method:"GET",params:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return v.apply(this,arguments)}function v(){return(v=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/create",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/avatar",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/kbUid",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/update/prompt/text",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/robot/delete",{method:"POST",data:i()(i()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},38778:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ze}});var r=n(44194),o=n(31167),a=n(19736),i=n(76711),s=n.n(i),l=n(89957),u=n.n(l),d=n(90819),c=n.n(d),g=n(89933),f=n.n(g),v=n(73193),p=n.n(v),m=n(45332),b=n.n(m),h=n(85255),x=n(3925),w=n(9428),k=n(48769),S=n(71876),M=n(12792),y=n(66810),j=n(65513),T=n(77359),R=n(29337),Z=n(68779),C=n(12322),F=n(58087),P=n(32530),L=n(31806),W=n(34600),A=n(56482),q=n(12781),U=n(10162),E=n(90727),O=n(59304),I=n(54881),J=n(47944),z=n(80556),K=n(55785),V=n(79866),D=n(93527),N=n(64484),Q=n(14888),X=n(88449),B=n(26710),H=n(6844),G=n(61952),$=n(2061),Y=(n(47460),n(15012),n(42670)),_=n(23312),ee=n(1725),te=n(20585),ne=n(83281),re=n(21914),oe=n(10154),ae=n.n(oe),ie=n(35912),se=n(44679),le=n(30064),ue=n(22576),de=n(31928),ce=n(68263),ge=n(36125),fe=n(31549),ve=function(e){var t=e.variant,n=e.robotRoutingSettings,o=e.onRobotRoutingSettingsChange,a=le.A.useForm(),i=b()(a,1)[0],s=(0,r.useRef)(!1),l=(0,r.useState)([]),u=b()(l,2),d=u[0],g=u[1],v=(0,Q.u)((function(e){return e.currentOrg})),p=(0,se.Z)().translateString,m=(0,r.useMemo)((function(){var e;return null!==(e=null==n?void 0:n.draft)&&void 0!==e?e:null==n?void 0:n.live}),[n]);(0,r.useEffect)((function(){var e,n;if("workgroup"===t){var r=null!==(e=null==m?void 0:m.robotUid)&&void 0!==e?e:null==m||null===(n=m.robot)||void 0===n?void 0:n.uid;i.setFieldsValue({defaultRobot:null==m?void 0:m.defaultRobot,offlineRobot:null==m?void 0:m.offlineRobot,nonWorktimeRobot:null==m?void 0:m.nonWorktimeRobot,robotUid:r})}}),[t,m,i]);var h=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.current){e.next=3;break}return ge.Z.debug("isLoading: 1",s.current),e.abrupt("return");case 3:return s.current=!0,D.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:H.f4h,orgUid:null==v?void 0:v.uid},e.next=8,(0,ie.p0)(t);case 8:n=e.sent,ge.Z.debug("queryRobotsByOrg: ",n),200===n.code?g(null==n||null===(r=n.data)||void 0===r?void 0:r.content):D.yw.error(n.message),s.current=!1,D.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){h()}),[]);var x=function(){var e;null===(e=i.validateFields)||void 0===e||e.call(i,["robotUid"]).catch((function(){return null}))},w=function(e){return function(t){var n,r=!(null==t||null===(n=t.target)||void 0===n||!n.checked);null==o||o(ae()({},e,r)),x()}};return(0,fe.jsx)(le.A,{form:i,style:{marginLeft:"20px"},submitter:!1,children:"workgroup"===t&&(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(ue.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:w("defaultRobot")}}),(0,fe.jsx)(ue.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:w("offlineRobot")}}),(0,fe.jsx)(ue.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人",fieldProps:{onChange:w("nonWorktimeRobot")}}),(0,fe.jsx)(de.Z,{name:["defaultRobot","offlineRobot","nonWorktimeRobot"],children:function(e){var t=e.defaultRobot,n=e.offlineRobot,r=e.nonWorktimeRobot,a=!!(t||n||r);return(0,fe.jsx)(ce.Z,{name:"robotUid",label:"客服机器人",width:"md",options:d.map((function(e){return{value:e.uid,label:p(e.nickname)}})),rules:[{validator:function(e,t){return a&&!t?Promise.reject(new Error("请选择客服机器人")):Promise.resolve()}}],fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){null==o||o({robotUid:null!=e?e:void 0}),x()}}})}})]})})},pe=(n(81005),n(35165)),me=n(30813),be=n(58867),he=function(){var e=be.Z.useForm(),t=b()(e,1)[0],n=(0,a.useIntl)(),o=(0,G.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),i=o.currentWorkgroupSettings,s=o.setCurrentWorkgroupSettings,l=(0,r.useState)(H.vXk),u=b()(l,2),d=u[0],c=u[1];(0,r.useEffect)((function(){if(i){var e=i;c(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[i]);return(0,fe.jsx)("div",{children:(0,fe.jsxs)(le.A,{form:t,submitter:!1,children:[(0,fe.jsx)(me.Z.Group,{name:"routingMode",label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:H.vXk},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:H.ZD$},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:H.owQ},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:H.e2F},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:H.zWk},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:H.HQF},{label:(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:H.WDq}],fieldProps:{value:d,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),c(e.target.value)}(e),t=e.target.value,i&&s(p()(p()({},i),{},{routingMode:t}))}}}),(0,fe.jsxs)(le.A.Item,{children:[d===H.vXk&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),d===H.ZD$&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),d===H.owQ&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),d===H.e2F&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),d===H.zWk&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),d===H.HQF&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),d===H.JEC&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),d===H.WDq&&(0,fe.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},xe=n(58791),we=n(74341),ke=n(93312),Se=n(86684),Me=function(e){var t=e.robotToAgentSettings,n=e.onRobotToAgentSettingsChange,o=(0,a.useIntl)(),i=le.A.useForm(),s=b()(i,1)[0],l=(0,r.useRef)(!1),u=(0,r.useMemo)((function(){return null!=t?t:{}}),[t]),d=(0,r.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==u?void 0:u.draft)&&void 0!==t?t:null==u?void 0:u.live)&&void 0!==e?e:void 0}),[null==u?void 0:u.draft,null==u?void 0:u.live]),c=o.formatMessage({id:"robot.to.agent.manual.label.default",defaultMessage:"转人工客服"}),g=(0,r.useCallback)((function(e){return Array.from(new Set((null!=e?e:[]).map((function(e){return(null!=e?e:"").trim()})).filter((function(e){return e.length>0}))))}),[]),f=(0,r.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==n||n(e))}),[n]);(0,r.useEffect)((function(){var e,t,n,r,o,a,i,u,g;l.current=!0,s.setFieldsValue({enabled:null===(e=null==d?void 0:d.enabled)||void 0===e||e,keywordTriggerEnabled:null===(t=null==d?void 0:d.keywordTriggerEnabled)||void 0===t||t,triggerKeywords:null!==(n=null==d?void 0:d.triggerKeywords)&&void 0!==n?n:[],minConfidence:null!==(r=null==d?void 0:d.minConfidence)&&void 0!==r?r:65,maxRobotRepliesBeforeTransfer:null!==(o=null==d?void 0:d.maxRobotRepliesBeforeTransfer)&&void 0!==o?o:3,autoTransferDelaySeconds:null!==(a=null==d?void 0:d.autoTransferDelaySeconds)&&void 0!==a?a:0,cooldownSeconds:null!==(i=null==d?void 0:d.cooldownSeconds)&&void 0!==i?i:90,allowVisitorManualTransfer:null===(u=null==d?void 0:d.allowVisitorManualTransfer)||void 0===u||u,manualTransferLabel:null!==(g=null==d?void 0:d.manualTransferLabel)&&void 0!==g?g:c}),l.current=!1}),[d,s,c]);var v=(0,r.useCallback)((function(e){if(!l.current){var t=p()({},e);if("triggerKeywords"in e){var n=g(e.triggerKeywords);t.triggerKeywords=n,n.length!==(e.triggerKeywords||[]).length&&(l.current=!0,s.setFieldsValue({triggerKeywords:n}),l.current=!1)}if("manualTransferLabel"in e&&"string"==typeof e.manualTransferLabel){var r=e.manualTransferLabel.trim();t.manualTransferLabel=r,r!==e.manualTransferLabel&&(l.current=!0,s.setFieldsValue({manualTransferLabel:r}),l.current=!1)}f(t)}}),[f,s,g]),m=(0,r.useCallback)((function(e){var t=e.keys;return(0,fe.jsx)(we.Z,{type:"generic",keys:t,live:null==u?void 0:u.live,draft:null==u?void 0:u.draft})}),[null==u?void 0:u.draft,null==u?void 0:u.live]);return(0,fe.jsxs)(le.A,{layout:"vertical",form:s,submitter:!1,style:{marginLeft:"20px",maxWidth:640},onValuesChange:v,children:[(0,fe.jsx)(ke.Z,{width:"md",name:"enabled",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.enabled",defaultMessage:"启用机器人转人工策略"}),(0,fe.jsx)(m,{keys:["enabled"]})]})}),(0,fe.jsx)(de.Z,{name:["enabled"],children:function(e){var t=!1===e.enabled;return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(ke.Z,{width:"md",name:"keywordTriggerEnabled",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keyword.trigger",defaultMessage:"允许关键词触发"}),(0,fe.jsx)(m,{keys:["keywordTriggerEnabled"]})]}),tooltip:o.formatMessage({id:"robot.to.agent.keyword.trigger.tip",defaultMessage:"访客发送关键词时立即转人工"}),fieldProps:{disabled:t}}),(0,fe.jsx)(ce.Z,{width:"lg",name:"triggerKeywords",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.keywords",defaultMessage:"转人工关键词"}),(0,fe.jsx)(m,{keys:["triggerKeywords"]})]}),fieldProps:{mode:"tags",tokenSeparators:[",","，"," ",";","；","\n"],disabled:t||!1===s.getFieldValue("keywordTriggerEnabled"),placeholder:o.formatMessage({id:"robot.to.agent.keywords.placeholder",defaultMessage:"输入关键词并回车确认，可粘贴多个"})},extra:o.formatMessage({id:"robot.to.agent.keywords.extra",defaultMessage:"直接输入关键词，然后回车确认，可设置多个关键词"})}),(0,fe.jsx)(ke.Z,{width:"md",name:"allowVisitorManualTransfer",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.transfer",defaultMessage:"允许访客手动转人工"}),(0,fe.jsx)(m,{keys:["allowVisitorManualTransfer"]})]}),fieldProps:{disabled:t}}),(0,fe.jsx)(de.Z,{name:["allowVisitorManualTransfer"],children:function(e){return!1!==e.allowVisitorManualTransfer?(0,fe.jsx)(Se.Z,{width:"lg",name:"manualTransferLabel",label:(0,fe.jsxs)("span",{children:[o.formatMessage({id:"robot.to.agent.manual.label",defaultMessage:"手动转人工按钮文案"}),(0,fe.jsx)(m,{keys:["manualTransferLabel"]})]}),fieldProps:{maxLength:20,disabled:t},placeholder:o.formatMessage({id:"robot.to.agent.manual.label.placeholder",defaultMessage:"如：转人工客服"})}):null}})]})}})]})},ye=n(65819),je="tips",Te=function(){var e=(0,a.useIntl)(),t=(0,Q.u)((function(e){return e.currentOrg})),n=(0,X.Z)().leftSiderStyle,i=(0,B.Z)().isDarkMode,l=(0,r.useState)(!1),d=b()(l,2),g=d[0],v=d[1],m=(0,r.useState)([]),H=b()(m,2),oe=H[0],ae=H[1],ie=(0,r.useState)(),se=b()(ie,2),le=se[0],ue=se[1],de=(0,r.useState)(""),ce=b()(de,2),me=ce[0],be=ce[1],we=(0,r.useState)(je),ke=b()(we,2),Se=ke[0],Te=ke[1],Re=(0,r.useState)(!1),Ze=b()(Re,2),Ce=Ze[0],Fe=Ze[1],Pe=(0,r.useState)(null),Le=b()(Pe,2),We=Le[0],Ae=Le[1],qe=(0,r.useMemo)((function(){return oe.find((function(e){return e.uid===le}))||null}),[oe,le]),Ue=(0,r.useState)(!1),Ee=b()(Ue,2),Oe=Ee[0],Ie=Ee[1],Je=(0,r.useState)(!1),ze=b()(Je,2),Ke=ze[0],Ve=ze[1],De=(0,r.useState)(!1),Ne=b()(De,2),Qe=Ne[0],Xe=Ne[1],Be=(0,r.useRef)(""),He=(0,G.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Ge=He.setCurrentWorkgroupSettings,$e=He.currentWorkgroupSettings,Ye=(0,r.useMemo)((function(){var e;return null!==(e=null!=$e?$e:qe)&&void 0!==e?e:null}),[$e,qe]),_e=(0,r.useCallback)((function(e){if($e){var t=$e.draftServiceSettings||$e.serviceSettings||{};Ge(p()(p()({},$e),{},{draftServiceSettings:p()(p()({},t),e)}))}}),[$e,Ge]),et=(0,r.useCallback)((function(e){if($e){var t=$e.draftInviteSettings||$e.inviteSettings||{};Ge(p()(p()({},$e),{},{draftInviteSettings:p()(p()({},t),e)}))}}),[$e,Ge]),tt=(0,r.useCallback)((function(e){if($e){var t=$e.draftMessageLeaveSettings||$e.messageLeaveSettings||{};Ge(p()(p()({},$e),{},{draftMessageLeaveSettings:p()(p()({},t),e)}))}}),[$e,Ge]),nt=(0,r.useCallback)((function(e){if($e){var t=$e.draftWorktimeSettings||$e.worktimeSettings||{};Ge(p()(p()({},$e),{},{draftWorktimeSettings:p()(p()({},t),e)}))}}),[$e,Ge]),rt=(0,r.useCallback)((function(e){if($e){var t=$e.draftRobotRoutingSettings||$e.robotRoutingSettings||{};Ge(p()(p()({},$e),{},{draftRobotRoutingSettings:p()(p()({},t),e)}))}}),[$e,Ge]),ot=(0,r.useCallback)((function(e){if($e){var t=$e.draftQueueSettings||$e.queueSettings||{};Ge(p()(p()({},$e),{},{draftQueueSettings:p()(p()({},t),e)}))}}),[$e,Ge]),at=(0,r.useCallback)((function(e){if($e){var t=$e.draftRobotToAgentSettings||$e.robotToAgentSettings||{};Ge(p()(p()({},$e),{},{draftRobotToAgentSettings:p()(p()({},t),e)}))}}),[$e,Ge]),it=(0,r.useMemo)((function(){if(!me)return oe;var e=me.toLowerCase();return oe.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[oe,me]),st=(0,r.useCallback)(function(){var e=f()(c()().mark((function e(n,r){var o,a,i,s,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,a=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:a||void 0},e.next=8,(0,N.zc)(i);case 8:s=e.sent,ge.Z.debug("加载工作组配置模板列表: ",null==s?void 0:s.data,i),l=(null==s||null===(o=s.data)||void 0===o?void 0:o.content)||[],ae(l),!(l.length>0)||le&&l.some((function(e){return e.uid===le}))||(ue(l[0].uid),null!=r&&r.keepActive||Te(je));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,le]),lt=(0,r.useCallback)((function(e){st(null!=e?e:me)}),[st,me]);(0,r.useEffect)((function(){st(me)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){qe?(Ge(qe),Be.current=JSON.stringify(null!=qe?qe:{}),Xe(!1)):(Ge(null),Be.current=JSON.stringify({}),Xe(!1))}),[null==qe?void 0:qe.uid]),(0,r.useEffect)((function(){if(qe)try{var e=JSON.stringify(null!=$e?$e:{});Xe(e!==Be.current)}catch(e){Xe(!0)}}),[$e,null==qe?void 0:qe.uid]);var ut=function(){var n=f()(c()().mark((function n(r){var o,a,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(o=null!=r?r:qe)&&o.uid){n.next=3;break}return n.abrupt("return");case 3:return a={uid:o.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,N.zN)(a);case 6:(i=n.sent)&&200===i.code?(D.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),st(me)):D.yw.error((null==i?void 0:i.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),dt=function(){var n=f()(c()().mark((function n(r,o){var a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,N.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:o});case 3:(a=n.sent)&&200===a.code?(D.yw.success(e.formatMessage({id:o?"common.enabled":"common.disabled",defaultMessage:o?"已启用":"已停用"})),st(me)):D.yw.error((null==a?void 0:a.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),D.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),ct=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},gt=function(e){return!e||"object"!==u()(e)||0===Object.keys(e).length},ft=function(e){if(e){var t=ct(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return ct(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return p()(p()({},t),n?{toolbar:n}:{})}},vt=function(e){if(e)return ct(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},pt=function(e){if(e)return ct(e,["name","description","color","order"])},mt=function(e){if(e)return ct(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},bt=function(e){if(e)return ct(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},ht=function(e){if(e){var t=ct(e,["enabled","keywordTriggerEnabled","triggerKeywords","minConfidence","maxRobotRepliesBeforeTransfer","autoTransferDelaySeconds","cooldownSeconds","allowVisitorManualTransfer","manualTransferLabel"]),n=p()({},t);return Array.isArray(n.triggerKeywords)&&(n.triggerKeywords=Array.from(new Set(n.triggerKeywords.map((function(e){return(e||"").trim()})).filter((function(e){return e.length>0}))))),"string"==typeof n.manualTransferLabel&&(n.manualTransferLabel=n.manualTransferLabel.trim()),n}},xt=function(e){var t,n;if(e){var r=ct(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),o=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return p()(p()({},r),o?{robotUid:o}:{})}},wt=function(e){if(e)return ct(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},kt=function(){var n=f()(c()().mark((function n(){var r,o,a,i,s,l,u,d,g,f,v,m,b,h;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=qe&&qe.uid){n.next=3;break}return D.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Ie(!0),n.prev=4,r=$e&&$e.uid===qe.uid?$e:qe,a=ft((o=function(e,t){return p()(p()({},e||{}),t||{})})(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),i=vt(o(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),s=pt(o(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),l=mt(o(null==r?void 0:r.messageLeaveSettings,null==r?void 0:r.draftMessageLeaveSettings)),u=wt(o(null==r?void 0:r.worktimeSettings,null==r?void 0:r.draftWorktimeSettings)),d=xt(o(null==r?void 0:r.robotRoutingSettings,null==r?void 0:r.draftRobotRoutingSettings)),g=bt(o(null==r?void 0:r.queueSettings,null==r?void 0:r.draftQueueSettings)),f=ht(o(null==r?void 0:r.robotToAgentSettings,null==r?void 0:r.draftRobotToAgentSettings)),v=p()(p()(p()(p()(p()(p()(p()(p()({uid:qe.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode},gt(a)?{}:{serviceSettings:a}),gt(i)?{}:{inviteSettings:i}),gt(s)?{}:{intentionSettings:s}),gt(l)?{}:{messageLeaveSettings:l}),gt(u)?{}:{worktimeSettings:u}),gt(d)?{}:{robotRoutingSettings:d}),gt(g)?{}:{queueSettings:g}),gt(f)?{}:{robotToAgentSettings:f}),n.next=18,(0,N.Y2)(v);case 18:m=n.sent,console.log("保存工作组配置模板: ",m,v),m&&200===m.code?(D.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Be.current=JSON.stringify(null!==(b=null!==(h=null==m?void 0:m.data)&&void 0!==h?h:r)&&void 0!==b?b:{}),Xe(!1),st(me,{keepActive:!0})):D.yw.error((null==m?void 0:m.message)||"保存失败"),n.next=27;break;case 23:n.prev=23,n.t0=n.catch(4),console.error("保存失败:",n.t0),D.yw.error("保存失败");case 27:return n.prev=27,Ie(!1),n.finish(27);case 30:case"end":return n.stop()}}),n,null,[[4,23,27,30]])})));return function(){return n.apply(this,arguments)}}(),St=function(){var n=f()(c()().mark((function n(){var r,o,a;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=qe&&qe.uid){n.next=3;break}return D.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Ve(!0),n.prev=4,!Qe){n.next=8;break}return n.next=8,kt();case 8:return r={uid:qe.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,N.Dm)(r);case 11:(o=n.sent)&&200===o.code?(D.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Be.current=JSON.stringify(null!==(a=null==o?void 0:o.data)&&void 0!==a?a:{}),Xe(!1),st(me)):D.yw.error((null==o?void 0:o.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),D.yw.error("发布失败");case 19:return n.prev=19,Ve(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),Mt=(0,r.useMemo)((function(){return null!=qe&&qe.uid?[{key:"tips",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(R.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,fe.jsx)(ee.Z,{variant:"workgroup",serviceSettings:{live:null==Ye?void 0:Ye.serviceSettings,draft:null==Ye?void 0:Ye.draftServiceSettings},onServiceSettingsChange:_e})},{key:"service",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(Z.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"})]}),children:(0,fe.jsx)(_.Z,{variant:"workgroup",serviceSettings:{live:null==Ye?void 0:Ye.serviceSettings,draft:null==Ye?void 0:Ye.draftServiceSettings},onServiceSettingsChange:_e})}].concat(s()((0,ye.OJ)()?[{key:"rate",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(C.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,fe.jsx)(re.Z,{variant:"workgroup",serviceSettings:{live:null==Ye?void 0:Ye.serviceSettings,draft:null==Ye?void 0:Ye.draftServiceSettings},onServiceSettingsChange:_e})}]:[]),[{key:"robot",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(F.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"robot",defaultMessage:"Robot"})]}),children:(0,fe.jsx)(ve,{variant:"workgroup",robotRoutingSettings:{live:null==Ye?void 0:Ye.robotRoutingSettings,draft:null==Ye?void 0:Ye.draftRobotRoutingSettings},onRobotRoutingSettingsChange:rt})}],s()((0,ye.OJ)()?[{key:"robotToAgent",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(P.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"robotToAgent",defaultMessage:"Robot to Agent"})]}),children:(0,fe.jsx)(Me,{variant:"workgroup",robotToAgentSettings:{live:null==Ye?void 0:Ye.robotToAgentSettings,draft:null==Ye?void 0:Ye.draftRobotToAgentSettings},onRobotToAgentSettingsChange:at})}]:[]),s()((0,ye.OJ)()?[{key:"messageLeave",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(L.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,fe.jsx)(te.Z,{variant:"workgroup",messageLeaveSettings:{live:null==Ye?void 0:Ye.messageLeaveSettings,draft:null==Ye?void 0:Ye.draftMessageLeaveSettings},onMessageLeaveSettingsChange:tt})}]:[]),s()((0,ye.OJ)()?[{key:"queue",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(xe.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"workgroup.settings.queue",defaultMessage:"排队设置"})]}),children:(0,fe.jsx)(pe.Z,{variant:"workgroup",queueSettings:{live:null==Ye?void 0:Ye.queueSettings,draft:null==Ye?void 0:Ye.draftQueueSettings},onQueueSettingsChange:ot})}]:[]),s()([]),s()((0,ye.OJ)()?[{key:"toolbar",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(W.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,fe.jsx)(Y.Z,{variant:"workgroup",serviceSettings:{live:null==Ye?void 0:Ye.serviceSettings,draft:null==Ye?void 0:Ye.draftServiceSettings},settingsUid:qe.uid,isActive:"toolbar"===Se,onServiceSettingsChange:_e})}]:[]),s()((0,ye.OJ)()?[{key:"right",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(A.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,fe.jsx)($.Z,{variant:"workgroup",serviceSettings:{live:null==Ye?void 0:Ye.serviceSettings,draft:null==Ye?void 0:Ye.draftServiceSettings},onServiceSettingsChange:_e,settingsUid:qe.uid,isActive:"right"===Se})}]:[]),s()([]),[{key:"route",label:(0,fe.jsxs)("span",{children:[(0,fe.jsx)(q.Z,{})," ",(0,fe.jsx)(a.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"})]}),children:(0,fe.jsx)(he,{})}],s()([])):[]}),[null==qe?void 0:qe.uid,Ye,e,_e,et,tt,rt,at,nt,ot,Se]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)(h.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,fe.jsx)(h.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,fe.jsxs)(V.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,fe.jsx)(x.ZP,{size:"small",icon:(0,fe.jsx)(U.Z,{}),type:"primary",onClick:function(){Ae(null),Fe(!0)},children:(0,fe.jsx)(a.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,fe.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,fe.jsxs)(w.Z.Compact,{style:{width:"100%"},children:[(0,fe.jsx)(k.Z,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:me,onChange:function(e){return be(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;be(t),lt(t)},allowClear:!0,size:"middle"}),(0,fe.jsx)(x.ZP,{type:"primary",icon:(0,fe.jsx)(E.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return lt()}})]})}),(0,fe.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,fe.jsx)(S.Z,{dataSource:it,locale:{emptyText:(0,fe.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,fe.jsx)(S.Z.Item,{style:le===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ue(e.uid)},children:(0,fe.jsx)(S.Z.Item.Meta,{title:(0,fe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,fe.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,fe.jsx)(w.Z,{size:4,children:e.isDefault?(0,fe.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,fe.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,fe.jsx)(h.Z.Panel,{children:qe?(0,fe.jsx)(V.Z,{title:(0,fe.jsxs)(w.Z,{children:[(0,fe.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",qe.name||qe.uid]}),(0,fe.jsx)(j.Z,{checked:!!qe.enabled,onChange:function(e){return dt(qe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,fe.jsx)(x.ZP,{size:"small",icon:(0,fe.jsx)(O.Z,{}),onClick:function(e){var t;e.stopPropagation(),Ae(null!=(t=qe)?t:qe),Fe(!0)},children:"编辑"}),(0,fe.jsx)(T.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),ut(qe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,fe.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,fe.jsx)(I.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),qe.isDefault?(0,fe.jsx)(y.Z,{color:"blue",children:"默认"}):null]}),extra:(0,fe.jsxs)(w.Z,{children:[(0,fe.jsx)(T.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),St()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,fe.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ke,type:"default",icon:(0,fe.jsx)(J.Z,{}),children:(0,fe.jsx)(a.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,fe.jsx)(x.ZP,{onClick:function(){qe&&(Ge(qe),Be.current=JSON.stringify(null!=qe?qe:{}),Xe(!1))},disabled:!Qe,icon:(0,fe.jsx)(z.Z,{}),children:(0,fe.jsx)(a.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,fe.jsx)(x.ZP,{type:"primary",loading:Oe,onClick:kt,disabled:!Qe,icon:(0,fe.jsx)(K.Z,{}),children:(0,fe.jsx)(a.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,fe.jsx)(o.Z,{activeKey:Se,onChange:Te,items:Mt})}):(0,fe.jsx)(V.Z,{children:(0,fe.jsx)(M.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,fe.jsx)(ne.Z,{open:Ce,onOpenChange:Fe,orgUid:(null==t?void 0:t.uid)||"",record:We,onSuccess:function(){Fe(!1),st(me)}})]})},Re=n(55141),Ze=function(){return(0,fe.jsx)(o.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,fe.jsx)(a.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,fe.jsx)(Re.Z,{})},{key:"settings",label:(0,fe.jsx)(a.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,fe.jsx)(Te,{})}]})}}}]);