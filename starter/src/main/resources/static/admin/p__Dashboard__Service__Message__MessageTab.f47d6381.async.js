"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8166],{16973:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ie}});var s=a(97244),r=a(8247),n=a(55735),o=a(84176),i=a.n(o),l=a(73193),d=a.n(l),c=a(86222),u=a.n(c),g=a(90819),f=a.n(g),p=a(89933),m=a.n(p),h=a(45332),x=a.n(h),M=a(86803),y=a(76750),v=a(40612),w=a(36310),j=a(54881),b=a(11090),k=a(2484),S=a(81947),F=a(30921),I=a(29266),T=a(61355),Z=a(53530),A=a(96485),C=a(75365),D=a(44194);function R(e){return E.apply(this,arguments)}function E(){return(E=m()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.request)("/api/v1/robot/message/query/org",{method:"GET",params:d()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=a(31549),U=["current","pageSize"],q={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},O=function(){var e=(0,F.useIntl)(),t=(0,D.useRef)(),a=(0,y.Z)().translateString,s=(0,v.u)((function(e){return e.currentOrg})),r=(0,D.useState)(1),o=x()(r,2),l=o[0],c=o[1],g=(0,D.useState)(10),p=x()(g,2),h=p[0],E=p[1],O=(0,D.useState)([]),z=x()(O,2),B=z[0],L=z[1],P=(0,D.useState)([]),Y=x()(P,2),H=Y[0],K=Y[1],_=(0,D.useState)(0),W=x()(_,2),G=W[0],V=W[1],Q=(0,D.useState)({}),J=x()(Q,2),$=J[0],X=J[1],ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var s;return(0,N.jsx)(N.Fragment,{children:a(null==t||null===(s=t.user)||void 0===s?void 0:s.nickname)})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var s;return(0,N.jsx)(N.Fragment,{children:a(null==t||null===(s=t.robot)||void 0===s?void 0:s.nickname)})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.answer.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=q[a]||{text:a,color:"default"};return(0,N.jsx)(I.Z,{color:s.color,children:s.text||a})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,N.jsx)(N.Fragment,{children:t.rateDownTagList.map((function(e){return(0,N.jsx)(I.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,s,r){return[(0,N.jsx)("a",{onClick:function(){te(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,N.jsx)(T.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==a?void 0:a.uid,"】？"),onConfirm:function(){return ae(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],te=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==s?void 0:s.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ae=function(){var a=m()(f()().mark((function a(s){var r;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",s),M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(r=t.current)||void 0===r||r.reload()}catch(t){M.yw.destroy(),M.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),se=function(){var a=m()(f()().mark((function a(){var s,r,n,o;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==H.length){a.next=3;break}return M.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=u()(H);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}M.yw.destroy(),0===r?M.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),L([]),K([]),null===(s=t.current)||void 0===s||s.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),re=function(){var e=m()(f()().mark((function e(t,a,r){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),o=localStorage.getItem(n.LA8),i=d()({orgUid:(null==s?void 0:s.uid)||"",accessToken:o||"",exportType:t},$),"current"===t?(i.pageNumber=String(l-1),i.pageSize=String(h)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(i.pageNumber=String(a),i.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ne=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return re("range",s,a)}})},n=0;n<s;n++)r();return t},oe={selectedRowKeys:B,onChange:function(e,t){L(e),K(t)}};return(0,N.jsx)(S.Z,{columns:ee,actionRef:t,cardBordered:!0,rowSelection:oe,scroll:{x:2e3},request:function(){var e=m()(f()().mark((function e(t,a,r){var n,o,l,u,g,p,m,h;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,o=t.pageSize,l=i()(t,U),c(n),E(o),X(l),u=void 0,g=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],u=p,g="ascend"===a[p]?"ascend":"descend"),m=d()(d()({pageNumber:n-1,pageSize:o,orgUid:null==s?void 0:s.uid},l),{},{sortBy:u,sortDirection:g}),e.next=11,R(m);case 11:return h=e.sent,console.log("getAllRobotMessages response:",m,h),200===h.code?V(h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return function(){var t=[],a=[];B.length>0&&a.push({key:"batchDelete",icon:(0,N.jsx)(j.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(B.length,")"),onClick:function(){Z.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(B.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:se,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return re("current")}}];return G>0&&(G<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return re("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ne(G)})),t.push((0,N.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(C.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(k.Z,{})]},"button")},"export")),a.length>0&&t.push((0,N.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,N.jsxs)(C.ZP,{type:B.length>0?"primary":"default",danger:B.length>0,children:[B.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(B.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(k.Z,{})]})},"batchOperations")),t}()}})},z=a(10154),B=a.n(z);function L(e){return P.apply(this,arguments)}function P(){return(P=m()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.request)("/api/v1/message/leave/query/org",{method:"GET",params:d()(d()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return H.apply(this,arguments)}function H(){return(H=m()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.request)("/api/v1/message/leave/reply",{method:"POST",data:d()(d()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=a(28977),_=a.n(K),W=a(88721),G=a(76711),V=a.n(G),Q=a(10162),J=a(36693),$=a(69169),X=a(32350),ee=a(32327),te=a(16309),ae=a(73442),se=a(3849),re=a(62673),ne=a(32943),oe=a(30348),ie=a(20045),le=ee.Z.Title,de=ee.Z.Paragraph,ce=ee.Z.Text,ue=function(e){var t,a=e.visible,s=e.onClose,r=e.messageLeave,o=e.onSuccess,i=(0,F.useIntl)(),l=te.Z.useForm(),c=x()(l,1)[0],u=(0,D.useState)(!1),g=x()(u,2),p=g[0],h=g[1],y=(0,D.useState)(!1),v=x()(y,2),j=v[0],b=v[1],k=(0,D.useState)([]),S=x()(k,2),I=S[0],T=S[1],A=(0,D.useState)([]),R=x()(A,2),E=R[0],U=R[1],q=(0,D.useState)(!1),O=x()(q,2),z=O[0],B=O[1],L=(0,D.useState)(""),P=x()(L,2),H=P[0],K=P[1],G=(0,D.useState)(""),ee=x()(G,2),ue=ee[0],ge=ee[1];(0,D.useEffect)((function(){if(r&&r.reply)if(c.setFieldsValue({reply:r.reply}),b(!0),r.replyImages&&r.replyImages.length>0){var e=r.replyImages.filter((function(e){return""!==e}));U(e),T(e.map((function(e,t){return{uid:"-".concat(t),name:"image-".concat(t,".png"),status:"done",url:e,thumbUrl:e}})))}else U([]),T([]);else c.resetFields(),b(!1),U([]),T([])}),[r,c]);var fe=function(){var e=m()(f()().mark((function e(t){var a,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,h(!0),a={uid:r.uid,reply:t.reply,replyImages:E,orgUid:r.orgUid},e.next=7,Y(a);case 7:n=e.sent,console.log("回复留言:",n.data),200===n.code?(M.yw.success(i.formatMessage({id:"reply.success",defaultMessage:"回复成功"})),c.resetFields(),U([]),T([]),o(),s()):M.yw.error(n.message||i.formatMessage({id:"reply.failed",defaultMessage:"回复失败"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("回复留言出错:",e.t0),M.yw.error(i.formatMessage({id:"reply.error",defaultMessage:"回复出错"}));case 16:return e.prev=16,h(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e){return!e||0===e.length||1===e.length&&""===e[0]?null:(0,N.jsxs)("div",{style:{marginTop:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"images",defaultMessage:"图片"}),":"]}),(0,N.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:e.map((function(e,t){return e?(0,N.jsx)("img",{src:e,alt:"留言图片",style:{width:"100px",height:"100px",objectFit:"cover",cursor:"pointer"},onClick:function(){return me({url:e,uid:"img-".concat(t),name:"图片 ".concat(t+1)})}},t):null}))})]})},me=function(){var e=m()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K(t.url||t.thumbUrl),B(!0),ge(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=(0,N.jsx)(C.ZP,{icon:(0,N.jsx)(Q.Z,{}),children:(0,N.jsx)(F.FormattedMessage,{id:"upload",defaultMessage:"上传"})}),xe={name:"file",accept:"image/*",action:(0,w.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(n.LA8)},listType:"picture-card",fileList:I,onPreview:me,onChange:function(e){var t=V()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var a=e.file.response.data.fileUrl;E.includes(a)||U((function(e){return[].concat(V()(e),[a])})),M.yw.success(i.formatMessage({id:"upload.success",defaultMessage:"上传 {filename} 成功"},{filename:e.file.name}))}else M.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name})+": ".concat(e.file.response.message));else"error"===e.file.status&&M.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name}));t=t.map((function(e){return e.response&&200===e.response.code?d()(d()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),T(t)},data:function(e){var t=_()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return console.log("uploadProps",t),{file:e,fileName:t,fileType:e.type,isAvatar:"false",kbType:n.IrL,categoryUid:"",kbUid:"",client:n.bVn}},onRemove:function(e){if(console.log("onRemove",e),"done"===e.status&&e.response&&e.response.data){var t=e.response.data.fileUrl;U((function(e){return e.filter((function(e){return e!==t}))}))}return e.url&&U((function(t){return t.filter((function(t){return t!==e.url}))})),!0}};return(0,N.jsx)(ae.Z,{title:i.formatMessage({id:"leave.message.reply",defaultMessage:"回复留言"}),width:600,placement:"right",onClose:s,open:a,styles:{body:{paddingBottom:80}},extra:(0,N.jsx)(se.Z,{children:(0,N.jsx)(C.ZP,{onClick:s,children:(0,N.jsx)(F.FormattedMessage,{id:"cancel",defaultMessage:"取消"})})}),children:r&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(re.Z,{bordered:!1,style:{marginBottom:"20px"},children:[(0,N.jsx)(le,{level:5,children:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.details",defaultMessage:"留言详情"})}),(0,N.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",(null===(t=r.user)||void 0===t?void 0:t.nickname)||"-"]}),(0,N.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"contact",defaultMessage:"联系方式"}),":"]})," ",r.contact||"-"]}),(0,N.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"内容"}),":"]}),(0,N.jsx)(de,{style:{marginTop:"8px"},children:r.content})]}),pe(r.images||[]),r.reply&&(0,N.jsxs)("div",{style:{marginTop:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"replied.content",defaultMessage:"回复内容"}),":"]}),(0,N.jsx)(de,{style:{marginTop:"8px"},children:r.reply})]}),r.replyImages&&r.replyImages.length>0&&(0,N.jsxs)("div",{style:{marginTop:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),":"]}),pe(r.replyImages||[])]}),(0,N.jsxs)("div",{style:{marginTop:"10px"},children:[(0,N.jsxs)(ce,{strong:!0,children:[(0,N.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"状态"}),":"]})," ",(0,W.It)(r.status)]})]}),j&&(0,N.jsx)(ne.Z,{type:"warning",showIcon:!0,message:i.formatMessage({id:"reply.exists.warning",defaultMessage:"已回复，继续回复仅更新已有回复"}),style:{marginBottom:"16px"}}),(0,N.jsxs)($.A,{form:c,onFinish:fe,submitter:{render:function(e,t){return(0,N.jsx)("div",{style:{textAlign:"right",marginTop:"24px"},children:(0,N.jsx)(C.ZP,{type:"primary",icon:(0,N.jsx)(J.Z,{}),loading:p,onClick:function(){return c.submit()},children:(0,N.jsx)(F.FormattedMessage,{id:"reply",defaultMessage:"回复"})})})}},children:[(0,N.jsx)(X.Z,{name:"reply",label:i.formatMessage({id:"reply.content",defaultMessage:"回复内容"}),placeholder:i.formatMessage({id:"please.enter.reply",defaultMessage:"请输入回复内容"}),rules:[{required:!0,message:i.formatMessage({id:"reply.content.required",defaultMessage:"请输入回复内容"})}],fieldProps:{rows:6}}),(0,N.jsxs)(te.Z.Item,{label:i.formatMessage({id:"reply.images",defaultMessage:"回复图片"}),children:[(0,N.jsx)(oe.Z,d()(d()({},xe),{},{children:he})),(0,N.jsx)(Z.Z,{open:z,title:ue,footer:null,onCancel:function(){return B(!1)},children:(0,N.jsx)(ie.Z,{alt:"预览图片",style:{width:"100%"},src:H})})]})]})]})})},ge=["current","pageSize"],fe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,width:300,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.contact.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,ellipsis:!0,width:300,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.content.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.images.tooltip"}),render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,N.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,N.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,N.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,width:120,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.status.tooltip"}),valueType:"select",valueEnum:B()(B()(B()(B()(B()(B()(B()(B()(B()({},n.d23,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),n.m7i,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),n.d3_,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),n.oLW,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),n.KBB,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),n.v3R,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),n.uke,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),n.fEl,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),n.K0y,{text:(0,N.jsx)(F.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,W.It)(t.status)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"reply",defaultMessage:"Reply"}),dataIndex:"reply",copyable:!0,hideInSearch:!0,ellipsis:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.reply.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),dataIndex:"replyImages",copyable:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.replyImages.tooltip"}),render:function(e,t,a,s){return!t.replyImages||0===t.replyImages.length||1===t.replyImages.length&&""===t.replyImages[0]?(0,N.jsx)("span",{children:"-"}):t.replyImages.map((function(e,t){return e?(0,N.jsx)("img",{src:e,alt:"reply image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,N.jsx)(F.FormattedMessage,{id:"reply.user",defaultMessage:"回复人员"}),dataIndex:"replyUserNickname",hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.replyUser.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:(null==t||null===(a=t.replyUser)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"repliedAt",defaultMessage:"回复时间"}),key:"repliedAt",dataIndex:"repliedAt",sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.repliedAt.tooltip"}),render:function(e,t,a,s){return t.repliedAt?_()(t.repliedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,N.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.createdAt.tooltip"}),render:function(e,t,a,s){return _()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,N.jsx)(F.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"leave.message.updatedAt.tooltip"}),render:function(e,t,a,s){return t.updatedAt?_()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],pe=function(){var e=(0,F.useIntl)(),t=(0,D.useRef)(),a=(0,D.useState)(1),s=x()(a,2),r=s[0],o=s[1],l=(0,D.useState)(10),c=x()(l,2),g=c[0],p=c[1],h=(0,v.u)((function(e){return e.currentOrg})),y=(0,D.useState)(!1),I=x()(y,2),R=I[0],E=I[1],U=(0,D.useState)(),q=x()(U,2),O=q[0],z=q[1],B=(0,D.useState)([]),P=x()(B,2),Y=P[0],H=P[1],K=(0,D.useState)([]),_=x()(K,2),W=_[0],G=_[1],V=(0,D.useState)(0),Q=x()(V,2),J=Q[0],$=Q[1],X=(0,D.useState)({}),ee=x()(X,2),te=ee[0],ae=ee[1],se=[].concat(fe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(t,a,s,r){return[(0,N.jsx)("a",{onClick:function(){re(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,N.jsx)("a",{onClick:function(){ne(a)},children:e.formatMessage({id:"handle",defaultMessage:"Handle"})},"handle"),(0,N.jsx)(T.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==a?void 0:a.uid,"】？"),onConfirm:function(){return oe(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),re=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==h?void 0:h.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ne=function(e){console.log("handleProcess",e),z(e),E(!0)},oe=function(){var a=m()(f()().mark((function a(s){var r;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",s),M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(r=t.current)||void 0===r||r.reload()}catch(t){M.yw.destroy(),M.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),ie=function(){var a=m()(f()().mark((function a(){var s,r,n,o;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==W.length){a.next=3;break}return M.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=u()(W);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}M.yw.destroy(),0===r?M.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),H([]),G([]),null===(s=t.current)||void 0===s||s.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),le=function(){var e=m()(f()().mark((function e(t,a,s){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),o=localStorage.getItem(n.LA8),i=d()({orgUid:(null==h?void 0:h.uid)||"",accessToken:o||"",exportType:t},te),"current"===t?(i.pageNumber=String(r-1),i.pageSize=String(g)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(i.pageNumber=String(a),i.pageSize=String(s)),window.open((0,w.kG)()+"/api/v1/message/leave/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),de=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return le("range",s,a)}})},n=0;n<s;n++)r();return t},ce={selectedRowKeys:Y,onChange:function(e,t){H(e),G(t)}};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(S.Z,{columns:se,actionRef:t,cardBordered:!0,rowSelection:ce,scroll:{x:2500},request:function(){var e=m()(f()().mark((function e(t,a,s){var r,n,l,c,u,g,m,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,l=i()(t,ge),o(r),p(n),ae(l),c=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],c=g,u="ascend"===a[g]?"ascend":"descend"),m=d()(d()({pageNumber:r-1,pageSize:n,orgUid:null==h?void 0:h.uid},l),{},{sortBy:c,sortDirection:u}),e.next=10,L(m);case 10:return x=e.sent,console.log("queryLeaveMsgsByOrg response:",x,m),200===x.code?$(x.data.totalElements):M.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"留言记录",toolBarRender:function(){return function(){var t=[],a=[];Y.length>0&&a.push({key:"batchDelete",icon:(0,N.jsx)(j.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(Y.length,")"),onClick:function(){Z.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(Y.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:ie,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return le("current")}}];return J>0&&(J<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(J,"条)"),onClick:function(){return le("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(J,"条)"),children:de(J)})),t.push((0,N.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(C.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(k.Z,{})]},"button")},"export")),a.length>0&&t.push((0,N.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,N.jsxs)(C.ZP,{type:Y.length>0?"primary":"default",danger:Y.length>0,children:[Y.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Y.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(k.Z,{})]})},"batchOperations")),t}()}}),(0,N.jsx)(ue,{visible:R,onClose:function(){E(!1)},messageLeave:O,onSuccess:function(){var e;null===(e=t.current)||void 0===e||e.reload()}})]})};function me(e){return he.apply(this,arguments)}function he(){return(he=m()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.request)("/api/v1/message/rating/query/org",{method:"GET",params:d()(d()({},t),{},{client:n.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xe=["current","pageSize"],Me={ROBOT:{text:"机器人",color:"blue"},AGENT:{text:"人工客服",color:"green"},FAQ:{text:"常见问题",color:"purple"}},ye={RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.answer.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.question.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.fromType"}),dataIndex:"fromType",ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.fromType.tooltip"}),render:function(e,t){var a=t.fromType||"",s=Me[a]||{text:a,color:"default"};return(0,N.jsx)(I.Z,{color:s.color,children:s.text||a})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=ye[a]||{text:a,color:"default"};return(0,N.jsx)(I.Z,{color:s.color,children:s.text||a})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.tags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,N.jsx)(N.Fragment,{children:t.rateDownTagList.map((function(e){return(0,N.jsx)(I.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.reason.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"faq.rating.user",defaultMessage:"用户"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,s){return t.createdAt?_()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],we=function(){var e=(0,F.useIntl)(),t=(0,D.useRef)(),a=(0,D.useState)(1),s=x()(a,2),r=s[0],o=s[1],l=(0,D.useState)(10),c=x()(l,2),g=c[0],p=c[1],h=(0,v.u)((function(e){return e.currentOrg})),y=(0,D.useState)([]),I=x()(y,2),R=I[0],E=I[1],U=(0,D.useState)([]),q=x()(U,2),O=q[0],z=q[1],B=(0,D.useState)(0),L=x()(B,2),P=L[0],Y=L[1],H=(0,D.useState)({}),K=x()(H,2),_=K[0],W=K[1],G=[].concat(ve,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,s,r){return[(0,N.jsx)("a",{onClick:function(){V(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,N.jsx)(T.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==a?void 0:a.uid,"】？"),onConfirm:function(){return Q(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),V=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==h?void 0:h.uid,t:n.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Q=function(){var a=m()(f()().mark((function a(s){var r;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",s),M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(r=t.current)||void 0===r||r.reload()}catch(t){M.yw.destroy(),M.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),J=function(){var a=m()(f()().mark((function a(){var s,r,n,o;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==O.length){a.next=3;break}return M.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:M.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=u()(O);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}M.yw.destroy(),0===r?M.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),E([]),z([]),null===(s=t.current)||void 0===s||s.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),$=function(){var e=m()(f()().mark((function e(t,a,s){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),o=localStorage.getItem(n.LA8),i=d()({orgUid:(null==h?void 0:h.uid)||"",accessToken:o||"",exportType:t},_),"current"===t?(i.pageNumber=String(r-1),i.pageSize=String(g)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(i.pageNumber=String(a),i.pageSize=String(s)),window.open((0,w.kG)()+"/api/v1/message/rating/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),X=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return $("range",s,a)}})},n=0;n<s;n++)r();return t},ee={selectedRowKeys:R,onChange:function(e,t){E(e),z(t)}};return(0,N.jsx)(S.Z,{columns:G,actionRef:t,cardBordered:!0,rowSelection:ee,scroll:{x:2e3},request:function(){var e=m()(f()().mark((function e(t,a,s){var r,n,l,c,u,g,m,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.current,n=t.pageSize,l=i()(t,xe),o(r),p(n),W(l),c=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],c=g,u="ascend"===a[g]?"ascend":"descend"),m=d()(d()({pageNumber:r-1,pageSize:n,orgUid:null==h?void 0:h.uid},l),{},{sortBy:c,sortDirection:u}),e.next=10,me(m);case 10:return x=e.sent,console.log("queryMessageRatingsByOrg response:",x,m),200===x.code?Y(x.data.totalElements):M.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"评价记录",toolBarRender:function(){return function(){var t=[],a=[];R.length>0&&a.push({key:"batchDelete",icon:(0,N.jsx)(j.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(R.length,")"),onClick:function(){Z.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(R.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:J,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return $("current")}}];return P>0&&(P<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(P,"条)"),onClick:function(){return $("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(P,"条)"),children:X(P)})),t.push((0,N.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(C.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(k.Z,{})]},"button")},"export")),a.length>0&&t.push((0,N.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,N.jsxs)(C.ZP,{type:R.length>0?"primary":"default",danger:R.length>0,children:[R.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(R.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(k.Z,{})]})},"batchOperations")),t}()}})},je=a(43867),be=["current","pageSize"],ke=function(e){var t=e.type,a=(0,F.useIntl)(),s=(0,D.useRef)(),r=(0,y.Z)().translateString,o=(0,v.u)((function(e){return e.currentOrg})),l=(0,D.useState)(1),c=x()(l,2),g=c[0],p=c[1],h=(0,D.useState)(10),I=x()(h,2),R=I[0],E=I[1],U=(0,D.useState)([]),q=x()(U,2),O=q[0],z=q[1],B=(0,D.useState)([]),L=x()(B,2),P=L[0],Y=L[1],H=(0,D.useState)(0),K=x()(H,2),_=K[0],G=K[1],V=(0,D.useState)({}),Q=x()(V,2),J=Q[0],$=Q[1],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,N.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:r(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,W.ng)(null==t?void 0:t.status)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,W.OI)(t.type)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.client.tooltip"}),render:function(e,t){return(0,W.qF)(t.client)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,r){return[(0,N.jsx)("a",{onClick:function(){ee(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,N.jsx)(T.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return te(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],ee=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==o?void 0:o.uid,t:n.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},te=function(){var e=m()(f()().mark((function e(t){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),M.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(r=s.current)||void 0===r||r.reload()}catch(e){M.yw.destroy(),M.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=m()(f()().mark((function e(){var t,r,n,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==P.length){e.next=3;break}return M.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:M.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=u()(P);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}M.yw.destroy(),0===r?M.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),z([]),Y([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=m()(f()().mark((function e(a,s,r){var i,l;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,r),i=localStorage.getItem(n.LA8),l=d()({componentType:t,orgUid:(null==o?void 0:o.uid)||"",accessToken:i||"",exportType:a,threadType:n.H_O},J),"current"===a?(l.pageNumber=String(g-1),l.pageSize=String(R)):"all"===a?(l.pageNumber="0",l.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==r&&(l.pageNumber=String(s),l.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/message/export?"+new URLSearchParams(l).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),re=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return se("range",s,a)}})},n=0;n<s;n++)r();return t},ne={selectedRowKeys:O,onChange:function(e,t){z(e),Y(t)}};return(0,N.jsx)(S.Z,{columns:X,actionRef:s,cardBordered:!0,rowSelection:ne,scroll:{x:1500},request:function(){var e=m()(f()().mark((function e(t,a,s){var r,l,c,u,g,m,h,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,s),r=t.current,l=t.pageSize,c=i()(t,be),p(r),E(l),$(c),u=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],u=m,g="ascend"===a[m]?"ascend":"descend"),h=d()(d()({pageNumber:r-1,pageSize:l,threadType:n.H_O,orgUid:null==o?void 0:o.uid},c),{},{sortBy:u,sortDirection:g}),e.next=11,(0,je.W5)(h);case 11:return x=e.sent,console.log("getAllMessages response:",h,x),200===x.code?G(x.data.totalElements):M.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];O.length>0&&t.push({key:"batchDelete",icon:(0,N.jsx)(j.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(O.length,")"),onClick:function(){Z.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(O.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ae,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return se("current")}}];return _>0&&(_<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_,"条)"),onClick:function(){return se("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_,"条)"),children:re(_)})),e.push((0,N.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(C.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(k.Z,{})]},"button")},"export")),t.length>0&&e.push((0,N.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,N.jsxs)(C.ZP,{type:O.length>0?"primary":"default",danger:O.length>0,children:[O.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(O.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(k.Z,{})]})},"batchOperations")),e}()}})},Se=["current","pageSize"],Fe=function(e){var t=e.type,a=(0,F.useIntl)(),s=(0,D.useRef)(),r=(0,y.Z)().translateString,o=(0,v.u)((function(e){return e.currentOrg})),l=(0,D.useState)(1),c=x()(l,2),g=c[0],p=c[1],h=(0,D.useState)(10),I=x()(h,2),R=I[0],E=I[1],U=(0,D.useState)([]),q=x()(U,2),O=q[0],z=q[1],B=(0,D.useState)([]),L=x()(B,2),P=L[0],Y=L[1],H=(0,D.useState)(0),K=x()(H,2),_=K[0],G=K[1],V=(0,D.useState)({}),Q=x()(V,2),J=Q[0],$=Q[1],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,N.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:r(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,N.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,N.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,W.ng)(null==t?void 0:t.status)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,W.OI)(t.type)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.client.tooltip"}),render:function(e,t){return(0,W.qF)(t.client)}},{title:(0,N.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,r){return[(0,N.jsx)("a",{onClick:function(){ee(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,N.jsx)(T.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return te(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],ee=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==o?void 0:o.uid,t:n.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},te=function(){var e=m()(f()().mark((function e(t){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),M.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(r=s.current)||void 0===r||r.reload()}catch(e){M.yw.destroy(),M.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=m()(f()().mark((function e(){var t,r,n,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==P.length){e.next=3;break}return M.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:M.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=u()(P);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}M.yw.destroy(),0===r?M.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),z([]),Y([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=m()(f()().mark((function e(a,s,r){var i,l;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,r),i=localStorage.getItem(n.LA8),l=d()({componentType:t,orgUid:(null==o?void 0:o.uid)||"",accessToken:i||"",exportType:a,threadType:n.n4F},J),"current"===a?(l.pageNumber=String(g-1),l.pageSize=String(R)):"all"===a?(l.pageNumber="0",l.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==r&&(l.pageNumber=String(s),l.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/message/export?"+new URLSearchParams(l).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),re=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return se("range",s,a)}})},n=0;n<s;n++)r();return t},ne={selectedRowKeys:O,onChange:function(e,t){z(e),Y(t)}};return(0,N.jsx)(S.Z,{columns:X,actionRef:s,cardBordered:!0,rowSelection:ne,scroll:{x:1500},request:function(){var e=m()(f()().mark((function e(t,a,s){var r,l,c,u,g,m,h,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,s),r=t.current,l=t.pageSize,c=i()(t,Se),p(r),E(l),$(c),u=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],u=m,g="ascend"===a[m]?"ascend":"descend"),h=d()(d()({pageNumber:r-1,pageSize:l,threadType:n.n4F,orgUid:null==o?void 0:o.uid},c),{},{sortBy:u,sortDirection:g}),e.next=11,(0,je.W5)(h);case 11:return x=e.sent,console.log("getAllMessages response:",h,x),200===x.code?G(x.data.totalElements):M.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];O.length>0&&t.push({key:"batchDelete",icon:(0,N.jsx)(j.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(O.length,")"),onClick:function(){Z.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(O.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ae,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return se("current")}}];return _>0&&(_<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_,"条)"),onClick:function(){return se("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_,"条)"),children:re(_)})),e.push((0,N.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(C.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(k.Z,{})]},"button")},"export")),t.length>0&&e.push((0,N.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,N.jsxs)(C.ZP,{type:O.length>0?"primary":"default",danger:O.length>0,children:[O.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(O.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(k.Z,{})]})},"batchOperations")),e}()}})},Ie=function(){var e=(0,F.useIntl)().formatMessage,t=[{key:"message",label:e({id:"message.tab.all"}),children:(0,N.jsx)(s.Z,{type:n.Nqz})}];return(0,w.OJ)()&&t.push({key:"messageLeave",label:e({id:"message.tab.leave"}),children:(0,N.jsx)(pe,{})},{key:"robotMessage",label:e({id:"message.tab.robot"}),children:(0,N.jsx)(O,{})},{key:"messageRating",label:e({id:"message.tab.rating"}),children:(0,N.jsx)(we,{})}),(0,w.Ox)()||t.push({key:"message.group",label:e({id:"message.tab.group"}),children:(0,N.jsx)(ke,{type:n.Nqz})},{key:"message.member",label:e({id:"message.tab.member"}),children:(0,N.jsx)(Fe,{type:n.Nqz})}),(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(r.Z,{defaultActiveKey:"message",items:t,style:{margin:10}})})}}}]);