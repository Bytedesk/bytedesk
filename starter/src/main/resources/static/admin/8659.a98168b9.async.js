"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8659],{32045:function(e,t,n){n.d(t,{XS:function(){return d},k4:function(){return g},uu:function(){return v},yr:function(){return y}});var r=n(90819),a=n.n(r),o=n(73193),s=n.n(o),u=n(89933),i=n.n(u),c=n(55735),l=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95160:function(e,t,n){n.d(t,{Z:function(){return P}});var r=n(90819),a=n.n(r),o=n(89933),s=n.n(o),u=n(45332),i=n.n(u),c=n(15722),l=n(90727),d=n(82669),f=n(80556),g=n(59304),p=n(54881),y=n(2484),h=n(53530),v=n(52288),m=n(75365),w=n(27487),b=n(96485),x=n(79777),k=n(88996),C=n(65837),M=n(86803),S=n(76750),j=n(6397),Z=n(40612),K=n(69169),R=n(4499),L=n(84881),z=n(44194),T=n(90838),O=n(55735),U=n(31549),F=function(e){var t,n=e.open,r=e.level,o=e.type,u=e.isEdit,c=e.onCancel,l=e.onSubmit,d=K.A.useForm(),f=i()(d,1)[0],g=(0,S.Z)().translateString,p=(0,Z.u)((function(e){return e.currentOrg})),y=(0,j.j)((function(e){return e.kbaseResult})),v=(0,j.j)((function(e){return e.currentKbase})),m=(0,T.v)((function(e){return e.currentCategory}));(0,z.useEffect)((function(){u?f.setFieldsValue({name:g(null==m?void 0:m.name)}):f.resetFields(),f.setFieldsValue({kbUid:null==v?void 0:v.uid})}),[n,u]);var w=function(){f.validateFields().then(function(){var e=s()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),n={uid:u?null==m?void 0:m.uid:"",name:t.name,level:r,type:o,kbUid:t.kbUid,orgUid:null==p?void 0:p.uid},l(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),M.yw.error("创建分类失败")}))};return(0,U.jsx)("div",{children:(0,U.jsx)(h.Z,{title:u?"编辑分类":"创建分类",open:n,forceRender:!0,onOk:w,onCancel:c,getContainer:!1,children:(0,U.jsxs)(K.A,{form:f,name:"categoryForm",submitter:!1,children:[(0,U.jsx)(R.Z,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&w()},placeholder:"请输入分类名称"}}),o!==O.Kvk&&o!==O.hcJ&&(0,U.jsx)(L.Z,{name:"kbUid",label:"所属知识库",allowClear:!0,options:null==y||null===(t=y.data)||void 0===t?void 0:t.content.map((function(e){return{label:g(e.name),value:e.uid}}))})]})})})},E=n(30921),B=n(28425),P=function(e){var t=e.type,n=(0,E.useIntl)(),r=(0,z.useState)(!0),o=i()(r,2),u=o[0],K=o[1],R=(0,z.useState)(!1),L=i()(R,2),P=L[0],D=L[1],I=(0,z.useState)(1),V=i()(I,2),q=V[0],W=V[1],A=(0,z.useState)(20),N=i()(A,2),X=N[0],H=N[1],J=(0,z.useState)(0),Y=i()(J,2),_=Y[0],G=Y[1],Q=(0,z.useState)(""),$=i()(Q,2),ee=$[0],te=$[1],ne=(0,Z.u)((function(e){return e.currentOrg})),re=(0,j.j)((function(e){return e.currentKbase})),ae=(0,z.useState)(!1),oe=i()(ae,2),se=oe[0],ue=oe[1],ie=(0,T.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),ce=ie.categoryTreeOptions,le=ie.currentCategory,de=ie.setCurrentCategoryUid,fe=(0,S.Z)(),ge=fe.translateString,pe=fe.translateStringTranct,ye=h.Z.useModal(),he=i()(ye,2),ve=he[0],me=he[1],we=function(){var e=s()(a()().mark((function e(){var r,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),r=t===O.FXY||t===O.Kvk,o=r?"":null==re?void 0:re.uid,e.next=5,(0,B.HK)(t,null==ne?void 0:ne.uid,o,{showLoading:!0,pageSize:X,pageNumber:q-1,searchName:ee,loadingMessage:n.formatMessage({id:"loading"}),errorMessage:n.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 5:s=e.sent,D(!1),s&&s.data&&G(s.data.totalElements||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(e){te(e),W(1),setTimeout((function(){we()}),0)},xe=function(e,t){W(e),t&&t!==X&&H(t),setTimeout((function(){we()}),0)},ke=function(){var e=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K(!0),ue(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,B.sT)(t,{showLoading:!0,loadingMessage:n.formatMessage({id:"deleting"}),successMessage:n.formatMessage({id:"delete.success"}),errorMessage:n.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&we();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=s()(a()().mark((function e(t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={showLoading:!0,loadingMessage:n.formatMessage({id:u?"updating":"creating"}),successMessage:n.formatMessage({id:u?"update.success":"create.success"}),errorMessage:n.formatMessage({id:u?"update.error":"create.error",defaultMessage:u?"Update failed":"Create failed"})},!u){e.next=7;break}return e.next=4,(0,B.ht)(t,r);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,B.i8)(t,r);case 9:e.t0=e.sent;case 10:e.t0&&(ue(!1),we());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,z.useEffect)((function(){t!==O.FXY&&(W(1),te(""),we())}),[re]),(0,z.useEffect)((function(){t!==O.FXY&&t!==O.Kvk||(W(1),te(""),we())}),[]);return(0,U.jsxs)("div",{children:[(0,U.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(_/X)>1||""!==ee)&&(0,U.jsx)(v.Z,{placeholder:n.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,U.jsx)(l.Z,{}),suffix:(0,U.jsx)(m.ZP,{type:"text",size:"small",icon:(0,U.jsx)(l.Z,{}),onClick:function(){return be(ee)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,U.jsx)("span",{onClick:function(e){e.stopPropagation(),te(""),W(1),we()}})},value:ee,onChange:function(e){var t=e.target.value;te(t),t||(W(1),setTimeout((function(){we()}),0))},onPressEnter:function(e){return be(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,U.jsxs)(w.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,U.jsxs)(w.Z,{gap:"small",children:[(0,U.jsx)(m.ZP,{type:"primary",size:"small",icon:(0,U.jsx)(d.Z,{}),onClick:ke,children:n.formatMessage({id:"create.category"})}),(0,U.jsx)(m.ZP,{size:"small",icon:(0,U.jsx)(f.Z,{spin:P}),onClick:we,loading:P,children:n.formatMessage({id:"refresh"})})]}),""!==(null==le?void 0:le.uid)&&(null==le?void 0:le.uid)!==O.zBg&&(0,U.jsx)(b.Z,{menu:{items:[{key:"edit",icon:(0,U.jsx)(g.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ke},{key:"delete",icon:(0,U.jsx)(p.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==O.zBg?ve.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,U.jsx)(c.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ge(e.name),"】？"),onOk:function(){Ce(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})}):M.yw.error(n.formatMessage({id:"delete.dept.all.error"}))}(le)}}]},children:(0,U.jsx)(m.ZP,{size:"small",icon:(0,U.jsx)(y.Z,{})})})]})]}),(0,U.jsx)(x.Z,{defaultSelectedKeys:[null==le?void 0:le.uid],selectedKeys:[null==le?void 0:le.uid],onSelect:function(e,t){0!==e.length&&de(e[0].toString())},treeData:ce,blockNode:!0,titleRender:function(e){return(0,U.jsx)(k.Z,{title:ge(e.title),children:pe(e.title)})}}),Math.ceil(_/X)>1&&(0,U.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,U.jsx)(C.Z,{size:"small",current:q,pageSize:X,total:_,onChange:xe,onShowSizeChange:xe,showSizeChanger:!0,showLessItems:!0}),(0,U.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:n.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:_})})]}),se&&(0,U.jsx)(F,{open:se,type:t,isEdit:u,onCancel:function(){ue(!1)},onSubmit:Me}),me]})}},96865:function(e,t,n){var r=n(23864);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,t,n){var r=n(55735),a=n(65461),o=n(30921);t.Z=function(){var e=(0,o.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},28425:function(e,t,n){n.d(t,{HK:function(){return l},ht:function(){return f},i8:function(){return d},sT:function(){return g}});var r=n(90819),a=n.n(r),o=n(89933),s=n.n(o),u=n(86803),i=n(32045),c=n(90838),l=function(){var e=s()(a()().mark((function e(t,n,r,o){var s,l,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.v.getState().setCategoryResult,null!=o&&o.showLoading&&u.yw.loading((null==o?void 0:o.loadingMessage)||"Loading..."),l={pageNumber:(null==o?void 0:o.pageNumber)||0,pageSize:(null==o?void 0:o.pageSize)||20,type:t,kbUid:r,orgUid:n,name:(null==o?void 0:o.searchName)||""},e.prev=3,e.next=6,(0,i.XS)(l);case 6:if(d=e.sent,console.log("queryCategoriesByOrg response: ",d,l),200!==d.code){e.next=14;break}return s(d),null!=o&&o.showLoading&&u.yw.destroy(),e.abrupt("return",d);case 14:return null!=o&&o.showLoading&&u.yw.destroy(),u.yw.error(d.message),e.abrupt("return",null);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(3),null!=o&&o.showLoading&&u.yw.destroy(),u.yw.error((null==o?void 0:o.errorMessage)||"Failed to fetch categories"),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),d=function(){var e=s()(a()().mark((function e(t,n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Creating..."),e.prev=1,e.next=4,(0,i.k4)(t);case 4:if(r=e.sent,console.log("createCategory response:",r),200!==r.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Create Success"),e.abrupt("return",r);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to create category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=s()(a()().mark((function e(t,n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Updating..."),e.prev=1,e.next=4,(0,i.yr)(t);case 4:if(r=e.sent,console.log("updateCategory response:",r),200!==r.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Update Success"),e.abrupt("return",r);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to update category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=s()(a()().mark((function e(t,n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Deleting..."),e.prev=1,e.next=4,(0,i.uu)(t);case 4:if(r=e.sent,console.log("deleteCategory response:",r),200!==r.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Delete Success"),e.abrupt("return",r);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to delete category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t,n){return e.apply(this,arguments)}}()},90838:function(e,t,n){n.d(t,{v:function(){return d}});var r=n(76711),a=n.n(r),o=n(73193),s=n.n(o),u=n(55735),i=n(44435),c=n(83642),l=n(83890);var d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:u.zBg,name:u.zBg},setCategoryResult:function(t){var n=function(e){var t=[];return e.data.content.forEach((function(e){var n={label:e.name,value:e.uid};t.push(n)})),t}(t),r={uid:u.zBg,name:u.zBg},o=s()(s()({},t),{},{data:s()(s()({},t.data),{},{content:[r].concat(a()(t.data.content))})}),i=function(e){var t=[];return e.data.content.forEach((function(e){var n={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(n.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(n)})),t}(o);e({categoryResult:o,categoryTreeOptions:i,categorySelectOptions:n}),0===t.data.content.length&&e({currentCategory:{uid:u.zBg,name:u.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var n=e.categoryResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:u.zBg,name:u.zBg}})},setCurrentCategoryUid:function(n){var r=t().categoryResult.data.content.find((function(e){return e.uid===n}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:u.OMm})))},6397:function(e,t,n){n.d(t,{j:function(){return d}});var r=n(73193),a=n.n(r),o=n(76711),s=n.n(o),u=n(55735),i=n(44435),c=n(83642),l=n(83890),d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var u=[].concat(s()(r.slice(0,o)),[n],s()(r.slice(o+1))),i=a()(a()({},t().kbaseResult),{},{data:{content:u}});e({kbaseResult:i,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n}));-1!==o?e({kbaseResult:a()(a()({},t().kbaseResult),{},{data:{content:[].concat(s()(r.slice(0,o)),s()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:u.wKE})))}}]);