"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6892],{51344:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(38404),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},83381:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(38404),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},77686:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(38404),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},80503:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(38404),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},17455:function(e,t,r){var n=r(80627),a=r(93683),s=r(68422),o=r(44194),l=r(84729),i=r(69983),c=r(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var r=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.showSearch,x=e.options,y=(0,a.Z)(e,u),M=(0,o.useContext)(l.Z);return(0,c.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(g),request:m,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:x,mode:h,showSearch:v,getPopupContainer:M.getPopupContainer},r),ref:t,proFieldProps:p},y),{},{children:d}))},p=o.forwardRef((function(e,t){var r=e.fieldProps,u=e.children,f=e.params,p=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.options,x=(0,a.Z)(e,d),y=(0,n.Z)({options:v,mode:h||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),M=(0,o.useContext)(l.Z);return(0,c.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(g),request:m,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:M.getPopupContainer},y),ref:t,proFieldProps:p},x),{},{children:u}))})),h=o.forwardRef(f);h.SearchSelect=p,h.displayName="ProFormComponent",t.Z=h},74056:function(e,t,r){var n=r(80627),a=r(93683),s=r(44194),o=r(69983),l=r(31549),i=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],c=s.forwardRef((function(e,t){var r=e.fieldProps,s=e.unCheckedChildren,c=e.checkedChildren,u=e.proFieldProps,d=(0,a.Z)(e,i);return(0,l.jsx)(o.Z,(0,n.Z)({valueType:"switch",fieldProps:(0,n.Z)({unCheckedChildren:s,checkedChildren:c},r),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=c},67186:function(e,t,r){var n=r(29552),a=r(80627),s=r(93683),o=r(92032),l=r(69159),i=r(43928),c=r(21762),u=r(44194),d=r(69983),f=r(31549),p=["fieldProps","proFieldProps"],h=["fieldProps","proFieldProps"],g="text",m=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,n.Z)(t,2),s=r[0],c=r[1];return(0,f.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,n=t.getFieldValue(e.name||[]);return(0,f.jsx)(i.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return c(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,n),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var t=e.fieldProps,r=e.proFieldProps,n=(0,s.Z)(e,p);return(0,f.jsx)(d.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:r},n))};v.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,o=(0,s.Z)(e,h),l=(0,u.useState)(!1),i=(0,n.Z)(l,2),p=i[0],v=i[1];return null!=t&&t.statusRender&&o.name?(0,f.jsx)(m,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,c.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),v(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),v(!0)}}),proFieldProps:r,filedConfig:{valueType:g}},o))})}):(0,f.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:g}},o))},v.displayName="ProFormComponent",t.Z=v},83788:function(e,t,r){var n=r(80627),a=r(93683),s=r(44194),o=r(69983),l=r(31549),i=["fieldProps","proFieldProps"],c=function(e,t){var r=e.fieldProps,s=e.proFieldProps,c=(0,a.Z)(e,i);return(0,l.jsx)(o.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:s},c))};t.Z=s.forwardRef(c)},63934:function(e,t,r){r.r(t),r.d(t,{default:function(){return ue}});var n=r(76711),a=r.n(n),s=r(45332),o=r.n(s),l=r(44194),i=r(10820),c=r(73193),u=r.n(c),d=r(84176),f=r.n(d),p=r(86222),h=r.n(p),g=r(90819),m=r.n(g),v=r(89933),x=r.n(v),y=r(10154),M=r.n(y),w=r(50884),b=r(27353),k=r(2290);function Z(e){return j.apply(this,arguments)}function j(){return(j=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/webhook/query/org",{method:"GET",params:u()(u()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return S.apply(this,arguments)}function S(){return(S=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/webhook/create",{method:"POST",data:u()(u()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return T.apply(this,arguments)}function T(){return(T=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/webhook/update",{method:"POST",data:u()(u()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return A.apply(this,arguments)}function A(){return(A=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/webhook/delete",{method:"POST",data:u()(u()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return R.apply(this,arguments)}function R(){return(R=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/webhook/delete/all",{method:"POST",data:u()(u()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=r(28520),O=r(1670),W=r(77686),L=r(83381),B=r(6992),q=r(91768),U=r(51344),z=r(80503),V=r(77601),K=r(35746),D=r(38623),H=r(64724),N=r(70937),J=r(90883),Y=r(56668),X=r(97588),_=r(67186),G=r(83788),Q=r(17455),$=r(74056),ee=r(19058),te=r(46206),re=r(31549),ne=function(e){var t=e.isEdit,r=e.webhook,n=e.open,a=e.onClose,s=e.onSubmit,i=X.A.useForm(),c=o()(i,1)[0],d=(0,E.u)((function(e){return e.currentOrg})),f=(0,l.useState)(b.I53),p=o()(f,2),h=p[0],g=p[1],m=function(e){try{var t=new URL(e);if("qyapi.weixin.qq.com"===t.hostname&&"/cgi-bin/webhook/send"===t.pathname)return t.searchParams.get("key")}catch(e){console.error("URL解析错误:",e)}return null},v=function(e){try{var t=new URL(e);if("open.feishu.cn"===t.hostname&&t.pathname.startsWith("/open-apis/bot/v2/hook/")){var r=t.pathname.split("/"),n=r[r.length-1];if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n))return n}}catch(e){console.error("URL解析错误:",e)}return null},x=function(e){try{var t=new URL(e);if("oapi.dingtalk.com"===t.hostname&&"/robot/send"===t.pathname)return t.searchParams.get("access_token")}catch(e){console.error("URL解析错误:",e)}return null},y=(0,l.useState)(!1),M=o()(y,2),w=(M[0],M[1]);return(0,l.useEffect)((function(){if(t){var e,n,a=null==r||null===(e=r.messageTypes)||void 0===e?void 0:e.includes("all");w(a),g((null==r?void 0:r.type)||b.I53),c.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,type:null==r?void 0:r.type,url:null==r?void 0:r.url,secret:null==r?void 0:r.secret,enabled:null===(n=null==r?void 0:r.enabled)||void 0===n||n,messageTypes:null==r?void 0:r.messageTypes,description:null==r?void 0:r.description})}else g(b.I53),c.setFieldsValue({name:"",type:b.I53,url:"",secret:"",enabled:!0,messageTypes:[b.KOL]})}),[t,r,c]),(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(ee.Z,{title:"Webhook",width:600,onClose:a,open:n,extra:(0,re.jsxs)(te.Z,{children:[(0,re.jsx)(J.ZP,{onClick:a,children:"取消"}),(0,re.jsx)(J.ZP,{type:"primary",onClick:function(){return c.submit()},children:"提交"})]}),children:(0,re.jsxs)(X.A,{form:c,name:"webhookForm",onFinish:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var t=u()(u()({},e),{},{orgUid:null==d?void 0:d.uid});console.log("submit",t),s(t)}))},submitter:!1,children:[(0,re.jsx)(_.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,re.jsx)(G.Z,{label:"描述",name:"description",placeholder:"可选，webhook用途描述"}),(0,re.jsx)(Q.Z,{name:"messageTypes",mode:"multiple",width:"lg",options:[{label:"留言消息",value:b.KOL}],placeholder:"请选择消息类型",rules:[{required:!0,message:"请选择至少一种消息类型"}]}),(0,re.jsx)(Q.Z,{name:"type",label:"类型",width:"md",options:[{label:"企业微信",value:b.I53},{label:"飞书",value:b.xKB},{label:"钉钉",value:b.Ix4},{label:"自定义",value:b.uY8}],rules:[{required:!0}],fieldProps:{onChange:function(e){g(e);var t=c.getFieldValue("url");if(t)if(e===b.I53){var r=m(t);r&&c.setFieldsValue({secret:r})}else if(e===b.xKB){var n=v(t);n&&c.setFieldsValue({secret:n})}else if(e===b.Ix4){var a=x(t);a&&c.setFieldsValue({secret:a})}}}}),(0,re.jsx)(_.Z,{label:"Webhook URL",name:"url",rules:[{required:!0,message:"请输入Webhook URL"},{pattern:/^https?:\/\/.+/,message:"URL必须以http://或https://开头"}],fieldProps:{onChange:function(e){return function(e){if(e)if(h===b.I53){var t=m(e);t&&c.setFieldsValue({secret:t})}else if(h===b.xKB){var r=v(e);r&&c.setFieldsValue({secret:r})}else if(h===b.Ix4){var n=x(e);n&&c.setFieldsValue({secret:n})}}(e.target.value)}}}),(0,re.jsx)(_.Z,{label:"Secret",name:"secret",placeholder:"可选，用于签名验证",fieldProps:{disabled:h===b.I53||h===b.xKB||h===b.Ix4}}),(0,re.jsx)($.Z,{label:"启用状态",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"}})]})})})},ae=r(21002),se=r(27318),oe=["current","pageSize"],le=function(){var e,t,r,n,a,s,i,c=(0,k.useIntl)(),d=(0,k.useAccess)(),p=(0,l.useRef)(),g=(0,ae.Z)().translateString,v=(0,l.useState)(1),y=o()(v,2),j=(y[0],y[1]),S=(0,l.useState)(10),T=o()(S,2),A=(T[0],T[1]),R=(0,E.u)((function(e){return e.currentOrg})),X=(0,l.useState)(!1),_=o()(X,2),G=_[0],Q=_[1],$=(0,l.useState)({}),ee=o()($,2),te=ee[0],le=ee[1],ie=(0,l.useState)(!1),ce=o()(ie,2),ue=ce[0],de=ce[1],fe=K.Z.useModal(),pe=o()(fe,2),he=pe[0],ge=pe[1],me=(0,l.useState)([]),ve=o()(me,2),xe=ve[0],ye=ve[1],Me=(0,l.useState)([]),we=o()(Me,2),be=we[0],ke=we[1],Ze=(0,l.useState)(0),je=o()(Ze,2),Pe=je[0],Se=je[1],Ce=(0,l.useState)({}),Te=o()(Ce,2),Fe=(Te[0],Te[1]),Ae=null==d||null===(e=d.getModulePermission)||void 0===e?void 0:e.call(d,se.MY.WEBHOOK),Ie=null!==(t=null==Ae||null===(r=Ae.canCreate)||void 0===r?void 0:r.call(Ae))&&void 0!==t&&t,Re=null!==(n=null==Ae||null===(a=Ae.canUpdate)||void 0===a?void 0:a.call(Ae))&&void 0!==n&&n,Ee=null!==(s=null==Ae||null===(i=Ae.canDelete)||void 0===i?void 0:i.call(Ae))&&void 0!==s&&s,Oe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,re.jsx)(k.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,re.jsx)(k.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",copyable:!0,width:200},{title:(0,re.jsx)(k.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,filters:!0,filterMultiple:!0,valueEnum:M()(M()(M()(M()(M()({},b.I53,{text:"企业微信"}),b.xKB,{text:"飞书"}),b.PIp,{text:"Lark"}),b.Ix4,{text:"钉钉"}),b.uY8,{text:"自定义"}),render:function(e,t){var r="blue",n="自定义";switch(t.type){case b.I53:r="green",n="企业微信";break;case b.xKB:r="cyan",n="飞书";break;case b.PIp:r="geekblue",n="Lark";break;case b.Ix4:r="blue",n="钉钉";break;case b.uY8:default:r="purple",n="自定义"}return(0,re.jsx)(D.Z,{color:r,children:n})}},{title:(0,re.jsx)(k.FormattedMessage,{id:"url",defaultMessage:"URL"}),dataIndex:"url",hideInSearch:!0,width:200,ellipsis:!0,render:function(e,t){var r=t.url?String(t.url):"";return(0,re.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,re.jsxs)("a",{href:r,target:"_blank",rel:"noopener noreferrer",onClick:function(e){r&&(r.startsWith("http://")||r.startsWith("https://"))||(e.preventDefault(),r&&window.open("https://".concat(r),"_blank","noopener,noreferrer"))},children:[(0,re.jsx)(W.Z,{style:{marginRight:5}}),r]}),r&&(0,re.jsx)(H.Z.Text,{copyable:{text:r,tooltips:["点击复制","复制成功"]},style:{marginLeft:8}})]})}},{title:(0,re.jsx)(k.FormattedMessage,{id:"messageTypes",defaultMessage:"Message Types"}),dataIndex:"messageTypes",hideInSearch:!0,width:300,render:function(e,t){if(!t.messageTypes||0===t.messageTypes.length)return"-";if(t.messageTypes.includes("all"))return(0,re.jsx)(D.Z,{color:"green",children:"全部消息类型"});var r=t.messageTypes.slice(0,3),n=t.messageTypes.length-3;return(0,re.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[r.map((function(e){return(0,re.jsx)(D.Z,{color:"blue",children:(0,O.OI)(e)},e)})),n>0&&(0,re.jsxs)(D.Z,{color:"default",children:["等",n,"个"]})]})}},{title:(0,re.jsx)(k.FormattedMessage,{id:"enabled",defaultMessage:"Status"}),dataIndex:"enabled",hideInSearch:!0,width:100,filters:!0,filterMultiple:!1,valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}},render:function(e,t){return(0,re.jsx)(D.Z,{color:t.enabled?"green":"red",style:{cursor:Re?"pointer":"default"},onClick:Re?function(){return Be(t)}:void 0,children:t.enabled?"启用":"禁用"})}},{title:(0,re.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,re.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],We=[].concat(Oe,[{title:c.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(e,t){var r=[];return Re&&r.push((0,re.jsx)("a",{onClick:function(){le(t),de(!0),Q(!0)},children:c.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),Ee&&r.push((0,re.jsx)(N.Z,{title:c.formatMessage({id:"deleteTip"}),description:"".concat(c.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(g(t.name),"】？"),onConfirm:function(){return Le(t)},okText:c.formatMessage({id:"ok"}),cancelText:c.formatMessage({id:"cancel"}),icon:(0,re.jsx)(L.Z,{style:{color:"red"}}),children:(0,re.jsx)(J.ZP,{type:"link",danger:!0,children:c.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")),r}}]),Le=function(){var e=x()(m()().mark((function e(t){var r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteWebhook:",t),e.next=3,F(t);case 3:r=e.sent,console.log("deleteWebhook:",r),200===r.code?(w.yw.success(c.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),p.current.reload()):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=x()(m()().mark((function e(t){var r,n,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={uid:t.uid,name:t.name,type:t.type,url:t.url,secret:t.secret,enabled:!t.enabled,messageTypes:t.messageTypes,description:t.description,orgUid:t.orgUid},e.next=3,C(r);case 3:n=e.sent,console.log("handleToggleEnabled response:",n),200===n.code?(w.yw.success(c.formatMessage({id:"toggle.success",defaultMessage:t.enabled?"禁用成功":"启用成功"})),null===(a=p.current)||void 0===a||a.reload()):w.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(){var e=x()(m()().mark((function e(t){var r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t);case 2:r=e.sent,console.log("handleCreateWebhook response:",r),200===r.code?(null===(n=p.current)||void 0===n||n.reload(),Q(!1)):w.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=x()(m()().mark((function e(t){var r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==te?void 0:te.uid,e.next=3,C(t);case 3:r=e.sent,console.log("handleUpdateWebhook response:",r),200===r.code?(null===(n=p.current)||void 0===n||n.reload(),Q(!1)):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){Q(!0),de(!1),le({})},Ve=function(){var e=x()(m()().mark((function e(){var t,r,n,a,s,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==be.length){e.next=3;break}return w.yw.warning(c.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 3:w.yw.loading(c.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,n=0,a=h()(be),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=23;break}return o=s.value,e.prev=11,e.next=14,F(o);case 14:200===e.sent.code?r++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:w.yw.destroy(),0===n?w.yw.success(c.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:r})):w.yw.warning(c.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:r,fail:n})),ye([]),ke([]),null===(t=p.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=x()(m()().mark((function e(){var t,r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Pe){e.next=3;break}return w.yw.warning(c.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return w.yw.loading(c.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={orgUid:null==R?void 0:R.uid},e.next=8,I(t);case 8:200===(r=e.sent).code?(w.yw.destroy(),w.yw.success(c.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(n=p.current)||void 0===n||n.reloadAndRest()):(w.yw.destroy(),w.yw.error(r.message||c.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),w.yw.destroy(),w.yw.error(c.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),De={selectedRowKeys:xe,onChange:function(e,t){ye(e),ke(t)}},He=function(){var e=x()(m()().mark((function e(t,r,n){var a,s,o,l,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=f()(t,oe),j(a),A(s),Fe(o),l=u()({pageNumber:a-1,pageSize:s,orgUid:null==R?void 0:R.uid},o),e.next=7,Z(l);case 7:return i=e.sent,console.log("queryWebhooksByOrg response:",i,l),200===i.code?Se(null==i?void 0:i.data.totalElements):w.yw.error(i.message),e.abrupt("return",{data:null==i?void 0:i.data.content,success:!0,total:null==i?void 0:i.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,re.jsxs)(re.Fragment,{children:[G&&(0,re.jsx)(ne,{isEdit:ue,open:G,webhook:te,onClose:function(){Q(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),ue?Ue(e):qe(e)}}),(0,re.jsx)(V.Z,{columns:We,actionRef:p,cardBordered:!0,rowSelection:!!Ee&&De,request:He,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){j(e),A(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return function(){var e=[];Ie&&e.push((0,re.jsx)(J.ZP,{type:"primary",icon:(0,re.jsx)(B.Z,{}),onClick:ze,children:c.formatMessage({id:"create",defaultMessage:"Create"})},"create"));var t=[];return Ee&&xe.length>0&&t.push({key:"batchDelete",icon:(0,re.jsx)(q.Z,{}),danger:!0,label:c.formatMessage({id:"batch.delete"})+" (".concat(xe.length,")"),onClick:function(){he.confirm({title:c.formatMessage({id:"batch.deleteTip"}),content:"".concat(c.formatMessage({id:"batch.deleteAffirm"})," ").concat(xe.length," ").concat(c.formatMessage({id:"items"}),"?"),onOk:Ve,okText:c.formatMessage({id:"ok"}),cancelText:c.formatMessage({id:"cancel"})})}}),Ee&&t.push({key:"deleteAll",icon:(0,re.jsx)(U.Z,{}),danger:!0,label:c.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){he.confirm({title:c.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:c.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:Ke,okText:c.formatMessage({id:"ok"}),cancelText:c.formatMessage({id:"cancel"})})}}),t.length>0&&e.push((0,re.jsx)(Y.Z,{menu:{items:t},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:xe.length>0?"primary":"default",danger:xe.length>0,children:[xe.length>0?c.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(xe.length,")"):c.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,re.jsx)(z.Z,{})]})},"batchOperations")),e}()}}),ge]})},ie=["current","pageSize"],ce=function(){var e,t,r,n,a,s,i,c,d,p=(0,k.useIntl)(),g=(0,k.useAccess)(),v=(0,l.useRef)(),y=(0,ae.Z)().translateString,M=(0,l.useState)(1),b=o()(M,2),j=(b[0],b[1]),S=(0,l.useState)(10),T=o()(S,2),A=(T[0],T[1]),R=(0,E.u)((function(e){return e.currentOrg})),O=(0,l.useState)(!1),W=o()(O,2),H=W[0],X=W[1],_=(0,l.useState)({}),G=o()(_,2),Q=G[0],$=G[1],ee=(0,l.useState)(!1),te=o()(ee,2),oe=te[0],le=te[1],ce=K.Z.useModal(),ue=o()(ce,2),de=ue[0],fe=ue[1],pe=(0,l.useState)([]),he=o()(pe,2),ge=he[0],me=he[1],ve=(0,l.useState)([]),xe=o()(ve,2),ye=xe[0],Me=xe[1],we=(0,l.useState)(0),be=o()(we,2),ke=be[0],Ze=be[1],je=(0,l.useState)({}),Pe=o()(je,2),Se=(Pe[0],Pe[1]),Ce=null==g||null===(e=g.getModulePermission)||void 0===e?void 0:e.call(g,se.MY.WEBHOOK_MESSAGE),Te=null!==(t=null==Ce||null===(r=Ce.canCreate)||void 0===r?void 0:r.call(Ce))&&void 0!==t&&t,Fe=null!==(n=null==Ce||null===(a=Ce.canUpdate)||void 0===a?void 0:a.call(Ce))&&void 0!==n&&n,Ae=null!==(s=null==Ce||null===(i=Ce.canDelete)||void 0===i?void 0:i.call(Ce))&&void 0!==s&&s,Ie=(c=null==Ce||null===(d=Ce.canExport)||void 0===d?void 0:d.call(Ce),[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,re.jsx)(k.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,re.jsx)(k.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(D.Z,{color:"blue",children:t.type})})}},{title:(0,re.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,re.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}]),Re=[].concat(Ie,[{title:p.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(e,t){var r=[];return Fe&&r.push((0,re.jsx)("a",{onClick:function(){$(t),le(!0),X(!0)},children:p.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),Ae&&r.push((0,re.jsx)(N.Z,{title:p.formatMessage({id:"deleteTip"}),description:"".concat(p.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(y(t.name),"】？"),onConfirm:function(){return Ee(t)},okText:p.formatMessage({id:"ok"}),cancelText:p.formatMessage({id:"cancel"}),icon:(0,re.jsx)(L.Z,{style:{color:"red"}}),children:(0,re.jsx)(J.ZP,{type:"link",danger:!0,children:p.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")),r}}]),Ee=function(){var e=x()(m()().mark((function e(t){var r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteWebhook:",t),e.next=3,F(t);case 3:r=e.sent,console.log("deleteWebhook:",r),200===r.code?(w.yw.success(p.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),v.current.reload()):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=x()(m()().mark((function e(t){var r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t);case 2:r=e.sent,console.log("handleCreateWebhook response:",r),200===r.code?(null===(n=v.current)||void 0===n||n.reload(),X(!1)):w.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=x()(m()().mark((function e(t){var r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==Q?void 0:Q.uid,e.next=3,C(t);case 3:r=e.sent,console.log("handleUpdateWebhook response:",r),200===r.code?(null===(n=v.current)||void 0===n||n.reload(),X(!1)):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){X(!0),le(!1),$({})},Be=function(){var e=x()(m()().mark((function e(){var t,r,n,a,s,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ye.length){e.next=3;break}return w.yw.warning(p.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 3:w.yw.loading(p.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,n=0,a=h()(ye),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=23;break}return o=s.value,e.prev=11,e.next=14,F(o);case 14:200===e.sent.code?r++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:w.yw.destroy(),0===n?w.yw.success(p.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:r})):w.yw.warning(p.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:r,fail:n})),me([]),Me([]),null===(t=v.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=x()(m()().mark((function e(){var t,r,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ke){e.next=3;break}return w.yw.warning(p.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return w.yw.loading(p.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={orgUid:null==R?void 0:R.uid},e.next=8,I(t);case 8:200===(r=e.sent).code?(w.yw.destroy(),w.yw.success(p.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(n=v.current)||void 0===n||n.reloadAndRest()):(w.yw.destroy(),w.yw.error(r.message||p.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),w.yw.destroy(),w.yw.error(p.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),Ue={selectedRowKeys:ge,onChange:function(e,t){me(e),Me(t)}},ze=function(){var e=x()(m()().mark((function e(t,r,n){var a,s,o,l,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=f()(t,ie),j(a),A(s),Se(o),l=u()({pageNumber:a-1,pageSize:s,orgUid:null==R?void 0:R.uid},o),e.next=7,Z(l);case 7:return i=e.sent,console.log("queryWebhooksByOrg response:",i,l),200===i.code?Ze(null==i?void 0:i.data.totalElements):w.yw.error(i.message),e.abrupt("return",{data:null==i?void 0:i.data.content,success:!0,total:null==i?void 0:i.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,re.jsxs)(re.Fragment,{children:[H&&(0,re.jsx)(ne,{isEdit:oe,open:H,webhook:Q,onClose:function(){X(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),oe?We(e):Oe(e)}}),(0,re.jsx)(V.Z,{columns:Re,actionRef:v,cardBordered:!0,rowSelection:!!Ae&&Ue,request:ze,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){j(e),A(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return function(){var e=[];Te&&e.push((0,re.jsx)(J.ZP,{type:"primary",icon:(0,re.jsx)(B.Z,{}),onClick:Le,children:p.formatMessage({id:"create",defaultMessage:"Create"})},"create"));var t=[];return Ae&&ge.length>0&&t.push({key:"batchDelete",icon:(0,re.jsx)(q.Z,{}),danger:!0,label:p.formatMessage({id:"batch.delete"})+" (".concat(ge.length,")"),onClick:function(){de.confirm({title:p.formatMessage({id:"batch.deleteTip"}),content:"".concat(p.formatMessage({id:"batch.deleteAffirm"})," ").concat(ge.length," ").concat(p.formatMessage({id:"items"}),"?"),onOk:Be,okText:p.formatMessage({id:"ok"}),cancelText:p.formatMessage({id:"cancel"})})}}),Ae&&t.push({key:"deleteAll",icon:(0,re.jsx)(U.Z,{}),danger:!0,label:p.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){de.confirm({title:p.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:p.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:qe,okText:p.formatMessage({id:"ok"}),cancelText:p.formatMessage({id:"cancel"})})}}),t.length>0&&e.push((0,re.jsx)(Y.Z,{menu:{items:t},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:ge.length>0?"primary":"default",danger:ge.length>0,children:[ge.length>0?p.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ge.length,")"):p.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,re.jsx)(z.Z,{})]})},"batchOperations")),e}()}}),fe]})},ue=function(){var e,t,r,n,s=(0,k.useIntl)(),c=(0,k.useAccess)(),u=(0,l.useState)("webhooks"),d=o()(u,2),f=d[0],p=d[1],h=null!==(e=null==c||null===(t=c.hasAnyModulePermission)||void 0===t?void 0:t.call(c,se.MY.WEBHOOK))&&void 0!==e&&e,g=null!==(r=null==c||null===(n=c.hasAnyModulePermission)||void 0===n?void 0:n.call(c,se.MY.WEBHOOK_MESSAGE))&&void 0!==r&&r,m=a()(h?[{key:"webhooks",label:s.formatMessage({id:"webhook.config",defaultMessage:"配置管理"}),children:(0,re.jsx)(le,{})}]:[]);return g&&m.push({key:"messages",label:s.formatMessage({id:"webhook.messages",defaultMessage:"消息记录"}),children:(0,re.jsx)(ce,{})}),m.length?(0,re.jsx)("div",{className:"webhook-container",children:(0,re.jsx)(i.Z,{activeKey:f,onChange:function(e){return p(e)},items:m})}):null}}}]);