"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9572],{11090:function(e,t,r){r.d(t,{Z:function(){return l}});var a=r(83910),s=r(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=r(54183),i=function(e,t){return s.createElement(o.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var l=s.forwardRef(i)},42491:function(e,t,r){var a=r(94433),s=r(38956),n=r(44194),o=r(50929),i=r(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=n.forwardRef((function(e,t){var r=e.fieldProps,n=e.unCheckedChildren,d=e.checkedChildren,u=e.proFieldProps,c=(0,s.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:n,checkedChildren:d},r),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=d},80953:function(e,t,r){var a=r(94433),s=r(38956),n=r(44194),o=r(50929),i=r(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var r=e.fieldProps,n=e.proFieldProps,d=(0,s.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:n},d))};t.Z=n.forwardRef(d)},58454:function(e,t,r){r.r(t),r.d(t,{default:function(){return ae}});var a=r(77033),s=r(75112),n=r(39497),o=r(84176),i=r.n(o),l=r(73193),d=r.n(l),u=r(90819),c=r.n(u),f=r(89933),p=r.n(f),g=r(45332),m=r.n(g),h=r(89246),v=r(78578),M=r(82770),x=r(63649),y=r(2907),b=r(44194),w=r(14906),S=r(59304),Z=r(15722),k=r(54881),j=r(10162),C=r(11090),P=r(2484),T=r(96596),U=r.n(T),I=r(26138),O=r(98830),F=r(91361);function z(e){return A.apply(this,arguments)}function A(){return(A=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/form/query/org",{method:"GET",params:d()(d()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return E.apply(this,arguments)}function E(){return(E=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/form/create",{method:"POST",data:d()(d()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return J.apply(this,arguments)}function J(){return(J=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/form/update",{method:"POST",data:d()(d()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return H.apply(this,arguments)}function H(){return(H=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/form/delete",{method:"POST",data:d()(d()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=r(5932),B=r(25784),D=r(2250),V=r(89965),L=r(80953),X=r(42491),G=r(82864),Q=r(39487),K=r(31549),W=function(e){var t=e.isEdit,r=e.myForm,a=e.open,s=e.level,n=e.onClose,o=e.onSubmit,i=B.A.useForm(),l=m()(i,1)[0],d=(0,w.useIntl)(),u=(0,O.u)((function(e){return e.currentOrg})),c=(0,I.v)((function(e){return e.currentCategory})),f=(0,I.v)((function(e){return e.categorySelectOptions}));(0,b.useEffect)((function(){if(t&&r&&l)l.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,serverType:null==r?void 0:r.type,status:null==r?void 0:r.status,enabled:null==r?void 0:r.enabled,categoryUid:(null==r?void 0:r.categoryUid)||(null==c?void 0:c.uid)});else{l.resetFields();var e=f&&f.length>0?f[0].value:void 0;l.setFieldsValue({categoryUid:e,enabled:!0,status:"INACTIVE",serverConfig:JSON.stringify({serverVersion:"1.0.0",protocol:"http",connectionTimeout:3e4,readTimeout:6e4,maxRetries:3,autoStart:!1},null,2)})}}),[r,t,l,c,f]);return(0,K.jsx)(G.Z,{title:t?d.formatMessage({id:"pages.form.edit",defaultMessage:"编辑表单"}):d.formatMessage({id:"pages.form.create",defaultMessage:"创建表单"}),width:600,open:a,onClose:n,extra:(0,K.jsxs)(Q.Z,{children:[(0,K.jsx)(M.ZP,{onClick:n,children:d.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,K.jsx)(M.ZP,{type:"primary",onClick:function(){l.validateFields().then((function(e){var a;console.log("Form values:",e);if(e.serverConfig)try{JSON.parse(e.serverConfig)}catch(e){return void console.error("Invalid JSON in serverConfig:",e)}var n=f&&f.length>0?f[0].value:void 0,i={uid:t?null==r?void 0:r.uid:"",name:e.name,description:e.description,status:e.status,enabled:null===(a=e.enabled)||void 0===a||a,categoryUid:e.categoryUid||n,level:s,orgUid:null==u?void 0:u.uid};console.log("myFormObject:",i),o(i)})).catch((function(e){console.log("Form errors:",e)}))},children:d.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,K.jsxs)(B.A,{form:l,layout:"vertical",submitter:!1,children:[(0,K.jsx)(D.Z,{name:"categoryUid",label:d.formatMessage({id:"pages.form.categoryUid",defaultMessage:"分类"}),placeholder:d.formatMessage({id:"pages.form.categoryUid.placeholder",defaultMessage:"请选择分类"}),tooltip:d.formatMessage({id:"pages.form.categoryUid.tooltip",defaultMessage:"表单所属分类"}),options:f,rules:[{required:!0,message:d.formatMessage({id:"pages.form.categoryUid.required",defaultMessage:"请选择分类"})}]}),(0,K.jsx)(V.Z,{name:"name",label:d.formatMessage({id:"pages.form.name",defaultMessage:"名称"}),placeholder:d.formatMessage({id:"pages.form.name.placeholder",defaultMessage:"请输入表单名称"}),rules:[{required:!0,message:d.formatMessage({id:"pages.form.name.required",defaultMessage:"请输入名称"})}]}),(0,K.jsx)(L.Z,{name:"description",label:d.formatMessage({id:"pages.form.description",defaultMessage:"描述"}),placeholder:d.formatMessage({id:"pages.form.description.placeholder",defaultMessage:"请输入表单描述"}),rows:3}),(0,K.jsx)(L.Z,{name:"serverConfig",label:d.formatMessage({id:"pages.form.serverConfig",defaultMessage:"服务器配置"}),placeholder:d.formatMessage({id:"pages.form.serverConfig.placeholder",defaultMessage:"请输入JSON格式的服务器配置"}),rows:20,tooltip:d.formatMessage({id:"pages.form.serverConfig.tooltip",defaultMessage:"包含服务器版本、URL、认证、超时、能力等配置的JSON字符串"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();try{return JSON.parse(t),Promise.resolve()}catch(e){return Promise.reject(new Error(d.formatMessage({id:"form.serverConfig.validation.json",defaultMessage:"请输入有效的JSON格式"})))}}}]}),(0,K.jsx)(X.Z,{name:"enabled",label:d.formatMessage({id:"pages.form.enabled",defaultMessage:"启用状态"}),checkedChildren:d.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:d.formatMessage({id:"disabled",defaultMessage:"禁用"}),initialValue:!0})]})})},$=r(19433),_=r(23753),ee=["current","pageSize","prompt"],te=function(e){var t=e.level,r=(e.type,(0,b.useRef)()),a=(0,w.useIntl)(),s=(0,b.useState)(!0),o=m()(s,2),l=o[0],u=o[1],f=(0,F.Z)().translateString,g=(0,b.useState)(1),T=m()(g,2),A=T[0],E=T[1],J=(0,b.useState)(10),H=m()(J,2),B=H[0],D=H[1],V=(0,b.useState)(!1),L=m()(V,2),X=L[0],G=L[1],Q=(0,b.useState)([]),te=m()(Q,2),re=(te[0],te[1]),ae=(0,b.useState)({}),se=m()(ae,2),ne=se[0],oe=se[1],ie=(0,I.v)((function(e){return e.currentCategory})),le=(0,O.u)((function(e){return e.currentOrg})),de=(0,b.useState)(0),ue=m()(de,2),ce=ue[0],fe=ue[1],pe=(0,b.useState)({}),ge=m()(pe,2),me=ge[0],he=ge[1],ve=function(){var e=p()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,R(t);case 3:200===(s=e.sent).code?($.yw.success(a.formatMessage({id:"delete.success"})),null===(n=r.current)||void 0===n||n.reload()):$.yw.error(s.message||a.formatMessage({id:"delete.error"}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=p()(c()().mark((function e(t){var s,n,o,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=7;break}return e.next=3,N(t);case 3:200===(s=e.sent).code?($.yw.success(a.formatMessage({id:"update.success"})),G(!1),null===(n=r.current)||void 0===n||n.reload()):$.yw.error(s.message||a.formatMessage({id:"update.error"})),e.next=11;break;case 7:return e.next=9,q(t);case 9:200===(o=e.sent).code?($.yw.success(a.formatMessage({id:"create.success"})),G(!1),null===(i=r.current)||void 0===i||i.reload()):$.yw.error(o.message||a.formatMessage({id:"create.error"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){u(!1),oe({}),G(!0)};(0,b.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.reload()}),[ie]);var ye=function(){var e=p()(c()().mark((function e(r,a,s){var o,i,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),o=localStorage.getItem(n.LA8),i=d()({categoryUid:(null==ie?void 0:ie.uid)===n.zBg?"":null==ie?void 0:ie.uid,orgUid:t===n.Hxq?"":null==le?void 0:le.uid,level:t,accessToken:o||"",exportType:r},me),"current"===r?(i.pageNumber=String(A-1),i.pageSize=String(B)):"all"===r?(i.pageNumber="0",i.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(i.pageNumber=String(a),i.pageSize=String(s)),l=Object.fromEntries(Object.entries(i).filter((function(e){var t=m()(e,2),r=(t[0],t[1]);return null!=r})).map((function(e){var t=m()(e,2),r=t[0],a=t[1];return[r,String(a)]}))),_.Z.debug("Export MCP Servers url:",(0,Y.kG)()+"/api/v1/form/export?"+new URLSearchParams(l).toString()),window.open((0,Y.kG)()+"/api/v1/form/export?"+new URLSearchParams(l).toString());case 7:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),be=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,o=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return ye("range",a,r)}})},n=0;n<a;n++)s();return t},we=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:a.formatMessage({id:"pages.form.uid",defaultMessage:"UID"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",width:180,copyable:!0,ellipsis:!0},{title:a.formatMessage({id:"pages.form.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:200,copyable:!0,ellipsis:!0,tooltip:a.formatMessage({id:"pages.form.name.tooltip",defaultMessage:"的名称"})},{title:a.formatMessage({id:"pages.form.description",defaultMessage:"描述"}),dataIndex:"description",width:250,copyable:!0,ellipsis:!0,tooltip:a.formatMessage({id:"pages.form.description.tooltip",defaultMessage:"的功能描述"})},{title:a.formatMessage({id:"pages.form.enabled",defaultMessage:"启用状态"}),dataIndex:"enabled",hideInSearch:!0,width:100,tooltip:a.formatMessage({id:"pages.form.enabled.tooltip",defaultMessage:"是否启用该"}),render:function(e,t){return t.enabled?"已启用":"已禁用"}},{title:a.formatMessage({id:"pages.form.categoryUid",defaultMessage:"分类"}),dataIndex:"categoryUid",hideInSearch:!0,width:150,copyable:!0,ellipsis:!0,tooltip:a.formatMessage({id:"pages.form.categoryUid.tooltip",defaultMessage:"所属分类"})},{title:a.formatMessage({id:"pages.form.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:a.formatMessage({id:"pages.form.createdAt.tooltip",defaultMessage:"创建的时间"}),render:function(e,t){return t.createdAt?U()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:a.formatMessage({id:"pages.form.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:a.formatMessage({id:"pages.form.updatedAt.tooltip",defaultMessage:"最后更新的时间"}),render:function(e,t){return t.updatedAt?U()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:a.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:a.formatMessage({id:"pages.form.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,K.jsx)(v.Z,{title:a.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,K.jsx)(M.ZP,{type:"text",size:"small",icon:(0,K.jsx)(S.Z,{}),onClick:function(){return function(e){u(!0),oe(e),G(!0)}(t)}})},"edit"),(0,K.jsx)(x.Z,{title:a.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(f(t.name),"】？"),onConfirm:function(){return ve(t)},okText:a.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:a.formatMessage({id:"cancel",defaultMessage:"取消"}),icon:(0,K.jsx)(Z.Z,{style:{color:"red"}}),children:(0,K.jsx)(v.Z,{title:a.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,K.jsx)(M.ZP,{type:"text",size:"small",danger:!0,icon:(0,K.jsx)(k.Z,{})})})},"delete")]}}],Se=function(){var e=p()(c()().mark((function e(r,s,o){var l,u,f,p,g,m,h,v,M,x,y,b;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.current,r.pageSize,r.prompt,l=i()(r,ee),he({name:r.name,description:r.description}),u=r.current?r.current-1:0,f=r.pageSize||10,E(r.current||1),D(f),p="createdAt",g="desc",s&&Object.keys(s).length>0&&(m=Object.keys(s)[0],p=m,g="ascend"===s[m]?"asc":"desc"),h=d()({pageNumber:u,pageSize:f,sortBy:p,sortDirection:g,level:t,orgUid:null==le?void 0:le.uid,categoryUid:(null==ie?void 0:ie.uid)===n.zBg?"":null==ie?void 0:ie.uid},l),e.prev=10,e.next=13,z(h);case 13:if(v=e.sent,_.Z.debug("queryFormsByOrg:",v,h),200!==v.code){e.next=22;break}return b=(null===(M=v.data)||void 0===M?void 0:M.content)||[],re(b),fe((null===(x=v.data)||void 0===x?void 0:x.totalElements)||0),e.abrupt("return",{data:b,success:!0,total:(null===(y=v.data)||void 0===y?void 0:y.totalElements)||0});case 22:return $.yw.error(v.message||a.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 24:e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(10),console.error("查询失败:",e.t0),$.yw.error(a.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 31:case"end":return e.stop()}}),e,null,[[10,26]])})));return function(t,r,a){return e.apply(this,arguments)}}();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(h.Z,{headerTitle:a.formatMessage({id:"pages.form.title",defaultMessage:"管理"}),actionRef:r,rowKey:"uid",search:{labelWidth:"auto"},toolBarRender:function(){return e=[(0,K.jsx)(M.ZP,{type:"primary",icon:(0,K.jsx)(j.Z,{}),onClick:xe,children:a.formatMessage({id:"create.form",defaultMessage:"新建"})},"create")],t=[{key:"export-current",icon:(0,K.jsx)(C.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}],ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,K.jsx)(C.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ye("all")}}):t.push({key:"export-range",icon:(0,K.jsx)(C.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:be(ce)})),e.push((0,K.jsx)(y.Z,{menu:{items:t},placement:"bottom",children:(0,K.jsxs)(M.ZP,{type:"primary",icon:(0,K.jsx)(C.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"导出"}),(0,K.jsx)(P.Z,{})]})},"export")),e;var e,t},request:Se,columns:we,scroll:{x:"max-content"},pagination:{pageSize:B,current:A,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e," ").concat(a.formatMessage({id:"items",defaultMessage:"条"}))}},options:{setting:{listsHeight:400}},size:"small"}),X&&(0,K.jsx)(W,{isEdit:l,myForm:ne,open:X,level:t,onClose:function(){return G(!1)},onSubmit:Me})]})},re=r(54285),ae=function(){var e=(0,s.Z)(),t=e.leftSiderStyle,r=e.contentStyle;return(0,K.jsxs)(a.Z,{style:{height:"100%"},children:[(0,K.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,K.jsx)(re.Z,{type:n.aTU,level:n.whQ,showKbase:!1})}),(0,K.jsx)(a.Z.Panel,{style:r,children:(0,K.jsx)(te,{level:n.whQ})})]})}}}]);