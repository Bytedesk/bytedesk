"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7786],{90938:function(e,n,t){var r=t(96775);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},94611:function(e,n,t){t.d(n,{Z:function(){return X}});var r=t(90819),o=t.n(r),a=t(76711),l=t.n(a),s=t(73193),i=t.n(s),u=t(89933),d=t.n(u),c=t(45332),f=t.n(c),g=t(35746),b=t(55721),v=t(90883),m=t(56668),p=t(46206),h=t(31461),x=t(2887),k=t(44194),y=t(10154),w=t.n(y),K=t(50884),j=t(21002),Z=t(28520),M=t(27353),C=t(97588),S=t(67186),P=t(17455),F=t(83788),R=t(69159),H=t(83801),E=t(22014),U=t(43420),V=t(28704),L=t(61476),T=t(31549),I=function(e){var n=e.open,t=e.isEdit,r=e.type,a=e.kbase,l=e.onCancel,s=e.onSubmit,u=C.A.useForm(),c=f()(u,1)[0],b=(0,j.Z)().translateString,m=(0,Z.u)((function(e){return e.currentOrg})),p=(0,k.useRef)(null),h=(0,k.useState)((0,L.kG)()+"/avatars/workflow.png"),x=f()(h,2),y=x[0],I=x[1],q=(0,k.useState)([]),O=f()(q,2),A=O[0],D=(O[1],(0,k.useState)({})),_=f()(D,2),z=_[0],N=_[1],Q=(0,k.useState)(!1),W=f()(Q,2),G=W[0],J=W[1],B="ollama",X="bge-m3:latest",Y=(0,k.useState)((null==a?void 0:a.embeddingProvider)||B),$=f()(Y,2),ee=$[0],ne=$[1],te=(0,k.useState)((null==a?void 0:a.embeddingModel)||X),re=f()(te,2),oe=re[0],ae=re[1],le=(0,k.useState)(""),se=f()(le,2),ie=se[0],ue=se[1];(0,k.useEffect)((function(){t?(c.setFieldsValue({name:b(null==a?void 0:a.name)}),c.setFieldsValue({headline:b(null==a?void 0:a.headline)}),c.setFieldsValue({footerHtml:b(null==a?void 0:a.footerHtml)}),c.setFieldsValue({descriptionHtml:b(null==a?void 0:a.descriptionHtml)}),c.setFieldsValue({language:null==a?void 0:a.language}),c.setFieldsValue({logoUrl:null==a?void 0:a.logoUrl}),I((null==a?void 0:a.logoUrl)||""),null!=a&&a.embeddingProvider&&(ne(a.embeddingProvider),c.setFieldsValue({embeddingProvider:a.embeddingProvider})),null!=a&&a.embeddingModel&&(ae(a.embeddingModel),c.setFieldsValue({embeddingModel:a.embeddingModel}))):(c.resetFields(),c.setFieldsValue({language:"ZH_CN"}),c.setFieldsValue({logoUrl:y}),c.setFieldsValue({embeddingProvider:B,embeddingModel:X})),n&&setTimeout((function(){var e;null===(e=p.current)||void 0===e||e.focus()}),100)}),[n,t,a]),(0,k.useEffect)((function(){if(ee&&oe&&z[ee]){var e=z[ee].find((function(e){return e.value===oe}));e&&ue(e.label)}}),[z,ee,oe]);var de=(0,k.useCallback)((function(){J(!1)}),[]),ce=(0,k.useCallback)((function(e,n,t){ne(e),ae(n),ue(t),c.setFieldValue("embeddingProvider",e),c.setFieldValue("embeddingModel",n),J(!1)}),[c]),fe=(0,k.useCallback)((function(e,n){N((function(t){return i()(i()({},t),{},w()({},e,n))}))}),[]),ge=function(){c.validateFields().then(function(){var e=d()(o()().mark((function e(n){var l;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("KbaseForm handleSubmit:",n),l={uid:t?null==a?void 0:a.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:r,language:n.language,embeddingProvider:n.embeddingProvider||B,embeddingModel:n.embeddingModel||X,logoUrl:n.logoUrl||y,orgUid:null==m?void 0:m.uid},s(l);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),K.yw.error("创建知识库失败")}))},be=function(e){"Enter"===e.key&&ge()};return(0,T.jsxs)("div",{children:[(0,T.jsx)(g.Z,{title:"新建知识库",open:n,forceRender:!0,onOk:ge,onCancel:l,children:(0,T.jsxs)(C.A,{form:c,submitter:!1,children:[(0,T.jsx)(R.Z.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:"Logo",children:(0,T.jsxs)(U.G,{onSuccess:function(e){I(e),c.setFieldValue("logoUrl",e)},onError:function(e){console.log("logo upload error:",e)},children:[(0,T.jsx)(H.Z,{src:y}),(0,T.jsx)(v.ZP,{icon:(0,T.jsx)(E.Z,{}),children:"上传"})]})}),(0,T.jsx)(S.Z,{name:"logoUrl",hidden:!0}),(0,T.jsx)(P.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,T.jsx)(S.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:be,placeholder:"请输入名称",ref:p}}),r===M.VX&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(S.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:be,placeholder:"请输入名称"}}),(0,T.jsx)(F.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,T.jsx)(F.Z,{label:"描述",name:"descriptionHtml"})]})}),r===M.QPQ&&(0,T.jsx)(V.Z,{visible:G,onCancel:de,onOk:ce,initialProvider:ee,initialModel:oe,initialModelLabel:ie,providers:A,currentOrgUid:null==m?void 0:m.uid,existingProviderModels:z,onModelsLoaded:fe,allowedModelTypes:[M.xTq]})]})},q=t(77129),O=t(64967),A=t(96775),D=t(2290),_=t(83381),z=t(90092),N=t(35911),Q=t(41881),W=t(91768),G=t(80503),J=t(12715),B=g.Z.confirm,X=function(e){var n=e.type,t=(0,D.useIntl)(),r=(0,k.useState)(!1),a=f()(r,2),s=a[0],u=a[1],c=(0,k.useRef)(!1),g=(0,k.useState)(!0),y=f()(g,2),w=y[0],C=y[1],S=(0,k.useState)(0),P=f()(S,2),F=P[0],R=P[1],H=(0,k.useState)(!1),E=f()(H,2),U=E[0],V=E[1],L=(0,k.useState)(""),X=f()(L,2),Y=X[0],$=X[1],ee=(0,A.Z)().isDarkMode,ne=(0,j.Z)().translateString,te=(0,Z.u)((function(e){return e.currentOrg})),re=(0,k.useState)(!0),oe=f()(re,2),ae=oe[0],le=oe[1],se=(0,O.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),ie=se.kbaseResult,ue=se.currentKbase,de=se.insertKbase,ce=se.updateLocalKbase,fe=se.setKbaseResult,ge=se.setCurrentKbase,be=se.removeKbase,ve=(0,k.useCallback)(d()(o()().mark((function e(){var t,r,a,d,f,g,b,v,m,p,h,x,k=arguments;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.length>0&&void 0!==k[0]?k[0]:0,r=k.length>1&&void 0!==k[1]&&k[1],!s&&!c.current){e.next=4;break}return e.abrupt("return");case 4:return c.current=!0,u(!0),a={pageNumber:t,pageSize:20,type:n,orgUid:null==te?void 0:te.uid,searchText:Y},e.prev=7,e.next=10,(0,q.AP)(a);case 10:d=e.sent,console.log("queryKbasesByOrg: ",d),200===d.code?(v=(null==d||null===(f=d.data)||void 0===f?void 0:f.content)||[],m=null!==(g=null==d||null===(b=d.data)||void 0===b?void 0:b.last)&&void 0!==g?g:0===v.length,C(!m),R(t),r?(h=(null==ie||null===(p=ie.data)||void 0===p?void 0:p.content)||[],x=i()(i()({},d),{},{data:i()(i()({},null==d?void 0:d.data),{},{content:[].concat(l()(h),l()(v))})}),fe(x)):fe(d)):K.yw.error(d.message);case 13:return e.prev=13,c.current=!1,u(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[7,,13,17]])}))),[s,Y,n,null==te?void 0:te.uid,ie,fe]);(0,k.useEffect)((function(){console.log("useEffect: getKbase"),R(0),C(!0),ve(0,!1)}),[Y,n,null==te?void 0:te.uid]);var me=function(){var e=d()(o()().mark((function e(n){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",K.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,q.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(de(null==r?void 0:r.data),ge(null==r?void 0:r.data),K.yw.success({content:"创建成功！",key:t,duration:2}),V(!1)):(console.log("create kb failed",r),K.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),pe=function(){var e=d()(o()().mark((function e(n){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",K.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,q.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(ce(null==r?void 0:r.data),ge(null==r?void 0:r.data),K.yw.success({content:"更新成功！",key:t,duration:2}),V(!1)):(console.log("update kb failed",r),K.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),he=function(){var e=d()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",ue),le(!0),V(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=d()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae?pe(n):me(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ke=function(){var e=d()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==ie.data.content.length){e.next=4;break}return K.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,q._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(be(n.uid),ve()):(console.log("handleDeleteKbase: ",r),K.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ye=function(e){console.log("搜索内容:",e)},we=function(e){var t=function(e){return n!==M._FS?ne(e.descriptionHtml):e.level===M.Hxq?"全平台客服可见":e.level===M.whQ?"本组织客服可见":e.level===M.fyH?"本客服可见":ne(e.descriptionHtml)}(e);return t};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(b.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,T.jsxs)(b.Z,{gap:"small",children:[(0,T.jsx)(v.ZP,{type:"primary",size:"small",icon:(0,T.jsx)(z.Z,{}),onClick:function(){console.log("new kb"),le(!1),V(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,T.jsx)(v.ZP,{size:"small",icon:(0,T.jsx)(N.Z,{spin:s}),onClick:function(){R(0),C(!0),ve(0,!1)},loading:s,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==ue?void 0:ue.uid)&&(0,T.jsx)(m.Z,{menu:{items:[{key:"edit",icon:(0,T.jsx)(Q.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:he},{key:"delete",icon:(0,T.jsx)(W.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){B({title:t.formatMessage({id:"deleteTip"}),icon:(0,T.jsx)(_.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ne(e.name),"】？"),onOk:function(){ke(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(ue)}}]},children:(0,T.jsx)(v.ZP,{size:"small",icon:(0,T.jsx)(G.Z,{})})})]}),(0,T.jsx)("div",{style:{padding:"0 10px 10px 10px"},children:(0,T.jsxs)(p.Z.Compact,{style:{width:"100%"},children:[(0,T.jsx)(h.Z,{placeholder:t.formatMessage({id:"kbase.search.placeholder",defaultMessage:"搜索知识库名称"}),value:Y,onChange:function(e){return $(e.target.value)},onPressEnter:function(){return ye(Y)},allowClear:!0}),(0,T.jsx)(v.ZP,{icon:(0,T.jsx)(J.Z,{}),onClick:function(){return ye(Y)}})]})}),(0,T.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 200px)"},onScroll:function(e){var n=e.currentTarget,t=n.scrollTop;n.scrollHeight-t-n.clientHeight<50&&w&&!s&&ve(F+1,!0)},children:(0,T.jsx)(x.Z,{itemLayout:"horizontal",dataSource:ie.data.content,renderItem:function(e,n){return(0,T.jsx)(x.Z.Item,{style:ue.uid===e.uid?{backgroundColor:ee?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){ge(e)},children:(0,T.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:e.logoUrl?(0,T.jsx)("img",{src:e.logoUrl,alt:"logo",style:{width:40,height:40,borderRadius:"50%",objectFit:"cover"}}):void 0,title:ne(e.name),description:we(e)})})}})}),U&&(0,T.jsx)(I,{open:U,isEdit:ae,type:n,kbase:ue,onSubmit:xe,onCancel:function(){V(!1)}})]})}},64967:function(e,n,t){t.d(n,{j:function(){return c}});var r=t(73193),o=t.n(r),a=t(76711),l=t.n(a),s=t(27353),i=t(26557),u=t(26407),d=t(20744),c=(0,i.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(l()(r.slice(0,a)),[t],l()(r.slice(a+1))),i=o()(o()({},n().kbaseResult),{},{data:{content:s}});e({kbaseResult:i,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({kbaseResult:o()(o()({},n().kbaseResult),{},{data:{content:[].concat(l()(r.slice(0,a)),l()(r.slice(a+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:s.wKE})))}}]);