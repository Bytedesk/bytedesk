"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4713],{66247:function(e,n,t){var r=t(90819),o=t.n(r),l=t(89933),i=t.n(l),a=t(45332),s=t.n(a),c=t(44194),d=t(36605),u=t(86803),m=t(23864),f=t(76750),v=t(30921),p=t(53530),g=t(27487),x=t(75365),h=t(9452),y=t(84288),j=t(40612),w=t(55735),P=t(15722),Z=t(11490),k=t(17520),b=t(19317),L=t(31549);n.Z=function(e){var n,t,r=e.level,l=(0,m.Z)().isDarkMode,a=(0,v.useIntl)(),M=(0,f.Z)(),C=M.translateString,S=M.translateStringTranct,I=(0,j.u)((function(e){return e.currentOrg})),R=(0,c.useState)(!1),F=s()(R,2),T=F[0],U=F[1],z=(0,c.useState)(!1),O=s()(z,2),E=O[0],N=(O[1],(0,Z.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}}))),D=N.llmproviderResult,K=N.currentLlmProvider,q=N.setLlmProviderResult,A=N.insertLlmProvider,_=N.setCurrentLlmProvider,H=N.upgradeLlmProvider,B=N.deleteCurrentLlmProvider,V=(0,b.$)((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),Y=V.llmproviderResultPlatform,J=V.currentLlmProviderPlatform,Q=V.setLlmProviderResultPlatform,W=V.insertLlmProviderPlatform,$=V.setCurrentLlmProviderPlatform,G=V.upgradeLlmProviderPlatform,X=V.deleteCurrentLlmProviderPlatform,ee=(0,c.useState)(r===w.Hxq),ne=s()(ee,1)[0],te=ne?J:K,re=p.Z.useModal(),oe=s()(re,2),le=oe[0],ie=oe[1],ae=function(){var e=i()(o()().mark((function e(n){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),u.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,d.HH)(n);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(u.yw.destroy(),u.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ne?X(n.uid):B(n.uid)):(u.yw.destroy(),u.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=i()(o()().mark((function e(){var n,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),n={pageNumber:0,pageSize:50,status:r===w.Hxq?"":w.KY,orgUid:r===w.Hxq?"":null==I?void 0:I.uid,level:r},e.next=4,(0,d.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t),200===t.code?ne?Q(t):q(t):u.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){se()}),[]);var ce=function(){var e=i()(o()().mark((function e(n){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",n),u.yw.loading(a.formatMessage({id:"creating"})),e.next=4,(0,d.T)(n);case 4:t=e.sent,console.log("createLlmProvider:",t),200===t.code?(u.yw.destroy(),u.yw.success(a.formatMessage({id:"create.success",defaultMessage:"create success"})),ne?W(t.data):A(t.data),U(!1)):(u.yw.destroy(),u.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=i()(o()().mark((function e(n){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(a.formatMessage({id:"updating"})),e.next=3,(0,d.fx)(n);case 3:t=e.sent,console.log("updateLlmProvider:",n,t),200===t.code?(u.yw.destroy(),u.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ne?G(t.data):H(t.data),U(!1)):(u.yw.destroy(),u.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{margin:10},children:(0,L.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[!1,(0,L.jsx)(x.ZP,{onClick:function(){return function(e){le.confirm({title:a.formatMessage({id:"deleteTip"}),icon:(0,L.jsx)(P.Z,{}),content:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(C(e.nickname),"】？"),onOk:function(){ae(e)},onCancel:function(){},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}(te)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==te?void 0:te.uid),children:a.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,L.jsx)(h.Z,{itemLayout:"horizontal",dataSource:ne?(null==Y||null===(n=Y.data)||void 0===n?void 0:n.content)||[]:(null==D||null===(t=D.data)||void 0===t?void 0:t.content)||[],renderItem:function(e,n){return(0,L.jsx)(h.Z.Item,{style:(null==te?void 0:te.uid)===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return n=e,void(ne?$(n):_(n));var n},children:(0,L.jsx)(h.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,L.jsx)(y.C,{src:e.logo}),title:(0,L.jsx)(L.Fragment,{children:S(null==e?void 0:e.nickname)}),description:(null==e?void 0:e.status)===w.KY?"上线发布":"未上线"})})}}),T&&(0,L.jsx)(k.Z,{open:T,isEdit:E,level:r,llmProvider:te,onCancel:function(){U(!1)},onSubmit:function(e){E?de(e):ce(e)}}),ie]})}},51729:function(e,n,t){t.d(n,{Z:function(){return xe}});var r=t(76711),o=t.n(r),l=t(45332),i=t.n(l),a=t(44194),s=t(8247),c=t(73193),d=t.n(c),u=t(86222),m=t.n(u),f=t(90819),v=t.n(f),p=t(89933),g=t.n(p),x=t(86803),h=t(82863),y=t(40612),j=t(55735),w=t(29266),P=t(53530),Z=t(84288),k=t(75365),b=t(39042),L=t(38775),M=t(3849),C=t(9452),S=t(32327),I=t(69169),R=t(4499),F=t(73442),T=t(31549),U=function(e){var n=e.isEdit,t=e.llmmodel,r=e.provider,o=e.open,l=e.level,s=e.onClose,c=e.onSubmit,d=I.A.useForm(),u=i()(d,1)[0],m=(0,y.u)((function(e){return e.currentOrg}));(0,a.useEffect)((function(){n&&t&&u?u.setFieldsValue({uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname}):(console.log("form resetFields"),u.resetFields())}),[t]);return(0,a.useEffect)((function(){}),[t]),(0,T.jsx)("div",{children:(0,T.jsx)(F.Z,{title:n?"编辑模型":"新建模型",width:600,onClose:s,open:o,extra:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)(k.ZP,{onClick:s,children:"取消"}),(0,T.jsx)(k.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var o={uid:n?null==t?void 0:t.uid:"",name:e.name,nickname:e.nickname,providerUid:null==r?void 0:r.uid,level:l,orgUid:null==m?void 0:m.uid};console.log("llmmodelObject:",o),c(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,T.jsxs)(I.A,{form:u,name:"model",submitter:!1,children:[(0,T.jsx)(R.Z,{label:"名称(用于接口调用)",name:"name"}),(0,T.jsx)(R.Z,{label:"昵称(便于记忆)",name:"nickname"})]})})})},z=t(15722),O=t(11090),E=t(10162),N=t(30617),D=t(80556),K=t(30921),q=t(36605),A=t(23864),_=t(76750),H=t(11490),B=t(17520),V=t(80601),Y=t(7875),J=S.Z.Text,Q=function(e){var n=e.provider,t=e.open,r=(e.level,e.onClose),o=e.onSubmit,l=e.existingModels,s=void 0===l?[]:l,c=((0,K.useIntl)(),(0,a.useState)(!1)),d=i()(c,2),u=d[0],m=d[1],f=(0,a.useState)([]),p=i()(f,2),y=p[0],P=p[1],Z=(0,a.useState)([]),b=i()(Z,2),L=b[0],C=b[1],S=function(e){return s.some((function(n){return n.name===e.name}))},I=function(){var e=g()(v()().mark((function e(){var t,r,o,l;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),e.prev=1,t={pageNumber:0,pageSize:100,level:j.Hxq,providerName:n.name},e.next=5,(0,h.LF)(t);case 5:r=e.sent,console.log("获取平台模型列表:",r),200===r.code?(o=r.data.content||[],P(o),l=o.filter((function(e){return S(e)})).map((function(e){return e.uid})),C(l)):x.yw.error(r.message||"获取模型列表失败"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),x.yw.error("获取模型列表异常");case 14:return e.prev=14,m(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){t&&I()}),[t]);var R=[{title:"名称",dataIndex:"name",key:"name",render:function(e,n){return(0,T.jsxs)(M.Z,{children:[e,S(n)&&(0,T.jsx)(w.Z,{color:"green",children:"已存在"})]})}},{title:"别名",dataIndex:"nickname",key:"nickname"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0}],U={selectedRowKeys:L,onChange:function(e){C(e)}};return(0,T.jsxs)(F.Z,{title:"导入".concat(n.nickname,"模型"),width:700,open:t,onClose:r,destroyOnClose:!0,footer:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)(k.ZP,{onClick:r,children:"取消"}),(0,T.jsxs)(k.ZP,{type:"primary",onClick:function(){if(0!==L.length){var e=y.filter((function(e){return L.includes(e.uid)}));o(e)}else x.yw.warning("请至少选择一个模型")},disabled:0===L.length,children:["导入已选(",L.length,")"]})]}),children:[(0,T.jsxs)(J,{type:"secondary",children:["从平台已有的",n.nickname,"模型中选择并导入到当前组织",s.length>0&&(0,T.jsx)(J,{type:"secondary",style:{marginLeft:8},children:"（已有标签的模型表示已导入到当前组织）"})]}),(0,T.jsx)("div",{style:{marginTop:16},children:(0,T.jsx)(V.Z,{spinning:u,children:(0,T.jsx)(Y.Z,{rowKey:"uid",columns:R,dataSource:y,pagination:{pageSize:10},rowSelection:U,size:"small"})})}),0===y.length&&!u&&(0,T.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,T.jsx)(J,{type:"secondary",children:"没有找到可导入的平台模型"})})]})},W={chat:"blue",embedding:"purple",vision:"green",code:"cyan",reasoning:"orange",text2image:"magenta",image2text:"pink",audio2text:"volcano",text2audio:"geekblue",text2video:"lime",video2text:"gold",default:"default"},$={chat:(0,T.jsx)(K.FormattedMessage,{id:"model.type.chat",defaultMessage:"对话"}),embedding:(0,T.jsx)(K.FormattedMessage,{id:"model.type.embedding",defaultMessage:"嵌入"}),vision:(0,T.jsx)(K.FormattedMessage,{id:"model.type.vision",defaultMessage:"视觉"}),code:(0,T.jsx)(K.FormattedMessage,{id:"model.type.code",defaultMessage:"代码"}),reasoning:(0,T.jsx)(K.FormattedMessage,{id:"model.type.reasoning",defaultMessage:"推理"}),text2image:(0,T.jsx)(K.FormattedMessage,{id:"model.type.text2image",defaultMessage:"文生图"}),image2text:(0,T.jsx)(K.FormattedMessage,{id:"model.type.image2text",defaultMessage:"图生文"}),audio2text:(0,T.jsx)(K.FormattedMessage,{id:"model.type.audio2text",defaultMessage:"语音转文本"}),text2audio:(0,T.jsx)(K.FormattedMessage,{id:"model.type.text2audio",defaultMessage:"文本转语音"}),text2video:(0,T.jsx)(K.FormattedMessage,{id:"model.type.text2video",defaultMessage:"文生视频"}),video2text:(0,T.jsx)(K.FormattedMessage,{id:"model.type.video2text",defaultMessage:"视频转文本"})},G=function(e){if(!e)return null;var n=W[e.toLowerCase()]||W.default,t=$[e.toLowerCase()]||e;return(0,T.jsx)(w.Z,{color:n,children:t})},X=function(e){var n=e.provider,t=e.level,r=(0,K.useIntl)(),o=(0,A.Z)().isDarkMode,l=(0,a.useState)(!0),s=i()(l,2),c=s[0],u=s[1],f=(0,_.Z)(),p=f.translateString,w=(f.translateStringTranct,(0,a.useState)()),I=i()(w,2),R=I[0],F=I[1],V=(0,a.useState)(!1),Y=i()(V,2),J=Y[0],W=Y[1],$=(0,a.useState)(!1),X=i()($,2),ee=X[0],ne=X[1],te=(0,y.u)((function(e){return e.currentOrg})),re=(0,a.useState)([]),oe=i()(re,2),le=oe[0],ie=oe[1],ae=(0,H.A)((function(e){return e.upgradeLlmProvider})),se=P.Z.useModal(),ce=i()(se,2),de=ce[0],ue=ce[1],me=(0,a.useState)(!1),fe=i()(me,2),ve=fe[0],pe=fe[1],ge=function(){var e=g()(v()().mark((function e(n){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),x.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,h.Oh)(n);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),xe()):(x.yw.destroy(),x.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=function(){var e=g()(v()().mark((function e(){var o,l;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestModels"),ie([]),x.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),o={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:null==te?void 0:te.uid,level:t},e.next=6,(0,h.LF)(o);case 6:l=e.sent,console.log("queryLlmModelsByOrg: ",l,o),200===l.code?(ie(l.data.content),x.yw.destroy()):(x.yw.destroy(),x.yw.error(l.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){xe()}),[]);var he=function(){W(!1)},ye=function(){ne(!1)},je=function(){var e=g()(v()().mark((function e(n){var t,o;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",n),!c){e.next=9;break}return e.next=4,(0,h.WS)(n);case 4:t=e.sent,console.log("updateLlmModel:",t),200===t.code?(x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),xe(),he()):x.yw.error(t.message),e.next=14;break;case 9:return e.next=11,(0,h.Jr)(n);case 11:o=e.sent,console.log("createLlmModel:",o),200===o.code?(x.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),xe(),he()):x.yw.error(o.message);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),we=function(){var e=g()(v()().mark((function e(r){var o,l,i,a,s,c,d,u;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",r),r&&0!==r.length){e.next=5;break}return x.yw.warning("没有选择任何模型"),ye(),e.abrupt("return");case 5:if(o=le.map((function(e){return e.name})),l=r.filter((function(e){return!o.includes(e.name)})),0!==l.length){e.next=11;break}return x.yw.info("所选模型均已存在，无需重复导入"),ye(),e.abrupt("return");case 11:x.yw.loading("正在导入".concat(l.length,"个模型...")),e.prev=12,i=0,a=m()(l),e.prev=15,a.s();case 17:if((s=a.n()).done){e.next=27;break}return c=s.value,d={name:c.name,nickname:c.nickname,description:c.description,providerUid:n.uid,providerName:n.name,orgUid:null==te?void 0:te.uid,level:t},e.next=22,(0,h.Jr)(d);case 22:u=e.sent,console.log("createLlmModel:",u,d),200===u.code&&i++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),a.e(e.t0);case 32:return e.prev=32,a.f(),e.finish(32);case 35:x.yw.destroy(),i>0?(x.yw.success("成功导入".concat(i,"个模型")),xe()):x.yw.warning("没有成功导入任何模型"),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),x.yw.destroy(),x.yw.error("导入模型失败");case 44:ye();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(n){return e.apply(this,arguments)}}(),Pe=function(){var e=g()(v()().mark((function e(t){var o,l;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",n),o=d()(d()({},n),{},{status:t?j.KY:j.L2A}),e.next=4,(0,q.fx)(o);case 4:l=e.sent,console.log("updateLlmProvider:",o,l),200===l.code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),ae(l.data)):(x.yw.destroy(),x.yw.error(l.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ze=function(e,n){var t;console.log("list on delete",e),t=e,de.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,T.jsx)(z.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(t.nickname),"】？"),onOk:function(){ge(t)},onCancel:function(){},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})},ke=function(){var e=g()(v()().mark((function e(n){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"updating"})),e.next=3,(0,q.fx)(n);case 3:t=e.sent,console.log("updateLlmProvider:",n,t),200===t.code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),ae(t.data),pe(!1)):(x.yw.destroy(),x.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("h1",{children:[(0,T.jsx)(Z.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,T.jsx)(k.ZP,{type:"text",icon:(0,T.jsx)(O.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),t===j.Hxq&&(0,T.jsx)(b.Z,{checkedChildren:"上线发布",unCheckedChildren:"下线调试",defaultChecked:(null==n?void 0:n.status)===j.KY,onChange:function(e){console.log("switch to ".concat(e)),Pe(e)}}),(0,T.jsx)(L.Z,{orientation:"left",children:"模型列表"}),(0,T.jsxs)(M.Z,{children:[(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(E.Z,{}),type:"primary",onClick:function(){u(!1),W(!0)},children:"添加模型"}),"ollama"!==n.name&&t===j.whQ&&(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(N.Z,{}),onClick:function(){return ne(!0)},children:"导入模型"}),(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(D.Z,{}),onClick:xe,children:"刷新模型"})]}),(0,T.jsx)(C.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:le,renderItem:function(e,n){return(0,T.jsx)(C.Z.Item,{style:(null==R?void 0:R.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){F(e)},actions:[(0,T.jsx)(k.ZP,{type:"link",onClick:function(){return n=e,console.log("list on edit",n),u(!0),void W(!0);var n},children:r.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,T.jsx)(k.ZP,{type:"link",onClick:function(){return Ze(e)},children:r.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,T.jsx)(C.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)("span",{children:e.nickname}),G(e.type)]}),description:(0,T.jsxs)("div",{children:[(0,T.jsx)(S.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,T.jsx)("div",{style:{marginTop:"4px"},children:(0,T.jsx)(S.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}}),J&&(0,T.jsx)(U,{isEdit:c,llmmodel:R,provider:n,open:J,level:t,onClose:he,onSubmit:je}),ee&&(0,T.jsx)(Q,{provider:n,open:ee,level:t,onClose:ye,onSubmit:we,existingModels:le}),ve&&(0,T.jsx)(B.Z,{open:ve,isEdit:c,level:t,llmProvider:n,onCancel:function(){return pe(!1)},onSubmit:ke}),ue]})},ee=t(92053),ne=t(77274),te=t(82690),re=t(54881),oe=t(32943),le=t(61355),ie=t(88996),ae=t(65461),se=t(19116),ce=t(52288),de=t(90727),ue=t(93689),me=t(54495),fe=function(e){var n,t,r,o,l,s,c,d,u,m,f,v=e.visible,p=e.onClose,g=e.modelName,x=e.modelDetails,h=e.loading,y=e.onRefresh,j=e.onPull,P=e.onDelete,Z=(e.isRemoteModel,e.isLocalModel),b=e.pullingModelName,S=e.localModelNames,I=void 0===S?[]:S,R=(0,a.useState)(""),U=i()(R,2),z=U[0],O=U[1],E=x&&"model"in x&&"tags"in x,N=x&&"license"in x&&"modelfile"in x,K=I.includes(g);return(0,T.jsxs)(F.Z,{title:"模型详情 - ".concat(g),width:600,placement:"right",onClose:p,open:v,zIndex:1002,children:[h?(0,T.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:(0,T.jsx)(V.Z,{tip:"加载中...",spinning:!0,children:(0,T.jsx)("div",{style:{padding:"50px",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px",minHeight:"200px"}})})}):x?(0,T.jsxs)(T.Fragment,{children:[E&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(se.Z,{bordered:!0,column:1,title:"基本信息",styles:{label:{width:"120px"}},children:[(0,T.jsx)(se.Z.Item,{label:"名称",children:(0,T.jsxs)(M.Z,{children:[(null===(n=x.model)||void 0===n?void 0:n.name)||g,K&&(0,T.jsx)(w.Z,{color:"success",children:"已安装"})]})}),(null===(t=x.model)||void 0===t?void 0:t.description)&&(0,T.jsx)(se.Z.Item,{label:"描述",children:x.model.description}),(null===(r=x.model)||void 0===r?void 0:r.lastUpdated)&&(0,T.jsx)(se.Z.Item,{label:"最后更新",children:x.model.lastUpdated}),(null===(o=x.model)||void 0===o?void 0:o.pullCount)&&(0,T.jsx)(se.Z.Item,{label:"下载次数",children:x.model.pullCount}),(null===(l=x.model)||void 0===l?void 0:l.totalTags)&&(0,T.jsx)(se.Z.Item,{label:"标签数量",children:x.model.totalTags}),(null===(s=x.model)||void 0===s?void 0:s.popularTags)&&x.model.popularTags.length>0&&(0,T.jsx)(se.Z.Item,{label:"热门标签",children:(0,T.jsx)(M.Z,{wrap:!0,children:x.model.popularTags.map((function(e,n){return(0,T.jsx)(w.Z,{color:"blue",children:e},n)}))})}),(null===(c=x.model)||void 0===c?void 0:c.modified_at)&&(0,T.jsx)(se.Z.Item,{label:"修改时间",children:(0,ae.mr)(x.model.modified_at.toString())})]}),x.tags&&x.tags.length>0&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(L.Z,{orientation:"left",children:"可用版本"}),(0,T.jsx)(ce.Z,{placeholder:"搜索版本...",prefix:(0,T.jsx)(de.Z,{}),value:z,onChange:function(e){return O(e.target.value)},style:{marginBottom:16},allowClear:!0}),(0,T.jsx)(C.Z,{itemLayout:"horizontal",dataSource:function(){if(!E||!x.tags)return[];var e=x.tags;if(!z)return e;var n=z.toLowerCase();return e.filter((function(e){return e.tag.toLowerCase().includes(n)||e.name.toLowerCase().includes(n)}))}(),renderItem:function(e){var n=function(e,n){var t="".concat(e,":").concat(n);return I.includes(t)}(g,e.tag),t="".concat(g,":").concat(e.tag);return(0,T.jsxs)(C.Z.Item,{children:[(0,T.jsx)(C.Z.Item.Meta,{title:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)("span",{children:e.name}),(0,T.jsx)(w.Z,{color:"green",children:e.tag}),e.size&&(0,T.jsx)(w.Z,{color:"orange",children:e.size}),n&&(0,T.jsx)(w.Z,{color:"success",children:"已安装"})]}),description:(0,T.jsxs)("span",{children:["最后更新: ",e.lastUpdated]})}),(0,T.jsx)(M.Z,{children:(0,T.jsx)(ie.Z,{title:n?"模型版本已安装":"点击拉取此版本",children:(0,T.jsx)(k.ZP,{type:"primary",size:"small",icon:n?(0,T.jsx)(ue.Z,{}):(0,T.jsx)(me.Z,{}),loading:b===t,onClick:function(){j(t)},disabled:n,children:n?"已安装":"拉取此版本"})})})]})}})]})]}),N&&(0,T.jsxs)(se.Z,{bordered:!0,column:1,title:"模型详情",styles:{label:{width:"120px"}},children:[(null===(d=x.details)||void 0===d?void 0:d.format)&&(0,T.jsx)(se.Z.Item,{label:"模型格式",children:x.details.format}),(null===(u=x.details)||void 0===u?void 0:u.family)&&(0,T.jsx)(se.Z.Item,{label:"模型系列",children:x.details.family}),(null===(m=x.details)||void 0===m?void 0:m.parameter_size)&&(0,T.jsx)(se.Z.Item,{label:"参数大小",children:x.details.parameter_size}),(null===(f=x.details)||void 0===f?void 0:f.quantization_level)&&(0,T.jsx)(se.Z.Item,{label:"量化等级",children:x.details.quantization_level}),x.system&&(0,T.jsx)(se.Z.Item,{label:"系统信息",children:x.system}),x.template&&(0,T.jsx)(se.Z.Item,{label:"模板",children:(0,T.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:x.template})}),x.modelfile&&(0,T.jsx)(se.Z.Item,{label:"模型文件",children:(0,T.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:x.modelfile})}),(0,T.jsx)(se.Z.Item,{label:"许可证",children:x.license})]})]}):(0,T.jsx)(oe.Z,{message:"无法获取详细信息",type:"warning"}),(0,T.jsx)(L.Z,{}),(0,T.jsxs)(M.Z,{children:[!h&&(0,T.jsx)(k.ZP,{type:"primary",onClick:function(){return y(g)},icon:(0,T.jsx)(D.Z,{}),children:"刷新详情"}),Z&&(0,T.jsx)(le.Z,{title:"删除模型",description:"确定要删除模型 ".concat(g," 吗？"),onConfirm:function(){P(g),p()},okText:"确定",cancelText:"取消",children:(0,T.jsx)(k.ZP,{type:"primary",danger:!0,icon:(0,T.jsx)(re.Z,{}),children:"删除此模型"})})]})]})},ve=function(e){var n=e.visible,t=e.onClose,r=e.models,o=e.loading,l=e.onRefresh,s=e.onModelDetails,c=e.onPull,d=e.pullingModelName,u=e.localModelNames,m=void 0===u?[]:u,f=(0,a.useState)(""),v=i()(f,2),p=v[0],g=v[1],x=r.filter((function(e){var n=p.toLowerCase();return e.name.toLowerCase().includes(n)||e.description&&e.description.toLowerCase().includes(n)||e.popularTags&&e.popularTags.some((function(e){return e.toLowerCase().includes(n)}))}));return(0,T.jsxs)(F.Z,{title:"Ollama 远程模型库",width:600,placement:"right",onClose:t,open:n,zIndex:1001,children:[(0,T.jsxs)(M.Z,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[(0,T.jsxs)(M.Z,{style:{width:"100%",justifyContent:"space-between"},children:[(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(D.Z,{}),loading:o,onClick:l,children:"刷新远程模型"}),(0,T.jsxs)("span",{style:{color:"#999",fontSize:"14px"},children:["共 ",x.length,"/",r.length," 个模型"]})]}),(0,T.jsx)(ce.Z,{placeholder:"搜索模型名称、描述或标签",prefix:(0,T.jsx)(de.Z,{}),onChange:function(e){return g(e.target.value)},allowClear:!0})]}),(0,T.jsx)(C.Z,{itemLayout:"vertical",loading:o,dataSource:x,renderItem:function(e){var n,t,r=(t=e.name,m.includes(t));return(0,T.jsx)(C.Z.Item,{extra:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)(k.ZP,{type:"default",icon:(0,T.jsx)(te.Z,{}),onClick:function(){return s(e.name)},style:{marginRight:8},children:"详情"}),(0,T.jsx)(ie.Z,{title:r?"模型已存在于本地":"点击拉取模型",children:(0,T.jsx)(k.ZP,{type:"primary",icon:r?(0,T.jsx)(ue.Z,{}):(0,T.jsx)(me.Z,{}),loading:d===e.name,onClick:function(){return c(e.name)},disabled:r,children:r?"已安装":"拉取"})})]}),children:(0,T.jsx)(C.Z.Item.Meta,{title:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)("strong",{children:e.name}),r&&(0,T.jsx)(w.Z,{color:"success",children:"已安装"})]}),description:(0,T.jsxs)(M.Z,{direction:"vertical",style:{width:"100%"},children:[(0,T.jsxs)(M.Z,{children:[e.pullCount&&(0,T.jsxs)(w.Z,{color:"cyan",children:["下载: ",e.pullCount]}),e.lastUpdated&&(0,T.jsxs)(w.Z,{color:"orange",children:["更新: ",e.lastUpdated]})]}),(0,T.jsx)("div",{children:e.description||"暂无描述"}),(0,T.jsx)(M.Z,{style:{marginTop:8},children:null===(n=e.popularTags)||void 0===n?void 0:n.map((function(e,n){return(0,T.jsx)(w.Z,{color:"blue",children:e},n)}))})]})})})}})]})},pe=function(e){var n=e.provider,t=e.level,r=(0,K.useIntl)(),o=(0,A.Z)().isDarkMode,l=(0,a.useState)(!1),s=i()(l,2),c=s[0],u=s[1],m=(0,a.useState)(!1),f=i()(m,2),p=f[0],h=f[1],y=(0,a.useState)([]),j=i()(y,2),P=j[0],b=j[1],S=(0,a.useState)(!1),I=i()(S,2),R=I[0],F=I[1],U=(0,H.A)((function(e){return e.upgradeLlmProvider})),z=(0,a.useState)(),E=i()(z,2),N=E[0],_=E[1],V=(0,a.useState)(!1),Y=i()(V,2),J=Y[0],Q=Y[1],W=(0,a.useState)([]),$=i()(W,2),G=$[0],X=$[1],se=(0,a.useState)(!1),ce=i()(se,2),de=ce[0],ue=ce[1],me=(0,a.useState)(""),pe=i()(me,2),ge=pe[0],xe=pe[1],he=(0,a.useState)(""),ye=i()(he,2),je=ye[0],we=ye[1],Pe=(0,a.useState)(!1),Ze=i()(Pe,2),ke=Ze[0],be=Ze[1],Le=(0,a.useState)(!1),Me=i()(Le,2),Ce=Me[0],Se=Me[1],Ie=(0,a.useState)(null),Re=i()(Ie,2),Fe=Re[0],Te=Re[1],Ue=(0,a.useState)(""),ze=i()(Ue,2),Oe=ze[0],Ee=ze[1],Ne=function(){var e=g()(v()().mark((function e(){var n;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(!0),console.log("pingOllama"),e.next=4,(0,ee.VM)();case 4:n=e.sent,console.log("getOllamaServerStatus: ",n),200===n.code?(h(n.data),u(!1)):(h(!1),u(!1));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=g()(v()().mark((function e(){var n,t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),u(!0),e.next=4,(0,ee.c8)();case 4:n=e.sent,console.log("getOllamaLocalModels: ",n),200===n.code&&(t=n.data.map((function(e){var n=e.name.split(":"),t=n[0]||e.name,r=n.length>1?n[1]:"default";return d()(d()({},e),{},{modelName:t,modelVersion:r})})),b(t)),u(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=g()(v()().mark((function e(){var n;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ue(!0),e.next=3,(0,ee.rg)();case 3:n=e.sent,console.log("getOllamaLibraryModels: ",n),200===n.code?X(n.data):x.yw.error(n.message||"获取远程模型列表失败"),ue(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(){Ne(),De()};(0,a.useEffect)((function(){qe()}),[]);var Ae=function(){var e=g()(v()().mark((function e(n){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"updating"})),e.next=3,(0,q.fx)(n);case 3:t=e.sent,console.log("updateLlmProvider:",n,t),200===t.code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),U(t.data),F(!1)):(x.yw.destroy(),x.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_e=function(){var e=g()(v()().mark((function e(n){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return x.yw.error("Ollama未运行，无法删除模型"),e.abrupt("return");case 3:return xe(n),x.yw.loading("正在删除模型 ".concat(n,"...")),e.prev=5,e.next=8,(0,ee.G9)(n);case 8:t=e.sent,console.log("deleteOllamaModel:",t.data,n),200===t.code&&t.data?(x.yw.success("成功删除模型 ".concat(n)),De()):x.yw.error(t.message||"删除模型 ".concat(n," 失败")),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("删除模型出错:",e.t0),x.yw.error("删除模型时发生错误: ".concat(e.t0));case 17:return e.prev=17,xe(""),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})));return function(n){return e.apply(this,arguments)}}(),He=function(){var e=g()(v()().mark((function e(n){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return x.yw.error("Ollama未运行，无法拉取模型"),e.abrupt("return");case 3:return we(n),x.yw.loading("正在拉取模型 ".concat(n,"...")),e.prev=5,e.next=8,(0,ee.N6)(n);case 8:200===(t=e.sent).code&&t.data?(x.yw.success("成功拉取模型 ".concat(n,"，模型下载可能需要一些时间")),Q(!1),De()):x.yw.error(t.message||"拉取模型 ".concat(n," 失败")),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("拉取模型出错:",e.t0),x.yw.error("拉取模型时发生错误: ".concat(e.t0));case 16:return e.prev=16,we(""),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[5,12,16,19]])})));return function(n){return e.apply(this,arguments)}}(),Be=function(){var e=g()(v()().mark((function e(n){var t,r,o;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Se(!0),Ee(n),be(!0),e.prev=3,t=P.some((function(e){return e.name===n})),r=G.some((function(e){return e.name===n})),!t){e.next=13;break}return e.next=9,(0,ee.sF)(n);case 9:o=e.sent,console.log("getOllamaModelDetails (local):",o),e.next=24;break;case 13:if(!r){e.next=20;break}return e.next=16,(0,ee.gF)(n);case 16:o=e.sent,console.log("getOllamaLibraryModelDetails (remote):",o),e.next=24;break;case 20:return e.next=22,(0,ee.gF)(n);case 22:o=e.sent,console.log("getOllamaLibraryModelDetails (default):",o);case 24:200===o.code?Te(o.data):(x.yw.error(o.message||"获取模型 ".concat(n," 详情失败")),Te(null)),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(3),console.error("获取模型详情出错:",e.t0),x.yw.error("获取详情时发生错误: ".concat(e.t0)),Te(null);case 32:return e.prev=32,Se(!1),e.finish(32);case 35:case"end":return e.stop()}}),e,null,[[3,27,32,35]])})));return function(n){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("h1",{children:[(0,T.jsx)(Z.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,T.jsx)(k.ZP,{type:"text",icon:(0,T.jsx)(O.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),(0,T.jsxs)(M.Z,{children:[(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(D.Z,{}),loading:c,type:"primary",onClick:qe,children:"刷新"}),(0,T.jsx)(k.ZP,{icon:(0,T.jsx)(ne.Z,{}),type:"primary",onClick:function(){Q(!0),Ke()},children:"远程模型库"})]}),(0,T.jsx)("br",{}),(0,T.jsx)("br",{}),p?(0,T.jsx)(oe.Z,{message:"Ollama运行中",type:"success"}):(0,T.jsx)(oe.Z,{message:"请首先启动Ollama",type:"error"}),(0,T.jsx)(L.Z,{orientation:"left",children:"本地模型列表"}),(0,T.jsx)(C.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:c,dataSource:P,renderItem:function(e,n){return(0,T.jsx)(C.Z.Item,{style:(null==N?void 0:N.name)===(null==e?void 0:e.name)?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){_(e)},actions:[(0,T.jsx)(k.ZP,{type:"text",icon:(0,T.jsx)(te.Z,{}),onClick:function(n){n.stopPropagation(),Be(null==e?void 0:e.name)},children:"详情"},"details"),(0,T.jsx)(le.Z,{title:"删除模型",description:"确定要删除模型 ".concat(null==e?void 0:e.name," 吗？"),onConfirm:function(n){null==n||n.stopPropagation(),_e(null==e?void 0:e.modelName)},okText:"确定",cancelText:"取消",onCancel:function(e){return null==e?void 0:e.stopPropagation()},children:(0,T.jsx)(k.ZP,{type:"text",danger:!0,icon:(0,T.jsx)(re.Z,{}),loading:ge===(null==e?void 0:e.modelName),onClick:function(e){return e.stopPropagation()},children:"删除"})},"delete")],children:(0,T.jsx)(C.Z.Item.Meta,{title:(0,T.jsxs)(M.Z,{children:[(0,T.jsx)("span",{children:null==e?void 0:e.modelName}),(0,T.jsx)(w.Z,{color:"blue",children:null==e?void 0:e.modelVersion}),(null==e?void 0:e.size)&&(0,T.jsx)(w.Z,{color:"green",children:(0,ae.sS)(null==e?void 0:e.size)}),(null==e?void 0:e.parameter_size)&&(0,T.jsx)(ie.Z,{title:"参数大小",children:(0,T.jsx)(w.Z,{color:"purple",children:null==e?void 0:e.parameter_size})})]}),description:(0,T.jsxs)(M.Z,{direction:"vertical",children:[(0,T.jsxs)("div",{children:["完整名称: ",null==e?void 0:e.name]}),(0,T.jsxs)("div",{children:["digest: ",null==e?void 0:e.digest]}),(null==e?void 0:e.family)&&(0,T.jsxs)("div",{children:["系列: ",null==e?void 0:e.family]}),(null==e?void 0:e.quantization_level)&&(0,T.jsxs)("div",{children:["量化等级: ",null==e?void 0:e.quantization_level]}),(0,T.jsxs)("div",{children:["更新时间: ",(0,ae.mr)(null==e?void 0:e.modified_at.toString())]})]}),style:{marginLeft:"15px"}})})}}),(0,T.jsx)(ve,{visible:J,onClose:function(){return Q(!1)},models:G,loading:de,onRefresh:Ke,onModelDetails:Be,onPull:He,pullingModelName:je,localModelNames:P.map((function(e){return e.modelName}))}),(0,T.jsx)(fe,{visible:ke,onClose:function(){return be(!1)},modelName:Oe,modelDetails:Fe,loading:Ce,onRefresh:Be,onPull:He,onDelete:_e,isRemoteModel:G.some((function(e){return e.name===Oe})),isLocalModel:P.some((function(e){return e.name===Oe})),pullingModelName:je,localModelNames:P.map((function(e){return e.name}))}),R&&(0,T.jsx)(B.Z,{open:R,isEdit:!0,level:t,llmProvider:n,onCancel:function(){return F(!1)},onSubmit:Ae})]})},ge=t(19317),xe=function(e){var n=e.level,t=(0,a.useState)(""),r=i()(t,2),l=r[0],c=r[1],d=(0,a.useState)([]),u=i()(d,2),m=u[0],f=u[1],v=(0,H.A)((function(e){return e.currentLlmProvider})),p=(0,ge.$)((function(e){return e.currentLlmProviderPlatform})),g=(0,a.useState)(n===j.Hxq),x=i()(g,1)[0]?p:v;(0,a.useEffect)((function(){if(x&&x.name)if(console.log("llmProvider: ",x),m.find((function(e){return e.key===x.name})))c(x.name);else{var e=o()(m);"ollama"===x.name?e.push({label:x.nickname||x.name,children:(0,T.jsx)(pe,{provider:x,level:n}),key:x.name,closable:!0}):e.push({label:x.nickname||x.name,children:(0,T.jsx)(X,{provider:x,level:n}),key:x.name,closable:!0}),f(e),c(x.name)}}),[x,m]);return 0===m.length?null:(0,T.jsx)(s.Z,{type:"editable-card",onChange:function(e){c(e)},activeKey:l,onEdit:function(e,n){"remove"===n&&function(e){var n=l,t=-1;m.forEach((function(n,r){n.key===e&&(t=r-1)}));var r=m.filter((function(n){return n.key!==e}));r.length&&n===e&&(n=t>=0?r[t].key:r[0].key),f(r),c(n)}(e)},items:m})}},17520:function(e,n,t){var r=t(90819),o=t.n(r),l=t(89933),i=t.n(l),a=t(45332),s=t.n(a),c=t(86803),d=t(36605),u=t(40612),m=t(55735),f=t(69169),v=t(84881),p=t(4499),g=t(57178),x=t(53530),h=t(44194),y=t(31549);n.Z=function(e){var n=e.open,t=e.isEdit,r=e.llmProvider,l=e.level,a=e.onCancel,j=e.onSubmit,w=g.Z.useForm(),P=s()(w,1)[0],Z=(0,u.u)((function(e){return e.currentOrg})),k=(0,h.useState)([]),b=s()(k,2),L=b[0],M=b[1],C=(0,h.useState)([]),S=s()(C,2),I=S[0],R=S[1],F=(0,h.useState)(),T=s()(F,2),U=T[0],z=T[1],O=function(){var e=i()(o()().mark((function e(){var n,t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLlmProviders"),n={pageNumber:0,pageSize:50,status:"",level:m.Hxq},e.next=4,(0,d.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t),200===t.code?M(null==t||null===(r=t.data)||void 0===r?void 0:r.content):c.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){var e=[];L.forEach((function(n){e.push({label:n.nickname,value:n.name,disabled:n.status!==m.KY})})),R(e)}),[L]),(0,h.useEffect)((function(){l===m.whQ&&O()}),[]),(0,h.useEffect)((function(){t?(z(r),P.setFieldsValue({name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,apiUrl:null==r?void 0:r.apiUrl,apiKey:null==r?void 0:r.apiKey})):P.resetFields()}),[t,r]);return(0,y.jsx)("div",{children:(0,y.jsx)(x.Z,{title:"添加大模型提供商",open:n,forceRender:!0,onOk:function(){P.validateFields().then(function(){var e=i()(o()().mark((function e(n){var l;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l={uid:t?null==r?void 0:r.uid:"",name:null==U?void 0:U.name,nickname:null==n?void 0:n.nickname,logo:null==U?void 0:U.logo,description:null==U?void 0:U.description,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey,webUrl:null==U?void 0:U.webUrl,status:m.KY,level:m.whQ,orgUid:null==Z?void 0:Z.uid},console.log("handleSaveLlmProvider:",n,l),j(l);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),c.yw.error("创建角色失败")}))},onCancel:a,children:(0,y.jsxs)(f.A,{form:P,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[l===m.whQ&&(0,y.jsx)(v.Z,{label:"选择大模型提供商",name:"name",options:I,fieldProps:{placeholder:"选择大模型提供商(必选)",allowClear:!0,onChange:function(e){console.log("onParentSelectChange:",e);var n=L.find((function(n){return n.name===e}));z(n),console.log("selectedProvider:",n),P.setFieldsValue({nickname:null==n?void 0:n.nickname,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey})},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,y.jsx)(p.Z,{label:"名称",name:"nickname",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,y.jsx)(p.Z,{label:"ApiUrl",name:"apiUrl",rules:[{required:!0,message:"请输入apiUrl!"}],fieldProps:{onPressEnter:function(e){}}}),"ollama"!==(null==U?void 0:U.name)&&(0,y.jsx)(p.Z.Password,{label:"ApiKey",name:"apiKey",fieldProps:{placeholder:"请输入apiKey",allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){}}})]})})})}},11490:function(e,n,t){t.d(n,{A:function(){return u}});var r=t(73193),o=t.n(r),l=t(76711),i=t.n(l),a=t(55735),s=t(44435),c=t(83642),d=t(83890),u=(0,s.Ue)()((0,c.mW)((0,c.tJ)((0,d.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentLlmProvider:{uid:"",nickname:""},insertLlmProvider:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},upgradeLlmProvider:function(n){e((function(e){var t=e.llmproviderResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResult:function(t){e({llmproviderResult:t});var r,o=n().currentLlmProvider;""!==o.uid&&void 0!==o||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLlmProvider:t.data.content[0]})},setCurrentLlmProvider:function(t){var r=n().llmproviderResult.data.content,l=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==l){var a=[].concat(i()(r.slice(0,l)),[t],i()(r.slice(l+1))),s=o()(o()({},n().llmproviderResult),{},{data:{content:a}});e({llmproviderResult:s,currentLlmProvider:t})}else e({currentLlmProvider:t})},deleteCurrentLlmProvider:function(t){var r=n().llmproviderResult.data.content,l=r.findIndex((function(e){return e.uid===t}));-1!==l?e({llmproviderResult:o()(o()({},n().llmproviderResult),{},{data:{content:[].concat(i()(r.slice(0,l)),i()(r.slice(l+1)))}})}):console.warn("LlmProvider not found in cache:",t),n().currentLlmProvider.uid===t&&e({currentLlmProvider:{uid:""}})},deleteLlmProviderCache:function(){return e({},!0)}}})),{name:a.ajB})))},19317:function(e,n,t){t.d(n,{$:function(){return u}});var r=t(73193),o=t.n(r),l=t(76711),i=t.n(l),a=t(55735),s=t(44435),c=t(83642),d=t(83890),u=(0,s.Ue)()((0,c.mW)((0,c.tJ)((0,d.n)((function(e,n){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(n){e((function(e){e.llmproviderResultPlatform.data.content.unshift(n)}))},upgradeLlmProviderPlatform:function(n){e((function(e){var t=e.llmproviderResultPlatform.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResultPlatform:function(t){e({llmproviderResultPlatform:t});var r,o=n().currentLlmProviderPlatform;""!==o.uid&&void 0!==o||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLlmProviderPlatform:t.data.content[0]})},setCurrentLlmProviderPlatform:function(t){var r=n().llmproviderResultPlatform.data.content,l=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==l){var a=[].concat(i()(r.slice(0,l)),[t],i()(r.slice(l+1))),s=o()(o()({},n().llmproviderResultPlatform),{},{data:{content:a}});e({llmproviderResultPlatform:s,currentLlmProviderPlatform:t})}else e({currentLlmProviderPlatform:t})},deleteCurrentLlmProviderPlatform:function(t){var r=n().llmproviderResultPlatform.data.content,l=r.findIndex((function(e){return e.uid===t}));-1!==l?e({llmproviderResultPlatform:o()(o()({},n().llmproviderResultPlatform),{},{data:{content:[].concat(i()(r.slice(0,l)),i()(r.slice(l+1)))}})}):console.warn("LlmProvider not found in cache:",t),n().currentLlmProviderPlatform.uid===t&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:a.dNm})))}}]);