"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5714],{93689:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(11757),r=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},o=n(54183),s=function(e,t){return r.createElement(o.Z,(0,a.Z)({},e,{ref:t,icon:i}))};var l=r.forwardRef(s)},79907:function(e,t,n){var a=n(17082),r=n(73457),i=n(44194),o=n(7010),s=n(31549),l=["fieldProps","min","proFieldProps","max"],d=function(e,t){var n=e.fieldProps,i=e.min,d=e.proFieldProps,u=e.max,c=(0,r.Z)(e,l);return(0,s.jsx)(o.Z,(0,a.Z)({valueType:"digit",fieldProps:(0,a.Z)({min:i,max:u},n),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:d},c))},u=i.forwardRef(d);t.Z=u},48708:function(e,t,n){var a=n(17082),r=n(73457),i=n(44194),o=n(7010),s=n(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=i.forwardRef((function(e,t){var n=e.fieldProps,i=e.unCheckedChildren,d=e.checkedChildren,u=e.proFieldProps,c=(0,r.Z)(e,l);return(0,s.jsx)(o.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:i,checkedChildren:d},n),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=d},99885:function(e,t,n){n.d(t,{Yg:function(){return v},kh:function(){return p},kv:function(){return x},pf:function(){return c},y:function(){return h}});var a=n(90819),r=n.n(a),i=n(73193),o=n.n(i),s=n(89933),l=n.n(s),d=n(55735),u=n(30921);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/faq/query/org",{method:"GET",params:o()(o()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/faq/create",{method:"POST",data:o()(o()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/faq/update",{method:"POST",data:o()(o()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/faq/delete",{method:"POST",data:o()(o()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,client:d.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51990:function(e,t,n){var a=n(73193),r=n.n(a),i=n(84176),o=n.n(i),s=n(86803),l=n(23864),d=n(44521),u=n(55735),c=n(30921),f=n(83905),p=(n(26286),n(28977)),g=n.n(p),h=n(44194),m=n(31549),v=["placeholder","defaultValue","value","style","toolbarKeys","onChange","options"];t.Z=function(e){var t=e.placeholder,n=e.defaultValue,a=e.value,i=e.style,p=e.toolbarKeys,y=e.onChange,x=(e.options,o()(e,v)),w=((0,c.useIntl)(),(0,l.Z)().isDarkMode),b=(0,h.useRef)(null),M=(0,h.useRef)(null);return(0,h.useEffect)((function(){if(b.current){if(!M.current){var e=new f.cW({element:b.current,theme:w?"dark":"light",placeholder:t,content:n,toolbarKeys:p,image:{uploadUrl:(0,d.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var i=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("file_name",i),o.append("file_type",e.type),o.append("is_avatar","false"),o.append("kb_type",u.bE7),o.append("category_uid",""),o.append("kb_uid",""),o.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:i}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){a(e)}))}))}},video:{uploadUrl:(0,d.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var i=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("file_name",i),o.append("file_type",e.type),o.append("is_avatar","false"),o.append("kb_type",u.bE7),o.append("category_uid",""),o.append("kb_uid",""),o.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){a(e)}))}))}},attachment:{uploadUrl:(0,d.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var i=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("file_name",i),o.append("file_type",e.type),o.append("is_avatar","false"),o.append("kb_type",u.bE7),o.append("category_uid",""),o.append("kb_uid",""),o.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:r()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:i}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){a(e)}))}))}},onChange:function(e){"function"==typeof y&&y(e.getHtml(),e.getMarkdown())}});M.current=e}return function(){M.current&&(M.current.destroy(),M.current=null)}}}),[]),(0,h.useEffect)((function(){M.current&&a!==M.current.getHtml()&&M.current.setContent(a||"")}),[a]),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("div",r()(r()({ref:b},x),{},{style:r()({height:"100%"},i)}))})}},2036:function(e,t,n){n.d(t,{H:function(){return i}});n(44194);var a=n(29078),r=n(31549),i=function(e){var t=e.content,n=a.Z.sanitize(t,{ALLOWED_TAGS:["p","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","a","strong","em","b","i","img","blockquote","code","pre"],ALLOWED_ATTR:["href","target","src","alt","style","class"]});return(0,r.jsx)("div",{className:"RichText",dangerouslySetInnerHTML:{__html:n}})}},17220:function(e,t,n){n(44194);var a=n(75365),r=n(54881),i=n(30921),o=n(31549);t.Z=function(e){var t,n,s=e.file,l=e.onDelete,d=e.showDelete,u=void 0===d||d,c=(0,i.useIntl)();return(0,o.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:c.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[u&&(0,o.jsx)(a.ZP,{type:"text",size:"small",icon:(0,o.jsx)(r.Z,{}),onClick:function(){return l(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,o.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(n=s.fileType)&&void 0!==n&&n.startsWith("image/")?(0,o.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,o.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,o.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,n){var a=n(76711),r=n.n(a),i=n(73193),o=n.n(i),s=n(45332),l=n.n(s),d=n(44194),u=n(42085),c=n(30348),f=n(53530),p=n(28977),g=n.n(p),h=n(55735),m=n(86803),v=n(44521),y=n(17220),x=n(30921),w=n(6397),b=n(31549),M=c.Z.Dragger;t.Z=function(e){var t=e.type,n=(e.acceptType,e.isModalOpen),a=e.attachments,i=e.handleSubmit,s=e.handleCancel,c=(0,x.useIntl)(),p=(0,w.j)((function(e){return e.currentKbase})),j=(0,d.useState)([]),k=l()(j,2),S=k[0],Z=k[1],C=(0,d.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==p?void 0:p.uid,client:h.bVn}),D=l()(C,2),P=D[0],q=D[1];(0,d.useEffect)((function(){console.log("UploadDrag currentKbase",p),p&&q((function(e){return o()(o()({},e),{},{kb_uid:null==p?void 0:p.uid})}))}),[p]);var F=(0,d.useMemo)((function(){return{name:"file",multiple:!0,action:(0,v.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(h.LA8)},data:P,showUploadList:!1,beforeUpload:function(e){var t=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return q((function(n){return o()(o()({},n),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&m.yw.loading(c.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(m.yw.destroy(),m.yw.success(c.formatMessage({id:"upload.success"},{filename:e.file.name})),Z((function(t){return[].concat(r()(t),[e.file.response.data])}))):(m.yw.destroy(),m.yw.error(c.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&m.yw.error(c.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[P,c]);(0,d.useEffect)((function(){q((function(e){return o()(o()({},e),{},{kb_type:t,category_uid:""})})),a&&Z(a.map((function(e){return e.upload})))}),[t]);var _=function(e){console.log("handleDelete",e),Z((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,b.jsxs)(f.Z,{title:c.formatMessage({id:"upload.modal.title"}),open:n,onOk:function(){i(S)},onCancel:s,children:[(0,b.jsxs)(M,o()(o()({},F),{},{children:[(0,b.jsx)("p",{className:"ant-upload-drag-icon",children:(0,b.jsx)(u.Z,{})}),(0,b.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"upload.drag.text"})}),(0,b.jsx)("p",{className:"ant-upload-hint",children:c.formatMessage({id:"upload.drag.hint"})})]})),(0,b.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,b.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:S.map((function(e){return(0,b.jsx)(y.Z,{file:e,onDelete:_},e.uid)}))})})]})}},3344:function(e,t,n){n.r(t),n.d(t,{default:function(){return Me}});var a=n(96865),r=n(75574),i=n(95160),o=n(55735),s=n(73193),l=n.n(s),d=n(84176),u=n.n(d),c=n(86222),f=n.n(c),p=n(90819),g=n.n(p),h=n(89933),m=n.n(h),v=n(45332),y=n.n(v),x=n(86803),w=n(99885),b=n(40612),M=n(10162),j=n(54881),k=n(93689),S=n(40439),Z=n(30617),C=n(11090),D=n(61107),P=n(25588),q=n(29266),F=n(61355),_=n(75365),Y=n(44194),I=n(90838),T=n(30921),U=n(76750),A=n(6397),E=n(27650),L=n(44521),H=n(28977),R=n.n(H),z=n(2036),O=n(76711),V=n.n(O),B=n(69169),N=n(84881),K=n(4499),W=n(62577),Q=n(39755),$=n(79907),G=n(32350),J=n(17082),X=n(73457),ee=n(42965),te=n(63653),ne=n(7010),ae=n(31549),re=["fieldProps","proFieldProps"],ie="dateRange",oe=Y.forwardRef((function(e,t){var n=e.fieldProps,a=e.proFieldProps,r=(0,X.Z)(e,re),i=(0,Y.useContext)(te.Z);return(0,ae.jsx)(ne.Z,(0,J.Z)({ref:t,fieldProps:(0,J.Z)({getPopupContainer:i.getPopupContainer},n),valueType:ie,proFieldProps:a,filedConfig:{valueType:ie,customLightMode:!0,lightFilterLabelFormatter:function(e){return(0,ee.c)(e,(null==n?void 0:n.format)||"YYYY-MM-DD")}}},r))})),se=n(48708),le=n(73442),de=n(3849),ue=n(38775),ce=n(62673),fe=n(52288),pe=n(65461),ge=n(51990),he=function(e){var t=e.isEdit,n=e.faq,a=e.open,r=e.onClose,i=e.onSubmit,s=B.A.useForm(),d=y()(s,1)[0],u=(0,Y.useState)(""),c=y()(u,2),f=c[0],p=c[1],h=(0,b.u)((function(e){return e.currentOrg})),v=(0,A.j)((function(e){return e.currentKbase})),j=(0,I.v)((function(e){return e.categorySelectOptions})),k=(0,I.v)((function(e){return e.currentCategory})),S=(0,Y.useState)(),Z=y()(S,2),C=(Z[0],Z[1]),D=(0,Y.useState)(o.PYi),P=y()(D,2),F=(P[0],P[1],(0,Y.useState)(".png,.jpg,.jpeg")),T=y()(F,2),U=(T[0],T[1],(0,Y.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==v?void 0:v.uid)||"",client:o.bVn})),E=y()(U,2),L=(E[0],E[1],(0,Y.useState)([])),H=y()(L,2),z=H[0],O=H[1],J=(0,Y.useState)(!1),X=y()(J,2),ee=X[0],te=X[1],ne=(0,Y.useState)(""),re=y()(ne,2),ie=re[0],he=re[1],me=(0,Y.useRef)(null),ve=(0,Y.useState)([]),ye=y()(ve,2),xe=(ye[0],ye[1]),we=(0,Y.useState)([]),be=y()(we,2),Me=be[0],je=be[1],ke=(0,Y.useState)(!0),Se=y()(ke,2),Ze=Se[0],Ce=Se[1];(0,Y.useEffect)((function(){var e=function(){var e=m()(g()().mark((function e(){var t,a,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==k?void 0:k.uid)===o.zBg?"":null==k?void 0:k.uid,kbUid:null==v?void 0:v.uid,orgUid:null==h?void 0:h.uid},e.next=5,(0,w.pf)(t);case 5:a=e.sent,console.log("获取FAQ列表响应:",t,a),x.yw.destroy(),200===a.code?(r=a.data.content.map((function(e){return{label:e.question,value:e.uid}})),je(r.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):x.yw.error(a.message||"加载常见问题失败"),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),x.yw.destroy(),x.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();a&&e()}),[a,null==v?void 0:v.uid,null==h?void 0:h.uid,null==k?void 0:k.uid]),(0,Y.useEffect)((function(){var e,a,r;t?(d.setFieldsValue({type:null==n?void 0:n.type,question:null==n?void 0:n.question,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==v?void 0:v.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[R()(n.startDate),R()(n.endDate)]:void 0}),p((null==n?void 0:n.answer)||""),O((null==n||null===(a=n.tagList)||void 0===a?void 0:a.filter((function(e){return""!==e})))||[]),xe((null==n||null===(r=n.relatedFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]),Ce(!1!==(null==n?void 0:n.enabled))):(d.setFieldsValue({type:o.PYi,question:"",answer:"",categoryUid:"",kbUid:null==v?void 0:v.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateRange:void 0}),p(""),O([]),xe([]),Ce(!0))}),[n,a]),(0,Y.useEffect)((function(){var e;ee&&(null===(e=me.current)||void 0===e||e.focus())}),[ee]);var De=function(){ie&&-1===z.indexOf(ie)&&O([].concat(V()(z),[ie])),te(!1),he("")};return(0,ae.jsx)(ae.Fragment,{children:(0,ae.jsx)(le.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:r,open:a,extra:(0,ae.jsxs)(de.Z,{children:[(0,ae.jsx)(_.ZP,{onClick:r,children:"取消"}),(0,ae.jsx)(_.ZP,{onClick:function(){d.validateFields().then((function(e){console.log("handleSubmit values:",e);var t=e.dateRange,a=null!=t&&t[0]?t[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=t&&t[1]?t[1].format("YYYY-MM-DDTHH:mm:ss"):void 0;i(l()(l()(l()({},n),e),{},{kbUid:null==v?void 0:v.uid,orgUid:null==h?void 0:h.uid,answer:f,answerList:e.answerList,tagList:z,relatedFaqUids:e.relatedFaqUids,startDate:a,endDate:r,enabled:e.enabled}))})).catch((function(e){console.log("Form errors:",e),x.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,ae.jsxs)(B.A,{form:d,submitter:{render:function(){return null}},children:[(0,ae.jsx)(N.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:j,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),C(e)}}}),(0,ae.jsx)(N.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:o.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){}}}),(0,ae.jsx)(K.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,ae.jsx)(B.A.Item,{name:"answer",label:"基础答案",children:(0,ae.jsx)(ge.Z,{value:f,toolbarKeys:(0,pe.eD)(),style:{height:"200px",width:"600px"},onChange:function(e){p(e)}})}),(0,ae.jsxs)(ue.Z,{orientation:"left",children:["扩展答案列表",(0,ae.jsx)(_.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,ae.jsx)(W.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,ae.jsx)(M.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,a=e.action,r=t.index;return(0,ae.jsx)(ce.Z,{size:"small",style:{marginBottom:16},extra:a,children:n},r)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,ae.jsx)("div",{children:e})},children:(0,ae.jsxs)(Q.UW,{children:[(0,ae.jsx)($.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,ae.jsx)(G.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,ae.jsx)(N.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:Me,fieldProps:{placeholder:"请选择相关问题"}}),(0,ae.jsx)(B.A.Item,{label:"标签",children:(0,ae.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[z.map((function(e){return(0,ae.jsx)(q.Z,{closable:!0,onClose:function(){return t=e,n=z.filter((function(e){return e!==t})),void O(n);var t,n},children:e},e)})),ee?(0,ae.jsx)(fe.Z,{ref:me,type:"text",size:"small",style:{width:78},value:ie,onChange:function(e){he(e.target.value)},onBlur:De,onPressEnter:De}):(0,ae.jsxs)(q.Z,{onClick:function(){te(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,ae.jsx)(M.Z,{})," 新标签"]})]})}),(0,ae.jsx)(oe,{name:"dateRange",label:"有效日期",fieldProps:{style:{width:"100%"}}}),(0,ae.jsx)(se.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:Ze,onChange:function(e){Ce(e)}}})]})})})},me=n(28425),ve=n(88721),ye=["current","pageSize"],xe=function(){var e=(0,T.useIntl)(),t=(0,U.Z)().translateString,n=(0,Y.useRef)(),a=(0,Y.useState)(!0),r=y()(a,2),i=r[0],s=r[1],d=(0,Y.useState)(),c=y()(d,2),p=c[0],h=c[1],v=(0,Y.useState)(!1),H=y()(v,2),O=H[0],V=H[1],B=(0,Y.useState)(1),N=y()(B,2),K=N[0],W=N[1],Q=(0,Y.useState)(10),$=y()(Q,2),G=$[0],J=$[1],X=(0,b.u)((function(e){return e.currentOrg})),ee=(0,A.j)((function(e){return e.currentKbase})),te=(0,I.v)((function(e){return e.currentCategory})),ne=(0,I.v)((function(e){return e.categorySelectOptions})),re=(0,Y.useState)(!1),ie=y()(re,2),oe=ie[0],se=ie[1],le=(0,Y.useState)([]),de=y()(le,2),ue=de[0],ce=de[1],fe=(0,Y.useState)([]),pe=y()(fe,2),ge=pe[0],xe=pe[1],we=function(){var t=m()(g()().mark((function t(a){var r;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(a),t.next=3,(0,w.Yg)(a);case 3:r=t.sent,console.log("delete response:",r),200===r.code?(null==n||n.current.reload(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),be=function(){var t=m()(g()().mark((function t(){var a,r,i,o,s,l;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ge.length){t.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,i=0,o=f()(ge),t.prev=7,o.s();case 9:if((s=o.n()).done){t.next=23;break}return l=s.value,t.prev=11,t.next=14,(0,w.Yg)(l);case 14:200===t.sent.code?r++:i++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),i++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:x.yw.destroy(),0===i?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:i})),ce([]),xe([]),null===(a=n.current)||void 0===a||a.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Me=function(){var t=m()(g()().mark((function t(a){var r,i,o,s,l,d;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ge.length){t.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),t.abrupt("return");case 3:x.yw.loading(a?e.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):e.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),i=0,o=0,s=f()(ge),t.prev=7,s.s();case 9:if((l=s.n()).done){t.next=23;break}return d=l.value,t.prev=11,t.next=14,(0,w.kv)({uid:d.uid,enabled:a});case 14:200===t.sent.code?i++:o++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),o++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),s.e(t.t1);case 28:return t.prev=28,s.f(),t.finish(28);case 31:x.yw.destroy(),0===o?x.yw.success(a?e.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:i}):e.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:i})):x.yw.warning(a?e.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:i,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:i,fail:o})),ce([]),xe([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(e){return t.apply(this,arguments)}}(),je=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:300,ellipsis:!0,search:!0},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:400,ellipsis:!0,search:!0,render:function(e,t){return(0,ae.jsx)(z.H,{content:null==t?void 0:t.answer})}},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.type"}),dataIndex:"type",width:100,render:function(e,t){return(0,ve.OI)(t.type)},valueEnum:{text:{text:e.formatMessage({id:"faq.type.text"})},image:{text:e.formatMessage({id:"faq.type.image"})},video:{text:e.formatMessage({id:"faq.type.video"})},file:{text:e.formatMessage({id:"faq.type.file"})}}},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0},{title:(0,ae.jsx)(T.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,render:function(e,t){var n=ne.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,ae.jsx)(q.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:ne.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.startDate?R()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.endDate?R()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ae.jsx)(T.FormattedMessage,{id:"faq.updatedAt"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,a,r){return[(0,ae.jsx)("a",{onClick:function(){Se(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,ae.jsx)(F.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return we(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,ae.jsx)(_.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}],ke=function(){h(void 0),s(!1),V(!0)},Se=function(e){h(e),s(!0),V(!0)},Ze=function(){var t=m()(g()().mark((function t(a){var r,o;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",a),i?x.yw.loading(e.formatMessage({id:"updating"})):x.yw.loading(e.formatMessage({id:"creating"})),!i){t.next=8;break}return t.next=5,(0,w.y)(a);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,w.kh)(a);case 10:t.t0=t.sent;case 11:r=t.t0,console.log("createFaq response:",a,r),200===r.code?(x.yw.destroy(),x.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),V(!1),null===(o=n.current)||void 0===o||o.reloadAndRest()):(x.yw.destroy(),x.yw.error(r.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ce=function(){var e=m()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleImport"),se(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,Y.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[ee,te]);var De=function(){var t=m()(g()().mark((function t(){return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,me.HK)(o.QPQ,null==X?void 0:X.uid,null==ee?void 0:ee.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Pe=function(){var e=m()(g()().mark((function e(){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",K,G),t=localStorage.getItem(o.LA8),window.open((0,L.kG)()+"/api/v1/faq/export?"+new URLSearchParams({pageNumber:String(K-1),pageSize:String(G),categoryUid:(null==te?void 0:te.uid)===o.zBg?"":null==te?void 0:te.uid,kbUid:null==ee?void 0:ee.uid,orgUid:(null==X?void 0:X.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe={selectedRowKeys:ue,onChange:function(e,t){ce(e),xe(t)}};return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(P.Z,{columns:je,actionRef:n,cardBordered:!0,rowSelection:qe,request:function(){var t=m()(g()().mark((function t(n,a,r){var i,s,d,c,f;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,a,r),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),i=n.current,s=n.pageSize,d=u()(n,ye),W(i),J(s),c=l()({pageNumber:i-1,pageSize:s,categoryUid:(null==te?void 0:te.uid)===o.zBg?"":null==te?void 0:te.uid,kbUid:null==ee?void 0:ee.uid,orgUid:null==X?void 0:X.uid},d),t.next=8,(0,w.pf)(c);case 8:return f=t.sent,console.log("queryFaqsByOrg response:",c,f),x.yw.destroy(),200===f.code||x.yw.error(f.message),t.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){W(e),J(t)}},dateFormatter:"string",headerTitle:t(null==ee?void 0:ee.name)+" - 常见问题",tooltip:"所添加FAQ内容会自动添加到 '拆分' 列表中 ",toolBarRender:function(){return[(0,ae.jsx)(_.ZP,{icon:(0,ae.jsx)(M.Z,{}),type:"primary",onClick:ke,children:e.formatMessage({id:"create"})},"create"),ue.length>0&&(0,ae.jsx)(F.Z,{title:e.formatMessage({id:"batch.deleteTip"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ue.length," ").concat(e.formatMessage({id:"items"}),"?"),onConfirm:be,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,ae.jsxs)(_.ZP,{danger:!0,icon:(0,ae.jsx)(j.Z,{}),children:[e.formatMessage({id:"batch.delete"})," (",ue.length,")"]})},"batchDelete"),ue.length>0&&(0,ae.jsxs)(_.ZP,{type:"primary",icon:(0,ae.jsx)(k.Z,{}),onClick:function(){return Me(!0)},children:[e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})," (",ue.length,")"]},"batchEnable"),ue.length>0&&(0,ae.jsxs)(_.ZP,{danger:!0,icon:(0,ae.jsx)(S.Z,{}),onClick:function(){return Me(!1)},children:[e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})," (",ue.length,")"]},"batchDisable"),(0,ae.jsx)(_.ZP,{icon:(0,ae.jsx)(Z.Z,{}),type:"primary",onClick:Ce,children:e.formatMessage({id:"import"})},"import"),(0,ae.jsx)(_.ZP,{icon:(0,ae.jsx)(C.Z,{}),type:"primary",onClick:Pe,children:e.formatMessage({id:"export"})},"export"),(0,ae.jsx)(_.ZP,{icon:(0,ae.jsx)(D.Z,{}),type:"link",onClick:function(){return(0,L.IY)()},children:e.formatMessage({id:"download.template"})},"download")]},columnsState:{persistenceKey:"faq-table",defaultValue:{viewCount:{show:!1},clickCount:{show:!0},upCount:{show:!0},downCount:{show:!0},valid:{show:!0},startDate:{show:!1},endDate:{show:!1}}}}),(0,ae.jsx)(he,{isEdit:i,open:O,faq:p,onClose:function(){return V(!1)},onSubmit:Ze}),oe&&(0,ae.jsx)(E.Z,{type:o.bE7,isModalOpen:oe,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),se(!1),null==n||n.current.reload(),De()},handleCancel:function(){console.log("handleUploadDragCancel"),se(!1),null==n||n.current.reload()}})]})},we=r.Z.Sider,be=r.Z.Content,Me=function(){var e=(0,a.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,ae.jsx)("div",{children:(0,ae.jsxs)(r.Z,{children:[(0,ae.jsx)(we,{style:t,children:(0,ae.jsx)(i.Z,{type:o.bE7})}),(0,ae.jsx)(r.Z,{children:(0,ae.jsx)(be,{style:n,children:(0,ae.jsx)(xe,{})})})]})})}}}]);