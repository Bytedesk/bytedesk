"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8628],{94527:function(e,t,n){n.d(t,{G9:function(){return k},J$:function(){return S},N6:function(){return w},VM:function(){return d},c8:function(){return p},gF:function(){return v},rg:function(){return m},sF:function(){return y}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(94976),c=n(4628);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},84553:function(e,t,n){n.d(t,{Bv:function(){return A},L0:function(){return C},QB:function(){return w},RF:function(){return k},YO:function(){return S},YQ:function(){return T},Yg:function(){return v},kh:function(){return p},kv:function(){return y},pf:function(){return d},y:function(){return m}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(94976),c=n(4628);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/deleteAll",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateIndex",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return U.apply(this,arguments)}function U(){return(U=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllIndex",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return I.apply(this,arguments)}function I(){return(I=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/updateAllVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return E.apply(this,arguments)}function E(){return(E=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/agent/text/faq-similar-questions",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},66406:function(e,t,n){var r=n(73193),a=n.n(r),s=n(43388),i=n(25553),o=n(58620),u=n(94976),l=n(4628),c=n(53411),d=(n(69055),n(96596)),f=n.n(d),p=n(44194),g=n(31549);t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,d=e.style,m=e.toolbarKeys,h=e.maxLength,v=e.onChange,x=e.options,y=(0,l.useIntl)(),M=(0,i.Z)().isDarkMode,w=(0,p.useRef)(null),b=(0,p.useRef)(null),k=(0,p.useRef)(!1),j=(0,p.useRef)(v);(0,p.useEffect)((function(){j.current=v}),[v]);var S=function(e,t,n){"function"!=typeof j.current||k.current||j.current(e,t,n)};return(0,p.useEffect)((function(){if(w.current){if(!b.current){var e=new c.cW(a()(a()({element:w.current,theme:M?"dark":"light",placeholder:t,content:n,toolbarKeys:m},x||{}),{},{image:{uploadUrl:(0,o.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var i=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("fileName",i),o.append("fileType",e.type),o.append("isAvatar","false"),o.append("kbType",u.QPQ),o.append("categoryUid",""),o.append("kbUid",""),o.append("orgUid",""),o.append("client",u.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:i}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,o.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var i=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("fileName",i),o.append("fileType",e.type),o.append("isAvatar","false"),o.append("kbType",u.QPQ),o.append("categoryUid",""),o.append("kbUid",""),o.append("client",u.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,o.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var i=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,o=new FormData;return o.append("file",e),o.append("fileName",i),o.append("fileType",e.type),o.append("isAvatar","false"),o.append("kbType",u.QPQ),o.append("categoryUid",""),o.append("kbUid",""),o.append("client",u.XtJ),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:o}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(i," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:i}};e(n)}else s.yw.destroy(),s.yw.error("".concat(i," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){var t=e.getText(),n=t.length,r="number"==typeof h?h:Number.POSITIVE_INFINITY;if(n>r){var a,i;s.yw.warning(y.formatMessage({id:"character.limit.reached"},{limit:r})||"已达到 ".concat(r," 字符限制"));var o=t.substring(0,r);k.current=!0,setTimeout((function(){b.current&&b.current.setContent(o),k.current=!1}),0),S((null===(a=b.current)||void 0===a?void 0:a.getHtml())||"",(null===(i=b.current)||void 0===i?void 0:i.getMarkdown())||"",o)}else S(e.getHtml(),e.getMarkdown(),e.getText())}}));b.current=e}return function(){b.current&&(b.current.destroy(),b.current=null)}}}),[]),(0,p.useEffect)((function(){b.current&&void 0!==r&&r!==b.current.getHtml()&&(k.current=!0,b.current.setContent(r||"",!1),requestAnimationFrame((function(){k.current=!1})))}),[r]),(0,g.jsx)("div",{ref:w,style:a()({height:"100%"},d)})}},35589:function(e,t,n){n.d(t,{Z:function(){return A}});var r=n(76711),a=n.n(r),s=n(73193),i=n.n(s),o=n(90819),u=n.n(o),l=n(89933),c=n.n(l),d=n(45332),f=n.n(d),p=n(43388),g=n(27729),m=n(69533),h=n(61353),v=n(4628),x=n(44194),y=n(56862),M=n(94976),w=n(6231),b=n(10162),k=n(93953),j=n(69174),S=n(10390),Z=n(31549),C="CREATE_NEW_ROBOT",U=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,s=e.currentKbaseUid,i=e.onOk,o=e.onCancel,u=e.onChange,l=(0,v.useIntl)();return(0,Z.jsx)(g.Z,{title:l.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:i,onCancel:o,okText:l.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:l.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,Z.jsx)(k.Z,{spinning:n,children:(0,Z.jsxs)("div",{style:{marginBottom:16},children:[(0,Z.jsx)("p",{children:l.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,Z.jsxs)(j.Z,{style:{width:"100%"},placeholder:l.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:u,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(s));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===s,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,Z.jsx)(j.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,Z.jsx)(j.Z.Option,{value:"divider",disabled:!0,children:(0,Z.jsx)(S.Z,{style:{margin:"4px 0"}})}),(0,Z.jsx)(j.Z.Option,{value:C,label:l.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,Z.jsxs)("div",{style:{color:"#1890ff"},children:[(0,Z.jsx)(b.Z,{})," ",l.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},A=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,s=e.checkingEmbeddingModel,o=(0,v.useIntl)(),l=(0,x.useState)(!1),d=f()(l,2),b=d[0],k=d[1],j=(0,x.useState)(!1),S=f()(j,2),A=S[0],I=S[1],T=(0,x.useState)(!1),E=f()(T,2),P=E[0],F=E[1],O=(0,x.useState)(),q=f()(O,2),D=(q[0],q[1]),R=(0,x.useState)([]),L=f()(R,2),z=L[0],Y=L[1],B=(0,x.useState)(""),N=f()(B,2),V=N[0],H=N[1],J=function(){var e=c()(u()().mark((function e(r){var a,s,i,l;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,a={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:M.whQ,type:M.f4h,orgUid:null==n?void 0:n.uid},e.next=5,(0,y.p0)(a);case 5:if(s=e.sent,console.log("queryRobotsByOrg response:",s,a),200!==s.code){e.next=15;break}return i=(null==s?void 0:s.data.content)||[],l=i.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),Y(l),r&&l.length>0&&D(l[0]),e.abrupt("return",l);case 15:return p.yw.error(s.message),e.abrupt("return",[]);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),p.yw.error(o.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 24:return e.prev=24,F(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,19,24,27]])})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=c()(u()().mark((function e(){var n,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V&&null!=t&&t.uid){e.next=3;break}return p.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return p.yw.loading(o.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:V,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,y.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r,n),200!==r.code){e.next=18;break}return p.yw.destroy(),p.yw.success(o.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=null==r?void 0:r.data,D(a),e.abrupt("return",!0);case 18:return p.yw.destroy(),p.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),p.yw.destroy(),p.yw.error(o.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),r){e.next=4;break}return g.Z.confirm({title:o.formatMessage({id:"warning",defaultMessage:"警告"}),content:o.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 4:if(!s){e.next=7;break}return p.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 7:return e.next=9,K();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=c()(u()().mark((function e(){var n,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return p.yw.error(o.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 3:return p.yw.loading(o.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=6,J(!0);case 6:if(n=e.sent,p.yw.destroy(),!(n.length>0)){e.next=12;break}n.length>1?(Y(n),H(""),k(!0)):W(n[0]),e.next=21;break;case 12:return e.next=14,J(!1);case 14:if(r=e.sent,console.log("All robots without kbase filter:",r),0!==r.length){e.next=19;break}return p.yw.info(o.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 19:H(""),k(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:M.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else p.yw.error(o.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},G=function(){var e=c()(u()().mark((function e(){var n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V){e.next=3;break}return p.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=z.find((function(e){return e.uid===V})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return g.Z.confirm({title:o.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:o.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X();case 2:e.sent&&(k(!1),W(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,X();case 9:e.sent&&(k(!1),n&&W(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=c()(u()().mark((function e(n){var r,s,l,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.yw.loading(o.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=i()(i()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,y.lg)(r);case 7:if(s=e.sent,console.log("Create robot response:",s),200!==s.code){e.next=29;break}if(p.yw.destroy(),p.yw.success(o.formatMessage({id:"create.success",defaultMessage:"创建成功"})),I(!1),l=null==s?void 0:s.data,console.log("New robot data:",l),null==l||!l.uid){e.next=23;break}H(l.uid),D(l),Y((function(e){var t=[l].concat(a()(e));return console.log("Updated robot list:",t),t})),k(!1),W(l),e.next=27;break;case 23:return e.next=25,J(!1);case 25:c=e.sent,console.log("Fetched all robots after creation:",c);case 27:e.next=31;break;case 29:p.yw.destroy(),p.yw.error(s.message||o.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),p.yw.destroy(),p.yw.error(o.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(m.ZP,{icon:(0,Z.jsx)(h.Z,{}),type:"primary",onClick:Q,disabled:s,children:o.formatMessage({id:"chat.test"})}),(0,Z.jsx)(U,{visible:b,loading:P,robotList:z,selectedRobotUid:V,currentKbaseUid:null==t?void 0:t.uid,onOk:G,onCancel:function(){return k(!1)},onChange:function(e){e===C?(I(!0),H("")):H(e)}}),A&&(0,Z.jsx)(w.Z,{open:A,onClose:function(){return I(!1)},onSubmit:_})]})}},33533:function(e,t,n){var r=n(45332),a=n.n(r),s=n(88722),i=n(8732),o=n(74171),u=n(44429),l=n(58620),c=n(30857),d=n(30310),f=n(69533),p=n(93953),g=n(44194),m=n(31549);t.Z=function(e){var t=e.type,n=e.open,r=e.onClose,h=(0,s.Z)().translateString,v=(0,i.j)((function(e){return e.currentKbase})),x=(0,u.L)((function(e){return e.userInfo})),y=(0,o.u)((function(e){return e.currentOrg})),M=(0,g.useState)(""),w=a()(M,2),b=w[0],k=w[1],j=(0,g.useState)(!1),S=a()(j,2),Z=S[0],C=S[1],U=function(){console.log("refresh"),C(!1);var e=(0,l.Cn)()+"?org="+encodeURIComponent(null==y?void 0:y.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==v?void 0:v.uid)+"&uid="+encodeURIComponent(null==x?void 0:x.uid)+"&nickname="+encodeURIComponent(null==x?void 0:x.nickname)+"&avatar="+encodeURIComponent(null==x?void 0:x.avatar)+"&navbar=0&"+(new Date).getTime();k(e)};(0,g.useEffect)((function(){U()}),[v]);return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(c.Z,{title:h(null==v?void 0:v.name),onClose:function(){r&&r()},open:n,extra:(0,m.jsxs)(d.Z,{children:[(0,m.jsx)(f.ZP,{onClick:function(){window.open(b)},children:"新窗口"}),(0,m.jsx)(f.ZP,{onClick:function(){console.log("restart"),U()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,m.jsx)(p.Z,{spinning:!Z,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,m.jsx)("iframe",{id:"chat-iframe",src:b,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){C(!0),console.log("Iframe loaded successfully!")}})]})})}},52489:function(e,t,n){n.d(t,{w:function(){return v}});var r=n(90819),a=n.n(r),s=n(89933),i=n.n(s),o=n(45332),u=n.n(o),l=n(44194),c=n(5957),d=n(82404),f=n(27729),p=n(4628),g=n(94527),m=n(60926),h=n(31549),v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)d.ZP.info("正在检查模型状态，请稍后再试");else{var r=m.A.getState().llmproviderConfigDefault.defaultEmbeddingProvider,a=m.A.getState().llmproviderConfigDefault.defaultEmbeddingModel,s="ollama"===r;s?t?e():(0,g.J$)({model:a}).then((function(t){if(404===t.code)return console.log("API 返回 404，不影响操作，直接执行"),void e();var n="请首先拉取Embedding向量模型".concat(a,"，用于知识库向量检索");f.Z.warning({title:"嵌入式模型缺失",content:n,okText:"确定"})})).catch((function(t){console.error("重新检查模型时出错:",t),console.log("API 调用异常，不影响操作，直接执行"),e()})):e()}};t.Z=function(e){var t=e.onModelStatusChange,n=(0,p.useIntl)(),r=(0,l.useState)(!1),s=u()(r,2),o=s[0],d=s[1],f=(0,l.useState)(!1),v=u()(f,2),x=v[0],y=v[1],M=(0,m.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingModel})),w=(0,m.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingProvider})),b=(0,l.useState)(!1),k=u()(b,2),j=k[0],S=k[1],Z=function(){return"ollama"===w},C=function(){var e=i()(a()().mark((function e(){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("检查嵌入式模型是否存在:",{defaultEmbeddingModel:M,defaultEmbeddingProvider:w}),Z()){e.next=5;break}return console.log("不需要检查模型：",{defaultEmbeddingModel:M,defaultEmbeddingProvider:w}),null==t||t(!0),e.abrupt("return");case 5:return e.prev=5,y(!0),null==t||t(!1),e.next=10,(0,g.J$)({model:M});case 10:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(d(null==n?void 0:n.data),null==t||t(null==n?void 0:n.data),S(!1)):404===n.code?(d(!0),null==t||t(!0),S(!1),console.log("接口404，不影响使用，视为模型存在")):(d(!1),null==t||t(!1),S(!1)),e.next=22;break;case 15:e.prev=15,e.t0=e.catch(5),console.error("检查嵌入式模型失败:",e.t0),d(!0),null==t||t(!0),S(!1),console.log("接口异常，不影响使用，视为模型存在");case 22:return e.prev=22,y(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[5,15,22,25]])})));return function(){return e.apply(this,arguments)}}();return(0,l.useEffect)((function(){C()}),[M,w]),Z()?x?(0,h.jsx)(c.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):o?j?(0,h.jsx)(c.Z,{type:"warning",showIcon:!0,message:(0,h.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,h.jsx)("span",{children:"嵌入模型配置警告"})}),description:"嵌入模型 ".concat(M," 不存在或无法访问，可能会影响知识库向量检索功能，请检查配置或联系管理员"),style:{marginBottom:16}}):null:(0,h.jsx)(c.Z,{type:"warning",showIcon:!0,message:(0,h.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,h.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型".concat(M,"，用于知识库向量检索")}),style:{marginBottom:16}}):null}},11818:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),s=(n(44194),n(47710)),i=n(94976),o=n(96596),u=n.n(o),l=n(67242),c=n(43388),d=n(58620),f=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},p={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var t=u()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=t,o.fileType=e.type,l.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var t,a=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(a),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(s.Z,a()(a()({},p),{},{children:t}))}},21850:function(e,t,n){var r=n(25553);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},6231:function(e,t,n){var r=n(90819),a=n.n(r),s=n(89933),i=n.n(s),o=n(45332),u=n.n(o),l=n(74171),c=n(94976),d=n(99036),f=n(86702),p=n(59005),g=n(4628),m=n(27729),h=n(69705),v=n(28582),x=n(69533),y=n(30310),M=n(69174),w=n(44194),b=n(47926),k=n(97799),j=n(10162),S=n(11818),Z=n(59908),C=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=(0,g.useIntl)(),o=d.A.useForm(),U=u()(o,1)[0],A=(0,l.u)((function(e){return e.currentOrg})),I=(0,w.useState)(!1),T=u()(I,2),E=T[0],P=T[1],F=(0,w.useState)(!1),O=u()(F,2),q=O[0],D=O[1],R=(0,w.useState)(0),L=u()(R,2),z=L[0],Y=L[1],B=(0,w.useState)([]),N=u()(B,2),V=N[0],H=N[1],J=(0,w.useState)([]),X=u()(J,2),Q=X[0],K=X[1],W=(0,w.useState)(""),G=u()(W,2),_=G[0],$=G[1],ee=(0,w.useCallback)(function(){var e=i()(a()().mark((function e(t){var n,r,s,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==A?void 0:A.uid,searchText:t||""},e.next=5,(0,b.VW)(r);case 5:return s=e.sent,console.log("queryRobotSettingsByOrg response:",s,r),i=(null==s||null===(n=s.data)||void 0===n?void 0:n.content)||[],H(i),!U.getFieldValue("settingsUid")&&i.length>0&&U.setFieldsValue({settingsUid:i[0].uid}),o=i.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),K(o),e.abrupt("return",o);case 13:return e.prev=13,D(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==A?void 0:A.uid,U]);(0,w.useEffect)((function(){t&&ee()}),[t,z,ee]);var te=function(){console.log("handleSaveRobot"),U.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==A?void 0:A.uid,avatar:e.avatar||_};console.log("robotObject:",t),r(t),U.resetFields(),$("")})).catch((function(e){console.log("Form errors:",e)}))};(0,w.useEffect)((function(){console.log("RobotForm useEffect"),t&&(U.resetFields(),U.setFieldsValue({type:c.f4h}),$(""))}),[t,U]);var ne=function(){var e=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",t),$(t),U.setFieldsValue({avatar:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsx)("div",{children:(0,C.jsxs)(m.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:te,onCancel:function(){U.resetFields(),n()},children:[(0,C.jsxs)(d.A,{form:U,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,C.jsx)(h.Z.Item,{name:"avatarUpload",label:s.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,C.jsxs)(S.G,{onSuccess:ne,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,C.jsx)(v.Z,{src:_}),(0,C.jsx)(x.ZP,{icon:(0,C.jsx)(Z.Z,{}),style:{marginLeft:12},children:s.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,C.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,C.jsx)(d.A.Item,{label:s.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:s.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,C.jsxs)(y.Z.Compact,{block:!0,children:[(0,C.jsx)(M.Z,{showSearch:!0,allowClear:!0,placeholder:s.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),options:Q,loading:q,filterOption:!1,onSearch:function(e){return ee(e)},onFocus:function(){return ee()},notFoundContent:0===V.length?(0,C.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,C.jsx)("div",{style:{marginBottom:8,color:"#999"},children:s.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,C.jsx)(x.ZP,{size:"small",type:"primary",icon:(0,C.jsx)(j.Z,{}),onClick:function(){return P(!0)},children:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0}),(0,C.jsx)(x.ZP,{size:"small",icon:(0,C.jsx)(j.Z,{}),onClick:function(){return P(!0)},title:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:s.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,C.jsx)(f.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return te()}}}),(0,C.jsx)(p.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:c.f4h,defaultMessage:"Service"}),value:c.f4h},{label:s.formatMessage({id:c.Qeb,defaultMessage:"Chat"}),value:c.Qeb}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,C.jsx)(k.Z,{open:E,onOpenChange:P,orgUid:(null==A?void 0:A.uid)||"",record:null,onSuccess:function(){P(!1),Y((function(e){return e+1}))}})]})})}},18820:function(e,t,n){n.d(t,{Z:function(){return Ae}});var r=n(84176),a=n.n(r),s=n(73193),i=n.n(s),o=n(86222),u=n.n(o),l=n(90819),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(94976),v=n(4628);function x(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/query/org",{method:"GET",params:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/update",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/delete",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/delete/all",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/updateIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/updateVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/updateAllIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/chunk/updateAllVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return O=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}var q=n(33533),D=n(1715),R=n(8732),L=n(74171),z=n(14447),Y=n(44565),B=n(27729),N=n(82878),V=n(65641),H=n(69533),J=n(90581),X=n(43275),Q=n(28508),K=n(44194),W=n(96596),G=n.n(W),_=n(88722),$=n(58620),ee=n(78112),te=n(76711),ne=n.n(te),re=n(84553),ae=n(58087),se=n(10162),ie=n(55785),oe=n(14377),ue=n(99036),le=n(59005),ce=n(86702),de=n(50628),fe=n(60241),pe=n(30857),ge=n(30310),me=n(1282),he=n(83281),ve=n(92351),xe=n(31549),ye=function(e){var t=e.isEdit,n=e.chunk,r=e.open,a=e.onClose,s=e.onSubmit,o=ue.A.useForm(),u=g()(o,1)[0],l=(0,v.useIntl)(),d=(0,L.u)((function(e){return e.currentOrg})),p=(0,R.j)((function(e){return e.currentKbase})),h=(0,D.v)((function(e){return e.currentCategory})),x=(0,D.v)((function(e){return e.categorySelectOptions})),y=(0,K.useState)(),M=g()(y,2),w=M[0],b=M[1],k=(0,K.useState)([]),j=g()(k,2),S=j[0],Z=j[1],C=(0,K.useState)(!1),U=g()(C,2),A=U[0],I=U[1],T=(0,K.useState)(""),E=g()(T,2),P=E[0],O=E[1],q=(0,K.useState)(!1),z=g()(q,2),Y=z[0],B=z[1],V=(0,K.useState)([]),X=g()(V,2),Q=X[0],W=X[1],G=(0,K.useState)(new Set),_=g()(G,2),$=_[0],ee=_[1],te=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ye=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,B(!0),e.next=4,u.validateFields();case 4:t=e.sent,r=i()(i()(i()({},n),t),{},{categoryUid:w,tagList:te(S),kbUid:null==p?void 0:p.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",r),s(r),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),m.yw.error("请检查表单填写是否正确");case 14:return e.prev=14,B(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=P.trim();e&&!S.includes(e)&&Z([].concat(ne()(S),[e])),I(!1),O("")},we=function(){I(!1),O("")},be=function(){var e=f()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.getFieldValue("name"),n=u.getFieldValue("content"),t&&n){e.next=5;break}return m.yw.warning("请先填写名称和内容"),e.abrupt("return");case 5:return B(!0),e.prev=6,r={name:t,content:n,orgUid:null==d?void 0:d.uid},e.next=10,F(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(m.yw.success("常见问题生成成功"),W(null==a?void 0:a.data),ee(new Set)):(W([]),m.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),m.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,B(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=f()(c()().mark((function e(t,n){var r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!$.has(n)){e.next=4;break}return m.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=i()(i()({},t),{},{categoryUid:null==h?void 0:h.uid,kbUid:null==p?void 0:p.uid,orgUid:null==d?void 0:d.uid,type:"TEXT"}),m.yw.loading("正在保存常见问题..."),e.next=8,(0,re.kh)(r);case 8:200===(a=e.sent).code?((s=new Set($)).add(n),ee(s),m.yw.success("常见问题保存成功")):m.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),m.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,K.useEffect)((function(){if(t&&n)u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid,enabled:void 0===(null==n?void 0:n.enabled)||n.enabled}),b(null==n?void 0:n.categoryUid),Z(te((null==n?void 0:n.tagList)||[]));else{if(u.setFieldsValue({name:"",content:"",enabled:!0}),x&&x.length>0){var e=x[0].value;u.setFieldValue("categoryUid",e),b(e)}Z([]),I(!1),O("")}W([]),ee(new Set)}),[t,n,u,x]),(0,xe.jsx)(pe.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,xe.jsxs)(ge.Z,{children:[(0,xe.jsx)(H.ZP,{onClick:a,children:"取消"}),(0,xe.jsx)(H.ZP,{onClick:ye,type:"primary",children:"保存"}),(0,xe.jsx)(H.ZP,{onClick:be,type:"default",loading:Y,icon:(0,xe.jsx)(ae.Z,{}),children:"智能生成常见问题"})]}),children:(0,xe.jsxs)(ue.A,{form:u,name:"chunkForm",submitter:!1,children:[(0,xe.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:x,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("chunk category selected ".concat(e)),b(e)}}}),(0,xe.jsx)(ce.Z,{label:l.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0,message:"请输入名称"}],placeholder:"请输入拆分文档名称"}),(0,xe.jsx)(de.Z,{label:"启用状态",name:"enabled",checkedChildren:"启用",unCheckedChildren:"禁用",tooltip:"控制拆分文档是否在知识库中生效",fieldProps:{defaultChecked:!0}}),(0,xe.jsx)(fe.Z,{label:l.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0,message:"请输入内容"}],placeholder:"请输入拆分文档内容",fieldProps:{rows:6,maxLength:1e4,showCount:!0},tooltip:"拆分文档的文本内容，用于知识库检索"}),(0,xe.jsx)(ue.A.Item,{label:"标签",name:"tagList",tooltip:"为拆分文档添加标签，便于分类和检索",children:(0,xe.jsxs)("div",{style:{minHeight:"32px"},children:[(0,xe.jsx)(ge.Z,{wrap:!0,style:{marginBottom:8},children:te(S).map((function(e,t){return(0,xe.jsx)(J.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void Z(te(S.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),A?(0,xe.jsxs)(ge.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)(me.Z,{value:P,onChange:function(e){O(e.target.value)},onKeyDown:function(e){"Enter"===e.key?Me():"Escape"===e.key&&we()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,xe.jsx)(H.ZP,{type:"primary",size:"small",icon:(0,xe.jsx)(ie.Z,{}),onClick:Me,disabled:!P.trim(),children:"保存"}),(0,xe.jsx)(H.ZP,{size:"small",icon:(0,xe.jsx)(oe.Z,{}),onClick:we,children:"取消"})]}):(0,xe.jsx)(H.ZP,{type:"dashed",onClick:function(){I(!0),O("")},icon:(0,xe.jsx)(se.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),Q.length>0&&(0,xe.jsxs)("div",{style:{marginTop:16},children:[(0,xe.jsx)(N.Z.Title,{level:5,children:"常见问题列表"}),(0,xe.jsx)(he.Z,{bordered:!0,dataSource:Q,renderItem:function(e,t){return(0,xe.jsx)(he.Z.Item,{actions:[(0,xe.jsx)(ve.Z,{title:$.has(t)?"已保存":"保存到常见问题库",children:(0,xe.jsx)(H.ZP,{type:$.has(t)?"default":"primary",icon:(0,xe.jsx)(ie.Z,{}),size:"small",disabled:$.has(t),onClick:function(){return ke(e,t)},children:$.has(t)?"已保存":"保存"})},"save")],children:(0,xe.jsx)(he.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})},Me=n(7358),we=n(77274),be=n(2484),ke=n(54881),je=n(58275),Se=n(11090),Ze=n(52489),Ce=n(35589),Ue=["current","pageSize"],Ae=function(e){var t=e.superUser,n=(0,v.useIntl)(),r=(0,K.useRef)(),s=(0,_.Z)().translateString,o=(0,K.useState)(1),l=g()(o,2),d=l[0],p=l[1],y=(0,K.useState)(10),w=g()(y,2),k=w[0],S=w[1],C=(0,L.u)((function(e){return e.currentOrg})),A=(0,R.j)((function(e){return e.currentKbase})),T=(0,D.v)((function(e){return e.currentCategory})),P=(0,D.v)((function(e){return e.categorySelectOptions})),F=(0,K.useState)(!1),O=g()(F,2),W=O[0],te=O[1],ne=(0,K.useState)(!1),re=g()(ne,2),ae=re[0],se=re[1],ie=(0,K.useState)(),oe=g()(ie,2),ue=oe[0],le=oe[1],ce=(0,K.useState)([]),de=g()(ce,2),fe=de[0],pe=de[1],ge=(0,K.useState)([]),me=g()(ge,2),he=me[0],ve=me[1],Ae=(0,K.useState)(!1),Ie=g()(Ae,2),Te=Ie[0],Ee=Ie[1],Pe=(0,K.useState)(!1),Fe=g()(Pe,2),Oe=Fe[0],qe=Fe[1],De=(0,K.useState)({}),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,K.useState)(0),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=B.Z.useModal(),Je=g()(He,2),Xe=Je[0],Qe=Je[1],Ke=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0,fixed:"left"},{title:(0,xe.jsx)(v.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",ellipsis:!0,copyable:!0,fixed:"left",tooltip:n.formatMessage({id:"llm.chunk.name.tooltip",defaultMessage:"拆分后的内容块名称"}),render:function(e,t,n,r){var a,s,i=null==t?void 0:t.name;null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")&&(i=null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)("span",{style:{marginRight:4},children:i}),(0,xe.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,copyable:!0,width:300,tooltip:n.formatMessage({id:"llm.chunk.content.tooltip",defaultMessage:"拆分后的内容块具体内容"}),render:function(e,t){var r=t.content||"-",a=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ee.TE)(t);case 2:e.sent.success?m.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):m.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,xe.jsx)(V.Z,{content:(0,xe.jsxs)("div",{children:[(0,xe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,xe.jsx)("span",{children:n.formatMessage({id:"chunk.content.preview",defaultMessage:"拆分内容预览"})}),(0,xe.jsx)(H.ZP,{type:"text",icon:(0,xe.jsx)(Me.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,xe.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:n.formatMessage({id:"chunk.content",defaultMessage:"拆分内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,xe.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.status.tooltip",defaultMessage:"拆分内容的处理状态，主要用于全文检索"}),render:function(e,t){var r=t.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,xe.jsx)(J.Z,{color:a,children:n.formatMessage({id:"llm.status.".concat((r||"").toLowerCase())})})}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.vectorStatus.tooltip",defaultMessage:"拆分内容的向量化处理状态，主要用于向量存储和检索"}),render:function(e,t){var r=t.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,xe.jsx)(J.Z,{color:a,icon:(0,xe.jsx)(we.Z,{}),children:n.formatMessage({id:"llm.vectorStatus.".concat((r||"").toLowerCase())})||r}):"-"}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,tooltip:n.formatMessage({id:"llm.chunk.tags.tooltip",defaultMessage:"拆分内容的标签，用于分类和搜索"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,xe.jsx)(xe.Fragment,{children:null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,xe.jsx)(J.Z,{color:"blue",style:{marginBottom:4},children:e},e)}))}):"-"}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"llm.chunk.category.tooltip",defaultMessage:"拆分内容所属的分类"}),render:function(e,t){var n=P.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,xe.jsx)(J.Z,{color:"blue",children:n.label}):(0,xe.jsx)(J.Z,{color:"default",children:"未分类"})}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:n.formatMessage({id:"enabled"}),status:"Success"},false:{text:n.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,width:100,tooltip:n.formatMessage({id:"llm.chunk.enabled.tooltip",defaultMessage:"拆分内容是否启用"})},{title:(0,xe.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.chunk.createdAt.tooltip",defaultMessage:"拆分内容创建的时间"}),render:function(e,t){return G()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,xe.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:n.formatMessage({id:"llm.chunk.updatedAt.tooltip",defaultMessage:"拆分内容最后更新的时间"}),render:function(e,t){return t.updatedAt?G()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],We=function(){var e=f()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,b(t);case 3:a=e.sent,console.log("delete response:",a),200===a.code?(null==r||r.current.reload(),m.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(n.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=f()(c()().mark((function e(){var t,a,s,i,o,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,i=u()(he),e.prev=7,i.s();case 9:if((o=i.n()).done){e.next=23;break}return l=o.value,e.prev=11,e.next=14,b(l);case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(n.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),pe([]),ve([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ue){e.next=7;break}return e.next=4,M(i()(i()({},t),{},{uid:ue.uid}));case 4:a=e.sent,e.next=7;break;case 7:200===a.code?(m.yw.success(n.formatMessage({id:ue?"update.success":"add.success",defaultMessage:ue?"Update Success":"Add Success"})),se(!1),null==r||null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),m.yw.error(n.formatMessage({id:ue?"update.error":"add.error",defaultMessage:ue?"Update Error":"Add Error"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),$e=[].concat(Ke,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,r,a){return[(0,xe.jsx)("a",{onClick:function(){return function(e){le(e),se(!0)}(t)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,xe.jsx)(X.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==t?void 0:t.name,"】？"),onConfirm:function(){return We(t)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"}),children:(0,xe.jsx)(H.ZP,{size:"small",type:"link",danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,xe.jsx)(Q.Z,{menu:{items:[{key:"updateIndex",label:n.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return et(t)}},{key:"updateVectorIndex",label:n.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return tt(t)}}]},placement:"bottomRight",children:(0,xe.jsxs)(H.ZP,{size:"small",type:"link",children:[n.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,xe.jsx)(be.Z,{})]})},"indexOperations")]}}]),et=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,Z({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=f()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,U({uid:t.uid});case 4:a=e.sent,m.yw.destroy(),200===a.code?(m.yw.success(n.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=r.current)||void 0===s||s.reload()):m.yw.error(a.message||n.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=f()(c()().mark((function e(){var t,a,s,i,o,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,i=u()(he),e.prev=7,i.s();case 9:if((o=i.n()).done){e.next=23;break}return l=o.value,e.prev=11,e.next=14,Z({uid:l.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):m.yw.error(n.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),rt=function(){var e=f()(c()().mark((function e(){var t,a,s,i,o,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==he.length){e.next=3;break}return m.yw.warning(n.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(n.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,i=u()(he),e.prev=7,i.s();case 9:if((o=i.n()).done){e.next=23;break}return l=o.value,e.prev=11,e.next=14,U({uid:l.uid});case 14:200===e.sent.code?a++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(n.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):m.yw.error(n.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(t=r.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),at=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:n.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,I({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.Z.confirm({title:n.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:n.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(n.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,E({kbUid:null==A?void 0:A.uid,categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,orgUid:null==C?void 0:C.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(n.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=r.current)||void 0===a||a.reload()):m.yw.error(t.message||n.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(n.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,K.useEffect)((function(){var e;null==r||null===(e=r.current)||void 0===e||e.reload()}),[A,T]),(0,K.useEffect)((function(){return z.Z.on(h.YwV,(function(e){var t;console.log("EVENT_BUS_MQTT_NOTICE",e),null==r||null===(t=r.current)||void 0===t||t.reload()})),function(){z.Z.off(h.YwV)}}),[]);var it=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=i()({categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:(null==C?void 0:C.uid)||"",accessToken:a||"",exportType:t},Le),"current"===t?(s.pageNumber=d-1,s.pageSize=k):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,$.kG)()+"/api/v1/llm/chunk/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ot=function(){var e=f()(c()().mark((function e(){var t,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ne){e.next=3;break}return m.yw.warning(n.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(n.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,kbUid:null==A?void 0:A.uid,orgUid:null==C?void 0:C.uid},e.next=8,j(t);case 8:a=e.sent,console.log("handleDeleteAllConfirm response:",a,t),200===a.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=r.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||n.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(n.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),ut=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return it("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Ze.Z,{onModelStatusChange:function(e){Ee(e),qe(!1)}}),(0,xe.jsx)(Y.Z,{columns:$e,actionRef:r,cardBordered:!0,rowSelection:{selectedRowKeys:fe,onChange:function(e,t){pe(e),ve(t)}},scroll:{x:2e3},request:function(){var e=f()(c()().mark((function e(n,r,s){var o,u,l,d,f,g,v,y,M,w;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",n,r,s),o=n.current,u=n.pageSize,l=a()(n,Ue),p(o),S(u),ze(l),d=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],d=g,f="ascend"===r[g]?"ascend":"descend"),v=t?void 0:(null==T?void 0:T.uid)===h.zBg?"":null==T?void 0:T.uid,y=t||null==A?void 0:A.uid,M=i()(i()({pageNumber:o-1,pageSize:u,categoryUid:v,kbUid:y,orgUid:null==C?void 0:C.uid,superUser:t},l),{},{sortBy:d,sortDirection:f}),e.next=13,x(M);case 13:return w=e.sent,console.log("queryChunksByOrg response:",w,M),200===w.code?Ve(null==w?void 0:w.data.totalElements):m.yw.error(w.message),e.abrupt("return",{data:null==w?void 0:w.data.content,success:!0,total:null==w?void 0:w.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e,t){p(e),S(t)}},dateFormatter:"string",headerTitle:s(null==A?void 0:A.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:t?function(){return[]}:function(){var e=[(0,xe.jsx)(Ce.Z,{currentKbase:A,currentOrg:C,embeddingModelExists:Te,checkingEmbeddingModel:Oe||!Te},"chat")],t=[];fe.length>0&&t.push({key:"batchDelete",icon:(0,xe.jsx)(ke.Z,{}),danger:!0,label:n.formatMessage({id:"batch.delete"})+" (".concat(fe.length,")"),onClick:function(){Xe.confirm({title:n.formatMessage({id:"batch.deleteTip"}),content:"".concat(n.formatMessage({id:"batch.deleteAffirm"})," ").concat(fe.length," ").concat(n.formatMessage({id:"items"}),"?"),onOk:Ge,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"batchUpdateIndex",icon:(0,xe.jsx)(we.Z,{}),label:n.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(fe.length,")"),onClick:nt},{key:"batchUpdateVectorIndex",icon:(0,xe.jsx)(we.Z,{}),label:n.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(fe.length,")"),onClick:rt}),t.push({key:"deleteAll",icon:(0,xe.jsx)(je.Z,{}),danger:!0,label:n.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Xe.confirm({title:n.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:n.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有拆分数据吗？此操作不可恢复!"}),onOk:ot,okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,xe.jsx)(we.Z,{}),label:n.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:at},{key:"updateAllVectorIndex",icon:(0,xe.jsx)(we.Z,{}),label:n.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:st});var r=[{key:"export-current",icon:(0,xe.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return it("current")}}];return Ne>0&&(Ne<=1e3?r.push({key:"export-all",icon:(0,xe.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ne,"条)"),onClick:function(){return it("all")}}):r.push({key:"export-range",icon:(0,xe.jsx)(Se.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ne,"条)"),children:ut(Ne)})),e.push((0,xe.jsx)(Q.Z,{menu:{items:r},placement:"bottom",children:(0,xe.jsxs)(H.ZP,{type:"primary",children:[n.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,xe.jsx)(be.Z,{})]})},"exportDropdown")),t.length>0&&e.push((0,xe.jsx)(Q.Z,{menu:{items:t},placement:"bottom",children:(0,xe.jsxs)(H.ZP,{type:fe.length>0?"primary":"default",danger:fe.length>0,children:[fe.length>0?n.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(fe.length,")"):n.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,xe.jsx)(be.Z,{})]})},"batchOperations")),e}}),W&&(0,xe.jsx)(q.Z,{type:h.ACv,open:W,onClose:function(){return te(!1)}}),(0,xe.jsx)(ye,{isEdit:!!ue,chunk:ue,open:ae,onClose:function(){return se(!1)},onSubmit:_e}),Qe]})}},86948:function(e,t,n){n.d(t,{Z:function(){return ke}});var r=n(84176),a=n.n(r),s=n(73193),i=n.n(s),o=n(86222),u=n.n(o),l=n(90819),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(84553),v=n(74171),x=n(77274),y=n(2484),M=n(10162),w=n(54881),b=n(93689),k=n(40439),j=n(58275),S=n(30617),Z=n(11090),C=n(61107),U=n(44565),A=n(90581),I=n(65641),T=n(43275),E=n(69533),P=n(28508),F=n(92351),O=n(27729),q=n(44194),D=n(1715),R=n(4628),L=n(88722),z=n(8732),Y=n(94976),B=n(54974),N=n(58620),V=n(96596),H=n.n(V),J=n(78069),X=n(35589),Q=n(52489),K=n(76711),W=n.n(K),G=n(99036),_=n(86702),$=n(15939),ee=n(97222),te=n(48058),ne=n(60241),re=n(59005),ae=n(91825),se=n(64346),ie=n(50628),oe=n(30857),ue=n(30310),le=n(95321),ce=n(47710),de=n(19239),fe=n(10390),pe=n(68177),ge=n(1282),me=n(58087),he=n(78112),ve=n(66406),xe=n(31549),ye=["key"],Me=function(e){var t=e.isEdit,n=e.faq,r=e.open,s=e.onClose,o=e.onSubmit,l=G.A.useForm(),d=g()(l,1)[0],p=(0,q.useState)(""),x=g()(p,2),y=x[0],w=x[1],b=(0,q.useState)(""),k=g()(b,2),j=k[0],S=k[1],Z=(0,q.useState)(""),C=g()(Z,2),U=C[0],I=C[1],T=(0,v.u)((function(e){return e.currentOrg})),P=(0,z.j)((function(e){return e.currentKbase})),R=(0,D.v)((function(e){return e.categorySelectOptions})),L=(0,D.v)((function(e){return e.categoryTreeOptions})),B=(0,D.v)((function(e){return e.currentCategory})),V=(0,q.useState)(),J=g()(V,2),X=(J[0],J[1]),Q=(0,q.useState)([]),K=g()(Q,2),Me=K[0],we=K[1],be=(0,q.useState)(!1),ke=g()(be,2),je=ke[0],Se=ke[1],Ze=(0,q.useState)(""),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,q.useRef)(null),Te=(0,q.useState)([]),Ee=g()(Te,2),Pe=(Ee[0],Ee[1]),Fe=(0,q.useState)([]),Oe=g()(Fe,2),qe=Oe[0],De=Oe[1],Re=(0,q.useState)(!0),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,q.useState)("permanent"),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,q.useState)([]),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],We=(0,q.useState)(!1),Ge=g()(We,2),_e=Ge[0],$e=Ge[1],et=(0,q.useState)([]),tt=g()(et,2),nt=tt[0],rt=tt[1],at=(0,q.useState)([]),st=g()(at,2),it=st[0],ot=st[1],ut=(0,q.useState)(!1),lt=g()(ut,2),ct=lt[0],dt=lt[1],ft=(0,q.useState)(""),pt=g()(ft,2),gt=pt[0],mt=pt[1],ht=(0,q.useState)(""),vt=g()(ht,2),xt=vt[0],yt=vt[1],Mt=(0,q.useState)([]),wt=g()(Mt,2),bt=wt[0],kt=wt[1],jt=(0,q.useState)([]),St=g()(jt,2),Zt=St[0],Ct=St[1],Ut=(0,q.useState)(!1),At=g()(Ut,2),It=At[0],Tt=At[1];(0,q.useEffect)((function(){var e=function(){var e=f()(c()().mark((function e(){var t,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==B?void 0:B.uid)===Y.zBg?"":null==B?void 0:B.uid,kbUid:null==P?void 0:P.uid,orgUid:null==T?void 0:T.uid},e.next=5,(0,h.pf)(t);case 5:r=e.sent,m.yw.destroy(),200===r.code?(a=null==r?void 0:r.data.content.map((function(e){return{label:e.question,value:e.uid}})),De(a.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):m.yw.error(r.message||"加载常见问题失败"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),m.yw.destroy(),m.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();r&&e()}),[r,null==P?void 0:P.uid,null==T?void 0:T.uid,null==B?void 0:B.uid,null==n?void 0:n.uid]),(0,q.useEffect)((function(){if(t){var e,r,a,s,i,o=Array.isArray(null==n?void 0:n.similarQuestions)?n.similarQuestions.map((function(e){return"string"==typeof e?e:String(e)})).filter((function(e){return""!==e.trim()})):[];if(d.setFieldsValue({question:null==n?void 0:n.question,similarQuestions:o,answer:null==n?void 0:n.answer,answerHtml:null==n?void 0:n.answerHtml,answerMarkdown:null==n?void 0:n.answerMarkdown,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==P?void 0:P.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateType:"permanent",dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[H()(n.startDate),H()(n.endDate)]:void 0}),console.log("edit faq:",n),w((null==n?void 0:n.answer)||""),S((null==n?void 0:n.answerHtml)||(null==n?void 0:n.answer)||""),I((null==n?void 0:n.answerMarkdown)||(null==n?void 0:n.answer)||""),$e(!1),we((null==n||null===(r=n.tagList)||void 0===r?void 0:r.filter((function(e){return e&&""!==e.trim()})))||[]),Pe((null==n||null===(a=n.relatedFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]),Ye(!1!==(null==n?void 0:n.enabled)),Ke(o),null!=n&&null!==(s=n.images)&&void 0!==s&&s.length&&n.images.some((function(e){return e&&""!==e.trim()}))){var u=n.images.filter((function(e){return e&&""!==e.trim()})),l=u.map((function(e,t){return{uid:"-".concat(t+1),name:"image_".concat(t+1,".jpg"),status:"done",url:e,thumbUrl:e}}));rt(l),ot(u)}else rt([]),ot([]);if(null!=n&&null!==(i=n.attachments)&&void 0!==i&&i.length&&n.attachments.some((function(e){return e&&""!==e.trim()}))){var c=n.attachments.filter((function(e){return e&&""!==e.trim()})),f=c.map((function(e,t){var n=e.substring(e.lastIndexOf("/")+1);return{uid:"-".concat(t+1),name:n||"attachment_".concat(t+1),status:"done",url:e}}));kt(f),Ct(c)}else kt([]),Ct([])}else{var p=Et(L);d.setFieldsValue({question:"",similarQuestions:[],answer:"",answerHtml:"",answerMarkdown:"",categoryUid:p,kbUid:null==P?void 0:P.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateType:"permanent",dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),p&&X(p),w(""),S(""),I(""),$e(!1),we([]),Pe([]),Ye(!0),Ke([]),rt([]),ot([]),kt([]),Ct([])}}),[n,r,R,L]);var Et=function e(t){var n,r=u()(t||[]);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.key!==Y.zBg)return a.key;var s=e(a.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""};(0,q.useEffect)((function(){var e;je&&(null===(e=Ie.current)||void 0===e||e.focus())}),[je]),(0,q.useEffect)((function(){console.log("editorAnswer",y),console.log("editorAnswerHtml",j)}),[y,j]);var Pt=function(){Ue&&-1===Me.indexOf(Ue)&&we([].concat(W()(Me),[Ue])),Se(!1),Ae("")},Ft=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:mt(t.url||t.thumbUrl),dt(!0),yt(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ot=(0,xe.jsx)(E.ZP,{icon:(0,xe.jsx)(M.Z,{}),children:"上传图片"}),qt={name:"file",accept:"image/*",action:(0,N.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(Y.LA8)},listType:"picture-card",fileList:nt,onPreview:Ft,onChange:function(e){var t=W()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;ot((function(e){return[].concat(W()(e),[r])})),m.yw.success("上传 ".concat(e.file.name," 成功"))}else m.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&m.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t,n;return e.response&&200===e.response.code?i()(i()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl,thumbUrl:null===(n=e.response)||void 0===n?void 0:n.data.fileUrl}):e})),rt(t)},data:function(e){return{file:e,fileName:H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:Y.IrL,categoryUid:d.getFieldValue("categoryUid")||"",kbUid:(null==P?void 0:P.uid)||"",channel:Y.XtJ}},onRemove:function(e){return e.url&&ot((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},Dt={name:"file",action:(0,N.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(Y.LA8)},fileList:bt,onChange:function(e){var t=W()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n,r=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;Ct((function(e){return[].concat(W()(e),[r])})),m.yw.success("上传 ".concat(e.file.name," 成功"))}else m.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&m.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){var t;return e.response&&200===e.response.code?i()(i()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl}):e})),kt(t)},data:function(e){return{file:e,fileName:H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:Y.IrL,categoryUid:d.getFieldValue("categoryUid")||"",kbUid:(null==P?void 0:P.uid)||"",channel:Y.XtJ}},onRemove:function(e){return e.url&&Ct((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},Rt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,N.OJ)()){e.next=3;break}return m.yw.error("生成相似问法功能仅在企业版和平台版可用"),e.abrupt("return");case 3:if((t=d.getFieldValue("question"))&&""!==t.trim()){e.next=7;break}return m.yw.error("请先输入问题后再生成相似问法"),e.abrupt("return");case 7:return e.prev=7,Tt(!0),m.yw.loading("正在智能生成相似问法..."),n={question:t,orgUid:null==T?void 0:T.uid},e.next=13,(0,h.YQ)(n);case 13:r=e.sent,console.log("生成相似问法响应:",n,r),m.yw.destroy(),200===r.code?(a=null==r?void 0:r.data,console.log("生成的相似问法:",a),s=a.similarQuestions.filter((function(e){return e&&""!==e.trim()})),i=Qe.filter((function(e){return e&&""!==e.trim()})),o=W()(i),s.forEach((function(e){o.includes(e)||o.push(e)})),Ke(o),d.setFieldValue("similarQuestions",o),m.yw.success("已成功生成 ".concat(s.length," 条相似问法"))):m.yw.error(r.message||"生成相似问法失败"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(7),console.error("生成相似问法出错:",e.t0),m.yw.destroy(),m.yw.error("生成相似问法失败");case 24:return e.prev=24,Tt(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[7,19,24,27]])})));return function(){return e.apply(this,arguments)}}();return(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)(oe.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:s,open:r,extra:(0,xe.jsxs)(ue.Z,{children:[(0,xe.jsx)(E.ZP,{onClick:s,children:"取消"}),(0,xe.jsx)(E.ZP,{onClick:function(){var e=Qe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));d.setFieldValue("similarQuestions",e),d.validateFields().then((function(e){var t,r;if(console.log("handleSubmit values:",e),console.log("handleSubmit edited:",y,j,U),"permanent"===e.dateType)t=H()().format("YYYY-MM-DDTHH:mm:ss"),r=H()().add(100,"years").format("YYYY-MM-DDTHH:mm:ss");else{var a=e.dateRange;t=null!=a&&a[0]?a[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=a&&a[1]?a[1].format("YYYY-MM-DDTHH:mm:ss"):void 0}var s=Qe.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e})),u=it.filter((function(e){return e&&""!==e.trim()})),l=Zt.filter((function(e){return e&&""!==e.trim()})),c=Me.filter((function(e){return e&&""!==e.trim()})),d=i()(i()(i()({},n),e),{},{type:Y.PYi,kbUid:null==P?void 0:P.uid,orgUid:null==T?void 0:T.uid,answer:e.answerHtml,answerHtml:e.answerHtml,answerMarkdown:e.answerHtml,similarQuestions:s,answerList:e.answerList||[],tagList:c,relatedFaqUids:e.relatedFaqUids||[],startDate:t,endDate:r,images:u,attachments:l});o(d)})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,xe.jsxs)(G.A,{form:d,submitter:{render:function(){return null}},children:[(0,xe.jsx)(G.A.Item,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],children:(0,xe.jsx)(le.Z,{treeData:function e(t){return(t||[]).filter((function(e){return e.key!==Y.zBg})).map((function(t){return i()(i()({},t),{},{children:t.children?e(t.children):void 0})}))}(L),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),X(e)},fieldNames:{label:"title",value:"key",children:"children"},treeCheckable:!1,variant:"outlined"})}),(0,xe.jsx)(_.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,xe.jsx)($.u,{name:"similarQuestions",label:(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,xe.jsx)("span",{children:"相似问法"}),(0,xe.jsxs)(F.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:["                ",(0,xe.jsx)(F.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:(0,xe.jsx)(E.ZP,{type:"primary",icon:(0,xe.jsx)(me.Z,{}),onClick:Rt,loading:It,size:"small",children:"智能生成"})})]})]}),creatorButtonProps:{creatorButtonText:"添加相似问法",icon:(0,xe.jsx)(M.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(W()(Qe),[""]);Ke(e),d.setFieldValue("similarQuestions",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var r=d.getFieldValue("similarQuestions")||[],a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):W()(Qe);Ke(a)},onAfterRemove:function(e,t){var n=d.getFieldValue("similarQuestions")||[],r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];Ke(r)},actionRender:function(e,t,n){return[(0,xe.jsx)(E.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=W()(Qe);r.splice(n,1),Ke(r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,s=a()(e,ye);return(0,xe.jsx)(_.Z,i()(i()({},s),{},{placeholder:"请输入相似问法",rules:[{required:!0,message:"请输入相似问法"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:Qe[t]||"",onChange:function(e){var n=W()(Qe);n[t]=e.target.value,Ke(n),d.setFieldValue(["similarQuestions",t],e.target.value)}}}),r)}}),(0,xe.jsx)(G.A.Item,{name:"answerHtml",label:"文本答案",children:(0,xe.jsx)(ve.Z,{value:j,toolbarKeys:(0,he.eD)(),style:{height:"200px",width:"600px"},maxLength:16383,onChange:function(e,t,n){console.log("Editor content changed: html",e),console.log("Editor content changed: markdown",t),console.log("Editor content changed: text",n),w(n),S(e),I(t),d.setFieldValue("answerHtml",e),_e||$e(!0)}})}),(0,xe.jsxs)(G.A.Item,{label:"图片",tooltip:"可以上传多张图片作为回复内容",children:[(0,xe.jsx)(ce.Z,i()(i()({},qt),{},{children:Ot})),(0,xe.jsx)(O.Z,{open:ct,title:xt,footer:null,onCancel:function(){return dt(!1)},children:(0,xe.jsx)(de.Z,{alt:"预览图片",style:{width:"100%"},src:gt})})]}),(0,xe.jsx)(G.A.Item,{label:"附件",tooltip:"可以上传多个附件作为回复内容",children:(0,xe.jsx)(ce.Z,i()(i()({},Dt),{},{children:(0,xe.jsx)(E.ZP,{icon:(0,xe.jsx)(M.Z,{}),children:"上传附件"})}))}),(0,xe.jsxs)(fe.Z,{orientation:"left",children:["扩展答案列表",(0,xe.jsx)(E.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,xe.jsx)($.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,xe.jsx)(M.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,r=e.action,a=t.index;return(0,xe.jsx)(pe.Z,{size:"small",style:{marginBottom:16},extra:r,children:n},a)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,xe.jsx)("div",{children:e})},children:(0,xe.jsxs)(ee.UW,{children:[(0,xe.jsx)(te.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,xe.jsx)(ne.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,xe.jsx)(re.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:qe,fieldProps:{placeholder:"请选择相关问题"}}),(0,xe.jsx)(G.A.Item,{label:"标签",children:(0,xe.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[Me.map((function(e){return(0,xe.jsx)(A.Z,{closable:!0,onClose:function(){return t=e,n=Me.filter((function(e){return e!==t})),void we(n);var t,n},children:e},e)})),je?(0,xe.jsx)(ge.Z,{ref:Ie,type:"text",size:"small",style:{width:78},value:Ue,onChange:function(e){Ae(e.target.value)},onBlur:Pt,onPressEnter:Pt}):(0,xe.jsxs)(A.Z,{onClick:function(){Se(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,xe.jsx)(M.Z,{})," 新标签"]})]})}),(0,xe.jsx)(ae.Z.Group,{name:"dateType",label:"有效期设置",options:[{label:"永久有效",value:"permanent"},{label:"自定义日期",value:"custom"}],fieldProps:{onChange:function(e){He(e.target.value),"permanent"===e.target.value&&d.setFieldValue("dateRange",void 0)},value:Ve}}),"custom"===Ve&&(0,xe.jsx)(se.Z,{name:"dateRange",label:"有效日期",rules:[{required:"custom"===Ve,message:"请选择有效日期范围"}],fieldProps:{style:{width:"100%"}}}),(0,xe.jsx)(ie.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:ze,onChange:function(e){Ye(e)}}})]})})})},we=n(85977),be=["current","pageSize"],ke=function(e){var t,n,r,s,o,l,d,p,V,K,W=e.superUser,G=(0,R.useIntl)(),_=(0,L.Z)().translateString,$=(0,R.useAccess)(),ee=(0,q.useRef)(),te=(0,q.useMemo)((function(){var e;return null==$||null===(e=$.getModulePermission)||void 0===e?void 0:e.call($,we.MY.FAQ)}),[$]),ne=(W||(t=null==te||null===(n=te.canRead)||void 0===n?void 0:n.call(te)),W||(r=null==te||null===(s=te.canCreate)||void 0===s?void 0:s.call(te)),W||(o=null==te||null===(l=te.canUpdate)||void 0===l?void 0:l.call(te)),W||(d=null==te||null===(p=te.canDelete)||void 0===p?void 0:p.call(te)),W||(V=null==te||null===(K=te.canExport)||void 0===K?void 0:K.call(te)),(0,q.useRef)(!1),(0,q.useState)(!0)),re=g()(ne,2),ae=re[0],se=re[1],ie=(0,q.useState)(),oe=g()(ie,2),ue=oe[0],le=oe[1],ce=(0,q.useState)(!1),de=g()(ce,2),fe=de[0],pe=de[1],ge=(0,q.useState)(1),me=g()(ge,2),he=me[0],ve=me[1],ye=(0,q.useState)(10),ke=g()(ye,2),je=ke[0],Se=ke[1],Ze=(0,v.u)((function(e){return e.currentOrg})),Ce=(0,z.j)((function(e){return e.currentKbase})),Ue=(0,D.v)((function(e){return e.currentCategory})),Ae=(0,D.v)((function(e){return e.categorySelectOptions})),Ie=(0,q.useState)(!1),Te=g()(Ie,2),Ee=Te[0],Pe=Te[1],Fe=(0,q.useState)([]),Oe=g()(Fe,2),qe=Oe[0],De=Oe[1],Re=(0,q.useState)([]),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,q.useState)(0),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,q.useState)(!1),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],We=(0,q.useState)(!1),Ge=g()(We,2),_e=Ge[0],$e=Ge[1],et=(0,q.useState)({}),tt=g()(et,2),nt=tt[0],rt=tt[1],at=function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,(0,h.Yg)(t);case 3:n=e.sent,console.log("delete response:",n),200===n.code?(null==ee||ee.current.reload(),m.yw.success(G.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(G.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),st=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ze.length){e.next=3;break}return m.yw.warning(G.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(G.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n=0,r=0,a=u()(ze),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=23;break}return i=s.value,e.prev=11,e.next=14,(0,h.Yg)(i);case 14:200===e.sent.code?n++:r++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),r++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:m.yw.destroy(),0===r?m.yw.success(G.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:n})):m.yw.warning(G.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:n,fail:r})),De([]),Ye([]),null===(t=ee.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),it=function(){var e=f()(c()().mark((function e(t){var n,r,a,s,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ze.length){e.next=3;break}return m.yw.warning(G.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 3:m.yw.loading(t?G.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):G.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),r=0,a=0,s=u()(ze),e.prev=7,s.s();case 9:if((i=s.n()).done){e.next=23;break}return o=i.value,e.prev=11,e.next=14,(0,h.kv)({uid:o.uid,enabled:t});case 14:200===e.sent.code?r++:a++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),a++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),s.e(e.t1);case 28:return e.prev=28,s.f(),e.finish(28);case 31:m.yw.destroy(),0===a?m.yw.success(t?G.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:r}):G.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:r})):m.yw.warning(t?G.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:r,fail:a}):G.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:r,fail:a})),De([]),Ye([]),null===(n=ee.current)||void 0===n||n.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(t){return e.apply(this,arguments)}}(),ot=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Ve){e.next=3;break}return m.yw.warning(G.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 3:return m.yw.loading(G.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=4,t={categoryUid:(null==Ue?void 0:Ue.uid)===Y.zBg?"":null==Ue?void 0:Ue.uid,kbUid:null==Ce?void 0:Ce.uid,orgUid:null==Ze?void 0:Ze.uid},e.next=8,(0,h.QB)(t);case 8:200===(n=e.sent).code?(m.yw.destroy(),m.yw.success(G.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(r=ee.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(n.message||G.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(G.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),ut=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0,tooltip:G.formatMessage({id:"faq.question.tooltip",defaultMessage:"常见问题的问题内容"})},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"similarQuestions",width:200,ellipsis:!0,search:!1,tooltip:G.formatMessage({id:"faq.similar.questions.tooltip",defaultMessage:"表达相同意思的其他问法"}),render:function(e,t){if(!t.similarQuestions||0===t.similarQuestions.length||1===t.similarQuestions.length&&""===t.similarQuestions[0])return"-";var n=t.similarQuestions.length>3,r=t.similarQuestions.slice(0,3),a=(0,xe.jsx)("div",{style:{maxWidth:300,maxHeight:300,overflow:"auto"},children:t.similarQuestions.map((function(e,t){return(0,xe.jsxs)("div",{style:{marginBottom:8},children:[(0,xe.jsx)(A.Z,{color:"blue",style:{marginRight:4},children:t+1}),e]},t)}))}),s=(0,xe.jsxs)("div",{children:[r.map((function(e,t){return(0,xe.jsx)(A.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),n&&(0,xe.jsxs)(A.Z,{color:"orange",children:["+",t.similarQuestions.length-3]})]});return(0,xe.jsx)(I.Z,{content:a,title:G.formatMessage({id:"faq.similar.questions",defaultMessage:"所有相似问法"}),placement:"right",trigger:"hover",children:s})}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,tooltip:G.formatMessage({id:"faq.answer.tooltip",defaultMessage:"常见问题的回答内容"})},{title:(0,xe.jsx)(R.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:G.formatMessage({id:"faq.status.tooltip",defaultMessage:"问题处理状态"}),render:function(e,t){var n=t.elasticStatus||"",r="";return"SUCCESS"===n?r="success":"ERROR"===n?r="error":"NEW"===n&&(r="processing"),(0,xe.jsx)(A.Z,{color:r,children:G.formatMessage({id:"llm.status.".concat(n.toLowerCase())})})}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:G.formatMessage({id:"faq.vectorStatus.tooltip",defaultMessage:"向量化处理状态"}),render:function(e,t){var n=t.vectorStatus||"",r="";return"SUCCESS"===n?r="success":"ERROR"===n?r="error":"NEW"===n?r="processing":"PROCESSING"===n&&(r="warning"),n?(0,xe.jsx)(A.Z,{color:r,icon:(0,xe.jsx)(x.Z,{}),children:G.formatMessage({id:"llm.vectorStatus.".concat((n||"").toLowerCase())})||n}):"-"}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0,tooltip:G.formatMessage({id:"faq.clickCount.tooltip",defaultMessage:"问题被点击的次数"})},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0,tooltip:G.formatMessage({id:"faq.upCount.tooltip",defaultMessage:"问题被点赞的次数"})},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0,tooltip:G.formatMessage({id:"faq.downCount.tooltip",defaultMessage:"问题被踩的次数"})},{title:(0,xe.jsx)(R.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:G.formatMessage({id:"faq.category.tooltip",defaultMessage:"问题所属的分类"}),render:function(e,t){var n=Ae.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,xe.jsx)(A.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:Ae.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.tags",defaultMessage:"标签"}),dataIndex:"tagList",width:150,hideInSearch:!0,tooltip:G.formatMessage({id:"faq.tags.tooltip",defaultMessage:"用于分类和搜索的标签"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,xe.jsxs)("div",{children:[r.map((function(e,t){return(0,xe.jsx)(A.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,xe.jsxs)(A.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:G.formatMessage({id:"faq.isValid.tooltip",defaultMessage:"问题是否有效可用"}),valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:G.formatMessage({id:"faq.startDate.tooltip",defaultMessage:"问题生效的开始时间"}),render:function(e,t){return t.startDate?H()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:G.formatMessage({id:"faq.endDate.tooltip",defaultMessage:"问题失效的结束时间"}),render:function(e,t){return t.endDate?H()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:G.formatMessage({id:"faq.createdAt.tooltip",defaultMessage:"问题创建的时间"}),render:function(e,t){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,xe.jsx)(R.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:G.formatMessage({id:"faq.updatedAt.tooltip",defaultMessage:"问题最后更新的时间"}),render:function(e,t){return t.updatedAt?H()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:G.formatMessage({id:"actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,n,r){return[(0,xe.jsx)("a",{onClick:function(){!function(e){console.log("showEditDrawer",e),le(e),se(!0),pe(!0)}(t)},children:G.formatMessage({id:"edit"})},"editable"),(0,xe.jsx)(T.Z,{title:G.formatMessage({id:"deleteTip"}),description:"".concat(G.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.question,"】？"),onConfirm:function(){return at(t)},okText:G.formatMessage({id:"ok"}),cancelText:G.formatMessage({id:"cancel"}),children:(0,xe.jsx)(E.ZP,{size:"small",type:"link",danger:!0,children:G.formatMessage({id:"delete"})})},"delete"),(0,xe.jsx)(P.Z,{menu:{items:[{key:"updateIndex",label:G.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return lt(t)}},{key:"updateVectorIndex",label:G.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return ct(t)}}]},placement:"bottomRight",children:(0,xe.jsx)(F.Z,{title:G.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,xe.jsxs)(E.ZP,{size:"small",type:"link",children:[G.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,xe.jsx)(y.Z,{})]})})},"indexOperations")]}}],lt=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(G.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=1,e.next=4,(0,h.RF)({uid:t.uid});case 4:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(G.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(r=ee.current)||void 0===r||r.reload()):m.yw.error(n.message||G.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(G.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ct=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(G.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=1,e.next=4,(0,h.YO)({uid:t.uid});case 4:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(G.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(r=ee.current)||void 0===r||r.reload()):m.yw.error(n.message||G.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(G.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),dt=function(){Qe?_e?m.yw.info("正在检查模型状态，请稍后再试"):(le(void 0),se(!1),pe(!0)):O.Z.confirm({title:G.formatMessage({id:"warning",defaultMessage:"警告"}),content:G.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:G.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:G.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){le(void 0),se(!1),pe(!0)}})},ft=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),ae?m.yw.loading(G.formatMessage({id:"updating"})):m.yw.loading(G.formatMessage({id:"creating"})),!ae){e.next=8;break}return e.next=5,(0,h.y)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,h.kh)(t);case 10:e.t0=e.sent;case 11:n=e.t0,console.log("createFaq response:",t,n),200===n.code?(m.yw.destroy(),m.yw.success(G.formatMessage({id:"create.success",defaultMessage:"create success"})),pe(!1),null===(r=ee.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(n.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qe){e.next=3;break}return O.Z.confirm({title:G.formatMessage({id:"warning",defaultMessage:"警告"}),content:G.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:G.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:G.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){Pe(!0)}}),e.abrupt("return");case 3:if(!_e){e.next=6;break}return m.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 6:Pe(!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,q.useEffect)((function(){var e;null===(e=ee.current)||void 0===e||e.reloadAndRest()}),[Ce,Ue]);var gt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.HK)(Y.QPQ,null==Ze?void 0:Ze.uid,null==Ce?void 0:Ce.uid,Y.whQ,{showLoading:!0,loadingMessage:G.formatMessage({id:"loading"}),errorMessage:G.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),mt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ze.length){e.next=3;break}return m.yw.warning(G.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(G.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n=0,r=0,a=u()(ze),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=23;break}return i=s.value,e.prev=11,e.next=14,(0,h.RF)({uid:i.uid});case 14:200===e.sent.code?n++:r++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),r++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:m.yw.destroy(),0===r?m.yw.success(G.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的索引")})):m.yw.error(G.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的索引，").concat(r," 条记录更新失败")})),null===(t=ee.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ht=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ze.length){e.next=3;break}return m.yw.warning(G.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 3:m.yw.loading(G.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n=0,r=0,a=u()(ze),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=23;break}return i=s.value,e.prev=11,e.next=14,(0,h.YO)({uid:i.uid});case 14:200===e.sent.code?n++:r++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),r++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:m.yw.destroy(),0===r?m.yw.success(G.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的向量索引")})):m.yw.error(G.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的向量索引，").concat(r," 条记录更新失败")})),null===(t=ee.current)||void 0===t||t.reload();case 34:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),vt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.Z.confirm({title:G.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:G.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(G.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,(0,h.L0)({kbUid:null==Ce?void 0:Ce.uid,categoryUid:(null==Ue?void 0:Ue.uid)===Y.zBg?"":null==Ue?void 0:Ue.uid,orgUid:null==Ze?void 0:Ze.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(G.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(n=ee.current)||void 0===n||n.reload()):m.yw.error(t.message||G.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(G.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.Z.confirm({title:G.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:G.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(G.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,(0,h.Bv)({kbUid:null==Ce?void 0:Ce.uid,categoryUid:(null==Ue?void 0:Ue.uid)===Y.zBg?"":null==Ue?void 0:Ue.uid,orgUid:null==Ze?void 0:Ze.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(G.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(n=ee.current)||void 0===n||n.reload()):m.yw.error(t.message||G.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(G.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),yt=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(Y.LA8),s=i()({categoryUid:(null==Ue?void 0:Ue.uid)===Y.zBg?"":null==Ue?void 0:Ue.uid,kbUid:null==Ce?void 0:Ce.uid,orgUid:(null==Ze?void 0:Ze.uid)||"",accessToken:a||"",exportType:t},nt),"current"===t?(s.pageNumber=String(he-1),s.pageSize=String(je)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,N.kG)()+"/api/v1/faq/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Mt={selectedRowKeys:qe,onChange:function(e,t){De(e),Ye(t)}},wt=function(){var e=f()(c()().mark((function e(t,n,r){var s,o,u,l,d,f,p,g,v,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(G.formatMessage({id:"loading",defaultMessage:"Loading"})),s=t.current,o=t.pageSize,u=a()(t,be),ve(s),Se(o),rt(u),l=void 0,d=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],l=f,d="ascend"===n[f]?"ascend":"descend"),p=W?void 0:(null==Ue?void 0:Ue.uid)===Y.zBg?"":null==Ue?void 0:Ue.uid,g=W||null==Ce?void 0:Ce.uid,v=i()(i()({pageNumber:s-1,pageSize:o,categoryUid:p,kbUid:g,orgUid:null==Ze?void 0:Ze.uid,superUser:W},u),{},{sortBy:l,sortDirection:d}),e.next=13,(0,h.pf)(v);case 13:return x=e.sent,console.log("queryFaqsByOrg response:",v,x),m.yw.destroy(),200===x.code?He(null==x?void 0:x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:null==x?void 0:x.data.content,success:!0,total:null==x?void 0:x.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),bt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return yt("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Q.Z,{onModelStatusChange:function(e){Ke(e),$e(!1)}}),(0,xe.jsx)(U.Z,{columns:ut,actionRef:ee,cardBordered:!0,rowSelection:Mt,request:wt,scroll:{x:2300},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){ve(e),Se(t)}},dateFormatter:"string",headerTitle:_(null==Ce?void 0:Ce.name)+" - 常见问题",tooltip:_e?"正在检查嵌入式模型...":Qe?"所添加FAQ内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return W?[]:function(){var e=[];(0,N.Ox)()||e.push((0,xe.jsx)(E.ZP,{icon:(0,xe.jsx)(M.Z,{}),type:"primary",onClick:dt,disabled:_e,children:G.formatMessage({id:"create"})},"create"),(0,xe.jsx)(F.Z,{title:G.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,xe.jsx)(X.Z,{currentKbase:Ce,currentOrg:Ze,embeddingModelExists:Qe,checkingEmbeddingModel:_e})},"chat"));var t=[];qe.length>0&&t.push({key:"batchDelete",icon:(0,xe.jsx)(w.Z,{}),danger:!0,label:G.formatMessage({id:"batch.delete"})+" (".concat(qe.length,")"),onClick:function(){O.Z.confirm({title:G.formatMessage({id:"batch.deleteTip"}),content:"".concat(G.formatMessage({id:"batch.deleteAffirm"})," ").concat(qe.length," ").concat(G.formatMessage({id:"items"}),"?"),onOk:st,okText:G.formatMessage({id:"ok"}),cancelText:G.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,xe.jsx)(b.Z,{}),label:G.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(qe.length,")"),onClick:function(){return it(!0)}},{key:"batchDisable",icon:(0,xe.jsx)(k.Z,{}),label:G.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(qe.length,")"),onClick:function(){return it(!1)}},{key:"batchUpdateIndex",icon:(0,xe.jsx)(x.Z,{}),label:G.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(qe.length,")"),onClick:mt},{key:"batchUpdateVectorIndex",icon:(0,xe.jsx)(x.Z,{}),label:G.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(qe.length,")"),onClick:ht}),t.push({key:"deleteAll",icon:(0,xe.jsx)(j.Z,{}),danger:!0,label:G.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){O.Z.confirm({title:G.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:G.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:ot,okText:G.formatMessage({id:"ok"}),cancelText:G.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,xe.jsx)(x.Z,{}),label:G.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:vt},{key:"updateAllVectorIndex",icon:(0,xe.jsx)(x.Z,{}),label:G.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:xt});var n=[{key:"import",icon:(0,xe.jsx)(S.Z,{}),label:G.formatMessage({id:"import"}),onClick:pt,disabled:_e},{key:"export-current",icon:(0,xe.jsx)(Z.Z,{}),label:G.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return yt("current")}}];return Ve>0&&(Ve<=1e3?n.push({key:"export-all",icon:(0,xe.jsx)(Z.Z,{}),label:G.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ve,"条)"),onClick:function(){return yt("all")}}):n.push({key:"export-range",icon:(0,xe.jsx)(Z.Z,{}),label:G.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ve,"条)"),children:bt(Ve)})),n.push({key:"download",icon:(0,xe.jsx)(C.Z,{}),label:G.formatMessage({id:"download.template"}),onClick:function(){return(0,N.IY)()}}),e.push((0,xe.jsx)(P.Z,{menu:{items:n},placement:"bottom",children:(0,xe.jsxs)(E.ZP,{type:"primary",children:[G.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,xe.jsx)(y.Z,{})]})},"importExport")),t.length>0&&e.push((0,xe.jsx)(P.Z,{menu:{items:t},placement:"bottom",children:(0,xe.jsxs)(E.ZP,{type:qe.length>0?"primary":"default",danger:qe.length>0,children:[qe.length>0?G.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(qe.length,")"):G.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,xe.jsx)(y.Z,{})]})},"batchOperations")),e}()}}),(0,xe.jsx)(Me,{isEdit:ae,open:fe,faq:ue,onClose:function(){return pe(!1)},onSubmit:ft}),Ee&&(0,xe.jsx)(B.Z,{type:Y.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:Ee,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Pe(!1),null==ee||ee.current.reload(),gt()},handleCancel:function(){console.log("handleUploadDragCancel"),Pe(!1),null==ee||ee.current.reload()}})]})}},5071:function(e,t,n){n.d(t,{Z:function(){return we}});var r=n(84176),a=n.n(r),s=n(73193),i=n.n(s),o=n(86222),u=n.n(o),l=n(90819),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(94976),v=n(4628);function x(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/file/query/org",{method:"GET",params:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/file/update",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/file/delete",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/file/delete/all",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/file/rechunk",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=n(33533),A=n(1715),I=n(8732),T=n(74171),E=n(14447),P=n(71529),F=n(92110),O=n(59304),q=n(21407),D=n(54881),R=n(10162),L=n(58275),z=n(11090),Y=n(2484),B=n(44565),N=n(27729),V=n(82878),H=n(90581),J=n(92351),X=n(69533),Q=n(43275),K=n(28508),W=n(44194),G=n(96596),_=n.n(G),$=n(54974),ee=n(88722),te=n(58620),ne=n(78069),re=n(52489),ae=n(35589),se=n(76711),ie=n.n(se),oe=n(99036),ue=n(59005),le=n(86702),ce=n(60241),de=n(82404),fe=n(30857),pe=n(30310),ge=n(1282),me=n(55785),he=n(14377),ve=n(31549),xe=function(e){var t=e.isEdit,n=void 0===t||t,r=e.file,a=e.open,s=e.onClose,o=e.onSubmit,u=oe.A.useForm(),l=g()(u,1)[0],d=(0,I.j)((function(e){return e.currentKbase})),p=(0,T.u)((function(e){return e.currentOrg})),m=(0,A.v)((function(e){return e.categorySelectOptions})),h=(0,W.useState)(),v=g()(h,2),x=v[0],y=v[1],M=(0,W.useState)([]),w=g()(M,2),b=w[0],k=w[1],j=(0,W.useState)(!1),S=g()(j,2),Z=S[0],C=S[1],U=(0,W.useState)(""),E=g()(U,2),P=E[0],F=E[1],O=(0,W.useState)(!1),q=g()(O,2),D=q[0],L=q[1],z=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},Y=function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,L(!0),e.next=4,l.validateFields();case 4:t=e.sent,n=i()(i()(i()({},r),t),{},{categoryUid:x,tagList:z(b),kbUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid}),console.log("submit",n),o(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),de.ZP.error("请检查表单填写是否正确");case 14:return e.prev=14,L(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=P.trim();e&&!b.includes(e)&&k([].concat(ie()(b),[e])),C(!1),F("")},N=function(){C(!1),F("")};return(0,W.useEffect)((function(){if(n)l.setFieldsValue({uid:null==r?void 0:r.uid,fileName:null==r?void 0:r.fileName,content:null==r?void 0:r.content,categoryUid:null==r?void 0:r.categoryUid,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled}),y(null==r?void 0:r.categoryUid),k(z((null==r?void 0:r.tagList)||[]));else{if(l.setFieldsValue({fileName:"",content:"",enabled:!0}),m&&m.length>0){var e=m[0].value;l.setFieldValue("categoryUid",e),y(e)}k([]),C(!1),F("")}}),[n,r,l,m]),(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsx)(fe.Z,{title:n?"编辑文件":"添加文件",onClose:s,open:a,width:600,extra:(0,ve.jsxs)(pe.Z,{children:[(0,ve.jsx)(X.ZP,{onClick:s,children:"取消"}),(0,ve.jsx)(X.ZP,{type:"primary",onClick:Y,loading:D,children:"提交"})]}),footer:null,children:(0,ve.jsxs)(oe.A,{form:l,name:"fileForm",submitter:!1,children:[(0,ve.jsx)(ue.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:m,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("file category selected ".concat(e)),y(e)}}}),(0,ve.jsx)(le.Z,{label:"文件名称",name:"fileName",rules:[{required:!0,message:"请输入文件名称"}],placeholder:"请输入文件名称"}),(0,ve.jsx)(ce.Z,{label:"文件内容",name:"content",rules:[{required:!0,message:"请输入文件内容"}],placeholder:"请输入文件内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"文件的文本内容，用于知识库检索"}),(0,ve.jsx)(oe.A.Item,{label:"标签",name:"tagList",tooltip:"为文件添加标签，便于分类和检索",children:(0,ve.jsxs)("div",{style:{minHeight:"32px"},children:[(0,ve.jsx)(pe.Z,{wrap:!0,style:{marginBottom:8},children:z(b).map((function(e,t){return(0,ve.jsx)(H.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void k(z(b.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),Z?(0,ve.jsxs)(pe.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)(ge.Z,{value:P,onChange:function(e){F(e.target.value)},onKeyDown:function(e){"Enter"===e.key?B():"Escape"===e.key&&N()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,ve.jsx)(X.ZP,{type:"primary",size:"small",icon:(0,ve.jsx)(me.Z,{}),onClick:B,disabled:!P.trim(),children:"保存"}),(0,ve.jsx)(X.ZP,{size:"small",icon:(0,ve.jsx)(he.Z,{}),onClick:N,children:"取消"})]}):(0,ve.jsx)(X.ZP,{type:"dashed",onClick:function(){C(!0),F("")},icon:(0,ve.jsx)(R.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),!1]})})})},ye=n(85977),Me=["current","pageSize"],we=function(e){var t,n,r,s,o,l,d,p,y,w,k=e.superUser,S=(0,v.useIntl)(),C=(0,v.useAccess)(),G=(0,W.useRef)(),se=(0,ee.Z)().translateString,ie=(0,W.useState)(1),oe=g()(ie,2),ue=oe[0],le=oe[1],ce=(0,W.useState)(10),de=g()(ce,2),fe=de[0],pe=de[1],ge=(0,T.u)((function(e){return e.currentOrg})),me=(0,I.j)((function(e){return e.currentKbase})),he=(0,A.v)((function(e){return e.currentCategory})),we=(0,A.v)((function(e){return e.categorySelectOptions})),be=(0,W.useState)(!1),ke=g()(be,2),je=ke[0],Se=ke[1],Ze=(0,W.useState)(!1),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=(0,W.useState)([]),Te=g()(Ie,2),Ee=Te[0],Pe=Te[1],Fe=(0,W.useState)([]),Oe=g()(Fe,2),qe=Oe[0],De=Oe[1],Re=(0,W.useState)(!1),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,W.useState)(!1),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,W.useState)({}),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],We=(0,W.useState)(0),Ge=g()(We,2),_e=Ge[0],$e=Ge[1],et=N.Z.useModal(),tt=g()(et,2),nt=tt[0],rt=tt[1],at=(0,W.useState)(!1),st=g()(at,2),it=st[0],ot=st[1],ut=(0,W.useState)(void 0),lt=g()(ut,2),ct=lt[0],dt=lt[1],ft=(0,W.useMemo)((function(){var e;return null==C||null===(e=C.getModulePermission)||void 0===e?void 0:e.call(C,ye.MY.FILE)}),[C]),pt=k||null!==(t=null==ft||null===(n=ft.canRead)||void 0===n?void 0:n.call(ft))&&void 0!==t&&t,gt=k||null!==(r=null==ft||null===(s=ft.canCreate)||void 0===s?void 0:s.call(ft))&&void 0!==r&&r,mt=k||null!==(o=null==ft||null===(l=ft.canUpdate)||void 0===l?void 0:l.call(ft))&&void 0!==o&&o,ht=k||null!==(d=null==ft||null===(p=ft.canDelete)||void 0===p?void 0:p.call(ft))&&void 0!==d&&d,vt=k||null!==(y=null==ft||null===(w=ft.canExport)||void 0===w?void 0:w.call(ft))&&void 0!==y&&y,xt=(0,W.useRef)(!1),yt=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},Mt=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ht){e.next=3;break}return yt("file.permission.delete.denied","无权限：删除文件"),e.abrupt("return");case 3:return e.next=5,b(t);case 5:200===e.sent.code?(null==G||G.current.reload(),m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(S.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),wt=function(){var e=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mt){e.next=3;break}return yt("file.permission.update.denied","无权限：编辑文件"),e.abrupt("return");case 3:return console.log("handleFileDrawerSubmit",t),m.yw.success(S.formatMessage({id:"update.success",defaultMessage:"更新成功"})),ot(!1),dt(void 0),e.next=9,M(t);case 9:200===e.sent.code?(null==G||G.current.reload(),m.yw.success(S.formatMessage({id:"update.success",defaultMessage:"更新成功"}))):m.yw.error(S.formatMessage({id:"update.error",defaultMessage:"更新失败"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt=function(){var e=f()(c()().mark((function e(t){var n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mt){e.next=3;break}return yt("file.permission.update.denied","无权限：重新切块"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"rechunking",defaultMessage:"正在重新切块..."})),e.prev=4,n={uid:t.uid},e.next=8,Z(n);case 8:r=e.sent,console.log("rechunk response",r,n),m.yw.destroy(),200===r.code?(m.yw.success(S.formatMessage({id:"rechunk.success",defaultMessage:"重新切块成功"})),null===(a=G.current)||void 0===a||a.reload()):m.yw.error(r.message||S.formatMessage({id:"rechunk.failed",defaultMessage:"重新切块失败"})),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"rechunk.error",defaultMessage:"重新切块过程发生错误"})),console.error("重新切块错误:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),kt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ve.jsx)(v.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",ellipsis:!0,copyable:!0,fixed:"left",tooltip:S.formatMessage({id:"llm.file.fileName.tooltip"}),render:function(e,t,n,r){var a,s,i=null==t?void 0:t.fileName;null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")&&(i=null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)("span",{style:{marginRight:4},children:i}),(0,ve.jsx)(V.Z.Text,{copyable:{text:(null==t?void 0:t.fileName)||""}})]})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"fileUrl",defaultMessage:"File URL"}),dataIndex:"fileUrl",ellipsis:!0,hideInSearch:!0,tooltip:S.formatMessage({id:"llm.file.fileUrl.tooltip"}),render:function(e,t){return t.fileUrl?(0,ve.jsxs)("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,ve.jsx)(P.Z,{})," ",S.formatMessage({id:"view.file"})]}):"-"}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,tooltip:S.formatMessage({id:"llm.file.tags.tooltip"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(F.Z,{})," ",null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,ve.jsx)(H.Z,{children:e},e)}))]}):"-"}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:S.formatMessage({id:"enabled"}),status:"Success"},false:{text:S.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,tooltip:S.formatMessage({id:"llm.file.enabled.tooltip"})},{title:(0,ve.jsx)(v.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",ellipsis:!0,hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"llm.file.category.tooltip"}),render:function(e,t){var n=we.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,ve.jsx)(H.Z,{color:"blue",children:n.label}):(0,ve.jsx)(H.Z,{color:"default",children:"未分类"})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:S.formatMessage({id:"llm.file.createdAt.tooltip"}),render:function(e,t){return _()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:S.formatMessage({id:"llm.file.updatedAt.tooltip"}),render:function(e,t){return t.updatedAt?_()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),key:"option",valueType:"option",width:140,fixed:"right",render:function(e,t){return[(0,ve.jsx)(J.Z,{title:S.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,ve.jsx)(X.ZP,{type:"text",size:"small",icon:(0,ve.jsx)(O.Z,{}),onClick:function(){return function(e){mt?(dt(e),ot(!0)):yt("file.permission.update.denied","无权限：编辑文件")}(t)}})},"edit"),(0,ve.jsx)(J.Z,{title:S.formatMessage({id:"rechunk",defaultMessage:"重新切块"}),children:(0,ve.jsx)(X.ZP,{type:"text",size:"small",icon:(0,ve.jsx)(q.Z,{}),onClick:function(){return bt(t)}})},"rechunk"),(0,ve.jsx)(Q.Z,{title:S.formatMessage({id:"deleteTip"}),description:"".concat(S.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.fileName,"】？"),onConfirm:function(){return Mt(t)},okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),children:(0,ve.jsx)(J.Z,{title:S.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,ve.jsx)(X.ZP,{type:"text",size:"small",icon:(0,ve.jsx)(D.Z,{}),danger:!0})})},"delete")]}}],jt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ht){e.next=3;break}return yt("file.permission.delete.denied","无权限：批量删除文件"),e.abrupt("return");case 3:if(0!==qe.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n=0,r=0,a=u()(qe),e.prev=10,a.s();case 12:if((s=a.n()).done){e.next=26;break}return i=s.value,e.prev=14,e.next=17,b(i);case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),a.e(e.t1);case 31:return e.prev=31,a.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:n})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:n,fail:r})),Pe([]),De([]),null===(t=G.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),St=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vt){e.next=3;break}return yt("file.permission.export.denied","无权限：导出文件"),e.abrupt("return");case 3:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=i()({categoryUid:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,kbUid:null==me?void 0:me.uid,orgUid:(null==ge?void 0:ge.uid)||"",accessToken:a||"",exportType:t},Qe),"current"===t?(s.pageNumber=ue-1,s.pageSize=fe):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,te.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Zt=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ht){e.next=3;break}return yt("file.permission.delete.denied","无权限：删除所有文件"),e.abrupt("return");case 3:if(0!==_e){e.next=6;break}return m.yw.warning(S.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 6:return m.yw.loading(S.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=7,t={categoryUid:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,kbUid:null==me?void 0:me.uid,orgUid:null==ge?void 0:ge.uid},e.next=11,j(t);case 11:n=e.sent,console.log("handleDeleteAllConfirm response:",n,t),200===n.code?(m.yw.destroy(),m.yw.success(S.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(r=G.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(n.message||S.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(7),m.yw.destroy(),m.yw.error(S.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(){return e.apply(this,arguments)}}(),Ct=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return St("range",r,n)}})},s=0;s<r;s++)a();return t};(0,W.useEffect)((function(){var e;null==G||null===(e=G.current)||void 0===e||e.reload()}),[me,he]),(0,W.useEffect)((function(){return E.Z.on(h.YwV,(function(e){var t;null==G||null===(t=G.current)||void 0===t||t.reload()})),function(){E.Z.off(h.YwV)}}),[]);var Ut=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ne.HK)(h.QPQ,null==ge?void 0:ge.uid,null==me?void 0:me.uid,h.whQ,{showLoading:!0,loadingMessage:S.formatMessage({id:"loading"}),errorMessage:S.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(re.Z,{onModelStatusChange:function(e){Ye(e),He(!1)}}),(0,ve.jsx)(B.Z,{columns:kt,actionRef:G,cardBordered:!0,rowSelection:ht?{selectedRowKeys:Ee,onChange:function(e,t){Pe(e),De(t)}}:void 0,scroll:{x:1800},request:function(){var e=f()(c()().mark((function e(t,n,r){var s,o,u,l,d,f,p,g,v,y;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pt){e.next=3;break}return xt.current||(xt.current=!0,yt("file.permission.read.denied","无权限：查看文件")),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=t.current,o=t.pageSize,u=a()(t,Me),le(s),pe(o),Ke(u),l=void 0,d=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],l=f,d="ascend"===n[f]?"ascend":"descend"),p=k?void 0:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,g=k||null==me?void 0:me.uid,v=i()(i()({pageNumber:s-1,pageSize:o,categoryUid:p,kbUid:g,orgUid:null==ge?void 0:ge.uid,superUser:k},u),{},{sortBy:l,sortDirection:d}),e.next=15,x(v);case 15:return 200===(y=e.sent).code?(console.log("queryFilesByOrg response:",v,y),$e(null==y?void 0:y.data.totalElements)):m.yw.error(y.message),e.abrupt("return",{data:null==y?void 0:y.data.content,success:!0,total:null==y?void 0:y.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){le(e),pe(t)}},dateFormatter:"string",headerTitle:se(null==me?void 0:me.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:k?function(){return[]}:function(){var e=[];gt&&e.push((0,ve.jsx)(X.ZP,{icon:(0,ve.jsx)(R.Z,{}),type:"primary",onClick:function(){return(0,re.w)((function(){return Se(!0)}),ze,Ve)},disabled:Ve||!ze,children:S.formatMessage({id:"upload",defaultMessage:"File"})},"upload")),pt&&e.push((0,ve.jsx)(ae.Z,{currentKbase:me,currentOrg:ge,embeddingModelExists:ze,checkingEmbeddingModel:Ve||!ze},"chat"));var t=[];if(ht&&Ee.length>0&&t.push({key:"batchDelete",icon:(0,ve.jsx)(D.Z,{}),danger:!0,label:S.formatMessage({id:"batch.delete"})+" (".concat(Ee.length,")"),onClick:function(){nt.confirm({title:S.formatMessage({id:"batch.deleteTip"}),content:"".concat(S.formatMessage({id:"batch.deleteAffirm"})," ").concat(Ee.length," ").concat(S.formatMessage({id:"items"}),"?"),onOk:jt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})}}),ht&&t.push({key:"deleteAll",icon:(0,ve.jsx)(L.Z,{}),danger:!0,label:S.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){nt.confirm({title:S.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:S.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文件数据吗？此操作不可恢复!"}),onOk:Zt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})}}),vt){var n=[{key:"export-current",icon:(0,ve.jsx)(z.Z,{}),label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return St("current")}}];_e>0&&(_e<=1e3?n.push({key:"export-all",icon:(0,ve.jsx)(z.Z,{}),label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_e,"条)"),onClick:function(){return St("all")}}):n.push({key:"export-range",icon:(0,ve.jsx)(z.Z,{}),label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_e,"条)"),children:Ct(_e)})),e.push((0,ve.jsx)(K.Z,{menu:{items:n},placement:"bottom",children:(0,ve.jsxs)(X.ZP,{type:"primary",children:[S.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,ve.jsx)(Y.Z,{})]})},"exportDropdown"))}return t.length>0&&e.push((0,ve.jsx)(K.Z,{menu:{items:t},placement:"bottom",children:(0,ve.jsxs)(X.ZP,{type:Ee.length>0?"primary":"default",danger:Ee.length>0,children:[Ee.length>0?S.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Ee.length,")"):S.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ve.jsx)(Y.Z,{})]})},"batchOperations")),e}}),je&&(0,ve.jsx)($.Z,{type:h.n1c,acceptType:"*",isModalOpen:je,handleSubmit:function(e){Se(!1),null==G||G.current.reload(),Ut()},handleCancel:function(){Se(!1),null==G||G.current.reload()}}),Ue&&(0,ve.jsx)(U.Z,{type:h.ACv,open:Ue,onClose:function(){return Ae(!1)}}),it&&(0,ve.jsx)(xe,{file:ct,open:it,onClose:function(){ot(!1),dt(void 0)},onSubmit:wt}),rt]})}},29100:function(e,t,n){n.d(t,{Z:function(){return Fe}});var r=n(84176),a=n.n(r),s=n(73193),i=n.n(s),o=n(86222),u=n.n(o),l=n(90819),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(94976),v=n(4628);function x(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/query/org",{method:"GET",params:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/create",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/update",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/delete",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/deleteAll",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/updateIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/updateVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/updateAllIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return(O=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/updateAllVectorIndex",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return D.apply(this,arguments)}function D(){return D=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return(L=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/text/enable",{method:"POST",data:i()(i()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=n(74171),Y=n(77274),B=n(15722),N=n(2484),V=n(10162),H=n(54881),J=n(93689),X=n(40439),Q=n(58275),K=n(30617),W=n(11090),G=n(61107),_=n(44565),$=n(27729),ee=n(90581),te=n(69533),ne=n(28508),re=n(92351),ae=n(44194),se=n(96596),ie=n.n(se),oe=n(76711),ue=n.n(oe),le=n(84553),ce=n(1715),de=n(8732),fe=n(58087),pe=n(55785),ge=n(99036),me=n(38106),he=n(86702),ve=n(60241),xe=n(30857),ye=n(30310),Me=n(1282),we=n(82878),be=n(83281),ke=n(14377),je=n(31549),Se=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,s=e.onSubmit,o=ge.A.useForm(),l=g()(o,1)[0],d=(0,ae.useState)(""),p=g()(d,2),v=(p[0],p[1]),x=(0,z.u)((function(e){return e.currentOrg})),y=(0,ce.v)((function(e){return e.categorySelectOptions})),M=(0,ce.v)((function(e){return e.categoryTreeOptions})),w=(0,ae.useState)(),b=g()(w,2),k=b[0],j=b[1],S=(0,de.j)((function(e){return e.currentKbase})),Z=(0,ae.useState)([]),C=g()(Z,2),U=C[0],A=C[1],I=(0,ae.useState)(!1),T=g()(I,2),E=T[0],P=T[1],F=(0,ae.useState)(""),O=g()(F,2),D=O[0],R=O[1],L=(0,ae.useState)([]),Y=g()(L,2),B=Y[0],N=Y[1],H=(0,ae.useState)(!1),J=g()(H,2),X=J[0],Q=J[1],K=(0,ae.useState)(new Set),W=g()(K,2),G=W[0],_=W[1],$=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ne=function(){var e=f()(c()().mark((function e(){var t,n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.getFieldValue("title"),n=l.getFieldValue("content"),t&&n){e.next=5;break}return m.yw.warning("请先填写标题和内容"),e.abrupt("return");case 5:return Q(!0),e.prev=6,r={title:t,content:n,orgUid:null==x?void 0:x.uid},e.next=10,q(r);case 10:a=e.sent,console.log("生成常见问题返回:",null==a?void 0:a.data,r),200===a.code?(m.yw.success("常见问题生成成功"),N(null==a?void 0:a.data),_(new Set)):(N([]),m.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),m.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,Q(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}();(0,ae.useEffect)((function(){if(r){if(t)l.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid}),v((null==n?void 0:n.content)||""),j(null==n?void 0:n.categoryUid),A($((null==n?void 0:n.tagList)||[]));else{l.resetFields();var e=function e(t){var n,r=u()(t||[]);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.key!==h.zBg)return a.key;var s=e(a.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(M||[]);if(e)l.setFieldValue("categoryUid",e),j(e);else if(y&&y.length>0){var a=y[0].value;l.setFieldValue("categoryUid",a),j(a)}A([]),P(!1),R("")}N([]),_(new Set)}}),[r,t,n,l,y,M]);var se=function(){var e=D.trim();if(e&&!U.includes(e)){var t=$([].concat(ue()(U),[e]));A(t)}P(!1),R("")},ie=function(){P(!1),R("")},oe=function(){var e=f()(c()().mark((function e(t,n){var r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!G.has(n)){e.next=4;break}return m.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=i()(i()({},t),{},{categoryUid:k||l.getFieldValue("categoryUid"),kbUid:null==S?void 0:S.uid,orgUid:null==x?void 0:x.uid,type:"TEXT"}),m.yw.loading("正在保存常见问题..."),e.next=8,(0,le.kh)(r);case 8:200===(a=e.sent).code?((s=new Set(G)).add(n),_(s),m.yw.success("常见问题保存成功")):m.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),m.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(xe.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,je.jsxs)(ye.Z,{children:[(0,je.jsx)(te.ZP,{onClick:a,children:"取消"}),(0,je.jsx)(te.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){var t=i()(i()({},e),{},{categoryUid:k,tagList:$(U),kbUid:null==S?void 0:S.uid,orgUid:null==x?void 0:x.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"}),(0,je.jsx)(te.ZP,{onClick:ne,type:"default",loading:X,icon:(0,je.jsx)(fe.Z,{}),children:"智能生成常见问题"})]}),children:(0,je.jsxs)(ge.A,{form:l,submitter:{render:function(){return null}},children:[(0,je.jsx)(me.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==h.zBg})).map((function(t){return i()(i()({},t),{},{children:e(t.children)})}))}(M||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("category selected ".concat(e)),j(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,je.jsx)(he.Z,{label:"标题",name:"title",rules:[{required:!0}]}),(0,je.jsx)(ge.A.Item,{label:"标签",name:"tagList",tooltip:"为文本添加标签，便于分类和检索",children:(0,je.jsxs)("div",{style:{minHeight:"32px"},children:[(0,je.jsx)(ye.Z,{wrap:!0,style:{marginBottom:8},children:$(U).map((function(e,t){return(0,je.jsx)(ee.Z,{closable:!0,color:"blue",onClose:function(){return t=e,n=$(U.filter((function(e){return e!==t}))),void A(n);var t,n},style:{marginBottom:4},children:e},t)}))}),E?(0,je.jsxs)(ye.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,je.jsx)(Me.Z,{value:D,onChange:function(e){R(e.target.value)},onKeyDown:function(e){"Enter"===e.key?se():"Escape"===e.key&&ie()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,je.jsx)(te.ZP,{type:"primary",size:"small",icon:(0,je.jsx)(pe.Z,{}),onClick:se,disabled:!D.trim(),children:"保存"}),(0,je.jsx)(te.ZP,{size:"small",icon:(0,je.jsx)(ke.Z,{}),onClick:ie,children:"取消"})]}):(0,je.jsx)(te.ZP,{type:"dashed",onClick:function(){P(!0),R("")},icon:(0,je.jsx)(V.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,je.jsx)(ve.Z,{label:"内容",name:"content",rules:[{required:!0}]}),B.length>0&&(0,je.jsxs)("div",{style:{marginTop:16},children:[(0,je.jsx)(we.Z.Title,{level:5,children:"常见问题列表"}),(0,je.jsx)(be.Z,{bordered:!0,dataSource:B,renderItem:function(e,t){return(0,je.jsx)(be.Z.Item,{actions:[(0,je.jsx)(re.Z,{title:G.has(t)?"已保存":"保存到常见问题库",children:(0,je.jsx)(te.ZP,{type:G.has(t)?"default":"primary",icon:(0,je.jsx)(pe.Z,{}),size:"small",disabled:G.has(t),onClick:function(){return oe(e,t)},children:G.has(t)?"已保存":"保存"})},"save")],children:(0,je.jsx)(be.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})})},Ze=n(88722),Ce=n(58620),Ue=n(52489),Ae=n(35589),Ie=n(54974),Te=n(78069),Ee=n(85977),Pe=["current","pageSize"],Fe=function(e){var t,n,r,s,o,l,d,p,y,w,k=e.superUser,S=(0,v.useIntl)(),C=(0,v.useAccess)(),A=(0,ae.useRef)(),T=(0,Ze.Z)().translateString,P=(0,ae.useState)(1),O=g()(P,2),q=O[0],D=O[1],L=(0,ae.useState)(10),se=g()(L,2),oe=se[0],ue=se[1],le=(0,z.u)((function(e){return e.currentOrg})),fe=(0,de.j)((function(e){return e.currentKbase})),pe=(0,ce.v)((function(e){return e.currentCategory})),ge=(0,ce.v)((function(e){return e.categorySelectOptions})),me=(0,ae.useState)(!1),he=g()(me,2),ve=he[0],xe=he[1],ye=(0,ae.useState)({}),Me=g()(ye,2),we=Me[0],be=Me[1],ke=(0,ae.useState)(!1),Fe=g()(ke,2),Oe=Fe[0],qe=Fe[1],De=$.Z.useModal(),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,ae.useState)([]),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=(0,ae.useState)([]),Je=g()(He,2),Xe=Je[0],Qe=Je[1],Ke=(0,ae.useState)(!1),We=g()(Ke,2),Ge=We[0],_e=We[1],$e=(0,ae.useState)(!1),et=g()($e,2),tt=et[0],nt=et[1],rt=(0,ae.useState)({}),at=g()(rt,2),st=at[0],it=at[1],ot=(0,ae.useState)(0),ut=g()(ot,2),lt=ut[0],ct=ut[1],dt=(0,ae.useState)(!1),ft=g()(dt,2),pt=ft[0],gt=ft[1],mt=(0,ae.useMemo)((function(){var e;return null==C||null===(e=C.getModulePermission)||void 0===e?void 0:e.call(C,Ee.MY.TEXT)}),[C]),ht=k||null!==(t=null==mt||null===(n=mt.canRead)||void 0===n?void 0:n.call(mt))&&void 0!==t&&t,vt=k||null!==(r=null==mt||null===(s=mt.canCreate)||void 0===s?void 0:s.call(mt))&&void 0!==r&&r,xt=k||null!==(o=null==mt||null===(l=mt.canUpdate)||void 0===l?void 0:l.call(mt))&&void 0!==o&&o,yt=k||null!==(d=null==mt||null===(p=mt.canDelete)||void 0===p?void 0:p.call(mt))&&void 0!==d&&d,Mt=k||null!==(y=null==mt||null===(w=mt.canExport)||void 0===w?void 0:w.call(mt))&&void 0!==y&&y,wt=(0,ae.useRef)(!1),bt=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},kt=function(){var e=f()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt){e.next=3;break}return bt("text.permission.delete.denied","无权限：删除文本"),e.abrupt("return");case 3:return console.log("deleteText:",t),e.next=6,j(t);case 6:n=e.sent,console.log("deleteMember:",n),200===n.code?(m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),A.current.reload()):m.yw.error(n.message);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt){e.next=3;break}return bt("text.permission.delete.denied","无权限：批量删除文本"),e.abrupt("return");case 3:if(0!==Xe.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n=0,r=0,a=u()(Xe),e.prev=10,a.s();case 12:if((s=a.n()).done){e.next=26;break}return i=s.value,e.prev=14,e.next=17,j(i);case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),a.e(e.t1);case 31:return e.prev=31,a.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:n})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:n,fail:r})),Ve([]),Qe([]),null===(t=A.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),St=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,je.jsx)(v.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,fixed:"left",tooltip:S.formatMessage({id:"llm.text.title.tooltip",defaultMessage:"文档的标题"})},{title:(0,je.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0,copyable:!0,tooltip:S.formatMessage({id:"llm.text.content.tooltip",defaultMessage:"文档的具体内容"})},{title:(0,je.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"llm.text.status.tooltip",defaultMessage:"文档索引处理状态"}),render:function(e,t){var n=t.elasticStatus||"",r="";return"SUCCESS"===n?r="success":"ERROR"===n?r="error":"NEW"===n&&(r="processing"),(0,je.jsx)(ee.Z,{color:r,children:S.formatMessage({id:"llm.status.".concat(n.toLowerCase())})})}},{title:(0,je.jsx)(v.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"llm.text.vectorStatus.tooltip",defaultMessage:"文档向量化处理状态"}),render:function(e,t){var n=t.vectorStatus||"",r="";return"SUCCESS"===n?r="success":"ERROR"===n?r="error":"NEW"===n?r="processing":"PROCESSING"===n&&(r="warning"),n?(0,je.jsx)(ee.Z,{color:r,icon:(0,je.jsx)(Y.Z,{}),children:S.formatMessage({id:"llm.vectorStatus.".concat((n||"").toLowerCase())})||n}):"-"}},{title:(0,je.jsx)(v.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"llm.text.category.tooltip",defaultMessage:"文档所属的分类"}),render:function(e,t){var n=ge.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,je.jsx)(ee.Z,{color:"blue",children:n.label}):(0,je.jsx)(ee.Z,{color:"default",children:"未分类"})}},{title:(0,je.jsx)(v.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:S.formatMessage({id:"llm.text.tags.tooltip",defaultMessage:"文档的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,je.jsxs)("div",{children:[r.map((function(e,t){return(0,je.jsx)(ee.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,je.jsxs)(ee.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,je.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:S.formatMessage({id:"llm.text.createdAt.tooltip",defaultMessage:"文档创建的时间"}),render:function(e,t){return ie()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,je.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:S.formatMessage({id:"llm.text.updatedAt.tooltip",defaultMessage:"文档最后更新的时间"}),render:function(e,t){return t.updatedAt?ie()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Zt=[].concat(St,[{title:S.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,n,r){return[(0,je.jsx)("a",{onClick:function(){be(t),qe(!0),xe(!0)},children:S.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,je.jsx)(te.ZP,{type:"link",onClick:function(){return function(e){Le.confirm({title:S.formatMessage({id:"deleteTip"}),icon:(0,je.jsx)(B.Z,{}),content:"".concat(S.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.title,"】？"),onOk:function(){kt(e)},onCancel:function(){},okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})}(t)},danger:!0,children:S.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete"),(0,je.jsx)(ne.Z,{menu:{items:[{key:"updateIndex",label:S.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return At(t)}},{key:"updateVectorIndex",label:S.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return It(t)}}]},placement:"bottomRight",children:(0,je.jsxs)(te.ZP,{size:"small",type:"link",children:[S.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,je.jsx)(N.Z,{})]})},"indexOperations")]}}]);(0,ae.useEffect)((function(){var e;null==A||null===(e=A.current)||void 0===e||e.reload()}),[fe,pe]);var Ct=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vt){e.next=3;break}return bt("text.permission.create.denied","无权限：新增文本"),e.abrupt("return");case 3:return e.next=5,M(t);case 5:n=e.sent,console.log("handleCreateText response:",n),200===n.code?(null===(r=A.current)||void 0===r||r.reload(),xe(!1)):m.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ut=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied","无权限：编辑文本"),e.abrupt("return");case 3:return t.uid=null==we?void 0:we.uid,e.next=6,b(t);case 6:n=e.sent,console.log("handleUpdateText response:",n),200===n.code?(null===(r=A.current)||void 0===r||r.reload(),xe(!1)):m.yw.error(n.message);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),At=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied","无权限：更新索引"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=4,e.next=7,U({uid:t.uid});case 7:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(S.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(r=A.current)||void 0===r||r.reload()):m.yw.error(n.message||S.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),It=function(){var e=f()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied","无权限：更新向量索引"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=4,e.next=7,I({uid:t.uid});case 7:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(S.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(r=A.current)||void 0===r||r.reload()):m.yw.error(n.message||S.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),Tt=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied","无权限：批量更新索引"),e.abrupt("return");case 3:if(0!==Xe.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n=0,r=0,a=u()(Xe),e.prev=10,a.s();case 12:if((s=a.n()).done){e.next=26;break}return i=s.value,e.prev=14,e.next=17,U({uid:i.uid});case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),a.e(e.t1);case 31:return e.prev=31,a.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的索引")})):m.yw.error(S.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的索引，").concat(r," 条记录更新失败")})),null===(t=A.current)||void 0===t||t.reload();case 37:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Et=function(){var e=f()(c()().mark((function e(){var t,n,r,a,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied","无权限：批量更新向量索引"),e.abrupt("return");case 3:if(0!==Xe.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n=0,r=0,a=u()(Xe),e.prev=10,a.s();case 12:if((s=a.n()).done){e.next=26;break}return i=s.value,e.prev=14,e.next=17,I({uid:i.uid});case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),a.e(e.t1);case 31:return e.prev=31,a.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的向量索引")})):m.yw.error(S.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的向量索引，").concat(r," 条记录更新失败")})),null===(t=A.current)||void 0===t||t.reload();case 37:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Pt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$.Z.confirm({title:S.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:S.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,E({kbUid:null==fe?void 0:fe.uid,categoryUid:(null==pe?void 0:pe.uid)===h.zBg?"":null==pe?void 0:pe.uid,orgUid:null==le?void 0:le.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(n=A.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ft=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$.Z.confirm({title:S.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:S.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,F({kbUid:null==fe?void 0:fe.uid,categoryUid:(null==pe?void 0:pe.uid)===h.zBg?"":null==pe?void 0:pe.uid,orgUid:null==le?void 0:le.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(n=A.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ot=function(){Ge?tt?m.yw.info("正在检查模型状态，请稍后再试"):(xe(!0),qe(!1),be({})):Le.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},qt=function(){var e=f()(c()().mark((function e(){var t,n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt){e.next=3;break}return bt("text.permission.delete.denied","无权限：删除所有文本"),e.abrupt("return");case 3:if(0!==lt){e.next=6;break}return m.yw.warning(S.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),e.abrupt("return");case 6:return m.yw.loading(S.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),e.prev=7,t={categoryUid:(null==pe?void 0:pe.uid)===h.zBg?"":null==pe?void 0:pe.uid,kbUid:null==fe?void 0:fe.uid,orgUid:null==le?void 0:le.uid},e.next=11,Z(t);case 11:n=e.sent,console.log("handleDeleteAllConfirm response:",n,t),200===n.code?(m.yw.destroy(),m.yw.success(S.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(r=A.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(n.message||S.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(7),m.yw.destroy(),m.yw.error(S.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(){return e.apply(this,arguments)}}(),Dt=function(){var e=f()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Mt){e.next=3;break}return bt("text.permission.export.denied","无权限：导出文本"),e.abrupt("return");case 3:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(h.LA8),s=i()({categoryUid:(null==pe?void 0:pe.uid)===h.zBg?"":null==pe?void 0:pe.uid,kbUid:null==fe?void 0:fe.uid,orgUid:null==le?void 0:le.uid,accessToken:a||"",exportType:t},st),"current"===t?(s.pageNumber=String(q-1),s.pageSize=String(oe)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,Ce.kG)()+"/api/v1/llm/text/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Rt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Te.HK)(h.QPQ,null==le?void 0:le.uid,null==fe?void 0:fe.uid,h.whQ,{showLoading:!0,loadingMessage:S.formatMessage({id:"loading"}),errorMessage:S.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){var e=f()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(vt){e.next=3;break}return bt("text.permission.create.denied","无权限：导入文本"),e.abrupt("return");case 3:if(Ge){e.next=6;break}return Le.confirm({title:S.formatMessage({id:"warning",defaultMessage:"警告"}),content:S.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响向量检索质量。是否继续？"}),okText:S.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:S.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){gt(!0)}}),e.abrupt("return");case 6:if(!tt){e.next=9;break}return m.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 9:gt(!0);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),zt={selectedRowKeys:Ne,onChange:function(e,t){Ve(e),Qe(t)}},Yt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return Dt("range",r,n)}})},s=0;s<r;s++)a();return t},Bt=function(){var e=f()(c()().mark((function e(t){var n,r,a,s,i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xt){e.next=3;break}return bt("text.permission.update.denied",t?"无权限：批量启用文本":"无权限：批量禁用文本"),e.abrupt("return");case 3:if(0!==Xe.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.noselection",defaultMessage:"请选择要处理的项目"})),e.abrupt("return");case 6:m.yw.loading(t?S.formatMessage({id:"enabling",defaultMessage:"正在启用..."}):S.formatMessage({id:"disabling",defaultMessage:"正在禁用..."})),r=0,a=0,s=u()(Xe),e.prev=10,s.s();case 12:if((i=s.n()).done){e.next=26;break}return o=i.value,e.prev=14,e.next=17,R({uid:o.uid,enabled:t});case 17:200===e.sent.code?r++:a++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),a++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===a?m.yw.success(t?S.formatMessage({id:"batch.enable.success",defaultMessage:"成功启用 {count} 条记录"},{count:r}):S.formatMessage({id:"batch.disable.success",defaultMessage:"成功禁用 {count} 条记录"},{count:r})):m.yw.warning(t?S.formatMessage({id:"batch.enable.partial",defaultMessage:"启用了 {success} 条记录，{fail} 条记录启用失败"},{success:r,fail:a}):S.formatMessage({id:"batch.disable.partial",defaultMessage:"禁用了 {success} 条记录，{fail} 条记录禁用失败"},{success:r,fail:a})),Ve([]),Qe([]),null===(n=A.current)||void 0===n||n.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(t){return e.apply(this,arguments)}}();return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ue.Z,{onModelStatusChange:function(e){_e(e),nt(!1)}}),(0,je.jsx)(_.Z,{columns:Zt,actionRef:A,cardBordered:!0,rowSelection:yt||xt?zt:void 0,scroll:{x:1500},sticky:!0,request:function(){var e=f()(c()().mark((function e(t,n,r){var s,o,u,l,d,f,p,g,v,y;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ht){e.next=3;break}return wt.current||(wt.current=!0,bt("text.permission.read.denied","无权限：查看文本")),e.abrupt("return",{data:[],success:!0,total:0});case 3:return console.log("request:",t,n,r),m.yw.loading(S.formatMessage({id:"loading",defaultMessage:"Loading"})),s=t.current,o=t.pageSize,u=a()(t,Pe),D(s),ue(o),it(u),l=void 0,d=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],l=f,d="ascend"===n[f]?"ascend":"descend"),p=k?void 0:(null==pe?void 0:pe.uid)===h.zBg?"":null==pe?void 0:pe.uid,g=k||null==fe?void 0:fe.uid,v=i()(i()({pageNumber:s-1,pageSize:o,categoryUid:p,kbUid:g,orgUid:null==le?void 0:le.uid,superUser:k},u),{},{sortBy:l,sortDirection:d}),e.next=17,x(v);case 17:return y=e.sent,console.log("queryTextsByOrg response:",v,y),m.yw.destroy(),200===y.code?ct(null==y?void 0:y.data.totalElements):m.yw.error(y.message),e.abrupt("return",{data:null==y?void 0:y.data.content,success:!0,total:null==y?void 0:y.data.totalElements});case 22:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){D(e),ue(t)}},dateFormatter:"string",headerTitle:T(null==fe?void 0:fe.name)+" - 文本列表",tooltip:tt?"正在检查嵌入式模型...":Ge?"所添加文本内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return k?[]:function(){var e=[];(0,Ce.Ox)()||(vt&&e.push((0,je.jsx)(te.ZP,{icon:(0,je.jsx)(V.Z,{}),type:"primary",onClick:Ot,disabled:tt,children:S.formatMessage({id:"create"})},"create")),ht&&e.push((0,je.jsx)(re.Z,{title:S.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,je.jsx)(Ae.Z,{currentKbase:fe,currentOrg:le,embeddingModelExists:Ge,checkingEmbeddingModel:tt})},"chat")));var t=[];Ne.length>0&&(yt&&t.push({key:"batchDelete",icon:(0,je.jsx)(H.Z,{}),danger:!0,label:S.formatMessage({id:"batch.delete"})+" (".concat(Ne.length,")"),onClick:function(){$.Z.confirm({title:S.formatMessage({id:"batch.deleteTip"}),content:"".concat(S.formatMessage({id:"batch.deleteAffirm"})," ").concat(Ne.length," ").concat(S.formatMessage({id:"items"}),"?"),onOk:jt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})}}),xt&&t.push({key:"batchEnable",icon:(0,je.jsx)(J.Z,{}),label:S.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(Ne.length,")"),onClick:function(){return Bt(!0)}},{key:"batchDisable",icon:(0,je.jsx)(X.Z,{}),label:S.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(Ne.length,")"),onClick:function(){return Bt(!1)}},{key:"batchUpdateIndex",icon:(0,je.jsx)(Y.Z,{}),label:S.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Ne.length,")"),onClick:Tt},{key:"batchUpdateVectorIndex",icon:(0,je.jsx)(Y.Z,{}),label:S.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Ne.length,")"),onClick:Et})),yt&&t.push({key:"deleteAll",icon:(0,je.jsx)(Q.Z,{}),danger:!0,label:S.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){$.Z.confirm({title:S.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:S.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文本数据吗？此操作不可恢复!"}),onOk:qt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})}}),xt&&t.push({key:"updateAllIndex",icon:(0,je.jsx)(Y.Z,{}),label:S.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Pt},{key:"updateAllVectorIndex",icon:(0,je.jsx)(Y.Z,{}),label:S.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Ft});var n=[];return vt&&n.push({key:"import",icon:(0,je.jsx)(K.Z,{}),label:S.formatMessage({id:"import"}),onClick:Lt,disabled:tt}),Mt&&n.push({key:"export-current",icon:(0,je.jsx)(W.Z,{}),label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Dt("current")}}),Mt&&lt>0&&(lt<=1e3?n.push({key:"export-all",icon:(0,je.jsx)(W.Z,{}),label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(lt,"条)"),onClick:function(){return Dt("all")}}):n.push({key:"export-range",icon:(0,je.jsx)(W.Z,{}),label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(lt,"条)"),children:Yt(lt)})),(vt||Mt)&&n.push({key:"download",icon:(0,je.jsx)(G.Z,{}),label:S.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,Ce.LG)()}}),n.length>0&&e.push((0,je.jsx)(ne.Z,{menu:{items:n},placement:"bottom",children:(0,je.jsxs)(te.ZP,{type:"primary",children:[S.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,je.jsx)(N.Z,{})]})},"importExport")),t.length>0&&e.push((0,je.jsx)(ne.Z,{menu:{items:t},placement:"bottom",children:(0,je.jsxs)(te.ZP,{type:Ne.length>0?"primary":"default",danger:Ne.length>0,children:[Ne.length>0?S.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Ne.length,")"):S.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,je.jsx)(N.Z,{})]})},"batchOperations")),e}()}}),ve&&(0,je.jsx)(Se,{isEdit:Oe,open:ve,text:we,onClose:function(){xe(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),Oe?Ut(e):Ct(e)}}),pt&&(0,je.jsx)(Ie.Z,{type:h.pBv,acceptType:".xlsx,.xls,.csv",isModalOpen:pt,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),gt(!1),null==A||A.current.reload(),Rt()},handleCancel:function(){console.log("handleUploadDragCancel"),gt(!1),null==A||A.current.reload()}}),ze]})}},62425:function(e,t,n){n.d(t,{Z:function(){return Ze}});var r=n(86222),a=n.n(r),s=n(90819),i=n.n(s),o=n(73193),u=n.n(o),l=n(84176),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(94976),v=n(4628);function x(e){return y.apply(this,arguments)}function y(){return(y=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/query/org",{method:"GET",params:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/create",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/update",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/delete",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/crawl",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/updateIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/updateVectorIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/updateAllIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return(O=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/webpage/updateAllVectorIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=n(74171),D=n(77274),R=n(7358),L=n(15722),z=n(61107),Y=n(2484),B=n(10162),N=n(54881),V=n(11090),H=n(44565),J=n(27729),X=n(82878),Q=n(90581),K=n(65641),W=n(69533),G=n(43275),_=n(28508),$=n(92351),ee=n(44194),te=n(96596),ne=n.n(te),re=n(76711),ae=n.n(re),se=n(8732),ie=n(1715),oe=n(99036),ue=n(38106),le=n(86702),ce=n(60241),de=n(82404),fe=n(30857),pe=n(30310),ge=n(1282),me=n(55785),he=n(14377),ve=n(31549),xe=function(e){var t=e.isEdit,n=e.webpage,r=e.open,s=e.onClose,o=e.onSubmit,l=oe.A.useForm(),c=g()(l,1)[0],d=(0,se.j)((function(e){return e.currentKbase})),p=(0,q.u)((function(e){return e.currentOrg})),m=(0,ie.v)((function(e){return e.categorySelectOptions})),v=(0,ie.v)((function(e){return e.categoryTreeOptions})),x=(0,ee.useState)(),y=g()(x,2),M=y[0],w=y[1],b=(0,ee.useState)([]),k=g()(b,2),j=k[0],S=k[1],Z=(0,ee.useState)(!1),C=g()(Z,2),U=C[0],A=C[1],I=(0,ee.useState)(""),T=g()(I,2),E=T[0],P=T[1],F=(0,ee.useState)(!1),O=g()(F,2),D=O[0],R=O[1],L=(0,ee.useState)(""),z=g()(L,2),Y=(z[0],z[1]),N=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},V=function(){var e=f()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(!0),e.next=4,c.validateFields();case 4:t=e.sent,!(n=t.url)||n.startsWith("http://")||n.startsWith("https://")||(n="https://".concat(n)),r=u()(u()({},t),{},{url:n,categoryUid:M,tagList:N(j),kbUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid}),console.log("submit",r),o(r),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),de.ZP.error("请检查表单填写是否正确");case 16:return e.prev=16,R(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=c.getFieldValue("url");if(e){var t=e;e.startsWith("http://")||e.startsWith("https://")||(t="https://".concat(e)),Y(t),window.open(t,"_blank")}else de.ZP.warning("请输入网址")},J=function(){var e=E.trim();e&&!j.includes(e)&&S([].concat(ae()(j),[e])),A(!1),P("")},X=function(){A(!1),P("")};return(0,ee.useEffect)((function(){if(t)c.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,url:null==n?void 0:n.url,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid}),w(null==n?void 0:n.categoryUid),S(N((null==n?void 0:n.tagList)||[]));else{c.setFieldsValue({title:"",url:"",content:"",description:""});var e=function e(t){var n,r=a()(t||[]);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.key!==h.zBg)return s.key;var i=e(s.children||[]);if(i)return i}}catch(e){r.e(e)}finally{r.f()}return""}(v||[]);if(e)c.setFieldValue("categoryUid",e),w(e);else if(m&&m.length>0){var r=m[0].value;c.setFieldValue("categoryUid",r),w(r)}S([]),A(!1),P("")}}),[t,n,c,m,v]),(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsx)(fe.Z,{title:t?"编辑网页":"添加网页",onClose:s,open:r,width:600,extra:(0,ve.jsxs)(pe.Z,{children:[(0,ve.jsx)(W.ZP,{onClick:s,children:"取消"}),(0,ve.jsx)(W.ZP,{type:"primary",onClick:V,loading:D,children:"提交"})]}),footer:null,children:(0,ve.jsxs)(oe.A,{form:c,name:"webpageForm",submitter:!1,children:[(0,ve.jsx)(ue.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==h.zBg})).map((function(t){return u()(u()({},t),{},{children:e(t.children)})}))}(v||[]),allowClear:!0,showSearch:!0,placeholder:"请选择分类",treeDefaultExpandAll:!1,onChange:function(e){console.log("webpage category selected ".concat(e)),w(e)},fieldNames:{label:"title",value:"key",children:"children"}}}),(0,ve.jsx)(le.Z,{label:"名称",name:"title",rules:[{required:!0,message:"请输入网页名称"}],placeholder:"请输入网页名称"}),(0,ve.jsx)(le.Z,{label:"URL",name:"url",rules:[{required:!0,message:"请输入网页地址"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,message:"请输入有效的网址"}],placeholder:"请输入网址，例如：www.example.com",renderFormItem:function(e,t){var n;return(0,ve.jsxs)(pe.Z.Compact,{block:!0,children:[null===(n=t.defaultRender)||void 0===n?void 0:n.call(t,e),(0,ve.jsx)(W.ZP,{type:"link",onClick:H,children:"预览"})]})},tooltip:"支持 http 或 https 开头的网址"}),t&&(0,ve.jsx)(ce.Z,{label:"内容",name:"content",placeholder:"网页内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"网页的文本内容，用于知识库检索"}),(0,ve.jsx)(oe.A.Item,{label:"标签",name:"tagList",tooltip:"为网页添加标签，便于分类和检索",children:(0,ve.jsxs)("div",{style:{minHeight:"32px"},children:[(0,ve.jsx)(pe.Z,{wrap:!0,style:{marginBottom:8},children:N(j).map((function(e,t){return(0,ve.jsx)(Q.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void S(N(j.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),U?(0,ve.jsxs)(pe.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)(ge.Z,{value:E,onChange:function(e){P(e.target.value)},onKeyDown:function(e){"Enter"===e.key?J():"Escape"===e.key&&X()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,ve.jsx)(W.ZP,{type:"primary",size:"small",icon:(0,ve.jsx)(me.Z,{}),onClick:J,disabled:!E.trim(),children:"保存"}),(0,ve.jsx)(W.ZP,{size:"small",icon:(0,ve.jsx)(he.Z,{}),onClick:X,children:"取消"})]}):(0,ve.jsx)(W.ZP,{type:"dashed",onClick:function(){A(!0),P("")},icon:(0,ve.jsx)(B.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,ve.jsx)(ce.Z,{label:"描述",name:"description",placeholder:"请输入网页描述",fieldProps:{maxLength:500,showCount:!0}})]})})})},ye=n(58620),Me=n(52489),we=n(35589),be=n(88722),ke=n(78112),je=n(85977),Se=["current","pageSize"],Ze=function(e){var t,n,r,s,o,l,d,p,y,w,k=e.superUser,S=(0,v.useIntl)(),C=(0,be.Z)().translateString,A=(0,v.useAccess)(),T=(0,ee.useRef)(),P=(0,ee.useState)(1),O=g()(P,2),te=O[0],re=O[1],ae=(0,ee.useState)(10),oe=g()(ae,2),ue=oe[0],le=oe[1],ce=(0,q.u)((function(e){return e.currentOrg})),de=(0,se.j)((function(e){return e.currentKbase})),fe=(0,ie.v)((function(e){return e.currentCategory})),pe=(0,ie.v)((function(e){return e.categorySelectOptions})),ge=(0,ee.useState)(!1),me=g()(ge,2),he=me[0],Ze=me[1],Ce=(0,ee.useState)({}),Ue=g()(Ce,2),Ae=Ue[0],Ie=Ue[1],Te=(0,ee.useState)(!1),Ee=g()(Te,2),Pe=Ee[0],Fe=Ee[1],Oe=J.Z.useModal(),qe=g()(Oe,2),De=(qe[0],qe[1]),Re=(0,ee.useState)(!1),Le=g()(Re,2),ze=Le[0],Ye=Le[1],Be=(0,ee.useState)(!1),Ne=g()(Be,2),Ve=Ne[0],He=Ne[1],Je=(0,ee.useState)({}),Xe=g()(Je,2),Qe=Xe[0],Ke=Xe[1],We=(0,ee.useState)(0),Ge=g()(We,2),_e=Ge[0],$e=Ge[1],et=(0,ee.useState)([]),tt=g()(et,2),nt=tt[0],rt=tt[1],at=(0,ee.useState)([]),st=g()(at,2),it=st[0],ot=st[1],ut=(0,ee.useMemo)((function(){var e;return null==A||null===(e=A.getModulePermission)||void 0===e?void 0:e.call(A,je.MY.WEBPAGE)}),[A]),lt=k||null!==(t=null==ut||null===(n=ut.canRead)||void 0===n?void 0:n.call(ut))&&void 0!==t&&t,ct=k||null!==(r=null==ut||null===(s=ut.canCreate)||void 0===s?void 0:s.call(ut))&&void 0!==r&&r,dt=k||null!==(o=null==ut||null===(l=ut.canUpdate)||void 0===l?void 0:l.call(ut))&&void 0!==o&&o,ft=k||null!==(d=null==ut||null===(p=ut.canDelete)||void 0===p?void 0:p.call(ut))&&void 0!==d&&d,pt=k||null!==(y=null==ut||null===(w=ut.canExport)||void 0===w?void 0:w.call(ut))&&void 0!==y&&y,gt=(0,ee.useRef)(!1),mt=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},ht=function(){var e=f()(i()().mark((function e(t,n,r){var a,s,o,l,d,f,p,g,v,y,M;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lt){e.next=3;break}return r="webpage.permission.read.denied",i="无权限：查看网页",gt.current||(gt.current=!0,m.yw.warning(S.formatMessage({id:r,defaultMessage:i}))),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=(a=t).current,o=a.pageSize,l=c()(a,Se),re(s),le(o),Ke(l),d=void 0,f=void 0,n&&Object.keys(n).length>0&&(p=Object.keys(n)[0],d=p,f="ascend"===n[p]?"ascend":"descend"),g=k?void 0:(null==fe?void 0:fe.uid)===h.zBg?"":null==fe?void 0:fe.uid,v=k||null==de?void 0:de.uid,y=u()(u()({pageNumber:s-1,pageSize:o,categoryUid:g,kbUid:v,orgUid:null==ce?void 0:ce.uid,superUser:k},l),{},{sortBy:d,sortDirection:f}),e.next=15,x(y);case 15:return M=e.sent,console.log("queryWebpagesByOrg: ",M,y),200===M.code?$e(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 19:case"end":return e.stop()}var r,i}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),vt=function(){var e=f()(i()().mark((function e(t){var n,r,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:if(t.content&&""!==t.content.trim()){e.next=6;break}return m.yw.warning(S.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),e.abrupt("return");case 6:return m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=7,n={uid:t.uid},e.next=11,U(n);case 11:r=e.sent,console.log("更新索引响应:",r,n),m.yw.destroy(),200===r.code?(m.yw.success(S.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(a=T.current)||void 0===a||a.reload()):m.yw.error(r.message||S.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t){return e.apply(this,arguments)}}(),xt=function(){var e=f()(i()().mark((function e(t){var n,r,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:if(t.content&&""!==t.content.trim()){e.next=6;break}return m.yw.warning(S.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),e.abrupt("return");case 6:return m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=7,n={uid:t.uid},e.next=11,I(n);case 11:r=e.sent,console.log("更新向量索引响应:",r,n),m.yw.destroy(),200===r.code?(m.yw.success(S.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(a=T.current)||void 0===a||a.reload()):m.yw.error(r.message||S.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t){return e.apply(this,arguments)}}(),yt=function(){var e=f()(i()().mark((function e(t){var n,r,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：抓取网页内容"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"crawling.content",defaultMessage:"正在抓取网页内容..."})),e.prev=4,n={uid:t.uid},e.next=8,Z(n);case 8:r=e.sent,console.log("抓取网页内容响应:",r,n),m.yw.destroy(),200===r.code?(m.yw.success(S.formatMessage({id:"crawl.content.success",defaultMessage:"网页内容抓取已触发"})),null===(a=T.current)||void 0===a||a.reload()):m.yw.error(r.message||S.formatMessage({id:"crawl.content.failed",defaultMessage:"网页内容抓取失败"})),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"crawl.content.error",defaultMessage:"抓取网页内容过程发生错误"})),console.error("抓取网页内容错误:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),Mt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ve.jsx)(v.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"title",copyable:!0,tooltip:S.formatMessage({id:"webpage.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.title}),(0,ve.jsx)(X.Z.Text,{copyable:{text:(null==t?void 0:t.title)||""}})]})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:S.formatMessage({id:"webpage.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,ve.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ve.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,ve.jsx)(X.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"webpage.category.tooltip",defaultMessage:"网页内容所属的分类"}),render:function(e,t){var n=pe.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,ve.jsx)(Q.Z,{color:"blue",children:n.label}):(0,ve.jsx)(Q.Z,{color:"default",children:"未分类"})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"webpage.status.tooltip",defaultMessage:"网页索引状态"}),render:function(e,t){var n=t.elasticStatus||"",r="";return"SUCCESS"===n.toUpperCase()?r="success":"ERROR"===n.toUpperCase()||"FAILED"===n.toUpperCase()?r="error":"NEW"===n.toUpperCase()||"PENDING"===n.toUpperCase()?r="default":"PROCESSING"===n.toUpperCase()&&(r="processing"),(0,ve.jsx)(Q.Z,{color:r,children:S.formatMessage({id:"llm.status.".concat((n||"").toLowerCase()),defaultMessage:n})})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:S.formatMessage({id:"webpage.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(e,t){var n=t.vectorStatus||"",r="";return"SUCCESS"===n.toUpperCase()?r="success":"ERROR"===n.toUpperCase()||"FAILED"===n.toUpperCase()?r="error":"NEW"===n.toUpperCase()||"PENDING"===n.toUpperCase()?r="default":"PROCESSING"===n.toUpperCase()&&(r="warning"),n?(0,ve.jsx)(Q.Z,{color:r,icon:(0,ve.jsx)(D.Z,{}),children:S.formatMessage({id:"llm.vectorStatus.".concat((n||"").toLowerCase()),defaultMessage:n})}):"-"}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:S.formatMessage({id:"webpage.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,ve.jsx)(v.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:S.formatMessage({id:"webpage.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,ve.jsxs)("div",{children:[r.map((function(e,t){return(0,ve.jsx)(Q.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,ve.jsxs)(Q.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,copyable:!0,width:300,tooltip:S.formatMessage({id:"webpage.content.tooltip",defaultMessage:"爬取的网页内容摘要"}),render:function(e,t){var n=t.content||"-",r=function(){var e=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ke.TE)(t);case 2:e.sent.success?m.yw.success(S.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):m.yw.error(S.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ve.jsx)(K.Z,{content:(0,ve.jsxs)("div",{children:[(0,ve.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,ve.jsx)("span",{children:S.formatMessage({id:"webpage.content.preview",defaultMessage:"网页内容预览"})}),(0,ve.jsx)(W.ZP,{type:"text",icon:(0,ve.jsx)(R.Z,{}),onClick:function(e){e.stopPropagation(),r(n)},title:S.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,ve.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:n})]}),title:S.formatMessage({id:"webpage.content",defaultMessage:"网页内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,ve.jsx)("span",{style:{cursor:"pointer"},children:n})})}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:S.formatMessage({id:"webpage.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,ve.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:S.formatMessage({id:"webpage.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?ne()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],wt=[].concat(Mt,[{title:S.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,n,r){var a=[];return dt&&a.push((0,ve.jsx)("a",{onClick:function(){Ie(t),Fe(!0),Ze(!0)},children:S.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),ft&&a.push((0,ve.jsx)(G.Z,{title:S.formatMessage({id:"deleteTip"}),description:"".concat(S.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.title,"】？"),onConfirm:function(){return bt(t)},okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),icon:(0,ve.jsx)(L.Z,{style:{color:"red"}}),children:(0,ve.jsx)(W.ZP,{type:"link",danger:!0,children:S.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete")),dt&&a.push((0,ve.jsx)(_.Z,{menu:{items:[{key:"crawlContent",icon:(0,ve.jsx)(z.Z,{}),label:S.formatMessage({id:"crawl.content",defaultMessage:"抓取内容"}),onClick:function(){return yt(t)}},{key:"updateIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return vt(t)}},{key:"updateVectorIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return xt(t)}}]},placement:"bottomRight",children:(0,ve.jsx)($.Z,{title:S.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),children:(0,ve.jsxs)(W.ZP,{size:"small",type:"link",children:[S.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),(0,ve.jsx)(Y.Z,{})]})})},"indexOperations")),a}}]);(0,ee.useEffect)((function(){var e;null==T||null===(e=T.current)||void 0===e||e.reload()}),[de,fe]);var bt=function(){var e=f()(i()().mark((function e(t){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return mt("webpage.permission.delete.denied","无权限：删除网页"),e.abrupt("return");case 3:return e.next=5,j(t);case 5:200===(n=e.sent).code?(m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),T.current.reload()):m.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kt=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ct){e.next=3;break}return mt("webpage.permission.create.denied","无权限：创建网页"),e.abrupt("return");case 3:return e.next=5,M(t);case 5:200===(n=e.sent).code?(null===(r=T.current)||void 0===r||r.reload(),Ze(!1)):m.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:return t.uid=null==Ae?void 0:Ae.uid,e.next=6,b(t);case 6:200===(n=e.sent).code?(null===(r=T.current)||void 0===r||r.reload(),Ze(!1)):m.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),St=function(){ct?ze?Ve?m.yw.info("正在检查模型状态，请稍后再试"):(Ze(!0),Fe(!1),Ie({})):J.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"}):mt("webpage.permission.create.denied","无权限：创建网页")},Zt=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return mt("webpage.permission.delete.denied","无权限：批量删除网页"),e.abrupt("return");case 3:if(0!==it.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),n=0,r=0,s=a()(it),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return u=o.value,e.prev=14,e.next=17,j(u);case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:n})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:n,fail:r})),rt([]),ot([]),null===(t=T.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Ct=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:if(0!==it.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:if(n=it.filter((function(e){return!e.content||""===e.content.trim()})),!(n.length>0)){e.next=10;break}return m.yw.warning(S.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(n.length,"条记录)")),e.abrupt("return");case 10:m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),r=0,s=0,o=a()(it),e.prev=14,o.s();case 16:if((u=o.n()).done){e.next=30;break}return l=u.value,e.prev=18,e.next=21,U({uid:l.uid});case 21:200===e.sent.code?r++:s++,e.next=28;break;case 25:e.prev=25,e.t0=e.catch(18),s++;case 28:e.next=16;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(14),o.e(e.t1);case 35:return e.prev=35,o.f(),e.finish(35);case 38:m.yw.destroy(),0===s?m.yw.success(S.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的索引")})):m.yw.error(S.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的索引，").concat(s," 条记录更新失败")})),null===(t=T.current)||void 0===t||t.reload();case 41:case"end":return e.stop()}}),e,null,[[14,32,35,38],[18,25]])})));return function(){return e.apply(this,arguments)}}(),Ut=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:if(0!==it.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:if(n=it.filter((function(e){return!e.content||""===e.content.trim()})),!(n.length>0)){e.next=10;break}return m.yw.warning(S.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(n.length,"条记录)")),e.abrupt("return");case 10:m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),r=0,s=0,o=a()(it),e.prev=14,o.s();case 16:if((u=o.n()).done){e.next=30;break}return l=u.value,e.prev=18,e.next=21,I({uid:l.uid});case 21:200===e.sent.code?r++:s++,e.next=28;break;case 25:e.prev=25,e.t0=e.catch(18),s++;case 28:e.next=16;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(14),o.e(e.t1);case 35:return e.prev=35,o.f(),e.finish(35);case 38:m.yw.destroy(),0===s?m.yw.success(S.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(r," 条记录的向量索引")})):m.yw.error(S.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(r," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(t=T.current)||void 0===t||t.reload();case 41:case"end":return e.stop()}}),e,null,[[14,32,35,38],[18,25]])})));return function(){return e.apply(this,arguments)}}(),At=function(){var e=f()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:J.Z.confirm({title:S.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:S.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,E({kbUid:null==de?void 0:de.uid,categoryUid:(null==fe?void 0:fe.uid)===h.zBg?"":null==fe?void 0:fe.uid,orgUid:null==ce?void 0:ce.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(n=T.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),It=function(){var e=f()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dt){e.next=3;break}return mt("webpage.permission.update.denied","无权限：更新网页"),e.abrupt("return");case 3:J.Z.confirm({title:S.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:S.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,F({kbUid:null==de?void 0:de.uid,categoryUid:(null==fe?void 0:fe.uid)===h.zBg?"":null==fe?void 0:fe.uid,orgUid:null==ce?void 0:ce.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(n=T.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Tt=function(){var e=f()(i()().mark((function e(t,n,r){var a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pt){e.next=3;break}return mt("webpage.permission.export.denied","无权限：导出网页"),e.abrupt("return");case 3:a=localStorage.getItem(h.LA8),s=u()({categoryUid:(null==fe?void 0:fe.uid)===h.zBg?"":null==fe?void 0:fe.uid,kbUid:null==de?void 0:de.uid,orgUid:(null==ce?void 0:ce.uid)||"",accessToken:a||"",exportType:t},Qe),"current"===t?(s.pageNumber=te-1,s.pageSize=ue):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,ye.kG)()+"/api/v1/webpage/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Et=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return Tt("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Me.Z,{onModelStatusChange:function(e){Ye(e),He(!1)}}),(0,ve.jsx)(H.Z,{columns:wt,actionRef:T,cardBordered:!0,scroll:{x:2200},rowSelection:ft||dt?{selectedRowKeys:nt,onChange:function(e,t){rt(e),ot(t)}}:void 0,request:ht,editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){re(e),le(t)}},dateFormatter:"string",headerTitle:C(null==de?void 0:de.name)+" - 网页爬虫",tooltip:Ve?"正在检查嵌入式模型...":ze?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:k?function(){return[]}:function(){var e=[];ct&&e.push((0,ve.jsx)(W.ZP,{type:"primary",icon:(0,ve.jsx)(B.Z,{}),onClick:function(){return(0,Me.w)(St,ze,Ve)},disabled:Ve||!ze,children:S.formatMessage({id:"create",defaultMessage:"Create"})},"create")),lt&&e.push((0,ve.jsx)(we.Z,{currentKbase:de,currentOrg:ce,embeddingModelExists:ze,checkingEmbeddingModel:Ve||!ze},"chat"));var t=[];if(nt.length>0&&(ft&&t.push({key:"batchDelete",icon:(0,ve.jsx)(N.Z,{}),danger:!0,label:S.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(nt.length,")"),onClick:function(){}}),dt&&t.push({key:"batchUpdateIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(nt.length,")"),onClick:Ct},{key:"batchUpdateVectorIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(nt.length,")"),onClick:Ut})),dt&&t.push({key:"updateAllIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:At},{key:"updateAllVectorIndex",icon:(0,ve.jsx)(D.Z,{}),label:S.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:It}),pt){var n=[{key:"export-current",icon:(0,ve.jsx)(V.Z,{}),label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Tt("current")}}];_e>0&&(_e<=1e3?n.push({key:"export-all",icon:(0,ve.jsx)(V.Z,{}),label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(_e,"条)"),onClick:function(){return Tt("all")}}):n.push({key:"export-range",icon:(0,ve.jsx)(V.Z,{}),label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(_e,"条)"),children:Et(_e)})),e.push((0,ve.jsx)(_.Z,{menu:{items:n},placement:"bottom",children:(0,ve.jsxs)(W.ZP,{type:"primary",icon:(0,ve.jsx)(V.Z,{}),children:[S.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,ve.jsx)(Y.Z,{})]})},"exportDropdown"))}if(t.length>0){var r=(0,ve.jsx)(_.Z,{menu:{items:t},placement:"bottom",children:(0,ve.jsxs)(W.ZP,{type:nt.length>0?"primary":"default",danger:nt.length>0,children:[nt.length>0?S.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(nt.length,")"):S.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ve.jsx)(Y.Z,{})]})},"batchOperations");e.push(ft?(0,ve.jsx)(G.Z,{title:S.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(S.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(nt.length," ").concat(S.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:Zt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),icon:(0,ve.jsx)(L.Z,{style:{color:"red"}}),disabled:0===nt.length,children:r},"batchDeleteConfirm"):r)}return e}}),he&&(0,ve.jsx)(xe,{isEdit:Pe,open:he,webpage:Ae,onClose:function(){Ze(!1)},onSubmit:function(e){Pe?jt(e):kt(e)}}),De]})}},42103:function(e,t,n){n.d(t,{Z:function(){return fe}});var r=n(86222),a=n.n(r),s=n(90819),i=n.n(s),o=n(73193),u=n.n(o),l=n(84176),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(43388),h=n(94976),v=n(4628);function x(e){return y.apply(this,arguments)}function y(){return(y=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/query/org",{method:"GET",params:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return w.apply(this,arguments)}function w(){return(w=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/create",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/update",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/delete",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/updateIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return A.apply(this,arguments)}function A(){return(A=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/updateVectorIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/updateAllIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=f()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/llm/website/updateAllVectorIndex",{method:"POST",data:u()(u()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=n(74171),O=n(77274),q=n(15722),D=n(2484),R=n(10162),L=n(54881),z=n(11090),Y=n(44565),B=n(27729),N=n(82878),V=n(90581),H=n(43275),J=n(69533),X=n(28508),Q=n(92351),K=n(44194),W=n(96596),G=n.n(W),_=n(8732),$=n(99036),ee=n(86702),te=n(60241),ne=n(30857),re=n(31549),ae=function(e){var t=e.isEdit,n=e.website,r=e.open,a=e.onClose,s=e.onSubmit,o=$.A.useForm(),l=g()(o,1)[0],c=(0,_.j)((function(e){return e.currentKbase})),d=(0,F.u)((function(e){return e.currentOrg})),p=(0,K.useState)(!1),m=g()(p,2),h=m[0],v=m[1],x=function(){var e=f()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),e.next=4,l.validateFields();case 4:t=e.sent,n=u()(u()({},t),{},{kbUid:null==c?void 0:c.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",n),s(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0);case 13:return e.prev=13,e.finish(13);case 15:case"end":return e.stop()}}),e,null,[[0,10,13,15]])})));return function(){return e.apply(this,arguments)}}();return(0,K.useEffect)((function(){t?l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,url:null==n?void 0:n.url,description:null==n?void 0:n.description}):l.setFieldsValue({name:"",url:"",content:""})}),[t,n,l]),(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(ne.Z,{title:"标签",onClose:a,open:r,width:600,extra:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(J.ZP,{onClick:a,style:{marginRight:8},children:"取消"}),(0,re.jsx)(J.ZP,{type:"primary",onClick:x,loading:h,children:"提交"})]}),footer:null,children:(0,re.jsxs)($.A,{form:l,name:"tagForm",submitter:!1,children:[(0,re.jsx)(ee.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,re.jsx)(ee.Z,{label:"URL",name:"url",rules:[{required:!0,pattern:/^https?:\/\/[^\s]+$/}]}),(0,re.jsx)(te.Z,{label:"描述",name:"description"})]})})})},se=n(1715),ie=n(58620),oe=n(52489),ue=n(35589),le=n(88722),ce=n(85977),de=["current","pageSize"],fe=function(e){var t,n,r,s,o,l,d,p,y,w,k=e.superUser,S=(0,v.useIntl)(),C=(0,le.Z)().translateString,A=(0,v.useAccess)(),T=(0,K.useRef)(),P=(0,K.useState)(1),W=g()(P,2),$=W[0],ee=W[1],te=(0,K.useState)(10),ne=g()(te,2),fe=ne[0],pe=ne[1],ge=(0,F.u)((function(e){return e.currentOrg})),me=(0,_.j)((function(e){return e.currentKbase})),he=(0,se.v)((function(e){return e.currentCategory})),ve=(0,se.v)((function(e){return e.categorySelectOptions})),xe=(0,K.useState)(!1),ye=g()(xe,2),Me=ye[0],we=ye[1],be=(0,K.useState)({}),ke=g()(be,2),je=ke[0],Se=ke[1],Ze=(0,K.useState)(!1),Ce=g()(Ze,2),Ue=Ce[0],Ae=Ce[1],Ie=B.Z.useModal(),Te=g()(Ie,2),Ee=(Te[0],Te[1]),Pe=(0,K.useState)(!1),Fe=g()(Pe,2),Oe=Fe[0],qe=Fe[1],De=(0,K.useState)(!1),Re=g()(De,2),Le=Re[0],ze=Re[1],Ye=(0,K.useState)({}),Be=g()(Ye,2),Ne=Be[0],Ve=Be[1],He=(0,K.useState)(0),Je=g()(He,2),Xe=Je[0],Qe=Je[1],Ke=(0,K.useState)([]),We=g()(Ke,2),Ge=We[0],_e=We[1],$e=(0,K.useState)([]),et=g()($e,2),tt=et[0],nt=et[1],rt=(0,K.useMemo)((function(){var e;return null==A||null===(e=A.getModulePermission)||void 0===e?void 0:e.call(A,ce.MY.WEBSITE)}),[A]),at=k||null!==(t=null==rt||null===(n=rt.canRead)||void 0===n?void 0:n.call(rt))&&void 0!==t&&t,st=k||null!==(r=null==rt||null===(s=rt.canCreate)||void 0===s?void 0:s.call(rt))&&void 0!==r&&r,it=k||null!==(o=null==rt||null===(l=rt.canUpdate)||void 0===l?void 0:l.call(rt))&&void 0!==o&&o,ot=k||null!==(d=null==rt||null===(p=rt.canDelete)||void 0===p?void 0:p.call(rt))&&void 0!==d&&d,ut=k||null!==(y=null==rt||null===(w=rt.canExport)||void 0===w?void 0:w.call(rt))&&void 0!==y&&y,lt=(0,K.useRef)(!1),ct=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},dt=function(){var e=f()(i()().mark((function e(t,n,r){var a,s,o,l,d,f,p,g,v,y,M;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(at){e.next=3;break}return r="website.permission.read.denied",i="无权限：查看网站",lt.current||(lt.current=!0,m.yw.warning(S.formatMessage({id:r,defaultMessage:i}))),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=(a=t).current,o=a.pageSize,l=c()(a,de),ee(s),pe(o),Ve(l),d=void 0,f=void 0,n&&Object.keys(n).length>0&&(p=Object.keys(n)[0],d=p,f="ascend"===n[p]?"ascend":"descend"),g=k?void 0:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,v=k||null==me?void 0:me.uid,y=u()(u()({pageNumber:s-1,pageSize:o,categoryUid:g,kbUid:v,orgUid:null==ge?void 0:ge.uid,superUser:k},l),{},{sortBy:d,sortDirection:f}),e.next=15,x(y);case 15:return M=e.sent,console.log("queryWebsitesByOrg: ",M,y),200===M.code?Qe(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 19:case"end":return e.stop()}var r,i}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ft=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),e.prev=4,e.next=7,Z({uid:t.uid});case 7:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(S.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(r=T.current)||void 0===r||r.reload()):m.yw.error(n.message||S.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:return m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),e.prev=4,e.next=7,U({uid:t.uid});case 7:n=e.sent,m.yw.destroy(),200===n.code?(m.yw.success(S.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(r=T.current)||void 0===r||r.reload()):m.yw.error(n.message||S.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),gt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,re.jsx)(v.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,tooltip:S.formatMessage({id:"website.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,re.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,re.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.name}),(0,re.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,re.jsx)(v.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:S.formatMessage({id:"website.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,re.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,re.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,re.jsx)(N.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,re.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"website.status.tooltip",defaultMessage:"网页索引状态"}),render:function(e,t){var n=t.elasticStatus||"",r="";return"SUCCESS"===n.toUpperCase()?r="success":"ERROR"===n.toUpperCase()||"FAILED"===n.toUpperCase()?r="error":"NEW"===n.toUpperCase()||"PENDING"===n.toUpperCase()?r="default":"PROCESSING"===n.toUpperCase()&&(r="processing"),(0,re.jsx)(V.Z,{color:r,children:S.formatMessage({id:"llm.status.".concat((n||"").toLowerCase()),defaultMessage:n})})}},{title:(0,re.jsx)(v.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:S.formatMessage({id:"website.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(e,t){var n=t.vectorStatus||"",r="";return"SUCCESS"===n.toUpperCase()?r="success":"ERROR"===n.toUpperCase()||"FAILED"===n.toUpperCase()?r="error":"NEW"===n.toUpperCase()||"PENDING"===n.toUpperCase()?r="default":"PROCESSING"===n.toUpperCase()&&(r="warning"),n?(0,re.jsx)(V.Z,{color:r,icon:(0,re.jsx)(O.Z,{}),children:S.formatMessage({id:"llm.vectorStatus.".concat((n||"").toLowerCase()),defaultMessage:n})}):"-"}},{title:(0,re.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:S.formatMessage({id:"website.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,re.jsx)(v.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:S.formatMessage({id:"website.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,re.jsxs)("div",{children:[r.map((function(e,t){return(0,re.jsx)(V.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,re.jsxs)(V.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,re.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,width:300,tooltip:S.formatMessage({id:"website.content.tooltip",defaultMessage:"爬取的网页内容摘要"})},{title:(0,re.jsx)(v.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:100,tooltip:S.formatMessage({id:"website.category.tooltip",defaultMessage:"网页内容所属的分类类型"}),render:function(e,t){var n=ve.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,re.jsx)(V.Z,{children:null==n?void 0:n.label})}},{title:(0,re.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:S.formatMessage({id:"website.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return G()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,re.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:S.formatMessage({id:"website.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?G()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],mt=[].concat(gt,[{title:S.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(e,t,n,r){var a=[];return it&&a.push((0,re.jsx)("a",{onClick:function(){Se(t),Ae(!0),we(!0)},children:S.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),ot&&a.push((0,re.jsx)(H.Z,{title:S.formatMessage({id:"deleteTip"}),description:"".concat(S.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onConfirm:function(){return ht(t)},okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),icon:(0,re.jsx)(q.Z,{style:{color:"red"}}),children:(0,re.jsx)(J.ZP,{type:"link",danger:!0,children:S.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete")),it&&a.push((0,re.jsx)(X.Z,{menu:{items:[{key:"updateIndex",label:S.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return ft(t)}},{key:"updateVectorIndex",label:S.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return pt(t)}}]},placement:"bottomRight",children:(0,re.jsx)(Q.Z,{title:S.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,re.jsxs)(J.ZP,{size:"small",type:"link",children:[S.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,re.jsx)(D.Z,{})]})})},"indexOperations")),a}}]);(0,K.useEffect)((function(){var e;null==T||null===(e=T.current)||void 0===e||e.reload()}),[me,he]);var ht=function(){var e=f()(i()().mark((function e(t){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ot){e.next=3;break}return ct("website.permission.delete.denied","无权限：删除网站"),e.abrupt("return");case 3:return e.next=5,j(t);case 5:200===(n=e.sent).code?(m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),T.current.reload()):m.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),vt=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(st){e.next=3;break}return ct("website.permission.create.denied","无权限：创建网站"),e.abrupt("return");case 3:return e.next=5,M(t);case 5:200===(n=e.sent).code?(null===(r=T.current)||void 0===r||r.reload(),we(!1)):m.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xt=function(){var e=f()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:return t.uid=null==je?void 0:je.uid,e.next=6,b(t);case 6:200===(n=e.sent).code?(null===(r=T.current)||void 0===r||r.reload(),we(!1)):m.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),yt=function(){st?Oe?Le?m.yw.info("正在检查模型状态，请稍后再试"):(we(!0),Ae(!1),Se({})):B.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"}):ct("website.permission.create.denied","无权限：创建网站")},Mt=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ot){e.next=3;break}return ct("website.permission.delete.denied","无权限：批量删除网站"),e.abrupt("return");case 3:if(0!==tt.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),n=0,r=0,s=a()(tt),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return u=o.value,e.prev=14,e.next=17,j(u);case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:n})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:n,fail:r})),_e([]),nt([]),null===(t=T.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),wt=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:if(0!==tt.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n=0,r=0,s=a()(tt),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return u=o.value,e.prev=14,e.next=17,Z({uid:u.uid});case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的索引")})):m.yw.error(S.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的索引，").concat(r," 条记录更新失败")})),null===(t=T.current)||void 0===t||t.reload();case 37:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),bt=function(){var e=f()(i()().mark((function e(){var t,n,r,s,o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:if(0!==tt.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n=0,r=0,s=a()(tt),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return u=o.value,e.prev=14,e.next=17,U({uid:u.uid});case 17:200===e.sent.code?n++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(n," 条记录的向量索引")})):m.yw.error(S.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(n," 条记录的向量索引，").concat(r," 条记录更新失败")})),null===(t=T.current)||void 0===t||t.reload();case 37:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),kt=function(){var e=f()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:B.Z.confirm({title:S.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:S.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),e.prev=1,e.next=4,I({kbUid:null==me?void 0:me.uid,categoryUid:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,orgUid:null==ge?void 0:ge.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(n=T.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),jt=function(){var e=f()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(it){e.next=3;break}return ct("website.permission.update.denied","无权限：更新网站"),e.abrupt("return");case 3:B.Z.confirm({title:S.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:S.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var e=f()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(S.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),e.prev=1,e.next=4,E({kbUid:null==me?void 0:me.uid,categoryUid:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,orgUid:null==ge?void 0:ge.uid});case 4:t=e.sent,m.yw.destroy(),200===t.code?(m.yw.success(S.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(n=T.current)||void 0===n||n.reload()):m.yw.error(t.message||S.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.destroy(),m.yw.error(S.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),St=function(){var e=f()(i()().mark((function e(t,n,r){var a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut){e.next=3;break}return ct("website.permission.export.denied","无权限：导出网站"),e.abrupt("return");case 3:a=localStorage.getItem(h.LA8),s=u()({categoryUid:(null==he?void 0:he.uid)===h.zBg?"":null==he?void 0:he.uid,kbUid:null==me?void 0:me.uid,orgUid:(null==ge?void 0:ge.uid)||"",accessToken:a||"",exportType:t},Ne),"current"===t?(s.pageNumber=$-1,s.pageSize=fe):"all"===t?(s.pageNumber=0,s.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=n,s.pageSize=r),window.open((0,ie.kG)()+"/api/v1/website/export?"+new URLSearchParams(Object.entries(s).reduce((function(e,t){var n=g()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Zt=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return St("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(oe.Z,{onModelStatusChange:function(e){qe(e),ze(!1)}}),(0,re.jsx)(Y.Z,{columns:mt,actionRef:T,cardBordered:!0,scroll:{x:2e3},rowSelection:ot||it?{selectedRowKeys:Ge,onChange:function(e,t){_e(e),nt(t)}}:void 0,request:dt,editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){ee(e),pe(t)}},dateFormatter:"string",headerTitle:C(null==me?void 0:me.name)+" - 网页爬虫",tooltip:Le?"正在检查嵌入式模型...":Oe?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:k?function(){return[]}:function(){var e=[];st&&e.push((0,re.jsx)(J.ZP,{type:"primary",icon:(0,re.jsx)(R.Z,{}),onClick:function(){return(0,oe.w)(yt,Oe,Le)},disabled:Le||!Oe,children:S.formatMessage({id:"create",defaultMessage:"Create"})},"create")),at&&e.push((0,re.jsx)(ue.Z,{currentKbase:me,currentOrg:ge,embeddingModelExists:Oe,checkingEmbeddingModel:Le||!Oe},"chat"));var t=[];if(Ge.length>0&&(ot&&t.push({key:"batchDelete",icon:(0,re.jsx)(L.Z,{}),danger:!0,label:S.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Ge.length,")"),onClick:function(){}}),it&&t.push({key:"batchUpdateIndex",icon:(0,re.jsx)(O.Z,{}),label:S.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Ge.length,")"),onClick:wt},{key:"batchUpdateVectorIndex",icon:(0,re.jsx)(O.Z,{}),label:S.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Ge.length,")"),onClick:bt})),it&&t.push({key:"updateAllIndex",icon:(0,re.jsx)(O.Z,{}),label:S.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:kt},{key:"updateAllVectorIndex",icon:(0,re.jsx)(O.Z,{}),label:S.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:jt}),ut){var n=[{key:"export-current",icon:(0,re.jsx)(z.Z,{}),label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return St("current")}}];Xe>0&&(Xe<=1e3?n.push({key:"export-all",icon:(0,re.jsx)(z.Z,{}),label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Xe,"条)"),onClick:function(){return St("all")}}):n.push({key:"export-range",icon:(0,re.jsx)(z.Z,{}),label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Xe,"条)"),children:Zt(Xe)})),e.push((0,re.jsx)(X.Z,{menu:{items:n},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:"primary",icon:(0,re.jsx)(z.Z,{}),children:[S.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,re.jsx)(D.Z,{})]})},"exportDropdown"))}if(t.length>0){var r=(0,re.jsx)(X.Z,{menu:{items:t},placement:"bottom",children:(0,re.jsxs)(J.ZP,{type:Ge.length>0?"primary":"default",danger:Ge.length>0,children:[Ge.length>0?S.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Ge.length,")"):S.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,re.jsx)(D.Z,{})]})},"batchOperations");e.push(ot?(0,re.jsx)(H.Z,{title:S.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(S.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(Ge.length," ").concat(S.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:Mt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),icon:(0,re.jsx)(q.Z,{style:{color:"red"}}),disabled:0===Ge.length,children:r},"batchDeleteConfirm"):r)}return e}}),Me&&(0,re.jsx)(ae,{isEdit:Ue,open:Me,website:je,onClose:function(){we(!1)},onSubmit:function(e){Ue?xt(e):vt(e)}}),Ee]})}}}]);