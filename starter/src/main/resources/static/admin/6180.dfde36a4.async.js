"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6180],{15722:function(e,t,r){r.d(t,{Z:function(){return c}});var a=r(83910),s=r(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=r(54183),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},11090:function(e,t,r){r.d(t,{Z:function(){return c}});var a=r(83910),s=r(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=r(54183),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},2484:function(e,t,r){r.d(t,{Z:function(){return c}});var a=r(83910),s=r(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=r(54183),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var c=s.forwardRef(o)},60241:function(e,t,r){var a=r(94433),s=r(38956),n=r(44194),i=r(9953),o=r(31549),c=["fieldProps","proFieldProps"],d=function(e,t){var r=e.fieldProps,n=e.proFieldProps,d=(0,s.Z)(e,c);return(0,o.jsx)(i.Z,(0,a.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:n},d))};t.Z=n.forwardRef(d)},78358:function(e,t,r){r.d(t,{EA:function(){return l},Gc:function(){return m},S8:function(){return f},jn:function(){return h}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(94976),u=r(4628);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/black/delete",{method:"POST",data:{uid:t,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11931:function(e,t,r){r.d(t,{$T:function(){return f},Fx:function(){return l},QE:function(){return h},ic:function(){return m}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(94976),u=r(4628);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ip/white/delete",{method:"POST",data:{uid:t,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},45067:function(e,t,r){r.d(t,{Lp:function(){return m},Pn:function(){return h},c5:function(){return v},ln:function(){return f},p:function(){return l}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(94976),u=r(4628);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/query/org",{method:"GET",params:i()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete/all",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},99646:function(e,t,r){r.d(t,{bU:function(){return m},eT:function(){return l},oH:function(){return h},x:function(){return f}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(94976),u=r(4628);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/browse/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95375:function(e,t,r){r.d(t,{A_:function(){return h},PJ:function(){return f},mY:function(){return m},vf:function(){return l}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(94976),u=r(4628);function l(e){return p.apply(this,arguments)}function p(){return(p=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/update/tagList",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/visitor/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},4640:function(e,t,r){r.d(t,{Z:function(){return G}});var a=r(84176),s=r.n(a),n=r(73193),i=r.n(n),o=r(90819),c=r.n(o),d=r(89933),u=r.n(d),l=r(45332),p=r.n(l),f=r(43388),g=r(27729),m=r(99646),x=r(74171),h=r(58620),M=r(94976),v=r(15722),b=r(90297),j=r(59304),k=r(54881),y=r(11090),w=r(10162),F=r(2484),Z=r(34512),S=r(4628),I=r(90581),T=r(30310),P=r(92351),A=r(69533),L=r(28508),C=r(96596),U=r.n(C),O=r(44194),R=r(99036),N=r(86702),B=r(60241),E=r(69705),Y=r(82878),q=r(30857),z=r(31549),D=function(e){var t,r=e.isEdit,a=e.browse,s=e.open,n=e.onClose,o=e.onSubmit,c=(0,S.useIntl)(),d=E.Z.useForm(),u=p()(d,1)[0],l=Y.Z.Text;(0,O.useEffect)((function(){var e;s&&(r&&a?u.setFieldsValue({url:a.url||"",title:a.title||"",referrer:a.referrer||"",ipAddress:a.ipAddress||"",deviceType:a.deviceType||"",operatingSystem:a.operatingSystem||"",browser:a.browser||"",screenResolution:a.screenResolution||"",duration:a.duration||"",pageLoadTime:a.pageLoadTime||"",geoLocation:a.geoLocation||"",sessionId:a.sessionId||"",userAgent:a.userAgent||"",utmSource:a.utmSource||"",utmMedium:a.utmMedium||"",utmCampaign:a.utmCampaign||"",status:(null===(e=a.visitor)||void 0===e?void 0:e.status)||"",eventData:a.eventData||""}):u.resetFields())}),[s,r,a,u]);var f=r?c.formatMessage({id:"browse.edit",defaultMessage:"编辑客户"}):c.formatMessage({id:"browse.create",defaultMessage:"新增客户"}),g=a&&!r,m=g?null:(0,z.jsxs)(T.Z,{children:[(0,z.jsx)(A.ZP,{onClick:n,children:(0,z.jsx)(S.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,z.jsx)(A.ZP,{type:"primary",onClick:function(){u.validateFields().then((function(e){var t=i()(i()({},e),r&&a?{uid:a.uid}:{});o(t)}))},children:(0,z.jsx)(S.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(q.Z,{title:f,onClose:n,open:s,width:500,extra:m,children:g&&a?(0,z.jsxs)("div",{children:[(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"url",defaultMessage:"URL"}),":"]})," ",a.url||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"title",defaultMessage:"标题"}),":"]})," ",a.title||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),":"]})," ",a.referrer||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),":"]})," ",a.ipAddress||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),":"]})," ",a.deviceType||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"}),":"]})," ",a.operatingSystem||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),":"]})," ",a.browser||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),":"]})," ",a.screenResolution||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),":"]})," ",a.duration?"".concat(a.duration,"秒"):"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间"}),":"]})," ",a.pageLoadTime?"".concat(a.pageLoadTime,"毫秒"):"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),":"]})," ",a.geoLocation||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"}),":"]})," ",a.sessionId||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"}),":"]})," ",a.userAgent||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"}),":"]})," ",a.utmSource||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"}),":"]})," ",a.utmMedium||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"}),":"]})," ",a.utmCampaign||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),":"]})," ",(null===(t=a.visitor)||void 0===t?void 0:t.status)||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),":"]})," ",a.eventData||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",a.createdAt||"-"]}),(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)(l,{strong:!0,children:[(0,z.jsx)(S.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",a.updatedAt||"-"]})]}):(0,z.jsxs)(R.A,{form:u,name:"browseForm",submitter:!1,children:[(0,z.jsx)(N.Z,{name:"url",label:(0,z.jsx)(S.FormattedMessage,{id:"url",defaultMessage:"URL"}),rules:[{required:!0,message:"请输入访问的URL"}]}),(0,z.jsx)(N.Z,{name:"title",label:(0,z.jsx)(S.FormattedMessage,{id:"title",defaultMessage:"标题"}),rules:[{required:!0,message:"请输入页面标题"}]}),(0,z.jsx)(N.Z,{name:"referrer",label:(0,z.jsx)(S.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),placeholder:"来源页面URL"}),(0,z.jsx)(N.Z,{name:"ipAddress",label:(0,z.jsx)(S.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"})}),(0,z.jsx)(N.Z,{name:"deviceType",label:(0,z.jsx)(S.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),placeholder:"desktop/mobile/tablet"}),(0,z.jsx)(N.Z,{name:"operatingSystem",label:(0,z.jsx)(S.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"})}),(0,z.jsx)(N.Z,{name:"browser",label:(0,z.jsx)(S.FormattedMessage,{id:"browser",defaultMessage:"浏览器"})}),(0,z.jsx)(N.Z,{name:"screenResolution",label:(0,z.jsx)(S.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),placeholder:"如 1920x1080"}),(0,z.jsx)(N.Z,{name:"duration",label:(0,z.jsx)(S.FormattedMessage,{id:"duration",defaultMessage:"停留时长(秒)"}),fieldProps:{type:"number"}}),(0,z.jsx)(N.Z,{name:"pageLoadTime",label:(0,z.jsx)(S.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间(毫秒)"}),fieldProps:{type:"number"}}),(0,z.jsx)(N.Z,{name:"geoLocation",label:(0,z.jsx)(S.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"})}),(0,z.jsx)(N.Z,{name:"sessionId",label:(0,z.jsx)(S.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"})}),(0,z.jsx)(B.Z,{name:"userAgent",label:(0,z.jsx)(S.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"})}),(0,z.jsx)(N.Z,{name:"utmSource",label:(0,z.jsx)(S.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"})}),(0,z.jsx)(N.Z,{name:"utmMedium",label:(0,z.jsx)(S.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"})}),(0,z.jsx)(N.Z,{name:"utmCampaign",label:(0,z.jsx)(S.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"})}),(0,z.jsx)(N.Z,{name:"status",label:(0,z.jsx)(S.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),placeholder:"默认为 ONLINE"}),(0,z.jsx)(B.Z,{name:"eventData",label:(0,z.jsx)(S.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),placeholder:"JSON格式的事件信息"})]})})})},J=r(67242),H=["current","pageSize"],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,z.jsx)(S.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,z.jsx)(S.FormattedMessage,{id:"url",defaultMessage:"URL"}),dataIndex:"url",copyable:!0,ellipsis:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.url.tooltip",defaultMessage:"访问的URL地址"}),render:function(e,t){return t.url?(0,z.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.url}):"-"}},{title:(0,z.jsx)(S.FormattedMessage,{id:"title",defaultMessage:"标题"}),dataIndex:"title",ellipsis:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.title.tooltip",defaultMessage:"页面标题"})},{title:(0,z.jsx)(S.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),dataIndex:"referrer",ellipsis:!0,hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.referrer.tooltip",defaultMessage:"来源页面URL"}),render:function(e,t){return t.referrer?(0,z.jsx)("a",{href:t.referrer,target:"_blank",rel:"noopener noreferrer",children:t.referrer}):"-"}},{title:(0,z.jsx)(S.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),dataIndex:"deviceType",hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.deviceType.tooltip",defaultMessage:"设备类型(desktop/mobile/tablet)"})},{title:(0,z.jsx)(S.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),dataIndex:"browser",hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.browser.tooltip",defaultMessage:"浏览器类型"})},{title:(0,z.jsx)(S.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),dataIndex:"duration",hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.duration.tooltip",defaultMessage:"停留时长(秒)"}),render:function(e,t){return t.duration?"".concat(t.duration,"秒"):"-"}},{title:(0,z.jsx)(S.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),dataIndex:"ipAddress",copyable:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.ipAddress.tooltip",defaultMessage:"访客IP地址"})},{title:(0,z.jsx)(S.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),dataIndex:"geoLocation",hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.geoLocation.tooltip",defaultMessage:"访客地理位置"})},{title:(0,z.jsx)(S.FormattedMessage,{id:"status",defaultMessage:"状态"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.status.tooltip",defaultMessage:"访客状态"}),render:function(e,t){var r,a,s;return"ONLINE"===(null===(r=t.visitor)||void 0===r?void 0:r.status)?(0,z.jsx)(I.Z,{color:"green",children:(0,z.jsx)(S.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===(null===(a=t.visitor)||void 0===a?void 0:a.status)?(0,z.jsx)(I.Z,{color:"red",children:(0,z.jsx)(S.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===(null===(s=t.visitor)||void 0===s?void 0:s.status)?(0,z.jsx)(I.Z,{color:"black",children:(0,z.jsx)(S.FormattedMessage,{id:"visitor.status.blocked"})}):(0,z.jsx)(I.Z,{color:"default",children:(0,z.jsx)(S.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,z.jsx)(S.FormattedMessage,{id:"createdAt",defaultMessage:"访问时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,z.jsx)(S.FormattedMessage,{id:"browse.createdAt.tooltip",defaultMessage:"访问时间"}),render:function(e,t,r,a){return U()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],G=function(e){var t=e.superUser,r=(0,S.useIntl)(),a=(0,O.useRef)(),n=(0,O.useState)(1),o=p()(n,2),d=o[0],l=o[1],I=(0,O.useState)(10),C=p()(I,2),U=C[0],R=C[1],N=(0,x.u)((function(e){return e.currentOrg})),B=(0,O.useState)({}),E=p()(B,2),Y=E[0],q=E[1],G=(0,O.useState)(0),K=p()(G,2),V=K[0],Q=K[1],W=(0,O.useState)([]),$=p()(W,2),_=$[0],ee=$[1],te=(0,O.useState)([]),re=p()(te,2),ae=(re[0],re[1]),se=(0,O.useState)(!1),ne=p()(se,2),ie=ne[0],oe=ne[1],ce=(0,O.useState)(!1),de=p()(ce,2),ue=de[0],le=de[1],pe=(0,O.useState)(),fe=p()(pe,2),ge=fe[0],me=fe[1],xe=function(){var e=u()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ue||!ge){e.next=7;break}return e.next=4,(0,m.bU)(i()(i()({},t),{},{uid:ge.uid,orgUid:null==N?void 0:N.uid}));case 4:s=e.sent,e.next=10;break;case 7:return e.next=9,(0,m.x)(i()(i()({},t),{},{orgUid:null==N?void 0:N.uid}));case 9:s=e.sent;case 10:200===s.code?(f.yw.success(ue?r.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):r.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),oe(!1),null===(n=a.current)||void 0===n||n.reload()):f.yw.error(s.message||r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),f.yw.error(r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),he=function(){me(void 0),le(!1),oe(!0)},Me=[].concat(X,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,t){return(0,z.jsxs)(T.Z,{children:[(0,z.jsx)(P.Z,{title:r.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,z.jsx)(A.ZP,{type:"text",icon:(0,z.jsx)(b.Z,{}),onClick:function(){return function(e){me(e),le(!1),oe(!0)}(t)}})}),(0,z.jsx)(P.Z,{title:r.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,z.jsx)(A.ZP,{type:"text",icon:(0,z.jsx)(j.Z,{}),onClick:function(){return function(e){me(e),le(!0),oe(!0)}(t)}})}),(0,z.jsx)(P.Z,{title:r.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,z.jsx)(A.ZP,{type:"text",danger:!0,icon:(0,z.jsx)(k.Z,{}),onClick:function(){return function(e){var t;g.Z.confirm({title:r.formatMessage({id:"browse.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,z.jsx)(v.Z,{}),content:r.formatMessage({id:"browse.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(t=u()(c()().mark((function t(){var s,n;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,m.oH)({uid:e.uid,orgUid:null==N?void 0:N.uid});case 3:200===(s=t.sent).code?(f.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=a.current)||void 0===n||n.reload()):f.yw.error(s.message||r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("删除客户出错:",t.t0),f.yw.error(r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(){return t.apply(this,arguments)})})}(t)}})})]})}}]),ve=function(){var e=u()(c()().mark((function e(t,r,a){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J.Z.debug("handleExportExcel",t,r,a),s=localStorage.getItem(M.LA8),n=i()({orgUid:(null==N?void 0:N.uid)||"",accessToken:s||"",exportType:t},Y),"current"===t?(n.pageNumber=String(d-1),n.pageSize=String(U)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==r&&void 0!==a&&(n.pageNumber=String(r),n.pageSize=String(a)),window.open((0,h.kG)()+"/api/v1/browse/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),be=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ve("range",a,r)}})},n=0;n<a;n++)s();return t},je={selectedRowKeys:_,onChange:function(e,t){ee(e),ae(t)}};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Z.Z,{columns:Me,actionRef:a,cardBordered:!0,rowSelection:je,scroll:{x:2500},request:function(){var e=u()(c()().mark((function e(r,a,n){var o,d,u,p,g,x,h,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,u=s()(r,H),l(o),R(d),q(u),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,g="ascend"===a[x]?"ascend":"descend"),h=i()(i()({pageNumber:o-1,pageSize:d,orgUid:null==N?void 0:N.uid,superUser:t},u),{},{sortBy:p,sortDirection:g}),e.next=10,(0,m.eT)(h);case 10:return M=e.sent,J.Z.debug("queryBrowsesByOrg response:",M,h),200===M.code?Q(null==M?void 0:M.data.totalElements):f.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),R(t),J.Z.debug("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"浏览列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,z.jsx)(y.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}],V>0&&(V<=1e3?e.push({key:"export-all",icon:(0,z.jsx)(y.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(V,"条)"),onClick:function(){return ve("all")}}):e.push({key:"export-range",icon:(0,z.jsx)(y.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(V,"条)"),children:be(V)})),[(0,z.jsx)(A.ZP,{type:"primary",icon:(0,z.jsx)(w.Z,{}),onClick:he,children:r.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,z.jsx)(L.Z,{menu:{items:e},placement:"bottom",children:(0,z.jsxs)(A.ZP,{type:"primary",icon:(0,z.jsx)(y.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,z.jsx)(F.Z,{})]})},"exportOperations")];var e}}),(0,z.jsx)(D,{isEdit:ue,browse:ge,open:ie,onClose:function(){return oe(!1)},onSubmit:xe})]})}},89451:function(e,t,r){r.d(t,{Z:function(){return Y}});var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),c=r.n(o),d=r(10154),u=r.n(d),l=r(73193),p=r.n(l),f=r(89933),g=r.n(f),m=r(45332),x=r.n(m),h=r(43388),M=r(94976),v=r(4628);function b(e){return j.apply(this,arguments)}function j(){return(j=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/query/org",{method:"GET",params:p()(p()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return y.apply(this,arguments)}function y(){return(y=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/delete",{method:"POST",data:{uid:t,channel:M.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(74171),F=r(58620),Z=r(67242),S=r(54881),I=r(2484),T=r(11090),P=r(34512),A=r(43275),L=r(69533),C=r(27729),U=r(28508),O=r(96596),R=r.n(O),N=r(44194),B=r(31549),E=["current","pageSize"],Y=function(e){var t=e.superUser,r=(0,v.useIntl)(),a=(0,N.useRef)(),n=(0,w.u)((function(e){return e.currentOrg})),o=(0,N.useState)(1),d=x()(o,2),l=d[0],f=d[1],m=(0,N.useState)(10),j=x()(m,2),y=j[0],O=j[1],Y=(0,N.useState)({}),q=x()(Y,2),z=q[0],D=q[1],J=(0,N.useState)(0),H=x()(J,2),X=H[0],G=H[1],K=(0,N.useState)([]),V=x()(K,2),Q=V[0],W=V[1],$=(0,N.useState)([]),_=x()($,2),ee=_[0],te=_[1],re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,B.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp"}),dataIndex:"blockIp",tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp.tooltip"}),valueEnum:{true:{text:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.yes"}),status:"Error"},false:{text:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.no"}),status:"Default"}}},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.reason"}),dataIndex:"reason",copyable:!0,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.reason.tooltip"})},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.startTime.tooltip"}),render:function(e,t){return t.startTime?R()(t.startTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.endTime.tooltip"}),render:function(e,t){return t.endTime?R()(t.endTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname.tooltip"})},{title:(0,B.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,B.jsx)(v.FormattedMessage,{id:"message.createdAt.tooltip"}),render:function(e,t){return t.createdAt?R()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],ae=[].concat(re,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,B.jsx)(A.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.blackNickname,"】？"),onConfirm:function(){return ne(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,B.jsx)(L.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackIp.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),se=function(){var e=g()(c()().mark((function e(r,a,s){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z.Z.debug("handleExportExcel",r,a,s),i=localStorage.getItem(M.LA8),o=p()({orgUid:t?"":(null==n?void 0:n.uid)||"",accessToken:i||"",exportType:r},Object.entries(z).reduce((function(e,t){var r=x()(t,2),a=r[0],s=r[1];return p()(p()({},e),{},u()({},a,"string"==typeof s?s:String(s)))}),{})),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(y)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,F.kG)()+"/api/v1/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ne=function(){var e=g()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t.uid);case 3:s=e.sent,Z.Z.debug("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),h.yw.success(r.formatMessage({id:"unblock.success"}))):h.yw.error(r.formatMessage({id:"unblock.error"})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h.yw.error(r.formatMessage({id:"unblock.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=g()(c()().mark((function e(){var t,s,n,o,d,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ee.length){e.next=3;break}return h.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:h.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()(ee),e.prev=7,o.s();case 9:if((d=o.n()).done){e.next=23;break}return u=d.value,e.prev=11,e.next=14,k(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:h.yw.destroy(),0===n?h.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):h.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),W([]),te([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),oe=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return se("range",a,r)}})},n=0;n<a;n++)s();return t},ce={selectedRowKeys:Q,onChange:function(e,t){W(e),te(t)}};return(0,B.jsx)(P.Z,{columns:ae,actionRef:a,cardBordered:!0,rowSelection:ce,scroll:{x:2e3},request:function(){var e=g()(c()().mark((function e(r,a,i){var o,d,u,l,g,m,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,u=s()(r,E),f(o),O(d),D(u),l=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],l=m,g="ascend"===a[m]?"ascend":"descend"),x=p()(p()({pageNumber:r.current-1,pageSize:d,orgUid:null==n?void 0:n.uid,superUser:t},u),{},{sortBy:l,sortDirection:g}),e.next=10,b(x);case 10:return M=e.sent,Z.Z.debug("queryBlacks response:",M,x),200===M.code?G(null==M?void 0:M.data.totalElements):h.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),O(t),Z.Z.debug("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.black.list"}),toolBarRender:function(){return function(){var e=[],t=[];Q.length>0&&(t.push({key:"batchUnblock",icon:(0,B.jsx)(S.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(Q.length,")"),onClick:function(){C.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(Q.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:ie,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,B.jsx)(U.Z,{menu:{items:t},placement:"bottom",children:(0,B.jsxs)(L.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",Q.length,")",(0,B.jsx)(I.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,B.jsx)(T.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return se("current")}}];return X>0&&(X<=1e3?a.push({key:"export-all",icon:(0,B.jsx)(T.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return se("all")}}):a.push({key:"export-range",icon:(0,B.jsx)(T.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:oe(X)})),e.push((0,B.jsx)(U.Z,{menu:{items:a},placement:"bottom",children:(0,B.jsxs)(L.ZP,{type:"primary",icon:(0,B.jsx)(T.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,B.jsx)(I.Z,{})]})},"exportOperations")),e}()}})}},35851:function(e,t,r){r.d(t,{Z:function(){return E}});var a=r(84176),s=r.n(a),n=r(90819),i=r.n(n),o=r(73193),c=r.n(o),d=r(89933),u=r.n(d),l=r(45332),p=r.n(l),f=r(43388),g=r(95375),m=r(74171),x=r(58620),h=r(94976),M=r(16658),v=r(11090),b=r(2484),j=r(34512),k=r(4628),y=r(90581),w=r(28508),F=r(69533),Z=r(96596),S=r.n(Z),I=r(44194),T=r(69705),P=r(30857),A=r(30310),L=r(69174),C=r(45067),U=r(88722),O=r(31549),R=function(e){var t=e.open,r=e.onClose,a=e.onSubmit,s=e.visitor,n=e.orgUid,o=(0,k.useIntl)(),c=(0,U.Z)().translateString,d=T.Z.useForm(),l=p()(d,1)[0],m=(0,I.useState)([]),x=p()(m,2),M=x[0],v=x[1],b=(0,I.useState)(!1),j=p()(b,2),y=j[0],w=j[1],Z=(0,I.useMemo)((function(){var e;return 1===(null==s||null===(e=s.tagList)||void 0===e?void 0:e.length)&&""===s.tagList[0]?[]:(null==s?void 0:s.tagList)||[]}),[null==s?void 0:s.tagList]);(0,I.useEffect)((function(){t&&n&&S()}),[t,n]),(0,I.useEffect)((function(){t&&s&&l.setFieldsValue({tagList:Z})}),[t,s,Z,l]);var S=function(){var e=u()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,C.p)({orgUid:n,type:h.IuT});case 3:200===(t=e.sent).code?v((null==t?void 0:t.data.content)||[]):f.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),f.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,w(!0),e.next=6,l.validateFields();case 6:return t=e.sent,e.next=9,(0,g.mY)({uid:s.uid,tagList:t.tagList||[],orgUid:s.orgUid});case 9:200===(n=e.sent).code?(f.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),a(),r()):f.yw.error(n.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),f.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,w(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,O.jsx)(P.Z,{title:o.formatMessage({id:"edit.visitor",defaultMessage:"编辑访客"}),placement:"right",onClose:r,open:t,width:400,extra:(0,O.jsxs)(A.Z,{children:[(0,O.jsx)(F.ZP,{onClick:r,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,O.jsx)(F.ZP,{type:"primary",onClick:R,loading:y,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,O.jsx)(T.Z,{form:l,layout:"vertical",initialValues:{tagList:Z},children:(0,O.jsx)(T.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,O.jsx)(L.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:M.map((function(e){return{label:c(e.name),value:e.name}})),filterOption:function(e,t){var r;return(null!==(r=null==t?void 0:t.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())}})})})})},N=r(67242),B=["current","pageSize"],E=function(e){var t=e.superUser,r=(0,k.useIntl)(),a=(0,I.useRef)(),n=(0,m.u)((function(e){return e.currentOrg})),o=(0,I.useState)(1),d=p()(o,2),l=d[0],Z=d[1],T=(0,I.useState)(10),P=p()(T,2),A=P[0],L=P[1],C=(0,I.useState)({}),U=p()(C,2),E=U[0],Y=U[1],q=(0,I.useState)(0),z=p()(q,2),D=z[0],J=z[1],H=(0,I.useState)([]),X=p()(H,2),G=X[0],K=X[1],V=(0,I.useState)([]),Q=p()(V,2),W=(Q[0],Q[1]),$=(0,I.useState)(!1),_=p()($,2),ee=_[0],te=_[1],re=(0,I.useState)(null),ae=p()(re,2),se=ae[0],ne=ae[1],ie=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,O.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.nickname"}),dataIndex:"nickname",copyable:!0,width:250,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.nickname.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ip"}),dataIndex:"ip",copyable:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ip.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ipLocation"}),dataIndex:"ipLocation",copyable:!0,width:250,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.ipLocation.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.tooltip"}),render:function(e,t){return"ONLINE"===t.status?(0,O.jsx)(y.Z,{color:"green",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===t.status?(0,O.jsx)(y.Z,{color:"red",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===t.status?(0,O.jsx)(y.Z,{color:"black",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.blocked"})}):(0,O.jsx)(y.Z,{color:"default",children:(0,O.jsx)(k.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.vipLevel"}),dataIndex:"vipLevel",copyable:!0,hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.vipLevel.tooltip"})},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.channel"}),dataIndex:"channel",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.channel.tooltip"}),render:function(e,t){return(0,M.YG)(t.channel)}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.tagList"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.tagList.tooltip"}),render:function(e,t){var r;return null==t||null===(r=t.tagList)||void 0===r?void 0:r.map((function(e,t){return(0,O.jsx)(y.Z,{color:"green",style:{marginRight:4},children:e},t)}))}},{title:(0,O.jsx)(k.FormattedMessage,{id:"visitor.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,fixed:"right",tooltip:(0,O.jsx)(k.FormattedMessage,{id:"visitor.updatedAt.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:S()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")})}}],oe=[].concat(ie,[{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",fixed:"right",width:100,render:function(e,t){return[(0,O.jsx)("a",{onClick:function(){ne(t),te(!0)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]}}]),ce=function(){var e=u()(i()().mark((function e(r,a,s){var o,d;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N.Z.debug("handleExportExcel",r,a,s),o=localStorage.getItem(h.LA8),d=c()({orgUid:t?"":null==n?void 0:n.uid,accessToken:o||"",exportType:r},E),"current"===r?(d.pageNumber=String(l-1),d.pageSize=String(A)):"all"===r?(d.pageNumber="0",d.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(d.pageNumber=String(a),d.pageSize=String(s)),window.open((0,x.kG)()+"/api/v1/visitor/export?"+new URLSearchParams(d).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),de=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ce("range",a,r)}})},n=0;n<a;n++)s();return t},ue={selectedRowKeys:G,onChange:function(e,t){K(e),W(t)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.Z,{columns:oe,actionRef:a,cardBordered:!0,rowSelection:ue,scroll:{x:1800},request:function(){var e=u()(i()().mark((function e(r,a,o){var d,u,l,p,m,x,h,M;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=r.current,u=r.pageSize,l=s()(r,B),Z(d),L(u),Y(l),p=void 0,m=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,m="ascend"===a[x]?"ascend":"descend"),h=c()(c()({pageNumber:r.current-1,pageSize:u,orgUid:null==n?void 0:n.uid,superUser:t},l),{},{sortBy:p,sortDirection:m}),e.next=10,(0,g.vf)(h);case 10:return M=e.sent,N.Z.debug("queryVisitorsByOrg response:",M,h),200===M.code?J(null==M?void 0:M.data.totalElements):f.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){Z(e),L(t),N.Z.debug("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.list"}),toolBarRender:function(){return e=[{key:"export-current",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ce("current")}}],D>0&&(D<=1e3?e.push({key:"export-all",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(D,"条)"),onClick:function(){return ce("all")}}):e.push({key:"export-range",icon:(0,O.jsx)(v.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(D,"条)"),children:de(D)})),[(0,O.jsx)(w.Z,{menu:{items:e},placement:"bottom",children:(0,O.jsxs)(F.ZP,{type:"primary",icon:(0,O.jsx)(v.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(b.Z,{})]})},"exportOperations")];var e}}),(0,O.jsx)(R,{open:ee,onClose:function(){te(!1),ne(null)},onSubmit:function(){var e;null===(e=a.current)||void 0===e||e.reload()},visitor:se,orgUid:(null==se?void 0:se.orgUid)||(null==n?void 0:n.uid)})]})}},22194:function(e,t,r){var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),c=r.n(o),d=r(73193),u=r.n(d),l=r(89933),p=r.n(l),f=r(45332),g=r.n(f),m=r(43388),x=r(78358),h=r(74171),M=r(58620),v=r(94976),b=r(59304),j=r(10162),k=r(54881),y=r(2484),w=r(11090),F=r(34512),Z=r(4628),S=r(69533),I=r(43275),T=r(27729),P=r(28508),A=r(96596),L=r.n(A),C=r(44194),U=r(35939),O=r(67242),R=r(31549),N=["current","pageSize"];t.Z=function(e){var t=e.superUser,r=(0,Z.useIntl)(),a=(0,C.useRef)(),n=(0,h.u)((function(e){return e.currentOrg})),o=(0,C.useState)(1),d=g()(o,2),l=d[0],f=d[1],A=(0,C.useState)(10),B=g()(A,2),E=B[0],Y=B[1],q=(0,C.useState)({}),z=g()(q,2),D=z[0],J=z[1],H=(0,C.useState)(0),X=g()(H,2),G=X[0],K=X[1],V=(0,C.useState)([]),Q=g()(V,2),W=Q[0],$=Q[1],_=(0,C.useState)([]),ee=g()(_,2),te=ee[0],re=ee[1],ae=(0,C.useState)(!1),se=g()(ae,2),ne=se[0],ie=se[1],oe=(0,C.useState)(),ce=g()(oe,2),de=ce[0],ue=ce[1],le=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(Z.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.ip"}),dataIndex:"ip",copyable:!0,width:150,tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.ip.tooltip"})},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.reason"}),dataIndex:"reason",tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.reason.tooltip"})},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.startTime.tooltip"}),render:function(e,t){return(0,R.jsx)("span",{children:L()(t.startTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.endTime.tooltip"}),render:function(e,t){return(0,R.jsx)("span",{children:L()(t.endTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.userNickname"}),dataIndex:"userNickname",tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"visitor.blackIp.userNickname.tooltip"})},{title:(0,R.jsx)(Z.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,R.jsx)(Z.FormattedMessage,{id:"message.createdAt.tooltip"})}],pe=[].concat(le,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,R.jsx)(S.ZP,{size:"small",type:"link",icon:(0,R.jsx)(b.Z,{}),onClick:function(){return me(t)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,R.jsx)(I.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return ge(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,R.jsx)(S.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackIp.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),fe=function(){var e=p()(c()().mark((function e(r,a,s){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.Z.debug("handleExportExcel",r,a,s),i=localStorage.getItem(v.LA8),o=u()({orgUid:t?"":null==n?void 0:n.uid,accessToken:i||"",exportType:r},D),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(E)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,M.kG)()+"/api/v1/ip/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ge=function(){var e=p()(c()().mark((function e(t){var s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.jn)(t.uid);case 3:s=e.sent,O.Z.debug("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),m.yw.success(r.formatMessage({id:"unblock.success"}))):m.yw.error(r.formatMessage({id:"unblock.error"})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),m.yw.error(r.formatMessage({id:"unblock.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),me=function(e){ue(e),ie(!0)},xe=function(){ue(void 0),ie(!0)},he=function(){var e=p()(c()().mark((function e(){var t,s,n,o,d,u;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==te.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()(te),e.prev=7,o.s();case 9:if((d=o.n()).done){e.next=23;break}return u=d.value,e.prev=11,e.next=14,(0,x.jn)(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===n?m.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):m.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),$([]),re([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Me=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return fe("range",a,r)}})},n=0;n<a;n++)s();return t},ve={selectedRowKeys:W,onChange:function(e,t){$(e),re(t)}};return(0,R.jsxs)(C.Fragment,{children:[(0,R.jsx)(F.Z,{columns:pe,actionRef:a,cardBordered:!0,rowSelection:ve,scroll:{x:2e3},request:function(){var e=p()(c()().mark((function e(r,a,i){var o,d,l,p,g,h,M,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,d=r.pageSize,l=s()(r,N),f(o),Y(d),J(l),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(h=Object.keys(a)[0],p=h,g="ascend"===a[h]?"ascend":"descend"),M=u()(u()({pageNumber:r.current-1,pageSize:d,orgUid:null==n?void 0:n.uid},l),{},{sortBy:p,sortDirection:g,superUser:t}),e.next=10,(0,x.EA)(M);case 10:return v=e.sent,O.Z.debug("queryIpBlacklists response:",v,M),200===v.code?K(null==v?void 0:v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:null==v?void 0:v.data.content,success:!0,total:null==v?void 0:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),Y(t),O.Z.debug("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.blackIp.list"}),toolBarRender:function(){return function(){var e=[];e.push((0,R.jsx)(S.ZP,{type:"primary",icon:(0,R.jsx)(j.Z,{}),onClick:xe,children:r.formatMessage({id:"visitor.blackIp.add",defaultMessage:"添加黑名单IP"})},"add"));var t=[];W.length>0&&(t.push({key:"batchUnblock",icon:(0,R.jsx)(k.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(W.length,")"),onClick:function(){T.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(W.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:he,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,R.jsx)(P.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(S.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",W.length,")",(0,R.jsx)(y.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,R.jsx)(w.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return fe("current")}}];return G>0&&(G<=1e3?a.push({key:"export-all",icon:(0,R.jsx)(w.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return fe("all")}}):a.push({key:"export-range",icon:(0,R.jsx)(w.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:Me(G)})),e.push((0,R.jsx)(P.Z,{menu:{items:a},placement:"bottom",children:(0,R.jsxs)(S.ZP,{type:"primary",icon:(0,R.jsx)(w.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,R.jsx)(y.Z,{})]})},"exportOperations")),e}()}}),(0,R.jsx)(U.Z,{visible:ne,onClose:function(){return ie(!1)},onSuccess:function(){var e;null===(e=a.current)||void 0===e||e.reload()},type:"black",editData:de,superUser:t})]})}},35939:function(e,t,r){var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),c=r.n(o),d=r(45332),u=r.n(d),l=r(43388),p=r(78358),f=r(11931),g=r(74171),m=r(4628),x=r(30861),h=r(1282),M=r(69705),v=r(30857),b=r(30310),j=r(69533),k=r(96596),y=r.n(k),w=r(44194),F=r(31549),Z=x.default.RangePicker,S=h.Z.TextArea;t.Z=function(e){var t=e.visible,r=e.onClose,a=e.onSuccess,n=e.type,o=e.editData,d=e.superUser,x=(0,m.useIntl)(),k=M.Z.useForm(),I=u()(k,1)[0],T=(0,g.u)((function(e){return e.currentOrg})),P=!(null==o||!o.uid),A=P?x.formatMessage({id:"visitor.".concat(n,"Ip.edit"),defaultMessage:"编辑".concat("black"===n?"黑名单":"白名单","IP")}):x.formatMessage({id:"visitor.".concat(n,"Ip.add"),defaultMessage:"添加".concat("black"===n?"黑名单":"白名单","IP")});(0,w.useEffect)((function(){if(t)if(P&&o){var e={ip:o.ip};if("black"===n){var r=o;e.reason=r.reason,e.blackNickname=r.blackNickname,e.userNickname=r.userNickname,r.startTime&&r.endTime&&(e.timeRange=[y()(r.startTime),y()(r.endTime)])}else{var a=o;e.description=a.description}I.setFieldsValue(e)}else I.resetFields()}),[t,o,P,n,I]);var L=function(){var e=c()(s()().mark((function e(){var t,c,u,g,m;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.validateFields();case 3:if(t=e.sent,c={ip:t.ip,orgUid:null==T?void 0:T.uid,superUser:d},"black"!==n){e.next=19;break}if(g=i()(i()({},c),{},{reason:t.reason,blackNickname:t.blackNickname,userNickname:t.userNickname}),t.timeRange&&2===t.timeRange.length&&(g.startTime=t.timeRange[0].format("YYYY-MM-DD HH:mm:ss"),g.endTime=t.timeRange[1].format("YYYY-MM-DD HH:mm:ss")),!P){e.next=14;break}return e.next=11,(0,p.Gc)(i()(i()({},g),{},{uid:o.uid}));case 11:u=e.sent,e.next=17;break;case 14:return e.next=16,(0,p.S8)(g);case 16:u=e.sent;case 17:e.next=29;break;case 19:if(m=i()(i()({},c),{},{description:t.description}),!P){e.next=26;break}return e.next=23,(0,f.ic)(i()(i()({},m),{},{uid:o.uid}));case 23:u=e.sent,e.next=29;break;case 26:return e.next=28,(0,f.$T)(m);case 28:u=e.sent;case 29:200===u.code?(l.yw.success(x.formatMessage({id:P?"update.success":"create.success",defaultMessage:P?"更新成功":"创建成功"})),a(),r()):l.yw.error(u.message||x.formatMessage({id:P?"update.error":"create.error",defaultMessage:P?"更新失败":"创建失败"})),e.next=36;break;case 32:e.prev=32,e.t0=e.catch(0),console.error("Submit error:",e.t0),l.yw.error(x.formatMessage({id:"submit.error",defaultMessage:"提交失败"}));case 36:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(){return e.apply(this,arguments)}}();return(0,F.jsx)(v.Z,{title:A,width:600,open:t,onClose:r,footer:(0,F.jsxs)(b.Z,{children:[(0,F.jsx)(j.ZP,{onClick:r,children:x.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,F.jsx)(j.ZP,{type:"primary",onClick:L,children:x.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,F.jsxs)(M.Z,{form:I,layout:"vertical",initialValues:{timeRange:[y()(),y()().add(1,"year")]},children:[(0,F.jsx)(M.Z.Item,{name:"ip",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.".concat(n,"Ip.ip")}),rules:[{validator:function(e,t){if(!t)return Promise.reject(new Error(x.formatMessage({id:"ip.required",defaultMessage:"请输入IP地址"})));return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)?Promise.resolve():Promise.reject(new Error(x.formatMessage({id:"ip.invalid",defaultMessage:"请输入有效的IP地址"})))}}],tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.".concat(n,"Ip.ip.tooltip")}),help:x.formatMessage({id:"ip.format.help",defaultMessage:"格式：xxx.xxx.xxx.xxx（如：192.168.1.1）"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"ip.placeholder",defaultMessage:"请输入IP地址"})})}),"black"===n?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(M.Z.Item,{name:"reason",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.reason"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.reason.tooltip"}),children:(0,F.jsx)(S,{rows:3,placeholder:x.formatMessage({id:"reason.placeholder",defaultMessage:"请输入封禁原因"})})}),(0,F.jsx)(M.Z.Item,{name:"blackNickname",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.black.nickname"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.black.nickname.tooltip"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"blackNickname.placeholder",defaultMessage:"请输入被封禁用户昵称"})})}),(0,F.jsx)(M.Z.Item,{name:"userNickname",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.userNickname"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.userNickname.tooltip"}),children:(0,F.jsx)(h.Z,{placeholder:x.formatMessage({id:"userNickname.placeholder",defaultMessage:"请输入操作员昵称"})})}),(0,F.jsx)(M.Z.Item,{name:"timeRange",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.timeRange",defaultMessage:"封禁时间范围"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.blackIp.timeRange.tooltip",defaultMessage:"设置IP封禁的时间范围"}),children:(0,F.jsx)(Z,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:[x.formatMessage({id:"startTime.placeholder",defaultMessage:"开始时间"}),x.formatMessage({id:"endTime.placeholder",defaultMessage:"结束时间"})]})})]}):(0,F.jsx)(M.Z.Item,{name:"description",label:(0,F.jsx)(m.FormattedMessage,{id:"visitor.white.description"}),tooltip:(0,F.jsx)(m.FormattedMessage,{id:"visitor.white.description.tooltip"}),children:(0,F.jsx)(S,{rows:3,placeholder:x.formatMessage({id:"description.placeholder",defaultMessage:"请输入白名单描述"})})})]})})}}}]);