"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[831],{11090:function(e,t,a){a.d(t,{Z:function(){return l}});var s=a(83910),n=a(44194),r={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,s.Z)({},e,{ref:t,icon:r}))};var l=n.forwardRef(i)},50177:function(e,t,a){var s=a(83910),n=a(44194),r=a(4812),o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,s.Z)({},e,{ref:t,icon:r.Z}))},l=n.forwardRef(i);t.Z=l},2484:function(e,t,a){a.d(t,{Z:function(){return l}});var s=a(83910),n=a(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,s.Z)({},e,{ref:t,icon:r}))};var l=n.forwardRef(i)},60241:function(e,t,a){var s=a(94433),n=a(38956),r=a(44194),o=a(9953),i=a(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var a=e.fieldProps,r=e.proFieldProps,d=(0,n.Z)(e,l);return(0,i.jsx)(o.Z,(0,s.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:r},d))};t.Z=r.forwardRef(d)},35517:function(e,t,a){var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(43388),x=a(95437),h=a(88722),M=a(74171),v=a(94976),y=a(58620),j=a(16658),w=a(54881),b=a(11090),k=a(2484),S=a(44565),F=a(4628),I=a(43275),Z=a(27729),C=a(28508),T=a(69533),A=a(44194),D=a(85977),E=a(31549),R=["current","pageSize"];t.Z=function(e){var t,a,s,r,i,d,u=e.type,f=e.superUser,U=(0,F.useIntl)(),P=(0,A.useRef)(),B=(0,h.Z)().translateString,L=(0,M.u)((function(e){return e.currentOrg})),O=(0,F.useAccess)(),z=(0,A.useMemo)((function(){var e;return null==O||null===(e=O.getModulePermission)||void 0===e?void 0:e.call(O,D.MY.MESSAGE)}),[O]),N=null!==(t=null==z||null===(a=z.canRead)||void 0===a?void 0:a.call(z))&&void 0!==t&&t,q=null!==(s=null==z||null===(r=z.canDelete)||void 0===r?void 0:r.call(z))&&void 0!==s&&s,Y=null!==(i=null==z||null===(d=z.canExport)||void 0===d?void 0:d.call(z))&&void 0!==i&&i,H=function(e,t){m.yw.warning(U.formatMessage({id:e,defaultMessage:t}))},_=(0,A.useState)(1),G=p()(_,2),K=G[0],W=G[1],J=(0,A.useState)(10),V=p()(J,2),Q=V[0],X=V[1],$=(0,A.useState)([]),ee=p()($,2),te=ee[0],ae=ee[1],se=(0,A.useState)([]),ne=p()(se,2),re=ne[0],oe=ne[1],ie=(0,A.useState)(0),le=p()(ie,2),de=le[0],ce=le[1],ue=(0,A.useState)({}),ge=p()(ue,2),fe=ge[0],pe=ge[1],me=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,E.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,E.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:B(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,E.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,E.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,j.ng)(null==t?void 0:t.status)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,j.OI)(t.type)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,j.YG)(t.channel)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:U.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,s){var n=[(0,E.jsx)("a",{onClick:function(){xe(t)},children:U.formatMessage({id:"view",defaultMessage:"View"})},"editable")];return q&&n.push((0,E.jsx)(I.Z,{title:U.formatMessage({id:"deleteTip"}),description:"".concat(U.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return he(t)},okText:U.formatMessage({id:"ok"}),cancelText:U.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:U.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),n}}],xe=function(e){var t,a,s;console.log("handleShowChatHistory",e);var n={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:v.CCt,sid:null==e||null===(a=e.thread)||void 0===a?void 0:a.uid}};null===(s=window.bytedesk)||void 0===s||s.showChat(n)},he=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return H("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),m.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(U.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==P||null===(a=P.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(U.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(c()().mark((function e(){var t,a,s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return H("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:if(0!==re.length){e.next=6;break}return m.yw.warning(U.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,s=l()(re);try{for(s.s();!(n=s.n()).done;)n.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===a?m.yw.success(U.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(U.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),ae([]),oe([]),null===(t=P.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ve=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return H("message.permission.export.denied","无权限：导出消息"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(v.LA8),r=o()({componentType:u,orgUid:(null==L?void 0:L.uid)||"",accessToken:n||"",exportType:t,threadType:v.H_O},fe),"current"===t?(r.pageNumber=String(K-1),r.pageSize=String(Q)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,y.kG)()+"/api/v1/message/export?"+new URLSearchParams(r).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ve("range",s,a)}})},r=0;r<s;r++)n();return t},je={selectedRowKeys:te,onChange:function(e,t){ae(e),oe(t)}};return(0,E.jsx)(S.Z,{columns:me,actionRef:P,cardBordered:!0,rowSelection:je,scroll:{x:1500},request:function(){var e=g()(c()().mark((function e(t,a,s){var r,i,l,d,u,g,p,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=4;break}return H("message.permission.read.denied","无权限：查看消息"),ce(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return console.log("request:",t,a,s),r=t.current,i=t.pageSize,l=n()(t,R),W(r),X(i),pe(l),d=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],d=g,u="ascend"===a[g]?"ascend":"descend"),p=o()(o()({pageNumber:r-1,pageSize:i,threadType:v.H_O,orgUid:null==L?void 0:L.uid,superUser:f},l),{},{sortBy:d,sortDirection:u}),e.next=15,(0,x.W5)(p);case 15:return h=e.sent,console.log("getAllMessages response:",p,h),200===h.code?ce(null==h?void 0:h.data.totalElements):m.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:U.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];if(q&&te.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(w.Z,{}),danger:!0,label:U.formatMessage({id:"batch.delete"})+" (".concat(te.length,")"),onClick:function(){Z.Z.confirm({title:U.formatMessage({id:"batch.deleteTip"}),content:"".concat(U.formatMessage({id:"batch.deleteAffirm"})," ").concat(te.length," ").concat(U.formatMessage({id:"items"}),"?"),onOk:Me,okText:U.formatMessage({id:"ok"}),cancelText:U.formatMessage({id:"cancel"})})}}),Y){var a=[{key:"export-current",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}];de>0&&(de<=1e3?a.push({key:"export-all",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(de,"条)"),onClick:function(){return ve("all")}}):a.push({key:"export-range",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(de,"条)"),children:ye(de)})),e.push((0,E.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,E.jsxs)(T.ZP,{icon:(0,E.jsx)(b.Z,{}),type:"primary",children:[U.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(k.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,E.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(T.ZP,{type:te.length>0?"primary":"default",danger:te.length>0,children:[te.length>0?U.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(te.length,")"):U.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(k.Z,{})]})},"batchOperations")),e}()}})}},82485:function(e,t,a){var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(43388),x=a(95437),h=a(88722),M=a(74171),v=a(94976),y=a(58620),j=a(16658),w=a(54881),b=a(11090),k=a(2484),S=a(44565),F=a(4628),I=a(43275),Z=a(27729),C=a(28508),T=a(69533),A=a(44194),D=a(85977),E=a(31549),R=["current","pageSize"];t.Z=function(e){var t,a,s,r,i,d,u=e.type,f=e.superUser,U=(0,F.useIntl)(),P=(0,A.useRef)(),B=(0,h.Z)().translateString,L=(0,M.u)((function(e){return e.currentOrg})),O=(0,F.useAccess)(),z=(0,A.useMemo)((function(){var e;return null==O||null===(e=O.getModulePermission)||void 0===e?void 0:e.call(O,D.MY.MESSAGE)}),[O]),N=null!==(t=null==z||null===(a=z.canRead)||void 0===a?void 0:a.call(z))&&void 0!==t&&t,q=null!==(s=null==z||null===(r=z.canDelete)||void 0===r?void 0:r.call(z))&&void 0!==s&&s,Y=null!==(i=null==z||null===(d=z.canExport)||void 0===d?void 0:d.call(z))&&void 0!==i&&i,H=function(e,t){m.yw.warning(U.formatMessage({id:e,defaultMessage:t}))},_=(0,A.useState)(1),G=p()(_,2),K=G[0],W=G[1],J=(0,A.useState)(10),V=p()(J,2),Q=V[0],X=V[1],$=(0,A.useState)([]),ee=p()($,2),te=ee[0],ae=ee[1],se=(0,A.useState)([]),ne=p()(se,2),re=ne[0],oe=ne[1],ie=(0,A.useState)(0),le=p()(ie,2),de=le[0],ce=le[1],ue=(0,A.useState)({}),ge=p()(ue,2),fe=ge[0],pe=ge[1],me=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,E.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,E.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:B(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,E.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,E.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,j.ng)(null==t?void 0:t.status)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,j.OI)(t.type)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,j.YG)(t.channel)}},{title:(0,E.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,E.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:U.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,s){var n=[(0,E.jsx)("a",{onClick:function(){xe(t)},children:U.formatMessage({id:"view",defaultMessage:"View"})},"editable")];return q&&n.push((0,E.jsx)(I.Z,{title:U.formatMessage({id:"deleteTip"}),description:"".concat(U.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return he(t)},okText:U.formatMessage({id:"ok"}),cancelText:U.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:U.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),n}}],xe=function(e){var t,a,s;console.log("handleShowChatHistory",e);var n={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:v.CCt,sid:null==e||null===(a=e.thread)||void 0===a?void 0:a.uid}};null===(s=window.bytedesk)||void 0===s||s.showChat(n)},he=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return H("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),m.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(U.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==P||null===(a=P.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(U.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(c()().mark((function e(){var t,a,s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return H("message.permission.delete.denied","无权限：删除消息"),e.abrupt("return");case 3:if(0!==re.length){e.next=6;break}return m.yw.warning(U.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,s=l()(re);try{for(s.s();!(n=s.n()).done;)n.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===a?m.yw.success(U.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(U.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),ae([]),oe([]),null===(t=P.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ve=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return H("message.permission.export.denied","无权限：导出消息"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(v.LA8),r=o()({componentType:u,orgUid:(null==L?void 0:L.uid)||"",accessToken:n||"",exportType:t,threadType:v.n4F},fe),"current"===t?(r.pageNumber=String(K-1),r.pageSize=String(Q)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,y.kG)()+"/api/v1/message/export?"+new URLSearchParams(r).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ve("range",s,a)}})},r=0;r<s;r++)n();return t},je={selectedRowKeys:te,onChange:function(e,t){ae(e),oe(t)}};return(0,E.jsx)(S.Z,{columns:me,actionRef:P,cardBordered:!0,rowSelection:je,scroll:{x:1500},request:function(){var e=g()(c()().mark((function e(t,a,s){var r,i,l,d,u,g,p,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=4;break}return H("message.permission.read.denied","无权限：查看消息"),ce(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return console.log("request:",t,a,s),r=t.current,i=t.pageSize,l=n()(t,R),W(r),X(i),pe(l),d=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],d=g,u="ascend"===a[g]?"ascend":"descend"),p=o()(o()({pageNumber:r-1,pageSize:i,threadType:v.n4F,orgUid:null==L?void 0:L.uid,superUser:f},l),{},{sortBy:d,sortDirection:u}),e.next=15,(0,x.W5)(p);case 15:return h=e.sent,console.log("getAllMessages response:",p,h),200===h.code?ce(null==h?void 0:h.data.totalElements):m.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:U.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];if(q&&te.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(w.Z,{}),danger:!0,label:U.formatMessage({id:"batch.delete"})+" (".concat(te.length,")"),onClick:function(){Z.Z.confirm({title:U.formatMessage({id:"batch.deleteTip"}),content:"".concat(U.formatMessage({id:"batch.deleteAffirm"})," ").concat(te.length," ").concat(U.formatMessage({id:"items"}),"?"),onOk:Me,okText:U.formatMessage({id:"ok"}),cancelText:U.formatMessage({id:"cancel"})})}}),Y){var a=[{key:"export-current",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}];de>0&&(de<=1e3?a.push({key:"export-all",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(de,"条)"),onClick:function(){return ve("all")}}):a.push({key:"export-range",icon:(0,E.jsx)(b.Z,{}),label:U.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(de,"条)"),children:ye(de)})),e.push((0,E.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,E.jsxs)(T.ZP,{icon:(0,E.jsx)(b.Z,{}),type:"primary",children:[U.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(k.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,E.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(T.ZP,{type:te.length>0?"primary":"default",danger:te.length>0,children:[te.length>0?U.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(te.length,")"):U.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(k.Z,{})]})},"batchOperations")),e}()}})}},59094:function(e,t,a){a.d(t,{Z:function(){return ce}});var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(10154),x=a.n(m),h=a(43388),M=a(94976),v=a(4628);function y(e){return j.apply(this,arguments)}function j(){return(j=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/message/leave/query/org",{method:"GET",params:o()(o()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/message/leave/reply",{method:"POST",data:o()(o()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/message/leave/delete",{method:"POST",data:o()(o()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F,I=a(74171),Z=a(58620),C=a(54881),T=a(11090),A=a(2484),D=a(44565),E=a(90581),R=a(43275),U=a(27729),P=a(28508),B=a(69533),L=a(96596),O=a.n(L),z=a(44194),N=a(16658),q=a(76711),Y=a.n(q),H=a(10162),_=a(50177),G=a(99036),K=a(60241),W=a(82878),J=a(69705),V=a(30857),Q=a(30310),X=a(68177),$=a(5957),ee=a(47710),te=a(19239),ae=a(31549),se=W.Z.Title,ne=W.Z.Paragraph,re=W.Z.Text,oe=function(e){var t,a=e.visible,s=e.onClose,n=e.messageLeave,r=e.onSuccess,i=(0,v.useIntl)(),l=J.Z.useForm(),d=p()(l,1)[0],u=(0,z.useState)(!1),f=p()(u,2),m=f[0],x=f[1],y=(0,z.useState)(!1),j=p()(y,2),b=j[0],k=j[1],S=(0,z.useState)([]),F=p()(S,2),I=F[0],C=F[1],T=(0,z.useState)([]),A=p()(T,2),D=A[0],E=A[1],R=(0,z.useState)(!1),P=p()(R,2),L=P[0],q=P[1],W=(0,z.useState)(""),oe=p()(W,2),ie=oe[0],le=oe[1],de=(0,z.useState)(""),ce=p()(de,2),ue=ce[0],ge=ce[1];(0,z.useEffect)((function(){if(n&&n.replyContent)if(d.setFieldsValue({replyContent:n.replyContent}),k(!0),n.replyImages&&n.replyImages.length>0){var e=n.replyImages.filter((function(e){return""!==e}));E(e),C(e.map((function(e,t){return{uid:"-".concat(t),name:"image-".concat(t,".png"),status:"done",url:e,thumbUrl:e}})))}else E([]),C([]);else d.resetFields(),k(!1),E([]),C([])}),[n,d]);var fe=function(){var e=g()(c()().mark((function e(t){var a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,x(!0),a={uid:n.uid,replyContent:t.replyContent,replyImages:D,orgUid:n.orgUid},e.next=7,w(a);case 7:o=e.sent,console.log("回复留言:",null==o?void 0:o.data),200===o.code?(h.yw.success(i.formatMessage({id:"replyContent.success",defaultMessage:"回复成功"})),d.resetFields(),E([]),C([]),r(),s()):h.yw.error(o.message||i.formatMessage({id:"replyContent.failed",defaultMessage:"回复失败"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("回复留言出错:",e.t0),h.yw.error(i.formatMessage({id:"replyContent.error",defaultMessage:"回复出错"}));case 16:return e.prev=16,x(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e){return!e||0===e.length||1===e.length&&""===e[0]?null:(0,ae.jsxs)("div",{style:{marginTop:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"images",defaultMessage:"图片"}),":"]}),(0,ae.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:e.map((function(e,t){return e?(0,ae.jsx)("img",{src:e,alt:"留言图片",style:{width:"100px",height:"100px",objectFit:"cover",cursor:"pointer"},onClick:function(){return me({url:e,uid:"img-".concat(t),name:"图片 ".concat(t+1)})}},t):null}))})]})},me=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le(t.url||t.thumbUrl),q(!0),ge(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=(0,ae.jsx)(B.ZP,{icon:(0,ae.jsx)(H.Z,{}),children:(0,ae.jsx)(v.FormattedMessage,{id:"upload",defaultMessage:"上传"})}),he={name:"file",accept:"image/*",action:(0,Z.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(M.LA8)},listType:"picture-card",fileList:I,onPreview:me,onChange:function(e){var t=Y()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var a,s=null===(a=e.file.response)||void 0===a?void 0:a.data.fileUrl;D.includes(s)||E((function(e){return[].concat(Y()(e),[s])})),h.yw.success(i.formatMessage({id:"upload.success",defaultMessage:"上传 {filename} 成功"},{filename:e.file.name}))}else h.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name})+": ".concat(e.file.response.message));else"error"===e.file.status&&h.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name}));t=t.map((function(e){var t,a;return e.response&&200===e.response.code?o()(o()({},e),{},{url:null===(t=e.response)||void 0===t?void 0:t.data.fileUrl,thumbUrl:null===(a=e.response)||void 0===a?void 0:a.data.fileUrl}):e})),C(t)},data:function(e){var t=O()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return console.log("uploadProps",t),{file:e,fileName:t,fileType:e.type,isAvatar:"false",kbType:M.IrL,categoryUid:"",kbUid:"",channel:M.XtJ}},onRemove:function(e){var t;if(console.log("onRemove",e),"done"===e.status&&e.response&&null!==(t=e.response)&&void 0!==t&&t.data){var a,s=null===(a=e.response)||void 0===a?void 0:a.data.fileUrl;E((function(e){return e.filter((function(e){return e!==s}))}))}return e.url&&E((function(t){return t.filter((function(t){return t!==e.url}))})),!0}};return(0,ae.jsx)(V.Z,{title:i.formatMessage({id:"leave.message.replyContent",defaultMessage:"回复留言"}),width:600,placement:"right",onClose:s,open:a,styles:{body:{paddingBottom:80}},extra:(0,ae.jsxs)(Q.Z,{children:[(0,ae.jsx)(B.ZP,{onClick:s,children:(0,ae.jsx)(v.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,ae.jsx)(B.ZP,{type:"primary",icon:(0,ae.jsx)(_.Z,{}),loading:m,onClick:function(){return d.submit()},children:(0,ae.jsx)(v.FormattedMessage,{id:"replyContent",defaultMessage:"回复"})})]}),children:n&&(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsxs)(X.Z,{variant:"borderless",style:{marginBottom:"20px"},children:[(0,ae.jsx)(se,{level:5,children:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.details",defaultMessage:"留言详情"})}),(0,ae.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",n.nickname||(null===(t=n.user)||void 0===t?void 0:t.nickname)||"-"]}),(0,ae.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"contact",defaultMessage:"联系方式"}),":"]})," ",n.contact||"-"]}),(0,ae.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.type",defaultMessage:"留言类型"}),":"]})," ",(0,N.aC)(n.type)]}),(0,ae.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"内容"}),":"]}),(0,ae.jsx)(ne,{style:{marginTop:"8px"},children:n.content})]}),pe(n.images||[]),n.replyContent&&(0,ae.jsxs)("div",{style:{marginTop:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"replied.content",defaultMessage:"回复内容"}),":"]}),(0,ae.jsx)(ne,{style:{marginTop:"8px"},children:n.replyContent})]}),n.replyImages&&n.replyImages.length>0&&(0,ae.jsxs)("div",{style:{marginTop:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"replyContent.images",defaultMessage:"回复图片"}),":"]}),pe(n.replyImages||[])]}),(0,ae.jsxs)("div",{style:{marginTop:"10px"},children:[(0,ae.jsxs)(re,{strong:!0,children:[(0,ae.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"状态"}),":"]})," ",(0,N.It)(n.status)]})]}),b&&(0,ae.jsx)($.Z,{type:"warning",showIcon:!0,message:i.formatMessage({id:"replyContent.exists.warning",defaultMessage:"已回复，继续回复仅更新已有回复"}),style:{marginBottom:"16px"}}),(0,ae.jsxs)(G.A,{form:d,onFinish:fe,submitter:!1,children:[(0,ae.jsx)(K.Z,{name:"replyContent",label:i.formatMessage({id:"replyContent.content",defaultMessage:"回复内容"}),placeholder:i.formatMessage({id:"please.enter.replyContent",defaultMessage:"请输入回复内容"}),rules:[{required:!0,message:i.formatMessage({id:"replyContent.content.required",defaultMessage:"请输入回复内容"})}],fieldProps:{rows:6}}),(0,ae.jsxs)(J.Z.Item,{label:i.formatMessage({id:"replyContent.images",defaultMessage:"回复图片"}),children:[(0,ae.jsx)(ee.Z,o()(o()({},he),{},{children:xe})),(0,ae.jsx)(U.Z,{open:L,title:ue,footer:null,onCancel:function(){return q(!1)},children:(0,ae.jsx)(te.Z,{alt:"预览图片",style:{width:"100%"},src:ie})})]})]})]})})},ie=a(85977),le=["current","pageSize"],de=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ae.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,ae.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"称呼"}),dataIndex:"nickname",copyable:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.nickname.tooltip",defaultMessage:"留言者称呼"})},{title:(0,ae.jsx)(v.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.contact.tooltip"})},{title:(0,ae.jsx)(v.FormattedMessage,{id:"type",defaultMessage:"留言类型"}),dataIndex:"type",copyable:!0,width:120,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.type.tooltip",defaultMessage:"留言类型"}),valueType:"select",valueEnum:(F={},x()(x()(x()(x()(x()(x()(x()(x()(x()(x()(F,M.sHH,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.consultation",defaultMessage:"咨询"}),status:"default"}),M.vvW,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.complaint",defaultMessage:"投诉"}),status:"error"}),M.hbS,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.suggestion",defaultMessage:"建议"}),status:"processing"}),M.te_,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.feedback",defaultMessage:"反馈"}),status:"processing"}),M.GpD,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.cooperation",defaultMessage:"合作"}),status:"default"}),M.jNT,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.recruitment",defaultMessage:"招聘"}),status:"default"}),M.FQ1,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.technical_support",defaultMessage:"技术支持"}),status:"processing"}),M.r8m,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.sales_inquiry",defaultMessage:"销售咨询"}),status:"default"}),M.tKt,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.billing",defaultMessage:"账单问题"}),status:"warning"}),M.L60,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.account",defaultMessage:"账户问题"}),status:"warning"}),x()(x()(x()(x()(F,M.B2x,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.feature_request",defaultMessage:"功能需求"}),status:"processing"}),M.gT6,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.bug_report",defaultMessage:"问题报告"}),status:"error"}),M.gRl,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.general",defaultMessage:"一般留言"}),status:"default"}),M.bjt,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.type.other",defaultMessage:"其他"}),status:"default"})),render:function(e,t){var a,s=(a={},x()(x()(x()(x()(x()(x()(x()(x()(x()(x()(a,M.sHH,{text:"咨询",color:"default"}),M.vvW,{text:"投诉",color:"error"}),M.hbS,{text:"建议",color:"processing"}),M.te_,{text:"反馈",color:"processing"}),M.GpD,{text:"合作",color:"default"}),M.jNT,{text:"招聘",color:"default"}),M.FQ1,{text:"技术支持",color:"processing"}),M.r8m,{text:"销售咨询",color:"default"}),M.tKt,{text:"账单问题",color:"warning"}),M.L60,{text:"账户问题",color:"warning"}),x()(x()(x()(x()(a,M.B2x,{text:"功能需求",color:"processing"}),M.gT6,{text:"问题报告",color:"error"}),M.gRl,{text:"一般留言",color:"default"}),M.bjt,{text:"其他",color:"default"}))[t.type]||{text:t.type||"-",color:"default"};return(0,ae.jsx)(E.Z,{color:s.color,children:s.text})}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"userNickname",defaultMessage:"用户昵称"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.userNickname.tooltip",defaultMessage:"用户昵称"}),render:function(e,t){var a;return(0,ae.jsx)(ae.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,ellipsis:!0,width:300,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.content.tooltip"})},{title:(0,ae.jsx)(v.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.images.tooltip"}),render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,ae.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,ae.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,width:120,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.status.tooltip"}),valueType:"select",valueEnum:x()(x()(x()(x()(x()(x()(x()(x()(x()({},M.d23,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),M.m7i,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),M.d3_,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),M.oLW,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),M.KBB,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),M.v3R,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),M.uke,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),M.fEl,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),M.K0y,{text:(0,ae.jsx)(v.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,N.It)(t.status)}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.replyContent",defaultMessage:"Reply"}),dataIndex:"replyContent",copyable:!0,hideInSearch:!0,ellipsis:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.replyContent.tooltip"})},{title:(0,ae.jsx)(v.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),dataIndex:"replyImages",copyable:!0,hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.replyImages.tooltip"}),render:function(e,t,a,s){return!t.replyImages||0===t.replyImages.length||1===t.replyImages.length&&""===t.replyImages[0]?(0,ae.jsx)("span",{children:"-"}):t.replyImages.map((function(e,t){return e?(0,ae.jsx)("img",{src:e,alt:"reply image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"reply.user",defaultMessage:"回复人员"}),dataIndex:"replyUserNickname",hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.replyUser.tooltip"}),render:function(e,t){var a;return(0,ae.jsx)(ae.Fragment,{children:(null==t||null===(a=t.replyUser)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"repliedAt",defaultMessage:"回复时间"}),key:"repliedAt",dataIndex:"repliedAt",sorter:!0,hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.repliedAt.tooltip"}),render:function(e,t,a,s){return t.repliedAt?O()(t.repliedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.createdAt.tooltip"}),render:function(e,t,a,s){return O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,ae.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,ae.jsx)(v.FormattedMessage,{id:"leave.message.updatedAt.tooltip"}),render:function(e,t,a,s){return t.updatedAt?O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],ce=function(e){var t,a,s,r,i,d,u,f,m=e.superUser,x=(0,v.useIntl)(),j=(0,z.useRef)(),w=(0,z.useState)(1),b=p()(w,2),S=b[0],F=b[1],E=(0,z.useState)(10),L=p()(E,2),O=L[0],N=L[1],q=(0,I.u)((function(e){return e.currentOrg})),Y=(0,z.useState)(!1),H=p()(Y,2),_=H[0],G=H[1],K=(0,z.useState)(),W=p()(K,2),J=W[0],V=W[1],Q=(0,z.useState)([]),X=p()(Q,2),$=X[0],ee=X[1],te=(0,z.useState)([]),se=p()(te,2),ne=se[0],re=se[1],ce=(0,z.useState)(0),ue=p()(ce,2),ge=ue[0],fe=ue[1],pe=(0,z.useState)({}),me=p()(pe,2),xe=me[0],he=me[1],Me=(0,v.useAccess)(),ve=(0,z.useMemo)((function(){var e;return null==Me||null===(e=Me.getModulePermission)||void 0===e?void 0:e.call(Me,ie.MY.MESSAGE_LEAVE)}),[Me]),ye=null!==(t=null==ve||null===(a=ve.canRead)||void 0===a?void 0:a.call(ve))&&void 0!==t&&t,je=null!==(s=null==ve||null===(r=ve.canUpdate)||void 0===r?void 0:r.call(ve))&&void 0!==s&&s,we=null!==(i=null==ve||null===(d=ve.canDelete)||void 0===d?void 0:d.call(ve))&&void 0!==i&&i,be=null!==(u=null==ve||null===(f=ve.canExport)||void 0===f?void 0:f.call(ve))&&void 0!==u&&u,ke=function(e,t){h.yw.warning(x.formatMessage({id:e,defaultMessage:t}))},Se=[].concat(de,[{title:x.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(e,t,a,s){var n=[(0,ae.jsx)("a",{onClick:function(){Fe(t)},children:x.formatMessage({id:"view",defaultMessage:"View"})},"view")];return je&&n.push((0,ae.jsx)("a",{onClick:function(){Ie(t)},children:x.formatMessage({id:"handle",defaultMessage:"Handle"})},"handle")),we&&n.push((0,ae.jsx)(R.Z,{title:x.formatMessage({id:"deleteTip"}),description:"".concat(x.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return Ze(t)},okText:x.formatMessage({id:"ok"}),cancelText:x.formatMessage({id:"cancel"}),children:(0,ae.jsx)("a",{style:{color:"red",marginLeft:8},children:x.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),n}}]),Fe=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:M.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Ie=function(e){je?(console.log("handleProcess",e),V(e),G(!0)):ke("messageLeave.permission.update.denied","无权限：处理留言")},Ze=function(){var e=g()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=3;break}return ke("messageLeave.permission.delete.denied","无权限：删除留言"),e.abrupt("return");case 3:return console.log("handleDeleteConfirm",t),h.yw.loading(x.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=5,e.next=8,k({uid:t.uid});case 8:a=e.sent,h.yw.destroy(),200===a.code?(h.yw.success(x.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==j||null===(s=j.current)||void 0===s||s.reload()):h.yw.error(a.message||x.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),h.yw.destroy(),h.yw.error(x.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){var e=g()(c()().mark((function e(){var t,a,s,n,r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=3;break}return ke("messageLeave.permission.delete.denied","无权限：删除留言"),e.abrupt("return");case 3:if(0!==ne.length){e.next=6;break}return h.yw.warning(x.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:h.yw.loading(x.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,n=l()(ne),e.prev=10,n.s();case 12:if((r=n.n()).done){e.next=26;break}return o=r.value,e.prev=14,e.next=17,k({uid:o.uid});case 17:200===e.sent.code?a++:s++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),s++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:h.yw.destroy(),0===s?h.yw.success(x.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):h.yw.warning(x.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ee([]),re([]),null===(t=j.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be){e.next=3;break}return ke("messageLeave.permission.export.denied","无权限：导出留言"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(M.LA8),r=o()({orgUid:(null==q?void 0:q.uid)||"",accessToken:n||"",exportType:t},xe),"current"===t?(r.pageNumber=String(S-1),r.pageSize=String(O)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,Z.kG)()+"/api/v1/message/leave/export?"+new URLSearchParams(r).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),Ae=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return Te("range",s,a)}})},r=0;r<s;r++)n();return t},De={selectedRowKeys:$,onChange:function(e,t){ee(e),re(t)}};return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(D.Z,{columns:Se,actionRef:j,cardBordered:!0,rowSelection:De,scroll:{x:2800},request:function(){var e=g()(c()().mark((function e(t,a,s){var r,i,l,d,u,g,f,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye){e.next=4;break}return ke("messageLeave.permission.read.denied","无权限：查看留言"),fe(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return r=t.current,i=t.pageSize,l=n()(t,le),F(r),N(i),he(l),d=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],d=g,u="ascend"===a[g]?"ascend":"descend"),f=o()(o()({pageNumber:r-1,pageSize:i,orgUid:null==q?void 0:q.uid,superUser:m},l),{},{sortBy:d,sortDirection:u}),e.next=14,y(f);case 14:return p=e.sent,console.log("queryLeaveMsgsByOrg response:",p,f),200===p.code?fe(null==p?void 0:p.data.totalElements):h.yw.error(p.message),e.abrupt("return",{data:null==p?void 0:p.data.content,success:!0,total:null==p?void 0:p.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"留言记录",toolBarRender:function(){return function(){var e=[],t=[];if(we&&$.length>0&&t.push({key:"batchDelete",icon:(0,ae.jsx)(C.Z,{}),danger:!0,label:x.formatMessage({id:"batch.delete"})+" (".concat($.length,")"),onClick:function(){U.Z.confirm({title:x.formatMessage({id:"batch.deleteTip"}),content:"".concat(x.formatMessage({id:"batch.deleteAffirm"})," ").concat($.length," ").concat(x.formatMessage({id:"items"}),"?"),onOk:Ce,okText:x.formatMessage({id:"ok"}),cancelText:x.formatMessage({id:"cancel"})})}}),be){var a=[{key:"export-current",icon:(0,ae.jsx)(T.Z,{}),label:x.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Te("current")}}];ge>0&&(ge<=1e3?a.push({key:"export-all",icon:(0,ae.jsx)(T.Z,{}),label:x.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ge,"条)"),onClick:function(){return Te("all")}}):a.push({key:"export-range",icon:(0,ae.jsx)(T.Z,{}),label:x.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ge,"条)"),children:Ae(ge)})),e.push((0,ae.jsx)(P.Z,{menu:{items:a},placement:"bottom",children:(0,ae.jsxs)(B.ZP,{icon:(0,ae.jsx)(T.Z,{}),type:"primary",children:[x.formatMessage({id:"export",defaultMessage:"Export"}),(0,ae.jsx)(A.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,ae.jsx)(P.Z,{menu:{items:t},placement:"bottom",children:(0,ae.jsxs)(B.ZP,{type:$.length>0?"primary":"default",danger:$.length>0,children:[$.length>0?x.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat($.length,")"):x.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ae.jsx)(A.Z,{})]})},"batchOperations")),e}()}}),(0,ae.jsx)(oe,{visible:_,onClose:function(){G(!1)},messageLeave:J,onSuccess:function(){var e;null===(e=j.current)||void 0===e||e.reload()}})]})}},48032:function(e,t,a){a.d(t,{Z:function(){return z}});var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(43388),x=a(94976),h=a(4628);function M(e){return v.apply(this,arguments)}function v(){return(v=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/message/rating/query/org",{method:"GET",params:o()(o()({},t),{},{channel:x.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=a(74171),j=a(58620),w=a(54881),b=a(11090),k=a(2484),S=a(44565),F=a(90581),I=a(43275),Z=a(27729),C=a(28508),T=a(69533),A=a(96596),D=a.n(A),E=a(44194),R=a(85977),U=a(31549),P=["current","pageSize"],B={ROBOT:{text:"机器人",color:"blue"},AGENT:{text:"人工客服",color:"green"},FAQ:{text:"常见问题",color:"purple"}},L={RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,U.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.answer.tooltip"})},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,ellipsis:!0,hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.question.tooltip"})},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.fromType"}),dataIndex:"fromType",ellipsis:!0,hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.fromType.tooltip"}),render:function(e,t){var a=t.fromType||"",s=B[a]||{text:a,color:"default"};return(0,U.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=L[a]||{text:a,color:"default"};return(0,U.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.tags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,U.jsx)(U.Fragment,{children:t.rateDownTagList.map((function(e){return(0,U.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.reason.tooltip"})},{title:(0,U.jsx)(h.FormattedMessage,{id:"faq.rating.user",defaultMessage:"用户"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t){var a;return(0,U.jsx)(U.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,U.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,U.jsx)(h.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,s){return t.createdAt?D()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],z=function(e){var t,a,s,r,i,d,u=e.superUser,f=(0,h.useIntl)(),v=(0,E.useRef)(),F=(0,E.useState)(1),A=p()(F,2),D=A[0],B=A[1],L=(0,E.useState)(10),z=p()(L,2),N=z[0],q=z[1],Y=(0,y.u)((function(e){return e.currentOrg})),H=(0,E.useState)([]),_=p()(H,2),G=_[0],K=_[1],W=(0,E.useState)([]),J=p()(W,2),V=J[0],Q=J[1],X=(0,E.useState)(0),$=p()(X,2),ee=$[0],te=$[1],ae=(0,E.useState)({}),se=p()(ae,2),ne=se[0],re=se[1],oe=(0,h.useAccess)(),ie=(0,E.useMemo)((function(){var e;return null==oe||null===(e=oe.getModulePermission)||void 0===e?void 0:e.call(oe,R.MY.MESSAGE_RATING)}),[oe]),le=null!==(t=null==ie||null===(a=ie.canRead)||void 0===a?void 0:a.call(ie))&&void 0!==t&&t,de=null!==(s=null==ie||null===(r=ie.canDelete)||void 0===r?void 0:r.call(ie))&&void 0!==s&&s,ce=null!==(i=null==ie||null===(d=ie.canExport)||void 0===d?void 0:d.call(ie))&&void 0!==i&&i,ue=function(e,t){m.yw.warning(f.formatMessage({id:e,defaultMessage:t}))},ge=[].concat(O,[{title:f.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,s){var n=[(0,U.jsx)("a",{onClick:function(){fe(t)},children:f.formatMessage({id:"view",defaultMessage:"View"})},"view")];return de&&n.push((0,U.jsx)(I.Z,{title:f.formatMessage({id:"deleteTip"}),description:"".concat(f.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return pe(t)},okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"}),children:(0,U.jsx)("a",{style:{color:"red",marginLeft:8},children:f.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),n}}]),fe=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:x.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},pe=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de){e.next=3;break}return ue("messageRating.permission.delete.denied","无权限：删除评分"),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),m.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(f.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==v||null===(a=v.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(f.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=g()(c()().mark((function e(){var t,a,s,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de){e.next=3;break}return ue("messageRating.permission.delete.denied","无权限：删除评分"),e.abrupt("return");case 3:if(0!==V.length){e.next=6;break}return m.yw.warning(f.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,s=l()(V);try{for(s.s();!(n=s.n()).done;)n.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===a?m.yw.success(f.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(f.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),K([]),Q([]),null===(t=v.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ce){e.next=3;break}return ue("messageRating.permission.export.denied","无权限：导出评分"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(x.LA8),r=o()({orgUid:(null==Y?void 0:Y.uid)||"",accessToken:n||"",exportType:t},ne),"current"===t?(r.pageNumber=String(D-1),r.pageSize=String(N)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,j.kG)()+"/api/v1/message/rating/export?"+new URLSearchParams(r).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),he=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return xe("range",s,a)}})},r=0;r<s;r++)n();return t},Me={selectedRowKeys:G,onChange:function(e,t){K(e),Q(t)}};return(0,U.jsx)(S.Z,{columns:ge,actionRef:v,cardBordered:!0,rowSelection:Me,scroll:{x:2e3},request:function(){var e=g()(c()().mark((function e(t,a,s){var r,i,l,d,g,f,p,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le){e.next=4;break}return ue("messageRating.permission.read.denied","无权限：查看评分"),te(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return r=t.current,i=t.pageSize,l=n()(t,P),B(r),q(i),re(l),d=void 0,g=void 0,a&&Object.keys(a).length>0&&(f=Object.keys(a)[0],d=f,g="ascend"===a[f]?"ascend":"descend"),p=o()(o()({pageNumber:r-1,pageSize:i,orgUid:null==Y?void 0:Y.uid,superUser:u},l),{},{sortBy:d,sortDirection:g}),e.next=14,M(p);case 14:return x=e.sent,console.log("queryMessageRatingsByOrg response:",x,p),200===x.code?te(null==x?void 0:x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:null==x?void 0:x.data.content,success:!0,total:null==x?void 0:x.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:f.formatMessage({id:"message.tab.rating"}),toolBarRender:function(){return function(){var e=[],t=[];if(de&&G.length>0&&t.push({key:"batchDelete",icon:(0,U.jsx)(w.Z,{}),danger:!0,label:f.formatMessage({id:"batch.delete"})+" (".concat(G.length,")"),onClick:function(){Z.Z.confirm({title:f.formatMessage({id:"batch.deleteTip"}),content:"".concat(f.formatMessage({id:"batch.deleteAffirm"})," ").concat(G.length," ").concat(f.formatMessage({id:"items"}),"?"),onOk:me,okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"})})}}),ce){var a=[{key:"export-current",icon:(0,U.jsx)(b.Z,{}),label:f.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xe("current")}}];ee>0&&(ee<=1e3?a.push({key:"export-all",icon:(0,U.jsx)(b.Z,{}),label:f.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ee,"条)"),onClick:function(){return xe("all")}}):a.push({key:"export-range",icon:(0,U.jsx)(b.Z,{}),label:f.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ee,"条)"),children:he(ee)})),e.push((0,U.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,U.jsxs)(T.ZP,{icon:(0,U.jsx)(b.Z,{}),type:"primary",children:[f.formatMessage({id:"export",defaultMessage:"Export"}),(0,U.jsx)(k.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,U.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,U.jsxs)(T.ZP,{type:G.length>0?"primary":"default",danger:G.length>0,children:[G.length>0?f.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(G.length,")"):f.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,U.jsx)(k.Z,{})]})},"batchOperations")),e}()}})}}}]);