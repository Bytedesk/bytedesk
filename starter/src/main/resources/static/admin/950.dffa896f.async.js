"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[950],{80950:function(e,l,n){var t=n(10154),o=n.n(t),a=n(73193),i=n.n(a),r=n(90819),u=n.n(r),s=n(89933),d=n.n(s),p=n(45332),c=n.n(p),m=n(44194),v=n(48470),f=n(86702),g=n(60241),b=n(99036),h=n(50628),x=n(59005),y=n(53052),M=n(4628),k=n(43388),j=n(56862),T=n(74171),S=n(94976),C=n(47926),E=n(97799),P=n(82878),w=n(30310),Z=n(69174),K=n(69533),U=n(69705),L=n(28582),R=n(68177),W=n(5957),F=n(10162),N=n(59908),A=n(11818),O=n(64628),z=n(90084),D=n(13845),I=n(31549),V=P.Z.Text,B=function(e){var l=e.value,n=e.onChange,t=e.options,o=e.loading,a=e.placeholder,i=e.emptyContent,r=e.onSearch,u=e.onDropdownOpen,s=e.onCreate,d=e.createLabel,p=e.createTitle;return(0,I.jsxs)(w.Z.Compact,{block:!0,children:[(0,I.jsx)(Z.Z,{value:l,onChange:function(e){return null==n?void 0:n(e)},options:t,showSearch:!0,filterOption:!1,placeholder:a,loading:o,allowClear:!0,style:{flex:1},notFoundContent:i,onSearch:r,onOpenChange:function(e){e&&u()}}),(0,I.jsx)(K.ZP,{size:"small",icon:(0,I.jsx)(F.Z,{}),onClick:s,title:p,children:d})]})};l.Z=function(e){var l,n,t,a,r,s,p,P,w,Z,q,Q,G,H,$,J,X,Y,_,ee,le,ne,te,oe,ae,ie,re=e.open,ue=e.record,se=e.onClose,de=e.onSuccess,pe=(0,M.useIntl)(),ce=(0,T.u)((function(e){return e.currentOrg})),me=(0,m.useMemo)((function(){return!(null==ue||!ue.uid)}),[ue]),ve=(0,m.useState)(!1),fe=c()(ve,2),ge=fe[0],be=fe[1],he=(0,m.useState)([]),xe=c()(he,2),ye=xe[0],Me=xe[1],ke=(0,m.useState)(!1),je=c()(ke,2),Te=je[0],Se=je[1],Ce=(0,m.useRef)(),Ee=(0,m.useState)((null==ue?void 0:ue.avatar)||""),Pe=c()(Ee,2),we=Pe[0],Ze=Pe[1],Ke=(0,m.useState)((null==ue?void 0:ue.type)||S.f4h),Ue=c()(Ke,2),Le=Ue[0],Re=Ue[1],We=(0,m.useState)((null==ue?void 0:ue.system)||!1),Fe=c()(We,2),Ne=(Fe[0],Fe[1]),Ae=(0,m.useState)([]),Oe=c()(Ae,2),ze=Oe[0],De=Oe[1],Ie=(0,m.useState)({}),Ve=c()(Ie,2),Be=Ve[0],qe=Ve[1],Qe=(0,m.useState)(!1),Ge=c()(Qe,2),He=Ge[0],$e=Ge[1],Je=(0,m.useState)(""),Xe=c()(Je,2),Ye=Xe[0],_e=Xe[1],el=(0,m.useState)(""),ll=c()(el,2),nl=ll[0],tl=ll[1],ol=(0,m.useState)(""),al=c()(ol,2),il=al[0],rl=al[1],ul=(0,m.useState)(""),sl=c()(ul,2),dl=sl[0],pl=sl[1],cl=(0,m.useState)(!(null==ue||null===(l=ue.llm)||void 0===l||!l.enabled)),ml=c()(cl,2),vl=ml[0],fl=ml[1],gl=(0,m.useState)(!(null==ue||!ue.kbEnabled)),bl=c()(gl,2),hl=bl[0],xl=bl[1],yl=(0,m.useState)(!(null==ue||null===(n=ue.llm)||void 0===n||!n.useLlmWhenKbEmpty)),Ml=c()(yl,2),kl=Ml[0],jl=Ml[1],Tl=(0,m.useState)(!1),Sl=c()(Tl,2),Cl=Sl[0],El=Sl[1],Pl=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e>1&&e<=100?Number((e/100).toFixed(4)):e<0?0:e>1?1:e}),[]),wl=(0,m.useCallback)((function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"==typeof e?e.toFixed(l):"-"}),[]),Zl=(0,m.useCallback)((function(e){return"number"==typeof e?Math.round(e).toString():"-"}),[]),Kl=(0,m.useCallback)((function(e){return"number"!=typeof e||Number.isNaN(e)?e:e<0?0:e>1?1:e}),[]),Ul=(0,m.useState)(null==ue||null===(t=ue.llm)||void 0===t?void 0:t.temperature),Ll=c()(Ul,2),Rl=Ll[0],Wl=Ll[1],Fl=(0,m.useState)(Pl(null==ue||null===(a=ue.llm)||void 0===a?void 0:a.topP)),Nl=c()(Fl,2),Al=Nl[0],Ol=Nl[1],zl=(0,m.useState)(null==ue||null===(r=ue.llm)||void 0===r?void 0:r.topK),Dl=c()(zl,2),Il=Dl[0],Vl=Dl[1],Bl=(0,m.useState)(Pl(null==ue||null===(s=ue.llm)||void 0===s?void 0:s.scoreThreshold)),ql=c()(Bl,2),Ql=ql[0],Gl=ql[1],Hl=(0,m.useState)(null==ue||null===(p=ue.llm)||void 0===p?void 0:p.maxTokens),$l=c()(Hl,2),Jl=($l[0],$l[1]),Xl=(0,m.useState)(null==ue||null===(P=ue.llm)||void 0===P?void 0:P.contextMsgCount),Yl=c()(Xl,2),_l=(Yl[0],Yl[1]),en=(0,m.useCallback)(function(){var e=d()(u()().mark((function e(l){var n,t,o,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Se(!0),e.prev=1,null!=ce&&ce.uid){e.next=5;break}return Me([]),e.abrupt("return",[]);case 5:return t={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==ce?void 0:ce.uid,searchText:l||""},e.next=8,(0,C.VW)(t);case 8:return o=e.sent,a=(null==o||null===(n=o.data)||void 0===n?void 0:n.content)||[],Me(a),e.abrupt("return",a);case 12:return e.prev=12,Se(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,,12,15]])})));return function(l){return e.apply(this,arguments)}}(),[null==ce?void 0:ce.uid]);(0,m.useEffect)((function(){var e,l,n,t,o,a,i,r,u,s,d,p,c,m,v,f,g,b,h,x,y,M,k,j,T,C,E,P;if(re){var w,Z,K;if(Ze((null==ue?void 0:ue.avatar)||""),Re((null==ue?void 0:ue.type)||S.f4h),Ne((null==ue?void 0:ue.system)||!1),fl(!(null==ue||null===(e=ue.llm)||void 0===e||!e.enabled)),xl(!(null==ue||!ue.kbEnabled)),jl(!(null==ue||null===(l=ue.llm)||void 0===l||!l.useLlmWhenKbEmpty)),null===(n=Ce.current)||void 0===n||n.setFieldsValue({nickname:null==ue?void 0:ue.nickname,type:null==ue?void 0:ue.type,settingsUid:null==ue||null===(t=ue.settings)||void 0===t?void 0:t.uid,name:null==ue?void 0:ue.name,categoryUid:null==ue?void 0:ue.categoryUid,provider:null==ue||null===(o=ue.llm)||void 0===o?void 0:o.textProvider,model:null==ue||null===(a=ue.llm)||void 0===a?void 0:a.textModel,prompt:null==ue||null===(i=ue.llm)||void 0===i?void 0:i.prompt,description:null==ue?void 0:ue.description,enabled:null==ue||null===(r=ue.llm)||void 0===r?void 0:r.enabled,enableThinking:null==ue||null===(u=ue.llm)||void 0===u?void 0:u.enableThinking,enableStreaming:null==ue||null===(s=ue.llm)||void 0===s?void 0:s.enableStreaming,useLlmWhenKbEmpty:null==ue||null===(d=ue.llm)||void 0===d?void 0:d.useLlmWhenKbEmpty,temperature:Kl(null==ue||null===(p=ue.llm)||void 0===p?void 0:p.temperature),topP:Pl(null==ue||null===(c=ue.llm)||void 0===c?void 0:c.topP),topK:null==ue||null===(m=ue.llm)||void 0===m?void 0:m.topK,scoreThreshold:Pl(null==ue||null===(v=ue.llm)||void 0===v?void 0:v.scoreThreshold),maxTokens:null==ue||null===(f=ue.llm)||void 0===f?void 0:f.maxTokens,contextMsgCount:null==ue||null===(g=ue.llm)||void 0===g?void 0:g.contextMsgCount,defaultReply:null==ue||null===(b=ue.llm)||void 0===b?void 0:b.defaultReply,searchType:(null==ue||null===(h=ue.llm)||void 0===h?void 0:h.searchType)||S.rk3,kbSourceEnabled:null==ue?void 0:ue.kbSourceEnabled,kbEnabled:null==ue?void 0:ue.kbEnabled,kbUid:null==ue?void 0:ue.kbUid}),null!=ue&&ue.llm&&(null!=ue&&null!==(x=ue.llm)&&void 0!==x&&x.textProviderUid||null!=ue&&null!==(y=ue.llm)&&void 0!==y&&y.textProvider||null!=ue&&null!==(M=ue.llm)&&void 0!==M&&M.textModel))_e((null==ue||null===(w=ue.llm)||void 0===w?void 0:w.textProvider)||""),tl((null==ue||null===(Z=ue.llm)||void 0===Z?void 0:Z.textProviderUid)||""),rl((null==ue||null===(K=ue.llm)||void 0===K?void 0:K.textModel)||"");else _e(""),tl(""),rl("");Wl(Kl(null==ue||null===(k=ue.llm)||void 0===k?void 0:k.temperature)),Ol(Pl(null==ue||null===(j=ue.llm)||void 0===j?void 0:j.topP)),Vl(null==ue||null===(T=ue.llm)||void 0===T?void 0:T.topK),Gl(Pl(null==ue||null===(C=ue.llm)||void 0===C?void 0:C.scoreThreshold)),Jl(null==ue||null===(E=ue.llm)||void 0===E?void 0:E.maxTokens),_l(null==ue||null===(P=ue.llm)||void 0===P?void 0:P.contextMsgCount),El(!1)}}),[re,ue]);var ln=function(){var e=d()(u()().mark((function e(l){var n,t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ze(l),!me||!ue){e.next=13;break}return e.prev=2,n={uid:null==ue?void 0:ue.uid,avatar:l},e.next=6,(0,j.lz)(n);case 6:200===(null==(t=e.sent)?void 0:t.code)?(k.yw.success(pe.formatMessage({id:"update.success",defaultMessage:"更新成功"})),null==de||de(t.data)):k.yw.error((null==t?void 0:t.message)||pe.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),k.yw.error(pe.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(l){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){re&&Le===S.f4h&&en()}),[re,Le,en]);var nn=(0,m.useMemo)((function(){return ye.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[ye]),tn=(0,m.useRef)(),on=(0,m.useCallback)((function(e){tn.current&&clearTimeout(tn.current),tn.current=setTimeout((function(){en(e)}),300)}),[en]);(0,m.useEffect)((function(){return function(){tn.current&&clearTimeout(tn.current)}}),[]);var an=(0,m.useCallback)((function(){ye.length||en()}),[ye.length,en]),rn=(0,m.useCallback)(d()(u()().mark((function e(){var l,n,t,o,a,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==ce?void 0:ce.uid,level:S.whQ},e.next=4,(0,z.mK)(l);case 4:200===(null==(n=e.sent)?void 0:n.code)&&(o=(null==n||null===(t=n.data)||void 0===t?void 0:t.content)||[],De(o),nl&&!Ye&&(a=o.find((function(e){return e.uid===nl})))&&_e(a.type),!nl&&Ye&&(i=o.find((function(e){return e.type===Ye})))&&tl(i.uid)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("fetchProviders error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[null==ce?void 0:ce.uid,nl,Ye]);(0,m.useEffect)((function(){re&&rn()}),[re,rn]);var un=(0,m.useCallback)((function(){return $e(!0)}),[]),sn=(0,m.useCallback)((function(){return $e(!1)}),[]),dn=(0,m.useCallback)((function(e,l){qe((function(n){return i()(i()({},n),{},o()({},e,l))}))}),[]),pn=(0,m.useCallback)((function(e,l,n){var t,o,a,i=ze.find((function(l){return l.uid===e})),r=i?i.type:e;_e(r),tl(e),rl(l),pl(n),null===(t=Ce.current)||void 0===t||t.setFieldsValue({provider:r,model:l});var u=null===(o=Ce.current)||void 0===o||null===(a=o.getFieldsValue)||void 0===a?void 0:a.call(o);if(u){var s,d,p,c,m,v,f,g,b,h,x,y,M,k,j,T,S,C,E,P,w,Z,K,U=(null==ue?void 0:ue.llm)||{},L=(null!==(s=u.prompt)&&void 0!==s?s:"")!==(null!==(d=U.prompt)&&void 0!==d?d:"")||(e||"")!==(null!==(p=U.textProviderUid)&&void 0!==p?p:"")||(r||u.provider||"")!==(null!==(c=U.textProvider)&&void 0!==c?c:"")||(l||u.model||"")!==(null!==(m=U.textModel)&&void 0!==m?m:"")||!!u.enabled!=!!U.enabled||!!u.enableThinking!=!!U.enableThinking||!!u.enableStreaming!=!!U.enableStreaming||!!u.useLlmWhenKbEmpty!=!!U.useLlmWhenKbEmpty||(null!==(v=u.temperature)&&void 0!==v?v:null)!==(null!==(f=U.temperature)&&void 0!==f?f:null)||(null!==(g=u.topP)&&void 0!==g?g:null)!==(null!==(b=U.topP)&&void 0!==b?b:null)||(null!==(h=u.topK)&&void 0!==h?h:null)!==(null!==(x=U.topK)&&void 0!==x?x:null)||(null!==(y=u.scoreThreshold)&&void 0!==y?y:null)!==(null!==(M=U.scoreThreshold)&&void 0!==M?M:null)||(null!==(k=u.maxTokens)&&void 0!==k?k:null)!==(null!==(j=U.maxTokens)&&void 0!==j?j:null)||(null!==(T=u.contextMsgCount)&&void 0!==T?T:null)!==(null!==(S=U.contextMsgCount)&&void 0!==S?S:null)||(null!==(C=u.defaultReply)&&void 0!==C?C:"")!==(null!==(E=U.defaultReply)&&void 0!==E?E:"")||(null!==(P=u.searchType)&&void 0!==P?P:"")!==(null!==(w=U.searchType)&&void 0!==w?w:""),R=!!u.kbEnabled!=!(null==ue||!ue.kbEnabled)||!!u.kbSourceEnabled!=!(null==ue||!ue.kbSourceEnabled)||(null!==(Z=u.kbUid)&&void 0!==Z?Z:"")!==(null!==(K=null==ue?void 0:ue.kbUid)&&void 0!==K?K:"");El(L||R)}$e(!1)}),[ze]);return(0,I.jsxs)(v.a,{onValuesChange:function(e,l){var n,t,o,a,i,r,u,s,d,p,c,m,v,f,g,b,h,x,y,M,k,j,T,S=(null==ue?void 0:ue.llm)||{},C=(null!==(n=l.prompt)&&void 0!==n?n:"")!==(null!==(t=S.prompt)&&void 0!==t?t:"")||(nl||"")!==(null!==(o=S.textProviderUid)&&void 0!==o?o:"")||(Ye||l.provider||"")!==(null!==(a=S.textProvider)&&void 0!==a?a:"")||(il||l.model||"")!==(null!==(i=S.textModel)&&void 0!==i?i:"")||!!l.enabled!=!!S.enabled||!!l.enableThinking!=!!S.enableThinking||!!l.enableStreaming!=!!S.enableStreaming||!!l.useLlmWhenKbEmpty!=!!S.useLlmWhenKbEmpty||(null!==(r=l.temperature)&&void 0!==r?r:null)!==(null!==(u=S.temperature)&&void 0!==u?u:null)||(null!==(s=l.topP)&&void 0!==s?s:null)!==(null!==(d=S.topP)&&void 0!==d?d:null)||(null!==(p=l.topK)&&void 0!==p?p:null)!==(null!==(c=S.topK)&&void 0!==c?c:null)||(null!==(m=l.scoreThreshold)&&void 0!==m?m:null)!==(null!==(v=S.scoreThreshold)&&void 0!==v?v:null)||(null!==(f=l.maxTokens)&&void 0!==f?f:null)!==(null!==(g=S.maxTokens)&&void 0!==g?g:null)||(null!==(b=l.contextMsgCount)&&void 0!==b?b:null)!==(null!==(h=S.contextMsgCount)&&void 0!==h?h:null)||(null!==(x=l.defaultReply)&&void 0!==x?x:"")!==(null!==(y=S.defaultReply)&&void 0!==y?y:"")||(null!==(M=l.searchType)&&void 0!==M?M:"")!==(null!==(k=S.searchType)&&void 0!==k?k:""),E=!!l.kbEnabled!=!(null==ue||!ue.kbEnabled)||!!l.kbSourceEnabled!=!(null==ue||!ue.kbSourceEnabled)||(null!==(j=l.kbUid)&&void 0!==j?j:"")!==(null!==(T=null==ue?void 0:ue.kbUid)&&void 0!==T?T:"");El(C||E)},open:re,onOpenChange:function(e){e||se()},title:pe.formatMessage({id:"robot.edit",defaultMessage:"编辑机器人"}),width:560,formRef:Ce,initialValues:me?{nickname:null==ue?void 0:ue.nickname,type:null==ue?void 0:ue.type,settingsUid:null==ue||null===(w=ue.settings)||void 0===w?void 0:w.uid,name:null==ue?void 0:ue.name,categoryUid:null==ue?void 0:ue.categoryUid,provider:null==ue||null===(Z=ue.llm)||void 0===Z?void 0:Z.textProvider,model:null==ue||null===(q=ue.llm)||void 0===q?void 0:q.textModel,prompt:null==ue||null===(Q=ue.llm)||void 0===Q?void 0:Q.prompt,description:null==ue?void 0:ue.description,enabled:null==ue||null===(G=ue.llm)||void 0===G?void 0:G.enabled,enableThinking:null==ue||null===(H=ue.llm)||void 0===H?void 0:H.enableThinking,enableStreaming:null==ue||null===($=ue.llm)||void 0===$?void 0:$.enableStreaming,useLlmWhenKbEmpty:null==ue||null===(J=ue.llm)||void 0===J?void 0:J.useLlmWhenKbEmpty,temperature:Kl(null==ue||null===(X=ue.llm)||void 0===X?void 0:X.temperature),topP:Pl(null==ue||null===(Y=ue.llm)||void 0===Y?void 0:Y.topP),topK:null==ue||null===(_=ue.llm)||void 0===_?void 0:_.topK,scoreThreshold:Pl(null==ue||null===(ee=ue.llm)||void 0===ee?void 0:ee.scoreThreshold),maxTokens:null==ue||null===(le=ue.llm)||void 0===le?void 0:le.maxTokens,contextMsgCount:null==ue||null===(ne=ue.llm)||void 0===ne?void 0:ne.contextMsgCount,defaultReply:null==ue||null===(te=ue.llm)||void 0===te?void 0:te.defaultReply,searchType:(null==ue||null===(oe=ue.llm)||void 0===oe?void 0:oe.searchType)||S.rk3,kbSourceEnabled:null==ue?void 0:ue.kbSourceEnabled,kbEnabled:null==ue?void 0:ue.kbEnabled,kbUid:null==ue?void 0:ue.kbUid}:{type:S.f4h,searchType:S.rk3},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0,extra:(0,I.jsxs)("div",{children:[(0,I.jsx)(K.ZP,{style:{marginRight:8},onClick:function(){return se()},children:pe.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,I.jsx)(K.ZP,{type:"primary",onClick:function(){var e,l;return null===(e=Ce.current)||void 0===e||null===(l=e.submit)||void 0===l?void 0:l.call(e)},children:pe.formatMessage({id:"save",defaultMessage:"保存"})})]})},submitter:{render:function(){return[]}},onFinish:function(){var e=d()(u()().mark((function e(l){var n,t,o,a,i,r,s,d,p,c,m,v,f,g,b,h,x,y,M,T,C,E,P,w,Z,K,U,L,R,W,F,N;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,me&&null!=ue&&ue.uid){e.next=4;break}return k.yw.warning(pe.formatMessage({id:"robot.edit.only",defaultMessage:"当前仅支持编辑，请通过新建入口创建机器人"})),e.abrupt("return",!1);case 4:return Z=(null==ue?void 0:ue.llm)||{},K=(null!==(n=l.prompt)&&void 0!==n?n:"")!==(null!==(t=Z.prompt)&&void 0!==t?t:"")||(nl||"")!==(null!==(o=Z.textProviderUid)&&void 0!==o?o:"")||(Ye||l.provider||"")!==(null!==(a=Z.textProvider)&&void 0!==a?a:"")||(il||l.model||"")!==(null!==(i=Z.textModel)&&void 0!==i?i:"")||!!l.enabled!=!!Z.enabled||!!l.enableThinking!=!!Z.enableThinking||!!l.enableStreaming!=!!Z.enableStreaming||!!l.useLlmWhenKbEmpty!=!!Z.useLlmWhenKbEmpty||(null!==(r=l.temperature)&&void 0!==r?r:null)!==(null!==(s=Z.temperature)&&void 0!==s?s:null)||(null!==(d=l.topP)&&void 0!==d?d:null)!==(null!==(p=Z.topP)&&void 0!==p?p:null)||(null!==(c=l.topK)&&void 0!==c?c:null)!==(null!==(m=Z.topK)&&void 0!==m?m:null)||(null!==(v=l.scoreThreshold)&&void 0!==v?v:null)!==(null!==(f=Z.scoreThreshold)&&void 0!==f?f:null)||(null!==(g=l.maxTokens)&&void 0!==g?g:null)!==(null!==(b=Z.maxTokens)&&void 0!==b?b:null)||(null!==(h=l.contextMsgCount)&&void 0!==h?h:null)!==(null!==(x=Z.contextMsgCount)&&void 0!==x?x:null)||(null!==(y=l.defaultReply)&&void 0!==y?y:"")!==(null!==(M=Z.defaultReply)&&void 0!==M?M:"")||(null!==(T=l.searchType)&&void 0!==T?T:"")!==(null!==(C=Z.searchType)&&void 0!==C?C:""),U=!!l.kbEnabled!=!(null==ue||!ue.kbEnabled)||!!l.kbSourceEnabled!=!(null==ue||!ue.kbSourceEnabled)||(null!==(E=l.kbUid)&&void 0!==E?E:"")!==(null!==(P=null==ue?void 0:ue.kbUid)&&void 0!==P?P:""),L=K||U,k.yw.loading(pe.formatMessage({id:me?"updating":"creating",defaultMessage:me?"Updating":"Creating"})),W={uid:null==ue?void 0:ue.uid,nickname:l.nickname,name:l.name,type:l.type||S.f4h,description:l.description,avatar:we,settingsUid:l.settingsUid,kbSourceEnabled:l.kbSourceEnabled,kbEnabled:l.kbEnabled,kbUid:l.kbUid,llm:{prompt:l.prompt,textProvider:Ye||l.provider,textProviderUid:nl||void 0,textModel:il||l.model,enabled:l.enabled,enableThinking:l.enableThinking,enableStreaming:l.enableStreaming,useLlmWhenKbEmpty:l.useLlmWhenKbEmpty,temperature:Kl(l.temperature),topP:Pl(l.topP),topK:l.topK,scoreThreshold:Pl(l.scoreThreshold),maxTokens:l.maxTokens,contextMsgCount:l.contextMsgCount,defaultReply:l.defaultReply,searchType:l.searchType}},e.next=12,(0,j.$l)(W);case 12:if(R=e.sent,console.log("updateRobot:",R,W),k.yw.destroy(),200!==(null===(w=R)||void 0===w?void 0:w.code)){e.next=23;break}return k.yw.success(pe.formatMessage({id:"save.success",defaultMessage:"保存成功"})),L&&k.yw.info(pe.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),5),null==de||de(null===(F=R)||void 0===F?void 0:F.data),se(),e.abrupt("return",!0);case 23:return k.yw.error((null===(N=R)||void 0===N?void 0:N.message)||pe.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),k.yw.destroy(),k.yw.error(pe.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(l){return e.apply(this,arguments)}}(),children:[(0,I.jsx)(U.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:pe.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"头像"}),children:(0,I.jsxs)(A.G,{onSuccess:ln,onError:function(e){console.log("Avatar upload error:",e)},children:[(0,I.jsx)(L.Z,{src:we}),(0,I.jsx)(K.ZP,{icon:(0,I.jsx)(N.Z,{}),style:{marginLeft:12},children:pe.formatMessage({id:"pages.robot.upload",defaultMessage:"上传"})})]},"avatar")}),(0,I.jsx)(f.Z,{name:"nickname",label:pe.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:pe.formatMessage({id:"nickname",defaultMessage:"昵称"})}]}),(0,I.jsx)(g.Z,{name:"description",label:pe.formatMessage({id:"description",defaultMessage:"描述"})}),Le===S.f4h&&(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(b.A.Item,{name:"settingsUid",label:pe.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),rules:[{required:!0,message:pe.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,I.jsx)(B,{options:nn,loading:Te,placeholder:pe.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),emptyContent:0===nn.length?(0,I.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,I.jsx)("div",{style:{marginBottom:8,color:"#999"},children:pe.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,I.jsx)(K.ZP,{size:"small",type:"primary",icon:(0,I.jsx)(F.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return be(!0)},children:pe.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:on,onDropdownOpen:an,onCreate:function(){return be(!0)},createLabel:pe.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:pe.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})})}),(0,I.jsx)(h.Z,{name:"enabled",label:pe.formatMessage({id:"pages.prompt.enabled",defaultMessage:"启用大模型问答"}),fieldProps:{onChange:function(e){return fl(e)}}}),vl&&(0,I.jsxs)(m.Fragment,{children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(V,{style:{marginBottom:8,display:"block"},children:pe.formatMessage({id:"pages.prompt.textProvider.cardTitle",defaultMessage:"文字对话模型提供商"})}),(0,I.jsx)(R.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:16},onClick:un,children:(nl||Ye)&&il?(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(V,{type:"secondary",children:pe.formatMessage({id:"pages.prompt.provider.colon",defaultMessage:"供应商："})}),(0,I.jsx)(V,{strong:!0,children:(null===(ae=ze.find((function(e){return e.uid===nl})))||void 0===ae?void 0:ae.nickname)||(null===(ie=ze.find((function(e){return e.type===Ye})))||void 0===ie?void 0:ie.nickname)||Ye}),(0,I.jsx)("br",{}),(0,I.jsx)(V,{type:"secondary",children:pe.formatMessage({id:"pages.prompt.model.colon",defaultMessage:"模型："})}),(0,I.jsx)(V,{strong:!0,children:dl||il})]}),(0,I.jsx)(K.ZP,{type:"primary",children:pe.formatMessage({id:"pages.prompt.changeModel",defaultMessage:"更换模型"})})]}):(0,I.jsx)("div",{style:{textAlign:"center"},children:(0,I.jsx)(K.ZP,{type:"primary",children:pe.formatMessage({id:"pages.prompt.selectModel",defaultMessage:"选择AI模型"})})})}),(0,I.jsxs)("div",{style:{display:"none"},children:[(0,I.jsx)(x.Z,{name:"provider"}),(0,I.jsx)(x.Z,{name:"model"})]})]}),(0,I.jsx)(y.Z,{name:"temperature",label:(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,I.jsx)("span",{children:pe.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"})}),(0,I.jsx)("span",{style:{color:"#999"},children:": "+wl(Rl,2)})]}),tooltip:pe.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"控制输出的随机性，值越高输出越随机创新"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Wl(Kl(e))}}}),(0,I.jsx)(y.Z,{name:"topP",label:(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,I.jsx)("span",{children:pe.formatMessage({id:"pages.prompt.topP",defaultMessage:"Top P"})}),(0,I.jsx)("span",{style:{color:"#999"},children:": "+wl(Al,2)})]}),tooltip:pe.formatMessage({id:"pages.prompt.topP.tooltip",defaultMessage:"Top P 采样阈值，保留累计概率达到该值的词，范围 0-1，值越小越保守"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Ol(Kl(e))}}}),(0,I.jsx)(y.Z,{name:"topK",label:(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,I.jsx)("span",{children:pe.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"})}),(0,I.jsx)("span",{style:{color:"#999"},children:": "+Zl(Il)})]}),tooltip:pe.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"检索时返回的相关文档数量"}),fieldProps:{min:0,max:100,step:1,onChange:function(e){return Vl(e)}}}),(0,I.jsx)(y.Z,{name:"scoreThreshold",label:(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,I.jsx)("span",{children:pe.formatMessage({id:"pages.prompt.scoreThreshold",defaultMessage:"得分阈值"})}),(0,I.jsx)("span",{style:{color:"#999"},children:": "+wl(Ql,2)})]}),tooltip:pe.formatMessage({id:"pages.prompt.scoreThreshold.tooltip",defaultMessage:"知识库召回命中文档的最低得分阈值，低于此值不纳入参考"}),min:0,max:1,step:.01,marks:{0:"0",.25:"0.25",.5:"0.5",.75:"0.75",1:"1"},fieldProps:{tooltip:{formatter:function(e){return"number"==typeof e?e.toFixed(2):String(e)}},onChange:function(e){return Gl(Kl(e))}}}),!1,(0,I.jsx)(g.Z,{name:"prompt",label:pe.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})}),(0,I.jsx)(h.Z,{name:"useLlmWhenKbEmpty",label:pe.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty",defaultMessage:"知识库空结果时使用大模型"}),tooltip:pe.formatMessage({id:"pages.prompt.useLlmWhenKbEmpty.tips",defaultMessage:"开启后，当知识库没有命中时将继续调用大模型回答；关闭则返回默认回复"}),fieldProps:{onChange:function(e){return jl(e)}}}),!kl&&(0,I.jsx)(g.Z,{name:"defaultReply",label:pe.formatMessage({id:"pages.prompt.defaultReply",defaultMessage:"默认回复"})})]}),(0,I.jsxs)(m.Fragment,{children:[(0,I.jsx)(h.Z,{name:"kbEnabled",label:pe.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"启用知识库"}),fieldProps:{onChange:function(e){return xl(e)}}}),hl&&(0,I.jsxs)(m.Fragment,{children:[(0,I.jsx)(h.Z,{name:"kbSourceEnabled",label:pe.formatMessage({id:"pages.prompt.kbSourceEnabled",defaultMessage:"显示知识库来源"}),tooltip:pe.formatMessage({id:"pages.prompt.kbSourceEnabled.tips",defaultMessage:"开启后将在回复中显示知识库命中来源，便于调试不同检索类型的搜索结果"})}),(0,I.jsx)(x.Z,{name:"searchType",label:pe.formatMessage({id:"pages.prompt.searchType",defaultMessage:"检索类型"}),valueEnum:o()(o()(o()({},S.ccx,{text:"全文"}),S.DGp,{text:"向量"}),S.rk3,{text:"混合"})}),(0,I.jsx)(x.Z,{name:"kbUid",label:pe.formatMessage({id:"pages.prompt.kbUid",defaultMessage:"知识库"}),placeholder:pe.formatMessage({id:"pages.prompt.kbUid.placeholder",defaultMessage:"请选择知识库"}),showSearch:!0,debounceTime:300,request:function(){var e=d()(u()().mark((function e(l){var n,t,o,a,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.keyWords,e.prev=1,o={pageNumber:0,pageSize:50,type:S.QPQ,orgUid:null==ce?void 0:ce.uid,searchText:n||""},e.next=5,(0,D.AP)(o);case 5:return a=e.sent,i=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],e.abrupt("return",i.map((function(e){return{label:e.name||e.uid,value:e.uid}})));case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(l){return e.apply(this,arguments)}}()})]})]}),Cl&&(0,I.jsx)(W.Z,{type:"info",showIcon:!0,message:pe.formatMessage({id:"robot.session.refresh.tips",defaultMessage:"LLM/知识库相关配置已更新，刷新或重新进入机器人会话后生效"}),style:{marginBottom:12}}),(0,I.jsx)(O.Z,{visible:He,onCancel:sn,onOk:pn,initialProvider:nl||Ye,initialModel:il,initialModelLabel:dl,providers:ze,currentOrgUid:null==ce?void 0:ce.uid,existingProviderModels:Be,onModelsLoaded:dn,allowedModelTypes:[S.l55,S.xZ8,"CHAT"]}),(0,I.jsx)(E.Z,{open:ge,onOpenChange:be,orgUid:(null==ce?void 0:ce.uid)||"",record:null,onSuccess:function(){be(!1),en()}})]})}}}]);