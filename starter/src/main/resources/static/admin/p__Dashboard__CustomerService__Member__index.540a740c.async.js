"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[652],{72844:function(oe,L,r){r.r(L),r.d(L,{default:function(){return l}});var A=r(90518),x=r(34886),w=r(52983),m=r(90819),F=r.n(m),O=r(89933),R=r.n(O),N=r(45332),I=r.n(N),P=r(13664),K=r(41900),f=r(77159),k=r(3206),$=r(45312),W=r(29263),y=r(64116),ae=r(97596),e=r(97458),H=function(){var a=f.Z.useForm(),h=I()(a,1),p=h[0],D=(0,w.useState)(!1),M=I()(D,2),Q=M[0],T=M[1],j=(0,A.u)(function(c){return{depCurrent:c.depCurrent,depOptions:c.depOptions,departments:c.departments,createMem:c.createMem,setDepCurrent:c.setDepCurrent}}),Z=j.depCurrent,z=j.depOptions,te=j.departments,X=j.createMem,Y=j.setDepCurrent,q=(0,w.useMemo)(function(){return Z.name==="DEPT_CS"?Z.members:[]},[Z]),_=function(){T(!0)},ee=function(){var c=R()(F()().mark(function v(){var b,C,S,G,ne,E,ue,le;return F()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(b=p.getFieldValue("jobNo"),C=p.getFieldValue("realname"),S=p.getFieldValue("seatNo"),G=p.getFieldValue("telephone"),ne=p.getFieldValue("mobile"),E=p.getFieldValue("email"),ue=Z.did,console.log("realname",C),Z.did!==""){V.next=11;break}return k.ZP.error("please choose a department"),V.abrupt("return");case 11:C?(le={jobNo:b,realname:C,seatNo:S,telephone:G,mobile:ne,email:E,dep_did:ue},X(le),T(!1)):k.ZP.error("name should not be null");case 12:case"end":return V.stop()}},v)}));return function(){return c.apply(this,arguments)}}(),se=function(){T(!1)},re=function(){console.log("new mem"),_()},g=function(v){console.log("select checked",v),Y(v)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.Z,{title:"\u6DFB\u52A0\u6210\u5458",open:Q,onOk:ee,onCancel:se,children:(0,e.jsxs)(f.Z,{form:p,name:"memForm",initialValues:{dep_did:Z.did},children:[(0,e.jsx)(f.Z.Item,{label:"\u90E8\u95E8",name:"dep_did",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u90E8\u95E8!"}],children:(0,e.jsx)(W.Z,{options:z,onChange:g})}),(0,e.jsx)(f.Z.Item,{label:"\u59D3\u540D",name:"realname",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D!"}],children:(0,e.jsx)(y.Z,{})}),(0,e.jsx)(f.Z.Item,{label:"\u624B\u673A\u53F7",name:"mobile",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7!"}],children:(0,e.jsx)(y.Z,{})}),(0,e.jsx)(f.Z.Item,{label:"\u5DE5\u53F7",name:"jobNo",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5DE5\u53F7!"}],children:(0,e.jsx)(y.Z,{})}),(0,e.jsx)(f.Z.Item,{label:"\u5EA7\u4F4D\u53F7",name:"seatNo",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5EA7\u4F4D\u53F7!"}],children:(0,e.jsx)(y.Z,{})}),(0,e.jsx)(f.Z.Item,{label:"\u5206\u673A\u53F7",name:"telephone",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5206\u673A\u53F7!"}],children:(0,e.jsx)(y.Z,{})}),(0,e.jsx)(f.Z.Item,{label:"\u90AE\u7BB1",name:"email",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"}],children:(0,e.jsx)(y.Z,{})})]})}),(0,e.jsx)(ae.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(P.Z,{}),onClick:re,children:"create agent"}),(0,e.jsx)(K.Rs,{rowKey:"id",headerTitle:"DEPT_CS",dataSource:q,showActions:"hover",editable:{onSave:function(){var c=R()(F()().mark(function b(C,S,G){return F()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return console.log(C,S,G),E.abrupt("return",!0);case 2:case"end":return E.stop()}},b)}));function v(b,C,S){return c.apply(this,arguments)}return v}()},metas:{title:{dataIndex:"realname"},avatar:{dataIndex:"user.avatar",editable:!1},description:{dataIndex:"user.description",render:function(v){return(0,e.jsx)("div",{children:v})}},actions:{render:function(v,b,C,S){return[(0,e.jsx)("a",{onClick:function(){S==null||S.startEditable(b.mid)},children:"\u7F16\u8F91"},"link")]}}}})]})},B=H,J=r(23598),U=function(){var a=f.Z.useForm(),h=I()(a,1),p=h[0],D=(0,w.useState)(!1),M=I()(D,2),Q=M[0],T=M[1],j=(0,A.u)(function(g){return{depCurrent:g.depCurrent,departments:g.departments,createDep:g.createDep,setDepCurrent:g.setDepCurrent}}),Z=j.depCurrent,z=j.departments,te=j.createDep,X=j.setDepCurrent,Y=(0,w.useMemo)(function(){return z.filter(function(g){return g.label==="DEPT_CS"})},[z]),q=function(){T(!0)},_=function(){var g=R()(F()().mark(function c(){var v;return F()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:v=p.getFieldValue("nickname"),console.log("nickname",v),v?(te(v),T(!1)):k.ZP.error("\u6635\u79F0\u4E0D\u80FD\u4E3A\u7A7A");case 3:case"end":return C.stop()}},c)}));return function(){return g.apply(this,arguments)}}(),ee=function(){T(!1)},se=function(){console.log("new dep"),q()},re=function(c){X(c.key)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{onClick:re,defaultSelectedKeys:[Z.did],mode:"inline",items:Y}),(0,e.jsx)($.Z,{title:"\u521B\u5EFA\u90E8\u95E8",open:Q,onOk:_,onCancel:ee,children:(0,e.jsx)(f.Z,{form:p,name:"depForm",style:{maxWidth:400},children:(0,e.jsx)(f.Z.Item,{label:"\u90E8\u95E8\u540D\u79F0",name:"nickname",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0!"}],children:(0,e.jsx)(y.Z,{})})})})]})},o=U,t=x.Z.Sider,d=x.Z.Content,n={margin:"10px",minHeight:120,backgroundColor:"#EEFAE0"},u={margin:"10px",backgroundColor:"#EEFAE0",borderRight:"1px solid #ccc"},s=function(){var a=(0,A.u)(function(h){return h.queryOrgs});return(0,w.useEffect)(function(){a()},[]),(0,e.jsxs)(x.Z,{children:[(0,e.jsx)(t,{style:u,children:(0,e.jsx)(o,{})}),(0,e.jsx)(x.Z,{children:(0,e.jsx)(d,{style:n,children:(0,e.jsx)(B,{})})})]})},l=s},90518:function(oe,L,r){r.d(L,{u:function(){return U}});var A=r(76711),x=r.n(A),w=r(90819),m=r.n(w),F=r(89933),O=r.n(F),R=r(73193),N=r(77108);function I(o){return P.apply(this,arguments)}function P(){return P=O()(m()().mark(function o(t){return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,N.request)("/api/org",{method:"POST",data:{nickname:t,client:"web"}}));case 1:case"end":return n.stop()}},o)})),P.apply(this,arguments)}function K(o,t,d){return f.apply(this,arguments)}function f(){return f=O()(m()().mark(function o(t,d,n){return m()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,N.request)("/api/v1/dep/create",{method:"POST",data:{nickname:t,parent_did:d,org_oid:n,client:"web"}}));case 1:case"end":return s.stop()}},o)})),f.apply(this,arguments)}function k(o){return $.apply(this,arguments)}function $(){return $=O()(m()().mark(function o(t){return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,N.request)("/api/v1/mem/create",{method:"POST",data:{jobNo:t.jobNo,realname:t.realname,seatNo:t.seatNo,telephone:t.telephone,mobile:t.mobile,email:t.email,dep_did:t.dep_did,client:"web"}}));case 1:case"end":return n.stop()}},o)})),$.apply(this,arguments)}function W(o,t){return y.apply(this,arguments)}function y(){return y=O()(m()().mark(function o(t,d){return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,N.request)("/api/v1/org/query",{method:"GET",params:{pageNumber:t,pageSize:d,client:"web"}}));case 1:case"end":return u.stop()}},o)})),y.apply(this,arguments)}function ae(o){return e.apply(this,arguments)}function e(){return e=_asyncToGenerator(_regeneratorRuntime().mark(function o(t){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/org",_objectSpread({method:"GET",params:{client:"web"}},t||{})));case 1:case"end":return n.stop()}},o)})),e.apply(this,arguments)}var H=r(14618),B=r(58472),J=r(53083),U=(0,H.Ue)()((0,B.mW)((0,B.tJ)((0,J.n)(function(o,t){return{orgCurrent:{oid:"",name:"",avatar:"",description:""},depOptions:[],depCurrent:{did:""},departments:[],createOrg:function(){var d=O()(m()().mark(function u(s){var l;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I(s);case 2:l=a.sent,console.log("createOrg:",l),l.statusCode==200&&t().transferOrgToTree(l.data);case 5:case"end":return a.stop()}},u)}));function n(u){return d.apply(this,arguments)}return n}(),createDep:function(){var d=O()(m()().mark(function u(s){var l,i,a,h;return m()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return l=t().orgCurrent.oid,D.next=3,K(s,"",l);case 3:i=D.sent,console.log("createDep:",i),i.statusCode==200&&(a={label:i.data.name,key:i.data.did},h={label:i.data.name,value:i.data.did},o({depOptions:[].concat(x()(t().depOptions),[h]),departments:[].concat(x()(t().departments),[a])}));case 6:case"end":return D.stop()}},u)}));function n(u){return d.apply(this,arguments)}return n}(),setDepCurrent:function(n){for(var u=t().orgCurrent.departments,s=0;s<u.length;s++){var l=u[s];l.did===n&&o({depCurrent:l})}},createMem:function(){var d=O()(m()().mark(function u(s){var l,i,a,h,p;return m()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,k(s);case 2:if(l=M.sent,console.log("createMem:",s.dep_did,l),l.statusCode==200){for(i=t().orgCurrent,a=i.departments,h=0;h<a.length;h++)p=a[h],p.did===s.dep_did&&(p.members=[l.data].concat(x()(p.members))),a[h]=p;i.departments=a,o({orgCurrent:i})}case 5:case"end":return M.stop()}},u)}));function n(u){return d.apply(this,arguments)}return n}(),queryOrgs:function(){var d=O()(m()().mark(function u(){var s,l;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,W(0,10);case 2:if(s=a.sent,console.log("refresh orgs:",s),s.data.content.length!=0){a.next=6;break}return a.abrupt("return");case 6:l=s.data.content[0],t().transferOrgToTree(l);case 8:case"end":return a.stop()}},u)}));function n(){return d.apply(this,arguments)}return n}(),transferOrgToTree:function(n){for(var u=[],s=[],l=0;l<n.departments.length;l++){var i=n.departments[l],a={label:i.name,key:i.did};s.push(a);var h={label:i.name,value:i.did};u.push(h)}o({orgCurrent:n,depOptions:u,departments:s})},deleteOrgCache:function(){return o({},!0)}}}),{name:"ORGANIZTION_STORE"})))}}]);
