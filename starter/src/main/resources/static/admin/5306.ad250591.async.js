"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5306],{93237:function(e,t,n){n.d(t,{Lr:function(){return h},_t:function(){return c},sE:function(){return p},x_:function(){return g}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(27353),d=n(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},42013:function(e,t,n){n.d(t,{IH:function(){return g},RB:function(){return M},SJ:function(){return h},Xy:function(){return y},iO:function(){return k},u9:function(){return c},wU:function(){return p}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(27353),d=n(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/enable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return w.apply(this,arguments)}function w(){return(w=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/disable",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return S.apply(this,arguments)}function S(){return(S=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},8369:function(e,t,n){n.d(t,{D$:function(){return g},EP:function(){return h},hS:function(){return p},z_:function(){return c}});var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(27353),d=n(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},97247:function(e,t,n){var a=n(90819),r=n.n(a),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(45332),d=n.n(l),c=n(44194),f=n(69159),g=n(35746),m=n(31461),p=n(50693),v=n(2290),h=n(50884),b=n(42013),M=n(31549);t.Z=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,s=e.record,u=e.onSuccess,l=(0,v.useIntl)(),x=f.Z.useForm(),k=d()(x,1)[0];(0,c.useEffect)((function(){var e,n;t&&(s?k.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(k.resetFields(),k.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,k]);var w=function(){var e=o()(r()().mark((function e(){var t,o,d,c;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.validateFields();case 3:if(t=e.sent,o=i()(i()({},t),{},{orgUid:a,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,b.wU)(o);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,b.IH)(o);case 13:e.t0=e.sent;case 14:(d=e.t0)&&200===d.code?(c=(null==d?void 0:d.data)||{},h.yw.success(l.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==u||u(c),n(!1)):h.yw.error((null==d?void 0:d.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving agent settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,M.jsx)(g.Z,{title:(0,M.jsx)(v.FormattedMessage,{id:null!=s&&s.uid?"agent.settings.template.edit":"agent.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:w,onCancel:function(){n(!1)},okText:(0,M.jsx)(v.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,M.jsx)(v.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,M.jsxs)(f.Z,{form:k,layout:"vertical",preserve:!1,children:[(0,M.jsx)(f.Z.Item,{name:"name",label:(0,M.jsx)(v.FormattedMessage,{id:"agent.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,M.jsx)(m.Z,{placeholder:l.formatMessage({id:"agent.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,M.jsx)(f.Z.Item,{name:"description",label:(0,M.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(m.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"agent.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,M.jsx)(f.Z.Item,{name:"enabled",label:(0,M.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,M.jsx)(p.Z,{})})]})})}},85306:function(e,t,n){n.d(t,{Z:function(){return $}});var a=n(86222),r=n.n(a),s=n(73193),i=n.n(s),u=n(90819),o=n.n(u),l=n(89933),d=n.n(l),c=n(45332),f=n.n(c),g=n(44194),m=n(2290),p=n(77601),v=n(83801),h=n(38623),b=n(70937),M=n(90883),x=n(50884),k=n(93237),w=n(28520),y=n(27353),S=n(76711),j=n.n(S),Z=n(89622),C=n(97588),U=n(17455),T=n(67186),q=n(83788),I=n(46206),O=n(25456),F=n(6992),P=n(22014),A=n(8369),E=n(42013),R=n(97247),D=n(43420),N=n(31549),z=function(e){var t=e.value,n=e.onChange,a=e.options,r=e.loading,s=e.placeholder,i=e.emptyContent,u=e.onSearch,o=e.onDropdownOpen,l=e.onCreate,d=e.createLabel,c=e.createTitle;return(0,N.jsxs)(I.Z.Compact,{block:!0,children:[(0,N.jsx)(O.Z,{value:t,onChange:n,options:a,showSearch:!0,filterOption:!1,placeholder:s,loading:r,style:{flex:1},notFoundContent:i,onSearch:u,onOpenChange:function(e){e&&o()}}),(0,N.jsx)(M.ZP,{size:"small",icon:(0,N.jsx)(F.Z,{}),onClick:l,title:c,children:d})]})},J=function(e){var t,n,a=e.open,r=e.record,s=e.onClose,u=e.onSuccess,l=(0,m.useIntl)(),c=(0,w.u)((function(e){return e.currentOrg})),p=(0,g.useState)(!1),h=f()(p,2),b=h[0],y=h[1],S=(0,g.useState)([]),I=f()(S,2),O=I[0],J=I[1],X=(0,g.useState)(!1),V=f()(X,2),B=V[0],L=V[1],_=(0,g.useState)((null==r?void 0:r.avatar)||""),G=f()(_,2),H=G[0],W=G[1],K=(0,g.useRef)(),Q=(0,g.useMemo)((function(){return!(null==r||!r.uid)}),[r]),$=function(){var e=d()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W(t),x.yw.success(l.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=(0,g.useCallback)(function(){var e=d()(o()().mark((function e(t){var n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(!0),e.prev=1,null!=c&&c.uid){e.next=5;break}return J([]),e.abrupt("return",[]);case 5:return a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==c?void 0:c.uid,searchText:t||""},e.next=8,(0,E.u9)(a);case 8:return r=e.sent,console.log("queryAgentSettingsByOrg request:",a,r),s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],J(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 13:return e.prev=13,L(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==c?void 0:c.uid]);(0,g.useEffect)((function(){Y()}),[Y]);var ee=(0,g.useMemo)((function(){return O.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}}))}),[O]),te=(0,g.useRef)(),ne=(0,g.useCallback)((function(e){te.current&&clearTimeout(te.current),te.current=setTimeout((function(){Y(e)}),300)}),[Y]);(0,g.useEffect)((function(){return function(){te.current&&clearTimeout(te.current)}}),[]);var ae=(0,g.useCallback)((function(){O.length||Y()}),[Y,O.length]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(Z.a,{open:a,onOpenChange:function(e){e||s()},title:Q?l.formatMessage({id:"agent.edit",defaultMessage:"编辑客服"}):l.formatMessage({id:"agent.new",defaultMessage:"新建客服"}),width:520,formRef:K,initialValues:Q?{nickname:null==r?void 0:r.nickname,agentNo:null==r?void 0:r.agentNo,email:null==r?void 0:r.email,mobile:null==r?void 0:r.mobile,description:null==r?void 0:r.description,memberUid:(null==r||null===(t=r.member)||void 0===t?void 0:t.uid)||(null==r?void 0:r.memberUid),settingsUid:null==r||null===(n=r.settings)||void 0===n?void 0:n.uid}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:l.formatMessage({id:"save",defaultMessage:"保存"}),resetText:l.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return s()}}},onFinish:function(){var e=d()(o()().mark((function e(t){var n,a,d,f,g;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.yw.loading(l.formatMessage({id:Q?"updating":"creating",defaultMessage:Q?"Updating":"Creating"})),!Q){e.next=10;break}return d=i()(i()(i()({},r),t),{},{avatar:H||(null==r?void 0:r.avatar)}),e.next=6,(0,k.sE)(d);case 6:a=e.sent,console.log("updateAgent payload:",d,a),e.next=15;break;case 10:return f={nickname:t.nickname,agentNo:t.agentNo,email:t.email,mobile:t.mobile,description:t.description,memberUid:t.memberUid,settingsUid:t.settingsUid,orgUid:null==c?void 0:c.uid,avatar:H},e.next=13,(0,k.x_)(f);case 13:a=e.sent,console.log("createAgent payload:",f,a);case 15:if(x.yw.destroy(),200!==(null===(n=a)||void 0===n?void 0:n.code)){e.next=23;break}return x.yw.success(l.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==u||u(a.data),s(),e.abrupt("return",!0);case 23:return x.yw.error((null===(g=a)||void 0===g?void 0:g.message)||l.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 25:e.next=32;break;case 27:return e.prev=27,e.t0=e.catch(0),x.yw.destroy(),x.yw.error(l.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,N.jsx)(C.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:l.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,N.jsxs)(D.G,{onSuccess:$,onError:function(e){x.yw.error(String(e))},children:[(0,N.jsx)(v.Z,{src:H||(null==r?void 0:r.avatar)}),(0,N.jsxs)(M.ZP,{icon:(0,N.jsx)(P.Z,{}),children:[" ",l.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})]})]})}),(0,N.jsx)(U.Z,{name:"memberUid",label:l.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),placeholder:l.formatMessage({id:"agent.info.member.placeholder",defaultMessage:"请选择成员"}),disabled:Q,rules:Q?[]:[{required:!0,message:l.formatMessage({id:"agent.info.member.required",defaultMessage:"请选择成员"})}],showSearch:!0,debounceTime:300,request:function(){var e=d()(o()().mark((function e(t){var n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.keyWords,e.next=3,(0,A.z_)({pageNumber:0,pageSize:20,orgUid:null==c?void 0:c.uid,searchText:a||""});case 3:return r=e.sent,s=(null==r||null===(n=r.data)||void 0===n?void 0:n.content)||[],e.abrupt("return",s.map((function(e){return{label:e.nickname,value:e.uid}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1}}),(0,N.jsx)(C.A.Item,{name:"settingsUid",label:l.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),rules:[{required:!0,message:l.formatMessage({id:"agent.settings.required",defaultMessage:"请选择客服配置"})}],children:(0,N.jsx)(z,{options:ee,loading:B,placeholder:l.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"}),emptyContent:0===ee.length?(0,N.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,N.jsx)("div",{style:{marginBottom:8,color:"#999"},children:l.formatMessage({id:"agent.settings.empty",defaultMessage:"暂无配置模板"})}),(0,N.jsx)(M.ZP,{size:"small",type:"primary",icon:(0,N.jsx)(F.Z,{}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){return y(!0)},children:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})]}):void 0,onSearch:ne,onDropdownOpen:ae,onCreate:function(){return y(!0)},createLabel:l.formatMessage({id:"common.new",defaultMessage:"新建"}),createTitle:l.formatMessage({id:"agent.settings.create",defaultMessage:"创建配置"})})}),(0,N.jsx)(T.Z,{name:"nickname",label:l.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.nickname.required"})}]}),(0,N.jsx)(T.Z,{name:"agentNo",label:l.formatMessage({id:"agent.no",defaultMessage:"客服工号"}),placeholder:l.formatMessage({id:"agent.no.placeholder",defaultMessage:"例如：A001"})}),(0,N.jsx)(T.Z,{name:"email",label:l.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.email.required"})}]}),(0,N.jsx)(T.Z,{name:"mobile",label:l.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),rules:[{required:!0,message:l.formatMessage({id:"agent.info.mobile.required"})}]}),(0,N.jsx)(q.Z,{name:"description",label:l.formatMessage({id:"agent.info.description",defaultMessage:"描述"})})]}),(0,N.jsx)(R.Z,{open:b,onOpenChange:y,orgUid:(null==c?void 0:c.uid)||"",record:null,onSuccess:function(e){var t;y(!1),J((function(t){return t.find((function(t){return t.uid===e.uid}))?t.map((function(t){return t.uid===e.uid?e:t})):[e].concat(j()(t))})),Y(),null===(t=K.current)||void 0===t||t.setFieldsValue({settingsUid:e.uid})}})]})},X=n(1181),V=n(71981),B=n(53534),L=n(35746),_=n(34053),G=n(31461),H=n(12715),W=function(e){var t=e.open,n=e.onClose,a=e.onSubmit,s=(0,m.useIntl)(),u=B.ZP.useForm(),l=f()(u,1)[0],c=(0,w.u)((function(e){return e.currentOrg})),p=(0,X.Z)((function(e){return e.memberResult})),v=(0,X.Z)((function(e){return e.setMemberResult})),h=(0,V.E)((function(e){return e.agentResult})),b=(0,g.useState)(0),x=f()(b,2),y=x[0],S=x[1],Z=(0,g.useState)(""),C=f()(Z,2),q=C[0],I=C[1],O=(0,g.useState)(!1),F=f()(O,2),P=F[0],R=F[1],D=(0,g.useState)([]),z=f()(D,2),J=z[0],W=z[1],K=(0,g.useRef)(null),Q=(0,g.useState)(0),$=f()(Q,2),Y=$[0],ee=$[1],te=(0,g.useState)(!0),ne=f()(te,2),ae=ne[0],re=ne[1],se=(0,g.useState)(!1),ie=f()(se,2),ue=ie[0],oe=ie[1],le=(0,g.useState)(0),de=f()(le,2),ce=de[0],fe=de[1],ge=(0,g.useState)(!0),me=f()(ge,2),pe=me[0],ve=me[1],he=(0,g.useState)(!1),be=f()(he,2),Me=be[0],xe=be[1],ke=(0,g.useState)(new Set),we=f()(ke,2),ye=we[0],Se=we[1],je=(0,g.useState)(!1),Ze=f()(je,2),Ce=Ze[0],Ue=Ze[1],Te=(0,g.useState)([]),qe=f()(Te,2),Ie=qe[0],Oe=qe[1];(0,g.useEffect)((function(){if(t){if(null==c||!c.uid)return;fe(0),ve(!0),xe(!0),I(""),W([]),ee(0),re(!0),d()(o()().mark((function e(){var t,n,a,r,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:20,orgUid:null==c?void 0:c.uid},e.next=4,(0,A.z_)(t);case 4:200===(null==(n=e.sent)?void 0:n.code)?(s=(null==n||null===(a=n.data)||void 0===a?void 0:a.content)||[],v({code:null==n?void 0:n.code,message:null==n?void 0:n.message,data:i()(i()({},null==n?void 0:n.data),{},{content:s})}),ve(!(null!=n&&null!==(r=n.data)&&void 0!==r&&r.last))):console.error("Init load members (paged) failed:",null==n?void 0:n.message),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Init load members (paged) failed:",e.t0);case 11:return e.prev=11,xe(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))(),d()(o()().mark((function e(){var t,n,a,r,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Ue(!0),n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==c?void 0:c.uid,searchText:""},e.next=5,(0,E.u9)(n);case 5:a=e.sent,r=(null==a||null===(t=a.data)||void 0===t?void 0:t.content)||[],i=r.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (".concat(s.formatMessage({id:"agent.settings.template.isDefault",defaultMessage:"默认"}),")"):"").concat(e.enabled?"":" (".concat(s.formatMessage({id:"app.disabled",defaultMessage:"已停用"}),")")),value:e.uid}})),Oe(i),!l.getFieldValue("settingsUid")&&i.length>0&&l.setFieldsValue({settingsUid:i[0].value}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Init load agent settings failed:",e.t0);case 16:return e.prev=16,Ue(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))()}}),[t,null==c?void 0:c.uid,l,s,v]),(0,g.useEffect)((function(){if(t&&null!=c&&c.uid){var e=!1;return d()(o()().mark((function t(){var n,a,s,i,u,l,d,f,g,m,p,v,h,b;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=new Set,a=200,s=0,i=200;case 5:if(!(s<i)){t.next=23;break}return d={pageNumber:s,pageSize:a,orgUid:c.uid},t.next=9,(0,k._t)(d);case 9:if(f=t.sent,!e){t.next=12;break}return t.abrupt("return");case 12:if(200===(null==f?void 0:f.code)){t.next=15;break}return console.error("Load all agents failed:",null==f?void 0:f.message,d),t.abrupt("break",23);case 15:g=(null==f||null===(u=f.data)||void 0===u?void 0:u.content)||[],m=r()(g);try{for(m.s();!(p=m.n()).done;)h=p.value,(b=(null==h||null===(v=h.member)||void 0===v?void 0:v.uid)||(null==h?void 0:h.memberUid))&&n.add(b)}catch(e){m.e(e)}finally{m.f()}if(!(null!=f&&null!==(l=f.data)&&void 0!==l&&l.last||0===g.length)){t.next=20;break}return t.abrupt("break",23);case 20:s+=1,t.next=5;break;case 23:e||Se(n),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),console.error("Load all agents error:",t.t0);case 29:case"end":return t.stop()}}),t,null,[[0,26]])})))(),function(){e=!0}}}),[t,null==c?void 0:c.uid]),(0,g.useEffect)((function(){return function(){K.current&&clearTimeout(K.current)}}),[]);var Fe=(0,g.useMemo)((function(){var e,t,n=new Set,a=(null==h||null===(e=h.data)||void 0===e?void 0:e.content)||[],s=r()(a);try{for(s.s();!(t=s.n()).done;){var i,u=t.value,o=(null==u||null===(i=u.member)||void 0===i?void 0:i.uid)||(null==u?void 0:u.memberUid);o&&n.add(o)}}catch(e){s.e(e)}finally{s.f()}return n}),[h]),Pe=(0,g.useMemo)((function(){return ye.size>0?ye:Fe}),[ye,Fe]),Ae=(0,g.useMemo)((function(){for(var e,t,n,a=[],r=q.trim()?J:(null==p||null===(e=p.data)||void 0===e?void 0:e.content)||[],i=0;i<r.length;i++){var u=r[i],o=Pe.has(u.uid),l={title:"",value:"",children:[]};t=u,(n=l).title=t.nickname,n.value=t.uid,o&&(l.disabled=!0,l.title="".concat(l.title," (").concat(s.formatMessage({id:"agent.member.alreadyCreated",defaultMessage:"已创建客服"}),")")),a.push(l)}return a}),[p,J,q,Pe,s]),Ee=function(){var e=d()(o()().mark((function e(t){var n,a,r,s,i=arguments;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],t.trim()||n){e.next=6;break}return W([]),ee(0),re(!0),e.abrupt("return");case 6:return n?oe(!0):R(!0),e.prev=7,a={pageNumber:n?Y+1:0,pageSize:20,orgUid:null==c?void 0:c.uid,searchText:t.trim()},e.next=11,(0,A.z_)(a);case 11:200===(r=e.sent).code?(s=(null==r?void 0:r.data.content)||[],n?(W((function(e){return[].concat(j()(e),j()(s))})),ee(Y+1)):(W(s),ee(0)),re(!(null!=r&&r.data.last))):(console.error("handleSearch Search failed:",r.message),n||W([])),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),console.error("Search error:",e.t0),n||W([]);case 19:return e.prev=19,n?oe(!1):R(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,15,19,22]])})));return function(t){return e.apply(this,arguments)}}(),Re=function(e){var t=e.target.value;I(t),K.current&&clearTimeout(K.current),t.trim()?K.current=setTimeout((function(){Ee(t)}),300):(W([]),ee(0),re(!0))},De=function(){Ee(q)},Ne=function(){!ue&&ae&&q.trim()&&Ee(q,!0)},ze=function(){var e=d()(o()().mark((function e(){var t,n,a,r,s,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Me||!pe){e.next=16;break}return xe(!0),e.prev=2,t={pageNumber:ce+1,pageSize:20,orgUid:null==c?void 0:c.uid},e.next=6,(0,A.z_)(t);case 6:200===(n=e.sent).code&&(r=(null==n?void 0:n.data.content)||[],s=X.Z.getState().memberResult,u=[].concat(j()((null==s||null===(a=s.data)||void 0===a?void 0:a.content)||[]),j()(r)),v({code:null==n?void 0:n.code,message:null==n?void 0:n.message,data:i()(i()({},null==n?void 0:n.data),{},{content:u})}),fe(ce+1),ve(!(null!=n&&n.data.last))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.error("Load more all members error:",e.t0);case 13:return e.prev=13,xe(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,10,13,16]])})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)("div",{children:(0,N.jsx)(L.Z,{title:s.formatMessage({id:"agent.create",defaultMessage:"创建客服"}),open:t,forceRender:!0,onOk:function(){l.validateFields().then((function(e){var t,n=(l.getFieldValue("memberUids")||[]).filter((function(e){return e&&!Pe.has(e)}));if(0!==n.length){var r=l.getFieldValue("nickname"),s=l.getFieldValue("email"),i=l.getFieldValue("mobile"),u=l.getFieldValue("settingsUid"),o=q.trim()?J:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[],d=[];if(1===n.length){var f={nickname:r,email:s,mobile:i,memberUid:n[0],orgUid:null==c?void 0:c.uid,settingsUid:u};d.push(f)}else n.forEach((function(e){var t=o.find((function(t){return t.uid===e}));if(t){var n={nickname:t.nickname,email:t.email,mobile:t.mobile,memberUid:e,orgUid:null==c?void 0:c.uid,settingsUid:u};d.push(n)}}));a(d)}else console.warn("No selectable members, all are already agents.")})).catch((function(e){console.error("Form errors:",e)}))},onCancel:function(){n()},children:(0,N.jsxs)(B.ZP,{form:l,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,N.jsx)(U.Z,{label:s.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),name:"settingsUid",tooltip:s.formatMessage({id:"agent.settings.tooltip",defaultMessage:"为本次创建的客服指定配置模板"}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.required.message",defaultMessage:"请选择客服配置!"})}],fieldProps:{options:Ie,loading:Ce,showSearch:!0,filterOption:function(e,t){return((null==t?void 0:t.label)||"").toLowerCase().includes(e.toLowerCase())},placeholder:s.formatMessage({id:"agent.settings.placeholder",defaultMessage:"请选择客服配置"})}}),(0,N.jsx)(B.ZP.Item,{label:s.formatMessage({id:"agent.info.member.bind",defaultMessage:"绑定成员"}),name:"memberUids",tooltip:s.formatMessage({id:"agent.info.member.tooltip",defaultMessage:"请先到组织-》成员-》创建成员，已创建过客服的成员会被标记并禁止选择"}),rules:[{required:!0,message:s.formatMessage({id:"agent.info.member.required.message",defaultMessage:"请选择成员!"})}],children:(0,N.jsx)(_.Z,{multiple:!0,treeDefaultExpandAll:!0,placeholder:s.formatMessage({id:"agent.info.member.placeholder.multiple",defaultMessage:"请选择成员（可多选）"}),onChange:function(e){var t,n=(e||[]).filter((function(e){return e&&!Pe.has(e)}));n.length!==(e||[]).length&&l.setFieldsValue({memberUids:n}),S(n.length);var a=q.trim()?J:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[];if(0===n.length)l.setFieldsValue({nickname:"",email:"",mobile:""});else if(1===n.length){var r=a.find((function(e){return e.uid===n[0]}));r&&l.setFieldsValue({nickname:r.nickname||"",email:r.email||"",mobile:r.mobile||""})}else{var s=a.filter((function(e){return n.includes(e.uid)})),i=s.map((function(e){return e.nickname})).filter(Boolean).join(", "),u=s.map((function(e){return e.email})).filter(Boolean).join(", "),o=s.map((function(e){return e.mobile})).filter(Boolean).join(", ");l.setFieldsValue({nickname:i,email:u,mobile:o})}},treeData:Ae,variant:"outlined",popupRender:function(e){return(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0"},children:(0,N.jsx)(G.Z,{placeholder:s.formatMessage({id:"agent.info.member.search",defaultMessage:"搜索成员"}),value:q,onChange:Re,onPressEnter:function(){return De()},suffix:(0,N.jsx)(H.Z,{onClick:De,style:{cursor:"pointer",color:P?"#1890ff":void 0},spin:P}),allowClear:!0,size:"small"})}),e,(q.trim()?ae:pe)&&(0,N.jsx)("div",{style:{padding:"8px",textAlign:"center",borderTop:"1px solid #f0f0f0"},children:(0,N.jsx)(M.ZP,{type:"link",size:"small",loading:q.trim()?ue:Me,onClick:q.trim()?Ne:ze,disabled:q.trim()?ue:Me,children:(q.trim()?ue:Me)?s.formatMessage({id:"loading",defaultMessage:"加载中..."}):s.formatMessage({id:"load.more",defaultMessage:"加载更多"})})})]})}})}),(0,N.jsx)(T.Z,{label:s.formatMessage({id:"agent.info.nickname",defaultMessage:"昵称"}),name:"nickname",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.nickname.tooltip.multiple",defaultMessage:"多选模式下昵称将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.nickname.tooltip",defaultMessage:"昵称将自动从选中的成员信息中获取"})}),(0,N.jsx)(T.Z,{label:s.formatMessage({id:"agent.info.email",defaultMessage:"邮箱"}),name:"email",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.email.tooltip.multiple",defaultMessage:"多选模式下邮箱将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.email.tooltip",defaultMessage:"邮箱将自动从选中的成员信息中获取"})}),(0,N.jsx)(T.Z,{label:s.formatMessage({id:"agent.info.mobile",defaultMessage:"手机号"}),name:"mobile",disabled:y>1,tooltip:y>1?s.formatMessage({id:"agent.info.mobile.tooltip.multiple",defaultMessage:"多选模式下手机号将自动从选中的成员信息中获取"}):s.formatMessage({id:"agent.info.mobile.tooltip",defaultMessage:"手机号将自动从选中的成员信息中获取"})})]})})})},K=n(97765),Q=n(27318),$=function(e){var t,n,a,s,u,l,c,S,j,Z,C=e.superUser,U=(0,m.useIntl)(),T=(0,g.useRef)(),q=(0,w.u)((function(e){return e.currentOrg})),I=(0,g.useState)(!1),O=f()(I,2),F=O[0],P=O[1],A=(0,g.useState)(!1),E=f()(A,2),R=E[0],D=E[1],z=(0,g.useState)(null),X=f()(z,2),V=X[0],B=X[1],L=(0,m.useAccess)(),_=(0,g.useMemo)((function(){var e;return null==L||null===(e=L.getModulePermission)||void 0===e?void 0:e.call(L,Q.MY.AGENT)}),[L]),G=null!==(t=null==_||null===(n=_.canRead)||void 0===n?void 0:n.call(_))&&void 0!==t&&t,H=null!==(a=null==_||null===(s=_.canCreate)||void 0===s?void 0:s.call(_))&&void 0!==a&&a,$=null!==(u=null==_||null===(l=_.canUpdate)||void 0===l?void 0:l.call(_))&&void 0!==u&&u,Y=null!==(c=null==_||null===(S=_.canDelete)||void 0===S?void 0:S.call(_))&&void 0!==c&&c,ee=(j=null==_||null===(Z=_.canExport)||void 0===Z?void 0:Z.call(_),function(e,t){x.yw.warning(U.formatMessage({id:e,defaultMessage:t}))}),te=(0,g.useRef)({}),ne=(0,g.useRef)(!1),ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:U.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:U.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,N.jsx)(v.Z,{src:null==t?void 0:t.avatar})}},{title:U.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:U.formatMessage({id:"agent.no",defaultMessage:"客服工号"}),dataIndex:"agentNo",copyable:!0,width:140,hideInSearch:!0,render:function(e,t){return(null==t?void 0:t.agentNo)||(0,N.jsx)("span",{style:{color:"#999"},children:"-"})}},{title:U.formatMessage({id:"agent.reception.status",defaultMessage:"接待状态"}),dataIndex:"status",width:140,hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.status){case y.Ra4:return(0,N.jsx)(h.Z,{color:"green",children:U.formatMessage({id:"agent.status.online",defaultMessage:"Online"})});case y.tU$:return(0,N.jsx)(h.Z,{color:"orange",children:U.formatMessage({id:"agent.status.busy",defaultMessage:"Busy"})});case y.LZ1:default:return(0,N.jsx)(h.Z,{color:"red",children:U.formatMessage({id:"agent.status.offline",defaultMessage:"Offline"})})}}},{title:U.formatMessage({id:"agent.connection.status",defaultMessage:"连接状态"}),dataIndex:"connected",width:140,hideInSearch:!0,render:function(e,t){return null!=t&&t.connected?(0,N.jsx)(h.Z,{color:"green",children:U.formatMessage({id:"agent.connection.success",defaultMessage:"Connected"})}):(0,N.jsx)(h.Z,{color:"red",children:U.formatMessage({id:"agent.connection.failed",defaultMessage:"Disconnected"})})}},{title:U.formatMessage({id:"agent.queue.stats",defaultMessage:"队列统计"}),dataIndex:"queueStats",width:280,hideInSearch:!0,render:function(e,t){var n,a,r,s=null==t?void 0:t.queueStats;return s?(0,N.jsxs)("span",{style:{fontSize:12},children:[(0,N.jsxs)(h.Z,{color:"blue",children:[U.formatMessage({id:"agent.queue.today",defaultMessage:"今日"}),": ",null!==(n=s.agentServedCount)&&void 0!==n?n:0]}),(0,N.jsxs)(h.Z,{color:"orange",children:[U.formatMessage({id:"agent.queue.queuing",defaultMessage:"排队中"}),": ",null!==(a=s.queuingCount)&&void 0!==a?a:0]}),(0,N.jsxs)(h.Z,{color:"green",children:[U.formatMessage({id:"agent.queue.chatting",defaultMessage:"接待中"}),": ",null!==(r=s.chattingCount)&&void 0!==r?r:0]})]}):(0,N.jsx)("span",{style:{color:"#999"},children:"-"})}},{title:U.formatMessage({id:"agent.settings",defaultMessage:"客服配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){var n=function(){$?(B(t),P(!0)):ee("agent.permission.update.denied","无权限：编辑客服")};return null!=t&&t.settings?(0,N.jsx)("a",{onClick:n,children:t.settings.name||U.formatMessage({id:"agent.settings.configured",defaultMessage:"已配置"})}):(0,N.jsx)("a",{style:{color:"#ff4d4f"},onClick:n,children:U.formatMessage({id:"agent.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:U.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:U.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:U.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:U.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){var n=[];return G&&n.push((0,N.jsx)("a",{onClick:function(){return function(e){var t;if(G)if(null!=e&&e.uid){var n={chatConfig:{org:null==q?void 0:q.uid,t:y._0X,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(n)}else x.yw.error(U.formatMessage({id:"agent.invalid",defaultMessage:"无效的客服"}));else ee("agent.permission.read.denied","无权限：查看客服")}(t)},children:U.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test")),G&&n.push((0,N.jsx)("a",{onClick:function(){return m.history.push("/service/channel")},children:U.formatMessage({id:"agent.get.code",defaultMessage:"获取客服代码"})},"code")),$&&n.push((0,N.jsx)("a",{onClick:function(){B(t),P(!0)},children:U.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")),Y&&n.push((0,N.jsx)(b.Z,{title:U.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(U.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:d()(o()().mark((function e(){var n,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return ee("agent.permission.delete.denied","无权限：删除客服"),e.abrupt("return");case 3:return x.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=4,e.next=7,(0,k.Lr)(t);case 7:n=e.sent,x.yw.destroy(),200===(null==n?void 0:n.code)?(x.yw.success(U.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(a=T.current)||void 0===a||a.reload()):x.yw.error((null==n?void 0:n.message)||"Delete failed"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),x.yw.destroy(),x.yw.error("Delete error");case 16:case"end":return e.stop()}}),e,null,[[4,12]])}))),okText:U.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:U.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,N.jsx)("a",{children:U.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")),n}},{title:U.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Z,{columns:ae,actionRef:T,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){var e=[];return H&&e.push((0,N.jsx)(M.ZP,{type:"primary",onClick:function(){H?(B(null),D(!0)):ee("agent.permission.create.denied","无权限：创建客服")},children:U.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")),e},request:function(){var e=d()(o()().mark((function e(t,n){var a,r,s,u,l,d,c,g,m,p,v,h,b,M,x,w,y,S,j,Z,U,T;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return ne.current||(ne.current=!0,ee("agent.permission.read.denied","无权限：查看客服")),e.abrupt("return",{data:[],total:0,success:!1});case 3:return u=(null!==(a=null==t?void 0:t.current)&&void 0!==a?a:1)-1,l=null!==(r=null==t?void 0:t.pageSize)&&void 0!==r?r:10,d=null!==(s=null==t?void 0:t.searchText)&&void 0!==s?s:"",(m=Object.entries(n||{})).length>0&&(p=m[0],v=f()(p,2),h=v[0],(b=v[1])&&(c=h,g="ascend"===b?"ascend":"descend")),M=i()(i()({pageNumber:u,pageSize:l,orgUid:null==q?void 0:q.uid,searchText:d,superUser:C},c?{sortBy:c}:{}),g?{sortDirection:g}:{}),te.current={searchText:d,sortBy:c,sortDirection:g},e.prev=10,e.next=13,(0,k._t)(M);case 13:if(x=e.sent,K.Z.debug("queryAgentsByOrg response:",x,M),200!==(null==x?void 0:x.code)){e.next=19;break}return U=(null==x||null===(w=x.data)||void 0===w?void 0:w.content)||[],T=null!==(y=null!==(S=null==x||null===(j=x.data)||void 0===j?void 0:j.totalElements)&&void 0!==S?S:null==x||null===(Z=x.data)||void 0===Z?void 0:Z.numberOfElements)&&void 0!==y?y:U.length,e.abrupt("return",{data:U,total:T,success:!0});case 19:return e.abrupt("return",{data:[],total:0,success:!1});case 22:return e.prev=22,e.t0=e.catch(10),e.abrupt("return",{data:[],total:0,success:!1});case 25:case"end":return e.stop()}}),e,null,[[10,22]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:U.formatMessage({id:"agent",defaultMessage:"Agent"})}),F&&(0,N.jsx)(J,{open:F,record:V,onClose:function(){return P(!1)},onSuccess:function(){var e;return null===(e=T.current)||void 0===e?void 0:e.reload()}}),R&&(0,N.jsx)(W,{open:R,onClose:function(){return D(!1)},onSubmit:function(){var e=d()(o()().mark((function e(t){var n,a,s,i,u,l,d,c,f,g,m,p,v,h,b,M;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=3;break}return ee("agent.permission.create.denied","无权限：创建客服"),e.abrupt("return");case 3:if(!(((null==t?void 0:t.length)||0)>200)){e.next=6;break}return x.yw.warning(U.formatMessage({id:"agent.create.batch.limit",defaultMessage:"超过最大批量 200，请分批创建"})),e.abrupt("return");case 6:n="agent-batch-create",x.yw.loading({content:U.formatMessage({id:"saving",defaultMessage:"Saving..."}),key:n,duration:0}),a=[],s=function(e){return new Promise((function(t){return setTimeout(t,e)}))},i=r()(t),e.prev=11,i.s();case 13:if((u=i.n()).done){e.next=55;break}l=u.value,d=0,c=!1,f=null;case 18:if(!(d<3)||c){e.next=52;break}return e.prev=19,e.next=22,(0,k.x_)(l);case 22:if(200!==(null==(g=e.sent)?void 0:g.code)){e.next=27;break}return a.push({uid:l.memberUid,ok:!0}),c=!0,e.abrupt("break",52);case 27:return a.push({uid:l.memberUid,ok:!1,code:null==g?void 0:g.code,msg:null==g?void 0:g.message}),c=!0,e.abrupt("break",52);case 32:if(e.prev=32,e.t0=e.catch(19),p=null===e.t0||void 0===e.t0||null===(m=e.t0.response)||void 0===m?void 0:m.status,f=e.t0,d+=1,!(409===p&&d<3)){e.next=43;break}return e.next=40,s(300*d);case 40:return e.abrupt("continue",18);case 43:if(502!==p&&503!==p&&504!==p||!(d<3)){e.next=47;break}return e.next=46,s(300*d);case 46:return e.abrupt("continue",18);case 47:return a.push({uid:l.memberUid,ok:!1,code:p,msg:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"error"}),c=!0,e.abrupt("break",52);case 50:e.next=18;break;case 52:!c&&f&&a.push({uid:l.memberUid,ok:!1,msg:(null===(v=f)||void 0===v?void 0:v.message)||"error"});case 53:e.next=13;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(11),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:h=a.filter((function(e){return e.ok})).length,b=a.length-h,h>0?(x.yw.success({content:U.formatMessage({id:"create.success",defaultMessage:"Create success"})+" (".concat(h,")"),key:n}),D(!1),null===(M=T.current)||void 0===M||M.reload()):x.yw.destroy(n),b>0&&x.yw.warning(U.formatMessage({id:"create.partial.failed",defaultMessage:"部分创建失败，请查看失败项并重试"})+" (".concat(b,")"));case 67:case"end":return e.stop()}}),e,null,[[11,57,60,63],[19,32]])})));return function(t){return e.apply(this,arguments)}}()})]})}},1181:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(27353),r=n(26557),s=n(26407),i=n(20744),u=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,i.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n.splice(a,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:a.PQL})))}}]);