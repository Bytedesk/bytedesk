"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{17208:function(e,t,r){r.d(t,{A8:function(){return c},Kq:function(){return g},RL:function(){return m}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),u=r.n(i),l=r(55735),d=r(30921);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/query",{method:"GET",params:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},81924:function(e,t,r){r.d(t,{E9:function(){return c},Rd:function(){return y},fA:function(){return g},ul:function(){return m}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),u=r.n(i),l=r(55735),d=r(30921);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},96865:function(e,t,r){var n=r(23864);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,t,r){var n=r(55735),a=r(65461),o=r(30921);t.Z=function(){var e=(0,o.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},42331:function(e,t,r){r.r(t),r.d(t,{default:function(){return W}});var n=r(96865),a=r(75574),o=r(44194),s=r(45516),i=r(73193),u=r.n(i),l=r(84176),d=r.n(l),c=r(90819),f=r.n(c),g=r(89933),p=r.n(g),m=r(45332),h=r.n(m),y=r(86803),v=r(81924),R=r(81947),x=r(40612),M=r(69169),w=r(4499),b=r(32350),S=r(84881),j=r(16309),P=r(73442),C=r(3849),I=r(75365),k=r(38775),Z=r(30921),T=r(31549),F=function(e){var t=e.isEdit,r=e.org,n=e.open,a=e.onClose,s=e.onSubmit,i=j.Z.useForm(),l=h()(i,1)[0],d=(0,Z.useIntl)(),c=(0,x.u)((function(e){return e.currentOrg}));(0,o.useEffect)((function(){t?l.setFieldsValue({name:null==r?void 0:r.name,logo:null==r?void 0:r.logo,code:null==r?void 0:r.code,description:null==r?void 0:r.description,verifiedType:null==r?void 0:r.verifiedType,identityType:null==r?void 0:r.identityType,identityImage:null==r?void 0:r.identityImage,identityNumber:null==r?void 0:r.identityNumber,verifyDate:null==r?void 0:r.verifyDate,verifyStatus:null==r?void 0:r.verifyStatus,rejectReason:null==r?void 0:r.rejectReason}):(l.resetFields(),l.setFieldsValue({verifyStatus:"未认证"}))}),[n]);return(0,T.jsx)(P.Z,{title:t?(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:a,open:n,width:600,extra:(0,T.jsxs)(C.Z,{children:[(0,T.jsx)(I.ZP,{onClick:a,children:(0,T.jsx)(Z.FormattedMessage,{id:"pages.common.cancel"})}),(0,T.jsx)(I.ZP,{onClick:function(){l.validateFields().then((function(e){s(u()(u()(u()({},r),e),{},{orgUid:null==c?void 0:c.uid}))})).catch((function(e){console.log("Form errors:",e),y.yw.error(d.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,T.jsx)(Z.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,T.jsxs)(M.A,{form:l,submitter:!1,children:[(0,T.jsx)(w.Z,{name:"name",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:d.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,T.jsx)(w.Z,{name:"logo",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"}),placeholder:d.formatMessage({id:"pages.org.logo.placeholder",defaultMessage:"请输入Logo URL"})}),(0,T.jsx)(w.Z,{name:"code",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:d.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,T.jsx)(b.Z,{name:"description",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:d.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,T.jsx)(k.Z,{children:"认证信息"}),(0,T.jsx)(S.Z,{name:"verifiedType",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:[{label:"企业认证",value:"企业认证"},{label:"个人认证",value:"个人认证"},{label:"政府事业单位认证",value:"政府事业单位认证"}],placeholder:d.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,T.jsx)(S.Z,{name:"identityType",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:[{label:"营业执照",value:"营业执照"},{label:"身份证",value:"身份证"},{label:"护照",value:"护照"},{label:"其他",value:"其他"}],placeholder:d.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,T.jsx)(w.Z,{name:"identityImage",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:d.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,T.jsx)(w.Z,{name:"identityNumber",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:d.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,T.jsx)(S.Z,{name:"verifyStatus",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:[{label:"未认证",value:"未认证"},{label:"已认证",value:"已认证"},{label:"审核中",value:"审核中"},{label:"审核失败",value:"审核失败"}],placeholder:d.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,T.jsx)(b.Z,{name:"rejectReason",label:(0,T.jsx)(Z.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:d.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})})},q=r(90838),A=r(78488),O=r(76750),z=r(28977),E=r.n(z),B=r(55735),L=(r(36310),r(17208)),U=r(88721),V=["current","pageSize"],D=function(){var e=(0,Z.useIntl)(),t=(0,o.useRef)(),r=(0,O.Z)().translateString,n=(0,o.useState)(!0),a=h()(n,2),s=a[0],i=(a[1],(0,o.useState)()),l=h()(i,2),c=l[0],g=(l[1],(0,o.useState)(!1)),m=h()(g,2),M=m[0],w=m[1],b=(0,o.useState)(1),S=h()(b,2),j=(S[0],S[1]),P=(0,o.useState)(10),C=h()(P,2),I=C[0],k=C[1],z=(0,x.u)((function(e){return e.currentOrg})),D=(0,A.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),N=(D.roleResult,D.roleResultPlatform,D.setRoleResult),W=D.setRoleResultPlatform,Y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,t){return t.logo?(0,T.jsx)("img",{src:t.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,t){return(0,U._i)(t.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,t){return(0,U.Cy)(t.verifyStatus)}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.createdAt?E()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return t.updatedAt?E()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],H=[].concat(Y),J=(0,q.v)((function(e){return e.currentCategory})),K=function(){var r=p()(f()().mark((function r(n){var a,o;return f()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("handleSubmitDrawer",n),s?y.yw.loading(e.formatMessage({id:"updating"})):y.yw.loading(e.formatMessage({id:"creating"})),!s){r.next=8;break}return r.next=5,(0,L.RL)(n);case 5:r.t0=r.sent,r.next=11;break;case 8:return r.next=10,(0,L.Kq)(n);case 10:r.t0=r.sent;case 11:a=r.t0,console.log("createOrg response:",n,a),200===a.code?(y.yw.destroy(),y.yw.loading(e.formatMessage({id:"create.success"})),w(!1),null===(o=t.current)||void 0===o||o.reloadAndRest()):(y.yw.destroy(),y.yw.error(a.message));case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),_=function(){var t=p()(f()().mark((function t(){var r,n;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,orgUid:null==z?void 0:z.uid},t.next=4,(0,v.E9)(r);case 4:n=t.sent,console.log("queryRolesByOrg response ",n),200===n.code?(y.yw.destroy(),N(n)):(y.yw.destroy(),y.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),G=function(){var t=p()(f()().mark((function t(){var r,n;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,level:B.Hxq},t.next=4,(0,v.E9)(r);case 4:n=t.sent,console.log("queryRolesBySuper response ",n),200===n.code?(y.yw.destroy(),W(n)):(y.yw.destroy(),y.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){_(),G()}),[]),(0,o.useEffect)((function(){var e;console.log("currentCategory:",J),null===(e=t.current)||void 0===e||e.reloadAndRest()}),[J]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(R.Z,{columns:H,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=p()(f()().mark((function t(n,a,o){var s,i,l,c,g;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,a,o),y.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=n.current,i=n.pageSize,l=d()(n,V),j(s),k(i),c=u()({pageNumber:s-1,pageSize:i},l),t.next=8,(0,L.A8)(c);case 8:return g=t.sent,console.log("getAllOrgs response:",c,g),y.yw.destroy(),200===g.code||y.yw.error(r(g.message)),t.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:I,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){console.log("pagination onChange:",e,t),j(e),k(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[]}}),M&&(0,T.jsx)(F,{isEdit:s,open:M,org:c,onClose:function(){w(!1)},onSubmit:K})]})},N=a.Z.Content,W=function(){(0,s.s0)();var e=(0,n.Z)().contentStyle;return(0,T.jsx)(a.Z,{children:(0,T.jsx)(a.Z,{children:(0,T.jsx)(N,{style:e,children:(0,T.jsx)(D,{})})})})}},90838:function(e,t,r){r.d(t,{v:function(){return c}});var n=r(76711),a=r.n(n),o=r(73193),s=r.n(o),i=r(55735),u=r(44435),l=r(83642),d=r(83890);var c=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(t){var r=function(e){var t=[];return e.data.content.forEach((function(e){var r={label:e.name,value:e.uid};t.push(r)})),t}(t),n={uid:i.zBg,name:i.zBg},o=s()(s()({},t),{},{data:s()(s()({},t.data),{},{content:[n].concat(a()(t.data.content))})}),u=function(e){var t=[];return e.data.content.forEach((function(e){var r={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(r.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(r)})),t}(o);e({categoryResult:o,categoryTreeOptions:u,categorySelectOptions:r}),0===t.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var r=e.categoryResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(r){var n=t().categoryResult.data.content.find((function(e){return e.uid===r}));e({currentCategory:n})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))},78488:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(73193),a=r.n(n),o=r(76711),s=r.n(o),i=r(55735),u=r(44435),l=r(83642),d=r(83890),c=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},currentRolePlatform:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},roleResultPlatform:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},insertRolePlatform:function(t){e((function(e){e.roleResultPlatform.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var r=e.roleResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},upgradeRolePlatform:function(t){e((function(e){var r=e.roleResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(r){var n;(e({roleResult:r}),""===t().currentRole.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRole:r.data.content[0]}))},setRoleResultPlatform:function(r){var n;(e({roleResultPlatform:r}),""===t().currentRolePlatform.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRolePlatform:r.data.content[0]}))},setCurrentRole:function(r){var n=t().roleResult.data.content,o=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==o){var i=[].concat(s()(n.slice(0,o)),[r],s()(n.slice(o+1))),u=a()(a()({},t().roleResult),{},{data:{content:i}});e({roleResult:u,currentRole:r})}else console.warn("Role with the specified uid not found."),e({currentRole:r})},setCurrentRolePlatform:function(r){var n=t().roleResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==o){var i=[].concat(s()(n.slice(0,o)),[r],s()(n.slice(o+1))),u=a()(a()({},t().roleResultPlatform),{},{data:{content:i}});e({roleResultPlatform:u,currentRolePlatform:r})}else console.warn("Role with the specified uid not found."),e({currentRolePlatform:r})},removeRole:function(r){var n=t().roleResult.data.content,o=n.findIndex((function(e){return e.uid===r}));-1!==o?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,o)),s()(n.slice(o+1)))}})}):console.warn("Role not found in cache:",r),t().currentRole.uid===r&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},removeRolePlatform:function(r){var n=t().roleResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r}));-1!==o?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,o)),s()(n.slice(o+1)))}})}):console.warn("Role not found in cache:",r),t().currentRolePlatform.uid===r&&e({currentRolePlatform:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:i.uaR})))}}]);