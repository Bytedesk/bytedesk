"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1117],{42268:function(e,t,n){n.d(t,{Jr:function(){return f},LF:function(){return d},Oh:function(){return v},WS:function(){return h}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),s=n(89933),l=n.n(s),u=n(94976),c=n(4628);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},94527:function(e,t,n){n.d(t,{G9:function(){return S},J$:function(){return M},N6:function(){return w},VM:function(){return d},c8:function(){return f},gF:function(){return v},rg:function(){return h},sF:function(){return x}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),s=n(89933),l=n.n(s),u=n(94976),c=n(4628);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return C.apply(this,arguments)}function C(){return(C=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},13845:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return v},t5:function(){return h},v_:function(){return f}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),s=n(89933),l=n.n(s),u=n(94976),c=n(4628);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},64628:function(e,t,n){var r=n(10154),i=n.n(r),a=n(73193),o=n.n(a),s=n(90819),l=n.n(s),u=n(89933),c=n.n(u),d=n(45332),p=n.n(d),f=n(43388),m=n(42268),h=n(94527),y=n(88722),v=n(94976),g=n(16658),x=n(82878),b=n(30310),w=n(5957),k=n(1282),S=n(69533),j=n(83281),M=n(10532),C=n(30857),Z=n(21600),T=n(4628),L=n(44194),P=n(25553),q=n(78112),J=n(31549),O=x.Z.Text,X=L.memo((function(e){var t,n=e.visible,r=e.onCancel,a=e.onOk,s=e.initialProvider,u=e.initialModel,d=e.initialModelLabel,X=e.providers,U=e.currentOrgUid,I=e.existingProviderModels,B=void 0===I?{}:I,E=e.onModelsLoaded,G=e.allowedModelTypes,z=void 0===G?[]:G,A=(0,T.useIntl)(),D=(0,P.Z)().isDarkMode,F=(0,y.Z)().translateString,H=(0,L.useState)(s||""),N=p()(H,2),R=N[0],W=N[1],Y=(0,L.useState)(B),_=p()(Y,2),V=_[0],$=_[1],K=(0,L.useState)(s||""),Q=p()(K,2),ee=Q[0],te=Q[1],ne=(0,L.useState)(u||""),re=p()(ne,2),ie=re[0],ae=re[1],oe=(0,L.useState)(d||""),se=p()(oe,2),le=se[0],ue=se[1],ce=(0,L.useState)(!1),de=p()(ce,2),pe=de[0],fe=de[1],me=(0,L.useState)(!1),he=p()(me,2),ye=he[0],ve=he[1],ge=(0,L.useState)(""),xe=p()(ge,2),be=xe[0],we=xe[1];(0,L.useEffect)((function(){te(s),ae(u),ue(d);var e=s;if(s){var t=X.find((function(e){return e.type===s})),n=X.find((function(e){return e.uid===s}));t&&!n&&(e=t.uid)}W(e),ve(!1),we("")}),[s,u,d,n,X]),(0,L.useEffect)((function(){if(n&&R&&!V[R]&&!pe){fe(!0),f.yw.loading({content:A.formatMessage({id:"loading"}),key:"modelLoading"});var e=X.find((function(e){return e.uid===R}));e&&(e.type===v.CZ7?Ce(e):Te(e))}}),[n,R,X]);var ke=(0,L.useCallback)((function(){ee&&ie&&a(ee,ie,le)}),[ee,ie,le,a]),Se=(0,L.useCallback)((function(){r(),T.history.push("/ai/model")}),[r]),je=(0,L.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(t){return e.toLowerCase().includes(t.toLowerCase())}))}),[]),Me=(0,L.useCallback)((function(e){return e?e.filter((function(e){return!je(e.value)&&(!z||0===z.length||(!e.type||z.includes(e.type)))})):[]}),[z,je]),Ce=function(){var e=c()(l()().mark((function e(t){var n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={baseUrl:null==t?void 0:t.baseUrl},e.next=4,(0,h.VM)(n);case 4:r=e.sent,console.log("getOllamaServerStatus:",r,n),200===r.code&&null!=r&&r.data?(ve(!0),Ze(t)):(ve(!1),f.yw.destroy("modelLoading"),fe(!1)),e.next=15;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),ve(!1),f.yw.destroy("modelLoading"),fe(!1);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),Ze=function(){var e=c()(l()().mark((function e(t){var n,r,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={baseUrl:null==t?void 0:t.baseUrl},e.next=4,(0,h.c8)(n);case 4:r=e.sent,console.log("getOllamaLocalModels:",null==r?void 0:r.data,n),200===r.code?(a=null==r?void 0:r.data.map((function(e){return{value:e.name,label:e.name,providerName:t.uid}})),s=Me(a),$((function(e){return o()(o()({},e),{},i()({},t.uid,s))})),E&&E(t.uid,s)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),f.yw.error(A.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),fe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(t){return e.apply(this,arguments)}}(),Te=function(){var e=c()(l()().mark((function e(t){var n,r,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",enabled:!0,providerUid:null==t?void 0:t.uid,orgUid:U,level:v.whQ},e.next=4,(0,m.LF)(n);case 4:r=e.sent,console.log("queryLlmModelsByOrg:",null==r?void 0:r.data,n),200===r.code?(a=null==r?void 0:r.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:t.uid}})),s=Me(a),$((function(e){return o()(o()({},e),{},i()({},t.uid,s))})),E&&E(t.uid,s)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),f.yw.error(A.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),fe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(t){return e.apply(this,arguments)}}(),Le=(0,L.useCallback)((function(e,t){te(e),ae(t.value),ue(t.label)}),[]),Pe=(0,L.useCallback)((function(e){if(W(e),we(""),!V[e]&&!pe){fe(!0),f.yw.loading({content:A.formatMessage({id:"loading"}),key:"modelLoading"});var t=X.find((function(t){return t.uid===e}));t&&("ollama"===t.type?Ce(t):Te(t))}}),[X,V,pe]),qe=(0,L.useCallback)((function(e,t){var n=(t||"").trim().toLowerCase();return n?e.filter((function(e){var t=(e.label||"").toLowerCase(),r=(e.value||"").toLowerCase(),i=(e.description||"").toLowerCase();return t.includes(n)||r.includes(n)||i.includes(n)})):e}),[]),Je=(0,L.useMemo)((function(){return X.filter((function(e){return!q.ju.includes(e.type)})).map((function(e){var t;return{key:e.uid,label:F(e.nickname),children:(0,J.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,J.jsxs)(b.Z,{direction:"vertical",style:{width:"100%"},children:["ollama"===e.type&&!ye&&(0,J.jsx)(w.Z,{message:A.formatMessage({id:"ai.ollama.notRunning"}),type:"error",showIcon:!0,style:{marginBottom:"16px"}}),(0,J.jsx)(k.Z.Search,{placeholder:A.formatMessage({id:"ai.modelSelection.searchPlaceholder"}),allowClear:!0,value:R===e.uid?be:"",onChange:function(t){R===e.uid&&we(t.target.value)},onSearch:function(t){R===e.uid&&we(t)}}),pe&&R===e.uid&&!V[e.uid]?(0,J.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,J.jsx)(O,{type:"secondary",children:A.formatMessage({id:"ai.modelSelection.loading"})})}):V[e.uid]&&0!==(null===(t=V[e.uid])||void 0===t?void 0:t.length)?null:(0,J.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,J.jsx)(O,{type:"secondary",style:{display:"block",marginBottom:"16px"},children:A.formatMessage({id:"ai.modelSelection.noModels"})}),(0,J.jsx)(S.ZP,{type:"link",onClick:Se,style:{padding:0,height:"auto",fontSize:"14px",color:"#1890ff"},children:A.formatMessage({id:"ai.modelSelection.addModelTip"})})]}),(0,J.jsx)(j.Z,{split:!1,dataSource:qe(V[e.uid]||[],R===e.uid?be:""),locale:{emptyText:A.formatMessage({id:"ai.modelSelection.noModels"})},renderItem:function(t){var n=ie===t.value&&ee===e.uid;return(0,J.jsx)(j.Z.Item,{style:{cursor:"pointer",padding:"12px 12px",borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:n?"#1890ff":"transparent",borderBottomStyle:"solid",borderBottomWidth:2,borderBottomColor:n?"#1890ff":D?"#303030":"#e8e8e8"},onClick:function(){return Le(e.uid,t)},children:(0,J.jsx)(j.Z.Item.Meta,{title:(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[(0,J.jsxs)("div",{style:{minWidth:0},children:[(0,J.jsx)(x.Z.Text,{strong:!0,children:t.label}),(0,J.jsx)("div",{children:(0,J.jsx)(x.Z.Text,{type:"secondary",children:t.value})})]}),(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[t.type&&(0,J.jsx)("div",{style:{marginBottom:8},children:(0,g.Rb)(t.type)}),n&&(0,J.jsx)(M.Z,{status:"processing",text:A.formatMessage({id:"ai.modelSelection.selected"})})]})]}),description:t.description?(0,J.jsx)(x.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{margin:"6px 0 0 0"},children:t.description}):null})})}})]})})}}))}),[X,V,R,pe,ie,ee,F,ye,be,qe,Le]);return(0,J.jsx)(C.Z,{title:A.formatMessage({id:"ai.modelSelection.title"}),open:n,onClose:r,width:700,destroyOnHidden:!1,footer:(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,J.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:D?"#262626":"#f6f8fa",borderRadius:"6px",border:D?"1px solid #434343":"1px solid #e1e4e8"},children:[(0,J.jsx)(O,{type:"secondary",style:{fontSize:"14px",marginRight:"8px"},children:A.formatMessage({id:"ai.modelSelection.cannotFindModel"})}),(0,J.jsx)(S.ZP,{type:"link",onClick:Se,style:{padding:0,height:"auto",fontSize:"14px"},children:A.formatMessage({id:"ai.modelSelection.addNewModel"})})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)(S.ZP,{onClick:r,style:{marginRight:8},children:A.formatMessage({id:"ai.modelSelection.cancel"})}),(0,J.jsx)(S.ZP,{onClick:ke,type:"primary",children:A.formatMessage({id:"ai.modelSelection.confirm"})})]})]}),children:X.length>0?(0,J.jsx)(Z.Z,{activeKey:R||(null===(t=X.filter((function(e){return!q.ju.includes(e.type)}))[0])||void 0===t?void 0:t.uid),onChange:Pe,items:Je,destroyOnHidden:!1}):(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center"},children:[(0,J.jsx)(O,{type:"secondary",style:{fontSize:"16px",marginBottom:"16px"},children:A.formatMessage({id:"ai.modelSelection.noProviders"})}),(0,J.jsx)(O,{type:"secondary",style:{fontSize:"14px",marginBottom:"24px"},children:A.formatMessage({id:"ai.modelSelection.noProvidersTip"})}),(0,J.jsx)(S.ZP,{type:"primary",onClick:Se,style:{fontSize:"14px"},children:A.formatMessage({id:"ai.modelSelection.goToProviders"})})]})})}),(function(e,t){return e.visible===t.visible&&e.initialProvider===t.initialProvider&&e.initialModel===t.initialModel&&e.initialModelLabel===t.initialModelLabel}));t.Z=X},11818:function(e,t,n){n.d(t,{G:function(){return f}});var r=n(73193),i=n.n(r),a=(n(44194),n(47710)),o=n(94976),s=n(96596),l=n.n(s),u=n(67242),c=n(43388),d=n(58620),p=n(31549),f=function(e){var t=e.children,n=e.onSuccess,r=e.onError,s={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},f={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:s,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return s.file=e,s.fileName=t,s.fileType=e.type,u.Z.log("beforeUpload",s),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var t,i=null===(t=e.file.response)||void 0===t?void 0:t.data.fileUrl;n(i),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,p.jsx)(a.Z,i()(i()({},f),{},{children:t}))}},21850:function(e,t,n){var r=n(25553);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}}}]);