"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9107],{47944:function(e,t,a){a.d(t,{Z:function(){return s}});var r=a(83910),n=a(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},o=a(54183),l=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var s=n.forwardRef(l)},42085:function(e,t,a){a.d(t,{Z:function(){return s}});var r=a(83910),n=a(44194),i={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},o=a(54183),l=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:i}))};var s=n.forwardRef(l)},59005:function(e,t,a){var r=a(94433),n=a(38956),i=a(57343),o=a(44194),l=a(45441),s=a(9953),u=a(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var a=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.showSearch,k=e.options,x=(0,n.Z)(e,d),M=(0,o.useContext)(l.Z);return(0,u.jsx)(s.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,i.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:k,mode:m,showSearch:v,getPopupContainer:M.getPopupContainer},a),ref:t,proFieldProps:p},x),{},{children:c}))},p=o.forwardRef((function(e,t){var a=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.options,k=(0,n.Z)(e,c),x=(0,r.Z)({options:v,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),M=(0,o.useContext)(l.Z);return(0,u.jsx)(s.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,i.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:M.getPopupContainer},x),ref:t,proFieldProps:p},k),{},{children:d}))})),m=o.forwardRef(f);m.SearchSelect=p,m.displayName="ProFormComponent",t.Z=m},86702:function(e,t,a){var r=a(32906),n=a(94433),i=a(38956),o=a(81424),l=a(69705),s=a(65641),u=a(34573),d=a(44194),c=a(9953),f=a(31549),p=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",h=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),a=(0,r.Z)(t,2),i=a[0],u=a[1];return(0,f.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var a,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(s.Z,(0,n.Z)((0,n.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(a=e.statusRender)||void 0===a?void 0:a.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:i,children:e.children}))}})},v=function(e){var t=e.fieldProps,a=e.proFieldProps,r=(0,i.Z)(e,p);return(0,f.jsx)(c.Z,(0,n.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:a},r))};v.Password=function(e){var t=e.fieldProps,a=e.proFieldProps,o=(0,i.Z)(e,m),l=(0,d.useState)(!1),s=(0,r.Z)(l,2),p=s[0],v=s[1];return null!=t&&t.statusRender&&o.name?(0,f.jsx)(h,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:(0,n.Z)((0,n.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var a;null==t||null===(a=t.onBlur)||void 0===a||a.call(t,e),v(!1)},onClick:function(e){var a;null==t||null===(a=t.onClick)||void 0===a||a.call(t,e),v(!0)}}),proFieldProps:a,filedConfig:{valueType:g}},o))})}):(0,f.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:t,proFieldProps:a,filedConfig:{valueType:g}},o))},v.displayName="ProFormComponent",t.Z=v},60241:function(e,t,a){var r=a(94433),n=a(38956),i=a(44194),o=a(9953),l=a(31549),s=["fieldProps","proFieldProps"],u=function(e,t){var a=e.fieldProps,i=e.proFieldProps,u=(0,n.Z)(e,s);return(0,l.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:a,proFieldProps:i},u))};t.Z=i.forwardRef(u)},32403:function(e,t,a){a.r(t),a.d(t,{default:function(){return je}});var r=a(90819),n=a.n(r),i=a(89933),o=a.n(i),l=a(45332),s=a.n(l),u=a(36183),d=a(44194),c=a(4628),f=a(69131),p=a(48551),m=a(41142),g=a(24809),h=a(42729),v=(a(48019),a(17350)),k=a(58620),x=a(3395),M=a(67242),y=a(25553),b=a(83910),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},Z=a(54183),j=function(e,t){return d.createElement(Z.Z,(0,b.Z)({},e,{ref:t,icon:w}))};var C=d.forwardRef(j),P=a(76711),S=a.n(P),U=a(89957),F=a.n(U),q=a(30857),N=a(30310),E=a(69533),I=a(99036),T=a(59005),A=a(60241),R=a(86702),B=a(27961),W=a(54038),z=a(94976),_=a(82404),V=a(69705),K=a(68177),O=a(96955),H=a(69174),L=a(10390),G=a(73193),D=a.n(G),J=a(1282),Q=a(4342),X=a(93646),Y=a(64180),$=a(30861),ee=a(47710),te=a(46520),ae=a(12461),re=a(41474),ne=(a(77586),a(31549)),ie=J.Z.TextArea,oe=Q.ZP.Group,le=X.Z.Group;var se=function(e){var t=e.fields,a=e.translate,r=e.forms,i=void 0===r?[]:r,l=e.selectedFormUid,u=e.onFormSelect,f=e.onFormSubmit,p=e.loading,m=void 0!==p&&p,g=e.renderMode,h=void 0===g?"full":g,v=e.fieldNamePrefix,k=void 0===v?"":v,x=(0,d.useState)([]),M=s()(x,2),y=M[0],b=M[1],w=(0,d.useState)(null),Z=s()(w,2),j=Z[0],C=Z[1],P=(0,d.useState)(0),S=s()(P,2),U=S[0],F=S[1],q=(0,c.useIntl)(),N=function(e){if(!e)return"";try{return a&&a(e)||e}catch(t){return console.error("translate field text failed:",t),e}},I=function(e){try{var t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("解析表单schema失败:",e),[]}},T=i.map((function(e){return e.uid})).join(",");(0,d.useEffect)((function(){if(l&&i.length>0){var e=i.find((function(e){return e.uid===l}));if(e)if(C(e),e.schema){var t=I(e.schema);b(t)}else b([])}else C(null),b([])}),[l,T]);var A=function(e){var t,a=function(e,t){switch(e){case"text":switch(t){case"email":return q.formatMessage({id:"ticket.form.placeholder.email",defaultMessage:"请输入邮箱地址"});case"tel":return q.formatMessage({id:"ticket.form.placeholder.tel",defaultMessage:"请输入电话号码"});case"textarea":return q.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入文本内容"});case"date":return q.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"datetime-local":return q.formatMessage({id:"ticket.form.placeholder.datetime",defaultMessage:"请选择日期时间"});default:return q.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}case"input":return q.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"});case"textarea":return q.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入多行文本"});case"select":return q.formatMessage({id:"ticket.form.placeholder.select",defaultMessage:"请选择"});case"datePicker":return q.formatMessage({id:"ticket.form.placeholder.date",defaultMessage:"请选择日期"});case"timePicker":return q.formatMessage({id:"ticket.form.placeholder.time",defaultMessage:"请选择时间"});default:return q.formatMessage({id:"ticket.form.placeholder.text",defaultMessage:"请输入"})}}(e.type,null===(t=e.props)||void 0===t?void 0:t.type);return function(e){var t=e.type,a=e.props,r=void 0===a?{}:a,n=e.options,i=e.placeholder,o=e.isDarkMode,l=void 0!==o&&o;if(!t)return null;var s=t.toLowerCase(),u=l?{backgroundColor:"#141414",borderColor:"#434343",color:"#fff"}:{},d=l?{backgroundColor:"#141414"}:{};switch(s){case"text":switch(r.type||"text"){case"email":return(0,ne.jsx)(J.Z,{type:"email",placeholder:i||"请输入邮箱地址",style:u});case"tel":return(0,ne.jsx)(J.Z,{type:"tel",placeholder:i||"请输入电话号码",style:u});case"textarea":return(0,ne.jsx)(ie,{rows:r.rows||4,placeholder:i||"请输入文本内容",style:u});case"date":return(0,ne.jsx)(Y.ZP,{locale:re.Z,children:(0,ne.jsx)($.default,{style:D()({width:"100%"},u),placeholder:i||"请选择日期"})});case"datetime-local":return(0,ne.jsx)(Y.ZP,{locale:re.Z,children:(0,ne.jsx)($.default,{showTime:!0,style:D()({width:"100%"},u),placeholder:i||"请选择日期时间"})});case"file":return(0,ne.jsx)(ee.Z,{accept:r.accept,children:(0,ne.jsx)(E.ZP,{style:l?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传文件"})});default:return(0,ne.jsx)(J.Z,{placeholder:i||"请输入",style:u})}case"input":return(0,ne.jsx)(J.Z,{placeholder:i||"请输入",style:u});case"textarea":return(0,ne.jsx)(ie,{rows:4,placeholder:i||"请输入多行文本",style:u});case"select":return(0,ne.jsx)(H.Z,{style:D()({width:"100%"},d),placeholder:i||"请选择",classNames:l?{popup:{root:"dark-mode-select"}}:void 0,options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t)}})):[{label:"选项1",value:"1",key:"option-1"},{label:"选项2",value:"2",key:"option-2"}]});case"radio":return(0,ne.jsx)(oe,{style:l?{color:"#fff"}:{},children:(Array.isArray(n)?n:["选项1","选项2"]).map((function(e,t){return(0,ne.jsx)(Q.ZP,{value:e,style:l?{color:"#fff"}:{},children:e},"".concat(e,"-").concat(t))}))});case"checkbox":return(0,ne.jsx)(le,{style:l?{color:"#fff"}:{},options:Array.isArray(n)?n.map((function(e,t){return{label:e,value:e,key:"".concat(e,"-").concat(t),style:l?{color:"#fff"}:{}}})):[{label:"选项1",value:"1",key:"option-1",style:l?{color:"#fff"}:{}},{label:"选项2",value:"2",key:"option-2",style:l?{color:"#fff"}:{}}]});case"datepicker":return(0,ne.jsx)(Y.ZP,{locale:re.Z,children:(0,ne.jsx)($.default,{style:D()({width:"100%"},u),placeholder:i||"请选择日期",classNames:l?{popup:{root:"dark-mode-picker"}}:void 0})});case"timepicker":return(0,ne.jsx)(Y.ZP,{locale:re.Z,children:(0,ne.jsx)(te.Z,{style:D()({width:"100%"},u),placeholder:i||"请选择时间",classNames:l?{popup:{root:"dark-mode-picker"}}:void 0})});case"switch":return(0,ne.jsx)(ae.Z,{checkedChildren:"开",unCheckedChildren:"关"});case"upload":return(0,ne.jsx)(ee.Z,{accept:r.accept,children:(0,ne.jsx)(E.ZP,{style:l?{backgroundColor:"#1f1f1f",borderColor:"#434343",color:"#fff"}:{},children:"点击上传"})});default:return console.log("Unknown component type:",t),(0,ne.jsxs)("div",{children:["未知组件类型: ",t]})}}({type:e.type,props:e.props,options:e.options,placeholder:a,isDarkMode:!1})},R=function(){var e=o()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!f){e.next=6;break}return e.next=4,f(t);case 4:_.ZP.success(q.formatMessage({id:"ticket.form.submit.success",defaultMessage:"表单提交成功"})),F((function(e){return e+1}));case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("表单提交失败:",e.t0),_.ZP.error(q.formatMessage({id:"ticket.form.submit.error",defaultMessage:"表单提交失败"}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();if(t&&t.length>0){return(0,ne.jsx)(ne.Fragment,{children:t.map((function(e,t){var a=function(e,t){return(null==e?void 0:e.id)||(null==e?void 0:e.fieldId)||(null==e?void 0:e.key)||(null==e?void 0:e.name)||"field-".concat(t)}(e,t),r="".concat(k).concat(a),n=(null==e?void 0:e.label)||(null==e?void 0:e.title)||"Field ".concat(t+1),i=N(n)||n,o=null!=e&&e.required?[{required:!0,message:q.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:i})}]:void 0;return(0,ne.jsx)(V.Z.Item,{name:r,label:i,rules:o,children:A(e)},r)}))})}if("fields-only"===h){if(!l||!i.length)return null;var B=i.find((function(e){return e.uid===l}));if(!B||!B.schema)return null;var W=I(B.schema);return W.length?(0,ne.jsx)(ne.Fragment,{children:W.map((function(e,t){return(0,ne.jsx)(V.Z.Item,{name:"".concat(k).concat(e.id||"field-".concat(t)),label:N(e.label)||e.label,rules:[{required:e.required,message:q.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:N(e.label)||e.label})}],children:A(e)},e.id||"field-".concat(t))}))}):null}return 0===i.length?(0,ne.jsx)(K.Z,{title:q.formatMessage({id:"ticket.form.panel.title",defaultMessage:"工单表单"}),children:(0,ne.jsx)(O.Z,{description:q.formatMessage({id:"ticket.form.empty",defaultMessage:"暂无可用的工单表单"})})}):(0,ne.jsxs)(K.Z,{title:q.formatMessage({id:"ticket.form.panel.title",defaultMessage:"工单表单"}),children:[(0,ne.jsx)(H.Z,{style:{width:"100%",marginBottom:16},placeholder:q.formatMessage({id:"ticket.form.select.placeholder",defaultMessage:"请选择工单表单"}),value:l,onChange:function(e){u&&u(e)},options:i.map((function(e){return{label:e.name,value:e.uid,disabled:"PUBLISHED"!==e.status}}))}),j&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(L.Z,{orientation:"left",children:j.name}),j.description&&(0,ne.jsx)("p",{style:{color:"#666",marginBottom:16},children:j.description}),y.length>0?(0,ne.jsxs)(V.Z,{layout:"vertical",onFinish:R,style:{maxWidth:"100%"},children:[j&&y.length?(0,ne.jsx)(ne.Fragment,{children:y.map((function(e,t){return(0,ne.jsx)(V.Z.Item,{name:"".concat(k).concat(e.id||"field-".concat(t)),label:N(e.label)||e.label,rules:[{required:e.required,message:q.formatMessage({id:"ticket.form.required",defaultMessage:"{label}是必填项"},{label:N(e.label)||e.label})}],children:A(e)},e.id||"field-".concat(t))}))}):null,(0,ne.jsx)(V.Z.Item,{children:(0,ne.jsx)(E.ZP,{type:"primary",htmlType:"submit",loading:m,block:!0,children:q.formatMessage({id:"ticket.form.submit",defaultMessage:"提交表单"})})})]},U):(0,ne.jsx)(O.Z,{description:q.formatMessage({id:"ticket.form.fields.empty",defaultMessage:"该表单暂无字段配置"})})]})]})},ue=a(88722),de=a(54974),ce=function(e){return e?e.trim().replace(/\s+/g," ").slice(0,100):""},fe=function(e){var t=e.visible,a=e.onClose,r=e.orgUid,i=e.workgroupUid,l=e.ticket,f=(0,c.useIntl)(),p=u.Z.useApp().message,m=(0,ue.Z)().translateString,g=I.A.useForm(),h=s()(g,1)[0],v=(0,d.useState)(!1),k=s()(v,2),x=k[0],y=k[1],b=(0,c.useModel)("@@initialState").initialState,w=(null!=b?b:{}).userInfo,Z=(0,d.useMemo)((function(){return r||"df_org_uid"}),[r]),j=(0,d.useMemo)((function(){return i||""}),[i]),C=Boolean(null==l?void 0:l.uid),P=(0,d.useState)(null),U=s()(P,2),_=U[0],V=U[1],K=(0,d.useState)(!1),O=s()(K,2),H=O[0],L=O[1],G=(0,d.useRef)(),D=(0,d.useMemo)((function(){var e,t,a=null!==(e=null==_?void 0:_.categorySettings)&&void 0!==e?e:null==_?void 0:_.draftCategorySettings;return null!=a&&null!==(t=a.items)&&void 0!==t&&t.length?a.items.filter((function(e){return Boolean(null==e?void 0:e.uid)&&!1!==(null==e?void 0:e.enabled)})).sort((function(e,t){var a,r;return(null!==(a=e.orderIndex)&&void 0!==a?a:0)-(null!==(r=t.orderIndex)&&void 0!==r?r:0)})):[]}),[_]),J=(0,d.useMemo)((function(){return D.map((function(e){return{label:m(e.name||""),value:e.uid}}))}),[D,m]),Q=Boolean(null==_?void 0:_.customFormEnabled),X=(0,d.useMemo)((function(){var e;return null!==(e=null==_?void 0:_.form)&&void 0!==e?e:null==_?void 0:_.draftForm}),[_]),Y=(0,d.useMemo)((function(){var e,t,a,r,n,i,o,l,s,u=null!==(e=null==_?void 0:_.basicSettings)&&void 0!==e?e:null==_?void 0:_.draftBasicSettings;return{showContactName:null===(t=null==u?void 0:u.showContactName)||void 0===t||t,requireContactName:null===(a=null==u?void 0:u.requireContactName)||void 0===a||a,showEmail:null===(r=null==u?void 0:u.showEmail)||void 0===r||r,requireEmail:null!==(n=null==u?void 0:u.requireEmail)&&void 0!==n&&n,showPhone:null===(i=null==u?void 0:u.showPhone)||void 0===i||i,requirePhone:null===(o=null==u?void 0:u.requirePhone)||void 0===o||o,showWechat:null!==(l=null==u?void 0:u.showWechat)&&void 0!==l&&l,requireWechat:null!==(s=null==u?void 0:u.requireWechat)&&void 0!==s&&s}}),[_]),$=(0,d.useMemo)((function(){if(!Q||null==X||!X.schema)return[];try{var e=JSON.parse(X.schema);if(Array.isArray(e))return e;if(Array.isArray(null==e?void 0:e.schema))return e.schema;if(Array.isArray(null==e?void 0:e.fields))return e.fields;if(Array.isArray(null==e?void 0:e.content))return e.content}catch(e){console.error("ticket form schema parse error",e)}return[]}),[Q,null==X?void 0:X.schema]),ee=(0,d.useCallback)((function(e,t){return(null==e?void 0:e.id)||(null==e?void 0:e.fieldId)||(null==e?void 0:e.key)||(null==e?void 0:e.name)||"field-".concat(t)}),[]),te=(0,d.useState)(!1),ae=s()(te,2),re=ae[0],ie=ae[1],oe=(0,d.useState)([]),le=s()(oe,2),fe=le[0],pe=le[1],me=(0,d.useMemo)((function(){return{contactName:(null==w?void 0:w.nickname)||(null==w?void 0:w.username)||"",email:(null==w?void 0:w.email)||"",phone:(null==w?void 0:w.mobile)||""}}),[w]),ge=(0,d.useCallback)(o()(n()().mark((function e(){var t;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z&&j){e.next=3;break}return V(null),e.abrupt("return");case 3:return L(!0),e.prev=4,e.next=7,(0,W.bD)({orgUid:Z,workgroupUid:j,type:z.dCh});case 7:t=e.sent,M.Z.debug("getTicketSettingsByWorkgroup response:",null==t?void 0:t.data,Z,j),200===(null==t?void 0:t.code)&&null!=t&&t.data?V(t.data):(V(null),null!=t&&t.message&&M.Z.warn("getTicketSettingsByWorkgroup failed:",t.message)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),console.error("Fetch ticket settings error:",e.t0),V(null);case 16:return e.prev=16,L(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[4,12,16,19]])}))),[Z,j]);(0,d.useEffect)((function(){var e,t,a,r,n=G.current,i=null==_?void 0:_.uid;if(G.current=i,D.length){var o=h.getFieldValue("categoryUid");if(i!==n||!o||!D.some((function(e){return e.uid===o}))){var l=null!==(e=null==_?void 0:_.categorySettings)&&void 0!==e?e:null==_?void 0:_.draftCategorySettings,s=(null===(t=D.find((function(e){return e.uid===(null==l?void 0:l.defaultCategoryUid)})))||void 0===t?void 0:t.uid)||(null===(a=D.find((function(e){return e.defaultCategory})))||void 0===a?void 0:a.uid)||(null===(r=D[0])||void 0===r?void 0:r.uid);h.setFieldsValue({categoryUid:s||void 0})}}else h.setFieldsValue({categoryUid:void 0})}),[_,D,h,t]),(0,d.useEffect)((function(){if(t)if(C){var e;if(h.setFieldsValue({description:(null==l?void 0:l.description)||"",categoryUid:(null==l?void 0:l.categoryUid)||void 0,contactName:(null==l?void 0:l.contactName)||"",email:(null==l?void 0:l.email)||"",phone:(null==l?void 0:l.phone)||"",wechat:(null==l?void 0:l.wechat)||"",departmentUid:(null==l?void 0:l.departmentUid)||z.zBg,assigneeUid:(null==l||null===(e=l.assignee)||void 0===e?void 0:e.uid)||void 0}),null!=l&&l.schema)try{var a=JSON.parse(l.schema);if(a&&"object"===F()(a)){var r=a.formData;r&&"object"===F()(r)&&Object.entries(r).forEach((function(e){var t=s()(e,2),a=t[0],r=t[1];h.setFieldValue("dynamicField_".concat(a),r)}))}}catch(e){}}else{h.setFieldsValue({status:z.sM_,priority:z.GMZ,departmentUid:z.zBg,assigneeUid:void 0});var n=localStorage.getItem("admin_ticketDraft");n&&h.setFieldValue("description",n)}}),[t,h,C,l]),(0,d.useEffect)((function(){if(t){var e=h.getFieldsValue(["contactName","email","phone"]),a={};!e.contactName&&me.contactName&&(a.contactName=me.contactName),!e.email&&me.email&&(a.email=me.email),!e.phone&&me.phone&&(a.phone=me.phone),Object.keys(a).length>0&&h.setFieldsValue(a)}}),[t,me,h]),(0,d.useEffect)((function(){t&&Z&&j&&ge()}),[t,Z,j,ge]);var he=function(){var e=o()(n()().mark((function e(t){var r,i,o,s,u,d,c,m,g,v,k,x,b,P,S,U,F,q,N,E,I,T,A,R,W,K,O,H,L,G,D;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z){e.next=3;break}return p.error(f.formatMessage({id:"ticket.create.org.missing",defaultMessage:"缺少组织信息，无法创建工单"})),e.abrupt("return",!1);case 3:if(j){e.next=6;break}return p.error(f.formatMessage({id:"ticket.create.workgroup.missing",defaultMessage:"缺少工作组信息，无法创建工单"})),e.abrupt("return",!1);case 6:if(e.prev=6,y(!0),P=t.description||"",S=ce(P),U=C?t.priority||(null==l?void 0:l.priority)||z.GMZ:t.priority||z.GMZ,F=t.departmentUid&&t.departmentUid!==z.zBg?t.departmentUid:void 0,q=Object.prototype.hasOwnProperty.call(t,"departmentUid"),N=t.assigneeUid||void 0,E=Array.from(new Set((fe||[]).map((function(e){return null==e?void 0:e.uid})).filter((function(e){return Boolean(e)})))),I=Boolean(Q&&(null==X?void 0:X.uid)),T=I?new Set($.map((function(e,t){return"dynamicField_".concat(ee(e,t))}))):new Set,A={},Object.keys(t).forEach((function(e){if(e.startsWith("dynamicField_")){if(I&&T.has(e)){var a=e.replace("dynamicField_","");A[a]=t[e]}delete t[e]}})),R=null,I&&null!=X&&X.uid&&(R={formUid:X.uid,formName:X.name,formSchema:X.schema,formData:A}),W="string"==typeof t.contactName?t.contactName.trim():void 0,K="string"==typeof t.email?t.email.trim():void 0,O="string"==typeof t.phone?t.phone.trim():void 0,H="string"==typeof t.wechat?t.wechat.trim():void 0,L={uid:C?null==l?void 0:l.uid:void 0,description:P,title:S,priority:U||(null==l?void 0:l.priority)||z.GMZ,status:(null==l?void 0:l.status)||z.sM_,level:z.Hxq,orgUid:Z,workgroupUid:j,departmentUid:q?F:(null==l?void 0:l.departmentUid)||void 0,assigneeUid:N||(null==l||null===(r=l.assignee)||void 0===r?void 0:r.uid)||void 0,assignee:(null==l?void 0:l.assignee)||void 0,contactName:C?Y.showContactName?null!=W?W:null!==(i=null==l?void 0:l.contactName)&&void 0!==i?i:"":null!==(o=null==l?void 0:l.contactName)&&void 0!==o?o:"":Y.showContactName&&null!=W?W:"",email:C?Y.showEmail?null!=K?K:null!==(s=null==l?void 0:l.email)&&void 0!==s?s:"":null!==(u=null==l?void 0:l.email)&&void 0!==u?u:"":Y.showEmail&&null!=K?K:"",phone:C?Y.showPhone?null!=O?O:null!==(d=null==l?void 0:l.phone)&&void 0!==d?d:"":null!==(c=null==l?void 0:l.phone)&&void 0!==c?c:"":Y.showPhone&&null!=O?O:"",wechat:C?Y.showWechat?null!=H?H:null!==(m=null==l?void 0:l.wechat)&&void 0!==m?m:"":null!==(g=null==l?void 0:l.wechat)&&void 0!==g?g:"":Y.showWechat&&null!=H?H:"",reporterUid:(null==l||null===(v=l.reporter)||void 0===v?void 0:v.uid)||(null==w?void 0:w.uid),reporter:(null==l?void 0:l.reporter)||(null!=w&&w.uid?{uid:w.uid,nickname:(null==w?void 0:w.nickname)||(null==w?void 0:w.username)||void 0,avatar:(null==w?void 0:w.avatar)||void 0}:void 0),categoryUid:t.categoryUid||void 0,uploadUids:C?void 0:E.length?E:void 0,schema:R?JSON.stringify(R):void 0,ticketSettingsUid:null==_?void 0:_.uid,processEntityUid:null!==(k=null==_||null===(x=_.process)||void 0===x?void 0:x.uid)&&void 0!==k?k:null==_||null===(b=_.draftProcess)||void 0===b?void 0:b.uid,formEntityUid:C?void 0:I?null==X?void 0:X.uid:void 0},!C){e.next=41;break}return e.next=29,(0,B.O)(L);case 29:if(G=e.sent,M.Z.debug("updateTicket response:",G,L),200!==(null==G?void 0:G.code)){e.next=39;break}return p.success(f.formatMessage({id:"ticket.update.success",defaultMessage:"工单更新成功"})),h.resetFields(),V(null),pe([]),ie(!1),a(!0),e.abrupt("return",!0);case 39:return p.error((null==G?void 0:G.message)||f.formatMessage({id:"ticket.update.failed",defaultMessage:"工单更新失败"})),e.abrupt("return",!1);case 41:return e.next=43,(0,B.ax)(L);case 43:if(D=e.sent,M.Z.debug("createTicket response:",D,L),200!==(null==D?void 0:D.code)){e.next=54;break}return p.success(f.formatMessage({id:"ticket.create.success",defaultMessage:"工单创建成功"})),h.resetFields(),localStorage.removeItem("admin_ticketDraft"),V(null),pe([]),ie(!1),a(!0),e.abrupt("return",!0);case 54:return p.error((null==D?void 0:D.message)||f.formatMessage({id:"ticket.create.failed",defaultMessage:"工单创建失败"})),e.abrupt("return",!1);case 58:return e.prev=58,e.t0=e.catch(6),console.error(C?"Update ticket failed:":"Create ticket failed:",e.t0),p.error(f.formatMessage({id:C?"ticket.update.failed":"ticket.create.failed",defaultMessage:C?"工单更新失败":"工单创建失败"})),e.abrupt("return",!1);case 63:return e.prev=63,y(!1),e.finish(63);case 66:case"end":return e.stop()}}),e,null,[[6,58,63,66]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){h.resetFields(),V(null),pe([]),ie(!1),a()};return(0,ne.jsxs)(q.Z,{title:C?f.formatMessage({id:"ticket.update.title",defaultMessage:"编辑工单"}):f.formatMessage({id:"ticket.create.title",defaultMessage:"创建工单"}),placement:"right",onClose:ve,open:t,width:500,extra:(0,ne.jsxs)(N.Z,{children:[(0,ne.jsx)(E.ZP,{onClick:ve,children:f.formatMessage({id:"common.cancel",defaultMessage:"取消"})}),(0,ne.jsx)(E.ZP,{type:"primary",onClick:function(){return h.submit()},loading:x||H,children:f.formatMessage({id:"common.confirm",defaultMessage:"确认"})})]}),children:[(0,ne.jsxs)(I.A,{form:h,layout:"vertical",submitter:{render:!1},onFinish:he,initialValues:{status:z.sM_,priority:z.GMZ,departmentUid:z.zBg},children:[J.length>0&&(0,ne.jsx)(T.Z,{name:"categoryUid",label:f.formatMessage({id:"ticket.category",defaultMessage:"问题分类"}),placeholder:f.formatMessage({id:"ticket.category.placeholder",defaultMessage:"请选择问题分类"}),options:J,rules:[{required:!0,message:f.formatMessage({id:"ticket.category.required",defaultMessage:"请选择问题分类"})}],fieldProps:{loading:H,showSearch:!0,optionFilterProp:"label"}}),Q&&$.length>0&&(0,ne.jsx)(se,{fields:$,fieldNamePrefix:"dynamicField_",translate:m}),(0,ne.jsx)(A.Z,{name:"description",label:f.formatMessage({id:"ticket.description",defaultMessage:"问题描述"}),placeholder:f.formatMessage({id:"ticket.description.placeholder",defaultMessage:"请详细描述您遇到的问题，以便我们更好地为您服务..."}),fieldProps:{rows:6,onBlur:function(){var e=h.getFieldValue("description");e&&localStorage.setItem("admin_ticketDraft",e)}},rules:[{required:!0,message:f.formatMessage({id:"ticket.description.required",defaultMessage:"请输入问题描述"})},{max:2e3,message:f.formatMessage({id:"ticket.description.maxlength",defaultMessage:"描述不能超过2000个字符"})}]}),Y.showContactName&&(0,ne.jsx)(R.Z,{name:"contactName",label:f.formatMessage({id:"ticket.contact.name",defaultMessage:"称呼"}),rules:Y.requireContactName?[{required:!0,message:f.formatMessage({id:"ticket.contact.name.required",defaultMessage:"请输入称呼"})}]:[],placeholder:f.formatMessage({id:"ticket.contact.name.placeholder",defaultMessage:"请输入您的称呼"})}),Y.showEmail&&(0,ne.jsx)(R.Z,{name:"email",label:f.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),placeholder:f.formatMessage({id:"ticket.contact.email.placeholder",defaultMessage:"请输入邮箱地址"}),rules:[].concat(S()(Y.requireEmail?[{required:!0,message:f.formatMessage({id:"ticket.contact.email.required",defaultMessage:"请输入邮箱地址"})}]:[]),[{type:"email",message:f.formatMessage({id:"ticket.contact.email.invalid",defaultMessage:"请输入有效的邮箱地址"})}])}),Y.showPhone&&(0,ne.jsx)(R.Z,{name:"phone",label:f.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),rules:Y.requirePhone?[{required:!0,message:f.formatMessage({id:"ticket.contact.phone.required",defaultMessage:"请输入手机号码"})}]:[],placeholder:f.formatMessage({id:"ticket.contact.phone.placeholder",defaultMessage:"请输入手机号码"})}),Y.showWechat&&(0,ne.jsx)(R.Z,{name:"wechat",label:f.formatMessage({id:"ticket.contact.wechat",defaultMessage:"微信"}),rules:Y.requireWechat?[{required:!0,message:f.formatMessage({id:"ticket.contact.wechat.required",defaultMessage:"请输入微信号"})}]:[],placeholder:f.formatMessage({id:"ticket.contact.wechat.placeholder",defaultMessage:"请输入您的微信号"}),extra:f.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})}),Y.showPhone&&!Y.showWechat&&(0,ne.jsx)("div",{style:{marginTop:-16,marginBottom:16},children:(0,ne.jsx)("span",{style:{color:"rgba(0, 0, 0, 0.45)",fontSize:12},children:f.formatMessage({id:"ticket.contact.extra",defaultMessage:"请留下您的联系方式，以便我们及时回复"})})})]}),re&&(0,ne.jsx)(de.Z,{type:z.hcJ,isModalOpen:re,handleSubmit:function(e){pe((function(t){var a=new Map;return t.forEach((function(e){null!=e&&e.uid&&a.set(e.uid,e)})),(e||[]).forEach((function(e){null!=e&&e.uid&&a.set(e.uid,e)})),Array.from(a.values())})),ie(!1)},handleCancel:function(){return ie(!1)}})]})},pe=a(10154),me=a.n(pe),ge=a(90581),he=a(34512),ve=a(59145),ke=a(10162),xe=a(44429),Me="df_org_uid",ye=(0,d.forwardRef)((function(e,t){var a,r=e.onCreateClick,i=(0,c.useIntl)(),l=u.Z.useApp().message,f=(0,d.useRef)(),p=(0,xe.L)((function(e){return e.userInfo})),m=(0,d.useState)(!1),g=s()(m,2),h=g[0],v=g[1],k=(0,d.useState)(null),x=s()(k,2),y=x[0],b=x[1];(0,d.useImperativeHandle)(t,(function(){return{reload:function(){var e;null===(e=f.current)||void 0===e||e.reload()}}}));var w=(0,d.useCallback)((function(e){null!=e&&e.uid&&(b(e),v(!0))}),[]),Z=(0,d.useCallback)((function(e){var t;(v(!1),b(null),e)&&(null===(t=f.current)||void 0===t||t.reload())}),[]),j=function(e){return i.formatMessage({id:"ticket.status.".concat(e.toLowerCase()),defaultMessage:e})},C=(a={},me()(me()(me()(me()(me()(me()(me()(me()(me()(me()(a,z.sM_,{text:j(z.sM_),status:"Processing"}),z.Yux,{text:j(z.Yux),status:"Processing"}),z.sFW,{text:j(z.sFW),status:"Processing"}),z.W66,{text:j(z.W66),status:"Warning"}),z.z1,{text:j(z.z1),status:"Processing"}),z.yZA,{text:j(z.yZA),status:"Processing"}),z.pIN,{text:j(z.pIN),status:"Warning"}),z.XrC,{text:j(z.XrC),status:"Warning"}),z.L1h,{text:j(z.L1h),status:"Processing"}),z.yib,{text:j(z.yib),status:"Warning"}),me()(me()(me()(me()(me()(me()(a,z.hwr,{text:j(z.hwr),status:"Success"}),z.AzB,{text:j(z.AzB),status:"Warning"}),z.frw,{text:j(z.frw),status:"Default"}),z.xw4,{text:j(z.xw4),status:"Error"}),z.qQU,{text:j(z.qQU),status:"Success"}),z.GJZ,{text:j(z.GJZ),status:"Error"})),P=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",align:"center",search:!1},{title:i.formatMessage({id:"ticket.number",defaultMessage:"工单编号"}),dataIndex:"ticketNumber",key:"ticketNumber",fixed:"left",copyable:!0,width:150},{title:i.formatMessage({id:"ticket.description",defaultMessage:"描述"}),dataIndex:"description",key:"description",ellipsis:!0},{title:i.formatMessage({id:"ticket.status",defaultMessage:"状态"}),dataIndex:"status",key:"status",width:100,valueType:"select",valueEnum:C,render:function(e,t){return function(e){var t;if(!e)return"-";var a=String(e).toUpperCase(),r=(t={},me()(me()(me()(me()(me()(me()(me()(me()(me()(me()(t,z.sM_,"blue"),z.Yux,"geekblue"),z.sFW,"cyan"),z.W66,"magenta"),z.z1,"processing"),z.yZA,"lime"),z.pIN,"warning"),z.XrC,"orange"),z.L1h,"cyan"),z.yib,"volcano"),me()(me()(me()(me()(me()(me()(t,z.hwr,"success"),z.AzB,"purple"),z.frw,"default"),z.xw4,"error"),z.qQU,"green"),z.GJZ,"red"))[a]||"default",n=j(a);return(0,ne.jsx)(ge.Z,{color:r,children:n})}(t.status)}},{title:i.formatMessage({id:"ticket.contact.name",defaultMessage:"联系人"}),dataIndex:"contactName",key:"contactName",width:120,search:!1},{title:i.formatMessage({id:"ticket.contact.email",defaultMessage:"邮箱"}),dataIndex:"email",key:"email",width:180,copyable:!0,search:!1},{title:i.formatMessage({id:"ticket.contact.phone",defaultMessage:"手机"}),dataIndex:"phone",key:"phone",width:150,copyable:!0,search:!1},{title:i.formatMessage({id:"ticket.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",key:"createdAt",width:180,search:!1},{title:i.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(e,t){return[(0,ne.jsx)(E.ZP,{type:"link",onClick:function(){return w(t)},children:i.formatMessage({id:"ticket.edit",defaultMessage:"编辑"})},"edit"),(0,ne.jsx)(E.ZP,{type:"link",icon:(0,ne.jsx)(ve.Z,{}),onClick:function(){return function(e){var t;M.Z.debug("handleShowTicketChat",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:z.EnU,sid:null==e?void 0:e.uid,visitorUid:null==p?void 0:p.uid,nickname:null==p?void 0:p.nickname,avatar:null==p?void 0:p.avatar,mobile:null==p?void 0:p.mobile,email:null==p?void 0:p.email}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}(t)},children:i.formatMessage({id:"ticket.chat",defaultMessage:"对话"})},"chat")]}}];return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(he.Z,{actionRef:f,columns:P,rowKey:"uid",style:{padding:10},scroll:{x:1500},request:function(){var e=o()(n()().mark((function e(t){var a,r;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:(t.current||1)-1,pageSize:t.pageSize||20,userUid:null==p?void 0:p.uid,orgUid:Me,ticketNumber:t.ticketNumber||void 0,level:z.Hxq},e.next=4,(0,B.AQ)(a);case 4:if(r=e.sent,M.Z.debug("queryTicketsByOrg:",r,a),200!==(null==r?void 0:r.code)||null==r||!r.data){e.next=10;break}return e.abrupt("return",{data:(null==r?void 0:r.data.content)||[],success:!0,total:(null==r?void 0:r.data.totalElements)||0});case 10:l.error(i.formatMessage({id:"ticket.list.load.failed",defaultMessage:"加载工单列表失败"}));case 11:return e.abrupt("return",{data:[],success:!1,total:0});case 14:return e.prev=14,e.t0=e.catch(0),console.error("加载工单列表失败:",e.t0),l.error(i.formatMessage({id:"ticket.list.load.failed",defaultMessage:"加载工单列表失败"})),e.abrupt("return",{data:[],success:!1,total:0});case 19:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e){return i.formatMessage({id:"pages.table.total",defaultMessage:"共 {total} 条"},{total:e})}},toolBarRender:function(){return[(0,ne.jsx)(E.ZP,{type:"primary",icon:(0,ne.jsx)(ke.Z,{}),onClick:r,children:i.formatMessage({id:"ticket.create",defaultMessage:"创建工单"})},"create")]}}),h&&(0,ne.jsx)(fe,{visible:h,onClose:Z,orgUid:(null==y?void 0:y.orgUid)||Me,workgroupUid:null==y?void 0:y.workgroupUid,ticket:y})]})})),be=ye,we=a(35084),Ze=function(){var e=(0,c.useIntl)(),t=u.Z.useApp(),a=t.message,r=t.modal,i=(0,c.useSearchParams)(),l=s()(i,2),b=l[0],w=l[1],Z=b.get("status")||"todo",j=(0,d.useState)(Z),P=s()(j,2),S=P[0],U=P[1],F=(0,d.useState)(!1),q=s()(F,2),N=q[0],E=q[1],I=(0,d.useRef)(null),T=(0,d.useRef)(!1),A=(0,k.OJ)(),R=(0,y.Z)().isDarkMode,B=(0,d.useState)(!1),W=s()(B,2),z=W[0],_=W[1],V=(0,d.useState)(null),K=s()(V,2),O=K[0],H=K[1],L=(0,d.useState)(!1),G=s()(L,2),D=(G[0],G[1]),J=(0,c.useModel)("@@initialState").initialState,Q=(null!=J?J:{}).userInfo;(0,d.useEffect)((function(){if(null==J||!J.userInfo){c.history.push("/auth/login?redirect=".concat(encodeURIComponent("/ticket-center")))}}),[J]),(0,d.useEffect)((function(){U(Z)}),[Z]);var X=(0,d.useCallback)((function(){"undefined"!=typeof window&&window.history.length>1?c.history.back():c.history.push("/")}),[c.history]),Y=(0,d.useCallback)((function(t,a){r.warning({title:e.formatMessage({id:"ticket.center.disabled.title",defaultMessage:"SuperTicket 未启用"}),content:e.formatMessage({id:t,defaultMessage:a}),okText:e.formatMessage({id:"common.ok",defaultMessage:"确定"}),cancelButtonProps:{style:{display:"none"}},maskClosable:!1,closable:!1,keyboard:!1,onOk:X})}),[X,e,r]);(0,d.useEffect)((function(){if(A){var t=function(){var t=o()(n()().mark((function t(){var r,i,o;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return D(!0),t.prev=1,t.next=4,(0,x.sc)();case 4:r=t.sent,M.Z.debug("queryPlatformTicketCenterSettings:",null==r?void 0:r.data),200===(null==r?void 0:r.code)&&null!=r&&r.data&&(o=!1!==(null==r||null===(i=r.data)||void 0===i?void 0:i.ticketCenterEnabled),H({workgroupUid:null==r?void 0:r.data.workgroupUid,ticketCenterEnabled:o,description:null==r?void 0:r.data.description}),o||T.current||(T.current=!0,Y("ticket.center.disabled.desc","请联系管理员启用 SuperTicket 后再访问此页面。"))),_(!0),t.next=15;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("加载平台工单中心配置失败:",t.t0),a.error(e.formatMessage({id:"ticket.center.settings.load.failed",defaultMessage:"加载平台工单中心配置失败"})),_(!0);case 15:return t.prev=15,D(!1),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,10,15,18]])})));return function(){return t.apply(this,arguments)}}();t()}else T.current||(T.current=!0,Y("ticket.center.disabled.no.permission","当前版本无法访问 SuperTicket，请联系管理员升级或启用。"))}),[A,X,e,a,r]);var $,ee,te=[{path:"/ticket-list",name:e.formatMessage({id:"ticket.list",defaultMessage:"工单列表"}),icon:(0,ne.jsx)(C,{})}];return(0,ne.jsxs)(f.f,{title:($=(0,k.nt)(),ee=(0,k.ye)(),$&&ee?ee:e.formatMessage({id:"app.title"})),logo:(0,k.do)(),layout:"mix",fixedHeader:!0,fixSiderbar:!0,splitMenus:!1,navTheme:R?"realDark":"light",route:{path:"/",routes:te},location:{pathname:"/".concat(S)},menuItemRender:function(e,t){return(0,ne.jsx)("div",{onClick:function(){var t,a,r=null===(t=e.path)||void 0===t?void 0:t.replace("/","");r&&(a={key:r}.key,U(a),w({status:a}))},children:t})},actionsRender:function(){return[(0,ne.jsx)(m.Z,{},"fullScreen"),(0,ne.jsx)(v.Z,{},"trialTip"),(0,ne.jsx)(h.Z,{},"GotoGithub"),!1,(0,ne.jsx)(g.Z,{},"GotoAgent")]},avatarProps:{src:null==Q?void 0:Q.avatar,title:(0,ne.jsx)(p.gj,{}),render:function(e,t){return(0,ne.jsx)(p.Kd,{menu:!0,children:t})}},footerRender:function(){return(0,ne.jsx)(p.$_,{})},contentStyle:{margin:0,padding:0,background:R?"#141414":"#f0f2f5"},children:[(0,ne.jsx)(we.Z,{configLoaded:z}),(0,ne.jsx)(be,{ref:I,onCreateClick:function(){return E(!0)}}),N&&(0,ne.jsx)(fe,{visible:N,onClose:function(e){var t;(E(!1),e)&&(null===(t=I.current)||void 0===t||t.reload())},orgUid:"df_org_uid",workgroupUid:(null==O?void 0:O.workgroupUid)||"df_wg_ticket"})]})},je=function(){return(0,ne.jsx)(u.Z,{children:(0,ne.jsx)(Ze,{})})}},8732:function(e,t,a){a.d(t,{j:function(){return c}});var r=a(73193),n=a.n(r),i=a(76711),o=a.n(i),l=a(94976),s=a(26557),u=a(26407),d=a(20744),c=(0,s.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var a=e.kbaseResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var a;e({kbaseResult:t}),(null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(a){var r=t().kbaseResult.data.content,i=r.findIndex((function(e){return e.uid===a.uid}));if(-1!==i){var l=[].concat(o()(r.slice(0,i)),[a],o()(r.slice(i+1))),s=n()(n()({},t().kbaseResult),{},{data:{content:l}});e({kbaseResult:s,currentKbase:a})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:a})},removeKbase:function(a){var r=t().kbaseResult.data.content,i=r.findIndex((function(e){return e.uid===a}));-1!==i?e({kbaseResult:n()(n()({},t().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,i)),o()(r.slice(i+1)))}})}):console.warn("Kbase not found in cache:",a),t().currentKbase.uid===a&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:l.wKE})))}}]);