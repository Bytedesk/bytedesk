"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{67560:function(e,t,n){n(90819),n(73193),n(89933),n(45332),n(24170),n(72614),n(1902),n(95490),n(55735),n(30921),n(44194),n(31549)},56347:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ve}});var r=n(75574),o=n(44194),s=n(90819),i=n.n(s),a=n(89933),u=n.n(a),l=n(45332),d=n.n(l),c=n(86803),g=n(24170),p=n(72614),f=n(23864),m=n(1902),v=n(40612),k=n(95490),h=n(15722),w=n(82669),b=n(30921),y=n(53530),x=n(27487),F=n(75365),j=n(9452),M=n(84288),S=n(76750),Z=n(69169),R=n(4499),q=n(84881),C=n(31549),W=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=Z.A.useForm(),i=d()(s,1)[0],a=(0,S.Z)().translateString,u=(0,v.u)((function(e){return e.currentOrg})),l=(0,m.E)((function(e){return e.agentResult})),c=(0,o.useState)([]),g=d()(c,2),p=g[0],f=g[1];(0,o.useEffect)((function(){i.setFieldsValue({nickname:"",agents:[]})}),[]);return(0,C.jsx)("div",{children:(0,C.jsx)(y.Z,{title:"创建技能组",open:t,forceRender:!0,onOk:function(){console.log("handleOk"),i.validateFields().then((function(e){console.log("form values:",e);var t={nickname:i.getFieldValue("nickname"),agentUids:i.getFieldValue("agents"),orgUid:null==u?void 0:u.uid};console.log("workgroup:",t),r(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,C.jsxs)(Z.A,{form:i,name:"wgForm",submitter:{render:function(e,t){return(0,C.jsx)(C.Fragment,{})}},children:[(0,C.jsx)(R.Z,{label:"技能组昵称",name:"nickname",rules:[{required:!0,message:"请输入昵称!"}]}),(0,C.jsx)(q.Z,{name:"agents",label:"成员",options:l.data.content.map((function(e){return{value:e.uid,label:a(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:"请选择成员",value:p,onChange:function(e){console.log("selected ".concat(e)),f(e)}}})]})})})},P=function(){var e=(0,b.useIntl)(),t=(0,o.useRef)(!1),n=(0,S.Z)().translateStringTranct,r=(0,f.Z)().isDarkMode,s=(0,o.useState)(!1),a=d()(s,2),l=a[0],Z=a[1],R=(0,v.u)((function(e){return e.currentOrg})),q=(0,m.E)((function(e){return e.setAgentResult})),P=(0,k.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,insertWorkgroup:e.insertWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup,deleteCurrentWorkgroup:e.deleteCurrentWorkgroup}})),U=P.workgroupResult,A=P.currentWorkgroup,T=P.setWorkgroupResult,L=P.insertWorkgroup,E=P.setCurrentWorkgroup,V=P.deleteCurrentWorkgroup,D=y.Z.useModal(),I=d()(D,2),O=I[0],z=I[1],B=function(){var t=u()(i()().mark((function t(n){var r;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete workgroup",n),c.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),t.next=4,(0,p.zl)(n);case 4:r=t.sent,console.log("delete workgroup response",r),200===r.code?(c.yw.destroy(),c.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),V(n.uid)):(c.yw.destroy(),c.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),H=function(){var e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==R?void 0:R.uid},e.next=3,(0,g._t)(t);case 3:n=e.sent,console.log("queryAgentsByOrg: ",n),200===n.code?q(n):c.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=u()(i()().mark((function e(){var n,r,o,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,c.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==R?void 0:R.uid},e.next=8,(0,p.u7)(n);case 8:r=e.sent,console.log("getWorkgroups",r),200===r.code?(c.yw.destroy(),T(r),null===A&&(null==r||null===(o=r.data)||void 0===o||null===(o=o.content)||void 0===o?void 0:o.length)>0&&E(null==r||null===(s=r.data)||void 0===s?void 0:s.content[0])):(c.yw.destroy(),c.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){N(),H()}),[]);var G=function(){var t=u()(i()().mark((function t(n){var r;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSave",n),c.yw.loading(e.formatMessage({id:"creating",defaultMessage:"Creating"})),t.next=4,(0,p.p0)(n);case 4:r=t.sent,console.log("create workgroup:",r),200===r.code?(c.yw.destroy(),c.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),Z(!1),L(r.data)):(c.yw.destroy(),Z(!1),c.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(x.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,C.jsx)(F.ZP,{size:"small",type:"primary",icon:(0,C.jsx)(w.Z,{}),onClick:function(){Z(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,C.jsx)(F.ZP,{size:"small",onClick:N,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,C.jsx)(F.ZP,{onClick:function(){return function(t){O.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,C.jsx)(h.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.nickname,"】？"),onOk:function(){B(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(A)},size:"small",danger:!0,disabled:A&&""===A.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,C.jsx)(j.Z,{itemLayout:"horizontal",dataSource:U.data.content,renderItem:function(e,t){return(0,C.jsx)(j.Z.Item,{style:A.uid===e.uid?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){E(e)},children:(0,C.jsx)(j.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,C.jsx)(M.C,{src:e.avatar}),title:(0,C.jsx)(C.Fragment,{children:n(e.nickname)}),description:n(e.description)})},e.uid)}}),l&&(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(W,{open:l,onClose:function(){Z(!1)},onSubmit:G})}),z]})},U=n(8247),A=n(73193),T=n.n(A),L=n(32350),E=n(59908),V=n(6631),D=function(){var e,t,n=Z.A.useForm(),r=d()(n,1)[0],s=(0,b.useIntl)(),a=(0,S.Z)().translateString,l=(0,m.E)((function(e){return e.agentResult})),g=(0,k.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),f=g.currentWorkgroup,v=g.setCurrentWorkgroup,h=(0,o.useState)((null===(e=f.agents)||void 0===e?void 0:e.map((function(e){return e.uid})))||[]),w=d()(h,2),y=w[0],x=w[1],j=(0,o.useState)(""),W=d()(j,2),P=W[0],U=W[1];(0,o.useEffect)((function(){if(f){var e;r.setFieldValue("nickname",a(null==f?void 0:f.nickname)),r.setFieldValue("description",a(null==f?void 0:f.description));var t=[];null===(e=f.agents)||void 0===e||e.forEach((function(e){t.push(e.uid)})),x(t)}}),[f]),(0,o.useEffect)((function(){f.agents&&(x(f.agents.map((function(e){return e.uid}))),r.setFieldsValue({agents:f.agents.map((function(e){return e.uid}))}))}),[f]);var A=function(){var e=u()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUploadSuccess:",t),U(t),n=T()(T()({},f),{},{avatar:t}),e.next=5,(0,p.n1)(n);case 5:r=e.sent,console.log("updateAvatar response:",r),200===r.code?(c.yw.success(s.formatMessage({id:"update.success"})),v(r.data)):(c.yw.destroy(),c.yw.error(r.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=u()(i()().mark((function e(t){var n,r,o,a,u,l,d,g,m,k;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish",t),c.yw.loading(s.formatMessage({id:"updating"})),m=T()(T()(T()({},f),t),{},{avatar:P,agentUids:y,serviceSettings:T()(T()({},f.serviceSettings),{},{welcomeFaqUids:null==f||null===(n=f.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),quickFaqUids:null==f||null===(r=f.serviceSettings)||void 0===r||null===(r=r.quickFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null==f||null===(o=f.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})),guessFaqUids:null==f||null===(a=f.serviceSettings)||void 0===a||null===(a=a.guessFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),hotFaqUids:null===(u=f.serviceSettings)||void 0===u||null===(u=u.hotFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),shortcutFaqUids:null==f||null===(l=f.serviceSettings)||void 0===l||null===(l=l.shortcutFaqs)||void 0===l?void 0:l.map((function(e){return e.uid}))}),robotSettings:T()(T()({},f.robotSettings),{},{robotUid:null===(d=f.robotSettings)||void 0===d||null===(d=d.robot)||void 0===d?void 0:d.uid}),messageLeaveSettings:T()(T()({},f.messageLeaveSettings),{},{worktimeUids:null===(g=f.messageLeaveSettings)||void 0===g||null===(g=g.worktimes)||void 0===g?void 0:g.map((function(e){return e.uid}))}),queueSettings:T()({},f.queueSettings)}),console.log("workgroupObject:",m),e.next=6,(0,p.W5)(m);case 6:k=e.sent,console.log("updateWorkGroup response:",k),200===k.code?(c.yw.destroy(),c.yw.success(s.formatMessage({id:"update.success"})),v(k.data)):(c.yw.destroy(),c.yw.error(k.message));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){U(null==f?void 0:f.avatar)}),[f]),(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(Z.A,{form:r,style:{marginLeft:"20px"},onFinish:D,children:[(0,C.jsx)(Z.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:s.formatMessage({id:"avatar"}),children:(0,C.jsxs)(V.G,{onSuccess:A,onError:function(e){console.log("handleUploadError:",e),c.yw.error(e)},children:[(0,C.jsx)(M.C,{src:P}),(0,C.jsx)(F.ZP,{icon:(0,C.jsx)(E.Z,{}),children:s.formatMessage({id:"upload"})})]},"avatar")}),(0,C.jsx)(R.Z,{width:"md",name:"nickname",label:s.formatMessage({id:"nickname"}),rules:[{required:!0,message:s.formatMessage({id:"please.input.nickname"})}]}),(0,C.jsx)(q.Z,{name:"agents",label:s.formatMessage({id:"members"}),tooltip:s.formatMessage({id:"please.create.agents.tooltip"}),width:"md",initialValue:null===(t=f.agents)||void 0===t?void 0:t.map((function(e){return e.uid})),options:l.data.content.map((function(e){return{value:e.uid,label:a(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:s.formatMessage({id:"please.select.members"}),onChange:function(e){console.log("selected ".concat(e)),x(e)}},rules:[{required:!0,message:s.formatMessage({id:"please.select.members"})}]}),(0,C.jsx)(L.Z,{width:"md",name:"description",label:s.formatMessage({id:"description"}),rules:[{required:!0,message:s.formatMessage({id:"please.input.description"})}]})]})})},I=n(55735),O=n(43705),z=n(71469),B=n(23635),H=(n(67560),n(54166),n(50796)),N=n(75808),G=n(40836),Q=n(17082),$=n(73457),X=n(82308),J=n(67402),K=n(69088),_=n(87413),Y=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],ee=o.forwardRef((function(e,t){var n=e.fieldProps,r=e.options,o=e.radioType,s=e.layout,i=e.proFieldProps,a=e.valueEnum,u=(0,$.Z)(e,Y);return(0,C.jsx)(_.Z,(0,Q.Z)((0,Q.Z)({valueType:"button"===o?"radioButton":"radio",ref:t,valueEnum:(0,X.h)(a,void 0)},u),{},{fieldProps:(0,Q.Z)({options:r,layout:s},n),proFieldProps:i,filedConfig:{customLightMode:!0}}))})),te=o.forwardRef((function(e,t){var n=e.fieldProps,r=e.children;return(0,C.jsx)(J.ZP,(0,Q.Z)((0,Q.Z)({},n),{},{ref:t,children:r}))})),ne=(0,K.G)(te,{valuePropName:"checked",ignoreWidth:!0});ne.Group=ee,ne.Button=J.ZP.Button,ne.displayName="ProFormComponent";var re=ne,oe=n(57178),se=n(3849),ie=function(){var e=oe.Z.useForm(),t=d()(e,1)[0],n=(0,b.useIntl)(),r=(0,k.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),s=r.currentWorkgroup,a=r.setCurrentWorkgroup,l=(0,o.useState)(I.vXk),g=d()(l,2),f=g[0],m=g[1];(0,o.useEffect)((function(){s&&(m(s.routingMode),t.setFieldValue("routingMode",s.routingMode))}),[s]);var v=function(){var e=u()(i()().mark((function e(t){var r,o,u,l,d,g,f,m,v,k;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),c.yw.loading(n.formatMessage({id:"workgroup.route.updating"})),v=T()(T()(T()({},s),t),{},{serviceSettings:T()(T()({},s.serviceSettings),{},{welcomeFaqUids:null==s||null===(r=s.serviceSettings)||void 0===r||null===(r=r.welcomeFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null==s||null===(o=s.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})),quickFaqUids:null===(u=s.serviceSettings)||void 0===u||null===(u=u.quickFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),guessFaqUids:null==s||null===(l=s.serviceSettings)||void 0===l||null===(l=l.guessFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),hotFaqUids:null==s||null===(d=s.serviceSettings)||void 0===d||null===(d=d.hotFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})),shortcutFaqUids:null==s||null===(g=s.serviceSettings)||void 0===g||null===(g=g.shortcutFaqs)||void 0===g?void 0:g.map((function(e){return e.uid}))}),robotSettings:T()(T()({},s.robotSettings),{},{robotUid:null==s||null===(f=s.robotSettings)||void 0===f||null===(f=f.robot)||void 0===f?void 0:f.uid}),messageLeaveSettings:T()(T()({},s.messageLeaveSettings),{},{worktimeUids:null==s||null===(m=s.messageLeaveSettings)||void 0===m||null===(m=m.worktimes)||void 0===m?void 0:m.map((function(e){return e.uid}))}),agentUids:s.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",v),e.next=6,(0,p.W5)(v);case 6:k=e.sent,console.log("updateWorkGroup response:",k),200===k.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"workgroup.route.update.success"})),a(k.data)):(c.yw.destroy(),c.yw.error(n.formatMessage({id:"workgroup.route.update.error"})));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsxs)("div",{children:[(0,C.jsxs)(Z.A,{form:t,onFinish:v,children:[(0,C.jsx)(re.Group,{name:"routingMode",label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:I.vXk},{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:I.ZD$},{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:I.owQ},{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:I.e2F},{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:I.zWk},{label:(0,C.jsx)(b.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:I.HQF}],fieldProps:{value:f,onChange:function(e){console.log("radio checked",e.target.value),m(e.target.value)}}}),(0,C.jsxs)(Z.A.Item,{children:[f===I.vXk&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),f===I.ZD$&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),f===I.owQ&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),f===I.e2F&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),f===I.zWk&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),f===I.HQF&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),f===I.JEC&&(0,C.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})})]})]}),(0,C.jsxs)(se.Z,{direction:"horizontal",style:{width:"100%",marginTop:10,marginBottom:10},children:[(0,C.jsx)(F.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:n.formatMessage({id:"workgroup.chat.show"})}),(0,C.jsx)(F.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.hideChat()},children:n.formatMessage({id:"workgroup.chat.hide"})})]})]})},ae=n(98473),ue=n(66916),le=(n(66310),function(){var e=(0,b.useIntl)(),t=(0,o.useMemo)((function(){return[{key:"faq",label:(0,C.jsx)(b.FormattedMessage,{id:"menu.kbase.faq",defaultMessage:"FAQ"}),children:(0,C.jsx)(O.Z,{type:I.aZD})},{key:"quickFaqs",label:(0,C.jsx)(b.FormattedMessage,{id:"menu.kbase.quickbutton",defaultMessage:"QuickButton"}),children:(0,C.jsx)(z.Z,{type:I.aZD})},{key:"rate",label:(0,C.jsx)(b.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,C.jsx)(B.Z,{type:I.aZD})},{key:"right",label:(0,C.jsx)(b.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,C.jsx)(G.Z,{type:I.aZD})},{key:"popup",label:(0,C.jsx)(b.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,C.jsx)(N.Z,{type:I.aZD})},{key:"trigger",label:(0,C.jsx)(b.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"}),children:(0,C.jsx)(ae.Z,{type:I.aZD})},{key:"route",label:(0,C.jsx)(b.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"}),children:(0,C.jsx)(ie,{})},{key:"inputassociation",label:(0,C.jsx)(b.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,C.jsx)(H.Z,{type:I.aZD})}]}),[e]);return(0,C.jsx)(U.Z,{tabPosition:"left",items:t})}),de=n(82211),ce=(n(9389),n(55930),n(73170),n(76711)),ge=n.n(ce),pe=n(85954),fe=n(62577),me=n(42965),ve=n(63653),ke=["fieldProps","proFieldProps"],he=["fieldProps","proFieldProps"],we="time",be=o.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,s=(0,$.Z)(e,ke),i=(0,o.useContext)(ve.Z);return(0,C.jsx)(_.Z,(0,Q.Z)({ref:t,fieldProps:(0,Q.Z)({getPopupContainer:i.getPopupContainer},n),valueType:"timeRange",proFieldProps:r,filedConfig:{valueType:"timeRange",customLightMode:!0,lightFilterLabelFormatter:function(e){return(0,me.c)(e,"HH:mm:ss")}}},s))})),ye=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,$.Z)(e,he),s=(0,o.useContext)(ve.Z);return(0,C.jsx)(_.Z,(0,Q.Z)({fieldProps:(0,Q.Z)({getPopupContainer:s.getPopupContainer},t),valueType:we,proFieldProps:n,filedConfig:{customLightMode:!0,valueType:we}},r))};ye.RangePicker=be;var xe=ye,Fe=n(28977),je=n.n(Fe);function Me(e){return Se.apply(this,arguments)}function Se(){return(Se=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/worktime/create",{method:"POST",data:T()(T()({},t),{},{client:I.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e){return Re.apply(this,arguments)}function Re(){return(Re=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/worktime/update",{method:"POST",data:T()(T()({},t),{},{client:I.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/worktime/delete",{method:"POST",data:T()(T()({},t),{},{client:I.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var We="HH:mm:ss",Pe=function(e){var t=e.type,n=Z.A.useForm(),r=d()(n,1)[0],s=(0,b.useIntl)(),a=(0,o.useRef)(!1),l=(0,o.useRef)(),f=(0,m.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),h=f.currentAgent,w=f.setCurrentAgent,y=(0,k.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),x=y.currentWorkgroup,F=y.setCurrentWorkgroup,j=(0,o.useState)([]),M=d()(j,2),R=M[0],W=M[1],P=(0,v.u)((function(e){return e.currentOrg})),U=(0,S.Z)().translateString,A=(0,o.useState)([]),L=d()(A,2),E=L[0],V=L[1];(0,o.useEffect)((function(){var e,n,o,s,i;if(t===I.Njn)V(null==h||null===(e=h.messageLeaveSettings)||void 0===e?void 0:e.worktimes),r.setFieldValue("defaultRobot",null==h||null===(n=h.robotSettings)||void 0===n?void 0:n.defaultRobot),r.setFieldValue("offlineRobot",null==h||null===(o=h.robotSettings)||void 0===o?void 0:o.offlineRobot),r.setFieldValue("nonWorktimeRobot",null==h||null===(s=h.robotSettings)||void 0===s?void 0:s.nonWorktimeRobot),r.setFieldValue("robotUid",null==h||null===(i=h.robotSettings)||void 0===i||null===(i=i.robot)||void 0===i?void 0:i.uid);else if(t===I.aZD){var a,u,l,d,c;V(null==x||null===(a=x.messageLeaveSettings)||void 0===a?void 0:a.worktimes),r.setFieldValue("defaultRobot",null==x||null===(u=x.robotSettings)||void 0===u?void 0:u.defaultRobot),r.setFieldValue("offlineRobot",null==x||null===(l=x.robotSettings)||void 0===l?void 0:l.offlineRobot),r.setFieldValue("nonWorktimeRobot",null==x||null===(d=x.robotSettings)||void 0===d?void 0:d.nonWorktimeRobot),r.setFieldValue("robotUid",null==x||null===(c=x.robotSettings)||void 0===c||null===(c=c.robot)||void 0===c?void 0:c.uid)}}),[h,x]);var D=function(){var e=u()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.current){e.next=3;break}return console.log("isLoading: 1",a.current),e.abrupt("return");case 3:return a.current=!0,c.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:I.f4h,orgUid:null==P?void 0:P.uid},e.next=8,(0,ue.p0)(t);case 8:n=e.sent,console.log("queryRobotsByOrg: ",n),200===n.code?W(null===(r=n.data)||void 0===r?void 0:r.content):c.yw.error(n.message),a.current=!1,c.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){D()}),[]);var O,z,B=function(){var e=u()(i()().mark((function e(n){var r,o,a,u,l,d,f,m,v,k,b,y,j,M,S,Z,R;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish:",n),!(n.defaultRobot||n.offlineRobot||n.nonWorktimeRobot)){e.next=5;break}if(n.robotUid){e.next=5;break}return c.yw.error("请选择客服机器人"),e.abrupt("return");case 5:if(c.yw.loading(s.formatMessage({id:"updating",defaultMessage:"updating"})),t!==I.Njn){e.next=16;break}return f=T()(T()({},h),{},{serviceSettings:T()(T()({},h.serviceSettings),{},{welcomeFaqUids:null==h||null===(r=h.serviceSettings)||void 0===r||null===(r=r.welcomeFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null===(o=h.serviceSettings)||void 0===o||null===(o=o.quickFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),faqUids:null===(a=h.serviceSettings)||void 0===a||null===(a=a.faqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==h||null===(u=h.serviceSettings)||void 0===u||null===(u=u.guessFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),hotFaqUids:null==h||null===(l=h.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==h||null===(d=h.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),messageLeaveSettings:T()(T()({},h.messageLeaveSettings),{},{worktimeUids:E.map((function(e){return null==e?void 0:e.uid}))}),robotSettings:T()(T()({},h.robotSettings),{},{defaultRobot:n.defaultRobot,offlineRobot:n.offlineRobot,nonWorktimeRobot:n.nonWorktimeRobot,robotUid:n.robotUid}),maxThreadCount:(null==n?void 0:n.maxThreadCount)||10,autoReplySettings:T()({},h.autoReplySettings)}),console.log("agentObject:",f),e.next=11,(0,g.sE)(f);case 11:m=e.sent,console.log("updateAgent response:",m),200===m.code?(c.yw.destroy(),c.yw.success(s.formatMessage({id:"update.success"})),w(m.data)):(c.yw.destroy(),c.yw.error(m.message)),e.next=24;break;case 16:if(t!==I.aZD){e.next=24;break}return Z=T()(T()({},x),{},{serviceSettings:T()(T()({},x.serviceSettings),{},{welcomeFaqUids:null==x||null===(v=x.serviceSettings)||void 0===v||null===(v=v.welcomeFaqs)||void 0===v?void 0:v.map((function(e){return e.uid})),quickFaqUids:null===(k=x.serviceSettings)||void 0===k||null===(k=k.quickFaqs)||void 0===k?void 0:k.map((function(e){return e.uid})),faqUids:null===(b=x.serviceSettings)||void 0===b||null===(b=b.faqs)||void 0===b?void 0:b.map((function(e){return e.uid})),guessFaqUids:null==x||null===(y=x.serviceSettings)||void 0===y||null===(y=y.guessFaqs)||void 0===y?void 0:y.map((function(e){return e.uid})),hotFaqUids:null==x||null===(j=x.serviceSettings)||void 0===j||null===(j=j.hotFaqs)||void 0===j?void 0:j.map((function(e){return e.uid})),shortcutFaqUids:null==x||null===(M=x.serviceSettings)||void 0===M||null===(M=M.shortcutFaqs)||void 0===M?void 0:M.map((function(e){return e.uid}))}),messageLeaveSettings:T()(T()({},x.messageLeaveSettings),{},{worktimeUids:E.map((function(e){return null==e?void 0:e.uid}))}),robotSettings:T()(T()({},x.robotSettings),{},{defaultRobot:n.defaultRobot,offlineRobot:n.offlineRobot,nonWorktimeRobot:n.nonWorktimeRobot,robotUid:n.robotUid}),agentUids:null==x||null===(S=x.agents)||void 0===S?void 0:S.map((function(e){return e.uid}))}),console.log("workgroupObject:",Z),e.next=21,(0,p.W5)(Z);case 21:R=e.sent,console.log("updateWorkGroup response:",R),200===R.code?(c.yw.destroy(),c.yw.success(s.formatMessage({id:"update.success"})),F(R.data)):(c.yw.destroy(),c.yw.error(R.message));case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=[];return E.map((function(t){e.push({worktime:[je()(t.startTime,We),je()(t.endTime,We)]})})),e},N=function(){var e=u()(i()().mark((function e(t,n,r){var o,s,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onWorktimeChange:",r,n),s={uid:null===(o=E[r])||void 0===o?void 0:o.uid,startTime:n[0],endTime:n[1]},e.next=4,Ze(s);case 4:a=e.sent,console.log("updateWorktime response:",a),200===a.code||c.yw.error(a.message);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),G=function(){var e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createWorktime"),t={startTime:"00:00:00",endTime:"23:59:59"},e.next=4,Me(t);case 4:n=e.sent,console.log("createWorktime response:",n),200===n.code?V([].concat(ge()(E),[n.data])):c.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=u()(i()().mark((function e(t){var n,r,o,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteWorktime:",t,null===(n=E[t])||void 0===n?void 0:n.uid),o={uid:null===(r=E[t])||void 0===r?void 0:r.uid},e.next=4,qe(o);case 4:s=e.sent,console.log("deleteWorktime response:",s),200===s.code?V(E.filter((function(e,n){return n!==t}))):c.yw.error(s.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){console.log("worktimes:",E),r.setFieldValue("worktimes",H())}),[E]),(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(Z.A,{form:r,style:{marginLeft:"20px"},onFinish:B,children:[(0,C.jsx)(pe.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人"}),(0,C.jsx)(pe.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人"}),(0,C.jsx)(pe.Z,{name:"nonWorktimeRobot",width:"md",label:"非工作时间启用机器人"}),(0,C.jsx)(fe.u,{name:"worktimes",style:{marginBlockEnd:0,width:"300px"},label:"工作时间区间，支持多个",creatorRecord:{worktime:[je()("00:00:00",We),je()("23:59:59",We)]},initialValue:H(),creatorButtonProps:{creatorButtonText:"添加",icon:!1,style:{width:"unset"}},copyIconProps:!1,deleteIconProps:{tooltipText:"删除"},itemRender:function(e){var t=e.listDom,n=e.action;return(0,C.jsxs)("div",{style:{display:"inline-flex",marginInlineEnd:25},children:[t,n]})},min:1,max:4,actionRef:l,actionGuard:{beforeAddRow:(z=u()(i()().mark((function e(t,n,r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeAddRow:",t,n),e.next=3,G();case 3:return e.abrupt("return",new Promise((function(e){e(!0)})));case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return z.apply(this,arguments)}),beforeRemoveRow:(O=u()(i()().mark((function e(t,n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("beforeRemoveRow:",t),e.next=3,Q(t);case 3:return e.abrupt("return",new Promise((function(e){e(0!==t)})));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return O.apply(this,arguments)})},children:function(e,t,n){return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(xe.RangePicker,{width:"md",name:"worktime",fieldProps:{onChange:function(e,n){N(e,n,t)},format:We}},"worktime")})}}),(0,C.jsx)(q.Z,{name:"robotUid",label:"客服机器人",width:"md",options:R.map((function(e){return{value:e.uid,label:U(e.nickname)}})),fieldProps:{allowClear:!0,placeholder:"请选择客服机器人"}})]})})},Ue=n(14238),Ae=function(){var e=(0,b.useIntl)(),t=(0,o.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,C.jsx)(D,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,C.jsx)(Ue.Z,{type:I.aZD})},{key:"robot",label:e.formatMessage({id:"pages.agent.robot",defaultMessage:"Robot"}),children:(0,C.jsx)(Pe,{type:I.aZD})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,C.jsx)(le,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,C.jsx)(de.Z,{type:I.aZD})}]}),[e]);return(0,C.jsx)(U.Z,{defaultActiveKey:"basic",items:t})},Te=n(96865),Le=r.Z.Sider,Ee=r.Z.Content,Ve=function(){var e=(0,Te.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,C.jsxs)(r.Z,{children:[(0,C.jsx)(Le,{width:n,style:t,children:(0,C.jsx)(P,{})}),(0,C.jsx)(r.Z,{children:(0,C.jsx)(Ee,{children:(0,C.jsx)(Ae,{})})})]})}}}]);