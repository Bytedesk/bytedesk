"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7555],{82863:function(e,n,r){r.d(n,{Jr:function(){return m},LF:function(){return d},Oh:function(){return h},WS:function(){return v}});var t=r(90819),o=r.n(t),i=r(73193),a=r.n(i),l=r(89933),s=r.n(l),u=r(55735),c=r(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36605:function(e,n,r){r.d(n,{HH:function(){return h},T:function(){return m},fx:function(){return v},mK:function(){return d}});var t=r(90819),o=r.n(t),i=r(73193),a=r.n(i),l=r(89933),s=r.n(l),u=r(55735),c=r(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/query/org",{method:"GET",params:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/create",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/update",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=s()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/delete",{method:"POST",data:a()(a()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92053:function(e,n,r){r.d(n,{V:function(){return u},c:function(){return d}});var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),l=r(55735),s=r(30921);function u(){return c.apply(this,arguments)}function c(){return(c=a()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:l.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=a()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:l.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},59875:function(e,n,r){var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),l=r(45332),s=r.n(l),u=r(44194),c=r(36605),d=r(86803),f=r(23864),m=r(76750),p=r(30921),v=r(53530),g=r(27487),h=r(75365),y=r(9452),x=r(84288),P=r(40612),w=r(55735),k=r(15722),L=r(11490),b=r(31842),j=r(19317),S=r(31549);n.Z=function(e){var n,r,t=e.level,i=(0,f.Z)().isDarkMode,l=(0,p.useIntl)(),Z=(0,m.Z)(),C=Z.translateString,M=Z.translateStringTranct,R=(0,P.u)((function(e){return e.currentOrg})),E=(0,u.useState)(!1),O=s()(E,2),q=O[0],T=O[1],U=(0,u.useState)(!1),K=s()(U,2),I=K[0],F=(K[1],(0,L.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}}))),V=F.llmproviderResult,A=F.currentLlmProvider,D=F.setLlmProviderResult,H=F.insertLlmProvider,z=F.setCurrentLlmProvider,W=F.upgradeLlmProvider,N=F.deleteCurrentLlmProvider,Y=(0,j.$)((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),J=Y.llmproviderResultPlatform,_=Y.currentLlmProviderPlatform,B=Y.setLlmProviderResultPlatform,G=Y.insertLlmProviderPlatform,Q=Y.setCurrentLlmProviderPlatform,$=Y.upgradeLlmProviderPlatform,X=Y.deleteCurrentLlmProviderPlatform,ee=(0,u.useState)(t===w.Hxq),ne=s()(ee,1)[0],re=ne?_:A,te=v.Z.useModal(),oe=s()(te,2),ie=oe[0],ae=oe[1],le=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),d.yw.loading(l.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,c.HH)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(d.yw.destroy(),d.yw.success(l.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ne?X(n.uid):N(n.uid)):(d.yw.destroy(),d.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=a()(o()().mark((function e(){var n,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),n={pageNumber:0,pageSize:50,status:t===w.Hxq?"":w.KY,orgUid:null==R?void 0:R.uid,level:t},e.next=4,(0,c.mK)(n);case 4:r=e.sent,console.log("queryLlmProvidersByOrg: ",r),200===r.code?ne?B(r):D(r):d.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){se()}),[]);var ue=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",n),d.yw.loading(l.formatMessage({id:"creating"})),e.next=4,(0,c.T)(n);case 4:r=e.sent,console.log("createLlmProvider:",r),200===r.code?(d.yw.destroy(),d.yw.success(l.formatMessage({id:"create.success",defaultMessage:"create success"})),ne?G(r.data):H(r.data),T(!1)):(d.yw.destroy(),d.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ce=function(){var e=a()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(l.formatMessage({id:"updating"})),e.next=3,(0,c.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(d.yw.destroy(),d.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),ne?$(r.data):W(r.data),T(!1)):(d.yw.destroy(),d.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{margin:10},children:(0,S.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[!1,(0,S.jsx)(h.ZP,{onClick:function(){return function(e){ie.confirm({title:l.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(k.Z,{}),content:"".concat(l.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(C(e.nickname),"】？"),onOk:function(){le(e)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})})}(re)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==re?void 0:re.uid),children:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,S.jsx)(y.Z,{itemLayout:"horizontal",dataSource:ne?(null==J||null===(n=J.data)||void 0===n?void 0:n.content)||[]:(null==V||null===(r=V.data)||void 0===r?void 0:r.content)||[],renderItem:function(e,n){return(0,S.jsx)(y.Z.Item,{style:(null==re?void 0:re.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return n=e,void(ne?Q(n):z(n));var n},children:(0,S.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,S.jsx)(x.C,{src:e.logo}),title:(0,S.jsx)(S.Fragment,{children:M(null==e?void 0:e.nickname)}),description:(null==e?void 0:e.status)===w.KY?"上线发布":"未上线"})})}}),q&&(0,S.jsx)(b.Z,{open:q,isEdit:I,level:t,llmProvider:re,onCancel:function(){T(!1)},onSubmit:function(e){I?ce(e):ue(e)}}),ae]})}},55270:function(e,n,r){r.d(n,{Z:function(){return re}});var t=r(76711),o=r.n(t),i=r(45332),a=r.n(i),l=r(44194),s=r(8247),u=r(73193),c=r.n(u),d=r(86222),f=r.n(d),m=r(90819),p=r.n(m),v=r(89933),g=r.n(v),h=r(86803),y=r(82863),x=r(40612),P=r(55735),w=r(53530),k=r(84288),L=r(75365),b=r(39042),j=r(38775),S=r(3849),Z=r(9452),C=r(69169),M=r(4499),R=r(73442),E=r(31549),O=function(e){var n=e.isEdit,r=e.llmmodel,t=e.provider,o=e.open,i=e.level,s=e.onClose,u=e.onSubmit,c=C.A.useForm(),d=a()(c,1)[0],f=(0,x.u)((function(e){return e.currentOrg}));(0,l.useEffect)((function(){n&&r&&d?d.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname}):(console.log("form resetFields"),d.resetFields())}),[r]);return(0,l.useEffect)((function(){}),[r]),(0,E.jsx)("div",{children:(0,E.jsx)(R.Z,{title:n?"编辑模型":"新建模型",width:600,onClose:s,open:o,extra:(0,E.jsxs)(S.Z,{children:[(0,E.jsx)(L.ZP,{onClick:s,children:"取消"}),(0,E.jsx)(L.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("Form values:",e);var o={uid:n?null==r?void 0:r.uid:"",name:e.name,nickname:e.nickname,providerUid:null==t?void 0:t.uid,level:i,orgUid:null==f?void 0:f.uid};console.log("llmmodelObject:",o),u(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,E.jsxs)(C.A,{form:d,name:"model",submitter:!1,children:[(0,E.jsx)(M.Z,{label:"名称(用于接口调用)",name:"name"}),(0,E.jsx)(M.Z,{label:"昵称(便于记忆)",name:"nickname"})]})})})},q=r(15722),T=r(11090),U=r(10162),K=r(30617),I=r(80556),F=r(30921),V=r(36605),A=r(23864),D=r(76750),H=r(11490),z=r(31842),W=r(32327),N=r(29266),Y=r(80601),J=r(7875),_=W.Z.Text,B=function(e){var n=e.provider,r=e.open,t=(e.level,e.onClose),o=e.onSubmit,i=e.existingModels,s=void 0===i?[]:i,u=((0,F.useIntl)(),(0,l.useState)(!1)),c=a()(u,2),d=c[0],f=c[1],m=(0,l.useState)([]),v=a()(m,2),x=v[0],w=v[1],k=(0,l.useState)([]),b=a()(k,2),j=b[0],Z=b[1],C=function(e){return s.some((function(n){return n.name===e.name}))},M=function(){var e=g()(p()().mark((function e(){var r,t,o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,r={pageNumber:0,pageSize:100,level:P.Hxq,providerName:n.name},e.next=5,(0,y.LF)(r);case 5:t=e.sent,console.log("获取平台模型列表:",t),200===t.code?(o=t.data.content||[],w(o),i=o.filter((function(e){return C(e)})).map((function(e){return e.uid})),Z(i)):h.yw.error(t.message||"获取模型列表失败"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),h.yw.error("获取模型列表异常");case 14:return e.prev=14,f(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){r&&M()}),[r]);var O=[{title:"名称",dataIndex:"name",key:"name",render:function(e,n){return(0,E.jsxs)(S.Z,{children:[e,C(n)&&(0,E.jsx)(N.Z,{color:"green",children:"已存在"})]})}},{title:"别名",dataIndex:"nickname",key:"nickname"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0}],q={selectedRowKeys:j,onChange:function(e){Z(e)}};return(0,E.jsxs)(R.Z,{title:"导入".concat(n.nickname,"模型"),width:700,open:r,onClose:t,destroyOnClose:!0,footer:(0,E.jsxs)(S.Z,{children:[(0,E.jsx)(L.ZP,{onClick:t,children:"取消"}),(0,E.jsxs)(L.ZP,{type:"primary",onClick:function(){if(0!==j.length){var e=x.filter((function(e){return j.includes(e.uid)}));o(e)}else h.yw.warning("请至少选择一个模型")},disabled:0===j.length,children:["导入已选(",j.length,")"]})]}),children:[(0,E.jsxs)(_,{type:"secondary",children:["从平台已有的",n.nickname,"模型中选择并导入到当前组织",s.length>0&&(0,E.jsx)(_,{type:"secondary",style:{marginLeft:8},children:"（已有标签的模型表示已导入到当前组织）"})]}),(0,E.jsx)("div",{style:{marginTop:16},children:(0,E.jsx)(Y.Z,{spinning:d,children:(0,E.jsx)(J.Z,{rowKey:"uid",columns:O,dataSource:x,pagination:{pageSize:10},rowSelection:q,size:"small"})})}),0===x.length&&!d&&(0,E.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,E.jsx)(_,{type:"secondary",children:"没有找到可导入的平台模型"})})]})},G=function(e){var n=e.provider,r=e.level,t=(0,F.useIntl)(),o=(0,A.Z)().isDarkMode,i=(0,l.useState)(!0),s=a()(i,2),u=s[0],d=s[1],m=(0,D.Z)(),v=m.translateString,C=(m.translateStringTranct,(0,l.useState)()),M=a()(C,2),R=M[0],W=M[1],N=(0,l.useState)(!1),Y=a()(N,2),J=Y[0],_=Y[1],G=(0,l.useState)(!1),Q=a()(G,2),$=Q[0],X=Q[1],ee=(0,x.u)((function(e){return e.currentOrg})),ne=(0,l.useState)([]),re=a()(ne,2),te=re[0],oe=re[1],ie=(0,H.A)((function(e){return e.upgradeLlmProvider})),ae=w.Z.useModal(),le=a()(ae,2),se=le[0],ue=le[1],ce=(0,l.useState)(!1),de=a()(ce,2),fe=de[0],me=de[1],pe=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),h.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,y.Oh)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(h.yw.destroy(),h.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ve()):(h.yw.destroy(),h.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ve=function(){var e=g()(p()().mark((function e(){var o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestModels"),oe([]),h.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading"})),o={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:null==ee?void 0:ee.uid,level:r},e.next=6,(0,y.LF)(o);case 6:i=e.sent,console.log("queryLlmModelsByOrg: ",i,o),200===i.code?(oe(i.data.content),h.yw.destroy()):(h.yw.destroy(),h.yw.error(i.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){ve()}),[]);var ge=function(){_(!1)},he=function(){X(!1)},ye=function(){var e=g()(p()().mark((function e(n){var r,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",n),!u){e.next=9;break}return e.next=4,(0,y.WS)(n);case 4:r=e.sent,console.log("updateLlmModel:",r),200===r.code?(h.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),ve(),ge()):h.yw.error(r.message),e.next=14;break;case 9:return e.next=11,(0,y.Jr)(n);case 11:o=e.sent,console.log("createLlmModel:",o),200===o.code?(h.yw.success(t.formatMessage({id:"create.success",defaultMessage:"create success"})),ve(),ge()):h.yw.error(o.message);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=function(){var e=g()(p()().mark((function e(t){var o,i,a,l,s,u,c,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",t),t&&0!==t.length){e.next=5;break}return h.yw.warning("没有选择任何模型"),he(),e.abrupt("return");case 5:if(o=te.map((function(e){return e.name})),i=t.filter((function(e){return!o.includes(e.name)})),0!==i.length){e.next=11;break}return h.yw.info("所选模型均已存在，无需重复导入"),he(),e.abrupt("return");case 11:h.yw.loading("正在导入".concat(i.length,"个模型...")),e.prev=12,a=0,l=f()(i),e.prev=15,l.s();case 17:if((s=l.n()).done){e.next=27;break}return u=s.value,c={name:u.name,nickname:u.nickname,description:u.description,providerUid:n.uid,providerName:n.name,orgUid:null==ee?void 0:ee.uid,level:r},e.next=22,(0,y.Jr)(c);case 22:d=e.sent,console.log("createLlmModel:",d,c),200===d.code&&a++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),l.e(e.t0);case 32:return e.prev=32,l.f(),e.finish(32);case 35:h.yw.destroy(),a>0?(h.yw.success("成功导入".concat(a,"个模型")),ve()):h.yw.warning("没有成功导入任何模型"),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),h.yw.destroy(),h.yw.error("导入模型失败");case 44:he();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(n){return e.apply(this,arguments)}}(),Pe=function(){var e=g()(p()().mark((function e(r){var o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",n),o=c()(c()({},n),{},{status:r?P.KY:P.L2A}),e.next=4,(0,V.fx)(o);case 4:i=e.sent,console.log("updateLlmProvider:",o,i),200===i.code?(h.yw.destroy(),h.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),ie(i.data)):(h.yw.destroy(),h.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),we=function(e,n){var r;console.log("list on delete",e),r=e,se.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,E.jsx)(q.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(v(r.nickname),"】？"),onOk:function(){pe(r)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})},ke=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,V.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(h.yw.destroy(),h.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),ie(r.data),me(!1)):(h.yw.destroy(),h.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("h1",{children:[(0,E.jsx)(k.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,E.jsx)(L.ZP,{type:"text",icon:(0,E.jsx)(T.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),(0,E.jsxs)("p",{children:["apiUrl: ",null==n?void 0:n.apiUrl]}),(0,E.jsxs)("p",{children:["apiKey: ",null!=n&&n.apiKey?"".concat(n.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),r===P.Hxq&&(0,E.jsx)(b.Z,{checkedChildren:"上线发布",unCheckedChildren:"下线调试",defaultChecked:(null==n?void 0:n.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),Pe(e)}}),(0,E.jsx)(j.Z,{orientation:"left",children:"模型列表"}),(0,E.jsxs)(S.Z,{children:[(0,E.jsx)(L.ZP,{icon:(0,E.jsx)(U.Z,{}),type:"primary",onClick:function(){d(!1),_(!0)},children:"添加模型"}),"ollama"!==n.name&&r===P.whQ&&(0,E.jsx)(L.ZP,{icon:(0,E.jsx)(K.Z,{}),onClick:function(){return X(!0)},children:"导入模型"}),(0,E.jsx)(L.ZP,{icon:(0,E.jsx)(I.Z,{}),onClick:ve,children:"刷新模型"})]}),(0,E.jsx)(Z.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:te,renderItem:function(e,n){return(0,E.jsx)(Z.Z.Item,{style:(null==R?void 0:R.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){W(e)},actions:[(0,E.jsx)(L.ZP,{type:"link",onClick:function(){return n=e,console.log("list on edit",n),d(!0),void _(!0);var n},children:t.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,E.jsx)(L.ZP,{type:"link",onClick:function(){return we(e)},children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,E.jsx)(Z.Z.Item.Meta,{style:{marginLeft:"15px"},title:e.nickname,description:e.name})})}}),J&&(0,E.jsx)(O,{isEdit:u,llmmodel:R,provider:n,open:J,level:r,onClose:ge,onSubmit:ye}),$&&(0,E.jsx)(B,{provider:n,open:$,level:r,onClose:he,onSubmit:xe,existingModels:te}),fe&&(0,E.jsx)(z.Z,{open:fe,isEdit:u,level:r,llmProvider:n,onCancel:function(){return me(!1)},onSubmit:ke}),ue]})},Q=r(92053),$=r(32943),X=r(65461),ee=function(e){var n=e.provider,r=e.level,t=(0,F.useIntl)(),o=(0,A.Z)().isDarkMode,i=(0,l.useState)(!1),s=a()(i,2),u=s[0],c=s[1],d=(0,l.useState)(!1),f=a()(d,2),m=f[0],v=f[1],y=(0,l.useState)([]),x=a()(y,2),P=x[0],w=x[1],b=(0,l.useState)(!1),S=a()(b,2),C=S[0],M=S[1],R=(0,H.A)((function(e){return e.upgradeLlmProvider})),O=(0,l.useState)(),q=a()(O,2),U=q[0],K=q[1],D=function(){var e=g()(p()().mark((function e(){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),console.log("pingOllama"),e.next=4,(0,Q.V)();case 4:n=e.sent,console.log("getOllamaServerStatus: ",n),200===n.code?(v(n.data),c(!1)):(v(!1),c(!1));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=g()(p()().mark((function e(){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,(0,Q.c)();case 3:n=e.sent,console.log("getOllamaLocalModels: ",n),200===n.code&&w(n.data);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){D(),W()};(0,l.useEffect)((function(){N()}),[]);var Y=function(){var e=g()(p()().mark((function e(n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,V.fx)(n);case 3:r=e.sent,console.log("updateLlmProvider:",n,r),200===r.code?(h.yw.destroy(),h.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),R(r.data),M(!1)):(h.yw.destroy(),h.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("h1",{children:[(0,E.jsx)(k.C,{src:null==n?void 0:n.logo}),null==n?void 0:n.nickname,(0,E.jsx)(L.ZP,{type:"text",icon:(0,E.jsx)(T.Z,{}),onClick:function(){window.open(null==n?void 0:n.webUrl,"_blank")}})]}),(0,E.jsx)(L.ZP,{icon:(0,E.jsx)(I.Z,{}),loading:u,type:"primary",onClick:N,children:"刷新"}),(0,E.jsx)("br",{}),(0,E.jsx)("br",{}),m?(0,E.jsx)($.Z,{message:"Ollama运行中",type:"success"}):(0,E.jsx)($.Z,{message:"请首先启动Ollama",type:"error"}),(0,E.jsx)(j.Z,{orientation:"left",children:"本地模型列表"}),(0,E.jsx)(Z.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:P,renderItem:function(e,n){return(0,E.jsx)(Z.Z.Item,{style:(null==U?void 0:U.name)===e.name?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){K(e)},actions:[],children:(0,E.jsx)(Z.Z.Item.Meta,{title:null==e?void 0:e.name,description:(0,X.mr)(null==e?void 0:e.modified_at.toString()),style:{marginLeft:"15px"}})})}}),C&&(0,E.jsx)(z.Z,{open:C,isEdit:!0,level:r,llmProvider:n,onCancel:function(){return M(!1)},onSubmit:Y})]})},ne=r(19317),re=function(e){var n=e.level,r=(0,l.useState)("default"),t=a()(r,2),i=t[0],u=t[1],c=(0,l.useState)([]),d=a()(c,2),f=d[0],m=d[1],p=(0,H.A)((function(e){return e.currentLlmProvider})),v=(0,ne.$)((function(e){return e.currentLlmProviderPlatform})),g=(0,l.useState)(n===P.Hxq),h=a()(g,1)[0]?v:p;(0,l.useEffect)((function(){if(console.log("llmProvider: ",h),f.find((function(e){return e.key===(null==h?void 0:h.name)})))u(null==h?void 0:h.name);else{var e=o()(f);"ollama"===(null==h?void 0:h.name)?e.push({label:null==h?void 0:h.nickname,children:(0,E.jsx)(ee,{provider:h,level:n}),key:null==h?void 0:h.name,closable:!0}):e.push({label:null==h?void 0:h.nickname,children:(0,E.jsx)(G,{provider:h,level:n}),key:null==h?void 0:h.name,closable:!0}),m(e),u(null==h?void 0:h.name)}}),[h]);return(0,E.jsx)(s.Z,{type:"editable-card",onChange:function(e){u(e)},activeKey:i,onEdit:function(e,n){!function(e){var n=i,r=-1;f.forEach((function(n,t){n.key===e&&(r=t-1)}));var t=f.filter((function(n){return n.key!==e}));t.length&&n===e&&(n=r>=0?t[r].key:t[0].key),m(t),u(n)}(e)},items:f})}},31842:function(e,n,r){var t=r(90819),o=r.n(t),i=r(89933),a=r.n(i),l=r(45332),s=r.n(l),u=r(86803),c=r(36605),d=r(40612),f=r(55735),m=r(69169),p=r(84881),v=r(4499),g=r(57178),h=r(53530),y=r(44194),x=r(31549);n.Z=function(e){var n=e.open,r=e.isEdit,t=e.llmProvider,i=e.level,l=e.onCancel,P=e.onSubmit,w=g.Z.useForm(),k=s()(w,1)[0],L=(0,d.u)((function(e){return e.currentOrg})),b=(0,y.useState)([]),j=s()(b,2),S=j[0],Z=j[1],C=(0,y.useState)([]),M=s()(C,2),R=M[0],E=M[1],O=(0,y.useState)(),q=s()(O,2),T=q[0],U=q[1],K=function(){var e=a()(o()().mark((function e(){var n,r,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLlmProviders"),n={pageNumber:0,pageSize:50,status:"",level:f.Hxq},e.next=4,(0,c.mK)(n);case 4:r=e.sent,console.log("queryLlmProvidersByOrg: ",r),200===r.code?Z(null==r||null===(t=r.data)||void 0===t?void 0:t.content):u.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){var e=[];S.forEach((function(n){e.push({label:n.nickname,value:n.name,disabled:n.status!==f.KY})})),E(e)}),[S]),(0,y.useEffect)((function(){i===f.whQ&&K()}),[]),(0,y.useEffect)((function(){r?(U(t),k.setFieldsValue({name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,apiUrl:null==t?void 0:t.apiUrl,apiKey:null==t?void 0:t.apiKey})):k.resetFields()}),[r,t]);return(0,x.jsx)("div",{children:(0,x.jsx)(h.Z,{title:"添加大模型提供商",open:n,forceRender:!0,onOk:function(){k.validateFields().then(function(){var e=a()(o()().mark((function e(n){var i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={uid:r?null==t?void 0:t.uid:"",name:null==T?void 0:T.name,nickname:null==n?void 0:n.nickname,logo:null==T?void 0:T.logo,description:null==T?void 0:T.description,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey,webUrl:null==T?void 0:T.webUrl,status:f.KY,level:f.whQ,orgUid:null==L?void 0:L.uid},console.log("handleSaveLlmProvider:",n,i),P(i);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),u.yw.error("创建角色失败")}))},onCancel:l,children:(0,x.jsxs)(m.A,{form:k,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[i===f.whQ&&(0,x.jsx)(p.Z,{label:"选择大模型提供商",name:"name",options:R,fieldProps:{placeholder:"选择大模型提供商(必选)",allowClear:!0,onChange:function(e){console.log("onParentSelectChange:",e);var n=S.find((function(n){return n.name===e}));U(n),console.log("selectedProvider:",n),k.setFieldsValue({nickname:null==n?void 0:n.nickname,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey})},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,x.jsx)(v.Z,{label:"名称",name:"nickname",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,x.jsx)(v.Z,{label:"ApiUrl",name:"apiUrl",rules:[{required:!0,message:"请输入apiUrl!"}],fieldProps:{onPressEnter:function(e){}}}),"ollama"!==(null==T?void 0:T.name)&&(0,x.jsx)(v.Z.Password,{label:"ApiKey",name:"apiKey",fieldProps:{placeholder:"请输入apiKey",allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){}}})]})})})}},96865:function(e,n,r){var t=r(23864);n.Z=function(){var e=(0,t.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,n,r){var t=r(55735),o=r(65461),i=r(30921);n.Z=function(){var e=(0,i.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(t.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(t.VoP)||null!=n&&n.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,o.aS)(n,10)}}}},11490:function(e,n,r){r.d(n,{A:function(){return d}});var t=r(73193),o=r.n(t),i=r(76711),a=r.n(i),l=r(55735),s=r(44435),u=r(83642),c=r(83890),d=(0,s.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentLlmProvider:{uid:"",nickname:""},insertLlmProvider:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},upgradeLlmProvider:function(n){e((function(e){var r=e.llmproviderResult.data.content,t=r.findIndex((function(e){return e.uid===n.uid}));-1!==t?r[t]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResult:function(r){e({llmproviderResult:r});var t,o=n().currentLlmProvider;""!==o.uid&&void 0!==o||(null===(t=r.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProvider:r.data.content[0]})},setCurrentLlmProvider:function(r){var t=n().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===r.uid}));if(-1!==i){var l=[].concat(a()(t.slice(0,i)),[r],a()(t.slice(i+1))),s=o()(o()({},n().llmproviderResult),{},{data:{content:l}});e({llmproviderResult:s,currentLlmProvider:r})}else e({currentLlmProvider:r})},deleteCurrentLlmProvider:function(r){var t=n().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===r}));-1!==i?e({llmproviderResult:o()(o()({},n().llmproviderResult),{},{data:{content:[].concat(a()(t.slice(0,i)),a()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",r),n().currentLlmProvider.uid===r&&e({currentLlmProvider:{uid:""}})},deleteLlmProviderCache:function(){return e({},!0)}}})),{name:l.ajB})))},19317:function(e,n,r){r.d(n,{$:function(){return d}});var t=r(73193),o=r.n(t),i=r(76711),a=r.n(i),l=r(55735),s=r(44435),u=r(83642),c=r(83890),d=(0,s.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,n){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(n){e((function(e){e.llmproviderResultPlatform.data.content.unshift(n)}))},upgradeLlmProviderPlatform:function(n){e((function(e){var r=e.llmproviderResultPlatform.data.content,t=r.findIndex((function(e){return e.uid===n.uid}));-1!==t?r[t]=n:console.warn("LlmProvider with uid ".concat(n.uid," not found."))}))},setLlmProviderResultPlatform:function(r){e({llmproviderResultPlatform:r});var t,o=n().currentLlmProviderPlatform;""!==o.uid&&void 0!==o||(null===(t=r.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProviderPlatform:r.data.content[0]})},setCurrentLlmProviderPlatform:function(r){var t=n().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===r.uid}));if(-1!==i){var l=[].concat(a()(t.slice(0,i)),[r],a()(t.slice(i+1))),s=o()(o()({},n().llmproviderResultPlatform),{},{data:{content:l}});e({llmproviderResultPlatform:s,currentLlmProviderPlatform:r})}else e({currentLlmProviderPlatform:r})},deleteCurrentLlmProviderPlatform:function(r){var t=n().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===r}));-1!==i?e({llmproviderResultPlatform:o()(o()({},n().llmproviderResultPlatform),{},{data:{content:[].concat(a()(t.slice(0,i)),a()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",r),n().currentLlmProviderPlatform.uid===r&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:l.dNm})))}}]);