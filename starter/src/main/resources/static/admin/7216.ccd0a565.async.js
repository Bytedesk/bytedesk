"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7216],{11090:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(83910),n=a(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var d=n.forwardRef(i)},2484:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(83910),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=a(54183),i=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var d=n.forwardRef(i)},32503:function(e,t,a){a.d(t,{XS:function(){return u},k4:function(){return f},uu:function(){return M},yr:function(){return m}});var r=a(90819),n=a.n(r),s=a(73193),o=a.n(s),i=a(89933),d=a.n(i),l=a(94976),c=a(4628);function u(e){return g.apply(this,arguments)}function g(){return(g=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},40392:function(e,t,a){var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(43388),h=a(32428),M=a(74171),x=a(94976),v=a(58620),y=a(54881),w=a(11090),b=a(2484),k=a(44565),j=a(4628),S=a(27729),I=a(43275),T=a(28508),F=a(69533),A=a(44194),Z=a(16658),C=a(85977),E=a(31549),D=["current","pageSize"];t.Z=function(e){var t,a,r,s,i,l,u=e.type,f=e.superUser,R=(0,j.useIntl)(),N=(0,A.useRef)(),U=(0,A.useState)(1),O=p()(U,2),z=O[0],P=O[1],B=(0,A.useState)(10),L=p()(B,2),Y=L[0],q=L[1],H=(0,M.u)((function(e){return e.currentOrg})),_=S.Z.useModal(),G=p()(_,2),V=(G[0],G[1]),K=(0,A.useState)([]),J=p()(K,2),Q=J[0],X=J[1],W=(0,A.useState)([]),$=p()(W,2),ee=$[0],te=$[1],ae=(0,A.useState)(0),re=p()(ae,2),ne=re[0],se=re[1],oe=(0,A.useState)({}),ie=p()(oe,2),de=ie[0],le=ie[1],ce=(0,j.useAccess)(),ue=(0,A.useMemo)((function(){var e;return null==ce||null===(e=ce.getModulePermission)||void 0===e?void 0:e.call(ce,C.MY.THREAD)}),[ce]),ge=null!==(t=null==ue||null===(a=ue.canRead)||void 0===a?void 0:a.call(ue))&&void 0!==t&&t,fe=null!==(r=null==ue||null===(s=ue.canExport)||void 0===s?void 0:s.call(ue))&&void 0!==r&&r,pe=null!==(i=null==ue||null===(l=ue.canDelete)||void 0===l?void 0:l.call(ue))&&void 0!==i&&i,me=function(e,t){m.yw.warning(R.formatMessage({id:e,defaultMessage:t}))},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,ellipsis:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,E.jsx)(j.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case x.ach:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.new"});case x.j0C:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.roboting"});case x.Q7C:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.offline"});case x.v1N:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.queuing"});case x.hl2:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.chatting"});case x.V1n:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,E.jsx)(j.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,E.jsx)(j.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,Z.YG)(t.channel)}},{title:(0,E.jsx)(j.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,E.jsx)(j.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,E.jsx)(j.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.type.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.topic.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.owner.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,E.jsx)(j.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.tagList.tooltip"}),render:function(e,t){var a;return null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,E.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],Me=[].concat(he,[{title:R.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,a,r){return[(0,E.jsx)("a",{onClick:function(){xe(t)},children:R.formatMessage({id:"view",defaultMessage:"View"})},"editable"),pe?(0,E.jsx)(I.Z,{title:R.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:R.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此群组记录吗？此操作不可恢复!"}),onConfirm:function(){return ve(t)},okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:R.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete"):null]}}]),xe=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:x.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ve=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe){e.next=3;break}return me("thread.permission.delete.denied","无权限：删除会话"),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(R.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==N||null===(a=N.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(R.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=g()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe){e.next=3;break}return me("thread.permission.delete.denied","无权限：批量删除会话"),e.abrupt("return");case 3:if(0!==ee.length){e.next=6;break}return m.yw.warning(R.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(ee);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}m.yw.destroy(),0===a?m.yw.success(R.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(R.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),X([]),te([]),null===(t=N.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=g()(c()().mark((function e(t,a,r){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe){e.next=3;break}return me("thread.permission.export.denied","无权限：导出会话"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(x.LA8),s=o()({componentType:u,orgUid:(null==H?void 0:H.uid)||"",accessToken:n||"",exportType:t,type:x.H_O},de),"current"===t?(s.pageNumber=String(z-1),s.pageSize=String(Y)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,v.kG)()+"/api/v1/thread/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),be=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return we("range",r,a)}})},s=0;s<r;s++)n();return t},ke={selectedRowKeys:Q,onChange:function(e,t){X(e),te(t)}};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(k.Z,{columns:Me,actionRef:N,cardBordered:!0,rowSelection:ke,scroll:{x:"max-content"},request:function(){var e=g()(c()().mark((function e(t,a,r){var s,i,d,l,u,g,p,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge){e.next=4;break}return me("thread.permission.read.denied","无权限：查看会话"),se(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return s=t.current,i=t.pageSize,d=n()(t,D),P(s),q(i),le(d),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],l=g,u="ascend"===a[g]?"ascend":"descend"),p=o()(o()({pageNumber:s-1,pageSize:i,componentType:"",type:x.H_O,orgUid:null==H?void 0:H.uid,mergeByTopic:!1,superUser:f},d),{},{sortBy:l,sortDirection:u}),e.next=14,(0,h.fk)(p);case 14:return M=e.sent,console.log("getAllThreads response:",M,p),200===M.code?se(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:R.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];pe&&Q.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(y.Z,{}),danger:!0,label:R.formatMessage({id:"batch.delete"})+" (".concat(Q.length,")"),onClick:function(){S.Z.confirm({title:R.formatMessage({id:"batch.deleteTip"}),content:"".concat(R.formatMessage({id:"batch.deleteAffirm"})," ").concat(Q.length," ").concat(R.formatMessage({id:"items"}),"?"),onOk:ye,okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return we("current")}}];return ne>0&&(ne<=1e3?a.push({key:"export-all",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ne,"条)"),onClick:function(){return we("all")}}):a.push({key:"export-range",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ne,"条)"),children:be(ne)})),fe&&e.push((0,E.jsx)(T.Z,{menu:{items:a},placement:"bottom",children:(0,E.jsxs)(F.ZP,{icon:(0,E.jsx)(w.Z,{}),type:"primary",children:[R.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,E.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(F.ZP,{type:Q.length>0?"primary":"default",danger:Q.length>0,children:[Q.length>0?R.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Q.length,")"):R.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(b.Z,{})]})},"batchOperations")),e}()}}),V]})}},16199:function(e,t,a){var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(43388),h=a(32428),M=a(74171),x=a(94976),v=a(58620),y=a(54881),w=a(11090),b=a(2484),k=a(44565),j=a(4628),S=a(27729),I=a(43275),T=a(28508),F=a(69533),A=a(44194),Z=a(16658),C=a(85977),E=a(31549),D=["current","pageSize"];t.Z=function(e){var t,a,r,s,i,l,u=e.type,f=e.superUser,R=(0,j.useIntl)(),N=(0,A.useRef)(),U=(0,A.useState)(1),O=p()(U,2),z=O[0],P=O[1],B=(0,A.useState)(10),L=p()(B,2),Y=L[0],q=L[1],H=(0,M.u)((function(e){return e.currentOrg})),_=S.Z.useModal(),G=p()(_,2),V=(G[0],G[1]),K=(0,A.useState)([]),J=p()(K,2),Q=J[0],X=J[1],W=(0,A.useState)([]),$=p()(W,2),ee=$[0],te=$[1],ae=(0,A.useState)(0),re=p()(ae,2),ne=re[0],se=re[1],oe=(0,A.useState)({}),ie=p()(oe,2),de=ie[0],le=ie[1],ce=(0,j.useAccess)(),ue=(0,A.useMemo)((function(){var e;return null==ce||null===(e=ce.getModulePermission)||void 0===e?void 0:e.call(ce,C.MY.THREAD)}),[ce]),ge=null!==(t=null==ue||null===(a=ue.canRead)||void 0===a?void 0:a.call(ue))&&void 0!==t&&t,fe=null!==(r=null==ue||null===(s=ue.canExport)||void 0===s?void 0:s.call(ue))&&void 0!==r&&r,pe=null!==(i=null==ue||null===(l=ue.canDelete)||void 0===l?void 0:l.call(ue))&&void 0!==i&&i,me=function(e,t){m.yw.warning(R.formatMessage({id:e,defaultMessage:t}))},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,E.jsx)(j.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,E.jsx)(j.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case x.ach:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.new"});case x.j0C:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.roboting"});case x.Q7C:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.offline"});case x.v1N:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.queuing"});case x.hl2:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.chatting"});case x.V1n:return(0,E.jsx)(j.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,E.jsx)(j.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,E.jsx)(j.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,Z.YG)(t.channel)}},{title:(0,E.jsx)(j.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,E.jsx)(j.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,E.jsx)(j.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,E.jsx)(j.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,E.jsx)(j.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,E.jsx)(j.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,E.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],Me=[].concat(he,[{title:R.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,E.jsx)(j.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,a,r){return[(0,E.jsx)("a",{onClick:function(){xe(t)},children:R.formatMessage({id:"view",defaultMessage:"View"})},"editable"),pe?(0,E.jsx)(I.Z,{title:R.formatMessage({id:"deleteTip"}),description:"".concat(R.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ve(t)},okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:R.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete"):null]}}]),xe=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:x.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ve=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe){e.next=3;break}return me("thread.permission.delete.denied","无权限：删除会话"),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(R.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==N||null===(a=N.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(R.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=g()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe){e.next=3;break}return me("thread.permission.delete.denied","无权限：批量删除会话"),e.abrupt("return");case 3:if(0!==ee.length){e.next=6;break}return m.yw.warning(R.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(R.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(ee);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}m.yw.destroy(),0===a?m.yw.success(R.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(R.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),X([]),te([]),null===(t=N.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=g()(c()().mark((function e(t,a,r){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe){e.next=3;break}return me("thread.permission.export.denied","无权限：导出会话"),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(x.LA8),s=o()({componentType:u,orgUid:(null==H?void 0:H.uid)||"",accessToken:n||"",exportType:t,type:x.n4F},de),"current"===t?(s.pageNumber=String(z-1),s.pageSize=String(Y)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,v.kG)()+"/api/v1/thread/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),be=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return we("range",r,a)}})},s=0;s<r;s++)n();return t},ke={selectedRowKeys:Q,onChange:function(e,t){X(e),te(t)}};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(k.Z,{columns:Me,actionRef:N,cardBordered:!0,rowSelection:ke,scroll:{x:"max-content"},request:function(){var e=g()(c()().mark((function e(t,a,r){var s,i,d,l,u,g,p,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge){e.next=4;break}return me("thread.permission.read.denied","无权限：查看会话"),se(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return s=t.current,i=t.pageSize,d=n()(t,D),P(s),q(i),le(d),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],l=g,u="ascend"===a[g]?"ascend":"descend"),p=o()(o()({pageNumber:s-1,pageSize:i,componentType:"",type:x.n4F,orgUid:null==H?void 0:H.uid,mergeByTopic:!1,superUser:f},d),{},{sortBy:l,sortDirection:u}),e.next=14,(0,h.fk)(p);case 14:return M=e.sent,console.log("getAllThreads response:",M,p),200===M.code?se(null==M?void 0:M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:null==M?void 0:M.data.content,success:!0,total:null==M?void 0:M.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:R.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];pe&&Q.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(y.Z,{}),danger:!0,label:R.formatMessage({id:"batch.delete"})+" (".concat(Q.length,")"),onClick:function(){S.Z.confirm({title:R.formatMessage({id:"batch.deleteTip"}),content:"".concat(R.formatMessage({id:"batch.deleteAffirm"})," ").concat(Q.length," ").concat(R.formatMessage({id:"items"}),"?"),onOk:ye,okText:R.formatMessage({id:"ok"}),cancelText:R.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return we("current")}}];return ne>0&&(ne<=1e3?a.push({key:"export-all",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ne,"条)"),onClick:function(){return we("all")}}):a.push({key:"export-range",icon:(0,E.jsx)(w.Z,{}),label:R.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ne,"条)"),children:be(ne)})),fe&&e.push((0,E.jsx)(T.Z,{menu:{items:a},placement:"bottom",children:(0,E.jsxs)(F.ZP,{icon:(0,E.jsx)(w.Z,{}),type:"primary",children:[R.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,E.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(F.ZP,{type:Q.length>0?"primary":"default",danger:Q.length>0,children:[Q.length>0?R.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Q.length,")"):R.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(b.Z,{})]})},"batchOperations")),e}()}}),V]})}},40128:function(e,t,a){a.d(t,{Z:function(){return P}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),f=a(76711),p=a.n(f),m=a(45332),h=a.n(m),M=a(43388),x=a(4628);function v(e){return y.apply(this,arguments)}function y(){return(y=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/invite/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=a(88722),b=a(74171),k=a(94976),j=a(58620),S=a(54881),I=a(11090),T=a(2484),F=a(44565),A=a(27729),Z=a(90581),C=a(43275),E=a(28508),D=a(69533),R=a(44194),N=a(85977),U=a(31549),O=["current","pageSize"],z={INVITE_PENDING:{text:"invite.status.pending",defaultMessage:"邀请待处理",color:"blue"},INVITE_ACCEPTED:{text:"invite.status.accepted",defaultMessage:"接受邀请",color:"green"},INVITE_REJECTED:{text:"invite.status.rejected",defaultMessage:"拒绝邀请",color:"red"},INVITE_TIMEOUT:{text:"invite.status.timeout",defaultMessage:"邀请超时",color:"orange"},INVITE_CANCELED:{text:"invite.status.canceled",defaultMessage:"取消邀请",color:"gray"}},P=function(e){var t,a,r,s,i,l,u=e.superUser,f=(0,x.useIntl)(),m=(0,x.useAccess)(),y=(0,R.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,N.MY.THREAD_INVITE)}),[m]),P=null!==(t=null==y||null===(a=y.canRead)||void 0===a?void 0:a.call(y))&&void 0!==t&&t,B=null!==(r=null==y||null===(s=y.canExport)||void 0===s?void 0:s.call(y))&&void 0!==r&&r,L=null!==(i=null==y||null===(l=y.canDelete)||void 0===l?void 0:l.call(y))&&void 0!==i&&i,Y=(0,R.useRef)(),q=(0,R.useState)(1),H=h()(q,2),_=H[0],G=H[1],V=(0,R.useState)(10),K=h()(V,2),J=K[0],Q=K[1],X=(0,b.u)((function(e){return e.currentOrg})),W=(0,w.Z)().translateString,$=A.Z.useModal(),ee=h()($,2),te=(ee[0],ee[1]),ae=(0,R.useState)([]),re=h()(ae,2),ne=re[0],se=re[1],oe=(0,R.useState)([]),ie=h()(oe,2),de=ie[0],le=ie[1],ce=(0,R.useState)(0),ue=h()(ce,2),ge=ue[0],fe=ue[1],pe=(0,R.useState)({}),me=h()(pe,2),he=me[0],Me=me[1],xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,U.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,U.jsx)(x.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"sender",copyable:!0,ellipsis:!0,tooltip:(0,U.jsx)(x.FormattedMessage,{id:"invite.sender.tooltip"}),render:function(e,t,a,r){var n;return W(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,U.jsx)(x.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,U.jsx)(x.FormattedMessage,{id:"invite.receiver.tooltip"}),render:function(e,t,a,r){var n;return W(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,U.jsx)(x.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,U.jsx)(x.FormattedMessage,{id:"invite.note.tooltip"})},{title:(0,U.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,U.jsx)(x.FormattedMessage,{id:"invite.status.tooltip"}),render:function(e,t){var a=t.status,r=z[a]||{text:"invite.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,U.jsx)(Z.Z,{color:r.color,children:(0,U.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,U.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,U.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],ve=[].concat(xe,[{title:f.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,U.jsx)("a",{onClick:function(){ye(t)},children:f.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(L?[(0,U.jsx)(C.Z,{title:f.formatMessage({id:"deleteTip"}),description:"".concat(f.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return we(t)},okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"}),children:(0,U.jsx)("a",{style:{color:"red",marginLeft:8},children:f.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),ye=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==X?void 0:X.uid,t:k.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},we=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(f.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==Y||null===(a=Y.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(f.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=g()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==de.length){e.next=6;break}return M.yw.warning(f.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(de);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(f.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(f.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),se([]),le([]),null===(t=Y.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=g()(c()().mark((function e(t,a,r){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(k.LA8),s=o()({orgUid:(null==X?void 0:X.uid)||"",accessToken:n||"",exportType:t},he),"current"===t?(s.pageNumber=String(_-1),s.pageSize=String(J)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,j.kG)()+"/api/v1/thread/invite/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),je=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ke("range",r,a)}})},s=0;s<r;s++)n();return t},Se={selectedRowKeys:ne,onChange:function(e,t){se(e),le(t)}};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(F.Z,{columns:ve,actionRef:Y,cardBordered:!0,rowSelection:L?Se:void 0,scroll:{x:"max-content"},request:function(){var e=g()(c()().mark((function e(t,a,r){var s,i,d,l,g,p,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=t.current,i=t.pageSize,d=n()(t,O),G(s),Q(i),Me(d),l=void 0,g=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,g="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:s-1,pageSize:i,orgUid:null==X?void 0:X.uid,superUser:u},d),{},{sortBy:l,sortDirection:g}),e.next=13,v(m);case 13:return h=e.sent,console.log("getAllThreadInvites response:",h,m),200===h.code?fe(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:f.formatMessage({id:"thread.tab.invite",defaultMessage:"ThreadInvite"}),toolBarRender:function(){return function(){var e=[],t=[];if(L&&ne.length>0&&t.push({key:"batchDelete",icon:(0,U.jsx)(S.Z,{}),danger:!0,label:f.formatMessage({id:"batch.delete"})+" (".concat(ne.length,")"),onClick:function(){A.Z.confirm({title:f.formatMessage({id:"batch.deleteTip"}),content:"".concat(f.formatMessage({id:"batch.deleteAffirm"})," ").concat(ne.length," ").concat(f.formatMessage({id:"items"}),"?"),onOk:be,okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"})})}}),B){var a=[{key:"export-current",icon:(0,U.jsx)(I.Z,{}),label:f.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ke("current")}}];ge>0&&(ge<=1e3?a.push({key:"export-all",icon:(0,U.jsx)(I.Z,{}),label:f.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ge,"条)"),onClick:function(){return ke("all")}}):a.push({key:"export-range",icon:(0,U.jsx)(I.Z,{}),label:f.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ge,"条)"),children:je(ge)})),e.push((0,U.jsx)(E.Z,{menu:{items:a},placement:"bottom",children:(0,U.jsxs)(D.ZP,{icon:(0,U.jsx)(I.Z,{}),type:"primary",children:[f.formatMessage({id:"export",defaultMessage:"Export"}),(0,U.jsx)(T.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,U.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,U.jsxs)(D.ZP,{type:ne.length>0?"primary":"default",danger:ne.length>0,children:[ne.length>0?f.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ne.length,")"):f.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,U.jsx)(T.Z,{})]})},"batchOperations")),e}()}}),te]})}},96063:function(e,t,a){a.d(t,{Z:function(){return O}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),f=a(76711),p=a.n(f),m=a(45332),h=a.n(m),M=a(43388),x=a(94976),v=a(4628);function y(e){return w.apply(this,arguments)}function w(){return(w=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/thread/rating/query/org",{method:"GET",params:o()(o()({},t),{},{channel:x.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=a(74171),k=a(58620),j=a(54881),S=a(11090),I=a(2484),T=a(44565),F=a(43275),A=a(27729),Z=a(28508),C=a(69533),E=a(44194),D=a(85977),R=a(31549),N=["current","pageSize"],U=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,ellipsis:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.nickname}},{title:(0,R.jsx)(v.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",hideInSearch:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.agent.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.agentProtobuf)||void 0===n?void 0:n.nickname}},{title:(0,R.jsx)(v.FormattedMessage,{id:"score",defaultMessage:"Score"}),dataIndex:"score",tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.score.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"comment",copyable:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.comment.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,R.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],O=function(e){var t,a,r,s,i,l,u=e.superUser,f=(0,v.useIntl)(),m=(0,v.useAccess)(),w=(0,E.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,D.MY.THREAD_RATING)}),[m]),O=null!==(t=null==w||null===(a=w.canRead)||void 0===a?void 0:a.call(w))&&void 0!==t&&t,z=null!==(r=null==w||null===(s=w.canExport)||void 0===s?void 0:s.call(w))&&void 0!==r&&r,P=null!==(i=null==w||null===(l=w.canDelete)||void 0===l?void 0:l.call(w))&&void 0!==i&&i,B=(0,E.useRef)(),L=(0,E.useState)(1),Y=h()(L,2),q=Y[0],H=Y[1],_=(0,E.useState)(10),G=h()(_,2),V=G[0],K=G[1],J=(0,b.u)((function(e){return e.currentOrg})),Q=(0,E.useState)([]),X=h()(Q,2),W=X[0],$=X[1],ee=(0,E.useState)([]),te=h()(ee,2),ae=te[0],re=te[1],ne=(0,E.useState)(0),se=h()(ne,2),oe=se[0],ie=se[1],de=(0,E.useState)({}),le=h()(de,2),ce=le[0],ue=le[1],ge=[].concat(U,[{title:f.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,R.jsx)("a",{onClick:function(){fe(t)},children:f.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(P?[(0,R.jsx)(F.Z,{title:f.formatMessage({id:"deleteTip"}),description:"".concat(f.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return pe(t)},okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"}),children:(0,R.jsx)("a",{style:{color:"red",marginLeft:8},children:f.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),fe=function(e){var t,a,r;console.log("handleShowChatHistory",e);var n={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:x.CCt,sid:null==e||null===(a=e.thread)||void 0===a?void 0:a.uid}};null===(r=window.bytedesk)||void 0===r||r.showChat(n)},pe=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(f.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==B||null===(a=B.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(f.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=g()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==ae.length){e.next=6;break}return M.yw.warning(f.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(ae);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(f.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(f.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),$([]),re([]),null===(t=B.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=g()(c()().mark((function e(t,a,r){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(x.LA8),s=o()({orgUid:(null==J?void 0:J.uid)||"",accessToken:n||"",exportType:t},ce),"current"===t?(s.pageNumber=String(q-1),s.pageSize=String(V)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/rating/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Me=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return he("range",r,a)}})},s=0;s<r;s++)n();return t},xe={selectedRowKeys:W,onChange:function(e,t){$(e),re(t)}};return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(T.Z,{columns:ge,actionRef:B,cardBordered:!0,rowSelection:P?xe:void 0,scroll:{x:"max-content"},request:function(){var e=g()(c()().mark((function e(t,a,r){var s,i,d,l,g,p,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=t.current,i=t.pageSize,d=n()(t,N),H(s),K(i),ue(d),l=void 0,g=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,g="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:s-1,pageSize:i,orgUid:null==J?void 0:J.uid,superUser:u},d),{},{sortBy:l,sortDirection:g}),e.next=13,y(m);case 13:return h=e.sent,console.log("queryRatesByOrgUid response:",null==h?void 0:h.data,m),200===h.code?ie(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"满意度评价",toolBarRender:function(){return function(){var e=[],t=[];if(P&&W.length>0&&t.push({key:"batchDelete",icon:(0,R.jsx)(j.Z,{}),danger:!0,label:f.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){A.Z.confirm({title:f.formatMessage({id:"batch.deleteTip"}),content:"".concat(f.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(f.formatMessage({id:"items"}),"?"),onOk:me,okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"})})}}),z){var a=[{key:"export-current",icon:(0,R.jsx)(S.Z,{}),label:f.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return he("current")}}];oe>0&&(oe<=1e3?a.push({key:"export-all",icon:(0,R.jsx)(S.Z,{}),label:f.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(oe,"条)"),onClick:function(){return he("all")}}):a.push({key:"export-range",icon:(0,R.jsx)(S.Z,{}),label:f.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(oe,"条)"),children:Me(oe)})),e.push((0,R.jsx)(Z.Z,{menu:{items:a},placement:"bottom",children:(0,R.jsxs)(C.ZP,{icon:(0,R.jsx)(S.Z,{}),type:"primary",children:[f.formatMessage({id:"export",defaultMessage:"Export"}),(0,R.jsx)(I.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,R.jsx)(Z.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(C.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?f.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):f.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,R.jsx)(I.Z,{})]})},"batchOperations")),e}()}})})}},78847:function(e,t,a){a.d(t,{Z:function(){return L}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(76711),c=a.n(l),u=a(90819),g=a.n(u),f=a(89933),p=a.n(f),m=a(45332),h=a.n(m),M=a(43388),x=a(88722),v=a(74171),y=a(94976),w=a(58620),b=a(54881),k=a(11090),j=a(2484),S=a(44565),I=a(4628),T=a(27729),F=a(90581),A=a(30310),Z=a(43275),C=a(28508),E=a(69533),D=a(44194);function R(e){return N.apply(this,arguments)}function N(){return(N=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,I.request)("/api/v1/thread/summary/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=a(32503),O=a(67242),z=a(85977),P=a(31549),B=["current","pageSize"],L=function(e){var t,a,r,s,i,l,u=e.superUser,f=(0,I.useIntl)(),m=(0,I.useAccess)(),N=(0,D.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,z.MY.THREAD_SUMMARY)}),[m]),L=null!==(t=null==N||null===(a=N.canRead)||void 0===a?void 0:a.call(N))&&void 0!==t&&t,Y=null!==(r=null==N||null===(s=N.canExport)||void 0===s?void 0:s.call(N))&&void 0!==r&&r,q=null!==(i=null==N||null===(l=N.canDelete)||void 0===l?void 0:l.call(N))&&void 0!==i&&i,H=(0,D.useRef)(),_=(0,D.useState)(1),G=h()(_,2),V=G[0],K=G[1],J=(0,D.useState)(10),Q=h()(J,2),X=Q[0],W=Q[1],$=(0,v.u)((function(e){return e.currentOrg})),ee=(0,x.Z)().translateString,te=T.Z.useModal(),ae=h()(te,2),re=(ae[0],ae[1]),ne=(0,D.useState)([]),se=h()(ne,2),oe=(se[0],se[1]),ie=(0,D.useState)({}),de=h()(ie,2),le=de[0],ce=de[1],ue=(0,D.useState)([]),ge=h()(ue,2),fe=ge[0],pe=ge[1],me=(0,D.useState)([]),he=h()(me,2),Me=he[0],xe=he[1],ve=(0,D.useState)(0),ye=h()(ve,2),we=ye[0],be=ye[1],ke=(0,D.useState)({}),je=h()(ke,2),Se=je[0],Ie=je[1],Te=function(){var e=p()(g()().mark((function e(){var t,a,r,n,s;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:100,type:y.ics,orgUid:null==$?void 0:$.uid},e.next=4,(0,U.XS)(a);case 4:r=e.sent,O.Z.debug("queryCategoriesByOrg response:",null==r?void 0:r.data,a),200===(null==r?void 0:r.code)&&null!=r&&null!==(t=r.data)&&void 0!==t&&t.content&&(n=null==r?void 0:r.data.content,oe(n),s={},n.forEach((function(e){s[e.uid]=e.name})),ce(s)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),O.Z.error("Fetch categories error:",e.t0),M.yw.error(f.formatMessage({id:"ticket.category.load.error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,D.useEffect)((function(){null!=$&&$.uid&&Te()}),[null==$?void 0:$.uid]);var Fe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,P.jsx)(I.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,P.jsx)(I.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.title.tooltip"})},{title:(0,P.jsx)(I.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.content.tooltip"})},{title:(0,P.jsx)(I.FormattedMessage,{id:"solution",defaultMessage:"Solution"}),dataIndex:"solution",copyable:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.solution.tooltip"})},{title:(0,P.jsx)(I.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.category.tooltip"}),render:function(e,t){var a=le[t.categoryUid]||t.categoryUid;return ee(a)}},{title:(0,P.jsx)(I.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.status.tooltip"}),render:function(e,t){var a="",r="";switch(t.status){case y.kA8:a="orange",r=f.formatMessage({id:"summary.status.pending",defaultMessage:"待处理"});break;case y.zvK:a="blue",r=f.formatMessage({id:"summary.status.processing",defaultMessage:"处理中"});break;case y.fuK:a="green",r=f.formatMessage({id:"summary.status.resolved",defaultMessage:"已解决"});break;case y.cin:a="gray",r=f.formatMessage({id:"summary.status.closed",defaultMessage:"已关闭"});break;default:a="default",r=e}return(0,P.jsx)(F.Z,{color:a,children:r})}},{title:(0,P.jsx)(I.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),hideInSearch:!0,tooltip:(0,P.jsx)(I.FormattedMessage,{id:"summary.tags.tooltip"}),render:function(e,t){var a;return null!=t&&t.tagList&&Array.isArray(null==t?void 0:t.tagList)&&0!==(null==t?void 0:t.tagList.length)?(0,P.jsx)(A.Z,{size:[0,4],wrap:!0,children:null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e){return(0,P.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,P.jsx)(I.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,P.jsx)(I.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],Ae=[].concat(Fe,[{title:f.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,P.jsx)("a",{onClick:function(){Ze(t)},children:f.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(c()(q?[(0,P.jsx)(Z.Z,{title:f.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:f.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此总结记录吗？此操作不可恢复!"}),onConfirm:function(){return Ce(t)},okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"}),children:(0,P.jsx)("a",{style:{color:"red",marginLeft:8},children:f.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),Ze=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==$?void 0:$.uid,t:y.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Ce=function(){var e=p()(g()().mark((function e(t){var a;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(f.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==H||null===(a=H.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(f.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){var e=p()(g()().mark((function e(){var t,a,r,n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==Me.length){e.next=6;break}return M.yw.warning(f.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(Me);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(f.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(f.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),pe([]),xe([]),null===(t=H.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=p()(g()().mark((function e(t,a,r){var n,s;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(y.LA8),s=o()({orgUid:(null==$?void 0:$.uid)||"",accessToken:n||"",exportType:t},Se),"current"===t?(s.pageNumber=String(V-1),s.pageSize=String(X)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/thread/summary/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Re=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return De("range",r,a)}})},s=0;s<r;s++)n();return t},Ne={selectedRowKeys:fe,onChange:function(e,t){pe(e),xe(t)}};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(S.Z,{columns:Ae,actionRef:H,cardBordered:!0,rowSelection:q?Ne:void 0,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,i,d,l,c,p,m,h;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=t.current,i=t.pageSize,d=n()(t,B),K(s),W(i),Ie(d),l=void 0,c=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,c="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:s-1,pageSize:i,orgUid:null==$?void 0:$.uid,superUser:u},d),{},{sortBy:l,sortDirection:c}),e.next=13,R(m);case 13:return h=e.sent,console.log("queryThreadSummariesByOrg response:",h,m),200===h.code?be(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:f.formatMessage({id:"thread.tab.summary",defaultMessage:"ThreadSummary"}),toolBarRender:function(){return function(){var e=[],t=[];if(q&&fe.length>0&&t.push({key:"batchDelete",icon:(0,P.jsx)(b.Z,{}),danger:!0,label:f.formatMessage({id:"batch.delete"})+" (".concat(fe.length,")"),onClick:function(){T.Z.confirm({title:f.formatMessage({id:"batch.deleteTip"}),content:"".concat(f.formatMessage({id:"batch.deleteAffirm"})," ").concat(fe.length," ").concat(f.formatMessage({id:"items"}),"?"),onOk:Ee,okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"})})}}),Y){var a=[{key:"export-current",icon:(0,P.jsx)(k.Z,{}),label:f.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return De("current")}}];we>0&&(we<=1e3?a.push({key:"export-all",icon:(0,P.jsx)(k.Z,{}),label:f.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(we,"条)"),onClick:function(){return De("all")}}):a.push({key:"export-range",icon:(0,P.jsx)(k.Z,{}),label:f.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(we,"条)"),children:Re(we)})),e.push((0,P.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,P.jsxs)(E.ZP,{icon:(0,P.jsx)(k.Z,{}),type:"primary",children:[f.formatMessage({id:"export",defaultMessage:"Export"}),(0,P.jsx)(j.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,P.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,P.jsxs)(E.ZP,{type:fe.length>0?"primary":"default",danger:fe.length>0,children:[fe.length>0?f.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(fe.length,")"):f.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,P.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),re]})}},1396:function(e,t,a){a.d(t,{Z:function(){return Y}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),f=a(76711),p=a.n(f),m=a(45332),h=a.n(m),M=a(43388),x=a(4628);function v(e){return y.apply(this,arguments)}function y(){return(y=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/transfer/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=a(88722),b=a(74171),k=a(94976),j=a(58620),S=a(54881),I=a(11090),T=a(2484),F=a(44565),A=a(27729),Z=a(90581),C=a(43275),E=a(28508),D=a(69533),R=a(44194),N=a(96596),U=a.n(N),O=a(85977),z=a(31549),P=["current","pageSize"],B={TRANSFER_PENDING:{text:"transfer.status.pending",defaultMessage:"转接待处理",color:"blue"},TRANSFER_ACCEPTED:{text:"transfer.status.accepted",defaultMessage:"接受转接",color:"green"},TRANSFER_REJECTED:{text:"transfer.status.rejected",defaultMessage:"拒绝转接",color:"red"},TRANSFER_TIMEOUT:{text:"transfer.status.timeout",defaultMessage:"转接超时",color:"orange"},TRANSFER_CANCELED:{text:"transfer.status.canceled",defaultMessage:"取消转接",color:"gray"}},L={AGENT_TO_AGENT:{text:"transfer.type.agent_to_agent",defaultMessage:"人工转人工",color:"purple"},ROBOT_TO_AGENT:{text:"transfer.type.robot_to_agent",defaultMessage:"机器人转人工",color:"cyan"}},Y=function(e){var t,a,r,s,i,l,u=e.superUser,f=(0,x.useIntl)(),m=(0,x.useAccess)(),y=(0,R.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,O.MY.THREAD_TRANSFER)}),[m]),N=null!==(t=null==y||null===(a=y.canRead)||void 0===a?void 0:a.call(y))&&void 0!==t&&t,Y=null!==(r=null==y||null===(s=y.canExport)||void 0===s?void 0:s.call(y))&&void 0!==r&&r,q=null!==(i=null==y||null===(l=y.canDelete)||void 0===l?void 0:l.call(y))&&void 0!==i&&i,H=(0,R.useRef)(),_=(0,R.useState)(1),G=h()(_,2),V=G[0],K=G[1],J=(0,R.useState)(10),Q=h()(J,2),X=Q[0],W=Q[1],$=(0,b.u)((function(e){return e.currentOrg})),ee=(0,w.Z)().translateString,te=A.Z.useModal(),ae=h()(te,2),re=(ae[0],ae[1]),ne=(0,R.useState)([]),se=h()(ne,2),oe=se[0],ie=se[1],de=(0,R.useState)([]),le=h()(de,2),ce=le[0],ue=le[1],ge=(0,R.useState)(0),fe=h()(ge,2),pe=fe[0],me=fe[1],he=(0,R.useState)({}),Me=h()(he,2),xe=Me[0],ve=Me[1],ye=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,z.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left"},{title:(0,z.jsx)(x.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"senderNickname",copyable:!0,ellipsis:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.sender.tooltip"}),render:function(e,t,a,r){var n;return ee(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,z.jsx)(x.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.receiver.tooltip"}),render:function(e,t,a,r){var n;return ee(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,z.jsx)(x.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.note.tooltip"})},{title:(0,z.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.status.tooltip"}),render:function(e,t){var a=t.status,r=B[a]||{text:"transfer.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,z.jsx)(Z.Z,{color:r.color,children:(0,z.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,z.jsx)(x.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,copyable:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.type.tooltip"}),render:function(e,t){var a=t.type,r=L[a]||{text:"transfer.type.unknown",defaultMessage:"未知类型",color:"default"};return(0,z.jsx)(Z.Z,{color:r.color,children:(0,z.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,z.jsx)(x.FormattedMessage,{id:"transfer.transferAt",defaultMessage:"转接时间"}),dataIndex:"transferAt",hideInSearch:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.transferAt.tooltip"}),render:function(e,t){return t.transferAt?U()(t.transferAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,z.jsx)(x.FormattedMessage,{id:"transfer.acceptAt",defaultMessage:"接受时间"}),dataIndex:"acceptAt",hideInSearch:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.acceptAt.tooltip"}),render:function(e,t){return t.acceptAt?U()(t.acceptAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,z.jsx)(x.FormattedMessage,{id:"transfer.cancelAt",defaultMessage:"取消时间"}),dataIndex:"cancelAt",hideInSearch:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.cancelAt.tooltip"}),render:function(e,t){return t.cancelAt?U()(t.cancelAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,z.jsx)(x.FormattedMessage,{id:"transfer.rejectAt",defaultMessage:"拒绝时间"}),dataIndex:"rejectAt",hideInSearch:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.rejectAt.tooltip"}),render:function(e,t){return t.rejectAt?U()(t.rejectAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,z.jsx)(x.FormattedMessage,{id:"transfer.expireAt",defaultMessage:"超时时间"}),dataIndex:"expireAt",hideInSearch:!0,tooltip:(0,z.jsx)(x.FormattedMessage,{id:"transfer.expireAt.tooltip"}),render:function(e,t){return t.expireAt?U()(t.expireAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,z.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,z.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],we=[].concat(ye,[{title:f.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,z.jsx)("a",{onClick:function(){be(t)},children:f.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(q?[(0,z.jsx)(C.Z,{title:f.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:f.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此转接记录吗？此操作不可恢复!"}),onConfirm:function(){return ke(t)},okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"}),children:(0,z.jsx)("a",{style:{color:"red",marginLeft:8},children:f.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),be=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==$?void 0:$.uid,t:k.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},ke=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:console.log("handleDeleteConfirm",t),M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(f.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==H||null===(a=H.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(f.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=g()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==ce.length){e.next=6;break}return M.yw.warning(f.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(f.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(ce);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(f.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(f.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),ie([]),ue([]),null===(t=H.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=g()(c()().mark((function e(t,a,r){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(k.LA8),s=o()({orgUid:(null==$?void 0:$.uid)||"",accessToken:n||"",exportType:t},xe),"current"===t?(s.pageNumber=String(V-1),s.pageSize=String(X)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,j.kG)()+"/api/v1/thread/transfer/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Ie=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return Se("range",r,a)}})},s=0;s<r;s++)n();return t},Te={selectedRowKeys:oe,onChange:function(e,t){ie(e),ue(t)}};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(F.Z,{columns:we,actionRef:H,cardBordered:!0,rowSelection:q?Te:void 0,scroll:{x:"max-content"},request:function(){var e=g()(c()().mark((function e(t,a,r){var s,i,d,l,g,p,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=3;break}return M.yw.warning(f.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return s=t.current,i=t.pageSize,d=n()(t,P),K(s),W(i),ve(d),l=void 0,g=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,g="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:s-1,pageSize:i,orgUid:null==$?void 0:$.uid,superUser:u},d),{},{sortBy:l,sortDirection:g}),e.next=13,v(m);case 13:return h=e.sent,console.log("getAllThreadTransfers response:",h,m),200===h.code?me(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:f.formatMessage({id:"thread.tab.transfer",defaultMessage:"ThreadTransfer"}),toolBarRender:function(){return function(){var e=[],t=[];if(q&&oe.length>0&&t.push({key:"batchDelete",icon:(0,z.jsx)(S.Z,{}),danger:!0,label:f.formatMessage({id:"batch.delete"})+" (".concat(oe.length,")"),onClick:function(){A.Z.confirm({title:f.formatMessage({id:"batch.deleteTip"}),content:"".concat(f.formatMessage({id:"batch.deleteAffirm"})," ").concat(oe.length," ").concat(f.formatMessage({id:"items"}),"?"),onOk:je,okText:f.formatMessage({id:"ok"}),cancelText:f.formatMessage({id:"cancel"})})}}),Y){var a=[{key:"export-current",icon:(0,z.jsx)(I.Z,{}),label:f.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Se("current")}}];pe>0&&(pe<=1e3?a.push({key:"export-all",icon:(0,z.jsx)(I.Z,{}),label:f.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(pe,"条)"),onClick:function(){return Se("all")}}):a.push({key:"export-range",icon:(0,z.jsx)(I.Z,{}),label:f.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(pe,"条)"),children:Ie(pe)})),e.push((0,z.jsx)(E.Z,{menu:{items:a},placement:"bottom",children:(0,z.jsxs)(D.ZP,{icon:(0,z.jsx)(I.Z,{}),type:"primary",children:[f.formatMessage({id:"export",defaultMessage:"Export"}),(0,z.jsx)(T.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,z.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,z.jsxs)(D.ZP,{type:oe.length>0?"primary":"default",danger:oe.length>0,children:[oe.length>0?f.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(oe.length,")"):f.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,z.jsx)(T.Z,{})]})},"batchOperations")),e}()}}),re]})}}}]);