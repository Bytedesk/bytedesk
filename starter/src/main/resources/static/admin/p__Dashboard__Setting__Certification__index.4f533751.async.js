"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9400],{85366:function(e,a,n){n.d(a,{Z:function(){return j}});var t=n(90819),r=n.n(t),s=n(89933),i=n.n(s),o=n(45332),c=n.n(o),l=n(43388),u=n(94976),d=n(4628);function f(){return p.apply(this,arguments)}function p(){return(p=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,a){return m.apply(this,arguments)}function m(){return(m=i()(r()().mark((function e(a,n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:a,captchaCode:n,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=n(58087),x=n(1282),v=n(44194),M=n(31549),j=function(e){var a=e.onKaptchaChange,n=e.onKaptchaCheck,t=(0,d.useIntl)(),s=(0,v.useState)(),o=c()(s,2),u=o[0],p=o[1],m=(0,v.useState)(),j=c()(m,2),y=j[0],b=j[1],Z=(0,v.useState)(!1),k=c()(Z,2),w=k[0],C=k[1],F=function(){var e=i()(r()().mark((function e(){var a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=2;break}return e.abrupt("return");case 2:return C(!0),e.prev=3,e.next=6,f();case 6:200===(a=e.sent).code?(p(null==a?void 0:a.data.captchaUid),b(null==a?void 0:a.data.captchaImage)):l.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),l.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 13:return e.prev=13,C(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=i()(r()().mark((function e(a,t){var s;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(a,t);case 2:s=e.sent,console.log("checkCaptcha response",s),200===(null==s?void 0:s.code)?n&&n(!0):n&&n(!1);case 5:case"end":return e.stop()}}),e)})));return function(a,n){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){F()}),[]);return(0,M.jsx)(M.Fragment,{children:y&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.Z,{onChange:function(e){a&&(a(u,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?U(u,e.target.value):n&&n(!1))},prefix:(0,M.jsx)(h.Z,{}),placeholder:t.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,M.jsx)("img",{src:y,alt:"captcha",onClick:F})]})})}},98342:function(e,a,n){n.r(a),n.d(a,{default:function(){return X}});var t=n(4628),r=n(82878),s=n(68177),i=n(21600),o=n(10022),c=n(13891),l=n(45332),u=n.n(l),d=n(44429),f=n(99036),p=n(44194),g=n(26874),m=n(95018),h=n(30310),x=n(90581),v=n(69533),M=n(31806),j=n(93689),y=n(40439),b=n(79479),Z=n(90819),k=n.n(Z),w=n(89933),C=n.n(w),F=n(43388),U=n(52847),S=n(14312),I=n(85366),z=n(88722),T=n(74171),V=n(94976),A=n(40795),q=n(26978),P=n(86702),R=n(33415),E=n(27729),K=n(31549),L=function(e){var a=e.open,n=e.onSubmit,r=e.onClose,s=(0,t.useIntl)(),i=f.A.useForm(),o=u()(i,1)[0],c=(0,z.Z)().translateString,l=(0,d.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),g=l.userInfo,m=l.deviceUid,h=(0,T.u)((function(e){return e.currentOrg})),x=(0,p.useRef)(),v=(0,p.useState)(""),M=u()(v,2),j=M[0],y=M[1],b=(0,p.useState)(""),Z=u()(b,2),w=Z[0],L=Z[1],N=(0,p.useState)(!1),O=u()(N,2),B=O[0],G=O[1],D=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};(0,p.useEffect)((function(){a?o.setFieldsValue({email:null==g?void 0:g.email}):(o.resetFields(),D())}),[a]);var J=function(){var e=C()(k()().mark((function e(a,n){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",a," captchaValue",n),y(a),L(n);case 3:case"end":return e.stop()}}),e)})));return function(a,n){return e.apply(this,arguments)}}(),X=function(){var e=C()(k()().mark((function e(a){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",a),G(a);case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),$=function(){var e=C()(k()().mark((function e(){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=C()(k()().mark((function e(a){var t,i;return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changeEmail:",a),t={email:a.email,code:a.code,platform:V.iw8},e.next=4,(0,S.Uk)(t);case 4:i=e.sent,console.log("changeEmail response:",i),200===i.code?(F.yw.success(s.formatMessage({id:"certification.verify.success",defaultMessage:"验证成功"})),n(a.email),r()):F.yw.error(c(i.message));case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(E.Z,{title:s.formatMessage({id:"pages.settings.verify.email",defaultMessage:"验证邮箱"}),forceRender:!0,open:a,footer:null,onCancel:function(){r()},children:(0,K.jsxs)(f.A,{form:o,onFinish:function(){var e=C()(k()().mark((function e(a){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeEmail:",a),$();case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),children:[(0,K.jsx)(P.Z,{fieldProps:{size:"large",prefix:(0,K.jsx)(A.Z,{})},name:"email",placeholder:s.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,K.jsx)(t.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"请输入邮箱！"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:s.formatMessage({id:"pages.login.email.invalid",defaultMessage:"邮箱格式不正确"})},{max:50,message:s.formatMessage({id:"pages.login.email.max.length",defaultMessage:"邮箱不得超过{max}字符"},{max:50})}],readonly:!0}),(0,K.jsx)(f.A.Item,{name:"captchaCode",rules:[],children:(0,K.jsx)(I.Z,{onKaptchaChange:J,onKaptchaCheck:X})}),(0,K.jsx)(R.Z,{fieldProps:{size:"large",prefix:(0,K.jsx)(q.Z,{}),allowClear:!0},captchaProps:{size:"large",disabled:!B},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,a){return e?"".concat(a," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"email",name:"code",rules:[{required:!0,message:(0,K.jsx)(t.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=C()(k()().mark((function e(a){var n,t;return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email:",a),!a){e.next=14;break}return n={email:a,type:V.UMe,captchaUid:j,captchaCode:w,deviceUid:m,userUid:null==g?void 0:g.uid,orgUid:null==h?void 0:h.uid,platform:V.iw8},e.next=5,(0,U.O8)(n);case 5:if(t=e.sent,console.log("sendEmailCode",t),200===t.code){e.next=11;break}return F.yw.error(c(t.message)),D(),e.abrupt("return");case 11:F.yw.success(c(t.message)),e.next=15;break;case 14:F.yw.error(s.formatMessage({id:"pages.login.email.required",defaultMessage:"请输入邮箱地址!"}));case 15:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()})]})})})},N=function(e){var a=e.open,n=e.onSubmit,r=e.onClose,s=(0,t.useIntl)(),i=f.A.useForm(),o=u()(i,1)[0],c=(0,z.Z)().translateString,l=(0,d.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),g=l.userInfo,m=l.deviceUid,h=(0,T.u)((function(e){return e.currentOrg})),x=(0,p.useRef)(),v=(0,p.useState)(""),M=u()(v,2),j=M[0],y=M[1],b=(0,p.useState)(""),Z=u()(b,2),w=Z[0],L=Z[1],N=(0,p.useState)(!1),O=u()(N,2),B=O[0],G=O[1],D=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};(0,p.useEffect)((function(){a?o.setFieldsValue({mobile:null==g?void 0:g.mobile}):(o.resetFields(),D())}),[a]);var J=function(){var e=C()(k()().mark((function e(a,n){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",a," captchaValue",n),y(a),L(n);case 3:case"end":return e.stop()}}),e)})));return function(a,n){return e.apply(this,arguments)}}(),X=function(){var e=C()(k()().mark((function e(a){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",a),G(a);case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),$=function(){var e=C()(k()().mark((function e(){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=C()(k()().mark((function e(a){var t,i;return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changeMobile:",a),t={mobile:a.mobile,code:a.code,platform:V.iw8},e.next=4,(0,S.KF)(t);case 4:i=e.sent,console.log("changeMobile response:",i),200===i.code?(F.yw.success(s.formatMessage({id:"certification.verify.success",defaultMessage:"验证成功"})),n(a.mobile),r()):F.yw.error(c(i.message));case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(E.Z,{title:s.formatMessage({id:"pages.settings.verify.mobile",defaultMessage:"验证手机号"}),forceRender:!0,open:a,footer:null,onCancel:function(){r()},children:(0,K.jsxs)(f.A,{form:o,onFinish:function(){var e=C()(k()().mark((function e(a){return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeMobile:",a),$();case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),children:[(0,K.jsx)(P.Z,{fieldProps:{size:"large",prefix:(0,K.jsx)(A.Z,{})},name:"mobile",placeholder:s.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,K.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,K.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}],readonly:!0}),(0,K.jsx)(f.A.Item,{name:"captchaCode",rules:[],children:(0,K.jsx)(I.Z,{onKaptchaChange:J,onKaptchaCheck:X})}),(0,K.jsx)(R.Z,{fieldProps:{size:"large",prefix:(0,K.jsx)(q.Z,{}),allowClear:!0},captchaProps:{size:"large",disabled:!B},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,a){return e?"".concat(a," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,K.jsx)(t.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=C()(k()().mark((function e(a){var n,t;return k()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",a),!a||11!==a.length){e.next=14;break}return n={mobile:a,type:V.aak,captchaUid:j,captchaCode:w,deviceUid:m,userUid:null==g?void 0:g.uid,orgUid:null==h?void 0:h.uid,platform:V.iw8},e.next=5,(0,U.Y7)(n);case 5:if(t=e.sent,console.log("sendMobileCode",t),200===t.code){e.next=11;break}return F.yw.error(c(t.message)),D(),e.abrupt("return");case 11:F.yw.success(c(t.message)),e.next=15;break;case 14:F.yw.error(s.formatMessage({id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"}));case 15:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()})]})})})},O=n(25553),B=r.Z.Text,G=function(){var e=(0,t.useIntl)(),a=(0,O.Z)().isDarkMode,n=(0,t.useNavigate)(),r=f.A.useForm(),i=u()(r,1)[0],o=(0,d.L)((function(e){return{userInfo:e.userInfo,setUserInfo:e.setUserInfo}})),l=o.userInfo,Z=o.setUserInfo,k=(0,p.useState)(!1),w=u()(k,2),C=w[0],F=w[1],U=(0,p.useState)(!1),S=u()(U,2),I=S[0],z=S[1];(0,p.useEffect)((function(){i.setFieldsValue({uid:l.uid,username:l.username,nickname:l.nickname,email:l.email,mobile:l.mobile})}),[]);return(0,K.jsxs)("div",{style:{padding:"16px",backgroundColor:a?"#1f1f1f":void 0},children:[(0,K.jsx)(s.Z,{title:(0,K.jsxs)(B,{strong:!0,style:{fontSize:"16px"},children:[(0,K.jsx)(c.Z,{style:{marginRight:"8px",color:"#52c41a"}}),e.formatMessage({id:"personal.certification.title",defaultMessage:"个人身份验证"})]}),size:"small",style:{marginBottom:"16px",backgroundColor:a?"#262626":void 0},children:(0,K.jsxs)(f.A,{form:i,submitter:!1,layout:"vertical",children:[(0,K.jsx)(s.Z,{type:"inner",size:"small",style:{marginBottom:"16px",backgroundColor:a?"#232323":"#fafafa"},children:(0,K.jsxs)(g.Z,{justify:"space-between",align:"middle",children:[(0,K.jsx)(m.Z,{flex:"auto",children:(0,K.jsxs)(h.Z,{direction:"vertical",size:"small",children:[(0,K.jsxs)(h.Z,{children:[(0,K.jsx)(M.Z,{style:{color:"#722ed1"}}),(0,K.jsx)(B,{strong:!0,children:e.formatMessage({id:"profile.email.address",defaultMessage:"邮箱地址"})}),null!=l&&l.emailVerified?(0,K.jsx)(x.Z,{icon:(0,K.jsx)(j.Z,{}),color:"success",children:e.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,K.jsx)(x.Z,{icon:(0,K.jsx)(y.Z,{}),color:"error",children:e.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,K.jsx)(B,{type:"secondary",style:{marginLeft:"20px"},children:(null==l?void 0:l.email)||e.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})})]})}),(0,K.jsx)(m.Z,{children:(0,K.jsxs)(h.Z,{children:[!(null!=l&&l.emailVerified)&&null!=l.email&&(0,K.jsx)(v.ZP,{type:"primary",onClick:function(){F(!0)},children:e.formatMessage({id:"pages.settings.verify.email",defaultMessage:"验证邮箱"})}),(0,K.jsx)(v.ZP,{type:"link",onClick:function(){n("/setting/profile")},children:e.formatMessage({id:"pages.settings.reset.email",defaultMessage:"修改邮箱"})})]})})]})}),(0,K.jsx)(s.Z,{type:"inner",size:"small",style:{backgroundColor:a?"#232323":"#fafafa"},children:(0,K.jsxs)(g.Z,{justify:"space-between",align:"middle",children:[(0,K.jsx)(m.Z,{flex:"auto",children:(0,K.jsxs)(h.Z,{direction:"vertical",size:"small",children:[(0,K.jsxs)(h.Z,{children:[(0,K.jsx)(b.Z,{style:{color:"#13c2c2"}}),(0,K.jsx)(B,{strong:!0,children:e.formatMessage({id:"profile.mobile.number",defaultMessage:"手机号码"})}),null!=l&&l.mobileVerified?(0,K.jsx)(x.Z,{icon:(0,K.jsx)(j.Z,{}),color:"success",children:e.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,K.jsx)(x.Z,{icon:(0,K.jsx)(y.Z,{}),color:"error",children:e.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,K.jsx)(B,{type:"secondary",style:{marginLeft:"20px"},children:(null==l?void 0:l.mobile)||e.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})})]})}),(0,K.jsx)(m.Z,{children:(0,K.jsxs)(h.Z,{children:[!(null!=l&&l.mobileVerified)&&null!=l.mobile&&(0,K.jsx)(v.ZP,{type:"primary",onClick:function(){z(!0)},children:e.formatMessage({id:"pages.settings.verify.mobile",defaultMessage:"验证手机号"})}),(0,K.jsx)(v.ZP,{type:"link",onClick:function(){n("/setting/profile")},children:e.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"修改手机号"})})]})})]})})]})}),C&&(0,K.jsx)(L,{open:C,onSubmit:function(e){F(!1),l.email=e,l.emailVerified=!0,Z(l),i.setFieldValue("email",e)},onClose:function(){F(!1)}}),I&&(0,K.jsx)(N,{open:I,onSubmit:function(e){z(!1),l.mobile=e,l.mobileVerified=!0,Z(l),i.setFieldValue("mobile",e)},onClose:function(){z(!1)}})]})},D=(r.Z.Text,function(e){console.log(e)}),J=r.Z.Title,X=function(){var e=(0,t.useIntl)(),a=(0,O.Z)().isDarkMode,n=[{key:"personal",label:(0,K.jsxs)("span",{children:[(0,K.jsx)(o.Z,{}),e.formatMessage({id:"certification.tab.personal",defaultMessage:"个人认证"})]}),children:(0,K.jsx)(G,{})}];return(0,K.jsx)("div",{style:{padding:"24px",backgroundColor:a?"#1f1f1f":"#f0f2f5",minHeight:"100vh"},children:(0,K.jsxs)(s.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:a?"0 2px 8px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,K.jsxs)(J,{level:2,style:{marginBottom:"24px",textAlign:"center"},children:[(0,K.jsx)(c.Z,{style:{marginRight:"8px",color:"#1890ff"}}),e.formatMessage({id:"certification.title",defaultMessage:"身份认证"})]}),(0,K.jsx)(i.Z,{defaultActiveKey:"personal",items:n,onChange:D,size:"large"})]})})}}}]);