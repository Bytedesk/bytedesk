"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{2036:function(e,t,n){n.d(t,{H:function(){return s}});n(44194);var r=n(29078),a=n(31549),s=function(e){var t=e.content,n=r.Z.sanitize(t,{ALLOWED_TAGS:["p","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","a","strong","em","b","i","img","blockquote","code","pre"],ALLOWED_ATTR:["href","target","src","alt","style","class"]});return(0,a.jsx)("div",{className:"RichText",dangerouslySetInnerHTML:{__html:n}})}},17220:function(e,t,n){n(44194);var r=n(75365),a=n(54881),s=n(30921),i=n(31549);t.Z=function(e){var t,n,o=e.file,u=e.onDelete,l=e.showDelete,c=void 0===l||l,d=(0,s.useIntl)();return(0,i.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:d.formatMessage({id:null!=o&&null!==(t=o.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[c&&(0,i.jsx)(r.ZP,{type:"text",size:"small",icon:(0,i.jsx)(a.Z,{}),onClick:function(){return u(o.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,i.jsx)("div",{onClick:function(){return window.open(o.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=o&&null!==(n=o.fileType)&&void 0!==n&&n.startsWith("image/")?(0,i.jsx)("img",{src:null==o?void 0:o.fileUrl,alt:null==o?void 0:o.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.fileName})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:o.fileName})]},o.uid)}},27650:function(e,t,n){var r=n(76711),a=n.n(r),s=n(73193),i=n.n(s),o=n(45332),u=n.n(o),l=n(44194),c=n(42085),d=n(30348),f=n(53530),p=n(28977),g=n.n(p),m=n(55735),h=n(86803),x=n(44521),v=n(17220),y=n(30921),w=n(6397),M=n(31549),b=d.Z.Dragger;t.Z=function(e){var t=e.type,n=(e.acceptType,e.isModalOpen),r=e.attachments,s=e.handleSubmit,o=e.handleCancel,d=(0,y.useIntl)(),p=(0,w.j)((function(e){return e.currentKbase})),k=(0,l.useState)([]),S=u()(k,2),j=S[0],C=S[1],Z=(0,l.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==p?void 0:p.uid,client:m.bVn}),T=u()(Z,2),U=T[0],D=T[1];(0,l.useEffect)((function(){console.log("UploadDrag currentKbase",p),p&&D((function(e){return i()(i()({},e),{},{kb_uid:null==p?void 0:p.uid})}))}),[p]);var I=(0,l.useMemo)((function(){return{name:"file",multiple:!0,action:(0,x.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(m.LA8)},data:U,showUploadList:!1,beforeUpload:function(e){var t=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return D((function(n){return i()(i()({},n),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&h.yw.loading(d.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(h.yw.destroy(),h.yw.success(d.formatMessage({id:"upload.success"},{filename:e.file.name})),C((function(t){return[].concat(a()(t),[e.file.response.data])}))):(h.yw.destroy(),h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[U,d]);(0,l.useEffect)((function(){D((function(e){return i()(i()({},e),{},{kb_type:t,category_uid:""})})),r&&C(r.map((function(e){return e.upload})))}),[t]);var q=function(e){console.log("handleDelete",e),C((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,M.jsxs)(f.Z,{title:d.formatMessage({id:"upload.modal.title"}),open:n,onOk:function(){s(j)},onCancel:o,children:[(0,M.jsxs)(b,i()(i()({},I),{},{children:[(0,M.jsx)("p",{className:"ant-upload-drag-icon",children:(0,M.jsx)(c.Z,{})}),(0,M.jsx)("p",{className:"ant-upload-text",children:d.formatMessage({id:"upload.drag.text"})}),(0,M.jsx)("p",{className:"ant-upload-hint",children:d.formatMessage({id:"upload.drag.hint"})})]})),(0,M.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,M.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:j.map((function(e){return(0,M.jsx)(v.Z,{file:e,onDelete:q},e.uid)}))})})]})}},4340:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ye}});var r=n(96865),a=n(75574),s=n(55735),i=n(95160),o=n(44194),u=n(8247),l=n(30921),c=n(73193),d=n.n(c),f=n(84176),p=n.n(f),g=n(86222),m=n.n(g),h=n(90819),x=n.n(h),v=n(89933),y=n.n(v),w=n(45332),M=n.n(w),b=n(86803);function k(e){return S.apply(this,arguments)}function S(){return(S=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/file/query/org",{method:"GET",params:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return C.apply(this,arguments)}function C(){return(C=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/file/delete",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=n(76750),T=n(6397),U=n(40612),D=n(51239),I=n(44521),q=n(73442),E=n(3849),A=n(75365),F=n(80601),P=n(31549),R=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,Z.Z)().translateString,s=(0,T.j)((function(e){return e.currentKbase})),i=(0,D.L)((function(e){return e.userInfo})),u=(0,U.u)((function(e){return e.currentOrg})),l=(0,o.useState)(""),c=M()(l,2),d=c[0],f=c[1],p=(0,o.useState)(!1),g=M()(p,2),m=g[0],h=g[1],x=function(){console.log("refresh"),h(!1);var e=(0,I.Cn)()+"?org="+encodeURIComponent(null==u?void 0:u.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==s?void 0:s.uid)+"&uid="+encodeURIComponent(null==i?void 0:i.uid)+"&nickname="+encodeURIComponent(null==i?void 0:i.nickname)+"&avatar="+encodeURIComponent(null==i?void 0:i.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,o.useEffect)((function(){x()}),[s]);return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(q.Z,{title:a(null==s?void 0:s.name),onClose:function(){r&&r()},open:n,extra:(0,P.jsxs)(E.Z,{children:[(0,P.jsx)(A.ZP,{onClick:function(){window.open(d)},children:"新窗口"}),(0,P.jsx)(A.ZP,{onClick:function(){console.log("restart"),x()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,P.jsx)(F.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,P.jsx)("iframe",{id:"chat-iframe",src:d,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},O=n(90838),z=n(69114),_=n(10162),N=n(54881),Y=n(11090),B=n(81947),V=n(29266),L=n(61355),K=n(28977),H=n.n(K),Q=n(27650),W=n(28425),G=["current","pageSize"],J=function(){var e=(0,l.useIntl)(),t=((0,l.useNavigate)(),(0,o.useRef)()),n=(0,Z.Z)().translateString,r=(0,o.useState)(1),a=M()(r,2),i=a[0],u=a[1],c=(0,o.useState)(10),f=M()(c,2),g=f[0],h=f[1],v=(0,U.u)((function(e){return e.currentOrg})),w=(0,T.j)((function(e){return e.currentKbase})),S=(0,O.v)((function(e){return e.currentCategory})),C=((0,O.v)((function(e){return e.categorySelectOptions})),(0,o.useState)(!1)),D=M()(C,2),q=D[0],E=D[1],F=(0,o.useState)(!1),K=M()(F,2),J=K[0],$=K[1],X=(0,o.useState)([]),ee=M()(X,2),te=ee[0],ne=ee[1],re=(0,o.useState)([]),ae=M()(re,2),se=ae[0],ie=ae[1],oe=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,P.jsx)(l.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",render:function(e,t,n,r){var a,s;return null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")?null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"):null==t?void 0:t.fileName}},{title:(0,P.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,P.jsx)(V.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],ue=function(){var n=y()(x()().mark((function n(r){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,j(r);case 2:200===n.sent.code?(null==t||t.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),le=function(){var n=y()(x()().mark((function n(){var r,a,s,i,o,u;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==se.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,i=m()(se),n.prev=7,i.s();case 9:if((o=i.n()).done){n.next=23;break}return u=o.value,n.prev=11,n.next=14,j(u);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),i.e(n.t1);case 28:return n.prev=28,i.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ne([]),ie([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),ce=[].concat(oe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,P.jsx)("a",{onClick:function(){var e=null==n?void 0:n.fileUrl,t=encodeURIComponent(e);window.open(decodeURIComponent(t))},children:e.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,P.jsx)(L.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return ue(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsx)(A.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[w,S]),(0,o.useEffect)((function(){return z.Z.on(s.YwV,(function(e){var n;null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){z.Z.off(s.YwV)}}),[]);var de=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,W.HK)(s.QPQ,null==v?void 0:v.uid,null==w?void 0:w.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),fe=function(){var e=y()(x()().mark((function e(){var t;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=localStorage.getItem(s.LA8),window.open((0,I.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==S?void 0:S.uid)===s.zBg?"":null==S?void 0:S.uid,kbUid:null==w?void 0:w.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:t||""}).toString());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe={selectedRowKeys:te,onChange:function(e,t){ne(e),ie(t)}};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(B.Z,{columns:ce,actionRef:t,cardBordered:!0,rowSelection:pe,request:function(){var e=y()(x()().mark((function e(t,n,r){var a,i,o,l,c;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,i=t.pageSize,o=p()(t,G),u(a),h(i),l=d()({pageNumber:a-1,pageSize:i,categoryUid:(null==S?void 0:S.uid)===s.zBg?"":null==S?void 0:S.uid,kbUid:null==w?void 0:w.uid,orgUid:null==v?void 0:v.uid},o),e.next=6,k(l);case 6:return 200===(c=e.sent).code||b.yw.error(c.message),e.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){}},dateFormatter:"string",headerTitle:n(null==w?void 0:w.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:function(){return[(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(_.Z,{}),type:"primary",onClick:function(){return E(!0)},children:e.formatMessage({id:"upload",defaultMessage:"File"})},"button"),te.length>0&&(0,P.jsx)(L.Z,{title:e.formatMessage({id:"batch.deleteTip",defaultMessage:"Batch Delete Tip"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm",defaultMessage:"Batch Delete"})," ").concat(te.length," ").concat(e.formatMessage({id:"items",defaultMessage:"items"}),"?"),onConfirm:le,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsxs)(A.ZP,{danger:!0,icon:(0,P.jsx)(N.Z,{}),children:[e.formatMessage({id:"batch.delete",defaultMessage:"Batch Delete"})," (",te.length,")"]})},"batchDelete"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(Y.Z,{}),type:"primary",onClick:fe,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),q&&(0,P.jsx)(Q.Z,{type:s.n1c,acceptType:"*",isModalOpen:q,handleSubmit:function(e){E(!1),null==t||t.current.reload(),de()},handleCancel:function(){E(!1),null==t||t.current.reload()}}),J&&(0,P.jsx)(R,{type:s.xtN,open:J,onClose:function(){return $(!1)}})]})};function $(e){return X.apply(this,arguments)}function X(){return(X=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/text/query/org",{method:"GET",params:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/text/create",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/text/update",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return se.apply(this,arguments)}function se(){return(se=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/text/delete",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=n(15722),oe=n(53530),ue=n(69169),le=n(84881),ce=n(4499),de=n(32350),fe=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,s=e.onSubmit,i=ue.A.useForm(),u=M()(i,1)[0],l=(0,o.useState)(""),c=M()(l,2),f=(c[0],c[1]),p=(0,U.u)((function(e){return e.currentOrg})),g=(0,O.v)((function(e){return e.categorySelectOptions})),m=(0,o.useState)(),h=M()(m,2),x=h[0],v=h[1],y=(0,T.j)((function(e){return e.currentKbase}));(0,o.useEffect)((function(){t?(u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:n.categoryUid}),f((null==n?void 0:n.content)||"")):u.resetFields()}),[t,n,u]);return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(q.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,P.jsxs)(E.Z,{children:[(0,P.jsx)(A.ZP,{onClick:a,children:"取消"}),(0,P.jsx)(A.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=d()(d()({},e),{},{categoryUid:x,kbUid:null==y?void 0:y.uid,orgUid:null==p?void 0:p.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"})]}),children:(0,P.jsxs)(ue.A,{form:u,submitter:{render:function(){return null}},children:[(0,P.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:g,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)}}}),(0,P.jsx)(ce.Z,{label:"标题",name:"name",rules:[{required:!0}]}),(0,P.jsx)(de.Z,{label:"内容",name:"content",rules:[{required:!0}]})]})})})},pe=["current","pageSize"],ge=function(){var e=(0,l.useIntl)(),t=(0,o.useRef)(),n=(0,Z.Z)().translateString,r=(0,o.useState)(1),a=M()(r,2),i=a[0],u=a[1],c=(0,o.useState)(10),f=M()(c,2),g=f[0],h=f[1],v=(0,U.u)((function(e){return e.currentOrg})),w=(0,T.j)((function(e){return e.currentKbase})),k=(0,O.v)((function(e){return e.currentCategory})),S=(0,O.v)((function(e){return e.categorySelectOptions})),j=(0,o.useState)(!1),C=M()(j,2),D=C[0],q=C[1],E=(0,o.useState)({}),F=M()(E,2),R=F[0],z=F[1],K=(0,o.useState)(!1),Q=M()(K,2),W=Q[0],G=Q[1],J=oe.Z.useModal(),X=M()(J,2),te=X[0],re=X[1],se=(0,o.useState)([]),ue=M()(se,2),le=ue[0],ce=ue[1],de=(0,o.useState)([]),ge=M()(de,2),me=ge[0],he=ge[1],xe=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,P.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,render:function(e,t){return(0,P.jsx)(P.Fragment,{children:t.name})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0},{title:(0,P.jsx)(l.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(e,t){var n=S.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,P.jsx)(V.Z,{children:null==n?void 0:n.label})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,P.jsx)(V.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,r){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],ve=[].concat(xe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,render:function(t,n,r,a){return[(0,P.jsx)("a",{onClick:function(){z(n),G(!0),q(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,P.jsx)(A.ZP,{type:"link",onClick:function(){return function(t){te.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(ie.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){ye(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")]}}]);(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[w,k]);var ye=function(){var n=y()(x()().mark((function n(r){var a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,ae(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):b.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),we=function(){var n=y()(x()().mark((function n(){var r,a,s,i,o,u;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==me.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,i=m()(me),n.prev=7,i.s();case 9:if((o=i.n()).done){n.next=23;break}return u=o.value,n.prev=11,n.next=14,ae(u);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),i.e(n.t1);case 28:return n.prev=28,i.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ce([]),he([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Me=function(){var e=y()(x()().mark((function e(n){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),q(!1)):b.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=y()(x()().mark((function e(n){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==R?void 0:R.uid,e.next=3,ne(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),q(!1)):b.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(){q(!0),G(!1),z({})},Se=function(){var e=y()(x()().mark((function e(){var t;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,g),t=localStorage.getItem(s.LA8),window.open((0,I.kG)()+"/api/v1/text/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==w?void 0:w.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je={selectedRowKeys:le,onChange:function(e,t){ce(e),he(t)}};return(0,P.jsxs)(P.Fragment,{children:[D&&(0,P.jsx)(fe,{isEdit:W,open:D,text:R,onClose:function(){q(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),W?be(e):Me(e)}}),(0,P.jsx)(B.Z,{columns:ve,actionRef:t,cardBordered:!0,rowSelection:je,request:function(){var e=y()(x()().mark((function e(t,n,r){var a,i,o,l,c;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,i=t.pageSize,o=p()(t,pe),u(a),h(i),l=d()({pageNumber:a-1,pageSize:i,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==w?void 0:w.uid,orgUid:null==v?void 0:v.uid},o),e.next=6,$(l);case 6:return c=e.sent,console.log("queryTextsByOrg response:",c,l),200===c.code||b.yw.error(c.message),e.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:n(null==w?void 0:w.name)+" - 文本列表",tooltip:"所添加文本内容会自动添加到 ’拆分‘ 列表中 ",toolBarRender:function(){return[(0,P.jsx)(A.ZP,{type:"primary",icon:(0,P.jsx)(_.Z,{}),onClick:ke,children:e.formatMessage({id:"create",defaultMessage:"Create"})}),le.length>0&&(0,P.jsx)(L.Z,{title:e.formatMessage({id:"batch.deleteTip"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(le.length," ").concat(e.formatMessage({id:"items"}),"?"),onConfirm:we,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsxs)(A.ZP,{danger:!0,icon:(0,P.jsx)(N.Z,{}),children:[e.formatMessage({id:"batch.delete"})," (",le.length,")"]})},"batchDelete"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(Y.Z,{}),type:"primary",onClick:Se,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),re]})};function me(e){return he.apply(this,arguments)}function he(){return(he=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/split/query/org",{method:"GET",params:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return ve.apply(this,arguments)}function ve(){return(ve=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/split/update",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){return we.apply(this,arguments)}function we(){return(we=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/split/delete",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=function(e){var t=e.isEdit,n=e.split,r=e.open,a=e.onClose,s=e.onSubmit,i=ue.A.useForm(),u=M()(i,1)[0],c=(0,l.useIntl)(),f=(0,U.u)((function(e){return e.currentOrg})),p=(0,T.j)((function(e){return e.currentKbase})),g=(0,O.v)((function(e){return e.currentCategory}));return(0,o.useEffect)((function(){t&&n?u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content}):u.setFieldsValue({name:"",content:""})}),[t,n,u]),(0,P.jsx)(q.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,P.jsxs)(E.Z,{children:[(0,P.jsx)(A.ZP,{onClick:a,children:"取消"}),(0,P.jsx)(A.ZP,{onClick:function(){u.validateFields().then((function(e){var t=d()(d()({},e),{},{orgUid:null==f?void 0:f.uid,kbUid:null==p?void 0:p.uid,categoryUid:null==g?void 0:g.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"})]}),children:(0,P.jsxs)(ue.A,{form:u,name:"splitForm",submitter:!1,children:[(0,P.jsx)(ce.Z,{label:c.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0}]}),(0,P.jsx)(de.Z,{label:c.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0}],fieldProps:{rows:6}})]})})},be=["current","pageSize"],ke=function(){var e=(0,l.useIntl)(),t=(0,o.useRef)(),n=(0,Z.Z)().translateString,r=(0,o.useState)(1),a=M()(r,2),i=a[0],u=a[1],c=(0,o.useState)(10),f=M()(c,2),g=f[0],h=f[1],v=(0,U.u)((function(e){return e.currentOrg})),w=(0,T.j)((function(e){return e.currentKbase})),k=(0,O.v)((function(e){return e.currentCategory})),S=(0,O.v)((function(e){return e.categorySelectOptions})),j=(0,o.useState)(!1),C=M()(j,2),D=C[0],q=C[1],E=(0,o.useState)(!1),F=M()(E,2),_=F[0],K=F[1],Q=(0,o.useState)(),W=M()(Q,2),G=W[0],J=W[1],$=(0,o.useState)([]),X=M()($,2),ee=X[0],te=X[1],ne=(0,o.useState)([]),re=M()(ne,2),ae=re[0],se=re[1],ie=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0},{title:(0,P.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",width:200,render:function(e,t,n,r){var a,s;return null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")?null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"):null==t?void 0:t.name}},{title:(0,P.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0},{title:(0,P.jsx)(l.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",render:function(e,t){var n=S.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,P.jsx)(V.Z,{children:null==n?void 0:n.label})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return H()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],oe=function(){var n=y()(x()().mark((function n(r){var a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,ye(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ue=function(){var n=y()(x()().mark((function n(){var r,a,s,i,o,u;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ae.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,i=m()(ae),n.prev=7,i.s();case 9:if((o=i.n()).done){n.next=23;break}return u=o.value,n.prev=11,n.next=14,ye(u);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),i.e(n.t1);case 28:return n.prev=28,i.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),te([]),se([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),le=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!G){n.next=7;break}return n.next=4,xe(d()(d()({},r),{},{uid:G.uid}));case 4:a=n.sent,n.next=7;break;case 7:200===a.code?(b.yw.success(e.formatMessage({id:G?"update.success":"add.success",defaultMessage:G?"Update Success":"Add Success"})),K(!1),null==t||null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),b.yw.error(e.formatMessage({id:G?"update.error":"add.error",defaultMessage:G?"Update Error":"Add Error"}));case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}(),ce=[].concat(ie,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,P.jsx)("a",{onClick:function(){return function(e){J(e),K(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,P.jsx)(L.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return oe(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsx)(A.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,o.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[w,k]),(0,o.useEffect)((function(){return z.Z.on(s.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){z.Z.off(s.YwV)}}),[]);var de=function(){var e=y()(x()().mark((function e(){var t;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,g),t=localStorage.getItem(s.LA8),window.open((0,I.kG)()+"/api/v1/split/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==w?void 0:w.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe={selectedRowKeys:ee,onChange:function(e,t){te(e),se(t)}};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(B.Z,{columns:ce,actionRef:t,cardBordered:!0,rowSelection:fe,request:function(){var e=y()(x()().mark((function e(t,n,r){var a,i,o,l,c;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,i=t.pageSize,o=p()(t,be),u(a),h(i),l=d()({pageNumber:a-1,pageSize:i,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==w?void 0:w.uid,orgUid:null==v?void 0:v.uid},o),e.next=7,me(l);case 7:return c=e.sent,console.log("querySplitsByOrg response:",c,l),200===c.code||b.yw.error(c.message),e.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:!1,rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:n(null==w?void 0:w.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:function(){return[ee.length>0&&(0,P.jsx)(L.Z,{title:e.formatMessage({id:"batch.deleteTip"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ee.length," ").concat(e.formatMessage({id:"items"}),"?"),onConfirm:ue,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsxs)(A.ZP,{danger:!0,icon:(0,P.jsx)(N.Z,{}),children:[e.formatMessage({id:"batch.delete"})," (",ee.length,")"]})},"batchDelete"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(Y.Z,{}),type:"primary",onClick:de,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),D&&(0,P.jsx)(R,{type:s.xtN,open:D,onClose:function(){return q(!1)}}),(0,P.jsx)(Me,{isEdit:!!G,split:G,open:_,onClose:function(){return K(!1)},onSubmit:le})]})},Se=n(30617),je=n(61107),Ce=n(2036),Ze=function(e){var t=e.isEdit,n=e.faq,r=e.open,a=e.onClose,i=e.onSubmit,u=ue.A.useForm(),l=M()(u,1)[0],c=(0,U.u)((function(e){return e.currentOrg})),f=(0,T.j)((function(e){return e.currentKbase})),p=(0,O.v)((function(e){return e.categorySelectOptions})),g=(0,o.useState)(),m=M()(g,2),h=(m[0],m[1]),x=(0,o.useState)(s.PYi),v=M()(x,2),y=(v[0],v[1],(0,o.useState)(".png,.jpg,.jpeg")),w=M()(y,2),k=(w[0],w[1],(0,o.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==f?void 0:f.uid)||"",client:s.bVn})),S=M()(k,2),j=(S[0],S[1],(0,o.useState)(!1)),C=M()(j,2),Z=C[0],D=(C[1],(0,o.useState)("")),I=M()(D,2),F=(I[0],I[1],(0,o.useRef)(null));(0,o.useEffect)((function(){t?l.setFieldsValue({type:null==n?void 0:n.type,question:null==n?void 0:n.question,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==f?void 0:f.uid}):l.setFieldsValue({type:s.PYi,question:"",answer:"",categoryUid:"",kbUid:null==f?void 0:f.uid})}),[n,r]),(0,o.useEffect)((function(){var e;Z&&(null===(e=F.current)||void 0===e||e.focus())}),[Z]);return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(q.Z,{title:t?"修改问答对":"新建问答对",width:650,onClose:a,open:r,extra:(0,P.jsxs)(E.Z,{children:[(0,P.jsx)(A.ZP,{onClick:a,children:"取消"}),(0,P.jsx)(A.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){console.log(e);e.dateRange;i(d()(d()(d()({},n),e),{},{kbUid:null==f?void 0:f.uid,orgUid:null==c?void 0:c.uid,answer:e.answer}))})).catch((function(e){console.log("Form errors:",e),b.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,P.jsxs)(ue.A,{form:l,submitter:{render:function(){return null}},children:[(0,P.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:p,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),h(e)}}}),(0,P.jsx)(le.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:s.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){}}}),(0,P.jsx)(ce.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,P.jsx)(de.Z,{label:"基础答案",name:"answer"})]})})})};function Te(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/query/org",{method:"GET",params:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/create",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/update",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/delete",{method:"POST",data:d()(d()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pe=n(88721),Re=["current","pageSize"],Oe=function(){var e=(0,l.useIntl)(),t=(0,Z.Z)().translateString,n=(0,o.useRef)(),r=(0,o.useState)(!0),a=M()(r,2),i=a[0],u=a[1],c=(0,o.useState)(),f=M()(c,2),g=f[0],h=f[1],v=(0,o.useState)(!1),w=M()(v,2),k=w[0],S=w[1],j=(0,o.useState)(1),C=M()(j,2),D=C[0],q=C[1],E=(0,o.useState)(10),F=M()(E,2),R=F[0],z=F[1],K=(0,U.u)((function(e){return e.currentOrg})),G=(0,T.j)((function(e){return e.currentKbase})),J=(0,O.v)((function(e){return e.currentCategory})),$=(0,O.v)((function(e){return e.categorySelectOptions})),X=(0,o.useState)(!1),ee=M()(X,2),te=ee[0],ne=ee[1],re=(0,o.useState)([]),ae=M()(re,2),se=ae[0],ie=ae[1],oe=(0,o.useState)([]),ue=M()(oe,2),le=ue[0],ce=ue[1],de=(0,o.useState)(0),fe=M()(de,2),pe=(fe[0],fe[1]),ge=function(){var t=y()(x()().mark((function t(r){var a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,Ae(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),me=function(){var t=y()(x()().mark((function t(){var r,a,s,i,o,u;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==le.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,i=m()(le),t.prev=7,i.s();case 9:if((o=i.n()).done){t.next=23;break}return u=o.value,t.prev=11,t.next=14,Ae(u);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),i.e(t.t1);case 28:return t.prev=28,i.f(),t.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),ie([]),ce([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:300,ellipsis:!0,search:!0},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:400,ellipsis:!0,search:!0,render:function(e,t){return(0,P.jsx)(Ce.H,{content:null==t?void 0:t.answer})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.type"}),dataIndex:"type",width:100,valueEnum:{text:{text:e.formatMessage({id:"faq.type.text"})},image:{text:e.formatMessage({id:"faq.type.image"})},video:{text:e.formatMessage({id:"faq.type.video"})},file:{text:e.formatMessage({id:"faq.type.file"})}},render:function(e,t){return(0,Pe.OI)(t.type)}},{title:(0,P.jsx)(l.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,render:function(e,t){var n=$.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,P.jsx)(V.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:$.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,P.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:100,render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,P.jsx)(V.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.startDate?H()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.endDate?H()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,P.jsx)(l.FormattedMessage,{id:"faq.updatedAt"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,r,a){return[(0,P.jsx)("a",{onClick:function(){ve(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,P.jsx)(L.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return ge(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsx)(A.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}],xe=function(){h(void 0),u(!1),S(!0)},ve=function(e){h(e),u(!0),S(!0)},ye=function(){var t=y()(x()().mark((function t(r){var a,s;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),i?b.yw.loading(e.formatMessage({id:"updating"})):b.yw.loading(e.formatMessage({id:"creating"})),!i){t.next=8;break}return t.next=5,qe(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,De(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createQa response:",r,a),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),S(!1),null===(s=n.current)||void 0===s||s.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),we=function(){var e=y()(x()().mark((function e(){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleImport"),ne(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[G,J]);var Me=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,W.HK)(s.QPQ,null==K?void 0:K.uid,null==G?void 0:G.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),be=function(){var e=y()(x()().mark((function e(){var t;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",D,R),t=localStorage.getItem(s.LA8),window.open((0,I.kG)()+"/api/v1/llm/qa/export?"+new URLSearchParams({pageNumber:String(D-1),pageSize:String(R),categoryUid:(null==J?void 0:J.uid)===s.zBg?"":null==J?void 0:J.uid,kbUid:null==G?void 0:G.uid,orgUid:(null==K?void 0:K.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke={selectedRowKeys:se,onChange:function(e,t){ie(e),ce(t)}};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(B.Z,{columns:he,actionRef:n,cardBordered:!0,rowSelection:ke,request:function(){var t=y()(x()().mark((function t(n,r,a){var i,o,u,l,c;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),b.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),i=n.current,o=n.pageSize,u=p()(n,Re),q(i),z(o),l=d()({pageNumber:i-1,pageSize:o,categoryUid:(null==J?void 0:J.uid)===s.zBg?"":null==J?void 0:J.uid,kbUid:null==G?void 0:G.uid,orgUid:null==K?void 0:K.uid},u),t.next=8,Te(l);case 8:return c=t.sent,console.log("queryQasByOrg qa response:",l,c),b.yw.destroy(),200===c.code?pe(c.data.totalElements):b.yw.error(c.message),t.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){q(e),z(t)}},dateFormatter:"string",headerTitle:t(null==G?void 0:G.name)+" - 问答对",tooltip:"所添加LLM_QA内容会自动添加到 '拆分' 列表中 ",toolBarRender:function(){return[(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(_.Z,{}),type:"primary",onClick:xe,children:e.formatMessage({id:"create"})},"create"),se.length>0&&(0,P.jsx)(L.Z,{title:e.formatMessage({id:"batch.deleteTip"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(se.length," ").concat(e.formatMessage({id:"items"}),"?"),onConfirm:me,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,P.jsxs)(A.ZP,{danger:!0,icon:(0,P.jsx)(N.Z,{}),children:[e.formatMessage({id:"batch.delete"})," (",se.length,")"]})},"batchDelete"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(Se.Z,{}),type:"primary",onClick:we,children:e.formatMessage({id:"import"})},"import"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(Y.Z,{}),type:"primary",onClick:be,children:e.formatMessage({id:"export"})},"export"),(0,P.jsx)(A.ZP,{icon:(0,P.jsx)(je.Z,{}),type:"link",onClick:function(){return(0,I.zA)()},children:e.formatMessage({id:"download.template"})},"download")]},columnsState:{persistenceKey:"qa-table",defaultValue:{viewCount:{show:!1},clickCount:{show:!0},upCount:{show:!0},downCount:{show:!0},valid:{show:!0},startDate:{show:!1},endDate:{show:!1}}}}),k&&(0,P.jsx)(Ze,{isEdit:i,open:k,faq:g,onClose:function(){return S(!1)},onSubmit:ye}),te&&(0,P.jsx)(Q.Z,{type:s.Vi_,isModalOpen:te,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),ne(!1),null==n||n.current.reload(),Me()},handleCancel:function(){console.log("handleUploadDragCancel"),ne(!1),null==n||n.current.reload()}})]})};var ze=function(){var e=(0,l.useIntl)(),t=(0,o.useMemo)((function(){return[{key:"qa",label:e.formatMessage({id:"pages.robot.kb.qa",defaultMessage:"Q&A"}),children:(0,P.jsx)(Oe,{})},{key:"file",label:e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,P.jsx)(J,{})},{key:"text",label:e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,P.jsx)(ge,{})},{key:"split",label:e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"}),children:(0,P.jsx)(ke,{})}]}),[e]);return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(u.Z,{items:t})})},_e=a.Z.Sider,Ne=a.Z.Content,Ye=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,P.jsx)("div",{children:(0,P.jsxs)(a.Z,{children:[(0,P.jsx)(_e,{style:t,children:(0,P.jsx)(i.Z,{type:s.QPQ})}),(0,P.jsx)(a.Z,{children:(0,P.jsx)(Ne,{style:n,children:(0,P.jsx)(ze,{})})})]})})}}}]);