"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5230],{86702:function(e,t,s){var r=s(32906),n=s(94433),a=s(38956),o=s(81424),i=s(69705),d=s(65641),l=s(34573),u=s(44194),c=s(9953),p=s(31549),m=["fieldProps","proFieldProps"],f=["fieldProps","proFieldProps"],g="text",x=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),s=(0,r.Z)(t,2),a=s[0],l=s[1];return(0,p.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var s,r=t.getFieldValue(e.name||[]);return(0,p.jsx)(d.Z,(0,n.Z)((0,n.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return l(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(s=e.statusRender)||void 0===s?void 0:s.call(e,r),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:a,children:e.children}))}})},h=function(e){var t=e.fieldProps,s=e.proFieldProps,r=(0,a.Z)(e,m);return(0,p.jsx)(c.Z,(0,n.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:s},r))};h.Password=function(e){var t=e.fieldProps,s=e.proFieldProps,o=(0,a.Z)(e,f),i=(0,u.useState)(!1),d=(0,r.Z)(i,2),m=d[0],h=d[1];return null!=t&&t.statusRender&&o.name?(0,p.jsx)(x,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:m,onOpenChange:h,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:(0,n.Z)((0,n.Z)({},(0,l.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var s;null==t||null===(s=t.onBlur)||void 0===s||s.call(t,e),h(!1)},onClick:function(e){var s;null==t||null===(s=t.onClick)||void 0===s||s.call(t,e),h(!0)}}),proFieldProps:s,filedConfig:{valueType:g}},o))})}):(0,p.jsx)(c.Z,(0,n.Z)({valueType:"password",fieldProps:t,proFieldProps:s,filedConfig:{valueType:g}},o))},h.displayName="ProFormComponent",t.Z=h},60241:function(e,t,s){var r=s(94433),n=s(38956),a=s(44194),o=s(9953),i=s(31549),d=["fieldProps","proFieldProps"],l=function(e,t){var s=e.fieldProps,a=e.proFieldProps,l=(0,n.Z)(e,d);return(0,i.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:s,proFieldProps:a},l))};t.Z=a.forwardRef(l)},21005:function(e,t,s){s.r(t),s.d(t,{default:function(){return ae}});var r=s(76711),n=s.n(r),a=s(45332),o=s.n(a),i=s(44194),d=s(21600),l=s(4628),u=s(35851),c=s(89451),p=s(84176),m=s.n(p),f=s(73193),g=s.n(f),x=s(90819),h=s.n(x),v=s(89933),M=s.n(v),j=s(43388),y=s(27729),b=s(94976);function Z(e){return k.apply(this,arguments)}function k(){return(k=M()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/customer/query/org",{method:"GET",params:g()(g()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return w.apply(this,arguments)}function w(){return(w=M()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/customer/create",{method:"POST",data:g()(g()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return S.apply(this,arguments)}function S(){return(S=M()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/customer/update",{method:"POST",data:g()(g()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return T.apply(this,arguments)}function T(){return(T=M()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/customer/delete",{method:"POST",data:g()(g()({},t),{},{channel:b.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=s(74171),B=s(58620),A=s(15722),U=s(90297),O=s(59304),R=s(54881),E=s(11090),q=s(10162),N=s(2484),z=s(34512),J=s(30310),D=s(92351),X=s(69533),Y=s(28508),K=s(96596),G=s.n(K),H=s(99036),L=s(86702),V=s(60241),Q=s(82878),W=s(30857),$=s(31549),_=function(e){var t=e.isEdit,s=e.customer,r=e.open,n=e.onClose,a=e.onSubmit,d=(0,l.useIntl)(),u=H.A.useForm(),c=o()(u,1)[0],p=Q.Z.Text;(0,i.useEffect)((function(){r&&(t&&s?c.setFieldsValue({nickname:s.nickname||"",email:s.email||"",mobile:s.mobile||"",description:s.description||"",notes:s.notes||"",extra:s.extra||"",channel:s.channel||""}):c.resetFields())}),[r,t,s,c]);var m=t?d.formatMessage({id:"customer.edit",defaultMessage:"编辑客户"}):d.formatMessage({id:"customer.create",defaultMessage:"新增客户"}),f=s&&!t,x=f?null:(0,$.jsxs)(J.Z,{children:[(0,$.jsx)(X.ZP,{onClick:n,children:(0,$.jsx)(l.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,$.jsx)(X.ZP,{type:"primary",onClick:function(){c.validateFields().then((function(e){var r=g()(g()({},e),t&&s?{uid:s.uid}:{});a(r)}))},children:(0,$.jsx)(l.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,$.jsx)($.Fragment,{children:(0,$.jsx)(W.Z,{title:m,onClose:n,open:r,width:500,extra:x,children:f&&s?(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",s.nickname||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),":"]})," ",s.email||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"mobile",defaultMessage:"手机"}),":"]})," ",s.mobile||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"description",defaultMessage:"描述"}),":"]})," ",s.description||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"notes",defaultMessage:"备注"}),":"]})," ",s.notes||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"extra",defaultMessage:"额外信息"}),":"]})," ",s.extra||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",s.createdAt||"-"]}),(0,$.jsxs)("div",{style:{marginBottom:16},children:[(0,$.jsxs)(p,{strong:!0,children:[(0,$.jsx)(l.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",s.updatedAt||"-"]})]}):(0,$.jsxs)(H.A,{form:c,name:"customerForm",submitter:!1,children:[(0,$.jsx)(L.Z,{name:"nickname",label:(0,$.jsx)(l.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:"请输入客户昵称"}]}),(0,$.jsx)(L.Z,{name:"email",label:(0,$.jsx)(l.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}]}),(0,$.jsx)(L.Z,{name:"mobile",label:(0,$.jsx)(l.FormattedMessage,{id:"mobile",defaultMessage:"手机"})}),(0,$.jsx)(V.Z,{name:"description",label:(0,$.jsx)(l.FormattedMessage,{id:"description",defaultMessage:"描述"})}),(0,$.jsx)(V.Z,{name:"notes",label:(0,$.jsx)(l.FormattedMessage,{id:"notes",defaultMessage:"备注"})}),(0,$.jsx)(V.Z,{name:"extra",label:(0,$.jsx)(l.FormattedMessage,{id:"extra",defaultMessage:"额外信息"})})]})})})},ee=["current","pageSize"],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,$.jsx)(l.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,$.jsx)(l.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,$.jsx)(l.FormattedMessage,{id:"customer.nickname.tooltip"})},{title:(0,$.jsx)(l.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",hideInSearch:!0,tooltip:(0,$.jsx)(l.FormattedMessage,{id:"customer.email.tooltip"})},{title:(0,$.jsx)(l.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",copyable:!0,tooltip:(0,$.jsx)(l.FormattedMessage,{id:"customer.mobile.tooltip"})},{title:(0,$.jsx)(l.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,tooltip:(0,$.jsx)(l.FormattedMessage,{id:"customer.description.tooltip"})},{title:(0,$.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,$.jsx)(l.FormattedMessage,{id:"customer.createdAt.tooltip"}),render:function(e,t,s,r){return G()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],se=function(e){e.superUser;var t=(0,l.useIntl)(),s=(0,i.useRef)(),r=(0,i.useState)(1),n=o()(r,2),a=n[0],d=n[1],u=(0,i.useState)(10),c=o()(u,2),p=c[0],f=c[1],x=(0,I.u)((function(e){return e.currentOrg})),v=(0,i.useState)({}),k=o()(v,2),w=k[0],S=k[1],T=(0,i.useState)(0),K=o()(T,2),G=K[0],H=K[1],L=(0,i.useState)([]),V=o()(L,2),Q=V[0],W=V[1],se=(0,i.useState)([]),re=o()(se,2),ne=(re[0],re[1]),ae=(0,i.useState)(!1),oe=o()(ae,2),ie=oe[0],de=oe[1],le=(0,i.useState)(!1),ue=o()(le,2),ce=ue[0],pe=ue[1],me=(0,i.useState)(),fe=o()(me,2),ge=fe[0],xe=fe[1],he=function(){var e=M()(h()().mark((function e(r){var n,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ce||!ge){e.next=7;break}return e.next=4,P(g()(g()({},r),{},{uid:ge.uid,orgUid:null==x?void 0:x.uid}));case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,F(g()(g()({},r),{},{orgUid:null==x?void 0:x.uid}));case 9:n=e.sent;case 10:200===n.code?(j.yw.success(ce?t.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):t.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),de(!1),null===(a=s.current)||void 0===a||a.reload()):j.yw.error(n.message||t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),j.yw.error(t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){xe(void 0),pe(!1),de(!0)},Me=[].concat(te,[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,r){return(0,$.jsxs)(J.Z,{children:[(0,$.jsx)(D.Z,{title:t.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,$.jsx)(X.ZP,{type:"text",icon:(0,$.jsx)(U.Z,{}),onClick:function(){return function(e){xe(e),pe(!1),de(!0)}(r)}})}),(0,$.jsx)(D.Z,{title:t.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,$.jsx)(X.ZP,{type:"text",icon:(0,$.jsx)(O.Z,{}),onClick:function(){return function(e){xe(e),pe(!0),de(!0)}(r)}})}),(0,$.jsx)(D.Z,{title:t.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,$.jsx)(X.ZP,{type:"text",danger:!0,icon:(0,$.jsx)(R.Z,{}),onClick:function(){return function(e){var r;y.Z.confirm({title:t.formatMessage({id:"customer.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,$.jsx)(A.Z,{}),content:t.formatMessage({id:"customer.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(r=M()(h()().mark((function r(){var n,a;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,C({uid:e.uid,orgUid:null==x?void 0:x.uid});case 3:200===(n=r.sent).code?(j.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(a=s.current)||void 0===a||a.reload()):j.yw.error(n.message||t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("删除客户出错:",r.t0),j.yw.error(t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return r.stop()}}),r,null,[[0,7]])}))),function(){return r.apply(this,arguments)})})}(r)}})})]})}}]),je=function(){var e=M()(h()().mark((function e(t,s,r){var n,o;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,s,r),n=localStorage.getItem(b.LA8),o=g()({orgUid:(null==x?void 0:x.uid)||"",accessToken:n||"",exportType:t},w),"current"===t?(o.pageNumber=String(a-1),o.pageSize=String(p)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==s&&void 0!==r&&(o.pageNumber=String(s),o.pageSize=String(r)),window.open((0,B.kG)()+"/api/v1/customer/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,s,r){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],s=1e3,r=Math.ceil(e/s),n=function(){var r=a,n=a*s+1,o=Math.min((a+1)*s,e);t.push({key:"export-".concat(a),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return je("range",r,s)}})},a=0;a<r;a++)n();return t},be={selectedRowKeys:Q,onChange:function(e,t){W(e),ne(t)}};return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(z.Z,{columns:Me,actionRef:s,cardBordered:!0,rowSelection:be,scroll:{x:1300},request:function(){var e=M()(h()().mark((function e(t,s,r){var n,a,o,i,l,u,c,p;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.current,a=t.pageSize,o=m()(t,ee),d(n),f(a),S(o),i=void 0,l=void 0,s&&Object.keys(s).length>0&&(u=Object.keys(s)[0],i=u,l="ascend"===s[u]?"ascend":"descend"),c=g()(g()({pageNumber:n-1,pageSize:a,orgUid:null==x?void 0:x.uid},o),{},{sortBy:i,sortDirection:l}),e.next=10,Z(c);case 10:return p=e.sent,console.log("queryCustomersByOrg response:",p,c),200===p.code?H(null==p?void 0:p.data.totalElements):j.yw.error(p.message),e.abrupt("return",{data:null==p?void 0:p.data.content,success:!0,total:null==p?void 0:p.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,s,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){d(e),f(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"客户列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,$.jsx)(E.Z,{}),label:t.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return je("current")}}],G>0&&(G<=1e3?e.push({key:"export-all",icon:(0,$.jsx)(E.Z,{}),label:t.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return je("all")}}):e.push({key:"export-range",icon:(0,$.jsx)(E.Z,{}),label:t.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ye(G)})),[(0,$.jsx)(X.ZP,{type:"primary",icon:(0,$.jsx)(q.Z,{}),onClick:ve,children:t.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,$.jsx)(Y.Z,{menu:{items:e},placement:"bottom",children:(0,$.jsxs)(X.ZP,{type:"primary",icon:(0,$.jsx)(E.Z,{}),children:[t.formatMessage({id:"export",defaultMessage:"导出"}),(0,$.jsx)(N.Z,{})]})},"exportOperations")];var e}}),(0,$.jsx)(_,{isEdit:ce,customer:ge,open:ie,onClose:function(){return de(!1)},onSubmit:he})]})},re=s(4640),ne=s(22194),ae=function(){var e=(0,l.useIntl)(),t=(0,i.useState)("visitor"),s=o()(t,2),r=s[0],a=s[1],p=(0,i.useMemo)((function(){var t=[{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,$.jsx)(u.Z,{superUser:!1})},{key:"customer",label:e.formatMessage({id:"customer"}),children:(0,$.jsx)(se,{superUser:!1})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,$.jsx)(c.Z,{superUser:!1})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,$.jsx)(re.Z,{superUser:!1})}];return(0,B.OJ)()&&t.splice(2,0,{key:"blackIp",label:e.formatMessage({id:"visitor.tab.blackIp"}),children:(0,$.jsx)(ne.Z,{superUser:!1})}),t}),[e]),m=(0,i.useMemo)((function(){return[]}),[]),f=(0,i.useMemo)((function(){return[].concat(n()(p),n()(m))}),[p,m]);return(0,$.jsx)(d.Z,{items:f,activeKey:r,onChange:a,style:{margin:10}})}}}]);