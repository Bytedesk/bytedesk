"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1956],{99824:function(e,t,a){a.d(t,{Z:function(){return le}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),u=a(90819),d=a.n(u),c=a(89933),p=a.n(c),f=a(45332),g=a.n(f),m=a(43388),y=a(94976),h=a(4628);function x(e){return v.apply(this,arguments)}function v(){return(v=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/query/org",{method:"GET",params:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/create",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/update",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/delete",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return D.apply(this,arguments)}function D(){return(D=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:y.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=a(74171),C=a(10162),F=a(54881),E=a(93689),I=a(40439),U=a(30617),P=a(11090),L=a(2484),A=a(44565),z=a(27729),O=a(90581),R=a(30310),Y=a(69533),q=a(43275),B=a(28508),K=a(44194),X=a(1715),N=a(8732),J=a(99036),V=a(38106),H=a(59005),Q=a(60241),W=a(30857),G=a(96596),_=a.n(G),$=a(58620),ee=a(31549),te=function(e){var t=e.isEdit,a=e.autoreply,r=e.open,n=e.onClose,s=e.onSubmit,i=J.A.useForm(),u=g()(i,1)[0],d=(0,Z.u)((function(e){return e.currentOrg})),c=(0,N.j)((function(e){return e.currentKbase})),p=(0,X.v)((function(e){return e.categorySelectOptions})),f=(0,X.v)((function(e){return e.categoryTreeOptions})),h=(0,K.useState)(),x=g()(h,2),v=(x[0],x[1]),M=(0,K.useState)(y.PYi),b=g()(M,2),w=(b[0],b[1]),k=(0,K.useState)(".png,.jpg,.jpeg"),j=g()(k,2),S=(j[0],j[1]),T=(0,K.useState)({file:void 0,fileName:"test.pdf",fileType:"application/pdf",isAvatar:"false",kbType:"type",categoryUid:"",kbUid:(null==c?void 0:c.uid)||"",channel:y.XtJ}),D=g()(T,2);D[0],D[1];(0,K.useEffect)((function(){if(t)u.setFieldsValue({type:null==a?void 0:a.type,content:null==a?void 0:a.content,categoryUid:null==a?void 0:a.categoryUid,kbUid:null==c?void 0:c.uid});else{var e=function e(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=l()(a);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.key!==y.zBg)return n.key;var s=e(n.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(f||[])||(p.length>0?p[0].value:"");u.resetFields(),u.setFieldsValue({type:y.PYi,content:"",categoryUid:e,kbUid:null==c?void 0:c.uid}),e&&v(e)}}),[r,p,f]);(0,$.M$)(),localStorage.getItem(y.LA8);return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(W.Z,{title:t?"修改固定回复":"新建固定回复",width:650,onClose:n,open:r,extra:(0,ee.jsxs)(R.Z,{children:[(0,ee.jsx)(Y.ZP,{onClick:n,children:"取消"}),(0,ee.jsx)(Y.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log(e),s(o()(o()(o()({},a),e),{},{kbUid:null==c?void 0:c.uid,orgUid:null==d?void 0:d.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,ee.jsxs)(J.A,{form:u,initialValues:o()({},a),submitter:{render:function(){return null}},children:[(0,ee.jsx)(V.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)},treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==y.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(f||[]),showSearch:!0,treeDefaultExpandAll:!1,fieldNames:{label:"title",value:"key",children:"children"}}}),(0,ee.jsx)(H.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:y.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),w(e),e===y.Qm?S(".png,.jpg,.jpeg,.gif,.bmp"):e===y.tVi?S(".mp4,.avi,.mov,.wmv"):e===y.Yu1?S(".mp3,.wav,.flac"):e===y.Qn&&S(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,ee.jsx)(Q.Z,{name:"content",label:"回复",rules:[{required:!0,message:"请输入回复"}]})]})})})},ae=a(88722),re=a(54974),ne=a(78069),se=a(16658),oe=a(85977),ie=["current","pageSize"],le=function(e){var t,a,r,s,i,u,c,f,v,b,k=e.superUser,S=(0,h.useIntl)(),D=(0,h.useAccess)(),J=(0,K.useRef)(),V=(0,K.useMemo)((function(){var e;return null==D||null===(e=D.getModulePermission)||void 0===e?void 0:e.call(D,oe.MY.AUTO_REPLY_FIXED)}),[D]),H=k||null!==(t=null==V||null===(a=V.canRead)||void 0===a?void 0:a.call(V))&&void 0!==t&&t,Q=k||null!==(r=null==V||null===(s=V.canCreate)||void 0===s?void 0:s.call(V))&&void 0!==r&&r,W=k||null!==(i=null==V||null===(u=V.canUpdate)||void 0===u?void 0:u.call(V))&&void 0!==i&&i,G=k||null!==(c=null==V||null===(f=V.canDelete)||void 0===f?void 0:f.call(V))&&void 0!==c&&c,le=k||null!==(v=null==V||null===(b=V.canExport)||void 0===b?void 0:b.call(V))&&void 0!==v&&v,ue=(0,K.useRef)(!1),de=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},ce=(0,K.useState)(!0),pe=g()(ce,2),fe=pe[0],ge=pe[1],me=(0,K.useState)(!1),ye=g()(me,2),he=ye[0],xe=ye[1],ve=(0,ae.Z)().translateString,Me=(0,K.useState)(1),be=g()(Me,2),we=be[0],ke=be[1],je=(0,K.useState)(10),Se=g()(je,2),Te=Se[0],De=Se[1],Ze=(0,Z.u)((function(e){return e.currentOrg})),Ce=(0,N.j)((function(e){return e.currentKbase})),Fe=(0,X.v)((function(e){return e.currentCategory})),Ee=(0,X.v)((function(e){return e.categorySelectOptions})),Ie=(0,K.useState)(!1),Ue=g()(Ie,2),Pe=Ue[0],Le=Ue[1],Ae=(0,K.useState)(),ze=g()(Ae,2),Oe=ze[0],Re=ze[1],Ye=(0,K.useState)([]),qe=g()(Ye,2),Be=qe[0],Ke=qe[1],Xe=(0,K.useState)([]),Ne=g()(Xe,2),Je=Ne[0],Ve=Ne[1],He=z.Z.useModal(),Qe=g()(He,2),We=(Qe[0],Qe[1]),Ge=(0,K.useState)({}),_e=g()(Ge,2),$e=_e[0],et=_e[1],tt=(0,K.useState)(0),at=g()(tt,2),rt=at[0],nt=at[1],st=function(){var e=p()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return de("autoreply.fixed.permission.delete.denied","无权限：删除固定回复"),e.abrupt("return");case 3:return console.log(t),e.next=6,j(t);case 6:a=e.sent,console.log("delete response:",a),200===a.code?(null==J||null===(r=J.current)||void 0===r||r.reload(),m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(S.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ot=function(){var e=p()(d()().mark((function e(){var t,a,r,n,s,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return de("autoreply.fixed.permission.batchDelete.denied","无权限：批量删除固定回复"),e.abrupt("return");case 3:if(0!==Je.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,r=0,n=l()(Je),e.prev=10,n.s();case 12:if((s=n.n()).done){e.next=26;break}return o=s.value,e.prev=14,e.next=17,j(o);case 17:200===e.sent.code?a++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:r})),Ke([]),Ve([]),null===(t=J.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),it=function(){var e=p()(d()().mark((function e(t){var a,r,n,s,o,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W){e.next=3;break}return de("autoreply.fixed.permission.update.denied","无权限：启用/禁用固定回复"),e.abrupt("return");case 3:if(0!==Je.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 6:m.yw.loading(t?S.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):S.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),r=0,n=0,s=l()(Je),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return i=o.value,e.prev=14,e.next=17,T({uid:i.uid,enabled:t});case 17:200===e.sent.code?r++:n++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),n++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===n?m.yw.success(t?S.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:r}):S.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:r})):m.yw.warning(t?S.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:r,fail:n}):S.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:r,fail:n})),Ke([]),Ve([]),null===(a=J.current)||void 0===a||a.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(t){return e.apply(this,arguments)}}(),lt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,fixed:"left",width:300,ellipsis:!0,search:!0,tooltip:S.formatMessage({id:"autoreply.fixed.content.tooltip",defaultMessage:"固定自动回复的内容"}),render:function(e,t){return ve(null==t?void 0:t.content)}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:100,tooltip:S.formatMessage({id:"autoreply.fixed.type.tooltip",defaultMessage:"回复内容的类型"}),render:function(e,t){return(0,se.OI)(t.type)},valueEnum:{text:{text:S.formatMessage({id:"autoreply.type.text"})},image:{text:S.formatMessage({id:"autoreply.type.image"})},video:{text:S.formatMessage({id:"autoreply.type.video"})},file:{text:S.formatMessage({id:"autoreply.type.file"})}}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.replyCount",defaultMessage:"Reply Count"}),dataIndex:"replyCount",width:100,hideInSearch:!0,sorter:!0,tooltip:S.formatMessage({id:"autoreply.fixed.replyCount.tooltip",defaultMessage:"该回复被使用的次数"})},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.enabled",defaultMessage:"Status"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.fixed.enabled.tooltip",defaultMessage:"该固定回复是否启用"}),valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"autoreply.fixed.category.tooltip",defaultMessage:"固定回复的分类"}),render:function(e,t){var a=Ee.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,ee.jsx)(O.Z,{color:"blue",children:(null==a?void 0:a.label)||"-"})},filters:Ee.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,ellipsis:!0,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.fixed.tags.tooltip",defaultMessage:"用于筛选和分类的标签"}),render:function(e,t){var a;return null!=t&&t.tagList?null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e){return(0,ee.jsx)(O.Z,{color:"green",children:e.trim()},e)})):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.startDate",defaultMessage:"Start Date"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.fixed.startDate.tooltip",defaultMessage:"固定回复生效的开始时间"}),render:function(e,t){return t.startDate?_()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.endDate",defaultMessage:"End Date"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.fixed.endDate.tooltip",defaultMessage:"固定回复失效的结束时间"}),render:function(e,t){return t.endDate?_()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.fixed.updatedAt.tooltip",defaultMessage:"最后更新的时间"})},{title:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){return(0,ee.jsxs)(R.Z,{children:[W?(0,ee.jsx)(Y.ZP,{type:"link",size:"small",onClick:function(){return dt(t)},children:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}):null,G?(0,ee.jsx)(q.Z,{title:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),description:S.formatMessage({id:"pages.common.deleteConfirm"},{name:t.content}),onConfirm:function(){return st(t)},okText:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.ok"}),cancelText:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.cancel"}),children:(0,ee.jsx)(Y.ZP,{type:"link",danger:!0,size:"small",children:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.delete"})})}):null]})}}],ut=function(){Q?(Re(void 0),ge(!1),xe(!0)):de("autoreply.fixed.permission.create.denied","无权限：新建固定回复")},dt=function(e){W?(Re(e),ge(!0),xe(!0)):de("autoreply.fixed.permission.update.denied","无权限：编辑固定回复")},ct=function(){var e=p()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),!fe||W){e.next=4;break}return de("autoreply.fixed.permission.update.denied","无权限：编辑固定回复"),e.abrupt("return");case 4:if(fe||Q){e.next=7;break}return de("autoreply.fixed.permission.create.denied","无权限：新建固定回复"),e.abrupt("return");case 7:if(fe?(m.yw.loading(S.formatMessage({id:"updating"})),t.uid=null==Oe?void 0:Oe.uid):m.yw.loading(S.formatMessage({id:"creating"})),!fe){e.next=14;break}return e.next=11,w(t);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,M(t);case 16:e.t0=e.sent;case 17:a=e.t0,console.log("createQuickreply response:",t,a),200===a.code?(m.yw.destroy(),m.yw.loading(S.formatMessage({id:"create.success"})),xe(!1),null===(r=J.current)||void 0===r||r.reload()):(m.yw.destroy(),m.yw.error(a.message));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=p()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q){e.next=3;break}return de("autoreply.fixed.permission.import.denied","无权限：导入固定回复"),e.abrupt("return");case 3:Le(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ft=function(){var e=p()(d()().mark((function e(t,a,r){var n,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleExportExcel",t,a,r),le){e.next=4;break}return de("autoreply.fixed.permission.export.denied","无权限：导出固定回复"),e.abrupt("return");case 4:n=localStorage.getItem(y.LA8),s=o()({categoryUid:(null==Fe?void 0:Fe.uid)===y.zBg?"":null==Fe?void 0:Fe.uid,kbUid:null==Ce?void 0:Ce.uid,orgUid:(null==Ze?void 0:Ze.uid)||"",accessToken:n||"",exportType:t},$e),"current"===t?(s.pageNumber=String(we-1),s.pageSize=String(Te)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,$.kG)()+"/api/v1/autoreply/fixed/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),gt=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ft("range",r,a)}})},s=0;s<r;s++)n();return t};(0,K.useEffect)((function(){var e;null===(e=J.current)||void 0===e||e.reload()}),[Ce,Fe]);var mt=function(){var e=p()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ne.HK)(y.WvL,null==Ze?void 0:Ze.uid,null==Ce?void 0:Ce.uid,y.whQ,{showLoading:!0,loadingMessage:S.formatMessage({id:"loading"}),errorMessage:S.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),yt=G?{selectedRowKeys:Be,onChange:function(e,t){Ke(e),Ve(t)}}:void 0;return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(A.Z,{columns:lt,actionRef:J,cardBordered:!0,rowSelection:yt,request:function(){var e=p()(d()().mark((function e(t,a,r){var s,i,l,u,c,p,f,g,h,v;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("request:",t,a,r),H){e.next=4;break}return ue.current||(ue.current=!0,de("autoreply.fixed.permission.read.denied","无权限：查看固定回复")),e.abrupt("return",{data:[],success:!0,total:0});case 4:return m.yw.loading(S.formatMessage({id:"loading",defaultMessage:"Loading"})),s=t.current,i=t.pageSize,l=n()(t,ie),ke(s),De(i),et(l),u=void 0,c=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],u=p,c="ascend"===a[p]?"ascend":"descend"),f=k?void 0:(null==Fe?void 0:Fe.uid)===y.zBg?"":null==Fe?void 0:Fe.uid,g=k||null==Ce?void 0:Ce.uid,h=o()(o()({pageNumber:s-1,pageSize:i,categoryUid:f,kbUid:g,orgUid:null==Ze?void 0:Ze.uid,superUser:k},l),{},{sortBy:u,sortDirection:c}),e.next=17,x(h);case 17:return v=e.sent,console.log("queryAutoReplyFixedByOrg response:",h,v),m.yw.destroy(),200===v.code?nt(null==v?void 0:v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:null==v?void 0:v.data.content,success:!0,total:null==v?void 0:v.data.totalElements});case 22:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){ke(e),De(t)}},dateFormatter:"string",headerTitle:ve(null==Ce?void 0:Ce.name)+" - "+S.formatMessage({id:"autoreply.fixed.title",defaultMessage:"固定回复"}),tooltip:{title:S.formatMessage({id:"autoreply.fixed.tooltip",defaultMessage:"客服-》一对一-》高级设置-》自动回复"}),placement:"top"},toolBarRender:function(){return k?[]:[Q?(0,ee.jsx)(Y.ZP,{icon:(0,ee.jsx)(C.Z,{}),type:"primary",onClick:ut,children:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.create",defaultMessage:"Create Fixed Reply"})},"create"):null,G&&Be.length>0&&(0,ee.jsx)(q.Z,{title:S.formatMessage({id:"batch.deleteTip"}),description:"".concat(S.formatMessage({id:"batch.deleteAffirm"})," ").concat(Be.length," ").concat(S.formatMessage({id:"items"}),"?"),onConfirm:ot,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),children:(0,ee.jsxs)(Y.ZP,{danger:!0,icon:(0,ee.jsx)(F.Z,{}),children:[S.formatMessage({id:"batch.delete"})," (",Be.length,")"]})},"batchDelete"),W&&Be.length>0&&(0,ee.jsxs)(Y.ZP,{type:"primary",icon:(0,ee.jsx)(E.Z,{}),onClick:function(){return it(!0)},children:[S.formatMessage({id:"batch.enable",defaultMessage:"Enable"})," (",Be.length,")"]},"batchEnable"),W&&Be.length>0&&(0,ee.jsxs)(Y.ZP,{danger:!0,icon:(0,ee.jsx)(I.Z,{}),onClick:function(){return it(!1)},children:[S.formatMessage({id:"batch.disable",defaultMessage:"Disable"})," (",Be.length,")"]},"batchDisable"),Q?(0,ee.jsx)(Y.ZP,{icon:(0,ee.jsx)(U.Z,{}),type:"primary",onClick:pt,children:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.import",defaultMessage:"Import Fixed Replies"})},"import"):null,le?(0,ee.jsx)(B.Z,{menu:{items:(e=[{key:"export-current",label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ft("current")}}],rt>0&&(rt<=1e3?e.push({key:"export-all",label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(rt,"条)"),onClick:function(){return ft("all")}}):e.push({key:"export-range",label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(rt,"条)"),children:gt(rt)})),e.push({key:"download",label:S.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,$.x5)()}}),e)},placement:"bottomRight",children:(0,ee.jsxs)(Y.ZP,{type:"primary",icon:(0,ee.jsx)(P.Z,{}),children:[(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.export",defaultMessage:"Export Fixed Replies"}),(0,ee.jsx)(L.Z,{})]})},"exportDropdown"):null].filter(Boolean);var e},columnsState:{persistenceKey:"autoreply-fixed-table",defaultValue:{tags:{show:!0},startDate:{show:!1},endDate:{show:!1},replyCount:{show:!0},enabled:{show:!0}}}}),he&&(0,ee.jsx)(te,{isEdit:fe,open:he,autoreply:Oe,onClose:function(){return xe(!1)},onSubmit:ct}),Pe&&(0,ee.jsx)(re.Z,{type:y.BMI,acceptType:".xlsx,.xls,.csv",isModalOpen:Pe,handleSubmit:function(e){var t;console.log("handleUploadDragSubmit",e),Le(!1),null==J||null===(t=J.current)||void 0===t||t.reload(),mt()},handleCancel:function(){var e;console.log("handleUploadDragCancel"),Le(!1),null==J||null===(e=J.current)||void 0===e||e.reload()}}),We]})}},74762:function(e,t,a){a.d(t,{Z:function(){return ue}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),u=a(90819),d=a.n(u),c=a(89933),p=a.n(c),f=a(45332),g=a.n(f),m=a(43388),y=a(94976),h=a(4628);function x(e){return v.apply(this,arguments)}function v(){return(v=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/query/org",{method:"GET",params:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/create",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/update",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/delete",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return D.apply(this,arguments)}function D(){return(D=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:y.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=a(74171),C=a(10162),F=a(54881),E=a(93689),I=a(40439),U=a(30617),P=a(11090),L=a(2484),A=a(44565),z=a(27729),O=a(30310),R=a(90581),Y=a(69533),q=a(43275),B=a(28508),K=a(44194),X=a(1715),N=a(8732),J=a(58620),V=a(99036),H=a(59005),Q=a(38106),W=a(60241),G=a(50628),_=a(30857),$=a(96596),ee=a.n($),te=a(31549),ae=function(e){var t=e.isEdit,a=e.keyword,r=e.open,n=e.onClose,s=e.onSubmit,i=V.A.useForm(),u=g()(i,1)[0],d=(0,Z.u)((function(e){return e.currentOrg})),c=(0,N.j)((function(e){return e.currentKbase})),p=(0,X.v)((function(e){return e.categorySelectOptions})),f=(0,X.v)((function(e){return e.categoryTreeOptions})),h=(0,K.useState)(),x=g()(h,2),v=(x[0],x[1]),M=(0,K.useState)(y.PYi),b=g()(M,2),w=(b[0],b[1]),k=(0,K.useState)(".png,.jpg,.jpeg"),j=g()(k,2),S=(j[0],j[1]),T=(0,K.useState)({file:void 0,fileName:"test.pdf",fileType:"application/pdf",isAvatar:"false",kbType:"type",categoryUid:"",kbUid:(null==c?void 0:c.uid)||"",channel:y.XtJ}),D=g()(T,2);D[0],D[1];(0,K.useEffect)((function(){if(t&&a){var e=Array.isArray(null==a?void 0:a.keywordList)?null==a?void 0:a.keywordList.join("|"):null==a?void 0:a.keywordList,r=Array.isArray(null==a?void 0:a.replyList)?null==a?void 0:a.replyList.join("|"):null==a?void 0:a.replyList;u.setFieldsValue({keywordList:e,replyList:r,matchType:null==a?void 0:a.matchType,contentType:null==a?void 0:a.contentType,categoryUid:null==a?void 0:a.categoryUid,kbUid:null==c?void 0:c.uid,enabled:null==a?void 0:a.enabled})}else{var n=function e(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=l()(a);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.key!==y.zBg)return n.key;var s=e(n.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(f||[])||(p.length>0?p[0].value:"");u.resetFields(),u.setFieldsValue({keywordList:"",replyList:"",matchType:y.lEl,contentType:y.PYi,categoryUid:n,enabled:!0}),n&&v(n)}}),[r,a,t,u,null==c?void 0:c.uid,p,f]);(0,J.M$)(),localStorage.getItem(y.LA8);return(0,te.jsx)(te.Fragment,{children:(0,te.jsx)(_.Z,{title:t?"修改关键词回复":"新建关键词回复",width:650,onClose:n,open:r,extra:(0,te.jsxs)(O.Z,{children:[(0,te.jsx)(Y.ZP,{onClick:n,children:"取消"}),(0,te.jsx)(Y.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("validateFields:",e);var t=Array.isArray(e.keywordList)?e.keywordList:e.keywordList.split("|").map((function(e){return e.trim()})).filter((function(e){return e})),a=Array.isArray(e.replyList)?e.replyList:e.replyList.split("|").map((function(e){return e.trim()})).filter((function(e){return e}));s(o()(o()({},e),{},{keywordList:t,replyList:a,kbUid:null==c?void 0:c.uid,orgUid:null==d?void 0:d.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,te.jsxs)(V.A,{form:u,submitter:{render:function(){return null}},children:[(0,te.jsx)(H.Z,{label:"匹配类型",name:"matchType",rules:[{required:!0,message:"请选择匹配类型"}],options:[{label:"模糊匹配",value:y.lEl},{label:"精确匹配",value:y.TAc,disabled:!0},{label:"正则匹配",value:y.c7i,disabled:!0},{label:"向量匹配",value:y.sOn,disabled:!0},{label:"搜索引擎匹配",value:y.NDq,disabled:!0}],fieldProps:{allowClear:!0,placeholder:"请选择匹配类型"}}),(0,te.jsx)(Q.Z,{label:"内容分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],tooltip:"请先：创建分类",fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)},treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==y.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(f||[]),showSearch:!0,treeDefaultExpandAll:!1,fieldNames:{label:"title",value:"key",children:"children"}}}),(0,te.jsx)(H.Z,{label:"类型",name:"contentType",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:y.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),w(e),e===y.Qm?S(".png,.jpg,.jpeg,.gif,.bmp"):e===y.tVi?S(".mp4,.avi,.mov,.wmv"):e===y.Yu1?S(".mp3,.wav,.flac"):e===y.Qn&&S(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,te.jsx)(W.Z,{label:"关键词，多个关键词使用 '|' 分割",name:"keywordList",tooltip:"多个关键词使用 '|' 分割",placeholder:"请输入关键词，多个关键词使用 '|' 分割",rules:[{required:!0,message:"请输入关键词，多个关键词使用 '|' 分割 "}]}),(0,te.jsx)(W.Z,{name:"replyList",label:"回复，多个回复使用 '|' 分割",tooltip:"多个回复使用 '|' 分割",rules:[{required:!0,message:"请输入回复，多个回复使用 '|' 分割"}]}),(0,te.jsx)(G.Z,{label:"启用",name:"enabled",fieldProps:{defaultValue:!0}})]})})})},re=a(54974),ne=a(88722),se=a(78069),oe=a(16658),ie=a(85977),le=["current","pageSize"],ue=function(e){var t,a,r,s,i,u,c,f,v,b,k=e.superUser,S=(0,h.useIntl)(),D=(0,ne.Z)().translateString,V=(0,h.useAccess)(),H=(0,K.useRef)(),Q=(0,K.useMemo)((function(){var e;return null==V||null===(e=V.getModulePermission)||void 0===e?void 0:e.call(V,ie.MY.AUTO_REPLY_KEYWORD)}),[V]),W=k||null!==(t=null==Q||null===(a=Q.canRead)||void 0===a?void 0:a.call(Q))&&void 0!==t&&t,G=k||null!==(r=null==Q||null===(s=Q.canCreate)||void 0===s?void 0:s.call(Q))&&void 0!==r&&r,_=k||null!==(i=null==Q||null===(u=Q.canUpdate)||void 0===u?void 0:u.call(Q))&&void 0!==i&&i,$=k||null!==(c=null==Q||null===(f=Q.canDelete)||void 0===f?void 0:f.call(Q))&&void 0!==c&&c,ue=k||null!==(v=null==Q||null===(b=Q.canExport)||void 0===b?void 0:b.call(Q))&&void 0!==v&&v,de=(0,K.useRef)(!1),ce=function(e,t){m.yw.warning(S.formatMessage({id:e,defaultMessage:t}))},pe=(0,K.useState)(!0),fe=g()(pe,2),ge=fe[0],me=fe[1],ye=(0,K.useState)(!1),he=g()(ye,2),xe=he[0],ve=he[1],Me=(0,K.useState)(1),be=g()(Me,2),we=be[0],ke=be[1],je=(0,K.useState)(10),Se=g()(je,2),Te=Se[0],De=Se[1],Ze=(0,Z.u)((function(e){return e.currentOrg})),Ce=(0,N.j)((function(e){return e.currentKbase})),Fe=(0,X.v)((function(e){return e.currentCategory})),Ee=(0,X.v)((function(e){return e.categorySelectOptions})),Ie=(0,K.useState)(!1),Ue=g()(Ie,2),Pe=(Ue[0],Ue[1],(0,K.useState)(!1)),Le=g()(Pe,2),Ae=Le[0],ze=Le[1],Oe=(0,K.useState)(),Re=g()(Oe,2),Ye=Re[0],qe=Re[1],Be=(0,K.useState)([]),Ke=g()(Be,2),Xe=Ke[0],Ne=Ke[1],Je=(0,K.useState)([]),Ve=g()(Je,2),He=Ve[0],Qe=Ve[1],We=z.Z.useModal(),Ge=g()(We,2),_e=(Ge[0],Ge[1]),$e=(0,K.useState)({}),et=g()($e,2),tt=et[0],at=et[1],rt=(0,K.useState)(0),nt=g()(rt,2),st=nt[0],ot=nt[1],it=function(){var e=p()(d()().mark((function e(t){var a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($){e.next=3;break}return ce("autoreply.keyword.permission.delete.denied","无权限：删除关键词回复"),e.abrupt("return");case 3:return console.log(t),e.next=6,j(t);case 6:a=e.sent,console.log("delete response:",a),200===a.code?(null==H||H.current.reload(),m.yw.success(S.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(S.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=p()(d()().mark((function e(){var t,a,r,n,s,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($){e.next=3;break}return ce("autoreply.keyword.permission.batchDelete.denied","无权限：批量删除关键词回复"),e.abrupt("return");case 3:if(0!==He.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:m.yw.loading(S.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,r=0,n=l()(He),e.prev=10,n.s();case 12:if((s=n.n()).done){e.next=26;break}return o=s.value,e.prev=14,e.next=17,j(o);case 17:200===e.sent.code?a++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:m.yw.destroy(),0===r?m.yw.success(S.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):m.yw.warning(S.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:r})),Ne([]),Qe([]),null===(t=H.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),ut=function(){var e=p()(d()().mark((function e(t){var a,r,n,s,o,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=3;break}return ce("autoreply.keyword.permission.update.denied","无权限：启用/禁用关键词回复"),e.abrupt("return");case 3:if(0!==He.length){e.next=6;break}return m.yw.warning(S.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 6:m.yw.loading(t?S.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):S.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),r=0,n=0,s=l()(He),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=26;break}return i=o.value,e.prev=14,e.next=17,T({uid:i.uid,enabled:t});case 17:200===e.sent.code?r++:n++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),n++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m.yw.destroy(),0===n?m.yw.success(t?S.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:r}):S.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:r})):m.yw.warning(t?S.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:r,fail:n}):S.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:r,fail:n})),Ne([]),Qe([]),null===(a=H.current)||void 0===a||a.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(t){return e.apply(this,arguments)}}(),dt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.keywordList",defaultMessage:"Keywords"}),dataIndex:"keywordList",copyable:!0,fixed:"left",width:200,ellipsis:!0,search:!0,tooltip:S.formatMessage({id:"autoreply.keyword.keywordList.tooltip",defaultMessage:"触发自动回复的关键词列表"}),render:function(e,t){return t.keywordList?(0,te.jsx)(O.Z,{wrap:!0,children:t.keywordList.map((function(e,t){return(0,te.jsx)(R.Z,{color:"blue",children:e},t)}))}):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.replyList",defaultMessage:"Replies"}),dataIndex:"replyList",copyable:!0,width:300,ellipsis:!0,search:!0,tooltip:S.formatMessage({id:"autoreply.keyword.replyList.tooltip",defaultMessage:"匹配关键词后的自动回复内容列表"}),render:function(e,t){return t.replyList?(0,te.jsx)(O.Z,{wrap:!0,children:t.replyList.map((function(e,t){return(0,te.jsx)(R.Z,{color:"green",children:e},t)}))}):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.matchType",defaultMessage:"Match Type"}),dataIndex:"matchType",width:120,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.matchType.tooltip",defaultMessage:"关键词匹配的方式"}),valueEnum:{EXACT:{text:S.formatMessage({id:"autoreply.matchType.exact",defaultMessage:"Exact"})},FUZZY:{text:S.formatMessage({id:"autoreply.matchType.contains",defaultMessage:"Contains"})}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.contentType",defaultMessage:"Content Type"}),dataIndex:"contentType",width:120,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.contentType.tooltip",defaultMessage:"回复内容的类型"}),render:function(e,t){return(0,oe.OI)(t.contentType)},valueEnum:{TEXT:{text:S.formatMessage({id:"autoreply.contentType.text",defaultMessage:"Text"})},IMAGE:{text:S.formatMessage({id:"autoreply.contentType.image",defaultMessage:"Image"})},VIDEO:{text:S.formatMessage({id:"autoreply.contentType.video",defaultMessage:"Video"})},FILE:{text:S.formatMessage({id:"autoreply.contentType.file",defaultMessage:"File"})}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:S.formatMessage({id:"autoreply.keyword.category.tooltip",defaultMessage:"关键词回复的分类"}),render:function(e,t){var a=Ee.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,te.jsx)(R.Z,{color:"blue",children:(null==a?void 0:a.label)||"-"})},filters:Ee.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.enabled",defaultMessage:"Status"}),dataIndex:"enabled",hideInSearch:!0,width:100,tooltip:S.formatMessage({id:"autoreply.keyword.enabled.tooltip",defaultMessage:"关键词回复是否启用"}),valueEnum:{true:{text:S.formatMessage({id:"common.enabled",defaultMessage:"Enabled"}),status:"Success"},false:{text:S.formatMessage({id:"common.disabled",defaultMessage:"Disabled"}),status:"Error"}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.isTransfer",defaultMessage:"Transfer"}),dataIndex:"isTransfer",width:100,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.isTransfer.tooltip",defaultMessage:"是否触发转人工服务"}),valueEnum:{true:{text:S.formatMessage({id:"common.yes",defaultMessage:"Yes"}),status:"Success"},false:{text:S.formatMessage({id:"common.no",defaultMessage:"No"}),status:"Default"}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.startDate",defaultMessage:"Start Date"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.startDate.tooltip",defaultMessage:"关键词回复生效的开始时间"}),render:function(e,t){return t.startDate?ee()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.endDate",defaultMessage:"End Date"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.endDate.tooltip",defaultMessage:"关键词回复失效的结束时间"}),render:function(e,t){return t.endDate?ee()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0,tooltip:S.formatMessage({id:"autoreply.keyword.updatedAt.tooltip",defaultMessage:"最后更新的时间"})},{title:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){var a;return(0,te.jsxs)(O.Z,{children:[_?(0,te.jsx)(Y.ZP,{type:"link",size:"small",onClick:function(){return pt(t)},children:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}):null,$?(0,te.jsx)(q.Z,{title:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),description:S.formatMessage({id:"pages.common.deleteConfirm"},{name:null===(a=t.keywordList)||void 0===a?void 0:a.join(", ")}),onConfirm:function(){return it(t)},okText:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.ok"}),cancelText:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.cancel"}),children:(0,te.jsx)(Y.ZP,{type:"link",danger:!0,size:"small",children:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.delete"})})}):null]})}}],ct=function(){G?(qe(void 0),me(!1),ve(!0)):ce("autoreply.keyword.permission.create.denied","无权限：新建关键词回复")},pt=function(e){_?(qe(e),me(!0),ve(!0)):ce("autoreply.keyword.permission.update.denied","无权限：编辑关键词回复")},ft=function(){var e=p()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),!ge||_){e.next=4;break}return ce("autoreply.keyword.permission.update.denied","无权限：编辑关键词回复"),e.abrupt("return");case 4:if(ge||G){e.next=7;break}return ce("autoreply.keyword.permission.create.denied","无权限：新建关键词回复"),e.abrupt("return");case 7:if(ge?(m.yw.loading(S.formatMessage({id:"updating"})),t.uid=null==Ye?void 0:Ye.uid):m.yw.loading(S.formatMessage({id:"creating"})),!ge){e.next=14;break}return e.next=11,w(t);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,M(t);case 16:e.t0=e.sent;case 17:a=e.t0,console.log("createKeyword response:",t,a),200===a.code?(m.yw.destroy(),m.yw.success(S.formatMessage({id:"create.success",defaultMessage:"create success"})),ve(!1),null===(r=H.current)||void 0===r||r.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gt=function(){var e=p()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return ce("autoreply.keyword.permission.import.denied","无权限：导入关键词回复"),e.abrupt("return");case 3:ze(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),mt=function(){var e=p()(d()().mark((function e(t,a,r){var n,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleExportExcel",t,a,r),ue){e.next=4;break}return ce("autoreply.keyword.permission.export.denied","无权限：导出关键词回复"),e.abrupt("return");case 4:n=localStorage.getItem(y.LA8),s=o()({categoryUid:(null==Fe?void 0:Fe.uid)===y.zBg?"":null==Fe?void 0:Fe.uid,kbUid:null==Ce?void 0:Ce.uid,orgUid:(null==Ze?void 0:Ze.uid)||"",accessToken:n||"",exportType:t},tt),"current"===t?(s.pageNumber=String(we-1),s.pageSize=String(Te)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,J.kG)()+"/api/v1/autoreply/keyword/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),yt=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return mt("range",r,a)}})},s=0;s<r;s++)n();return t};(0,K.useEffect)((function(){var e;null===(e=H.current)||void 0===e||e.reloadAndRest()}),[Ce,Fe]);var ht=function(){var e=p()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,se.HK)(y.WvL,null==Ze?void 0:Ze.uid,null==Ce?void 0:Ce.uid,y.whQ,{showLoading:!0,loadingMessage:S.formatMessage({id:"loading"}),errorMessage:S.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xt=$?{selectedRowKeys:Xe,onChange:function(e,t){Ne(e),Qe(t)}}:void 0;return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(A.Z,{columns:dt,actionRef:H,cardBordered:!0,rowSelection:xt,request:function(){var e=p()(d()().mark((function e(t,a,r){var s,i,l,u,c,p,f,g,h,v;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W){e.next=3;break}return de.current||(de.current=!0,ce("autoreply.keyword.permission.read.denied","无权限：查看关键词回复")),e.abrupt("return",{data:[],success:!0,total:0});case 3:return m.yw.loading(S.formatMessage({id:"loading",defaultMessage:"Loading"})),s=t.current,i=t.pageSize,l=n()(t,le),ke(s),De(i),at(l),u=void 0,c=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],u=p,c="ascend"===a[p]?"ascend":"descend"),f=k?void 0:(null==Fe?void 0:Fe.uid)===y.zBg?"":null==Fe?void 0:Fe.uid,g=k||null==Ce?void 0:Ce.uid,h=o()(o()({pageNumber:s-1,pageSize:i,categoryUid:f,kbUid:g,orgUid:null==Ze?void 0:Ze.uid,superUser:k},l),{},{sortBy:u,sortDirection:c}),e.next=16,x(h);case 16:return v=e.sent,console.log("getAllKeywords response:",h,v),m.yw.destroy(),200===v.code?ot(null==v?void 0:v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:null==v?void 0:v.data.content,success:!0,total:null==v?void 0:v.data.totalElements});case 21:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto",defaultCollapsed:!1},pagination:{pageSize:10,onChange:function(e,t){ke(e),De(t)}},dateFormatter:"string",headerTitle:D(null==Ce?void 0:Ce.name)+" - "+S.formatMessage({id:"menu.kbase.keyword",defaultMessage:"KEYWORD"}),tooltip:{title:"客服-》一对一-》高级设置-》自动回复",placement:"top"},toolBarRender:function(){return k?[]:[G?(0,te.jsx)(Y.ZP,{icon:(0,te.jsx)(C.Z,{}),type:"primary",onClick:ct,children:S.formatMessage({id:"create",defaultMessage:"Create"})},"create"):null,$&&Xe.length>0&&(0,te.jsx)(q.Z,{title:S.formatMessage({id:"batch.deleteTip"}),description:"".concat(S.formatMessage({id:"batch.deleteAffirm"})," ").concat(Xe.length," ").concat(S.formatMessage({id:"items"}),"?"),onConfirm:lt,okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"}),children:(0,te.jsxs)(Y.ZP,{danger:!0,icon:(0,te.jsx)(F.Z,{}),children:[S.formatMessage({id:"batch.delete"})," (",Xe.length,")"]})},"batchDelete"),_&&Xe.length>0&&(0,te.jsxs)(Y.ZP,{type:"primary",icon:(0,te.jsx)(E.Z,{}),onClick:function(){return ut(!0)},children:[S.formatMessage({id:"batch.enable",defaultMessage:"Enable"})," (",Xe.length,")"]},"batchEnable"),_&&Xe.length>0&&(0,te.jsxs)(Y.ZP,{danger:!0,icon:(0,te.jsx)(I.Z,{}),onClick:function(){return ut(!1)},children:[S.formatMessage({id:"batch.disable",defaultMessage:"Disable"})," (",Xe.length,")"]},"batchDisable"),G?(0,te.jsx)(Y.ZP,{icon:(0,te.jsx)(U.Z,{}),type:"primary",onClick:gt,children:S.formatMessage({id:"import",defaultMessage:"Import"})},"import"):null,ue?(0,te.jsx)(B.Z,{menu:{items:(e=[{key:"export-current",label:S.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return mt("current")}}],st>0&&(st<=1e3?e.push({key:"export-all",label:S.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(st,"条)"),onClick:function(){return mt("all")}}):e.push({key:"export-range",label:S.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(st,"条)"),children:yt(st)})),e.push({key:"download",label:S.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,J.zw)()}}),e)},placement:"bottomRight",children:(0,te.jsxs)(Y.ZP,{type:"primary",icon:(0,te.jsx)(P.Z,{}),children:[S.formatMessage({id:"export",defaultMessage:"Export"}),(0,te.jsx)(L.Z,{})]})},"exportDropdown"):null].filter(Boolean);var e}}),xe&&(0,te.jsx)(ae,{isEdit:ge,open:xe,keyword:Ye,onClose:function(){return ve(!1)},onSubmit:ft}),Ae&&(0,te.jsx)(re.Z,{type:y.ibP,acceptType:".xlsx,.xls,.csv",isModalOpen:Ae,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),ze(!1),null==H||H.current.reload(),ht()},handleCancel:function(){console.log("handleUploadDragCancel"),ze(!1),null==H||H.current.reload()}}),_e]})}}}]);