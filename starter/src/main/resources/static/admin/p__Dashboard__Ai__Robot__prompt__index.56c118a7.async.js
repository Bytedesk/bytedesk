"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7674],{17455:function(e,t,r){var a=r(80627),s=r(93683),n=r(68422),o=r(44194),i=r(84729),l=r(69983),u=r(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var r=e.fieldProps,c=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,M=e.showSearch,h=e.options,x=(0,s.Z)(e,d),y=(0,o.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,n.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:h,mode:m,showSearch:M,getPopupContainer:y.getPopupContainer},r),ref:t,proFieldProps:f},x),{},{children:c}))},f=o.forwardRef((function(e,t){var r=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,M=e.options,h=(0,s.Z)(e,c),x=(0,a.Z)({options:M,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),y=(0,o.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,n.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:y.getPopupContainer},x),ref:t,proFieldProps:f},h),{},{children:d}))})),m=o.forwardRef(p);m.SearchSelect=f,m.displayName="ProFormComponent",t.Z=m},74056:function(e,t,r){var a=r(80627),s=r(93683),n=r(44194),o=r(69983),i=r(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=n.forwardRef((function(e,t){var r=e.fieldProps,n=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,s.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:n,checkedChildren:u},r),ref:t,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=u},67186:function(e,t,r){var a=r(29552),s=r(80627),n=r(93683),o=r(92032),i=r(69159),l=r(43928),u=r(21762),d=r(44194),c=r(69983),p=r(31549),f=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",v=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,a.Z)(t,2),n=r[0],u=r[1];return(0,p.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,a=t.getFieldValue(e.name||[]);return(0,p.jsx)(l.Z,(0,s.Z)((0,s.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,a),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:n,children:e.children}))}})},M=function(e){var t=e.fieldProps,r=e.proFieldProps,a=(0,n.Z)(e,f);return(0,p.jsx)(c.Z,(0,s.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:r},a))};M.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,o=(0,n.Z)(e,m),i=(0,d.useState)(!1),l=(0,a.Z)(i,2),f=l[0],M=l[1];return null!=t&&t.statusRender&&o.name?(0,p.jsx)(v,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:f,onOpenChange:M,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,s.Z)({valueType:"password",fieldProps:(0,s.Z)((0,s.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),M(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),M(!0)}}),proFieldProps:r,filedConfig:{valueType:g}},o))})}):(0,p.jsx)(c.Z,(0,s.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:g}},o))},M.displayName="ProFormComponent",t.Z=M},83788:function(e,t,r){var a=r(80627),s=r(93683),n=r(44194),o=r(69983),i=r(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var r=e.fieldProps,n=e.proFieldProps,u=(0,s.Z)(e,l);return(0,i.jsx)(o.Z,(0,a.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:n},u))};t.Z=n.forwardRef(u)},88674:function(e,t,r){r.d(t,{$2:function(){return Z},$j:function(){return M},Fh:function(){return f},Fu:function(){return g},OW:function(){return x},WD:function(){return c},uy:function(){return j},vF:function(){return w}});var a=r(90819),s=r.n(a),n=r(73193),o=r.n(n),i=r(89933),l=r.n(i),u=r(27353),d=r(2290);function c(e){return p.apply(this,arguments)}function p(){return(p=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return h.apply(this,arguments)}function h(){return(h=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/score",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/optimize",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/reset",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){return P.apply(this,arguments)}function P(){return(P=l()(s()().mark((function e(t,r){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/prompt/reset/".concat(t),{method:"POST",data:o()(o()({},r||{}),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},84966:function(e,t,r){r.r(t),r.d(t,{default:function(){return X}});var a=r(73193),s=r.n(a),n=r(84176),o=r.n(n),i=r(90819),l=r.n(i),u=r(89933),d=r.n(u),c=r(45332),p=r.n(c),f=r(44194),m=r(2290),g=r(77601),v=r(38623),M=r(70937),h=r(90883),x=r(50884),y=r(28520),w=r(27318),b=r(97765),j=r(88674),k=r(19058),Z=r(46206),P=r(97588),C=r(67186),S=r(17455),T=r(74056),R=r(83788),O=r(31549),E=function(e){return{userPrompt:null==e?void 0:e.userPrompt,variables:null==e?void 0:e.variables,tags:null==e?void 0:e.tags,metadata:null==e?void 0:e.metadata}},z=function(e){var t=e.open,r=e.mode,a=e.initialValues,n=e.onCancel,o=e.onSubmit,i=(0,m.useIntl)(),u=(0,f.useRef)(null);(0,f.useEffect)((function(){var e,r;t?null===(e=u.current)||void 0===e||e.setFieldsValue({uid:null==a?void 0:a.uid,name:null==a?void 0:a.name,nickname:null==a?void 0:a.nickname,description:null==a?void 0:a.description,type:(null==a?void 0:a.type)||"GENERAL",enabled:"boolean"!=typeof(null==a?void 0:a.enabled)||a.enabled,language:(null==a?void 0:a.language)||"ZH_CN",systemPrompt:null==a?void 0:a.systemPrompt}):null===(r=u.current)||void 0===r||r.resetFields()}),[t,a]);var c="create"===r?i.formatMessage({id:"prompt.create",defaultMessage:"新建提示词"}):i.formatMessage({id:"prompt.edit",defaultMessage:"编辑提示词"});return(0,O.jsx)(k.Z,{open:t,title:c,onClose:n,width:600,destroyOnHidden:!0,extra:(0,O.jsxs)(Z.Z,{children:[(0,O.jsx)(h.ZP,{onClick:function(){var e;null===(e=u.current)||void 0===e||e.resetFields()},children:i.formatMessage({id:"common.reset",defaultMessage:"重置"})}),(0,O.jsx)(h.ZP,{onClick:n,children:i.formatMessage({id:"common.cancel",defaultMessage:"取消"})}),(0,O.jsx)(h.ZP,{type:"primary",onClick:function(){var e;null===(e=u.current)||void 0===e||e.submit()},children:i.formatMessage({id:"common.confirm",defaultMessage:"确认"})})]}),children:(0,O.jsxs)(P.A,{formRef:u,layout:"vertical",onFinish:function(){var e=d()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="edit"===r?s()(s()({},E(a)),t):t,e.next=3,o(n);case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submitter:!1,children:[(0,O.jsx)(C.Z,{name:"uid",hidden:!0}),(0,O.jsx)(C.Z,{name:"name",label:i.formatMessage({id:"name",defaultMessage:"名称"}),rules:[{required:!0,message:i.formatMessage({id:"name.required",defaultMessage:"请输入名称"})}],fieldProps:{maxLength:128}}),(0,O.jsx)(C.Z,{name:"nickname",label:i.formatMessage({id:"nickname",defaultMessage:"昵称"}),fieldProps:{maxLength:128}}),(0,O.jsx)(S.Z,{name:"type",label:i.formatMessage({id:"type",defaultMessage:"类型"}),rules:[{required:!0,message:i.formatMessage({id:"type.required",defaultMessage:"请选择类型"})}],options:[{value:"GENERAL",label:i.formatMessage({id:"prompt.type.general",defaultMessage:"通用"})},{value:"THREAD_SUMMARY",label:i.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"会话总结"})},{value:"THREAD_INTENTION",label:i.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"会话意图"})},{value:"THREAD_EMOTION",label:i.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"会话情绪"})},{value:"CUSTOMER_PROFILE",label:i.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"客户画像"})},{value:"TICKET_ASSIST",label:i.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"工单辅助"})},{value:"THREAD",label:i.formatMessage({id:"prompt.type.legacy.thread",defaultMessage:"（旧）THREAD"})},{value:"CUSTOMER",label:i.formatMessage({id:"prompt.type.legacy.customer",defaultMessage:"（旧）CUSTOMER"})},{value:"TICKET",label:i.formatMessage({id:"prompt.type.legacy.ticket",defaultMessage:"（旧）TICKET"})}]}),(0,O.jsx)(T.Z,{name:"enabled",label:i.formatMessage({id:"enabled",defaultMessage:"启用"})}),(0,O.jsx)(C.Z,{name:"description",label:i.formatMessage({id:"description",defaultMessage:"描述"}),fieldProps:{maxLength:512}}),(0,O.jsx)(S.Z,{name:"language",label:i.formatMessage({id:"language",defaultMessage:"语言"}),showSearch:!0,options:[{value:"ZH_CN",label:i.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"简体中文(ZH_CN)"})},{value:"EN",label:i.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"})},{value:"ZH_TW",label:i.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"繁體中文(ZH_TW)"})}]}),(0,O.jsx)(R.Z,{name:"systemPrompt",label:i.formatMessage({id:"prompt.system",defaultMessage:"系统提示词"}),fieldProps:{rows:6}})]})})},N=r(35746),F=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},U=function(e){var t=e.open,r=e.record,a=e.orgUid,s=e.canUpdate,n=e.autoRunAction,o=void 0===n?null:n,i=e.onAutoRunConsumed,u=e.onClose,c=e.onReload,g=(0,m.useIntl)(),v=(0,f.useState)(r),y=p()(v,2),w=y[0],b=y[1],k=(0,f.useState)(null),Z=p()(k,2),P=Z[0],C=Z[1],S=(0,f.useState)(null),T=p()(S,2),R=T[0],E=T[1];(0,f.useEffect)((function(){b(r),C((null==r?void 0:r.scoreObject)||F(null==r?void 0:r.scoreResult)),E((null==r?void 0:r.optimizeObject)||F(null==r?void 0:r.optimizationMetadata))}),[r]);var z=null==w?void 0:w.uid,U=(0,f.useMemo)((function(){return(null==w?void 0:w.language)||"ZH_CN"}),[null==w?void 0:w.language]),I=function(){var e=d()(l()().mark((function e(){var t,r,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,x.yw.loading(g.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=6,(0,j.OW)({uid:z,orgUid:a});case 6:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(g.formatMessage({id:"success",defaultMessage:"评分成功"})),b(null==t?void 0:t.data),C((null==t||null===(r=t.data)||void 0===r?void 0:r.scoreObject)||F(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),null==c||c()):x.yw.error((null==t?void 0:t.message)||g.formatMessage({id:"failed",defaultMessage:"评分失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),x.yw.error(g.formatMessage({id:"error",defaultMessage:"请求出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=d()(l()().mark((function e(){var t,r,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,x.yw.loading(g.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=6,(0,j.vF)({uid:z,orgUid:a});case 6:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(g.formatMessage({id:"success",defaultMessage:"优化成功"})),b(null==t?void 0:t.data),E((null==t||null===(r=t.data)||void 0===r?void 0:r.optimizeObject)||F(null==t||null===(s=t.data)||void 0===s?void 0:s.optimizationMetadata)),null==c||c()):x.yw.error((null==t?void 0:t.message)||g.formatMessage({id:"failed",defaultMessage:"优化失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),x.yw.error(g.formatMessage({id:"error",defaultMessage:"请求出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=d()(l()().mark((function e(){var t,r,s,n,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,x.yw.loading(g.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=6,(0,j.$2)(z,{orgUid:a});case 6:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(g.formatMessage({id:"success",defaultMessage:"重置成功"})),b(null==t?void 0:t.data),C((null==t||null===(r=t.data)||void 0===r?void 0:r.scoreObject)||F(null==t||null===(s=t.data)||void 0===s?void 0:s.scoreResult)),E((null==t||null===(n=t.data)||void 0===n?void 0:n.optimizeObject)||F(null==t||null===(o=t.data)||void 0===o?void 0:o.optimizationMetadata)),null==c||c()):x.yw.error((null==t?void 0:t.message)||g.formatMessage({id:"failed",defaultMessage:"重置失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),x.yw.error(g.formatMessage({id:"error",defaultMessage:"请求出错"}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){t&&z&&o&&d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("score"!==o){e.next=5;break}return e.next=3,I();case 3:e.next=8;break;case 5:if("optimize"!==o){e.next=8;break}return e.next=8,H();case 8:null==i||i();case 9:case"end":return e.stop()}}),e)})))()}),[t,z,o]),(0,O.jsx)(N.Z,{title:g.formatMessage({id:"prompt.detail",defaultMessage:"提示词详情"}),open:t,onCancel:u,width:900,footer:w?[(0,O.jsx)(M.Z,{title:g.formatMessage({id:"prompt.reset.confirm",defaultMessage:"确认重置为系统默认提示词？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：重置提示词"})),e.abrupt("return");case 3:return e.next=5,A();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{danger:!0,children:g.formatMessage({id:"prompt.reset.default",defaultMessage:"重置默认"})})},"detailReset"),(0,O.jsx)(M.Z,{title:g.formatMessage({id:"prompt.score.confirm",defaultMessage:"确认对该提示词进行评分？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：评分提示词"})),e.abrupt("return");case 3:return e.next=5,I();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{children:g.formatMessage({id:"prompt.score",defaultMessage:"评分"})})},"detailScore"),(0,O.jsx)(M.Z,{title:g.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"确认对该提示词进行优化？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：优化提示词"})),e.abrupt("return");case 3:return e.next=5,H();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{type:"primary",children:g.formatMessage({id:"prompt.optimize",defaultMessage:"优化"})})},"detailOptimize"),(0,O.jsx)(h.ZP,{onClick:u,children:g.formatMessage({id:"close",defaultMessage:"关闭"})},"close")]:[(0,O.jsx)(h.ZP,{onClick:u,children:g.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:w?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{style:{marginBottom:12},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"name",defaultMessage:"名称"}),"："]})," ",w.name||"-",(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"nickname",defaultMessage:"昵称"}),"："]})," ",w.nickname||"-"]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"language",defaultMessage:"语言"}),"："]})," ",U]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"type",defaultMessage:"类型"}),"："]})," ",w.type||"-"]})]}),(0,O.jsxs)("div",{style:{marginBottom:16},children:[(0,O.jsx)("h4",{children:g.formatMessage({id:"prompt.system",defaultMessage:"系统提示词"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:w.systemPrompt||""})]}),(0,O.jsxs)("div",{style:{marginBottom:16},children:[(0,O.jsx)("h4",{children:g.formatMessage({id:"prompt.score.result",defaultMessage:"评分结果"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:P?JSON.stringify(P,null,2):"暂无结果"})]}),(0,O.jsxs)("div",{style:{marginBottom:8},children:[(0,O.jsx)("h4",{children:g.formatMessage({id:"prompt.optimize.result",defaultMessage:"优化结果"})}),(0,O.jsxs)("div",{style:{marginBottom:8},children:[(0,O.jsx)("b",{children:g.formatMessage({id:"prompt.optimized.prompt",defaultMessage:"优化后的提示词"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:180,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:w.optimizedPrompt||""})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("b",{children:g.formatMessage({id:"prompt.optimization.metadata",defaultMessage:"优化元数据"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:180,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:R?JSON.stringify(R,null,2):"暂无结果"})]})]})]}):(0,O.jsx)("div",{children:g.formatMessage({id:"empty",defaultMessage:"暂无数据"})})})},I=r(88547),H=r(70674),A=r(30235),_=r(64724),q=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},B=function(e){var t,r,a=e.open,s=e.record,n=e.orgUid,o=e.canUpdate,i=e.autoRunScore,u=void 0!==i&&i,c=e.onAutoRunConsumed,g=e.onClose,y=e.onReload,w=(0,m.useIntl)(),b=(0,f.useState)(s),P=p()(b,2),C=P[0],S=P[1],T=(0,f.useState)(null),R=p()(T,2),E=R[0],z=R[1];(0,f.useEffect)((function(){S(s),z((null==s?void 0:s.scoreObject)||q(null==s?void 0:s.scoreResult))}),[s]);var N=null==C?void 0:C.uid,F=(0,f.useMemo)((function(){var e,t;return n||(null==C?void 0:C.orgUid)||(null==s?void 0:s.orgUid)||(null==C||null===(e=C.org)||void 0===e?void 0:e.uid)||(null==s||null===(t=s.org)||void 0===t?void 0:t.uid)}),[n,C,s]),U=(0,f.useMemo)((function(){return(null==C?void 0:C.language)||"ZH_CN"}),[null==C?void 0:C.language]),B=function(){var e=d()(l()().mark((function e(){var t,r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:if(F){e.next=5;break}return x.yw.warning(w.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 5:return e.prev=5,x.yw.loading(w.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=9,(0,j.OW)({uid:N,orgUid:F});case 9:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(w.formatMessage({id:"success",defaultMessage:"评分成功"})),S(null==t?void 0:t.data),z((null==t||null===(r=t.data)||void 0===r?void 0:r.scoreObject)||q(null==t||null===(a=t.data)||void 0===a?void 0:a.scoreResult)),null==y||y()):x.yw.error((null==t?void 0:t.message)||w.formatMessage({id:"failed",defaultMessage:"评分失败"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),x.yw.error(w.formatMessage({id:"error",defaultMessage:"请求出错"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=d()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:if(F){e.next=5;break}return x.yw.warning(w.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 5:return e.prev=5,x.yw.loading(w.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=9,(0,j.vF)({uid:N,orgUid:F});case 9:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(w.formatMessage({id:"success",defaultMessage:"优化成功"})),S(null==t?void 0:t.data),null==y||y()):x.yw.error((null==t?void 0:t.message)||w.formatMessage({id:"failed",defaultMessage:"优化失败"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),x.yw.error(w.formatMessage({id:"error",defaultMessage:"请求出错"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=d()(l()().mark((function e(){var t,r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:if(F){e.next=5;break}return x.yw.warning(w.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 5:return e.prev=5,x.yw.loading(w.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=9,(0,j.$2)(N,{orgUid:F});case 9:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(w.formatMessage({id:"success",defaultMessage:"重置成功"})),S(null==t?void 0:t.data),z((null==t||null===(r=t.data)||void 0===r?void 0:r.scoreObject)||q(null==t||null===(a=t.data)||void 0===a?void 0:a.scoreResult)),null==y||y()):x.yw.error((null==t?void 0:t.message)||w.formatMessage({id:"failed",defaultMessage:"重置失败"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),x.yw.error(w.formatMessage({id:"error",defaultMessage:"请求出错"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){a&&N&&u&&o&&d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:null==c||c();case 3:case"end":return e.stop()}}),e)})))()}),[a,N,u,o]);var J=(0,f.useMemo)((function(){var e=null==E?void 0:E.score;if("number"==typeof e&&!Number.isNaN(e))return e<=1?Math.max(0,Math.min(100,Math.round(100*e))):e<=10?Math.max(0,Math.min(100,Math.round(10*e))):Math.max(0,Math.min(100,Math.round(e)))}),[null==E?void 0:E.score]);return(0,O.jsx)(k.Z,{open:a,title:w.formatMessage({id:"prompt.score.result",defaultMessage:"评分结果"}),width:660,onClose:g,destroyOnHidden:!0,extra:(0,O.jsxs)(Z.Z,{children:[(0,O.jsx)(M.Z,{title:w.formatMessage({id:"prompt.reset.confirm",defaultMessage:"确认重置为系统默认提示词？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=3;break}return x.yw.warning(w.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：重置提示词"})),e.abrupt("return");case 3:return e.next=5,W();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{danger:!0,disabled:!C||!o,children:w.formatMessage({id:"prompt.reset.default",defaultMessage:"重置默认"})})}),(0,O.jsx)(M.Z,{title:w.formatMessage({id:"prompt.score.confirm",defaultMessage:"确认对该提示词进行评分？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=3;break}return x.yw.warning(w.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：评分提示词"})),e.abrupt("return");case 3:return e.next=5,B();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{disabled:!C||!o,children:w.formatMessage({id:"prompt.score",defaultMessage:"评分"})})}),(0,O.jsx)(M.Z,{title:w.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"确认对该提示词进行优化？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=3;break}return x.yw.warning(w.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：优化提示词"})),e.abrupt("return");case 3:return e.next=5,L();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{type:"primary",disabled:!C||!o,children:w.formatMessage({id:"prompt.optimize",defaultMessage:"优化"})})}),(0,O.jsx)(h.ZP,{onClick:g,children:w.formatMessage({id:"close",defaultMessage:"关闭"})})]}),children:C?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{style:{marginBottom:12},children:[(0,O.jsxs)("b",{children:[w.formatMessage({id:"name",defaultMessage:"名称"}),"："]})," ",C.name||"-",(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[w.formatMessage({id:"nickname",defaultMessage:"昵称"}),"："]})," ",C.nickname||"-"]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[w.formatMessage({id:"language",defaultMessage:"语言"}),"："]})," ",U]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[w.formatMessage({id:"type",defaultMessage:"类型"}),"："]})," ",C.type||"-"]})]}),(0,O.jsxs)("div",{style:{marginBottom:16},children:[(0,O.jsx)("h4",{children:w.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:C.systemPrompt||""})]}),(0,O.jsxs)("div",{style:{marginBottom:16},children:[(0,O.jsx)("h4",{children:w.formatMessage({id:"prompt.score.result",defaultMessage:"评分结果"})}),E?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(I.Z,{bordered:!0,size:"small",column:1,children:[(0,O.jsx)(I.Z.Item,{label:w.formatMessage({id:"prompt.score",defaultMessage:"评分"}),children:(0,O.jsxs)(Z.Z,{children:[(0,O.jsx)("span",{children:"number"==typeof E.score?E.score:"-"}),"number"==typeof J?(0,O.jsx)(H.Z,{percent:J,size:"small",style:{width:220}}):null]})}),(0,O.jsx)(I.Z.Item,{label:w.formatMessage({id:"grade",defaultMessage:"等级"}),children:E.grade?(0,O.jsx)(v.Z,{color:"blue",children:E.grade}):"-"})]}),(0,O.jsx)(A.Z,{style:{margin:"12px 0"}}),(0,O.jsxs)(I.Z,{bordered:!0,size:"small",column:1,children:[(0,O.jsx)(I.Z.Item,{label:w.formatMessage({id:"prompt.strengths",defaultMessage:"优点"}),children:null!==(t=E.strengths)&&void 0!==t&&t.length?(0,O.jsx)(Z.Z,{direction:"vertical",size:4,children:E.strengths.map((function(e,t){return(0,O.jsx)("div",{children:e},"".concat(t,"-").concat(e))}))}):"-"}),(0,O.jsx)(I.Z.Item,{label:w.formatMessage({id:"prompt.weaknesses",defaultMessage:"缺点"}),children:null!==(r=E.weaknesses)&&void 0!==r&&r.length?(0,O.jsx)(Z.Z,{direction:"vertical",size:4,children:E.weaknesses.map((function(e,t){return(0,O.jsx)("div",{children:e},"".concat(t,"-").concat(e))}))}):"-"}),(0,O.jsx)(I.Z.Item,{label:w.formatMessage({id:"prompt.suggestions",defaultMessage:"建议"}),children:(0,O.jsx)(_.Z.Paragraph,{style:{marginBottom:0,whiteSpace:"pre-wrap"},children:E.suggestions||"-"})})]})]}):(0,O.jsx)("div",{children:w.formatMessage({id:"empty",defaultMessage:"暂无数据"})})]})]}):(0,O.jsx)("div",{children:w.formatMessage({id:"empty",defaultMessage:"暂无数据"})})})},L=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},W=function(e){var t=e.open,r=e.record,a=e.orgUid,s=e.canUpdate,n=e.autoRunOptimize,o=void 0!==n&&n,i=e.onAutoRunConsumed,u=e.onClose,c=e.onReload,g=(0,m.useIntl)(),v=(0,f.useState)(r),y=p()(v,2),w=y[0],b=y[1],P=(0,f.useState)(null),C=p()(P,2),S=C[0],T=C[1];(0,f.useEffect)((function(){b(r),T((null==r?void 0:r.optimizeObject)||L(null==r?void 0:r.optimizationMetadata))}),[r]);var R=null==w?void 0:w.uid,E=(0,f.useMemo)((function(){var e,t;return a||(null==w?void 0:w.orgUid)||(null==r?void 0:r.orgUid)||(null==w||null===(e=w.org)||void 0===e?void 0:e.uid)||(null==r||null===(t=r.org)||void 0===t?void 0:t.uid)}),[a,w,r]),z=(0,f.useMemo)((function(){return(null==w?void 0:w.language)||"ZH_CN"}),[null==w?void 0:w.language]),N=function(){var e=d()(l()().mark((function e(){var t,r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R){e.next=2;break}return e.abrupt("return");case 2:if(E){e.next=5;break}return x.yw.warning(g.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 5:return e.prev=5,x.yw.loading(g.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=9,(0,j.vF)({uid:R,orgUid:E});case 9:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(g.formatMessage({id:"success",defaultMessage:"优化成功"})),b(null==t?void 0:t.data),T((null==t||null===(r=t.data)||void 0===r?void 0:r.optimizeObject)||L(null==t||null===(a=t.data)||void 0===a?void 0:a.optimizationMetadata)),null==c||c()):x.yw.error((null==t?void 0:t.message)||g.formatMessage({id:"failed",defaultMessage:"优化失败"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),x.yw.error(g.formatMessage({id:"error",defaultMessage:"请求出错"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=d()(l()().mark((function e(){var t,r,a,s,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R){e.next=2;break}return e.abrupt("return");case 2:if(E){e.next=5;break}return x.yw.warning(g.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 5:if(t=null==w?void 0:w.optimizedPrompt){e.next=9;break}return x.yw.warning(g.formatMessage({id:"empty",defaultMessage:"暂无数据"})),e.abrupt("return");case 9:return e.prev=9,x.yw.loading(g.formatMessage({id:"loading",defaultMessage:"正在处理..."})),r={uid:R,orgUid:E,name:null==w?void 0:w.name,nickname:null==w?void 0:w.nickname,description:null==w?void 0:w.description,type:null==w?void 0:w.type,enabled:null==w?void 0:w.enabled,language:null==w?void 0:w.language,systemPrompt:t,userPrompt:null==w?void 0:w.userPrompt,variables:null==w?void 0:w.variables,tags:null==w?void 0:w.tags,metadata:null==w?void 0:w.metadata},e.next=14,(0,j.Fu)(r);case 14:200===(null==(a=e.sent)?void 0:a.code)?(x.yw.success(g.formatMessage({id:"update.success",defaultMessage:"更新成功"})),b(null==a?void 0:a.data),T((null==a||null===(s=a.data)||void 0===s?void 0:s.optimizeObject)||L(null==a||null===(n=a.data)||void 0===n?void 0:n.optimizationMetadata)),null==c||c()):x.yw.error((null==a?void 0:a.message)||g.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),x.yw.error(g.formatMessage({id:"error",defaultMessage:"请求出错"}));case 21:case"end":return e.stop()}}),e,null,[[9,18]])})));return function(){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){t&&R&&o&&s&&d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:null==i||i();case 3:case"end":return e.stop()}}),e)})))()}),[t,R,o,s]),(0,O.jsx)(k.Z,{open:t,title:g.formatMessage({id:"prompt.optimize.result",defaultMessage:"优化结果"}),width:660,onClose:u,destroyOnHidden:!0,extra:(0,O.jsxs)(Z.Z,{children:[(0,O.jsx)(M.Z,{title:g.formatMessage({id:"prompt.optimize.confirm",defaultMessage:"确认对该提示词进行优化？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：优化提示词"})),e.abrupt("return");case 3:return e.next=5,N();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{disabled:!w||!s,children:g.formatMessage({id:"prompt.optimize",defaultMessage:"优化"})})}),(0,O.jsx)(M.Z,{title:g.formatMessage({id:"prompt.apply.optimized.confirm",defaultMessage:"确认将优化后的提示词覆盖到系统提示词？"}),onConfirm:d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：编辑提示词"})),e.abrupt("return");case 3:return e.next=5,F();case 5:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)(h.ZP,{type:"primary",disabled:!w||!(null!=w&&w.optimizedPrompt)||!s,children:g.formatMessage({id:"prompt.apply.optimized",defaultMessage:"一键更新到系统提示词"})})}),(0,O.jsx)(h.ZP,{onClick:u,children:g.formatMessage({id:"close",defaultMessage:"关闭"})})]}),children:w?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{style:{marginBottom:12},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"name",defaultMessage:"名称"}),"："]})," ",w.name||"-",(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"nickname",defaultMessage:"昵称"}),"："]})," ",w.nickname||"-"]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"language",defaultMessage:"语言"}),"："]})," ",z]}),(0,O.jsxs)("span",{style:{marginLeft:16},children:[(0,O.jsxs)("b",{children:[g.formatMessage({id:"type",defaultMessage:"类型"}),"："]})," ",w.type||"-"]})]}),(0,O.jsxs)("div",{style:{marginBottom:16},children:[(0,O.jsx)("h4",{children:g.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:220,overflow:"auto"},children:w.systemPrompt||""})]}),(0,O.jsxs)("div",{style:{marginBottom:8},children:[(0,O.jsx)("h4",{children:g.formatMessage({id:"prompt.optimize.result",defaultMessage:"优化结果"})}),(0,O.jsxs)("div",{style:{marginBottom:8},children:[(0,O.jsx)("b",{children:g.formatMessage({id:"prompt.optimized.prompt",defaultMessage:"优化后的提示词"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:260,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:w.optimizedPrompt||""})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("b",{children:g.formatMessage({id:"prompt.optimization.metadata",defaultMessage:"优化元数据"})}),(0,O.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:260,overflow:"auto",backgroundColor:"#f5f5f5",padding:8},children:S?JSON.stringify(S,null,2):"暂无结果"})]})]})]}):(0,O.jsx)("div",{children:g.formatMessage({id:"empty",defaultMessage:"暂无数据"})})})},J=function(e){var t=e.open,r=e.record,a=e.orgUid,s=e.canUpdate,n=e.value,o=e.onClose,i=e.onSaved,u=(0,m.useIntl)(),c=(0,f.useState)(n||(null==r?void 0:r.systemPrompt)||""),g=p()(c,2),v=g[0],M=g[1],y=(0,f.useMemo)((function(){var e;return a||(null==r?void 0:r.orgUid)||(null==r||null===(e=r.org)||void 0===e?void 0:e.uid)}),[a,r]);(0,f.useEffect)((function(){var e;M(null!==(e=null!=n?n:null==r?void 0:r.systemPrompt)&&void 0!==e?e:"")}),[t,n,null==r?void 0:r.uid]);var w=function(){var e=d()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(v||"");case 3:x.yw.success(u.formatMessage({id:"copy.success",defaultMessage:"复制成功"})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),x.yw.error(u.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=d()(l()().mark((function e(){var t,a,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return null==o||o(),e.abrupt("return");case 3:if(s){e.next=6;break}return x.yw.warning(u.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：编辑提示词"})),e.abrupt("return");case 6:if(y){e.next=9;break}return x.yw.warning(u.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 9:return e.prev=9,x.yw.loading(u.formatMessage({id:"saving",defaultMessage:"Saving..."})),a={uid:(t=r).uid,orgUid:y,name:t.name,nickname:null==t?void 0:t.nickname,description:t.description,type:t.type,enabled:t.enabled,language:null==t?void 0:t.language,systemPrompt:v,userPrompt:null==t?void 0:t.userPrompt,variables:null==t?void 0:t.variables,tags:null==t?void 0:t.tags,metadata:null==t?void 0:t.metadata},e.next=15,(0,j.Fu)(a);case 15:n=e.sent,b.Z.debug("PromptSystemPromptModal handleSave updated systemPrompt:",n,a),x.yw.destroy(),200===(null==n?void 0:n.code)?(x.yw.success(u.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==i||i()):x.yw.error((null==n?void 0:n.message)||u.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(9),x.yw.destroy(),x.yw.error(u.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 25:case"end":return e.stop()}}),e,null,[[9,21]])})));return function(){return e.apply(this,arguments)}}();return(0,O.jsx)(N.Z,{open:t,title:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),onCancel:o,footer:[(0,O.jsx)(h.ZP,{onClick:w,children:u.formatMessage({id:"copy",defaultMessage:"复制"})},"copy"),(0,O.jsx)(h.ZP,{type:"primary",onClick:k,disabled:!r||!s,children:u.formatMessage({id:"save",defaultMessage:"保存"})},"save"),(0,O.jsx)(h.ZP,{onClick:o,children:u.formatMessage({id:"close",defaultMessage:"关闭"})},"close")],children:(0,O.jsx)("div",{children:(0,O.jsx)("textarea",{value:v,onChange:function(e){return M(e.target.value)},style:{width:"100%",minHeight:240,maxHeight:480,padding:8,resize:"vertical"},placeholder:u.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"})})})})},D=["current","pageSize"],X=function(){var e,t,r,a,n,i,u,c,k=(0,m.useIntl)(),Z=(0,m.useAccess)(),P=(0,f.useRef)(),C=(0,y.u)((function(e){return e.currentOrg})),S={GENERAL:{text:k.formatMessage({id:"prompt.type.general",defaultMessage:"通用"})},THREAD_SUMMARY:{text:k.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"会话总结"})},THREAD_INTENTION:{text:k.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"会话意图"})},THREAD_EMOTION:{text:k.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"会话情绪"})},CUSTOMER_PROFILE:{text:k.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"客户画像"})},TICKET_ASSIST:{text:k.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"工单辅助"})}},T={ZH_CN:{text:k.formatMessage({id:"prompt.language.ZH_CN",defaultMessage:"简体中文(ZH_CN)"})},EN:{text:k.formatMessage({id:"prompt.language.EN",defaultMessage:"English (EN)"})},ZH_TW:{text:k.formatMessage({id:"prompt.language.ZH_TW",defaultMessage:"繁體中文(ZH_TW)"})}},R=(0,f.useMemo)((function(){var e;return null==Z||null===(e=Z.getModulePermission)||void 0===e?void 0:e.call(Z,w.MY.PROMPT)}),[Z]),E=null!==(e=null==R||null===(t=R.canRead)||void 0===t?void 0:t.call(R))&&void 0!==e&&e,N=null!==(r=null==R||null===(a=R.canCreate)||void 0===a?void 0:a.call(R))&&void 0!==r&&r,F=null!==(n=null==R||null===(i=R.canUpdate)||void 0===i?void 0:i.call(R))&&void 0!==n&&n,I=null!==(u=null==R||null===(c=R.canDelete)||void 0===c?void 0:c.call(R))&&void 0!==u&&u,H=(0,f.useState)(!1),A=p()(H,2),_=A[0],q=A[1],L=(0,f.useState)("create"),X=p()(L,2),V=X[0],$=X[1],K=(0,f.useState)(void 0),G=p()(K,2),Y=G[0],Q=G[1],ee=(0,f.useState)(!1),te=p()(ee,2),re=te[0],ae=te[1],se=(0,f.useState)(void 0),ne=p()(se,2),oe=ne[0],ie=ne[1],le=(0,f.useState)(null),ue=p()(le,2),de=ue[0],ce=ue[1],pe=(0,f.useState)(!1),fe=p()(pe,2),me=fe[0],ge=fe[1],ve=(0,f.useState)(void 0),Me=p()(ve,2),he=Me[0],xe=Me[1],ye=(0,f.useState)(!1),we=p()(ye,2),be=we[0],je=we[1],ke=(0,f.useState)(!1),Ze=p()(ke,2),Pe=Ze[0],Ce=Ze[1],Se=(0,f.useState)(void 0),Te=p()(Se,2),Re=Te[0],Oe=Te[1],Ee=(0,f.useState)(!1),ze=p()(Ee,2),Ne=ze[0],Fe=ze[1],Ue=(0,f.useState)(!1),Ie=p()(Ue,2),He=Ie[0],Ae=Ie[1],_e=(0,f.useState)(""),qe=p()(_e,2),Be=qe[0],Le=qe[1],We=(0,f.useState)(null),Je=p()(We,2),De=Je[0],Xe=Je[1],Ve=function(){$("create"),Q(void 0),q(!0)},$e=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:k.formatMessage({id:"name",defaultMessage:"名称"}),dataIndex:"name",copyable:!0,ellipsis:!0,sorter:!0,fixed:"left"},{title:k.formatMessage({id:"nickname",defaultMessage:"昵称"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,sorter:!0,width:200},{title:k.formatMessage({id:"type",defaultMessage:"类型"}),dataIndex:"type",valueType:"select",width:160,valueEnum:S,render:function(e,t){var r,a=(null==t?void 0:t.type)||"-",s=(null==S||null===(r=S[a])||void 0===r?void 0:r.text)||a;return(0,O.jsx)(v.Z,{children:s})}},{title:k.formatMessage({id:"description",defaultMessage:"描述"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:k.formatMessage({id:"language",defaultMessage:"语言"}),dataIndex:"language",valueType:"select",width:110,ellipsis:!0,copyable:!0,valueEnum:T},{title:k.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:"systemPrompt",width:120,hideInSearch:!0,render:function(e,t){var r=null==t?void 0:t.systemPrompt;return r?(0,O.jsx)("a",{onClick:function(){E?(Le(r),Xe(t),Ae(!0)):x.yw.warning(k.formatMessage({id:"prompt.permission.read.denied",defaultMessage:"无权限：查看提示词"}))},children:k.formatMessage({id:"view",defaultMessage:"查看"})}):"-"}},{title:k.formatMessage({id:"enabled",defaultMessage:"启用"}),dataIndex:"enabled",valueType:"select",width:100,valueEnum:{true:{text:k.formatMessage({id:"yes",defaultMessage:"是"})},false:{text:k.formatMessage({id:"no",defaultMessage:"否"})}},render:function(e,t){return null!=t&&t.enabled?(0,O.jsx)(v.Z,{color:"green",children:"ON"}):(0,O.jsx)(v.Z,{color:"default",children:"OFF"})}},{title:k.formatMessage({id:"updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",width:200,hideInSearch:!0,sorter:!0},{title:k.formatMessage({id:"action",defaultMessage:"操作"}),valueType:"option",width:320,fixed:"right",render:function(e,t){return[(0,O.jsx)("a",{onClick:function(){ce(null),function(e){ie(e),ae(!0)}(t)},children:k.formatMessage({id:"view",defaultMessage:"查看"})},"view"),(0,O.jsx)(M.Z,{title:k.formatMessage({id:"prompt.reset.confirm",defaultMessage:"确认重置为系统默认提示词？"}),onConfirm:d()(l()().mark((function e(){var r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=3;break}return x.yw.warning(k.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：重置提示词"})),e.abrupt("return");case 3:if(null!=t&&t.uid){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,x.yw.loading(k.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=9,(0,j.$2)(t.uid,{orgUid:null==C?void 0:C.uid});case 9:200===(null==(r=e.sent)?void 0:r.code)?(x.yw.success(k.formatMessage({id:"success",defaultMessage:"重置成功"})),null===(a=P.current)||void 0===a||a.reload()):x.yw.error((null==r?void 0:r.message)||k.formatMessage({id:"failed",defaultMessage:"重置失败"})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),x.yw.error(k.formatMessage({id:"error",defaultMessage:"请求出错"}));case 16:case"end":return e.stop()}}),e,null,[[5,13]])}))),children:(0,O.jsx)("a",{children:k.formatMessage({id:"prompt.reset.default",defaultMessage:"重置默认"})})},"reset"),(0,O.jsx)("a",{onClick:function(){F?function(e){xe(e),je(!1),ge(!0)}(t):x.yw.warning(k.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：评分提示词"}))},children:k.formatMessage({id:"prompt.score",defaultMessage:"评分"})},"score"),(0,O.jsx)("a",{onClick:function(){F?function(e){Oe(e),Fe(!1),Ce(!0)}(t):x.yw.warning(k.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：优化提示词"}))},children:k.formatMessage({id:"prompt.optimize",defaultMessage:"优化"})},"optimize"),(0,O.jsx)("a",{onClick:function(){F?function(e){$("edit"),Q(e),q(!0)}(t):x.yw.warning(k.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"无权限：编辑提示词"}))},children:k.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,O.jsx)(M.Z,{title:k.formatMessage({id:"delete.confirm",defaultMessage:"确认删除？"}),onConfirm:d()(l()().mark((function e(){var r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I){e.next=3;break}return x.yw.warning(k.formatMessage({id:"prompt.permission.delete.denied",defaultMessage:"无权限：删除提示词"})),e.abrupt("return");case 3:if(null!=t&&t.uid){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,(0,j.$j)({uid:t.uid});case 7:200===(null==(r=e.sent)?void 0:r.code)?(x.yw.success(k.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),null===(a=P.current)||void 0===a||a.reload()):x.yw.error((null==r?void 0:r.message)||k.formatMessage({id:"delete.failed",defaultMessage:"删除失败"}));case 9:case"end":return e.stop()}}),e)}))),children:(0,O.jsx)("a",{children:k.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(g.Z,{columns:$e,actionRef:P,cardBordered:!0,scroll:{x:"max-content"},form:{initialValues:{language:"ZH_CN"}},request:function(){var e=d()(l()().mark((function e(t,r){var a,n,i,u,d,c,p,f,m,g,v,M;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E){e.next=3;break}return x.yw.warning(k.formatMessage({id:"prompt.permission.read.denied",defaultMessage:"无权限：查看提示词"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return d=(u=t).current,c=u.pageSize,"true"===(null==(p=o()(u,D))?void 0:p.enabled)?p.enabled=!0:"false"===(null==p?void 0:p.enabled)&&(p.enabled=!1),r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],f=g,m="ascend"===r[g]?"ascend":"descend"),v=s()(s()({pageNumber:(d||1)-1,pageSize:c||10,orgUid:null==C?void 0:C.uid},p),{},{language:null!==(a=null==p?void 0:p.language)&&void 0!==a?a:"ZH_CN",sortBy:f,sortDirection:m}),e.next=9,(0,j.WD)(v);case 9:return M=e.sent,b.Z.debug("PromptTab queryPromptsByOrg:",M,v),e.abrupt("return",{data:(null==M||null===(n=M.data)||void 0===n?void 0:n.content)||[],success:!0,total:(null==M||null===(i=M.data)||void 0===i?void 0:i.totalElements)||0});case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0},headerTitle:k.formatMessage({id:"menu.robot.prompt",defaultMessage:"提示词"}),toolBarRender:function(){return e=[],N&&e.push((0,O.jsx)(h.ZP,{type:"primary",onClick:Ve,children:k.formatMessage({id:"create",defaultMessage:"新建"})},"create")),F&&e.push((0,O.jsx)(M.Z,{title:k.formatMessage({id:"prompt.reset.all.confirm",defaultMessage:"确认重置全部为系统默认提示词？"}),onConfirm:d()(l()().mark((function e(){var t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=C&&C.uid){e.next=3;break}return x.yw.warning(k.formatMessage({id:"prompt.org.missing",defaultMessage:"请先选择组织"})),e.abrupt("return");case 3:return e.prev=3,x.yw.loading(k.formatMessage({id:"loading",defaultMessage:"正在处理..."})),e.next=7,(0,j.uy)({orgUid:C.uid});case 7:200===(null==(t=e.sent)?void 0:t.code)?(x.yw.success(k.formatMessage({id:"prompt.reset.all.success",defaultMessage:"已重置为系统默认"})),null===(r=P.current)||void 0===r||r.reload()):x.yw.error((null==t?void 0:t.message)||k.formatMessage({id:"failed",defaultMessage:"重置失败"})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),x.yw.error(k.formatMessage({id:"error",defaultMessage:"请求出错"}));case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),children:(0,O.jsx)(h.ZP,{danger:!0,children:k.formatMessage({id:"prompt.reset.all",defaultMessage:"重置全部默认"})},"resetAllBtn")},"resetAll")),e;var e}}),(0,O.jsx)(z,{open:_,mode:V,initialValues:Y,onCancel:function(){return q(!1)},onSubmit:function(){var e=d()(l()().mark((function e(t){var r,a,n,o,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=s()(s()({},t),{},{orgUid:null==C?void 0:C.uid}),"create"!==V){e.next=8;break}return e.next=5,(0,j.Fh)(r);case 5:return 200===(null==(a=e.sent)?void 0:a.code)?(x.yw.success(k.formatMessage({id:"create.success",defaultMessage:"创建成功"})),q(!1),null===(n=P.current)||void 0===n||n.reload()):x.yw.error((null==a?void 0:a.message)||k.formatMessage({id:"create.failed",defaultMessage:"创建失败"})),e.abrupt("return");case 8:return e.next=10,(0,j.Fu)(r);case 10:200===(null==(o=e.sent)?void 0:o.code)?(x.yw.success(k.formatMessage({id:"update.success",defaultMessage:"更新成功"})),q(!1),null===(i=P.current)||void 0===i||i.reload()):x.yw.error((null==o?void 0:o.message)||k.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),x.yw.error(k.formatMessage({id:"save.error",defaultMessage:"保存出错"}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()}),(0,O.jsx)(U,{open:re,record:oe,orgUid:null==C?void 0:C.uid,canUpdate:F,autoRunAction:de,onAutoRunConsumed:function(){return ce(null)},onReload:function(){var e;return null===(e=P.current)||void 0===e?void 0:e.reload()},onClose:function(){ae(!1),ie(void 0),ce(null)}}),(0,O.jsx)(B,{open:me,record:he,orgUid:null==C?void 0:C.uid,canUpdate:F,autoRunScore:be,onAutoRunConsumed:function(){return je(!1)},onReload:function(){var e;return null===(e=P.current)||void 0===e?void 0:e.reload()},onClose:function(){ge(!1),xe(void 0),je(!1)}}),(0,O.jsx)(W,{open:Pe,record:Re,orgUid:null==C?void 0:C.uid,canUpdate:F,autoRunOptimize:Ne,onAutoRunConsumed:function(){return Fe(!1)},onReload:function(){var e;return null===(e=P.current)||void 0===e?void 0:e.reload()},onClose:function(){Ce(!1),Oe(void 0),Fe(!1)}}),(0,O.jsx)(J,{open:He,record:De,value:Be,orgUid:null==C?void 0:C.uid,canUpdate:F,onClose:function(){return Ae(!1)},onSaved:function(){var e;Ae(!1),Xe(null),null===(e=P.current)||void 0===e||e.reload()}})]})}}}]);