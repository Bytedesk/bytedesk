"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{58275:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},47944:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},61353:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}},{tag:"path",attrs:{d:"M894 345a343.92 343.92 0 00-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4a31.95 31.95 0 0040.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1A367.31 367.31 0 00729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"}},{tag:"path",attrs:{d:"M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}}]},name:"comment",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},15722:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},42085:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},2484:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var c=a.forwardRef(i)},32350:function(e,t,n){var r=n(17082),a=n(73457),o=n(44194),s=n(7010),i=n(31549),c=["fieldProps","proFieldProps"],l=function(e,t){var n=e.fieldProps,o=e.proFieldProps,l=(0,a.Z)(e,c);return(0,i.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:o},l))};t.Z=o.forwardRef(l)},92053:function(e,t,n){n.d(t,{G9:function(){return w},J$:function(){return k},N6:function(){return x},VM:function(){return l},c8:function(){return d},gF:function(){return m},rg:function(){return p},sF:function(){return v}});var r=n(90819),a=n.n(r),o=n(89933),s=n.n(o),i=n(55735),c=n(30921);function l(){return u.apply(this,arguments)}function u(){return(u=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return g.apply(this,arguments)}function g(){return(g=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/"+t+"/details",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/"+t+"/details",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",params:{client:i.bVn},data:{model:t}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",params:{client:i.bVn},data:{model:t}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return j.apply(this,arguments)}function j(){return(j=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/embedding-model/exists",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},66916:function(e,t,n){n.d(t,{$l:function(){return v},JT:function(){return w},Xd:function(){return k},gf:function(){return S},lg:function(){return p},lz:function(){return x},p0:function(){return d},s9:function(){return m}});var r=n(90819),a=n.n(r),o=n(73193),s=n.n(o),i=n(89933),c=n.n(i),l=n(55735),u=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/query/org",{method:"GET",params:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/create",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/create/prompt",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/avatar",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/prompt",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/kbUid",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/delete",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},80876:function(e,t,n){var r=n(45332),a=n.n(r),o=n(40612),s=n(55735),i=n(69169),c=n(4499),l=n(84881),u=n(30921),d=n(53530),f=n(44194),p=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,g=(0,u.useIntl)(),m=i.A.useForm(),h=a()(m,1)[0],v=(0,o.u)((function(e){return e.currentOrg})),b=function(){console.log("handleSaveRobot"),h.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},kbEnabled:!1,orgUid:null==v?void 0:v.uid};console.log("robotObject:",t),r(t),h.resetFields()})).catch((function(e){console.log("Form errors:",e)}))};return(0,f.useEffect)((function(){console.log("RobotForm useEffect"),t&&(h.resetFields(),h.setFieldsValue({type:s.f4h}))}),[t,h]),(0,p.jsx)("div",{children:(0,p.jsx)(d.Z,{title:g.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:g.formatMessage({id:"save",defaultMessage:"Save"}),onOk:b,onCancel:function(){h.resetFields(),n()},children:(0,p.jsxs)(i.A,{form:h,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,p.jsx)(c.Z,{label:g.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:g.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return b()}}}),(0,p.jsx)(l.Z,{label:g.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:g.formatMessage({id:s.f4h,defaultMessage:"Service"}),value:s.f4h}],rules:[{required:!0,message:g.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:g.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})}},90553:function(e,t,n){n.r(t),n.d(t,{default:function(){return Pe}});var r=n(96865),a=n(75574),o=n(55735),s=n(95160),i=n(44194),c=n(8247),l=n(30921),u=n(73193),d=n.n(u),f=n(84176),p=n.n(f),g=n(86222),m=n.n(g),h=n(90819),v=n.n(h),b=n(89933),x=n.n(b),y=n(45332),w=n.n(y);var M=n(76750),k=n(6397),j=n(40612),S=(n(51239),n(44521)),C=n(31549),Z=n(90838),q=(n(69114),n(28977)),E=n.n(q),O=n(27650),I=n(28425),$=n(72608),P=n(32943),T=n(53530),F=n(92053),V=function(e){var t=e.onModelStatusChange,n=(0,l.useIntl)(),r=(0,i.useState)(!1),a=w()(r,2),o=a[0],s=a[1],c=(0,i.useState)(!1),u=w()(c,2),d=u[0],f=u[1],p=(0,i.useState)(!1),g=w()(p,2),m=(g[0],g[1],function(){var e=x()(v()().mark((function e(){var n;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f(!0),null==t||t(!1),e.next=5,(0,F.J$)();case 5:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(s(n.data),null==t||t(n.data)):(s(!1),null==t||t(!1)),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("检查嵌入式模型失败:",e.t0),s(!1),null==t||t(!1);case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,10,15,18]])})));return function(){return e.apply(this,arguments)}}());return(0,i.useEffect)((function(){m()}),[]),d?(0,C.jsx)(P.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):o?null:(0,C.jsx)(P.Z,{type:"warning",showIcon:!0,message:(0,C.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,C.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型bge-m3:latest，用于知识库向量检索"}),style:{marginBottom:16}})},U=n(76711),z=n.n(U),L=n(86803),R=n(75365),A=n(61353),B=n(66916),H=n(80876),N=n(10162),D=n(80601),G=n(44781),K=n(38775),Q="CREATE_NEW_ROBOT",W=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,o=e.currentKbaseUid,s=e.onOk,i=e.onCancel,c=e.onChange,u=(0,l.useIntl)();return console.log("RobotSelectModal rendering with:",{robotList:r,selectedRobotUid:a,currentKbaseUid:o}),(0,C.jsx)(T.Z,{title:u.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:s,onCancel:i,okText:u.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:u.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,C.jsx)(D.Z,{spinning:n,children:(0,C.jsxs)("div",{style:{marginBottom:16},children:[(0,C.jsx)("p",{children:u.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,C.jsxs)(G.Z,{style:{width:"100%"},placeholder:u.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:c,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(o));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===o,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,C.jsx)(G.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,C.jsx)(G.Z.Option,{value:"divider",disabled:!0,children:(0,C.jsx)(K.Z,{style:{margin:"4px 0"}})}),(0,C.jsx)(G.Z.Option,{value:Q,label:u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,C.jsxs)("div",{style:{color:"#1890ff"},children:[(0,C.jsx)(N.Z,{})," ",u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},Y=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,a=e.checkingEmbeddingModel,s=(0,l.useIntl)(),c=(0,i.useState)(!1),u=w()(c,2),f=u[0],p=u[1],g=(0,i.useState)(!1),m=w()(g,2),h=m[0],b=m[1],y=(0,i.useState)(!1),M=w()(y,2),k=M[0],j=M[1],S=(0,i.useState)(),Z=w()(S,2),q=(Z[0],Z[1]),E=(0,i.useState)([]),O=w()(E,2),I=O[0],P=O[1],F=(0,i.useState)(""),V=w()(F,2),U=V[0],N=V[1],D=function(){var e=x()(v()().mark((function e(r){var a,i,c,l;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.prev=1,a={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:o.whQ,type:o.f4h,orgUid:null==n?void 0:n.uid},console.log("Fetching robots with params:",a),e.next=6,(0,B.p0)(a);case 6:if(i=e.sent,console.log("queryRobotsByOrg response:",i),200!==i.code){e.next=16;break}return c=i.data.content||[],l=c.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),P(l),r&&l.length>0&&q(l[0]),e.abrupt("return",l);case 16:return L.yw.error(i.message),e.abrupt("return",[]);case 18:e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),L.yw.error(s.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 25:return e.prev=25,j(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,20,25,28]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=x()(v()().mark((function e(){var n,r,a;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U&&null!=t&&t.uid){e.next=3;break}return L.yw.error(s.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return L.yw.loading(s.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:U,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,B.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r),200!==r.code){e.next=18;break}return L.yw.destroy(),L.yw.success(s.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=r.data,q(a),e.abrupt("return",!0);case 18:return L.yw.destroy(),L.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),L.yw.destroy(),L.yw.error(s.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=x()(v()().mark((function e(){var n;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),t){e.next=4;break}return L.yw.error(s.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 4:return L.yw.loading(s.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=7,D(!0);case 7:if(n=e.sent,L.yw.destroy(),!(n.length>0)){e.next=13;break}n.length>1?(P(n),N(""),p(!0)):Y(n[0]),e.next=21;break;case 13:return e.next=15,D(!1);case 15:if(0!==e.sent.length){e.next=19;break}return L.yw.info(s.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 19:N(""),p(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:o.xtN,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else L.yw.error(s.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},X=function(){var e=x()(v()().mark((function e(){var n;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U){e.next=3;break}return L.yw.error(s.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=I.find((function(e){return e.uid===U})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return T.Z.confirm({title:s.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:s.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:s.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=x()(v()().mark((function e(){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G();case 2:e.sent&&(p(!1),Y(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,G();case 9:e.sent&&(p(!1),n&&Y(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=x()(v()().mark((function e(n){var r,a,o,i;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,L.yw.loading(s.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=d()(d()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,B.lg)(r);case 7:if(a=e.sent,console.log("Create robot response:",a),200!==a.code){e.next=29;break}if(L.yw.destroy(),L.yw.success(s.formatMessage({id:"create.success",defaultMessage:"创建成功"})),b(!1),o=a.data,console.log("New robot data:",o),null==o||!o.uid){e.next=23;break}N(o.uid),q(o),P((function(e){var t=[o].concat(z()(e));return console.log("Updated robot list:",t),t})),p(!1),Y(o),e.next=27;break;case 23:return e.next=25,D(!1);case 25:i=e.sent,console.log("Fetched all robots after creation:",i);case 27:e.next=31;break;case 29:L.yw.destroy(),L.yw.error(a.message||s.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),L.yw.destroy(),L.yw.error(s.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(R.ZP,{icon:(0,C.jsx)(A.Z,{}),type:"primary",onClick:function(){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?$.ZP.info("正在检查模型状态，请稍后再试"):t?e():T.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})}(K,r,a)},disabled:a,children:s.formatMessage({id:"chat.test"})}),(0,C.jsx)(W,{visible:f,loading:k,robotList:I,selectedRobotUid:U,currentKbaseUid:null==t?void 0:t.uid,onOk:X,onCancel:function(){return p(!1)},onChange:function(e){e===Q?(b(!0),N("")):N(e)}}),h&&(0,C.jsx)(H.Z,{open:h,onClose:function(){return b(!1)},onSubmit:_})]})};var X=n(30617),_=n(11090),J=n(61107),ee=n(54881),te=n(58275),ne=n(2484),re=n(81947),ae=n(29266),oe=n(61355),se=n(88996),ie=n(96485),ce=n(69169),le=n(84881),ue=n(4499),de=n(62577),fe=n(32350),pe=n(73442),ge=n(3849),me=["key"],he=function(e){var t=e.isEdit,n=e.qa,r=e.open,a=e.onClose,s=e.onSubmit,c=ce.A.useForm(),l=w()(c,1)[0],u=(0,j.u)((function(e){return e.currentOrg})),f=(0,k.j)((function(e){return e.currentKbase})),g=(0,Z.v)((function(e){return e.categorySelectOptions})),m=(0,i.useState)([]),h=w()(m,2),v=(h[0],h[1]),b=(0,i.useState)(!1),x=w()(b,2),y=x[0],M=x[1],S=((0,i.useRef)(null),(0,i.useState)(!1)),q=w()(S,2),E=(q[0],q[1],(0,i.useState)("")),O=w()(E,2),I=(O[0],O[1],(0,i.useState)([])),$=w()(I,2),P=$[0],T=$[1];(0,i.useEffect)((function(){if(!r)return M(!1),void T([]);if(t&&n&&!y){console.log("Setting form for edit mode:",n),M(!0);var e=Array.isArray(n.questionList)?n.questionList:[],a={type:n.type||o.PYi,question:n.question||"",answer:n.answer||"",categoryUid:n.categoryUid||"",kbUid:null==f?void 0:f.uid,questionList:e},s=e.map((function(e){return"string"==typeof e?e:String(e)}));v(s),T(s),l.resetFields(),l.setFieldsValue(a),console.log("Form values set:",a),console.log("Current form values:",l.getFieldsValue(!0))}else t||y||(M(!0),T([]),l.resetFields(),l.setFieldsValue({type:o.PYi,question:"",answer:"",categoryUid:"",kbUid:null==f?void 0:f.uid,questionList:[]}),v([]))}),[t,n,r,l,null==f?void 0:f.uid,y]);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(pe.Z,{title:t?"修改问答对":"新建问答对",width:650,onClose:a,open:r,extra:(0,C.jsxs)(ge.Z,{children:[(0,C.jsx)(R.ZP,{onClick:a,children:"取消"}),(0,C.jsx)(R.ZP,{onClick:function(){var e=P.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));l.setFieldValue("questionList",e),l.validateFields().then((function(t){console.log("Validated values:",t);var r=d()(d()(d()({},n),t),{},{kbUid:null==f?void 0:f.uid,orgUid:null==u?void 0:u.uid,questionList:e});console.log("Final submit data:",r),s(r)})).catch((function(e){console.log("Form validation errors:",e),L.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,C.jsxs)(ce.A,{form:l,submitter:{render:function(){return null}},children:[(0,C.jsx)(le.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:g,fieldProps:{allowClear:!0,placeholder:"请选择分类"}}),(0,C.jsx)(le.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:o.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型"}}),(0,C.jsx)(ue.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,C.jsx)(de.u,{name:"questionList",label:"相似问法",creatorButtonProps:{creatorButtonText:"添加相似问题",icon:(0,C.jsx)(N.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(z()(P),[""]);T(e),l.setFieldValue("questionList",e),console.log("Added new similar question, new list:",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:t&&(null==n?void 0:n.questionList)||[],onAfterAdd:function(e,t,n){console.log("ProFormList onAfterAdd called:",{defaultValue:e,insertIndex:t,count:n});var r=l.getFieldValue("questionList")||[];console.log("Current form values after add:",r);var a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):z()(P);T(a),console.log("Updated similarQuestions after add:",a)},onAfterRemove:function(e,t){console.log("ProFormList onAfterRemove called:",{index:e,count:t});var n=l.getFieldValue("questionList")||[];console.log("Current form values after remove:",n);var r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];T(r),console.log("Updated similarQuestions after remove:",r)},actionRender:function(e,t,n){return[(0,C.jsx)(R.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=z()(P);r.splice(n,1),T(r),console.log("Removed similar question at index:",n,"new list:",r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,a=p()(e,me);return(0,C.jsx)(ue.Z,d()(d()({},a),{},{placeholder:"请输入相似问题",rules:[{required:!0,message:"请输入相似问题"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:P[t]||"",onChange:function(e){var n=z()(P);n[t]=e.target.value,T(n),l.setFieldValue(["questionList",t],e.target.value)}}}),r)}}),(0,C.jsx)(fe.Z,{label:"基础答案",name:"answer"})]})})})};function ve(e){return be.apply(this,arguments)}function be(){return(be=x()(v()().mark((function e(t){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/query/org",{method:"GET",params:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return ye.apply(this,arguments)}function ye(){return(ye=x()(v()().mark((function e(t){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/create",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){return Me.apply(this,arguments)}function Me(){return(Me=x()(v()().mark((function e(t){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/update",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){return je.apply(this,arguments)}function je(){return(je=x()(v()().mark((function e(t){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/delete",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=x()(v()().mark((function e(t){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/llm/qa/deleteAll",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ze=n(88721),qe=["current","pageSize"],Ee=function(){var e=(0,l.useIntl)(),t=(0,M.Z)().translateString,n=(0,i.useRef)(),r=(0,i.useState)(!0),a=w()(r,2),s=a[0],c=a[1],u=(0,i.useState)(),f=w()(u,2),g=f[0],h=f[1],b=(0,i.useState)(!1),y=w()(b,2),q=y[0],$=y[1],P=(0,i.useState)(1),F=w()(P,2),U=F[0],z=F[1],A=(0,i.useState)(10),B=w()(A,2),H=B[0],D=B[1],G=(0,j.u)((function(e){return e.currentOrg})),K=(0,k.j)((function(e){return e.currentKbase})),Q=(0,Z.v)((function(e){return e.currentCategory})),W=(0,Z.v)((function(e){return e.categorySelectOptions})),ce=(0,i.useState)(!1),le=w()(ce,2),ue=le[0],de=le[1],fe=(0,i.useState)([]),pe=w()(fe,2),ge=pe[0],me=pe[1],be=(0,i.useState)([]),ye=w()(be,2),Me=ye[0],je=ye[1],Ce=(0,i.useState)(0),Ee=w()(Ce,2),Oe=Ee[0],Ie=Ee[1],$e=(0,i.useState)(!1),Pe=w()($e,2),Te=Pe[0],Fe=Pe[1],Ve=(0,i.useState)(!1),Ue=w()(Ve,2),ze=Ue[0],Le=Ue[1],Re=function(){var t=x()(v()().mark((function t(r){var a;return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,ke(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),L.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):L.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ae=function(){var t=x()(v()().mark((function t(){var r,a,o,s,i,c;return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Me.length){t.next=3;break}return L.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:L.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,o=0,s=m()(Me),t.prev=7,s.s();case 9:if((i=s.n()).done){t.next=23;break}return c=i.value,t.prev=11,t.next=14,ke(c);case 14:200===t.sent.code?a++:o++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),o++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),s.e(t.t1);case 28:return t.prev=28,s.f(),t.finish(28);case 31:L.yw.destroy(),0===o?L.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):L.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:o})),me([]),je([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Be=function(){var t=x()(v()().mark((function t(){var r,a,s;return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Oe){t.next=3;break}return L.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),t.abrupt("return");case 3:return L.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),t.prev=4,r={categoryUid:(null==Q?void 0:Q.uid)===o.zBg?"":null==Q?void 0:Q.uid,kbUid:null==K?void 0:K.uid,orgUid:null==G?void 0:G.uid},t.next=8,Se(r);case 8:200===(a=t.sent).code?(L.yw.destroy(),L.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=n.current)||void 0===s||s.reloadAndRest()):(L.yw.destroy(),L.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),L.yw.destroy(),L.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),He=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0},{title:(0,C.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:100,render:function(t,n){var r=n.status||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"!==r&&"PROCESSING"!==r||(a="processing"),(0,C.jsx)(ae.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"questionList",width:150,ellipsis:!0,search:!1,render:function(e,t){if(!t.questionList||0===t.questionList.length)return"-";var n=t.questionList.length>3,r=t.questionList.slice(0,3);return(0,C.jsxs)("div",{children:[r.map((function(e,t){return(0,C.jsx)(ae.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),n&&(0,C.jsxs)(ae.Z,{color:"orange",children:["+",t.questionList.length-3]})]})}},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.type"}),dataIndex:"type",width:100,valueEnum:{text:{text:e.formatMessage({id:"faq.type.text"})},image:{text:e.formatMessage({id:"faq.type.image"})},video:{text:e.formatMessage({id:"faq.type.video"})},file:{text:e.formatMessage({id:"faq.type.file"})}},render:function(e,t){return(0,Ze.OI)(t.type)}},{title:(0,C.jsx)(l.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,render:function(e,t){var n=W.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,C.jsx)(ae.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:W.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.startDate?E()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.endDate?E()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(l.FormattedMessage,{id:"faq.updatedAt"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",hideInSearch:!0},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,r,a){return[(0,C.jsx)("a",{onClick:function(){De(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,C.jsx)(oe.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return Re(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,C.jsx)(R.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete")]}}],Ne=function(){Te?ze?L.yw.info("正在检查模型状态，请稍后再试"):(h(void 0),c(!1),$(!0)):T.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},De=function(e){h(e),c(!0),$(!0)},Ge=function(){var t=x()(v()().mark((function t(r){var a,o;return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),s?L.yw.loading(e.formatMessage({id:"updating"})):L.yw.loading(e.formatMessage({id:"creating"})),!s){t.next=8;break}return t.next=5,we(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,xe(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createQa response:",r,a),200===a.code?(L.yw.destroy(),L.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),$(!1),null===(o=n.current)||void 0===o||o.reloadAndRest()):(L.yw.destroy(),L.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ke=function(){var e=x()(v()().mark((function e(){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te){e.next=3;break}return T.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"}),e.abrupt("return");case 3:if(!ze){e.next=6;break}return L.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 6:de(!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[K,Q]);var Qe=function(){var t=x()(v()().mark((function t(){return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,I.HK)(o.QPQ,null==G?void 0:G.uid,null==K?void 0:K.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),We=function(){var e=x()(v()().mark((function e(){var t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",U,H),t=localStorage.getItem(o.LA8),window.open((0,S.kG)()+"/api/v1/llm/qa/export?"+new URLSearchParams({pageNumber:String(U-1),pageSize:String(H),categoryUid:(null==Q?void 0:Q.uid)===o.zBg?"":null==Q?void 0:Q.uid,kbUid:null==K?void 0:K.uid,orgUid:(null==G?void 0:G.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ye={selectedRowKeys:ge,onChange:function(e,t){me(e),je(t)}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(V,{onModelStatusChange:function(e){Fe(e),Le(!1)}}),(0,C.jsx)(re.Z,{columns:He,actionRef:n,cardBordered:!0,rowSelection:Ye,request:function(){var t=x()(v()().mark((function t(n,r,a){var s,i,c,l,u;return v()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),L.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=n.current,i=n.pageSize,c=p()(n,qe),z(s),D(i),l=d()({pageNumber:s-1,pageSize:i,categoryUid:(null==Q?void 0:Q.uid)===o.zBg?"":null==Q?void 0:Q.uid,kbUid:null==K?void 0:K.uid,orgUid:null==G?void 0:G.uid},c),t.next=8,ve(l);case 8:return u=t.sent,console.log("queryQasByOrg qa response:",l,u),L.yw.destroy(),200===u.code?Ie(u.data.totalElements):L.yw.error(u.message),t.abrupt("return",{data:u.data.content,success:!0,total:u.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){z(e),D(t)}},dateFormatter:"string",headerTitle:t(null==K?void 0:K.name)+" - 问答对",tooltip:ze?"正在检查嵌入式模型...":Te?"所添加问答对会自动添加到 '拆分' 列表中":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return t=[(0,C.jsx)(R.ZP,{icon:(0,C.jsx)(N.Z,{}),type:"primary",onClick:Ne,disabled:ze||!Te,children:e.formatMessage({id:"create"})},"create"),(0,C.jsx)(se.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,C.jsx)(Y,{currentKbase:K,currentOrg:G,embeddingModelExists:Te,checkingEmbeddingModel:ze||!Te})},"chat")],n=[{key:"import",icon:(0,C.jsx)(X.Z,{}),label:e.formatMessage({id:"import"}),onClick:Ke,disabled:ze||!Te},{key:"export",icon:(0,C.jsx)(_.Z,{}),label:e.formatMessage({id:"export"}),onClick:We},{key:"download",icon:(0,C.jsx)(J.Z,{}),label:e.formatMessage({id:"download.template"}),onClick:function(){return(0,S.zA)()}}],r=[],ge.length>0&&r.push({key:"batchDelete",icon:(0,C.jsx)(ee.Z,{}),label:e.formatMessage({id:"batch.delete"})+" (".concat(ge.length,")"),danger:!0,onClick:function(){T.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ge.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ae,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.push({key:"deleteAll",icon:(0,C.jsx)(te.Z,{}),label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),danger:!0,onClick:function(){T.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:Be,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.length>0&&t.push((0,C.jsx)(ie.Z,{menu:{items:r},placement:"bottom",children:(0,C.jsxs)(R.ZP,{type:ge.length>0?"primary":"default",danger:ge.length>0,children:[ge.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ge.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,C.jsx)(ne.Z,{})]})},"batchOperations")),t.push((0,C.jsx)(ie.Z,{menu:{items:n},placement:"bottom",children:(0,C.jsxs)(R.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,C.jsx)(ne.Z,{})]})},"importExport")),t;var t,n,r},columnsState:{persistenceKey:"qa-table",defaultValue:{viewCount:{show:!1},clickCount:{show:!0},upCount:{show:!0},downCount:{show:!0},valid:{show:!0},startDate:{show:!1},endDate:{show:!1}}}}),q&&(0,C.jsx)(he,{isEdit:s,open:q,qa:g,onClose:function(){return $(!1)},onSubmit:Ge}),ue&&(0,C.jsx)(O.Z,{type:o.Vi_,acceptType:".xlsx,.xls,.csv",isModalOpen:ue,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),de(!1),null==n||n.current.reload(),Qe()},handleCancel:function(){console.log("handleUploadDragCancel"),de(!1),null==n||n.current.reload()}})]})};var Oe=function(){var e=(0,l.useIntl)(),t=(0,i.useMemo)((function(){return[{key:"qa",label:e.formatMessage({id:"pages.robot.kb.qa",defaultMessage:"Q&A"}),children:(0,C.jsx)(Ee,{})}]}),[e]);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(c.Z,{items:t})})},Ie=a.Z.Sider,$e=a.Z.Content,Pe=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,C.jsx)("div",{children:(0,C.jsxs)(a.Z,{children:[(0,C.jsx)(Ie,{style:t,children:(0,C.jsx)(s.Z,{type:o.QPQ})}),(0,C.jsx)(a.Z,{children:(0,C.jsx)($e,{style:n,children:(0,C.jsx)(Oe,{})})})]})})}},32943:function(e,t,n){n.d(t,{Z:function(){return U}});var r=n(44194),a=n(58644),o=n(92520),s=n(14377),i=n(64985),c=n(18701),l=n(51865),u=n.n(l),d=n(77588),f=n(67762),p=n(34221),g=n(79145),m=n(37167),h=n(47825),v=n(88874),b=n(65759);const x=(e,t,n,r,a)=>({background:e,border:`${(0,h.bf)(r.lineWidth)} ${r.lineType} ${t}`,[`${a}-icon`]:{color:n}}),y=e=>{const{componentCls:t,motionDurationSlow:n,marginXS:r,marginSM:a,fontSize:o,fontSizeLG:s,lineHeight:i,borderRadiusLG:c,motionEaseInOutCirc:l,withDescriptionIconSize:u,colorText:d,colorTextHeading:f,withDescriptionPadding:p,defaultPadding:g}=e;return{[t]:Object.assign(Object.assign({},(0,v.Wf)(e)),{position:"relative",display:"flex",alignItems:"center",padding:g,wordWrap:"break-word",borderRadius:c,[`&${t}-rtl`]:{direction:"rtl"},[`${t}-content`]:{flex:1,minWidth:0},[`${t}-icon`]:{marginInlineEnd:r,lineHeight:0},"&-description":{display:"none",fontSize:o,lineHeight:i},"&-message":{color:f},[`&${t}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${n} ${l}, opacity ${n} ${l},\n        padding-top ${n} ${l}, padding-bottom ${n} ${l},\n        margin-bottom ${n} ${l}`},[`&${t}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${t}-with-description`]:{alignItems:"flex-start",padding:p,[`${t}-icon`]:{marginInlineEnd:a,fontSize:u,lineHeight:0},[`${t}-message`]:{display:"block",marginBottom:r,color:f,fontSize:s},[`${t}-description`]:{display:"block",color:d}},[`${t}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},w=e=>{const{componentCls:t,colorSuccess:n,colorSuccessBorder:r,colorSuccessBg:a,colorWarning:o,colorWarningBorder:s,colorWarningBg:i,colorError:c,colorErrorBorder:l,colorErrorBg:u,colorInfo:d,colorInfoBorder:f,colorInfoBg:p}=e;return{[t]:{"&-success":x(a,r,n,e,t),"&-info":x(p,f,d,e,t),"&-warning":x(i,s,o,e,t),"&-error":Object.assign(Object.assign({},x(u,l,c,e,t)),{[`${t}-description > pre`]:{margin:0,padding:0}})}}},M=e=>{const{componentCls:t,iconCls:n,motionDurationMid:r,marginXS:a,fontSizeIcon:o,colorIcon:s,colorIconHover:i}=e;return{[t]:{"&-action":{marginInlineStart:a},[`${t}-close-icon`]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:o,lineHeight:(0,h.bf)(o),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${n}-close`]:{color:s,transition:`color ${r}`,"&:hover":{color:i}}},"&-close-text":{color:s,transition:`color ${r}`,"&:hover":{color:i}}}}};var k=(0,b.I$)("Alert",(e=>[y(e),w(e),M(e)]),(e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:`${e.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${e.paddingMD}px ${e.paddingContentHorizontalLG}px`}))),j=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const S={success:a.Z,info:c.Z,error:o.Z,warning:i.Z},C=e=>{const{icon:t,prefixCls:n,type:a}=e,o=S[a]||null;return t?(0,g.wm)(t,r.createElement("span",{className:`${n}-icon`},t),(()=>({className:u()(`${n}-icon`,t.props.className)}))):r.createElement(o,{className:`${n}-icon`})},Z=e=>{const{isClosable:t,prefixCls:n,closeIcon:a,handleClose:o,ariaProps:i}=e,c=!0===a||void 0===a?r.createElement(s.Z,null):a;return t?r.createElement("button",Object.assign({type:"button",onClick:o,className:`${n}-close-icon`,tabIndex:0},i),c):null},q=r.forwardRef(((e,t)=>{const{description:n,prefixCls:a,message:o,banner:s,className:i,rootClassName:c,style:l,onMouseEnter:g,onMouseLeave:h,onClick:v,afterClose:b,showIcon:x,closable:y,closeText:w,closeIcon:M,action:S,id:q}=e,E=j(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[O,I]=r.useState(!1);const $=r.useRef(null);r.useImperativeHandle(t,(()=>({nativeElement:$.current})));const{getPrefixCls:P,direction:T,alert:F}=r.useContext(m.E_),V=P("alert",a),[U,z,L]=k(V),R=t=>{var n;I(!0),null===(n=e.onClose)||void 0===n||n.call(e,t)},A=r.useMemo((()=>void 0!==e.type?e.type:s?"warning":"info"),[e.type,s]),B=r.useMemo((()=>!("object"!=typeof y||!y.closeIcon)||(!!w||("boolean"==typeof y?y:!1!==M&&null!=M||!!(null==F?void 0:F.closable)))),[w,M,y,null==F?void 0:F.closable]),H=!(!s||void 0!==x)||x,N=u()(V,`${V}-${A}`,{[`${V}-with-description`]:!!n,[`${V}-no-icon`]:!H,[`${V}-banner`]:!!s,[`${V}-rtl`]:"rtl"===T},null==F?void 0:F.className,i,c,L,z),D=(0,f.Z)(E,{aria:!0,data:!0}),G=r.useMemo((()=>{var e,t;return"object"==typeof y&&y.closeIcon?y.closeIcon:w||(void 0!==M?M:"object"==typeof(null==F?void 0:F.closable)&&(null===(e=null==F?void 0:F.closable)||void 0===e?void 0:e.closeIcon)?null===(t=null==F?void 0:F.closable)||void 0===t?void 0:t.closeIcon:null==F?void 0:F.closeIcon)}),[M,y,w,null==F?void 0:F.closeIcon]),K=r.useMemo((()=>{const e=null!=y?y:null==F?void 0:F.closable;if("object"==typeof e){const{closeIcon:t}=e;return j(e,["closeIcon"])}return{}}),[y,null==F?void 0:F.closable]);return U(r.createElement(d.ZP,{visible:!O,motionName:`${V}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:e=>({maxHeight:e.offsetHeight}),onLeaveEnd:b},((t,a)=>{let{className:s,style:i}=t;return r.createElement("div",Object.assign({id:q,ref:(0,p.sQ)($,a),"data-show":!O,className:u()(N,s),style:Object.assign(Object.assign(Object.assign({},null==F?void 0:F.style),l),i),onMouseEnter:g,onMouseLeave:h,onClick:v,role:"alert"},D),H?r.createElement(C,{description:n,icon:e.icon,prefixCls:V,type:A}):null,r.createElement("div",{className:`${V}-content`},o?r.createElement("div",{className:`${V}-message`},o):null,n?r.createElement("div",{className:`${V}-description`},n):null),S?r.createElement("div",{className:`${V}-action`},S):null,r.createElement(Z,{isClosable:B,prefixCls:V,closeIcon:G,handleClose:R,ariaProps:K}))})))}));var E=q,O=n(74592),I=n(32099),$=n(67019),P=n(14755);let T=function(e){function t(){var e;return(0,O.Z)(this,t),(e=(0,$.Z)(this,t,arguments)).state={error:void 0,info:{componentStack:""}},e}return(0,P.Z)(t,e),(0,I.Z)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,info:t})}},{key:"render",value:function(){const{message:e,description:t,id:n,children:a}=this.props,{error:o,info:s}=this.state,i=(null==s?void 0:s.componentStack)||null,c=void 0===e?(o||"").toString():e,l=void 0===t?i:t;return o?r.createElement(E,{id:n,type:"error",message:c,description:r.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},l)}):a}}])}(r.Component);var F=T;const V=E;V.ErrorBoundary=F;var U=V},27487:function(e,t,n){n.d(t,{Z:function(){return k}});var r=n(44194),a=n(51865),o=n.n(a),s=n(97859),i=n(90899),c=n(37167),l=n(65759),u=n(77167);const d=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],p=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var g=function(e,t){return o()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const n=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${n}`]:n&&d.includes(n)}})(e,t)),((e,t)=>{const n={};return p.forEach((r=>{n[`${e}-align-${r}`]=t.align===r})),n[`${e}-align-stretch`]=!t.align&&!!t.vertical,n})(e,t)),((e,t)=>{const n={};return f.forEach((r=>{n[`${e}-justify-${r}`]=t.justify===r})),n})(e,t)))};const m=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,n={};return d.forEach((e=>{n[`${t}-wrap-${e}`]={flexWrap:e}})),n},b=e=>{const{componentCls:t}=e,n={};return p.forEach((e=>{n[`${t}-align-${e}`]={alignItems:e}})),n},x=e=>{const{componentCls:t}=e,n={};return f.forEach((e=>{n[`${t}-justify-${e}`]={justifyContent:e}})),n};var y=(0,l.I$)("Flex",(e=>{const{paddingXS:t,padding:n,paddingLG:r}=e,a=(0,u.IX)(e,{flexGapSM:t,flexGap:n,flexGapLG:r});return[m(a),h(a),v(a),b(a),x(a)]}),(()=>({})),{resetStyle:!1}),w=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const M=r.forwardRef(((e,t)=>{const{prefixCls:n,rootClassName:a,className:l,style:u,flex:d,gap:f,children:p,vertical:m=!1,component:h="div"}=e,v=w(e,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:b,direction:x,getPrefixCls:M}=r.useContext(c.E_),k=M("flex",n),[j,S,C]=y(k),Z=null!=m?m:null==b?void 0:b.vertical,q=o()(l,a,null==b?void 0:b.className,k,S,C,g(k,e),{[`${k}-rtl`]:"rtl"===x,[`${k}-gap-${f}`]:(0,i.n)(f),[`${k}-vertical`]:Z}),E=Object.assign(Object.assign({},null==b?void 0:b.style),u);return d&&(E.flex=d),f&&!(0,i.n)(f)&&(E.gap=f),j(r.createElement(h,Object.assign({ref:t,className:q,style:E},(0,s.Z)(v,["justify","wrap","align"])),p))}));var k=M},67019:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(42885),a=n(19567),o=n(27842);function s(e,t,n){return t=(0,r.Z)(t),(0,o.Z)(e,(0,a.Z)()?Reflect.construct(t,n||[],(0,r.Z)(e).constructor):t.apply(e,n))}}}]);