"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7960],{47944:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},15722:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},11090:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},30617:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},42085:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},2484:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},82669:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var u=a.forwardRef(o)},59005:function(e,t,n){var r=n(94433),a=n(38956),s=n(57343),i=n(44194),o=n(45441),u=n(9953),l=n(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var n=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.showSearch,b=e.options,x=(0,a.Z)(e,d),w=(0,i.useContext)(o.Z);return(0,l.jsx)(u.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:b,mode:m,showSearch:v,getPopupContainer:w.getPopupContainer},n),ref:t,proFieldProps:p},x),{},{children:c}))},p=i.forwardRef((function(e,t){var n=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,m=e.mode,g=e.valueEnum,h=e.request,v=e.options,b=(0,a.Z)(e,c),x=(0,r.Z)({options:v,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),w=(0,i.useContext)(o.Z);return(0,l.jsx)(u.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:w.getPopupContainer},x),ref:t,proFieldProps:p},b),{},{children:d}))})),m=i.forwardRef(f);m.SearchSelect=p,m.displayName="ProFormComponent",t.Z=m},86702:function(e,t,n){var r=n(32906),a=n(94433),s=n(38956),i=n(81424),o=n(69705),u=n(65641),l=n(34573),d=n(44194),c=n(9953),f=n(31549),p=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",h=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,r.Z)(t,2),s=n[0],l=n[1];return(0,f.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,r=t.getFieldValue(e.name||[]);return(0,f.jsx)(u.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return l(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,s.Z)(e,p);return(0,f.jsx)(c.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:n},r))};v.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,i=(0,s.Z)(e,m),o=(0,d.useState)(!1),u=(0,r.Z)(o,2),p=u[0],v=u[1];return null!=t&&t.statusRender&&i.name?(0,f.jsx)(h,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,l.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),v(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),v(!0)}}),proFieldProps:n,filedConfig:{valueType:g}},i))})}):(0,f.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:g}},i))},v.displayName="ProFormComponent",t.Z=v},60241:function(e,t,n){var r=n(94433),a=n(38956),s=n(44194),i=n(9953),o=n(31549),u=["fieldProps","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.proFieldProps,l=(0,a.Z)(e,u);return(0,o.jsx)(i.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:s},l))};t.Z=s.forwardRef(l)},38106:function(e,t,n){var r=n(94433),a=n(38956),s=n(44194),i=n(9953),o=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,d=e.proFieldProps,c=(0,a.Z)(e,u);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:d},c))},d=s.forwardRef(l);t.Z=d},33979:function(e,t,n){n.d(t,{Cd:function(){return y},E9:function(){return c},Fr:function(){return j},N:function(){return k},Rd:function(){return x},fA:function(){return g},ul:function(){return v},yq:function(){return p}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(94976),d=n(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/uid",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/authorities/reset",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return Z.apply(this,arguments)}function Z(){return(Z=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/authorities/add",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return C.apply(this,arguments)}function C(){return(C=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/authorities/remove",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},13916:function(e,t,n){n.d(t,{If:function(){return v},dF:function(){return c},j4:function(){return g},v$:function(){return p}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(94976),d=n(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/department/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},30606:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return v},hS:function(){return g},z_:function(){return c}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(94976),d=n(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},21850:function(e,t,n){var r=n(25553);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},71475:function(e,t,n){n.r(t),n.d(t,{default:function(){return ye}});var r=n(81581),a=n(44194),s=n(21850),i=n(73193),o=n.n(i),u=n(84176),l=n.n(u),d=n(90819),c=n.n(d),f=n(89933),p=n.n(f),m=n(86222),g=n.n(m),h=n(45332),v=n.n(h),b=n(30606),x=n(36846),w=n(74171),y=n(10162),M=n(54881),j=n(30617),Z=n(11090),k=n(61107),C=n(2484),S=n(44565),P=n(27729),F=n(82878),D=n(90581),R=n(43275),T=n(69533),E=n(28508),z=n(76711),U=n.n(z),I=n(94976),q=n(99036),O=n(86702),B=n(59005),N=n(4628),A=n(30857),$=n(30310),H=n(95321),V=n(2287),L=n(43388),J=n(33979),K=n(88722),X=n(7117),G=n(67242),W=n(31549),_=F.Z.Text,Q="df_role_member_uid",Y=function(e){var t,n,r=e.isEdit,s=e.member,i=e.open,u=e.onClose,l=e.onSubmit,d=e.isSubmitting,f=void 0!==d&&d,m=q.A.useForm(),g=v()(m,1)[0],h=(0,N.useIntl)(),b=(0,K.Z)().translateString,y=(0,x.H)((function(e){return e.departmentResult})),M=(0,w.u)((function(e){return e.currentOrg})),j=(0,a.useState)([]),Z=v()(j,2),k=Z[0],C=Z[1],S=(0,a.useState)([]),P=v()(S,2),F=P[0],R=P[1],E=(0,a.useState)(0),z=v()(E,2),Y=z[0],ee=z[1],te=(0,a.useState)(!1),ne=v()(te,2),re=ne[0],ae=ne[1];(0,a.useEffect)((function(){r&&s&&g?g.setFieldsValue({uid:null==s?void 0:s.uid,nickname:null==s?void 0:s.nickname,email:null==s?void 0:s.email,mobile:null==s?void 0:s.mobile,jobNo:null==s?void 0:s.jobNo,jobTitle:b(null==s?void 0:s.jobTitle),seatNo:null==s?void 0:s.seatNo,telephone:null==s?void 0:s.telephone,deptUid:null==s?void 0:s.deptUid}):(G.Z.debug("form resetFields"),g.resetFields(),ee(0))}),[s,r]);var se,ie,oe,ue=function e(t,n){var r;if(null!=t&&null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=h.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name,n.value=t.uid,t.children)for(var a=0;a<t.children.length;a++){var s={title:"",value:"",children:[]};e(t.children[a],s),n.children.push(s)}},le=(0,a.useMemo)((function(){for(var e=[],t=0;t<y.data.content.length;t++)if(y.data.content[t].name!==I.zBg){var n={title:"",value:"",children:[]};ue(y.data.content[t],n),e.push(n)}return e}),[y]),de=function(){var e=p()(c()().mark((function e(){var t,n,r,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=M&&M.uid){e.next=2;break}return e.abrupt("return");case 2:return L.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:M.uid,system:!1},e.next=6,(0,J.E9)(t);case 6:n=e.sent,G.Z.debug("queryRolesByOrg orgResp ",n),200===n.code?(L.yw.destroy(),a=(null==n||null===(r=n.data)||void 0===r?void 0:r.content)||[],s=Array.from(new Map(a.map((function(e){return[e.uid,e]}))).values()),R(s)):(L.yw.destroy(),L.yw.error(n.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e=((null==s?void 0:s.roles)||[]).map((function(e){return null==e?void 0:e.uid})).filter((function(e){return!!e})).filter((function(e){return""!==e&&e!==Q}));C(e)}),[s]),(0,a.useEffect)((function(){i&&(de(),r||ee(0))}),[i,r]),(0,W.jsx)("div",{children:(0,W.jsx)(A.Z,{title:r?(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.edit.title"}):(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.create.title"}),onClose:u,open:i,width:600,extra:(0,W.jsxs)($.Z,{children:[(0,W.jsx)(T.ZP,{onClick:u,disabled:f,children:(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.button.cancel"})}),(0,W.jsx)(T.ZP,{onClick:function(){G.Z.debug("handleSubmit"),g.validateFields().then((function(e){G.Z.debug("Form values:",e);var t=o()({uid:null==s?void 0:s.uid,nickname:e.nickname,email:e.email,mobile:e.mobile,jobNo:e.jobNo,jobTitle:e.jobTitle,seatNo:e.seatNo,telephone:e.telephone,deptUid:e.deptUid,orgUid:null==M?void 0:M.uid,roleUids:k},!r&&e.password&&{password:e.password});G.Z.debug("memberObject:",t),l(t)})).catch((function(e){G.Z.debug("Form errors:",e)}))},type:"primary",loading:f,disabled:f,children:(0,W.jsx)(N.FormattedMessage,{id:"team.member.drawer.button.save"})})]}),children:(0,W.jsxs)(q.A,{form:g,name:"memForm",submitter:!1,children:[(0,W.jsx)(q.A.Item,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.department"}),name:"deptUid",rules:[{required:!0,message:h.formatMessage({id:"team.member.form.department.required"})}],children:(0,W.jsx)(H.Z,{placeholder:h.formatMessage({id:"team.member.form.department.placeholder"}),allowClear:!0,treeDefaultExpandAll:!0,treeData:le,variant:"outlined",styles:{popup:{root:{maxHeight:400,overflow:"auto"}}}})}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.name",defaultMessage:"昵称"}),name:"nickname",rules:[{required:!0,message:h.formatMessage({id:"team.member.form.name.required"})}]}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.mobile"}),name:"mobile",disabled:r,rules:[{required:!r,message:h.formatMessage({id:"team.member.form.mobile.required"})},{validator:(oe=p()(c()().mark((function e(t,n){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(/^1[3456789]\d{9}$/.test(n)){e.next=4;break}throw new Error(h.formatMessage({id:"team.member.form.mobile.invalid"}));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return oe.apply(this,arguments)})}]}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.email"}),name:"email",disabled:r,rules:[{required:!r,message:h.formatMessage({id:"team.member.form.email.required"})},{validator:(ie=p()(c()().mark((function e(t,n){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){e.next=5;break}throw new Error(h.formatMessage({id:"team.member.form.email.invalid"}));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return ie.apply(this,arguments)})}]}),!r&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(O.Z.Password,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.password"}),name:"password",rules:[{required:!0,message:h.formatMessage({id:"team.member.form.password.required"})},{min:6,message:h.formatMessage({id:"team.member.form.password.min"})}],placeholder:h.formatMessage({id:"team.member.form.password.placeholder"}),fieldProps:{onChange:function(e){var t=e.target.value;if(t){var n=(0,X.Qc)(t);ee(n)}else ee(0)}}}),Y>0&&(0,W.jsxs)("div",{style:{marginBottom:16},children:[(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,W.jsx)(_,{children:"密码强度:"}),(0,W.jsx)(_,{type:"secondary",children:(0,X.$g)(Y)})]}),(0,W.jsx)(V.Z,{percent:Y,strokeColor:(se=Y,se>=80?"#52c41a":se>=60?"#faad14":se>=40?"#ff7a45":"#ff4d4f"),size:"small",showInfo:!1}),(0,W.jsx)("div",{style:{marginTop:4},children:(0,W.jsx)(_,{type:"secondary",style:{fontSize:"12px"},children:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})]})]}),(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser)&&(0,W.jsx)("p",{children:"超级管理员拥有所有权限，禁止编辑角色"}),(0,W.jsx)(B.Z,{name:"roleUids",label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.role"}),extra:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.role.systemHiddenTip",defaultMessage:"说明：系统角色不会在下拉中显示；已拥有的系统角色会在保存时自动保留。"}),width:"md",disabled:null==s||null===(n=s.user)||void 0===n?void 0:n.superUser,options:(F||[]).filter((function(e){return!0!==e.system})).map((function(e){return{value:e.uid,label:b(e.name),disabled:!1}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:h.formatMessage({id:"team.member.form.role.placeholder"}),value:k,onChange:function(e){G.Z.debug("selected ".concat(e));var t=((null==s?void 0:s.roles)||[]).filter((function(e){return!0===(null==e?void 0:e.system)})).map((function(e){return null==e?void 0:e.uid})).filter((function(e){return!!e})).filter((function(e){return k.includes(e)})),n=Array.from(new Set([].concat(U()(e||[]),U()(t))));n.length!==(e||[]).length&&L.yw.warning("系统角色已自动保留");var r=n.filter((function(e){return""!==e&&e!==Q}));C(r)},tagRender:function(e){var t=e.label,n=e.value,r=e.closable,a=e.onClose;return new Set(((null==s?void 0:s.roles)||[]).filter((function(e){return!0===(null==e?void 0:e.system)})).map((function(e){return null==e?void 0:e.uid})).filter((function(e){return!!e}))).has(String(n))?null:(0,W.jsx)(D.Z,{closable:r,onClose:a,style:{marginRight:3},children:t})}}}),(0,W.jsx)("div",{style:{marginBottom:16},children:(0,W.jsx)(T.ZP,{type:"link",onClick:function(){return ae(!re)},style:{padding:0},children:re?"隐藏高级设置":"高级设置"})}),re&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.jobNo"}),name:"jobNo"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.jobTitle"}),name:"jobTitle"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.seatNo"}),name:"seatNo"}),(0,W.jsx)(O.Z,{label:(0,W.jsx)(N.FormattedMessage,{id:"team.member.form.telephone"}),name:"telephone"})]})]})})})},ee=n(69705),te=n(1282),ne=n(14312),re=function(e){var t,n,r,s=e.open,i=e.member,o=e.onClose,u=e.onSuccess,l=(0,N.useIntl)(),d=ee.Z.useForm(),f=v()(d,1)[0],m=(0,a.useState)(!1),g=v()(m,2),h=g[0],b=g[1],x=(0,a.useState)(0),w=v()(x,2),y=w[0],M=w[1],j=(0,a.useState)(!1),Z=v()(j,2),k=Z[0],C=Z[1],S=function(){f.resetFields(),M(0),C(!1)},F=function(){S(),o()},D=function(){var e=p()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i&&null!==(n=i.user)&&void 0!==n&&n.uid){e.next=3;break}return L.yw.error(l.formatMessage({id:"change.password.error.noUid",defaultMessage:"用户ID不存在"})),e.abrupt("return");case 3:return y<40&&L.yw.warning(l.formatMessage({id:"change.password.warning.weakPassword",defaultMessage:"密码强度较弱，建议使用更强的密码"})),b(!0),e.prev=5,e.next=8,(0,ne.TZ)({uid:i.user.uid,newPassword:t.newPassword});case 8:200===(r=e.sent).code?(L.yw.success(l.formatMessage({id:"change.password.success",defaultMessage:"密码修改成功"})),F(),null==u||u()):L.yw.error(r.message||l.formatMessage({id:"change.password.failed",defaultMessage:"密码修改失败"})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),L.yw.error(l.formatMessage({id:"change.password.error",defaultMessage:"密码修改出错"}));case 15:return e.prev=15,b(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[5,12,15,18]])})));return function(t){return e.apply(this,arguments)}}(),R=function(e){return e>=80?"#52c41a":e>=60?"#faad14":e>=40?"#fa8c16":"#ff4d4f"};return(0,a.useEffect)((function(){s||S()}),[s]),(0,W.jsx)(P.Z,{title:l.formatMessage({id:"change.password",defaultMessage:"修改密码"}),open:s,onCancel:F,footer:null,destroyOnHidden:!0,width:500,children:(0,W.jsxs)(ee.Z,{form:f,onFinish:D,layout:"vertical",requiredMark:!1,children:[(0,W.jsx)(ee.Z.Item,{label:l.formatMessage({id:"user.nickname",defaultMessage:"用户昵称"}),children:(0,W.jsx)(te.Z,{value:(null==i?void 0:i.nickname)||"",disabled:!0,placeholder:l.formatMessage({id:"user.nickname.placeholder",defaultMessage:"用户昵称"})})}),(0,W.jsx)(ee.Z.Item,{label:l.formatMessage({id:"user.username",defaultMessage:"用户名"}),children:(0,W.jsx)(te.Z,{value:(null==i||null===(t=i.user)||void 0===t?void 0:t.username)||"",disabled:!0,placeholder:l.formatMessage({id:"user.username.placeholder",defaultMessage:"用户名"})})}),(0,W.jsx)(ee.Z.Item,{name:"newPassword",label:l.formatMessage({id:"new.password",defaultMessage:"新密码"}),rules:[{required:!0,message:l.formatMessage({id:"new.password.required",defaultMessage:"请输入新密码"})},{min:6,message:l.formatMessage({id:"new.password.minLength",defaultMessage:"密码长度不能少于6位"})},{max:50,message:l.formatMessage({id:"new.password.maxLength",defaultMessage:"密码长度不能超过50位"})}],children:(0,W.jsx)(te.Z.Password,{placeholder:l.formatMessage({id:"new.password.placeholder",defaultMessage:"请输入新密码"}),onChange:function(e){var t=e.target.value,n=(0,X.Qc)(t);M(n)},autoComplete:"new-password",visibilityToggle:{visible:k,onVisibleChange:C}})}),y>0&&(0,W.jsxs)(ee.Z.Item,{children:[(0,W.jsxs)("div",{style:{marginBottom:8},children:[(0,W.jsxs)("span",{style:{marginRight:8},children:[l.formatMessage({id:"password.strength",defaultMessage:"密码强度"}),":"]}),(0,W.jsx)("span",{style:{color:R(y),fontWeight:"bold"},children:(n=y,r=(0,X.$g)(n),l.formatMessage({id:"password.strength.".concat(r),defaultMessage:r}))})]}),(0,W.jsx)(V.Z,{percent:y,strokeColor:R(y),size:"small",showInfo:!1}),(0,W.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:l.formatMessage({id:"password.strength.tip",defaultMessage:"建议使用包含大小写字母、数字和特殊字符的强密码"})})]}),(0,W.jsx)(ee.Z.Item,{name:"confirmPassword",label:l.formatMessage({id:"confirm.password",defaultMessage:"确认密码"}),dependencies:["newPassword"],rules:[{required:!0,message:l.formatMessage({id:"confirm.password.required",defaultMessage:"请确认新密码"})},function(e){var t=e.getFieldValue;return{validator:function(e,n){return n&&t("newPassword")!==n?Promise.reject(new Error(l.formatMessage({id:"confirm.password.mismatch",defaultMessage:"两次输入的密码不一致"}))):Promise.resolve()}}}],children:(0,W.jsx)(te.Z.Password,{placeholder:l.formatMessage({id:"confirm.password.placeholder",defaultMessage:"请再次输入新密码"}),autoComplete:"new-password"})}),(0,W.jsx)(ee.Z.Item,{children:(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[(0,W.jsx)(T.ZP,{onClick:F,disabled:h,children:l.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,W.jsx)(T.ZP,{type:"primary",htmlType:"submit",loading:h,disabled:y<20,children:l.formatMessage({id:"confirm",defaultMessage:"确认"})})]})})]})})},ae=n(58620),se=n(54974),ie=n(13916),oe=n(44429),ue=n(85977),le=["current","pageSize"],de=function(){var e,t,n,r,s,i,u,d,f,m,h,z=(0,a.useRef)(),U=(0,N.useIntl)(),q=(0,a.useRef)(!1),O=(0,K.Z)().translateString,B=(0,a.useState)(!0),A=v()(B,2),$=A[0],H=A[1],V=(0,a.useState)(1),J=v()(V,2),X=J[0],_=J[1],Q=(0,a.useState)(10),ee=v()(Q,2),te=ee[0],ne=ee[1],de=(0,a.useState)({}),ce=v()(de,2),fe=ce[0],pe=ce[1],me=(0,a.useState)(),ge=v()(me,2),he=ge[0],ve=ge[1],be=(0,a.useState)(!1),xe=v()(be,2),we=xe[0],ye=xe[1],Me=(0,w.u)((function(e){return e.currentOrg})),je=(0,oe.L)((function(e){return e.userInfo})),Ze=(0,x.H)((function(e){return e.currentDepartment})),ke=P.Z.useModal(),Ce=v()(ke,2),Se=Ce[0],Pe=Ce[1],Fe=(0,a.useState)(!1),De=v()(Fe,2),Re=De[0],Te=De[1],Ee=(0,a.useState)(),ze=v()(Ee,2),Ue=ze[0],Ie=ze[1],qe=(0,x.H)((function(e){return{departmentResult:e.departmentResult,setDepartmentResult:e.setDepartmentResult}})),Oe=qe.departmentResult,Be=qe.setDepartmentResult,Ne=(0,a.useState)([]),Ae=v()(Ne,2),$e=Ae[0],He=Ae[1],Ve=(0,a.useState)([]),Le=v()(Ve,2),Je=Le[0],Ke=Le[1],Xe=(0,a.useState)(0),Ge=v()(Xe,2),We=Ge[0],_e=Ge[1],Qe=(0,a.useState)(!1),Ye=v()(Qe,2),et=Ye[0],tt=Ye[1],nt=(0,a.useState)(!1),rt=v()(nt,2),at=rt[0],st=rt[1],it=(0,N.useAccess)(),ot=(0,a.useMemo)((function(){var e;return null==it||null===(e=it.getModulePermission)||void 0===e?void 0:e.call(it,ue.MY.MEMBER)}),[it]),ut=null!==(e=null==ot||null===(t=ot.canRead)||void 0===t?void 0:t.call(ot))&&void 0!==e&&e,lt=null!==(n=null==ot||null===(r=ot.canCreate)||void 0===r?void 0:r.call(ot))&&void 0!==n&&n,dt=null!==(s=null==ot||null===(i=ot.canUpdate)||void 0===i?void 0:i.call(ot))&&void 0!==s&&s,ct=null!==(u=null==ot||null===(d=ot.canDelete)||void 0===d?void 0:d.call(ot))&&void 0!==u&&u,ft=null!==(f=null==ot||null===(m=ot.canExport)||void 0===m?void 0:m.call(ot))&&void 0!==f&&f,pt=function(e,t){L.yw.warning(U.formatMessage({id:e,defaultMessage:t}))},mt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,W.jsx)(N.FormattedMessage,{id:"pages.user.nickname",defaultMessage:"昵称"}),dataIndex:"nickname",fixed:"left",copyable:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.nickname.tooltip",defaultMessage:"成员的昵称或显示名称"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"pages.user.username",defaultMessage:"Username"}),dataIndex:"username",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.username.tooltip",defaultMessage:"成员的登录账号名称"}),render:function(e,t){var n,r=null==t||null===(n=t.user)||void 0===n?void 0:n.username;return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("span",{children:r}),r&&(0,W.jsx)(F.Z.Text,{copyable:{text:r},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.mobile.tooltip",defaultMessage:"成员的手机号码联系方式"}),render:function(e,t){return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("a",{href:"tel:".concat(t.mobile),children:t.mobile}),t.mobile&&(0,W.jsx)(F.Z.Text,{copyable:{text:t.mobile},style:{marginLeft:4}})]})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",copyable:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.email.tooltip",defaultMessage:"成员的电子邮箱地址"}),render:function(e,t){return(0,W.jsx)("a",{href:"mailto:".concat(e),children:e})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"jobNo",defaultMessage:"工号"}),dataIndex:"jobNo",copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.jobNo.tooltip",defaultMessage:"成员在组织内部的工号标识"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"jobTitle",defaultMessage:"职位"}),dataIndex:"jobTitle",copyable:!0,hideInSearch:!1,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.jobTitle.tooltip",defaultMessage:"成员在组织内的职位或职务名称"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"seatNo",defaultMessage:"座席号"}),dataIndex:"seatNo",copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.seatNo.tooltip",defaultMessage:"成员的座席编号，通常用于客服系统"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"telephone",defaultMessage:"电话"}),dataIndex:"telephone",copyable:!0,hideInSearch:!0,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.telephone.tooltip",defaultMessage:"成员的固定电话或分机号"}),render:function(e){return e?(0,W.jsx)("a",{href:"tel:".concat(e),children:e}):""}},{title:(0,W.jsx)(N.FormattedMessage,{id:"department",defaultMessage:"Department"}),dataIndex:"deptUid",valueType:"select",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.department.tooltip",defaultMessage:"成员所属的部门或组织单位"}),fieldProps:{options:function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=[],s=g()(t||[]);try{for(s.s();!(n=s.n()).done;){var i=n.value;if(i.uid!==I.zBg){var o=O(i.name),u=r?"".concat(r," / ").concat(o):o;a.push({label:u,value:i.uid}),i.children&&i.children.length>0&&(a=a.concat(e(i.children,u)))}}}catch(e){s.e(e)}finally{s.f()}return a}((null==Oe||null===(h=Oe.data)||void 0===h?void 0:h.content)||[])},render:function(e,t){var n=function e(t,n){var r,a=g()(t||[]);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.uid===n)return s;if(s.children&&s.children.length>0){var i=e(s.children,n);if(i)return i}}}catch(e){a.e(e)}finally{a.f()}return null}(Oe.data.content,t.deptUid);return n?(0,W.jsx)(D.Z,{color:"green",children:O(n.name)}):""}},{title:(0,W.jsx)(N.FormattedMessage,{id:"roles",defaultMessage:"Roles"}),dataIndex:"roles",hideInSearch:!0,width:180,tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.roles.tooltip",defaultMessage:"成员拥有的角色，决定其系统权限"}),render:function(e,t){var n=(t.roles||[]).map((function(e){var t=null!=e&&e.name?O(e.name):(null==e?void 0:e.uid)||"";return t?{name:t,system:!0===(null==e?void 0:e.system)}:null})).filter((function(e){return!!e}));return(0,W.jsx)(W.Fragment,{children:n.map((function(e,t){return(0,W.jsxs)(D.Z,{color:e.system?"gold":"blue",style:{margin:"2px"},children:[e.name,e.system?"（系统）":""]},t)}))})}},{title:(0,W.jsx)(N.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,hideInSearch:!0,sorter:!0,valueType:"dateTime",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.createdAt.tooltip",defaultMessage:"成员创建或添加的时间"})},{title:(0,W.jsx)(N.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0,valueType:"dateTime",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.updatedAt.tooltip",defaultMessage:"成员信息最后更新的时间"})},{title:U.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",tooltip:(0,W.jsx)(N.FormattedMessage,{id:"member.actions.tooltip",defaultMessage:"对成员可执行的操作，如编辑、删除等"}),render:function(e,t,n,r){var a,s,i=[];return dt&&(i.push((0,W.jsx)("a",{onClick:function(){G.Z.debug("editable:",t),jt(t)},children:U.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable")),i.push((0,W.jsx)("a",{onClick:function(){G.Z.debug("changePassword:",t),Pt(t)},children:U.formatMessage({id:"change.password",defaultMessage:"修改密码"})},"changePassword"))),!ct||null!=t&&null!==(a=t.user)&&void 0!==a&&a.superUser||(null==t||null===(s=t.user)||void 0===s?void 0:s.uid)===(null==je?void 0:je.uid)||i.push((0,W.jsx)(R.Z,{title:U.formatMessage({id:"deleteTip"}),description:"".concat(U.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.nickname,"】？"),onConfirm:function(){return bt(t)},okText:U.formatMessage({id:"ok"}),cancelText:U.formatMessage({id:"cancel"}),children:(0,W.jsx)(T.ZP,{type:"link",danger:!0,children:U.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")),i}}],gt=function(){var e=p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lt){e.next=3;break}return pt("member.permission.createDenied","暂无创建成员权限"),e.abrupt("return");case 3:Te(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ht=function(){var e=p()(c()().mark((function e(t){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G.Z.debug("handleSubmitDrawer:",t),!$||dt){e.next=4;break}return pt("member.permission.updateDenied","暂无编辑成员权限"),e.abrupt("return");case 4:if($||lt){e.next=7;break}return pt("member.permission.createDenied","暂无创建成员权限"),e.abrupt("return");case 7:if(st(!0),e.prev=8,!$){e.next=17;break}return e.next=12,(0,b.hS)(t);case 12:n=e.sent,G.Z.debug("updateMember:",n),200===n.code?(L.yw.success(U.formatMessage({id:"update.success",defaultMessage:"update success"})),z.current.reload(),Zt()):L.yw.error(n.message),e.next=22;break;case 17:return e.next=19,(0,b.D$)(t);case 19:r=e.sent,G.Z.debug("createMember:",r),200===r.code?(L.yw.success(U.formatMessage({id:"create.success",defaultMessage:"create success"})),z.current.reload(),Zt()):L.yw.error(r.message);case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),console.error("提交失败:",e.t0),L.yw.error(U.formatMessage({id:"submit.error",defaultMessage:"提交失败，请重试"}));case 28:return e.prev=28,st(!1),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[8,24,28,31]])})));return function(t){return e.apply(this,arguments)}}(),vt=function(){var e=p()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,orgUid:null==Me?void 0:Me.uid},e.next=3,(0,ie.dF)(t);case 3:n=e.sent,G.Z.debug("queryDepartmentsByOrg:",n,t),200===n.code?Be(n):L.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),bt=function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ct){e.next=3;break}return pt("member.permission.deleteDenied","暂无删除成员权限"),e.abrupt("return");case 3:return G.Z.debug("delete mem:",t),e.next=6,(0,b.EP)({uid:t.uid});case 6:n=e.sent,G.Z.debug("deleteMember:",n),200===n.code?(L.yw.success(U.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z.current.reload()):L.yw.error(n.message);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xt={selectedRowKeys:$e,onChange:function(e,t){He(e),Ke(t)},getCheckboxProps:function(e){var t,n;return{disabled:(null==e||null===(t=e.user)||void 0===t?void 0:t.superUser)||(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)===(null==je?void 0:je.uid),name:e.nickname}}};(0,a.useEffect)((function(){z.current.reload()}),[Ze]);var wt,yt=function(){var e=p()(c()().mark((function e(t,n,r){var a,s,i,u,d,f,p,m;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut){e.next=3;break}return pt("member.permission.readDenied","暂无查看成员权限"),e.abrupt("return",{data:[],success:!0,total:0});case 3:if(!q.current){e.next=6;break}return G.Z.debug("isLoading: 1",q.current),e.abrupt("return",{});case 6:return q.current=!0,L.yw.loading("正在加载"),a=t.current,s=t.pageSize,i=l()(t,le),pe(i),_(a),ne(s),u=void 0,d=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],u=f,d="ascend"===n[f]?"ascend":"descend"),p=o()(o()({pageNumber:a-1,pageSize:s,orgUid:null==Me?void 0:Me.uid,deptUid:(null==Ze?void 0:Ze.uid)===I.zBg?"":null==Ze?void 0:Ze.uid},i),{},{sortBy:u,sortDirection:d}),e.next=18,(0,b.z_)(p);case 18:return m=e.sent,G.Z.debug("queryMembersByOrg:",p,m),200===m.code?_e(null==m?void 0:m.data.totalElements):L.yw.error(m.message),q.current=!1,L.yw.destroy(),e.abrupt("return",{data:null==m?void 0:m.data.content,success:!0,total:null==m?void 0:m.data.totalElements});case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Mt=function(){lt?(ve(void 0),H(!1),ye(!0)):pt("member.permission.createDenied","暂无创建成员权限")},jt=function(e){dt?(ve(e),H(!0),ye(!0)):pt("member.permission.updateDenied","暂无编辑成员权限")},Zt=function(){ye(!1)},kt=function(){var e=p()(c()().mark((function e(t,n,r){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return pt("member.permission.exportDenied","暂无导出成员权限"),e.abrupt("return");case 3:G.Z.debug("handleExportExcel",t,n,r,fe),a=localStorage.getItem(I.LA8),s=o()(o()({orgUid:(null==Me?void 0:Me.uid)||"",accessToken:a||"",exportType:t},fe),{},{deptUid:(null==Ze?void 0:Ze.uid)===I.zBg?"":null==Ze?void 0:Ze.uid}),"current"===t?(s.pageNumber=String(X-1),s.pageSize=String(te)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,ae.kG)()+"/api/v1/member/export?"+new URLSearchParams(s).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ct=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,i=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return kt("range",r,n)}})},s=0;s<r;s++)a();return t},St=function(){var e=p()(c()().mark((function e(){var t,n,r,a,s,i,o,u,l,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ct){e.next=3;break}return pt("member.permission.deleteDenied","暂无删除成员权限"),e.abrupt("return");case 3:if(0!==Je.length){e.next=6;break}return L.yw.warning(U.formatMessage({id:"batch.delete.noselection",defaultMessage:"请先选择要删除的项目"})),e.abrupt("return");case 6:if(n=Je.filter((function(e){var t,n;return!(null!=e&&null!==(t=e.user)&&void 0!==t&&t.superUser)&&(null==e||null===(n=e.user)||void 0===n?void 0:n.uid)!==(null==je?void 0:je.uid)})),0!==n.length){e.next=10;break}return L.yw.warning(U.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"选中的都是超级用户或当前登录用户，无法删除"})),e.abrupt("return");case 10:n.length<Je.length&&(r=Je.filter((function(e){var t;return null==e||null===(t=e.user)||void 0===t?void 0:t.superUser})).length,a=Je.filter((function(e){var t;return(null==e||null===(t=e.user)||void 0===t?void 0:t.uid)===(null==je?void 0:je.uid)})).length,s=U.formatMessage({id:"batch.delete.containsSpecialUsers",defaultMessage:"选中的 {total} 项中包含 {skippedCount} 项无法删除"},{total:Je.length,skippedCount:Je.length-n.length}),r>0&&a>0?s+=U.formatMessage({id:"batch.delete.superAndCurrentUsers",defaultMessage:"（包括 {superCount} 个超级用户和当前登录用户）"},{superCount:r}):r>0?s+=U.formatMessage({id:"batch.delete.onlySuperUsers",defaultMessage:"（{superCount} 个超级用户）"},{superCount:r}):a>0&&(s+=U.formatMessage({id:"batch.delete.currentUser",defaultMessage:"（当前登录用户）"})),L.yw.warning(s)),L.yw.loading(U.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),i=0,o=0,u=g()(n),e.prev=15,u.s();case 17:if((l=u.n()).done){e.next=31;break}return d=l.value,e.prev=19,e.next=22,(0,b.EP)({uid:d.uid});case 22:200===e.sent.code?i++:o++,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(19),o++;case 29:e.next=17;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(15),u.e(e.t1);case 36:return e.prev=36,u.f(),e.finish(36);case 39:L.yw.destroy(),0===o?L.yw.success(U.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:i})):L.yw.warning(U.formatMessage({id:"batch.delete.partial",defaultMessage:"已删除 {success} 项，{fail} 项删除失败"},{success:i,fail:o})),He([]),Ke([]),null===(t=z.current)||void 0===t||t.reloadAndRest();case 44:case"end":return e.stop()}}),e,null,[[15,33,36,39],[19,26]])})));return function(){return e.apply(this,arguments)}}(),Pt=function(e){dt?(Ie(e),tt(!0)):pt("member.permission.updateDenied","暂无编辑成员权限")};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(S.Z,{columns:mt,actionRef:z,cardBordered:!0,rowSelection:ct?xt:void 0,request:yt,rowKey:"uid",scroll:{x:2500},search:{labelWidth:"auto"},pagination:{pageSize:te,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){_(e),ne(t)}},headerTitle:null!=Ze&&null!==(wt=Ze.name)&&void 0!==wt&&wt.startsWith("i18n.")?U.formatMessage({id:null==Ze?void 0:Ze.name,defaultMessage:null==Ze?void 0:Ze.name}):null==Ze?void 0:Ze.name,toolBarRender:function(){var e=[];lt&&e.push((0,W.jsx)(T.ZP,{icon:(0,W.jsx)(y.Z,{}),type:"primary",onClick:Mt,children:U.formatMessage({id:"create.member",defaultMessage:"创建成员"})},"create"));var t=[];ct&&$e.length>0&&t.push({key:"batchDelete",icon:(0,W.jsx)(M.Z,{}),danger:!0,label:U.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat($e.length,")"),onClick:function(){Se.confirm({title:U.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),content:"".concat(U.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确认删除选中的"})," ").concat($e.length," ").concat(U.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:St,okText:U.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:U.formatMessage({id:"cancel",defaultMessage:"取消"})})}});var n=[];return lt&&n.push({key:"import",icon:(0,W.jsx)(j.Z,{}),label:U.formatMessage({id:"import",defaultMessage:"导入"}),onClick:gt}),ft&&(n.push({key:"export-current",icon:(0,W.jsx)(Z.Z,{}),label:U.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return kt("current")}}),We>0&&(We<=1e3?n.push({key:"export-all",icon:(0,W.jsx)(Z.Z,{}),label:U.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(We,"条)"),onClick:function(){return kt("all")}}):n.push({key:"export-range",icon:(0,W.jsx)(Z.Z,{}),label:U.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(We,"条)"),children:Ct(We)}))),lt&&n.push({key:"download",icon:(0,W.jsx)(k.Z,{}),label:U.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,ae.$E)()}}),n.length>0&&e.push((0,W.jsx)(E.Z,{menu:{items:n},placement:"bottom",children:(0,W.jsxs)(T.ZP,{type:"primary",children:[U.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,W.jsx)(C.Z,{})]})},"importExport")),t.length>0&&e.push((0,W.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,W.jsxs)(T.ZP,{type:$e.length>0?"primary":"default",danger:$e.length>0,children:[$e.length>0?U.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat($e.length,")"):U.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,W.jsx)(C.Z,{})]})},"batchOperations")),e}}),we&&(0,W.jsx)(Y,{isEdit:$,member:he,open:we,onClose:Zt,onSubmit:ht,isSubmitting:at}),Re&&(0,W.jsx)(se.Z,{type:I.zey,acceptType:".xls,.xlsx,.csv",isModalOpen:Re,handleSubmit:function(e){G.Z.debug("handleUploadDragSubmit",e),Te(!1),vt(),null==z||z.current.reload()},handleCancel:function(){G.Z.debug("handleUploadDragCancel"),Te(!1),null==z||z.current.reload()}}),et&&(0,W.jsx)(re,{open:et,member:Ue,onClose:function(){tt(!1)},onSuccess:function(){var e;null===(e=z.current)||void 0===e||e.reload()}}),Pe]})},ce=n(65051),fe=n(34123),pe=n(15722),me=n(82669),ge=n(80556),he=n(59304),ve=n(38106),be=n(60241),xe=function(e){var t=e.open,n=e.isEdit,r=e.department,s=e.onCancel,i=e.onSubmit,o=ee.Z.useForm(),u=v()(o,1)[0],l=(0,N.useIntl)(),d=(0,x.H)((function(e){return e.departmentResult})),f=(0,w.u)((function(e){return e.currentOrg})),m=(0,K.Z)().translateString,g=(0,a.useRef)(null);(0,a.useEffect)((function(){if(t)if(n)u.setFieldsValue({uid:null==r?void 0:r.uid,parentUid:(null==r?void 0:r.parentUid)||I.zBg,name:m(null==r?void 0:r.name),description:null==r?void 0:r.description});else{u.resetFields();var e=null!=r&&r.uid&&r.uid!==I.zBg?r.uid:I.zBg;u.setFieldsValue({parentUid:e})}}),[t,n,null==r?void 0:r.uid]);var h=function e(t,n){var r;if(null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?n.title=l.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name||"",n.value=t.uid||"",t.children&&t.children.length>0){n.children=[];for(var a=0;a<t.children.length;a++){var s={title:"",value:""};e(t.children[a],s),n.children.push(s)}}},b=(0,a.useMemo)((function(){for(var e,t=[],a=(null==d||null===(e=d.data)||void 0===e?void 0:e.content)||[],s=0;s<a.length;s++){var i;if((null===(i=a[s])||void 0===i?void 0:i.uid)!==I.zBg){var o={title:"",value:""};h(a[s],o),t.push(o)}}var u=n?null==r?void 0:r.uid:void 0;if(u){var c=function e(t){var n;t&&(t.disabled=!0,null===(n=t.children)||void 0===n||n.forEach(e))};!function e(t){t&&t.forEach((function(t){t.value===u?c(t):t.children&&t.children.length>0&&e(t.children)}))}(t)}return[{title:l.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),value:I.zBg}].concat(t)}),[d,n,null==r?void 0:r.uid]),y=function(){u.validateFields().then(function(){var e=p()(c()().mark((function e(t){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.parentUid===I.zBg?void 0:t.parentUid,s={uid:n?null==r?void 0:r.uid:"",name:t.name,description:t.description,parentUid:a,orgUid:null==f?void 0:f.uid},console.log("handleSaveDep:",t,s),i(s);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),L.yw.error(n?"更新部门失败":"创建部门失败")}))};return(0,W.jsx)("div",{children:(0,W.jsx)(P.Z,{title:n?"编辑部门":"创建部门",open:t,forceRender:!0,onOk:y,onCancel:s,children:(0,W.jsxs)(q.A,{form:u,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,W.jsx)(ve.Z,{label:"上级部门",name:"parentUid",allowClear:!0,fieldProps:{treeData:b,fieldNames:{label:"title",value:"value",children:"children"},placeholder:"请选择上级部门(可选)",allowClear:!0,treeDefaultExpandAll:!0,filterTreeNode:function(e,t){var n;return(null!==(n=t&&t.title)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},variant:"outlined",styles:{popup:{root:{maxHeight:400,overflow:"auto"}}}}}),(0,W.jsx)(O.Z,{label:"部门名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(){g.current&&g.current.focus()}}}),(0,W.jsx)(be.Z,{label:"部门简介",name:"description",fieldProps:{ref:g,onPressEnter:function(e){e.preventDefault(),y()}}})]})})})},we=function(){var e,t,n,r,s,i,o,u,l=(0,N.useIntl)(),d=(0,N.useAccess)(),f=(0,a.useMemo)((function(){var e;return null==d||null===(e=d.getModulePermission)||void 0===e?void 0:e.call(d,ue.MY.DEPARTMENT)}),[d]),m=null!==(e=null==f||null===(t=f.canRead)||void 0===t?void 0:t.call(f))&&void 0!==e&&e,g=null!==(n=null==f||null===(r=f.canCreate)||void 0===r?void 0:r.call(f))&&void 0!==n&&n,h=null!==(s=null==f||null===(i=f.canUpdate)||void 0===i?void 0:i.call(f))&&void 0!==s&&s,b=null!==(o=null==f||null===(u=f.canDelete)||void 0===u?void 0:u.call(f))&&void 0!==o&&o,y=function(e,t){L.yw.warning(l.formatMessage({id:e,defaultMessage:t}))},j=(0,a.useState)(!1),Z=v()(j,2),k=Z[0],S=Z[1],F=(0,a.useState)(!1),D=v()(F,2),R=D[0],z=D[1],U=(0,w.u)((function(e){return e.currentOrg})),q=P.Z.useModal(),O=v()(q,2),B=O[0],A=O[1],$=(0,a.useState)(!1),H=v()($,2),V=H[0],J=H[1],K=(0,x.H)((function(e){return{currentDepartment:e.currentDepartment,departmentResult:e.departmentResult,insertDepartment:e.insertDepartment,upgradeDepartment:e.upgradeDepartment,removeDepartment:e.removeDepartment,setCurrentDepartment:e.setCurrentDepartment,setDepartmentResult:e.setDepartmentResult,setCurrentDepUid:e.setCurrentDepUid}})),X=K.currentDepartment,_=K.departmentResult,Q=K.insertDepartment,Y=K.upgradeDepartment,ee=K.removeDepartment,te=K.setCurrentDepartment,ne=K.setDepartmentResult,re=K.setCurrentDepUid,ae=function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return y("department.permission.delete","暂无删除部门权限"),e.abrupt("return");case 3:return G.Z.debug("handleDeleteDept",t),L.yw.loading(l.formatMessage({id:"deleting"})),e.next=7,(0,ie.If)(t);case 7:n=e.sent,G.Z.debug("handleDeleteDept:",n),200===n.code?(L.yw.destroy(),L.yw.success(l.formatMessage({id:"delete.success",defaultMessage:"delete success"})),ee(null==t?void 0:t.uid),S(!1)):(L.yw.destroy(),L.yw.error(n.message));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function e(t,n){var r,a="";if(a=null!==(r=t.name)&&void 0!==r&&r.startsWith(I.VoP)?l.formatMessage({id:t.name,defaultMessage:t.name}):t.name||"",void 0!==t.memberCount&&null!==t.memberCount&&t.memberCount>=0?a="".concat(a," (").concat(t.memberCount,")"):null!==t.memberCount&&void 0!==t.memberCount||(a="".concat(a," (0)")),n.title=a,n.key=t.uid||"",t.children)for(var s=0;s<t.children.length;s++){var i={title:"",key:"",children:[]};e(t.children[s],i),n.children.push(i)}},oe=(0,a.useMemo)((function(){var e=[],t=0;_.data.content&&_.data.content.forEach((function(e){if(e.uid!==I.zBg){var n,r=null!==(n=e.memberCount)&&void 0!==n?n:0;t+=r}}));for(var n=0;n<_.data.content.length;n++){var r={title:"",key:"",children:[]};if(_.data.content[n].uid===I.zBg){var a=l.formatMessage({id:"allDept",defaultMessage:"全部"});a="".concat(a," (").concat(t,")"),r.title=a,r.key=I.zBg}else se(_.data.content[n],r);e.push(r)}return e}),[_]),le=function(){var e=p()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=3;break}return y("department.permission.read","暂无查看部门权限"),e.abrupt("return");case 3:return J(!0),t={pageNumber:0,pageSize:100,orgUid:null==U?void 0:U.uid},e.next=7,(0,ie.dF)(t);case 7:n=e.sent,G.Z.debug("queryDepartmentsByOrg:",n,t),200===n.code?ne(n):L.yw.error(n.message),J(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){le()}),[null==U?void 0:U.uid,m]);var de=function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=3;break}return y("department.permission.create","暂无创建部门权限"),e.abrupt("return");case 3:return G.Z.debug("handleCreateDept",t),L.yw.loading(l.formatMessage({id:"creating"})),e.next=7,(0,ie.v$)(t);case 7:n=e.sent,G.Z.debug("createDepartment:",n),200===n.code?(L.yw.destroy(),L.yw.success(l.formatMessage({id:"create.success",defaultMessage:"create success"})),Q(null==n?void 0:n.data),te(null==n?void 0:n.data),S(!1),le()):(L.yw.destroy(),L.yw.error(n.message));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=p()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=3;break}return y("department.permission.update","暂无更新部门权限"),e.abrupt("return");case 3:return L.yw.loading(l.formatMessage({id:"updating"})),e.next=6,(0,ie.j4)(t);case 6:n=e.sent,G.Z.debug("handleUpdateDept:",t,n),200===n.code?(L.yw.destroy(),L.yw.success(l.formatMessage({id:"update.success",defaultMessage:"update success"})),te(null==n?void 0:n.data),Y(null==n?void 0:n.data),S(!1),le()):(L.yw.destroy(),L.yw.error(n.message));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(ce.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,W.jsxs)(ce.Z,{gap:"small",children:[(0,W.jsx)(T.ZP,{type:"primary",size:"small",icon:(0,W.jsx)(me.Z,{}),onClick:function(){G.Z.debug("new dep"),g?(z(!1),S(!0)):y("department.permission.create","暂无创建部门权限")},disabled:!g,children:l.formatMessage({id:"createDept",defaultMessage:"createDepartment"})}),(0,W.jsx)(T.ZP,{size:"small",icon:(0,W.jsx)(ge.Z,{spin:V}),onClick:le,loading:V,disabled:!m,children:l.formatMessage({id:"refresh",defaultMessage:"Refresh"})})]}),(null==X?void 0:X.uid)&&(null==X?void 0:X.uid)!==I.zBg&&(0,W.jsx)(E.Z,{menu:{items:[{key:"edit",icon:(0,W.jsx)(he.Z,{}),label:l.formatMessage({id:"edit",defaultMessage:"Edit"}),onClick:function(){G.Z.debug("edit role"),h?(z(!0),S(!0)):y("department.permission.update","暂无更新部门权限")},disabled:!h},{key:"delete",icon:(0,W.jsx)(M.Z,{}),label:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"}),danger:!0,onClick:function(){return e=X,void B.confirm({title:l.formatMessage({id:"deleteTip"}),icon:(0,W.jsx)(pe.Z,{}),content:"".concat(l.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){ae(e)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})});var e},disabled:!b}]},children:(0,W.jsx)(T.ZP,{size:"small",icon:(0,W.jsx)(C.Z,{})})})]}),(0,W.jsx)(fe.Z,{defaultSelectedKeys:[(null==X?void 0:X.uid)||I.zBg],onSelect:function(e,t){G.Z.debug("selected",e,t),m?0!==e.length&&re(e[0].toString()):y("department.permission.read","暂无查看部门权限")},treeData:oe,blockNode:!0}),k&&(0,W.jsx)(xe,{open:k,isEdit:R,department:X,onCancel:function(){S(!1)},onSubmit:function(e){R?ve(e):de(e)}}),A]})},ye=function(){var e=(0,s.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,W.jsxs)(r.Z,{style:{height:"100%"},children:[(0,W.jsx)(r.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,W.jsx)(we,{})}),(0,W.jsx)(r.Z.Panel,{style:n,children:(0,W.jsx)(de,{})})]})}},8732:function(e,t,n){n.d(t,{j:function(){return c}});var r=n(73193),a=n.n(r),s=n(76711),i=n.n(s),o=n(94976),u=n(26557),l=n(26407),d=n(20744),c=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var r=t().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==s){var o=[].concat(i()(r.slice(0,s)),[n],i()(r.slice(s+1))),u=a()(a()({},t().kbaseResult),{},{data:{content:o}});e({kbaseResult:u,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var r=t().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===n}));-1!==s?e({kbaseResult:a()(a()({},t().kbaseResult),{},{data:{content:[].concat(i()(r.slice(0,s)),i()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:o.wKE})))},36846:function(e,t,n){n.d(t,{H:function(){return p}});var r=n(86222),a=n.n(r),s=n(76711),i=n.n(s),o=n(73193),u=n.n(o),l=n(94976),d=n(26557),c=n(26407),f=n(20744),p=(0,d.Ue)()((0,c.mW)((0,c.tJ)((0,f.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:l.zBg,nickname:l.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,a={uid:l.zBg,name:l.zBg};(e({departmentResult:u()(u()({},n),{},{data:{content:[a].concat(i()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(i()(r.slice(0,a)),[n],i()(r.slice(a+1))),o=u()(u()({},t().departmentResult),{},{data:{content:s}});e({departmentResult:o,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,s,i=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(i)e({currentDepartment:i});else{!function t(r){var s,i=a()(r);try{for(i.s();!(s=i.n()).done;){var o=s.value;if(o.uid===n)return void e({currentDepartment:o});o.children&&o.children.length>0&&t(o.children)}}catch(e){i.e(e)}finally{i.f()}}((null===(s=t().departmentResult)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:l.xY_})))},7117:function(e,t,n){n.d(t,{$g:function(){return d},N9:function(){return u},Qc:function(){return l},vC:function(){return o}});var r=n(46803),a=n.n(r),s=n(67242);function i(e){return"bytedesk_salt"!==e&&e?a().SHA256(e).toString().substring(0,16):"bytedesk_license"}function o(e,t){if(!e)throw new Error("密码不能为空");if(!t)throw new Error("盐值不能为空");try{var n=i(t),r=a().enc.Utf8.parse(n);return a().AES.encrypt(e,r,{mode:a().mode.ECB,padding:a().pad.Pkcs7}).toString()}catch(e){throw s.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function u(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}function l(e){var t=0;return e?(e.length>=8&&(t+=20),e.length>=12&&(t+=10),/\d/.test(e)&&(t+=20),/[a-z]/.test(e)&&(t+=20),/[A-Z]/.test(e)&&(t+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(t+=10),Math.min(t,100)):0}function d(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}},65051:function(e,t,n){n.d(t,{Z:function(){return j}});var r=n(44194),a=n(51865),s=n.n(a),i=n(34573),o=n(6243),u=n(5924),l=n(20914),d=n(77167);const c=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],p=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var m=function(e,t){return s()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const n=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${n}`]:n&&c.includes(n)}})(e,t)),((e,t)=>{const n={};return p.forEach((r=>{n[`${e}-align-${r}`]=t.align===r})),n[`${e}-align-stretch`]=!t.align&&!!t.vertical,n})(e,t)),((e,t)=>{const n={};return f.forEach((r=>{n[`${e}-justify-${r}`]=t.justify===r})),n})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,n={};return c.forEach((e=>{n[`${t}-wrap-${e}`]={flexWrap:e}})),n},b=e=>{const{componentCls:t}=e,n={};return p.forEach((e=>{n[`${t}-align-${e}`]={alignItems:e}})),n},x=e=>{const{componentCls:t}=e,n={};return f.forEach((e=>{n[`${t}-justify-${e}`]={justifyContent:e}})),n};var w=(0,l.I$)("Flex",(e=>{const{paddingXS:t,padding:n,paddingLG:r}=e,a=(0,d.IX)(e,{flexGapSM:t,flexGap:n,flexGapLG:r});return[g(a),h(a),v(a),b(a),x(a)]}),(()=>({})),{resetStyle:!1}),y=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const M=r.forwardRef(((e,t)=>{const{prefixCls:n,rootClassName:a,className:l,style:d,flex:c,gap:f,vertical:p=!1,component:g="div",children:h}=e,v=y(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component","children"]),{flex:b,direction:x,getPrefixCls:M}=r.useContext(u.E_),j=M("flex",n),[Z,k,C]=w(j),S=null!=p?p:null==b?void 0:b.vertical,P=s()(l,a,null==b?void 0:b.className,j,k,C,m(j,e),{[`${j}-rtl`]:"rtl"===x,[`${j}-gap-${f}`]:(0,o.n)(f),[`${j}-vertical`]:S}),F=Object.assign(Object.assign({},null==b?void 0:b.style),d);return c&&(F.flex=c),f&&!(0,o.n)(f)&&(F.gap=f),Z(r.createElement(g,Object.assign({ref:t,className:P,style:F},(0,i.Z)(v,["justify","wrap","align"])),h))}));var j=M}}]);