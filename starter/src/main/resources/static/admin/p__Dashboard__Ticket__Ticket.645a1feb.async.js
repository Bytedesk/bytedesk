"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[987],{59908:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(11757),i=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=r(54183),s=function(e,t){return i.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var u=i.forwardRef(s)},32350:function(e,t,r){var n=r(17082),i=r(73457),a=r(44194),o=r(5369),s=r(31549),u=["fieldProps","proFieldProps"],c=function(e,t){var r=e.fieldProps,a=e.proFieldProps,c=(0,i.Z)(e,u);return(0,s.jsx)(o.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:a},c))};t.Z=a.forwardRef(c)},72614:function(e,t,r){r.d(t,{LE:function(){return l},W5:function(){return v},c$:function(){return p},n1:function(){return x},p0:function(){return m},zl:function(){return k}});var n=r(90819),i=r.n(n),a=r(73193),o=r.n(a),s=r(89933),u=r.n(s),c=r(30921);function l(e){return d.apply(this,arguments)}function d(){return(d=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/query/uid",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/create",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/update",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/update/avatar",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return w.apply(this,arguments)}function w(){return(w=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/delete",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,r){r.d(t,{D$:function(){return f},EP:function(){return h},hS:function(){return g},z_:function(){return d}});var n=r(90819),i=r.n(n),a=r(73193),o=r.n(a),s=r(89933),u=r.n(s),c=r(55735),l=r(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/query/org",{method:"GET",params:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/create",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/update",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/delete",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17220:function(e,t,r){r(44194);var n=r(75365),i=r(54881),a=r(30921),o=r(31549);t.Z=function(e){var t,r,s=e.file,u=e.onDelete,c=e.showDelete,l=void 0===c||c,d=(0,a.useIntl)();return(0,o.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:d.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[l&&(0,o.jsx)(n.ZP,{type:"text",size:"small",icon:(0,o.jsx)(i.Z,{}),onClick:function(){return u(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,o.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(r=s.fileType)&&void 0!==r&&r.startsWith("image/")?(0,o.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,o.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,o.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,r){var n=r(76711),i=r.n(n),a=r(73193),o=r.n(a),s=r(45332),u=r.n(s),c=r(44194),l=r(42085),d=r(30348),p=r(53530),f=r(28977),m=r.n(f),g=r(55735),v=r(86803),h=r(44521),x=r(17220),y=r(30921),k=r(6397),w=r(31549),b=d.Z.Dragger;t.Z=function(e){var t=e.type,r=(e.acceptType,e.isModalOpen),n=e.attachments,a=e.handleSubmit,s=e.handleCancel,d=(0,y.useIntl)(),f=(0,k.j)((function(e){return e.currentKbase})),j=(0,c.useState)([]),M=u()(j,2),S=M[0],Z=M[1],T=(0,c.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==f?void 0:f.uid,client:g.bVn}),F=u()(T,2),U=F[0],C=F[1];(0,c.useEffect)((function(){console.log("UploadDrag currentKbase",f),f&&C((function(e){return o()(o()({},e),{},{kb_uid:null==f?void 0:f.uid})}))}),[f]);var I=(0,c.useMemo)((function(){return{name:"file",multiple:!0,action:(0,h.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(g.LA8)},data:U,showUploadList:!1,beforeUpload:function(e){var t=m()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return C((function(r){return o()(o()({},r),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&v.yw.loading(d.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(v.yw.destroy(),v.yw.success(d.formatMessage({id:"upload.success"},{filename:e.file.name})),Z((function(t){return[].concat(i()(t),[e.file.response.data])}))):(v.yw.destroy(),v.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&v.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[U,d]);(0,c.useEffect)((function(){C((function(e){return o()(o()({},e),{},{kb_type:t,category_uid:""})})),n&&Z(n.map((function(e){return e.upload})))}),[t]);var q=function(e){console.log("handleDelete",e),Z((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,w.jsxs)(p.Z,{title:d.formatMessage({id:"upload.modal.title"}),open:r,onOk:function(){a(S)},onCancel:s,children:[(0,w.jsxs)(b,o()(o()({},I),{},{children:[(0,w.jsx)("p",{className:"ant-upload-drag-icon",children:(0,w.jsx)(l.Z,{})}),(0,w.jsx)("p",{className:"ant-upload-text",children:d.formatMessage({id:"upload.drag.text"})}),(0,w.jsx)("p",{className:"ant-upload-hint",children:d.formatMessage({id:"upload.drag.hint"})})]})),(0,w.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:S.map((function(e){return(0,w.jsx)(x.Z,{file:e,onDelete:q},e.uid)}))})})]})}},21041:function(e,t,r){r.r(t),r.d(t,{default:function(){return me}});var n=r(75574),i=r(73193),a=r.n(i),o=r(84176),s=r.n(o),u=r(10154),c=r.n(u),l=r(90819),d=r.n(l),p=r(89933),f=r.n(p),m=r(45332),g=r.n(m),v=r(86803),h=r(55735),x=r(30921);function y(e){return k.apply(this,arguments)}function k(){return(k=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/query/org",{method:"GET",params:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/update",{method:"POST",data:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return M.apply(this,arguments)}function M(){return(M=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/delete",{method:"POST",data:{uid:t,client:h.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/history/activity",{method:"GET",params:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=r(40612),F=r(90838),U=r(32045),C=r(76750),I=r(11090),q=r(25588),z=r(53530),P=r(29266),E=r(75365),O=r(28977),A=r.n(O),_=r(44194),D=r(76711),L=r.n(D),R=r(57178),Y=r(73442),N=r(3849),V=r(72614),B=r(6807),W=r(4499),H=r(32350),G=r(84881),J=r(17220),X=r(27650),Q=r(59908),K=r(31549),$=function(e){var t=e.open,r=e.isEdit,n=e.ticket,i=e.onClose,a=e.onSuccess,o=R.Z.useForm(),s=g()(o,1)[0],u=(0,x.useIntl)(),c=(0,C.Z)().translateString,l=(0,T.u)((function(e){return e.currentOrg})),p=(0,_.useState)([]),m=g()(p,2),y=m[0],k=m[1],b=(0,_.useState)([]),j=g()(b,2),M=j[0],S=j[1],Z=(0,_.useState)([]),F=g()(Z,2),I=F[0],q=F[1],z=(0,_.useState)(!1),P=g()(z,2),O=P[0],A=P[1],D=(0,_.useState)([]),$=g()(D,2),ee=$[0],te=$[1],re=[{value:h.sM_,label:u.formatMessage({id:"ticket.status.new"})},{value:h.Yux,label:u.formatMessage({id:"ticket.status.assigned"})},{value:h.sFW,label:u.formatMessage({id:"ticket.status.claimed"})},{value:h.W66,label:u.formatMessage({id:"ticket.status.unclaimed"})},{value:h.z1,label:u.formatMessage({id:"ticket.status.processing"})},{value:h.yZA,label:u.formatMessage({id:"ticket.status.transferred"})},{value:h.pIN,label:u.formatMessage({id:"ticket.status.pending"})},{value:h.XrC,label:u.formatMessage({id:"ticket.status.holding"})},{value:h.L1h,label:u.formatMessage({id:"ticket.status.resumed"})},{value:h.yib,label:u.formatMessage({id:"ticket.status.reopened"})},{value:h.hwr,label:u.formatMessage({id:"ticket.status.resolved"})},{value:h.AzB,label:u.formatMessage({id:"ticket.status.escalated"})},{value:h.frw,label:u.formatMessage({id:"ticket.status.closed"})},{value:h.xw4,label:u.formatMessage({id:"ticket.status.cancelled"})},{value:h.qQU,label:u.formatMessage({id:"ticket.status.verifiedOk"})},{value:h.GJZ,label:u.formatMessage({id:"ticket.status.verifiedFail"})}],ne=[{value:h.JTO,label:u.formatMessage({id:"ticket.priority.lowest"})},{value:h.sbT,label:u.formatMessage({id:"ticket.priority.low"})},{value:h.GMZ,label:u.formatMessage({id:"ticket.priority.medium"})},{value:h.Bt2,label:u.formatMessage({id:"ticket.priority.high"})},{value:h._Xr,label:u.formatMessage({id:"ticket.priority.urgent"})},{value:h.Lx6,label:u.formatMessage({id:"ticket.priority.critical"})}],ie=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,U.XS)({type:h.hcJ,orgUid:null==l?void 0:l.uid,pageNumber:0,pageSize:100});case 3:200===(r=e.sent).code&&null!==(t=r.data)&&void 0!==t&&t.content&&k(r.data.content),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Fetch categories error:",e.t0),v.yw.error(u.formatMessage({id:"ticket.category.load.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==l?void 0:l.uid},e.next=3,(0,V.LE)(t);case 3:200===(r=e.sent).code?(S(r.data.content),q(r.data.content.reduce((function(e,t){var r;return null===(r=t.agents)||void 0===r||r.forEach((function(t){e.find((function(e){return e.uid===t.uid}))||e.push(t)})),e}),[]))):v.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,_.useEffect)((function(){t&&(ae(),ie())}),[t]);var oe=y.filter((function(e){return e.uid!==h.zBg})),se=function(){var e=f()(d()().mark((function e(){var t,r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.validateFields();case 3:return t=e.sent,v.yw.loading(u.formatMessage({id:"updating"})),r={uid:null==n?void 0:n.uid,title:null==t?void 0:t.title,description:null==t?void 0:t.description,categoryUid:null==t?void 0:t.categoryUid,workgroupUid:null==t?void 0:t.workgroupUid,assigneeUid:null==t?void 0:t.assigneeUid,status:null==t?void 0:t.status,priority:null==t?void 0:t.priority,uploadUids:ee.map((function(e){return e.uid}))},console.log("updateTicket request",r),e.next=9,w(r);case 9:o=e.sent,console.log("updateTicket response",o),200===o.code?(v.yw.success(u.formatMessage({id:"update.success"})),a(),i()):v.yw.error(o.message),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Update failed:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}();_.useEffect((function(){var e,r,i;t&&n&&(s.setFieldsValue({title:null==n?void 0:n.title,description:null==n?void 0:n.description,status:null==n?void 0:n.status,priority:null==n?void 0:n.priority,categoryUid:null==n?void 0:n.categoryUid,workgroupUid:null==n||null===(e=n.workgroup)||void 0===e?void 0:e.uid,assigneeUid:null==n||null===(r=n.assignee)||void 0===r?void 0:r.uid}),te(null==n||null===(i=n.attachments)||void 0===i?void 0:i.map((function(e){return e.upload}))))}),[t,n]);var ue=function(e){console.log("handleDelete",e),te((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,K.jsx)(Y.Z,{title:u.formatMessage({id:"ticket.edit.title"}),width:600,open:t,onClose:i,extra:(0,K.jsxs)(N.Z,{children:[(0,K.jsx)(E.ZP,{onClick:i,children:(0,K.jsx)(x.FormattedMessage,{id:"cancel"})}),(0,K.jsx)(E.ZP,{type:"primary",onClick:se,children:(0,K.jsx)(x.FormattedMessage,{id:"save"})})]}),children:(0,K.jsxs)(B.ZP,{form:s,submitter:!1,layout:"vertical",children:[(0,K.jsx)(W.Z,{name:"title",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.title"}),rules:[{required:!0}]}),(0,K.jsx)(H.Z,{name:"description",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.description"}),rules:[{required:!0}]}),(0,K.jsx)(G.Z,{name:"categoryUid",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.category"}),rules:[{required:!0}],options:oe.map((function(e){return{label:c(e.name),value:e.uid}}))}),(0,K.jsx)(G.Z,{name:"workgroupUid",label:u.formatMessage({id:"ticket.workgroup"}),rules:[{required:!0}],options:M.map((function(e){return{label:c(e.nickname),value:e.uid}})),placeholder:u.formatMessage({id:"ticket.workgroup.placeholder"}),onChange:function(e){var t=M.find((function(t){return t.uid===e}));null!=t&&t.agents?(q(t.agents),s.setFieldValue("assigneeUid",void 0)):q([])}}),(0,K.jsx)(G.Z,{name:"assigneeUid",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),options:I.map((function(e){return{label:e.nickname,value:e.uid}}))}),(0,K.jsx)(G.Z,{name:"status",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.status"}),rules:[{required:!0}],options:re}),(0,K.jsx)(G.Z,{name:"priority",label:(0,K.jsx)(x.FormattedMessage,{id:"ticket.priority"}),rules:[{required:!0}],options:ne}),O&&(0,K.jsx)(X.Z,{type:h.hcJ,isModalOpen:O,attachments:null==n?void 0:n.attachments,handleSubmit:function(e){console.log("handleSubmit",e),te(r&&n?e:function(t){return[].concat(L()(t),L()(e))}),A(!1)},handleCancel:function(){A(!1)}}),(0,K.jsx)("div",{style:{marginTop:"16px",marginBottom:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,K.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:ee.map((function(e){return(0,K.jsx)(J.Z,{file:e,onDelete:ue},e.uid)}))})}),(0,K.jsx)(E.ZP,{icon:(0,K.jsx)(Q.Z,{}),onClick:function(){return A(!0)},children:u.formatMessage({id:"ticket.upload.button"})})]})})},ee=r(44521),te=r(73669),re=r(19981),ne=r(80601),ie=r(51004),ae=r(73589),oe=function(e){var t=e.ticket,r=e.isThreadTicket,n=void 0!==r&&r,i=(0,T.u)((function(e){return e.currentOrg})),a=(0,_.useState)([]),o=g()(a,2),s=o[0],u=o[1],c=(0,_.useState)(!1),l=g()(c,2),p=l[0],m=l[1],y=(0,x.useIntl)();console.log("currentTicket",t,p);var k=(0,re.Z)(),w=k.memberResult,b=k.setMemberResult,j=function(){var e=f()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,m(!0),r={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid},e.next=7,S(r);case 7:n=e.sent,console.log("queryTicketHistoryActivity response:",n.data),200===n.code?u(n.data||[]):(console.log("queryTicketHistoryActivity error:",n.data),v.yw.error(n.message)),m(!1),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Fetch ticket history error:",e.t0),v.yw.error("获取工单历史记录失败"),m(!1);case 18:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==i?void 0:i.uid},e.next=4,(0,te.z_)(t);case 4:200===(r=e.sent).code?(v.yw.destroy(),b(r)):v.yw.destroy();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,_.useEffect)((function(){n||(j(),M())}),[t]);var Z=function(e){if(!e)return"-";var t=w.data.content.find((function(t){return t.uid===e}));return(null==t?void 0:t.nickname)||""};return(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)(ne.Z,{spinning:p,children:[(0,K.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center"},children:"活动历史"}),(0,K.jsx)(ie.Z,{direction:"vertical",size:"small",current:s.length-1,style:{padding:"16px"},items:s.map((function(e,t){var r,n;return{title:(n=null==e?void 0:e.activityName,(n?n===h.sM_||n===h.Yux||n===h.sFW||n===h.W66||n===h.z1||n===h.yZA||n===h.pIN||n===h.XrC||n===h.L1h||n===h.yib||n===h.hwr||n===h.AzB||n===h.frw||n===h.xw4||n===h.qQU||n===h.GJZ?y.formatMessage({id:"ticket.status.".concat(n.toLowerCase())}):n:"")||"活动"),description:(0,K.jsxs)("div",{children:[(null==e?void 0:e.assignee)&&(0,K.jsxs)("div",{children:["处理人: ",Z(null==e?void 0:e.assignee)||(null==e?void 0:e.assignee)]}),(0,K.jsxs)("div",{children:["处理时间: ",(null===(r=e.startTime)||void 0===r?void 0:r.toLocaleString())||"-"]})]}),status:t===s.length-1?"process":"finish"}}))}),0===s.length&&(0,K.jsx)(ae.Z,{description:"请选择工单查看流转过程"})]})})},se=function(e){var t=e.open,r=e.ticket,n=e.onClose;return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(Y.Z,{open:t,onClose:function(){n()},title:"工单详情",children:(0,K.jsx)(oe,{ticket:r,isThreadTicket:!1})})})},ue=["current","pageSize"],ce=function(){var e=(0,x.useIntl)(),t=(0,_.useRef)(),r=(0,_.useState)(1),n=g()(r,2),i=n[0],o=n[1],u=(0,_.useState)(10),l=g()(u,2),p=l[0],m=l[1],k=(0,T.u)((function(e){return e.currentOrg})),w=(0,C.Z)().translateString,b=(0,F.v)().setCategoryResult,M=(0,F.v)((function(e){return e.currentCategory})),S=(0,_.useState)(!1),Z=g()(S,2),O=Z[0],D=Z[1],L=(0,_.useState)(),R=g()(L,2),Y=R[0],N=R[1],V=(0,_.useState)(!1),B=g()(V,2),W=B[0],H=B[1],G=z.Z.useModal(),J=g()(G,2),X=J[0],Q=J[1],te=(0,_.useState)(!1),re=g()(te,2),ne=re[0],ie=re[1],ae=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,type:h.hcJ,orgUid:null==k?void 0:k.uid},e.next=3,(0,U.XS)(t);case 3:200===(r=e.sent).code?b(r):v.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,_.useEffect)((function(){ae()}),[]);var oe=(0,F.v)((function(e){return e.categoryResult.data.content}));(0,_.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reload()}),[null==M?void 0:M.uid]);var ce=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.title"}),dataIndex:"title",copyable:!0,ellipsis:!0},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.description"}),dataIndex:"description",ellipsis:!0},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.status"}),dataIndex:"status",hideInSearch:!0,render:function(e,t){var r,n=(r={},c()(c()(c()(c()(c()(c()(c()(c()(c()(c()(r,h.sM_,"blue"),h.Yux,"geekblue"),h.sFW,"cyan"),h.W66,"magenta"),h.z1,"processing"),h.yZA,"lime"),h.pIN,"warning"),h.XrC,"orange"),h.L1h,"cyan"),h.yib,"volcano"),c()(c()(c()(c()(c()(c()(r,h.hwr,"success"),h.AzB,"purple"),h.frw,"default"),h.xw4,"error"),h.qQU,"green"),h.GJZ,"red"));return(0,K.jsx)(P.Z,{color:n[t.status],children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.status.".concat(t.status.toLowerCase())})})}},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.priority"}),dataIndex:"priority",hideInSearch:!0,render:function(e,t){var r,n=c()(c()(c()(c()(c()(c()({},h.JTO,"default"),h.sbT,"blue"),h.GMZ,"orange"),h.Bt2,"volcano"),h._Xr,"red"),h.Lx6,"purple");return(0,K.jsx)(P.Z,{color:n[null==t?void 0:t.priority],children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.priority.".concat(null==t||null===(r=t.priority)||void 0===r?void 0:r.toLowerCase())})})}},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),dataIndex:"assignee",hideInSearch:!0,render:function(e,t,r,n){var i;return(0,K.jsx)(P.Z,{color:"blue",children:null==t||null===(i=t.assignee)||void 0===i?void 0:i.nickname})}},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.reporter"}),dataIndex:"reporter",hideInSearch:!0,render:function(e,t,r,n){var i;return(0,K.jsx)(P.Z,{color:"red",children:null==t||null===(i=t.reporter)||void 0===i?void 0:i.nickname})}},{title:(0,K.jsx)(x.FormattedMessage,{id:"ticket.category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(t,r){var n=oe.find((function(e){return e.uid===r.categoryUid}));return n?(0,K.jsx)(P.Z,{color:"green",children:w(n.name)}):(0,K.jsx)(P.Z,{color:"default",children:e.formatMessage({id:"uncategorized",defaultMessage:"Uncategorized"})})}},{title:(0,K.jsx)(x.FormattedMessage,{id:"createdAt"}),dataIndex:"createdAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,r,n){return A()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,K.jsx)(x.FormattedMessage,{id:"updatedAt"}),dataIndex:"updatedAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,r,n){return A()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,K.jsx)(x.FormattedMessage,{id:"action"}),key:"option",dataIndex:"option",hideInSearch:!0,width:200,render:function(e,r){return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(E.ZP,{type:"link",onClick:function(){return N(r),D(!0),void H(!0)},children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.action.edit"})}),(0,K.jsx)(E.ZP,{type:"link",onClick:function(){return e=r,console.log("handleViewTicket",e),N(e),void ie(!0);var e},children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.action.view"})}),(0,K.jsx)(E.ZP,{type:"link",onClick:function(){return e=r,console.log("handleDeleteTicket",e),void X.confirm({title:"确定要删除该工单吗？",onOk:(n=f()(d()().mark((function r(){var n,i;return d()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("onOk"),r.next=3,j(e.uid);case 3:n=r.sent,console.log("deleteTicket response:",n),200===n.code?(v.yw.success(n.message),null===(i=t.current)||void 0===i||i.reload()):v.yw.error(n.message);case 6:case"end":return r.stop()}}),r)}))),function(){return n.apply(this,arguments)})});var e,n},children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.action.delete"})})]})}}],le=function(){var e=f()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,p),t=localStorage.getItem(h.LA8),window.open((0,ee.kG)()+"/api/v1/ticket/export?"+new URLSearchParams({orgUid:(null==k?void 0:k.uid)||"",pageNumber:String(i-1),pageSize:String(p),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(q.Z,{columns:ce,actionRef:t,cardBordered:!0,columnsState:{defaultValue:{description:{show:!1},createdAt:{show:!1},reporter:{show:!1}},persistenceKey:"ticket-table-columns",persistenceType:"localStorage"},request:function(){var e=f()(d()().mark((function e(t,r,n){var i,u,c,l,p;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.current,u=t.pageSize,c=s()(t,ue),o(i),m(u),l=a()(a()({pageNumber:i-1,pageSize:u,orgUid:null==k?void 0:k.uid},(null==M?void 0:M.uid)!==h.zBg&&{categoryUid:null==M?void 0:M.uid}),c),e.next=6,y(l);case 6:return p=e.sent,console.log("queryTicketsByOrgUid response:",p,l),200===p.code||v.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"ticket.list"}),toolBarRender:function(){return[(0,K.jsx)(E.ZP,{type:"primary",onClick:function(){return window.open((0,ee.rl)())},children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.action.open.flow.editor"})}),(0,K.jsx)(E.ZP,{icon:(0,K.jsx)(I.Z,{}),type:"primary",onClick:le,children:(0,K.jsx)(x.FormattedMessage,{id:"ticket.action.export"})},"button")]}}),O&&(0,K.jsx)($,{open:O,isEdit:W,ticket:Y,onClose:function(){D(!1),N(void 0),H(!1)},onSuccess:function(){var e;null===(e=t.current)||void 0===e||e.reload()}}),ne&&(0,K.jsx)(se,{open:ne,ticket:Y,onClose:function(){return ie(!1)}}),Q]})},le=r(95160),de=r(96865),pe=n.Z.Sider,fe=n.Z.Content,me=function(){var e=(0,de.Z)(),t=e.leftSiderStyle,r=e.contentStyle;return(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)(n.Z,{children:[(0,K.jsx)(pe,{style:t,width:250,children:(0,K.jsx)(le.Z,{type:h.FXY})}),(0,K.jsx)(n.Z,{children:(0,K.jsx)(fe,{style:r,children:(0,K.jsx)(ce,{})})})]})})}},19981:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(55735),i=r(44435),a=r(83642),o=r(83890),s=(0,i.Ue)()((0,a.mW)((0,a.tJ)((0,o.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var r=e.memberResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var r=e.memberResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r.splice(n,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:n.PQL})))}}]);