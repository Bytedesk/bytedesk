(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[368],{66097:function(K,F,a){"use strict";var I=a(45332),g=a.n(I),P=a(52983),v=function(d,M){var y=(0,P.useState)(function(){try{var L=localStorage.getItem(d);return L?JSON.parse(L):(localStorage.setItem(d,JSON.stringify(M)),M)}catch(j){return localStorage.setItem(d,JSON.stringify(M)),M}}),S=g()(y,2),x=S[0],B=S[1],b=function(j){var p;if(typeof j=="function"){var T=j;p=T(x)}else p=j;localStorage.setItem(d,JSON.stringify(p)),B(p)};return[x,b]};F.Z=v},67279:function(K,F,a){"use strict";a.r(F),a.d(F,{default:function(){return ae}});var I=a(90819),g=a.n(I),P=a(73193),v=a.n(P),R=a(89933),d=a.n(R),M=a(45332),y=a.n(M),S=a(53936),x=a(32405),B=a(24255),b=a(70127),L=a(79048),j=a(92188),p=a(37778),T=a(46423),W=a(56461),J=a(56306),u=a(77108),V=a(69687),U=a(85667),G=a(11114),H=a(52983),Y=a(63730),k=a(93711),Q=a(66097),E=a(43089),X=E.createLogger({level:"info",format:E.format.json(),transports:[new E.transports.Console]}),q=X,e=a(97458),N=function(Z){var m=Z.content;return(0,e.jsx)(V.Z,{style:{marginBottom:24},message:m,type:"error",showIcon:!0})},_=function(){var Z=U.Z.useApp(),m=Z.message,se=(0,Q.Z)("ACCESS_TOKEN",""),D=y()(se,2),ge=D[0],$=D[1],re=(0,H.useState)("account"),w=y()(re,2),h=w[0],ne=w[1],C=(0,u.useModel)("@@initialState"),A=C.initialState,ce=C.loading,de=C.refresh,te=C.setInitialState,oe=(0,J.l)(function(){return{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('/admin/assets/images/bg-wide.png')",backgroundSize:"100% 100%"}}),i=(0,u.useIntl)(),z=function(){var f=d()(g()().mark(function o(){var n,t;return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,A==null||(n=A.fetchUserInfo)===null||n===void 0?void 0:n.call(A);case 2:t=c.sent,t&&(0,Y.flushSync)(function(){te(function(r){return v()(v()({},r),{},{userInfo:t})})});case 4:case"end":return c.stop()}},o)}));return function(){return f.apply(this,arguments)}}(),le=function(){var f=d()(g()().mark(function o(n){var t,l,c,r;return g()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("handleSubmit values: ",n),s.next=4,(0,S.x4)(v()({},n));case 4:if(t=s.sent,console.log("LoginResult:",t),!t.data.access_token){s.next=15;break}return $(t.data.access_token),l=i.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),m.success(l),s.next=12,z();case 12:return c=new URL(window.location.href).searchParams,u.history.push("/"),s.abrupt("return");case 15:console.log(t),s.next=23;break;case 18:s.prev=18,s.t0=s.catch(0),r=i.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),console.log(s.t0),m.error(r);case 23:case"end":return s.stop()}},o,null,[[0,18]])}));return function(n){return f.apply(this,arguments)}}(),ie=function(){var f=d()(g()().mark(function o(n){var t,l,c,r;return g()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("handleMobileSubmit values: ",n),s.next=4,(0,S.N9)(v()({},n));case 4:if(t=s.sent,console.log("LoginMobileResult:",t),!t.data.access_token){s.next=15;break}return $(t.data.access_token),l=i.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),m.success(l),s.next=12,z();case 12:return c=new URL(window.location.href).searchParams,u.history.push(c.get("redirect")||"/"),s.abrupt("return");case 15:console.log(t),s.next=23;break;case 18:s.prev=18,s.t0=s.catch(0),r=i.formatMessage({id:h==="account"?"pages.login.failure":"pages.login.failureCode",defaultMessage:h==="account"?"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF01":"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),console.log(s.t0),m.error(r);case 23:case"end":return s.stop()}},o,null,[[0,18]])}));return function(n){return f.apply(this,arguments)}}();return(0,e.jsxs)("div",{className:oe,children:[(0,e.jsx)(u.Helmet,{children:(0,e.jsxs)("title",{children:[i.formatMessage({id:"menu.login",defaultMessage:"\u767B\u5F55\u9875"}),"- ",k.Z.title]})}),(0,e.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,e.jsxs)(j.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,e.jsx)("img",{alt:"logo",src:"/admin/assets/images/logo.png"}),title:"\u5FAE\u8BED",subTitle:i.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},actions:[],onFinish:function(){var f=d()(g()().mark(function o(n){var t,l;return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(h!=="account"){r.next=7;break}return t={username:n.username,password:n.password},console.log("login info:",t),r.next=5,le(t);case 5:r.next=11;break;case 7:return l={mobile:n.mobile,code:n.code},console.log("login mobile info:",l),r.next=11,ie(l);case 11:case"end":return r.stop()}},o)}));return function(o){return f.apply(this,arguments)}}(),children:[(0,e.jsx)(G.Z,{activeKey:h,onChange:ne,centered:!0,items:[{key:"account",label:i.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"})},{key:"mobile",label:i.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"})}]}),status==="error"&&h==="account"&&(0,e.jsx)(N,{content:i.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF"})}),h==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(B.Z,{})},placeholder:i.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D"}),rules:[{required:!0,message:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,e.jsx)(p.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(b.Z,{})},placeholder:i.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]}),status==="error"&&h==="mobile"&&(0,e.jsx)(N,{content:"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),h==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(L.Z,{})},name:"mobile",placeholder:i.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,e.jsx)(T.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(b.Z,{})},captchaProps:{size:"large"},placeholder:i.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(o,n){return o?"".concat(n," ").concat(i.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):i.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],onGetCaptcha:function(){var f=d()(g()().mark(function o(n){var t,l;return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("mobile:",n),!(n&&n.length===11)){r.next=13;break}return t={mobile:n},r.next=5,(0,S.Y7)(t);case 5:if(l=r.sent,q.debug("sendMobileCode",l),l.statusCode===200){r.next=10;break}return m.error(l.message),r.abrupt("return");case 10:m.success(l.message),r.next=14;break;case 13:m.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 14:case"end":return r.stop()}},o)}));return function(o){return f.apply(this,arguments)}}()})]}),(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(W.Z,{noStyle:!0,name:"autoLogin",children:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"\u81EA\u52A8\u767B\u5F55"})}),(0,e.jsx)("div",{style:{float:"right"},children:(0,e.jsx)(u.Link,{to:"/auth/register",children:(0,e.jsx)(u.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})})})]})]})}),(0,e.jsx)(x.$_,{})]})},ee=function(){return(0,e.jsx)(U.Z,{children:(0,e.jsx)(_,{})})},ae=ee},41559:function(){},2838:function(){},15325:function(){},22810:function(){},76574:function(){},31653:function(){},31935:function(){},52209:function(){}}]);
