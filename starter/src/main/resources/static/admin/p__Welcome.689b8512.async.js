"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8185],{17208:function(e,t,r){r.d(t,{Kq:function(){return l},RL:function(){return g}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),u=r.n(i),c=r(55735),d=r(30921);function l(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2041:function(e,t,r){r.d(t,{bN:function(){return m},fk:function(){return d}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),u=r.n(i),c=r(30921);function d(e){return l.apply(this,arguments)}function l(){return(l=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/thread/query/org",{method:"GET",params:s()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/thread/process/history/activity",{method:"GET",params:s()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,r){r.d(t,{D$:function(){return g},EP:function(){return x},hS:function(){return f},z_:function(){return l}});var n=r(90819),a=r.n(n),o=r(73193),s=r.n(o),i=r(89933),u=r.n(i),c=r(55735),d=r(30921);function l(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:s()(s()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},32289:function(e,t,r){r.r(t),r.d(t,{default:function(){return oe}});var n=r(45332),a=r.n(n),o=r(40612),s=r(55735),i=r(65461),u=r(30921),c=r(44194),d=r(90819),l=r.n(d),m=r(89933),g=r.n(m),p=r(53530),f=r(75365),h=r(52288),x=r(86803),b=r(17208),v=r(31549),y=function(e){var t=e.open,r=e.onClose,n=e.onSuccess,o=(0,u.useIntl)(),s=((0,u.useModel)("@@initialState").initialState||{}).userInfo,i=(0,c.useState)(!1),d=a()(i,2),m=d[0],y=d[1],M=(0,c.useState)(""),j=a()(M,2),w=j[0],S=j[1],q=(0,c.useState)(!1),k=a()(q,2),C=k[0],I=k[1],F=function(){var e=g()(l()().mark((function e(){var t,a,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==w){e.next=3;break}return x.yw.error(o.formatMessage({id:"welcome.message.org.name.required"})),e.abrupt("return");case 3:return y(!0),x.yw.loading(o.formatMessage({id:"welcome.message.org.creating"})),t=null!=s&&s.mobile?null==s?void 0:s.mobile:null==s?void 0:s.email,a={name:w,code:t,logo:"https://www.weiyuai.cn/logo.png",description:w+"description"},e.prev=7,e.next=10,(0,b.Kq)(a);case 10:200===(i=e.sent).code?(y(!1),x.yw.destroy(),x.yw.success(o.formatMessage({id:"welcome.message.create.success"})),n(i.data),r()):(y(!1),x.yw.destroy(),x.yw.error(o.formatMessage({id:"welcome.message.create.failed"}))),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(7),y(!1),x.yw.destroy(),x.yw.error(o.formatMessage({id:"welcome.message.create.failed"}));case 19:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)(p.Z,{title:o.formatMessage({id:"welcome.modal.title"}),closable:!1,open:t,onCancel:function(){x.yw.error(o.formatMessage({id:"welcome.message.org.required"}))},maskClosable:!1,footer:[(0,v.jsx)(f.ZP,{type:"primary",onClick:function(){r()},disabled:!0,children:o.formatMessage({id:"welcome.modal.join"})},"join"),(0,v.jsx)(f.ZP,{type:"primary",loading:m,onClick:function(){C?F():(I(!0),y(!1))},children:o.formatMessage({id:"welcome.modal.create"})},"create")],children:[(0,v.jsx)("p",{children:o.formatMessage({id:"welcome.modal.description"})}),C&&(0,v.jsx)(h.Z,{placeholder:o.formatMessage({id:"welcome.modal.input.placeholder"}),value:w,onChange:function(e){return S(e.target.value)},onPressEnter:F,autoFocus:!0})]})},M=function(e){var t=e.open,r=e.onClose,n=(0,u.useIntl)(),a=(0,u.useNavigate)(),o=function(){localStorage.setItem("skipVerification","true"),r()};return(0,v.jsx)(p.Z,{title:n.formatMessage({id:"welcome.verify.modal.title",defaultMessage:"账号验证提示"}),open:t,onCancel:o,footer:[(0,v.jsx)(f.ZP,{onClick:o,children:n.formatMessage({id:"welcome.verify.later",defaultMessage:"稍后验证"})},"later"),(0,v.jsx)(f.ZP,{type:"primary",onClick:function(){r(),a("/setting/certification")},children:n.formatMessage({id:"welcome.verify.now",defaultMessage:"立即验证"})},"now")],children:(0,v.jsx)("p",{children:n.formatMessage({id:"welcome.verify.modal.description",defaultMessage:"您的邮箱和手机号尚未验证，为保障账号安全，建议您尽快完成验证。"})})})},j=r(73589),w=r(8247),S=r(73193),q=r.n(S),k=r(84176),C=r.n(k);function I(e){return F.apply(this,arguments)}function F(){return(F=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/agent/status/query/org",{method:"GET",params:q()(q()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=r(76750),O=r(44521),A=r(25588),z=r(29266),Z=r(28977),$=r.n(Z),N=["current","pageSize"],P=function(){var e=(0,u.useIntl)(),t=(0,c.useRef)(),r=((0,T.Z)().translateString,(0,c.useState)(1)),n=a()(r,2),s=(n[0],n[1]),i=(0,c.useState)(10),d=a()(i,2),m=(d[0],d[1]),p=(0,o.u)((function(e){return e.currentOrg})),f=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,v.jsx)(u.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,render:function(e,t){var r;return(0,v.jsx)(v.Fragment,{children:null==t||null===(r=t.agent)||void 0===r?void 0:r.nickname})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!0,render:function(e,t){return"AVAILABLE"===t.status?(0,v.jsx)(z.Z,{color:"green",children:(0,v.jsx)(u.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,v.jsx)(z.Z,{color:"red",children:(0,v.jsx)(u.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,v.jsx)(z.Z,{color:"orange",children:(0,v.jsx)(u.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,v.jsx)(u.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,render:function(e,t,r,n){return $()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}];return(0,v.jsx)(A.Z,{columns:f,actionRef:t,cardBordered:!0,request:function(){var e=g()(l()().mark((function e(t,r,n){var a,o,i,u,c;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,r,n),a=t.current,o=t.pageSize,i=C()(t,N),s(a),m(o),u=q()({pageNumber:a-1,pageSize:o,orgUid:null==p?void 0:p.uid},i),e.next=7,I(u);case 7:return c=e.sent,console.log("queryAgentStatusByOrg response:",u,c),200===c.code||x.yw.error(c.message),e.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"})})},E=r(85916),B=r(44781);r(1902),r(95490),r(24170),r(72614);r(32327).Z.Title,E.default.RangePicker,B.Z.Option;function Y(e){return R.apply(this,arguments)}function R(){return(R=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/queue/member/query/org",{method:"GET",params:q()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=r(88721),D=r(11090),L=r(2041),U=r(73669),V=r(19981),W=r(80556),Q=r(73442),G=r(80601),K=r(51004),_=function(e){var t=e.thread,r=e.drawerOpen,n=void 0!==r&&r,a=e.onClose,o=(0,u.useIntl)();return(0,v.jsx)(Q.Z,{title:o.formatMessage({id:"thread.process.steps.title",defaultMessage:"会话处理流程"}),placement:"right",closable:!0,onClose:a,open:n,width:500,children:(0,v.jsx)(J,{thread:t,isDrawer:!0})})},J=function(e){var t=e.thread,r=e.isDrawer,n=void 0!==r&&r,s=(0,o.u)((function(e){return e.currentOrg})),i=(0,c.useState)([]),d=a()(i,2),m=d[0],p=d[1],h=(0,c.useState)(!1),b=a()(h,2),y=b[0],M=b[1];(0,u.useIntl)();console.log("currentThread",t,y);var w=(0,V.Z)(),S=w.memberResult,q=w.setMemberResult,k=function(){var e=g()(l()().mark((function e(){var r,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),r={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid},e.next=7,(0,L.bN)(r);case 7:n=e.sent,console.log("queryThreadProcessHistoryActivity response:",n.data),200===n.code?p(n.data||[]):(console.log("queryThreadProcessHistoryActivity error:",n.data),x.yw.error(n.message)),M(!1),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Fetch thread history error:",e.t0),x.yw.error("获取工单历史记录失败"),M(!1);case 18:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=g()(l()().mark((function e(){var t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==s?void 0:s.uid},e.next=4,(0,U.z_)(t);case 4:200===(r=e.sent).code?(x.yw.destroy(),q(r)):x.yw.destroy();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){I()}),[t]);var I=function(){k(),C()},F=function(e){if(!e)return"-";var t=S.data.content.find((function(t){return t.uid===e}));return(null==t?void 0:t.nickname)||""},T=n?{}:{maxHeight:"400px",overflowY:"auto"};return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(G.Z,{spinning:y,children:(0,v.jsxs)("div",{style:T,children:[(0,v.jsx)(f.ZP,{type:"primary",shape:"circle",icon:(0,v.jsx)(W.Z,{}),size:"small",onClick:I,style:{position:"absolute",top:"10px",right:"10px",zIndex:1},title:"刷新"}),(0,v.jsx)(K.Z,{direction:"vertical",size:"small",current:m.length-1,style:{padding:"16px"},items:m.map((function(e,t){var r,n;return{title:(n=null==e?void 0:e.activityName,n||"活动"),description:(0,v.jsxs)("div",{children:[(null==e?void 0:e.assignee)&&(0,v.jsxs)("div",{children:["处理人: ",F(null==e?void 0:e.assignee)||(null==e?void 0:e.assignee)]}),(0,v.jsxs)("div",{children:["处理时间: ",(null===(r=e.startTime)||void 0===r?void 0:r.toLocaleString())||"-"]})]}),status:t===m.length-1?"process":"finish"}}))}),0===m.length&&(0,v.jsx)(j.Z,{description:"请选择工单查看流转过程"})]})})})},X=["current","pageSize"],ee=function(){var e=(0,u.useIntl)(),t=(0,c.useRef)(),r=(0,T.Z)().translateString,n=(0,c.useState)(1),i=a()(n,2),d=i[0],m=i[1],p=(0,c.useState)(10),h=a()(p,2),b=h[0],y=h[1],M=(0,o.u)((function(e){return e.currentOrg})),j=(0,c.useState)(!1),w=a()(j,2),S=w[0],k=w[1],I=(0,c.useState)(),F=a()(I,2),z=F[0],Z=(F[1],[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.nickname"}),dataIndex:"visitorNickname",fixed:"left",width:100,copyable:!0,render:function(e,t){var n;return r(null==t||null===(n=t.thread)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.nickname)}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.number"}),dataIndex:"queueNumber",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.queueNickname"}),dataIndex:"queueNickname",copyable:!0,width:100,hideInSearch:!0,render:function(e,t){var n;return r(null==t||null===(n=t.queue)||void 0===n?void 0:n.nickname)}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robot"}),dataIndex:"robotNickname",copyable:!0,render:function(e,t){var n,a=null==t||null===(n=t.thread)||void 0===n?void 0:n.robot;return r(null==a?void 0:a.nickname)}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.waitTime"}),dataIndex:"waitTime",hideInSearch:!0,render:function(e,t){if(!t.waitTime&&0!==t.waitTime)return"-";var r=Math.floor(t.waitTime/60),n=t.waitTime%60;return r>0?"".concat(r,"分").concat(n,"秒"):"".concat(n,"秒")}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.enqueueTime"}),dataIndex:"enqueueTime",hideInSearch:!0,render:function(e,t){return $()(null==t?void 0:t.visitorEnqueueTime).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.status"}),dataIndex:"status",hideInSearch:!0,render:function(e,t){var r;switch(null==t||null===(r=t.thread)||void 0===r?void 0:r.status){case s.ach:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.new"});case s.j0C:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.roboting"});case s.Q7C:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.offline"});case s.v1N:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.queuing"});case s.hl2:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.chatting"});case s.V1n:return(0,v.jsx)(u.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robotAcceptType"}),dataIndex:"robotAcceptType",hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.robotAcceptType){case"AUTO":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.auto"});case"MANUAL":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.manual"});case"ROBOT":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.robot"});default:return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.unknown"})}}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robotAcceptTime"}),dataIndex:"robotAcceptTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotAcceptTime?$()(null==t?void 0:t.robotAcceptTime).format("YYYY-MM-DD HH:mm:ss"):"未接入"}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robotToAgent"}),dataIndex:"robotToAgent",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.offline.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.offline.no"})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robotToAgentTime"}),dataIndex:"robotToAgentTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?$()(null==t?void 0:t.robotToAgentTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.agent"}),dataIndex:"agentNickname",copyable:!0,render:function(e,t){var n,a=JSON.parse((null==t||null===(n=t.thread)||void 0===n?void 0:n.agent)||"{}");return r(null==a?void 0:a.nickname)}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.offline"}),dataIndex:"agentOffline",hideInSearch:!0,render:function(e,t){return null!=t&&t.robotToAgent?null!=t&&t.agentOffline?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.offline.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.offline.no"}):"-"}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.agentAcceptType"}),dataIndex:"agentAcceptType",hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.agentAcceptType){case"AUTO":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.auto"});case"MANUAL":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.manual"});case"ROBOT":return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.robot"});default:return(0,v.jsx)(u.FormattedMessage,{id:"queue.member.acceptType.unknown"})}}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.agentAcceptTime"}),dataIndex:"agentAcceptTime",hideInSearch:!0,render:function(e,t){return null!=t&&t.agentAcceptTime?$()(null==t?void 0:t.agentAcceptTime).format("YYYY-MM-DD HH:mm:ss"):"未接入"}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.solved"}),dataIndex:"resolved",hideInSearch:!0,render:function(e,t){return t.resolved?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.solved.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.solved.no"})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.rated"}),dataIndex:"rated",hideInSearch:!0,render:function(e,t){return t.rated?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.rated.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.rated.no"})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.rateAt"}),dataIndex:"rateAt",hideInSearch:!0,render:function(e,t){return null!=t&&t.rateAt?$()(null==t?void 0:t.rateAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.summarized"}),dataIndex:"summarized",hideInSearch:!0,render:function(e,t){return t.summarized?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.summarized.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.summarized.no"})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.visitorMessageCount"}),dataIndex:"visitorMessageCount",hideInSearch:!0,render:function(e,t){return t.visitorMessageCount||0}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.agentMessageCount"}),dataIndex:"agentMessageCount",hideInSearch:!0,render:function(e,t){return t.agentMessageCount||0}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.robotMessageCount"}),dataIndex:"robotMessageCount",hideInSearch:!0,render:function(e,t){return t.robotMessageCount||0}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.leaveMsg"}),dataIndex:"leaveMsg",hideInSearch:!0,render:function(e,t){return t.leaveMsg?(0,v.jsx)(u.FormattedMessage,{id:"queue.member.leaveMsg.yes"}):(0,v.jsx)(u.FormattedMessage,{id:"queue.member.leaveMsg.no"})}},{title:(0,v.jsx)(u.FormattedMessage,{id:"client"}),dataIndex:"client",copyable:!0,hideInSearch:!0,render:function(e,t){var r;return(0,H.qF)(null==t||null===(r=t.thread)||void 0===r?void 0:r.client)}}]);var N=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",d,b),t=localStorage.getItem(s.LA8),window.open((0,O.kG)()+"/api/v1/queue/member/export?"+new URLSearchParams({orgUid:(null==M?void 0:M.uid)||"",pageNumber:String(d-1),pageSize:String(b),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(A.Z,{columns:Z,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=g()(l()().mark((function t(r,n,a){var o,s,i,u,c;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",r,n,a),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=r.current,s=r.pageSize,i=C()(r,X),m(o),y(s),u=q()({pageNumber:o-1,pageSize:s,orgUid:null==M?void 0:M.uid},i),t.next=8,Y(u);case 8:return c=t.sent,console.log("queryQueueMembersByOrg response:",u,c),x.yw.destroy(),200===c.code||x.yw.error(c.message),t.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"queue.member.list"}),toolBarRender:function(){return[(0,v.jsx)(f.ZP,{icon:(0,v.jsx)(D.Z,{}),type:"primary",onClick:N,children:(0,v.jsx)(u.FormattedMessage,{id:"queue.member.export"})},"button")]},columnsState:{persistenceKey:"queue-member-table",defaultValue:{}},options:{setting:{draggable:!0,checkable:!0,checkedReset:!0,extra:[(0,v.jsx)("a",{onClick:function(){var e,r;null===(e=t.current)||void 0===e||null===(r=e.reset)||void 0===r||r.call(e)},children:(0,v.jsx)(u.FormattedMessage,{id:"table.columns.reset"})},"reset")]}}}),(0,v.jsx)(_,{thread:z,drawerOpen:S,onClose:function(){return k(!1)}})]})},te=r(87491),re=["current","pageSize"],ne=function(){var e=(0,u.useIntl)(),t=(0,c.useRef)(),r=(0,T.Z)().translateString,n=(0,c.useState)(1),i=a()(n,2),d=i[0],m=i[1],p=(0,c.useState)(10),h=a()(p,2),b=h[0],y=h[1],M=(0,o.u)((function(e){return e.currentOrg})),j=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.nickname"}),dataIndex:"nickname",copyable:!0,width:150,fixed:"left",render:function(e,t){return r(null==t?void 0:t.nickname)}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.type"}),dataIndex:"type",hideInSearch:!0,render:function(e,t){switch(t.type){case s.VXt:return(0,v.jsx)(u.FormattedMessage,{id:"queue.type.workgroup"});case s.BOH:return(0,v.jsx)(u.FormattedMessage,{id:"queue.type.agent"});case s.aOw:return(0,v.jsx)(u.FormattedMessage,{id:"queue.type.robot"});default:return(0,v.jsx)(u.FormattedMessage,{id:"queue.type.unknown"})}}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.day"}),dataIndex:"day",valueType:"date",search:{transform:function(e){return $()(e).format("YYYY-MM-DD")}}},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.totalCount"}),dataIndex:"totalCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.offlineCount"}),dataIndex:"offlineCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.leaveMsgCount"}),dataIndex:"leaveMsgCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.robotToAgentCount"}),dataIndex:"robotToAgentCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.queuingCount"}),dataIndex:"queuingCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.chattingCount"}),dataIndex:"chattingCount",hideInSearch:!0},{title:(0,v.jsx)(u.FormattedMessage,{id:"queue.closedCount"}),dataIndex:"closedCount",hideInSearch:!0}],w=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",d,b),t=localStorage.getItem(s.LA8),window.open((0,O.kG)()+"/api/v1/queue/export?"+new URLSearchParams({orgUid:(null==M?void 0:M.uid)||"",pageNumber:String(d-1),pageSize:String(b),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsx)(A.Z,{columns:j,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var t=g()(l()().mark((function t(r,n,a){var o,s,i,u,c;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",r,n,a),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=r.current,s=r.pageSize,i=C()(r,re),m(o),y(s),u=q()({pageNumber:o-1,pageSize:s,orgUid:null==M?void 0:M.uid},i),t.next=8,(0,te.Wq)(u);case 8:return c=t.sent,console.log("queryQueuesByOrg response:",u,c),x.yw.destroy(),200===c.code||x.yw.error(c.message),t.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"queue.list"}),toolBarRender:function(){return[(0,v.jsx)(f.ZP,{icon:(0,v.jsx)(D.Z,{}),type:"primary",onClick:w,children:(0,v.jsx)(u.FormattedMessage,{id:"queue.export"})},"button")]}})},ae=function(){var e=[{key:"queue",label:(0,v.jsx)(u.FormattedMessage,{id:"queue.tab.list"}),children:(0,v.jsx)(ne,{})},{key:"queue_member",label:(0,v.jsx)(u.FormattedMessage,{id:"queue.tab.member"}),children:(0,v.jsx)(ee,{})},{key:"agent_status",label:(0,v.jsx)(u.FormattedMessage,{id:"agent.status.log"}),children:(0,v.jsx)(P,{})}];return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(w.Z,{defaultActiveKey:"queue",items:e,style:{padding:"10px"}})})},oe=function(){var e=((0,u.useModel)("@@initialState").initialState||{}).userInfo,t=(0,o.u)((function(e){return e.setCurrentOrg})),r=(0,u.useAccess)();r.canDebug&&console.log("Developing canDebug");var n=(0,c.useState)(!1),d=a()(n,2),l=d[0],m=d[1],g=(0,c.useState)(!1),p=a()(g,2),f=p[0],h=p[1];return(0,c.useEffect)((function(){!function(){if(e){if(!e.currentOrganization)return console.log("before initOrganization",e),void(e.platform===s.Ogg&&m(!0));console.log("after initOrganization"),t(e.currentOrganization)}}(),"true"!==localStorage.getItem("skipVerification")&&(!e||e.emailVerified||e.mobileVerified||h(!0)),(0,i.Bc)()&&console.log("weiyuaiSaas")}),[e]),(0,v.jsxs)("div",{children:[(0,v.jsx)(u.Access,{accessible:r.canAdmin(),fallback:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(j.Z,{description:"欢迎"})}),children:(0,v.jsx)(ae,{})}),(0,v.jsx)(y,{open:l,onClose:function(){return m(!1)},onSuccess:function(e){t(e),window.location.reload()}}),(0,v.jsx)(M,{open:f,onClose:function(){return h(!1)}})]})}},19981:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(55735),a=r(44435),o=r(83642),s=r(83890),i=(0,a.Ue)()((0,o.mW)((0,o.tJ)((0,s.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var r=e.memberResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var r=e.memberResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r.splice(n,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:n.PQL})))},29266:function(e,t,r){r.d(t,{Z:function(){return T}});var n=r(44194),a=r(51865),o=r.n(a),s=r(97859),i=r(63125),u=r(80314),c=r(79145),d=r(18011),l=r(37167),m=r(47825),g=r(87471),p=r(88874),f=r(77167),h=r(65759);const x=e=>{const{lineWidth:t,fontSizeIcon:r,calc:n}=e,a=e.fontSizeSM;return(0,f.IX)(e,{tagFontSize:a,tagLineHeight:(0,m.bf)(n(e.lineHeightSM).mul(a).equal()),tagIconSize:n(r).sub(n(t).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},b=e=>({defaultBg:new g.t(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText});var v=(0,h.I$)("Tag",(e=>(e=>{const{paddingXXS:t,lineWidth:r,tagPaddingHorizontal:n,componentCls:a,calc:o}=e,s=o(n).sub(r).equal(),i=o(t).sub(r).equal();return{[a]:Object.assign(Object.assign({},(0,p.Wf)(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:s,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${(0,m.bf)(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${a}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${a}-close-icon`]:{marginInlineStart:i,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${a}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${a}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:s}}),[`${a}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}})(x(e))),b),y=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const M=n.forwardRef(((e,t)=>{const{prefixCls:r,style:a,className:s,checked:i,onChange:u,onClick:c}=e,d=y(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:m,tag:g}=n.useContext(l.E_),p=m("tag",r),[f,h,x]=v(p),b=o()(p,`${p}-checkable`,{[`${p}-checkable-checked`]:i},null==g?void 0:g.className,s,h,x);return f(n.createElement("span",Object.assign({},d,{ref:t,style:Object.assign(Object.assign({},a),null==g?void 0:g.style),className:b,onClick:e=>{null==u||u(!i),null==c||c(e)}})))}));var j=M,w=r(85772);var S=(0,h.bk)(["Tag","preset"],(e=>(e=>(0,w.Z)(e,((t,r)=>{let{textColor:n,lightBorderColor:a,lightColor:o,darkColor:s}=r;return{[`${e.componentCls}${e.componentCls}-${t}`]:{color:n,background:o,borderColor:a,"&-inverse":{color:e.colorTextLightSolid,background:s,borderColor:s},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}})))(x(e))),b);const q=(e,t,r)=>{const n="string"!=typeof(a=r)?a:a.charAt(0).toUpperCase()+a.slice(1);var a;return{[`${e.componentCls}${e.componentCls}-${t}`]:{color:e[`color${r}`],background:e[`color${n}Bg`],borderColor:e[`color${n}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}};var k=(0,h.bk)(["Tag","status"],(e=>{const t=x(e);return[q(t,"success","Success"),q(t,"processing","Info"),q(t,"error","Error"),q(t,"warning","Warning")]}),b),C=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const I=n.forwardRef(((e,t)=>{const{prefixCls:r,className:a,rootClassName:m,style:g,children:p,icon:f,color:h,onClose:x,bordered:b=!0,visible:y}=e,M=C(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:j,direction:w,tag:q}=n.useContext(l.E_),[I,F]=n.useState(!0),T=(0,s.Z)(M,["closeIcon","closable"]);n.useEffect((()=>{void 0!==y&&F(y)}),[y]);const O=(0,i.o2)(h),A=(0,i.yT)(h),z=O||A,Z=Object.assign(Object.assign({backgroundColor:h&&!z?h:void 0},null==q?void 0:q.style),g),$=j("tag",r),[N,P,E]=v($),B=o()($,null==q?void 0:q.className,{[`${$}-${h}`]:z,[`${$}-has-color`]:h&&!z,[`${$}-hidden`]:!I,[`${$}-rtl`]:"rtl"===w,[`${$}-borderless`]:!b},a,m,P,E),Y=e=>{e.stopPropagation(),null==x||x(e),e.defaultPrevented||F(!1)},[,R]=(0,u.Z)((0,u.w)(e),(0,u.w)(q),{closable:!1,closeIconRender:e=>{const t=n.createElement("span",{className:`${$}-close-icon`,onClick:Y},e);return(0,c.wm)(e,t,(e=>({onClick:t=>{var r;null===(r=null==e?void 0:e.onClick)||void 0===r||r.call(e,t),Y(t)},className:o()(null==e?void 0:e.className,`${$}-close-icon`)})))}}),H="function"==typeof M.onClick||p&&"a"===p.type,D=f||null,L=D?n.createElement(n.Fragment,null,D,p&&n.createElement("span",null,p)):p,U=n.createElement("span",Object.assign({},T,{ref:t,className:B,style:Z}),L,R,O&&n.createElement(S,{key:"preset",prefixCls:$}),A&&n.createElement(k,{key:"status",prefixCls:$}));return N(H?n.createElement(d.Z,{component:"Tag"},U):U)})),F=I;F.CheckableTag=j;var T=F}}]);