"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8659],{32045:function(e,n,t){t.d(n,{XS:function(){return d},k4:function(){return g},uu:function(){return v},yr:function(){return y}});var r=t(90819),a=t.n(r),u=t(73193),o=t.n(u),s=t(89933),i=t.n(s),c=t(55735),l=t(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return w.apply(this,arguments)}function w(){return(w=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95160:function(e,n,t){t.d(n,{Z:function(){return j}});var r=t(90819),a=t.n(r),u=t(89933),o=t.n(u),s=t(45332),i=t.n(s),c=t(15722),l=t(53530),d=t(27487),f=t(75365),g=t(79777),p=t(88996),y=t(86803),h=t(76750),v=t(6397),w=t(40612),m=t(69169),b=t(4499),k=t(84881),x=t(44194),C=t(90838),M=t(55735),S=t(31549),K=function(e){var n,t=e.open,r=e.level,u=e.type,s=e.isEdit,c=e.onCancel,d=e.onSubmit,f=m.A.useForm(),g=i()(f,1)[0],p=(0,h.Z)().translateString,K=(0,w.u)((function(e){return e.currentOrg})),R=(0,v.j)((function(e){return e.kbaseResult})),L=(0,v.j)((function(e){return e.currentKbase})),j=(0,C.v)((function(e){return e.currentCategory}));(0,x.useEffect)((function(){s?g.setFieldsValue({name:p(null==j?void 0:j.name)}):g.resetFields(),g.setFieldsValue({kbUid:null==L?void 0:L.uid})}),[t,s]);var O=function(){g.validateFields().then(function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:s?null==j?void 0:j.uid:"",name:n.name,level:r,type:u,kbUid:n.kbUid,orgUid:null==K?void 0:K.uid},d(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),y.yw.error("创建分类失败")}))};return(0,S.jsx)("div",{children:(0,S.jsx)(l.Z,{title:s?"编辑分类":"创建分类",open:t,forceRender:!0,onOk:O,onCancel:c,getContainer:!1,children:(0,S.jsxs)(m.A,{form:g,name:"categoryForm",submitter:!1,children:[(0,S.jsx)(b.Z,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&O()},placeholder:"请输入分类名称"}}),u!==M.Kvk&&u!==M.hcJ&&(0,S.jsx)(k.Z,{name:"kbUid",label:"所属知识库",allowClear:!0,options:null==R||null===(n=R.data)||void 0===n?void 0:n.content.map((function(e){return{label:p(e.name),value:e.uid}}))})]})})})},R=t(30921),L=t(28425),j=function(e){var n=e.type,t=(0,R.useIntl)(),r=(0,x.useState)(!0),u=i()(r,2),s=u[0],m=u[1],b=(0,w.u)((function(e){return e.currentOrg})),k=(0,v.j)((function(e){return e.currentKbase})),j=(0,x.useState)(!1),O=i()(j,2),U=O[0],Z=O[1],z=(0,C.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),T=z.categoryTreeOptions,F=z.currentCategory,B=z.setCurrentCategoryUid,E=(0,h.Z)(),D=E.translateString,P=E.translateStringTranct,V=l.Z.useModal(),q=i()(V,2),W=q[0],I=q[1],A=function(){var e=o()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={showLoading:!0,loadingMessage:t.formatMessage({id:s?"updating":"creating"}),successMessage:t.formatMessage({id:s?"update.success":"create.success"}),errorMessage:t.formatMessage({id:s?"update.error":"create.error",defaultMessage:s?"Update failed":"Create failed"})},!s){e.next=7;break}return e.next=4,(0,L.ht)(n,r);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,L.i8)(n,r);case 9:e.t0=e.sent;case 10:e.t0&&(Z(!1),X());case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=o()(a()().mark((function e(){var r,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n===M.FXY||n===M.Kvk,u=r?"":null==k?void 0:k.uid,e.next=4,(0,L.HK)(n,null==b?void 0:b.uid,u,{showLoading:!0,loadingMessage:t.formatMessage({id:"loading"}),errorMessage:t.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m(!0),Z(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,L.sT)(n,{showLoading:!0,loadingMessage:t.formatMessage({id:"deleting"}),successMessage:t.formatMessage({id:"delete.success"}),errorMessage:t.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&X();case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){n!==M.FXY&&X()}),[k]),(0,x.useEffect)((function(){n!==M.FXY&&n!==M.Kvk||X()}),[]);return(0,S.jsxs)("div",{children:[(0,S.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{padding:"5px"},children:[(0,S.jsx)(f.ZP,{type:"primary",size:"small",onClick:function(){m(!1),Z(!0)},children:t.formatMessage({id:"create.category"})}),(0,S.jsx)(f.ZP,{size:"small",onClick:X,children:t.formatMessage({id:"refresh"})}),""!==(null==F?void 0:F.uid)&&(null==F?void 0:F.uid)!==M.zBg&&(0,S.jsx)(f.ZP,{size:"small",onClick:H,children:t.formatMessage({id:"edit"})}),""!==(null==F?void 0:F.uid)&&(null==F?void 0:F.uid)!==M.zBg&&(0,S.jsx)(f.ZP,{onClick:function(){return function(e){e.uid!==M.zBg?W.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(c.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(D(e.name),"】？"),onOk:function(){J(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})}):y.yw.error(t.formatMessage({id:"delete.dept.all.error"}))}(F)},size:"small",style:{float:"right"},danger:!0,children:t.formatMessage({id:"delete"})})]}),(0,S.jsx)(g.Z,{defaultSelectedKeys:[null==F?void 0:F.uid],selectedKeys:[null==F?void 0:F.uid],onSelect:function(e,n){0!==e.length&&B(e[0].toString())},treeData:T,blockNode:!0,titleRender:function(e){return(0,S.jsx)(p.Z,{title:D(e.title),children:P(e.title)})}}),U&&(0,S.jsx)(K,{open:U,type:n,isEdit:s,onCancel:function(){Z(!1)},onSubmit:A}),I]})}},96865:function(e,n,t){var r=t(23864);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,n,t){var r=t(55735),a=t(65461),u=t(30921);n.Z=function(){var e=(0,u.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},28425:function(e,n,t){t.d(n,{HK:function(){return l},ht:function(){return f},i8:function(){return d},sT:function(){return g}});var r=t(90819),a=t.n(r),u=t(89933),o=t.n(u),s=t(86803),i=t(32045),c=t(90838),l=function(){var e=o()(a()().mark((function e(n,t,r,u){var o,l,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.v.getState().setCategoryResult,null!=u&&u.showLoading&&s.yw.loading((null==u?void 0:u.loadingMessage)||"Loading..."),l={pageNumber:0,pageSize:(null==u?void 0:u.pageSize)||50,type:n,kbUid:r,orgUid:t},e.prev=3,e.next=6,(0,i.XS)(l);case 6:if(d=e.sent,console.log("queryCategoriesByOrg response: ",d,l),200!==d.code){e.next=14;break}return o(d),null!=u&&u.showLoading&&s.yw.destroy(),e.abrupt("return",d);case 14:return null!=u&&u.showLoading&&s.yw.destroy(),s.yw.error(d.message),e.abrupt("return",null);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(3),null!=u&&u.showLoading&&s.yw.destroy(),s.yw.error((null==u?void 0:u.errorMessage)||"Failed to fetch categories"),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(n,t,r,a){return e.apply(this,arguments)}}(),d=function(){var e=o()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&s.yw.loading((null==t?void 0:t.loadingMessage)||"Creating..."),e.prev=1,e.next=4,(0,i.k4)(n);case 4:if(r=e.sent,console.log("createCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.success((null==t?void 0:t.successMessage)||"Create Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error((null==t?void 0:t.errorMessage)||"Failed to create category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}(),f=function(){var e=o()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&s.yw.loading((null==t?void 0:t.loadingMessage)||"Updating..."),e.prev=1,e.next=4,(0,i.yr)(n);case 4:if(r=e.sent,console.log("updateCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.success((null==t?void 0:t.successMessage)||"Update Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error((null==t?void 0:t.errorMessage)||"Failed to update category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}(),g=function(){var e=o()(a()().mark((function e(n,t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=t&&t.showLoading&&s.yw.loading((null==t?void 0:t.loadingMessage)||"Deleting..."),e.prev=1,e.next=4,(0,i.uu)(n);case 4:if(r=e.sent,console.log("deleteCategory response:",r),200!==r.code){e.next=12;break}return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.success((null==t?void 0:t.successMessage)||"Delete Success"),e.abrupt("return",r);case 12:return null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error(r.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=t&&t.showLoading&&s.yw.destroy(),s.yw.error((null==t?void 0:t.errorMessage)||"Failed to delete category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(n,t){return e.apply(this,arguments)}}()},90838:function(e,n,t){t.d(n,{v:function(){return d}});var r=t(76711),a=t.n(r),u=t(73193),o=t.n(u),s=t(55735),i=t(44435),c=t(83642),l=t(83890),d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,n){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:s.zBg,name:s.zBg},setCategoryResult:function(n){var t=function(e){var n=[];return e.data.content.forEach((function(e){var t={label:e.name,value:e.uid};n.push(t)})),n}(n),r={uid:s.zBg,name:s.zBg},u=o()(o()({},n),{},{data:{content:[r].concat(a()(n.data.content))}}),i=function(e){var n=[];return e.data.content.forEach((function(e){var t={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(t.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),n.push(t)})),n}(u);e({categoryResult:u,categoryTreeOptions:i,categorySelectOptions:t}),e({currentCategory:{uid:s.zBg,name:s.zBg}})},insertCategory:function(n){e((function(e){e.categoryResult.data.content.unshift(n)}))},upgradeCategory:function(n){e((function(e){var t=e.categoryResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Category with uid ".concat(n.uid," not found."))}))},setCurrentCategory:function(n){e({currentCategory:n})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:s.zBg,name:s.zBg}})},setCurrentCategoryUid:function(t){var r=n().categoryResult.data.content.find((function(e){return e.uid===t}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:s.OMm})))},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),u=t(76711),o=t.n(u),s=t(55735),i=t(44435),c=t(83642),l=t(83890),d=(0,i.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,u=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==u){var s=[].concat(o()(r.slice(0,u)),[t],o()(r.slice(u+1))),i=a()(a()({},n().kbaseResult),{},{data:{content:s}});e({kbaseResult:i,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,u=r.findIndex((function(e){return e.uid===t}));-1!==u?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,u)),o()(r.slice(u+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:s.wKE})))}}]);