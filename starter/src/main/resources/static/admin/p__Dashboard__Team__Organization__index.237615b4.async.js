"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4822],{22014:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(38404),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=t(5901),i=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var l=a.forwardRef(i)},43420:function(e,n,t){t.d(n,{G:function(){return g}});var r=t(73193),a=t.n(r),s=(t(44194),t(6960)),o=t(27353),i=t(96596),l=t.n(i),u=t(97765),d=t(50884),c=t(61476),f=t(31549),g=function(e){var n=e.children,t=e.onSuccess,r=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},g={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var n=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=n,i.fileType=e.type,u.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var n,a=null===(n=e.file.response)||void 0===n?void 0:n.data.fileUrl;t(a),d.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,f.jsx)(s.Z,a()(a()({},g),{},{children:n}))}},90938:function(e,n,t){var r=t(96775);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},61519:function(e,n,t){t.r(n),t.d(n,{default:function(){return U}});var r=t(73193),a=t.n(r),s=t(45332),o=t.n(s),i=t(90938),l=t(92451),u=t(10820),d=t(44194),c=t(2290),f=t(90819),g=t.n(f),m=t(89933),p=t.n(m),v=t(50884),h=t(79865),x=t(28520),M=t(77601),b=t(46206),y=t(83801),S=t(18221),j=t(84115),w=t(69159),Z=t(19058),z=t(90883),I=t(64724),k=t(31461),E=t(50693),C=t(43420),A=t(22014),O=t(31549),R=function(e){var n=e.open,t=e.loading,r=e.canEdit,a=e.canShowCustomServer,s=e.organization,i=e.onClose,l=e.onSubmit,u=(0,c.useIntl)(),f=w.Z.useForm(),m=o()(f,1)[0],v=(0,d.useState)(!1),h=o()(v,2),x=h[0],M=h[1],S=(0,d.useMemo)((function(){return{name:(null==s?void 0:s.name)||"",code:(null==s?void 0:s.code)||"",description:(null==s?void 0:s.description)||"",logo:null==s?void 0:s.logo,customServerEnabled:null==s?void 0:s.customServerEnabled,customServerHost:null==s?void 0:s.customServerHost}}),[s]);(0,d.useEffect)((function(){n&&m.setFieldsValue(S)}),[n,m,S]);var j=function(){var e=p()(g()().mark((function e(){var n;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return i(),e.abrupt("return");case 3:return e.prev=3,e.next=6,m.validateFields();case 6:return n=e.sent,M(!0),e.next=10,l(n);case 10:e.sent&&i();case 12:return e.prev=12,M(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[3,,12,15]])})));return function(){return e.apply(this,arguments)}}();return(0,O.jsx)(Z.Z,{title:u.formatMessage({id:"edit",defaultMessage:"编辑"}),open:n,onClose:i,width:520,destroyOnClose:!1,maskClosable:!x,footer:(0,O.jsxs)(b.Z,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,O.jsx)(z.ZP,{onClick:i,disabled:x,children:u.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,O.jsx)(z.ZP,{type:"primary",onClick:j,loading:Boolean(t)||x,disabled:!r,children:u.formatMessage({id:"save",defaultMessage:"保存"})})]}),children:(0,O.jsxs)(w.Z,{form:m,layout:"vertical",disabled:!r,children:[(0,O.jsxs)(w.Z.Item,{label:u.formatMessage({id:"organization.logo",defaultMessage:"Logo"}),children:[(0,O.jsxs)(b.Z,{children:[(0,O.jsx)(y.Z,{src:m.getFieldValue("logo")||(null==s?void 0:s.logo),size:48}),(0,O.jsx)(C.G,{onSuccess:function(e){m.setFieldsValue({logo:e})},onError:function(e){console.log("OrganizationDrawer upload error:",e)},children:(0,O.jsx)(z.ZP,{icon:(0,O.jsx)(A.Z,{}),children:u.formatMessage({id:"organization.logo.upload",defaultMessage:"上传"})})}),(0,O.jsx)(I.Z.Text,{type:"secondary",children:u.formatMessage({id:"organization.logo.upload.tip",defaultMessage:"建议上传正方形图片"})})]}),(0,O.jsx)(w.Z.Item,{name:"logo",hidden:!0,children:(0,O.jsx)(k.Z,{})})]}),(0,O.jsx)(w.Z.Item,{name:"name",label:u.formatMessage({id:"organization.name.label",defaultMessage:"名称"}),rules:[{required:!0,message:u.formatMessage({id:"organization.name.required",defaultMessage:"请输入组织名称"})}],children:(0,O.jsx)(k.Z,{})}),(0,O.jsx)(w.Z.Item,{name:"code",label:u.formatMessage({id:"organization.code.label",defaultMessage:"编码"}),rules:[{required:!0,message:u.formatMessage({id:"organization.code.required",defaultMessage:"请输入组织编码"})}],children:(0,O.jsx)(k.Z,{})}),(0,O.jsx)(w.Z.Item,{name:"description",label:u.formatMessage({id:"organization.description.label",defaultMessage:"简介"}),rules:[{required:!0,message:u.formatMessage({id:"organization.description.required",defaultMessage:"请输入组织简介"})}],children:(0,O.jsx)(k.Z.TextArea,{rows:4})}),a&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(w.Z.Item,{name:"customServerEnabled",label:u.formatMessage({id:"organization.customServer.enabled",defaultMessage:"自定义服务器"}),valuePropName:"checked",children:(0,O.jsx)(E.Z,{})}),(0,O.jsx)(w.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.customServerEnabled!==n.customServerEnabled},children:function(e){var n=e.getFieldValue,t=Boolean(n("customServerEnabled"));return(0,O.jsx)(w.Z.Item,{name:"customServerHost",label:u.formatMessage({id:"organization.customServer.host",defaultMessage:"域名/IP"}),rules:t?[{required:!0,message:u.formatMessage({id:"organization.customServer.host.required",defaultMessage:"请输入域名/IP"})}]:void 0,children:(0,O.jsx)(k.Z,{placeholder:u.formatMessage({id:"organization.customServer.host.placeholder",defaultMessage:"例如：example.com 或 1.2.3.4"}),disabled:!t||!r})})}})]})]})})},H=function(){var e,n,t,r=(0,c.useIntl)(),s=(0,c.useAccess)(),i=!0===(null==s||null===(e=s.isWeiyu)||void 0===e?void 0:e.call(s)),l=((0,c.useModel)("@@initialState").initialState||{}).userInfo,u=(0,x.u)((function(e){return{currentOrg:e.currentOrg,setCurrentOrg:e.setCurrentOrg}})),f=u.currentOrg,m=u.setCurrentOrg,w=(0,d.useState)(!1),Z=o()(w,2),z=Z[0],I=Z[1],k=(0,d.useState)(!1),E=o()(k,2),C=E[0],A=E[1],H=(0,d.useState)(!1),P=o()(H,2),T=P[0],q=P[1],L=(0,d.useRef)(),U=(0,d.useRef)(f),N=(0,d.useRef)(null==f?void 0:f.updatedAt);(0,d.useEffect)((function(){U.current=f,N.current=null==f?void 0:f.updatedAt}),[f]);var V=(null==l||null===(n=l.currentOrganization)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.uid)||(null==f||null===(t=f.user)||void 0===t?void 0:t.uid),B=Boolean((null==l?void 0:l.uid)&&V&&l.uid===V),D=function(){var e=p()(g()().mark((function e(n){var t,s,o,l,u,d,c,p,x,M,b,y=arguments;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.length>1&&void 0!==y[1]?y[1]:"save",s=y.length>2?y[2]:void 0,B){e.next=4;break}return e.abrupt("return",!1);case 4:if(v.yw.loading({content:r.formatMessage({id:"saving"}),key:t,duration:0}),e.prev=5,null!=f&&f.uid){e.next=10;break}return v.yw.destroy(),v.yw.error(r.formatMessage({id:"save.failed"})),e.abrupt("return",!1);case 10:return x=a()({uid:f.uid,name:null!==(o=n.name)&&void 0!==o?o:f.name,logo:null!==(l=n.logo)&&void 0!==l?l:f.logo,code:null!==(u=n.code)&&void 0!==u?u:f.code,description:null!==(d=n.description)&&void 0!==d?d:f.description},i?{customServerEnabled:null!==(c=n.customServerEnabled)&&void 0!==c?c:f.customServerEnabled,customServerHost:null!==(p=n.customServerHost)&&void 0!==p?p:f.customServerHost}:{}),e.next=13,(0,h.RL)(x);case 13:if(M=e.sent,console.log("saveOrganization response:",M,x),200!==M.code){e.next=23;break}return v.yw.destroy(),b=s||r.formatMessage({id:"update.success"}),v.yw.success(b),m(null==M?void 0:M.data),e.abrupt("return",!0);case 23:return v.yw.destroy(),v.yw.error(M.message),e.abrupt("return",!1);case 26:e.next=34;break;case 28:return e.prev=28,e.t0=e.catch(5),v.yw.destroy(),v.yw.error(r.formatMessage({id:"save.failed"})),console.error("saveOrganization error:",e.t0),e.abrupt("return",!1);case 34:case"end":return e.stop()}}),e,null,[[5,28]])})));return function(n){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){l&&(l.currentOrganization?m(l.currentOrganization):I(!0))}),[l,m]);var F=function(e){m(e),window.location.reload()},Y=((0,d.useMemo)((function(){return f?[f]:[]}),[f]),(0,d.useCallback)(p()(g()().mark((function e(){var n,t,a;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f&&f.uid){e.next=2;break}return e.abrupt("return",{data:[],success:!0,total:0});case 2:return e.next=4,(0,h.tn)(f.uid);case 4:if(200!==(n=e.sent).code){e.next=9;break}return(null==(t=n.data)?void 0:t.updatedAt)!==N.current&&m(t),e.abrupt("return",{data:[t],success:!0,total:1});case 9:return v.yw.error(n.message||r.formatMessage({id:"query.failed",defaultMessage:"查询失败"})),a=U.current?[U.current]:[],e.abrupt("return",{data:a,success:!1,total:a.length});case 12:case"end":return e.stop()}}),e)}))),[null==f?void 0:f.uid,r,m])),G=(0,d.useMemo)((function(){var e=[{title:r.formatMessage({id:"organization.logo",defaultMessage:"Logo"}),dataIndex:"logo",width:120,editable:!1,render:function(e,n){return(0,O.jsx)(b.Z,{children:(0,O.jsx)(y.Z,{src:n.logo,size:48})})}},{title:r.formatMessage({id:"organization.name.label",defaultMessage:"名称"}),dataIndex:"name",ellipsis:!0},{title:r.formatMessage({id:"organization.code.label",defaultMessage:"编码"}),dataIndex:"code",ellipsis:!0},{title:r.formatMessage({id:"organization.description.label",defaultMessage:"简介"}),dataIndex:"description",valueType:"textarea",ellipsis:!0}];return i&&e.push({title:r.formatMessage({id:"organization.customServer.enabled",defaultMessage:"自定义服务器"}),dataIndex:"customServerEnabled",valueType:"switch",width:140},{title:r.formatMessage({id:"organization.customServer.host",defaultMessage:"域名/IP"}),dataIndex:"customServerHost",ellipsis:!0}),e.push({title:r.formatMessage({id:"pages.common.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",editable:!1,width:180,hideInSearch:!0}),e.push({title:r.formatMessage({id:"pages.common.action",defaultMessage:"操作"}),valueType:"option",width:120,render:function(e,n){return B&&null!=n&&n.uid?[(0,O.jsx)("a",{onClick:function(){A(!0)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]:[]}}),e}),[r,B,i]);return f?(0,O.jsxs)("div",{style:{padding:12},children:[!B&&(0,O.jsx)(S.Z,{type:"warning",showIcon:!0,style:{marginBottom:16},message:r.formatMessage({id:"organization.permission.denied",defaultMessage:"无权限编辑组织信息"}),description:r.formatMessage({id:i?"organization.permission.denied.desc.customServer":"organization.permission.denied.desc",defaultMessage:"仅当当前用户为该组织管理员时，才允许修改名称、编码、简介和 Logo。"})}),(0,O.jsx)(M.Z,{actionRef:L,rowKey:function(e){return e.uid||""},columns:G,search:!1,options:{reload:!0,density:!0,fullScreen:!0,setting:!0},pagination:!1,request:Y,toolBarRender:!1}),C&&(0,O.jsx)(R,{open:C,loading:T,canEdit:B,canShowCustomServer:i,organization:f,onClose:function(){return A(!1)},onSubmit:function(){var e=p()(g()().mark((function e(n){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(!0),e.prev=1,e.next=4,D(a()({name:n.name,code:n.code,description:n.description,logo:n.logo},i?{customServerEnabled:n.customServerEnabled,customServerHost:n.customServerHost}:{}),"save-org",r.formatMessage({id:"update.success",defaultMessage:"更新成功"}));case 4:return t=e.sent,e.abrupt("return",t);case 6:return e.prev=6,q(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(n){return e.apply(this,arguments)}}()}),z&&(0,O.jsx)(j.Z,{open:z,onClose:function(){return I(!1)},onSuccess:F})]}):(0,O.jsx)("div",{style:{padding:12},children:(0,O.jsxs)("div",{style:{textAlign:"center",padding:"48px 0"},children:[(0,O.jsx)("div",{children:r.formatMessage({id:"loading"})}),(0,O.jsx)(j.Z,{open:z,onClose:function(){return I(!1)},onSuccess:F})]})})},P=t(38623),T=t(13040),q=function(){var e=(0,c.useIntl)(),n=(0,d.useRef)(),t=(0,x.u)((function(e){return e.currentOrg})),r=function(n,t){return e.formatMessage({id:n,defaultMessage:t})},a=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:e.formatMessage({id:"pages.org.name",defaultMessage:"组织"}),dataIndex:"name",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"pages.common.applicant",defaultMessage:"申请人"}),dataIndex:["user","nickname"],ellipsis:!0,hideInSearch:!0,render:function(e,n){var t,r;return(null==n||null===(t=n.user)||void 0===t?void 0:t.nickname)||(null==n||null===(r=n.user)||void 0===r?void 0:r.username)||(null==n?void 0:n.userUid)||"-"}},{title:e.formatMessage({id:"pages.common.mobile",defaultMessage:"手机号"}),dataIndex:["user","mobile"],ellipsis:!0,hideInSearch:!0,render:function(e,n){var t;return(null==n||null===(t=n.user)||void 0===t?void 0:t.mobile)||"-"}},{title:e.formatMessage({id:"pages.common.email",defaultMessage:"邮箱"}),dataIndex:["user","email"],ellipsis:!0,hideInSearch:!0,render:function(e,n){var t;return(null==n||null===(t=n.user)||void 0===t?void 0:t.email)||"-"}},{title:e.formatMessage({id:"pages.common.status",defaultMessage:"状态"}),dataIndex:"status",hideInSearch:!0,render:function(e,n){return t=n.status,"APPROVED"===(a=(t||"").toUpperCase())?(0,O.jsx)(P.Z,{color:"green",children:r("organization.apply.status.approved","已通过")}):"REJECTED"===a?(0,O.jsx)(P.Z,{color:"red",children:r("organization.apply.status.rejected","已拒绝")}):"CANCELED"===a?(0,O.jsx)(P.Z,{children:r("organization.apply.status.canceled","已取消")}):(0,O.jsx)(P.Z,{color:"gold",children:r("organization.apply.status.pending","待处理")});var t,a}},{title:e.formatMessage({id:"pages.common.remark",defaultMessage:"备注"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"pages.common.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",hideInSearch:!0,width:180}];return(0,O.jsx)(M.Z,{actionRef:n,rowKey:function(e){return e.uid||""},columns:a,search:!1,options:{reload:!0,density:!0,fullScreen:!0,setting:!0},pagination:{showSizeChanger:!0},request:function(){var e=p()(g()().mark((function e(n){var r,a,s,o,i,l,u;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return",{data:[],success:!0,total:0});case 2:return s="number"==typeof n.current?n.current-1:0,o="number"==typeof n.pageSize?n.pageSize:10,e.next=6,(0,T.vl)({orgUid:t.uid,pageNumber:s,pageSize:o});case 6:return i=e.sent,l=(null==i||null===(r=i.data)||void 0===r?void 0:r.content)||[],u=(null==i||null===(a=i.data)||void 0===a?void 0:a.totalElements)||0,e.abrupt("return",{data:l,success:200===(null==i?void 0:i.code),total:u});case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()})},L=t(27318),U=function(){var e,n,t,r,s,f=(0,i.Z)().contentStyle,g=(0,c.useIntl)(),m=(0,c.useAccess)(),p=(0,x.u)((function(e){return e.currentOrg})),v=function(e,n){return g.formatMessage({id:e,defaultMessage:n})},h=(0,d.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,L.MY.ORGANIZATION)}),[m]),M=(0,d.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,L.MY.ORGANIZATION_APPLY)}),[m]),b=null!==(e=null==h||null===(n=h.canRead)||void 0===n?void 0:n.call(h))&&void 0!==e&&e,y=null!==(t=null==M||null===(r=M.canRead)||void 0===r?void 0:r.call(M))&&void 0!==t&&t,S=(0,d.useMemo)((function(){var e=[];return b&&e.push({key:"organization",label:v("organization.tab.profile","组织信息"),children:(0,O.jsx)(H,{})}),null!=p&&p.uid&&y&&e.push({key:"apply",label:v("organization.tab.apply","加入申请"),children:(0,O.jsx)(q,{})}),e}),[b,y,null==p?void 0:p.uid,v]),j=(0,d.useState)(),w=o()(j,2),Z=w[0],z=w[1];return(0,d.useEffect)((function(){var e,n=null==S||null===(e=S[0])||void 0===e?void 0:e.key;n&&(Z&&S.some((function(e){return e.key===Z}))||z(n))}),[S,Z]),S.length?(0,O.jsx)("div",{style:a()(a()({},f),{},{height:"100%"}),children:(0,O.jsx)(u.Z,{items:S,activeKey:null!=Z?Z:null==S||null===(s=S[0])||void 0===s?void 0:s.key,onChange:function(e){return z(e)}})}):(0,O.jsx)("div",{style:a()(a()({},f),{},{height:"100%",padding:12}),children:(0,O.jsx)(l.ZP,{status:"403",title:v("organization.noAccess.title","无权限访问"),subTitle:v("organization.noAccess.subtitle","请联系管理员开通组织/加入申请权限。")})})}}}]);