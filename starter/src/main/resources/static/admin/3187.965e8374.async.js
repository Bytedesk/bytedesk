"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3187],{82669:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(11757),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},u=r(54183),i=function(e,t){return o.createElement(u.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var s=o.forwardRef(i)},32350:function(e,t,r){var n=r(17082),o=r(73457),a=r(44194),u=r(35175),i=r(31549),s=["fieldProps","proFieldProps"],l=function(e,t){var r=e.fieldProps,a=e.proFieldProps,l=(0,o.Z)(e,s);return(0,i.jsx)(u.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:a},l))};t.Z=a.forwardRef(l)},81924:function(e,t,r){r.d(t,{E9:function(){return d},Rd:function(){return g},fA:function(){return m},ul:function(){return h}});var n=r(90819),o=r.n(n),a=r(73193),u=r.n(a),i=r(89933),s=r.n(i),l=r(55735),c=r(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=s()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/query/org",{method:"GET",params:u()(u()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/create",{method:"POST",data:u()(u()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return R.apply(this,arguments)}function R(){return(R=s()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/update",{method:"POST",data:u()(u()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/delete",{method:"POST",data:u()(u()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},80508:function(e,t,r){r.d(t,{Z:function(){return F}});var n=r(73193),o=r.n(n),a=r(90819),u=r.n(a),i=r(89933),s=r.n(i),l=r(45332),c=r.n(l),d=r(78488),f=r(44194),m=r(81924),p=r(40612),h=r(86803),R=r(30921),g=r(53530),v=r(27487),y=r(75365),w=r(9452),x=r(23864),P=r(76750),Z=r(15722),k=r(82669),M=r(55735),S=r(69169),b=r(4499),j=r(32350),C=r(57178),E=r(31549),q=function(e){var t=e.open,r=e.isSuper,n=e.isEdit,o=e.role,a=e.onCancel,i=e.onSubmit,l=C.Z.useForm(),d=c()(l,1)[0],m=(0,R.useIntl)(),v=(0,p.u)((function(e){return e.currentOrg}));(0,f.useEffect)((function(){n&&o?d.setFieldsValue({uid:o.uid,name:o.name,description:o.description}):d.resetFields()}),[n,o]);var y=function(){d.validateFields().then(function(){var e=s()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==o?void 0:o.uid:"",name:t.name,description:t.description,authorityUids:[],orgUid:null==v?void 0:v.uid,level:r?M.Hxq:M.whQ},i(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),h.yw.error(m.formatMessage({id:"role.message.operation.failed"}))}))};return(0,E.jsx)(g.Z,{title:m.formatMessage({id:n?"role.edit.title":"role.create.title"}),open:t,forceRender:!0,onOk:y,onCancel:a,children:(0,E.jsxs)(S.A,{form:d,name:"roleForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,E.jsx)(b.Z,{label:m.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0,message:m.formatMessage({id:"role.name.required"})}],fieldProps:{onPressEnter:function(){d.validateFields(["description"]).then((function(){y()}))}}}),(0,E.jsx)(j.Z,{label:m.formatMessage({id:"role.description"}),name:"description",rules:[{required:!0,message:m.formatMessage({id:"role.description.required"})}],fieldProps:{onPressEnter:function(){y()},autoSize:{minRows:2,maxRows:6}}})]})})},F=function(e){var t=e.isSuper,r=(0,R.useIntl)(),n=(0,x.Z)().isDarkMode,a=g.Z.useModal(),i=c()(a,2),l=i[0],S=i[1],b=(0,P.Z)().translateString,j=(0,f.useState)(!1),C=c()(j,2),F=C[0],I=C[1],O=(0,f.useState)(!1),T=c()(O,2),U=T[0],z=T[1],V=(0,p.u)((function(e){return e.currentOrg})),A=(0,d.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform,insertRole:e.insertRole,insertRolePlatform:e.insertRolePlatform,upgradeRole:e.upgradeRole,upgradeRolePlatform:e.upgradeRolePlatform,currentRole:e.currentRole,currentRolePlatform:e.currentRolePlatform,removeRole:e.removeRole,removeRolePlatform:e.removeRolePlatform,setCurrentRole:e.setCurrentRole,setCurrentRolePlatform:e.setCurrentRolePlatform}})),W=A.roleResult,H=A.roleResultPlatform,G=A.setRoleResult,L=A.setRoleResultPlatform,Q=A.insertRole,_=A.insertRolePlatform,B=A.upgradeRole,D=A.upgradeRolePlatform,J=A.removeRole,N=A.removeRolePlatform,K=A.currentRole,X=A.currentRolePlatform,Y=A.setCurrentRole,$=A.setCurrentRolePlatform,ee=t?X:K,te=function(e){return[M.jGk,M.w7Z,M.nGQ,M.gJI].includes(null==e?void 0:e.uid)||!0===(null==e?void 0:e.system)},re=function(){var e=s()(u()().mark((function e(){var n,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(r.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:100,orgUid:t?"":null==V?void 0:V.uid,level:t?M.Hxq:M.whQ},e.next=4,(0,m.E9)(n);case 4:o=e.sent,console.log("queryRolesByOrg response: ",o.data,n),200===o.code?(h.yw.destroy(),t?(L(o),""===(null==X?void 0:X.uid)&&o.data.content.length>0&&$(o.data.content[0])):(G(o),""===(null==K?void 0:K.uid)&&o.data.content.length>0&&Y(o.data.content[0]))):(h.yw.destroy(),h.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){re()}),[]);var ne=function(){var e=s()(u()().mark((function e(n){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(r.formatMessage({id:"creating"})),e.next=3,(0,m.fA)(o()({},n));case 3:200===(a=e.sent).code?(h.yw.destroy(),h.yw.success(r.formatMessage({id:"create.success"})),I(!1),t?(_(a.data),$(a.data)):(Q(a.data),Y(a.data))):(h.yw.destroy(),h.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=s()(u()().mark((function e(n){var o,a,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,authorityUids:(null==n||null===(o=n.authorities)||void 0===o?void 0:o.map((function(e){return e.uid})))||[],system:t},h.yw.loading(r.formatMessage({id:"updating"})),e.next=4,(0,m.ul)(a);case 4:200===(i=e.sent).code?(h.yw.destroy(),h.yw.success(r.formatMessage({id:"update.success"})),t?D(i.data):B(i.data),I(!1)):(h.yw.destroy(),h.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=s()(u()().mark((function e(n){var o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.yw.loading(r.formatMessage({id:"deleting"})),e.next=3,(0,m.Rd)(n);case 3:200===(o=e.sent).code?(h.yw.destroy(),h.yw.success(r.formatMessage({id:"delete.success"})),t?N(n.uid):J(n.uid),I(!1),re()):(h.yw.destroy(),h.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=t?H.data.content:W.data.content;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(v.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[(0,E.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,E.jsx)(k.Z,{}),onClick:function(){z(!1),I(!0)},children:r.formatMessage({id:"create"})}),(0,E.jsx)(y.ZP,{size:"small",onClick:re,children:r.formatMessage({id:"refresh"})}),!te(ee)&&(null==ee?void 0:ee.uid)&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(y.ZP,{size:"small",onClick:function(){te(ee)?h.yw.error(r.formatMessage({id:"role.system.noedit"})):(z(!0),I(!0))},children:r.formatMessage({id:"edit"})}),(0,E.jsx)(y.ZP,{onClick:function(){return function(e){te(e)?h.yw.error(r.formatMessage({id:"role.system.nodelete"})):l.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,E.jsx)(Z.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm"}),"【").concat(b(e.name),"】？"),onOk:function(){ae(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}(ee)},size:"small",style:{float:"right"},danger:!0,children:r.formatMessage({id:"delete"})})]})]}),(0,E.jsx)(w.Z,{dataSource:ue,renderItem:function(e){return(0,E.jsx)(w.Z.Item,{style:{backgroundColor:(null==ee?void 0:ee.uid)===e.uid?n?"#333333":"#dddddd":void 0,cursor:"pointer"},onClick:function(){return r=e,void(t?$(r):Y(r));var r},children:(0,E.jsx)(w.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,E.jsx)(E.Fragment,{children:b(e.name)}),description:b(e.description)})},e.uid)}}),F&&(0,E.jsx)(q,{open:F,isSuper:t,isEdit:U,role:ee,onCancel:function(){I(!1)},onSubmit:function(e){U?oe(e):ne(e)}}),S]})}},15008:function(e,t,r){r.d(t,{Z:function(){return j}});var n=r(44194),o=r(8247),a=r(73193),u=r.n(a),i=r(76711),s=r.n(i),l=r(90819),c=r.n(l),d=r(89933),f=r.n(d),m=r(45332),p=r.n(m),h=r(86803),R=r(55735),g=r(30921);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,g.request)("/api/v1/authority/query/org",{method:"GET",params:u()(u()({},t),{},{client:R.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(76750),x=r(78488),P=r(62673),Z=r(99749),k=r(81924),M=r(31549),S={width:"20%",textAlign:"center"},b=function(e){var t=e.isSuper,r=(0,g.useIntl)(),o=(0,w.Z)().translateString,a=(0,n.useState)({uid:""}),i=p()(a,2),l=i[0],d=i[1],m=(0,x.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole,currentRolePlatform:e.currentRolePlatform,setCurrentRolePlatform:e.setCurrentRolePlatform}})),y=m.upgradeRole,b=m.currentRole,j=m.setCurrentRole,C=m.currentRolePlatform,E=m.setCurrentRolePlatform,q=(0,n.useState)([]),F=p()(q,2),I=F[0],O=F[1],T=(0,n.useState)(b.authorities),U=p()(T,2),z=U[0],V=U[1],A=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,level:R.Hxq},e.next=3,v(t);case 3:r=e.sent,console.log("getAuthorities response",r),200===r.code?O(r.data.content):(console.log("getAuthorities error",r),h.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=I.reduce((function(e,t){var r=t.name.split("_"),n=p()(r,1)[0];return e[n]||(e[n]=[]),e[n].push(t),e}),{});(0,n.useEffect)((function(){t?(d(C),V(C.authorities)):(d(b),V(b.authorities))}),[b,C,t]),(0,n.useEffect)((function(){A()}),[]);var H=function(e){return e.some((function(e){return z.some((function(t){return t.name===e.name}))}))},G=function(){var e=f()(c()().mark((function e(t){var n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",n),h.yw.loading(r.formatMessage({id:"updating"})),e.next=5,(0,k.ul)(n);case 5:o=e.sent,console.log("updateRole:",o),200===o.code?(h.yw.destroy(),h.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),y(o.data)):(h.yw.destroy(),h.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,M.jsx)(M.Fragment,{children:Object.keys(W).map((function(e){return(0,M.jsx)(P.Z,{title:(0,M.jsx)(Z.Z,{checked:(r=W[e],r.every((function(e){return z.some((function(t){return t.name===e.name}))}))),indeterminate:H(W[e]),onChange:function(r){return function(e,r){var n,o=W[e];r?(n=s()(z),o.forEach((function(e){n.some((function(t){return t.name===e.name}))||n.push(e)}))):n=z.filter((function(e){return!o.some((function(t){return t.name===e.name}))})),V(n),t?(E(u()(u()({},C),{},{authorities:n})),G(u()(u()({},C),{},{authorities:n}))):(j(u()(u()({},b),{},{authorities:n})),G(u()(u()({},b),{},{authorities:n})))}(e,r.target.checked)},disabled:(null==l?void 0:l.system)||""===(null==l?void 0:l.uid),children:o(e)}),style:{marginTop:10},children:W[e].map((function(e){return(0,M.jsx)(P.Z.Grid,{style:S,children:(0,M.jsx)(Z.Z,{checked:null==z?void 0:z.some((function(t){return t.name===e.name})),disabled:!0,children:o(e.name)})},e.name)}))},e);var r}))})},j=function(e){var t=e.isSuper,r=[{key:"authority",label:"权限",children:(0,M.jsx)(b,{isSuper:t})}];return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(o.Z,{defaultActiveKey:"1",items:r,onChange:function(e){console.log(e)}})})}},96865:function(e,t,r){var n=r(23864);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,t,r){var n=r(55735),o=r(65461),a=r(30921);t.Z=function(){var e=(0,a.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,o.aS)(t,10)}}}},78488:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(73193),o=r.n(n),a=r(76711),u=r.n(a),i=r(55735),s=r(44435),l=r(83642),c=r(83890),d=(0,s.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},currentRolePlatform:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},roleResultPlatform:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},insertRolePlatform:function(t){e((function(e){e.roleResultPlatform.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var r=e.roleResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},upgradeRolePlatform:function(t){e((function(e){var r=e.roleResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(r){var n;(e({roleResult:r}),""===t().currentRole.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRole:r.data.content[0]}))},setRoleResultPlatform:function(r){var n;(e({roleResultPlatform:r}),""===t().currentRolePlatform.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRolePlatform:r.data.content[0]}))},setCurrentRole:function(r){var n=t().roleResult.data.content,a=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==a){var i=[].concat(u()(n.slice(0,a)),[r],u()(n.slice(a+1))),s=o()(o()({},t().roleResult),{},{data:{content:i}});e({roleResult:s,currentRole:r})}else console.warn("Role with the specified uid not found."),e({currentRole:r})},setCurrentRolePlatform:function(r){var n=t().roleResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==a){var i=[].concat(u()(n.slice(0,a)),[r],u()(n.slice(a+1))),s=o()(o()({},t().roleResultPlatform),{},{data:{content:i}});e({roleResultPlatform:s,currentRolePlatform:r})}else console.warn("Role with the specified uid not found."),e({currentRolePlatform:r})},removeRole:function(r){var n=t().roleResult.data.content,a=n.findIndex((function(e){return e.uid===r}));-1!==a?e({roleResult:o()(o()({},t().roleResult),{},{data:{content:[].concat(u()(n.slice(0,a)),u()(n.slice(a+1)))}})}):console.warn("Role not found in cache:",r),t().currentRole.uid===r&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},removeRolePlatform:function(r){var n=t().roleResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===r}));-1!==a?e({roleResult:o()(o()({},t().roleResult),{},{data:{content:[].concat(u()(n.slice(0,a)),u()(n.slice(a+1)))}})}):console.warn("Role not found in cache:",r),t().currentRolePlatform.uid===r&&e({currentRolePlatform:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:i.uaR})))}}]);