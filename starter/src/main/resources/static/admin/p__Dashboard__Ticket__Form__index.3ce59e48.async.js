"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8600],{74545:function(e,t,a){a.d(t,{dI:function(){return g},xg:function(){return c}});var r=a(90819),n=a.n(r),s=a(73193),i=a.n(s),o=a(89933),u=a.n(o),d=a(6844),l=a(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/form/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=u()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/form/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},88449:function(e,t,a){var r=a(26710);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},14361:function(e,t,a){a.r(t),a.d(t,{default:function(){return N}});var r=a(85255),n=a(88449),s=a(6844),i=a(73193),o=a.n(i),u=a(84176),d=a.n(u),l=a(90819),c=a.n(l),f=a(89933),g=a.n(f),p=a(45332),m=a.n(p),y=a(67412),h=a(9428),M=a(3925),v=a(77359),x=a(44194),S=a(19736),E=a(10162),k=a(96596),T=a.n(k),w=a(47598),A=a(14888),C=(0,a(26557).Ue)((function(e){return{selectedType:"",setSelectedType:function(t){return e({selectedType:t})}}})),I=a(44679),b=a(74545),B=a(65819),R=a(93527),L=a(36125),O=a(31549),z=["current","pageSize","prompt"],j=function(e){var t=e.level,a=(e.type,(0,x.useRef)()),r=(0,S.useIntl)(),n=(0,I.Z)().translateString,i=(0,x.useState)(1),u=m()(i,2),l=u[0],f=u[1],p=(0,x.useState)(10),k=m()(p,2),j=k[0],D=k[1],P=(0,x.useState)([]),_=m()(P,2),N=(_[0],_[1]),U=(0,w.v)((function(e){return e.currentCategory})),Z=(0,A.u)((function(e){return e.currentOrg})),G=C().selectedType,K=(0,x.useState)(0),q=m()(K,2),H=(q[0],q[1]),Y=(0,x.useState)({}),F=m()(Y,2),J=(F[0],F[1]),Q=function(){var e=g()(c()().mark((function e(t){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,b.dI)(t);case 3:200===(n=e.sent).code?(R.yw.success(r.formatMessage({id:"delete.success"})),null===(s=a.current)||void 0===s||s.reload()):R.yw.error(n.message||r.formatMessage({id:"delete.error"}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){window.open((0,B.P1)(),"_blank")};(0,x.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[U,G]);var W=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.form.uid",defaultMessage:"UID"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",width:180,copyable:!0,ellipsis:!0},{title:r.formatMessage({id:"pages.form.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.form.name.tooltip",defaultMessage:"的名称"})},{title:r.formatMessage({id:"pages.form.description",defaultMessage:"描述"}),dataIndex:"description",width:250,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.form.description.tooltip",defaultMessage:"的功能描述"})},{title:r.formatMessage({id:"pages.form.type",defaultMessage:"类型"}),dataIndex:"type",hideInSearch:!0,width:150,ellipsis:!0,tooltip:r.formatMessage({id:"pages.form.type.tooltip",defaultMessage:"表单类型"}),valueEnum:{TICKET_INTERNAL:{text:r.formatMessage({id:"pages.form.type.ticket.internal",defaultMessage:"内部工单"})},TICKET_EXTERNAL:{text:r.formatMessage({id:"pages.form.type.ticket.external",defaultMessage:"外部工单"})},THREAD:{text:r.formatMessage({id:"pages.form.type.thread",defaultMessage:"会话表单"})},FLOW:{text:r.formatMessage({id:"pages.form.type.flow",defaultMessage:"流程表单"})},PRE_SALES_QUESTIONNAIRE:{text:r.formatMessage({id:"pages.form.type.pre.sales.questionnaire",defaultMessage:"询前问卷"})},MESSAGE_LEAVE:{text:r.formatMessage({id:"pages.form.type.message.leave",defaultMessage:"客户留言"})},COMPLAINT:{text:r.formatMessage({id:"pages.form.type.complaint",defaultMessage:"客户投诉"})},FEEDBACK:{text:r.formatMessage({id:"pages.form.type.feedback",defaultMessage:"意见反馈"})},PRODUCT_SUGGESTION:{text:r.formatMessage({id:"pages.form.type.product.suggestion",defaultMessage:"产品建议"})},BUG_REPORT:{text:r.formatMessage({id:"pages.form.type.bug.report",defaultMessage:"Bug报告"})},APPOINTMENT_TRIAL:{text:r.formatMessage({id:"pages.form.type.appointment.trial",defaultMessage:"预约试听"})}}},{title:r.formatMessage({id:"pages.form.status",defaultMessage:"状态"}),dataIndex:"status",hideInSearch:!0,width:100,tooltip:r.formatMessage({id:"pages.form.status.tooltip",defaultMessage:"表单状态"}),valueEnum:{DRAFT:{text:r.formatMessage({id:"pages.form.status.draft",defaultMessage:"草稿"}),status:"Default"},PUBLISHED:{text:r.formatMessage({id:"pages.form.status.published",defaultMessage:"已发布"}),status:"Success"},DISABLED:{text:r.formatMessage({id:"pages.form.status.disabled",defaultMessage:"已禁用"}),status:"Error"}}},{title:r.formatMessage({id:"pages.form.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.form.createdAt.tooltip",defaultMessage:"创建的时间"}),render:function(e,t){return t.createdAt?T()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.form.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.form.updatedAt.tooltip",defaultMessage:"最后更新的时间"}),render:function(e,t){return t.updatedAt?T()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:150,fixed:"right",tooltip:r.formatMessage({id:"pages.form.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return(0,O.jsxs)(h.Z,{children:[(0,O.jsx)(M.ZP,{type:"link",onClick:function(){return function(e){var t="".concat((0,B.P1)(),"?formUid=").concat(e.uid);window.open(t,"_blank")}(t)},children:r.formatMessage({id:"form.action.edit",defaultMessage:"编辑"})}),(0,O.jsx)(v.Z,{title:r.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(n(t.name),"】？"),onConfirm:function(){return Q(t)},okText:r.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:r.formatMessage({id:"cancel",defaultMessage:"取消"}),children:(0,O.jsx)(M.ZP,{type:"link",danger:!0,children:r.formatMessage({id:"form.action.delete",defaultMessage:"删除"})})})]})}}],X=function(){var e=g()(c()().mark((function e(a,n,i){var u,l,g,p,m,y,h,M,v,x,S,E;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.current,a.pageSize,a.prompt,u=d()(a,z),J({name:a.name,description:a.description}),l=a.current?a.current-1:0,g=a.pageSize||10,f(a.current||1),D(g),p="createdAt",m="desc",n&&Object.keys(n).length>0&&(y=Object.keys(n)[0],p=y,m="ascend"===n[y]?"asc":"desc"),h=o()({pageNumber:l,pageSize:g,sortBy:p,sortDirection:m,level:t,orgUid:null==Z?void 0:Z.uid,categoryUid:(null==U?void 0:U.uid)===s.zBg?"":null==U?void 0:U.uid,type:"ALL"===G?"":G},u),e.prev=10,e.next=13,(0,b.xg)(h);case 13:if(M=e.sent,L.Z.debug("queryFormsByOrg:",M,h),200!==M.code){e.next=22;break}return E=(null==M||null===(v=M.data)||void 0===v?void 0:v.content)||[],N(E),H((null==M||null===(x=M.data)||void 0===x?void 0:x.totalElements)||0),e.abrupt("return",{data:E,success:!0,total:(null==M||null===(S=M.data)||void 0===S?void 0:S.totalElements)||0});case 22:return R.yw.error(M.message||r.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 24:e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(10),console.error("查询失败:",e.t0),R.yw.error(r.formatMessage({id:"request.error"})),e.abrupt("return",{data:[],success:!1,total:0});case 31:case"end":return e.stop()}}),e,null,[[10,26]])})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(y.Z,{headerTitle:r.formatMessage({id:"pages.form.title",defaultMessage:"管理"}),actionRef:a,rowKey:"uid",search:{labelWidth:"auto"},toolBarRender:function(){return[(0,O.jsx)(M.ZP,{type:"primary",icon:(0,O.jsx)(E.Z,{}),onClick:V,children:r.formatMessage({id:"form.action.open.form.editor",defaultMessage:"打开表单编辑器"})},"create")]},request:X,columns:W,scroll:{x:"max-content"},pagination:{pageSize:j,current:l,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e," ").concat(r.formatMessage({id:"items",defaultMessage:"条"}))}},options:{setting:{listsHeight:400}},size:"small"})})},D=a(51936),P={ALL:{title:"全部表单",key:"ALL",children:[]},BASE:{title:"基础表单",key:"BASE",children:[{title:"内部工单表单",key:"TICKET_INTERNAL"},{title:"外部工单表单",key:"TICKET_EXTERNAL"}]},CUSTOMER_SERVICE:{title:"客户服务",key:"CUSTOMER_SERVICE",children:[{title:"询前问卷",key:"PRE_SALES_QUESTIONNAIRE"},{title:"客户留言",key:"MESSAGE_LEAVE"},{title:"客户投诉",key:"COMPLAINT"},{title:"意见反馈",key:"FEEDBACK"},{title:"产品建议",key:"PRODUCT_SUGGESTION"},{title:"Bug报告",key:"BUG_REPORT"}]}},_=function(){(0,S.useIntl)();var e=C(),t=e.selectedType,a=e.setSelectedType,r=x.useState(["ALL","BASE"]),n=m()(r,2),s=n[0],i=n[1],o=x.useState(""),u=m()(o,2),d=u[0],l=(u[1],x.useState(!0)),c=m()(l,2),f=c[0],g=c[1];x.useEffect((function(){t||a("ALL")}),[]);var p=Object.values(P).map((function(e){return{title:e.title,key:e.key,children:e.children.map((function(e){return{title:e.title,key:e.key}}))}}));return(0,O.jsx)("div",{children:(0,O.jsx)(D.Z,{showLine:!0,onExpand:function(e){i(e),g(!1)},expandedKeys:s,autoExpandParent:f,treeData:function e(t){return t.map((function(t){var a=t.title,r=a.toLowerCase().indexOf(d.toLowerCase()),n=a.substring(0,r),s=a.substring(r+d.length),i=r>-1?(0,O.jsxs)("span",{children:[n,(0,O.jsx)("span",{className:"site-tree-search-value",children:a.substring(r,r+d.length)}),s]}):(0,O.jsx)("span",{children:a});return t.children?{title:i,key:t.key,children:e(t.children)}:{title:i,key:t.key}}))}(p),onSelect:function(e){e.length>0&&a(e[0])},selectedKeys:t?[t]:[]})})},N=function(){var e=(0,n.Z)(),t=e.leftSiderStyle,a=e.contentStyle;return(0,O.jsxs)(r.Z,{style:{height:"100%"},children:[(0,O.jsx)(r.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:t,children:(0,O.jsx)(_,{})}),(0,O.jsx)(r.Z.Panel,{style:a,children:(0,O.jsx)(j,{level:s.whQ})})]})}},47598:function(e,t,a){a.d(t,{v:function(){return p}});var r=a(86222),n=a.n(r),s=a(73193),i=a.n(s),o=a(76711),u=a.n(o),d=a(6844),l=a(26557),c=a(26407),f=a(20744),g=a(36125);var p=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,f.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:d.zBg,name:d.zBg},setCategoryResult:function(t){var a=function(e){var t=[];return e.data.content.forEach((function(e){var a={label:e.name,value:e.uid};t.push(a)})),t}(t),r=function(e){var t,a=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],r=function e(t){var a={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(a.children=t.children.map((function(t){return e(t)}))),a};return a.filter((function(e){return e&&e.uid&&e.uid!==d.zBg})).map((function(e){return r(e)}))}(t),n=[{title:d.zBg,key:d.zBg}].concat(u()(r)),s={uid:d.zBg,name:d.zBg},o=i()(i()({},t),{},{data:i()(i()({},t.data),{},{content:[s].concat(u()(t.data.content))})});e({categoryResult:o,categoryTreeOptions:n,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:d.zBg,name:d.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){g.Z.log("resetDefaultCategory"),e({currentCategory:{uid:d.zBg,name:d.zBg}})},setCurrentCategoryUid:function(a){if(a!==d.zBg){var r=function e(t,a){if(t&&0!==t.length){var r,s=n()(t);try{for(s.s();!(r=s.n()).done;){var i=r.value;if((null==i?void 0:i.uid)===a)return i;var o=e(null==i?void 0:i.children,a);if(o)return o}}catch(e){s.e(e)}finally{s.f()}}}(t().categoryResult.data.content,a);e({currentCategory:null!=r?r:{uid:d.zBg,name:d.zBg}})}else e({currentCategory:{uid:d.zBg,name:d.zBg}})},deleteCategoryCache:function(){return e({},!0)}}})),{name:d.OMm})))}}]);