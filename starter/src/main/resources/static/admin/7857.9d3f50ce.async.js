"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7857],{66916:function(e,t,n){n.d(t,{$l:function(){return h},JT:function(){return w},Xd:function(){return k},gf:function(){return j},lg:function(){return f},lz:function(){return b},p0:function(){return d},s9:function(){return g}});var r=n(90819),a=n.n(r),o=n(73193),i=n.n(o),s=n(89933),u=n.n(s),c=n(55735),l=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/query/org",{method:"GET",params:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/create",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/create/prompt",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/avatar",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/prompt",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/update/kbUid",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return T.apply(this,arguments)}function T(){return(T=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/robot/delete",{method:"POST",data:i()(i()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67857:function(e,t,n){n.d(t,{Z:function(){return Y}});var r=n(73193),a=n.n(r),o=n(84176),i=n.n(o),s=n(90819),u=n.n(s),c=n(89933),l=n.n(c),d=n(45332),p=n.n(d),f=n(44194),m=n(53530),g=n(75365),v=n(86803),h=n(66916),y=n(30921),b=n(55735),x=n(90838),w=n(40612),M=n(69169),k=n(84881),S=n(4499),j=n(32350),T=n(73442),U=n(3849),Z=n(84288),C=n(6631),q=n(59908),I=n(76750),A=n(31549),P=function(e){var t,n=e.isEdit,r=e.robot,a=e.open,o=e.level,i=e.onClose,s=e.onSubmit,u=M.A.useForm(),c=p()(u,1)[0],l=(0,y.useIntl)(),d=(0,w.u)((function(e){return e.currentOrg})),m=(0,f.useState)("https://cdn.weiyuai.cn/assets/images/llm/provider/zhipu.png"),h=p()(m,2),P=h[0],E=(h[1],(0,f.useState)()),O=p()(E,2),V=O[0],F=O[1],z=(0,x.v)((function(e){return e.categoryResult})),D=(0,I.Z)(),Y=D.translateString;D.translateStringTranct;(0,f.useEffect)((function(){if(n&&r&&c){var e,t;c.setFieldsValue({uid:null==r?void 0:r.uid,nickname:null==r?void 0:r.nickname,prompt:null==r||null===(e=r.llm)||void 0===e?void 0:e.prompt,description:null==r?void 0:r.description,categoryUid:null==r?void 0:r.categoryUid});var a=null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(e){return e.uid===(null==r?void 0:r.categoryUid)}));F(a)}else console.log("form resetFields"),c.resetFields()}),[r]);(0,f.useEffect)((function(){}),[r]);return(0,A.jsx)("div",{children:(0,A.jsx)(T.Z,{title:n?"编辑提示语":"新建提示语",width:650,onClose:i,open:a,extra:(0,A.jsxs)(U.Z,{children:[(0,A.jsx)(g.ZP,{onClick:i,children:"取消"}),(0,A.jsx)(g.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:n?null==r?void 0:r.uid:"",nickname:e.nickname,avatar:P,categoryUid:null==V?void 0:V.uid,llm:{prompt:e.prompt},description:e.description,type:b.Qeb,level:o,orgUid:null==d?void 0:d.uid};console.log("robotObject:",t),s(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,A.jsxs)(M.A,{form:c,name:"model",submitter:!1,children:[(0,A.jsx)(k.Z,{label:"类别",name:"categoryUid",required:!0,options:null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t||null===(t=t.filter((function(e){return e.uid!==b.zBg})))||void 0===t?void 0:t.map((function(e){return{label:Y(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),F(null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,A.jsx)(S.Z,{label:"昵称",name:"nickname",required:!0}),(0,A.jsx)(M.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:l.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,A.jsxs)(C.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e)},onError:function(e){console.log("handleUploadError:",e),v.yw.error(e)},children:[(0,A.jsx)(Z.C,{src:P}),(0,A.jsx)(g.ZP,{icon:(0,A.jsx)(q.Z,{}),children:l.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,A.jsx)(j.Z,{label:"提示语Prompt",name:"prompt",required:!0}),(0,A.jsx)(j.Z,{label:"简介描述",name:"description"})]})})})},E=n(15722),O=n(10162),V=n(81947),F=n(28977),z=n.n(F),D=["current","pageSize"],Y=function(e){var t=e.level,n=(e.type,(0,f.useRef)()),r=(0,y.useIntl)(),o=(0,f.useState)(!0),s=p()(o,2),c=s[0],d=s[1],M=(0,I.Z)().translateString,k=(0,f.useState)(1),S=p()(k,2),j=(S[0],S[1]),T=(0,f.useState)(10),U=p()(T,2),Z=(U[0],U[1]),C=(0,f.useState)(!1),q=p()(C,2),F=q[0],Y=q[1],B=(0,f.useState)([]),L=p()(B,2),H=(L[0],L[1]),R=(0,f.useState)({}),N=p()(R,2),G=N[0],J=N[1],Q=(0,x.v)((function(e){return e.currentCategory})),$=(0,w.u)((function(e){return e.currentOrg})),_=m.Z.useModal(),K=p()(_,2),W=K[0],X=K[1],ee=function(){var e=l()(u()().mark((function e(t){var a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h.gf)(t);case 3:200===(a=e.sent).code?(v.yw.destroy(),v.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=n.current)||void 0===o||o.reload()):(v.yw.destroy(),v.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=l()(u()().mark((function e(t){var a,o,i,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=8;break}return v.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.JT)(t);case 4:200===(a=e.sent).code?(v.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=n.current)||void 0===o||o.reload(),Y(!1)):v.yw.error(a.message),e.next=13;break;case 8:return v.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.s9)(t);case 11:200===(i=e.sent).code?(v.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(s=n.current)||void 0===s||s.reload(),Y(!1)):v.yw.error(i.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reload()}),[Q]);var ne=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:r.formatMessage({id:"pages.prompt.nickname",defaultMessage:"名称"}),dataIndex:"nickname",hideInSearch:!1,render:function(e,t){return M(t.nickname)}},{title:r.formatMessage({id:"pages.prompt.description",defaultMessage:"描述"}),dataIndex:"description",hideInSearch:!0,render:function(e,t){return M(t.description)}},{title:r.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],ellipsis:!0,hideInSearch:!0},{title:r.formatMessage({id:"pages.prompt.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.updatedAt?z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",render:function(e,t){var n;return[(0,A.jsx)("a",{onClick:function(){return function(e){d(!0),J(e),Y(!0)}(t)},children:r.formatMessage({id:"pages.robot.edit",defaultMessage:"Edit"})},"edit"),!(null!=t&&null!==(n=t.uid)&&void 0!==n&&n.includes("void_agent"))&&(0,A.jsx)("a",{onClick:function(){return e=t,void W.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,A.jsx)(E.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(e.nickname),"】？"),onOk:function(){ee(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")]}}];return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(V.Z,{columns:ne,actionRef:n,cardBordered:!0,rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.prompt.list",defaultMessage:"提示语列表"}),toolBarRender:function(){return[(0,A.jsx)(g.ZP,{type:"primary",onClick:function(){d(!1),J({}),Y(!0)},icon:(0,A.jsx)(O.Z,{}),children:r.formatMessage({id:"pages.prompt.create",defaultMessage:"添加提示语"})},"create")]},request:function(){var e=l()(u()().mark((function e(n,o,s){var c,l,d,p,f;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),c=n.current,l=n.pageSize,d=i()(n,D),j(c),Z(l),p=a()({pageNumber:c-1,pageSize:l,nickname:"",orgUid:t===b.Hxq?"":null==$?void 0:$.uid,categoryUid:(null==Q?void 0:Q.uid)===b.zBg?"":null==Q?void 0:Q.uid,type:b.Qeb,level:t},d),e.next=7,(0,h.p0)(p);case 7:if(f=e.sent,console.log("queryRobotsByOrg response:",f,p),200!==f.code){e.next=15;break}return v.yw.destroy(),H(f.data.content),e.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 15:return v.yw.destroy(),v.yw.error(f.message),e.abrupt("return",{data:[],success:!1,total:0});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}),F&&(0,A.jsx)(P,{isEdit:c,robot:G,level:t,open:F,onClose:function(){return Y(!1)},onSubmit:te}),X]})}},6631:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),o=(n(44194),n(30348)),i=n(55735),s=n(28977),u=n.n(s),c=n(86803),l=n(36310),d=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,s={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",client:i.bVn},p={name:"file",accept:"image/*",action:(0,l.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:s,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=u()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return s.file=e,s.fileName=t,s.fileType=e.type,console.log("beforeUpload",s),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,d.jsx)(o.Z,a()(a()({},p),{},{children:t}))}}}]);