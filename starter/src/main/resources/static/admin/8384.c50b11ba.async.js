"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8384],{2484:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(11757),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=t(54183),i=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var l=a.forwardRef(i)},82669:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(11757),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},o=t(54183),i=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var l=a.forwardRef(i)},80556:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(11757),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},o=t(54183),i=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var l=a.forwardRef(i)},32350:function(e,n,t){var r=t(17082),a=t(73457),s=t(44194),o=t(35175),i=t(31549),l=["fieldProps","proFieldProps"],c=function(e,n){var t=e.fieldProps,s=e.proFieldProps,c=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({ref:n,valueType:"textarea",fieldProps:t,proFieldProps:s},c))};n.Z=s.forwardRef(c)},58384:function(e,n,t){t.d(n,{Z:function(){return U}});var r=t(90819),a=t.n(r),s=t(89933),o=t.n(s),i=t(45332),l=t.n(i),c=t(53530),u=t(27487),d=t(75365),f=t(96485),p=t(9452),m=t(44194),g=t(10154),b=t.n(g),v=t(73193),h=t.n(v),x=t(86803),y=t(76750),k=t(40612),w=t(55735),Z=t(69169),j=t(84881),K=t(4499),P=t(32350),C=t(32327),M=t(62673),R=t(40679),F=t(36605),E=t(31549),O=function(e){var n,t=e.open,r=e.isEdit,s=e.type,i=e.kbase,u=e.onCancel,d=e.onSubmit,f=Z.A.useForm(),p=l()(f,1)[0],g=(0,y.Z)().translateString,v=(0,k.u)((function(e){return e.currentOrg})),O=(0,m.useRef)(null),S=(0,m.useState)([]),H=l()(S,2),T=H[0],z=H[1],I=(0,m.useState)({}),V=l()(I,2),A=V[0],q=V[1],L=(0,m.useState)(!1),N=l()(L,2),Q=N[0],U=N[1],_="ollama",B="bge-m3:latest",D=(0,m.useState)((null==i?void 0:i.embeddingProvider)||_),$=l()(D,2),W=$[0],J=$[1],X=(0,m.useState)((null==i?void 0:i.embeddingModel)||B),Y=l()(X,2),G=Y[0],ee=Y[1],ne=(0,m.useState)(""),te=l()(ne,2),re=te[0],ae=te[1];(0,m.useEffect)((function(){r?(p.setFieldsValue({name:g(null==i?void 0:i.name)}),p.setFieldsValue({headline:g(null==i?void 0:i.headline)}),p.setFieldsValue({footerHtml:g(null==i?void 0:i.footerHtml)}),p.setFieldsValue({descriptionHtml:g(null==i?void 0:i.descriptionHtml)}),p.setFieldsValue({language:null==i?void 0:i.language}),null!=i&&i.embeddingProvider&&(J(i.embeddingProvider),p.setFieldsValue({embeddingProvider:i.embeddingProvider})),null!=i&&i.embeddingModel&&(ee(i.embeddingModel),p.setFieldsValue({embeddingModel:i.embeddingModel}))):(p.resetFields(),p.setFieldsValue({language:"ZH_CN"}),p.setFieldsValue({embeddingProvider:_,embeddingModel:B})),t&&setTimeout((function(){var e;null===(e=O.current)||void 0===e||e.focus()}),100)}),[t,r,i]),(0,m.useEffect)((function(){t&&s===w.QPQ&&se()}),[t,s]),(0,m.useEffect)((function(){if(W&&G&&A[W]){var e=A[W].find((function(e){return e.value===G}));e&&ae(e.label)}}),[A,W,G]);var se=function(){var e=o()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==v?void 0:v.uid,level:w.whQ},e.next=4,(0,F.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t.data,n),200===t.code?(r=t.data.content||[],z(r)):x.yw.error(t.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),oe=(0,m.useCallback)((function(){}),[]),ie=(0,m.useCallback)((function(){U(!1)}),[]),le=(0,m.useCallback)((function(e,n,t){J(e),ee(n),ae(t),p.setFieldValue("embeddingProvider",e),p.setFieldValue("embeddingModel",n),U(!1)}),[p]),ce=(0,m.useCallback)((function(e,n){q((function(t){return h()(h()({},t),{},b()({},e,n))}))}),[]),ue=function(){p.validateFields().then(function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:r?null==i?void 0:i.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:s,language:n.language,embeddingProvider:n.embeddingProvider||_,embeddingModel:n.embeddingModel||B,orgUid:null==v?void 0:v.uid},d(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),x.yw.error("创建知识库失败")}))},de=function(e){"Enter"===e.key&&ue()};return(0,E.jsxs)("div",{children:[(0,E.jsx)(c.Z,{title:"新建知识库",open:t,forceRender:!0,onOk:ue,onCancel:u,children:(0,E.jsxs)(Z.A,{form:p,submitter:!1,children:[(0,E.jsx)(j.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,E.jsx)(K.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称",ref:O}}),s===w.VX&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(K.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称"}}),(0,E.jsx)(P.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,E.jsx)(P.Z,{label:"描述",name:"descriptionHtml"}),s===w.QPQ&&(0,E.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,E.jsx)(C.Z.Text,{strong:!0,style:{marginRight:"8px"},children:"嵌入模型选择："}),(0,E.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,E.jsx)(M.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:oe,children:W&&G?(0,E.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,E.jsxs)("div",{children:[(0,E.jsx)(C.Z.Text,{type:"secondary",children:"供应商："}),(0,E.jsx)(C.Z.Text,{strong:!0,children:g((null===(n=T.find((function(e){return e.name===W})))||void 0===n?void 0:n.nickname)||W)}),(0,E.jsx)("br",{}),(0,E.jsx)(C.Z.Text,{type:"secondary",children:"模型："}),(0,E.jsx)(C.Z.Text,{strong:!0,children:re||G})]})}):(0,E.jsx)("div",{style:{textAlign:"center"}})})}),(0,E.jsxs)("div",{style:{display:"none"},children:[(0,E.jsx)(j.Z,{name:"embeddingProvider",width:"lg"}),(0,E.jsx)(j.Z,{name:"embeddingModel",width:"lg"})]})]})]})}),s===w.QPQ&&(0,E.jsx)(R.Z,{visible:Q,onCancel:ie,onOk:le,initialProvider:W,initialModel:G,initialModelLabel:re,providers:T,currentOrgUid:null==v?void 0:v.uid,existingProviderModels:A,onModelsLoaded:ce,allowedModelTypes:[w.xTq]})]})},S=t(27522),H=t(6397),T=t(23864),z=t(30921),I=t(15722),V=t(82669),A=t(80556),q=t(59304),L=t(54881),N=t(2484),Q=c.Z.confirm,U=function(e){var n=e.type,t=(0,z.useIntl)(),r=(0,m.useState)(!1),s=l()(r,2),i=s[0],c=s[1],g=(0,m.useRef)(!1),b=(0,m.useState)(!1),v=l()(b,2),h=v[0],Z=v[1],j=(0,T.Z)().isDarkMode,K=(0,y.Z)().translateString,P=(0,k.u)((function(e){return e.currentOrg})),C=(0,m.useState)(!0),M=l()(C,2),R=M[0],F=M[1],U=(0,H.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),_=U.kbaseResult,B=U.currentKbase,D=U.insertKbase,$=U.updateLocalKbase,W=U.setKbaseResult,J=U.setCurrentKbase,X=U.removeKbase,Y=function(){var e=o()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g.current){e.next=3;break}return console.log("isLoading: 1",g.current),e.abrupt("return");case 3:return g.current=!0,c(!0),x.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==P?void 0:P.uid},e.next=9,(0,S.AP)(t);case 9:r=e.sent,console.log("queryKbasesByOrg: ",r),200===r.code?(x.yw.destroy(),W(r)):(x.yw.destroy(),x.yw.error(r.message)),g.current=!1,c(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){console.log("useEffect"),Y()}),[]);var G=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",x.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,S.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(D(r.data),J(r.data),x.yw.success({content:"创建成功！",key:t,duration:2}),Z(!1)):(console.log("create kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",x.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,S.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?($(r.data),J(r.data),x.yw.success({content:"更新成功！",key:t,duration:2}),Z(!1)):(console.log("update kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ne=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",B),F(!0),Z(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R?ee(n):G(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=o()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==_.data.content.length){e.next=4;break}return x.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,S._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(X(n.uid),Y()):(console.log("handleDeleteKbase: ",r),x.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(e){return n!==w._FS?K(e.descriptionHtml):e.level===w.Hxq?"全平台客服可见":e.level===w.whQ?"本组织客服可见":e.level===w.fyH?"本客服可见":K(e.descriptionHtml)};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(u.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,E.jsxs)(u.Z,{gap:"small",children:[(0,E.jsx)(d.ZP,{type:"primary",size:"small",icon:(0,E.jsx)(V.Z,{}),onClick:function(){console.log("new kb"),F(!1),Z(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,E.jsx)(d.ZP,{size:"small",icon:(0,E.jsx)(A.Z,{spin:i}),onClick:Y,loading:i,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,E.jsx)(f.Z,{menu:{items:[{key:"edit",icon:(0,E.jsx)(q.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ne},{key:"delete",icon:(0,E.jsx)(L.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){Q({title:t.formatMessage({id:"deleteTip"}),icon:(0,E.jsx)(I.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(K(e.name),"】？"),onOk:function(){re(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(B)}}]},children:(0,E.jsx)(d.ZP,{size:"small",icon:(0,E.jsx)(N.Z,{})})})]}),(0,E.jsx)(p.Z,{itemLayout:"horizontal",dataSource:_.data.content,renderItem:function(e,n){return(0,E.jsx)(p.Z.Item,{style:B.uid===e.uid?{backgroundColor:j?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){J(e)},children:(0,E.jsx)(p.Z.Item.Meta,{style:{marginLeft:"10px"},title:K(e.name),description:ae(e)})})}}),h&&(0,E.jsx)(O,{open:h,isEdit:R,type:n,kbase:B,onSubmit:te,onCancel:function(){Z(!1)}})]})}},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(55735),l=t(44435),c=t(83642),u=t(83890),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),l=a()(a()({},n().kbaseResult),{},{data:{content:i}});e({kbaseResult:l,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))},53530:function(e,n,t){t.d(n,{Z:function(){return k}});var r=t(18960),a=t(31695),s=t(27710),o=t(44194),i=t(51865),l=t.n(i),c=t(24255),u=t(43037),d=t(37167),f=t(30829),p=t(78660),m=t(59348),g=t(6750),b=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)n.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};var v=(0,u.i)((e=>{const{prefixCls:n,className:t,closeIcon:r,closable:a,type:s,title:i,children:u,footer:v}=e,h=b(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:x}=o.useContext(d.E_),y=x(),k=n||x("modal"),w=(0,f.Z)(y),[Z,j,K]=(0,g.ZP)(k,w),P=`${k}-confirm`;let C={};return C=s?{closable:null!=a&&a,title:"",footer:"",children:o.createElement(p.O,Object.assign({},e,{prefixCls:k,confirmPrefixCls:P,rootPrefixCls:y,content:u}))}:{closable:null==a||a,title:i,footer:null!==v&&o.createElement(m.$,Object.assign({},e)),children:u},Z(o.createElement(c.s,Object.assign({prefixCls:k,className:l()(j,`${k}-pure-panel`,s&&P,s&&`${P}-${s}`,t,K,w)},h,{closeIcon:(0,m.b)(k,r),closable:a},C)))})),h=t(75807);function x(e){return(0,r.ZP)((0,r.uW)(e))}const y=s.Z;y.useModal=h.Z,y.info=function(e){return(0,r.ZP)((0,r.cw)(e))},y.success=function(e){return(0,r.ZP)((0,r.vq)(e))},y.error=function(e){return(0,r.ZP)((0,r.AQ)(e))},y.warning=x,y.warn=x,y.confirm=function(e){return(0,r.ZP)((0,r.Au)(e))},y.destroyAll=function(){for(;a.Z.length;){const e=a.Z.pop();e&&e()}},y.config=r.ai,y._InternalPanelDoNotUseOrYouWillBeFired=v;var k=y}}]);