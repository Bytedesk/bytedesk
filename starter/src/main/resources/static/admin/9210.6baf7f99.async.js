"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9210],{4308:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),r=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"},o=n(5901),a=function(e,t){return r.createElement(o.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(a)},82325:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),r=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M744 62H280c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h464c35.3 0 64-28.7 64-64V126c0-35.3-28.7-64-64-64zm-8 824H288V134h448v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"mobile",theme:"outlined"},o=n(5901),a=function(e,t){return r.createElement(o.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(a)},86772:function(e,t,n){var i=n(94433),r=n(38956),s=n(75477),o=n(941),a=n(44194),l=n(99066),u=n(46659),d=n(31549),c=["options","fieldProps","proFieldProps","valueEnum"],v=a.forwardRef((function(e,t){var n=e.options,o=e.fieldProps,a=e.proFieldProps,l=e.valueEnum,v=(0,r.Z)(e,c);return(0,d.jsx)(u.Z,(0,i.Z)({ref:t,valueType:"checkbox",valueEnum:(0,s.h)(l,void 0),fieldProps:(0,i.Z)({options:n},o),lightProps:(0,i.Z)({labelFormatter:function(){return(0,d.jsx)(u.Z,(0,i.Z)({ref:t,valueType:"checkbox",mode:"read",valueEnum:(0,s.h)(l,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,i.Z)({options:n},o),proFieldProps:a},v))}},v.lightProps),proFieldProps:a},v))})),g=a.forwardRef((function(e,t){var n=e.fieldProps,r=e.children;return(0,d.jsx)(o.Z,(0,i.Z)((0,i.Z)({ref:t},n),{},{children:r}))})),f=(0,l.G)(g,{valuePropName:"checked"});f.Group=v,t.Z=f},50447:function(e,t,n){var i=n(94433),r=n(38956),s=n(75477),o=n(44194),a=n(18758),l=n(46659),u=n(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],v=function(e,t){var n=e.fieldProps,c=e.children,v=e.params,g=e.proFieldProps,f=e.mode,p=e.valueEnum,S=e.request,h=e.showSearch,m=e.options,w=(0,r.Z)(e,d),b=(0,o.useContext)(a.Z);return(0,u.jsx)(l.Z,(0,i.Z)((0,i.Z)({valueEnum:(0,s.h)(p),request:S,params:v,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,i.Z)({options:m,mode:f,showSearch:h,getPopupContainer:b.getPopupContainer},n),ref:t,proFieldProps:g},w),{},{children:c}))},g=o.forwardRef((function(e,t){var n=e.fieldProps,d=e.children,v=e.params,g=e.proFieldProps,f=e.mode,p=e.valueEnum,S=e.request,h=e.options,m=(0,r.Z)(e,c),w=(0,i.Z)({options:h,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),b=(0,o.useContext)(a.Z);return(0,u.jsx)(l.Z,(0,i.Z)((0,i.Z)({valueEnum:(0,s.h)(p),request:S,params:v,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,i.Z)({getPopupContainer:b.getPopupContainer},w),ref:t,proFieldProps:g},m),{},{children:d}))})),f=o.forwardRef(v);f.SearchSelect=g,f.displayName="ProFormComponent",t.Z=f},47268:function(e,t,n){var i=n(32906),r=n(94433),s=n(38956),o=n(92032),a=n(70878),l=n(35068),u=n(21762),d=n(44194),c=n(46659),v=n(31549),g=["fieldProps","proFieldProps"],f=["fieldProps","proFieldProps"],p="text",S=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,i.Z)(t,2),s=n[0],u=n[1];return(0,v.jsx)(a.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,i=t.getFieldValue(e.name||[]);return(0,v.jsx)(l.Z,(0,r.Z)((0,r.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,v.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,i),e.strengthText?(0,v.jsx)("div",{style:{marginTop:10},children:(0,v.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},h=function(e){var t=e.fieldProps,n=e.proFieldProps,i=(0,s.Z)(e,g);return(0,v.jsx)(c.Z,(0,r.Z)({valueType:p,fieldProps:t,filedConfig:{valueType:p},proFieldProps:n},i))};h.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,o=(0,s.Z)(e,f),a=(0,d.useState)(!1),l=(0,i.Z)(a,2),g=l[0],h=l[1];return null!=t&&t.statusRender&&o.name?(0,v.jsx)(S,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:g,onOpenChange:h,children:(0,v.jsx)("div",{children:(0,v.jsx)(c.Z,(0,r.Z)({valueType:"password",fieldProps:(0,r.Z)((0,r.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),h(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),h(!0)}}),proFieldProps:n,filedConfig:{valueType:p}},o))})}):(0,v.jsx)(c.Z,(0,r.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:p}},o))},h.displayName="ProFormComponent",t.Z=h},54008:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return h},t5:function(){return p},v_:function(){return g}});var i=n(90819),r=n.n(i),s=n(73193),o=n.n(s),a=n(89933),l=n.n(a),u=n(68992),d=n(62395);function c(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return S.apply(this,arguments)}function S(){return(S=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},18313:function(e,t,n){n.d(t,{IH:function(){return g},RB:function(){return w},SJ:function(){return h},Xy:function(){return k},iO:function(){return x},u9:function(){return c},wU:function(){return p}});var i=n(90819),r=n.n(i),s=n(73193),o=n.n(s),a=n(89933),l=n.n(a),u=n(68992),d=n(62395);function c(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return S.apply(this,arguments)}function S(){return(S=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/enable",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/disable",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/agent/settings/publish",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},34203:function(e,t,n){n.d(t,{Dm:function(){return w},Y2:function(){return p},jT:function(){return g},zN:function(){return h},zc:function(){return c}});var i=n(90819),r=n.n(i),s=n(73193),o=n.n(s),a=n(89933),l=n.n(a),u=n(68992),d=n(62395);function c(e){return v.apply(this,arguments)}function v(){return(v=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/workgroup/settings/query/org",{method:"GET",params:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return f.apply(this,arguments)}function f(){return(f=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/workgroup/settings/create",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return S.apply(this,arguments)}function S(){return(S=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/workgroup/settings/update",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/workgroup/settings/delete",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/workgroup/settings/publish",{method:"POST",data:o()(o()({},t),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},98257:function(e,t,n){n(90819),n(89933),n(73193),n(45332),n(18313),n(90170),n(34203),n(66675),n(48388),n(81997),n(68992),n(62395),n(44194),n(85684),n(91733),n(83262),n(31549)},84005:function(e,t,n){var i=n(73193),r=n.n(i),s=n(90819),o=n.n(s),a=n(89933),l=n.n(a),u=n(45332),d=n.n(u),c=n(91733),v=n(68992),g=n(18313),f=n(90170),p=n(34203),S=(n(62134),n(89007)),h=n(59853),m=n(62395),w=n(44194),b=(n(91743),n(99754)),x=n(31549);t.Z=function(e){var t=e.type,n=(0,m.useIntl)(),i=S.A.useForm(),s=d()(i,1)[0],a=(0,b.Z)().translateString,u=(0,w.useState)(!1),y=d()(u,2),k=(y[0],y[1]),j=(0,w.useState)(""),C=d()(j,2),U=(C[0],C[1]),T=(0,c.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),q=T.currentRobotSettings,F=T.currentAgentSettings,Z=T.currentWorkgroupSettings,R=T.setCurrentRobotSettings,M=T.setCurrentAgentSettings,P=T.setCurrentWorkgroupSettings,A=(0,w.useState)(!1),N=d()(A,2),X=N[0],K=N[1];(0,w.useEffect)((function(){var e,n,i,r;if(t===v.Njn)s.setFieldValue("showRateBtn",null==F||null===(e=F.serviceSettings)||void 0===e?void 0:e.showRateBtn),s.setFieldValue("autoInviteRate",null==F||null===(n=F.serviceSettings)||void 0===n?void 0:n.autoInviteRate),U(a(null==F||null===(i=F.serviceSettings)||void 0===i?void 0:i.inviteRateTip)),k(!(null==F||null===(r=F.serviceSettings)||void 0===r||!r.showRateBtn));else if(t===v.aZD){var o,l,u,d;s.setFieldValue("showRateBtn",null==Z||null===(o=Z.serviceSettings)||void 0===o?void 0:o.showRateBtn),s.setFieldValue("autoInviteRate",null==Z||null===(l=Z.serviceSettings)||void 0===l?void 0:l.autoInviteRate),U(a(null==Z||null===(u=Z.serviceSettings)||void 0===u?void 0:u.inviteRateTip)),k(!(null==Z||null===(d=Z.serviceSettings)||void 0===d||!d.showRateBtn))}else if(t===v._X4){var c,g,f,p;s.setFieldValue("showRateBtn",null==q||null===(c=q.serviceSettings)||void 0===c?void 0:c.showRateBtn),s.setFieldValue("autoInviteRate",null==q||null===(g=q.serviceSettings)||void 0===g?void 0:g.autoInviteRate),U(a(null==q||null===(f=q.serviceSettings)||void 0===f?void 0:f.inviteRateTip)),k(!(null==q||null===(p=q.serviceSettings)||void 0===p||!p.showRateBtn))}}),[null==q?void 0:q.uid,null==F?void 0:F.uid,null==Z?void 0:Z.uid]);var I=function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onFinish:",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=l()(o()().mark((function e(n){var i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("TabRating handleChange autoInviteRate",n),s.setFieldValue("autoInviteRate",n),i={autoInviteRate:n},t===v.Njn&&F?M(r()(r()({},F),{},{serviceSettings:r()(r()({},F.serviceSettings),i),draftServiceSettings:r()(r()({},F.draftServiceSettings||{}),i)})):t===v._X4&&q?R(r()(r()({},q),{},{serviceSettings:r()(r()({},q.serviceSettings),i),draftServiceSettings:r()(r()({},q.draftServiceSettings||{}),i)})):t===v.aZD&&Z&&P(r()(r()({},Z),{},{serviceSettings:r()(r()({},Z.serviceSettings),i),draftServiceSettings:r()(r()({},Z.draftServiceSettings||{}),i)})),e.prev=4,K(!0),t!==v.Njn||null==F||!F.uid){e.next=11;break}return e.next=9,(0,g.wU)({uid:F.uid,serviceSettings:i});case 9:e.next=19;break;case 11:if(t!==v._X4||null==q||!q.uid){e.next=16;break}return e.next=14,(0,f.sK)({uid:q.uid,serviceSettings:i});case 14:e.next=19;break;case 16:if(t!==v.aZD||null==Z||!Z.uid){e.next=19;break}return e.next=19,(0,p.Y2)({uid:Z.uid,serviceSettings:i});case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),console.warn("autoInviteRate 即时保存失败(忽略):",e.t0);case 24:return e.prev=24,K(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[4,21,24,27]])})));return function(t){return e.apply(this,arguments)}}();return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(S.A,{form:s,onFinish:I,submitter:!1,style:{marginLeft:"20px"},children:[(0,x.jsx)(h.Z,{width:"md",name:"autoInviteRate",label:n.formatMessage({id:"rate.auto.invite.rate"}),tooltip:n.formatMessage({id:"rate.auto.invite.rate.tooltip"}),fieldProps:{onChange:_,disabled:X}}),!1]})})}},30394:function(e,t,n){var i=n(73193),r=n.n(i),s=n(90819),o=n.n(s),a=n(89933),l=n.n(a),u=n(45332),d=n.n(u),c=n(61489),v=n(18313),g=n(90170),f=n(34203),p=n(72309),S=n(54008),h=n(66675),m=n(48388),w=n(81997),b=n(91733),x=n(77686),y=n(99754),k=n(68992),j=n(89007),C=n(59853),U=n(47268),T=n(50447),q=n(62395),F=n(44194),Z=n(88130),R=n(44528),M=n(78380),P=n(70378),A=n(4308),N=n(82325),X=n(87005),K=n(83262),I=n(6677),_=n(94571),L=n(44635),V=n(31549);t.Z=function(e){var t,n,i,s,a,u,W,D,E=e.type,O=e.settingsUid,z=(0,q.useIntl)(),B=j.A.useForm(),J=d()(B,1)[0],H=(0,x.u)((function(e){return e.currentOrg})),Q=(0,y.Z)().translateString,Y=(0,F.useState)(),G=d()(Y,2),$=G[0],ee=G[1],te=(0,F.useState)(),ne=d()(te,2),ie=ne[0],re=ne[1],se=(0,F.useState)(),oe=d()(se,2),ae=oe[0],le=oe[1],ue=(0,F.useState)("iframe"),de=d()(ue,2),ce=de[0],ve=de[1],ge=(0,F.useState)(0),fe=d()(ge,2),pe=fe[0],Se=fe[1],he=(0,F.useState)(!1),me=d()(he,2),we=me[0],be=me[1],xe=(0,F.useRef)(Promise.resolve()),ye=(0,F.useState)("desktop"),ke=d()(ye,2),je=ke[0],Ce=ke[1],Ue=(0,F.useState)(),Te=d()(Ue,2),qe=Te[0],Fe=Te[1],Ze=(0,F.useState)(),Re=d()(Ze,2),Me=Re[0],Pe=Re[1],Ae=(0,F.useState)(),Ne=d()(Ae,2),Xe=Ne[0],Ke=Ne[1],Ie=(0,F.useCallback)((function(){var e=(null==H?void 0:H.uid)||"unknown",t=E===k.Njn?"agent":E===k._X4?"robot":"workgroup";return"admin.preview.selected.".concat(t,".").concat(e)}),[null==H?void 0:H.uid,E]),_e=(0,F.useCallback)((function(){try{return localStorage.getItem(Ie())||void 0}catch(e){return}}),[Ie]),Le=(0,F.useCallback)((function(e){try{var t=Ie();e?localStorage.setItem(t,e):localStorage.removeItem(t)}catch(e){}}),[Ie]),Ve=(0,m.V)((function(e){return{robotResult:e.robotResult,setRobotResult:e.setRobotResult}})),We=Ve.robotResult,De=Ve.setRobotResult,Ee=(0,h.E)((function(e){return{agentResult:e.agentResult,setAgentResult:e.setAgentResult}})),Oe=Ee.agentResult,ze=Ee.setAgentResult,Be=(0,w.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),Je=Be.workgroupResult,He=Be.setWorkgroupResult,Qe=(0,b.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),Ye=Qe.currentRobotSettings,Ge=Qe.currentAgentSettings,$e=Qe.currentWorkgroupSettings,et=Qe.setCurrentRobotSettings,tt=Qe.setCurrentAgentSettings,nt=Qe.setCurrentWorkgroupSettings,it=(0,F.useCallback)(function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xe.current=xe.current.then(l()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be(!0),e.prev=1,E!==k.Njn||!Ge){e.next=7;break}return e.next=5,(0,v.wU)({uid:Ge.uid,serviceSettings:t});case 5:case 10:e.next=15;break;case 7:if(E!==k._X4||!Ye){e.next=12;break}return e.next=10,(0,g.sK)({uid:Ye.uid,serviceSettings:t});case 12:if(E!==k.aZD||!$e){e.next=15;break}return e.next=15,(0,f.Y2)({uid:$e.uid,serviceSettings:t});case 15:return e.prev=15,be(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,,15,18]])})))),e.abrupt("return",xe.current);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[E,Ge,Ye,$e]),rt=(0,F.useMemo)((function(){if(E===k._X4){var e,t=qe||(null==We||null===(e=We.data)||void 0===e||null===(e=e.content)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.uid)||"";return{chatType:k.ACv,chatSid:t}}if(E===k.Njn){var n,i=Me||(null==Oe||null===(n=Oe.data)||void 0===n||null===(n=n.content)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.uid)||"";return{chatType:k._0X,chatSid:i}}if(E===k.aZD){var r,s=Xe||(null==Je||null===(r=Je.data)||void 0===r||null===(r=r.content)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.uid)||"";return{chatType:k.I$6,chatSid:s}}return{chatType:k.ACv,chatSid:""}}),[E,qe,null==We||null===(t=We.data)||void 0===t?void 0:t.content,Me,null==Oe||null===(n=Oe.data)||void 0===n?void 0:n.content,Xe,null==Je||null===(i=Je.data)||void 0===i?void 0:i.content]),st=rt.chatType,ot=rt.chatSid,at=function(){var e=l()(o()().mark((function e(){var t,n,i,r,s,a,l;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(z.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:k.QPQ,orgUid:null==H?void 0:H.uid},e.prev=2,e.next=5,(0,S.AP)(t);case 5:n=e.sent,console.log("TabRight.getKbases response:",t,n),c.yw.destroy(),200===n.code?(r={code:n.code,message:n.message,data:{content:n.data.content.map((function(e){return{uid:e.uid,name:e.name,type:e.type,orgUid:e.orgUid}})),totalElements:n.data.totalElements,totalPages:n.data.totalPages,number:n.data.number}},re(r),a=E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings,l=E===k._X4?null==Ye?void 0:Ye.serviceSettings:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:null==$e?void 0:$e.serviceSettings,null!=a&&a.faqKbUid?s=a.faqKbUid:null!=l&&l.faqKbUid?s=l.faqKbUid:(null===(i=r.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.length)>0&&(s=r.data.content[0].uid),s&&(le(s),J.setFieldValue("faqKbUid",s),lt(s))):c.yw.error(n.message),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),c.yw.destroy(),console.error("TabRight 获取知识库失败:",e.t0),c.yw.error("获取知识库失败");case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),lt=function(){var e=l()(o()().mark((function e(t){var n,i,r,s,a,l,u,d;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||ae){e.next=4;break}return console.log("TabRight: 没有选择知识库，无法获取FAQ"),ee(void 0),e.abrupt("return");case 4:return c.yw.loading(z.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:100,orgUid:null==H?void 0:H.uid,kbUid:t||ae},e.prev=6,e.next=9,(0,p.pf)(n);case 9:i=e.sent,console.log("TabRight.getFaqs response:",n,i),c.yw.destroy(),200===i.code?(r={code:i.code,message:i.message,data:{content:i.data.content.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer,kbUid:e.kbUid,orgUid:e.orgUid}})),totalElements:i.data.totalElements,totalPages:i.data.totalPages,number:i.data.number}},ee(r),s=t||ae,a=J.getFieldValue("faqUids")||[],s&&a.length>0&&(u=(null===(l=r.data.content)||void 0===l?void 0:l.map((function(e){return e.uid})))||[],(d=a.filter((function(e){return u.includes(e)}))).length!==a.length&&J.setFieldValue("faqUids",d))):c.yw.error(i.message),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(6),c.yw.destroy(),console.error("TabRight 获取FAQ失败:",e.t0),c.yw.error("获取FAQ失败");case 20:case"end":return e.stop()}}),e,null,[[6,15]])})));return function(t){return e.apply(this,arguments)}}();(0,F.useEffect)((function(){if(E===k._X4){var e=(null==Ye?void 0:Ye.draftServiceSettings)||(null==Ye?void 0:Ye.serviceSettings),t=null==e?void 0:e.showRightIframe,n=null==e?void 0:e.showFaqs;J.setFieldsValue({showRightIframe:t,rightIframeUrl:null==e?void 0:e.rightIframeUrl,showFaqs:n,faqKbUid:null==e?void 0:e.faqKbUid,faqUids:Array.isArray(null==e?void 0:e.faqUids)?null==e?void 0:e.faqUids:Array.isArray(null==e?void 0:e.faqs)?(null==e?void 0:e.faqs).map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[]})}else if(E===k.Njn){var i=(null==Ge?void 0:Ge.draftServiceSettings)||(null==Ge?void 0:Ge.serviceSettings),r=null==i?void 0:i.showRightIframe,s=null==i?void 0:i.showFaqs;J.setFieldsValue({showRightIframe:r,rightIframeUrl:null==i?void 0:i.rightIframeUrl,showFaqs:s,faqKbUid:null==i?void 0:i.faqKbUid,faqUids:Array.isArray(null==i?void 0:i.faqUids)?null==i?void 0:i.faqUids:Array.isArray(null==i?void 0:i.faqs)?(null==i?void 0:i.faqs).map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[]})}else if(E===k.aZD){var o=(null==$e?void 0:$e.draftServiceSettings)||(null==$e?void 0:$e.serviceSettings),a=null==o?void 0:o.showRightIframe,l=null==o?void 0:o.showFaqs;J.setFieldsValue({showRightIframe:a,rightIframeUrl:null==o?void 0:o.rightIframeUrl,showFaqs:l,faqKbUid:null==o?void 0:o.faqKbUid,faqUids:Array.isArray(null==o?void 0:o.faqUids)?null==o?void 0:o.faqUids:Array.isArray(null==o?void 0:o.faqs)?(null==o?void 0:o.faqs).map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[]})}}),[Ye,Ge,$e,st,ot,null==H?void 0:H.uid]),(0,F.useEffect)((function(){null!=H&&H.uid&&at()}),[null==H?void 0:H.uid,E]),(0,F.useEffect)((function(){var e=function(){var e=l()(o()().mark((function e(){var t,n,i,r,s,a,l,u,d,c,v,g,f,p,S,h,m,w,b,x,y;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=H&&H.uid){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,E!==k.Njn){e.next=11;break}return t={pageNumber:0,pageSize:100,orgUid:H.uid},e.next=7,(0,I._t)(t);case 7:200===(n=e.sent).code&&(ze(n),r=(null===(i=n.data)||void 0===i?void 0:i.content)||[],s=_e(),(a=s?r.find((function(e){return(null==e?void 0:e.uid)===s})):void 0)?Pe(a.uid):!Me&&r.length&&(l=r[0],Pe(null==l?void 0:l.uid),Le(null==l?void 0:l.uid))),e.next=25;break;case 11:if(E!==k._X4){e.next=19;break}return u={pageNumber:0,pageSize:100,level:k.whQ,type:k.f4h,orgUid:H.uid},e.next=15,(0,_.p0)(u);case 15:200===(d=e.sent).code&&(De(d),v=(null===(c=d.data)||void 0===c?void 0:c.content)||[],g=_e(),(f=g?v.find((function(e){return(null==e?void 0:e.uid)===g})):void 0)?Fe(f.uid):!qe&&v.length&&(p=v[0],Fe(null==p?void 0:p.uid),Le(null==p?void 0:p.uid))),e.next=25;break;case 19:if(E!==k.aZD){e.next=25;break}return S={pageNumber:0,pageSize:100,orgUid:H.uid},e.next=23,(0,L.LE)(S);case 23:200===(h=e.sent).code&&(He(h),w=(null===(m=h.data)||void 0===m?void 0:m.content)||[],b=_e(),(x=b?w.find((function(e){return(null==e?void 0:e.uid)===b})):void 0)?Ke(x.uid):!Xe&&w.length&&(y=w[0],Ke(null==y?void 0:y.uid),Le(null==y?void 0:y.uid)));case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(2),console.warn("加载预览实体失败(忽略):",e.t0);case 30:case"end":return e.stop()}}),e,null,[[2,27]])})));return function(){return e.apply(this,arguments)}}();e()}),[null==H?void 0:H.uid,E,ze,De,He,Me,qe,Xe,_e,Le]),(0,F.useEffect)((function(){void 0!==O&&dt("switch-settings")}),[O]);var ut=function(){var e=l()(o()().mark((function e(){var t,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E===k.Njn?null==Ge?void 0:Ge.uid:E===k._X4?null==Ye?void 0:Ye.uid:null==$e?void 0:$e.uid){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,J.validateFields();case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),c.yw.warning(z.formatMessage({id:"form.validate.failed",defaultMessage:"请先修正表单校验错误"})),e.abrupt("return",!1);case 12:if(t=J.getFieldsValue(),n={showRightIframe:t.showRightIframe,rightIframeUrl:t.rightIframeUrl,showFaqs:t.showFaqs,faqKbUid:t.faqKbUid,faqUids:Array.isArray(t.faqUids)?t.faqUids:void 0},e.prev=14,be(!0),E!==k.Njn||!Ge){e.next=21;break}return e.next=19,(0,v.wU)({uid:Ge.uid,serviceSettings:n});case 19:case 24:e.next=29;break;case 21:if(E!==k._X4||!Ye){e.next=26;break}return e.next=24,(0,g.sK)({uid:Ye.uid,serviceSettings:n});case 26:if(E!==k.aZD||!$e){e.next=29;break}return e.next=29,(0,f.Y2)({uid:$e.uid,serviceSettings:n});case 29:return e.abrupt("return",!0);case 32:return e.prev=32,e.t1=e.catch(14),console.warn("保存右侧配置失败(忽略刷新):",e.t1),c.yw.error(z.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 37:return e.prev=37,be(!1),e.finish(37);case 40:case"end":return e.stop()}}),e,null,[[3,8],[14,32,37,40]])})));return function(){return e.apply(this,arguments)}}(),dt=function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.current;case 2:if(!we){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,ut();case 6:e.sent&&Se((function(e){return e+1}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ct=function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onFinish:",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),vt=function(){var e=l()(o()().mark((function e(t){var n,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabRight handleChange showRightIframe",t),J.setFieldValue("showRightIframe",t),n={showRightIframe:t},E===k.Njn&&Ge?tt(r()(r()({},Ge),{},{serviceSettings:r()(r()({},Ge.serviceSettings),n),draftServiceSettings:r()(r()({},Ge.draftServiceSettings||{}),n)})):E===k._X4&&Ye?et(r()(r()({},Ye),{},{serviceSettings:r()(r()({},Ye.serviceSettings),n),draftServiceSettings:r()(r()({},Ye.draftServiceSettings||{}),n)})):E===k.aZD&&$e&&nt(r()(r()({},$e),{},{serviceSettings:r()(r()({},$e.serviceSettings),n),draftServiceSettings:r()(r()({},$e.draftServiceSettings||{}),n)})),e.prev=4,i={showRightIframe:t},e.next=8,it(i);case 8:Se((function(e){return e+1})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn("showRightIframe 即时保存失败(忽略):",e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}(),gt=function(){var e=l()(o()().mark((function e(t){var n,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabRight handleChange showFaqs",t),J.setFieldValue("showFaqs",t),n={showFaqs:t},E===k.Njn&&Ge?tt(r()(r()({},Ge),{},{serviceSettings:r()(r()({},Ge.serviceSettings),n),draftServiceSettings:r()(r()({},Ge.draftServiceSettings||{}),n)})):E===k._X4&&Ye?et(r()(r()({},Ye),{},{serviceSettings:r()(r()({},Ye.serviceSettings),n),draftServiceSettings:r()(r()({},Ye.draftServiceSettings||{}),n)})):E===k.aZD&&$e&&nt(r()(r()({},$e),{},{serviceSettings:r()(r()({},$e.serviceSettings),n),draftServiceSettings:r()(r()({},$e.draftServiceSettings||{}),n)})),e.prev=4,i={showFaqs:t},e.next=8,it(i);case 8:Se((function(e){return e+1})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn("showFaqs 即时保存失败(忽略):",e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}(),ft=(0,F.useMemo)((function(){return O||(E===k.Njn?null==Ge?void 0:Ge.uid:E===k._X4?null==Ye?void 0:Ye.uid:E===k.aZD?null==$e?void 0:$e.uid:void 0)}),[O,E,null==Ge?void 0:Ge.uid,null==Ye?void 0:Ye.uid,null==$e?void 0:$e.uid]),pt=(0,F.useMemo)((function(){var e=(0,X.Cn)(),t=new URLSearchParams({org:(null==H?void 0:H.uid)||"",t:st,sid:ot,debug:"1",k:String(pe)});ft&&t.set("settingsUid",ft);var n="".concat(e,"?").concat(t.toString());return console.log("Chat Preview URL Right:",n),n}),[null==H?void 0:H.uid,st,ot,pe,ft]),St=(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(C.Z,{width:"md",name:"showRightIframe",label:(0,V.jsxs)("span",{children:[z.formatMessage({id:"showRightIframe"}),(0,V.jsx)(K.Z,{type:"service",keys:["showRightIframe"],live:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:E===k._X4?null==Ye?void 0:Ye.serviceSettings:null==$e?void 0:$e.serviceSettings,draft:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings})]}),fieldProps:{onChange:vt,disabled:we}}),(0,V.jsx)(U.Z,{width:"md",name:"rightIframeUrl",label:(0,V.jsxs)("span",{children:[z.formatMessage({id:"rightIframeUrl"}),(0,V.jsx)(K.Z,{type:"service",keys:["rightIframeUrl"],live:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:E===k._X4?null==Ye?void 0:Ye.serviceSettings:null==$e?void 0:$e.serviceSettings,draft:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings})]}),placeholder:z.formatMessage({id:"rightIframeUrl.placeholder",defaultMessage:"请输入以 http:// 或 https:// 开头的URL"}),rules:[{type:"url",message:z.formatMessage({id:"rightIframeUrl.invalid",defaultMessage:"请输入有效的URL地址"})},{pattern:/^https?:\/\/[^\s]+$/i,message:z.formatMessage({id:"rightIframeUrl.scheme.required",defaultMessage:"必须以 http:// 或 https:// 开头"})}],fieldProps:{type:"url",inputMode:"url",allowClear:!0,disabled:we}})]}),ht=(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(C.Z,{width:"md",name:"showFaqs",label:(0,V.jsxs)("span",{children:[z.formatMessage({id:"faq.show.faqs"}),(0,V.jsx)(K.Z,{type:"service",keys:["showFaqs"],live:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:E===k._X4?null==Ye?void 0:Ye.serviceSettings:null==$e?void 0:$e.serviceSettings,draft:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings})]}),fieldProps:{onChange:gt,disabled:we}}),(0,V.jsx)(T.Z,{name:"faqKbUid",width:"md",label:(0,V.jsxs)("span",{children:[z.formatMessage({id:"faq.kbase.select",defaultMessage:"选择侧边栏常见问题知识库"}),(0,V.jsx)(K.Z,{type:"service",keys:["faqKbUid"],live:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:E===k._X4?null==Ye?void 0:Ye.serviceSettings:null==$e?void 0:$e.serviceSettings,draft:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings})]}),options:null==ie||null===(s=ie.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:Q(e.name),value:e.uid}})),fieldProps:{onChange:function(e){console.log("TabRight selected kbase:",e),le(e),J.setFieldValue("faqUids",[]),lt(e);var t={faqKbUid:e,faqs:void 0,faqUids:[]};E===k.Njn&&Ge?tt(r()(r()({},Ge),{},{serviceSettings:r()(r()({},Ge.serviceSettings),t),draftServiceSettings:r()(r()({},Ge.draftServiceSettings||{}),t)})):E===k._X4&&Ye?et(r()(r()({},Ye),{},{serviceSettings:r()(r()({},Ye.serviceSettings),t),draftServiceSettings:r()(r()({},Ye.draftServiceSettings||{}),t)})):E===k.aZD&&$e&&nt(r()(r()({},$e),{},{serviceSettings:r()(r()({},$e.serviceSettings),t),draftServiceSettings:r()(r()({},$e.draftServiceSettings||{}),t)}))},allowClear:!0,placeholder:z.formatMessage({id:"choose",defaultMessage:"Choose"}),disabled:we}}),(0,V.jsx)(T.Z,{name:"faqUids",width:"md",label:(0,V.jsxs)("span",{children:[z.formatMessage({id:"menu.kbase.faq"}),(0,V.jsx)(K.Z,{type:"service",keys:["faqUids"],live:E===k.Njn?null==Ge?void 0:Ge.serviceSettings:E===k._X4?null==Ye?void 0:Ye.serviceSettings:null==$e?void 0:$e.serviceSettings,draft:E===k.Njn?null==Ge?void 0:Ge.draftServiceSettings:E===k._X4?null==Ye?void 0:Ye.draftServiceSettings:null==$e?void 0:$e.draftServiceSettings})]}),options:null==$||null===(a=$.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.map((function(e){return{label:Q(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:z.formatMessage({id:"choose",defaultMessage:"Choose"}),disabled:we}})]});return(0,V.jsxs)(Z.Z,{children:[(0,V.jsx)(Z.Z.Panel,{defaultSize:"30%",min:"20%",max:"50%",children:(0,V.jsx)("div",{style:{padding:"0 16px",height:"100%",overflowY:"auto"},children:(0,V.jsx)(j.A,{form:J,onFinish:ct,onValuesChange:function(e,t){var n={rightIframeUrl:t.rightIframeUrl,faqKbUid:t.faqKbUid,faqUids:t.faqUids,showRightIframe:t.showRightIframe,showFaqs:t.showFaqs};E===k.Njn&&Ge?tt(r()(r()({},Ge),{},{serviceSettings:r()(r()({},Ge.serviceSettings),n),draftServiceSettings:r()(r()({},Ge.draftServiceSettings||{}),n)})):E===k._X4&&Ye?et(r()(r()({},Ye),{},{serviceSettings:r()(r()({},Ye.serviceSettings),n),draftServiceSettings:r()(r()({},Ye.draftServiceSettings||{}),n)})):E===k.aZD&&$e&&nt(r()(r()({},$e),{},{serviceSettings:r()(r()({},$e.serviceSettings),n),draftServiceSettings:r()(r()({},$e.draftServiceSettings||{}),n)}))},submitter:!1,children:(0,V.jsx)(R.Z,{activeKey:ce,onChange:ve,items:[{key:"iframe",label:z.formatMessage({id:"showRightIframe",defaultMessage:"右侧iframe"}),children:St},{key:"faq",label:z.formatMessage({id:"faq.show.faqs",defaultMessage:"常见问题"}),children:ht}]})})})}),(0,V.jsx)(Z.Z.Panel,{children:(0,V.jsxs)("div",{style:{height:"100%",padding:"16px",background:"#f0f2f5",display:"flex",flexDirection:"column"},children:[(0,V.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,gap:12},children:[E===k.Njn&&(0,V.jsx)(M.Z,{style:{minWidth:220},value:Me,placeholder:z.formatMessage({id:"preview.select.agent",defaultMessage:"选择预览客服"}),options:((null==Oe||null===(u=Oe.data)||void 0===u?void 0:u.content)||[]).map((function(e){return{value:e.uid,label:Q(e.nickname)}})),onChange:function(e){Pe(e),Le(e),dt("switch-agent")},allowClear:!0,disabled:we}),E===k._X4&&(0,V.jsx)(M.Z,{style:{minWidth:220},value:qe,placeholder:z.formatMessage({id:"preview.select.robot",defaultMessage:"选择预览机器人"}),options:((null==We||null===(W=We.data)||void 0===W?void 0:W.content)||[]).map((function(e){return{value:e.uid,label:Q(e.nickname)}})),onChange:function(e){Fe(e),Le(e),dt("switch-robot")},allowClear:!0,disabled:we}),E===k.aZD&&(0,V.jsx)(M.Z,{style:{minWidth:220},value:Xe,placeholder:z.formatMessage({id:"preview.select.workgroup",defaultMessage:"选择预览工作组"}),options:((null==Je||null===(D=Je.data)||void 0===D?void 0:D.content)||[]).map((function(e){return{value:e.uid,label:Q(e.nickname)}})),onChange:function(e){Ke(e),Le(e),dt("switch-workgroup")},allowClear:!0,disabled:we}),(0,V.jsx)(P.Z,{value:je,onChange:function(e){return Ce(e)},options:[{value:"desktop",icon:(0,V.jsx)(A.Z,{})},{value:"mobile",icon:(0,V.jsx)(N.Z,{})}],disabled:we})]}),(0,V.jsx)("div",{style:{flex:1,minHeight:720,display:"flex",justifyContent:"center"},children:(0,V.jsx)("div",{style:{width:"mobile"===je?390:"100%",height:"100%",border:"1px solid #d9d9d9",borderRadius:4,overflow:"hidden",background:"#fff"},children:(0,V.jsx)("iframe",{src:pt,style:{width:"100%",height:"100%",border:"none"},title:"Chat Preview"},pe)})})]})})]})}},51898:function(e,t,n){var i=n(73193),r=n.n(i),s=n(45332),o=n.n(s),a=n(91733),l=n(66675),u=n(68992),d=n(89007),c=n(82465),v=n(86772),g=n(62395),f=n(44194),p=n(83262),S=n(31549);t.Z=function(e){var t=e.type,n=d.A.useForm(),i=o()(n,1)[0],s=(0,g.useIntl)(),h=(0,a.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),m=h.currentRobotSettings,w=h.currentAgentSettings,b=h.currentWorkgroupSettings,x=h.setCurrentRobotSettings,y=h.setCurrentAgentSettings,k=h.setCurrentWorkgroupSettings,j=(0,l.E)((function(e){return{currentAgent:e.currentAgent}})).currentAgent;(0,f.useEffect)((function(){if(t===u._X4&&(null!=m&&m.draftServiceSettings||null!=m&&m.serviceSettings)){var e=(null==m?void 0:m.draftServiceSettings)||(null==m?void 0:m.serviceSettings);i.setFieldValue("autoCloseMin",null==e?void 0:e.autoCloseMin),i.setFieldValue("showLogo",null==e?void 0:e.showLogo)}else if(t===u.Njn&&(null!=w&&w.draftServiceSettings||null!=w&&w.serviceSettings)){var n=(null==w?void 0:w.draftServiceSettings)||(null==w?void 0:w.serviceSettings);i.setFieldValue("autoCloseMin",null==n?void 0:n.autoCloseMin),i.setFieldValue("showLogo",null==n?void 0:n.showLogo),i.setFieldValue("maxThreadCount",null==w?void 0:w.maxThreadCount),i.setFieldValue("timeoutRemindTime",null==w?void 0:w.timeoutRemindTime)}else if(t===u.aZD&&(null!=b&&b.draftServiceSettings||null!=b&&b.serviceSettings)){var r=(null==b?void 0:b.draftServiceSettings)||(null==b?void 0:b.serviceSettings);i.setFieldValue("autoCloseMin",null==r?void 0:r.autoCloseMin),i.setFieldValue("showLogo",null==r?void 0:r.showLogo)}}),[null==m?void 0:m.uid,null==w?void 0:w.uid,null==b?void 0:b.uid,null==j?void 0:j.uid]);return(0,S.jsxs)(d.A,{form:i,submitter:!1,style:{marginLeft:"20px"},children:[t===u.Njn&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(c.Z,{width:"md",name:"maxThreadCount",label:s.formatMessage({id:"agent.settings.max.thread"}),min:0,fieldProps:{onChange:function(e){t===u.Njn&&w&&y(r()(r()({},w),{},{maxThreadCount:e}))}}}),(0,S.jsx)(c.Z,{width:"md",name:"timeoutRemindTime",label:s.formatMessage({id:"agent.settings.timeout.remind",defaultMessage:"超时提醒时间"}),tooltip:s.formatMessage({id:"agent.settings.timeout.remind.tooltip",defaultMessage:"超过设定时间未回复客户将收到提醒"}),min:1,fieldProps:{addonAfter:s.formatMessage({id:"time.minute",defaultMessage:"分钟"}),onChange:function(e){t===u.Njn&&w&&y(r()(r()({},w),{},{timeoutRemindTime:e}))}}})]}),(0,S.jsx)(c.Z,{width:"md",name:"autoCloseMin",label:(0,S.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.auto.close.time"}),(0,S.jsx)(p.Z,{type:"service",keys:["autoCloseMin"],live:t===u.Njn?null==w?void 0:w.serviceSettings:t===u._X4?null==m?void 0:m.serviceSettings:null==b?void 0:b.serviceSettings,draft:t===u.Njn?null==w?void 0:w.draftServiceSettings:t===u._X4?null==m?void 0:m.draftServiceSettings:null==b?void 0:b.draftServiceSettings})]}),tooltip:s.formatMessage({id:"agent.settings.auto.close.time.tooltip"}),min:1,fieldProps:{onChange:function(e){t===u.Njn&&w?y(r()(r()({},w),{},{serviceSettings:r()(r()({},w.serviceSettings),{},{autoCloseMin:e}),draftServiceSettings:r()(r()({},w.draftServiceSettings||{}),{},{autoCloseMin:e})})):t===u._X4&&m?x(r()(r()({},m),{},{serviceSettings:r()(r()({},m.serviceSettings),{},{autoCloseMin:e}),draftServiceSettings:r()(r()({},m.draftServiceSettings||{}),{},{autoCloseMin:e})})):t===u.aZD&&b&&k(r()(r()({},b),{},{serviceSettings:r()(r()({},b.serviceSettings),{},{autoCloseMin:e}),draftServiceSettings:r()(r()({},b.draftServiceSettings||{}),{},{autoCloseMin:e})}))}}}),(0,S.jsx)(v.Z,{name:"showLogo",width:"md",label:(0,S.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.show.logo"}),(0,S.jsx)(p.Z,{type:"service",keys:["showLogo"],live:t===u.Njn?null==w?void 0:w.serviceSettings:t===u._X4?null==m?void 0:m.serviceSettings:null==b?void 0:b.serviceSettings,draft:t===u.Njn?null==w?void 0:w.draftServiceSettings:t===u._X4?null==m?void 0:m.draftServiceSettings:null==b?void 0:b.draftServiceSettings})]}),tooltip:s.formatMessage({id:"agent.settings.show.logo.tooltip"}),fieldProps:{onChange:function(e){console.log("onShowLogoChange = ".concat(e.target.checked))}},disabled:!0})]})}},28672:function(e,t,n){var i=n(90819),r=n.n(i),s=n(89933),o=n.n(s),a=n(73193),l=n.n(a),u=n(45332),d=n.n(u),c=n(99754),v=n(91733),g=n(18313),f=n(90170),p=n(34203),S=n(68992),h=n(89007),m=n(86772),w=n(62395),b=n(44194),x=n(91743),y=n(62134),k=n(83262),j=n(31549);t.Z=function(e){var t=e.type,n=h.A.useForm(),i=d()(n,1)[0],s=(0,w.useIntl)(),a=(0,c.Z)().translateString,u=(0,b.useState)(!1),C=d()(u,2),U=C[0],T=C[1],q=(0,v.z)((function(e){return{currentAgentSettings:e.currentAgentSettings,currentRobotSettings:e.currentRobotSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),F=q.currentAgentSettings,Z=q.currentRobotSettings,R=q.currentWorkgroupSettings,M=q.setCurrentAgentSettings,P=q.setCurrentRobotSettings,A=q.setCurrentWorkgroupSettings,N=(0,b.useState)(""),X=d()(N,2),K=X[0],I=X[1],_=(0,b.useState)(""),L=d()(_,2),V=L[0],W=L[1],D=(0,b.useState)(""),E=d()(D,2),O=E[0],z=E[1],B=(0,b.useState)(""),J=d()(B,2),H=J[0],Q=J[1];(0,b.useEffect)((function(){if(t===S._X4&&(null!=Z&&Z.draftServiceSettings||null!=Z&&Z.serviceSettings)){var e=(null==Z?void 0:Z.draftServiceSettings)||(null==Z?void 0:Z.serviceSettings);W(a(null==e?void 0:e.topTip)),Q(a(null==e?void 0:e.autoCloseTip)),T(!(null==e||!e.showTopTip)),i.setFieldValue("showTopTip",null==e?void 0:e.showTopTip)}else if(t===S.Njn&&(null!=F&&F.draftServiceSettings||null!=F&&F.serviceSettings)){var n=(null==F?void 0:F.draftServiceSettings)||(null==F?void 0:F.serviceSettings);W(a(null==n?void 0:n.topTip)),z(a(null==n?void 0:n.agentCloseTip)),Q(a(null==n?void 0:n.autoCloseTip));var r=(null==F?void 0:F.draftMessageLeaveSettings)||(null==F?void 0:F.messageLeaveSettings);I(a(null==r?void 0:r.messageLeaveTip)),T(!(null==n||!n.showTopTip)),i.setFieldValue("showTopTip",null==n?void 0:n.showTopTip)}else if(t===S.aZD&&(null!=R&&R.draftServiceSettings||null!=R&&R.serviceSettings)){var s=(null==R?void 0:R.draftServiceSettings)||(null==R?void 0:R.serviceSettings);W(a(null==s?void 0:s.topTip)),z(a(null==s?void 0:s.agentCloseTip)),Q(a(null==s?void 0:s.autoCloseTip));var o=(null==R?void 0:R.draftMessageLeaveSettings)||(null==R?void 0:R.messageLeaveSettings);I(a(null==o?void 0:o.messageLeaveTip)),T(!(null==s||!s.showTopTip)),i.setFieldValue("showTopTip",null==s?void 0:s.showTopTip)}}),[t,null==Z?void 0:Z.uid,null==F?void 0:F.uid,null==R?void 0:R.uid]);return(0,j.jsxs)(h.A,{form:i,submitter:!1,style:{marginLeft:"20px"},children:[(0,j.jsx)(m.Z,{name:"showTopTip",width:"md",label:(0,j.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.show.top.tip"}),(0,j.jsx)(k.Z,{type:"service",keys:["showTopTip"],live:t===S.Njn?null==F?void 0:F.serviceSettings:t===S._X4?null==Z?void 0:Z.serviceSettings:null==R?void 0:R.serviceSettings,draft:t===S.Njn?null==F?void 0:F.draftServiceSettings:t===S._X4?null==Z?void 0:Z.draftServiceSettings:null==R?void 0:R.draftServiceSettings})]}),fieldProps:{onChange:function(e){var n;if(T(e.target.checked),e.target.checked)if(t===S._X4)W(a(null==Z||null===(n=Z.serviceSettings)||void 0===n?void 0:n.topTip));else if(t===S.Njn){var i;W(a(null==F||null===(i=F.serviceSettings)||void 0===i?void 0:i.topTip))}else if(t===S.aZD){var s;W(a(null==R||null===(s=R.serviceSettings)||void 0===s?void 0:s.topTip))}t===S.Njn&&F?M(l()(l()({},F),{},{serviceSettings:l()(l()({},F.serviceSettings),{},{showTopTip:e.target.checked})})):t===S._X4&&Z?P(l()(l()({},Z),{},{serviceSettings:l()(l()({},Z.serviceSettings),{},{showTopTip:e.target.checked})})):t===S.aZD&&R&&A(l()(l()({},R),{},{serviceSettings:l()(l()({},R.serviceSettings),{},{showTopTip:e.target.checked})})),o()(r()().mark((function n(){var i;return r()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,i={serviceSettings:{showTopTip:e.target.checked}},t!==S.Njn||!F){n.next=7;break}return n.next=5,(0,g.wU)(l()({uid:F.uid},i));case 5:n.next=15;break;case 7:if(t!==S._X4||!Z){n.next=12;break}return n.next=10,(0,f.sK)(l()({uid:Z.uid},i));case 10:n.next=15;break;case 12:if(t!==S.aZD||!R){n.next=15;break}return n.next=15,(0,p.Y2)(l()({uid:R.uid},i));case 15:n.next=20;break;case 17:n.prev=17,n.t0=n.catch(0),console.warn("showTopTip 即时保存失败(忽略):",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})))()}}}),U&&(0,j.jsx)(h.A.Item,{name:"topTip",label:(0,j.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.top.tip"}),(0,j.jsx)(k.Z,{type:"service",keys:["topTip"],live:t===S.Njn?null==F?void 0:F.serviceSettings:t===S._X4?null==Z?void 0:Z.serviceSettings:null==R?void 0:R.serviceSettings,draft:t===S.Njn?null==F?void 0:F.draftServiceSettings:t===S._X4?null==Z?void 0:Z.draftServiceSettings:null==R?void 0:R.draftServiceSettings})]}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.top.tip.required"})}],children:(0,j.jsx)(x.Z,{placeholder:s.formatMessage({id:"agent.settings.top.tip.placeholder"}),value:V,toolbarKeys:(0,y.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){console.log("topTip onchange:",e),i.setFieldValue("topTip",e),t===S.Njn&&F?M(l()(l()({},F),{},{serviceSettings:l()(l()({},F.serviceSettings),{},{topTip:e}),draftServiceSettings:l()(l()({},F.draftServiceSettings||{}),{},{topTip:e})})):t===S._X4&&Z?P(l()(l()({},Z),{},{serviceSettings:l()(l()({},Z.serviceSettings),{},{topTip:e}),draftServiceSettings:l()(l()({},Z.draftServiceSettings||{}),{},{topTip:e})})):t===S.aZD&&R&&A(l()(l()({},R),{},{serviceSettings:l()(l()({},R.serviceSettings),{},{topTip:e}),draftServiceSettings:l()(l()({},R.draftServiceSettings||{}),{},{topTip:e})}))}},"topTipEditor")}),t!==S._X4&&(0,j.jsx)(h.A.Item,{name:"messageLeaveTip",label:(0,j.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.leave.msg"}),(0,j.jsx)(k.Z,{type:"messageLeave",keys:["messageLeaveTip"],live:t===S.Njn?null==F?void 0:F.messageLeaveSettings:null==R?void 0:R.messageLeaveSettings,draft:t===S.Njn?null==F?void 0:F.draftMessageLeaveSettings:null==R?void 0:R.draftMessageLeaveSettings})]}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.leave.msg.required"})}],children:(0,j.jsx)(x.Z,{placeholder:s.formatMessage({id:"agent.settings.leave.msg.placeholder"}),value:K,toolbarKeys:(0,y.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){console.log("messageLeaveTip onchange:",e),i.setFieldValue("messageLeaveTip",e),t===S.Njn&&F?M(l()(l()({},F),{},{messageLeaveSettings:l()(l()({},F.messageLeaveSettings),{},{messageLeaveTip:e}),draftMessageLeaveSettings:l()(l()({},F.draftMessageLeaveSettings||{}),{},{messageLeaveTip:e})})):t===S.aZD&&R&&A(l()(l()({},R),{},{messageLeaveSettings:l()(l()({},R.messageLeaveSettings),{},{messageLeaveTip:e}),draftMessageLeaveSettings:l()(l()({},R.draftMessageLeaveSettings||{}),{},{messageLeaveTip:e})}))}},"leaveMsgEditor")}),t!==S._X4&&(0,j.jsx)(h.A.Item,{name:"agentCloseTip",label:(0,j.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.agent.close.tip"}),(0,j.jsx)(k.Z,{type:"service",keys:["agentCloseTip"],live:t===S.Njn?null==F?void 0:F.serviceSettings:null==R?void 0:R.serviceSettings,draft:t===S.Njn?null==F?void 0:F.draftServiceSettings:null==R?void 0:R.draftServiceSettings})]}),tooltip:s.formatMessage({id:"agent.settings.agent.close.tip.tooltip"}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.agent.close.tip.required"})}],children:(0,j.jsx)(x.Z,{placeholder:s.formatMessage({id:"agent.settings.agent.close.tip.placeholder"}),value:O,toolbarKeys:(0,y.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){console.log("agentCloseTip onchange:",e),i.setFieldValue("agentCloseTip",e),t===S.Njn&&F?M(l()(l()({},F),{},{serviceSettings:l()(l()({},F.serviceSettings),{},{agentCloseTip:e}),draftServiceSettings:l()(l()({},F.draftServiceSettings||{}),{},{agentCloseTip:e})})):t===S.aZD&&R&&A(l()(l()({},R),{},{serviceSettings:l()(l()({},R.serviceSettings),{},{agentCloseTip:e}),draftServiceSettings:l()(l()({},R.draftServiceSettings||{}),{},{agentCloseTip:e})}))}},"agentCloseTipEditor")}),(0,j.jsx)(h.A.Item,{name:"autoCloseTip",label:(0,j.jsxs)("span",{children:[s.formatMessage({id:"agent.settings.auto.close.tip"}),(0,j.jsx)(k.Z,{type:"service",keys:["autoCloseTip"],live:t===S.Njn?null==F?void 0:F.serviceSettings:t===S._X4?null==Z?void 0:Z.serviceSettings:null==R?void 0:R.serviceSettings,draft:t===S.Njn?null==F?void 0:F.draftServiceSettings:t===S._X4?null==Z?void 0:Z.draftServiceSettings:null==R?void 0:R.draftServiceSettings})]}),tooltip:s.formatMessage({id:"agent.settings.auto.close.tip.tooltip"}),rules:[{required:!0,message:s.formatMessage({id:"agent.settings.auto.close.tip.required"})}],children:(0,j.jsx)(x.Z,{placeholder:s.formatMessage({id:"agent.settings.auto.close.tip.placeholder"}),value:H,toolbarKeys:(0,y.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){console.log("autoCloseTip onchange:",e),i.setFieldValue("autoCloseTip",e),t===S.Njn&&F?M(l()(l()({},F),{},{serviceSettings:l()(l()({},F.serviceSettings),{},{autoCloseTip:e}),draftServiceSettings:l()(l()({},F.draftServiceSettings||{}),{},{autoCloseTip:e})})):t===S._X4&&Z?P(l()(l()({},Z),{},{serviceSettings:l()(l()({},Z.serviceSettings),{},{autoCloseTip:e}),draftServiceSettings:l()(l()({},Z.draftServiceSettings||{}),{},{autoCloseTip:e})})):t===S.aZD&&R&&A(l()(l()({},R),{},{serviceSettings:l()(l()({},R.serviceSettings),{},{autoCloseTip:e}),draftServiceSettings:l()(l()({},R.draftServiceSettings||{}),{},{autoCloseTip:e})}))}},"autoCloseTipEditor")})]})}},65448:function(e,t,n){var i=n(90819),r=n.n(i),s=n(89933),o=n.n(s),a=n(73193),l=n.n(a),u=n(45332),d=n.n(u),c=n(61489),v=n(99754),g=n(91733),f=n(68992),p=n(89007),S=n(50447),h=n(62395),m=n(44194),w=n(91743),b=n(62134),x=n(83262),y=n(77686),k=n(72309),j=n(54008),C=n(31549);t.Z=function(e){var t,n,i,s,a,u,U,T,q,F,Z,R,M,P,A,N,X,K,I,_,L,V,W,D,E,O,z,B,J,H,Q,Y,G,$,ee=e.type,te=p.A.useForm(),ne=d()(te,1)[0],ie=(0,h.useIntl)(),re=(0,v.Z)().translateString,se=(0,y.u)((function(e){return e.currentOrg})),oe=(0,m.useState)(),ae=d()(oe,2),le=ae[0],ue=ae[1],de=(0,m.useState)(),ce=d()(de,2),ve=ce[0],ge=ce[1],fe=(0,m.useState)(),pe=d()(fe,2),Se=pe[0],he=pe[1],me=(0,g.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,currentAgentSettings:e.currentAgentSettings,currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentAgentSettings:e.setCurrentAgentSettings,setCurrentRobotSettings:e.setCurrentRobotSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),we=me.currentRobotSettings,be=me.currentAgentSettings,xe=me.currentWorkgroupSettings,ye=me.setCurrentAgentSettings,ke=me.setCurrentRobotSettings,je=me.setCurrentWorkgroupSettings,Ce=(0,m.useState)(""),Ue=d()(Ce,2),Te=Ue[0],qe=Ue[1],Fe=(0,m.useRef)(!1),Ze=(0,m.useCallback)((function(e){console.log("welcomeTip onchange:",e),ne.setFieldValue("welcomeTip",e),ee===f.Njn&&be?ye(l()(l()({},be),{},{serviceSettings:l()(l()({},be.serviceSettings),{},{welcomeTip:e}),draftServiceSettings:l()(l()({},be.draftServiceSettings||{}),{},{welcomeTip:e})})):ee===f._X4&&we?ke(l()(l()({},we),{},{serviceSettings:l()(l()({},we.serviceSettings),{},{welcomeTip:e}),draftServiceSettings:l()(l()({},we.draftServiceSettings||{}),{},{welcomeTip:e})})):ee===f.aZD&&xe&&je(l()(l()({},xe),{},{serviceSettings:l()(l()({},xe.serviceSettings),{},{welcomeTip:e}),draftServiceSettings:l()(l()({},xe.draftServiceSettings||{}),{},{welcomeTip:e})}))}),[ne,ee,be,we,xe,ye,ke,je]),Re=function(){var e=o()(r()().mark((function e(){var t,n,i,s,o,a,u,d,v,g,p,S,h,m,w,b,x,y,k;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(ie.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:f.QPQ,orgUid:null==se?void 0:se.uid},e.next=4,(0,j.AP)(t);case 4:n=e.sent,c.yw.destroy(),200===n.code?(ge(n),p=(null===(i=n.data)||void 0===i?void 0:i.content)||[],S=ee===f.Njn?(null==be||null===(s=be.draftServiceSettings)||void 0===s?void 0:s.welcomeKbUid)||(null==be||null===(o=be.serviceSettings)||void 0===o?void 0:o.welcomeKbUid):ee===f._X4?(null==we||null===(a=we.draftServiceSettings)||void 0===a?void 0:a.welcomeKbUid)||(null==we||null===(u=we.serviceSettings)||void 0===u?void 0:u.welcomeKbUid):(null==xe||null===(d=xe.draftServiceSettings)||void 0===d?void 0:d.welcomeKbUid)||(null==xe||null===(v=xe.serviceSettings)||void 0===v?void 0:v.welcomeKbUid),(h=S||Se||(null===(g=p[0])||void 0===g?void 0:g.uid))&&(he(h),ne.setFieldValue("welcomeKbUid",h),ee===f.Njn&&be?((null==be||null===(m=be.draftServiceSettings)||void 0===m?void 0:m.welcomeKbUid)||(null==be||null===(w=be.serviceSettings)||void 0===w?void 0:w.welcomeKbUid))!==h&&ye(l()(l()({},be),{},{serviceSettings:l()(l()({},be.serviceSettings),{},{welcomeKbUid:h}),draftServiceSettings:l()(l()({},be.draftServiceSettings||{}),{},{welcomeKbUid:h})})):ee===f._X4&&we?((null==we||null===(b=we.draftServiceSettings)||void 0===b?void 0:b.welcomeKbUid)||(null==we||null===(x=we.serviceSettings)||void 0===x?void 0:x.welcomeKbUid))!==h&&ke(l()(l()({},we),{},{serviceSettings:l()(l()({},we.serviceSettings),{},{welcomeKbUid:h}),draftServiceSettings:l()(l()({},we.draftServiceSettings||{}),{},{welcomeKbUid:h})})):ee===f.aZD&&xe&&((null==xe||null===(y=xe.draftServiceSettings)||void 0===y?void 0:y.welcomeKbUid)||(null==xe||null===(k=xe.serviceSettings)||void 0===k?void 0:k.welcomeKbUid))!==h&&je(l()(l()({},xe),{},{serviceSettings:l()(l()({},xe.serviceSettings),{},{welcomeKbUid:h}),draftServiceSettings:l()(l()({},xe.draftServiceSettings||{}),{},{welcomeKbUid:h})})),Me(h))):c.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=o()(r()().mark((function e(t){var n,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(ie.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,orgUid:null==se?void 0:se.uid,kbUid:t||Se},e.next=4,(0,k.pf)(n);case 4:i=e.sent,c.yw.destroy(),200===i.code?ue(i):c.yw.error(i.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){null!=se&&se.uid&&Re()}),[null==se?void 0:se.uid,ee,null==be?void 0:be.uid,null==be||null===(t=be.draftServiceSettings)||void 0===t?void 0:t.welcomeKbUid,null==be||null===(n=be.serviceSettings)||void 0===n?void 0:n.welcomeKbUid,null==we?void 0:we.uid,null==we||null===(i=we.draftServiceSettings)||void 0===i?void 0:i.welcomeKbUid,null==we||null===(s=we.serviceSettings)||void 0===s?void 0:s.welcomeKbUid,null==xe?void 0:xe.uid,null==xe||null===(a=xe.draftServiceSettings)||void 0===a?void 0:a.welcomeKbUid,null==xe||null===(u=xe.serviceSettings)||void 0===u?void 0:u.welcomeKbUid]),(0,m.useEffect)((function(){var e;if(ee===f._X4?e=(null==we?void 0:we.draftServiceSettings)||(null==we?void 0:we.serviceSettings):ee===f.Njn?e=(null==be?void 0:be.draftServiceSettings)||(null==be?void 0:be.serviceSettings):ee===f.aZD&&(e=(null==xe?void 0:xe.draftServiceSettings)||(null==xe?void 0:xe.serviceSettings)),e){var t=Array.isArray(e.welcomeFaqUids)?e.welcomeFaqUids:Array.isArray(e.welcomeFaqs)?e.welcomeFaqs.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];ne.setFieldValue("welcomeFaqUids",t)}}),[ee,ne,null==le||null===(U=le.data)||void 0===U||null===(U=U.content)||void 0===U?void 0:U.length,null==we?void 0:we.uid,null==we||null===(T=we.draftServiceSettings)||void 0===T?void 0:T.welcomeFaqUids,null==we||null===(q=we.serviceSettings)||void 0===q?void 0:q.welcomeFaqUids,null==be?void 0:be.uid,null==be||null===(F=be.draftServiceSettings)||void 0===F?void 0:F.welcomeFaqUids,null==be||null===(Z=be.serviceSettings)||void 0===Z?void 0:Z.welcomeFaqUids,null==xe?void 0:xe.uid,null==xe||null===(R=xe.draftServiceSettings)||void 0===R?void 0:R.welcomeFaqUids,null==xe||null===(M=xe.serviceSettings)||void 0===M?void 0:M.welcomeFaqUids]);var Pe=(0,m.useCallback)((function(e){he(e),Me(e),ee===f.Njn&&be?ye(l()(l()({},be),{},{serviceSettings:l()(l()({},be.serviceSettings),{},{welcomeKbUid:e}),draftServiceSettings:l()(l()({},be.draftServiceSettings||{}),{},{welcomeKbUid:e})})):ee===f._X4&&we?ke(l()(l()({},we),{},{serviceSettings:l()(l()({},we.serviceSettings),{},{welcomeKbUid:e}),draftServiceSettings:l()(l()({},we.draftServiceSettings||{}),{},{welcomeKbUid:e})})):ee===f.aZD&&xe&&je(l()(l()({},xe),{},{serviceSettings:l()(l()({},xe.serviceSettings),{},{welcomeKbUid:e}),draftServiceSettings:l()(l()({},xe.draftServiceSettings||{}),{},{welcomeKbUid:e})}))}),[ee,be,we,xe,ye,ke,je]);return(0,m.useEffect)((function(){var e;if(ee===f._X4?e=(null==we?void 0:we.draftServiceSettings)||(null==we?void 0:we.serviceSettings):ee===f.Njn?e=(null==be?void 0:be.draftServiceSettings)||(null==be?void 0:be.serviceSettings):ee===f.aZD&&(e=(null==xe?void 0:xe.draftServiceSettings)||(null==xe?void 0:xe.serviceSettings)),e){var t,n=re(e.welcomeTip);if(Te!==n&&qe(n),e.welcomeKbUid)if(ne.setFieldValue("welcomeKbUid",e.welcomeKbUid),Se!==e.welcomeKbUid)he(e.welcomeKbUid),null!=ve&&null!==(t=ve.data)&&void 0!==t&&null!==(t=t.content)&&void 0!==t&&t.length&&Me(e.welcomeKbUid);var i=Array.isArray(e.welcomeFaqUids)?e.welcomeFaqUids:Array.isArray(e.welcomeFaqs)?e.welcomeFaqs.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];ne.setFieldValue("welcomeFaqUids",i),Fe.current=!0}}),[ee,null==we||null===(P=we.draftServiceSettings)||void 0===P?void 0:P.welcomeTip,null==we||null===(A=we.draftServiceSettings)||void 0===A?void 0:A.welcomeKbUid,null==we||null===(N=we.draftServiceSettings)||void 0===N?void 0:N.welcomeFaqUids,null==we||null===(X=we.serviceSettings)||void 0===X?void 0:X.welcomeTip,null==we||null===(K=we.serviceSettings)||void 0===K?void 0:K.welcomeKbUid,null==we||null===(I=we.serviceSettings)||void 0===I?void 0:I.welcomeFaqUids,null==be||null===(_=be.draftServiceSettings)||void 0===_?void 0:_.welcomeTip,null==be||null===(L=be.draftServiceSettings)||void 0===L?void 0:L.welcomeKbUid,null==be||null===(V=be.draftServiceSettings)||void 0===V?void 0:V.welcomeFaqUids,null==be||null===(W=be.serviceSettings)||void 0===W?void 0:W.welcomeTip,null==be||null===(D=be.serviceSettings)||void 0===D?void 0:D.welcomeKbUid,null==be||null===(E=be.serviceSettings)||void 0===E?void 0:E.welcomeFaqUids,null==xe||null===(O=xe.draftServiceSettings)||void 0===O?void 0:O.welcomeTip,null==xe||null===(z=xe.draftServiceSettings)||void 0===z?void 0:z.welcomeKbUid,null==xe||null===(B=xe.draftServiceSettings)||void 0===B?void 0:B.welcomeFaqUids,null==xe||null===(J=xe.serviceSettings)||void 0===J?void 0:J.welcomeTip,null==xe||null===(H=xe.serviceSettings)||void 0===H?void 0:H.welcomeKbUid,null==xe||null===(Q=xe.serviceSettings)||void 0===Q?void 0:Q.welcomeFaqUids,null==ve||null===(Y=ve.data)||void 0===Y||null===(Y=Y.content)||void 0===Y?void 0:Y.length,Se]),(0,C.jsxs)(p.A,{form:ne,submitter:!1,style:{marginLeft:"20px"},children:[(0,C.jsx)(p.A.Item,{name:"welcomeTip",label:(0,C.jsxs)("span",{children:[ie.formatMessage({id:"agent.settings.welcome.tip"}),(0,C.jsx)(x.Z,{type:"service",keys:["welcomeTip"],live:ee===f.Njn?null==be?void 0:be.serviceSettings:ee===f._X4?null==we?void 0:we.serviceSettings:null==xe?void 0:xe.serviceSettings,draft:ee===f.Njn?null==be?void 0:be.draftServiceSettings:ee===f._X4?null==we?void 0:we.draftServiceSettings:null==xe?void 0:xe.draftServiceSettings})]}),tooltip:ie.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:ie.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,C.jsx)(w.Z,{placeholder:ie.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:Te,toolbarKeys:(0,b.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:Ze})}),(0,C.jsx)(S.Z,{name:"welcomeKbUid",width:"md",label:(0,C.jsxs)("span",{children:[ie.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,C.jsx)(x.Z,{type:"service",keys:["welcomeKbUid"],live:ee===f.Njn?null==be?void 0:be.serviceSettings:ee===f._X4?null==we?void 0:we.serviceSettings:null==xe?void 0:xe.serviceSettings,draft:ee===f.Njn?null==be?void 0:be.draftServiceSettings:ee===f._X4?null==we?void 0:we.draftServiceSettings:null==xe?void 0:xe.draftServiceSettings})]}),options:null==ve||null===(G=ve.data)||void 0===G||null===(G=G.content)||void 0===G?void 0:G.map((function(e){return{label:re(e.name),value:e.uid}})),fieldProps:{onChange:Pe,allowClear:!0,placeholder:(0,C.jsx)(h.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,C.jsx)(S.Z,{name:"welcomeFaqUids",width:"md",label:(0,C.jsxs)("span",{children:[ie.formatMessage({id:"menu.kbase.faq.welcome"}),(0,C.jsx)(x.Z,{type:"service",keys:["welcomeFaqUids"],live:ee===f.Njn?null==be?void 0:be.serviceSettings:ee===f._X4?null==we?void 0:we.serviceSettings:null==xe?void 0:xe.serviceSettings,draft:ee===f.Njn?null==be?void 0:be.draftServiceSettings:ee===f._X4?null==we?void 0:we.draftServiceSettings:null==xe?void 0:xe.draftServiceSettings})]}),options:null==le||null===($=le.data)||void 0===$||null===($=$.content)||void 0===$?void 0:$.map((function(e){return{label:re(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,C.jsx)(h.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){ee===f.Njn&&be?ye(l()(l()({},be),{},{serviceSettings:l()(l()({},be.serviceSettings),{},{welcomeFaqUids:e}),draftServiceSettings:l()(l()({},be.draftServiceSettings||{}),{},{welcomeFaqUids:e})})):ee===f._X4&&we?ke(l()(l()({},we),{},{serviceSettings:l()(l()({},we.serviceSettings),{},{welcomeFaqUids:e}),draftServiceSettings:l()(l()({},we.draftServiceSettings||{}),{},{welcomeFaqUids:e})})):ee===f.aZD&&xe&&je(l()(l()({},xe),{},{serviceSettings:l()(l()({},xe.serviceSettings),{},{welcomeFaqUids:e}),draftServiceSettings:l()(l()({},xe.draftServiceSettings||{}),{},{welcomeFaqUids:e})}))}}})]})}},23968:function(e,t,n){n(76711),n(90819),n(89933),n(73193),n(45332),n(66675),n(48388),n(81997),n(91733),n(77686),n(68992),n(62395),n(44194),n(72309),n(54008),n(99754),n(87005),n(18313),n(90170),n(34203),n(83262),n(6677),n(94571),n(44635),n(31549)},57648:function(e,t,n){n(76711),n(90819),n(73193),n(89933),n(45332),n(18313),n(90170),n(34203),n(48388),n(91733),n(68992),n(62395),n(44194);var i=n(78380);n(83262),n(31549),i.Z.Option},83262:function(e,t,n){n.d(t,{Z:function(){return y}});var i=n(73193),r=n.n(i),s=n(44194),o=n(62954),a=n(33633),l=n(86222),u=n.n(l),d=n(89957),c=n.n(d),v=["welcomeFaqUids","faqUids","quickFaqUids","guessFaqUids","hotFaqUids","shortcutFaqUids","proactiveFaqUids","worktimeUids"],g=["welcomeFaqs","faqs","quickFaqs","guessFaqs","hotFaqs","shortcutFaqs","proactiveFaqs"];function f(e){return"[object Object]"===Object.prototype.toString.call(e)}function p(e,t){if(!e)return e;if(!t||0===t.length)return e;var n={};return t.forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])})),n}function S(e){if(!Array.isArray(e))return e;var t=e.slice();return t.every((function(e){return["string","number","boolean"].includes(c()(e))}))?t.map((function(e){return"string"==typeof e?e:String(e)})).sort():t}function h(e){var t=e&&f(e)?r()({},e):{};return g.forEach((function(e){t[e]&&(t[e.replace(/s$/,"Uids")]=function(e){if(Array.isArray(e))return e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean).map(String)}(t[e]),delete t[e])})),v.forEach((function(e){t[e]&&(t[e]=S(t[e]))})),t}function m(e){var t=e&&f(e)?r()({},e):{};return t.worktimeUids&&(t.worktimeUids=S(t.worktimeUids)),delete t.worktimes,t}function w(e){var t=new WeakSet;return JSON.stringify(function e(n){if(null===n||"object"!==c()(n))return n;if(!t.has(n)){if(t.add(n),Array.isArray(n))return n.map((function(t){return e(t)}));var i,r=Object.keys(n).sort(),s={},o=u()(r);try{for(o.s();!(i=o.n()).done;){var a=i.value;s[a]=e(n[a])}}catch(e){o.e(e)}finally{o.f()}return s}}(e))}function b(e,t){return w(e)===w(t)}var x=n(31549),y=function(e){var t=e.hasDiff,n=e.type,i=void 0===n?"service":n,l=e.live,u=e.draft,d=e.keys,c=e.text,v=void 0===c?"草稿未发布":c,g=e.style;return(0,s.useMemo)((function(){if("boolean"==typeof t)return t;if(!l&&!u)return!1;switch(i){case"service":return function(e,t,n){return!b(p(h(e),n),p(h(t),n))}(l,u,d);case"messageLeave":return function(e,t,n){return!b(p(m(e),n),p(m(t),n))}(l,u,d);default:return function(e,t,n){return!b(p(e||{},n),p(t||{},n))}(l,u,d)}}),[t,i,l,u,d])?(0,x.jsx)(o.Z,{title:"string"==typeof v?v:"草稿与线上不一致",children:(0,x.jsx)(a.Z,{color:"orange",style:r()({marginLeft:8,height:20,lineHeight:"18px"},g),children:"Draft"})}):null}},91733:function(e,t,n){n.d(t,{z:function(){return a}});var i=n(68992),r=n(58063),s=n(66266),o=n(31403),a=(0,r.Ue)()((0,s.mW)((0,s.tJ)((0,o.n)((function(e){return{currentAgentSettings:null,currentRobotSettings:null,currentWorkgroupSettings:null,setCurrentAgentSettings:function(t){return e({currentAgentSettings:t})},setCurrentRobotSettings:function(t){return e({currentRobotSettings:t})},setCurrentWorkgroupSettings:function(t){return e({currentWorkgroupSettings:t})},clear:function(){return e({currentAgentSettings:null,currentRobotSettings:null,currentWorkgroupSettings:null})}}})),{name:i.rpR})))}}]);