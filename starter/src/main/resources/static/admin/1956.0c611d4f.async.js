"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1956],{99824:function(e,t,a){a.d(t,{Z:function(){return ie}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),d=a(90819),u=a.n(d),c=a(89933),p=a.n(c),f=a(45332),g=a.n(f),m=a(43388),y=a(94976),h=a(4628);function x(e){return v.apply(this,arguments)}function v(){return(v=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/query/org",{method:"GET",params:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/create",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/update",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/delete",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/fixed/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:y.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=a(74171),C=a(10162),F=a(54881),E=a(93689),I=a(40439),U=a(30617),L=a(11090),P=a(2484),A=a(44565),z=a(27729),O=a(90581),Y=a(30310),q=a(69533),R=a(43275),B=a(28508),K=a(44194),N=a(1715),X=a(8732),J=a(99036),V=a(38106),H=a(59005),Q=a(60241),G=a(30857),W=a(96596),$=a.n(W),_=a(58620),ee=a(31549),te=function(e){var t=e.isEdit,a=e.autoreply,r=e.open,n=e.onClose,s=e.onSubmit,i=J.A.useForm(),d=g()(i,1)[0],u=(0,D.u)((function(e){return e.currentOrg})),c=(0,X.j)((function(e){return e.currentKbase})),p=(0,N.v)((function(e){return e.categorySelectOptions})),f=(0,N.v)((function(e){return e.categoryTreeOptions})),h=(0,K.useState)(),x=g()(h,2),v=(x[0],x[1]),M=(0,K.useState)(y.PYi),b=g()(M,2),w=(b[0],b[1]),k=(0,K.useState)(".png,.jpg,.jpeg"),j=g()(k,2),S=(j[0],j[1]),T=(0,K.useState)({file:void 0,fileName:"test.pdf",fileType:"application/pdf",isAvatar:"false",kbType:"type",categoryUid:"",kbUid:(null==c?void 0:c.uid)||"",channel:y.XtJ}),Z=g()(T,2);Z[0],Z[1];(0,K.useEffect)((function(){if(t)d.setFieldsValue({type:null==a?void 0:a.type,content:null==a?void 0:a.content,categoryUid:null==a?void 0:a.categoryUid,kbUid:null==c?void 0:c.uid});else{var e=function e(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=l()(a);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.key!==y.zBg)return n.key;var s=e(n.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(f||[])||(p.length>0?p[0].value:"");d.resetFields(),d.setFieldsValue({type:y.PYi,content:"",categoryUid:e,kbUid:null==c?void 0:c.uid}),e&&v(e)}}),[r,p,f]);(0,_.M$)(),localStorage.getItem(y.LA8);return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(G.Z,{title:t?"修改固定回复":"新建固定回复",width:650,onClose:n,open:r,extra:(0,ee.jsxs)(Y.Z,{children:[(0,ee.jsx)(q.ZP,{onClick:n,children:"取消"}),(0,ee.jsx)(q.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log(e),s(o()(o()(o()({},a),e),{},{kbUid:null==c?void 0:c.uid,orgUid:null==u?void 0:u.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,ee.jsxs)(J.A,{form:d,initialValues:o()({},a),submitter:{render:function(){return null}},children:[(0,ee.jsx)(V.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)},treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==y.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(f||[]),showSearch:!0,treeDefaultExpandAll:!1,fieldNames:{label:"title",value:"key",children:"children"}}}),(0,ee.jsx)(H.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:y.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),w(e),e===y.Qm?S(".png,.jpg,.jpeg,.gif,.bmp"):e===y.tVi?S(".mp4,.avi,.mov,.wmv"):e===y.Yu1?S(".mp3,.wav,.flac"):e===y.Qn&&S(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,ee.jsx)(Q.Z,{name:"content",label:"回复",rules:[{required:!0,message:"请输入回复"}]})]})})})},ae=a(88722),re=a(54974),ne=a(78069),se=a(16658),oe=["current","pageSize"],ie=function(e){var t=e.superUser,a=(0,h.useIntl)(),r=(0,K.useRef)(),s=(0,K.useState)(!0),i=g()(s,2),d=i[0],c=i[1],f=(0,K.useState)(!1),v=g()(f,2),b=v[0],k=v[1],S=(0,ae.Z)().translateString,Z=(0,K.useState)(1),J=g()(Z,2),V=J[0],H=J[1],Q=(0,K.useState)(10),G=g()(Q,2),W=G[0],ie=G[1],le=(0,D.u)((function(e){return e.currentOrg})),de=(0,X.j)((function(e){return e.currentKbase})),ue=(0,N.v)((function(e){return e.currentCategory})),ce=(0,N.v)((function(e){return e.categorySelectOptions})),pe=(0,K.useState)(!1),fe=g()(pe,2),ge=fe[0],me=fe[1],ye=(0,K.useState)(),he=g()(ye,2),xe=he[0],ve=he[1],Me=(0,K.useState)([]),be=g()(Me,2),we=be[0],ke=be[1],je=(0,K.useState)([]),Se=g()(je,2),Te=Se[0],Ze=Se[1],De=z.Z.useModal(),Ce=g()(De,2),Fe=(Ce[0],Ce[1]),Ee=(0,K.useState)({}),Ie=g()(Ee,2),Ue=Ie[0],Le=Ie[1],Pe=(0,K.useState)(0),Ae=g()(Pe,2),ze=Ae[0],Oe=Ae[1],Ye=function(){var e=p()(u()().mark((function e(t){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,j(t);case 3:n=e.sent,console.log("delete response:",n),200===n.code?(null==r||null===(s=r.current)||void 0===s||s.reload(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(){var e=p()(u()().mark((function e(){var t,n,s,o,i,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Te.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n=0,s=0,o=l()(Te),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return d=i.value,e.prev=11,e.next=14,j(d);case 14:200===e.sent.code?n++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:n})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:n,fail:s})),ke([]),Ze([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=p()(u()().mark((function e(t){var n,s,o,i,d,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Te.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 3:m.yw.loading(t?a.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):a.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),s=0,o=0,i=l()(Te),e.prev=7,i.s();case 9:if((d=i.n()).done){e.next=23;break}return c=d.value,e.prev=11,e.next=14,T({uid:c.uid,enabled:t});case 14:200===e.sent.code?s++:o++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),o++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===o?m.yw.success(t?a.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:s}):a.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:s})):m.yw.warning(t?a.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:s,fail:o}):a.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:s,fail:o})),ke([]),Ze([]),null===(n=r.current)||void 0===n||n.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(t){return e.apply(this,arguments)}}(),Be=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,fixed:"left",width:300,ellipsis:!0,search:!0,tooltip:a.formatMessage({id:"autoreply.fixed.content.tooltip",defaultMessage:"固定自动回复的内容"}),render:function(e,t){return S(null==t?void 0:t.content)}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:100,tooltip:a.formatMessage({id:"autoreply.fixed.type.tooltip",defaultMessage:"回复内容的类型"}),render:function(e,t){return(0,se.OI)(t.type)},valueEnum:{text:{text:a.formatMessage({id:"autoreply.type.text"})},image:{text:a.formatMessage({id:"autoreply.type.image"})},video:{text:a.formatMessage({id:"autoreply.type.video"})},file:{text:a.formatMessage({id:"autoreply.type.file"})}}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.replyCount",defaultMessage:"Reply Count"}),dataIndex:"replyCount",width:100,hideInSearch:!0,sorter:!0,tooltip:a.formatMessage({id:"autoreply.fixed.replyCount.tooltip",defaultMessage:"该回复被使用的次数"})},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.enabled",defaultMessage:"Status"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.fixed.enabled.tooltip",defaultMessage:"该固定回复是否启用"}),valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:a.formatMessage({id:"autoreply.fixed.category.tooltip",defaultMessage:"固定回复的分类"}),render:function(e,t){var a=ce.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,ee.jsx)(O.Z,{color:"blue",children:(null==a?void 0:a.label)||"-"})},filters:ce.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,ellipsis:!0,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.fixed.tags.tooltip",defaultMessage:"用于筛选和分类的标签"}),render:function(e,t){var a;return null!=t&&t.tagList?null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e){return(0,ee.jsx)(O.Z,{color:"green",children:e.trim()},e)})):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.startDate",defaultMessage:"Start Date"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.fixed.startDate.tooltip",defaultMessage:"固定回复生效的开始时间"}),render:function(e,t){return t.startDate?$()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.endDate",defaultMessage:"End Date"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.fixed.endDate.tooltip",defaultMessage:"固定回复失效的结束时间"}),render:function(e,t){return t.endDate?$()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.fixed.updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.fixed.updatedAt.tooltip",defaultMessage:"最后更新的时间"})},{title:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){return(0,ee.jsxs)(Y.Z,{children:[(0,ee.jsx)(q.ZP,{type:"link",size:"small",onClick:function(){return Ne(t)},children:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}),(0,ee.jsx)(R.Z,{title:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),description:a.formatMessage({id:"pages.common.deleteConfirm"},{name:t.content}),onConfirm:function(){return Ye(t)},okText:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.ok"}),cancelText:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.cancel"}),children:(0,ee.jsx)(q.ZP,{type:"link",danger:!0,size:"small",children:(0,ee.jsx)(h.FormattedMessage,{id:"pages.common.delete"})})})]})}}],Ke=function(){ve(void 0),c(!1),k(!0)},Ne=function(e){ve(e),c(!0),k(!0)},Xe=function(){var e=p()(u()().mark((function e(t){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),d?(m.yw.loading(a.formatMessage({id:"updating"})),t.uid=null==xe?void 0:xe.uid):m.yw.loading(a.formatMessage({id:"creating"})),!d){e.next=8;break}return e.next=5,w(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,M(t);case 10:e.t0=e.sent;case 11:n=e.t0,console.log("createQuickreply response:",t,n),200===n.code?(m.yw.destroy(),m.yw.loading(a.formatMessage({id:"create.success"})),k(!1),null===(s=r.current)||void 0===s||s.reload()):(m.yw.destroy(),m.yw.error(n.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Je=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:me(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve=function(){var e=p()(u()().mark((function e(t,a,r){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(y.LA8),s=o()({categoryUid:(null==ue?void 0:ue.uid)===y.zBg?"":null==ue?void 0:ue.uid,kbUid:null==de?void 0:de.uid,orgUid:(null==le?void 0:le.uid)||"",accessToken:n||"",exportType:t},Ue),"current"===t?(s.pageNumber=String(V-1),s.pageSize=String(W)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,_.kG)()+"/api/v1/autoreply/fixed/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),He=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return Ve("range",r,a)}})},s=0;s<r;s++)n();return t};(0,K.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.reload()}),[de,ue]);var Qe=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ne.HK)(y.WvL,null==le?void 0:le.uid,null==de?void 0:de.uid,y.whQ,{showLoading:!0,loadingMessage:a.formatMessage({id:"loading"}),errorMessage:a.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ge={selectedRowKeys:we,onChange:function(e,t){ke(e),Ze(t)}};return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(A.Z,{columns:Be,actionRef:r,cardBordered:!0,rowSelection:Ge,request:function(){var e=p()(u()().mark((function e(r,s,i){var l,d,c,p,f,g,h,v,M,b;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",r,s,i),m.yw.loading(a.formatMessage({id:"loading",defaultMessage:"Loading"})),l=r.current,d=r.pageSize,c=n()(r,oe),H(l),ie(d),Le(c),p=void 0,f=void 0,s&&Object.keys(s).length>0&&(g=Object.keys(s)[0],p=g,f="ascend"===s[g]?"ascend":"descend"),h=t?void 0:(null==ue?void 0:ue.uid)===y.zBg?"":null==ue?void 0:ue.uid,v=t||null==de?void 0:de.uid,M=o()(o()({pageNumber:l-1,pageSize:d,categoryUid:h,kbUid:v,orgUid:null==le?void 0:le.uid,superUser:t},c),{},{sortBy:p,sortDirection:f}),e.next=14,x(M);case 14:return b=e.sent,console.log("queryAutoReplyFixedByOrg response:",M,b),m.yw.destroy(),200===b.code?Oe(null==b?void 0:b.data.totalElements):m.yw.error(b.message),e.abrupt("return",{data:null==b?void 0:b.data.content,success:!0,total:null==b?void 0:b.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){H(e),ie(t)}},dateFormatter:"string",headerTitle:S(null==de?void 0:de.name)+" - "+a.formatMessage({id:"autoreply.fixed.title",defaultMessage:"固定回复"}),tooltip:{title:a.formatMessage({id:"autoreply.fixed.tooltip",defaultMessage:"客服-》一对一-》高级设置-》自动回复"}),placement:"top"},toolBarRender:function(){return t?[]:[(0,ee.jsx)(q.ZP,{icon:(0,ee.jsx)(C.Z,{}),type:"primary",onClick:Ke,children:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.create",defaultMessage:"Create Fixed Reply"})},"create"),we.length>0&&(0,ee.jsx)(R.Z,{title:a.formatMessage({id:"batch.deleteTip"}),description:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(we.length," ").concat(a.formatMessage({id:"items"}),"?"),onConfirm:qe,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,ee.jsxs)(q.ZP,{danger:!0,icon:(0,ee.jsx)(F.Z,{}),children:[a.formatMessage({id:"batch.delete"})," (",we.length,")"]})},"batchDelete"),we.length>0&&(0,ee.jsxs)(q.ZP,{type:"primary",icon:(0,ee.jsx)(E.Z,{}),onClick:function(){return Re(!0)},children:[a.formatMessage({id:"batch.enable",defaultMessage:"Enable"})," (",we.length,")"]},"batchEnable"),we.length>0&&(0,ee.jsxs)(q.ZP,{danger:!0,icon:(0,ee.jsx)(I.Z,{}),onClick:function(){return Re(!1)},children:[a.formatMessage({id:"batch.disable",defaultMessage:"Disable"})," (",we.length,")"]},"batchDisable"),(0,ee.jsx)(q.ZP,{icon:(0,ee.jsx)(U.Z,{}),type:"primary",onClick:Je,children:(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.import",defaultMessage:"Import Fixed Replies"})},"import"),(0,ee.jsx)(B.Z,{menu:{items:(e=[{key:"export-current",label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ve("current")}}],ze>0&&(ze<=1e3?e.push({key:"export-all",label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ze,"条)"),onClick:function(){return Ve("all")}}):e.push({key:"export-range",label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ze,"条)"),children:He(ze)})),e.push({key:"download",label:a.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,_.x5)()}}),e)},placement:"bottomRight",children:(0,ee.jsxs)(q.ZP,{type:"primary",icon:(0,ee.jsx)(L.Z,{}),children:[(0,ee.jsx)(h.FormattedMessage,{id:"autoreply.action.export",defaultMessage:"Export Fixed Replies"}),(0,ee.jsx)(P.Z,{})]})},"exportDropdown")];var e},columnsState:{persistenceKey:"autoreply-fixed-table",defaultValue:{tags:{show:!0},startDate:{show:!1},endDate:{show:!1},replyCount:{show:!0},enabled:{show:!0}}}}),b&&(0,ee.jsx)(te,{isEdit:d,open:b,autoreply:xe,onClose:function(){return k(!1)},onSubmit:Xe}),ge&&(0,ee.jsx)(re.Z,{type:y.BMI,acceptType:".xlsx,.xls,.csv",isModalOpen:ge,handleSubmit:function(e){var t;console.log("handleUploadDragSubmit",e),me(!1),null==r||null===(t=r.current)||void 0===t||t.reload(),Qe()},handleCancel:function(){var e;console.log("handleUploadDragCancel"),me(!1),null==r||null===(e=r.current)||void 0===e||e.reload()}}),Fe]})}},74762:function(e,t,a){a.d(t,{Z:function(){return le}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),l=a.n(i),d=a(90819),u=a.n(d),c=a(89933),p=a.n(c),f=a(45332),g=a.n(f),m=a(43388),y=a(94976),h=a(4628);function x(e){return v.apply(this,arguments)}function v(){return(v=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/query/org",{method:"GET",params:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/create",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/update",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/delete",{method:"POST",data:o()(o()({},t),{},{channel:y.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/autoreply/keyword/enable",{method:"POST",data:{uid:t.uid,enabled:t.enabled,channel:y.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=a(74171),C=a(10162),F=a(54881),E=a(93689),I=a(40439),U=a(30617),L=a(11090),P=a(2484),A=a(44565),z=a(27729),O=a(30310),Y=a(90581),q=a(69533),R=a(43275),B=a(28508),K=a(44194),N=a(1715),X=a(8732),J=a(58620),V=a(99036),H=a(59005),Q=a(38106),G=a(60241),W=a(50628),$=a(30857),_=a(96596),ee=a.n(_),te=a(31549),ae=function(e){var t=e.isEdit,a=e.keyword,r=e.open,n=e.onClose,s=e.onSubmit,i=V.A.useForm(),d=g()(i,1)[0],u=(0,D.u)((function(e){return e.currentOrg})),c=(0,X.j)((function(e){return e.currentKbase})),p=(0,N.v)((function(e){return e.categorySelectOptions})),f=(0,N.v)((function(e){return e.categoryTreeOptions})),h=(0,K.useState)(),x=g()(h,2),v=(x[0],x[1]),M=(0,K.useState)(y.PYi),b=g()(M,2),w=(b[0],b[1]),k=(0,K.useState)(".png,.jpg,.jpeg"),j=g()(k,2),S=(j[0],j[1]),T=(0,K.useState)({file:void 0,fileName:"test.pdf",fileType:"application/pdf",isAvatar:"false",kbType:"type",categoryUid:"",kbUid:(null==c?void 0:c.uid)||"",channel:y.XtJ}),Z=g()(T,2);Z[0],Z[1];(0,K.useEffect)((function(){if(t&&a){var e=Array.isArray(null==a?void 0:a.keywordList)?null==a?void 0:a.keywordList.join("|"):null==a?void 0:a.keywordList,r=Array.isArray(null==a?void 0:a.replyList)?null==a?void 0:a.replyList.join("|"):null==a?void 0:a.replyList;d.setFieldsValue({keywordList:e,replyList:r,matchType:null==a?void 0:a.matchType,contentType:null==a?void 0:a.contentType,categoryUid:null==a?void 0:a.categoryUid,kbUid:null==c?void 0:c.uid,enabled:null==a?void 0:a.enabled})}else{var n=function e(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=l()(a);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.key!==y.zBg)return n.key;var s=e(n.children||[]);if(s)return s}}catch(e){r.e(e)}finally{r.f()}return""}(f||[])||(p.length>0?p[0].value:"");d.resetFields(),d.setFieldsValue({keywordList:"",replyList:"",matchType:y.lEl,contentType:y.PYi,categoryUid:n,enabled:!0}),n&&v(n)}}),[r,a,t,d,null==c?void 0:c.uid,p,f]);(0,J.M$)(),localStorage.getItem(y.LA8);return(0,te.jsx)(te.Fragment,{children:(0,te.jsx)($.Z,{title:t?"修改关键词回复":"新建关键词回复",width:650,onClose:n,open:r,extra:(0,te.jsxs)(O.Z,{children:[(0,te.jsx)(q.ZP,{onClick:n,children:"取消"}),(0,te.jsx)(q.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("validateFields:",e);var t=Array.isArray(e.keywordList)?e.keywordList:e.keywordList.split("|").map((function(e){return e.trim()})).filter((function(e){return e})),a=Array.isArray(e.replyList)?e.replyList:e.replyList.split("|").map((function(e){return e.trim()})).filter((function(e){return e}));s(o()(o()({},e),{},{keywordList:t,replyList:a,kbUid:null==c?void 0:c.uid,orgUid:null==u?void 0:u.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,te.jsxs)(V.A,{form:d,submitter:{render:function(){return null}},children:[(0,te.jsx)(H.Z,{label:"匹配类型",name:"matchType",rules:[{required:!0,message:"请选择匹配类型"}],options:[{label:"模糊匹配",value:y.lEl},{label:"精确匹配",value:y.TAc,disabled:!0},{label:"正则匹配",value:y.c7i,disabled:!0},{label:"向量匹配",value:y.sOn,disabled:!0},{label:"搜索引擎匹配",value:y.NDq,disabled:!0}],fieldProps:{allowClear:!0,placeholder:"请选择匹配类型"}}),(0,te.jsx)(Q.Z,{label:"内容分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],tooltip:"请先：创建分类",fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)},treeData:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(e){return e.key!==y.zBg})).map((function(t){return o()(o()({},t),{},{children:e(t.children)})}))}(f||[]),showSearch:!0,treeDefaultExpandAll:!1,fieldNames:{label:"title",value:"key",children:"children"}}}),(0,te.jsx)(H.Z,{label:"类型",name:"contentType",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:y.PYi}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),w(e),e===y.Qm?S(".png,.jpg,.jpeg,.gif,.bmp"):e===y.tVi?S(".mp4,.avi,.mov,.wmv"):e===y.Yu1?S(".mp3,.wav,.flac"):e===y.Qn&&S(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,te.jsx)(G.Z,{label:"关键词，多个关键词使用 '|' 分割",name:"keywordList",tooltip:"多个关键词使用 '|' 分割",placeholder:"请输入关键词，多个关键词使用 '|' 分割",rules:[{required:!0,message:"请输入关键词，多个关键词使用 '|' 分割 "}]}),(0,te.jsx)(G.Z,{name:"replyList",label:"回复，多个回复使用 '|' 分割",tooltip:"多个回复使用 '|' 分割",rules:[{required:!0,message:"请输入回复，多个回复使用 '|' 分割"}]}),(0,te.jsx)(W.Z,{label:"启用",name:"enabled",fieldProps:{defaultValue:!0}})]})})})},re=a(54974),ne=a(88722),se=a(78069),oe=a(16658),ie=["current","pageSize"],le=function(e){var t=e.superUser,a=(0,h.useIntl)(),r=(0,ne.Z)().translateString,s=(0,K.useRef)(),i=(0,K.useState)(!0),d=g()(i,2),c=d[0],f=d[1],v=(0,K.useState)(!1),b=g()(v,2),k=b[0],S=b[1],Z=(0,K.useState)(1),V=g()(Z,2),H=V[0],Q=V[1],G=(0,K.useState)(10),W=g()(G,2),$=W[0],_=W[1],le=(0,D.u)((function(e){return e.currentOrg})),de=(0,X.j)((function(e){return e.currentKbase})),ue=(0,N.v)((function(e){return e.currentCategory})),ce=(0,N.v)((function(e){return e.categorySelectOptions})),pe=(0,K.useState)(!1),fe=g()(pe,2),ge=(fe[0],fe[1],(0,K.useState)(!1)),me=g()(ge,2),ye=me[0],he=me[1],xe=(0,K.useState)(),ve=g()(xe,2),Me=ve[0],be=ve[1],we=(0,K.useState)([]),ke=g()(we,2),je=ke[0],Se=ke[1],Te=(0,K.useState)([]),Ze=g()(Te,2),De=Ze[0],Ce=Ze[1],Fe=z.Z.useModal(),Ee=g()(Fe,2),Ie=(Ee[0],Ee[1]),Ue=(0,K.useState)({}),Le=g()(Ue,2),Pe=Le[0],Ae=Le[1],ze=(0,K.useState)(0),Oe=g()(ze,2),Ye=Oe[0],qe=Oe[1],Re=function(){var e=p()(u()().mark((function e(t){var r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,j(t);case 3:r=e.sent,console.log("delete response:",r),200===r.code?(null==s||s.current.reload(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=p()(u()().mark((function e(){var t,r,n,o,i,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==De.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r=0,n=0,o=l()(De),e.prev=7,o.s();case 9:if((i=o.n()).done){e.next=23;break}return d=i.value,e.prev=11,e.next=14,j(d);case 14:200===e.sent.code?r++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:r})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:r,fail:n})),Se([]),Ce([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=p()(u()().mark((function e(t){var r,n,o,i,d,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==De.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),e.abrupt("return");case 3:m.yw.loading(t?a.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):a.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),n=0,o=0,i=l()(De),e.prev=7,i.s();case 9:if((d=i.n()).done){e.next=23;break}return c=d.value,e.prev=11,e.next=14,T({uid:c.uid,enabled:t});case 14:200===e.sent.code?n++:o++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),o++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:m.yw.destroy(),0===o?m.yw.success(t?a.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:n}):a.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:n})):m.yw.warning(t?a.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:n,fail:o}):a.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:n,fail:o})),Se([]),Ce([]),null===(r=s.current)||void 0===r||r.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(t){return e.apply(this,arguments)}}(),Ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.keywordList",defaultMessage:"Keywords"}),dataIndex:"keywordList",copyable:!0,fixed:"left",width:200,ellipsis:!0,search:!0,tooltip:a.formatMessage({id:"autoreply.keyword.keywordList.tooltip",defaultMessage:"触发自动回复的关键词列表"}),render:function(e,t){return t.keywordList?(0,te.jsx)(O.Z,{wrap:!0,children:t.keywordList.map((function(e,t){return(0,te.jsx)(Y.Z,{color:"blue",children:e},t)}))}):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.replyList",defaultMessage:"Replies"}),dataIndex:"replyList",copyable:!0,width:300,ellipsis:!0,search:!0,tooltip:a.formatMessage({id:"autoreply.keyword.replyList.tooltip",defaultMessage:"匹配关键词后的自动回复内容列表"}),render:function(e,t){return t.replyList?(0,te.jsx)(O.Z,{wrap:!0,children:t.replyList.map((function(e,t){return(0,te.jsx)(Y.Z,{color:"green",children:e},t)}))}):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.matchType",defaultMessage:"Match Type"}),dataIndex:"matchType",width:120,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.matchType.tooltip",defaultMessage:"关键词匹配的方式"}),valueEnum:{EXACT:{text:a.formatMessage({id:"autoreply.matchType.exact",defaultMessage:"Exact"})},FUZZY:{text:a.formatMessage({id:"autoreply.matchType.contains",defaultMessage:"Contains"})}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.contentType",defaultMessage:"Content Type"}),dataIndex:"contentType",width:120,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.contentType.tooltip",defaultMessage:"回复内容的类型"}),render:function(e,t){return(0,oe.OI)(t.contentType)},valueEnum:{TEXT:{text:a.formatMessage({id:"autoreply.contentType.text",defaultMessage:"Text"})},IMAGE:{text:a.formatMessage({id:"autoreply.contentType.image",defaultMessage:"Image"})},VIDEO:{text:a.formatMessage({id:"autoreply.contentType.video",defaultMessage:"Video"})},FILE:{text:a.formatMessage({id:"autoreply.contentType.file",defaultMessage:"File"})}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:a.formatMessage({id:"autoreply.keyword.category.tooltip",defaultMessage:"关键词回复的分类"}),render:function(e,t){var a=ce.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,te.jsx)(Y.Z,{color:"blue",children:(null==a?void 0:a.label)||"-"})},filters:ce.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.enabled",defaultMessage:"Status"}),dataIndex:"enabled",hideInSearch:!0,width:100,tooltip:a.formatMessage({id:"autoreply.keyword.enabled.tooltip",defaultMessage:"关键词回复是否启用"}),valueEnum:{true:{text:a.formatMessage({id:"common.enabled",defaultMessage:"Enabled"}),status:"Success"},false:{text:a.formatMessage({id:"common.disabled",defaultMessage:"Disabled"}),status:"Error"}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.isTransfer",defaultMessage:"Transfer"}),dataIndex:"isTransfer",width:100,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.isTransfer.tooltip",defaultMessage:"是否触发转人工服务"}),valueEnum:{true:{text:a.formatMessage({id:"common.yes",defaultMessage:"Yes"}),status:"Success"},false:{text:a.formatMessage({id:"common.no",defaultMessage:"No"}),status:"Default"}}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.startDate",defaultMessage:"Start Date"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.startDate.tooltip",defaultMessage:"关键词回复生效的开始时间"}),render:function(e,t){return t.startDate?ee()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.endDate",defaultMessage:"End Date"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.endDate.tooltip",defaultMessage:"关键词回复失效的结束时间"}),render:function(e,t){return t.endDate?ee()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,te.jsx)(h.FormattedMessage,{id:"autoreply.keyword.updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:160,valueType:"dateTime",sorter:!0,hideInSearch:!0,tooltip:a.formatMessage({id:"autoreply.keyword.updatedAt.tooltip",defaultMessage:"最后更新的时间"})},{title:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.actions",defaultMessage:"Actions"}),valueType:"option",fixed:"right",width:150,render:function(e,t){var r;return(0,te.jsxs)(O.Z,{children:[(0,te.jsx)(q.ZP,{type:"link",size:"small",onClick:function(){return Je(t)},children:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.edit",defaultMessage:"Edit"})}),(0,te.jsx)(R.Z,{title:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.deleteTip",defaultMessage:"Delete Confirmation"}),description:a.formatMessage({id:"pages.common.deleteConfirm"},{name:null===(r=t.keywordList)||void 0===r?void 0:r.join(", ")}),onConfirm:function(){return Re(t)},okText:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.ok"}),cancelText:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.cancel"}),children:(0,te.jsx)(q.ZP,{type:"link",danger:!0,size:"small",children:(0,te.jsx)(h.FormattedMessage,{id:"pages.common.delete"})})})]})}}],Xe=function(){be(void 0),f(!1),S(!0)},Je=function(e){be(e),f(!0),S(!0)},Ve=function(){var e=p()(u()().mark((function e(t){var r,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer",t),c?(m.yw.loading(a.formatMessage({id:"updating"})),t.uid=null==Me?void 0:Me.uid):m.yw.loading(a.formatMessage({id:"creating"})),!c){e.next=8;break}return e.next=5,w(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,M(t);case 10:e.t0=e.sent;case 11:r=e.t0,console.log("createKeyword response:",t,r),200===r.code?(m.yw.destroy(),m.yw.success(a.formatMessage({id:"create.success",defaultMessage:"create success"})),S(!1),null===(n=s.current)||void 0===n||n.reloadAndRest()):(m.yw.destroy(),m.yw.error(r.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:he(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Qe=function(){var e=p()(u()().mark((function e(t,a,r){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(y.LA8),s=o()({categoryUid:(null==ue?void 0:ue.uid)===y.zBg?"":null==ue?void 0:ue.uid,kbUid:null==de?void 0:de.uid,orgUid:(null==le?void 0:le.uid)||"",accessToken:n||"",exportType:t},Pe),"current"===t?(s.pageNumber=String(H-1),s.pageSize=String($)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,J.kG)()+"/api/v1/autoreply/keyword/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Ge=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return Qe("range",r,a)}})},s=0;s<r;s++)n();return t};(0,K.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.reloadAndRest()}),[de,ue]);var We=function(){var e=p()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,se.HK)(y.WvL,null==le?void 0:le.uid,null==de?void 0:de.uid,y.whQ,{showLoading:!0,loadingMessage:a.formatMessage({id:"loading"}),errorMessage:a.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$e={selectedRowKeys:je,onChange:function(e,t){Se(e),Ce(t)}};return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(A.Z,{columns:Ne,actionRef:s,cardBordered:!0,rowSelection:$e,request:function(){var e=p()(u()().mark((function e(r,s,i){var l,d,c,p,f,g,h,v,M,b;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.yw.loading(a.formatMessage({id:"loading",defaultMessage:"Loading"})),l=r.current,d=r.pageSize,c=n()(r,ie),Q(l),_(d),Ae(c),p=void 0,f=void 0,s&&Object.keys(s).length>0&&(g=Object.keys(s)[0],p=g,f="ascend"===s[g]?"ascend":"descend"),h=t?void 0:(null==ue?void 0:ue.uid)===y.zBg?"":null==ue?void 0:ue.uid,v=t||null==de?void 0:de.uid,M=o()(o()({pageNumber:l-1,pageSize:d,categoryUid:h,kbUid:v,orgUid:null==le?void 0:le.uid,superUser:t},c),{},{sortBy:p,sortDirection:f}),e.next=13,x(M);case 13:return b=e.sent,console.log("getAllKeywords response:",M,b),m.yw.destroy(),200===b.code?qe(null==b?void 0:b.data.totalElements):m.yw.error(b.message),e.abrupt("return",{data:null==b?void 0:b.data.content,success:!0,total:null==b?void 0:b.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),scroll:{x:1800},rowKey:"uid",search:{labelWidth:"auto",defaultCollapsed:!1},pagination:{pageSize:10,onChange:function(e,t){Q(e),_(t)}},dateFormatter:"string",headerTitle:r(null==de?void 0:de.name)+" - "+a.formatMessage({id:"menu.kbase.keyword",defaultMessage:"KEYWORD"}),tooltip:{title:"客服-》一对一-》高级设置-》自动回复",placement:"top"},toolBarRender:function(){return t?[]:[(0,te.jsx)(q.ZP,{icon:(0,te.jsx)(C.Z,{}),type:"primary",onClick:Xe,children:a.formatMessage({id:"create",defaultMessage:"Create"})},"create"),je.length>0&&(0,te.jsx)(R.Z,{title:a.formatMessage({id:"batch.deleteTip"}),description:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(je.length," ").concat(a.formatMessage({id:"items"}),"?"),onConfirm:Be,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,te.jsxs)(q.ZP,{danger:!0,icon:(0,te.jsx)(F.Z,{}),children:[a.formatMessage({id:"batch.delete"})," (",je.length,")"]})},"batchDelete"),je.length>0&&(0,te.jsxs)(q.ZP,{type:"primary",icon:(0,te.jsx)(E.Z,{}),onClick:function(){return Ke(!0)},children:[a.formatMessage({id:"batch.enable",defaultMessage:"Enable"})," (",je.length,")"]},"batchEnable"),je.length>0&&(0,te.jsxs)(q.ZP,{danger:!0,icon:(0,te.jsx)(I.Z,{}),onClick:function(){return Ke(!1)},children:[a.formatMessage({id:"batch.disable",defaultMessage:"Disable"})," (",je.length,")"]},"batchDisable"),(0,te.jsx)(q.ZP,{icon:(0,te.jsx)(U.Z,{}),type:"primary",onClick:He,children:a.formatMessage({id:"import",defaultMessage:"Import"})},"import"),(0,te.jsx)(B.Z,{menu:{items:(e=[{key:"export-current",label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Qe("current")}}],Ye>0&&(Ye<=1e3?e.push({key:"export-all",label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ye,"条)"),onClick:function(){return Qe("all")}}):e.push({key:"export-range",label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ye,"条)"),children:Ge(Ye)})),e.push({key:"download",label:a.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,J.zw)()}}),e)},placement:"bottomRight",children:(0,te.jsxs)(q.ZP,{type:"primary",icon:(0,te.jsx)(L.Z,{}),children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,te.jsx)(P.Z,{})]})},"exportDropdown")];var e}}),k&&(0,te.jsx)(ae,{isEdit:c,open:k,keyword:Me,onClose:function(){return S(!1)},onSubmit:Ve}),ye&&(0,te.jsx)(re.Z,{type:y.ibP,acceptType:".xlsx,.xls,.csv",isModalOpen:ye,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),he(!1),null==s||s.current.reload(),We()},handleCancel:function(){console.log("handleUploadDragCancel"),he(!1),null==s||s.current.reload()}}),Ie]})}}}]);