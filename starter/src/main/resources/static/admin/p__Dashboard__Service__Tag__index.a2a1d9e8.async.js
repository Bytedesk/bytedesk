"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5387],{15724:function(e,t,n){n.d(t,{Lp:function(){return m},Pn:function(){return x},c5:function(){return v},ln:function(){return p},p:function(){return d}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),c=n.n(i),u=n(55735),l=n(41159);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/query/org",{method:"GET",params:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/create",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/update",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/delete",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return M.apply(this,arguments)}function M(){return(M=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/delete/all",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},76750:function(e,t,n){var r=n(55735),a=n(65461),s=n(41159);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},9416:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var r=n(41159),a=n(8247),s=n(44194),o=n(84176),i=n.n(o),c=n(73193),u=n.n(c),l=n(86222),d=n.n(l),f=n(90819),p=n.n(f),g=n(89933),m=n.n(g),h=n(45332),x=n.n(h),y=n(86803),v=n(15724),M=n(40612),w=n(15722),b=n(10162),k=n(54881),S=n(58275),j=n(11090),T=n(2484),Z=n(48524),A=n(53530),C=n(29266),F=n(61355),I=n(75365),P=n(96485),E=n(55735),O=n(69169),q=n(4499),R=n(84881),V=n(73442),D=n(31549),z=function(e){var t=e.isEdit,n=e.tag,r=e.open,a=e.onClose,o=e.onSubmit,i=O.A.useForm(),c=x()(i,1)[0],l=(0,M.u)((function(e){return e.currentOrg})),d=(0,s.useState)([]),f=x()(d,2),p=f[0],g=f[1],m=(0,s.useState)([]),h=x()(m,2),y=(h[0],h[1]);(0,s.useEffect)((function(){t?(c.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,color:null==n?void 0:n.color,type:null==n?void 0:n.type}),y([null==n?void 0:n.color]),g([null==n?void 0:n.type])):c.setFieldsValue({name:"",color:"red",type:E.IuT})}),[t,n,c]);return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)(V.Z,{title:"标签",width:600,onClose:a,open:r,children:(0,D.jsxs)(O.A,{form:c,name:"tagForm",onFinish:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var t=u()(u()({},e),{},{orgUid:null==l?void 0:l.uid});console.log("submit",t),o(t)}))},children:[(0,D.jsx)(q.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,D.jsx)(R.Z,{name:"type",label:"类型",width:"md",options:[{label:"会话标签",value:E.bDv},{label:"客户标签",value:E.IuT}],fieldProps:{allowClear:!0,placeholder:"请选择类型",value:p,onChange:function(e){console.log("selected type ".concat(e)),g(e)}}})]})})})},L=n(36310),U=n(76750),N=["current","pageSize"],W=function(){var e=(0,r.useIntl)(),t=(0,s.useRef)(),n=(0,U.Z)().translateString,a=(0,s.useState)(1),o=x()(a,2),c=o[0],l=o[1],f=(0,s.useState)(10),g=x()(f,2),h=g[0],O=g[1],q=(0,M.u)((function(e){return e.currentOrg})),R=(0,s.useState)(!1),V=x()(R,2),W=V[0],B=V[1],K=(0,s.useState)({}),G=x()(K,2),_=G[0],J=G[1],Q=(0,s.useState)(!1),H=x()(Q,2),X=H[0],Y=H[1],$=A.Z.useModal(),ee=x()($,2),te=ee[0],ne=ee[1],re=(0,s.useState)([]),ae=x()(re,2),se=ae[0],oe=ae[1],ie=(0,s.useState)([]),ce=x()(ie,2),ue=ce[0],le=ce[1],de=(0,s.useState)(0),fe=x()(de,2),pe=fe[0],ge=fe[1],me=(0,s.useState)({}),he=x()(me,2),xe=he[0],ye=he[1],ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(r.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150,render:function(e,t){return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)(C.Z,{color:t.color,children:n(t.name)})})}},{title:(0,D.jsx)(r.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,D.jsxs)(D.Fragment,{children:[t.type===E.bDv&&(0,D.jsx)(C.Z,{color:"blue",children:"会话标签"}),t.type===E.IuT&&(0,D.jsx)(C.Z,{color:"green",children:"客户标签"})]})}},{title:(0,D.jsx)(r.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,D.jsx)(r.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],Me=[].concat(ve,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,r,a,s){return[(0,D.jsx)("a",{onClick:function(){J(r),Y(!0),B(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,D.jsx)(F.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(r.name),"】？"),onConfirm:function(){return we(r)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,D.jsx)(w.Z,{style:{color:"red"}}),children:(0,D.jsx)(I.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),we=function(){var n=m()(p()().mark((function n(r){var a;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteTag:",r),n.next=3,(0,v.Pn)(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(y.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):y.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),be=function(){var e=m()(p()().mark((function e(n){var r,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.ln)(n);case 2:r=e.sent,console.log("handleCreateTag response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),B(!1)):y.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(){var e=m()(p()().mark((function e(n){var r,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==_?void 0:_.uid,e.next=3,(0,v.Lp)(n);case 3:r=e.sent,console.log("handleUpdateTag response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),B(!1)):y.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(){B(!0),Y(!1),J({})},je=function(){var n=m()(p()().mark((function n(){var r,a,s,o,i,c;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ue.length){n.next=3;break}return y.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),n.abrupt("return");case 3:y.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=d()(ue),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return c=i.value,n.prev=11,n.next=14,(0,v.Pn)(c);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:y.yw.destroy(),0===s?y.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:a})):y.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:a,fail:s})),oe([]),le([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Te=function(){var n=m()(p()().mark((function n(){var r,a,s;return p()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==pe){n.next=3;break}return y.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return y.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={orgUid:null==q?void 0:q.uid},n.next=8,(0,v.c5)(r);case 8:200===(a=n.sent).code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(y.yw.destroy(),y.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),y.yw.destroy(),y.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(){return n.apply(this,arguments)}}(),Ze=function(){var e=m()(p()().mark((function e(t,n,r){var a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(E.LA8),s=u()({orgUid:(null==q?void 0:q.uid)||"",accessToken:a||"",exportType:t},xe),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(h)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(s.pageNumber=String(n),s.pageSize=String(r)),window.open((0,L.kG)()+"/api/v1/tag/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ae=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Ze("range",r,n)}})},s=0;s<r;s++)a();return t},Ce={selectedRowKeys:se,onChange:function(e,t){oe(e),le(t)}},Fe=function(){var e=m()(p()().mark((function e(t,n,r){var a,s,o,c,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=i()(t,N),l(a),O(s),ye(o),c=u()({pageNumber:a-1,pageSize:s,orgUid:null==q?void 0:q.uid},o),e.next=7,(0,v.p)(c);case 7:return d=e.sent,console.log("queryTagsByOrg response:",d,c),200===d.code?ge(d.data.totalElements):y.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return(0,D.jsxs)(D.Fragment,{children:[W&&(0,D.jsx)(z,{isEdit:X,open:W,tag:_,onClose:function(){B(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),X?ke(e):be(e)}}),(0,D.jsx)(Z.Z,{columns:Me,actionRef:t,cardBordered:!0,rowSelection:Ce,request:Fe,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),O(t)}},dateFormatter:"string",headerTitle:"标签列表",toolBarRender:function(){return function(){var t=[(0,D.jsx)(I.ZP,{type:"primary",icon:(0,D.jsx)(b.Z,{}),onClick:Se,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],n=[];se.length>0&&n.push({key:"batchDelete",icon:(0,D.jsx)(k.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(se.length,")"),onClick:function(){te.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(se.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:je,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,D.jsx)(S.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){te.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有标签数据吗？此操作不可恢复!"}),onOk:Te,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,D.jsx)(j.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ze("current")}}];return pe>0&&(pe<=1e3?r.push({key:"export-all",icon:(0,D.jsx)(j.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(pe,"条)"),onClick:function(){return Ze("all")}}):r.push({key:"export-range",icon:(0,D.jsx)(j.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(pe,"条)"),children:Ae(pe)})),t.push((0,D.jsx)(P.Z,{menu:{items:r},placement:"bottom",children:(0,D.jsxs)(I.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,D.jsx)(T.Z,{})]})},"importExport")),n.length>0&&t.push((0,D.jsx)(P.Z,{menu:{items:n},placement:"bottom",children:(0,D.jsxs)(I.ZP,{type:se.length>0?"primary":"default",danger:se.length>0,children:[se.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(se.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,D.jsx)(T.Z,{})]})},"batchOperations")),t}()}}),ne]})},B=function(){var e=[{key:"tags",label:(0,r.useIntl)().formatMessage({id:"tags.tab.tags"}),children:(0,D.jsx)(W,{})}];return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)(a.Z,{defaultActiveKey:"tags",items:e,style:{padding:"20px"}})})}}}]);