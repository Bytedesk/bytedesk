"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5800],{11293:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return p},Gv:function(){return M},bD:function(){return f},mE:function(){return k},nQ:function(){return j},nU:function(){return x},oX:function(){return S}});var s=n(90819),r=n.n(s),i=n(73193),a=n.n(i),o=n(89933),u=n.n(o),l=n(14906),d=n(39497);function c(e){return g.apply(this,arguments)}function g(){return(g=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(r()().mark((function e(t){var n,s;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,s=t.workgroupUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(s),{method:"GET",params:{channel:d.XtJ}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return Z.apply(this,arguments)}function Z(){return(Z=u()(r()().mark((function e(t,n){var s,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.uid,i=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(s,"/orgs/").concat(i,"/bindings"),{method:"POST",data:a()(a()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11553:function(e,t,n){n.r(t),n.d(t,{default:function(){return we}});var s=n(73193),r=n.n(s),i=n(89957),a=n.n(i),o=n(90819),u=n.n(o),l=n(89933),d=n.n(l),c=n(45332),g=n.n(c),f=n(44194),m=n(14906),p=n(77033),h=n(82770),x=n(39487),v=n(32525),M=n(50716),y=n(92354),k=n(81739),b=n(66431),j=n(63649),Z=n(67738),S=n(49764),C=n(68779),w=n(28514),T=n(10162),F=n(59304),P=n(54881),I=n(47944),E=n(80556),O=n(55785),L=n(19433),U=n(98830),A=n(14597),q=n(75112),z=n(11293),J=n(58063),B=n(66266),D=n(31403),N=n(39497),X=(0,J.Ue)()((0,B.mW)((0,B.tJ)((0,D.n)((function(e){return{currentTicketSettings:null,ticketSettingsMap:{},setCurrentTicketSettings:function(t){return e({currentTicketSettings:t})},setTicketSettingsForWorkgroup:function(t,n){return e((function(e){e.ticketSettingsMap[t]=n}))},updateCurrentTicketSettings:function(t){return e((function(e){e.currentTicketSettings&&("function"==typeof t?t(e.currentTicketSettings):e.currentTicketSettings=r()(r()({},e.currentTicketSettings),t))}))},removeTicketSettingsForWorkgroup:function(t){return e((function(e){delete e.ticketSettingsMap[t]}))},clearAll:function(){return e({currentTicketSettings:null,ticketSettingsMap:{}})}}})),{name:N.rpR+"_TICKET"}))),H=n(83001),K=n(13847),W=n(41196),R=n(34201),G=n(79489),_=n(78578),V=n(45067),Q=n(62640),Y=n(82690),$=n(25784),ee=n(31549),te=H.Z.Text,ne=H.Z.Title,se=(K.Z.Option,function(e){var t,n,s,r=e.settings,i=e.onChange,a=(0,m.useIntl)(),o=$.A.useForm(),u=g()(o,1)[0];(0,f.useEffect)((function(){u.setFieldsValue(r)}),[r,u]);var l=W.Z.useWatch("numberPrefix",u),d=W.Z.useWatch("numberLength",u),c=W.Z.useWatch("enableAutoClose",u),p=null!==(t=null!=l?l:r.numberPrefix)&&void 0!==t?t:"",h=null!==(n=null!=d?d:r.numberLength)&&void 0!==n?n:0,M=("boolean"==typeof c||r.enableAutoClose,Math.max(0,h-(null!==(s=null==p?void 0:p.length)&&void 0!==s?s:0))),y=M>0?"".concat("0".repeat(Math.max(M-3,0)),"123").slice(-M):"123",k="".concat(p).concat(y);return(0,ee.jsxs)($.A,{form:u,layout:"vertical",submitter:!1,style:{padding:"20px 0"},onValuesChange:function(e){return i(e)},children:[(0,ee.jsxs)("div",{style:{marginBottom:32},children:[(0,ee.jsxs)(x.Z,{size:"small",children:[(0,ee.jsx)(C.Z,{}),(0,ee.jsx)(ne,{level:5,style:{margin:0},children:a.formatMessage({id:"ticket.settings.basic.section.number",defaultMessage:"工单编号设置"})})]}),(0,ee.jsxs)(R.Z,{gutter:24,children:[(0,ee.jsx)(G.Z,{span:12,children:(0,ee.jsx)($.A.Item,{name:"numberPrefix",label:(0,ee.jsxs)(x.Z,{children:[a.formatMessage({id:"ticket.settings.basic.numberPrefix",defaultMessage:"工单编号前缀"}),(0,ee.jsx)(_.Z,{title:a.formatMessage({id:"ticket.settings.basic.numberPrefix.tooltip",defaultMessage:"工单编号的前缀，如 TK、WO 等"}),children:(0,ee.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ee.jsx)(v.Z,{maxLength:10,placeholder:a.formatMessage({id:"ticket.settings.basic.numberPrefix.placeholder",defaultMessage:"如：TK、WO"})})})}),(0,ee.jsx)(G.Z,{span:12,children:(0,ee.jsx)($.A.Item,{name:"numberLength",label:(0,ee.jsxs)(x.Z,{children:[a.formatMessage({id:"ticket.settings.basic.numberLength",defaultMessage:"编号长度"}),(0,ee.jsx)(_.Z,{title:a.formatMessage({id:"ticket.settings.basic.numberLength.tooltip",defaultMessage:"工单编号的总长度，包括前缀"}),children:(0,ee.jsx)(Y.Z,{style:{color:"#999"}})})]}),children:(0,ee.jsx)(V.Z,{min:Math.max(p.length+1,6),max:20,placeholder:a.formatMessage({id:"ticket.settings.basic.numberLength.placeholder",defaultMessage:"如：8"})})})})]}),(0,ee.jsx)(te,{type:"secondary",children:a.formatMessage({id:"ticket.settings.basic.sample",defaultMessage:"示例编号：{sample}"},{sample:k})})]}),(0,ee.jsx)(Q.Z,{style:{margin:"16px 0"}}),(0,ee.jsxs)("div",{children:[(0,ee.jsx)(ne,{level:5,children:a.formatMessage({id:"ticket.settings.basic.section.visitor",defaultMessage:"访客创建限制"})}),(0,ee.jsx)($.A.Item,{name:"requireLogin",label:a.formatMessage({id:"ticket.settings.basic.requireLogin.label",defaultMessage:"必须登录后才能创建工单"}),valuePropName:"checked",children:(0,ee.jsx)(b.Z,{checkedChildren:a.formatMessage({id:"ticket.settings.basic.requireLogin.on",defaultMessage:"需要登录"}),unCheckedChildren:a.formatMessage({id:"ticket.settings.basic.requireLogin.off",defaultMessage:"允许匿名"})})}),(0,ee.jsx)(te,{type:"secondary",children:a.formatMessage({id:"ticket.settings.basic.requireLogin.desc",defaultMessage:"启用后，访客必须先通过登录认证才能提交工单。"})})]})]})}),re=n(76711),ie=n.n(re),ae=n(59533),oe=n(40110),ue=n(54943),le=n(86895),de=n(65207),ce=n(33979),ge=n(48965),fe=n(12322),me=n(2696),pe=n(9170),he=n(25420),xe=n(26138),ve=n(41658),Me=n(91361),ye=H.Z.Text,ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"tmp_".concat(e,"_").concat(Math.floor(1e3*Math.random()))},be=function(e){return ie()(e).sort((function(e,t){var n,s,r=null!==(n=e.orderIndex)&&void 0!==n?n:0,i=null!==(s=t.orderIndex)&&void 0!==s?s:0;return r===i?(e.name||"").localeCompare(t.name||""):r-i}))},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e,t){var n,s,r,i,a;return{uid:null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:ke(t),name:(null!==(s=null==e?void 0:e.name)&&void 0!==s?s:"").trim(),description:null!==(r=null==e?void 0:e.description)&&void 0!==r?r:"",enabled:!1!==(null==e?void 0:e.enabled),defaultCategory:null!==(i=null==e?void 0:e.defaultCategory)&&void 0!==i&&i,orderIndex:null!==(a=null==e?void 0:e.orderIndex)&&void 0!==a?a:t}})),n=be(t).map((function(e,t){return r()(r()({},e),{},{orderIndex:t})})),s=!1,i=n.map((function(e){return e.defaultCategory&&e.enabled?s?r()(r()({},e),{},{defaultCategory:!1}):(s=!0,e):e}));if(!s){var a=i.findIndex((function(e){return e.enabled}));a>=0&&(i[a]=r()(r()({},i[a]),{},{defaultCategory:!0}),s=!0)}return!s&&i.length>0&&(i[0]=r()(r()({},i[0]),{},{defaultCategory:!0,enabled:!0})),i},Ze=function(e){var t=e.items,n=e.onChange,s=(0,m.useIntl)(),i=(0,Me.Z)().translateString,a=W.Z.useForm(),o=g()(a,1)[0],l=(0,f.useState)(!1),c=g()(l,2),p=c[0],M=c[1],Z=(0,f.useState)(null),S=g()(Z,2),C=S[0],w=S[1],T=(0,U.u)((function(e){return e.currentOrg})),I=(0,xe.v)((function(e){return e.categoryTreeOptions})),E=(0,xe.v)((function(e){return e.categoryResult})),O=(0,f.useState)(!1),L=g()(O,2),A=L[0],q=L[1],z=(0,f.useState)([]),J=g()(z,2),B=J[0],D=J[1],X=(0,f.useState)(!1),H=g()(X,2),K=H[0],R=H[1],G=(0,f.useMemo)((function(){return je(null!=t?t:[])}),[t]),V=(0,f.useMemo)((function(){var e,t=G.filter((function(e){return e.enabled})).length;return{enabled:t,disabled:G.length-t,defaultUid:null===(e=G.find((function(e){return e.defaultCategory&&e.enabled})))||void 0===e?void 0:e.uid}}),[G]);(0,f.useEffect)((function(){null!=T&&T.uid&&(0,ve.HK)(N.FXY,T.uid,void 0,N.whQ,{pageSize:200,showLoading:!1})}),[null==T?void 0:T.uid]);var Q=(0,f.useMemo)((function(){return I.filter((function(e){return e.key!==N.zBg}))}),[I]),Y=(0,f.useMemo)((function(){var e,t=[];return function e(n){null!=n&&n.length&&n.forEach((function(n){var s;null!=n&&n.uid&&n.uid!==N.zBg&&(t.push(n),null!==(s=n.children)&&void 0!==s&&s.length&&e(n.children))}))}(null==E||null===(e=E.data)||void 0===e?void 0:e.content),t}),[E]),$=(0,f.useMemo)((function(){var e=new Map;return Y.forEach((function(t){t.uid&&e.set(t.uid,t)})),e}),[Y]);(0,f.useEffect)((function(){if(A){var e=G.map((function(e){return e.uid})).filter((function(e){return"string"==typeof e&&e.length>0}));D(e)}}),[A,G]);var te=function(e){n(je(e))},ne=function(){var e=d()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=T&&T.uid){e.next=3;break}return ae.ZP.warning(s.formatMessage({id:"ticket.settings.category.select.noOrg",defaultMessage:"请先选择一个组织"})),e.abrupt("return");case 3:if(q(!0),0!==Q.length){e.next=12;break}return R(!0),e.prev=6,e.next=9,(0,ve.HK)(N.FXY,T.uid,void 0,N.whQ,{pageSize:200,showLoading:!1});case 9:return e.prev=9,R(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])})));return function(){return e.apply(this,arguments)}}(),se=function(e,t){if(e){var n=ie()(G),s=n.findIndex((function(t){return t.uid===e}));if(!(s<0)){var i="up"===t?s-1:s+1;if(!(i<0||i>=n.length)){var a=n.splice(s,1),o=g()(a,1)[0];n.splice(i,0,o);var u=n.map((function(e,t){return r()(r()({},e),{},{orderIndex:t})}));te(u)}}}},re=function(){var e=d()(u()().mark((function e(){var t,n,i,a,l;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.validateFields();case 3:if(i=e.sent,null!=C&&C.uid){e.next=6;break}return e.abrupt("return");case 6:a=r()(r()({},C),{},{name:i.name.trim(),description:(null!==(t=i.description)&&void 0!==t?t:"").trim(),enabled:!1!==i.enabled,defaultCategory:!0===i.defaultCategory,orderIndex:null!==(n=C.orderIndex)&&void 0!==n?n:0}),l=G.map((function(e){return e.uid===C.uid?r()(r()({},e),a):e})),te(l),M(!1),w(null),o.resetFields(),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.update.success",defaultMessage:"分类已更新"})),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),be=[{title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.name",defaultMessage:"分类名称"}),dataIndex:"name",key:"name",render:function(e,t){return(0,ee.jsxs)(x.Z,{size:8,children:[t.defaultCategory&&t.enabled?(0,ee.jsx)(k.Z,{color:"gold",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.badge",defaultMessage:"默认"})}):null,(0,ee.jsx)(ye,{strong:!0,children:i(t.name)||"--"})]})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",render:function(e,t){return(0,ee.jsx)(b.Z,{checked:!!t.enabled,onChange:function(e){return function(e,t){if(e){var n=G.map((function(n){return n.uid===e?r()(r()({},n),{},{enabled:t}):n}));te(n)}}(t.uid,e)}})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default",defaultMessage:"默认分类"}),dataIndex:"defaultCategory",key:"defaultCategory",render:function(e,t){return(0,ee.jsx)(_.Z,{title:t.enabled?s.formatMessage({id:"ticket.settings.category.makeDefault",defaultMessage:"设为默认分类"}):s.formatMessage({id:"ticket.settings.category.default.disabled",defaultMessage:"启用后方可设为默认"}),children:(0,ee.jsx)(h.ZP,{type:"text",icon:t.enabled&&t.defaultCategory?(0,ee.jsx)(ge.Z,{style:{color:"#faad14"}}):(0,ee.jsx)(fe.Z,{}),disabled:!t.enabled,onClick:function(){return function(e){if(e){var t=G.map((function(t){return r()(r()({},t),{},{defaultCategory:t.uid===e})}));te(t)}}(t.uid)}})})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.order",defaultMessage:"排序"}),key:"order",render:function(e,t,n){return(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(_.Z,{title:s.formatMessage({id:"common.move.up",defaultMessage:"上移"}),children:(0,ee.jsx)(h.ZP,{type:"text",icon:(0,ee.jsx)(me.Z,{}),disabled:0===n,onClick:function(){return se(t.uid,"up")}})}),(0,ee.jsx)(_.Z,{title:s.formatMessage({id:"common.move.down",defaultMessage:"下移"}),children:(0,ee.jsx)(h.ZP,{type:"text",icon:(0,ee.jsx)(pe.Z,{}),disabled:n===G.length-1,onClick:function(){return se(t.uid,"down")}})})]})}},{title:(0,ee.jsx)(m.FormattedMessage,{id:"common.actions",defaultMessage:"操作"}),key:"actions",render:function(e,t){return(0,ee.jsxs)(x.Z,{size:8,children:[(0,ee.jsx)(h.ZP,{type:"link",icon:(0,ee.jsx)(F.Z,{}),onClick:function(){return function(e){w(e),o.setFieldsValue({name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory}),M(!0)}(t)},children:(0,ee.jsx)(m.FormattedMessage,{id:"common.edit",defaultMessage:"编辑"})}),(0,ee.jsx)(j.Z,{title:s.formatMessage({id:"ticket.settings.category.delete.confirm",defaultMessage:"确认删除该分类？"}),onConfirm:function(){return function(e){if(e){var t=G.filter((function(t){return t.uid!==e}));te(t),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.delete.success",defaultMessage:"分类已删除"}))}}(t.uid)},okText:s.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(h.ZP,{type:"link",danger:!0,icon:(0,ee.jsx)(P.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})})]})}}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(oe.Z,{title:(0,ee.jsxs)(x.Z,{size:8,children:[(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.title",defaultMessage:"分类列表"}),(0,ee.jsx)(k.Z,{color:"blue",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.summary",defaultMessage:"启用 {enabled} / 禁用 {disabled}",values:{enabled:V.enabled,disabled:V.disabled}})}),V.defaultUid?(0,ee.jsx)(k.Z,{color:"gold",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.current",defaultMessage:"默认已设置"})}):(0,ee.jsx)(k.Z,{color:"red",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.default.missing",defaultMessage:"请设置默认分类"})})]}),extra:(0,ee.jsx)(h.ZP,{type:"primary",icon:(0,ee.jsx)(he.Z,{}),onClick:ne,children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.selectFromTree",defaultMessage:"从分类树选择"})}),styles:{body:{padding:0}},children:[(0,ee.jsx)(ue.Z,{columns:be,dataSource:G,rowKey:function(e){var t,n;return null!==(t=null!==(n=e.uid)&&void 0!==n?n:e.name)&&void 0!==t?t:ke()},pagination:!1}),(0,ee.jsx)("div",{style:{padding:"16px 24px"},children:(0,ee.jsx)(ye,{type:"secondary",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.hint",defaultMessage:"至少保留一个启用的分类，并指定默认分类供访客预选。"})})})]}),(0,ee.jsx)(le.Z,{open:A,title:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.title",defaultMessage:"选择工单分类"}),onOk:function(){if(0!==B.length){var e=new Set(B),t=G.filter((function(t){return t.uid&&e.has(t.uid)})),n=[];B.forEach((function(e){var s;if(!t.some((function(t){return t.uid===e}))){var r=$.get(e);r&&n.push({uid:r.uid,name:null!==(s=r.name)&&void 0!==s?s:r.uid,description:"",enabled:!0,defaultCategory:!1,orderIndex:t.length+n.length})}}));var r=[].concat(ie()(t),n);te(r),q(!1),ae.ZP.success(s.formatMessage({id:"ticket.settings.category.select.success",defaultMessage:"分类列表已更新"}))}else ae.ZP.warning(s.formatMessage({id:"ticket.settings.category.select.empty",defaultMessage:"请选择至少一个分类"}))},onCancel:function(){q(!1),R(!1)},confirmLoading:K,destroyOnHidden:!0,width:480,okText:s.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:s.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsxs)(x.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,ee.jsx)(ye,{type:"secondary",children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.tip",defaultMessage:"勾选需要在工单配置中启用的分类。"})}),K?(0,ee.jsx)("div",{style:{textAlign:"center",padding:"32px 0"},children:(0,ee.jsx)(de.Z,{})}):Q.length>0?(0,ee.jsx)(ce.Z,{checkable:!0,selectable:!1,checkedKeys:B,onCheck:function(e){var t;Array.isArray(e)?D(e):D(null!==(t=e.checked)&&void 0!==t?t:[])},treeData:Q,height:360,titleRender:function(e){var t="string"==typeof e.title?e.title:"",n=i(t)||t||"--";return(0,ee.jsx)(_.Z,{title:n,children:n})}}):(0,ee.jsx)(y.Z,{image:y.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.select.emptyTree",defaultMessage:"暂无可用分类，请先在分类管理中创建。"})})]})}),(0,ee.jsx)(le.Z,{open:p,title:C?s.formatMessage({id:"ticket.settings.category.modal.edit",defaultMessage:"编辑分类"}):s.formatMessage({id:"ticket.settings.category.modal.create",defaultMessage:"新增分类"}),onOk:re,onCancel:function(){M(!1),w(null),o.resetFields()},destroyOnHidden:!0,width:520,children:(0,ee.jsxs)(W.Z,{form:o,layout:"vertical",children:[(0,ee.jsx)(W.Z.Item,{name:"name",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.name",defaultMessage:"分类名称"}),rules:[{required:!0,message:s.formatMessage({id:"ticket.settings.category.form.name.required",defaultMessage:"请输入分类名称"})},{max:32,message:s.formatMessage({id:"ticket.settings.category.form.name.length",defaultMessage:"名称长度不超过32个字符"})}],children:(0,ee.jsx)(v.Z,{placeholder:s.formatMessage({id:"ticket.settings.category.form.name.placeholder",defaultMessage:"例如：售后支持"}),allowClear:!0})}),(0,ee.jsx)(W.Z.Item,{name:"description",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.description",defaultMessage:"描述"}),rules:[{max:120,message:s.formatMessage({id:"ticket.settings.category.form.description.length",defaultMessage:"描述长度不超过120个字符"})}],children:(0,ee.jsx)(v.Z.TextArea,{rows:3,placeholder:s.formatMessage({id:"ticket.settings.category.form.description.placeholder",defaultMessage:"用于帮助访客理解分类用途，可选填"}),allowClear:!0})}),(0,ee.jsx)(W.Z.Item,{name:"enabled",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,ee.jsx)(b.Z,{})}),(0,ee.jsx)(W.Z.Item,{name:"defaultCategory",label:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.category.form.default",defaultMessage:"设为默认分类"}),valuePropName:"checked",children:(0,ee.jsx)(b.Z,{disabled:0===G.length&&!C})})]})})]})},Se=function(e){var t=e.open,n=e.record,s=e.onClose,r=e.onSuccess,i=(0,m.useIntl)(),a=(0,U.u)((function(e){return e.currentOrg})),o=W.Z.useForm(),l=g()(o,1)[0],c=(0,f.useState)(!1),p=g()(c,2),h=p[0],x=p[1],M=!(null==n||!n.uid);(0,f.useEffect)((function(){t&&(l.resetFields(),n&&l.setFieldsValue({name:n.name,description:n.description}))}),[t,null==n?void 0:n.uid]);var y=function(){var e=d()(u()().mark((function e(){var t,o,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.validateFields();case 3:if(t=e.sent,null!=a&&a.uid){e.next=6;break}return e.abrupt("return");case 6:if(x(!0),!M){e.next=14;break}return e.next=10,(0,z.mE)({uid:n.uid,orgUid:a.uid,name:t.name,description:t.description});case 10:200===(null==(o=e.sent)?void 0:o.code)?(L.yw.success(i.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),r(o.data),s()):L.yw.error((null==o?void 0:o.message)||i.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),e.next=18;break;case 14:return e.next=16,(0,z.Gv)({orgUid:a.uid,name:t.name,description:t.description});case 16:200===(null==(d=e.sent)?void 0:d.code)?(L.yw.success(i.formatMessage({id:"common.created",defaultMessage:"创建成功"})),r(d.data),s()):L.yw.error((null==d?void 0:d.message)||i.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"}));case 18:return e.prev=18,x(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,,18,21]])})));return function(){return e.apply(this,arguments)}}();return(0,ee.jsx)(le.Z,{title:M?i.formatMessage({id:"ticket.settings.edit.title",defaultMessage:"编辑工单配置"}):i.formatMessage({id:"ticket.settings.create.title",defaultMessage:"新建工单配置"}),width:520,open:t,onCancel:s,onOk:y,okText:M?i.formatMessage({id:"common.save",defaultMessage:"保存"}):i.formatMessage({id:"common.create",defaultMessage:"创建"}),cancelText:i.formatMessage({id:"common.cancel",defaultMessage:"取消"}),confirmLoading:h,destroyOnHidden:!0,children:(0,ee.jsxs)(W.Z,{form:l,layout:"vertical",children:[(0,ee.jsx)(W.Z.Item,{label:i.formatMessage({id:"common.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0,message:i.formatMessage({id:"common.name.required",defaultMessage:"请输入名称"})}],children:(0,ee.jsx)(v.Z,{maxLength:64,showCount:!0,placeholder:i.formatMessage({id:"common.name.placeholder",defaultMessage:"请输入名称"})})}),(0,ee.jsx)(W.Z.Item,{label:i.formatMessage({id:"common.description",defaultMessage:"描述"}),name:"description",children:(0,ee.jsx)(v.Z.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:i.formatMessage({id:"common.description.placeholder",defaultMessage:"请输入描述"})})})]})})},Ce=function(e){return e?JSON.parse(JSON.stringify(e)):null},we=function(){var e=(0,m.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),n=(0,A.Z)().isDarkMode,s=(0,q.Z)().leftSiderStyle,i=(0,f.useState)([]),o=g()(i,2),l=o[0],c=o[1],J=(0,f.useState)(""),B=g()(J,2),D=B[0],N=B[1],H=(0,f.useState)(),K=g()(H,2),W=K[0],R=K[1],G=(0,f.useState)("basic"),_=g()(G,2),V=_[0],Q=_[1],Y=(0,f.useState)(!1),$=g()(Y,2),te=$[0],ne=$[1],re=(0,f.useState)(!1),ie=g()(re,2),ae=ie[0],oe=ie[1],ue=(0,f.useState)(!1),le=g()(ue,2),de=le[0],ce=le[1],ge=(0,f.useState)(!1),fe=g()(ge,2),me=fe[0],pe=fe[1],he=(0,f.useState)(null),xe=g()(he,2),ve=xe[0],Me=xe[1],ye=(0,f.useState)(!1),ke=g()(ye,2),be=ke[0],we=ke[1],Te=(0,f.useRef)(""),Fe=X((function(e){return{setCurrentTicketSettings:e.setCurrentTicketSettings,currentTicketSettings:e.currentTicketSettings,updateCurrentTicketSettings:e.updateCurrentTicketSettings}})),Pe=Fe.setCurrentTicketSettings,Ie=Fe.currentTicketSettings,Ee=Fe.updateCurrentTicketSettings,Oe=(0,f.useMemo)((function(){return(W?l.find((function(e){return e.uid===W})):null)||null}),[l,W]),Le=(0,f.useMemo)((function(){if(!D)return l;var e=D.toLowerCase();return l.filter((function(t){return((t.name||t.uid||"")+(t.description||"")).toLowerCase().includes(e)}))}),[l,D]),Ue=(0,f.useCallback)(function(){var e=d()(u()().mark((function e(n){var s,r,i,a,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return ne(!0),e.prev=3,r=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:200,searchText:r},e.next=8,(0,z.Bg)(i);case 8:a=e.sent,console.log("queryTicketSettingsByOrg response:",a,i),o=(null==a||null===(s=a.data)||void 0===s?void 0:s.content)||[],c(o),!(o.length>0)||W&&o.some((function(e){return e.uid===W}))||R(o[0].uid);case 13:return e.prev=13,ne(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,W]);(0,f.useEffect)((function(){Ue(D)}),[null==t?void 0:t.uid]),(0,f.useEffect)((function(){if(Oe){var e=Ce(Oe);Pe(e),Te.current=JSON.stringify(null!=Oe?Oe:{}),we(!1)}else Pe(null),Te.current=JSON.stringify({}),we(!1)}),[Oe,Pe]),(0,f.useEffect)((function(){if(Ie)try{var e=JSON.stringify(Ie);we(e!==Te.current)}catch(e){we(!0)}else we(!1)}),[Ie]);var Ae=function(){var n=d()(u()().mark((function n(s){var r,i,a,o;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=null!=s?s:Oe)&&r.uid){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,z.oX)({uid:r.uid});case 6:if(i=n.sent,!((Array.isArray(null==i?void 0:i.data)?i.data:[]).length>0)){n.next=11;break}return L.yw.warning(e.formatMessage({id:"ticket.settings.delete.hasBinding",defaultMessage:"当前工单设置已绑定工作组，请先解绑后再删除"})),n.abrupt("return");case 11:return a={uid:r.uid,orgUid:null==t?void 0:t.uid},n.next=14,(0,z.nU)(a);case 14:o=n.sent,console.log("deleteTicketSettings response:",o,a),200===(null==o?void 0:o.code)?(L.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),c((function(e){return e.filter((function(e){return e.uid!==r.uid}))})),W===r.uid&&R(void 0)):L.yw.error((null==o?void 0:o.message)||"删除失败"),n.next=23;break;case 19:n.prev=19,n.t0=n.catch(3),console.error(n.t0),L.yw.error(e.formatMessage({id:"ticket.settings.delete.failed",defaultMessage:"删除失败"}));case 23:case"end":return n.stop()}}),n,null,[[3,19]])})));return function(e){return n.apply(this,arguments)}}(),qe=function(){var n=d()(u()().mark((function n(s,r){var i;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,z.mE)({uid:s,orgUid:null==t?void 0:t.uid,enabled:r});case 3:(i=n.sent)&&200===i.code?(L.yw.success(e.formatMessage({id:r?"common.enabled":"common.disabled",defaultMessage:r?"已启用":"已停用"})),Ue(D)):L.yw.error((null==i?void 0:i.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),L.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),ze=function(e){if(e){var t=e;return t&&"object"===a()(t)&&"content"in t?t.content:e}},Je=function(e){var t,n,s,i,a,o,u,l;if(!e)return null;var d,c=null!==(t=e.draftBasicSettings)&&void 0!==t?t:e.basicSettings,g=c?r()({},c):void 0,f=null!==(n=e.draftStatusFlowSettings)&&void 0!==n?n:e.statusFlowSettings,m=null!==(s=e.draftPrioritySettings)&&void 0!==s?s:e.prioritySettings,p=null!==(i=e.draftCustomFieldSettings)&&void 0!==i?i:e.customFieldSettings,h=null!==(a=e.draftAssignmentSettings)&&void 0!==a?a:e.assignmentSettings,x=null!==(o=e.draftNotificationSettings)&&void 0!==o?o:e.notificationSettings,v=null!==(u=e.draftCategorySettings)&&void 0!==u?u:e.categorySettings,M=v?je(null!==(l=v.items)&&void 0!==l?l:[]):void 0;return{uid:e.uid,orgUid:e.orgUid,name:e.name,description:e.description,isDefault:null==e?void 0:e.isDefault,enabled:null==e?void 0:e.enabled,basicSettings:g,statusFlowSettings:ze(f),prioritySettings:ze(m),assignmentSettings:h,notificationSettings:x,customFieldSettings:ze(p),categorySettings:M?{items:(d=M,null==d?void 0:d.map((function(e,t){var n;return{uid:e.uid,name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory,orderIndex:null!==(n=e.orderIndex)&&void 0!==n?n:t}})))}:void 0}},Be=function(){var n=d()(u()().mark((function n(){var s,i,a,o,l;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=Ie)&&s.uid){n.next=4;break}return L.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return",!1);case 4:if(oe(!0),n.prev=5,i=Je(s)){n.next=10;break}return L.yw.error(e.formatMessage({id:"ticket.settings.save.payload.empty",defaultMessage:"保存数据为空，无法提交"})),n.abrupt("return",!1);case 10:return a=r()(r()({},i),{},{orgUid:null==t?void 0:t.uid}),n.next=13,(0,z.mE)(a);case 13:if(o=n.sent,console.log("updateTicketSettings response:",o,a),200!==(null==o?void 0:o.code)){n.next=25;break}return L.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),u=o.data,d=s,g=void 0,f=void 0,m=void 0,p=void 0,h=void 0,x=void 0,l=u?r()(r()(r()({},d),u),{},{basicSettings:null!==(g=u.basicSettings)&&void 0!==g?g:d.basicSettings,draftBasicSettings:null!==(f=null!==(m=null!==(p=u.draftBasicSettings)&&void 0!==p?p:u.basicSettings)&&void 0!==m?m:d.draftBasicSettings)&&void 0!==f?f:d.basicSettings,draftCategorySettings:null!==(h=u.draftCategorySettings)&&void 0!==h?h:d.draftCategorySettings,categorySettings:null!==(x=u.categorySettings)&&void 0!==x?x:d.categorySettings}):d,Te.current=JSON.stringify(null!=l?l:{}),we(!1),c((function(e){return e.map((function(e){return e.uid===s.uid?l:e}))})),Pe(Ce(l)),n.abrupt("return",!0);case 25:return L.yw.error((null==o?void 0:o.message)||e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 27:n.next=34;break;case 29:return n.prev=29,n.t0=n.catch(5),console.error("保存失败:",n.t0),L.yw.error(e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 34:return n.prev=34,oe(!1),n.finish(34);case 37:return n.abrupt("return",!1);case 38:case"end":return n.stop()}var u,d,g,f,m,p,h,x}),n,null,[[5,29,34,37]])})));return function(){return n.apply(this,arguments)}}(),De=function(){var n=d()(u()().mark((function n(){var s,r,i,a;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=Ie)&&s.uid){n.next=4;break}return L.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return");case 4:if(ce(!0),n.prev=5,!be){n.next=12;break}return n.next=9,Be();case 9:if(n.sent){n.next=12;break}return n.abrupt("return");case 12:return r={uid:s.uid,orgUid:null==t?void 0:t.uid},n.next=15,(0,z.Ch)(r);case 15:i=n.sent,console.log("publishTicketSettings response:",i,r),200===(null==i?void 0:i.code)?(L.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Te.current=JSON.stringify(null!==(a=i.data)&&void 0!==a?a:{}),we(!1),c((function(e){return e.map((function(e){return e.uid===s.uid?i.data:e}))})),Pe(Ce(i.data))):L.yw.error((null==i?void 0:i.message)||e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"})),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(5),console.error("发布失败:",n.t0),L.yw.error(e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"}));case 24:return n.prev=24,ce(!1),n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[5,20,24,27]])})));return function(){return n.apply(this,arguments)}}(),Ne=function(e){var t,n,s,r,i,a,o;return{numberPrefix:null!==(t=null==e?void 0:e.numberPrefix)&&void 0!==t?t:"TK",numberLength:null!==(n=null==e?void 0:e.numberLength)&&void 0!==n?n:8,defaultPriority:null!==(s=null==e?void 0:e.defaultPriority)&&void 0!==s?s:"medium",validityDays:null!==(r=null==e?void 0:e.validityDays)&&void 0!==r?r:30,autoCloseHours:null!==(i=null==e?void 0:e.autoCloseHours)&&void 0!==i?i:72,enableAutoClose:null!==(a=null==e?void 0:e.enableAutoClose)&&void 0!==a&&a,requireLogin:null!==(o=null==e?void 0:e.requireLogin)&&void 0!==o&&o}},Xe=function(e){var t=Array.isArray(null==e?void 0:e.items)?e.items:[];return je(t)},He=null!=Ie?Ie:Oe,Ke=(0,f.useMemo)((function(){var e,t;if(null==He||!He.uid)return[];var n=[{key:"basic",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(C.Z,{})," ",(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.tab.basic",defaultMessage:"基础设置"})]}),children:(0,ee.jsx)("div",{style:{padding:8},children:(0,ee.jsx)(se,{settings:Ne(null!==(e=null==He?void 0:He.draftBasicSettings)&&void 0!==e?e:null==He?void 0:He.basicSettings),onChange:function(e){Ee((function(t){var n,s,i=Ne(null!==(n=null!==(s=t.draftBasicSettings)&&void 0!==s?s:t.basicSettings)&&void 0!==n?n:{});t.draftBasicSettings=r()(r()({},i),e),t.hasUnpublishedChanges=!0}))}})})},{key:"categories",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(w.Z,{})," ",(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.tab.categories",defaultMessage:"分类设置"})]}),children:(0,ee.jsx)("div",{style:{padding:8},children:(0,ee.jsx)(Ze,{items:Xe(null!==(t=null==He?void 0:He.draftCategorySettings)&&void 0!==t?t:null==He?void 0:He.categorySettings),onChange:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=je(e),n=t.filter((function(e){return e.enabled})).length,s=t.length-n,r=t.find((function(e){return e.defaultCategory&&e.enabled}));return{items:t,defaultCategoryUid:null==r?void 0:r.uid,enabledCount:n,disabledCount:s}}(e);Ee((function(e){e.draftCategorySettings=t,e.hasUnpublishedChanges=!0}))}})})}];return n}),[He,e,Ee]),We=(0,f.useCallback)((function(e){var t=e.trim();N(t),Ue(t)}),[Ue,N]);return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ee.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:s,children:(0,ee.jsxs)(S.Z,{title:e.formatMessage({id:"ticket.settings.list",defaultMessage:"工单配置列表"}),extra:(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(T.Z,{}),type:"primary",onClick:function(){Me(null),pe(!0)},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:te,children:[(0,ee.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ee.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ee.jsx)(v.Z,{placeholder:e.formatMessage({id:"ticket.settings.search.placeholder",defaultMessage:"搜索工单配置"}),value:D,onChange:function(e){return N(e.target.value)},onPressEnter:function(){return We(D)},allowClear:!0,size:"middle"}),(0,ee.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return We(D)},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.search",defaultMessage:"搜索"})})]})}),(0,ee.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ee.jsx)(M.Z,{dataSource:Le,locale:{emptyText:(0,ee.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ee.jsx)(M.Z.Item,{style:W===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return R(e.uid)},children:(0,ee.jsx)(M.Z.Item.Meta,{title:(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ee.jsx)(x.Z,{size:4,children:e.isDefault?(0,ee.jsx)(k.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ee.jsx)("div",{style:{color:n?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ee.jsx)(p.Z.Panel,{children:He?(0,ee.jsx)(S.Z,{title:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsxs)("span",{children:[e.formatMessage({id:"ticket.settings.editing",defaultMessage:"编辑工单设置"}),": ",He.name||He.uid]}),(0,ee.jsx)(b.Z,{checked:!!He.enabled,onChange:function(e){return qe(He.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(F.Z,{}),onClick:function(e){e.stopPropagation(),Oe&&(Me(Oe),pe(!0))},children:(0,ee.jsx)(m.FormattedMessage,{id:"ticket.settings.edit",defaultMessage:"编辑"})}),(0,ee.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ae(Oe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,ee.jsx)(P.Z,{}),onClick:function(e){return e.stopPropagation()},children:(0,ee.jsx)(m.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})}),He.isDefault?(0,ee.jsx)(k.Z,{color:"blue",children:"默认"}):null,be&&(0,ee.jsx)(k.Z,{color:"red",children:(0,ee.jsx)(m.FormattedMessage,{id:"common.unsaved",defaultMessage:"未保存修改"})})]}),extra:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(j.Z,{title:e.formatMessage({id:"ticket.settings.publish.confirm.title",defaultMessage:"发布到线上环境"}),description:e.formatMessage({id:"ticket.settings.publish.confirm.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:e.formatMessage({id:"ticket.settings.publish.confirm.ok",defaultMessage:"继续发布"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),De()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ee.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:de,type:"default",icon:(0,ee.jsx)(I.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ee.jsx)(h.ZP,{onClick:function(){if(Oe){var t=Te.current?JSON.parse(Te.current):null;Pe(Ce(t)),we(!1),L.yw.info(e.formatMessage({id:"ticket.settings.reset.info",defaultMessage:"已重置为当前发布版本"}))}},disabled:!be,icon:(0,ee.jsx)(E.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ee.jsx)(h.ZP,{type:"primary",loading:ae,onClick:Be,disabled:!be,icon:(0,ee.jsx)(O.Z,{}),children:(0,ee.jsx)(m.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ee.jsx)(Z.Z,{activeKey:V,onChange:Q,items:Ke})}):(0,ee.jsx)(S.Z,{children:(0,ee.jsx)(y.Z,{description:e.formatMessage({id:"ticket.settings.select.settings",defaultMessage:"请从左侧选择工单配置"})})})})]}),(0,ee.jsx)(Se,{open:me,record:ve||void 0,onClose:function(){return pe(!1)},onSuccess:function(){var e=d()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(D);case 2:null!=t&&t.uid&&R(t.uid);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})}}}]);