"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[362],{69842:function(e,t,n){n.d(t,{H:function(){return c}});var i=n(90819),o=n.n(i),s=n(73193),r=n.n(s),l=n(89933),a=n.n(l),u=n(55735),d=n(30921);function c(e){return v.apply(this,arguments)}function v(){return(v=a()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/vip/invoice/query/org",{method:"GET",params:r()(r()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},43705:function(e,t,n){var i=n(76711),o=n.n(i),s=n(73193),r=n.n(s),l=n(90819),a=n.n(l),u=n(89933),d=n.n(u),c=n(45332),v=n.n(c),g=n(86803),f=n(99885),p=n(66916),m=n(76750),h=n(66310),w=n(40612),b=n(90297),x=n(69169),q=n(48708),y=n(84881),S=n(30921),F=n(3849),k=n(75365),U=n(44194),C=n(1902),j=n(95490),M=n(55735),R=n(24170),T=n(72614),Z=n(11184),I=n(27522),P=n(31549);t.Z=function(e){var t,n,i=e.type,s=x.A.useForm(),l=v()(s,1)[0],u=(0,S.useIntl)(),c=((0,S.useNavigate)(),(0,m.Z)().translateString),A=(0,Z.M)(),K=A.config,V=A.updateConfig,L=(0,w.u)((function(e){return e.currentOrg})),W=(0,U.useState)(),B=v()(W,2),_=B[0],N=B[1],D=(0,U.useState)(),E=v()(D,2),O=E[0],X=E[1],z=(0,U.useState)(),Q=v()(z,2),$=Q[0],G=Q[1],H=(0,h.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),Y=H.currentRobot,J=H.setCurrentRobot,ee=(0,C.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),te=ee.currentAgent,ne=ee.setCurrentAgent,ie=(0,j.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),oe=ie.currentWorkgroup,se=ie.setCurrentWorkgroup,re=(0,U.useMemo)((function(){return i===M._X4?{chatType:M.xtN,chatSid:Y.uid}:i===M.Njn?{chatType:M.scI,chatSid:te.uid}:i===M.aZD?{chatType:M.vPY,chatSid:oe.uid}:{chatType:M.xtN,chatSid:""}}),[i,Y,te,oe]),le=re.chatType,ae=re.chatSid,ue=function(){var e=d()(a()().mark((function e(){var t,n,o,s,r,d,c,v;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:M.QPQ,orgUid:null==L?void 0:L.uid},e.prev=2,e.next=5,(0,I.AP)(t);case 5:n=e.sent,console.log("getKbases response:",t,n),g.yw.destroy(),200===n.code?(c={code:n.code,message:n.message,data:{content:n.data.content.map((function(e){return{uid:e.uid,name:e.name,type:e.type,orgUid:e.orgUid}})),totalElements:n.data.totalElements,totalPages:n.data.totalPages,number:n.data.number}},X(c),i===M._X4&&null!=Y&&null!==(o=Y.serviceSettings)&&void 0!==o&&o.faqKbUid?v=Y.serviceSettings.faqKbUid:i===M.Njn&&null!=te&&null!==(s=te.serviceSettings)&&void 0!==s&&s.faqKbUid?v=te.serviceSettings.faqKbUid:i===M.aZD&&null!=oe&&null!==(r=oe.serviceSettings)&&void 0!==r&&r.faqKbUid?v=oe.serviceSettings.faqKbUid:(null===(d=c.data)||void 0===d||null===(d=d.content)||void 0===d?void 0:d.length)>0&&(v=c.data.content[0].uid),v&&(G(v),l.setFieldValue("faqKbUid",v),de(v))):g.yw.error(n.message),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),g.yw.destroy(),console.error("获取知识库失败:",e.t0),g.yw.error("获取知识库失败");case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=d()(a()().mark((function e(t){var n,i,o,s,r,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||$){e.next=4;break}return console.log("没有选择知识库，无法获取FAQ"),N(void 0),e.abrupt("return");case 4:return g.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:100,orgUid:null==L?void 0:L.uid,kbUid:t||$},e.prev=6,e.next=9,(0,f.pf)(n);case 9:i=e.sent,console.log("getFaqs response:",n,i),g.yw.destroy(),200===i.code?(o={code:i.code,message:i.message,data:{content:i.data.content.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer,kbUid:e.kbUid,orgUid:e.orgUid}})),totalElements:i.data.totalElements,totalPages:i.data.totalPages,number:i.data.number}},N(o),t||$,(s=l.getFieldValue("faqUids")||[]).length>0&&(r=o.data.content.map((function(e){return e.uid})),(d=s.filter((function(e){return r.includes(e)}))).length!==s.length&&l.setFieldValue("faqUids",d))):g.yw.error(i.message),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(6),g.yw.destroy(),console.error("获取FAQ失败:",e.t0),g.yw.error("获取FAQ失败");case 20:case"end":return e.stop()}}),e,null,[[6,15]])})));return function(t){return e.apply(this,arguments)}}();(0,U.useEffect)((function(){null!=L&&L.uid&&ue()}),[null==L?void 0:L.uid,i]),(0,U.useEffect)((function(){var e;if(i===M._X4&&Y){var t,n,o,s={showFaqs:null==Y||null===(t=Y.serviceSettings)||void 0===t?void 0:t.showFaqs,faqKbUid:null==Y||null===(n=Y.serviceSettings)||void 0===n?void 0:n.faqKbUid,faqUids:(null==Y||null===(o=Y.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})))||[]};l.setFieldsValue({showFaqs:s.showFaqs,faqKbUid:s.faqKbUid,faqUids:s.faqUids}),e=s.faqKbUid,V(s.showFaqs?r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:680}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}):r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:380}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}))}else if(i===M.Njn&&te){var a,u,d,c={showFaqs:null==te||null===(a=te.serviceSettings)||void 0===a?void 0:a.showFaqs,faqKbUid:null==te||null===(u=te.serviceSettings)||void 0===u?void 0:u.faqKbUid,faqUids:(null==te||null===(d=te.serviceSettings)||void 0===d||null===(d=d.faqs)||void 0===d?void 0:d.map((function(e){return e.uid})))||[]};l.setFieldsValue({showFaqs:c.showFaqs,faqKbUid:c.faqKbUid,faqUids:c.faqUids}),e=c.faqKbUid,V(c.showFaqs?r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:680}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}):r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:380}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}))}else if(i===M.aZD&&oe){var v,g,f,p={showFaqs:null==oe||null===(v=oe.serviceSettings)||void 0===v?void 0:v.showFaqs,faqKbUid:null==oe||null===(g=oe.serviceSettings)||void 0===g?void 0:g.faqKbUid,faqUids:(null==oe||null===(f=oe.serviceSettings)||void 0===f||null===(f=f.faqs)||void 0===f?void 0:f.map((function(e){return e.uid})))||[]};l.setFieldsValue({showFaqs:p.showFaqs,faqKbUid:p.faqKbUid,faqUids:p.faqUids}),e=p.faqKbUid,V(p.showFaqs?r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:680}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}):r()(r()({},K),{},{window:r()(r()({},K.window),{},{width:380}),chatConfig:r()(r()({},K.chatConfig),{},{org:null==L?void 0:L.uid,t:le,sid:ae})}))}e&&e!==$&&(console.log("知识库ID变化，更新FAQ列表:",e),G(e),de(e))}),[Y,te,oe,i,le,ae,null==L?void 0:L.uid]);var ce=function(){var e=d()(a()().mark((function e(t){var n,s,l,d,c,v,f,m,h,w,b,x,q,y,S,F,k,U,C,j,Z,I,P,A,K,V,L;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish",t),e.prev=1,i!==M._X4){e.next=13;break}return c={showFaqs:t.showFaqs,faqKbUid:t.faqKbUid,faqUids:Array.isArray(t.faqUids)?o()(t.faqUids):[],welcomeFaqUids:null==Y||null===(n=Y.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),quickFaqUids:null==Y||null===(s=Y.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),hotFaqUids:null==Y||null===(l=Y.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==Y||null===(d=Y.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))},v=r()(r()({},Y),{},{serviceSettings:c}),console.log("robotObject:",v),e.next=8,(0,p.$l)(v);case 8:f=e.sent,console.log("updateRobot response:",f),200===f.code?(g.yw.destroy(),g.yw.success(u.formatMessage({id:"update.success"})),h=r()(r()({},f.data),{},{serviceSettings:r()(r()({},f.data.serviceSettings),{},{faqs:(null===(m=f.data.serviceSettings.faqs)||void 0===m?void 0:m.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer}})))||[]})}),J(h)):(g.yw.destroy(),g.yw.error(f.message)),e.next=33;break;case 13:if(i!==M.Njn){e.next=24;break}return y={showFaqs:t.showFaqs,faqKbUid:t.faqKbUid,faqUids:Array.isArray(t.faqUids)?o()(t.faqUids):[],welcomeFaqUids:null==Y||null===(w=Y.serviceSettings)||void 0===w||null===(w=w.welcomeFaqs)||void 0===w?void 0:w.map((function(e){return e.uid})),quickFaqUids:null==Y||null===(b=Y.serviceSettings)||void 0===b||null===(b=b.quickFaqs)||void 0===b?void 0:b.map((function(e){return e.uid})),hotFaqUids:null==Y||null===(x=Y.serviceSettings)||void 0===x||null===(x=x.hotFaqs)||void 0===x?void 0:x.map((function(e){return e.uid})),shortcutFaqUids:null==Y||null===(q=Y.serviceSettings)||void 0===q||null===(q=q.shortcutFaqs)||void 0===q?void 0:q.map((function(e){return e.uid}))},S=r()(r()({},te),{},{serviceSettings:y}),console.log("agentObject:",S),e.next=19,(0,R.sE)(S);case 19:F=e.sent,console.log("updateAgent response:",F),200===F.code?(g.yw.destroy(),g.yw.success(u.formatMessage({id:"update.success"})),U=r()(r()({},F.data),{},{serviceSettings:r()(r()({},F.data.serviceSettings),{},{faqs:(null===(k=F.data.serviceSettings.faqs)||void 0===k?void 0:k.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer}})))||[]})}),ne(U)):(g.yw.destroy(),g.yw.error(F.message)),e.next=33;break;case 24:if(i!==M.aZD){e.next=33;break}return P={showFaqs:t.showFaqs,faqKbUid:t.faqKbUid,faqUids:Array.isArray(t.faqUids)?o()(t.faqUids):[],welcomeFaqUids:null==Y||null===(C=Y.serviceSettings)||void 0===C||null===(C=C.welcomeFaqs)||void 0===C?void 0:C.map((function(e){return e.uid})),quickFaqUids:null==Y||null===(j=Y.serviceSettings)||void 0===j||null===(j=j.quickFaqs)||void 0===j?void 0:j.map((function(e){return e.uid})),hotFaqUids:null==Y||null===(Z=Y.serviceSettings)||void 0===Z||null===(Z=Z.hotFaqs)||void 0===Z?void 0:Z.map((function(e){return e.uid})),shortcutFaqUids:null==Y||null===(I=Y.serviceSettings)||void 0===I||null===(I=I.shortcutFaqs)||void 0===I?void 0:I.map((function(e){return e.uid}))},A=r()(r()({},oe),{},{serviceSettings:P}),console.log("workgroupObject:",A),e.next=30,(0,T.W5)(A);case 30:K=e.sent,console.log("updateWorkGroup response:",K),200===K.code?(g.yw.destroy(),g.yw.success(u.formatMessage({id:"update.success"})),L=r()(r()({},K.data),{},{serviceSettings:r()(r()({},K.data.serviceSettings),{},{faqs:(null===(V=K.data.serviceSettings.faqs)||void 0===V?void 0:V.map((function(e){return{uid:e.uid,question:e.question,answer:e.answer}})))||[]})}),se(L)):(g.yw.destroy(),g.yw.error(K.message));case 33:e.next=40;break;case 35:e.prev=35,e.t0=e.catch(1),g.yw.destroy(),console.error("提交失败:",e.t0),g.yw.error("提交失败");case 40:case"end":return e.stop()}}),e,null,[[1,35]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=d()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabFaqs handleChange",t),l.setFieldValue("showFaqs",t),e.prev=2,e.next=5,l.validateFields();case 5:n=e.sent,ce(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("验证失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,P.jsx)("div",{children:(0,P.jsxs)(x.A,{form:l,layout:"vertical",onFinish:ce,submitter:{render:function(e,t){return(0,P.jsxs)(F.Z,{children:[t,(0,P.jsx)(k.ZP,{color:"danger",variant:"outlined",icon:(0,P.jsx)(b.Z,{}),onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:u.formatMessage({id:"preview",defaultMessage:"Preview"})})]})}},children:[(0,P.jsx)(q.Z,{label:u.formatMessage({id:"faq.show.faqs"}),name:"showFaqs",fieldProps:{onChange:ve}}),(0,P.jsx)(y.Z,{name:"faqKbUid",width:"md",label:u.formatMessage({id:"menu.kbase.select",defaultMessage:"选择知识库"}),options:null==O||null===(t=O.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{label:c(e.name),value:e.uid}})),fieldProps:{onChange:function(e){console.log("selected kbase:",e),G(e),l.setFieldValue("faqUids",[]),de(e)},allowClear:!0,placeholder:(0,P.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,P.jsx)(y.Z,{name:"faqUids",width:"md",label:u.formatMessage({id:"menu.kbase.faq"}),options:null==_||null===(n=_.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:c(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,P.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}})]})})}},71469:function(e,t,n){var i=n(73193),o=n.n(i),s=n(90819),r=n.n(s),l=n(89933),a=n.n(l),u=n(45332),d=n.n(u),c=n(86803),v=n(99885),g=n(66916),f=n(76750),p=n(66310),m=n(40612),h=n(90297),w=n(69169),b=n(48708),x=n(84881),q=n(30921),y=n(3849),S=n(75365),F=n(44194),k=n(1902),U=n(95490),C=n(55735),j=n(24170),M=n(72614),R=n(11184),T=n(27522),Z=n(31549);t.Z=function(e){var t,n,i=e.type,s=w.A.useForm(),l=d()(s,1)[0],u=(0,q.useIntl)(),I=((0,q.useNavigate)(),(0,f.Z)().translateString),P=(0,R.M)(),A=P.config,K=P.updateConfig,V=(0,m.u)((function(e){return e.currentOrg})),L=(0,F.useState)(),W=d()(L,2),B=W[0],_=W[1],N=(0,F.useState)(),D=d()(N,2),E=D[0],O=D[1],X=(0,F.useState)(),z=d()(X,2),Q=z[0],$=z[1],G=(0,p.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),H=G.currentRobot,Y=G.setCurrentRobot,J=(0,k.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),ee=J.currentAgent,te=J.setCurrentAgent,ne=(0,U.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),ie=ne.currentWorkgroup,oe=ne.setCurrentWorkgroup,se=(0,F.useMemo)((function(){return i===C._X4?{chatType:C.xtN,chatSid:H.uid}:i===C.Njn?{chatType:C.scI,chatSid:ee.uid}:i===C.aZD?{chatType:C.vPY,chatSid:ie.uid}:{chatType:C.xtN,chatSid:""}}),[i,H,ee,ie]),re=se.chatType,le=se.chatSid,ae=function(){var e=a()(r()().mark((function e(){var t,n,o,s,a,d,v;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:C.QPQ,orgUid:null==V?void 0:V.uid},e.next=4,(0,T.AP)(t);case 4:n=e.sent,console.log("getKbases response:",t,n),c.yw.destroy(),200===n.code?(O(n),i===C._X4&&null!=H&&null!==(o=H.serviceSettings)&&void 0!==o&&o.quickFaqKbUid?v=H.serviceSettings.quickFaqKbUid:i===C.Njn&&null!=ee&&null!==(s=ee.serviceSettings)&&void 0!==s&&s.quickFaqKbUid?v=ee.serviceSettings.quickFaqKbUid:i===C.aZD&&null!=ie&&null!==(a=ie.serviceSettings)&&void 0!==a&&a.quickFaqKbUid?v=ie.serviceSettings.quickFaqKbUid:(null===(d=n.data)||void 0===d||null===(d=d.content)||void 0===d?void 0:d.length)>0&&(v=n.data.content[0].uid),v&&($(v),l.setFieldValue("quickFaqKbUid",v),ue(v))):c.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=a()(r()().mark((function e(t){var n,i,o,s,a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||Q){e.next=4;break}return console.log("没有选择知识库，无法获取FAQ"),_(void 0),e.abrupt("return");case 4:return c.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,orgUid:null==V?void 0:V.uid,kbUid:t||Q},e.next=8,(0,v.pf)(n);case 8:i=e.sent,console.log("getFaqs response:",n,i),c.yw.destroy(),200===i.code?(_(i),t||Q,(o=l.getFieldValue("quickFaqUids")||[]).length>0&&(s=i.data.content.map((function(e){return e.uid})),(a=o.filter((function(e){return s.includes(e)}))).length!==o.length&&l.setFieldValue("quickFaqUids",a))):c.yw.error(i.message);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,F.useEffect)((function(){null!=V&&V.uid&&ae()}),[V]),(0,F.useEffect)((function(){var e,t,n,s,r;if(i===C._X4&&H)l.setFieldsValue({showQuickFaqs:null==H||null===(t=H.serviceSettings)||void 0===t?void 0:t.showQuickFaqs,quickFaqKbUid:null==H||null===(n=H.serviceSettings)||void 0===n?void 0:n.quickFaqKbUid,quickFaqUids:null==H||null===(s=H.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid}))}),e=null==H||null===(r=H.serviceSettings)||void 0===r?void 0:r.quickFaqKbUid,K(o()(o()({},A),{},{chatConfig:o()(o()({},A.chatConfig),{},{org:null==V?void 0:V.uid,t:re,sid:le})}));else if(i===C.Njn&&ee){var a,u,d,c;l.setFieldsValue({showQuickFaqs:null==ee||null===(a=ee.serviceSettings)||void 0===a?void 0:a.showQuickFaqs,quickFaqKbUid:null==ee||null===(u=ee.serviceSettings)||void 0===u?void 0:u.quickFaqKbUid,quickFaqUids:null==ee||null===(d=ee.serviceSettings)||void 0===d||null===(d=d.quickFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),e=null==ee||null===(c=ee.serviceSettings)||void 0===c?void 0:c.quickFaqKbUid,K(o()(o()({},A),{},{chatConfig:o()(o()({},A.chatConfig),{},{org:null==V?void 0:V.uid,t:re,sid:le})}))}else if(i===C.aZD&&ie){var v,g,f,p;l.setFieldsValue({showQuickFaqs:null==ie||null===(v=ie.serviceSettings)||void 0===v?void 0:v.showQuickFaqs,quickFaqKbUid:null==ie||null===(g=ie.serviceSettings)||void 0===g?void 0:g.quickFaqKbUid,quickFaqUids:null==ie||null===(f=ie.serviceSettings)||void 0===f||null===(f=f.quickFaqs)||void 0===f?void 0:f.map((function(e){return e.uid}))}),e=null==ie||null===(p=ie.serviceSettings)||void 0===p?void 0:p.quickFaqKbUid,K(o()(o()({},A),{},{chatConfig:o()(o()({},A.chatConfig),{},{org:null==V?void 0:V.uid,t:re,sid:le})}))}e&&e!==Q&&(console.log("快捷回复知识库ID变化，更新FAQ列表:",e),$(e),ue(e))}),[H,ee,ie,i,re,le,null==V?void 0:V.uid]);var de=function(){var e=a()(r()().mark((function e(t){var n,s,l,a,d,v,f,p,m,h,w,b,x,q,y,S,F,k,U,R,T,Z,I,P,A;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish",t),i!==C._X4){e.next=11;break}return v=o()(o()({},H),{},{serviceSettings:o()(o()({},H.serviceSettings),{},{showQuickFaqs:t.showQuickFaqs,quickFaqKbUid:t.quickFaqKbUid,quickFaqUids:t.quickFaqUids,welcomeFaqUids:null==H||null===(n=H.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),faqUids:null==H||null===(s=H.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==H||null===(l=H.serviceSettings)||void 0===l||null===(l=l.guessFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),hotFaqUids:null==H||null===(a=H.serviceSettings)||void 0===a||null===(a=a.hotFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),shortcutFaqUids:null==H||null===(d=H.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))})}),console.log("robotObject:",v),e.next=6,(0,g.$l)(v);case 6:f=e.sent,console.log("updateRobot response:",f),200===f.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),Y(f.data)):(c.yw.destroy(),c.yw.error(f.message)),e.next=29;break;case 11:if(i!==C.Njn){e.next=21;break}return y=o()(o()({},ee),{},{serviceSettings:o()(o()({},null==ee?void 0:ee.serviceSettings),{},{showQuickFaqs:t.showQuickFaqs,quickFaqKbUid:t.quickFaqKbUid,quickFaqUids:t.quickFaqUids,welcomeFaqUids:null==ee||null===(p=ee.serviceSettings)||void 0===p||null===(p=p.welcomeFaqs)||void 0===p?void 0:p.map((function(e){return e.uid})),faqUids:null==ee||null===(m=ee.serviceSettings)||void 0===m||null===(m=m.faqs)||void 0===m?void 0:m.map((function(e){return e.uid})),guessFaqUids:null==ee||null===(h=ee.serviceSettings)||void 0===h||null===(h=h.guessFaqs)||void 0===h?void 0:h.map((function(e){return e.uid})),hotFaqUids:null==ee||null===(w=ee.serviceSettings)||void 0===w||null===(w=w.hotFaqs)||void 0===w?void 0:w.map((function(e){return e.uid})),shortcutFaqUids:null==ee||null===(b=ee.serviceSettings)||void 0===b||null===(b=b.shortcutFaqs)||void 0===b?void 0:b.map((function(e){return e.uid}))}),robotSettings:o()(o()({},ee.robotSettings),{},{robotUid:null==ee||null===(x=ee.robotSettings)||void 0===x||null===(x=x.robot)||void 0===x?void 0:x.uid}),messageLeaveSettings:o()(o()({},ee.messageLeaveSettings),{},{worktimeUids:null==ee||null===(q=ee.messageLeaveSettings)||void 0===q||null===(q=q.worktimes)||void 0===q?void 0:q.map((function(e){return e.uid}))}),autoReplySettings:o()({},ee.autoReplySettings)}),console.log("agentObject:",y),e.next=16,(0,j.sE)(y);case 16:S=e.sent,console.log("updateAgent response:",S),200===S.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),te(S.data)):(c.yw.destroy(),c.yw.error(S.message)),e.next=29;break;case 21:if(i!==C.aZD){e.next=29;break}return P=o()(o()({},ie),{},{serviceSettings:o()(o()({},ie.serviceSettings),{},{showQuickFaqs:t.showQuickFaqs,quickFaqKbUid:t.quickFaqKbUid,quickFaqUids:t.quickFaqUids,welcomeFaqUids:null==ie||null===(F=ie.serviceSettings)||void 0===F||null===(F=F.welcomeFaqs)||void 0===F?void 0:F.map((function(e){return e.uid})),faqUids:null===(k=ie.serviceSettings)||void 0===k||null===(k=k.faqs)||void 0===k?void 0:k.map((function(e){return e.uid})),guessFaqUids:null==ie||null===(U=ie.serviceSettings)||void 0===U||null===(U=U.guessFaqs)||void 0===U?void 0:U.map((function(e){return e.uid})),hotFaqUids:null==ie||null===(R=ie.serviceSettings)||void 0===R||null===(R=R.hotFaqs)||void 0===R?void 0:R.map((function(e){return e.uid})),shortcutFaqUids:null==ie||null===(T=ie.serviceSettings)||void 0===T||null===(T=T.shortcutFaqs)||void 0===T?void 0:T.map((function(e){return e.uid}))}),robotSettings:o()(o()({},ie.robotSettings),{},{robotUid:null==ie||null===(Z=ie.robotSettings)||void 0===Z||null===(Z=Z.robot)||void 0===Z?void 0:Z.uid}),messageLeaveSettings:o()(o()({},ie.messageLeaveSettings),{},{worktimeUids:null==ie||null===(I=ie.messageLeaveSettings)||void 0===I||null===(I=I.worktimes)||void 0===I?void 0:I.map((function(e){return e.uid}))}),agentUids:ie.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",P),e.next=26,(0,M.W5)(P);case 26:A=e.sent,console.log("updateWorkGroup response:",A),200===A.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),oe(A.data)):(c.yw.destroy(),c.yw.error(A.message));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=a()(r()().mark((function e(t){var n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabFaqs handleChange",t),l.setFieldValue("showQuickFaqs",t),e.prev=2,e.next=5,l.validateFields();case 5:n=e.sent,de(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("验证失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,Z.jsx)("div",{children:(0,Z.jsxs)(w.A,{form:l,layout:"vertical",onFinish:de,submitter:{render:function(e,t){return(0,Z.jsxs)(y.Z,{children:[t,(0,Z.jsx)(S.ZP,{color:"danger",variant:"outlined",icon:(0,Z.jsx)(h.Z,{}),onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:u.formatMessage({id:"preview",defaultMessage:"Preview"})})]})}},children:[(0,Z.jsx)(b.Z,{label:u.formatMessage({id:"faq.show.quick.buttons"}),name:"showQuickFaqs",fieldProps:{onChange:ce}}),(0,Z.jsx)(x.Z,{name:"quickFaqKbUid",width:"md",label:u.formatMessage({id:"menu.kbase.select",defaultMessage:"选择知识库"}),options:null==E||null===(t=E.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{label:I(e.name),value:e.uid}})),fieldProps:{onChange:function(e){console.log("selected kbase:",e),$(e),l.setFieldValue("quickFaqUids",[]),ue(e)},allowClear:!0,placeholder:(0,Z.jsx)(q.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,Z.jsx)(x.Z,{name:"quickFaqUids",width:"md",label:u.formatMessage({id:"menu.kbase.quickbutton"}),options:null==B||null===(n=B.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:I(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,Z.jsx)(q.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}})]})})}},40058:function(e,t,n){n(90819),n(73193),n(89933),n(45332),n(24170),n(66916),n(72614),n(1902),n(66310),n(95490),n(55735),n(30921),n(44194),n(31549)},50796:function(e,t,n){n(90819),n(73193),n(89933),n(45332),n(24170),n(66916),n(72614),n(1902),n(66310),n(95490),n(55735),n(30921),n(44194),n(31549)},75808:function(e,t,n){var i=n(90819),o=n.n(i),s=n(89933),r=n.n(s),l=n(73193),a=n.n(l),u=n(45332),d=n.n(u),c=n(86803),v=n(24170),g=n(66916),f=n(72614),p=n(1902),m=n(66310),h=n(95490),w=n(55735),b=n(69169),x=n(48708),q=n(30921),y=n(44194),S=n(11184),F=n(3849),k=n(75365),U=n(90297),C=n(31549);t.Z=function(e){var t=e.type,n=(0,q.useIntl)(),i=b.A.useForm(),s=d()(i,1)[0],l=(0,S.M)(),u=l.config,j=l.updateConfig,M=(0,m.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),R=M.currentRobot,T=M.setCurrentRobot,Z=(0,p.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),I=Z.currentAgent,P=Z.setCurrentAgent,A=(0,h.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),K=A.currentWorkgroup,V=A.setCurrentWorkgroup,L=(0,y.useMemo)((function(){return t===w._X4?{chatType:w.xtN,chatSid:R.uid}:t===w.Njn?{chatType:w.scI,chatSid:I.uid}:t===w.aZD?{chatType:w.vPY,chatSid:K.uid}:{chatType:w.xtN,chatSid:""}}),[t,R,I,K]),W=L.chatType,B=L.chatSid;(0,y.useEffect)((function(){var e,n,i,o,r,l;if(t===w._X4)s.setFieldsValue({autoPopup:null==R||null===(e=R.serviceSettings)||void 0===e?void 0:e.autoPopup,showInvite:null==R||null===(n=R.inviteSettings)||void 0===n?void 0:n.show,inviteText:null==R||null===(i=R.inviteSettings)||void 0===i?void 0:i.text}),j(a()(a()({},u),{},{autoPopup:null==R||null===(o=R.serviceSettings)||void 0===o?void 0:o.autoPopup,inviteConfig:{show:null==R||null===(r=R.inviteSettings)||void 0===r?void 0:r.show,text:null==R||null===(l=R.inviteSettings)||void 0===l?void 0:l.text},chatConfig:a()(a()({},u.chatConfig),{},{t:W,sid:B})}));else if(t===w.Njn){var d,c,v,g,f,p;s.setFieldsValue({autoPopup:null==I||null===(d=I.serviceSettings)||void 0===d?void 0:d.autoPopup,showInvite:null==I||null===(c=I.inviteSettings)||void 0===c?void 0:c.show,inviteText:null==I||null===(v=I.inviteSettings)||void 0===v?void 0:v.text}),j(a()(a()({},u),{},{autoPopup:null==I||null===(g=I.serviceSettings)||void 0===g?void 0:g.autoPopup,inviteConfig:{show:null==I||null===(f=I.inviteSettings)||void 0===f?void 0:f.show,text:null==I||null===(p=I.inviteSettings)||void 0===p?void 0:p.text},chatConfig:a()(a()({},u.chatConfig),{},{t:W,sid:B})}))}else if(t===w.aZD){var m,h,b,x,q,y;s.setFieldsValue({autoPopup:null==K||null===(m=K.serviceSettings)||void 0===m?void 0:m.autoPopup,showInvite:null==K||null===(h=K.inviteSettings)||void 0===h?void 0:h.show,inviteText:null==K||null===(b=K.inviteSettings)||void 0===b?void 0:b.text}),j(a()(a()({},u),{},{autoPopup:null==K||null===(x=K.serviceSettings)||void 0===x?void 0:x.autoPopup,inviteConfig:{show:null==K||null===(q=K.inviteSettings)||void 0===q?void 0:q.show,text:null==K||null===(y=K.inviteSettings)||void 0===y?void 0:y.text},chatConfig:a()(a()({},u.chatConfig),{},{t:W,sid:B})}))}}),[R,I,K,W,B]);var _=function(){var e=r()(o()().mark((function e(i){var s,r,l,u,d,p,m,h,b,x,q,y,S,F,k,U,C,j,M,Z,A,L,W,B,_,N,D,E;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish:",i),t!==w._X4){e.next=11;break}return m=a()(a()({},R),{},{serviceSettings:a()(a()({},R.serviceSettings),{},{autoPopup:i.autoPopup,welcomeFaqUids:null==R||null===(s=R.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==R||null===(r=R.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==R||null===(l=R.serviceSettings)||void 0===l||null===(l=l.quickFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),guessFaqUids:null==R||null===(u=R.serviceSettings)||void 0===u||null===(u=u.guessFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),hotFaqUids:null==R||null===(d=R.serviceSettings)||void 0===d||null===(d=d.hotFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})),shortcutFaqUids:null==R||null===(p=R.serviceSettings)||void 0===p||null===(p=p.shortcutFaqs)||void 0===p?void 0:p.map((function(e){return e.uid}))}),inviteSettings:a()(a()({},R.inviteSettings),{},{show:i.showInvite,text:i.inviteText})}),console.log("robotObject:",m),e.next=6,(0,g.$l)(m);case 6:h=e.sent,console.log("updateRobot response:",h),200===h.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),T(h.data)):(c.yw.destroy(),c.yw.error(h.message)),e.next=29;break;case 11:if(t!==w.Njn){e.next=21;break}return C=a()(a()({},I),{},{serviceSettings:a()(a()({},null==I?void 0:I.serviceSettings),{},{autoPopup:i.autoPopup,welcomeFaqUids:null==I||null===(b=I.serviceSettings)||void 0===b||null===(b=b.faqs)||void 0===b?void 0:b.map((function(e){return e.uid})),faqUids:null==I||null===(x=I.serviceSettings)||void 0===x||null===(x=x.faqs)||void 0===x?void 0:x.map((function(e){return e.uid})),quickFaqUids:null==I||null===(q=I.serviceSettings)||void 0===q||null===(q=q.quickFaqs)||void 0===q?void 0:q.map((function(e){return e.uid})),guessFaqUids:null==I||null===(y=I.serviceSettings)||void 0===y||null===(y=y.guessFaqs)||void 0===y?void 0:y.map((function(e){return e.uid})),hotFaqUids:null==I||null===(S=I.serviceSettings)||void 0===S||null===(S=S.hotFaqs)||void 0===S?void 0:S.map((function(e){return e.uid})),shortcutFaqUids:null==I||null===(F=I.serviceSettings)||void 0===F||null===(F=F.shortcutFaqs)||void 0===F?void 0:F.map((function(e){return e.uid}))}),robotSettings:a()(a()({},I.robotSettings),{},{robotUid:null==I||null===(k=I.robotSettings)||void 0===k||null===(k=k.robot)||void 0===k?void 0:k.uid}),messageLeaveSettings:a()(a()({},I.messageLeaveSettings),{},{worktimeUids:null==I||null===(U=I.messageLeaveSettings)||void 0===U||null===(U=U.worktimes)||void 0===U?void 0:U.map((function(e){return e.uid}))}),autoReplySettings:a()({},I.autoReplySettings),inviteSettings:a()(a()({},I.inviteSettings),{},{show:i.showInvite,text:i.inviteText})}),console.log("agentObject:",C),e.next=16,(0,v.sE)(C);case 16:j=e.sent,console.log("updateAgent response:",j),200===j.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),P(j.data)):(c.yw.destroy(),c.yw.error(j.message)),e.next=29;break;case 21:if(t!==w.aZD){e.next=29;break}return D=a()(a()({},K),{},{serviceSettings:a()(a()({},K.serviceSettings),{},{autoPopup:i.autoPopup,welcomeFaqUids:null==K||null===(M=K.serviceSettings)||void 0===M||null===(M=M.faqs)||void 0===M?void 0:M.map((function(e){return e.uid})),faqUids:null==K||null===(Z=K.serviceSettings)||void 0===Z||null===(Z=Z.faqs)||void 0===Z?void 0:Z.map((function(e){return e.uid})),quickFaqUids:null===(A=K.serviceSettings)||void 0===A||null===(A=A.quickFaqs)||void 0===A?void 0:A.map((function(e){return e.uid})),guessFaqUids:null==K||null===(L=K.serviceSettings)||void 0===L||null===(L=L.guessFaqs)||void 0===L?void 0:L.map((function(e){return e.uid})),hotFaqUids:null==K||null===(W=K.serviceSettings)||void 0===W||null===(W=W.hotFaqs)||void 0===W?void 0:W.map((function(e){return e.uid})),shortcutFaqUids:null==K||null===(B=K.serviceSettings)||void 0===B||null===(B=B.shortcutFaqs)||void 0===B?void 0:B.map((function(e){return e.uid}))}),robotSettings:a()(a()({},K.robotSettings),{},{robotUid:null==K||null===(_=K.robotSettings)||void 0===_||null===(_=_.robot)||void 0===_?void 0:_.uid}),messageLeaveSettings:a()(a()({},K.messageLeaveSettings),{},{worktimeUids:null==K||null===(N=K.messageLeaveSettings)||void 0===N||null===(N=N.worktimes)||void 0===N?void 0:N.map((function(e){return e.uid}))}),inviteSettings:a()(a()({},K.inviteSettings),{},{show:i.showInvite,text:i.inviteText}),agentUids:K.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",D),e.next=26,(0,f.W5)(D);case 26:E=e.sent,console.log("updateWorkGroup response:",E),200===E.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),V(E.data)):(c.yw.destroy(),c.yw.error(E.message));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=r()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleAutoPopChange",t),s.setFieldValue("autoPopup",t),e.prev=2,e.next=5,s.validateFields();case 5:n=e.sent,_(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("验证失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsx)("div",{children:(0,C.jsxs)(b.A,{form:s,onFinish:_,submitter:{render:function(e,t){var i=s.getFieldValue("autoPopup");return(0,C.jsxs)(F.Z,{children:[t,i&&(0,C.jsx)(k.ZP,{color:"danger",variant:"outlined",icon:(0,C.jsx)(U.Z,{}),onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showInviteDialog()},children:n.formatMessage({id:"preview",defaultMessage:"Preview"})})]})}},children:[(0,C.jsx)(x.Z,{width:"md",name:"autoPopup",label:n.formatMessage({id:"autoPopup",defaultMessage:"Auto Popup"}),fieldProps:{onChange:N}}),!1]})})}},69539:function(e,t,n){n(31549)},23635:function(e,t,n){var i=n(90819),o=n.n(i),s=n(73193),r=n.n(s),l=n(89933),a=n.n(l),u=n(45332),d=n.n(u),c=n(86803),v=n(24170),g=n(72614),f=n(1902),p=n(95490),m=n(55735),h=n(65461),w=n(69169),b=n(48708),x=n(30921),q=n(44194),y=n(51990),S=n(66310),F=n(66916),k=n(76750),U=n(31549);t.Z=function(e){var t=e.type,n=(0,x.useIntl)(),i=w.A.useForm(),s=d()(i,1)[0],l=(0,k.Z)().translateString,u=(0,q.useState)(!1),C=d()(u,2),j=(C[0],C[1],(0,q.useState)("")),M=d()(j,2),R=M[0],T=M[1],Z=(0,S.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),I=Z.currentRobot,P=Z.setCurrentRobot,A=(0,f.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),K=A.currentAgent,V=A.setCurrentAgent,L=(0,p.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),W=L.currentWorkgroup,B=L.setCurrentWorkgroup;(0,q.useEffect)((function(){var e,n,i;if(t===m.Njn)s.setFieldValue("showRateBtn",null==K||null===(e=K.serviceSettings)||void 0===e?void 0:e.showRateBtn),s.setFieldValue("autoInviteRate",null==K||null===(n=K.serviceSettings)||void 0===n?void 0:n.autoInviteRate),T(l(null==K||null===(i=K.serviceSettings)||void 0===i?void 0:i.inviteRateTip));else if(t===m.aZD){var o,r,a;s.setFieldValue("showRateBtn",null==W||null===(o=W.serviceSettings)||void 0===o?void 0:o.showRateBtn),s.setFieldValue("autoInviteRate",null==W||null===(r=W.serviceSettings)||void 0===r?void 0:r.autoInviteRate),T(l(null==W||null===(a=W.serviceSettings)||void 0===a?void 0:a.inviteRateTip))}else if(t===m._X4){var u,d,c;s.setFieldValue("showRateBtn",null==I||null===(u=I.serviceSettings)||void 0===u?void 0:u.showRateBtn),s.setFieldValue("autoInviteRate",null==I||null===(d=I.serviceSettings)||void 0===d?void 0:d.autoInviteRate),T(l(null==I||null===(c=I.serviceSettings)||void 0===c?void 0:c.inviteRateTip))}}),[I,K,W]);var _=function(){var e=a()(o()().mark((function e(i){var s,l,a,u,d,f,p,h,w,b,x,q,y,S,k,U,C,j,M,T,Z,A,L,_,N,D,E;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish:",i),t!==m._X4){e.next=11;break}return f=r()(r()({},I),{},{serviceSettings:r()(r()({},I.serviceSettings),{},{showRateBtn:i.showRateBtn,autoInviteRate:i.autoInviteRate,inviteRateTip:R,rateMsgCount:i.rateMsgCount,welcomeFaqUids:null==i?void 0:i.welcomeFaqUids,quickFaqUids:null===(s=K.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==I||null===(l=I.serviceSettings)||void 0===l||null===(l=l.faqs)||void 0===l?void 0:l.map((function(e){return e.uid})),guessFaqUids:null==I||null===(a=I.serviceSettings)||void 0===a||null===(a=a.guessFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),hotFaqUids:null==I||null===(u=I.serviceSettings)||void 0===u||null===(u=u.hotFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),shortcutFaqUids:null==I||null===(d=I.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))})}),console.log("robotObject:",f),e.next=6,(0,F.$l)(f);case 6:p=e.sent,console.log("updateRobot response:",p),200===p.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),P(p.data)):(c.yw.destroy(),c.yw.error(p.message)),e.next=29;break;case 11:if(t!==m.Njn){e.next=21;break}return U=r()(r()({},K),{},{serviceSettings:r()(r()({},null==K?void 0:K.serviceSettings),{},{showRateBtn:i.showRateBtn,autoInviteRate:i.autoInviteRate,inviteRateTip:R,rateMsgCount:i.rateMsgCount,welcomeFaqUids:null==K||null===(h=K.serviceSettings)||void 0===h||null===(h=h.welcomeFaqs)||void 0===h?void 0:h.map((function(e){return e.uid})),quickFaqUids:null==K||null===(w=K.serviceSettings)||void 0===w||null===(w=w.quickFaqs)||void 0===w?void 0:w.map((function(e){return e.uid})),faqUids:null==K||null===(b=K.serviceSettings)||void 0===b||null===(b=b.faqs)||void 0===b?void 0:b.map((function(e){return e.uid})),guessFaqUids:null==K||null===(x=K.serviceSettings)||void 0===x||null===(x=x.guessFaqs)||void 0===x?void 0:x.map((function(e){return e.uid})),hotFaqUids:null==K||null===(q=K.serviceSettings)||void 0===q||null===(q=q.hotFaqs)||void 0===q?void 0:q.map((function(e){return e.uid})),shortcutFaqUids:null==K||null===(y=K.serviceSettings)||void 0===y||null===(y=y.shortcutFaqs)||void 0===y?void 0:y.map((function(e){return e.uid}))}),robotSettings:r()(r()({},K.robotSettings),{},{robotUid:null==K||null===(S=K.robotSettings)||void 0===S||null===(S=S.robot)||void 0===S?void 0:S.uid}),messageLeaveSettings:r()(r()({},K.messageLeaveSettings),{},{worktimeUids:null==K||null===(k=K.messageLeaveSettings)||void 0===k||null===(k=k.worktimes)||void 0===k?void 0:k.map((function(e){return e.uid}))}),autoReplySettings:r()({},K.autoReplySettings)}),console.log("agentObject:",U),e.next=16,(0,v.sE)(U);case 16:C=e.sent,console.log("updateAgent response:",C),200===C.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),V(C.data)):(c.yw.destroy(),c.yw.error(C.message)),e.next=29;break;case 21:if(t!==m.aZD){e.next=29;break}return D=r()(r()({},W),{},{serviceSettings:r()(r()({},W.serviceSettings),{},{showRateBtn:i.showRateBtn,autoInviteRate:i.autoInviteRate,inviteRateTip:R,rateMsgCount:i.rateMsgCount,welcomeFaqUids:null==W||null===(j=W.serviceSettings)||void 0===j||null===(j=j.welcomeFaqs)||void 0===j?void 0:j.map((function(e){return e.uid})),quickFaqUids:null===(M=W.serviceSettings)||void 0===M||null===(M=M.quickFaqs)||void 0===M?void 0:M.map((function(e){return e.uid})),faqUids:null==W||null===(T=W.serviceSettings)||void 0===T||null===(T=T.faqs)||void 0===T?void 0:T.map((function(e){return e.uid})),guessFaqUids:null==W||null===(Z=W.serviceSettings)||void 0===Z||null===(Z=Z.guessFaqs)||void 0===Z?void 0:Z.map((function(e){return e.uid})),hotFaqUids:null===(A=W.serviceSettings)||void 0===A||null===(A=A.hotFaqs)||void 0===A?void 0:A.map((function(e){return e.uid})),shortcutFaqUids:null==W||null===(L=W.serviceSettings)||void 0===L||null===(L=L.shortcutFaqs)||void 0===L?void 0:L.map((function(e){return e.uid}))}),robotSettings:r()(r()({},W.robotSettings),{},{robotUid:null==W||null===(_=W.robotSettings)||void 0===_||null===(_=_.robot)||void 0===_?void 0:_.uid}),messageLeaveSettings:r()(r()({},W.messageLeaveSettings),{},{worktimeUids:null==W||null===(N=W.messageLeaveSettings)||void 0===N||null===(N=N.worktimes)||void 0===N?void 0:N.map((function(e){return e.uid}))}),agentUids:W.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",D),e.next=26,(0,g.W5)(D);case 26:E=e.sent,console.log("updateWorkGroup response:",E),200===E.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),B(E.data)):(c.yw.destroy(),c.yw.error(E.message));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=a()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabFaqs handleChange",t),s.setFieldValue("autoInviteRate",t),e.prev=2,e.next=5,s.validateFields();case 5:n=e.sent,_(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("验证失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,U.jsx)(U.Fragment,{children:(0,U.jsxs)(w.A,{form:s,onFinish:_,style:{marginLeft:"20px"},children:[(0,U.jsx)(b.Z,{width:"md",name:"autoInviteRate",label:n.formatMessage({id:"rate.auto.invite.rate"}),tooltip:n.formatMessage({id:"rate.auto.invite.rate.tooltip"}),fieldProps:{onChange:N}}),(0,U.jsx)(w.A.Item,{name:"inviteRateTip",label:n.formatMessage({id:"rate.auto.invite.rate.tip"}),tooltip:n.formatMessage({id:"rate.auto.invite.rate.tip.tooltip"}),rules:[{required:!0,message:n.formatMessage({id:"rate.auto.invite.rate.tip.required"})}],children:(0,U.jsx)(y.Z,{placeholder:n.formatMessage({id:"rate.auto.invite.rate.tip.placeholder"}),value:R,toolbarKeys:(0,h.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){T(e)}})}),!1]})})}},40836:function(e,t,n){var i=n(90819),o=n.n(i),s=n(89933),r=n.n(s),l=n(73193),a=n.n(l),u=n(45332),d=n.n(u),c=n(86803),v=n(24170),g=n(66916),f=n(72614),p=n(1902),m=n(66310),h=n(95490),w=n(55735),b=n(69169),x=n(48708),q=n(32350),y=n(30921),S=n(44194),F=n(3849),k=n(75365),U=n(11184),C=n(90297),j=n(31549);t.Z=function(e){var t=e.type,n=(0,y.useIntl)(),i=b.A.useForm(),s=d()(i,1)[0],l=(0,U.M)(),u=l.config,M=l.updateConfig,R=(0,m.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),T=R.currentRobot,Z=R.setCurrentRobot,I=(0,p.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),P=I.currentAgent,A=I.setCurrentAgent,K=(0,h.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),V=K.currentWorkgroup,L=K.setCurrentWorkgroup,W=(0,S.useMemo)((function(){return t===w._X4?{chatType:w.xtN,chatSid:T.uid}:t===w.Njn?{chatType:w.scI,chatSid:P.uid}:t===w.aZD?{chatType:w.vPY,chatSid:V.uid}:{chatType:w.xtN,chatSid:""}}),[t,T,P,V]),B=W.chatType,_=W.chatSid;(0,S.useEffect)((function(){if(t===w._X4){var e,n,i=null==T||null===(e=T.serviceSettings)||void 0===e?void 0:e.showRightIframe;s.setFieldsValue({showRightIframe:i,rightIframeUrl:null==T||null===(n=T.serviceSettings)||void 0===n?void 0:n.rightIframeUrl}),M(i?a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:680})}):a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:380})}))}else if(t===w.Njn){var o,r,l=null==P||null===(o=P.serviceSettings)||void 0===o?void 0:o.showRightIframe;s.setFieldsValue({showRightIframe:l,rightIframeUrl:null==P||null===(r=P.serviceSettings)||void 0===r?void 0:r.rightIframeUrl}),M(l?a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:680})}):a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:380})}))}else if(t===w.aZD){var d,c,v=null==V||null===(d=V.serviceSettings)||void 0===d?void 0:d.showRightIframe;s.setFieldsValue({showRightIframe:v,rightIframeUrl:null==V||null===(c=V.serviceSettings)||void 0===c?void 0:c.rightIframeUrl}),M(v?a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:680})}):a()(a()({},u),{},{chatConfig:a()(a()({},u.chatConfig),{},{t:B,sid:_}),window:a()(a()({},u.window),{},{width:380})}))}}),[T,P,V,B,_]);var N=function(){var e=r()(o()().mark((function e(i){var s,r,l,u,d,p,m,h,b,x,q,y,S,F,k,U,C,j,M,R,I,K,W,B,_,N,D,E,O;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFinish:",i),t!==w._X4){e.next=11;break}return m=a()(a()({},T),{},{serviceSettings:a()(a()({},T.serviceSettings),{},{showRightIframe:i.showRightIframe,rightIframeUrl:i.rightIframeUrl,welcomeFaqUids:null==T||null===(s=T.serviceSettings)||void 0===s||null===(s=s.welcomeFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==T||null===(r=T.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==T||null===(l=T.serviceSettings)||void 0===l||null===(l=l.quickFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),guessFaqUids:null==T||null===(u=T.serviceSettings)||void 0===u||null===(u=u.guessFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),hotFaqUids:null==T||null===(d=T.serviceSettings)||void 0===d||null===(d=d.hotFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})),shortcutFaqUids:null==T||null===(p=T.serviceSettings)||void 0===p||null===(p=p.shortcutFaqs)||void 0===p?void 0:p.map((function(e){return e.uid}))})}),console.log("robotObject:",m),e.next=6,(0,g.$l)(m);case 6:h=e.sent,console.log("updateRobot response:",h),200===h.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),Z(h.data)):(c.yw.destroy(),c.yw.error(h.message)),e.next=29;break;case 11:if(t!==w.Njn){e.next=21;break}return C=a()(a()({},P),{},{serviceSettings:a()(a()({},null==P?void 0:P.serviceSettings),{},{showRightIframe:i.showRightIframe,rightIframeUrl:i.rightIframeUrl,welcomeFaqUids:null==P||null===(b=P.serviceSettings)||void 0===b||null===(b=b.welcomeFaqs)||void 0===b?void 0:b.map((function(e){return e.uid})),faqUids:null==P||null===(x=P.serviceSettings)||void 0===x||null===(x=x.faqs)||void 0===x?void 0:x.map((function(e){return e.uid})),quickFaqUids:null==P||null===(q=P.serviceSettings)||void 0===q||null===(q=q.quickFaqs)||void 0===q?void 0:q.map((function(e){return e.uid})),guessFaqUids:null==P||null===(y=P.serviceSettings)||void 0===y||null===(y=y.guessFaqs)||void 0===y?void 0:y.map((function(e){return e.uid})),hotFaqUids:null==P||null===(S=P.serviceSettings)||void 0===S||null===(S=S.hotFaqs)||void 0===S?void 0:S.map((function(e){return e.uid})),shortcutFaqUids:null==P||null===(F=P.serviceSettings)||void 0===F||null===(F=F.shortcutFaqs)||void 0===F?void 0:F.map((function(e){return e.uid}))}),robotSettings:a()(a()({},P.robotSettings),{},{robotUid:null==P||null===(k=P.robotSettings)||void 0===k||null===(k=k.robot)||void 0===k?void 0:k.uid}),messageLeaveSettings:a()(a()({},P.messageLeaveSettings),{},{worktimeUids:null==P||null===(U=P.messageLeaveSettings)||void 0===U||null===(U=U.worktimes)||void 0===U?void 0:U.map((function(e){return e.uid}))}),autoReplySettings:a()({},P.autoReplySettings)}),console.log("agentObject:",C),e.next=16,(0,v.sE)(C);case 16:j=e.sent,console.log("updateAgent response:",j),200===j.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),A(j.data)):(c.yw.destroy(),c.yw.error(j.message)),e.next=29;break;case 21:if(t!==w.aZD){e.next=29;break}return E=a()(a()({},V),{},{serviceSettings:a()(a()({},V.serviceSettings),{},{showRightIframe:i.showRightIframe,rightIframeUrl:i.rightIframeUrl,welcomeFaqUids:null==V||null===(M=V.serviceSettings)||void 0===M||null===(M=M.welcomeFaqs)||void 0===M?void 0:M.map((function(e){return e.uid})),faqUids:null==V||null===(R=V.serviceSettings)||void 0===R||null===(R=R.faqs)||void 0===R?void 0:R.map((function(e){return e.uid})),quickFaqUids:null==V||null===(I=V.serviceSettings)||void 0===I||null===(I=I.quickFaqs)||void 0===I?void 0:I.map((function(e){return e.uid})),guessFaqUids:null==V||null===(K=V.serviceSettings)||void 0===K||null===(K=K.guessFaqs)||void 0===K?void 0:K.map((function(e){return e.uid})),hotFaqUids:null==V||null===(W=V.serviceSettings)||void 0===W||null===(W=W.hotFaqs)||void 0===W?void 0:W.map((function(e){return e.uid})),shortcutFaqUids:null==V||null===(B=V.serviceSettings)||void 0===B||null===(B=B.shortcutFaqs)||void 0===B?void 0:B.map((function(e){return e.uid}))}),robotSettings:a()(a()({},V.robotSettings),{},{robotUid:null==V||null===(_=V.robotSettings)||void 0===_||null===(_=_.robot)||void 0===_?void 0:_.uid}),messageLeaveSettings:a()(a()({},V.messageLeaveSettings),{},{worktimeUids:null==V||null===(N=V.messageLeaveSettings)||void 0===N||null===(N=N.worktimes)||void 0===N?void 0:N.map((function(e){return e.uid}))}),agentUids:null==V||null===(D=V.agents)||void 0===D?void 0:D.map((function(e){return e.uid}))}),console.log("workgroupObject:",E),e.next=26,(0,f.W5)(E);case 26:O=e.sent,console.log("updateWorkGroup response:",O),200===O.code?(c.yw.destroy(),c.yw.success(n.formatMessage({id:"update.success"})),L(O.data)):(c.yw.destroy(),c.yw.error(O.message));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=r()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TabFaqs handleChange",t),s.setFieldValue("showRightIframe",t),e.prev=2,e.next=5,s.validateFields();case 5:n=e.sent,N(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("验证失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,j.jsx)("div",{children:(0,j.jsxs)(b.A,{form:s,onFinish:N,submitter:{render:function(e,t){return(0,j.jsxs)(F.Z,{children:[t,(0,j.jsx)(k.ZP,{color:"danger",variant:"outlined",icon:(0,j.jsx)(C.Z,{}),onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:n.formatMessage({id:"preview",defaultMessage:"Preview"})})]})}},children:[(0,j.jsx)(x.Z,{width:"md",name:"showRightIframe",label:n.formatMessage({id:"showRightIframe"}),fieldProps:{onChange:D}}),(0,j.jsx)(q.Z,{width:"md",name:"rightIframeUrl",label:n.formatMessage({id:"rightIframeUrl"}),placeholder:n.formatMessage({id:"rightIframeUrl.placeholder",defaultMessage:"请输入有效的URL地址"}),rules:[{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w.-]*)*\/?$/,message:n.formatMessage({id:"rightIframeUrl.invalid",defaultMessage:"请输入有效的URL地址"})}]})]})})}},14238:function(e,t,n){var i=n(73193),o=n.n(i),s=n(90819),r=n.n(s),l=n(89933),a=n.n(l),u=n(45332),d=n.n(u),c=n(86803),v=n(24170),g=n(66916),f=n(72614),p=n(76750),m=n(1902),h=n(66310),w=n(95490),b=n(55735),x=n(69169),q=n(85954),y=n(84881),S=n(79907),F=n(30921),k=n(44194),U=n(51990),C=n(65461),j=n(40612),M=n(99885),R=n(27522),T=n(31549);t.Z=function(e){var t,n,i=e.type,s=x.A.useForm(),l=d()(s,1)[0],u=(0,F.useIntl)(),Z=(0,p.Z)().translateString,I=(0,k.useState)(!1),P=d()(I,2),A=P[0],K=P[1],V=(0,j.u)((function(e){return e.currentOrg})),L=(0,k.useState)(),W=d()(L,2),B=W[0],_=W[1],N=(0,k.useState)(),D=d()(N,2),E=D[0],O=D[1],X=(0,k.useState)(),z=d()(X,2),Q=z[0],$=z[1],G=(0,h.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),H=G.currentRobot,Y=G.setCurrentRobot,J=(0,m.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),ee=J.currentAgent,te=J.setCurrentAgent,ne=(0,w.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),ie=ne.currentWorkgroup,oe=ne.setCurrentWorkgroup,se=(0,k.useState)(""),re=d()(se,2),le=re[0],ae=re[1],ue=(0,k.useState)(""),de=d()(ue,2),ce=de[0],ve=de[1],ge=(0,k.useState)(""),fe=d()(ge,2),pe=fe[0],me=fe[1],he=(0,k.useState)(""),we=d()(he,2),be=we[0],xe=we[1],qe=(0,k.useState)(""),ye=d()(qe,2),Se=ye[0],Fe=ye[1],ke=function(){var e=a()(r()().mark((function e(){var t,n,o,s,a,d;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:b.QPQ,orgUid:null==V?void 0:V.uid},e.next=4,(0,R.AP)(t);case 4:n=e.sent,console.log("getKbases response:",t,n),c.yw.destroy(),200===n.code?(O(n),i===b._X4&&null!=H&&null!==(o=H.serviceSettings)&&void 0!==o&&o.welcomeKbUid?($(H.serviceSettings.welcomeKbUid),l.setFieldValue("welcomeKbUid",H.serviceSettings.welcomeKbUid),Ue(H.serviceSettings.welcomeKbUid)):i===b.Njn&&null!=ee&&null!==(s=ee.serviceSettings)&&void 0!==s&&s.welcomeKbUid?($(ee.serviceSettings.welcomeKbUid),l.setFieldValue("welcomeKbUid",ee.serviceSettings.welcomeKbUid),Ue(ee.serviceSettings.welcomeKbUid)):i===b.aZD&&null!=ie&&null!==(a=ie.serviceSettings)&&void 0!==a&&a.welcomeKbUid?($(ie.serviceSettings.welcomeKbUid),l.setFieldValue("welcomeKbUid",ie.serviceSettings.welcomeKbUid),Ue(ie.serviceSettings.welcomeKbUid)):(null===(d=n.data)||void 0===d||null===(d=d.content)||void 0===d?void 0:d.length)>0&&($(n.data.content[0].uid),l.setFieldValue("welcomeKbUid",n.data.content[0].uid),Ue(n.data.content[0].uid))):c.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ue=function(){var e=a()(r()().mark((function e(t){var n,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,orgUid:null==V?void 0:V.uid,kbUid:t||Q},e.next=4,(0,M.pf)(n);case 4:i=e.sent,console.log("getFaqs response:",n,i),c.yw.destroy(),200===i.code?_(i):c.yw.error(i.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,k.useEffect)((function(){ke()}),[]);var Ce=function(e){if(console.log("setFormValues:",e),ae(Z(null==e?void 0:e.welcomeTip)),me(Z(null==e?void 0:e.topTip)),xe(Z(null==e?void 0:e.agentCloseTip)),Fe(Z(null==e?void 0:e.autoCloseTip)),K(null==e?void 0:e.showTopTip),l.setFieldValue("showTopTip",null==e?void 0:e.showTopTip),l.setFieldValue("autoCloseMin",null==e?void 0:e.autoCloseMin),l.setFieldValue("showLogo",null==e?void 0:e.showLogo),null!=e&&e.welcomeKbUid&&(l.setFieldValue("welcomeKbUid",null==e?void 0:e.welcomeKbUid),Ue(null==e?void 0:e.welcomeKbUid)),null!=e&&e.welcomeFaqs&&(null==e?void 0:e.welcomeFaqs.length)>0){var t=e.welcomeFaqs.map((function(e){return e.uid}));console.log("从welcomeFaqs提取uid初始化:",t),l.setFieldValue("welcomeFaqUids",t)}else console.log("设置welcomeFaqUids为空数组"),l.setFieldValue("welcomeFaqUids",[]);if(i===b._X4);else if(i===b.Njn){var n;ve(Z(null==ee||null===(n=ee.messageLeaveSettings)||void 0===n?void 0:n.messageLeaveTip)),l.setFieldValue("maxThreadCount",null==ee?void 0:ee.maxThreadCount),l.setFieldValue("timeoutRemindTime",null==ee?void 0:ee.timeoutRemindTime)}else if(i===b.aZD){var o;ve(Z(null==ie||null===(o=ie.messageLeaveSettings)||void 0===o?void 0:o.messageLeaveTip))}};(0,k.useEffect)((function(){i===b._X4?null!=H&&H.serviceSettings&&(console.log("初始化机器人设置:",H.serviceSettings),Ce(H.serviceSettings)):i===b.Njn?null!=ee&&ee.serviceSettings&&(console.log("初始化客服设置:",ee.serviceSettings),Ce(ee.serviceSettings),l.setFieldValue("maxThreadCount",null==ee?void 0:ee.maxThreadCount)):i===b.aZD&&null!=ie&&ie.serviceSettings&&(console.log("初始化工作组设置:",ie.serviceSettings),Ce(ie.serviceSettings))}),[H,ee,ie]);var je=function(){var e=a()(r()().mark((function e(t){var n,s,l,a,d,p,m,h,w,x,q,y,S,F,k,U,C,j,M,R,T,Z,I,P,K;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("表单提交的值:",t),c.yw.loading(u.formatMessage({id:"updating"})),i!==b._X4){e.next=12;break}return p=o()(o()({},H),{},{serviceSettings:o()(o()({},H.serviceSettings),{},{topTip:pe,showTopTip:A,welcomeTip:le,autoCloseTip:Se,autoCloseMin:(null==t?void 0:t.autoCloseMin)||25,showLogo:(null==t?void 0:t.showLogo)||!0,welcomeKbUid:null==t?void 0:t.welcomeKbUid,welcomeFaqUids:(null==t?void 0:t.welcomeFaqUids)||[],quickFaqUids:(null===(n=H.serviceSettings)||void 0===n||null===(n=n.quickFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})))||[],faqUids:(null==H||null===(s=H.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})))||[],guessFaqUids:(null==H||null===(l=H.serviceSettings)||void 0===l||null===(l=l.guessFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})))||[],hotFaqUids:(null==H||null===(a=H.serviceSettings)||void 0===a||null===(a=a.hotFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[],shortcutFaqUids:(null==H||null===(d=H.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})))||[]})}),console.log("提交的机器人对象:",p),e.next=7,(0,g.$l)(p);case 7:m=e.sent,console.log("updateRobot response:",m),200===m.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),Y(m.data)):(c.yw.destroy(),c.yw.error(m.message)),e.next=30;break;case 12:if(i!==b.Njn){e.next=22;break}return k=o()(o()({},ee),{},{serviceSettings:o()(o()({},ee.serviceSettings),{},{topTip:pe,showTopTip:A,welcomeTip:le,agentCloseTip:be,autoCloseTip:Se,autoCloseMin:(null==t?void 0:t.autoCloseMin)||25,showLogo:(null==t?void 0:t.showLogo)||!0,welcomeKbUid:null==t?void 0:t.welcomeKbUid,welcomeFaqUids:null==t?void 0:t.welcomeFaqUids,quickFaqUids:null===(h=ee.serviceSettings)||void 0===h||null===(h=h.quickFaqs)||void 0===h?void 0:h.map((function(e){return e.uid})),faqUids:null===(w=ee.serviceSettings)||void 0===w||null===(w=w.faqs)||void 0===w?void 0:w.map((function(e){return e.uid})),guessFaqUids:null==ee||null===(x=ee.serviceSettings)||void 0===x||null===(x=x.guessFaqs)||void 0===x?void 0:x.map((function(e){return e.uid})),hotFaqUids:null==ee||null===(q=ee.serviceSettings)||void 0===q||null===(q=q.hotFaqs)||void 0===q?void 0:q.map((function(e){return e.uid})),shortcutFaqUids:null==ee||null===(y=ee.serviceSettings)||void 0===y||null===(y=y.shortcutFaqs)||void 0===y?void 0:y.map((function(e){return e.uid}))}),messageLeaveSettings:o()(o()({},ee.messageLeaveSettings),{},{messageLeaveTip:ce,worktimeUids:null===(S=ee.messageLeaveSettings)||void 0===S||null===(S=S.worktimes)||void 0===S?void 0:S.map((function(e){return e.uid}))}),robotSettings:o()(o()({},ee.robotSettings),{},{robotUid:null===(F=ee.robotSettings)||void 0===F||null===(F=F.robot)||void 0===F?void 0:F.uid}),maxThreadCount:(null==t?void 0:t.maxThreadCount)||10,timeoutRemindTime:(null==t?void 0:t.timeoutRemindTime)||5}),console.log("agentObject:",k),e.next=17,(0,v.sE)(k);case 17:U=e.sent,console.log("updateAgent response:",U),200===U.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),te(U.data)):(c.yw.destroy(),c.yw.error(U.message)),e.next=30;break;case 22:if(i!==b.aZD){e.next=30;break}return P=o()(o()({},ie),{},{serviceSettings:o()(o()({},ie.serviceSettings),{},{topTip:pe,showTopTip:A,welcomeTip:le,agentCloseTip:be,autoCloseTip:Se,autoCloseMin:(null==t?void 0:t.autoCloseMin)||25,showLogo:(null==t?void 0:t.showLogo)||!0,welcomeKbUid:null==t?void 0:t.welcomeKbUid,welcomeFaqUids:null==t?void 0:t.welcomeFaqUids,quickFaqUids:null===(C=ie.serviceSettings)||void 0===C||null===(C=C.quickFaqs)||void 0===C?void 0:C.map((function(e){return e.uid})),faqUids:null===(j=ie.serviceSettings)||void 0===j||null===(j=j.faqs)||void 0===j?void 0:j.map((function(e){return e.uid})),guessFaqUids:null==ie||null===(M=ie.serviceSettings)||void 0===M||null===(M=M.guessFaqs)||void 0===M?void 0:M.map((function(e){return e.uid})),hotFaqUids:null==ie||null===(R=ie.serviceSettings)||void 0===R||null===(R=R.hotFaqs)||void 0===R?void 0:R.map((function(e){return e.uid})),shortcutFaqUids:null==ie||null===(T=ie.serviceSettings)||void 0===T||null===(T=T.shortcutFaqs)||void 0===T?void 0:T.map((function(e){return e.uid}))}),messageLeaveSettings:o()(o()({},ie.messageLeaveSettings),{},{messageLeaveTip:ce,worktimeUids:null===(Z=ie.messageLeaveSettings)||void 0===Z||null===(Z=Z.worktimes)||void 0===Z?void 0:Z.map((function(e){return e.uid}))}),robotSettings:o()(o()({},ie.robotSettings),{},{robotUid:null===(I=ie.robotSettings)||void 0===I||null===(I=I.robot)||void 0===I?void 0:I.uid}),agentUids:ie.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",P),e.next=27,(0,f.W5)(P);case 27:K=e.sent,console.log("updateWorkGroup response:",K),200===K.code?(c.yw.destroy(),c.yw.success(u.formatMessage({id:"update.success"})),oe(K.data)):(c.yw.destroy(),c.yw.error(K.message));case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,T.jsxs)(x.A,{form:l,onFinish:je,style:{marginLeft:"20px"},children:[(0,T.jsx)(q.Z,{name:"showTopTip",width:"md",label:u.formatMessage({id:"agent.settings.show.top.tip"}),fieldProps:{onChange:function(e){var t,n;if(console.log("checked = ".concat(e.target.checked,", showTopTip:").concat(null==ee||null===(t=ee.serviceSettings)||void 0===t?void 0:t.showTopTip)),K(e.target.checked),e.target.checked)if(i===b._X4)me(Z(null==H||null===(n=H.serviceSettings)||void 0===n?void 0:n.topTip));else if(i===b.Njn){var o;me(Z(null==ee||null===(o=ee.serviceSettings)||void 0===o?void 0:o.topTip))}else if(i===b.aZD){var s;me(Z(null==ie||null===(s=ie.serviceSettings)||void 0===s?void 0:s.topTip))}}}}),A&&(0,T.jsx)(x.A.Item,{name:"topTip",label:u.formatMessage({id:"agent.settings.top.tip"}),rules:[{required:!0,message:u.formatMessage({id:"agent.settings.top.tip.required"})}],children:(0,T.jsx)(U.Z,{placeholder:u.formatMessage({id:"agent.settings.top.tip.placeholder"}),value:pe,toolbarKeys:(0,C.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){me(e)}})}),(0,T.jsx)(x.A.Item,{name:"welcomeTip",label:u.formatMessage({id:"agent.settings.welcome.tip"}),tooltip:u.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:u.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,T.jsx)(U.Z,{placeholder:u.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:le,toolbarKeys:(0,C.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){ae(e)}})}),(0,T.jsx)(y.Z,{name:"welcomeKbUid",width:"md",label:u.formatMessage({id:"menu.kbase.select",defaultMessage:"选择知识库"}),options:null==E||null===(t=E.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{label:Z(e.name),value:e.uid}})),fieldProps:{onChange:function(e){console.log("selected kbase:",e),$(e),Ue(e)},allowClear:!0,placeholder:(0,T.jsx)(F.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,T.jsx)(y.Z,{name:"welcomeFaqUids",width:"md",label:u.formatMessage({id:"menu.kbase.faq.welcome"}),options:null==B||null===(n=B.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:Z(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,T.jsx)(F.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),i!=b._X4&&(0,T.jsx)(x.A.Item,{name:"messageLeaveTip",label:u.formatMessage({id:"agent.settings.leave.msg"}),rules:[{required:!0,message:u.formatMessage({id:"agent.settings.leave.msg.required"})}],children:(0,T.jsx)(U.Z,{placeholder:u.formatMessage({id:"agent.settings.leave.msg.placeholder"}),value:ce,toolbarKeys:(0,C.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){ve(e)}})}),i!=b._X4&&(0,T.jsx)(x.A.Item,{name:"agentCloseTip",label:u.formatMessage({id:"agent.settings.agent.close.tip"}),tooltip:u.formatMessage({id:"agent.settings.agent.close.tip.tooltip"}),rules:[{required:!0,message:u.formatMessage({id:"agent.settings.agent.close.tip.required"})}],children:(0,T.jsx)(U.Z,{placeholder:u.formatMessage({id:"agent.settings.agent.close.tip.placeholder"}),value:be,toolbarKeys:(0,C.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){xe(e)}})}),(0,T.jsx)(x.A.Item,{name:"autoCloseTip",label:u.formatMessage({id:"agent.settings.auto.close.tip"}),tooltip:u.formatMessage({id:"agent.settings.auto.close.tip.tooltip"}),rules:[{required:!0,message:u.formatMessage({id:"agent.settings.auto.close.tip.required"})}],children:(0,T.jsx)(U.Z,{placeholder:u.formatMessage({id:"agent.settings.auto.close.tip.placeholder"}),value:Se,toolbarKeys:(0,C.eD)(),style:{height:"200px",width:"600px"},maxLength:200,onChange:function(e){Fe(e)}})}),i===b.Njn&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("p",{children:u.formatMessage({id:"agent.settings.max.thread.tip1"})}),(0,T.jsx)("p",{children:u.formatMessage({id:"agent.settings.max.thread.tip2"})}),(0,T.jsx)("p",{children:u.formatMessage({id:"agent.settings.max.thread.tip3"})}),(0,T.jsx)(S.Z,{width:"md",name:"maxThreadCount",label:u.formatMessage({id:"agent.settings.max.thread"}),min:0}),(0,T.jsx)(S.Z,{width:"md",name:"timeoutRemindTime",label:u.formatMessage({id:"agent.settings.timeout.remind",defaultMessage:"超时提醒时间"}),tooltip:u.formatMessage({id:"agent.settings.timeout.remind.tooltip",defaultMessage:"超过设定时间未回复客户将收到提醒"}),min:1,fieldProps:{addonAfter:u.formatMessage({id:"time.minute",defaultMessage:"分钟"})}})]}),(0,T.jsx)(S.Z,{width:"md",name:"autoCloseMin",label:u.formatMessage({id:"agent.settings.auto.close.time"}),tooltip:u.formatMessage({id:"agent.settings.auto.close.time.tooltip"}),min:1}),(0,T.jsx)(q.Z,{name:"showLogo",width:"md",label:u.formatMessage({id:"agent.settings.show.logo"}),tooltip:u.formatMessage({id:"agent.settings.show.logo.tooltip"}),fieldProps:{onChange:function(e){console.log("onShowLogoChange = ".concat(e.target.checked))}},disabled:!0})]})}},98473:function(e,t,n){var i=n(76711),o=n.n(i),s=n(90819),r=n.n(s),l=n(73193),a=n.n(l),u=n(89933),d=n.n(u),c=n(45332),v=n.n(c),g=n(86803),f=n(24170),p=n(66916),m=n(72614),h=n(1902),w=n(66310),b=n(95490),x=n(55735),q=n(69169),y=n(48708),S=n(32350),F=n(79907),k=n(30921),U=n(44194),C=n(32327),j=n(71738),M=n(44781),R=n(57178),T=n(78819),Z=n(52288),I=(n(29266),n(3849),n(75365),n(62673)),P=n(38775),A=n(53530),K=(n(59304),n(54881),n(31549)),V=(C.Z.Text,j.Z.Panel,M.Z.Option),L="no_response",W="keyword_match",B="visit_count",_="page_stay",N="time_range",D=[{label:"无响应触发",value:L}];t.Z=function(e){var t=e.type,n=(0,k.useIntl)(),i=q.A.useForm(),s=v()(i,1)[0],l=(0,U.useState)([]),u=v()(l,2),c=u[0],C=u[1],j=(0,U.useState)(!1),E=v()(j,2),O=E[0],X=E[1],z=(0,U.useState)(null),Q=v()(z,2),$=(Q[0],Q[1],R.Z.useForm()),G=v()($,1)[0],H=(0,U.useState)(null),Y=v()(H,2),J=Y[0],ee=(Y[1],(0,w.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}}))),te=ee.currentRobot,ne=ee.setCurrentRobot,ie=(0,h.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),oe=ie.currentAgent,se=ie.setCurrentAgent,re=(0,b.$)((function(e){return{currentWorkgroup:e.currentWorkgroup,setCurrentWorkgroup:e.setCurrentWorkgroup}})),le=re.currentWorkgroup,ae=re.setCurrentWorkgroup,ue=(0,U.useMemo)((function(){return t===x._X4?{chatType:x.xtN,chatSid:te.uid}:t===x.Njn?{chatType:x.scI,chatSid:oe.uid}:t===x.aZD?{chatType:x.vPY,chatSid:le.uid}:{chatType:x.xtN,chatSid:""}}),[t,te,oe,le]),de=ue.chatType,ce=ue.chatSid;(0,U.useEffect)((function(){if(t===x._X4){var e,n,i,o,r,l,a,u,d,c,v,g=null!=te&&null!==(e=te.serviceSettings)&&void 0!==e&&e.triggerConditions&&(null===(n=JSON.parse(null==te||null===(i=te.serviceSettings)||void 0===i?void 0:i.triggerConditions))||void 0===n?void 0:n.conditions)||[];s.setFieldsValue({autoPopup:null==te||null===(o=te.serviceSettings)||void 0===o?void 0:o.autoPopup,showInvite:null==te||null===(r=te.inviteSettings)||void 0===r?void 0:r.show,inviteText:null==te||null===(l=te.inviteSettings)||void 0===l?void 0:l.text,enableProactiveTrigger:null==te||null===(a=te.serviceSettings)||void 0===a?void 0:a.enableProactiveTrigger,noResponseTimeout:(null==te||null===(u=te.serviceSettings)||void 0===u?void 0:u.noResponseTimeout)||300,proactiveMessage:null==te||null===(d=te.serviceSettings)||void 0===d?void 0:d.proactiveMessage,maxProactiveCount:(null==te||null===(c=te.serviceSettings)||void 0===c?void 0:c.maxProactiveCount)||3,proactiveInterval:(null==te||null===(v=te.serviceSettings)||void 0===v?void 0:v.proactiveInterval)||600}),C(g)}else if(t===x.Njn){var f,p,m,h,w,b,q,y,S,F,k,U=null!=oe&&null!==(f=oe.serviceSettings)&&void 0!==f&&f.triggerConditions&&(null===(p=JSON.parse(null==oe||null===(m=oe.serviceSettings)||void 0===m?void 0:m.triggerConditions))||void 0===p?void 0:p.conditions)||[];s.setFieldsValue({autoPopup:null==oe||null===(h=oe.serviceSettings)||void 0===h?void 0:h.autoPopup,showInvite:null==oe||null===(w=oe.inviteSettings)||void 0===w?void 0:w.show,inviteText:null==oe||null===(b=oe.inviteSettings)||void 0===b?void 0:b.text,enableProactiveTrigger:null==oe||null===(q=oe.serviceSettings)||void 0===q?void 0:q.enableProactiveTrigger,noResponseTimeout:(null==oe||null===(y=oe.serviceSettings)||void 0===y?void 0:y.noResponseTimeout)||300,proactiveMessage:null==oe||null===(S=oe.serviceSettings)||void 0===S?void 0:S.proactiveMessage,maxProactiveCount:(null==oe||null===(F=oe.serviceSettings)||void 0===F?void 0:F.maxProactiveCount)||3,proactiveInterval:(null==oe||null===(k=oe.serviceSettings)||void 0===k?void 0:k.proactiveInterval)||600}),C(U)}else if(t===x.aZD){var j,M,R,T,Z,I,P,A,K,V,L,W=null!=le&&null!==(j=le.serviceSettings)&&void 0!==j&&j.triggerConditions&&(null===(M=JSON.parse(null==le||null===(R=le.serviceSettings)||void 0===R?void 0:R.triggerConditions))||void 0===M?void 0:M.conditions)||[];s.setFieldsValue({autoPopup:null==le||null===(T=le.serviceSettings)||void 0===T?void 0:T.autoPopup,showInvite:null==le||null===(Z=le.inviteSettings)||void 0===Z?void 0:Z.show,inviteText:null==le||null===(I=le.inviteSettings)||void 0===I?void 0:I.text,enableProactiveTrigger:null==le||null===(P=le.serviceSettings)||void 0===P?void 0:P.enableProactiveTrigger,noResponseTimeout:(null==le||null===(A=le.serviceSettings)||void 0===A?void 0:A.noResponseTimeout)||300,proactiveMessage:null==le||null===(K=le.serviceSettings)||void 0===K?void 0:K.proactiveMessage,maxProactiveCount:(null==le||null===(V=le.serviceSettings)||void 0===V?void 0:V.maxProactiveCount)||3,proactiveInterval:(null==le||null===(L=le.serviceSettings)||void 0===L?void 0:L.proactiveInterval)||600}),C(W)}}),[te,oe,le,de,ce]);var ve=function(){var e=d()(r()().mark((function e(i){var o,s,l,u,d,v,h,w,b,q,y,S,F,k,U,C,j,M,R,T,Z,I,P,A,K,V,L,W,B;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handlePreFormSubmit:",i),o=JSON.stringify({conditions:c}),t!==x._X4){e.next=12;break}return w=a()(a()({},te),{},{serviceSettings:a()(a()({},te.serviceSettings),{},{autoPopup:i.autoPopup,enableProactiveTrigger:i.enableProactiveTrigger,noResponseTimeout:i.noResponseTimeout,proactiveMessage:i.proactiveMessage,maxProactiveCount:i.maxProactiveCount,proactiveInterval:i.proactiveInterval,triggerConditions:o,welcomeFaqUids:null==te||null===(s=te.serviceSettings)||void 0===s||null===(s=s.welcomeFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==te||null===(l=te.serviceSettings)||void 0===l||null===(l=l.faqs)||void 0===l?void 0:l.map((function(e){return e.uid})),quickFaqUids:null==te||null===(u=te.serviceSettings)||void 0===u||null===(u=u.quickFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),guessFaqUids:null==te||null===(d=te.serviceSettings)||void 0===d||null===(d=d.guessFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})),hotFaqUids:null==te||null===(v=te.serviceSettings)||void 0===v||null===(v=v.hotFaqs)||void 0===v?void 0:v.map((function(e){return e.uid})),shortcutFaqUids:null==te||null===(h=te.serviceSettings)||void 0===h||null===(h=h.shortcutFaqs)||void 0===h?void 0:h.map((function(e){return e.uid}))}),inviteSettings:a()(a()({},te.inviteSettings),{},{show:i.showInvite,text:i.inviteText})}),console.log("robotObject:",w),e.next=7,(0,p.$l)(w);case 7:b=e.sent,console.log("updateRobot response:",b),200===b.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success"})),ne(b.data)):(g.yw.destroy(),g.yw.error(b.message)),e.next=30;break;case 12:if(t!==x.Njn){e.next=22;break}return M=a()(a()({},oe),{},{serviceSettings:a()(a()({},null==oe?void 0:oe.serviceSettings),{},{autoPopup:i.autoPopup,enableProactiveTrigger:i.enableProactiveTrigger,noResponseTimeout:i.noResponseTimeout,proactiveMessage:i.proactiveMessage,maxProactiveCount:i.maxProactiveCount,proactiveInterval:i.proactiveInterval,triggerConditions:o,welcomeFaqUids:null==oe||null===(q=oe.serviceSettings)||void 0===q||null===(q=q.welcomeFaqs)||void 0===q?void 0:q.map((function(e){return e.uid})),faqUids:null==oe||null===(y=oe.serviceSettings)||void 0===y||null===(y=y.faqs)||void 0===y?void 0:y.map((function(e){return e.uid})),quickFaqUids:null==oe||null===(S=oe.serviceSettings)||void 0===S||null===(S=S.quickFaqs)||void 0===S?void 0:S.map((function(e){return e.uid})),guessFaqUids:null==oe||null===(F=oe.serviceSettings)||void 0===F||null===(F=F.guessFaqs)||void 0===F?void 0:F.map((function(e){return e.uid})),hotFaqUids:null==oe||null===(k=oe.serviceSettings)||void 0===k||null===(k=k.hotFaqs)||void 0===k?void 0:k.map((function(e){return e.uid})),shortcutFaqUids:null==oe||null===(U=oe.serviceSettings)||void 0===U||null===(U=U.shortcutFaqs)||void 0===U?void 0:U.map((function(e){return e.uid}))}),robotSettings:a()(a()({},oe.robotSettings),{},{robotUid:null==oe||null===(C=oe.robotSettings)||void 0===C||null===(C=C.robot)||void 0===C?void 0:C.uid}),messageLeaveSettings:a()(a()({},oe.messageLeaveSettings),{},{worktimeUids:null==oe||null===(j=oe.messageLeaveSettings)||void 0===j||null===(j=j.worktimes)||void 0===j?void 0:j.map((function(e){return e.uid}))}),autoReplySettings:a()({},oe.autoReplySettings),inviteSettings:a()(a()({},oe.inviteSettings),{},{show:i.showInvite,text:i.inviteText})}),console.log("agentObject:",M),e.next=17,(0,f.sE)(M);case 17:R=e.sent,console.log("updateAgent response:",R),200===R.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success"})),se(R.data)):(g.yw.destroy(),g.yw.error(R.message)),e.next=30;break;case 22:if(t!==x.aZD){e.next=30;break}return W=a()(a()({},le),{},{serviceSettings:a()(a()({},le.serviceSettings),{},{autoPopup:i.autoPopup,enableProactiveTrigger:i.enableProactiveTrigger,noResponseTimeout:i.noResponseTimeout,proactiveMessage:i.proactiveMessage,maxProactiveCount:i.maxProactiveCount,proactiveInterval:i.proactiveInterval,triggerConditions:o,welcomeFaqUids:null==le||null===(T=le.serviceSettings)||void 0===T||null===(T=T.welcomeFaqs)||void 0===T?void 0:T.map((function(e){return e.uid})),faqUids:null==le||null===(Z=le.serviceSettings)||void 0===Z||null===(Z=Z.faqs)||void 0===Z?void 0:Z.map((function(e){return e.uid})),quickFaqUids:null===(I=le.serviceSettings)||void 0===I||null===(I=I.quickFaqs)||void 0===I?void 0:I.map((function(e){return e.uid})),guessFaqUids:null==le||null===(P=le.serviceSettings)||void 0===P||null===(P=P.guessFaqs)||void 0===P?void 0:P.map((function(e){return e.uid})),hotFaqUids:null==le||null===(A=le.serviceSettings)||void 0===A||null===(A=A.hotFaqs)||void 0===A?void 0:A.map((function(e){return e.uid})),shortcutFaqUids:null==le||null===(K=le.serviceSettings)||void 0===K||null===(K=K.shortcutFaqs)||void 0===K?void 0:K.map((function(e){return e.uid}))}),robotSettings:a()(a()({},le.robotSettings),{},{robotUid:null==le||null===(V=le.robotSettings)||void 0===V||null===(V=V.robot)||void 0===V?void 0:V.uid}),messageLeaveSettings:a()(a()({},le.messageLeaveSettings),{},{worktimeUids:null==le||null===(L=le.messageLeaveSettings)||void 0===L||null===(L=L.worktimes)||void 0===L?void 0:L.map((function(e){return e.uid}))}),inviteSettings:a()(a()({},le.inviteSettings),{},{show:i.showInvite,text:i.inviteText}),agentUids:le.agents.map((function(e){return e.uid}))}),console.log("workgroupObject:",W),e.next=27,(0,m.W5)(W);case 27:B=e.sent,console.log("updateWorkGroup response:",B),200===B.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success"})),ae(B.data)):(g.yw.destroy(),g.yw.error(B.message));case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,K.jsxs)("div",{children:[(0,K.jsxs)(q.A,{form:s,onFinish:ve,children:[(0,K.jsxs)(I.Z,{title:"主动触发设置",children:[(0,K.jsx)(y.Z,{width:"md",name:"enableProactiveTrigger",label:"启用主动触发"}),(0,K.jsx)(q.A.Group,{children:(0,K.jsx)(S.Z,{width:"md",name:"proactiveMessage",label:"主动发送的消息内容",placeholder:"例如：您好，看起来您有一段时间没有互动了。请问还需要帮助吗？"})}),(0,K.jsx)(q.A.Group,{children:(0,K.jsx)(F.Z,{width:"xs",name:"noResponseTimeout",label:"无响应超时时间(秒)",min:1,fieldProps:{addonAfter:"秒"}})})]}),(0,K.jsx)(P.Z,{})]}),(0,K.jsx)(A.Z,{title:null!==J?"编辑触发条件":"添加触发条件",open:O,onOk:function(){G.validateFields().then((function(e){var t=e.keywords;t&&"string"==typeof t&&(t=t.split(",").map((function(e){return e.trim()})).filter((function(e){return e})));var n={type:e.type,message:e.message,timeout:e.type===L||e.type===_?e.timeout:void 0,keywords:e.type===W?t:void 0,threshold:e.type===B?e.threshold:void 0,start:e.type===N?e.start:void 0,end:e.type===N?e.end:void 0};if(null!==J){var i=o()(c);i[J]=n,C(i)}else C([].concat(o()(c),[n]));X(!1),G.resetFields()}))},onCancel:function(){return X(!1)},width:600,children:(0,K.jsxs)(R.Z,{form:G,layout:"vertical",initialValues:{type:L,timeout:300,message:"您好，需要帮助吗？"},children:[(0,K.jsx)(R.Z.Item,{name:"type",label:"触发类型",rules:[{required:!0,message:"请选择触发类型"}],children:(0,K.jsx)(M.Z,{children:D.map((function(e){return(0,K.jsx)(V,{value:e.value,children:e.label},e.value)}))})}),function(){switch(G.getFieldValue("type")){case L:return(0,K.jsx)(R.Z.Item,{name:"timeout",label:"无响应超时时间(秒)",rules:[{required:!0,message:"请输入超时时间"}],children:(0,K.jsx)(T.Z,{min:1})});case W:return(0,K.jsx)(R.Z.Item,{name:"keywords",label:"关键词列表(逗号分隔)",rules:[{required:!0,message:"请输入关键词"}],children:(0,K.jsx)(Z.Z,{placeholder:"例如: 价格, 费用, 多少钱"})});case B:return(0,K.jsx)(R.Z.Item,{name:"threshold",label:"访问次数阈值",rules:[{required:!0,message:"请输入访问次数"}],children:(0,K.jsx)(T.Z,{min:1})});case _:return(0,K.jsx)(R.Z.Item,{name:"timeout",label:"页面停留时间(秒)",rules:[{required:!0,message:"请输入停留时间"}],children:(0,K.jsx)(T.Z,{min:1})});case N:return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(R.Z.Item,{name:"start",label:"开始时间",rules:[{required:!0,message:"请输入开始时间"}],children:(0,K.jsx)(Z.Z,{placeholder:"格式: HH:mm, 例如: 09:00"})}),(0,K.jsx)(R.Z.Item,{name:"end",label:"结束时间",rules:[{required:!0,message:"请输入结束时间"}],children:(0,K.jsx)(Z.Z,{placeholder:"格式: HH:mm, 例如: 18:00"})})]});default:return null}}(),(0,K.jsx)(R.Z.Item,{name:"message",label:"触发消息",rules:[{required:!0,message:"请输入触发后发送的消息"}],children:(0,K.jsx)(Z.Z.TextArea,{rows:3,placeholder:"触发条件满足后发送给用户的消息"})})]})})]})}},79677:function(e,t,n){n(44194),n(30921),n(53038),n(79686),n(31549);var i=n(75574);i.Z.Sider,i.Z.Content},69690:function(e,t,n){n.d(t,{Z:function(){return G}});var i=n(44194),o=n(8247),s=n(30921),r=n(31549),l=function(){var e=(0,s.useIntl)();return(0,r.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,r.jsx)("h2",{children:(0,r.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:e.formatMessage({id:"install.guide.github"})})}),(0,r.jsx)("h2",{children:e.formatMessage({id:"install.guide.steps"})}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:e.formatMessage({id:"install.guide.step1.title"})}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(e.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:e.formatMessage({id:"install.guide.step2.title"})}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:e.formatMessage({id:"install.guide.step3.title"})}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(e.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(e.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:e.formatMessage({id:"install.guide.step4.title"})}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('BytedeskReact initialized');\n  };\n\n  return (\n    <div>\n      <BytedeskReact {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ".concat(e.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:e.formatMessage({id:"install.guide.step5.title"})}),(0,r.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",e.formatMessage({id:"install.guide.step5.show"})]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",e.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},a=function(e){e.type;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l,{})})},u=n(53038),d=function(){return(0,r.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,r.jsx)("h2",{children:(0,r.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:"More Demo on -》Github"})}),(0,r.jsx)("h2",{children:"安装步骤"}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"1. 安装依赖"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# 或\nyarn add bytedesk-web"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"2. 导入组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"import { BytedeskReact } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"3. 配置参数"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // 替换为您的组织ID\n    t: \"2\",\n    sid: 'df_rt_uid'      // 替换为您的SID\n  }\n};"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"4. 使用组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('BytedeskReact initialized');\n  };\n\n  return (\n    <div>\n      <BytedeskReact {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        打开聊天\n      </button>\n    </div>\n  );\n};"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"5. 可用方法"}),(0,r.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - 显示聊天窗口"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - 隐藏聊天窗口"]})]})]})]})},c=function(e){e.type;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(d,{})})},v=function(){return(0,r.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,r.jsx)("h2",{children:(0,r.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:"More Demo on -》Github"})}),(0,r.jsx)("h2",{children:"安装步骤"}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"1. 安装依赖"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# 或\nyarn add bytedesk-web"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"2. 导入组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"import { BytedeskReact } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"3. 配置参数"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // 替换为您的组织ID\n    t: \"2\",\n    sid: 'df_rt_uid'      // 替换为您的SID\n  }\n};"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"4. 使用组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('BytedeskReact initialized');\n  };\n\n  return (\n    <div>\n      <BytedeskReact {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        打开聊天\n      </button>\n    </div>\n  );\n};"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"5. 可用方法"}),(0,r.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - 显示聊天窗口"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - 隐藏聊天窗口"]})]})]})]})},g=function(e){e.type;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(v,{})})},f=function(){return(0,r.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,r.jsx)("h2",{children:(0,r.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:"More Demo on -》Github"})}),(0,r.jsx)("h2",{children:"安装步骤"}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"1. 安装依赖"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# 或\nyarn add bytedesk-web"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"2. 导入组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"import { BytedeskReact } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"3. 配置参数"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // 替换为您的组织ID\n    t: \"2\",\n    sid: 'df_rt_uid'      // 替换为您的SID\n  }\n};"})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("h3",{children:"4. 使用组件"}),(0,r.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('BytedeskReact initialized');\n  };\n\n  return (\n    <div>\n      <BytedeskReact {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        打开聊天\n      </button>\n    </div>\n  );\n};"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"5. 可用方法"}),(0,r.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - 显示聊天窗口"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - 隐藏聊天窗口"]})]})]})]})},p=function(e){e.type;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(f,{})})},m=n(73193),h=n.n(m),w=n(45332),b=n.n(w),x=n(7358),q=n(71529),y=n(3340),S=n(61107),F=n(1430),k=n(3849),U=n(75365),C=n(53530),j=n(88958),M=n(11184),R=n(69169),T=n(48708),Z=n(84881),I=n(85954),P=n(32350),A=n(62673),K=n(66310),V=n(40612),L=n(1902),W=n(95490),B=n(44521),_=n(55735),N=n(86803),D=n(76711),E=n.n(D),O=n(44435),X=n(83642),z=n(83890),Q=(0,O.Ue)()((0,X.mW)((0,X.tJ)((0,z.n)((function(e,t){return{unifiedResult:{data:{content:[]}},currentUnified:{uid:"",nickname:"",avatar:"",description:"",orgUid:""},insertUnified:function(t){e((function(e){e.unifiedResult.data.content.unshift(t)}))},updateUnified:function(t){e((function(e){var n=e.unifiedResult.data.content,i=n.findIndex((function(e){return e.uid===t.uid}));-1!==i?n[i]=t:console.warn("Unified with uid ".concat(t.uid," not found."))}))},deleteUnified:function(t){e((function(e){var n=e.unifiedResult.data.content,i=n.findIndex((function(e){return e.uid===t.uid}));-1!==i?n.splice(i,1):console.warn("Unified with uid ".concat(t.uid," not found."))}))},setUnifiedResult:function(n){var i;(e({unifiedResult:n}),""===t().currentUnified.uid)&&((null===(i=n.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.length)>0&&e({currentUnified:n.data.content[0]}))},setCurrentUnified:function(n){var i=t().unifiedResult.data.content,o=i.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var s=[].concat(E()(i.slice(0,o)),[n],E()(i.slice(o+1))),r=h()(h()({},t().unifiedResult),{},{data:{content:s}});e({unifiedResult:r,currentUnified:n})}else console.warn("Unified with the specified uid not found."),e({currentUnified:n})},deleteCurrentUnified:function(n){var i=t().unifiedResult.data.content,o=i.findIndex((function(e){return e.uid===n}));-1!==o?e({unifiedResult:h()(h()({},t().unifiedResult),{},{data:{content:[].concat(E()(i.slice(0,o)),E()(i.slice(o+1)))}})}):console.warn("Unified not found in cache:",n),t().currentUnified.uid===n&&e({currentUnified:{uid:"",orgUid:""}})},deleteUnifiedCache:function(){return e({},!0)}}})),{name:_.jlI}))),$=function(e){var t,n,o,l,a,u,d,c,v=e.type,g=R.A.useForm(),f=b()(g,1)[0],p=(0,M.M)(),m=p.config,w=p.updateConfig,D=(0,V.u)((function(e){return e.currentOrg})),E=(0,K.V)((function(e){return e.currentRobot})),O=(0,L.E)((function(e){return e.currentAgent})),X=(0,W.$)((function(e){return e.currentWorkgroup})),z=Q((function(e){return e.currentUnified})),$=(0,i.useState)(!1),G=b()($,2),H=G[0],Y=G[1],J=(0,i.useState)(!1),ee=b()(J,2),te=ee[0],ne=ee[1],ie=(0,i.useState)("zh-cn"),oe=b()(ie,2),se=oe[0],re=oe[1],le=(0,i.useState)("system"),ae=b()(le,2),ue=ae[0],de=ae[1],ce=(0,s.useIntl)(),ve=(0,i.useState)(!1),ge=b()(ve,2),fe=ge[0],pe=ge[1],me=(0,i.useState)("full"),he=b()(me,2),we=he[0],be=he[1],xe=(0,i.useMemo)((function(){return v===_._X4?{chatType:_.xtN,chatSid:E.uid}:v===_.Njn?{chatType:_.scI,chatSid:O.uid}:v===_.aZD?{chatType:_.vPY,chatSid:X.uid}:v===_.RB4?{chatType:_.vIe,chatSid:z.uid}:{chatType:_.xtN,chatSid:""}}),[v,E,O,X]),qe=xe.chatType,ye=xe.chatSid;(0,i.useEffect)((function(){var e,t;null!=D&&D.uid&&qe&&ye&&w({chatConfig:{org:null==D?void 0:D.uid,t:qe,sid:ye},theme:{backgroundColor:null===(e=m.theme)||void 0===e?void 0:e.backgroundColor,textColor:null===(t=m.theme)||void 0===t?void 0:t.textColor}})}),[null==D?void 0:D.uid,qe,ye,null===(t=m.theme)||void 0===t?void 0:t.backgroundColor,null===(n=m.theme)||void 0===n?void 0:n.textColor]);var Se=function(e){var t,n,i=e+"?".concat(_.I3Y,"=").concat(null==D?void 0:D.uid)+"&".concat(_.ZfG,"=").concat(qe)+"&".concat(_.RI9,"=").concat(ye);(H&&(i+="&".concat(_.ErC,"=").concat(se)),te)&&(i+="&".concat(_.N1q,"=").concat(ue)+"&".concat(_.spX,"=").concat(null===(t=m.theme)||void 0===t?void 0:t.backgroundColor)+"&".concat(_.cW9,"=").concat(null===(n=m.theme)||void 0===n?void 0:n.textColor));return i+"&"},Fe=(0,i.useMemo)((function(){return Se((0,B.Cn)())}),[null==D?void 0:D.uid,E,O,X,H,se,te,ue,null===(o=m.theme)||void 0===o?void 0:o.backgroundColor,null===(l=m.theme)||void 0===l?void 0:l.textColor]),ke=(0,i.useMemo)((function(){return Se((0,B.Z$)())}),[null==D?void 0:D.uid,E,O,X,H,se,te,ue,null===(a=m.theme)||void 0===a?void 0:a.backgroundColor,null===(u=m.theme)||void 0===u?void 0:u.textColor]),Ue=function(e){var t,n,i,o,s,r,l,a,u,d;return'\x3c!-- bytedesk.com --\x3e\n<script src="https://www.weiyuai.cn/embed/bytedesk-web.js"><\/script>\n<script>\n  const config = {\n    baseUrl: \''.concat(e.baseUrl||"https://www.weiyuai.cn/chat","',\n    placement: '").concat(e.placement||"bottom-right","',\n    autoPopup: ").concat(e.autoPopup||!1,",\n    locale: '").concat(se,"',\n    inviteConfig: {\n      show: ").concat((null===(t=e.inviteConfig)||void 0===t?void 0:t.show)||!1,",\n      text: '").concat((null===(n=e.inviteConfig)||void 0===n?void 0:n.text)||"需要帮助么","',\n    },\n    bubbleConfig: {\n      show: ").concat(null===(i=null===(o=e.bubbleConfig)||void 0===o?void 0:o.show)||void 0===i||i,",\n      icon: '").concat((null===(s=e.bubbleConfig)||void 0===s?void 0:s.icon)||"👋","',\n      title: '").concat((null===(r=e.bubbleConfig)||void 0===r?void 0:r.title)||"需要帮助么","',\n      subtitle: '").concat((null===(l=e.bubbleConfig)||void 0===l?void 0:l.subtitle)||"点击我，与我对话","'\n    },\n    theme: {\n      mode: '").concat(ue,"',\n      backgroundColor: '").concat((null===(a=e.theme)||void 0===a?void 0:a.backgroundColor)||"#0066FF","',\n      textColor: '").concat((null===(u=e.theme)||void 0===u?void 0:u.textColor)||"#ffffff","'\n    },\n    window: {\n      width: '").concat((null===(d=e.window)||void 0===d?void 0:d.width)||380,"'\n    },\n    chatConfig: {\n      org: '").concat(null==D?void 0:D.uid,"',\n      t: '").concat(qe,"',\n      sid: '").concat(ye,"'\n    }\n  };\n  const bytedesk = new BytedeskWeb(config);\n  bytedesk.init();\n<\/script>")};(0,i.useEffect)((function(){var e,t;m&&(f.setFieldValue("codeFullUrl",Fe),f.setFieldValue("codeFrameUrl",ke),f.setFieldValue("buttonColor",null===(e=m.theme)||void 0===e?void 0:e.backgroundColor),f.setFieldValue("showBubble",null===(t=m.bubbleConfig)||void 0===t?void 0:t.show),f.setFieldsValue({rightPlacement:"bottom-right"===m.placement,configText:Ue(m)}))}),[m]);var Ce=function(e){be(e),pe(!0)};return(0,r.jsxs)(A.Z,{title:ce.formatMessage({id:"channel.web.config.title"}),children:[(0,r.jsxs)(R.A,{form:f,submitter:!1,onValuesChange:function(e,t){var n=t.rightPlacement?{placement:"bottom-right"}:{placement:"bottom-left"};w(n),f.setFieldsValue({configText:Ue(h()(h()({},m),n))})},children:[(0,r.jsx)(T.Z,{name:"rightPlacement",label:ce.formatMessage({id:"channel.web.position"}),tooltip:ce.formatMessage({id:"channel.web.position.tooltip"}),fieldProps:{checked:"bottom-right"===m.placement}}),(0,r.jsx)(Z.Z,{name:"buttonColor",width:"md",label:ce.formatMessage({id:"channel.web.button.color"}),options:[{label:ce.formatMessage({id:"channel.web.button.color.blue"}),value:"#0066FF"},{label:ce.formatMessage({id:"channel.web.button.color.green"}),value:"#52c41a"},{label:ce.formatMessage({id:"channel.web.button.color.red"}),value:"#ff4d4f"},{label:ce.formatMessage({id:"channel.web.button.color.yellow"}),value:"#faad14"},{label:ce.formatMessage({id:"channel.web.button.color.purple"}),value:"#722ed1"}],fieldProps:{value:null===(d=m.theme)||void 0===d?void 0:d.backgroundColor,onChange:function(e){w({theme:h()(h()({},m.theme),{},{textColor:"#ffffff",backgroundColor:e})}),f.setFieldsValue({configText:Ue(h()(h()({},m),{},{theme:h()(h()({},m.theme),{},{textColor:"#ffffff",backgroundColor:e})}))})}},addonAfter:(0,r.jsx)(F.Z,{value:null===(c=m.theme)||void 0===c?void 0:c.backgroundColor,onChange:function(e){var t=e.toHexString();w({theme:h()(h()({},m.theme),{},{backgroundColor:t})}),f.setFieldsValue({buttonColor:t,configText:Ue(h()(h()({},m),{},{theme:h()(h()({},m.theme),{},{backgroundColor:t})}))})}})}),(0,r.jsx)(I.Z,{name:"showBubble",width:"xl",tooltip:ce.formatMessage({id:"channel.web.show.bubble.tooltip"}),label:ce.formatMessage({id:"channel.web.show.bubble"}),fieldProps:{onChange:function(e){var t=e.target.checked;w({bubbleConfig:h()(h()({},m.bubbleConfig),{},{show:t})}),f.setFieldsValue({configText:Ue(h()(h()({},m),{},{bubbleConfig:h()(h()({},m.bubbleConfig),{},{show:t})}))})}}}),(0,r.jsx)(I.Z,{name:"showLang",width:"xl",tooltip:ce.formatMessage({id:"channel.web.enable.multilang.tooltip"}),label:ce.formatMessage({id:"channel.web.enable.multilang"}),fieldProps:{checked:H,onChange:function(e){var t=e.target.checked;Y(t),t||re("zh-cn")}}}),H&&(0,r.jsx)(Z.Z,{name:"language",width:"md",label:ce.formatMessage({id:"channel.web.select.language"}),options:[{label:ce.formatMessage({id:"channel.web.lang.zh_cn"}),value:"zh-cn"},{label:ce.formatMessage({id:"channel.web.lang.zh_tw"}),value:"zh-tw"},{label:ce.formatMessage({id:"channel.web.lang.en"}),value:"en"}],fieldProps:{onChange:function(e){return re(e)}}}),(0,r.jsx)(I.Z,{name:"showTheme",width:"xl",tooltip:ce.formatMessage({id:"channel.web.enable.theme.tooltip"}),label:ce.formatMessage({id:"channel.web.enable.theme"}),fieldProps:{checked:te,onChange:function(e){var t=e.target.checked;ne(t),t||de("system")}}}),te&&(0,r.jsx)(Z.Z,{name:"theme",width:"md",label:ce.formatMessage({id:"channel.web.theme.select"}),options:[{label:ce.formatMessage({id:"channel.web.theme.follow.system"}),value:"system"},{label:ce.formatMessage({id:"channel.web.theme.light"}),value:"light"},{label:ce.formatMessage({id:"channel.web.theme.dark"}),value:"dark"}],fieldProps:{value:ue,onChange:de}}),(0,r.jsx)(P.Z,{name:"configText",width:"xl",label:ce.formatMessage({id:"channel.web.code.embed"}),tooltip:ce.formatMessage({id:"channel.web.code.embed.desc"}),fieldProps:{autoSize:{minRows:15,maxRows:25},readOnly:!0}}),(0,r.jsxs)(k.Z,{direction:"horizontal",style:{width:"100%",marginTop:10,marginBottom:10},children:[(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(x.Z,{}),onClick:function(){var e=f.getFieldValue("configText");navigator.clipboard.writeText(e).then((function(){N.yw.success(ce.formatMessage({id:"channel.web.copy.success"}))})).catch((function(){N.yw.error(ce.formatMessage({id:"channel.web.copy.error"}))}))},children:ce.formatMessage({id:"channel.web.copy.code"})}),(0,r.jsx)(U.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:ce.formatMessage({id:"channel.web.show.chat"})}),(0,r.jsx)(U.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.hideChat()},children:ce.formatMessage({id:"channel.web.hide.chat"})})]}),(0,r.jsx)(P.Z,{name:"codeFullUrl",width:"xl",label:ce.formatMessage({id:"channel.web.code.fullscreen"}),tooltip:ce.formatMessage({id:"channel.web.code.fullscreen.desc"}),fieldProps:{autoSize:{minRows:2,maxRows:5},readOnly:!0}}),(0,r.jsxs)(k.Z,{direction:"horizontal",style:{width:"100%",marginBottom:10},children:[(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(x.Z,{}),onClick:function(){navigator.clipboard.writeText(Fe).then((function(){N.yw.success(ce.formatMessage({id:"channel.web.fullscreen.copy.success"}))})).catch((function(){N.yw.error(ce.formatMessage({id:"channel.web.copy.error"}))}))},children:ce.formatMessage({id:"channel.web.copy.fullscreen"})}),(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(q.Z,{}),onClick:function(){window.open(Fe)},children:ce.formatMessage({id:"channel.web.open.fullscreen"})}),(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(y.Z,{}),onClick:function(){return Ce("full")},children:ce.formatMessage({id:"channel.web.generate.qrcode",defaultMessage:"生成二维码"})})]}),(0,r.jsx)(P.Z,{name:"codeFrameUrl",width:"xl",label:ce.formatMessage({id:"channel.web.code.frame"}),tooltip:ce.formatMessage({id:"channel.web.code.frame.desc"}),fieldProps:{autoSize:{minRows:2,maxRows:5},readOnly:!0}}),(0,r.jsxs)(k.Z,{direction:"horizontal",style:{width:"100%"},children:[(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(x.Z,{}),onClick:function(){var e=f.getFieldValue("codeFrameUrl");navigator.clipboard.writeText(e).then((function(){N.yw.success(ce.formatMessage({id:"channel.web.frame.copy.success"}))})).catch((function(){N.yw.error(ce.formatMessage({id:"channel.web.copy.error"}))}))},children:ce.formatMessage({id:"channel.web.copy.frame"})}),(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(q.Z,{}),onClick:function(){window.open(ke)},children:ce.formatMessage({id:"channel.web.open.frame"})}),(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(y.Z,{}),onClick:function(){return Ce("frame")},children:ce.formatMessage({id:"channel.web.generate.qrcode",defaultMessage:"生成二维码"})})]})]}),(0,r.jsx)(C.Z,{title:ce.formatMessage({id:"channel.web.qrcode.title",defaultMessage:"客服二维码"}),open:fe,onCancel:function(){return pe(!1)},footer:[(0,r.jsx)(U.ZP,{onClick:function(){return pe(!1)},children:ce.formatMessage({id:"common.close",defaultMessage:"关闭"})},"close"),(0,r.jsx)(U.ZP,{type:"primary",icon:(0,r.jsx)(S.Z,{}),onClick:function(){var e,t=null===(e=document.getElementById("bytedesk-qrcode-canvas"))||void 0===e?void 0:e.querySelector("canvas");if(t){var n=t.toDataURL(),i=document.createElement("a");i.download="bytedesk-".concat(we,"-qrcode.png"),i.href=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),N.yw.success(ce.formatMessage({id:"channel.web.qrcode.download.success"}))}},children:ce.formatMessage({id:"channel.web.qrcode.download",defaultMessage:"下载二维码"})},"download")],width:400,centered:!0,children:(0,r.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},id:"bytedesk-qrcode-canvas",children:[(0,r.jsx)(j.Z,{value:"full"===we?Fe:ke,size:280,style:{margin:"0 auto"},errorLevel:"H"}),(0,r.jsx)("div",{style:{marginTop:10},children:ce.formatMessage({id:"channel.web.qrcode.scan",defaultMessage:"扫描二维码咨询客服"})})]})})]})},G=function(e){var t=e.type,n=[{key:"web",label:"Web",children:(0,r.jsx)($,{type:t})},{key:"react",label:"React",children:(0,r.jsx)(a,{type:t})},{key:"vue",label:"Vue",children:(0,r.jsx)(p,{type:t})},{key:"svelte",label:"Svelte",children:(0,r.jsx)(c,{type:t})},{key:"vanilla",label:"Vanilla",children:(0,r.jsx)(g,{type:t})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{type:t}),(0,r.jsx)(o.Z,{tabPosition:"left",items:n})]})}},75157:function(e,t,n){n(44194),n(30921),n(53038),n(79686),n(31549)},23832:function(e,t,n){n(44194);var i=n(30921),o=(n(79686),n(31549));n(53038),n(90819),n(73193),n(84176),n(89933),n(45332),n(40612),n(69842),n(55735),i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,n(72614),n(76750),n(95490);i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage,i.FormattedMessage},53038:function(e,t,n){var i=n(30921),o=n(31549);t.Z=function(e){e.type,(0,i.useIntl)();return(0,o.jsx)(o.Fragment,{})}},79686:function(e,t,n){n(55735),n(30921),n(31549)},6631:function(e,t,n){n.d(t,{G:function(){return v}});var i=n(73193),o=n.n(i),s=(n(44194),n(30348)),r=n(55735),l=n(28977),a=n.n(l),u=n(86803),d=n(44521),c=n(31549),v=function(e){var t=e.children,n=e.onSuccess,i=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:r.IrL,categoryUid:"",kbUid:"",client:r.bVn},v={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(r.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=a()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=t,l.fileType=e.type,console.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),u.yw.success("".concat(e.file.name," 上传成功"))}else i(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),i(e.file))}};return(0,c.jsx)(s.Z,o()(o()({},v),{},{children:t}))}},66310:function(e,t,n){n.d(t,{V:function(){return c}});var i=n(73193),o=n.n(i),s=n(76711),r=n.n(s),l=n(55735),a=n(44435),u=n(83642),d=n(83890),c=(0,a.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,t){return{robotResult:{data:{content:[]}},currentRobot:{uid:"",nickname:""},insertRobot:function(t){e((function(e){e.robotResult.data.content.unshift(t)}))},setRobotResult:function(n){e({robotResult:n});var i,o=t().currentRobot;""!==o.uid&&void 0!==o||(null===(i=n.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.length)>0&&e({currentRobot:n.data.content[0]})},setCurrentRobot:function(n){var i=t().robotResult.data.content,s=i.findIndex((function(e){return e.uid===n.uid}));if(-1!==s){var l=[].concat(r()(i.slice(0,s)),[n],r()(i.slice(s+1))),a=o()(o()({},t().robotResult),{},{data:{content:l}});e({robotResult:a,currentRobot:n})}else console.warn("Robot with the specified uid not found."),e({currentRobot:n})},deleteCurrentRobot:function(n){var i=t().robotResult.data.content,s=i.findIndex((function(e){return e.uid===n}));-1!==s?e({robotResult:o()(o()({},t().robotResult),{},{data:{content:[].concat(r()(i.slice(0,s)),r()(i.slice(s+1)))}})}):console.warn("Robot not found in cache:",n),t().currentRobot.uid===n&&e({currentRobot:{uid:""}})},deleteRobotCache:function(){return e({},!0)}}})),{name:l.Eis})))}}]);