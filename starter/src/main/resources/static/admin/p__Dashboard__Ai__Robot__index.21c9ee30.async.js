"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{74840:function(e,t,a){a.d(t,{Z:function(){return l}});var s=a(83910),n=a(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},r=a(54183),o=function(e,t){return n.createElement(r.Z,(0,s.Z)({},e,{ref:t,icon:i}))};var l=n.forwardRef(o)},27901:function(e,t,a){var s=a(90819),n=a.n(s),i=a(89933),r=a.n(i),o=a(45332),l=a.n(o),d=a(66441),u=a(43388),c=a(84553),g=a(13845),f=a(88722),m=a(74171),p=a(94976),v=a(78112),M=a(99036),h=a(59005),x=a(4628),b=a(44194),y=a(66406),S=a(67242),w=a(31549);t.Z=function(e){var t,a,s,i,o=M.A.useForm(),j=l()(o,1)[0],T=(0,x.useIntl)(),C=(0,f.Z)().translateString,k=(0,m.u)((function(e){return e.currentOrg})),Z=(0,b.useState)(),F=l()(Z,2),P=F[0],U=F[1],E=(0,b.useState)(),I=l()(E,2),R=I[0],A=I[1],q=(0,b.useState)(),O=l()(q,2),N=O[0],z=O[1],K=(0,b.useState)(""),D=l()(K,2),J=D[0],L=D[1],_=(0,b.useRef)(!1),B=(0,b.useRef)(),H=(0,b.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),W=(0,b.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==H?void 0:H.draft)&&void 0!==t?t:null==H?void 0:H.live)&&void 0!==e?e:void 0}),[H]),V=(0,b.useCallback)((function(t){var a;null===(a=e.onServiceSettingsChange)||void 0===a||a.call(e,t)}),[e.onServiceSettingsChange]),G=(0,b.useCallback)((function(e){j.setFieldValue("welcomeTip",e),V({welcomeTip:e})}),[j,V]);(0,b.useEffect)((function(){if(null!=k&&k.uid&&(B.current!==k.uid&&(B.current=k.uid,_.current=!1),!_.current)){_.current=!0;var e=function(){var e=r()(n()().mark((function e(){var t,a,s,i,r,o,l;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(T.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:p.QPQ,orgUid:k.uid},e.next=4,(0,g.AP)(t);case 4:a=e.sent,S.Z.debug("TabServiceWelcome queryKbasesByOrg:",a,t),u.yw.destroy(),200===a.code?(A(a),r=(null==a||null===(s=a.data)||void 0===s?void 0:s.content)||[],o=null==W?void 0:W.welcomeKbUid,(l=o||N||(null===(i=r[0])||void 0===i?void 0:i.uid))&&(z(l),j.setFieldValue("welcomeKbUid",l),o!==l&&V({welcomeKbUid:l}))):u.yw.error(a.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==k?void 0:k.uid,T,null==W?void 0:W.welcomeKbUid,N,j,V]),(0,b.useEffect)((function(){if(null!=k&&k.uid&&N){var e=function(){var e=r()(n()().mark((function e(){var t,a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.yw.loading(T.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:k.uid,kbUid:N},e.next=4,(0,c.pf)(t);case 4:a=e.sent,S.Z.debug("TabServiceWelcome queryFaqsByOrg:",a,t),u.yw.destroy(),200===a.code?U(a):u.yw.error(a.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==k?void 0:k.uid,N,T]),(0,b.useEffect)((function(){if(W){var e=null==W?void 0:W.welcomeFaqs,t=Array.isArray(W.welcomeFaqUids)?W.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==P||null===(t=P.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==W?void 0:W.welcomeFaqUids,W]);var Y=(0,b.useCallback)((function(e){z(e),j.setFieldValue("welcomeFaqUids",[]),V({welcomeKbUid:e,welcomeFaqUids:[]})}),[V,j]);return(0,b.useEffect)((function(){var e=C(null==W?void 0:W.welcomeTip);void 0!==e&&J!==e&&L(e),null!=W&&W.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",W.welcomeKbUid),N!==W.welcomeKbUid&&z(W.welcomeKbUid))}),[C,null==W?void 0:W.welcomeTip,null==W?void 0:W.welcomeKbUid,J,j,N,null==R||null===(a=R.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length]),(0,w.jsxs)(M.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,w.jsx)(M.A.Item,{name:"welcomeTip",label:(0,w.jsxs)("span",{children:[T.formatMessage({id:"agent.settings.welcome.tip"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeTip"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),tooltip:T.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:T.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,w.jsx)(y.Z,{placeholder:T.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:J,toolbarKeys:(0,v.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:G})}),(0,w.jsx)(h.Z,{name:"welcomeKbUid",width:"md",label:(0,w.jsxs)("span",{children:[T.formatMessage({id:"menu.kbase.select",defaultMessage:"é€‰æ‹©çŒœä½ æƒ³é—®çŸ¥è¯†åº“"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeKbUid"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),options:null==R||null===(s=R.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return Y(e)},allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,w.jsx)(h.Z,{name:"welcomeFaqUids",width:"md",label:(0,w.jsxs)("span",{children:[T.formatMessage({id:"menu.kbase.faq.welcome"}),(0,w.jsx)(d.Z,{type:"service",keys:["welcomeFaqUids"],live:null==H?void 0:H.live,draft:null==H?void 0:H.draft})]}),options:null==P||null===(i=P.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,w.jsx)(x.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return V({welcomeFaqUids:e})}}})]})}},5911:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ee}});var s=a(44194),n=a(21600),i=a(4628),r=a(76711),o=a.n(r),l=a(90819),d=a.n(l),u=a(89933),c=a.n(u),g=a(73193),f=a.n(g),m=a(45332),p=a.n(m),v=a(81581),M=a(69533),h=a(30310),x=a(1282),b=a(83281),y=a(96955),S=a(90581),w=a(12461),j=a(43275),T=a(27729),C=a(82878),k=a(74840),Z=a(29337),F=a(68779),P=a(90727),U=a(12322),E=a(34600),I=a(56482),R=a(94322),A=a(10162),q=a(59304),O=a(54881),N=a(47944),z=a(4317),K=a(80556),D=a(55785),J=a(97135),L=a(43388),_=a(47926),B=a(74171),H=a(21850),W=a(25553),V=a(39325),G=a(85977),Y=a(95093),Q=a(1596),X=(a(94147),a(77500)),$=a(12608),ee=a(27501),te=a(83610),ae=a(27901),se=(a(66441),a(31549)),ne=a(97799),ie=a(42e3),re=(a(92029),a(67242)),oe=a(58620),le="welcome",de=function(){var e,t,a,r,l,u,g,m,de=(0,i.useIntl)(),ue=(0,i.useAccess)(),ce=(0,B.u)((function(e){return e.currentOrg})),ge=(0,H.Z)().leftSiderStyle,fe=(0,W.Z)().isDarkMode,me=(0,s.useState)(!1),pe=p()(me,2),ve=pe[0],Me=pe[1],he=(0,s.useState)([]),xe=p()(he,2),be=xe[0],ye=xe[1],Se=(0,s.useState)(),we=p()(Se,2),je=we[0],Te=we[1],Ce=(0,s.useState)(""),ke=p()(Ce,2),Ze=ke[0],Fe=ke[1],Pe=(0,s.useState)(le),Ue=p()(Pe,2),Ee=Ue[0],Ie=Ue[1],Re=(0,s.useState)(!1),Ae=p()(Re,2),qe=Ae[0],Oe=Ae[1],Ne=(0,s.useState)(null),ze=p()(Ne,2),Ke=ze[0],De=ze[1],Je=(0,s.useState)(!1),Le=p()(Je,2),_e=Le[0],Be=Le[1],He=(0,s.useMemo)((function(){return be.find((function(e){return e.uid===je}))||null}),[be,je]),We=(0,s.useState)(!1),Ve=p()(We,2),Ge=Ve[0],Ye=Ve[1],Qe=(0,s.useState)(!1),Xe=p()(Qe,2),$e=Xe[0],et=Xe[1],tt=(0,s.useState)(!1),at=p()(tt,2),st=at[0],nt=at[1],it=(0,s.useRef)(""),rt=(0,V.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),ot=rt.setCurrentRobotSettings,lt=rt.currentRobotSettings,dt=(0,s.useMemo)((function(){var e;return null!==(e=null!=lt?lt:He)&&void 0!==e?e:null}),[lt,He]),ut=(0,s.useMemo)((function(){var e;return null==ue||null===(e=ue.getModulePermission)||void 0===e?void 0:e.call(ue,G.MY.ROBOT_SETTINGS)}),[ue]),ct=null!==(e=null==ut||null===(t=ut.canRead)||void 0===t?void 0:t.call(ut))&&void 0!==e&&e,gt=null!==(a=null==ut||null===(r=ut.canCreate)||void 0===r?void 0:r.call(ut))&&void 0!==a&&a,ft=null!==(l=null==ut||null===(u=ut.canUpdate)||void 0===u?void 0:u.call(ut))&&void 0!==l&&l,mt=null!==(g=null==ut||null===(m=ut.canDelete)||void 0===m?void 0:m.call(ut))&&void 0!==g&&g,pt=(0,s.useRef)(!1),vt=function(e,t){L.yw.warning(de.formatMessage({id:e,defaultMessage:t}))},Mt=(0,s.useCallback)((function(e){if(lt){var t=lt.draftServiceSettings||lt.serviceSettings||{};ot(f()(f()({},lt),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[lt,ot]),ht=(0,s.useCallback)((function(e){if(lt){var t=lt.draftTriggerSettings||lt.triggerSettings||{};ot(f()(f()({},lt),{},{draftTriggerSettings:f()(f()({},t),e)}))}}),[lt,ot]),xt=((0,s.useCallback)((function(e){if(lt){var t=lt.draftSummarySettings||lt.summarySettings||{};ot(f()(f()({},lt),{},{draftSummarySettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){if(lt){var t=lt.draftInviteSettings||lt.inviteSettings||{};ot(f()(f()({},lt),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[lt,ot])),bt=((0,s.useCallback)((function(e){if(lt){var t=lt.draftIntentionSettings||lt.intentionSettings||{};ot(f()(f()({},lt),{},{draftIntentionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){if(lt){var t=lt.draftEmotionSettings||lt.emotionSettings||{};ot(f()(f()({},lt),{},{draftEmotionSettings:f()(f()({},t),e)}))}}),[lt,ot]),(0,s.useCallback)((function(e){var t;if(lt){var a=lt.draftToolsSettings||lt.toolsSettings||{};ot(f()(f()({},lt),{},{draftToolsSettings:f()(f()(f()({},a),e),{},{toolConfigs:null!==(t=e.toolConfigs)&&void 0!==t?t:a.toolConfigs})}))}}),[lt,ot]),(0,s.useMemo)((function(){if(!Ze)return be;var e=Ze.toLowerCase();return be.filter((function(t){var a=(t.name||t.uid||"").toLowerCase(),s=(t.description||"").toLowerCase();return a.includes(e)||s.includes(e)}))}),[be,Ze])),yt=(0,s.useCallback)(function(){var e=c()(d()().mark((function e(t,a){var s,n,i,r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=ce&&ce.uid){e.next=2;break}return e.abrupt("return");case 2:if(ct){e.next=9;break}return pt.current||(pt.current=!0,vt("robot_settings.permission.read.denied","æ— æƒé™ï¼šæŸ¥çœ‹æœºå™¨äººé…ç½®")),ye([]),Te(void 0),ot(null),nt(!1),e.abrupt("return");case 9:return Me(!0),e.prev=10,n=(null!=t?t:"").trim(),i={orgUid:ce.uid,pageNumber:0,pageSize:100,searchText:n||void 0},e.next=15,(0,_.VW)(i);case 15:r=e.sent,re.Z.debug("åŠ è½½æœºå™¨äººé…ç½®æ¨¡æ¿åˆ—è¡¨: ",r,i),o=(null==r||null===(s=r.data)||void 0===s?void 0:s.content)||[],ye(o),!(o.length>0)||je&&o.some((function(e){return e.uid===je}))||(Te(o[0].uid),null!=a&&a.keepActive||Ie(le));case 20:return e.prev=20,Me(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[10,,20,23]])})));return function(t,a){return e.apply(this,arguments)}}(),[null==ce?void 0:ce.uid,je,ct,ot]),St=(0,s.useCallback)((function(e){yt(null!=e?e:Ze)}),[yt,Ze]);(0,s.useEffect)((function(){yt(Ze)}),[null==ce?void 0:ce.uid]),(0,s.useEffect)((function(){He?(ot(He),it.current=JSON.stringify(null!=He?He:{}),nt(!1)):(ot(null),it.current=JSON.stringify({}),nt(!1))}),[He]),(0,s.useEffect)((function(){if(He)try{var e,t,a=JSON.stringify(null!=lt?lt:{}),s=a!==it.current;re.Z.debug("ğŸ” [Dirty Check]",{isDirty:s,selectedUid:null==He?void 0:He.uid,currentWelcomeTip:(null==lt||null===(e=lt.draftServiceSettings)||void 0===e?void 0:e.welcomeTip)||(null==lt||null===(t=lt.serviceSettings)||void 0===t?void 0:t.welcomeTip),originalLength:it.current.length,nowLength:a.length}),nt(s)}catch(e){nt(!0)}}),[lt,null==He?void 0:He.uid]);var wt=function(){var e=c()(d()().mark((function e(t){var a,s,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mt){e.next=3;break}return vt("robot_settings.permission.delete.denied","æ— æƒé™ï¼šåˆ é™¤æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=(a=null!=t?t:He)&&a.uid){e.next=6;break}return e.abrupt("return");case 6:return s={uid:a.uid,orgUid:null==ce?void 0:ce.uid,pageNumber:0,pageSize:100},e.next=9,(0,_.r$)(s);case 9:(n=e.sent)&&200===n.code?(L.yw.success(de.formatMessage({id:"common.deleted",defaultMessage:"åˆ é™¤æˆåŠŸ"})),yt(Ze)):L.yw.error((null==n?void 0:n.message)||de.formatMessage({id:"delete.error",defaultMessage:"åˆ é™¤å¤±è´¥"}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=c()(d()().mark((function e(t,a){var s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:return e.prev=3,e.next=6,(0,_.sK)({uid:t,orgUid:null==ce?void 0:ce.uid,enabled:a});case 6:(s=e.sent)&&200===s.code?(L.yw.success(de.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"å·²å¯ç”¨":"å·²åœç”¨"})),yt(Ze)):L.yw.error((null==s?void 0:s.message)||de.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("åˆ‡æ¢å¯ç”¨çŠ¶æ€å¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"operation.failed",defaultMessage:"æ“ä½œå¤±è´¥"}));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,a){return e.apply(this,arguments)}}(),Tt=function(e,t){if(e){var a={};return t.forEach((function(t){void 0!==e[t]&&(a[t]=e[t])})),a}},Ct=function(e){if(e){var t=Tt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputAssociationKbUid","inputPreviewEnabled","inputPreviewAlwaysShow","inputPreviewShowSeconds","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","requireLogin","showLogo","validateUntil"]),a=function(a,s){if(void 0===t[a]){var n=null==e?void 0:e[s];if(Array.isArray(n)){var i=n.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);i.length>0&&(t[a]=i)}}};a("welcomeFaqUids","welcomeFaqs"),a("faqUids","faqs"),a("quickButtonUids","quickButtons"),a("guessFaqUids","guessFaqs"),a("hotFaqUids","hotFaqs"),a("shortcutFaqUids","shortcutFaqs");var s=function(e){if(e)return Tt(e,["smile","upload","image","file","uploadRobot","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),s?{toolbar:s}:{})}},kt=function(e){if(e){var t=null==e?void 0:e.triggers;return Array.isArray(t)?{uid:null==e?void 0:e.uid,triggers:t.map((function(e){return{uid:null==e?void 0:e.uid,triggerKey:null==e?void 0:e.triggerKey,enabled:null==e?void 0:e.enabled,type:null==e?void 0:e.type,name:null==e?void 0:e.name,description:null==e?void 0:e.description,config:null==e?void 0:e.config}}))}:Tt(e,["uid"])}},Zt=function(e){if(e)return Tt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},Ft=function(e){if(e)return Tt(e,["name","description","color","order","robotUid","enabled","executionTiming"])},Pt=function(e){if(e)return Tt(e,["name","description","robotUid","enabled","executionTiming"])},Ut=function(e){if(e)return Tt(e,["name","description","defaultTemplate","robotUid","enabled","executionTiming"])},Et=function(e){if(e)return Tt(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},It=function(e){if(e){var t=Tt(e,["enabled","invocationMode","toolChoice","maxToolInvocations","defaultToolPrompt"]);return e.toolConfigs&&(t.toolConfigs=e.toolConfigs.map((function(e){return Tt(e,["key","name","description","category","icon","enabled","bindingType","beanName","className","methodName","endpoint","inputSchema","outputSchema","systemPrompt","orderIndex","requiresApproval","metadata"])}))),t}},Rt=function(){var e=c()(d()().mark((function e(){var t,a,s,n,i,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=He&&He.uid){e.next=6;break}return L.yw.warning(de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:return Ye(!0),e.prev=7,t=lt&&lt.uid===He.uid?lt:He,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:He.uid,orgUid:null==ce?void 0:ce.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,isDefault:null==t?void 0:t.isDefault,enabled:null==t?void 0:t.enabled,serviceSettings:Ct(a(null==t?void 0:t.serviceSettings,null==t?void 0:t.draftServiceSettings)),triggerSettings:kt(a(null==t?void 0:t.triggerSettings,null==t?void 0:t.draftTriggerSettings)),inviteSettings:Zt(a(null==t?void 0:t.inviteSettings,null==t?void 0:t.draftInviteSettings)),intentionSettings:Ft(a(null==t?void 0:t.intentionSettings,null==t?void 0:t.draftIntentionSettings)),emotionSettings:Pt(a(null==t?void 0:t.emotionSettings,null==t?void 0:t.draftEmotionSettings)),summarySettings:Ut(a(null==t?void 0:t.summarySettings,null==t?void 0:t.draftSummarySettings)),rateDownSettings:Et(a(null==t?void 0:t.rateDownSettings,null==t?void 0:t.draftRateDownSettings)),toolsSettings:It(a(null==t?void 0:t.toolsSettings,null==t?void 0:t.draftToolsSettings))},e.next=13,(0,_.sK)(s);case 13:n=e.sent,re.Z.debug("ä¿å­˜æœºå™¨äººé…ç½®æ¨¡æ¿: ",n,s),n&&200===n.code?(L.yw.success(de.formatMessage({id:"common.saved",defaultMessage:"ä¿å­˜æˆåŠŸ"})),it.current=JSON.stringify(null!==(i=null!==(r=null==n?void 0:n.data)&&void 0!==r?r:t)&&void 0!==i?i:{}),nt(!1),yt(Ze)):L.yw.error((null==n?void 0:n.message)||de.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("ä¿å­˜å¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"save.failed",defaultMessage:"ä¿å­˜å¤±è´¥"}));case 22:return e.prev=22,Ye(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),At=function(){var e=c()(d()().mark((function e(){var t,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft){e.next=3;break}return vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šå‘å¸ƒæœºå™¨äººé…ç½®"),e.abrupt("return");case 3:if(null!=He&&He.uid){e.next=6;break}return L.yw.warning(de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})),e.abrupt("return");case 6:if(et(!0),e.prev=7,!st){e.next=11;break}return e.next=11,Rt();case 11:return t={uid:He.uid,orgUid:null==ce?void 0:ce.uid},e.next=14,(0,_.KF)(t);case 14:(a=e.sent)&&200===a.code?(L.yw.success(de.formatMessage({id:"common.published",defaultMessage:"å‘å¸ƒæˆåŠŸ"})),it.current=JSON.stringify(null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{}),nt(!1),yt(Ze,{keepActive:!0})):L.yw.error((null==a?void 0:a.message)||de.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("å‘å¸ƒå¤±è´¥:",e.t0),L.yw.error(de.formatMessage({id:"publish.failed",defaultMessage:"å‘å¸ƒå¤±è´¥"}));case 22:return e.prev=22,et(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),qt=(0,s.useMemo)((function(){return null!=He&&He.uid?[{key:"welcome",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(k.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"æ¬¢è¿è¯­è®¾ç½®"})]}),children:(0,se.jsx)(ae.Z,{serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})},{key:"tips",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(Z.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"æç¤ºä¿¡æ¯"})]}),children:(0,se.jsx)(te.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})},{key:"service",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(F.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"robot.settings.service",defaultMessage:"æœåŠ¡è®¾ç½®"})]}),children:(0,se.jsx)(ee.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}].concat(o()([]),o()((0,oe.OJ)()?[{key:"inputAssociation",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(P.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"robot.settings.input.association",defaultMessage:"è¾“å…¥è”æƒ³"})]}),children:(0,se.jsx)(Y.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"rate",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(U.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,se.jsx)(ie.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"toolbar",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(E.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,se.jsx)($.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},settingsUid:He.uid,isActive:"toolbar"===Ee,onServiceSettingsChange:Mt})}]:[]),o()((0,oe.OJ)()?[{key:"right",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(I.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,se.jsx)(Q.Z,{variant:"robot",serviceSettings:{live:null==dt?void 0:dt.serviceSettings,draft:null==dt?void 0:dt.draftServiceSettings},onServiceSettingsChange:Mt,settingsUid:He.uid,isActive:"right"===Ee})}]:[]),o()((0,oe.OJ)()?[{key:"trigger",label:(0,se.jsxs)("span",{children:[(0,se.jsx)(R.Z,{})," ",(0,se.jsx)(i.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"})]}),children:(0,se.jsx)(X.Z,{variant:"robot",triggerSettings:{live:null==dt?void 0:dt.triggerSettings,draft:null==dt?void 0:dt.draftTriggerSettings},onTriggerSettingsChange:ht})}]:[]),o()([]),o()([])):[]}),[null==He?void 0:He.uid,dt,Mt,ht,xt,de,Ee]);return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,se.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:ge,children:(0,se.jsxs)(J.Z,{title:de.formatMessage({id:"robot.settings.templates",defaultMessage:"æ¨¡æ¿åˆ—è¡¨"}),extra:gt?(0,se.jsx)(M.ZP,{size:"small",icon:(0,se.jsx)(A.Z,{}),type:"primary",onClick:function(){gt?(De(null),Oe(!0)):vt("robot_settings.permission.create.denied","æ— æƒé™ï¼šåˆ›å»ºæœºå™¨äººé…ç½®")},children:(0,se.jsx)(i.FormattedMessage,{id:"common.new",defaultMessage:"æ–°å»º"})}):null,bodyStyle:{padding:8},loading:ve,children:[(0,se.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,se.jsxs)(h.Z.Compact,{style:{width:"100%"},children:[(0,se.jsx)(x.Z,{placeholder:de.formatMessage({id:"robot.settings.template.search",defaultMessage:"æœç´¢æ¨¡æ¿åç§°"}),value:Ze,onChange:function(e){return Fe(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;Fe(t),St(t)},allowClear:!0,size:"middle"}),(0,se.jsx)(M.ZP,{type:"primary",icon:(0,se.jsx)(P.Z,{}),"aria-label":de.formatMessage({id:"common.search",defaultMessage:"æœç´¢"}),onClick:function(){return St()}})]})}),(0,se.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,se.jsx)(b.Z,{dataSource:bt,locale:{emptyText:(0,se.jsx)(y.Z,{description:de.formatMessage({id:"empty",defaultMessage:"æš‚æ— æ•°æ®"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,se.jsx)(b.Z.Item,{style:je===e.uid?{backgroundColor:fe?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Te(e.uid)},children:(0,se.jsx)(b.Z.Item.Meta,{title:(0,se.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,se.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,se.jsx)(h.Z,{size:4,children:e.isDefault?(0,se.jsx)(S.Z,{color:"blue",children:(0,se.jsx)(i.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null})]}),description:e.description?(0,se.jsx)("div",{style:{color:fe?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,se.jsx)(v.Z.Panel,{children:He?(0,se.jsx)(J.Z,{title:(0,se.jsxs)(h.Z,{children:[(0,se.jsxs)("span",{children:[de.formatMessage({id:"robot.settings.editing",defaultMessage:"ç¼–è¾‘æ¨¡æ¿"}),": ",He.name||He.uid]}),(0,se.jsx)(w.Z,{checked:!!He.enabled,onChange:function(e){return jt(He.uid,e)},disabled:!ft,checkedChildren:de.formatMessage({id:"common.enabled",defaultMessage:"å¯ç”¨"}),unCheckedChildren:de.formatMessage({id:"common.disabled",defaultMessage:"åœç”¨"})}),ft?(0,se.jsx)(M.ZP,{size:"small",icon:(0,se.jsx)(q.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=He,ft?(De(null!=t?t:He),Oe(!0)):vt("robot_settings.permission.update.denied","æ— æƒé™ï¼šç¼–è¾‘æœºå™¨äººé…ç½®")},children:(0,se.jsx)(i.FormattedMessage,{id:"pages.common.edit",defaultMessage:"ç¼–è¾‘"})}):null,mt?(0,se.jsx)(j.Z,{title:de.formatMessage({id:"common.delete.confirm",defaultMessage:"ç¡®å®šè¦åˆ é™¤å—?"}),onConfirm:function(e){null==e||e.stopPropagation(),wt(He)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:de.formatMessage({id:"common.confirm",defaultMessage:"ç¡®å®š"}),cancelText:de.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),children:(0,se.jsx)(M.ZP,{size:"small",danger:!0,icon:(0,se.jsx)(O.Z,{}),onClick:function(e){e.stopPropagation()},children:(0,se.jsx)(i.FormattedMessage,{id:"pages.common.delete",defaultMessage:"åˆ é™¤"})})}):null,He.isDefault?(0,se.jsx)(S.Z,{color:"blue",children:(0,se.jsx)(i.FormattedMessage,{id:"pages.common.default",defaultMessage:"é»˜è®¤"})}):null]}),extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(j.Z,{title:de.formatMessage({id:"settings.publish.online.title",defaultMessage:"å‘å¸ƒåˆ°çº¿ä¸Šç¯å¢ƒ"}),description:de.formatMessage({id:"settings.publish.online.desc",defaultMessage:"åªæœ‰å‘å¸ƒä¹‹åï¼Œæ‰ä¼šåº”ç”¨åˆ°çº¿ä¸Šç¯å¢ƒ"}),okText:de.formatMessage({id:"settings.publish.online.ok",defaultMessage:"ç»§ç»­å‘å¸ƒ"}),cancelText:de.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),At()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,se.jsx)(M.ZP,{onClick:function(e){return e.stopPropagation()},loading:$e,disabled:!ft,type:"default",icon:(0,se.jsx)(N.Z,{}),children:(0,se.jsx)(i.FormattedMessage,{id:"common.publish",defaultMessage:"å‘å¸ƒ"})})}),(0,se.jsx)(M.ZP,{onClick:function(e){e.stopPropagation(),Be(!0)},disabled:!ft,type:"default",icon:(0,se.jsx)(z.Z,{}),children:(0,se.jsx)(i.FormattedMessage,{id:"settings.gray.publish",defaultMessage:"ç°åº¦å‘å¸ƒ"})}),(0,se.jsx)(M.ZP,{onClick:function(){He&&(ot(He),it.current=JSON.stringify(null!=He?He:{}),nt(!1))},disabled:!st||!ft,icon:(0,se.jsx)(K.Z,{}),children:(0,se.jsx)(i.FormattedMessage,{id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,se.jsx)(M.ZP,{type:"primary",loading:Ge,onClick:Rt,disabled:!st||!ft,icon:(0,se.jsx)(D.Z,{}),children:(0,se.jsx)(i.FormattedMessage,{id:"common.save",defaultMessage:"ä¿å­˜"})})]}),children:(0,se.jsx)(n.Z,{activeKey:Ee,onChange:Ie,items:qt})}):(0,se.jsx)(J.Z,{children:(0,se.jsx)(y.Z,{description:de.formatMessage({id:"robot.settings.template.select",defaultMessage:"è¯·ä»å·¦ä¾§é€‰æ‹©æ¨¡æ¿"})})})})]}),(0,se.jsx)(ne.Z,{open:qe,onOpenChange:Oe,orgUid:(null==ce?void 0:ce.uid)||"",record:Ke,onSuccess:function(){Oe(!1),yt(Ze)}}),(0,se.jsxs)(T.Z,{title:de.formatMessage({id:"settings.gray.publish.title",defaultMessage:"ç°åº¦å‘å¸ƒè¯´æ˜"}),open:_e,onCancel:function(){return Be(!1)},footer:[(0,se.jsx)(M.ZP,{onClick:function(){return Be(!1)},children:(0,se.jsx)(i.FormattedMessage,{id:"common.close",defaultMessage:"å…³é—­"})},"close"),(0,se.jsx)(M.ZP,{type:"primary",onClick:function(){Be(!1),i.history.push("/service/channel")},children:(0,se.jsx)(i.FormattedMessage,{id:"settings.gray.publish.go.channel",defaultMessage:"å‰å¾€æ¸ é“é¡µé¢è·å–é“¾æ¥"})},"go")],children:[(0,se.jsx)(C.Z.Paragraph,{children:(0,se.jsx)(i.FormattedMessage,{id:"settings.gray.publish.p1",defaultMessage:"ç°åº¦å‘å¸ƒç”¨äºæµ‹è¯•å½“å‰è‰ç¨¿ï¼ˆdraftï¼‰é…ç½®ï¼Œç‚¹å‡»ä¿å­˜ï¼Œä½†æœªç‚¹å‡»å‘å¸ƒï¼Œä¸ä¼šå½±å“çº¿ä¸Šç¯å¢ƒã€‚"})}),(0,se.jsx)(C.Z.Paragraph,{children:(0,se.jsx)(i.FormattedMessage,{id:"settings.gray.publish.p2",defaultMessage:"åœ¨æ¸ é“é¡µé¢ç”Ÿæˆé“¾æ¥æ—¶å‹¾é€‰â€œç°åº¦æµ‹è¯•â€ï¼Œé“¾æ¥ä¼šè¿½åŠ  {draft1}ï¼›åµŒå…¥å¼è„šæœ¬ä¼šåœ¨ {chatConfig} ä¸­å¢åŠ  {draftTrue}ã€‚",values:{draft1:(0,se.jsx)(C.Z.Text,{code:!0,children:"draft=1"}),chatConfig:(0,se.jsx)(C.Z.Text,{code:!0,children:"chatConfig"}),draftTrue:(0,se.jsx)(C.Z.Text,{code:!0,children:"draft: true"})}})})]})]})},ue=a(43330),ce=a(84176),ge=a.n(ce),fe=a(34512),me=a(94976);function pe(e){return ve.apply(this,arguments)}function ve(){return(ve=c()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/prompt/query/org",{method:"GET",params:f()(f()({},t),{},{channel:me.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e){return he.apply(this,arguments)}function he(){return(he=c()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/prompt/create",{method:"POST",data:f()(f()({},t),{},{channel:me.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return be.apply(this,arguments)}function be(){return(be=c()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/prompt/update",{method:"POST",data:f()(f()({},t),{},{channel:me.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){return Se.apply(this,arguments)}function Se(){return(Se=c()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/prompt/delete",{method:"POST",data:f()(f()({},t),{},{channel:me.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=a(30857),je=a(99036),Te=a(86702),Ce=a(59005),ke=a(50628),Ze=a(60241),Fe=function(e){var t=e.open,a=e.mode,n=e.initialValues,r=e.onCancel,o=e.onSubmit,l=(0,i.useIntl)(),u=(0,s.useRef)(null);(0,s.useEffect)((function(){var e,a;t?null===(e=u.current)||void 0===e||e.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,type:(null==n?void 0:n.type)||"GENERAL",enabled:"boolean"!=typeof(null==n?void 0:n.enabled)||n.enabled,locale:null==n?void 0:n.locale,systemPrompt:null==n?void 0:n.systemPrompt,userPrompt:null==n?void 0:n.userPrompt,variables:null==n?void 0:n.variables,tags:null==n?void 0:n.tags,metadata:null==n?void 0:n.metadata}):null===(a=u.current)||void 0===a||a.resetFields()}),[t,n]);var g="create"===a?l.formatMessage({id:"prompt.create",defaultMessage:"æ–°å»ºæç¤ºè¯"}):l.formatMessage({id:"prompt.edit",defaultMessage:"ç¼–è¾‘æç¤ºè¯"});return(0,se.jsx)(we.Z,{open:t,title:g,onClose:r,width:600,destroyOnHidden:!0,extra:(0,se.jsxs)(h.Z,{children:[(0,se.jsx)(M.ZP,{onClick:function(){var e;null===(e=u.current)||void 0===e||e.resetFields()},children:l.formatMessage({id:"common.reset",defaultMessage:"é‡ç½®"})}),(0,se.jsx)(M.ZP,{onClick:r,children:l.formatMessage({id:"common.cancel",defaultMessage:"å–æ¶ˆ"})}),(0,se.jsx)(M.ZP,{type:"primary",onClick:function(){var e;null===(e=u.current)||void 0===e||e.submit()},children:l.formatMessage({id:"common.confirm",defaultMessage:"ç¡®è®¤"})})]}),children:(0,se.jsxs)(je.A,{formRef:u,layout:"vertical",onFinish:function(){var e=c()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(t);case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submitter:!1,children:[(0,se.jsx)(Te.Z,{name:"uid",hidden:!0}),(0,se.jsx)(Te.Z,{name:"name",label:l.formatMessage({id:"name",defaultMessage:"åç§°"}),rules:[{required:!0,message:l.formatMessage({id:"name.required",defaultMessage:"è¯·è¾“å…¥åç§°"})}],fieldProps:{maxLength:128}}),(0,se.jsx)(Ce.Z,{name:"type",label:l.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),rules:[{required:!0,message:l.formatMessage({id:"type.required",defaultMessage:"è¯·é€‰æ‹©ç±»å‹"})}],options:[{value:"GENERAL",label:l.formatMessage({id:"prompt.type.general",defaultMessage:"é€šç”¨"})},{value:"THREAD_SUMMARY",label:l.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"ä¼šè¯æ€»ç»“"})},{value:"THREAD_INTENTION",label:l.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"ä¼šè¯æ„å›¾"})},{value:"THREAD_EMOTION",label:l.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"ä¼šè¯æƒ…ç»ª"})},{value:"CUSTOMER_PROFILE",label:l.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"å®¢æˆ·ç”»åƒ"})},{value:"TICKET_ASSIST",label:l.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"å·¥å•è¾…åŠ©"})},{value:"THREAD",label:l.formatMessage({id:"prompt.type.legacy.thread",defaultMessage:"ï¼ˆæ—§ï¼‰THREAD"})},{value:"CUSTOMER",label:l.formatMessage({id:"prompt.type.legacy.customer",defaultMessage:"ï¼ˆæ—§ï¼‰CUSTOMER"})},{value:"TICKET",label:l.formatMessage({id:"prompt.type.legacy.ticket",defaultMessage:"ï¼ˆæ—§ï¼‰TICKET"})}]}),(0,se.jsx)(ke.Z,{name:"enabled",label:l.formatMessage({id:"enabled",defaultMessage:"å¯ç”¨"})}),(0,se.jsx)(Te.Z,{name:"description",label:l.formatMessage({id:"description",defaultMessage:"æè¿°"}),fieldProps:{maxLength:512}}),(0,se.jsx)(Ce.Z,{name:"locale",label:l.formatMessage({id:"locale",defaultMessage:"è¯­è¨€"}),allowClear:!0,showSearch:!0,options:[{value:"zh-CN",label:l.formatMessage({id:"prompt.locale.zh-CN",defaultMessage:"ç®€ä½“ä¸­æ–‡(zh-CN)"})},{value:"en-US",label:l.formatMessage({id:"prompt.locale.en-US",defaultMessage:"English (en-US)"})},{value:"zh-TW",label:l.formatMessage({id:"prompt.locale.zh-TW",defaultMessage:"ç¹é«”ä¸­æ–‡(zh-TW)"})}]}),(0,se.jsx)(Ze.Z,{name:"systemPrompt",label:l.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"}),fieldProps:{rows:6}}),(0,se.jsx)(Ze.Z,{name:"userPrompt",label:l.formatMessage({id:"prompt.user",defaultMessage:"User Prompt"}),fieldProps:{rows:8}}),(0,se.jsx)(Ze.Z,{name:"variables",label:l.formatMessage({id:"prompt.variables",defaultMessage:"å˜é‡(JSON)"}),tooltip:l.formatMessage({id:"prompt.variables.tip",defaultMessage:"å»ºè®®å¡«å†™ JSON å¯¹è±¡å­—ç¬¦ä¸²ï¼ŒæŒ‰éœ€ç”±è°ƒç”¨æ–¹æ¸²æŸ“/æ›¿æ¢"}),fieldProps:{rows:4}}),(0,se.jsx)(Ze.Z,{name:"tags",label:l.formatMessage({id:"prompt.tags",defaultMessage:"æ ‡ç­¾(JSONæ•°ç»„)"}),tooltip:l.formatMessage({id:"prompt.tags.tip",defaultMessage:'å»ºè®®å¡«å†™ JSON æ•°ç»„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ ["support","sales"]'}),fieldProps:{rows:3}}),(0,se.jsx)(Ze.Z,{name:"metadata",label:l.formatMessage({id:"prompt.metadata",defaultMessage:"å…ƒæ•°æ®(JSON)"}),tooltip:l.formatMessage({id:"prompt.metadata.tip",defaultMessage:"æ‰©å±•å­—æ®µï¼ŒæŒ‰ä¸šåŠ¡è‡ªå®šä¹‰"}),fieldProps:{rows:4}})]})})},Pe=["current","pageSize"],Ue=function(){var e,t,a,n,r,o,l,u,g=(0,i.useIntl)(),m=(0,i.useAccess)(),v=(0,s.useRef)(),h=(0,B.u)((function(e){return e.currentOrg})),x={GENERAL:{text:g.formatMessage({id:"prompt.type.general",defaultMessage:"é€šç”¨"})},THREAD_SUMMARY:{text:g.formatMessage({id:"prompt.type.thread.summary",defaultMessage:"ä¼šè¯æ€»ç»“"})},THREAD_INTENTION:{text:g.formatMessage({id:"prompt.type.thread.intention",defaultMessage:"ä¼šè¯æ„å›¾"})},THREAD_EMOTION:{text:g.formatMessage({id:"prompt.type.thread.emotion",defaultMessage:"ä¼šè¯æƒ…ç»ª"})},CUSTOMER_PROFILE:{text:g.formatMessage({id:"prompt.type.customer.profile",defaultMessage:"å®¢æˆ·ç”»åƒ"})},TICKET_ASSIST:{text:g.formatMessage({id:"prompt.type.ticket.assist",defaultMessage:"å·¥å•è¾…åŠ©"})},THREAD:{text:g.formatMessage({id:"prompt.type.legacy.thread",defaultMessage:"ï¼ˆæ—§ï¼‰THREAD"})},CUSTOMER:{text:g.formatMessage({id:"prompt.type.legacy.customer",defaultMessage:"ï¼ˆæ—§ï¼‰CUSTOMER"})},TICKET:{text:g.formatMessage({id:"prompt.type.legacy.ticket",defaultMessage:"ï¼ˆæ—§ï¼‰TICKET"})}},b={"zh-CN":{text:g.formatMessage({id:"prompt.locale.zh-CN",defaultMessage:"ç®€ä½“ä¸­æ–‡(zh-CN)"})},"en-US":{text:g.formatMessage({id:"prompt.locale.en-US",defaultMessage:"English (en-US)"})},"zh-TW":{text:g.formatMessage({id:"prompt.locale.zh-TW",defaultMessage:"ç¹é«”ä¸­æ–‡(zh-TW)"})}},y=(0,s.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,G.MY.PROMPT)}),[m]),w=null!==(e=null==y||null===(t=y.canRead)||void 0===t?void 0:t.call(y))&&void 0!==e&&e,T=null!==(a=null==y||null===(n=y.canCreate)||void 0===n?void 0:n.call(y))&&void 0!==a&&a,C=null!==(r=null==y||null===(o=y.canUpdate)||void 0===o?void 0:o.call(y))&&void 0!==r&&r,k=null!==(l=null==y||null===(u=y.canDelete)||void 0===u?void 0:u.call(y))&&void 0!==l&&l,Z=(0,s.useState)(!1),F=p()(Z,2),P=F[0],U=F[1],E=(0,s.useState)("create"),I=p()(E,2),R=I[0],A=I[1],q=(0,s.useState)(void 0),O=p()(q,2),N=O[0],z=O[1],K=function(){A("create"),z(void 0),U(!0)},D=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:g.formatMessage({id:"name",defaultMessage:"åç§°"}),dataIndex:"name",copyable:!0,ellipsis:!0,sorter:!0,fixed:"left"},{title:g.formatMessage({id:"type",defaultMessage:"ç±»å‹"}),dataIndex:"type",valueType:"select",width:160,valueEnum:x,render:function(e,t){var a,s=(null==t?void 0:t.type)||"-",n=(null==x||null===(a=x[s])||void 0===a?void 0:a.text)||s;return(0,se.jsx)(S.Z,{children:n})}},{title:g.formatMessage({id:"description",defaultMessage:"æè¿°"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:g.formatMessage({id:"locale",defaultMessage:"è¯­è¨€"}),dataIndex:"locale",valueType:"select",width:110,ellipsis:!0,copyable:!0,valueEnum:b},{title:g.formatMessage({id:"prompt.system",defaultMessage:"System Prompt"}),dataIndex:"systemPrompt",width:360,ellipsis:!0,copyable:!0,hideInSearch:!0},{title:g.formatMessage({id:"prompt.user",defaultMessage:"User Prompt"}),dataIndex:"userPrompt",width:360,ellipsis:!0,copyable:!0,hideInSearch:!0},{title:g.formatMessage({id:"prompt.variables",defaultMessage:"å˜é‡(JSON)"}),dataIndex:"variables",width:220,ellipsis:!0,copyable:!0,hideInSearch:!0},{title:g.formatMessage({id:"prompt.tags",defaultMessage:"æ ‡ç­¾(JSONæ•°ç»„)"}),dataIndex:"tags",width:200,ellipsis:!0,copyable:!0,hideInSearch:!0},{title:g.formatMessage({id:"prompt.metadata",defaultMessage:"å…ƒæ•°æ®(JSON)"}),dataIndex:"metadata",width:220,ellipsis:!0,copyable:!0,hideInSearch:!0},{title:g.formatMessage({id:"enabled",defaultMessage:"å¯ç”¨"}),dataIndex:"enabled",valueType:"select",width:100,valueEnum:{true:{text:g.formatMessage({id:"yes",defaultMessage:"æ˜¯"})},false:{text:g.formatMessage({id:"no",defaultMessage:"å¦"})}},render:function(e,t){return null!=t&&t.enabled?(0,se.jsx)(S.Z,{color:"green",children:"ON"}):(0,se.jsx)(S.Z,{color:"default",children:"OFF"})}},{title:g.formatMessage({id:"updatedAt",defaultMessage:"æ›´æ–°æ—¶é—´"}),dataIndex:"updatedAt",width:200,hideInSearch:!0,sorter:!0},{title:g.formatMessage({id:"action",defaultMessage:"æ“ä½œ"}),valueType:"option",width:160,fixed:"right",render:function(e,t){return[(0,se.jsx)("a",{onClick:function(){C?function(e){A("edit"),z(e),U(!0)}(t):L.yw.warning(g.formatMessage({id:"prompt.permission.update.denied",defaultMessage:"æ— æƒé™ï¼šç¼–è¾‘æç¤ºè¯"}))},children:g.formatMessage({id:"edit",defaultMessage:"ç¼–è¾‘"})},"edit"),(0,se.jsx)(j.Z,{title:g.formatMessage({id:"delete.confirm",defaultMessage:"ç¡®è®¤åˆ é™¤ï¼Ÿ"}),onConfirm:c()(d()().mark((function e(){var a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.delete.denied",defaultMessage:"æ— æƒé™ï¼šåˆ é™¤æç¤ºè¯"})),e.abrupt("return");case 3:if(null!=t&&t.uid){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,ye({uid:t.uid});case 7:200===(null==(a=e.sent)?void 0:a.code)?(L.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"åˆ é™¤æˆåŠŸ"})),null===(s=v.current)||void 0===s||s.reload()):L.yw.error((null==a?void 0:a.message)||g.formatMessage({id:"delete.failed",defaultMessage:"åˆ é™¤å¤±è´¥"}));case 9:case"end":return e.stop()}}),e)}))),children:(0,se.jsx)("a",{children:g.formatMessage({id:"delete",defaultMessage:"åˆ é™¤"})})},"delete")]}}];return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(fe.Z,{columns:D,actionRef:v,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=c()(d()().mark((function e(t,a){var s,n,i,r,o,l,u,c,m,p,v;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=3;break}return L.yw.warning(g.formatMessage({id:"prompt.permission.read.denied",defaultMessage:"æ— æƒé™ï¼šæŸ¥çœ‹æç¤ºè¯"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return r=(i=t).current,o=i.pageSize,"true"===(null==(l=ge()(i,Pe))?void 0:l.enabled)?l.enabled=!0:"false"===(null==l?void 0:l.enabled)&&(l.enabled=!1),a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],u=m,c="ascend"===a[m]?"ascend":"descend"),p=f()(f()({pageNumber:(r||1)-1,pageSize:o||10,orgUid:null==h?void 0:h.uid},l),{},{sortBy:u,sortDirection:c}),e.next=9,pe(p);case 9:return v=e.sent,re.Z.debug("PromptTab queryPromptsByOrg:",v,p),e.abrupt("return",{data:(null==v||null===(s=v.data)||void 0===s?void 0:s.content)||[],success:!0,total:(null==v||null===(n=v.data)||void 0===n?void 0:n.totalElements)||0});case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0},headerTitle:g.formatMessage({id:"menu.robot.prompt",defaultMessage:"æç¤ºè¯"}),toolBarRender:function(){return T?[(0,se.jsx)(M.ZP,{type:"primary",onClick:K,children:g.formatMessage({id:"create",defaultMessage:"æ–°å»º"})},"create")]:[]}}),(0,se.jsx)(Fe,{open:P,mode:R,initialValues:N,onCancel:function(){return U(!1)},onSubmit:function(){var e=c()(d()().mark((function e(t){var a,s,n,i,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=f()(f()({},t),{},{orgUid:null==h?void 0:h.uid}),"create"!==R){e.next=8;break}return e.next=5,Me(a);case 5:return 200===(null==(s=e.sent)?void 0:s.code)?(L.yw.success(g.formatMessage({id:"create.success",defaultMessage:"åˆ›å»ºæˆåŠŸ"})),U(!1),null===(n=v.current)||void 0===n||n.reload()):L.yw.error((null==s?void 0:s.message)||g.formatMessage({id:"create.failed",defaultMessage:"åˆ›å»ºå¤±è´¥"})),e.abrupt("return");case 8:return e.next=10,xe(a);case 10:200===(null==(i=e.sent)?void 0:i.code)?(L.yw.success(g.formatMessage({id:"update.success",defaultMessage:"æ›´æ–°æˆåŠŸ"})),U(!1),null===(r=v.current)||void 0===r||r.reload()):L.yw.error((null==i?void 0:i.message)||g.formatMessage({id:"update.failed",defaultMessage:"æ›´æ–°å¤±è´¥"})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),L.yw.error(g.formatMessage({id:"save.error",defaultMessage:"ä¿å­˜å‡ºé”™"}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()})]})},Ee=function(){var e,t,a,s,r,o,l,d,u=(0,i.useAccess)(),c=null!==(e=null==u||null===(t=u.hasAnyModulePermission)||void 0===t?void 0:t.call(u,G.MY.ROBOT))&&void 0!==e&&e,g=null!==(a=null==u||null===(s=u.hasAnyModulePermission)||void 0===s?void 0:s.call(u,G.MY.ROBOT_SETTINGS))&&void 0!==a&&a,f=null!==(r=null==u||null===(o=u.hasAnyModulePermission)||void 0===o?void 0:o.call(u,G.MY.PROMPT))&&void 0!==r&&r,m=[];if(c&&m.push({key:"table",label:(0,se.jsx)(i.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,se.jsx)(ue.Z,{robotType:me.f4h})}),g&&m.push({key:"settings",label:(0,se.jsx)(i.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,se.jsx)(de,{})}),c&&m.push({key:"agent",label:(0,se.jsx)(i.FormattedMessage,{id:"menu.robot.agent",defaultMessage:"æ™ºèƒ½ä½“"}),children:(0,se.jsx)(ue.Z,{robotType:me.Qeb})}),f&&m.push({key:"prompt",label:(0,se.jsx)(i.FormattedMessage,{id:"menu.robot.prompt",defaultMessage:"Prompt"}),children:(0,se.jsx)(Ue,{})}),0===m.length)return null;var p=String(null!==(l=null===(d=m[0])||void 0===d?void 0:d.key)&&void 0!==l?l:"table");return(0,se.jsx)(n.Z,{defaultActiveKey:p,style:{padding:"10px"},items:m})}}}]);