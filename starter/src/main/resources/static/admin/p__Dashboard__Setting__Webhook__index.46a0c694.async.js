"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6892],{76750:function(e,t,n){var a=n(55735),r=n(65461),s=n(41159);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(a.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(a.VoP)||null!=t&&t.startsWith("ROLE_")?(0,r.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,r.aS)(t,10)}}}},72469:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var a=n(73193),r=n.n(a),s=n(84176),o=n.n(s),l=n(86222),u=n.n(l),i=n(90819),c=n.n(i),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),h=n(86803),m=n(55735),b=n(41159);function v(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/webhook/query/org",{method:"GET",params:r()(r()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return y.apply(this,arguments)}function y(){return(y=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/webhook/create",{method:"POST",data:r()(r()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return k.apply(this,arguments)}function k(){return(k=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/webhook/update",{method:"POST",data:r()(r()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/webhook/delete",{method:"POST",data:r()(r()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return Z.apply(this,arguments)}function Z(){return(Z=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/webhook/delete/all",{method:"POST",data:r()(r()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=n(40612),C=n(15722),F=n(10162),W=n(54881),O=n(58275),q=n(2484),I=n(48524),E=n(53530),P=n(29266),V=n(61355),R=n(75365),D=n(96485),B=n(44194),U=n(69169),z=n(4499),K=n(84881),L=n(32350),N=n(73442),_=n(31549),G=function(e){var t=e.isEdit,n=e.webhook,a=e.open,s=e.onClose,o=e.onSubmit,l=U.A.useForm(),u=g()(l,1)[0],i=(0,T.u)((function(e){return e.currentOrg}));return(0,B.useEffect)((function(){t?u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,color:null==n?void 0:n.color}):u.setFieldsValue({name:"",type:"",color:"blue"})}),[t,n,u]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(N.Z,{title:"Webhook",width:600,onClose:s,open:a,children:(0,_.jsxs)(U.A,{form:u,name:"webhookForm",onFinish:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=r()(r()({},e),{},{orgUid:null==i?void 0:i.uid});console.log("submit",t),o(t)}))},children:[(0,_.jsx)(z.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,_.jsx)(K.Z,{name:"type",label:"类型",width:"md",options:[{label:"消息通知",value:"message"},{label:"事件通知",value:"event"},{label:"状态通知",value:"status"}],rules:[{required:!0}]}),(0,_.jsx)(K.Z,{name:"color",label:"颜色",width:"md",options:[{label:"red",value:"red"},{label:"magenta",value:"magenta"},{label:"volcano",value:"volcano"},{label:"orange",value:"orange"},{label:"gold",value:"gold"},{label:"lime",value:"lime"},{label:"green",value:"green"},{label:"cyan",value:"cyan"},{label:"blue",value:"blue"},{label:"geekblue",value:"geekblue"},{label:"purple",value:"purple"}],rules:[{required:!0}]}),(0,_.jsx)(L.Z,{label:"描述",name:"description"})]})})})},J=n(76750),Q=["current","pageSize"],H=function(){var e=(0,b.useIntl)(),t=(0,B.useRef)(),n=(0,J.Z)().translateString,a=(0,B.useState)(1),s=g()(a,2),l=(s[0],s[1]),i=(0,B.useState)(10),d=g()(i,2),p=(d[0],d[1]),m=(0,T.u)((function(e){return e.currentOrg})),x=(0,B.useState)(!1),y=g()(x,2),k=y[0],j=y[1],Z=(0,B.useState)({}),U=g()(Z,2),z=U[0],K=U[1],L=(0,B.useState)(!1),N=g()(L,2),H=N[0],X=N[1],Y=E.Z.useModal(),$=g()(Y,2),ee=$[0],te=$[1],ne=(0,B.useState)([]),ae=g()(ne,2),re=ae[0],se=ae[1],oe=(0,B.useState)([]),le=g()(oe,2),ue=le[0],ie=le[1],ce=(0,B.useState)(0),de=g()(ce,2),fe=de[0],pe=de[1],ge=(0,B.useState)({}),he=g()(ge,2),me=(he[0],he[1]),be=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,_.jsx)(b.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,_.jsx)(b.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(P.Z,{color:"blue",children:t.type})})}},{title:(0,_.jsx)(b.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,_.jsx)(b.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],ve=[].concat(be,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,a,r,s){return[(0,_.jsx)("a",{onClick:function(){K(a),X(!0),j(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,_.jsx)(V.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(a.name),"】？"),onConfirm:function(){return xe(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,_.jsx)(C.Z,{style:{color:"red"}}),children:(0,_.jsx)(R.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),xe=function(){var n=f()(c()().mark((function n(a){var r;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteWebhook:",a),n.next=3,S(a);case 3:r=n.sent,console.log("deleteWebhook:",r),200===r.code?(h.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):h.yw.error(r.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),we=function(){var e=f()(c()().mark((function e(n){var a,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(n);case 2:a=e.sent,console.log("handleCreateWebhook response:",a),200===a.code?(null===(r=t.current)||void 0===r||r.reload(),j(!1)):h.yw.error(a.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=f()(c()().mark((function e(n){var a,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==z?void 0:z.uid,e.next=3,M(n);case 3:a=e.sent,console.log("handleUpdateWebhook response:",a),200===a.code?(null===(r=t.current)||void 0===r||r.reload(),j(!1)):h.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){j(!0),X(!1),K({})},ke=function(){var n=f()(c()().mark((function n(){var a,r,s,o,l,i;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ue.length){n.next=3;break}return h.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),n.abrupt("return");case 3:h.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,s=0,o=u()(ue),n.prev=7,o.s();case 9:if((l=o.n()).done){n.next=23;break}return i=l.value,n.prev=11,n.next=14,S(i);case 14:200===n.sent.code?r++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:h.yw.destroy(),0===s?h.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:r})):h.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:r,fail:s})),se([]),ie([]),null===(a=t.current)||void 0===a||a.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Se=function(){var n=f()(c()().mark((function n(){var a,r,s;return c()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==fe){n.next=3;break}return h.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return h.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,a={orgUid:null==m?void 0:m.uid},n.next=8,A(a);case 8:200===(r=n.sent).code?(h.yw.destroy(),h.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(h.yw.destroy(),h.yw.error(r.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),h.yw.destroy(),h.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(){return n.apply(this,arguments)}}(),je={selectedRowKeys:re,onChange:function(e,t){se(e),ie(t)}},Ae=function(){var e=f()(c()().mark((function e(t,n,a){var s,u,i,d,f;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,u=t.pageSize,i=o()(t,Q),l(s),p(u),me(i),d=r()({pageNumber:s-1,pageSize:u,orgUid:null==m?void 0:m.uid},i),e.next=7,v(d);case 7:return f=e.sent,console.log("queryWebhooksByOrg response:",f,d),200===f.code?pe(f.data.totalElements):h.yw.error(f.message),e.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();return(0,_.jsxs)(_.Fragment,{children:[k&&(0,_.jsx)(G,{isEdit:H,open:k,webhook:z,onClose:function(){j(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),H?ye(e):we(e)}}),(0,_.jsx)(I.Z,{columns:ve,actionRef:t,cardBordered:!0,rowSelection:je,request:Ae,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),p(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return t=[(0,_.jsx)(R.ZP,{type:"primary",icon:(0,_.jsx)(F.Z,{}),onClick:Me,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],n=[],re.length>0&&n.push({key:"batchDelete",icon:(0,_.jsx)(W.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(re.length,")"),onClick:function(){ee.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(re.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:ke,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,_.jsx)(O.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){ee.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:Se,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.length>0&&t.push((0,_.jsx)(D.Z,{menu:{items:n},placement:"bottom",children:(0,_.jsxs)(R.ZP,{type:re.length>0?"primary":"default",danger:re.length>0,children:[re.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(re.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,_.jsx)(q.Z,{})]})},"batchOperations")),t;var t,n}}),te]})}}}]);