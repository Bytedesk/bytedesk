"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3368],{83381:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(83910),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=r(5901),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},90092:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(83910),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},s=r(5901),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},403:function(e,t,r){r.d(t,{Z:function(){return z}});var n=r(73193),o=r.n(n),a=r(90819),s=r.n(a),i=r(89933),l=r.n(i),u=r(45332),c=r.n(u),d=r(70157),f=r(44194),m=r(11950),p=r(77686),g=r(61489),h=r(62395),v=r(66248),y=r(11853),x=r(72264),w=r(13243),R=r(60593),j=r(70097),C=r(99754),P=r(83381),Z=r(90092),b=r(68992),M=r(89007),k=r(47268),S=r(26608),E=r(70878),O=r(31549),$=function(e){var t=e.open,r=e.superUser,n=e.isEdit,o=e.role,a=e.onCancel,i=e.onSubmit,u=E.Z.useForm(),d=c()(u,1)[0],m=(0,h.useIntl)(),y=(0,p.u)((function(e){return e.currentOrg}));(0,f.useEffect)((function(){n&&o?d.setFieldsValue({uid:o.uid,name:o.name,description:o.description}):d.resetFields()}),[n,o]);var x=function(){d.validateFields().then(function(){var e=l()(s()().mark((function e(t){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==o?void 0:o.uid:"",name:t.name,description:t.description,authorityUids:[],orgUid:null==y?void 0:y.uid,level:r?b.Hxq:b.whQ},i(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),g.yw.error(m.formatMessage({id:"role.message.operation.failed"}))}))};return(0,O.jsx)(v.Z,{title:m.formatMessage({id:n?"role.edit.title":"role.create.title"}),open:t,forceRender:!0,onOk:x,onCancel:a,children:(0,O.jsxs)(M.A,{form:d,name:"roleForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,O.jsx)(k.Z,{label:m.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0,message:m.formatMessage({id:"role.name.required"})}],fieldProps:{onPressEnter:function(){d.validateFields(["description"]).then((function(){x()}))}}}),(0,O.jsx)(S.Z,{label:m.formatMessage({id:"role.description"}),name:"description",rules:[{required:!0,message:m.formatMessage({id:"role.description.required"})}],fieldProps:{onPressEnter:function(){x()},autoSize:{minRows:2,maxRows:6}}})]})})},z=function(e){var t=e.superUser,r=(0,h.useIntl)(),n=(0,j.Z)().isDarkMode,a=v.Z.useModal(),i=c()(a,2),u=i[0],M=i[1],k=(0,C.Z)().translateString,S=(0,f.useState)(!1),E=c()(S,2),z=E[0],F=E[1],G=(0,f.useState)(""),U=c()(G,2),I=U[0],q=U[1],N=(0,f.useState)(!1),A=c()(N,2),H=A[0],T=A[1],L=(0,p.u)((function(e){return e.currentOrg})),V=(0,d.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform,insertRole:e.insertRole,insertRolePlatform:e.insertRolePlatform,upgradeRole:e.upgradeRole,upgradeRolePlatform:e.upgradeRolePlatform,currentRole:e.currentRole,currentRolePlatform:e.currentRolePlatform,removeRole:e.removeRole,removeRolePlatform:e.removeRolePlatform,setCurrentRole:e.setCurrentRole,setCurrentRolePlatform:e.setCurrentRolePlatform}})),B=V.roleResult,D=V.roleResultPlatform,Q=V.setRoleResult,W=V.setRoleResultPlatform,X=V.insertRole,J=V.insertRolePlatform,_=V.upgradeRole,K=V.upgradeRolePlatform,Y=V.removeRole,ee=V.removeRolePlatform,te=V.currentRole,re=V.currentRolePlatform,ne=V.setCurrentRole,oe=V.setCurrentRolePlatform,ae=t?re:te,se=function(e){return[b.jGk,b.w7Z,b.nGQ,b.gJI].includes(null==e?void 0:e.uid)||!0===(null==e?void 0:e.system)},ie=function(){var e=l()(s()().mark((function e(){var n,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:100,orgUid:t?"":null==L?void 0:L.uid,level:t?b.Hxq:b.whQ,searchText:I},e.next=4,(0,m.E9)(n);case 4:o=e.sent,console.log("queryRolesByOrg response: ",o.data,n),200===o.code?(g.yw.destroy(),t?(W(o),""===(null==re?void 0:re.uid)&&o.data.content.length>0&&oe(o.data.content[0])):(Q(o),""===(null==te?void 0:te.uid)&&o.data.content.length>0&&ne(o.data.content[0]))):(g.yw.destroy(),g.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){ie()}),[I,null==L?void 0:L.uid]);var le=function(){var e=l()(s()().mark((function e(n){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"creating"})),e.next=3,(0,m.fA)(o()({},n));case 3:200===(a=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"create.success"})),F(!1),t?(J(a.data),oe(a.data)):(X(a.data),ne(a.data))):(g.yw.destroy(),g.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=l()(s()().mark((function e(n){var o,a,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,authorityUids:(null==n||null===(o=n.authorities)||void 0===o?void 0:o.map((function(e){return e.uid})))||[],system:t},g.yw.loading(r.formatMessage({id:"updating"})),e.next=4,(0,m.ul)(a);case 4:200===(i=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success"})),t?K(i.data):_(i.data),F(!1)):(g.yw.destroy(),g.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=l()(s()().mark((function e(n){var o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"deleting"})),e.next=3,(0,m.Rd)(n);case 3:200===(o=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"delete.success"})),t?ee(n.uid):Y(n.uid),F(!1),ie()):(g.yw.destroy(),g.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=t?D.data.content:B.data.content;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(y.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[(0,O.jsx)(x.ZP,{type:"primary",size:"small",icon:(0,O.jsx)(Z.Z,{}),onClick:function(){T(!1),F(!0)},children:r.formatMessage({id:"create"})}),(0,O.jsx)(x.ZP,{size:"small",onClick:ie,children:r.formatMessage({id:"refresh"})}),!se(ae)&&(null==ae?void 0:ae.uid)&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(x.ZP,{size:"small",onClick:function(){se(ae)?g.yw.error(r.formatMessage({id:"role.system.noedit"})):(T(!0),F(!0))},children:r.formatMessage({id:"edit"})}),(0,O.jsx)(x.ZP,{onClick:function(){return function(e){se(e)?g.yw.error(r.formatMessage({id:"role.system.nodelete"})):u.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,O.jsx)(P.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm"}),"【").concat(k(e.name),"】？"),onOk:function(){ce(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}(ae)},size:"small",style:{float:"right"},danger:!0,children:r.formatMessage({id:"delete"})})]})]}),(0,O.jsx)("div",{style:{margin:5},children:(0,O.jsx)(w.Z.Search,{placeholder:r.formatMessage({id:"role.search.placeholder",defaultMessage:"搜索角色名称"}),value:I,onChange:function(e){return q(e.target.value)},onSearch:function(){return ie()},allowClear:!0,style:{width:"100%"}})}),(0,O.jsx)(R.Z,{dataSource:de,renderItem:function(e){return(0,O.jsx)(R.Z.Item,{style:{backgroundColor:(null==ae?void 0:ae.uid)===e.uid?n?"#333333":"#dddddd":void 0,cursor:"pointer"},onClick:function(){return r=e,void(t?oe(r):ne(r));var r},children:(0,O.jsx)(R.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,O.jsx)(O.Fragment,{children:k(e.name)}),description:k(e.description)})},e.uid)}}),z&&(0,O.jsx)($,{open:z,superUser:t,isEdit:H,role:ae,onCancel:function(){F(!1)},onSubmit:function(e){H?ue(e):le(e)}}),M]})}},98323:function(e,t,r){r.d(t,{Z:function(){return k}});var n=r(44194),o=r(44528),a=r(73193),s=r.n(a),i=r(76711),l=r.n(i),u=r(90819),c=r.n(u),d=r(89933),f=r.n(d),m=r(45332),p=r.n(m),g=r(61489),h=r(68992),v=r(62395);function y(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/authority/query/org",{method:"GET",params:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(99754),R=r(70157),j=r(63052),C=r(941),P=r(11950),Z=r(31549),b={width:"20%",textAlign:"center"},M=function(e){var t=e.superUser,r=(0,v.useIntl)(),o=(0,w.Z)().translateString,a=(0,n.useState)({uid:""}),i=p()(a,2),u=i[0],d=i[1],m=(0,R.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole,currentRolePlatform:e.currentRolePlatform,setCurrentRolePlatform:e.setCurrentRolePlatform}})),x=m.upgradeRole,M=m.currentRole,k=m.setCurrentRole,S=m.currentRolePlatform,E=m.setCurrentRolePlatform,O=(0,n.useState)([]),$=p()(O,2),z=$[0],F=$[1],G=(0,n.useState)(M.authorities),U=p()(G,2),I=U[0],q=U[1],N=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,level:h.Hxq},e.next=3,y(t);case 3:r=e.sent,console.log("getAuthorities response",r),200===r.code?F(r.data.content):(console.log("getAuthorities error",r),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=z.reduce((function(e,t){var r=t.name.split("_"),n=p()(r,1)[0];return e[n]||(e[n]=[]),e[n].push(t),e}),{});(0,n.useEffect)((function(){t?(d(S),q(S.authorities)):(d(M),q(M.authorities))}),[M,S,t]),(0,n.useEffect)((function(){N()}),[]);var H=function(e){return e.some((function(e){return I.some((function(t){return t.name===e.name}))}))},T=function(){var e=f()(c()().mark((function e(t){var n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",n),g.yw.loading(r.formatMessage({id:"updating"})),e.next=5,(0,P.ul)(n);case 5:o=e.sent,console.log("updateRole:",o),200===o.code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),x(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,Z.jsx)(Z.Fragment,{children:Object.keys(A).map((function(e){return(0,Z.jsx)(j.Z,{title:(0,Z.jsx)(C.Z,{checked:(r=A[e],r.every((function(e){return I.some((function(t){return t.name===e.name}))}))),indeterminate:H(A[e]),onChange:function(r){return function(e,r){var n,o=A[e];r?(n=l()(I),o.forEach((function(e){n.some((function(t){return t.name===e.name}))||n.push(e)}))):n=I.filter((function(e){return!o.some((function(t){return t.name===e.name}))})),q(n),t?(E(s()(s()({},S),{},{authorities:n})),T(s()(s()({},S),{},{authorities:n}))):(k(s()(s()({},M),{},{authorities:n})),T(s()(s()({},M),{},{authorities:n})))}(e,r.target.checked)},disabled:(null==u?void 0:u.system)||""===(null==u?void 0:u.uid),children:o(e)}),style:{marginTop:10},children:A[e].map((function(e){return(0,Z.jsx)(j.Z.Grid,{style:b,children:(0,Z.jsx)(C.Z,{checked:null==I?void 0:I.some((function(t){return t.name===e.name})),disabled:!0,children:o(e.name)})},e.name)}))},e);var r}))})},k=function(e){var t=e.superUser,r=[{key:"authority",label:"权限",children:(0,Z.jsx)(M,{superUser:t})}];return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(o.Z,{defaultActiveKey:"1",items:r,onChange:function(e){console.log(e)}})})}},38552:function(e,t,r){var n=r(70097);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},11853:function(e,t,r){r.d(t,{Z:function(){return C}});var n=r(44194),o=r(51865),a=r.n(o),s=r(21762),i=r(66692),l=r(35738),u=r(11973),c=r(10750);const d=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],m=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var p=function(e,t){return a()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const r=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${r}`]:r&&d.includes(r)}})(e,t)),((e,t)=>{const r={};return m.forEach((n=>{r[`${e}-align-${n}`]=t.align===n})),r[`${e}-align-stretch`]=!t.align&&!!t.vertical,r})(e,t)),((e,t)=>{const r={};return f.forEach((n=>{r[`${e}-justify-${n}`]=t.justify===n})),r})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,r={};return d.forEach((e=>{r[`${t}-wrap-${e}`]={flexWrap:e}})),r},y=e=>{const{componentCls:t}=e,r={};return m.forEach((e=>{r[`${t}-align-${e}`]={alignItems:e}})),r},x=e=>{const{componentCls:t}=e,r={};return f.forEach((e=>{r[`${t}-justify-${e}`]={justifyContent:e}})),r};var w=(0,u.I$)("Flex",(e=>{const{paddingXS:t,padding:r,paddingLG:n}=e,o=(0,c.IX)(e,{flexGapSM:t,flexGap:r,flexGapLG:n});return[g(o),h(o),v(o),y(o),x(o)]}),(()=>({})),{resetStyle:!1}),R=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};const j=n.forwardRef(((e,t)=>{const{prefixCls:r,rootClassName:o,className:u,style:c,flex:d,gap:f,vertical:m=!1,component:g="div",children:h}=e,v=R(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component","children"]),{flex:y,direction:x,getPrefixCls:j}=n.useContext(l.E_),C=j("flex",r),[P,Z,b]=w(C),M=null!=m?m:null==y?void 0:y.vertical,k=a()(u,o,null==y?void 0:y.className,C,Z,b,p(C,e),{[`${C}-rtl`]:"rtl"===x,[`${C}-gap-${f}`]:(0,i.n)(f),[`${C}-vertical`]:M}),S=Object.assign(Object.assign({},null==y?void 0:y.style),c);return d&&(S.flex=d),f&&!(0,i.n)(f)&&(S.gap=f),P(n.createElement(g,Object.assign({ref:t,className:k,style:S},(0,s.Z)(v,["justify","wrap","align"])),h))}));var C=j}}]);