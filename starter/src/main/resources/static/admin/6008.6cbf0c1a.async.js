"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6008],{8369:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return g},hS:function(){return m},z_:function(){return l}});var r=n(90819),i=n.n(r),a=n(73193),u=n.n(a),s=n(89933),c=n.n(s),o=n(27353),d=n(2290);function l(e){return f.apply(this,arguments)}function f(){return(f=c()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/query/org",{method:"GET",params:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=c()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/create",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=c()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/update",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=c()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/member/delete",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},6008:function(e,t,n){n.d(t,{Z:function(){return Z}});var r=n(19058),i=n(2290),a=n(90819),u=n.n(a),s=n(73193),c=n.n(s),o=n(89933),d=n.n(o),l=n(45332),f=n.n(l),p=n(50884),h=n(8369),m=n(25155),v=n(28520),g=n(1181),y=n(27353),b=n(97765),k=n(97368),w=n(23294),x=n(18464),M=n(44194),T=n(31549),I=function(e){var t=e.ticket,n=e.threadUid,r=e.isThreadTicket,a=void 0!==r&&r,s=(0,v.u)((function(e){return e.currentOrg})),o=(0,M.useState)([]),l=f()(o,2),I=l[0],Z=l[1],U=(0,M.useState)(!1),j=f()(U,2),S=j[0],q=j[1],z=(0,i.useIntl)(),R=(0,g.Z)(),C=R.memberResult,E=R.setMemberResult,F=(0,M.useState)(t),J=f()(F,2),A=J[0],O=J[1],P=function(){var e=d()(u()().mark((function e(t){var n,r,i,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null==t?void 0:t.ticketUid,(r=null==t?void 0:t.processInstanceId)||n){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,q(!0),i=c()({pageNumber:0,pageSize:100},r?{processInstanceId:r}:{uid:n}),e.next=9,(0,m.EH)(i);case 9:a=e.sent,b.Z.debug("queryTicketHistoryActivity response:",null==a?void 0:a.data,i),200===a.code?Z((null==a?void 0:a.data)||[]):(b.Z.debug("queryTicketHistoryActivity error:",null==a?void 0:a.data),p.yw.error(a.message)),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("Fetch ticket history error:",e.t0),p.yw.error(z.formatMessage({id:"ticket.history.fetch.failed",defaultMessage:"获取工单历史记录失败"}));case 18:return e.prev=18,q(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[4,14,18,21]])})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=d()(u()().mark((function e(t){var n,r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return O(void 0),e.abrupt("return");case 3:return e.prev=3,q(!0),n={threadUid:t,orgUid:null==s?void 0:s.uid},e.next=8,(0,m.sY)(n);case 8:r=e.sent,b.Z.debug("queryTicketByThreadUid response:",null==r?void 0:r.data,n),200===r.code?(i=null==r?void 0:r.data,O(i),i||p.yw.warning(z.formatMessage({id:"ticket.thread.related.notFound",defaultMessage:"未找到该会话关联的工单"}))):p.yw.error(r.message),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),console.error("Fetch ticket by threadUid error:",e.t0),p.yw.error(z.formatMessage({id:"ticket.thread.ticket.fetch.failed",defaultMessage:"获取关联工单失败"}));case 17:return e.prev=17,q(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[3,13,17,20]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=d()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.yw.loading(z.formatMessage({id:"loading",defaultMessage:"加载中"})),t={pageNumber:0,pageSize:100,orgUid:null==s?void 0:s.uid},e.next=4,(0,h.z_)(t);case 4:n=e.sent,b.Z.debug("queryMembersByOrg: ",null==n?void 0:n.data,t),200===n.code?(p.yw.destroy(),E(n)):p.yw.destroy();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,M.useEffect)((function(){Z([]),a?X(n):O(t)}),[a,n,null==t?void 0:t.uid]),(0,M.useEffect)((function(){L()}),[null==s?void 0:s.uid]),(0,M.useEffect)((function(){null!=A&&A.uid&&P({ticketUid:A.uid,processInstanceId:A.processInstanceId})}),[null==A?void 0:A.uid,null==A?void 0:A.processInstanceId]);var N=function(e){var t;if(!e)return"-";var n=((null==C||null===(t=C.data)||void 0===t?void 0:t.content)||[]).find((function(t){return t.uid===e}));return(null==n?void 0:n.nickname)||""};return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)(k.Z,{spinning:S,children:[(0,T.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center"},children:z.formatMessage({id:"ticket.history.activity.title",defaultMessage:"活动历史"})}),(0,T.jsx)(w.Z,{direction:"vertical",size:"small",current:I.length-1,style:{padding:"16px"},items:I.map((function(e,t){var n,r;return{title:(r=null==e?void 0:e.activityName,(r?r===y.sM_||r===y.Yux||r===y.sFW||r===y.W66||r===y.z1||r===y.yZA||r===y.pIN||r===y.XrC||r===y.L1h||r===y.yib||r===y.hwr||r===y.AzB||r===y.frw||r===y.xw4||r===y.qQU||r===y.GJZ?z.formatMessage({id:"ticket.status.".concat((r||"").toLowerCase())}):r:"")||z.formatMessage({id:"ticket.activity.default",defaultMessage:"活动"})),description:(0,T.jsxs)("div",{children:[(null==e?void 0:e.assignee)&&(0,T.jsxs)("div",{children:[z.formatMessage({id:"ticket.history.assignee",defaultMessage:"处理人"}),": ",N(null==e?void 0:e.assignee)||(null==e?void 0:e.assignee)]}),(0,T.jsxs)("div",{children:[z.formatMessage({id:"ticket.history.time",defaultMessage:"处理时间"}),": ",(null===(n=e.startTime)||void 0===n?void 0:n.toLocaleString())||"-"]})]}),status:t===I.length-1?"process":"finish"}}))}),0===I.length&&(0,T.jsx)(x.Z,{description:z.formatMessage({id:"ticket.history.selectToViewFlow",defaultMessage:"请选择工单查看流转过程"})})]})})},Z=function(e){var t=e.open,n=e.ticket,a=e.threadUid,u=e.isThreadTicket,s=void 0!==u&&u,c=e.onClose,o=(0,i.useIntl)();return(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(r.Z,{open:t,onClose:function(){null==c||c()},title:o.formatMessage({id:"ticket.detail",defaultMessage:"工单详情"}),children:(0,T.jsx)(I,{ticket:n,threadUid:a,isThreadTicket:s})})})}},1181:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(27353),i=n(26557),a=n(26407),u=n(20744),s=(0,i.Ue)()((0,a.mW)((0,a.tJ)((0,u.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);