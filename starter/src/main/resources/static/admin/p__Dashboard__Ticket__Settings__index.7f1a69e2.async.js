"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5800],{81838:function(e,t,n){n.d(t,{dI:function(){return g},xg:function(){return c}});var s=n(90819),i=n.n(s),r=n(73193),a=n.n(r),o=n(89933),u=n.n(o),l=n(27353),d=n(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/form/query/org",{method:"GET",params:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/form/delete",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},275:function(e,t,n){n.d(t,{Bo:function(){return v},Gx:function(){return c},OI:function(){return M},Q3:function(){return g},hW:function(){return k},sz:function(){return p}});var s=n(90819),i=n.n(s),r=n(73193),a=n.n(r),o=n(89933),u=n.n(o),l=n(27353),d=n(2290);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/query/org",{method:"GET",params:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/update",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/delete",{method:"POST",data:{uid:t,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/deploy",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/reset",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/ticket/process/undeploy",{method:"POST",data:a()(a()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},60016:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return p},Gv:function(){return M},bD:function(){return g},mE:function(){return k},nQ:function(){return j},nU:function(){return v},oX:function(){return Z}});var s=n(90819),i=n.n(s),r=n(73193),a=n.n(r),o=n(89933),u=n.n(o),l=n(2290),d=n(27353);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){var n,s,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,s=t.workgroupUid,r=t.type,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(s),{method:"GET",params:{channel:d.XtJ,type:r}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return y.apply(this,arguments)}function y(){return(y=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return w.apply(this,arguments)}function w(){return(w=u()(i()().mark((function e(t,n){var s,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.uid,r=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(s,"/orgs/").concat(r,"/bindings"),{method:"POST",data:a()(a()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:a()(a()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},90938:function(e,t,n){var s=n(96775);t.Z=function(){var e=(0,s.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},20973:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ae}});var s=n(73193),i=n.n(s),r=n(90819),a=n.n(r),o=n(89933),u=n.n(o),l=n(45332),d=n.n(l),c=n(44194),f=n(2290),g=n(10820),m=n(15911),p=n(90883),h=n(46206),v=n(31461),x=n(2887),M=n(18464),y=n(38623),k=n(50693),b=n(70937),j=n(9848),w=n(6430),Z=n(5415),C=n(71389),S=n(6992),T=n(41881),F=n(91768),P=n(28172),I=n(35911),E=n(90417),q=n(50884),O=n(28520),A=n(96775),N=n(90938),U=n(60016),L=n(26557),z=n(26407),J=n(20744),B=n(27353),X=(0,L.Ue)()((0,z.mW)((0,z.tJ)((0,J.n)((function(e){return{currentTicketSettings:null,ticketSettingsMap:{},setCurrentTicketSettings:function(t){return e({currentTicketSettings:t})},setTicketSettingsForWorkgroup:function(t,n){return e((function(e){e.ticketSettingsMap[t]=n}))},updateCurrentTicketSettings:function(t){return e((function(e){e.currentTicketSettings&&("function"==typeof t?t(e.currentTicketSettings):e.currentTicketSettings=i()(i()({},e.currentTicketSettings),t))}))},removeTicketSettingsForWorkgroup:function(t){return e((function(e){delete e.ticketSettingsMap[t]}))},clearAll:function(){return e({currentTicketSettings:null,ticketSettingsMap:{}})}}})),{name:B.rpR+"_TICKET"}))),D=n(64724),W=n(69159),Q=n(528),_=n(41455),G=n(46589),R=n(48518),H=n(85121),K=n(30235),V=n(48861),$=n(34937),Y=n(63508),ee=n(97588),te=n(31549),ne=D.Z.Text,se=D.Z.Title,ie=function(e){var t=e.record,n=e.form,s=W.Z.useWatch(t.showField,n);return(0,te.jsx)(ee.A.Item,{name:t.requireField,valuePropName:"checked",noStyle:!0,children:(0,te.jsx)(Q.Z,{disabled:!s})})},re=function(e){var t,n,s,i=e.settings,r=e.onChange,a=e.hideRequireLogin,o=void 0!==a&&a,u=e.hideContactFields,l=void 0!==u&&u,g=(0,f.useIntl)(),m=ee.A.useForm(),p=d()(m,1)[0];(0,c.useEffect)((function(){p.setFieldsValue(i)}),[i,p]);var x=W.Z.useWatch("numberPrefix",p),M=W.Z.useWatch("numberLength",p),y=W.Z.useWatch("enableAutoClose",p),b=null!==(t=null!=x?x:i.numberPrefix)&&void 0!==t?t:"",j=null!==(n=null!=M?M:i.numberLength)&&void 0!==n?n:0,Z=("boolean"==typeof y||i.enableAutoClose,Math.max(0,j-(null!==(s=null==b?void 0:b.length)&&void 0!==s?s:0))),C=Z>0?"".concat("0".repeat(Math.max(Z-3,0)),"123").slice(-Z):"123",S="".concat(b).concat(C);(0,c.useMemo)((function(){return[{value:B.vXk,label:g.formatMessage({id:"ticket.settings.assignment.type.round_robin",defaultMessage:"轮询分配"})},{value:B.tSv,label:g.formatMessage({id:"ticket.settings.assignment.type.manual",defaultMessage:"手动分配"})}]}),[g]);return(0,te.jsxs)(ee.A,{form:p,layout:"vertical",submitter:!1,style:{padding:"20px 0"},onValuesChange:function(e){return r(e)},children:[(0,te.jsxs)("div",{style:{marginBottom:32},children:[(0,te.jsxs)(h.Z,{size:"small",children:[(0,te.jsx)(w.Z,{}),(0,te.jsx)(se,{level:5,style:{margin:0},children:g.formatMessage({id:"ticket.settings.basic.section.number",defaultMessage:"工单编号设置"})})]}),(0,te.jsxs)(_.Z,{gutter:24,children:[(0,te.jsx)(G.Z,{span:12,children:(0,te.jsx)(ee.A.Item,{name:"numberPrefix",label:(0,te.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.numberPrefix",defaultMessage:"工单编号前缀"}),(0,te.jsx)(R.Z,{title:g.formatMessage({id:"ticket.settings.basic.numberPrefix.tooltip",defaultMessage:"工单编号的前缀，如 TK、WO 等"}),children:(0,te.jsx)($.Z,{style:{color:"#999"}})})]}),children:(0,te.jsx)(v.Z,{maxLength:10,placeholder:g.formatMessage({id:"ticket.settings.basic.numberPrefix.placeholder",defaultMessage:"如：TK、WO"})})})}),(0,te.jsx)(G.Z,{span:12,children:(0,te.jsx)(ee.A.Item,{name:"numberLength",label:(0,te.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.numberLength",defaultMessage:"编号长度"}),(0,te.jsx)(R.Z,{title:g.formatMessage({id:"ticket.settings.basic.numberLength.tooltip",defaultMessage:"工单编号的总长度，包括前缀"}),children:(0,te.jsx)($.Z,{style:{color:"#999"}})})]}),children:(0,te.jsx)(H.Z,{min:Math.max(b.length+1,6),max:20,placeholder:g.formatMessage({id:"ticket.settings.basic.numberLength.placeholder",defaultMessage:"如：8"})})})})]}),(0,te.jsx)(ne,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.sample",defaultMessage:"示例编号：{sample}"},{sample:S})})]}),!o&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(K.Z,{style:{margin:"16px 0"}}),(0,te.jsxs)("div",{children:[(0,te.jsx)(se,{level:5,children:g.formatMessage({id:"ticket.settings.basic.section.visitor",defaultMessage:"访客创建限制"})}),(0,te.jsx)(ee.A.Item,{name:"requireLogin",label:g.formatMessage({id:"ticket.settings.basic.requireLogin.label",defaultMessage:"必须登录后才能创建工单"}),valuePropName:"checked",children:(0,te.jsx)(k.Z,{checkedChildren:g.formatMessage({id:"ticket.settings.basic.requireLogin.on",defaultMessage:"需要登录"}),unCheckedChildren:g.formatMessage({id:"ticket.settings.basic.requireLogin.off",defaultMessage:"允许匿名"})})}),(0,te.jsx)(ne,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.requireLogin.desc",defaultMessage:"启用后，访客必须先通过登录认证才能提交工单。"})})]})]}),(0,te.jsx)(K.Z,{style:{margin:"16px 0"}}),(0,te.jsxs)("div",{style:{marginBottom:32},children:[(0,te.jsx)(se,{level:5,children:g.formatMessage({id:"ticket.settings.basic.section.tips",defaultMessage:"工单提示语"})}),(0,te.jsx)(ee.A.Item,{name:"accessTip",label:g.formatMessage({id:"ticket.settings.basic.accessTip",defaultMessage:"工单接入提示语"}),tooltip:g.formatMessage({id:"ticket.settings.basic.accessTip.tooltip",defaultMessage:"当工单会话首次打开（线程状态 NEW）时发送给访客，并将会话转为对话中（CHATTING）。"}),children:(0,te.jsx)(v.Z.TextArea,{rows:3,maxLength:2e3,showCount:!0,placeholder:g.formatMessage({id:"ticket.settings.basic.accessTip.placeholder",defaultMessage:"例如：您好，工单已创建，我们将尽快为您处理。"})})}),(0,te.jsx)(ee.A.Item,{name:"closeTip",label:g.formatMessage({id:"ticket.settings.basic.closeTip",defaultMessage:"工单关闭提示语"}),tooltip:g.formatMessage({id:"ticket.settings.basic.closeTip.tooltip",defaultMessage:"当会话已关闭时用于提示（关闭状态下仅允许查看聊天记录）。"}),children:(0,te.jsx)(v.Z.TextArea,{rows:3,maxLength:2e3,showCount:!0,placeholder:g.formatMessage({id:"ticket.settings.basic.closeTip.placeholder",defaultMessage:"例如：本工单会话已关闭，如需帮助请提交新工单。"})})}),(0,te.jsxs)(_.Z,{gutter:24,children:[(0,te.jsx)(G.Z,{span:12,children:(0,te.jsx)(ee.A.Item,{name:"agentTimeoutTip",label:g.formatMessage({id:"ticket.settings.basic.agentTimeoutTip",defaultMessage:"客服超时未回复提示语"}),tooltip:g.formatMessage({id:"ticket.settings.basic.agentTimeoutTip.tooltip",defaultMessage:"预留：用于客服长时间未回复时的自动提示。"}),children:(0,te.jsx)(v.Z.TextArea,{rows:3,maxLength:2e3,showCount:!0,placeholder:g.formatMessage({id:"ticket.settings.basic.agentTimeoutTip.placeholder",defaultMessage:"例如：抱歉久等了，我们正在处理中，请稍候。"})})})}),(0,te.jsx)(G.Z,{span:12,children:(0,te.jsx)(ee.A.Item,{name:"visitorTimeoutTip",label:g.formatMessage({id:"ticket.settings.basic.visitorTimeoutTip",defaultMessage:"访客超时未回复提示语"}),tooltip:g.formatMessage({id:"ticket.settings.basic.visitorTimeoutTip.tooltip",defaultMessage:"预留：用于访客长时间未回复时的自动提示。"}),children:(0,te.jsx)(v.Z.TextArea,{rows:3,maxLength:2e3,showCount:!0,placeholder:g.formatMessage({id:"ticket.settings.basic.visitorTimeoutTip.placeholder",defaultMessage:"例如：如您暂时不方便回复，后续可随时继续补充信息。"})})})})]}),(0,te.jsx)(ne,{type:"secondary",children:g.formatMessage({id:"ticket.settings.basic.tips.desc",defaultMessage:"提示：上述提示语支持纯文本；如留空则不主动发送。"})})]}),!l&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(K.Z,{style:{margin:"16px 0"}}),(0,te.jsxs)("div",{children:[(0,te.jsxs)(h.Z,{size:"small",style:{marginBottom:16},children:[(0,te.jsx)(Y.Z,{}),(0,te.jsx)(se,{level:5,style:{margin:0},children:g.formatMessage({id:"ticket.settings.basic.section.contact",defaultMessage:"联系方式字段设置"})})]}),(0,te.jsx)(ne,{type:"secondary",style:{display:"block",marginBottom:16},children:g.formatMessage({id:"ticket.settings.basic.contact.desc",defaultMessage:"配置访客提交工单时需要填写的联系方式字段，控制字段的显示和是否必填。"})}),(0,te.jsx)(V.Z,{dataSource:[{key:"contactName",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.contactName",defaultMessage:"联系人姓名"}),showField:"showContactName",requireField:"requireContactName"},{key:"email",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.email",defaultMessage:"邮箱"}),showField:"showEmail",requireField:"requireEmail"},{key:"phone",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.phone",defaultMessage:"手机号"}),showField:"showPhone",requireField:"requirePhone"},{key:"wechat",fieldName:g.formatMessage({id:"ticket.settings.basic.contact.field.wechat",defaultMessage:"微信"}),showField:"showWechat",requireField:"requireWechat"}],columns:[{title:g.formatMessage({id:"ticket.settings.basic.contact.column.field",defaultMessage:"字段名称"}),dataIndex:"fieldName",key:"fieldName",width:"40%"},{title:g.formatMessage({id:"ticket.settings.basic.contact.column.show",defaultMessage:"显示"}),dataIndex:"showField",key:"showField",width:"30%",render:function(e,t){return(0,te.jsx)(ee.A.Item,{name:t.showField,valuePropName:"checked",noStyle:!0,children:(0,te.jsx)(Q.Z,{})})}},{title:(0,te.jsxs)(h.Z,{children:[g.formatMessage({id:"ticket.settings.basic.contact.column.required",defaultMessage:"必填"}),(0,te.jsx)(R.Z,{title:g.formatMessage({id:"ticket.settings.basic.contact.column.required.tooltip",defaultMessage:"仅当字段显示时，必填设置才生效"}),children:(0,te.jsx)($.Z,{style:{color:"#999"}})})]}),dataIndex:"requireField",key:"requireField",width:"30%",render:function(e,t){return(0,te.jsx)(ie,{record:t,form:p})}}],pagination:!1,size:"small",bordered:!0})]})]})]})},ae=n(76711),oe=n.n(ae),ue=n(99065),le=n(35746),de=n(97368),ce=n(24839),fe=n(95199),ge=n(47192),me=n(92395),pe=n(67702),he=n(48586),ve=n(7603),xe=n(27403),Me=n(21002),ye=D.Z.Text,ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"tmp_".concat(e,"_").concat(Math.floor(1e3*Math.random()))},be=function(e){return oe()(e).sort((function(e,t){var n,s,i=null!==(n=e.orderIndex)&&void 0!==n?n:0,r=null!==(s=t.orderIndex)&&void 0!==s?s:0;return i===r?(e.name||"").localeCompare(t.name||""):i-r}))},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e,t){var n,s,i,r,a;return{uid:null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:ke(t),name:(null!==(s=null==e?void 0:e.name)&&void 0!==s?s:"").trim(),description:null!==(i=null==e?void 0:e.description)&&void 0!==i?i:"",enabled:!1!==(null==e?void 0:e.enabled),defaultCategory:null!==(r=null==e?void 0:e.defaultCategory)&&void 0!==r&&r,orderIndex:null!==(a=null==e?void 0:e.orderIndex)&&void 0!==a?a:t}})),n=be(t).map((function(e,t){return i()(i()({},e),{},{orderIndex:t})})),s=!1,r=n.map((function(e){return e.defaultCategory&&e.enabled?s?i()(i()({},e),{},{defaultCategory:!1}):(s=!0,e):e}));if(!s){var a=r.findIndex((function(e){return e.enabled}));a>=0&&(r[a]=i()(i()({},r[a]),{},{defaultCategory:!0}),s=!0)}return!s&&r.length>0&&(r[0]=i()(i()({},r[0]),{},{defaultCategory:!0,enabled:!0})),r},we=function(e){var t=e.items,n=e.onChange,s=e.categoryType,r=(0,f.useIntl)(),o=(0,Me.Z)().translateString,l=W.Z.useForm(),g=d()(l,1)[0],m=(0,c.useState)(!1),x=d()(m,2),j=x[0],w=x[1],Z=(0,c.useState)(null),C=d()(Z,2),S=C[0],P=C[1],I=(0,O.u)((function(e){return e.currentOrg})),E=(0,ve.v)((function(e){return e.categoryTreeOptions})),A=(0,ve.v)((function(e){return e.categoryResult})),N=(0,c.useState)(!1),U=d()(N,2),L=U[0],z=U[1],J=(0,c.useState)([]),X=d()(J,2),D=X[0],Q=X[1],_=(0,c.useState)(!1),G=d()(_,2),H=G[0],K=G[1],$=null!=s?s:B.hXJ,Y=(0,c.useMemo)((function(){return je(null!=t?t:[])}),[t]),ee=(0,c.useMemo)((function(){var e,t=Y.filter((function(e){return e.enabled})).length;return{enabled:t,disabled:Y.length-t,defaultUid:null===(e=Y.find((function(e){return e.defaultCategory&&e.enabled})))||void 0===e?void 0:e.uid}}),[Y]);(0,c.useEffect)((function(){null!=I&&I.uid&&(0,xe.HK)($,I.uid,void 0,B.whQ,{pageSize:200,showLoading:!1})}),[null==I?void 0:I.uid,$]);var ne=(0,c.useMemo)((function(){return E.filter((function(e){return e.key!==B.zBg}))}),[E]),se=(0,c.useMemo)((function(){var e,t=[];return function e(n){null!=n&&n.length&&n.forEach((function(n){var s;null!=n&&n.uid&&n.uid!==B.zBg&&(t.push(n),null!==(s=n.children)&&void 0!==s&&s.length&&e(n.children))}))}(null==A||null===(e=A.data)||void 0===e?void 0:e.content),t}),[A]),ie=(0,c.useMemo)((function(){var e=new Map;return se.forEach((function(t){t.uid&&e.set(t.uid,t)})),e}),[se]);(0,c.useEffect)((function(){if(L){var e=Y.map((function(e){return e.uid})).filter((function(e){return"string"==typeof e&&e.length>0}));Q(e)}}),[L,Y]);var re=function(e){n(je(e))},ae=function(){var e=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=I&&I.uid){e.next=3;break}return q.yw.warning(r.formatMessage({id:"ticket.settings.category.select.noOrg",defaultMessage:"请先选择一个组织"})),e.abrupt("return");case 3:if(z(!0),0!==ne.length){e.next=12;break}return K(!0),e.prev=6,e.next=9,(0,xe.HK)($,I.uid,void 0,B.whQ,{pageSize:200,showLoading:!1});case 9:return e.prev=9,K(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])})));return function(){return e.apply(this,arguments)}}(),be=function(e,t){if(e){var n=oe()(Y),s=n.findIndex((function(t){return t.uid===e}));if(!(s<0)){var r="up"===t?s-1:s+1;if(!(r<0||r>=n.length)){var a=n.splice(s,1),o=d()(a,1)[0];n.splice(r,0,o);var u=n.map((function(e,t){return i()(i()({},e),{},{orderIndex:t})}));re(u)}}}},we=function(){var e=u()(a()().mark((function e(){var t,n,s,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(s=e.sent,null!=S&&S.uid){e.next=6;break}return e.abrupt("return");case 6:o=i()(i()({},S),{},{name:s.name.trim(),description:(null!==(t=s.description)&&void 0!==t?t:"").trim(),enabled:!1!==s.enabled,defaultCategory:!0===s.defaultCategory,orderIndex:null!==(n=S.orderIndex)&&void 0!==n?n:0}),u=Y.map((function(e){return e.uid===S.uid?i()(i()({},e),o):e})),re(u),w(!1),P(null),g.resetFields(),q.yw.success(r.formatMessage({id:"ticket.settings.category.update.success",defaultMessage:"分类已更新"})),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),Ze=[{title:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.name",defaultMessage:"分类名称"}),dataIndex:"name",key:"name",render:function(e,t){return(0,te.jsxs)(h.Z,{size:8,children:[t.defaultCategory&&t.enabled?(0,te.jsx)(y.Z,{color:"gold",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.badge",defaultMessage:"默认"})}):null,(0,te.jsx)(ye,{strong:!0,children:o(t.name)||"--"})]})}},{title:(0,te.jsx)(f.FormattedMessage,{id:"common.status",defaultMessage:"状态"}),dataIndex:"enabled",key:"enabled",render:function(e,t){return(0,te.jsx)(k.Z,{checked:!!t.enabled,onChange:function(e){return function(e,t){if(e){var n=Y.map((function(n){return n.uid===e?i()(i()({},n),{},{enabled:t}):n}));re(n)}}(t.uid,e)}})}},{title:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default",defaultMessage:"默认分类"}),dataIndex:"defaultCategory",key:"defaultCategory",render:function(e,t){return(0,te.jsx)(R.Z,{title:t.enabled?r.formatMessage({id:"ticket.settings.category.makeDefault",defaultMessage:"设为默认分类"}):r.formatMessage({id:"ticket.settings.category.default.disabled",defaultMessage:"启用后方可设为默认"}),children:(0,te.jsx)(p.ZP,{type:"text",icon:t.enabled&&t.defaultCategory?(0,te.jsx)(fe.Z,{style:{color:"#faad14"}}):(0,te.jsx)(ge.Z,{}),disabled:!t.enabled,onClick:function(){return function(e){if(e){var t=Y.map((function(t){return i()(i()({},t),{},{defaultCategory:t.uid===e})}));re(t)}}(t.uid)}})})}},{title:(0,te.jsx)(f.FormattedMessage,{id:"common.order",defaultMessage:"排序"}),key:"order",render:function(e,t,n){return(0,te.jsxs)(h.Z,{children:[(0,te.jsx)(R.Z,{title:r.formatMessage({id:"common.move.up",defaultMessage:"上移"}),children:(0,te.jsx)(p.ZP,{type:"text",icon:(0,te.jsx)(me.Z,{}),disabled:0===n,onClick:function(){return be(t.uid,"up")}})}),(0,te.jsx)(R.Z,{title:r.formatMessage({id:"common.move.down",defaultMessage:"下移"}),children:(0,te.jsx)(p.ZP,{type:"text",icon:(0,te.jsx)(pe.Z,{}),disabled:n===Y.length-1,onClick:function(){return be(t.uid,"down")}})})]})}},{title:(0,te.jsx)(f.FormattedMessage,{id:"common.actions",defaultMessage:"操作"}),key:"actions",render:function(e,t){return(0,te.jsxs)(h.Z,{size:8,children:[(0,te.jsx)(p.ZP,{type:"link",icon:(0,te.jsx)(T.Z,{}),onClick:function(){return function(e){P(e),g.setFieldsValue({name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory}),w(!0)}(t)},children:(0,te.jsx)(f.FormattedMessage,{id:"common.edit",defaultMessage:"编辑"})}),(0,te.jsx)(b.Z,{title:r.formatMessage({id:"ticket.settings.category.delete.confirm",defaultMessage:"确认删除该分类？"}),onConfirm:function(){return function(e){if(e){var t=Y.filter((function(t){return t.uid!==e}));re(t),q.yw.success(r.formatMessage({id:"ticket.settings.category.delete.success",defaultMessage:"分类已删除"}))}}(t.uid)},okText:r.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:r.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,te.jsx)(p.ZP,{type:"link",danger:!0,icon:(0,te.jsx)(F.Z,{}),children:(0,te.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})})]})}}];return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(ue.Z,{title:(0,te.jsxs)(h.Z,{size:8,children:[(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.title",defaultMessage:"分类列表"}),(0,te.jsx)(y.Z,{color:"blue",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.summary",defaultMessage:"启用 {enabled} / 禁用 {disabled}",values:{enabled:ee.enabled,disabled:ee.disabled}})}),ee.defaultUid?(0,te.jsx)(y.Z,{color:"gold",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.current",defaultMessage:"默认已设置"})}):(0,te.jsx)(y.Z,{color:"red",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.default.missing",defaultMessage:"请设置默认分类"})})]}),extra:(0,te.jsx)(p.ZP,{type:"primary",icon:(0,te.jsx)(he.Z,{}),onClick:ae,children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.selectFromTree",defaultMessage:"从分类树选择"})}),styles:{body:{padding:0}},children:[(0,te.jsx)(V.Z,{columns:Ze,dataSource:Y,rowKey:function(e){var t,n;return null!==(t=null!==(n=e.uid)&&void 0!==n?n:e.name)&&void 0!==t?t:ke()},pagination:!1}),(0,te.jsx)("div",{style:{padding:"16px 24px"},children:(0,te.jsx)(ye,{type:"secondary",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.hint",defaultMessage:"至少保留一个启用的分类，并指定默认分类供访客预选。"})})})]}),(0,te.jsx)(le.Z,{open:L,title:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.title",defaultMessage:"选择工单分类"}),onOk:function(){if(0!==D.length){var e=new Set(D),t=Y.filter((function(t){return t.uid&&e.has(t.uid)})),n=[];D.forEach((function(e){var s;if(!t.some((function(t){return t.uid===e}))){var i=ie.get(e);i&&n.push({uid:i.uid,name:null!==(s=i.name)&&void 0!==s?s:i.uid,description:"",enabled:!0,defaultCategory:!1,orderIndex:t.length+n.length})}}));var s=[].concat(oe()(t),n);re(s),z(!1),q.yw.success(r.formatMessage({id:"ticket.settings.category.select.success",defaultMessage:"分类列表已更新"}))}else q.yw.warning(r.formatMessage({id:"ticket.settings.category.select.empty",defaultMessage:"请选择至少一个分类"}))},onCancel:function(){z(!1),K(!1)},confirmLoading:H,destroyOnHidden:!0,width:480,okText:r.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:r.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,te.jsxs)(h.Z,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,te.jsx)(ye,{type:"secondary",children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.tip",defaultMessage:"勾选需要在工单配置中启用的分类。"})}),H?(0,te.jsx)("div",{style:{textAlign:"center",padding:"32px 0"},children:(0,te.jsx)(de.Z,{})}):ne.length>0?(0,te.jsx)(ce.Z,{checkable:!0,selectable:!1,checkedKeys:D,onCheck:function(e){var t;Array.isArray(e)?Q(e):Q(null!==(t=e.checked)&&void 0!==t?t:[])},treeData:ne,height:360,titleRender:function(e){var t="string"==typeof e.title?e.title:"",n=o(t)||t||"--";return(0,te.jsx)(R.Z,{title:n,children:n})}}):(0,te.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.select.emptyTree",defaultMessage:"暂无可用分类，请先在分类管理中创建。"})})]})}),(0,te.jsx)(le.Z,{open:j,title:S?r.formatMessage({id:"ticket.settings.category.modal.edit",defaultMessage:"编辑分类"}):r.formatMessage({id:"ticket.settings.category.modal.create",defaultMessage:"新增分类"}),onOk:we,onCancel:function(){w(!1),P(null),g.resetFields()},destroyOnHidden:!0,width:520,children:(0,te.jsxs)(W.Z,{form:g,layout:"vertical",children:[(0,te.jsx)(W.Z.Item,{name:"name",label:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.name",defaultMessage:"分类名称"}),rules:[{required:!0,message:r.formatMessage({id:"ticket.settings.category.form.name.required",defaultMessage:"请输入分类名称"})},{max:32,message:r.formatMessage({id:"ticket.settings.category.form.name.length",defaultMessage:"名称长度不超过32个字符"})}],children:(0,te.jsx)(v.Z,{placeholder:r.formatMessage({id:"ticket.settings.category.form.name.placeholder",defaultMessage:"例如：售后支持"}),allowClear:!0})}),(0,te.jsx)(W.Z.Item,{name:"description",label:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.description",defaultMessage:"描述"}),rules:[{max:120,message:r.formatMessage({id:"ticket.settings.category.form.description.length",defaultMessage:"描述长度不超过120个字符"})}],children:(0,te.jsx)(v.Z.TextArea,{rows:3,placeholder:r.formatMessage({id:"ticket.settings.category.form.description.placeholder",defaultMessage:"用于帮助访客理解分类用途，可选填"}),allowClear:!0})}),(0,te.jsx)(W.Z.Item,{name:"enabled",label:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,te.jsx)(k.Z,{})}),(0,te.jsx)(W.Z.Item,{name:"defaultCategory",label:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.category.form.default",defaultMessage:"设为默认分类"}),valuePropName:"checked",children:(0,te.jsx)(k.Z,{disabled:0===Y.length&&!S})})]})})]})},Ze=function(e){var t=e.open,n=e.record,s=e.ticketType,i=e.onClose,r=e.onSuccess,o=(0,f.useIntl)(),l=(0,O.u)((function(e){return e.currentOrg})),g=W.Z.useForm(),m=d()(g,1)[0],p=(0,c.useState)(!1),h=d()(p,2),x=h[0],M=h[1],y=!(null==n||!n.uid);(0,c.useEffect)((function(){t&&(m.resetFields(),n&&m.setFieldsValue({name:n.name,description:n.description}))}),[t,null==n?void 0:n.uid]);var k=function(){var e=u()(a()().mark((function e(){var t,u,d,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.validateFields();case 3:if(t=e.sent,null!=l&&l.uid){e.next=6;break}return e.abrupt("return");case 6:if(M(!0),u=n?n.type===B.IpQ?B.IpQ:B.dCh:s,!y){e.next=15;break}return e.next=11,(0,U.mE)({uid:n.uid,orgUid:l.uid,name:t.name,description:t.description,type:u});case 11:200===(null==(d=e.sent)?void 0:d.code)?(q.yw.success(o.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),r(d.data),i()):q.yw.error((null==d?void 0:d.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),e.next=19;break;case 15:return e.next=17,(0,U.Gv)({orgUid:l.uid,name:t.name,description:t.description,type:u});case 17:200===(null==(c=e.sent)?void 0:c.code)?(q.yw.success(o.formatMessage({id:"common.created",defaultMessage:"创建成功"})),r(c.data),i()):q.yw.error((null==c?void 0:c.message)||o.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"}));case 19:return e.prev=19,M(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,,19,22]])})));return function(){return e.apply(this,arguments)}}();return(0,te.jsx)(le.Z,{title:y?o.formatMessage({id:"ticket.settings.edit.title",defaultMessage:"编辑工单配置"}):o.formatMessage({id:"ticket.settings.create.title",defaultMessage:"新建工单配置"}),width:520,open:t,onCancel:i,onOk:k,okText:y?o.formatMessage({id:"common.save",defaultMessage:"保存"}):o.formatMessage({id:"common.create",defaultMessage:"创建"}),cancelText:o.formatMessage({id:"common.cancel",defaultMessage:"取消"}),confirmLoading:x,destroyOnHidden:!0,children:(0,te.jsxs)(W.Z,{form:m,layout:"vertical",children:[(0,te.jsx)(W.Z.Item,{label:o.formatMessage({id:"common.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0,message:o.formatMessage({id:"common.name.required",defaultMessage:"请输入名称"})}],children:(0,te.jsx)(v.Z,{maxLength:64,showCount:!0,placeholder:o.formatMessage({id:"common.name.placeholder",defaultMessage:"请输入名称"})})}),(0,te.jsx)(W.Z.Item,{label:o.formatMessage({id:"common.description",defaultMessage:"描述"}),name:"description",children:(0,te.jsx)(v.Z.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:o.formatMessage({id:"common.description.placeholder",defaultMessage:"请输入描述"})})})]})})},Ce=n(84416),Se=n(17455),Te=n(275),Fe=n(81838),Pe=n(61476),Ie=n(97765),Ee=function(e){var t=e.orgUid,n=e.process,s=e.draftProcess,i=e.form,r=e.draftForm,o=e.ticketScope,l=void 0===o?B.dCh:o,g=e.customFormEnabled,m=void 0!==g&&g,v=e.onProcessChange,x=e.onFormChange,y=e.onCustomFormEnabledChange,b=(0,f.useIntl)(),j=(0,Me.Z)().translateString,w=ee.A.useForm(),Z=d()(w,1)[0],C=(0,c.useState)(!1),S=d()(C,2),T=S[0],F=S[1],P=(0,c.useState)(!1),E=d()(P,2),O=E[0],A=E[1],N=(0,c.useState)([]),U=d()(N,2),L=U[0],z=U[1],J=(0,c.useState)([]),X=d()(J,2),W=X[0],Q=X[1],_=l===B.IpQ?B.T2C:B.w_8,G=l===B.IpQ?B.O4J:B.Qou,R=!t,H=Boolean(m),K=R||!H,V=(0,c.useCallback)(u()(a()().mark((function e(){var n,s,i,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return z([]),e.abrupt("return");case 3:return F(!0),e.prev=4,n={orgUid:t,pageNumber:0,pageSize:100,status:B.bSv,type:G,sortBy:"updatedAt",sortDirection:"descend"},e.next=8,(0,Te.Gx)(n);case 8:s=e.sent,Ie.Z.debug("queryProcessesByOrg response:",null==s?void 0:s.data,n),200===(null==s?void 0:s.code)?z(null!==(i=null==s||null===(r=s.data)||void 0===r?void 0:r.content)&&void 0!==i?i:[]):q.yw.error((null==s?void 0:s.message)||b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load processes",e.t0),q.yw.error(b.formatMessage({id:"ticket.settings.workflow.process.loadFailed",defaultMessage:"加载流程列表失败"}));case 17:return e.prev=17,F(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,G]),$=(0,c.useCallback)(u()(a()().mark((function e(){var n,s,i,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return Q([]),e.abrupt("return");case 3:return A(!0),e.prev=4,n={orgUid:t,type:_,status:B.eiy,pageNumber:0,pageSize:100},e.next=8,(0,Fe.xg)(n);case 8:s=e.sent,Ie.Z.debug("queryFormsByOrg response:",null==s?void 0:s.data,n),200===(null==s?void 0:s.code)?(o=null!==(i=null==s||null===(r=s.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.filter((function(e){return e.status===B.eiy})))&&void 0!==i?i:[],Q(o)):q.yw.error((null==s?void 0:s.message)||b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Failed to load ticket forms",e.t0),q.yw.error(b.formatMessage({id:"ticket.settings.workflow.form.loadFailed",defaultMessage:"加载表单列表失败"}));case 17:return e.prev=17,A(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])}))),[t,b,_]);(0,c.useEffect)((function(){if(!t)return z([]),void Q([]);V(),$()}),[t,V,$]);var Y=(0,c.useMemo)((function(){var e=new Map;return L.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[n,s].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[L,n,s]),ne=(0,c.useMemo)((function(){var e=new Map;return W.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),[i,r].forEach((function(t){t&&t.uid&&!e.has(t.uid)&&e.set(t.uid,t)})),Array.from(e.values())}),[W,i,r]),se=(0,c.useMemo)((function(){return Y.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[Y]),ie=(0,c.useMemo)((function(){return ne.filter((function(e){return!!e.uid})).map((function(e){return{label:j(e.name)||e.uid,value:e.uid}}))}),[ne]),re=(0,c.useMemo)((function(){var e=new Map;return Y.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[Y]),ae=(0,c.useMemo)((function(){var e=new Map;return ne.forEach((function(t){null!=t&&t.uid&&e.set(t.uid,t)})),e}),[ne]),oe=(0,c.useMemo)((function(){return void 0!==s?s?s.uid:void 0:null==n?void 0:n.uid}),[s,n]),le=(0,c.useMemo)((function(){return void 0!==r?r?r.uid:void 0:null==i?void 0:i.uid}),[r,i]);(0,c.useEffect)((function(){Z.setFieldsValue({processUid:oe,formUid:le,customFormEnabled:H})}),[Z,oe,le,H]);var de=(0,c.useCallback)((function(e){R||y(e)}),[R,y]);return(0,te.jsx)(ee.A,{form:Z,layout:"vertical",submitter:!1,style:{width:"100%"},children:(0,te.jsxs)(h.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,te.jsxs)(ue.Z,{title:b.formatMessage({id:"ticket.settings.workflow.process.title",defaultMessage:"工单流程绑定"}),extra:(0,te.jsxs)(h.Z,{size:8,children:[(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(Ce.Z,{}),onClick:function(){var e=(0,Pe.LE)();window.open(e,"_blank","noopener,noreferrer")},disabled:R,children:b.formatMessage({id:"ticket.settings.workflow.process.openBuilder",defaultMessage:"打开流程设计器"})}),(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(I.Z,{}),onClick:V,loading:T,disabled:R})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,te.jsx)(Se.Z,{name:"processUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.process.placeholder",defaultMessage:"选择一个已部署的流程"}),options:se,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:R,loading:T,onChange:function(e){return function(e){if(e){var t=re.get(e);t&&v(t)}else v(null)}(e)}}}),se.length||T?null:(0,te.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.process.emptyOptions",defaultMessage:"暂无已部署流程，请先在流程中心创建并部署"})})]}),(0,te.jsxs)(ue.Z,{title:b.formatMessage({id:"ticket.settings.workflow.form.title",defaultMessage:"工单表单绑定"}),extra:(0,te.jsxs)(h.Z,{size:8,children:[(0,te.jsx)(k.Z,{size:"small",checked:H,onChange:de,disabled:R,checkedChildren:b.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:b.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(Ce.Z,{}),onClick:function(){var e=(0,Pe.P1)();window.open(e,"_blank","noopener,noreferrer")},disabled:K,children:b.formatMessage({id:"ticket.settings.workflow.form.openBuilder",defaultMessage:"打开表单设计器"})}),(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(I.Z,{}),onClick:$,loading:O,disabled:K})]}),styles:{body:{display:"flex",flexDirection:"column",gap:16}},children:[(0,te.jsx)(D.Z.Text,{type:"secondary",children:b.formatMessage({id:"ticket.settings.workflow.form.custom.desc",defaultMessage:"启用后，桌面端工单抽屉会根据所选流程关联的表单渲染自定义字段。"})}),(0,te.jsx)(Se.Z,{name:"formUid",placeholder:b.formatMessage({id:"ticket.settings.workflow.form.placeholder",defaultMessage:"选择一个已发布的工单表单"}),options:ie,fieldProps:{showSearch:!0,allowClear:!0,optionFilterProp:"label",disabled:K,loading:O,onChange:function(e){return function(e){if(e){var t=ae.get(e);t&&x(t)}else x(null)}(e)}}}),!H||ie.length||O?null:(0,te.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_SIMPLE,description:b.formatMessage({id:"ticket.settings.workflow.form.emptyOptions",defaultMessage:"暂无已发布表单，请先在表单中心创建并发布"})})]})]})})},qe=function(e){return e?JSON.parse(JSON.stringify(e)):null},Oe=function(e){return e===B.IpQ?B.IpQ:B.dCh},Ae=function(){var e=(0,f.useIntl)(),t=(0,O.u)((function(e){return e.currentOrg})),n=(0,A.Z)().isDarkMode,s=(0,N.Z)().leftSiderStyle,r=(0,c.useState)([]),o=d()(r,2),l=o[0],L=o[1],z=(0,c.useState)(""),J=d()(z,2),D=J[0],W=J[1],Q=(0,c.useState)(),_=d()(Q,2),G=_[0],R=_[1],H=(0,c.useState)("basic"),K=d()(H,2),V=K[0],$=K[1],Y=(0,c.useState)(!1),ee=d()(Y,2),ne=ee[0],se=ee[1],ie=(0,c.useState)(!1),ae=d()(ie,2),oe=ae[0],ue=ae[1],le=(0,c.useState)(!1),de=d()(le,2),ce=de[0],fe=de[1],ge=(0,c.useState)(!1),me=d()(ge,2),pe=me[0],he=me[1],ve=(0,c.useState)(null),xe=d()(ve,2),Me=xe[0],ye=xe[1],ke=(0,c.useState)(!1),be=d()(ke,2),Ce=be[0],Se=be[1],Te=(0,c.useRef)(""),Fe=(0,c.useState)(B.IpQ),Pe=d()(Fe,2),Ae=Pe[0],Ne=Pe[1],Ue=X((function(e){return{setCurrentTicketSettings:e.setCurrentTicketSettings,currentTicketSettings:e.currentTicketSettings,updateCurrentTicketSettings:e.updateCurrentTicketSettings}})),Le=Ue.setCurrentTicketSettings,ze=Ue.currentTicketSettings,Je=Ue.updateCurrentTicketSettings,Be=null==t?void 0:t.uid,Xe=(0,c.useMemo)((function(){return(G?l.find((function(e){return e.uid===G})):null)||null}),[l,G]),De=(0,c.useMemo)((function(){if(!D)return l;var e=D.toLowerCase();return l.filter((function(t){return((t.name||t.uid||"")+(t.description||"")).toLowerCase().includes(e)}))}),[l,D]),We=(0,c.useCallback)(function(){var e=u()(a()().mark((function e(n){var s,i,r,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return se(!0),e.prev=3,i=(null!=n?n:"").trim(),r={orgUid:t.uid,pageNumber:0,pageSize:200,searchText:i,type:Ae},e.next=8,(0,U.Bg)(r);case 8:o=e.sent,Ie.Z.debug("queryTicketSettingsByOrg response:",null==o?void 0:o.data,r),u=(null==o||null===(s=o.data)||void 0===s?void 0:s.content)||[],L(u),!(u.length>0)||G&&u.some((function(e){return e.uid===G}))||R(u[0].uid);case 13:return e.prev=13,se(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,G,Ae]);(0,c.useEffect)((function(){We(D)}),[null==t?void 0:t.uid,Ae]),(0,c.useEffect)((function(){if(Xe){var e=qe(Xe);Le(e),Te.current=JSON.stringify(null!=Xe?Xe:{}),Se(!1)}else Le(null),Te.current=JSON.stringify({}),Se(!1)}),[Xe,Le]),(0,c.useEffect)((function(){if(ze)try{var e=JSON.stringify(ze);Se(e!==Te.current)}catch(e){Se(!0)}else Se(!1)}),[ze]);var Qe=function(){var n=u()(a()().mark((function n(s){var r,o,u,l,d;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=null!=s?s:Xe)&&r.uid){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,U.oX)({uid:r.uid,type:Oe(r.type)});case 6:if(o=n.sent,!((Array.isArray(null==o?void 0:o.data)?o.data:[]).length>0)){n.next=11;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.delete.hasBinding",defaultMessage:"当前工单设置已绑定工作组，请先解绑后再删除"})),n.abrupt("return");case 11:return u={uid:r.uid,orgUid:null==t?void 0:t.uid},l=i()(i()({},u),{},{type:Oe(r.type)}),n.next=15,(0,U.nU)(l);case 15:d=n.sent,console.log("deleteTicketSettings response:",d,l),200===(null==d?void 0:d.code)?(q.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),L((function(e){return e.filter((function(e){return e.uid!==r.uid}))})),G===r.uid&&R(void 0)):q.yw.error((null==d?void 0:d.message)||"删除失败"),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(3),console.error(n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.delete.failed",defaultMessage:"删除失败"}));case 24:case"end":return n.stop()}}),n,null,[[3,20]])})));return function(e){return n.apply(this,arguments)}}(),_e=function(){var n=u()(a()().mark((function n(s,i){var r;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,U.mE)({uid:s,orgUid:null==t?void 0:t.uid,enabled:i,type:Oe(null==Ye?void 0:Ye.type)});case 3:(r=n.sent)&&200===r.code?(q.yw.success(e.formatMessage({id:i?"common.enabled":"common.disabled",defaultMessage:i?"已启用":"已停用"})),We(D)):q.yw.error((null==r?void 0:r.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),q.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ge=function(e,t){return void 0!==e?null===e?"":null==e?void 0:e.uid:null==t?void 0:t.uid},Re=function(e){var t,n,s,r;if(!e)return null;var a,o=null!==(t=e.draftBasicSettings)&&void 0!==t?t:e.basicSettings,u=o?i()({},o):void 0,l=null!==(n=e.draftNotificationSettings)&&void 0!==n?n:e.notificationSettings,d=null!==(s=e.draftCategorySettings)&&void 0!==s?s:e.categorySettings,c=d?je(null!==(r=d.items)&&void 0!==r?r:[]):void 0,f=Ge(e.draftProcess,e.process),g=Ge(e.draftForm,e.form);return{uid:e.uid,orgUid:e.orgUid,type:Oe(e.type),name:e.name,description:e.description,isDefault:null==e?void 0:e.isDefault,enabled:null==e?void 0:e.enabled,customFormEnabled:null==e?void 0:e.customFormEnabled,basicSettings:u,notificationSettings:l,categorySettings:c?{items:(a=c,null==a?void 0:a.map((function(e,t){var n;return{uid:e.uid,name:e.name,description:e.description,enabled:e.enabled,defaultCategory:e.defaultCategory,orderIndex:null!==(n=e.orderIndex)&&void 0!==n?n:t}})))}:void 0,processUid:f,formUid:g}},He=function(){var n=u()(a()().mark((function n(){var s,r,o,u,l,d;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=ze)&&s.uid){n.next=4;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return",!1);case 4:if(ue(!0),n.prev=5,o=Re(s)){n.next=10;break}return q.yw.error(e.formatMessage({id:"ticket.settings.save.payload.empty",defaultMessage:"保存数据为空，无法提交"})),n.abrupt("return",!1);case 10:return u=i()(i()({},o),{},{orgUid:null==t?void 0:t.uid,type:null!==(r=null==o?void 0:o.type)&&void 0!==r?r:Ae}),n.next=13,(0,U.mE)(u);case 13:if(l=n.sent,console.log("updateTicketSettings response:",l,u),200!==(null==l?void 0:l.code)){n.next=25;break}return q.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),a=null==l?void 0:l.data,c=s,f=void 0,g=void 0,m=void 0,p=void 0,h=void 0,v=void 0,d=a?i()(i()(i()({},c),a),{},{basicSettings:null!==(f=a.basicSettings)&&void 0!==f?f:c.basicSettings,draftBasicSettings:null!==(g=null!==(m=null!==(p=a.draftBasicSettings)&&void 0!==p?p:a.basicSettings)&&void 0!==m?m:c.draftBasicSettings)&&void 0!==g?g:c.basicSettings,draftCategorySettings:null!==(h=a.draftCategorySettings)&&void 0!==h?h:c.draftCategorySettings,categorySettings:null!==(v=a.categorySettings)&&void 0!==v?v:c.categorySettings}):c,Te.current=JSON.stringify(null!=d?d:{}),Se(!1),L((function(e){return e.map((function(e){return e.uid===s.uid?d:e}))})),Le(qe(d)),n.abrupt("return",!0);case 25:return q.yw.error((null==l?void 0:l.message)||e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 27:n.next=34;break;case 29:return n.prev=29,n.t0=n.catch(5),console.error("保存失败:",n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.save.failed",defaultMessage:"保存失败"})),n.abrupt("return",!1);case 34:return n.prev=34,ue(!1),n.finish(34);case 37:return n.abrupt("return",!1);case 38:case"end":return n.stop()}var a,c,f,g,m,p,h,v}),n,null,[[5,29,34,37]])})));return function(){return n.apply(this,arguments)}}(),Ke=function(){var n=u()(a()().mark((function n(){var s,i,r,o;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(s=ze)&&s.uid){n.next=4;break}return q.yw.warning(e.formatMessage({id:"ticket.settings.select.template",defaultMessage:"请从左侧选择工单配置"})),n.abrupt("return");case 4:if(fe(!0),n.prev=5,!Ce){n.next=12;break}return n.next=9,He();case 9:if(n.sent){n.next=12;break}return n.abrupt("return");case 12:return i={uid:s.uid,orgUid:null==t?void 0:t.uid,type:Oe(s.type)},n.next=15,(0,U.Ch)(i);case 15:r=n.sent,console.log("publishTicketSettings response:",r,i),200===(null==r?void 0:r.code)?(q.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Te.current=JSON.stringify(null!==(o=null==r?void 0:r.data)&&void 0!==o?o:{}),Se(!1),L((function(e){return e.map((function(e){return e.uid===s.uid?null==r?void 0:r.data:e}))})),Le(qe(null==r?void 0:r.data))):q.yw.error((null==r?void 0:r.message)||e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"})),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(5),console.error("发布失败:",n.t0),q.yw.error(e.formatMessage({id:"ticket.settings.publish.failed",defaultMessage:"发布失败"}));case 24:return n.prev=24,fe(!1),n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[5,20,24,27]])})));return function(){return n.apply(this,arguments)}}(),Ve=function(t){var n,s,i,r,a,o,u,l,d,c,f,g,m,p,h,v,x,M,y,k;return{numberPrefix:null!==(n=null==t?void 0:t.numberPrefix)&&void 0!==n?n:"TK",numberLength:null!==(s=null==t?void 0:t.numberLength)&&void 0!==s?s:8,defaultPriority:null!==(i=null==t?void 0:t.defaultPriority)&&void 0!==i?i:"medium",validityDays:null!==(r=null==t?void 0:t.validityDays)&&void 0!==r?r:30,autoCloseHours:null!==(a=null==t?void 0:t.autoCloseHours)&&void 0!==a?a:72,enableAutoClose:null!==(o=null==t?void 0:t.enableAutoClose)&&void 0!==o&&o,requireLogin:null!==(u=null==t?void 0:t.requireLogin)&&void 0!==u&&u,assignmentMode:null!==(l=null==t?void 0:t.assignmentMode)&&void 0!==l?l:B.vXk,accessTip:null!==(d=null==t?void 0:t.accessTip)&&void 0!==d?d:e.formatMessage({id:"ticket.settings.basic.accessTip.default",defaultMessage:"您好，工单已接入，我们将尽快为您处理。"}),closeTip:null!==(c=null==t?void 0:t.closeTip)&&void 0!==c?c:e.formatMessage({id:"ticket.settings.basic.closeTip.default",defaultMessage:"本工单会话已关闭，如需继续请提交新工单。"}),agentTimeoutTip:null!==(f=null==t?void 0:t.agentTimeoutTip)&&void 0!==f?f:e.formatMessage({id:"ticket.settings.basic.agentTimeoutTip.default",defaultMessage:"客服暂时未回复，我们正在处理中，请您稍候。"}),visitorTimeoutTip:null!==(g=null==t?void 0:t.visitorTimeoutTip)&&void 0!==g?g:e.formatMessage({id:"ticket.settings.basic.visitorTimeoutTip.default",defaultMessage:"如您暂时不方便回复，后续可随时继续补充信息。"}),showContactName:null===(m=null==t?void 0:t.showContactName)||void 0===m||m,requireContactName:null===(p=null==t?void 0:t.requireContactName)||void 0===p||p,showEmail:null===(h=null==t?void 0:t.showEmail)||void 0===h||h,requireEmail:null!==(v=null==t?void 0:t.requireEmail)&&void 0!==v&&v,showPhone:null===(x=null==t?void 0:t.showPhone)||void 0===x||x,requirePhone:null!==(M=null==t?void 0:t.requirePhone)&&void 0!==M&&M,showWechat:null!==(y=null==t?void 0:t.showWechat)&&void 0!==y&&y,requireWechat:null!==(k=null==t?void 0:t.requireWechat)&&void 0!==k&&k}},$e=function(e){var t=Array.isArray(null==e?void 0:e.items)?e.items:[];return je(t)},Ye=null!=ze?ze:Xe,et=Ae===B.IpQ?B.p$M:B.hXJ,tt=Ae===B.IpQ,nt=(0,c.useMemo)((function(){var e,t,n,s;if(null==Ye||!Ye.uid)return[];var r=[{key:"basic",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(w.Z,{})," ",(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.basic",defaultMessage:"基础设置"})]}),children:(0,te.jsx)("div",{style:{padding:8},children:(0,te.jsx)(re,{settings:Ve(null!==(e=null==Ye?void 0:Ye.draftBasicSettings)&&void 0!==e?e:null==Ye?void 0:Ye.basicSettings),hideRequireLogin:tt,hideContactFields:tt,onChange:function(e){Je((function(t){var n,s,r=Ve(null!==(n=null!==(s=t.draftBasicSettings)&&void 0!==s?s:t.basicSettings)&&void 0!==n?n:{});t.draftBasicSettings=i()(i()({},r),e),t.hasUnpublishedChanges=!0}))}})})},{key:"categories",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(Z.Z,{})," ",(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.categories",defaultMessage:"分类设置"})]}),children:(0,te.jsx)("div",{style:{padding:8},children:(0,te.jsx)(we,{items:$e(null!==(t=null==Ye?void 0:Ye.draftCategorySettings)&&void 0!==t?t:null==Ye?void 0:Ye.categorySettings),categoryType:et,onChange:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=je(e),n=t.filter((function(e){return e.enabled})).length,s=t.length-n,i=t.find((function(e){return e.defaultCategory&&e.enabled}));return{items:t,defaultCategoryUid:null==i?void 0:i.uid,enabledCount:n,disabledCount:s}}(e);Je((function(e){e.draftCategorySettings=t,e.hasUnpublishedChanges=!0}))}})})},{key:"workflow",label:(0,te.jsxs)("span",{children:[(0,te.jsx)(C.Z,{})," ",(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.tab.workflow",defaultMessage:"流程与表单"})]}),children:(0,te.jsx)("div",{style:{padding:8},children:(0,te.jsx)(Ee,{orgUid:Be,process:null!==(n=null==Ye?void 0:Ye.process)&&void 0!==n?n:null,draftProcess:null==Ye?void 0:Ye.draftProcess,form:null!==(s=null==Ye?void 0:Ye.form)&&void 0!==s?s:null,draftForm:null==Ye?void 0:Ye.draftForm,ticketScope:Ae,customFormEnabled:null==Ye?void 0:Ye.customFormEnabled,onProcessChange:function(e){Je((function(t){t.draftProcess=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onFormChange:function(e){Je((function(t){t.draftForm=void 0===e?void 0:e,t.hasUnpublishedChanges=!0}))},onCustomFormEnabledChange:function(e){Je((function(t){t.customFormEnabled=e,t.hasUnpublishedChanges=!0}))}})})}];return r}),[Ye,e,Je,et,tt,Be]),st=(0,c.useCallback)((function(e){var t=e.trim();W(t),We(t)}),[We,W]),it=[{key:B.dCh,label:e.formatMessage({id:"ticket.settings.scope.external",defaultMessage:"外部工单"})},{key:B.IpQ,label:e.formatMessage({id:"ticket.settings.scope.internal",defaultMessage:"内部工单"})}];return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(g.Z,{activeKey:Ae,onChange:function(e){var t=Oe(e);Ne(t),R(void 0),L([]),Le(null),Te.current=JSON.stringify({}),Se(!1)},items:it}),(0,te.jsxs)(m.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,te.jsx)(m.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:s,children:(0,te.jsxs)(j.Z,{title:e.formatMessage({id:"ticket.settings.list",defaultMessage:"工单配置列表"}),extra:(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(S.Z,{}),type:"primary",onClick:function(){ye(null),he(!0)},children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:ne,children:[(0,te.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,te.jsxs)(h.Z.Compact,{style:{width:"100%"},children:[(0,te.jsx)(v.Z,{placeholder:e.formatMessage({id:"ticket.settings.search.placeholder",defaultMessage:"搜索工单配置"}),value:D,onChange:function(e){return W(e.target.value)},onPressEnter:function(){return st(D)},allowClear:!0,size:"middle"}),(0,te.jsx)(p.ZP,{type:"primary",size:"middle",onClick:function(){return st(D)},children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.search",defaultMessage:"搜索"})})]})}),(0,te.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,te.jsx)(x.Z,{dataSource:De,locale:{emptyText:(0,te.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,te.jsx)(x.Z.Item,{style:G===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return R(e.uid)},children:(0,te.jsx)(x.Z.Item.Meta,{title:(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,te.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,te.jsx)(h.Z,{size:4,children:e.isDefault?(0,te.jsx)(y.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,te.jsx)("div",{style:{color:n?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,te.jsx)(m.Z.Panel,{children:Ye?(0,te.jsx)(j.Z,{title:(0,te.jsxs)(h.Z,{children:[(0,te.jsxs)("span",{children:[e.formatMessage({id:"ticket.settings.editing",defaultMessage:"编辑工单设置"}),": ",Ye.name||Ye.uid]}),(0,te.jsx)(k.Z,{checked:!!Ye.enabled,onChange:function(e){return _e(Ye.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,te.jsx)(p.ZP,{size:"small",icon:(0,te.jsx)(T.Z,{}),onClick:function(e){e.stopPropagation(),Xe&&(ye(Xe),he(!0))},children:(0,te.jsx)(f.FormattedMessage,{id:"ticket.settings.edit",defaultMessage:"编辑"})}),(0,te.jsx)(b.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Qe(Xe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,te.jsx)(p.ZP,{size:"small",danger:!0,icon:(0,te.jsx)(F.Z,{}),onClick:function(e){return e.stopPropagation()},children:(0,te.jsx)(f.FormattedMessage,{id:"common.delete",defaultMessage:"删除"})})}),Ye.isDefault?(0,te.jsx)(y.Z,{color:"blue",children:"默认"}):null,Ce&&(0,te.jsx)(y.Z,{color:"red",children:(0,te.jsx)(f.FormattedMessage,{id:"common.unsaved",defaultMessage:"未保存修改"})})]}),extra:(0,te.jsxs)(h.Z,{children:[(0,te.jsx)(b.Z,{title:e.formatMessage({id:"ticket.settings.publish.confirm.title",defaultMessage:"发布到线上环境"}),description:e.formatMessage({id:"ticket.settings.publish.confirm.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:e.formatMessage({id:"ticket.settings.publish.confirm.ok",defaultMessage:"继续发布"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ke()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,te.jsx)(p.ZP,{onClick:function(e){return e.stopPropagation()},loading:ce,type:"default",icon:(0,te.jsx)(P.Z,{}),children:(0,te.jsx)(f.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,te.jsx)(p.ZP,{onClick:function(){if(Xe){var t=Te.current?JSON.parse(Te.current):null;Le(qe(t)),Se(!1),q.yw.info(e.formatMessage({id:"ticket.settings.reset.info",defaultMessage:"已重置为当前发布版本"}))}},disabled:!Ce,icon:(0,te.jsx)(I.Z,{}),children:(0,te.jsx)(f.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,te.jsx)(p.ZP,{type:"primary",loading:oe,onClick:He,disabled:!Ce,icon:(0,te.jsx)(E.Z,{}),children:(0,te.jsx)(f.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,te.jsx)(g.Z,{activeKey:V,onChange:$,items:nt})}):(0,te.jsx)(j.Z,{children:(0,te.jsx)(M.Z,{description:e.formatMessage({id:"ticket.settings.select.settings",defaultMessage:"请从左侧选择工单配置"})})})})]}),(0,te.jsx)(Ze,{open:pe,record:Me||void 0,ticketType:Me?Oe(Me.type):Ae,onClose:function(){return he(!1)},onSuccess:function(){var e=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(D);case 2:null!=t&&t.uid&&R(t.uid);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})}}}]);