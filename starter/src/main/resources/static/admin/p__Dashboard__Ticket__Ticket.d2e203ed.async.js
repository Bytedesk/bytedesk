"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[987],{59908:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),i=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=n(54183),s=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:a}))};var u=i.forwardRef(s)},32350:function(e,t,n){var r=n(17082),i=n(73457),a=n(44194),o=n(87413),s=n(31549),u=["fieldProps","proFieldProps"],c=function(e,t){var n=e.fieldProps,a=e.proFieldProps,c=(0,i.Z)(e,u);return(0,s.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:a},c))};t.Z=a.forwardRef(c)},72614:function(e,t,n){n.d(t,{W5:function(){return g},n1:function(){return h},p0:function(){return f},u7:function(){return d},zl:function(){return y}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),s=n(89933),u=n.n(s),c=n(55735),l=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/query/org",{method:"GET",params:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/create",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/update",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/update/avatar",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return k.apply(this,arguments)}function k(){return(k=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/workgroup/delete",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,n){n.d(t,{D$:function(){return f},EP:function(){return h},hS:function(){return g},z_:function(){return d}});var r=n(90819),i=n.n(r),a=n(73193),o=n.n(a),s=n(89933),u=n.n(s),c=n(55735),l=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/query/org",{method:"GET",params:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/create",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/update",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/member/delete",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17220:function(e,t,n){n(44194);var r=n(75365),i=n(54881),a=n(30921),o=n(31549);t.Z=function(e){var t,n,s=e.file,u=e.onDelete,c=e.showDelete,l=void 0===c||c,d=(0,a.useIntl)();return(0,o.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:d.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[l&&(0,o.jsx)(r.ZP,{type:"text",size:"small",icon:(0,o.jsx)(i.Z,{}),onClick:function(){return u(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,o.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(n=s.fileType)&&void 0!==n&&n.startsWith("image/")?(0,o.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,o.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,o.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,n){var r=n(76711),i=n.n(r),a=n(73193),o=n.n(a),s=n(45332),u=n.n(s),c=n(44194),l=n(42085),d=n(30348),p=n(53530),f=n(28977),m=n.n(f),g=n(55735),v=n(86803),h=n(44521),x=n(17220),y=n(30921),k=n(6397),w=n(31549),b=d.Z.Dragger;t.Z=function(e){var t=e.type,n=(e.acceptType,e.isModalOpen),r=e.attachments,a=e.handleSubmit,s=e.handleCancel,d=(0,y.useIntl)(),f=(0,k.j)((function(e){return e.currentKbase})),j=(0,c.useState)([]),M=u()(j,2),S=M[0],Z=M[1],T=(0,c.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==f?void 0:f.uid,client:g.bVn}),F=u()(T,2),C=F[0],U=F[1];(0,c.useEffect)((function(){console.log("UploadDrag currentKbase",f),f&&U((function(e){return o()(o()({},e),{},{kb_uid:null==f?void 0:f.uid})}))}),[f]);var I=(0,c.useMemo)((function(){return{name:"file",multiple:!0,action:(0,h.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(g.LA8)},data:C,showUploadList:!1,beforeUpload:function(e){var t=m()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return U((function(n){return o()(o()({},n),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&v.yw.loading(d.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(v.yw.destroy(),v.yw.success(d.formatMessage({id:"upload.success"},{filename:e.file.name})),Z((function(t){return[].concat(i()(t),[e.file.response.data])}))):(v.yw.destroy(),v.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&v.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[C,d]);(0,c.useEffect)((function(){U((function(e){return o()(o()({},e),{},{kb_type:t,category_uid:""})})),r&&Z(r.map((function(e){return e.upload})))}),[t]);var z=function(e){console.log("handleDelete",e),Z((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,w.jsxs)(p.Z,{title:d.formatMessage({id:"upload.modal.title"}),open:n,onOk:function(){a(S)},onCancel:s,children:[(0,w.jsxs)(b,o()(o()({},I),{},{children:[(0,w.jsx)("p",{className:"ant-upload-drag-icon",children:(0,w.jsx)(l.Z,{})}),(0,w.jsx)("p",{className:"ant-upload-text",children:d.formatMessage({id:"upload.drag.text"})}),(0,w.jsx)("p",{className:"ant-upload-hint",children:d.formatMessage({id:"upload.drag.hint"})})]})),(0,w.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:S.map((function(e){return(0,w.jsx)(x.Z,{file:e,onDelete:z},e.uid)}))})})]})}},21041:function(e,t,n){n.r(t),n.d(t,{default:function(){return me}});var r=n(75574),i=n(73193),a=n.n(i),o=n(84176),s=n.n(o),u=n(10154),c=n.n(u),l=n(90819),d=n.n(l),p=n(89933),f=n.n(p),m=n(45332),g=n.n(m),v=n(86803),h=n(55735),x=n(30921);function y(e){return k.apply(this,arguments)}function k(){return(k=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/query/org",{method:"GET",params:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/update",{method:"POST",data:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return M.apply(this,arguments)}function M(){return(M=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/delete",{method:"POST",data:{uid:t,client:h.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/ticket/history/activity",{method:"GET",params:a()(a()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=n(40612),F=n(90838),C=n(32045),U=n(76750),I=n(11090),z=n(81947),q=n(53530),P=n(29266),O=n(75365),V=n(28977),_=n.n(V),E=n(44194),D=n(76711),R=n.n(D),A=n(16309),N=n(73442),Y=n(3849),B=n(72614),L=n(6807),W=n(4499),H=n(32350),G=n(84881),J=n(17220),X=n(27650),K=n(59908),Q=n(31549),$=function(e){var t=e.open,n=e.isEdit,r=e.ticket,i=e.onClose,a=e.onSuccess,o=A.Z.useForm(),s=g()(o,1)[0],u=(0,x.useIntl)(),c=(0,U.Z)().translateString,l=(0,T.u)((function(e){return e.currentOrg})),p=(0,E.useState)([]),m=g()(p,2),y=m[0],k=m[1],b=(0,E.useState)([]),j=g()(b,2),M=j[0],S=j[1],Z=(0,E.useState)([]),F=g()(Z,2),I=F[0],z=F[1],q=(0,E.useState)(!1),P=g()(q,2),V=P[0],_=P[1],D=(0,E.useState)([]),$=g()(D,2),ee=$[0],te=$[1],ne=[{value:h.sM_,label:u.formatMessage({id:"ticket.status.new"})},{value:h.sFW,label:u.formatMessage({id:"ticket.status.claimed"})},{value:h.z1,label:u.formatMessage({id:"ticket.status.processing"})},{value:h.pIN,label:u.formatMessage({id:"ticket.status.pending"})},{value:h.XrC,label:u.formatMessage({id:"ticket.status.holding"})},{value:h.yib,label:u.formatMessage({id:"ticket.status.reopened"})},{value:h.hwr,label:u.formatMessage({id:"ticket.status.resolved"})},{value:h.frw,label:u.formatMessage({id:"ticket.status.closed"})},{value:h.xw4,label:u.formatMessage({id:"ticket.status.cancelled"})}],re=[{value:h.JTO,label:u.formatMessage({id:"ticket.priority.lowest"})},{value:h.sbT,label:u.formatMessage({id:"ticket.priority.low"})},{value:h.GMZ,label:u.formatMessage({id:"ticket.priority.medium"})},{value:h.Bt2,label:u.formatMessage({id:"ticket.priority.high"})},{value:h._Xr,label:u.formatMessage({id:"ticket.priority.urgent"})},{value:h.Lx6,label:u.formatMessage({id:"ticket.priority.critical"})}],ie=function(){var e=f()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,C.XS)({type:h.hcJ,orgUid:null==l?void 0:l.uid,pageNumber:0,pageSize:100});case 3:200===(n=e.sent).code&&null!==(t=n.data)&&void 0!==t&&t.content&&k(n.data.content),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Fetch categories error:",e.t0),v.yw.error(u.formatMessage({id:"ticket.category.load.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=f()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==l?void 0:l.uid},e.next=3,(0,B.u7)(t);case 3:200===(n=e.sent).code?(S(n.data.content),z(n.data.content.reduce((function(e,t){var n;return null===(n=t.agents)||void 0===n||n.forEach((function(t){e.find((function(e){return e.uid===t.uid}))||e.push(t)})),e}),[]))):v.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,E.useEffect)((function(){t&&(ae(),ie())}),[t]);var oe=y.filter((function(e){return e.uid!==h.zBg})),se=function(){var e=f()(d()().mark((function e(){var t,n,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.validateFields();case 3:return t=e.sent,v.yw.loading(u.formatMessage({id:"updating"})),n={uid:null==r?void 0:r.uid,title:null==t?void 0:t.title,description:null==t?void 0:t.description,categoryUid:null==t?void 0:t.categoryUid,workgroupUid:null==t?void 0:t.workgroupUid,assigneeUid:null==t?void 0:t.assigneeUid,status:null==t?void 0:t.status,priority:null==t?void 0:t.priority,uploadUids:ee.map((function(e){return e.uid}))},console.log("updateTicket request",n),e.next=9,w(n);case 9:o=e.sent,console.log("updateTicket response",o),200===o.code?(v.yw.success(u.formatMessage({id:"update.success"})),a(),i()):v.yw.error(o.message),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Update failed:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}();E.useEffect((function(){var e,n,i;t&&r&&(s.setFieldsValue({title:null==r?void 0:r.title,description:null==r?void 0:r.description,status:null==r?void 0:r.status,priority:null==r?void 0:r.priority,categoryUid:null==r?void 0:r.categoryUid,workgroupUid:null==r||null===(e=r.workgroup)||void 0===e?void 0:e.uid,assigneeUid:null==r||null===(n=r.assignee)||void 0===n?void 0:n.uid}),te(null==r||null===(i=r.attachments)||void 0===i?void 0:i.map((function(e){return e.upload}))))}),[t,r]);var ue=function(e){console.log("handleDelete",e),te((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,Q.jsx)(N.Z,{title:u.formatMessage({id:"ticket.edit.title"}),width:600,open:t,onClose:i,extra:(0,Q.jsxs)(Y.Z,{children:[(0,Q.jsx)(O.ZP,{onClick:i,children:(0,Q.jsx)(x.FormattedMessage,{id:"cancel"})}),(0,Q.jsx)(O.ZP,{type:"primary",onClick:se,children:(0,Q.jsx)(x.FormattedMessage,{id:"save"})})]}),children:(0,Q.jsxs)(L.ZP,{form:s,submitter:!1,layout:"vertical",children:[(0,Q.jsx)(W.Z,{name:"title",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.title"}),rules:[{required:!0}]}),(0,Q.jsx)(H.Z,{name:"description",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.description"}),rules:[{required:!0}]}),(0,Q.jsx)(G.Z,{name:"categoryUid",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.category"}),rules:[{required:!0}],options:oe.map((function(e){return{label:c(e.name),value:e.uid}}))}),(0,Q.jsx)(G.Z,{name:"workgroupUid",label:u.formatMessage({id:"ticket.workgroup"}),rules:[{required:!0}],options:M.map((function(e){return{label:c(e.nickname),value:e.uid}})),placeholder:u.formatMessage({id:"ticket.workgroup.placeholder"}),onChange:function(e){var t=M.find((function(t){return t.uid===e}));null!=t&&t.agents?(z(t.agents),s.setFieldValue("assigneeUid",void 0)):z([])}}),(0,Q.jsx)(G.Z,{name:"assigneeUid",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),options:I.map((function(e){return{label:e.nickname,value:e.uid}}))}),(0,Q.jsx)(G.Z,{name:"status",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.status"}),rules:[{required:!0}],options:ne}),(0,Q.jsx)(G.Z,{name:"priority",label:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.priority"}),rules:[{required:!0}],options:re}),V&&(0,Q.jsx)(X.Z,{type:h.hcJ,isModalOpen:V,attachments:null==r?void 0:r.attachments,handleSubmit:function(e){console.log("handleSubmit",e),te(n&&r?e:function(t){return[].concat(R()(t),R()(e))}),_(!1)},handleCancel:function(){_(!1)}}),(0,Q.jsx)("div",{style:{marginTop:"16px",marginBottom:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,Q.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:ee.map((function(e){return(0,Q.jsx)(J.Z,{file:e,onDelete:ue},e.uid)}))})}),(0,Q.jsx)(O.ZP,{icon:(0,Q.jsx)(K.Z,{}),onClick:function(){return _(!0)},children:u.formatMessage({id:"ticket.upload.button"})})]})})},ee=n(44521),te=n(73669),ne=n(19981),re=n(80601),ie=n(51004),ae=n(73589),oe=function(e){var t=e.ticket,n=e.isThreadTicket,r=void 0!==n&&n,i=(0,T.u)((function(e){return e.currentOrg})),a=(0,E.useState)([]),o=g()(a,2),s=o[0],u=o[1],c=(0,E.useState)(!1),l=g()(c,2),p=l[0],m=l[1],y=(0,x.useIntl)();console.log("currentTicket",t,p);var k=(0,ne.Z)(),w=k.memberResult,b=k.setMemberResult,j=function(){var e=f()(d()().mark((function e(){var n,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,m(!0),n={pageNumber:0,pageSize:100,uid:null==t?void 0:t.uid},e.next=7,S(n);case 7:r=e.sent,console.log("queryTicketHistoryActivity response:",r.data),200===r.code?u(r.data||[]):(console.log("queryTicketHistoryActivity error:",r.data),v.yw.error(r.message)),m(!1),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Fetch ticket history error:",e.t0),v.yw.error("获取工单历史记录失败"),m(!1);case 18:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=f()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==i?void 0:i.uid},e.next=4,(0,te.z_)(t);case 4:200===(n=e.sent).code?(v.yw.destroy(),b(n)):v.yw.destroy();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,E.useEffect)((function(){r||(j(),M())}),[t]);var Z=function(e){if(!e)return"-";var t=w.data.content.find((function(t){return t.uid===e}));return(null==t?void 0:t.nickname)||""};return(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsxs)(re.Z,{spinning:p,children:[(0,Q.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center"},children:"活动历史"}),(0,Q.jsx)(ie.Z,{direction:"vertical",size:"small",current:s.length-1,style:{padding:"16px"},items:s.map((function(e,t){var n,r;return{title:(r=null==e?void 0:e.activityName,(r?r===h.sM_||r===h.Yux||r===h.sFW||r===h.W66||r===h.z1||r===h.yZA||r===h.pIN||r===h.XrC||r===h.L1h||r===h.yib||r===h.hwr||r===h.AzB||r===h.frw||r===h.xw4||r===h.qQU||r===h.GJZ?y.formatMessage({id:"ticket.status.".concat(r.toLowerCase())}):r:"")||"活动"),description:(0,Q.jsxs)("div",{children:[(null==e?void 0:e.assignee)&&(0,Q.jsxs)("div",{children:["处理人: ",Z(null==e?void 0:e.assignee)||(null==e?void 0:e.assignee)]}),(0,Q.jsxs)("div",{children:["处理时间: ",(null===(n=e.startTime)||void 0===n?void 0:n.toLocaleString())||"-"]})]}),status:t===s.length-1?"process":"finish"}}))}),0===s.length&&(0,Q.jsx)(ae.Z,{description:"请选择工单查看流转过程"})]})})},se=function(e){var t=e.open,n=e.ticket,r=e.onClose;return(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(N.Z,{open:t,onClose:function(){r()},title:"工单详情",children:(0,Q.jsx)(oe,{ticket:n,isThreadTicket:!1})})})},ue=["current","pageSize"],ce=function(){var e=(0,x.useIntl)(),t=(0,E.useRef)(),n=(0,E.useState)(1),r=g()(n,2),i=r[0],o=r[1],u=(0,E.useState)(10),l=g()(u,2),p=l[0],m=l[1],k=(0,T.u)((function(e){return e.currentOrg})),w=(0,U.Z)().translateString,b=(0,F.v)().setCategoryResult,M=(0,F.v)((function(e){return e.currentCategory})),S=(0,E.useState)(!1),Z=g()(S,2),V=Z[0],D=Z[1],R=(0,E.useState)(),A=g()(R,2),N=A[0],Y=A[1],B=(0,E.useState)(!1),L=g()(B,2),W=L[0],H=L[1],G=q.Z.useModal(),J=g()(G,2),X=J[0],K=J[1],te=(0,E.useState)(!1),ne=g()(te,2),re=ne[0],ie=ne[1],ae=function(){var e=f()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,type:h.hcJ,orgUid:null==k?void 0:k.uid},e.next=3,(0,C.XS)(t);case 3:200===(n=e.sent).code?b(n):v.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,E.useEffect)((function(){ae()}),[]);var oe=(0,F.v)((function(e){return e.categoryResult.data.content}));(0,E.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reload()}),[null==M?void 0:M.uid]);var ce=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.title"}),dataIndex:"title",copyable:!0,ellipsis:!0},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.description"}),dataIndex:"description",ellipsis:!0},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.status"}),dataIndex:"status",hideInSearch:!0,render:function(e,t){var n=c()(c()(c()(c()(c()(c()(c()(c()(c()({},h.sM_,"blue"),h.sFW,"cyan"),h.z1,"processing"),h.pIN,"warning"),h.XrC,"orange"),h.yib,"volcano"),h.hwr,"success"),h.frw,"default"),h.xw4,"error");return(0,Q.jsx)(P.Z,{color:n[t.status],children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.status.".concat(t.status.toLowerCase())})})}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.priority"}),dataIndex:"priority",hideInSearch:!0,render:function(e,t){var n,r=c()(c()(c()(c()(c()(c()({},h.JTO,"default"),h.sbT,"blue"),h.GMZ,"orange"),h.Bt2,"volcano"),h._Xr,"red"),h.Lx6,"purple");return(0,Q.jsx)(P.Z,{color:r[null==t?void 0:t.priority],children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.priority.".concat(null==t||null===(n=t.priority)||void 0===n?void 0:n.toLowerCase())})})}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.assignee"}),dataIndex:"assignee",hideInSearch:!0,render:function(e,t,n,r){var i;return(0,Q.jsx)(P.Z,{color:"blue",children:null==t||null===(i=t.assignee)||void 0===i?void 0:i.nickname})}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.reporter"}),dataIndex:"reporter",hideInSearch:!0,render:function(e,t,n,r){var i;return(0,Q.jsx)(P.Z,{color:"red",children:null==t||null===(i=t.reporter)||void 0===i?void 0:i.nickname})}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(t,n){var r=oe.find((function(e){return e.uid===n.categoryUid}));return r?(0,Q.jsx)(P.Z,{color:"green",children:w(r.name)}):(0,Q.jsx)(P.Z,{color:"default",children:e.formatMessage({id:"uncategorized",defaultMessage:"Uncategorized"})})}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"createdAt"}),dataIndex:"createdAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,n,r){return _()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"updatedAt"}),dataIndex:"updatedAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t,n,r){return _()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Q.jsx)(x.FormattedMessage,{id:"action"}),key:"option",dataIndex:"option",hideInSearch:!0,width:200,render:function(e,n){return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(O.ZP,{type:"link",onClick:function(){return Y(n),D(!0),void H(!0)},children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.action.edit"})}),(0,Q.jsx)(O.ZP,{type:"link",onClick:function(){return e=n,console.log("handleViewTicket",e),Y(e),void ie(!0);var e},children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.action.view"})}),(0,Q.jsx)(O.ZP,{type:"link",onClick:function(){return e=n,console.log("handleDeleteTicket",e),void X.confirm({title:"确定要删除该工单吗？",onOk:(r=f()(d()().mark((function n(){var r,i;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("onOk"),n.next=3,j(e.uid);case 3:r=n.sent,console.log("deleteTicket response:",r),200===r.code?(v.yw.success(r.message),null===(i=t.current)||void 0===i||i.reload()):v.yw.error(r.message);case 6:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})});var e,r},children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.action.delete"})})]})}}],le=function(){var e=f()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,p),t=localStorage.getItem(h.LA8),window.open((0,ee.kG)()+"/api/v1/ticket/export?"+new URLSearchParams({orgUid:(null==k?void 0:k.uid)||"",pageNumber:String(i-1),pageSize:String(p),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(z.Z,{columns:ce,actionRef:t,cardBordered:!0,columnsState:{defaultValue:{description:{show:!1},createdAt:{show:!1},reporter:{show:!1}},persistenceKey:"ticket-table-columns",persistenceType:"localStorage"},request:function(){var e=f()(d()().mark((function e(t,n,r){var i,u,c,l,p;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.current,u=t.pageSize,c=s()(t,ue),o(i),m(u),l=a()(a()({pageNumber:i-1,pageSize:u,orgUid:null==k?void 0:k.uid},(null==M?void 0:M.uid)!==h.zBg&&{categoryUid:null==M?void 0:M.uid}),c),e.next=6,y(l);case 6:return p=e.sent,console.log("queryTicketsByOrgUid response:",p,l),200===p.code||v.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"ticket.list"}),toolBarRender:function(){return[(0,Q.jsx)(O.ZP,{type:"primary",onClick:function(){return window.open((0,ee.rl)())},children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.action.open.flow.editor"})}),(0,Q.jsx)(O.ZP,{icon:(0,Q.jsx)(I.Z,{}),type:"primary",onClick:le,children:(0,Q.jsx)(x.FormattedMessage,{id:"ticket.action.export"})},"button")]}}),V&&(0,Q.jsx)($,{open:V,isEdit:W,ticket:N,onClose:function(){D(!1),Y(void 0),H(!1)},onSuccess:function(){var e;null===(e=t.current)||void 0===e||e.reload()}}),re&&(0,Q.jsx)(se,{open:re,ticket:N,onClose:function(){return ie(!1)}}),K]})},le=n(95160),de=n(96865),pe=r.Z.Sider,fe=r.Z.Content,me=function(){var e=(0,de.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsxs)(r.Z,{children:[(0,Q.jsx)(pe,{style:t,width:250,children:(0,Q.jsx)(le.Z,{type:h.FXY})}),(0,Q.jsx)(r.Z,{children:(0,Q.jsx)(fe,{style:n,children:(0,Q.jsx)(ce,{})})})]})})}},19981:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(55735),i=n(44435),a=n(83642),o=n(83890),s=(0,i.Ue)()((0,a.mW)((0,a.tJ)((0,o.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);