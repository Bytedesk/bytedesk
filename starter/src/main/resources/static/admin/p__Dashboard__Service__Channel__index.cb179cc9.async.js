"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{76750:function(e,n,t){var r=t(55735),a=t(65461),s=t(41159);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},19496:function(e,n,t){t.r(n),t.d(n,{default:function(){return es}});var r=t(96865),a=t(75574),s=t(45332),i=t.n(s),o=t(23864),l=t(73193),c=t.n(l),u=t(76711),d=t.n(u),p=t(55735),f=t(44435),m=t(83642),h=t(83890),g=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:i,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),x=t(9452),y=t(44194),v=t(36310),j=t(31549),w=[{name:"web",nickname:"网站/H5"},{name:"npm",nickname:"Npm包"}],k=function(){var e=(0,o.Z)().isDarkMode,n=(0,y.useState)([]),t=i()(n,2),r=t[0],a=t[1],s=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),l=s.currentChannel,c=s.setCurrentChannel;return(0,y.useEffect)((function(){var e=[].concat(w);!(0,v.Ox)()&&(0,v.OJ)()&&e.push({name:"app",nickname:"App应用"},{name:"wechat-app",nickname:"微信应用"},{name:"messenger",nickname:"Messenger(开发中)"},{name:"instagram",nickname:"Instagram(开发中)"},{name:"whatsapp",nickname:"Whatsapp(开发中)"},{name:"telegram",nickname:"Telegram(开发中)"},{name:"line",nickname:"Line(开发中)"},{name:"email",nickname:"Email(开发中)"}),a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,j.jsx)(x.Z.Item,{style:(null==l?void 0:l.name)===n.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){c(n)},children:(0,j.jsx)(x.Z.Item.Meta,{title:(0,j.jsx)("div",{style:{marginLeft:10},children:n.nickname})})})}})})},Z=t(8247),b=t(41159),M=function(){var e=(0,b.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(b.Access,{accessible:e.canDebug(),fallback:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(b.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},A=t(90819),C=t.n(A),I=t(89933),S=t.n(I),E=t(10154),T=t.n(E),R=t(86803);function P(e){return W.apply(this,arguments)}function W(){return(W=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return q.apply(this,arguments)}function q(){return(q=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return D.apply(this,arguments)}function D(){return(D=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return z.apply(this,arguments)}function z(){return(z=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return O.apply(this,arguments)}function O(){return(O=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return N.apply(this,arguments)}function N(){return(N=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=t(40612),Y=t(15722),_=t(82669),G=t(80556),H=t(59304),J=t(54881),X=t(2484),Q=t(53530),$=t(27487),ee=t(75365),ne=t(96485),te=t(76750),re=t(72614),ae=t(95490),se=t(69169),ie=t(4499),oe=t(84881),le=t(73442),ce=t(3849),ue="MP",de="MINI",pe="WORK",fe="KEFU",me=function(e){var n,t=e.isEdit,r=e.wechatApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==m?void 0:m.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||pe,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:pe,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:ue},{label:"微信小程序",value:de},{label:"企业微信",value:pe},{label:"微信客服",value:fe}],fieldProps:{defaultValue:pe},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===pe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===pe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},he=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:i,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),ge=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),xe=function(e){e.type;var n=(0,b.useIntl)(),t=(0,y.useRef)(!1),r=(0,te.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,y.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],m=p[1],h=(0,y.useState)(!1),g=i()(h,2),v=g[0],w=g[1],k=(0,B.u)((function(e){return e.currentOrg})),Z=he((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),M=Z.wechatAppResult,A=Z.currentWechatApp,I=Z.setWechatAppResult,E=Z.insertWechatApp,T=Z.setCurrentWechatApp,W=Z.deleteCurrentWechatApp,F=Q.Z.useModal(),q=i()(F,2),D=q[0],z=q[1],O=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete wechatApp",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,U(t);case 4:r=e.sent,console.log("delete wechatApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==k?void 0:k.uid},e.next=8,P(n);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(R.yw.destroy(),I(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){K();var e=function(e){m(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var N=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),w(!0),e.prev=2,!f){e.next=8;break}return e.next=6,ae(n);case 6:e.next=10;break;case 8:return e.next=10,re(n);case 10:return e.prev=10,w(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,L(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(E(t.data),T(t.data),u(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==A?void 0:A.uid,R.yw.loading("正在更新..."),e.next=4,V(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(T(t.data),u(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){u(!0),m(!1)},children:n.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:K,children:n.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==A?void 0:A.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),u(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=A,void D.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){O(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:A.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",ge[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,j.jsx)(me,{isEdit:f,open:c,loading:v,wechatApp:A,onClose:function(){u(!1)},onSubmit:N}),z]})},ye=t(32327),ve=t(62673),je=t(73589),we=t(29266),ke=t(19116),Ze=t(88996),be=t(38775),Me=t(83337),Ae=t(34600),Ce=t(15892),Ie=t(54800),Se=t(5716),Ee=t(90297),Te=t(34545),Re=t(28977),Pe=t.n(Re),We=ye.Z.Text,Fe=ye.Z.Paragraph,qe=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Le=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Me.Z,{})),p.qRy,(0,j.jsx)(Ae.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),De={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Ve={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},ze=function(){var e,n=(0,b.useIntl)(),t=he((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=t.currentWechatApp,a=t.refreshCurrentWechatApp,s=(0,y.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],m=(0,y.useState)(!1),h=i()(m,2),g=h[0],x=h[1],w=(0,y.useState)(!1),k=i()(w,2),Z=k[0],M=k[1],A=(0,y.useState)(!1),I=i()(A,2),E=(I[0],I[1],(0,y.useState)(!1)),T=i()(E,2),P=T[0],W=T[1],q=(0,y.useState)(!1),L=i()(q,2),D=L[0],V=L[1],z=function(e,n){return e?n?e:"******":"-"},U=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,K({uid:r.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),a&&a(n.data),O()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return V(!0),e.prev=4,e.next=7,F({uid:r.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),a&&a(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,V(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Le[r.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:qe[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:O,loading:D,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(We,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:qe[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(We,{copyable:!0,children:r.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(We,{copyable:!!p&&{text:r.appSecret||""},children:z(r.appSecret,p)}),(0,j.jsx)(Ze.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:p?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"加密模式",children:(0,j.jsx)(we.Z,{color:Ve[r.encryptMode]||"default",children:De[r.encryptMode]||r.encryptMode})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(We,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/webhooks/"+r.uid})}),(0,j.jsx)(ke.Z.Item,{label:"Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(We,{copyable:!!g&&{text:r.token||""},children:z(r.token,g)}),(0,j.jsx)(Ze.Z,{title:g?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:g?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return x(!g)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(We,{copyable:!!Z&&{text:r.encodingAesKey||""},children:z(r.encodingAesKey,Z)}),(0,j.jsx)(Ze.Z,{title:Z?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(ee.ZP,{type:"text",icon:Z?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return M(!Z)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(We,{copyable:!!l&&{text:r.accessToken||""},children:z(r.accessToken,l)}),(0,j.jsx)(Ze.Z,{title:l?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:l?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Te.Z,{}),onClick:U,size:"small",loading:P,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Pe()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(Fe,{children:r.description})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Pe()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(Fe,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Ue=function(e){console.log(e)},Oe=[{key:"detail",label:"应用详情",children:(0,j.jsx)(ze,{})}],Ke=function(e){e.type;var n=(0,y.useState)(Oe),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(Oe);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:Ue})})},Ne=a.Z.Sider,Be=a.Z.Content,Ye=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Ne,{width:i,style:s,children:(0,j.jsx)(xe,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Be,{children:(0,j.jsx)(Ke,{type:n})})})]})},_e=t(24170),Ge=t(91723),He=t(67402),Je=t(71529),Xe=function(e){var n=e.platform,t=void 0===n?"react":n,r=(0,b.useIntl)(),a=(0,y.useState)(t),s=i()(a,2),o=s[0],l=s[1],c=o.charAt(0).toUpperCase()+o.slice(1),u="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(c);return(0,j.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,j.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsx)("h2",{children:(0,j.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:r.formatMessage({id:"install.guide.github"})})}),(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Je.Z,{}),href:"".concat("https://www.weiyuai.cn/docs/zh-CN/docs/channel/").concat("vanilla"===o?"web":o),target:"_blank",children:r.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,j.jsx)(be.Z,{orientation:"left",children:"选择框架"}),(0,j.jsx)(He.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){l(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,j.jsx)("h2",{children:r.formatMessage({id:"install.guide.steps"})}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step1.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(r.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step2.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step3.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(r.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(r.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step4.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(u," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(r.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step5.title"})}),(0,j.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",r.formatMessage({id:"install.guide.step5.show"})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",r.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},Qe=t(1902),$e=ye.Z.Title,en=ye.Z.Text,nn=function(e){var n=e.channel,t=((0,y.useRef)(!1),(0,te.Z)().translateString),r=g((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),a=r.currentType,s=r.setCurrentType,o=(0,B.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,Qe.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,f=c.setAgentResult,m=c.setCurrentAgent,h=(0,y.useState)([]),x=i()(h,2),v=x[0],w=x[1],k=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),Z=k.workgroupResult,b=k.currentWorkgroup,M=k.setWorkgroupResult,A=k.setCurrentWorkgroup,I=(0,y.useState)(null==d?void 0:d.uid),E=i()(I,2),T=E[0],P=E[1],W=(0,y.useState)(null==b?void 0:b.uid),F=i()(W,2),q=F[0],L=F[1],D=(0,y.useState)([]),V=i()(D,2),z=V[0],U=V[1],O=function(){var e=S()(C()().mark((function e(){var n,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,_e._t)(n);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(R.yw.destroy(),f(r),r.data.content.length>0&&(m(r.data.content[0]),P(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),w(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(){var n,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,re.LE)(n);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(R.yw.destroy(),M(r),r.data.content.length>0&&(A(r.data.content[0]),L(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),U(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){O(),K()}),[a]);var N=["web","npm","ios","android","flutter","uniapp"].includes((null==n?void 0:n.name)||"");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(He.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),s(e.target.value)},options:l,defaultValue:a,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)("br",{}),(0,j.jsx)("br",{}),a===p.Njn&&(null==d?void 0:d.uid)&&(0,j.jsx)(He.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=u.data.content.find((function(n){return n.uid===e.target.value}));m(n)},options:v,defaultValue:T,optionType:"button",buttonStyle:"solid"}),a===p.aZD&&(null==d?void 0:d.uid)&&(0,j.jsx)(He.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=Z.data.content.find((function(n){return n.uid===e.target.value}));A(n)},options:z,defaultValue:q,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)(be.Z,{}),(0,j.jsx)($e,{level:5,children:"组织orgUid"}),(0,j.jsx)(en,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,j.jsx)($e,{level:5,children:"一对一当前客服Uid"}),(0,j.jsx)(en,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,j.jsx)($e,{level:5,children:"当前技能组Uid"}),(0,j.jsx)(en,{code:!0,copyable:!0,children:null==b?void 0:b.uid}),(0,j.jsx)(be.Z,{}),N&&("web"===(null==n?void 0:n.name)?(0,j.jsx)(Ge.Z,{type:p.aZD}):"npm"===(null==n?void 0:n.name)?(0,j.jsx)(Xe,{}):null)]})};function tn(e){return rn.apply(this,arguments)}function rn(){return(rn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(e){return sn.apply(this,arguments)}function sn(){return(sn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e){return ln.apply(this,arguments)}function ln(){return(ln=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e){return un.apply(this,arguments)}function un(){return(un=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dn=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().appResult),{},{data:{content:s}});e({appResult:i,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),pn=t(32350),fn=function(e){var n=e.open,t=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,o=(0,b.useIntl)(),l=se.A.useForm(),u=i()(l,1)[0],d=(0,B.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,y.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,j.jsx)(le.Z,{title:t?o.formatMessage({id:"edit",defaultMessage:"编辑应用"}):o.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:n,onClose:a,maskClosable:!0,extra:(0,j.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,j.jsx)(ee.ZP,{onClick:a,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,j.jsx)(ee.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});s(n)}))},type:"primary",children:o.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,j.jsxs)(se.A,{form:u,layout:"vertical",submitter:!1,children:[(0,j.jsx)(ie.Z,{name:"name",label:o.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:o.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:o.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,j.jsx)(oe.Z,{name:"appPlatform",label:o.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:o.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:o.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,j.jsx)(ie.Z,{name:"appPackage",label:o.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:o.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:o.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,j.jsx)(ie.Z,{name:"appKey",label:"App Key",placeholder:o.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,j.jsx)(ee.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,j.jsx)(ie.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:o.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,j.jsx)(pn.Z,{name:"description",label:o.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:o.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},mn=function(e){e.type;var n=(0,b.useIntl)(),t=(0,y.useRef)(!1),r=(0,te.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,y.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],m=p[1],h=(0,B.u)((function(e){return e.currentOrg})),g=dn((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),v=g.appResult,w=g.currentApp,k=g.setAppResult,Z=g.insertApp,M=g.setCurrentApp,A=g.deleteCurrentApp,I=Q.Z.useModal(),E=i()(I,2),T=E[0],P=E[1],W=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete app",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除"})),e.next=4,cn(t);case 4:r=e.sent,console.log("delete app response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),A(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),F=function(){var e=S()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=8,tn(n);case 8:r=e.sent,console.log("getApps",r),200===r.code?(R.yw.destroy(),k(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){F()}),[]);var q=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,an(t);case 2:r=e.sent,console.log("handleCreateApp response:",r),200===r.code?(Z(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):R.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==w?void 0:w.uid,e.next=3,on(t);case 3:r=e.sent,console.log("handleUpdateApp response:",r),200===r.code?(M(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):R.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(ee.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(_.Z,{}),onClick:function(){u(!0),m(!1)},children:n.formatMessage({id:"create",defaultMessage:"新建"})}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){m(!0),u(!0)},disabled:""===(null==w?void 0:w.uid),children:n.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,j.jsx)(ee.ZP,{size:"small",danger:!0,onClick:function(){return function(e){T.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(e.name,"】？"),onOk:function(){W(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(w)},disabled:""===(null==w?void 0:w.uid),children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:w.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){M(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",r(null==e?void 0:e.appPlatform),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,j.jsx)(fn,{isEdit:f,open:c,app:w,onClose:function(){u(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),f?L(e):q(e)}}),P]})},hn=t(2523),gn=t(48006),xn=t(40795),yn=ye.Z.Text,vn=ye.Z.Paragraph,jn={android:(0,j.jsx)(hn.Z,{}),ios:(0,j.jsx)(gn.Z,{}),flutter:(0,j.jsx)(xn.Z,{}),uniapp:(0,j.jsx)(Ae.Z,{})},wn={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},kn=function(){var e=(0,b.useIntl)(),n=dn().currentApp;return null!=n&&n.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[jn[n.appPlatform]||(0,j.jsx)(xn.Z,{}),(0,j.jsx)("span",{children:n.name||"应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:wn[n.appPlatform]||n.appPlatform})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(yn,{copyable:!0,children:n.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,j.jsx)(ke.Z.Item,{label:"App Key",children:(0,j.jsx)(yn,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,j.jsx)(ke.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(vn,{children:n.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(vn,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先选择或创建一个应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Zn=t(69079),bn=t(72608),Mn=ye.Z.Title,An=ye.Z.Paragraph,Cn=ye.Z.Text,In=(ye.Z.Link,Z.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),Sn=function(){(0,b.useIntl)();var e=dn().currentApp,n=(0,B.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先选择或创建一个应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})});return(0,j.jsxs)(ve.Z,{title:"集成指南",bordered:!1,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Zn.Z,{}),onClick:function(){var n=e.appPlatform,t=In[n];t?window.open(t,"_blank"):bn.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Je.Z,{}),onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,j.jsxs)(Mn,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,j.jsxs)(An,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(Mn,{level:5,children:"1. 基本配置"}),(0,j.jsx)(An,{children:(0,j.jsxs)("ul",{children:[e.appKey&&(0,j.jsxs)("li",{children:[(0,j.jsx)(Cn,{strong:!0,children:"App Key:"})," ",(0,j.jsx)(Cn,{copyable:!0,children:e.appKey})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)(Cn,{strong:!0,children:"组织ID:"})," ",(0,j.jsx)(Cn,{copyable:!0,children:null==n?void 0:n.uid})]})]})}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(An,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},En=function(e){console.log(e)},Tn=[{key:"details",label:"应用详情",children:(0,j.jsx)(kn,{})},{key:"integration",label:"集成指南",children:(0,j.jsx)(Sn,{})}],Rn=function(e){e.type;var n=(0,y.useState)([]),t=i()(n,2),r=t[0],a=t[1];dn((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,y.useEffect)((function(){var e=[].concat(Tn);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"details",items:r,onChange:En})})},Pn=a.Z.Sider,Wn=a.Z.Content,Fn=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Pn,{width:i,style:s,children:(0,j.jsx)(mn,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Wn,{children:(0,j.jsx)(Rn,{type:n})})})]})};function qn(e){return Ln.apply(this,arguments)}function Ln(){return(Ln=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dn(e){return Vn.apply(this,arguments)}function Vn(){return Vn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Vn.apply(this,arguments)}function zn(e){return Un.apply(this,arguments)}function Un(){return(Un=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return Kn.apply(this,arguments)}function Kn(){return Kn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Kn.apply(this,arguments)}var Nn="WORK",Bn=function(e){var n,t=e.isEdit,r=e.email,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==m?void 0:m.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Nn,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Email应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Yn=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{emailResult:{data:{content:[]}},currentEmail:{uid:"",nickname:"",avatar:"",description:""},insertEmail:function(n){e((function(e){e.emailResult.data.content.unshift(n)}))},updateEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Email with uid ".concat(n.uid," not found."))}))},deleteEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Email with uid ".concat(n.uid," not found."))}))},setEmailResult:function(t){var r;(e({emailResult:t}),""===n().currentEmail.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentEmail:t.data.content[0]}))},setCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().emailResult),{},{data:{content:s}});e({emailResult:i,currentEmail:t})}else console.warn("Email with the specified uid not found."),e({currentEmail:t})},refreshCurrentEmail:function(n){e((function(e){e.currentEmail=c()(c()({},e.currentEmail),n);var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({emailResult:c()(c()({},n().emailResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Email not found in cache:",t),n().currentEmail.uid===t&&e({currentEmail:{uid:""}})},deleteEmailCache:function(){return e({},!0)}}})),{name:p.e73}))),_n=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=Yn((function(e){return{emailResult:e.emailResult,currentEmail:e.currentEmail,setEmailResult:e.setEmailResult,insertEmail:e.insertEmail,setCurrentEmail:e.setCurrentEmail,deleteCurrentEmail:e.deleteCurrentEmail}})),A=M.emailResult,I=M.currentEmail,E=M.setEmailResult,T=M.insertEmail,P=M.setCurrentEmail,W=M.deleteCurrentEmail,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete email",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,On(n);case 4:r=e.sent,console.log("delete email response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,qn(n);case 8:t=e.sent,console.log("getEmails response:",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Dn(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateEmail response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,zn(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateEmail response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Bn,{type:n,isEdit:m,open:u,loading:w,email:I,onClose:function(){d(!1)},onSubmit:U}),D]})},Gn=ye.Z.Text,Hn=T()(T()(T()(T()({},p.a4q,"Email公众号"),p.qRy,"Email小程序"),p._oo,"企业Email"),p.rWo,"Email客服"),Jn=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Me.Z,{})),p.qRy,(0,j.jsx)(Ae.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),Xn=function(){var e,n=(0,b.useIntl)(),t=Yn((function(e){return{currentEmail:e.currentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})).currentEmail,r=(0,y.useState)(!1),a=i()(r,2),s=(a[0],a[1],(0,y.useState)(!1)),o=i()(s,2),l=(o[0],o[1],(0,y.useState)(!1)),c=i()(l,2),u=(c[0],c[1],(0,y.useState)(!1)),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),m=(f[0],f[1],(0,y.useState)(!1)),h=i()(m,2),g=(h[0],h[1],(0,y.useState)(!1)),x=i()(g,2),w=x[0],k=x[1],Z=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:k(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,j.jsx)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Jn[t.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:t.name||"Email应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Hn[t.type]||t.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:Z,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Gn,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Hn[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(Gn,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==t||null===(e=t.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]})}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Email应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Qn=function(e){console.log(e)},$n=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Xn,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Qn})})},et=a.Z.Sider,nt=a.Z.Content,tt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(et,{width:i,style:s,children:(0,j.jsx)(_n,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(nt,{children:(0,j.jsx)($n,{type:n})})})]})};function rt(e){return at.apply(this,arguments)}function at(){return(at=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return it=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),it.apply(this,arguments)}function ot(e){return lt.apply(this,arguments)}function lt(){return(lt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e){return ut.apply(this,arguments)}function ut(){return ut=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}var dt="MP",pt="MINI",ft="WORK",mt="KEFU",ht=function(e){var n,t=e.isEdit,r=e.telegram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==m?void 0:m.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:ft,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:dt},{label:"微信小程序",value:pt},{label:"企业微信",value:ft},{label:"微信客服",value:mt}],fieldProps:{defaultValue:ft},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===ft?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===ft?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},gt=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{telegramResult:{data:{content:[]}},currentTelegram:{uid:"",nickname:"",avatar:"",description:""},insertTelegram:function(n){e((function(e){e.telegramResult.data.content.unshift(n)}))},updateTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Telegram with uid ".concat(n.uid," not found."))}))},deleteTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Telegram with uid ".concat(n.uid," not found."))}))},setTelegramResult:function(t){var r;(e({telegramResult:t}),""===n().currentTelegram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentTelegram:t.data.content[0]}))},setCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().telegramResult),{},{data:{content:s}});e({telegramResult:i,currentTelegram:t})}else console.warn("Telegram with the specified uid not found."),e({currentTelegram:t})},refreshCurrentTelegram:function(n){e((function(e){e.currentTelegram=c()(c()({},e.currentTelegram),n);var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({telegramResult:c()(c()({},n().telegramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Telegram not found in cache:",t),n().currentTelegram.uid===t&&e({currentTelegram:{uid:""}})},deleteTelegramCache:function(){return e({},!0)}}})),{name:p.I2C}))),xt=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=gt((function(e){return{telegramResult:e.telegramResult,currentTelegram:e.currentTelegram,setTelegramResult:e.setTelegramResult,insertTelegram:e.insertTelegram,setCurrentTelegram:e.setCurrentTelegram,deleteCurrentTelegram:e.deleteCurrentTelegram}})),A=M.telegramResult,I=M.currentTelegram,E=M.setTelegramResult,T=M.insertTelegram,P=M.setCurrentTelegram,W=M.deleteCurrentTelegram,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete telegram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ct(n);case 4:r=e.sent,console.log("delete telegram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,rt(n);case 8:t=e.sent,console.log("getTelegrams response",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,st(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateTelegram response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,ot(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateTelegram response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]})})})}}),u&&(0,j.jsx)(ht,{type:n,isEdit:m,open:u,loading:w,telegram:I,onClose:function(){d(!1)},onSubmit:U}),D]})},yt=ye.Z.Text,vt=ye.Z.Paragraph,jt=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),wt=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Me.Z,{})),p.qRy,(0,j.jsx)(Ae.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),kt=function(e){e.type;var n=(0,b.useIntl)(),t=gt((function(e){return{currentTelegram:e.currentTelegram,refreshCurrentTelegram:e.refreshCurrentTelegram}})),r=t.currentTelegram,a=(t.refreshCurrentTelegram,(0,y.useState)(!1)),s=i()(a,2),o=(s[0],s[1],(0,y.useState)(!1)),l=i()(o,2),c=(l[0],l[1],(0,y.useState)(!1)),u=i()(c,2),d=(u[0],u[1],(0,y.useState)(!1)),p=i()(d,2),f=(p[0],p[1],(0,y.useState)(!1)),m=i()(f,2),h=(m[0],m[1],(0,y.useState)(!1)),g=i()(h,2),x=(g[0],g[1],(0,y.useState)(!1)),v=i()(x,2),w=v[0],k=v[1],Z=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:k(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[wt[r.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:jt[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:Z,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(yt,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:jt[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Pe()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(vt,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Zt=function(e){console.log(e)},bt=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(kt,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Zt})})},Mt=a.Z.Sider,At=a.Z.Content,Ct=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Mt,{width:i,style:s,children:(0,j.jsx)(xt,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(At,{children:(0,j.jsx)(bt,{type:n})})})]})};function It(e){return St.apply(this,arguments)}function St(){return(St=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Et(e){return Tt.apply(this,arguments)}function Tt(){return Tt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Tt.apply(this,arguments)}function Rt(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return Ft.apply(this,arguments)}function Ft(){return Ft=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Ft.apply(this,arguments)}var qt="MP",Lt="MINI",Dt="WORK",Vt="KEFU",zt=function(e){var n,t=e.isEdit,r=e.line,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==m?void 0:m.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Dt,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:qt},{label:"微信小程序",value:Lt},{label:"企业微信",value:Dt},{label:"微信客服",value:Vt}],fieldProps:{defaultValue:Dt},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===Dt?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===Dt?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Ut=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{lineResult:{data:{content:[]}},currentLine:{uid:"",nickname:"",avatar:"",description:""},insertLine:function(n){e((function(e){e.lineResult.data.content.unshift(n)}))},updateLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Line with uid ".concat(n.uid," not found."))}))},deleteLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Line with uid ".concat(n.uid," not found."))}))},setLineResult:function(t){var r;(e({lineResult:t}),""===n().currentLine.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLine:t.data.content[0]}))},setCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().lineResult),{},{data:{content:s}});e({lineResult:i,currentLine:t})}else console.warn("Line with the specified uid not found."),e({currentLine:t})},refreshCurrentLine:function(n){e((function(e){e.currentLine=c()(c()({},e.currentLine),n);var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({lineResult:c()(c()({},n().lineResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Line not found in cache:",t),n().currentLine.uid===t&&e({currentLine:{uid:""}})},deleteLineCache:function(){return e({},!0)}}})),{name:p.yRi}))),Ot=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=Ut((function(e){return{lineResult:e.lineResult,currentLine:e.currentLine,setLineResult:e.setLineResult,insertLine:e.insertLine,setCurrentLine:e.setCurrentLine,deleteCurrentLine:e.deleteCurrentLine}})),A=M.lineResult,I=M.currentLine,E=M.setLineResult,T=M.insertLine,P=M.setCurrentLine,W=M.deleteCurrentLine,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete line",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Wt(n);case 4:r=e.sent,console.log("delete line response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,It(n);case 8:t=e.sent,console.log("getLines response:",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Et(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateLine response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,Rt(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateLine response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]})})})}}),u&&(0,j.jsx)(zt,{type:n,isEdit:m,open:u,loading:w,line:I,onClose:function(){d(!1)},onSubmit:U}),D]})},Kt=ye.Z.Text,Nt=ye.Z.Paragraph,Bt=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Yt=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Me.Z,{})),p.qRy,(0,j.jsx)(Ae.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),_t=function(e){e.type;var n=(0,b.useIntl)(),t=Ut((function(e){return{currentLine:e.currentLine,refreshCurrentLine:e.refreshCurrentLine}})),r=t.currentLine,a=(t.refreshCurrentLine,(0,y.useState)(!1)),s=i()(a,2),o=s[0],l=s[1],c=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:l(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Yt[r.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Bt[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:c,loading:o,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Kt,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Bt[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Pe()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(Nt,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Gt=function(e){console.log(e)},Ht=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(_t,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Gt})})},Jt=a.Z.Sider,Xt=a.Z.Content,Qt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Jt,{width:i,style:s,children:(0,j.jsx)(Ot,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Xt,{children:(0,j.jsx)(Ht,{type:n})})})]})};function $t(e){return er.apply(this,arguments)}function er(){return(er=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(e){return tr.apply(this,arguments)}function tr(){return(tr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(e){return ar.apply(this,arguments)}function ar(){return(ar=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sr(e){return ir.apply(this,arguments)}function ir(){return(ir=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function or(e){return lr.apply(this,arguments)}function lr(){return(lr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cr(e){return ur.apply(this,arguments)}function ur(){return(ur=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dr="MP",pr="MINI",fr="WORK",mr="KEFU",hr=function(e){var n,t=e.isEdit,r=e.whatsApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==m?void 0:m.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||fr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:fr,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:dr},{label:"微信小程序",value:pr},{label:"企业微信",value:fr},{label:"微信客服",value:mr}],fieldProps:{defaultValue:fr},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===fr?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===fr?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},gr=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{whatsAppResult:{data:{content:[]}},currentWhatsApp:{uid:"",nickname:"",avatar:"",description:""},insertWhatsApp:function(n){e((function(e){e.whatsAppResult.data.content.unshift(n)}))},updateWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},deleteWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},setWhatsAppResult:function(t){var r;(e({whatsAppResult:t}),""===n().currentWhatsApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWhatsApp:t.data.content[0]}))},setCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().whatsAppResult),{},{data:{content:s}});e({whatsAppResult:i,currentWhatsApp:t})}else console.warn("WhatsApp with the specified uid not found."),e({currentWhatsApp:t})},refreshCurrentWhatsApp:function(n){e((function(e){e.currentWhatsApp=c()(c()({},e.currentWhatsApp),n);var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({whatsAppResult:c()(c()({},n().whatsAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WhatsApp not found in cache:",t),n().currentWhatsApp.uid===t&&e({currentWhatsApp:{uid:""}})},deleteWhatsAppCache:function(){return e({},!0)}}})),{name:p.TvW}))),xr=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=gr((function(e){return{whatsAppResult:e.whatsAppResult,currentWhatsApp:e.currentWhatsApp,setWhatsAppResult:e.setWhatsAppResult,insertWhatsApp:e.insertWhatsApp,setCurrentWhatsApp:e.setCurrentWhatsApp,deleteCurrentWhatsApp:e.deleteCurrentWhatsApp}})),A=M.whatsAppResult,I=M.currentWhatsApp,E=M.setWhatsAppResult,T=M.insertWhatsApp,P=M.setCurrentWhatsApp,W=M.deleteCurrentWhatsApp,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete whatsApp",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,or(n);case 4:r=e.sent,console.log("delete whatsApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,$t(n);case 8:t=e.sent,console.log("getWhatsApps response",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,rr(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWhatsApp response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,sr(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWhatsApp response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=I,void L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})});var e}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(hr,{type:n,isEdit:m,open:u,loading:w,whatsApp:I,onClose:function(){d(!1)},onSubmit:U}),D]})},yr=ye.Z.Text,vr=ye.Z.Paragraph,jr=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),wr=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Me.Z,{})),p.qRy,(0,j.jsx)(Ae.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),kr={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Zr={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},br=function(e){e.type;var n,t=(0,b.useIntl)(),r=gr((function(e){return{currentWhatsApp:e.currentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),a=r.currentWhatsApp,s=r.refreshCurrentWhatsApp,o=(0,y.useState)(!1),l=i()(o,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],m=p[1],h=(0,y.useState)(!1),g=i()(h,2),x=g[0],w=g[1],k=(0,y.useState)(!1),Z=i()(k,2),M=Z[0],A=Z[1],I=(0,y.useState)(!1),E=i()(I,2),T=E[0],P=E[1],W=(0,y.useState)(!1),F=i()(W,2),q=F[0],L=F[1],D=function(e,n){return e?n?e:"******":"-"},V=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return P(!0),e.prev=4,e.next=7,cr({uid:a.uid});case 7:n=e.sent,console.log("refreshAccessTokenWhatsApp response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),s&&s(n.data),z()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,P(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return L(!0),e.prev=4,e.next=7,nr({uid:a.uid});case 7:n=e.sent,console.log("queryWhatsAppByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),s&&s(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,L(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=a&&a.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[wr[a.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:a.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:jr[a.type]||a.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:a}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:z,loading:q,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(yr,{copyable:!0,children:a.uid})}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:a.name}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:jr[a.type]||a.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(yr,{copyable:!0,children:a.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(yr,{copyable:!!f&&{text:a.appSecret||""},children:D(a.appSecret,f)}),(0,j.jsx)(Ze.Z,{title:f?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:f?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return m(!f)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"加密模式",children:(0,j.jsx)(we.Z,{color:Zr[a.encryptMode]||"default",children:kr[a.encryptMode]||a.encryptMode})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(yr,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==a||null===(n=a.type)||void 0===n?void 0:n.toLowerCase())+"/hook/"+a.uid})}),(0,j.jsx)(ke.Z.Item,{label:"Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(yr,{copyable:!!x&&{text:a.token||""},children:D(a.token,x)}),(0,j.jsx)(Ze.Z,{title:x?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:x?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return w(!x)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(yr,{copyable:!!M&&{text:a.encodingAesKey||""},children:D(a.encodingAesKey,M)}),(0,j.jsx)(Ze.Z,{title:M?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(ee.ZP,{type:"text",icon:M?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return A(!M)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(yr,{copyable:!!c&&{text:a.accessToken||""},children:D(a.accessToken,c)}),(0,j.jsx)(Ze.Z,{title:c?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:c?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return u(!c)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Te.Z,{}),onClick:V,size:"small",loading:T,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:a.accessTokenExpiresAt?Pe()(a.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),a.description&&(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(vr,{children:a.description})}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:a.createdAt?Pe()(a.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(vr,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Mr=function(e){console.log(e)},Ar=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(br,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Mr})})},Cr=a.Z.Sider,Ir=a.Z.Content,Sr=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Cr,{width:i,style:s,children:(0,j.jsx)(xr,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Ir,{children:(0,j.jsx)(Ar,{type:n})})})]})};function Er(e){return Tr.apply(this,arguments)}function Tr(){return(Tr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rr(e){return Pr.apply(this,arguments)}function Pr(){return(Pr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wr(e){return Fr.apply(this,arguments)}function Fr(){return(Fr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qr(e){return Lr.apply(this,arguments)}function Lr(){return(Lr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dr(e){return Vr.apply(this,arguments)}function Vr(){return(Vr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zr(e){return Ur.apply(this,arguments)}function Ur(){return(Ur=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Or=t(84176),Kr=t.n(Or),Nr=["token"],Br="WEBHOOK",Yr="MESSENGER",_r="INSTAGRAM",Gr="WHATSAPP",Hr=function(e){var n,t=e.isEdit,r=e.messenger,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=e.token,t=Kr()(e,Nr),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==m?void 0:m.uid});console.log("submit",r),u(r)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Yr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Yr,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Br},{label:"Messenger",value:Yr},{label:"Instagram",value:_r},{label:"Whatsapp",value:Gr}],fieldProps:{defaultValue:Br},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,j.jsx)(ie.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Jr=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{messengerResult:{data:{content:[]}},currentMessenger:{uid:"",nickname:"",avatar:"",description:""},insertMessenger:function(n){e((function(e){e.messengerResult.data.content.unshift(n)}))},updateMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Messenger with uid ".concat(n.uid," not found."))}))},deleteMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Messenger with uid ".concat(n.uid," not found."))}))},setMessengerResult:function(t){var r;(e({messengerResult:t}),""===n().currentMessenger.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMessenger:t.data.content[0]}))},setCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().messengerResult),{},{data:{content:s}});e({messengerResult:i,currentMessenger:t})}else console.warn("Messenger with the specified uid not found."),e({currentMessenger:t})},refreshCurrentMessenger:function(n){e((function(e){e.currentMessenger=c()(c()({},e.currentMessenger),n);var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({messengerResult:c()(c()({},n().messengerResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Messenger not found in cache:",t),n().currentMessenger.uid===t&&e({currentMessenger:{uid:""}})},deleteMessengerCache:function(){return e({},!0)}}})),{name:p.Gmi}))),Xr=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Qr=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=Jr((function(e){return{messengerResult:e.messengerResult,currentMessenger:e.currentMessenger,setMessengerResult:e.setMessengerResult,insertMessenger:e.insertMessenger,setCurrentMessenger:e.setCurrentMessenger,deleteCurrentMessenger:e.deleteCurrentMessenger}})),A=M.messengerResult,I=M.currentMessenger,E=M.setMessengerResult,T=M.insertMessenger,P=M.setCurrentMessenger,W=M.deleteCurrentMessenger,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete messenger",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Dr(n);case 4:r=e.sent,console.log("delete messenger response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var t,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,Er(t);case 8:a=e.sent,console.log("getMessengers response",a,t),200===a.code?(R.yw.destroy(),E(a)):(R.yw.destroy(),R.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Wr(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateMessenger response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,qr(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateMessenger response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:(null==I?void 0:I.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",Xr[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Hr,{isEdit:m,open:u,loading:w,messenger:I,onClose:function(){d(!1)},onSubmit:U}),D]})},$r=ye.Z.Text,ea=ye.Z.Paragraph,na=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),ta=T()(T()(T()(T()({},p.Iap,(0,j.jsx)(Ee.Z,{})),p.Ff2,(0,j.jsx)(Me.Z,{})),p.cRk,(0,j.jsx)(Ae.Z,{})),p.SbP,(0,j.jsx)(Ce.Z,{})),ra="appSecret",aa="verifyToken",sa="accessToken",ia="pageAccessToken",oa=function(){var e=(0,b.useIntl)(),n=Jr((function(e){return{currentMessenger:e.currentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),t=n.currentMessenger,r=n.refreshCurrentMessenger,a=(0,y.useState)(T()(T()(T()(T()({},ra,!1),aa,!1),sa,!1),ia,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),x=i()(g,2),w=x[0],k=x[1],Z=function(e){l((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},M=function(e,n){return e?n?e:"******":"-"},A=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return h(!0),e.prev=4,e.next=7,zr({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenMessenger response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),r&&r(n.data),I()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=S()(C()().mark((function e(){var n,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return k(!0),e.prev=4,e.next=7,Rr({uid:t.uid});case 7:n=e.sent,console.log("queryMessengerByUid refresh detail",n),200===n.code?(a=n.data,R.yw.success("应用详情刷新成功"),r&&r(a)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[ta[t.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:t.name||"Meta应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:na[t.type]||t.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:I,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)($r,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:na[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID",children:(0,j.jsx)($r,{copyable:!0,children:t.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)($r,{copyable:!!o[ra]&&{text:t.appSecret||""},children:M(t.appSecret,o[ra])}),(0,j.jsx)(Ze.Z,{title:o[ra]?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[ra]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(ra)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"回调网址",children:(0,j.jsx)($r,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:"验证口令",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)($r,{copyable:!!o[aa]&&{text:t.verifyToken||""},children:M(t.verifyToken,o[aa])}),(0,j.jsx)(Ze.Z,{title:o[aa]?"隐藏Verify Token":"显示Verify Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[aa]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(aa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)($r,{copyable:!!o[ia]&&{text:t.pageAccessToken||""},children:M(t.pageAccessToken,o[ia])}),(0,j.jsx)(Ze.Z,{title:o[ia]?"隐藏Page Access Token":"显示Page Access Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[ia]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(ia)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page ID",children:(0,j.jsx)($r,{copyable:!0,children:t.pageId||"-"})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)($r,{copyable:!!o[sa]&&{text:t.accessToken||""},children:M(t.accessToken,o[sa])}),(0,j.jsx)(Ze.Z,{title:o[sa]?"隐藏AccessToken":"显示AccessToken",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[sa]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(sa)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Te.Z,{}),onClick:A,size:"small",loading:m,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Pe()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(ea,{children:t.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(ea,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Meta应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},la=function(e){console.log(e)},ca=[{key:"detail",label:"应用详情",children:(0,j.jsx)(oa,{})}],ua=function(e){e.type;var n=(0,y.useState)(ca),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(ca);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:la})})},da=a.Z.Sider,pa=a.Z.Content,fa=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(da,{width:i,style:s,children:(0,j.jsx)(Qr,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(pa,{children:(0,j.jsx)(ua,{type:n})})})]})};function ma(e){return ha.apply(this,arguments)}function ha(){return(ha=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ga(e){return xa.apply(this,arguments)}function xa(){return(xa=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ya(e){return va.apply(this,arguments)}function va(){return(va=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ja(e){return wa.apply(this,arguments)}function wa(){return(wa=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ka(e){return Za.apply(this,arguments)}function Za(){return(Za=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ba(e){return Ma.apply(this,arguments)}function Ma(){return(Ma=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Aa=["token"],Ca="WEBHOOK",Ia="MESSENGER",Sa="INSTAGRAM",Ea="WHATSAPP",Ta=function(e){var n,t=e.isEdit,r=e.instagram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,m=(0,B.u)((function(e){return e.currentOrg})),h=(0,y.useState)(!1),g=i()(h,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=e.token,t=Kr()(e,Aa),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==m?void 0:m.uid});console.log("submit",r),u(r)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Ia,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Ia,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n})}}),[t,r,p,k]);var M=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==m?void 0:m.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Ca},{label:"Messenger",value:Ia},{label:"Instagram",value:Sa},{label:"Whatsapp",value:Ea}],fieldProps:{defaultValue:Ca},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,j.jsx)(ie.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Ra=(0,f.Ue)()((0,m.mW)((0,m.tJ)((0,h.n)((function(e,n){return{instagramResult:{data:{content:[]}},currentInstagram:{uid:"",nickname:"",avatar:"",description:""},insertInstagram:function(n){e((function(e){e.instagramResult.data.content.unshift(n)}))},updateInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Instagram with uid ".concat(n.uid," not found."))}))},deleteInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Instagram with uid ".concat(n.uid," not found."))}))},setInstagramResult:function(t){var r;(e({instagramResult:t}),""===n().currentInstagram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentInstagram:t.data.content[0]}))},setCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().instagramResult),{},{data:{content:s}});e({instagramResult:i,currentInstagram:t})}else console.warn("Instagram with the specified uid not found."),e({currentInstagram:t})},refreshCurrentInstagram:function(n){e((function(e){e.currentInstagram=c()(c()({},e.currentInstagram),n);var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({instagramResult:c()(c()({},n().instagramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Instagram not found in cache:",t),n().currentInstagram.uid===t&&e({currentInstagram:{uid:""}})},deleteInstagramCache:function(){return e({},!0)}}})),{name:p.S6e}))),Pa=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Wa=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,B.u)((function(e){return e.currentOrg})),M=Ra((function(e){return{instagramResult:e.instagramResult,currentInstagram:e.currentInstagram,setInstagramResult:e.setInstagramResult,insertInstagram:e.insertInstagram,setCurrentInstagram:e.setCurrentInstagram,deleteCurrentInstagram:e.deleteCurrentInstagram}})),A=M.instagramResult,I=M.currentInstagram,E=M.setInstagramResult,T=M.insertInstagram,P=M.setCurrentInstagram,W=M.deleteCurrentInstagram,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],V=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete instagram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ka(n);case 4:r=e.sent,console.log("delete instagram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=S()(C()().mark((function e(){var t,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,ma(t);case 8:a=e.sent,console.log("getInstagram response",a,t),200===a.code?(R.yw.destroy(),E(a)):(R.yw.destroy(),R.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){z();var e=function(e){h(!0),d(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,K(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,ya(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateInstagram response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,ja(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateInstagram response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(_.Z,{}),onClick:function(){d(!0),h(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:z,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(Y.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){V(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:(null==I?void 0:I.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",Pa[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Ta,{isEdit:m,open:u,loading:w,instagram:I,onClose:function(){d(!1)},onSubmit:U}),D]})},Fa=ye.Z.Text,qa=ye.Z.Paragraph,La=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Da=T()(T()(T()(T()({},p.Iap,(0,j.jsx)(Ee.Z,{})),p.Ff2,(0,j.jsx)(Me.Z,{})),p.cRk,(0,j.jsx)(Ae.Z,{})),p.SbP,(0,j.jsx)(Ce.Z,{})),Va="appSecret",za="verifyToken",Ua="accessToken",Oa="pageAccessToken",Ka=function(){var e=(0,b.useIntl)(),n=Ra((function(e){return{currentInstagram:e.currentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),t=n.currentInstagram,r=n.refreshCurrentInstagram,a=(0,y.useState)(T()(T()(T()(T()({},Va,!1),za,!1),Ua,!1),Oa,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),m=f[0],h=f[1],g=(0,y.useState)(!1),x=i()(g,2),w=x[0],k=x[1],Z=function(e){l((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},M=function(e,n){return e?n?e:"******":"-"},A=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return h(!0),e.prev=4,e.next=7,ba({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenInstagram response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),r&&r(n.data),I()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=S()(C()().mark((function e(){var n,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return k(!0),e.prev=4,e.next=7,ga({uid:t.uid});case 7:n=e.sent,console.log("queryInstagramByUid refresh detail",n),200===n.code?(a=n.data,R.yw.success("应用详情刷新成功"),r&&r(a)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Da[t.type]||(0,j.jsx)(Me.Z,{}),(0,j.jsx)("span",{children:t.name||"Meta应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:La[t.type]||t.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:I,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Fa,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:La[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID",children:(0,j.jsx)(Fa,{copyable:!0,children:t.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fa,{copyable:!!o[Va]&&{text:t.appSecret||""},children:M(t.appSecret,o[Va])}),(0,j.jsx)(Ze.Z,{title:o[Va]?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Va]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(Va)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"回调网址",children:(0,j.jsx)(Fa,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:"验证口令",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fa,{copyable:!!o[za]&&{text:t.verifyToken||""},children:M(t.verifyToken,o[za])}),(0,j.jsx)(Ze.Z,{title:o[za]?"隐藏Verify Token":"显示Verify Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[za]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(za)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fa,{copyable:!!o[Oa]&&{text:t.pageAccessToken||""},children:M(t.pageAccessToken,o[Oa])}),(0,j.jsx)(Ze.Z,{title:o[Oa]?"隐藏Page Access Token":"显示Page Access Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Oa]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(Oa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page ID",children:(0,j.jsx)(Fa,{copyable:!0,children:t.pageId||"-"})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fa,{copyable:!!o[Ua]&&{text:t.accessToken||""},children:M(t.accessToken,o[Ua])}),(0,j.jsx)(Ze.Z,{title:o[Ua]?"隐藏AccessToken":"显示AccessToken",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Ua]?(0,j.jsx)(Se.Z,{}):(0,j.jsx)(Ee.Z,{}),onClick:function(){return Z(Ua)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Te.Z,{}),onClick:A,size:"small",loading:m,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Pe()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(qa,{children:t.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Pe()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(qa,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Meta应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Na=function(e){console.log(e)},Ba=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Ka,{})}],Ya=function(e){e.type;var n=(0,y.useState)(Ba),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(Ba);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:Na})})},_a=a.Z.Sider,Ga=a.Z.Content,Ha=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(_a,{width:i,style:s,children:(0,j.jsx)(Wa,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Ga,{children:(0,j.jsx)(Ya,{type:n})})})]})},Ja=function(e){var n=e.channel,t="web"===(null==n?void 0:n.name)||"npm"===(null==n?void 0:n.name);return(0,j.jsxs)("div",{children:[t&&(0,j.jsx)(nn,{channel:n}),"app"===(null==n?void 0:n.name)&&(0,j.jsx)(Fn,{type:null==n?void 0:n.name}),"wechat-app"===(null==n?void 0:n.name)&&(0,j.jsx)(Ye,{type:null==n?void 0:n.name}),"messenger"===(null==n?void 0:n.name)&&(0,j.jsx)(fa,{type:p.Ff2}),"instagram"===(null==n?void 0:n.name)&&(0,j.jsx)(Ha,{type:p.cRk}),"whatsapp"===(null==n?void 0:n.name)&&(0,j.jsx)(Sr,{type:p.SbP}),"telegram"===(null==n?void 0:n.name)&&(0,j.jsx)(Ct,{type:null==n?void 0:n.name}),"line"===(null==n?void 0:n.name)&&(0,j.jsx)(Qt,{type:null==n?void 0:n.name}),"email"===(null==n?void 0:n.name)&&(0,j.jsx)(tt,{type:null==n?void 0:n.name}),"douyin"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"baidu"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"weibo"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"pdd"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"jd"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"qianniu"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"doudian"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"telegram"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"facebook"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"line"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"shopify"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"lazada"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"wordpress"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"opencart"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"magento"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"prestashop"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"dify"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{}),"coze"===(null==n?void 0:n.name)&&(0,j.jsx)(M,{})]})},Xa=function(){var e=(0,y.useState)(""),n=i()(e,2),t=n[0],r=n[1],a=(0,y.useState)([]),s=i()(a,2),o=s[0],l=s[1],c=g().currentChannel;(0,y.useEffect)((function(){c&&u(c)}),[c]);var u=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&l([].concat(d()(o),[{label:e.nickname,key:n,children:(0,j.jsx)(Ja,{channel:e}),channelInfo:e,closable:!0}])),r(n)};return(0,j.jsx)(Z.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),a=o.filter((function(n){return n.key!==e}));if(a.length&&e===t){var s=a[n===a.length?n-1:n].key;r(s)}l(a)}(e)},items:o})},Qa=a.Z.Sider,$a=a.Z.Content,es=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Qa,{style:n,children:(0,j.jsx)(k,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)($a,{style:t,children:(0,j.jsx)(Xa,{})})})]})})}}}]);