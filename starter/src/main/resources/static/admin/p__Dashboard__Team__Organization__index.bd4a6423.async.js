"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4822],{58791:function(e,r,n){var o=n(83910),t=n(44194),i=n(85333),a=n(54183),s=function(e,r){return t.createElement(a.Z,(0,o.Z)({},e,{ref:r,icon:i.Z}))},l=t.forwardRef(s);r.Z=l},59908:function(e,r,n){n.d(r,{Z:function(){return l}});var o=n(83910),t=n(44194),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},a=n(54183),s=function(e,r){return t.createElement(a.Z,(0,o.Z)({},e,{ref:r,icon:i}))};var l=t.forwardRef(s)},86702:function(e,r,n){var o=n(32906),t=n(94433),i=n(38956),a=n(81424),s=n(69705),l=n(65641),d=n(34573),u=n(44194),c=n(9953),p=n(31549),f=["fieldProps","proFieldProps"],g=["fieldProps","proFieldProps"],m="text",x=function(e){var r=(0,a.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,o.Z)(r,2),i=n[0],d=n[1];return(0,p.jsx)(s.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(r){var n,o=r.getFieldValue(e.name||[]);return(0,p.jsx)(l.Z,(0,t.Z)((0,t.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return d(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,o),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:i,children:e.children}))}})},v=function(e){var r=e.fieldProps,n=e.proFieldProps,o=(0,i.Z)(e,f);return(0,p.jsx)(c.Z,(0,t.Z)({valueType:m,fieldProps:r,filedConfig:{valueType:m},proFieldProps:n},o))};v.Password=function(e){var r=e.fieldProps,n=e.proFieldProps,a=(0,i.Z)(e,g),s=(0,u.useState)(!1),l=(0,o.Z)(s,2),f=l[0],v=l[1];return null!=r&&r.statusRender&&a.name?(0,p.jsx)(x,{name:a.name,statusRender:null==r?void 0:r.statusRender,popoverProps:null==r?void 0:r.popoverProps,strengthText:null==r?void 0:r.strengthText,open:f,onOpenChange:v,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,t.Z)({valueType:"password",fieldProps:(0,t.Z)((0,t.Z)({},(0,d.Z)(r,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==r||null===(n=r.onBlur)||void 0===n||n.call(r,e),v(!1)},onClick:function(e){var n;null==r||null===(n=r.onClick)||void 0===n||n.call(r,e),v(!0)}}),proFieldProps:n,filedConfig:{valueType:m}},a))})}):(0,p.jsx)(c.Z,(0,t.Z)({valueType:"password",fieldProps:r,proFieldProps:n,filedConfig:{valueType:m}},a))},v.displayName="ProFormComponent",r.Z=v},60241:function(e,r,n){var o=n(94433),t=n(38956),i=n(44194),a=n(9953),s=n(31549),l=["fieldProps","proFieldProps"],d=function(e,r){var n=e.fieldProps,i=e.proFieldProps,d=(0,t.Z)(e,l);return(0,s.jsx)(a.Z,(0,o.Z)({ref:r,valueType:"textarea",fieldProps:n,proFieldProps:i},d))};r.Z=i.forwardRef(d)},11818:function(e,r,n){n.d(r,{G:function(){return f}});var o=n(73193),t=n.n(o),i=(n(44194),n(47710)),a=n(94976),s=n(96596),l=n.n(s),d=n(67242),u=n(43388),c=n(58620),p=n(31549),f=function(e){var r=e.children,n=e.onSuccess,o=e.onError,s={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:a.IrL,categoryUid:"",kbUid:"",channel:a.XtJ},f={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(a.LA8)},data:s,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var r=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return s.file=e,s.fileName=r,s.fileType=e.type,d.Z.log("beforeUpload",s),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var r,t=null===(r=e.file.response)||void 0===r?void 0:r.data.fileUrl;n(t),u.yw.success("".concat(e.file.name," 上传成功"))}else o(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),o(e.file))}};return(0,p.jsx)(i.Z,t()(t()({},f),{},{children:r}))}},99189:function(e,r,n){n.r(r),n.d(r,{default:function(){return A}});var o=n(73193),t=n.n(o),i=n(90819),a=n.n(i),s=n(89933),l=n.n(s),d=n(45332),u=n.n(d),c=n(43388),p=n(21586),f=n(74171),g=n(11818),m=n(83910),x=n(44194),v={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M894 462c30.9 0 43.8-39.7 18.7-58L530.8 126.2a31.81 31.81 0 00-37.6 0L111.3 404c-25.1 18.2-12.2 58 18.8 58H192v374h-72c-4.4 0-8 3.6-8 8v52c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-52c0-4.4-3.6-8-8-8h-72V462h62zM512 196.7l271.1 197.2H240.9L512 196.7zM264 462h117v374H264V462zm189 0h117v374H453V462zm307 374H642V462h118v374z"}}]},name:"bank",theme:"outlined"},h=n(54183),y=function(e,r){return x.createElement(h.Z,(0,m.Z)({},e,{ref:r,icon:v}))};var Z=x.forwardRef(y),b=n(59908),j=n(58791),w=n(99036),z=n(86702),P=n(60241),M=n(4628),k=n(82878),C=n(69705),T=n(68177),R=n(5957),F=n(26874),S=n(95018),O=n(30310),B=n(28582),V=n(69533),H=n(84993),U=n(25553),L=n(31549),E=k.Z.Title,q=k.Z.Text,A=function(){var e,r,n=C.Z.useForm(),o=u()(n,1)[0],i=(0,M.useIntl)(),s=(0,U.Z)().isDarkMode,d=((0,M.useModel)("@@initialState").initialState||{}).userInfo,m=(0,f.u)((function(e){return{currentOrg:e.currentOrg,setCurrentOrg:e.setCurrentOrg}})),v=m.currentOrg,h=m.setCurrentOrg,y=(0,x.useState)(""),k=u()(y,2),A=k[0],I=k[1],D=(0,x.useState)(!1),N=u()(D,2),W=N[0],Y=N[1],G=(null==d||null===(e=d.currentOrganization)||void 0===e||null===(e=e.user)||void 0===e?void 0:e.uid)||(null==v||null===(r=v.user)||void 0===r?void 0:r.uid),J=Boolean((null==d?void 0:d.uid)&&G&&d.uid===G),X=function(){var e=l()(a()().mark((function e(r){var n,o,t,s,l,d,u,f,g,m=arguments;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>1&&void 0!==m[1]?m[1]:"save",o=m.length>2?m[2]:void 0,J){e.next=4;break}return e.abrupt("return",!1);case 4:if(c.yw.loading({content:i.formatMessage({id:"saving"}),key:n,duration:0}),e.prev=5,null!=v&&v.uid){e.next=10;break}return c.yw.destroy(),c.yw.error(i.formatMessage({id:"save.failed"})),e.abrupt("return",!1);case 10:return u={uid:v.uid,name:null!==(t=r.name)&&void 0!==t?t:v.name,logo:null!==(s=r.logo)&&void 0!==s?s:v.logo,code:null!==(l=r.code)&&void 0!==l?l:v.code,description:null!==(d=r.description)&&void 0!==d?d:v.description},e.next=13,(0,p.RL)(u);case 13:if(f=e.sent,console.log("saveOrganization response:",f,u),200!==f.code){e.next=24;break}return c.yw.destroy(),g=o||i.formatMessage({id:"update.success"}),c.yw.success(g),h(null==f?void 0:f.data),r.logo&&I((null==f?void 0:f.data.logo)||r.logo),e.abrupt("return",!0);case 24:return c.yw.destroy(),c.yw.error(f.message),e.abrupt("return",!1);case 27:e.next=35;break;case 29:return e.prev=29,e.t0=e.catch(5),c.yw.destroy(),c.yw.error(i.formatMessage({id:"save.failed"})),console.error("saveOrganization error:",e.t0),e.abrupt("return",!1);case 35:case"end":return e.stop()}}),e,null,[[5,29]])})));return function(r){return e.apply(this,arguments)}}(),$=function(){var e=l()(a()().mark((function e(r){var n,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J){e.next=2;break}return e.abrupt("return");case 2:return console.log("handleUploadSuccess:",r),I(r),n=o.getFieldsValue(),s=t()(t()({},n),{},{logo:r}),e.next=8,X(s,"save-logo",i.formatMessage({id:"organization.logo.upload.success"}));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_=function(){var e=l()(a()().mark((function e(r){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J){e.next=2;break}return e.abrupt("return");case 2:return n=t()(t()({},r),{},{logo:A}),e.next=5,X(n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){d&&(d.currentOrganization?h(d.currentOrganization):Y(!0))}),[d,h]),(0,x.useEffect)((function(){v&&(I(v.logo),o.setFieldsValue({name:v.name,code:v.code,description:v.description}))}),[v,o]);var K=function(e){h(e),window.location.reload()};return v?(0,L.jsx)("div",{style:{padding:"24px",backgroundColor:s?"#141414":"#f0f2f5",minHeight:"100vh"},children:(0,L.jsxs)(T.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:s?"0 2px 8px rgba(255, 255, 255, 0.08)":"0 2px 8px rgba(0, 0, 0, 0.1)",backgroundColor:s?"#1f1f1f":"#ffffff"},children:[(0,L.jsxs)(E,{level:2,style:{marginBottom:"24px",textAlign:"center"},children:[(0,L.jsx)(Z,{style:{marginRight:"8px",color:"#1890ff"}}),i.formatMessage({id:"organization.title"})]}),!J&&(0,L.jsx)(R.Z,{type:"warning",showIcon:!0,style:{marginBottom:"24px"},message:i.formatMessage({id:"organization.permission.denied",defaultMessage:"无权限编辑组织信息"}),description:i.formatMessage({id:"organization.permission.denied.desc",defaultMessage:"仅当当前用户为该组织管理员时，才允许修改名称、编码、简介和 Logo。"})}),(0,L.jsx)(T.Z,{size:"small",style:{marginBottom:"24px",backgroundColor:s?"#262626":"#fafafa",borderRadius:"8px"},children:(0,L.jsx)(F.Z,{justify:"center",align:"middle",style:{padding:"20px 0"},children:(0,L.jsx)(S.Z,{children:(0,L.jsxs)(O.Z,{direction:"vertical",align:"center",size:"large",children:[(0,L.jsx)(B.Z,{src:A,size:100,style:{border:"4px solid #fff",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}}),J?(0,L.jsx)(g.G,{onSuccess:$,onError:function(e){console.log("handleUploadError:",e)},children:(0,L.jsx)(V.ZP,{type:"primary",icon:(0,L.jsx)(b.Z,{}),style:{borderRadius:"20px"},children:i.formatMessage({id:"organization.upload.logo"})})},"avatar"):(0,L.jsx)(V.ZP,{type:"primary",icon:(0,L.jsx)(b.Z,{}),disabled:!0,style:{borderRadius:"20px"},children:i.formatMessage({id:"organization.upload.logo"})})]})})})}),(0,L.jsx)(w.A,{form:o,onFinish:_,disabled:!J,submitter:{render:function(e,r){return(0,L.jsx)(F.Z,{justify:"center",style:{marginTop:"32px"},children:(0,L.jsx)(S.Z,{children:(0,L.jsx)(O.Z,{size:"middle",children:r})})})},submitButtonProps:{size:"large",disabled:!J,style:{borderRadius:"8px",minWidth:"120px"}},resetButtonProps:{size:"large",disabled:!J,style:{borderRadius:"8px",minWidth:"120px"},onClick:function(e){var r;null==e||null===(r=e.preventDefault)||void 0===r||r.call(e),v&&(o.resetFields(),I(v.logo||""),o.setFieldsValue({name:v.name,code:v.code,description:v.description}))}}},children:(0,L.jsxs)(T.Z,{title:(0,L.jsxs)(q,{strong:!0,style:{fontSize:"16px"},children:[(0,L.jsx)(j.Z,{style:{marginRight:"8px",color:"#1890ff"}}),i.formatMessage({id:"organization.info"})]}),size:"small",style:{marginBottom:"24px"},children:[(0,L.jsx)(z.Z,{rules:[{required:!0,message:i.formatMessage({id:"organization.name.required"})}],label:i.formatMessage({id:"organization.name.label"}),name:"name",width:"md",fieldProps:{prefix:(0,L.jsx)(j.Z,{style:{color:"#1890ff"}})}}),(0,L.jsx)(z.Z,{rules:[{required:!0,message:i.formatMessage({id:"organization.code.required"})}],label:i.formatMessage({id:"organization.code.label"}),name:"code",width:"md",fieldProps:{placeholder:i.formatMessage({id:"organization.code.placeholder"})}}),(0,L.jsx)(P.Z,{rules:[{required:!0,message:i.formatMessage({id:"organization.description.required"})}],label:i.formatMessage({id:"organization.description.label"}),name:"description",width:"md",fieldProps:{rows:4,placeholder:i.formatMessage({id:"organization.description.placeholder"})}})]})}),(0,L.jsx)(H.Z,{open:W,onClose:function(){return Y(!1)},onSuccess:K})]})}):(0,L.jsx)("div",{style:{padding:"24px",backgroundColor:s?"#141414":"#f0f2f5",minHeight:"100vh"},children:(0,L.jsxs)(T.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:s?"0 2px 8px rgba(255, 255, 255, 0.08)":"0 2px 8px rgba(0, 0, 0, 0.1)",textAlign:"center",padding:"100px 0",backgroundColor:s?"#1f1f1f":"#ffffff"},children:[(0,L.jsx)("div",{children:i.formatMessage({id:"loading"})}),(0,L.jsx)(H.Z,{open:W,onClose:function(){return Y(!1)},onSuccess:K})]})})}}}]);