"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3868],{32045:function(e,t,a){a.d(t,{XS:function(){return c},k4:function(){return p},uu:function(){return x},yr:function(){return m}});var r=a(90819),n=a.n(r),s=a(73193),o=a.n(s),i=a(89933),d=a.n(i),u=a(55735),l=a(30921);function c(e){return g.apply(this,arguments)}function g(){return(g=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},81651:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});var r=a(8247),n=a(21182),s=a(73193),o=a.n(s),i=a(84176),d=a.n(i),u=a(90819),l=a.n(u),c=a(89933),g=a.n(c),p=a(45332),f=a.n(p),m=a(86803),h=a(30921);function x(e){return M.apply(this,arguments)}function M(){return(M=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/invite/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=a(76750),y=a(40612),j=a(55735),w=a(44521),I=a(11090),S=a(81947),b=a(53530),F=a(29266),k=a(75365),T=a(44194),A=a(28977),E=a.n(A),C=a(31549),N=["current","pageSize"],Y={INVITE_PENDING:{text:"invite.status.pending",defaultMessage:"邀请待处理",color:"blue"},INVITE_ACCEPTED:{text:"invite.status.accepted",defaultMessage:"接受邀请",color:"green"},INVITE_REJECTED:{text:"invite.status.rejected",defaultMessage:"拒绝邀请",color:"red"},INVITE_TIMEOUT:{text:"invite.status.timeout",defaultMessage:"邀请超时",color:"orange"},INVITE_CANCELED:{text:"invite.status.canceled",defaultMessage:"取消邀请",color:"gray"}},R=function(){var e=(0,h.useIntl)(),t=(0,T.useRef)(),a=(0,T.useState)(1),r=f()(a,2),n=r[0],s=r[1],i=(0,T.useState)(10),u=f()(i,2),c=u[0],p=u[1],M=(0,y.u)((function(e){return e.currentOrg})),A=(0,v.Z)().translateString,R=b.Z.useModal(),U=f()(R,2),q=(U[0],U[1]),Z=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"sender",copyable:!0,ellipsis:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"invite.sender.tooltip"}),render:function(e,t,a,r){var n;return A(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"invite.receiver.tooltip"}),render:function(e,t,a,r){var n;return A(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"invite.note.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"invite.status.tooltip"}),render:function(e,t){var a=t.status,r=Y[a]||{text:"invite.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,C.jsx)(F.Z,{color:r.color,children:(0,C.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,render:function(e,t,a,r){return E()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],z=[].concat(Z,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,fixed:"right",render:function(t,a,r,n){return[(0,C.jsx)("a",{onClick:function(){D(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),D=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==M?void 0:M.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},H=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",n,c),t=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/invite/export?"+new URLSearchParams({orgUid:(null==M?void 0:M.uid)||"",pageNumber:String(n-1),pageSize:String(c),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.Z,{columns:z,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,i,u,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,i=t.pageSize,u=d()(t,N),s(n),p(i),c=o()({pageNumber:n-1,pageSize:i,orgUid:null==M?void 0:M.uid},u),e.next=7,x(c);case 7:return g=e.sent,console.log("getAllThreadInvites response:",g,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.invite",defaultMessage:"ThreadInvite"}),toolBarRender:function(){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:H,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),q]})};function U(e){return q.apply(this,arguments)}function q(){return(q=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/transfer/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=["current","pageSize"],z={TRANSFER_PENDING:{text:"transfer.status.pending",defaultMessage:"转接待处理",color:"blue"},TRANSFER_ACCEPTED:{text:"transfer.status.accepted",defaultMessage:"接受转接",color:"green"},TRANSFER_REJECTED:{text:"transfer.status.rejected",defaultMessage:"拒绝转接",color:"red"},TRANSFER_TIMEOUT:{text:"transfer.status.timeout",defaultMessage:"转接超时",color:"orange"},TRANSFER_CANCELED:{text:"transfer.status.canceled",defaultMessage:"取消转接",color:"gray"}},D={AGENT_TO_AGENT:{text:"transfer.type.agent_to_agent",defaultMessage:"人工转人工",color:"purple"},ROBOT_TO_AGENT:{text:"transfer.type.robot_to_agent",defaultMessage:"机器人转人工",color:"cyan"}},H=function(){var e=(0,h.useIntl)(),t=(0,T.useRef)(),a=(0,T.useState)(1),r=f()(a,2),n=r[0],s=r[1],i=(0,T.useState)(10),u=f()(i,2),c=u[0],p=u[1],x=(0,y.u)((function(e){return e.currentOrg})),M=(0,v.Z)().translateString,A=b.Z.useModal(),N=f()(A,2),Y=(N[0],N[1]),R=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"senderNickname",copyable:!0,ellipsis:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.sender.tooltip"}),render:function(e,t,a,r){var n;return M(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.receiver.tooltip"}),render:function(e,t,a,r){var n;return M(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.note.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.status.tooltip"}),render:function(e,t){var a=t.status,r=z[a]||{text:"transfer.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,C.jsx)(F.Z,{color:r.color,children:(0,C.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.type.tooltip"}),render:function(e,t){var a=t.type,r=D[a]||{text:"transfer.type.unknown",defaultMessage:"未知类型",color:"default"};return(0,C.jsx)(F.Z,{color:r.color,children:(0,C.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"transfer.transferAt",defaultMessage:"转接时间"}),dataIndex:"transferAt",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.transferAt.tooltip"}),render:function(e,t){return t.transferAt?E()(t.transferAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"transfer.acceptAt",defaultMessage:"接受时间"}),dataIndex:"acceptAt",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.acceptAt.tooltip"}),render:function(e,t){return t.acceptAt?E()(t.acceptAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"transfer.cancelAt",defaultMessage:"取消时间"}),dataIndex:"cancelAt",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.cancelAt.tooltip"}),render:function(e,t){return t.cancelAt?E()(t.cancelAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"transfer.rejectAt",defaultMessage:"拒绝时间"}),dataIndex:"rejectAt",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.rejectAt.tooltip"}),render:function(e,t){return t.rejectAt?E()(t.rejectAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"transfer.expireAt",defaultMessage:"超时时间"}),dataIndex:"expireAt",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"transfer.expireAt.tooltip"}),render:function(e,t){return t.expireAt?E()(t.expireAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,render:function(e,t,a,r){return E()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],q=[].concat(R,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,fixed:"right",render:function(t,a,r,n){return[(0,C.jsx)("a",{onClick:function(){H(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),H=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==x?void 0:x.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},B=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",n,c),t=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/transfer/export?"+new URLSearchParams({orgUid:(null==x?void 0:x.uid)||"",pageNumber:String(n-1),pageSize:String(c),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.Z,{columns:q,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,i,u,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,i=t.pageSize,u=d()(t,Z),s(n),p(i),c=o()({pageNumber:n-1,pageSize:i,orgUid:null==x?void 0:x.uid},u),e.next=7,U(c);case 7:return g=e.sent,console.log("getAllThreadTransfers response:",g,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.transfer",defaultMessage:"ThreadTransfer"}),toolBarRender:function(){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:B,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),Y]})},B=a(3849);function L(e){return O.apply(this,arguments)}function O(){return(O=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/summary/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=a(32045),_=["current","pageSize"],V=function(){var e=(0,h.useIntl)(),t=(0,T.useRef)(),a=(0,T.useState)(1),r=f()(a,2),n=r[0],s=r[1],i=(0,T.useState)(10),u=f()(i,2),c=u[0],p=u[1],x=(0,y.u)((function(e){return e.currentOrg})),M=(0,v.Z)().translateString,A=b.Z.useModal(),N=f()(A,2),Y=(N[0],N[1]),R=(0,T.useState)([]),U=f()(R,2),q=(U[0],U[1]),Z=(0,T.useState)({}),z=f()(Z,2),D=z[0],H=z[1],O=function(){var t=g()(l()().mark((function t(){var a,r,n,s,o;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={pageNumber:0,pageSize:100,type:j.ics,orgUid:null==x?void 0:x.uid},t.next=4,(0,P.XS)(r);case 4:n=t.sent,console.log("queryCategoriesByOrg response:",n.data,r),200===(null==n?void 0:n.code)&&null!==(a=n.data)&&void 0!==a&&a.content&&(s=n.data.content,q(s),o={},s.forEach((function(e){o[e.uid]=e.name})),H(o)),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Fetch categories error:",t.t0),m.yw.error(e.formatMessage({id:"ticket.category.load.error"}));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();(0,T.useEffect)((function(){null!=x&&x.uid&&O()}),[null==x?void 0:x.uid]);var V=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.title.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.content.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"solution",defaultMessage:"Solution"}),dataIndex:"solution",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.solution.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.category.tooltip"}),render:function(e,t){var a=D[t.categoryUid]||t.categoryUid;return M(a)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.status.tooltip"}),render:function(t,a){var r="",n="";switch(a.status){case j.kA8:r="orange",n=e.formatMessage({id:"summary.status.pending",defaultMessage:"待处理"});break;case j.zvK:r="blue",n=e.formatMessage({id:"summary.status.processing",defaultMessage:"处理中"});break;case j.fuK:r="green",n=e.formatMessage({id:"summary.status.resolved",defaultMessage:"已解决"});break;case j.cin:r="gray",n=e.formatMessage({id:"summary.status.closed",defaultMessage:"已关闭"});break;default:r="default",n=t}return(0,C.jsx)(F.Z,{color:r,children:n})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.tags.tooltip"}),render:function(e,t){return t.tagList&&Array.isArray(t.tagList)&&0!==t.tagList.length?(0,C.jsx)(B.Z,{size:[0,4],wrap:!0,children:t.tagList.map((function(e){return(0,C.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,C.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"summary.updatedAt.tooltip"}),render:function(e,t,a,r){return E()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],G=[].concat(V,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,render:function(t,a,r,n){return[(0,C.jsx)("a",{onClick:function(){J(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),J=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==x?void 0:x.uid,t:j.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},K=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",n,c),t=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/summary/export?"+new URLSearchParams({orgUid:(null==x?void 0:x.uid)||"",pageNumber:String(n-1),pageSize:String(c),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.Z,{columns:G,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,i,u,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,i=t.pageSize,u=d()(t,_),s(n),p(i),c=o()({pageNumber:n-1,pageSize:i,orgUid:null==x?void 0:x.uid},u),e.next=7,L(c);case 7:return g=e.sent,console.log("queryThreadSummariesByOrg response:",g,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.summary",defaultMessage:"ThreadSummary"}),toolBarRender:function(){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:K,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),Y]})};function G(e){return J.apply(this,arguments)}function J(){return(J=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/rating/query/org",{method:"GET",params:o()(o()({},t),{},{client:j.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=["current","pageSize"],Q=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,ellipsis:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.nickname}},{title:(0,C.jsx)(h.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"rating.agent.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.agentProtobuf)||void 0===n?void 0:n.nickname}},{title:(0,C.jsx)(h.FormattedMessage,{id:"score",defaultMessage:"Score"}),dataIndex:"score",tooltip:(0,C.jsx)(h.FormattedMessage,{id:"rating.score.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"comment",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"rating.comment.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,r){return E()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],W=function(){var e=(0,h.useIntl)(),t=(0,T.useRef)(),a=(0,T.useState)(1),r=f()(a,2),n=r[0],s=r[1],i=(0,T.useState)(10),u=f()(i,2),c=u[0],p=u[1],x=(0,y.u)((function(e){return e.currentOrg})),M=[].concat(Q,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,fixed:"right",render:function(t,a,r,n){return[(0,C.jsx)("a",{onClick:function(){v(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),v=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==x?void 0:x.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},b=function(){var e=g()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",n,c),t=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/rating/export?"+new URLSearchParams({orgUid:(null==x?void 0:x.uid)||"",pageNumber:String(n-1),pageSize:String(c),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(S.Z,{columns:M,actionRef:t,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,i,u,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.current,i=t.pageSize,u=d()(t,K),s(n),p(i),c=o()({pageNumber:n-1,pageSize:i,orgUid:null==x?void 0:x.uid},u),e.next=6,G(c);case 6:return g=e.sent,console.log("queryRatesByOrgUid response:",g.data,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"评价记录",toolBarRender:function(){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:b,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})})},X=a(2041),$=a(88721),ee=["current","pageSize"],te=function(e){var t=e.type,a=(0,h.useIntl)(),r=(0,T.useRef)(),n=(0,T.useState)(1),s=f()(n,2),i=s[0],u=s[1],c=(0,T.useState)(10),p=f()(c,2),x=p[0],M=p[1],v=(0,y.u)((function(e){return e.currentOrg})),F=b.Z.useModal(),A=f()(F,2),N=(A[0],A[1]),Y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,C.jsx)(h.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.status){case j.ach:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.new"});case j.j0C:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.roboting"});case j.Q7C:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.offline"});case j.v1N:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.queuing"});case j.hl2:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.chatting"});case j.V1n:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,C.jsx)(h.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,C.jsx)(h.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,render:function(e,t){return(0,$.qF)(t.client)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",hideInSearch:!0,sorter:!0,render:function(e,t){return E()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,C.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,C.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],R=[].concat(Y,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,fixed:"right",render:function(e,t,r,n){return[(0,C.jsx)("a",{onClick:function(){U(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),U=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:j.IUl,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},q=function(){var e=g()(l()().mark((function e(){var a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,x),a=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/export?"+new URLSearchParams({componentType:t,orgUid:(null==v?void 0:v.uid)||"",pageNumber:String(i-1),pageSize:String(x),accessToken:a||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.Z,{columns:R,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,s,i,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,s=t.pageSize,i=d()(t,ee),u(n),M(s),c=o()({pageNumber:n-1,pageSize:s,componentType:"",type:j.H_O,orgUid:null==v?void 0:v.uid,mergeByTopic:!1},i),e.next=7,(0,X.fk)(c);case 7:return g=e.sent,console.log("getAllThreads response:",g,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(e){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:q,children:a.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),N]})},ae=["current","pageSize"],re=function(e){var t=e.type,a=(0,h.useIntl)(),r=(0,T.useRef)(),n=(0,T.useState)(1),s=f()(n,2),i=s[0],u=s[1],c=(0,T.useState)(10),p=f()(c,2),x=p[0],M=p[1],v=(0,y.u)((function(e){return e.currentOrg})),F=b.Z.useModal(),A=f()(F,2),N=(A[0],A[1]),Y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,C.jsx)(h.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,C.jsx)(h.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,C.jsx)(h.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,render:function(e,t){switch(null==t?void 0:t.status){case j.ach:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.new"});case j.j0C:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.roboting"});case j.Q7C:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.offline"});case j.v1N:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.queuing"});case j.hl2:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.chatting"});case j.V1n:return(0,C.jsx)(h.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,C.jsx)(h.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,C.jsx)(h.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,render:function(e,t){return(0,$.qF)(t.client)}},{title:(0,C.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",hideInSearch:!0,sorter:!0,render:function(e,t){return E()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,C.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(h.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(h.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,C.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],R=[].concat(Y,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:50,fixed:"right",render:function(e,t,r,n){return[(0,C.jsx)("a",{onClick:function(){U(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable")]}}]),U=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:j.IUl,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},q=function(){var e=g()(l()().mark((function e(){var a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,x),a=localStorage.getItem(j.LA8),window.open((0,w.kG)()+"/api/v1/thread/export?"+new URLSearchParams({componentType:t,orgUid:(null==v?void 0:v.uid)||"",pageNumber:String(i-1),pageSize:String(x),accessToken:a||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.Z,{columns:R,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,a,r){var n,s,i,c,g;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,a,r),n=t.current,s=t.pageSize,i=d()(t,ae),u(n),M(s),c=o()({pageNumber:n-1,pageSize:s,componentType:"",type:j.n4F,orgUid:null==v?void 0:v.uid,mergeByTopic:!1},i),e.next=7,(0,X.fk)(c);case 7:return g=e.sent,console.log("getAllThreads response:",g,c),200===g.code||m.yw.error(g.message),e.abrupt("return",{data:g.data.content,success:!0,total:g.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(e){return[(0,C.jsx)(k.ZP,{icon:(0,C.jsx)(I.Z,{}),type:"primary",onClick:q,children:a.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),N]})},ne=function(){var e=(0,h.useIntl)(),t=[{key:"thread",label:e.formatMessage({id:"thread.tab.all"}),children:(0,C.jsx)(n.Z,{type:j.Nqz})}];return(0,w.OJ)()&&t.push({key:"rate",label:e.formatMessage({id:"thread.tab.rate"}),children:(0,C.jsx)(W,{})},{key:"transfer",label:e.formatMessage({id:"thread.tab.transfer"}),children:(0,C.jsx)(H,{})},{key:"invite",label:e.formatMessage({id:"thread.tab.invite"}),children:(0,C.jsx)(R,{})},{key:"summary",label:e.formatMessage({id:"thread.tab.summary"}),children:(0,C.jsx)(V,{})}),(0,w.Ox)()||t.push({key:"thread.group",label:e.formatMessage({id:"thread.tab.group"}),children:(0,C.jsx)(te,{type:j.Nqz})},{key:"thread.member",label:e.formatMessage({id:"thread.tab.member"}),children:(0,C.jsx)(re,{type:j.Nqz})}),(0,C.jsx)(r.Z,{defaultActiveKey:"thread",items:t,style:{padding:"10px"}})}}}]);