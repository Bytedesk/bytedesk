"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7927],{15722:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=a.forwardRef(i)},59908:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=n(54183),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var l=a.forwardRef(i)},84881:function(e,t,n){var r=n(17082),a=n(73457),o=n(82308),s=n(44194),i=n(63653),l=n(7010),u=n(31549),c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var n=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,h=e.showSearch,y=e.options,x=(0,a.Z)(e,c),b=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:y,mode:m,showSearch:h,getPopupContainer:b.getPopupContainer},n),ref:t,proFieldProps:f},x),{},{children:d}))},f=s.forwardRef((function(e,t){var n=e.fieldProps,c=e.children,p=e.params,f=e.proFieldProps,m=e.mode,g=e.valueEnum,v=e.request,h=e.options,y=(0,a.Z)(e,d),x=(0,r.Z)({options:h,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),b=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,o.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:b.getPopupContainer},x),ref:t,proFieldProps:f},y),{},{children:c}))})),m=s.forwardRef(p);m.SearchSelect=f,m.displayName="ProFormComponent",t.Z=m},32350:function(e,t,n){var r=n(17082),a=n(73457),o=n(44194),s=n(7010),i=n(31549),l=["fieldProps","proFieldProps"],u=function(e,t){var n=e.fieldProps,o=e.proFieldProps,u=(0,a.Z)(e,l);return(0,i.jsx)(s.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:o},u))};t.Z=o.forwardRef(u)},66916:function(e,t,n){n.d(t,{$l:function(){return h},JT:function(){return w},gf:function(){return S},lg:function(){return f},n1:function(){return x},p0:function(){return d},s9:function(){return g}});var r=n(90819),a=n.n(r),o=n(73193),s=n.n(o),i=n(89933),l=n.n(i),u=n(55735),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/query/org",{method:"GET",params:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/create",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/create/prompt",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/update",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/update/avatar",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/update/prompt",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/delete",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67857:function(e,t,n){n.d(t,{Z:function(){return L}});var r=n(73193),a=n.n(r),o=n(84176),s=n.n(o),i=n(90819),l=n.n(i),u=n(89933),c=n.n(u),d=n(45332),p=n.n(d),f=n(44194),m=n(53530),g=n(75365),v=n(86803),h=n(66916),y=n(30921),x=n(55735),b=n(90838),w=n(40612),M=n(69169),S=n(84881),Z=n(4499),j=n(32350),P=n(73442),C=n(3849),k=n(84288),E=n(6631),O=n(59908),F=n(76750),I=n(31549),T=function(e){var t,n=e.isEdit,r=e.robot,a=e.open,o=e.level,s=e.onClose,i=e.onSubmit,l=M.A.useForm(),u=p()(l,1)[0],c=(0,y.useIntl)(),d=(0,w.u)((function(e){return e.currentOrg})),m=(0,f.useState)("https://cdn.weiyuai.cn/assets/images/llm/provider/zhipu.png"),h=p()(m,2),T=h[0],q=(h[1],(0,f.useState)()),$=p()(q,2),U=$[0],V=$[1],z=(0,b.v)((function(e){return e.categoryResult})),A=(0,F.Z)(),L=A.translateString;A.translateStringTranct;(0,f.useEffect)((function(){if(n&&r&&u){var e,t;u.setFieldsValue({uid:null==r?void 0:r.uid,nickname:null==r?void 0:r.nickname,prompt:null==r||null===(e=r.llm)||void 0===e?void 0:e.prompt,description:null==r?void 0:r.description,categoryUid:null==r?void 0:r.categoryUid});var a=null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(e){return e.uid===(null==r?void 0:r.categoryUid)}));V(a)}else console.log("form resetFields"),u.resetFields()}),[r]);(0,f.useEffect)((function(){}),[r]);return(0,I.jsx)("div",{children:(0,I.jsx)(P.Z,{title:n?"编辑提示语":"新建提示语",width:650,onClose:s,open:a,extra:(0,I.jsxs)(C.Z,{children:[(0,I.jsx)(g.ZP,{onClick:s,children:"取消"}),(0,I.jsx)(g.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:n?null==r?void 0:r.uid:"",nickname:e.nickname,avatar:T,categoryUid:null==U?void 0:U.uid,llm:{prompt:e.prompt},description:e.description,type:x.Qeb,level:o,orgUid:null==d?void 0:d.uid};console.log("robotObject:",t),i(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,I.jsxs)(M.A,{form:u,name:"model",submitter:!1,children:[(0,I.jsx)(S.Z,{label:"类别",name:"categoryUid",required:!0,options:null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t||null===(t=t.filter((function(e){return e.uid!==x.zBg})))||void 0===t?void 0:t.map((function(e){return{label:L(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),V(null==z||null===(t=z.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,I.jsx)(Z.Z,{label:"昵称",name:"nickname",required:!0}),(0,I.jsx)(M.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:c.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,I.jsxs)(E.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e)},onError:function(e){console.log("handleUploadError:",e),v.yw.error(e)},children:[(0,I.jsx)(k.C,{src:T}),(0,I.jsx)(g.ZP,{icon:(0,I.jsx)(O.Z,{}),children:c.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,I.jsx)(j.Z,{label:"提示语Prompt",name:"prompt",required:!0}),(0,I.jsx)(j.Z,{label:"简介描述",name:"description"})]})})})},q=n(15722),$=n(10162),U=n(81947),V=n(28977),z=n.n(V),A=["current","pageSize"],L=function(e){var t=e.level,n=(e.type,(0,f.useRef)()),r=(0,y.useIntl)(),o=(0,f.useState)(!0),i=p()(o,2),u=i[0],d=i[1],M=(0,F.Z)().translateString,S=(0,f.useState)(1),Z=p()(S,2),j=(Z[0],Z[1]),P=(0,f.useState)(10),C=p()(P,2),k=(C[0],C[1]),E=(0,f.useState)(!1),O=p()(E,2),V=O[0],L=O[1],G=(0,f.useState)([]),R=p()(G,2),_=(R[0],R[1]),D=(0,f.useState)({}),B=p()(D,2),N=B[0],Y=B[1],H=(0,b.v)((function(e){return e.currentCategory})),J=(0,w.u)((function(e){return e.currentOrg})),Q=m.Z.useModal(),W=p()(Q,2),X=W[0],K=W[1],ee=function(){var e=c()(l()().mark((function e(t){var a,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h.gf)(t);case 3:200===(a=e.sent).code?(v.yw.destroy(),v.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=n.current)||void 0===o||o.reload()):(v.yw.destroy(),v.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=c()(l()().mark((function e(t){var a,o,s,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=8;break}return v.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.JT)(t);case 4:200===(a=e.sent).code?(v.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=n.current)||void 0===o||o.reload(),L(!1)):v.yw.error(a.message),e.next=13;break;case 8:return v.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.s9)(t);case 11:200===(s=e.sent).code?(v.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=n.current)||void 0===i||i.reload(),L(!1)):v.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reload()}),[H]);var ne=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:r.formatMessage({id:"pages.prompt.nickname",defaultMessage:"名称"}),dataIndex:"nickname",hideInSearch:!1,render:function(e,t){return M(t.nickname)}},{title:r.formatMessage({id:"pages.prompt.description",defaultMessage:"描述"}),dataIndex:"description",hideInSearch:!0,render:function(e,t){return M(t.description)}},{title:r.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:["llm","prompt"],ellipsis:!0,hideInSearch:!0},{title:r.formatMessage({id:"pages.prompt.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",hideInSearch:!0,render:function(e,t){return t.updatedAt?z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",render:function(e,t){var n;return[(0,I.jsx)("a",{onClick:function(){return function(e){d(!0),Y(e),L(!0)}(t)},children:r.formatMessage({id:"pages.robot.edit",defaultMessage:"Edit"})},"edit"),!(null!=t&&null!==(n=t.uid)&&void 0!==n&&n.includes("void_agent"))&&(0,I.jsx)("a",{onClick:function(){return e=t,void X.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,I.jsx)(q.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(e.nickname),"】？"),onOk:function(){ee(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")]}}];return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(U.Z,{columns:ne,actionRef:n,cardBordered:!0,rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.prompt.list",defaultMessage:"提示语列表"}),toolBarRender:function(){return[(0,I.jsx)(g.ZP,{type:"primary",onClick:function(){d(!1),Y({}),L(!0)},icon:(0,I.jsx)($.Z,{}),children:r.formatMessage({id:"pages.prompt.create",defaultMessage:"添加提示语"})},"create")]},request:function(){var e=c()(l()().mark((function e(n,o,i){var u,c,d,p,f;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),u=n.current,c=n.pageSize,d=s()(n,A),j(u),k(c),p=a()({pageNumber:u-1,pageSize:c,nickname:"",orgUid:t===x.Hxq?"":null==J?void 0:J.uid,categoryUid:(null==H?void 0:H.uid)===x.zBg?"":null==H?void 0:H.uid,type:x.Qeb,level:t},d),e.next=7,(0,h.p0)(p);case 7:if(f=e.sent,console.log("queryRobotsByOrg response:",f,p),200!==f.code){e.next=15;break}return v.yw.destroy(),_(f.data.content),e.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 15:return v.yw.destroy(),v.yw.error(f.message),e.abrupt("return",{data:[],success:!1,total:0});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}),V&&(0,I.jsx)(T,{isEdit:u,robot:N,level:t,open:V,onClose:function(){return L(!1)},onSubmit:te}),K]})}},6631:function(e,t,n){n.d(t,{G:function(){return p}});var r=n(73193),a=n.n(r),o=(n(44194),n(30348)),s=n(55735),i=n(28977),l=n.n(i),u=n(86803),c=n(44521),d=n(31549),p=function(e){var t=e.children,n=e.onSuccess,r=e.onError,i={file:null,file_name:"test.png",file_type:"image/png",is_avatar:"true",kb_type:s.IrL,category_uid:"",kb_uid:"",client:s.bVn},p={name:"file",accept:"image/*",action:(0,c.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;i.file=e,i.file_name=t,i.file_type=e.type,console.log("beforeUpload",i)},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;n(t),u.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,d.jsx)(o.Z,a()(a()({},p),{},{children:t}))}},27487:function(e,t,n){n.d(t,{Z:function(){return S}});var r=n(44194),a=n(51865),o=n.n(a),s=n(97859),i=n(90899),l=n(37167),u=n(65759),c=n(77167);const d=["wrap","nowrap","wrap-reverse"],p=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],f=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var m=function(e,t){return o()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const n=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${n}`]:n&&d.includes(n)}})(e,t)),((e,t)=>{const n={};return f.forEach((r=>{n[`${e}-align-${r}`]=t.align===r})),n[`${e}-align-stretch`]=!t.align&&!!t.vertical,n})(e,t)),((e,t)=>{const n={};return p.forEach((r=>{n[`${e}-justify-${r}`]=t.justify===r})),n})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},v=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},h=e=>{const{componentCls:t}=e,n={};return d.forEach((e=>{n[`${t}-wrap-${e}`]={flexWrap:e}})),n},y=e=>{const{componentCls:t}=e,n={};return f.forEach((e=>{n[`${t}-align-${e}`]={alignItems:e}})),n},x=e=>{const{componentCls:t}=e,n={};return p.forEach((e=>{n[`${t}-justify-${e}`]={justifyContent:e}})),n};var b=(0,u.I$)("Flex",(e=>{const{paddingXS:t,padding:n,paddingLG:r}=e,a=(0,c.IX)(e,{flexGapSM:t,flexGap:n,flexGapLG:r});return[g(a),v(a),h(a),y(a),x(a)]}),(()=>({})),{resetStyle:!1}),w=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const M=r.forwardRef(((e,t)=>{const{prefixCls:n,rootClassName:a,className:u,style:c,flex:d,gap:p,children:f,vertical:g=!1,component:v="div"}=e,h=w(e,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:y,direction:x,getPrefixCls:M}=r.useContext(l.E_),S=M("flex",n),[Z,j,P]=b(S),C=null!=g?g:null==y?void 0:y.vertical,k=o()(u,a,null==y?void 0:y.className,S,j,P,m(S,e),{[`${S}-rtl`]:"rtl"===x,[`${S}-gap-${p}`]:(0,i.n)(p),[`${S}-vertical`]:C}),E=Object.assign(Object.assign({},null==y?void 0:y.style),c);return d&&(E.flex=d),p&&!(0,i.n)(p)&&(E.gap=p),Z(r.createElement(v,Object.assign({ref:t,className:k,style:E},(0,s.Z)(h,["justify","wrap","align"])),f))}));var S=M}}]);