"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{38889:function(e,t,n){n.r(t),n.d(t,{default:function(){return mn}});var r=n(96865),a=n(75574),s=n(45332),i=n.n(s),o=n(23864),l=n(73193),c=n.n(l),u=n(76711),d=n.n(u),p=n(55735),f=n(44435),h=n(83642),m=n(83890),x=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,t){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(t){e((function(e){e.llmproviderResult.data.content.unshift(t)}))},setChannelResult:function(n){e({llmproviderResult:n});var r,a=t().currentChannel;""!==a.uid&&void 0!==a||(null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:n.data.content[0]})},setCurrentChannel:function(n){var r=t().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[n],d()(r.slice(a+1))),i=c()(c()({},t().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:i,currentChannel:n})}else e({currentChannel:n})},setCurrentType:function(t){e({currentType:t})},deleteCurrentChannel:function(n){var r=t().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({llmproviderResult:c()(c()({},t().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",n),t().currentChannel.uid===n&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),g=n(9452),y=n(44194),v=n(36310),j=n(31549),b=[{name:"web",nickname:"网站/H5"},{name:"npm",nickname:"Npm包"}],w=function(){var e=(0,o.Z)().isDarkMode,t=(0,y.useState)([]),n=i()(t,2),r=n[0],a=n[1],s=x((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),l=s.currentChannel,c=s.setCurrentChannel;return(0,y.useEffect)((function(){var e=[].concat(b);!(0,v.Ox)()&&(0,v.OJ)()&&e.push({name:"app",nickname:"App应用"},{name:"wechat-app",nickname:"微信应用"}),a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(g.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(t,n){return(0,j.jsx)(g.Z.Item,{style:(null==l?void 0:l.name)===t.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){c(t)},children:(0,j.jsx)(g.Z.Item.Meta,{title:(0,j.jsx)("div",{style:{marginLeft:10},children:t.nickname})})})}})})},A=n(8247),k=n(41159),Z=function(){var e=(0,k.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(k.Access,{accessible:e.canDebug(),fallback:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(k.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},M=n(90819),C=n.n(M),S=n(89933),I=n.n(S),E=n(10154),P=n.n(E),R=n(86803);function T(e){return W.apply(this,arguments)}function W(){return(W=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return q.apply(this,arguments)}function q(){return(q=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return V.apply(this,arguments)}function V(){return(V=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return z.apply(this,arguments)}function z(){return(z=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return L.apply(this,arguments)}function L(){return(L=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return O.apply(this,arguments)}function O(){return(O=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=n(40612),G=n(15722),_=n(82669),Y=n(53530),H=n(27487),J=n(75365),X=n(76750),Q=n(72614),$=n(95490),ee=n(69169),te=n(4499),ne=n(84881),re=n(73442),ae=n(3849),se="MP",ie="MINI",oe="WORK",le="KEFU",ce=function(e){var t,n=e.isEdit,r=e.wechatApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ee.A.useForm(),p=i()(d,1)[0],f=(0,X.Z)().translateStringTranct,h=(0,N.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),x=i()(m,2),g=x[0],v=x[1],b=(0,$.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),w=b.workgroupResult,A=b.setWorkgroupResult,k=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var t=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",t),u(t)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(n)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||oe,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,t=(null==w||null===(e=w.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?w.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:oe,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:t})}}),[n,r,p,w]);var Z=function(){var e=I()(C()().mark((function e(){var t,n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,Q.LE)(t);case 4:n=e.sent,console.log("getWorkgroups",n),200===n.code?(R.yw.destroy(),A(n)):(R.yw.destroy(),R.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){Z()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(re.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(J.ZP,{type:"primary",onClick:k,loading:g||o,children:g||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(ee.A,{form:p,name:"wechatWorkForm",onFinish:k,submitter:!1,children:[(0,j.jsx)(te.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(ne.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:se},{label:"微信小程序",value:ie},{label:"企业微信",value:oe},{label:"微信客服",value:le}],fieldProps:{defaultValue:oe},rules:[{required:!0}]}),(0,j.jsx)(ee.A.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.type!==t.type},children:function(e){var t=e.getFieldValue;return(0,j.jsx)(te.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:t("type")===oe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(ee.A.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.type!==t.type},children:function(e){var t=e.getFieldValue;return(0,j.jsx)(te.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:t("type")===oe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(te.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<32;n++){var r=Math.floor(Math.random()*e.length);t+=e.charAt(r)}p.setFieldsValue({token:t})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<43;n++){var r=Math.floor(Math.random()*e.length);t+=e.charAt(r)}p.setFieldsValue({encodingAesKey:t})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(ne.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(ne.Z,{label:"客服技能组",name:"workgroupUid",options:null==w||null===(t=w.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},ue=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,t){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(t){e((function(e){e.wechatAppResult.data.content.unshift(t)}))},updateWechatApp:function(t){e((function(e){var n=e.wechatAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("WechatApp with uid ".concat(t.uid," not found."))}))},deleteWechatApp:function(t){e((function(e){var n=e.wechatAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("WechatApp with uid ".concat(t.uid," not found."))}))},setWechatAppResult:function(n){var r;(e({wechatAppResult:n}),""===t().currentWechatApp.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:n.data.content[0]}))},setCurrentWechatApp:function(n){var r=t().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[n],d()(r.slice(a+1))),i=c()(c()({},t().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:i,currentWechatApp:n})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:n})},refreshCurrentWechatApp:function(t){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),t);var n=e.wechatAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r&&(n[r]=c()(c()({},n[r]),t))}))},deleteCurrentWechatApp:function(n){var r=t().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({wechatAppResult:c()(c()({},t().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",n),t().currentWechatApp.uid===n&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),de=P()(P()(P()(P()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),pe=function(){var e=(0,k.useIntl)(),t=(0,y.useRef)(!1),n=(0,X.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,y.useState)(!1),s=i()(a,2),l=s[0],c=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),x=m[0],v=m[1],b=(0,N.u)((function(e){return e.currentOrg})),w=ue((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),A=w.wechatAppResult,Z=w.currentWechatApp,M=w.setWechatAppResult,S=w.insertWechatApp,E=w.setCurrentWechatApp,P=w.deleteCurrentWechatApp,W=Y.Z.useModal(),F=i()(W,2),q=F[0],V=F[1],z=function(){var t=I()(C()().mark((function t(n){var r;return C()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete wechatApp",n),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),t.next=4,U(n);case 4:r=t.sent,console.log("delete wechatApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),P(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=function(){var e=I()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=8,T(n);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(R.yw.destroy(),M(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){L();var e=function(e){f(!0),c(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var B=function(){var e=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",t),v(!0),e.prev=2,!p){e.next=8;break}return e.next=6,Q(t);case 6:e.next=10;break;case 8:return e.next=10,O(t);case 10:return e.prev=10,v(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=I()(C()().mark((function e(t){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,D(t);case 3:n=e.sent,R.yw.destroy(),console.log("handleCreateWechatApp response:",n),200===n.code?(S(n.data),E(n.data),c(!1),R.yw.success("创建成功")):R.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=I()(C()().mark((function e(t){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==Z?void 0:Z.uid,R.yw.loading("正在更新..."),e.next=4,K(t);case 4:n=e.sent,R.yw.destroy(),console.log("handleUpdateWechatApp response:",n),200===n.code?(E(n.data),c(!1),R.yw.success("更新成功")):R.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(H.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(J.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(_.Z,{}),onClick:function(){c(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){f(!0),c(!0)},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,j.jsx)(J.ZP,{size:"small",danger:!0,onClick:function(){return t=Z,void q.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(G.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){z(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,j.jsx)(g.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,t){return(0,j.jsx)(g.Z.Item,{style:Z.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){E(e)},children:(0,j.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[n(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",de[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:n(null==e?void 0:e.description)})})}}),l&&(0,j.jsx)(ce,{isEdit:p,open:l,loading:x,wechatApp:Z,onClose:function(){c(!1)},onSubmit:B}),V]})},fe=n(32327),he=n(62673),me=n(73589),xe=n(29266),ge=n(19116),ye=n(88996),ve=n(38775),je=n(83337),be=n(34600),we=n(15892),Ae=n(54800),ke=n(59304),Ze=n(80556),Me=n(5716),Ce=n(90297),Se=n(34545),Ie=n(28977),Ee=n.n(Ie),Pe=fe.Z.Text,Re=fe.Z.Paragraph,Te=P()(P()(P()(P()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),We=P()(P()(P()(P()({},p.a4q,(0,j.jsx)(je.Z,{})),p.qRy,(0,j.jsx)(be.Z,{})),p._oo,(0,j.jsx)(we.Z,{})),p.rWo,(0,j.jsx)(Ae.Z,{})),Fe={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},qe={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},De=function(){var e,t=(0,k.useIntl)(),n=ue((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=n.currentWechatApp,a=n.refreshCurrentWechatApp,s=(0,y.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),x=m[0],g=m[1],b=(0,y.useState)(!1),w=i()(b,2),A=w[0],Z=w[1],M=(0,y.useState)(!1),S=i()(M,2),E=(S[0],S[1],(0,y.useState)(!1)),P=i()(E,2),T=P[0],W=P[1],q=(0,y.useState)(!1),D=i()(q,2),V=D[0],K=D[1],z=function(e,t){return e?t?e:"******":"-"},U=function(){var e=I()(C()().mark((function e(){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,B({uid:r.uid});case 7:t=e.sent,console.log("refreshAccessTokenWechatApp response",t),200===t.code?(R.yw.success("AccessToken 刷新成功"),a&&a(t.data),L()):R.yw.error("刷新失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=I()(C()().mark((function e(){var t,n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return K(!0),e.prev=4,e.next=7,F({uid:r.uid});case 7:t=e.sent,console.log("queryWechatAppByUid refresh detail",t),200===t.code?(n=t.data,R.yw.success("应用详情刷新成功"),a&&a(n)):R.yw.error("刷新失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,K(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(he.Z,{title:(0,j.jsxs)(ae.Z,{children:[We[r.type]||(0,j.jsx)(je.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(xe.Z,{color:"blue",children:Te[r.type]||r.type})]}),extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(ke.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(Ze.Z,{}),onClick:L,loading:V,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ge.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Pe,{copyable:!0,children:r.uid})}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(xe.Z,{color:"blue",children:Te[r.type]||r.type})}),(0,j.jsx)(ge.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(Pe,{copyable:!0,children:r.appId})}),(0,j.jsx)(ge.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!p&&{text:r.appSecret||""},children:z(r.appSecret,p)}),(0,j.jsx)(ye.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(J.ZP,{type:"text",icon:p?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"加密模式",children:(0,j.jsx)(xe.Z,{color:qe[r.encryptMode]||"default",children:Fe[r.encryptMode]||r.encryptMode})}),(0,j.jsx)(ge.Z.Item,{label:"URL",children:(0,j.jsx)(Pe,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+r.uid})}),(0,j.jsx)(ge.Z.Item,{label:"Token",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!x&&{text:r.token||""},children:z(r.token,x)}),(0,j.jsx)(ye.Z,{title:x?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:x?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return g(!x)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!A&&{text:r.encodingAesKey||""},children:z(r.encodingAesKey,A)}),(0,j.jsx)(ye.Z,{title:A?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(J.ZP,{type:"text",icon:A?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return Z(!A)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Pe,{copyable:!!l&&{text:r.accessToken||""},children:z(r.accessToken,l)}),(0,j.jsx)(ye.Z,{title:l?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:l?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,j.jsx)(ye.Z,{title:"刷新AccessToken",children:(0,j.jsx)(J.ZP,{type:"primary",icon:(0,j.jsx)(Se.Z,{}),onClick:U,size:"small",loading:T,children:"刷新Token"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Ee()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(Re,{children:r.description})}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ee()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(fe.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(Re,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先在左侧列表选择一个微信应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})})},Ve=function(e){console.log(e)},Ke=[{key:"detail",label:"应用详情",children:(0,j.jsx)(De,{})}],ze=function(){var e=(0,y.useState)(Ke),t=i()(e,2),n=t[0],r=t[1];return(0,y.useEffect)((function(){var e=[].concat(Ke);r(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(A.Z,{defaultActiveKey:"agent",items:n,onChange:Ve})})},Ue=a.Z.Sider,Le=a.Z.Content,Be=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Ue,{width:n,style:t,children:(0,j.jsx)(pe,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Le,{children:(0,j.jsx)(ze,{})})})]})},Oe=n(24170),Ne=n(91723),Ge=n(67402),_e=n(71529),Ye=function(e){var t=e.platform,n=void 0===t?"react":t,r=(0,k.useIntl)(),a=(0,y.useState)(n),s=i()(a,2),o=s[0],l=s[1],c=o.charAt(0).toUpperCase()+o.slice(1),u="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(c);return(0,j.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,j.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsx)("h2",{children:(0,j.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:r.formatMessage({id:"install.guide.github"})})}),(0,j.jsx)(J.ZP,{type:"primary",icon:(0,j.jsx)(_e.Z,{}),href:"".concat("https://www.weiyuai.cn/docs/zh-CN/docs/channel/").concat("vanilla"===o?"web":o),target:"_blank",children:r.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,j.jsx)(ve.Z,{orientation:"left",children:"选择框架"}),(0,j.jsx)(Ge.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){l(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,j.jsx)("h2",{children:r.formatMessage({id:"install.guide.steps"})}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step1.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(r.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step2.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step3.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(r.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(r.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step4.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(u," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(r.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step5.title"})}),(0,j.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",r.formatMessage({id:"install.guide.step5.show"})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",r.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},He=n(1902),Je=fe.Z.Title,Xe=fe.Z.Text,Qe=function(e){var t=e.channel,n=((0,y.useRef)(!1),(0,X.Z)().translateString),r=x((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),a=r.currentType,s=r.setCurrentType,o=(0,N.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,He.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,f=c.setAgentResult,h=c.setCurrentAgent,m=(0,y.useState)([]),g=i()(m,2),v=g[0],b=g[1],w=(0,$.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),A=w.workgroupResult,k=w.currentWorkgroup,Z=w.setWorkgroupResult,M=w.setCurrentWorkgroup,S=(0,y.useState)(null==d?void 0:d.uid),E=i()(S,2),P=E[0],T=E[1],W=(0,y.useState)(null==k?void 0:k.uid),F=i()(W,2),q=F[0],D=F[1],V=(0,y.useState)([]),K=i()(V,2),z=K[0],U=K[1],L=function(){var e=I()(C()().mark((function e(){var t,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,Oe._t)(t);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(R.yw.destroy(),f(r),r.data.content.length>0&&(h(r.data.content[0]),T(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var t={label:n(e.nickname),value:e.uid};a.push(t)})),b(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=I()(C()().mark((function e(){var t,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,Q.LE)(t);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(R.yw.destroy(),Z(r),r.data.content.length>0&&(M(r.data.content[0]),D(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var t={label:n(e.nickname),value:e.uid};a.push(t)})),U(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){L(),B()}),[a]);var O=["web","npm","ios","android","flutter","uniapp"].includes((null==t?void 0:t.name)||"");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Ge.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),s(e.target.value)},options:l,defaultValue:a,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)("br",{}),(0,j.jsx)("br",{}),a===p.Njn&&(null==d?void 0:d.uid)&&(0,j.jsx)(Ge.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var t=u.data.content.find((function(t){return t.uid===e.target.value}));h(t)},options:v,defaultValue:P,optionType:"button",buttonStyle:"solid"}),a===p.aZD&&(null==d?void 0:d.uid)&&(0,j.jsx)(Ge.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var t=A.data.content.find((function(t){return t.uid===e.target.value}));M(t)},options:z,defaultValue:q,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(Je,{level:5,children:"组织orgUid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,j.jsx)(Je,{level:5,children:"一对一当前客服Uid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,j.jsx)(Je,{level:5,children:"当前技能组Uid"}),(0,j.jsx)(Xe,{code:!0,copyable:!0,children:null==k?void 0:k.uid}),(0,j.jsx)(ve.Z,{}),O&&("web"===(null==t?void 0:t.name)?(0,j.jsx)(Ne.Z,{type:p.aZD}):"npm"===(null==t?void 0:t.name)?(0,j.jsx)(Ye,{}):null)]})};function $e(e){return et.apply(this,arguments)}function et(){return(et=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){return nt.apply(this,arguments)}function nt(){return(nt=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e){return at.apply(this,arguments)}function at(){return(at=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return(it=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ot=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,t){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(t){e((function(e){e.appResult.data.content.unshift(t)}))},updateApp:function(t){e((function(e){var n=e.appResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("App with uid ".concat(t.uid," not found."))}))},deleteApp:function(t){e((function(e){var n=e.appResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("App with uid ".concat(t.uid," not found."))}))},setAppResult:function(n){var r;(e({appResult:n}),""===t().currentApp.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:n.data.content[0]}))},setCurrentApp:function(n){var r=t().appResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[n],d()(r.slice(a+1))),i=c()(c()({},t().appResult),{},{data:{content:s}});e({appResult:i,currentApp:n})}else e({currentApp:n})},deleteCurrentApp:function(n){var r=t().appResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({appResult:c()(c()({},t().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",n),t().currentApp.uid===n&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),lt=n(32350),ct=function(e){var t=e.open,n=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,o=(0,k.useIntl)(),l=ee.A.useForm(),u=i()(l,1)[0],d=(0,N.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,y.useEffect)((function(){t&&n&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[t,n,r,u]),(0,j.jsx)(re.Z,{title:n?o.formatMessage({id:"edit",defaultMessage:"编辑应用"}):o.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:t,onClose:a,maskClosable:!0,extra:(0,j.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,j.jsx)(J.ZP,{onClick:a,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,j.jsx)(J.ZP,{onClick:function(){u.validateFields().then((function(e){var t=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:n?r.uid:void 0});s(t)}))},type:"primary",children:o.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,j.jsxs)(ee.A,{form:u,layout:"vertical",submitter:!1,children:[(0,j.jsx)(te.Z,{name:"name",label:o.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:o.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:o.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,j.jsx)(ne.Z,{name:"appPlatform",label:o.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:o.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:o.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,j.jsx)(te.Z,{name:"appPackage",label:o.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:o.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:o.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,j.jsx)(te.Z,{name:"appKey",label:"App Key",placeholder:o.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,j.jsx)(J.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<16;n++)t+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:t})},children:"随机生成"})}}),(0,j.jsx)(te.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:o.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,j.jsx)(lt.Z,{name:"description",label:o.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:o.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},ut=function(){var e=(0,k.useIntl)(),t=(0,y.useRef)(!1),n=(0,X.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,y.useState)(!1),s=i()(a,2),l=s[0],c=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,N.u)((function(e){return e.currentOrg})),m=ot((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),x=m.appResult,v=m.currentApp,b=m.setAppResult,w=m.insertApp,A=m.setCurrentApp,Z=m.deleteCurrentApp,M=Y.Z.useModal(),S=i()(M,2),E=S[0],P=S[1],T=function(){var t=I()(C()().mark((function t(n){var r;return C()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete app",n),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除"})),t.next=4,st(n);case 4:r=t.sent,console.log("delete app response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),Z(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),W=function(){var e=I()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=8,$e(n);case 8:r=e.sent,console.log("getApps",r),200===r.code?(R.yw.destroy(),b(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){W()}),[]);var F=function(){var t=I()(C()().mark((function t(n){var r;return C()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tt(n);case 2:r=t.sent,console.log("handleCreateApp response:",r),200===r.code?(w(r.data),c(!1),R.yw.success(e.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):R.yw.error(r.message);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),q=function(){var t=I()(C()().mark((function t(n){var r;return C()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.uid=null==v?void 0:v.uid,t.next=3,rt(n);case 3:r=t.sent,console.log("handleUpdateApp response:",r),200===r.code?(A(r.data),c(!1),R.yw.success(e.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):R.yw.error(r.message);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(H.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(J.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(_.Z,{}),onClick:function(){c(!0),f(!1)},children:e.formatMessage({id:"create",defaultMessage:"新建"})}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){f(!0),c(!0)},disabled:""===(null==v?void 0:v.uid),children:e.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,j.jsx)(J.ZP,{size:"small",danger:!0,onClick:function(){return function(t){E.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(G.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(t.name,"】？"),onOk:function(){T(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(v)},disabled:""===(null==v?void 0:v.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,j.jsx)(g.Z,{itemLayout:"horizontal",dataSource:x.data.content,renderItem:function(e,t){return(0,j.jsx)(g.Z.Item,{style:v.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){A(e)},children:(0,j.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[n(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",n(null==e?void 0:e.appPlatform),")"]})]}),description:n(null==e?void 0:e.description)})})}}),l&&(0,j.jsx)(ct,{isEdit:p,open:l,app:v,onClose:function(){c(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?q(e):F(e)}}),P]})},dt=n(2523),pt=n(48006),ft=n(40795),ht=fe.Z.Text,mt=fe.Z.Paragraph,xt={android:(0,j.jsx)(dt.Z,{}),ios:(0,j.jsx)(pt.Z,{}),flutter:(0,j.jsx)(ft.Z,{}),uniapp:(0,j.jsx)(be.Z,{})},gt={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},yt=function(){var e=(0,k.useIntl)(),t=ot().currentApp;return null!=t&&t.uid?(0,j.jsxs)(he.Z,{title:(0,j.jsxs)(ae.Z,{children:[xt[t.appPlatform]||(0,j.jsx)(ft.Z,{}),(0,j.jsx)("span",{children:t.name||"应用详情"}),(0,j.jsx)(xe.Z,{color:"blue",children:gt[t.appPlatform]||t.appPlatform})]}),bordered:!1,children:[(0,j.jsxs)(ge.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ge.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(ht,{copyable:!0,children:t.uid})}),(0,j.jsx)(ge.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),t.appKey&&(0,j.jsx)(ge.Z.Item,{label:"App Key",children:(0,j.jsx)(ht,{copyable:!0,children:t.appKey})}),"android"===t.appPlatform&&t.appPackage&&(0,j.jsx)(ge.Z.Item,{label:"Package Name",children:t.appPackage}),t.description&&(0,j.jsx)(ge.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(mt,{children:t.description})}),(0,j.jsx)(ge.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt})]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(fe.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(mt,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先选择或创建一个应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})})},vt=n(69079),jt=n(72608),bt=fe.Z.Title,wt=fe.Z.Paragraph,At=fe.Z.Text,kt=(fe.Z.Link,A.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),Zt=function(){(0,k.useIntl)();var e=ot().currentApp,t=(0,N.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先选择或创建一个应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})});return(0,j.jsxs)(he.Z,{title:"集成指南",bordered:!1,extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(vt.Z,{}),onClick:function(){var t=e.appPlatform,n=kt[t];n?window.open(n,"_blank"):jt.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(_e.Z,{}),onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,j.jsxs)(bt,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,j.jsxs)(wt,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(bt,{level:5,children:"1. 基本配置"}),(0,j.jsx)(wt,{children:(0,j.jsxs)("ul",{children:[e.appKey&&(0,j.jsxs)("li",{children:[(0,j.jsx)(At,{strong:!0,children:"App Key:"})," ",(0,j.jsx)(At,{copyable:!0,children:e.appKey})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)(At,{strong:!0,children:"组织ID:"})," ",(0,j.jsx)(At,{copyable:!0,children:null==t?void 0:t.uid})]})]})}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(wt,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},Mt=function(e){console.log(e)},Ct=[{key:"details",label:"应用详情",children:(0,j.jsx)(yt,{})},{key:"integration",label:"集成指南",children:(0,j.jsx)(Zt,{})}],St=function(){var e=(0,y.useState)([]),t=i()(e,2),n=t[0],r=t[1];ot((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,y.useEffect)((function(){var e=[].concat(Ct);r(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(A.Z,{defaultActiveKey:"details",items:n,onChange:Mt})})},It=a.Z.Sider,Et=a.Z.Content,Pt=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(It,{width:n,style:t,children:(0,j.jsx)(ut,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Et,{children:(0,j.jsx)(St,{})})})]})};function Rt(e){return Tt.apply(this,arguments)}function Tt(){return(Tt=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(e){return Dt.apply(this,arguments)}function Dt(){return(Dt=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(e){return Kt.apply(this,arguments)}function Kt(){return(Kt=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(e){return Ut.apply(this,arguments)}function Ut(){return(Ut=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(e){return Bt.apply(this,arguments)}function Bt(){return(Bt=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},t),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ot="MESSENGER",Nt="INSTAGRAM",Gt="WHATSAPP",_t=function(e){var t,n=e.isEdit,r=e.metaApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ee.A.useForm(),p=i()(d,1)[0],f=(0,X.Z)().translateStringTranct,h=(0,N.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),x=i()(m,2),g=x[0],v=x[1],b=(0,$.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),w=b.workgroupResult,A=b.setWorkgroupResult,k=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var t=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",t),u(t)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(n)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Ot,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,t=(null==w||null===(e=w.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?w.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Ot,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:t})}}),[n,r,p,w]);var Z=function(){var e=I()(C()().mark((function e(){var t,n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,Q.LE)(t);case 4:n=e.sent,console.log("getWorkgroups",n),200===n.code?(R.yw.destroy(),A(n)):(R.yw.destroy(),R.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){Z()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(re.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(J.ZP,{type:"primary",onClick:k,loading:g||o,children:g||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(ee.A,{form:p,name:"wechatWorkForm",onFinish:k,submitter:!1,children:[(0,j.jsx)(te.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(ne.Z,{label:"应用类型",name:"type",options:[{label:"Messenger",value:Ot},{label:"Instagram",value:Nt},{label:"Whatsapp",value:Gt}],fieldProps:{defaultValue:Ot},rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<32;n++){var r=Math.floor(Math.random()*e.length);t+=e.charAt(r)}p.setFieldsValue({token:t})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(te.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<43;n++){var r=Math.floor(Math.random()*e.length);t+=e.charAt(r)}p.setFieldsValue({encodingAesKey:t})},children:"随机生成"}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(ne.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT"},{label:"兼容模式",value:"COMPATIBLE"}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(ne.Z,{label:"客服技能组",name:"workgroupUid",options:null==w||null===(t=w.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Yt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,t){return{metaAppResult:{data:{content:[]}},currentMetaApp:{uid:"",nickname:"",avatar:"",description:""},insertMetaApp:function(t){e((function(e){e.metaAppResult.data.content.unshift(t)}))},updateMetaApp:function(t){e((function(e){var n=e.metaAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("MetaApp with uid ".concat(t.uid," not found."))}))},deleteMetaApp:function(t){e((function(e){var n=e.metaAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("MetaApp with uid ".concat(t.uid," not found."))}))},setMetaAppResult:function(n){var r;(e({metaAppResult:n}),""===t().currentMetaApp.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMetaApp:n.data.content[0]}))},setCurrentMetaApp:function(n){var r=t().metaAppResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[n],d()(r.slice(a+1))),i=c()(c()({},t().metaAppResult),{},{data:{content:s}});e({metaAppResult:i,currentMetaApp:n})}else console.warn("MetaApp with the specified uid not found."),e({currentMetaApp:n})},refreshCurrentMetaApp:function(t){e((function(e){e.currentMetaApp=c()(c()({},e.currentMetaApp),t);var n=e.metaAppResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r&&(n[r]=c()(c()({},n[r]),t))}))},deleteCurrentMetaApp:function(n){var r=t().metaAppResult.data.content,a=r.findIndex((function(e){return e.uid===n}));-1!==a?e({metaAppResult:c()(c()({},t().metaAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("MetaApp not found in cache:",n),t().currentMetaApp.uid===n&&e({currentMetaApp:{uid:""}})},deleteMetaAppCache:function(){return e({},!0)}}})),{name:p.b3t}))),Ht=P()(P()(P()({},p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Jt=function(){var e=(0,k.useIntl)(),t=(0,y.useRef)(!1),n=(0,X.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,y.useState)(!1),s=i()(a,2),l=s[0],c=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),x=m[0],v=m[1],b=(0,N.u)((function(e){return e.currentOrg})),w=Yt((function(e){return{metaAppResult:e.metaAppResult,currentMetaApp:e.currentMetaApp,setMetaAppResult:e.setMetaAppResult,insertMetaApp:e.insertMetaApp,setCurrentMetaApp:e.setCurrentMetaApp,deleteCurrentMetaApp:e.deleteCurrentMetaApp}})),A=w.metaAppResult,Z=w.currentMetaApp,M=w.setMetaAppResult,S=w.insertMetaApp,E=w.setCurrentMetaApp,P=w.deleteCurrentMetaApp,T=Y.Z.useModal(),W=i()(T,2),F=W[0],q=W[1],D=function(){var t=I()(C()().mark((function t(n){var r;return C()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete metaApp",n),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),t.next=4,zt(n);case 4:r=t.sent,console.log("delete metaApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),P(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),V=function(){var e=I()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=8,Rt(n);case 8:r=e.sent,console.log("getMetaApps",r),200===r.code?(R.yw.destroy(),M(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){f(!0),c(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var K=function(){var e=I()(C()().mark((function e(t){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",t),v(!0),e.prev=2,!p){e.next=8;break}return e.next=6,U(t);case 6:e.next=10;break;case 8:return e.next=10,z(t);case 10:return e.prev=10,v(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=I()(C()().mark((function e(t){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,qt(t);case 3:n=e.sent,R.yw.destroy(),console.log("handleCreateMetaApp response:",n),200===n.code?(S(n.data),E(n.data),c(!1),R.yw.success("创建成功")):R.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=I()(C()().mark((function e(t){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==Z?void 0:Z.uid,R.yw.loading("正在更新..."),e.next=4,Vt(t);case 4:n=e.sent,R.yw.destroy(),console.log("handleUpdateMetaApp response:",n),200===n.code?(E(n.data),c(!1),R.yw.success("更新成功")):R.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(H.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(J.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(_.Z,{}),onClick:function(){c(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(J.ZP,{size:"small",onClick:function(){f(!0),c(!0)},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,j.jsx)(J.ZP,{size:"small",danger:!0,onClick:function(){return t=Z,void F.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(G.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){D(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t},disabled:Z&&""===Z.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,j.jsx)(g.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,t){return(0,j.jsx)(g.Z.Item,{style:(null==Z?void 0:Z.uid)===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){E(e)},children:(0,j.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[n(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",Ht[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:n(null==e?void 0:e.description)})})}}),l&&(0,j.jsx)(_t,{isEdit:p,open:l,loading:x,metaApp:Z,onClose:function(){c(!1)},onSubmit:K}),q]})},Xt=fe.Z.Text,Qt=fe.Z.Paragraph,$t=P()(P()(P()({},p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),en=P()(P()(P()({},p.Ff2,(0,j.jsx)(je.Z,{})),p.cRk,(0,j.jsx)(be.Z,{})),p.SbP,(0,j.jsx)(we.Z,{})),tn={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},nn={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},rn=function(){var e,t=(0,k.useIntl)(),n=Yt((function(e){return{currentMetaApp:e.currentMetaApp,refreshCurrentMetaApp:e.refreshCurrentMetaApp}})),r=n.currentMetaApp,a=n.refreshCurrentMetaApp,s=(0,y.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),x=m[0],g=m[1],b=(0,y.useState)(!1),w=i()(b,2),A=w[0],Z=w[1],M=(0,y.useState)(!1),S=i()(M,2),E=(S[0],S[1],(0,y.useState)(!1)),P=i()(E,2),T=P[0],W=P[1],F=(0,y.useState)(!1),q=i()(F,2),D=q[0],V=q[1],K=function(e,t){return e?t?e:"******":"-"},z=function(){var e=I()(C()().mark((function e(){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,Lt({uid:r.uid});case 7:t=e.sent,console.log("refreshAccessTokenMetaApp response",t),200===t.code?(R.yw.success("AccessToken 刷新成功"),a&&a(t.data),U()):R.yw.error("刷新失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=I()(C()().mark((function e(){var t,n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return V(!0),e.prev=4,e.next=7,Wt({uid:r.uid});case 7:t=e.sent,console.log("queryMetaAppByUid refresh detail",t),200===t.code?(n=t.data,R.yw.success("应用详情刷新成功"),a&&a(n)):R.yw.error("刷新失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,V(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(he.Z,{title:(0,j.jsxs)(ae.Z,{children:[en[r.type]||(0,j.jsx)(je.Z,{}),(0,j.jsx)("span",{children:r.name||"Meta应用详情"}),(0,j.jsx)(xe.Z,{color:"blue",children:$t[r.type]||r.type})]}),extra:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(ke.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(J.ZP,{icon:(0,j.jsx)(Ze.Z,{}),onClick:U,loading:D,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ge.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Xt,{copyable:!0,children:r.uid})}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(xe.Z,{color:"blue",children:$t[r.type]||r.type})}),(0,j.jsx)(ge.Z.Item,{label:"AppID",children:(0,j.jsx)(Xt,{copyable:!0,children:r.appId})}),(0,j.jsx)(ge.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Xt,{copyable:!!p&&{text:r.appSecret||""},children:K(r.appSecret,p)}),(0,j.jsx)(ye.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(J.ZP,{type:"text",icon:p?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"加密模式",children:(0,j.jsx)(xe.Z,{color:nn[r.encryptMode]||"default",children:tn[r.encryptMode]||r.encryptMode})}),(0,j.jsx)(ge.Z.Item,{label:"URL",children:(0,j.jsx)(Xt,{copyable:!0,children:(0,v.kG)()+"/meta/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+r.uid})}),(0,j.jsx)(ge.Z.Item,{label:"Token",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Xt,{copyable:!!x&&{text:r.token||""},children:K(r.token,x)}),(0,j.jsx)(ye.Z,{title:x?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:x?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return g(!x)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Xt,{copyable:!!A&&{text:r.encodingAesKey||""},children:K(r.encodingAesKey,A)}),(0,j.jsx)(ye.Z,{title:A?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(J.ZP,{type:"text",icon:A?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return Z(!A)},size:"small"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ae.Z,{children:[(0,j.jsx)(Xt,{copyable:!!l&&{text:r.accessToken||""},children:K(r.accessToken,l)}),(0,j.jsx)(ye.Z,{title:l?"隐藏Token":"显示Token",children:(0,j.jsx)(J.ZP,{type:"text",icon:l?(0,j.jsx)(Me.Z,{}):(0,j.jsx)(Ce.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,j.jsx)(ye.Z,{title:"刷新AccessToken",children:(0,j.jsx)(J.ZP,{type:"primary",icon:(0,j.jsx)(Se.Z,{}),onClick:z,size:"small",loading:T,children:"刷新Token"})})]})}),(0,j.jsx)(ge.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Ee()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(Qt,{children:r.description})}),(0,j.jsx)(ge.Z.Item,{label:t.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ee()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(ve.Z,{}),(0,j.jsx)(fe.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(Qt,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(he.Z,{bordered:!1,children:(0,j.jsx)(me.Z,{description:"请先在左侧列表选择一个Meta应用",image:me.Z.PRESENTED_IMAGE_SIMPLE})})},an=function(e){console.log(e)},sn=[{key:"detail",label:"应用详情",children:(0,j.jsx)(rn,{})}],on=function(){var e=(0,y.useState)(sn),t=i()(e,2),n=t[0],r=t[1];return(0,y.useEffect)((function(){var e=[].concat(sn);r(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(A.Z,{defaultActiveKey:"agent",items:n,onChange:an})})},ln=a.Z.Sider,cn=a.Z.Content,un=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(ln,{width:n,style:t,children:(0,j.jsx)(Jt,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(cn,{children:(0,j.jsx)(on,{})})})]})},dn=function(e){var t=e.channel,n="web"===(null==t?void 0:t.name)||"npm"===(null==t?void 0:t.name);return(0,j.jsxs)("div",{children:[n&&(0,j.jsx)(Qe,{channel:t}),"app"===(null==t?void 0:t.name)&&(0,j.jsx)(Pt,{}),"wechat-app"===(null==t?void 0:t.name)&&(0,j.jsx)(Be,{}),"meta-app"===(null==t?void 0:t.name)&&(0,j.jsx)(un,{}),"douyin"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"xiaohongshu"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"baidu"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"weibo"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"pdd"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"jd"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"qianniu"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"doudian"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"whatsapp"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"telegram"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"facebook"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"line"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"shopify"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"lazada"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"wordpress"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"woocommerce"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"opencart"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"magento"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"prestashop"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"dify"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{}),"coze"===(null==t?void 0:t.name)&&(0,j.jsx)(Z,{})]})},pn=function(){var e=(0,y.useState)(""),t=i()(e,2),n=t[0],r=t[1],a=(0,y.useState)([]),s=i()(a,2),o=s[0],l=s[1],c=x().currentChannel;(0,y.useEffect)((function(){c&&u(c)}),[c]);var u=function(e){var t=e.name;-1===o.findIndex((function(e){return e.key===t}))&&l([].concat(d()(o),[{label:e.nickname,key:t,children:(0,j.jsx)(dn,{channel:e}),channelInfo:e,closable:!0}])),r(t)};return(0,j.jsx)(A.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:n,type:"editable-card",onEdit:function(e,t){"remove"===t&&function(e){var t=o.findIndex((function(t){return t.key===e})),a=o.filter((function(t){return t.key!==e}));if(a.length&&e===n){var s=a[t===a.length?t-1:t].key;r(s)}l(a)}(e)},items:o})},fn=a.Z.Sider,hn=a.Z.Content,mn=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(fn,{style:t,children:(0,j.jsx)(w,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(hn,{style:n,children:(0,j.jsx)(pn,{})})})]})})}}}]);