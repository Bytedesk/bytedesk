"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{2516:function(e,t,n){var r=n(17082),a=n(73457),s=n(44194),o=n(87413),i=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,c=e.proFieldProps,d=(0,a.Z)(e,u);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:c},d))},c=s.forwardRef(l);t.Z=c},6807:function(e,t,n){var r=n(69169);t.ZP=r.A},200:function(e,t,n){n.d(t,{I2:function(){return y},dO:function(){return p},l8:function(){return m},o_:function(){return d}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/fixed/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/fixed/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/fixed/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/fixed/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},27522:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return y},t5:function(){return m},v_:function(){return p}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,n){n.d(t,{D$:function(){return p},EP:function(){return y},hS:function(){return m},z_:function(){return d}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67560:function(e,t,n){n(90819),n(73193),n(89933),n(45332),n(24170),n(72614),n(1902),n(95490),n(55735),n(30921),n(44194),n(31549)},74087:function(e,t,n){n.r(t),n.d(t,{default:function(){return ce}});var r=n(75574),a=n(44194),s=n(8247),o=n(30921),i=n(90819),u=n.n(i),l=n(73193),c=n.n(l),d=n(89933),f=n.n(d),p=n(45332),g=n.n(p),m=n(86803),v=n(24170),y=n(76750),h=n(1902),b=n(6631),x=n(59908),w=n(69169),j=n(4499),k=n(32350),M=n(84288),Z=n(75365),S=n(31549),R=function(){var e=w.A.useForm(),t=g()(e,1)[0],n=(0,o.useIntl)(),r=(0,y.Z)().translateString,s=(0,h.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}})),i=s.currentAgent,l=s.setCurrentAgent,d=(0,a.useState)(""),p=g()(d,2),R=p[0],F=p[1];(0,a.useEffect)((function(){var e;i&&t.setFieldsValue({nickname:r(null==i?void 0:i.nickname),email:null==i?void 0:i.email,mobile:null==i?void 0:i.mobile,description:r(null==i?void 0:i.description),memberUid:null==i||null===(e=i.member)||void 0===e?void 0:e.uid})}),[i]);var A=function(){var e=f()(u()().mark((function e(t){var r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUploadSuccess:",t),F(t),r=c()(c()({},i),{},{avatar:t}),e.next=5,(0,v.n1)(r);case 5:a=e.sent,console.log("updateAvatar response:",a),200===a.code?(m.yw.success(n.formatMessage({id:"update.success"})),l(a.data)):(m.yw.destroy(),m.yw.error(a.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=f()(u()().mark((function e(t){var r,a,s,o,d,f,p,g,y,h;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),m.yw.loading(n.formatMessage({id:"updating"})),y=c()(c()(c()({},i),t),{},{avatar:R,serviceSettings:c()(c()({},i.serviceSettings),{},{welcomeFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.welcomeFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),faqUids:null==i||null===(s=i.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==i||null===(o=i.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.hotFaqs)||void 0===d?void 0:d.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(f=i.serviceSettings)||void 0===f||null===(f=f.shortcutFaqs)||void 0===f?void 0:f.map((function(e){return e.uid}))}),robotSettings:c()(c()({},i.robotSettings),{},{robotUid:null===(p=i.robotSettings)||void 0===p||null===(p=p.robot)||void 0===p?void 0:p.uid}),messageLeaveSettings:c()(c()({},i.messageLeaveSettings),{},{worktimeUids:null==i||null===(g=i.messageLeaveSettings)||void 0===g||null===(g=g.worktimes)||void 0===g?void 0:g.map((function(e){return e.uid}))})}),console.log("agentObject:",y),e.next=6,(0,v.sE)(y);case 6:h=e.sent,console.log("updateAgent response:",h),200===h.code?(m.yw.destroy(),m.yw.success(n.formatMessage({id:"update.success"})),l(h.data)):(m.yw.destroy(),m.yw.error(h.message));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e;i&&(F(i.avatar),t.setFieldsValue({member:null==i||null===(e=i.member)||void 0===e?void 0:e.nickname}))}),[i]),(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(w.A,{form:t,style:{marginLeft:"20px"},onFinish:C,children:[(0,S.jsx)(w.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:n.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,S.jsxs)(b.G,{onSuccess:A,onError:function(e){console.log("handleUploadError:",e),m.yw.error(e)},children:[(0,S.jsx)(M.C,{src:R}),(0,S.jsx)(Z.ZP,{icon:(0,S.jsx)(x.Z,{}),children:n.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,S.jsx)(j.Z,{width:"md",name:"nickname",label:n.formatMessage({id:"agent.info.nickname"}),rules:[{required:!0,message:n.formatMessage({id:"agent.info.nickname.required"})}]}),(0,S.jsx)(j.Z,{width:"md",name:"email",label:n.formatMessage({id:"agent.info.email"}),rules:[{required:!0,message:n.formatMessage({id:"agent.info.email.required"})}]}),(0,S.jsx)(j.Z,{width:"md",name:"mobile",label:n.formatMessage({id:"agent.info.mobile"}),rules:[{required:!0,message:n.formatMessage({id:"agent.info.mobile.required"})}]}),(0,S.jsx)(k.Z,{width:"md",name:"description",label:n.formatMessage({id:"agent.info.description"}),rules:[{required:!0,message:n.formatMessage({id:"agent.info.description.required"})}]}),(0,S.jsx)(j.Z,{width:"md",name:"member",label:n.formatMessage({id:"agent.info.member"}),disabled:!0})]})})},F=n(55735),A=n(43705),C=n(71469),q=n(23635),P=(n(67560),n(54166),n(50796)),T=n(75808),U=n(40836),E=n(200),V=n(27522),O=n(40612),N=n(5651),I=n(48708),L=n(84881),D=n(32943),z=n(38775),_=function(e){var t,n,r=e.type,s=(0,o.useIntl)(),i=(0,o.useNavigate)(),l=w.A.useForm(),c=g()(l,1)[0],d=(0,y.Z)().translateString,p=(0,a.useState)(),b=g()(p,2),x=b[0],j=b[1],k=(0,a.useState)(),M=g()(k,2),R=M[0],A=M[1],C=(0,O.u)((function(e){return e.currentOrg})),q=(0,h.E)((function(e){return e.currentAgent})),P=(0,h.E)((function(e){return e.setCurrentAgent})),T=(0,a.useMemo)((function(){var e;return(null==q||null===(e=q.autoReplySettings)||void 0===e?void 0:e.autoReplyType)||F.DST}),[null==q||null===(t=q.autoReplySettings)||void 0===t?void 0:t.autoReplyType]),U=(0,a.useState)(T),_=g()(U,2),Q=_[0],W=_[1],B=(0,a.useCallback)(f()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.yw.loading(s.formatMessage({id:"loading"})),t={pageNumber:0,pageSize:50,orgUid:null==C?void 0:C.uid},e.next=5,(0,E.o_)(t);case 5:n=e.sent,console.log("getAutoReplyFixed response:",n),200===n.code?j(n):m.yw.error(n.message),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error fetching auto replies:",e.t0),m.yw.error(s.formatMessage({id:"error.fetch.failed"}));case 14:return e.prev=14,m.yw.destroy(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])}))),[null==C?void 0:C.uid]),G=(0,a.useCallback)(function(){var e=f()(u()().mark((function e(t){var n,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m.yw.loading(s.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:50,type:t,orgUid:null==C?void 0:C.uid},e.next=5,(0,V.AP)(n);case 5:r=e.sent,console.log("getKeywordBase response:",r),200===r.code?A(r):m.yw.error(r.message),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error fetching knowledge base:",e.t0),m.yw.error(s.formatMessage({id:"error.fetch.failed"}));case 14:return e.prev=14,m.yw.destroy(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(t){return e.apply(this,arguments)}}(),[Q,null==C?void 0:C.uid]);(0,a.useEffect)((function(){B(),G(F.WvL)}),[]),(0,a.useEffect)((function(){Q===F.PZ1?G(F.WvL):Q===F.PcP&&G(F.QPQ)}),[Q]),(0,a.useEffect)((function(){var e,t,n,a,s,o;r===F.Njn&&null!=q&&q.autoReplySettings&&c.setFieldsValue({kbUid:null==q||null===(e=q.autoReplySettings)||void 0===e?void 0:e.kbUid,autoReplyEnabled:null==q||null===(t=q.autoReplySettings)||void 0===t?void 0:t.autoReplyEnabled,autoReplyType:null==q||null===(n=q.autoReplySettings)||void 0===n?void 0:n.autoReplyType,autoReplyUid:null==q||null===(a=q.autoReplySettings)||void 0===a?void 0:a.autoReplyUid,autoReplyContent:null==q||null===(s=q.autoReplySettings)||void 0===s?void 0:s.autoReplyContent,autoReplyContentType:null==q||null===(o=q.autoReplySettings)||void 0===o?void 0:o.autoReplyContentType})}),[q,c,r]);var $=function(){var e=f()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleAutoReplySubmit:"),m.yw.loading(s.formatMessage({id:"autoreply.save.loading",defaultMessage:"正在保存，请稍后..."})),t={uid:null==q?void 0:q.uid,autoReplySettings:{autoReplyEnabled:c.getFieldValue("autoReplyEnabled"),autoReplyType:c.getFieldValue("autoReplyType"),autoReplyUid:c.getFieldValue("autoReplyUid"),autoReplyContent:c.getFieldValue("autoReplyContent"),autoReplyContentType:c.getFieldValue("autoReplyContentType"),kbUid:c.getFieldValue("kbUid")}},e.next=5,(0,v.i8)(t);case 5:n=e.sent,console.log("handleUpdateAutoReply:",n),200===n.code?(m.yw.destroy(),P(n.data)):(m.yw.destroy(),m.yw.error(s.formatMessage({id:"autoreply.save.error",defaultMessage:"保存失败"})));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(D.Z,{message:"自动回复",description:"已经接入人工的情况下，自动回复可以作为辅助回复，提高回复效率。",type:"info"}),(0,S.jsx)(z.Z,{}),(0,S.jsxs)(w.A,{form:c,onFinish:$,children:[(0,S.jsx)(I.Z,{width:"md",name:"autoReplyEnabled",label:"是否启用自动回复",fieldProps:{onChange:$}}),(0,S.jsx)(L.Z,{width:"md",name:"autoReplyType",label:"自动回复类型",options:[{label:"固定回复",value:F.DST},{label:"关键字匹配",value:F.PZ1},{label:"大模型回复",value:F.PcP,disabled:!0}],fieldProps:{onChange:function(e,t){!function(e,t){console.log("handleAutoReplyTypeChange:",e),W(e)}(e)}}}),Q===F.DST&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(w.A.Item,{children:(0,S.jsx)(Z.ZP,{icon:(0,S.jsx)(N.Z,{}),onClick:function(){i("/kb/autoreply/data")},children:"添加固定回复内容"},"github")}),(0,S.jsx)(L.Z,{width:"md",name:"autoReplyContent",label:"选择固定回复内容",options:null==x||null===(n=x.data)||void 0===n?void 0:n.content.map((function(e){return{label:d(null==e?void 0:e.content),value:null==e?void 0:e.content}})),fieldProps:{onChange:function(e,t){!function(e,t){var n;console.log("handleAutoReplySelectChange:",e),null==x||null===(n=x.data.content)||void 0===n||n.forEach((function(t){t.uid===e&&c.setFieldsValue({autoReplyContentType:t.type,autoReplyContent:t.content})}))}(e)}}})]}),Q===F.PZ1&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(w.A.Item,{children:(0,S.jsx)(Z.ZP,{icon:(0,S.jsx)(N.Z,{}),onClick:function(){i("/kb/autoreply/data")},children:"添加关键词知识库"},"github")}),(0,S.jsx)(L.Z,{width:"md",name:"kbUid",label:"选择关键词知识库",options:null==R?void 0:R.data.content.map((function(e){return{label:d(e.name),value:e.uid}}))})]}),Q===F.PcP&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(w.A.Item,{children:(0,S.jsx)(Z.ZP,{icon:(0,S.jsx)(N.Z,{}),onClick:function(){i("/kb/llm/data")},children:"添加大模型知识库"},"github")}),(0,S.jsx)(L.Z,{width:"md",name:"kbUid",label:"选择大模型知识库",options:null==R?void 0:R.data.content.map((function(e){return{label:d(e.name),value:e.uid}}))})]})]})]})},Q=n(98473),W=function(){var e=(0,o.useIntl)(),t=(0,h.E)((function(e){return e.setCurrentAgent})),n=(0,O.u)((function(e){return e.currentOrg})),r=(0,h.E)((function(e){return e.currentAgent})),i=(0,a.useMemo)((function(){return[{key:"faq",label:(0,S.jsx)(o.FormattedMessage,{id:"menu.kbase.faq",defaultMessage:"FAQ"}),children:(0,S.jsx)(A.Z,{type:F.Njn})},{key:"quickFaqs",label:(0,S.jsx)(o.FormattedMessage,{id:"menu.kbase.quickbutton",defaultMessage:"QuickButton"}),children:(0,S.jsx)(C.Z,{type:F.Njn})},{key:"rate",label:(0,S.jsx)(o.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,S.jsx)(q.Z,{type:F.Njn})},{key:"right",label:(0,S.jsx)(o.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,S.jsx)(U.Z,{type:F.Njn})},{key:"popup",label:(0,S.jsx)(o.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,S.jsx)(T.Z,{type:F.Njn})},{key:"trigger",label:(0,S.jsx)(o.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"}),children:(0,S.jsx)(Q.Z,{type:F.Njn})},{key:"autoreply",label:(0,S.jsx)(o.FormattedMessage,{id:"autoreply",defaultMessage:"AutoReply"}),children:(0,S.jsx)(_,{type:F.Njn})},{key:"inputassociation",label:(0,S.jsx)(o.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,S.jsx)(P.Z,{type:F.Njn})}]}),[e]),l=function(){var a=f()(u()().mark((function a(){var s,o;return u()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,m.yw.loading(e.formatMessage({id:"loading"})),s={orgUid:null==n?void 0:n.uid,uid:null==r?void 0:r.uid},a.next=5,(0,v.tY)(s);case 5:o=a.sent,console.log("queryAgentDetail response:",o),200===o.code?t(o.data):m.yw.error(o.message),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(0),console.error("Error fetching agent detail:",a.t0),m.yw.error(e.formatMessage({id:"error.fetch.failed"}));case 14:return a.prev=14,m.yw.destroy(),a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[0,10,14,17]])})));return function(){return a.apply(this,arguments)}}();return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(s.Z,{tabPosition:"left",items:i,onChange:function(e){console.log("key:",e),l()}})})},B=n(82211),G=(n(9389),n(55930),n(73170),n(14238)),$=function(){var e=(0,o.useIntl)(),t=(0,a.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,S.jsx)(R,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,S.jsx)(G.Z,{type:F.Njn})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,S.jsx)(W,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,S.jsx)(B.Z,{type:F.Njn})}]}),[e]);return(0,S.jsx)(s.Z,{defaultActiveKey:"basic",items:t})},J=n(23864),K=n(15722),Y=n(82669),H=n(53530),X=n(27487),ee=n(9452),te=n(19981),ne=n(6807),re=n(2516),ae=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=ne.ZP.useForm(),o=g()(s,1)[0],i=(0,O.u)((function(e){return e.currentOrg})),u=(0,te.Z)((function(e){return e.memberResult})),l=(0,a.useMemo)((function(){for(var e,t,n=[],r=0;r<u.data.content.length;r++){var a={title:"",value:"",children:[]};e=u.data.content[r],(t=a).title=e.nickname,t.value=e.uid,n.push(a)}return n}),[u]);return(0,S.jsx)("div",{children:(0,S.jsx)(H.Z,{title:"创建客服",open:t,forceRender:!0,onOk:function(){console.log("handleOk"),o.validateFields().then((function(e){console.log("form values:",e);var t={nickname:o.getFieldValue("nickname"),email:o.getFieldValue("email"),mobile:o.getFieldValue("mobile"),memberUid:o.getFieldValue("memberUid"),orgUid:null==i?void 0:i.uid};console.log("agent:",t),r(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,S.jsxs)(ne.ZP,{form:o,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,S.jsx)(re.Z,{label:"绑定成员",name:"memberUid",tooltip:"请先到组织-》成员-》创建成员",rules:[{required:!0,message:"请选择成员!"}],fieldProps:{multiple:!1,treeDefaultExpandAll:!0,placeholder:"请选择成员",onChange:function(e){console.log("onTreeSelectChange:",e);for(var t=0;t<u.data.content.length;t++){var n=u.data.content[t];n.uid===e&&(console.log("element:",n),o.setFieldsValue({nickname:n.nickname}),o.setFieldsValue({email:n.email}),o.setFieldsValue({mobile:n.mobile}))}},treeData:l,variant:"outlined"}}),(0,S.jsx)(j.Z,{label:"昵称",name:"nickname",rules:[{required:!0,message:"请输入昵称!"}]}),(0,S.jsx)(j.Z,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱!"},{type:"email",message:"请输入正确的邮箱地址"}]}),(0,S.jsx)(j.Z,{label:"手机号",name:"mobile",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}]})]})})})},se=n(73669),oe=function(){var e=(0,o.useIntl)(),t=(0,a.useRef)(!1),n=(0,y.Z)(),r=n.translateString,s=n.translateStringTranct,i=(0,J.Z)().isDarkMode,l=(0,a.useState)(!1),c=g()(l,2),d=c[0],p=c[1],b=(0,O.u)((function(e){return e.currentOrg})),x=(0,te.Z)((function(e){return e.setMemberResult})),w=(0,h.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,insertAgent:e.insertAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent,deleteCurrentAgent:e.deleteCurrentAgent}})),j=w.agentResult,k=w.currentAgent,R=w.insertAgent,A=w.setAgentResult,C=w.setCurrentAgent,q=w.deleteCurrentAgent,P=H.Z.useModal(),T=g()(P,2),U=T[0],E=T[1],V=function(){var t=f()(u()().mark((function t(n){var r;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete agent",n),m.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),t.next=4,(0,v.Lr)(n);case 4:r=t.sent,console.log("delete agent response",r),200===r.code?(m.yw.destroy(),m.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),q(n.uid)):(m.yw.destroy(),m.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),N=function(){var e=f()(u()().mark((function e(){var n,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,m.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=8,(0,v._t)(n);case 8:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(m.yw.destroy(),A(r)):(m.yw.destroy(),m.yw.error(s(r.message))),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=f()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=3,(0,se.z_)(t);case 3:n=e.sent,console.log("queryAllMembers:",t,n),200===n.code?x(n):m.yw.error(s(n.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){N(),I()}),[]);var L=function(){var t=f()(u()().mark((function t(n){var r;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("save agent"),m.yw.loading(e.formatMessage({id:"creating",defaultMessage:"Creating"})),t.next=4,(0,v.x_)(n);case 4:r=t.sent,console.log("create agent:",r),200===r.code?(m.yw.destroy(),m.yw.success(e.formatMessage({id:"create.success"})),R(r.data),p(!1)):(m.yw.destroy(),m.yw.error(s(r.message)));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(X.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,S.jsx)(Z.ZP,{size:"small",type:"primary",icon:(0,S.jsx)(Y.Z,{}),onClick:function(){p(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,S.jsx)(Z.ZP,{size:"small",onClick:N,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,S.jsx)(Z.ZP,{onClick:function(){return function(t){U.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(K.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(t.nickname),"】？"),onOk:function(){V(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(k)},size:"small",danger:!0,disabled:""===(null==k?void 0:k.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,S.jsx)(ee.Z,{itemLayout:"horizontal",dataSource:j.data.content,renderItem:function(t,n){return(0,S.jsx)(ee.Z.Item,{style:k.uid===t.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){C(t)},children:(0,S.jsx)(ee.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,S.jsx)(M.C,{src:t.avatar}),title:(0,S.jsx)(S.Fragment,{children:s(t.nickname)}),description:(r=t,(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("span",{style:{color:"#999999",fontSize:12},children:[r.status===F.Ra4&&"[😀-".concat(e.formatMessage({id:"agent.status.online"}),"]"),r.status===F.LZ1&&"[🔻-".concat(e.formatMessage({id:"agent.status.offline"}),"]"),r.status===F.tU$&&"[🏃‍♀️-".concat(e.formatMessage({id:"agent.status.busy"}),"]"),r.connected?" ✅".concat(e.formatMessage({id:"agent.connection.success"})):" ❌".concat(e.formatMessage({id:"agent.connection.failed"}))]})}))})},t.uid);var r}}),d&&(0,S.jsx)(ae,{open:d,onClose:function(){p(!1)},onSubmit:L}),E]})},ie=n(96865),ue=r.Z.Sider,le=r.Z.Content,ce=function(){var e=(0,ie.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,a.useEffect)((function(){}),[]),(0,S.jsxs)(r.Z,{children:[(0,S.jsx)(ue,{width:n,style:t,children:(0,S.jsx)(oe,{})}),(0,S.jsx)(r.Z,{children:(0,S.jsx)(le,{children:(0,S.jsx)($,{})})})]})}},19981:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(55735),a=n(44435),s=n(83642),o=n(83890),i=(0,a.Ue)()((0,s.mW)((0,s.tJ)((0,o.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:r.PQL})))}}]);