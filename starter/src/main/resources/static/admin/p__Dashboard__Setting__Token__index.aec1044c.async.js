"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5128],{72252:function(e,t,a){a.r(t),a.d(t,{default:function(){return ue}});var n=a(45332),s=a.n(n),r=a(44194),o=a(37963),i=a(73193),c=a.n(i),d=a(84176),l=a.n(d),u=a(86222),f=a.n(u),g=a(90819),p=a.n(g),m=a(89933),k=a.n(m),h=a(5025),M=a(5488),v=a(14870);function x(e){return y.apply(this,arguments)}function y(){return(y=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/query/org",{method:"GET",params:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return T.apply(this,arguments)}function T(){return(T=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/create",{method:"POST",data:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return A.apply(this,arguments)}function A(){return(A=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/update",{method:"POST",data:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/delete",{method:"POST",data:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return C.apply(this,arguments)}function C(){return(C=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/delete/all",{method:"POST",data:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return Z.apply(this,arguments)}function Z(){return(Z=k()(p()().mark((function e(t){return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/token/generate",{method:"POST",data:c()(c()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=a(34599),E=a(12322),P=a(15722),O=a(10162),F=a(54881),U=a(36099),_=a(93689),q=a(58275),B=a(2484),N=a(81084),V=a(68349),J=a(27473),L=a(88344),W=a(67652),z=a(5780),X=a(78359),Y=a(32394),H=a(48821),K=a(47783),G=a(11137),Q=a(59999),$=a(16331),ee=a(68724),te=a(49616),ae=a(80556),ne=a(31549),se=function(e){var t=e.isEdit,a=e.token,n=e.open,o=e.onClose,i=e.onSubmit,d=(0,v.useIntl)(),l=Y.A.useForm(),u=s()(l,1)[0],f=(0,D.u)((function(e){return e.currentOrg})),g=(0,r.useState)(M.Bye),m=s()(g,2),x=m[0],y=m[1],w=(0,r.useState)(!1),T=s()(w,2),b=T[0],A=T[1],j=function(){var e=k()(p()().mark((function e(){var t,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f&&f.uid){e.next=3;break}return h.yw.error(d.formatMessage({id:"token.organization.required",defaultMessage:"请先选择组织"})),e.abrupt("return");case 3:return A(!0),e.prev=4,t={orgUid:f.uid,type:x},e.next=8,R(t);case 8:a=e.sent,console.log("generateToken response",null==a?void 0:a.data,t),200===(null==a?void 0:a.code)&&null!=a&&a.data?(u.setFieldValue("accessToken",a.data),h.yw.success(d.formatMessage({id:"token.generate.success",defaultMessage:"Token生成成功"}))):h.yw.error(d.formatMessage({id:"token.generate.failed",defaultMessage:"Token生成失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Generate token error:",e.t0),h.yw.error(d.formatMessage({id:"token.generate.failed",defaultMessage:"Token生成失败"}));case 17:return e.prev=17,A(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){var e,n,s;t?(y((null==a?void 0:a.type)||M.ntl),s=(null==a?void 0:a.type)===M.Bye||(null==a?void 0:a.type)===M.ntl||(null==a?void 0:a.type)===M.UnP||(null==a?void 0:a.type)===M.SZe||(null==a?void 0:a.type)===M.BWI||(null==a?void 0:a.type)===M.Ofb||(null==a?void 0:a.type)===M.p_p?Array.isArray(null==a?void 0:a.scope)?null==a?void 0:a.scope:null!=a&&a.scope?[null==a?void 0:a.scope]:[]:Array.isArray(null==a?void 0:a.scope)?null==a?void 0:a.scope.join(" "):(null==a?void 0:a.scope)||"",u.setFieldsValue({uid:null==a?void 0:a.uid,name:null==a?void 0:a.name,type:null==a?void 0:a.type,accessToken:null==a?void 0:a.accessToken,refreshToken:null==a?void 0:a.refreshToken,scope:s,expiresAt:null==a?void 0:a.expiresAt,permanent:null!==(e=null==a?void 0:a.permanent)&&void 0!==e&&e,revoked:null!==(n=null==a?void 0:a.revoked)&&void 0!==n&&n,revokeReason:null==a?void 0:a.revokeReason,channel:null==a?void 0:a.channel,device:null==a?void 0:a.device,description:null==a?void 0:a.description})):(y(M.ntl),u.setFieldsValue({name:"",type:M.ntl,accessToken:"",refreshToken:"",scope:[],expiresAt:void 0,permanent:!1,revoked:!1,revokeReason:"",channel:"",device:"",description:""}))}),[t,a,u]),(0,ne.jsx)(ne.Fragment,{children:(0,ne.jsx)(ee.Z,{title:d.formatMessage({id:"token.drawer.title",defaultMessage:"Token"}),width:600,onClose:o,open:n,extra:(0,ne.jsxs)(te.Z,{children:[(0,ne.jsx)(z.ZP,{onClick:o,children:d.formatMessage({id:"token.drawer.cancel",defaultMessage:"取消"})}),(0,ne.jsx)(z.ZP,{type:"primary",onClick:function(){return u.submit()},children:d.formatMessage({id:"token.drawer.submit",defaultMessage:"提交"})})]}),children:(0,ne.jsxs)(Y.A,{form:u,name:"tokenForm",onFinish:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=c()({},e);x===M.Bye||x===M.ntl||x===M.UnP||x===M.SZe||x===M.BWI||x===M.Ofb||x===M.p_p?Array.isArray(t.scope)||(t.scope=t.scope?[t.scope]:[]):Array.isArray(t.scope)&&(t.scope=t.scope.join(" ")),t.permanent&&(t.expiresAt=void 0);var a=c()(c()({},t),{},{orgUid:null==f?void 0:f.uid});console.log("submit",a),i(a)}))},submitter:!1,children:[(0,ne.jsx)(H.Z,{label:d.formatMessage({id:"token.form.name",defaultMessage:"名称"}),name:"name",rules:[{required:!0}]}),(0,ne.jsx)(K.Z,{name:"type",label:d.formatMessage({id:"token.form.type",defaultMessage:"类型"}),width:"md",options:[{label:d.formatMessage({id:"token.type.api",defaultMessage:"API Token"}),value:M.ntl}],rules:[{required:!0}],fieldProps:{onChange:function(e){y(e),e===M.Bye||e===M.ntl||e===M.UnP||e===M.SZe||e===M.BWI||e===M.Ofb||e===M.p_p?u.setFieldValue("scope",[]):u.setFieldValue("scope","")}}}),(0,ne.jsx)(H.Z,{label:d.formatMessage({id:"token.form.accessToken",defaultMessage:"Access Token"}),name:"accessToken",rules:[{required:!0,message:d.formatMessage({id:"token.form.accessToken.required",defaultMessage:"请输入Access Token"})},{min:10,message:d.formatMessage({id:"token.form.accessToken.minLength",defaultMessage:"Access Token长度至少10个字符"})}],fieldProps:{placeholder:d.formatMessage({id:"token.form.accessToken.placeholder",defaultMessage:"请输入访问令牌"}),showCount:!0,maxLength:500,suffix:(0,ne.jsx)(z.ZP,{size:"small",icon:(0,ne.jsx)(ae.Z,{}),onClick:j,type:"text",title:d.formatMessage({id:"token.form.accessToken.generateRandom",defaultMessage:"生成随机Token"}),loading:b,disabled:b,children:b?d.formatMessage({id:"token.form.accessToken.generating",defaultMessage:"生成中..."}):d.formatMessage({id:"token.form.accessToken.generate",defaultMessage:"随机生成"})})}}),(0,ne.jsx)(G.Z,{label:d.formatMessage({id:"token.form.permanent",defaultMessage:"永久有效"}),name:"permanent",fieldProps:{checkedChildren:d.formatMessage({id:"token.form.permanent.checked",defaultMessage:"永久"}),unCheckedChildren:d.formatMessage({id:"token.form.permanent.unchecked",defaultMessage:"临时"}),onChange:function(e){e&&u.setFieldValue("expiresAt",void 0)}},tooltip:d.formatMessage({id:"token.form.permanent.tooltip",defaultMessage:"设置为永久有效时，Token将不会过期"})}),(0,ne.jsx)(Y.A.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.permanent!==t.permanent},children:function(e){return(0,e.getFieldValue)("permanent")?null:(0,ne.jsx)(Q.Z,{label:d.formatMessage({id:"token.form.expiresAt",defaultMessage:"过期时间"}),name:"expiresAt",fieldProps:{placeholder:d.formatMessage({id:"token.form.expiresAt.placeholder",defaultMessage:"选择过期时间"}),showTime:!0,format:"YYYY-MM-DD HH:mm:ss",showNow:!0,showToday:!0},tooltip:d.formatMessage({id:"token.form.expiresAt.tooltip",defaultMessage:"设置Token的过期时间"})})}}),(0,ne.jsx)(G.Z,{label:d.formatMessage({id:"token.form.revoked",defaultMessage:"是否撤销"}),name:"revoked",fieldProps:{checkedChildren:d.formatMessage({id:"token.form.revoked.checked",defaultMessage:"已撤销"}),unCheckedChildren:d.formatMessage({id:"token.form.revoked.unchecked",defaultMessage:"有效"})}}),(0,ne.jsx)(H.Z,{label:d.formatMessage({id:"token.form.revokeReason",defaultMessage:"撤销原因"}),name:"revokeReason",fieldProps:{placeholder:d.formatMessage({id:"token.form.revokeReason.placeholder",defaultMessage:"可选，撤销原因"})}}),(0,ne.jsx)($.Z,{label:d.formatMessage({id:"token.form.description",defaultMessage:"描述"}),name:"description",placeholder:d.formatMessage({id:"token.form.description.placeholder",defaultMessage:"可选，token用途描述"})})]})})})},re=a(18751),oe=a(90033),ie=a(92729),ce=a(13775),de=["current","pageSize"],le=function(){var e=(0,v.useIntl)(),t=(0,r.useRef)(),a=(0,re.Z)().translateString,n=(0,r.useState)(1),o=s()(n,2),i=(o[0],o[1]),d=(0,r.useState)(10),u=s()(d,2),g=(u[0],u[1]),m=(0,D.u)((function(e){return e.currentOrg})),M=(0,oe.L)((function(e){return e.userInfo})),y=(0,ie.t)((function(e){return e.getAccessToken()})),T=(0,r.useState)(!1),A=s()(T,2),S=A[0],C=A[1],R=(0,r.useState)({}),Z=s()(R,2),Y=Z[0],H=Z[1],K=(0,r.useState)(!1),G=s()(K,2),Q=G[0],$=G[1],ee=V.Z.useModal(),te=s()(ee,2),ae=te[0],le=te[1],ue=(0,r.useState)([]),fe=s()(ue,2),ge=fe[0],pe=fe[1],me=(0,r.useState)([]),ke=s()(me,2),he=ke[0],Me=ke[1],ve=(0,r.useState)(0),xe=s()(ve,2),ye=xe[0],we=xe[1],Te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ne.jsx)(v.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150,ellipsis:!0},{title:(0,ne.jsx)(v.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,valueType:"select",valueEnum:{BEARER:{text:"Bearer Token",status:"Default"},API:{text:"API Token",status:"Default"},REFRESH:{text:e.formatMessage({id:"token.type.refresh.text"}),status:"Default"},ACCESS:{text:e.formatMessage({id:"token.type.access.text"}),status:"Default"},THIRD_PARTY:{text:e.formatMessage({id:"token.type.third_party.text"}),status:"Default"},TEMPORARY:{text:e.formatMessage({id:"token.type.temporary.text"}),status:"Default"},DEVICE:{text:e.formatMessage({id:"token.type.device.text"}),status:"Default"},SESSION:{text:e.formatMessage({id:"token.type.session.text"}),status:"Default"},VERIFICATION:{text:e.formatMessage({id:"token.type.verification.text"}),status:"Default"},PASSWORD_RESET:{text:e.formatMessage({id:"token.type.password_reset.text"}),status:"Default"},INVITATION:{text:e.formatMessage({id:"token.type.invitation.text"}),status:"Default"},SSO:{text:e.formatMessage({id:"token.type.sso.text"}),status:"Default"},AUTHORIZATION_CODE:{text:e.formatMessage({id:"token.type.authorization_code.text"}),status:"Default"},CLIENT_CREDENTIALS:{text:e.formatMessage({id:"token.type.client_credentials.text"}),status:"Default"},IMPLICIT:{text:e.formatMessage({id:"token.type.implicit.text"}),status:"Default"},RESOURCE_OWNER_PASSWORD:{text:e.formatMessage({id:"token.type.resource_owner_password.text"}),status:"Default"},CUSTOM:{text:e.formatMessage({id:"token.type.custom.text"}),status:"Default"}},render:function(t){return(0,ce.x9)(t,e)}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"accessToken",defaultMessage:"Access Token"}),dataIndex:"accessToken",width:200,copyable:!0,ellipsis:!0,hideInSearch:!0,render:function(e){return e?e.length>20?"".concat(e.substring(0,20),"..."):e:"-"}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"channel",defaultMessage:"Channel"}),dataIndex:"channel",width:120,hideInSearch:!0,ellipsis:!0},{title:(0,ne.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",width:200,hideInSearch:!0,ellipsis:!0,render:function(e){return e?e.length>30?"".concat(e.substring(0,30),"..."):e:"-"}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"token.expiresAt",defaultMessage:"Expires At"}),dataIndex:"expiresAt",width:180,hideInSearch:!0,valueType:"dateTime",render:function(t,a){return a.permanent?e.formatMessage({id:"token.no.expiry",defaultMessage:"永不过期"}):t||e.formatMessage({id:"token.no.expiry",defaultMessage:"永不过期"})}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"token.permanent",defaultMessage:"Permanent"}),dataIndex:"permanent",width:100,valueType:"select",hideInSearch:!0,valueEnum:{true:{text:e.formatMessage({id:"token.status.permanent",defaultMessage:"永久有效"}),status:"Success"},false:{text:e.formatMessage({id:"token.status.temporary",defaultMessage:"临时有效"}),status:"Default"}}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"revoked",defaultMessage:"Revoked"}),dataIndex:"revoked",width:100,valueType:"select",hideInSearch:!0,valueEnum:{true:{text:e.formatMessage({id:"token.status.revoked"}),status:"Error"},false:{text:e.formatMessage({id:"token.status.valid"}),status:"Success"}}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"revokeReason",defaultMessage:"Revoke Reason"}),dataIndex:"revokeReason",width:150,hideInSearch:!0,ellipsis:!0,render:function(e){return e?e.length>20?"".concat(e.substring(0,20),"..."):e:"-"}},{title:(0,ne.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,valueType:"dateTime"},{title:(0,ne.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,valueType:"dateTime"}],be=[].concat(Te,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:200,render:function(t,n,s,r){return n.accessToken===y?[(0,ne.jsx)("a",{onClick:function(){H(n),$(!0),C(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,ne.jsx)(J.Z,{title:e.formatMessage({id:"token.current.tooltip",defaultMessage:"这是您当前正在使用的访问令牌，无法删除或撤销"}),children:(0,ne.jsx)(L.Z,{icon:(0,ne.jsx)(E.Z,{}),color:"gold",style:{marginLeft:8},children:e.formatMessage({id:"token.current",defaultMessage:"当前Token"})})},"current-token")]:[(0,ne.jsx)("a",{onClick:function(){H(n),$(!0),C(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,ne.jsx)(W.Z,{title:e.formatMessage({id:"token.toggle.revoke.confirm.title",defaultMessage:"确认操作"}),description:n.revoked?e.formatMessage({id:"token.toggle.revoke.confirm.restore",defaultMessage:"确定要恢复此Token吗？"}):e.formatMessage({id:"token.toggle.revoke.confirm.revoke",defaultMessage:"确定要撤销此Token吗？"}),onConfirm:function(){return je(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,ne.jsx)(P.Z,{style:{color:n.revoked?"#52c41a":"#ff4d4f"}}),children:(0,ne.jsx)("a",{style:{color:n.revoked?"#52c41a":"#ff4d4f"},children:n.revoked?e.formatMessage({id:"token.toggle.revoke.restore"}):e.formatMessage({id:"token.toggle.revoke.revoke"})})},"toggle-revoke"),(0,ne.jsx)(W.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(a(n.name),"】？"),onConfirm:function(){return Ae(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,ne.jsx)(P.Z,{style:{color:"red"}}),children:(0,ne.jsx)(z.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),Ae=function(){var a=k()(p()().mark((function a(n){var s;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("deleteToken:",n),a.next=3,j(n);case 3:s=a.sent,console.log("deleteToken:",s),200===s.code?(h.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):h.yw.error(s.message);case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),je=function(){var a=k()(p()().mark((function a(n){var s,r,o;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s={uid:n.uid,name:n.name,type:n.type,accessToken:n.accessToken,refreshToken:n.refreshToken,scope:n.scope,expiresAt:n.expiresAt,permanent:n.permanent,revoked:!n.revoked,revokeReason:n.revoked?"":e.formatMessage({id:"token.manual.revoke",defaultMessage:"手动撤销"}),channel:n.channel,device:n.device,description:n.description,orgUid:n.orgUid},a.next=3,b(s);case 3:r=a.sent,console.log("handleToggleRevoke response:",r),200===r.code?(h.yw.success(e.formatMessage({id:n.revoked?"token.toggle.revoke.success.restore":"token.toggle.revoke.success.revoke"})),null===(o=t.current)||void 0===o||o.reload()):h.yw.error(r.message);case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),Se=function(){var e=k()(p()().mark((function e(a){var n,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(a);case 2:n=e.sent,console.log("handleCreateToken response:",n),200===n.code?(null===(s=t.current)||void 0===s||s.reload(),C(!1)):h.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=k()(p()().mark((function e(a){var n,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.uid=null==Y?void 0:Y.uid,e.next=3,b(a);case 3:n=e.sent,console.log("handleUpdateToken response:",n),200===n.code?(null===(s=t.current)||void 0===s||s.reload(),C(!1)):h.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){C(!0),$(!1),H({})},Re=function(){var a=k()(p()().mark((function a(){var n,s,r,o,i,c,d;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==he.length){a.next=3;break}return h.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),a.abrupt("return");case 3:if(s=he.filter((function(e){return e.accessToken!==y})),0!==s.length){a.next=7;break}return h.yw.warning(e.formatMessage({id:"token.current.batch.delete.warning",defaultMessage:"当前使用的Token不能删除"})),a.abrupt("return");case 7:s.length<he.length&&h.yw.warning(e.formatMessage({id:"token.current.skip.delete.warning",defaultMessage:"已跳过当前使用的Token"})),h.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),r=0,o=0,i=f()(s),a.prev=12,i.s();case 14:if((c=i.n()).done){a.next=28;break}return d=c.value,a.prev=16,a.next=19,j(d);case 19:200===a.sent.code?r++:o++,a.next=26;break;case 23:a.prev=23,a.t0=a.catch(16),o++;case 26:a.next=14;break;case 28:a.next=33;break;case 30:a.prev=30,a.t1=a.catch(12),i.e(a.t1);case 33:return a.prev=33,i.f(),a.finish(33);case 36:h.yw.destroy(),0===o?h.yw.success(e.formatMessage({id:"token.batch.delete.success.count"},{count:r})):h.yw.warning(e.formatMessage({id:"token.batch.delete.partial.success.fail"},{success:r,fail:o})),pe([]),Me([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 41:case"end":return a.stop()}}),a,null,[[12,30,33,36],[16,23]])})));return function(){return a.apply(this,arguments)}}(),Ze=function(){var a=k()(p()().mark((function a(){var n,s,r,o,i,c,d,l;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==he.length){a.next=3;break}return h.yw.warning(e.formatMessage({id:"batch.revoke.noselection",defaultMessage:"请选择要撤销的项目"})),a.abrupt("return");case 3:if(s=he.filter((function(e){return e.accessToken!==y})),0!==s.length){a.next=7;break}return h.yw.warning(e.formatMessage({id:"token.current.batch.revoke.warning",defaultMessage:"当前使用的Token不能撤销"})),a.abrupt("return");case 7:s.length<he.length&&h.yw.warning(e.formatMessage({id:"token.current.skip.revoke.warning",defaultMessage:"已跳过当前使用的Token"})),h.yw.loading(e.formatMessage({id:"revoking",defaultMessage:"正在撤销..."})),r=0,o=0,i=f()(s),a.prev=12,i.s();case 14:if((c=i.n()).done){a.next=29;break}return d=c.value,a.prev=16,l={uid:d.uid,permanent:d.permanent,revoked:!0,revokeReason:e.formatMessage({id:"token.batch.revoke.reason",defaultMessage:"批量撤销"}),orgUid:d.orgUid},a.next=20,b(l);case 20:200===a.sent.code?r++:o++,a.next=27;break;case 24:a.prev=24,a.t0=a.catch(16),o++;case 27:a.next=14;break;case 29:a.next=34;break;case 31:a.prev=31,a.t1=a.catch(12),i.e(a.t1);case 34:return a.prev=34,i.f(),a.finish(34);case 37:h.yw.destroy(),0===o?h.yw.success(e.formatMessage({id:"token.batch.revoke.success.count"},{count:r})):h.yw.warning(e.formatMessage({id:"token.batch.revoke.partial.success.fail"},{success:r,fail:o})),pe([]),Me([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 42:case"end":return a.stop()}}),a,null,[[12,31,34,37],[16,24]])})));return function(){return a.apply(this,arguments)}}(),De=function(){var a=k()(p()().mark((function a(){var n,s,r,o,i,c,d;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==he.length){a.next=3;break}return h.yw.warning(e.formatMessage({id:"batch.restore.noselection",defaultMessage:"请选择要恢复的项目"})),a.abrupt("return");case 3:h.yw.loading(e.formatMessage({id:"restoring",defaultMessage:"正在恢复..."})),s=0,r=0,o=f()(he),a.prev=7,o.s();case 9:if((i=o.n()).done){a.next=24;break}return c=i.value,a.prev=11,d={uid:c.uid,permanent:c.permanent,revoked:!1,revokeReason:"",orgUid:c.orgUid},a.next=15,b(d);case 15:200===a.sent.code?s++:r++,a.next=22;break;case 19:a.prev=19,a.t0=a.catch(11),r++;case 22:a.next=9;break;case 24:a.next=29;break;case 26:a.prev=26,a.t1=a.catch(7),o.e(a.t1);case 29:return a.prev=29,o.f(),a.finish(29);case 32:h.yw.destroy(),0===r?h.yw.success(e.formatMessage({id:"token.batch.restore.success.count"},{count:s})):h.yw.warning(e.formatMessage({id:"token.batch.restore.partial.success.fail"},{success:s,fail:r})),pe([]),Me([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 37:case"end":return a.stop()}}),a,null,[[7,26,29,32],[11,19]])})));return function(){return a.apply(this,arguments)}}(),Ee=function(){var a=k()(p()().mark((function a(){var n,s,r;return p()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==ye){a.next=3;break}return h.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),a.abrupt("return");case 3:return h.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),a.prev=4,n={orgUid:null==m?void 0:m.uid},a.next=8,I(n);case 8:200===(s=a.sent).code?(h.yw.destroy(),h.yw.success(e.formatMessage({id:"token.deleteAll.success.all"})),null===(r=t.current)||void 0===r||r.reloadAndRest()):(h.yw.destroy(),h.yw.error(s.message||e.formatMessage({id:"token.deleteAll.failed"}))),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(4),h.yw.destroy(),h.yw.error(e.formatMessage({id:"token.deleteAll.error.process"})),console.error(e.formatMessage({id:"token.deleteAll.error.console"}),a.t0);case 17:case"end":return a.stop()}}),a,null,[[4,12]])})));return function(){return a.apply(this,arguments)}}(),Pe={selectedRowKeys:ge,onChange:function(e,t){pe(e),Me(t)},getCheckboxProps:function(e){return{disabled:e.accessToken===y,name:e.name}}},Oe=function(){var e=k()(p()().mark((function e(t,a,n){var s,r,o,d,u;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,r=t.pageSize,o=l()(t,de),i(s),g(r),d=c()({pageNumber:s-1,pageSize:r,orgUid:null==m?void 0:m.uid,userUid:null==M?void 0:M.uid},o),e.next=6,x(d);case 6:return u=e.sent,console.log("queryTokensByOrg response:",u,d),200===u.code?we(u.data.totalElements):h.yw.error(u.message),e.abrupt("return",{data:u.data.content,success:!0,total:u.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}();return(0,ne.jsxs)(ne.Fragment,{children:[S&&(0,ne.jsx)(se,{isEdit:Q,open:S,token:Y,onClose:function(){C(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),Q?Ie(e):Se(e)}}),(0,ne.jsx)(N.Z,{columns:be,actionRef:t,cardBordered:!0,rowSelection:Pe,request:Oe,scroll:{x:1600},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){i(e),g(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"token.list.title"}),toolBarRender:function(){return t=[(0,ne.jsx)(z.ZP,{type:"primary",icon:(0,ne.jsx)(O.Z,{}),onClick:Ce,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],a=[],ge.length>0&&a.push({key:"batchDelete",icon:(0,ne.jsx)(F.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(ge.length,")"),onClick:function(){ae.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ge.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Re,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchRevoke",icon:(0,ne.jsx)(U.Z,{}),danger:!0,label:e.formatMessage({id:"batch.revoke"})+" (".concat(ge.length,")"),onClick:function(){ae.confirm({title:e.formatMessage({id:"batch.revoke.tip"}),content:e.formatMessage({id:"batch.revoke.confirm"}),onOk:Ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchRestore",icon:(0,ne.jsx)(_.Z,{}),label:e.formatMessage({id:"batch.restore"})+" (".concat(ge.length,")"),onClick:function(){ae.confirm({title:e.formatMessage({id:"batch.restore.tip"}),content:e.formatMessage({id:"batch.restore.confirm"}),onOk:De,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),a.push({key:"deleteAll",icon:(0,ne.jsx)(q.Z,{}),danger:!0,label:e.formatMessage({id:"token.deleteAll"}),onClick:function(){ae.confirm({title:e.formatMessage({id:"token.deleteAll.tip"}),content:e.formatMessage({id:"token.deleteAll.confirm"}),onOk:Ee,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),a.length>0&&t.push((0,ne.jsx)(X.Z,{menu:{items:a},placement:"bottom",children:(0,ne.jsxs)(z.ZP,{type:ge.length>0?"primary":"default",danger:ge.length>0,children:[ge.length>0?e.formatMessage({id:"batch.operations"})+" (".concat(ge.length,")"):e.formatMessage({id:"more.operations"}),(0,ne.jsx)(B.Z,{})]})},"batchOperations")),t;var t,a}}),le]})},ue=function(){var e=(0,v.useIntl)(),t=(0,r.useState)("tokens"),a=s()(t,2),n=a[0],i=a[1],c=[{key:"tokens",label:e.formatMessage({id:"token.config",defaultMessage:"AccessToken"}),children:(0,ne.jsx)(le,{})}];return(0,ne.jsx)("div",{className:"token-container",children:(0,ne.jsx)(o.Z,{activeKey:n,onChange:function(e){return i(e)},items:c})})}}}]);