"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8472],{3291:function(e,t,r){r.r(t),r.d(t,{default:function(){return ye}});var n=r(44194),a=r(44528),s=r(62395),i=r(76711),l=r.n(i),o=r(73193),d=r.n(o),u=r(90819),c=r.n(u),f=r(89933),g=r.n(f),m=r(45332),p=r.n(m),v=r(88130),x=r(72264),h=r(13243),b=r(60593),M=r(42876),y=r(89654),k=r(33633),j=r(15065),w=r(77902),S=r(6992),C=r(41881),Z=r(91768),P=r(66759),F=r(61489),T=r(90170),U=r(77686),R=r(38552),E=r(70097),I=r(68992),O=r(91733),V=r(30394),A=(r(98257),r(57648),r(23968),r(51898)),q=r(28672),z=r(65448),N=r(34519),L=r(10154),D=r.n(L),B=r(16743),K=r(95017),Q=r(54008),W=r(99754),_=r(89007),J=r(59853),G=r(50447),X=r(26608),H=r(94433),$=r(38956),Y=r(46659),ee=r(31549),te=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],re=n.forwardRef((function(e,t){var r=e.fieldProps,n=e.proFieldProps,a=e.min,s=e.max,i=e.step,l=e.marks,o=e.vertical,d=e.range,u=(0,$.Z)(e,te);return(0,ee.jsx)(Y.Z,(0,H.Z)({valueType:"slider",fieldProps:(0,H.Z)((0,H.Z)({},r),{},{min:a,max:s,step:i,marks:l,vertical:o,range:d,style:null==r?void 0:r.style}),ref:t,proFieldProps:n,filedConfig:{ignoreWidth:!0}},u))})),ne=r(69650),ae=r(63052),se=r(40855),ie=r(41558),le=r(87005),oe=r(62134),de=function(e){var t,r,a=e.settingsUid,i=(0,s.useIntl)(),l=(0,E.Z)().isDarkMode,o=_.A.useForm(),u=p()(o,1)[0],f=(0,W.Z)().translateString,m=(0,U.u)((function(e){return e.currentOrg})),v=(0,n.useState)([]),h=p()(v,2),b=h[0],M=h[1],y=(0,n.useState)({}),k=p()(y,2),j=k[0],w=k[1],S=(0,n.useState)(!1),C=p()(S,2),Z=C[0],P=C[1],T=(0,n.useState)(""),R=p()(T,2),V=R[0],A=R[1],q=(0,n.useState)(""),z=p()(q,2),N=z[0],L=z[1],H=(0,n.useState)(""),$=p()(H,2),Y=$[0],te=$[1],de=(0,n.useState)(""),ue=p()(de,2),ce=(ue[0],ue[1]),fe=(0,n.useState)(""),ge=p()(fe,2),me=(ge[0],ge[1]),pe=(0,n.useState)(!1),ve=p()(pe,2),xe=ve[0],he=ve[1],be=(0,n.useState)(""),Me=p()(be,2),ye=(Me[0],Me[1]),ke=(0,n.useState)(""),je=p()(ke,2),we=je[0],Se=je[1],Ce=(0,n.useState)(""),Ze=p()(Ce,2),Pe=Ze[0],Fe=Ze[1],Te=(0,n.useState)(""),Ue=p()(Te,2),Re=Ue[0],Ee=Ue[1],Ie=(0,n.useState)({}),Oe=p()(Ie,2),Ve=Oe[0],Ae=Oe[1],qe=(0,n.useState)(),ze=p()(qe,2),Ne=ze[0],Le=ze[1],De=(0,O.z)((function(e){return{currentRobotSettings:e.currentRobotSettings,setCurrentRobotSettings:e.setCurrentRobotSettings}})),Be=De.currentRobotSettings,Ke=De.setCurrentRobotSettings;(0,n.useEffect)((function(){var e=null==Be?void 0:Be.llm;u.setFieldValue("kbSourceEnabled",null==Be?void 0:Be.kbSourceEnabled),u.setFieldValue("kbEnabled",null==Be?void 0:Be.kbEnabled),u.setFieldValue("kbUid",null==Be?void 0:Be.kbUid),u.setFieldValue("enabled",null==e?void 0:e.enabled),u.setFieldValue("enableThinking",null==e?void 0:e.enableThinking),u.setFieldValue("enableStreaming",null==e?void 0:e.enableStreaming),u.setFieldValue("topK",null==e?void 0:e.topK),u.setFieldValue("scoreThreshold",null==e?void 0:e.scoreThreshold),u.setFieldValue("textProviderUid",null==e?void 0:e.textProviderUid),u.setFieldValue("textModel",null==e?void 0:e.textModel),u.setFieldValue("temperature",null==e?void 0:e.temperature),u.setFieldValue("topP",null==e?void 0:e.topP),u.setFieldValue("prompt",f(null==e?void 0:e.prompt)),u.setFieldValue("defaultReply",null==e?void 0:e.defaultReply),u.setFieldValue("contextMsgCount",null==e?void 0:e.contextMsgCount),u.setFieldValue("rerankEnabled",null==e?void 0:e.rerankEnabled),u.setFieldValue("rerankProvider",null==e?void 0:e.rerankProvider),u.setFieldValue("rerankProviderUid",null==e?void 0:e.rerankProviderUid),u.setFieldValue("rerankModel",null==e?void 0:e.rerankModel),u.setFieldValue("searchType",(null==e?void 0:e.searchType)||"MIXED");var t=(null==e?void 0:e.textProviderUid)||"",r=(null==e?void 0:e.textModel)||"";ce((null==e?void 0:e.rerankProvider)||""),me((null==e?void 0:e.rerankModel)||""),A(t),L(r);var n=(null==e?void 0:e.rerankProvider)||"",a=(null==e?void 0:e.rerankProviderUid)||"",s=(null==e?void 0:e.rerankModel)||"";ye(n),Se(a),Fe(s),r&&!Y&&te(r)}),[null==Be?void 0:Be.uid]),(0,n.useEffect)((function(){var e=V,t=N;if(e&&t&&j[e]){var r=j[e].find((function(e){return e.value===t}));r&&te(r.label)}}),[j,V,N]),(0,n.useEffect)((function(){var e=we,t=Pe;if(e&&t&&Ve[e]){var r=Ve[e].find((function(e){return e.value===t}));r&&Ee(r.label)}}),[Ve,we,Pe]);var Qe=function(){var e=g()(c()().mark((function e(){var t,r,n,a,s,i,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",enabled:!0,orgUid:null==m?void 0:m.uid,level:I.whQ},e.next=4,(0,B.mK)(t);case 4:r=e.sent,console.log("queryLlmProvidersByOrg:",r,t),200===r.code?(a=r.data.content||[],s=a.filter((function(e){return!oe.ju.includes(e.type)})),M(s),(i=null==Be||null===(n=Be.llm)||void 0===n?void 0:n.textProviderUid)&&(l=s.find((function(e){return e.uid===i})))&&(l.type===I.CZ7?tt(l):nt(l))):F.yw.error(r.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){Qe()}),[]);var We=function(){var e=g()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,type:I.QPQ,orgUid:null==m?void 0:m.uid},e.next=4,(0,Q.AP)(t);case 4:r=e.sent,console.log("getKeywordBase response:",t,r),200===r.code?Le(r):F.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch kbase list:",e.t0),F.yw.error(i.formatMessage({id:"error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){We()}),[]);var _e=(0,n.useCallback)((function(){P(!0)}),[]),Je=(0,n.useCallback)((function(){P(!1)}),[]),Ge=(0,n.useCallback)((function(e,t,r){P(!1);var n=b.find((function(t){return t.uid===e})),a=n?n.type:e;A(e),L(t),te(r),u.setFieldsValue({textProvider:a,textProviderUid:e,textModel:t}),u.submit()}),[u,b]),Xe=((0,n.useCallback)((function(){he(!0)}),[]),(0,n.useCallback)((function(){he(!1)}),[])),He=(0,n.useCallback)((function(e,t,r){he(!1);var n=b.find((function(t){return t.uid===e})),a=n?n.type:e;ye(a),Se(e),Fe(t),Ee(r),u.setFieldsValue({rerankProvider:a,rerankProviderUid:e,rerankModel:t}),u.submit()}),[u,b]),$e=(0,n.useCallback)((function(e,t){w((function(r){return d()(d()({},r),{},D()({},e,t))}))}),[]),Ye=(0,n.useCallback)((function(e,t){Ae((function(r){return d()(d()({},r),{},D()({},e,t))}))}),[]),et=function(){var e=g()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={enabled:t.enabled,enableThinking:t.enableThinking,enableStreaming:t.enableStreaming,topK:t.topK,scoreThreshold:t.scoreThreshold,textProvider:t.textProvider,textProviderUid:t.textProviderUid,textModel:t.textModel,temperature:t.temperature,topP:t.topP,prompt:t.prompt,defaultReply:t.defaultReply,contextMsgCount:t.contextMsgCount,rerankEnabled:t.rerankEnabled,rerankProvider:t.rerankProvider,rerankProviderUid:t.rerankProviderUid,rerankModel:t.rerankModel,searchType:t.searchType},Be&&Ke(d()(d()({},Be),{},{uid:a||Be.uid,llm:r,kbSourceEnabled:t.kbSourceEnabled,kbEnabled:t.kbEnabled,kbUid:t.kbUid})),e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=g()(c()().mark((function e(t){var r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={baseUrl:t.baseUrl},e.next=4,(0,se.VM)(r);case 4:n=e.sent,console.log("getOllamaServerStatus: ",n),200===n.code&&n.data?rt(t):F.yw.error(n.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),F.yw.error(i.formatMessage({id:"error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),rt=function(){var e=g()(c()().mark((function e(t){var r,n,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={baseUrl:t.baseUrl},e.next=4,(0,se.c8)(r);case 4:n=e.sent,console.log("getOllamaLocalModels: ",n),200===n.code?(a=n.data.map((function(e){return{value:e.name,label:e.name,providerName:t.uid}})),w((function(e){return d()(d()({},e),{},D()({},t.uid,a))})),V===t.uid&&N&&(s=a.find((function(e){return e.value===N})))&&te(s.label)):F.yw.error(n.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),F.yw.error(i.formatMessage({id:"error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=g()(c()().mark((function e(t){var r,n,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:50,providerUid:null==t?void 0:t.uid,orgUid:null==m?void 0:m.uid,level:I.whQ},e.next=4,(0,K.LF)(r);case 4:n=e.sent,console.log("queryLlmModelsByOrg: ",n,r),200===n.code?(a=n.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,providerName:t.nickname}})),w((function(e){return d()(d()({},e),{},D()({},t.uid,a))})),t.uid===u.getFieldValue("textProviderUid")&&N&&(s=a.find((function(e){return e.value===N})))&&te(s.label)):F.yw.error(n.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),F.yw.error(i.formatMessage({id:"error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();return(0,ee.jsxs)("div",{style:{marginLeft:15},children:[(0,ee.jsxs)(_.A,{form:u,size:"large",layout:"vertical",style:{maxWidth:"800px"},submitter:!1,onFinish:et,children:[(0,ee.jsx)(J.Z,{width:"lg",name:"enabled",label:i.formatMessage({id:"llm.enabled.label"}),tooltip:i.formatMessage({id:"llm.enabled.tooltip"}),fieldProps:{onChange:function(e){setTimeout((function(){u.submit()}),100)}}}),(0,ee.jsx)(J.Z,{name:"kbSourceEnabled",label:i.formatMessage({id:"robot.kb.source.enable",defaultMessage:"显示知识来源"}),tooltip:i.formatMessage({id:"robot.kb.source.enable.tooltip",defaultMessage:"在前端展示答案的来源信息（如知识库/文档/段落等），仅影响展示，不影响检索与回答逻辑"}),fieldProps:{onChange:function(){setTimeout((function(){u.submit()}),100)}}}),(0,ee.jsx)(J.Z,{name:"kbEnabled",label:i.formatMessage({id:"robot.kb.enable",defaultMessage:"启用大模型知识库"}),tooltip:i.formatMessage({id:"robot.kb.enable.tooltip",defaultMessage:"开启后，机器人将优先使用知识库回答问题"}),fieldProps:{onChange:function(){setTimeout((function(){u.submit()}),100)}}}),(0,ee.jsx)(G.Z,{width:"md",name:"kbUid",label:i.formatMessage({id:"robot.kb.select",defaultMessage:"大模型知识库"}),options:null==Ne||null===(t=Ne.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return{value:e.uid,label:f(e.name)}})),fieldProps:{onChange:function(){setTimeout((function(){u.submit()}),100)}}}),u.getFieldValue("enabled")&&(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(J.Z,{width:"lg",name:"enableThinking",label:i.formatMessage({id:"llm.thinking.label"}),tooltip:i.formatMessage({id:"llm.thinking.tooltip"}),fieldProps:{onChange:function(e){setTimeout((function(){u.submit()}),100)}}}),(0,le.OJ)()&&(0,ee.jsx)(G.Z,{width:"lg",name:"searchType",label:i.formatMessage({id:"llm.searchType.label"}),tooltip:i.formatMessage({id:"llm.searchType.tooltip"}),options:[{label:i.formatMessage({id:"llm.searchType.fulltext"}),value:I.ccx},{label:i.formatMessage({id:"llm.searchType.vector"}),value:I.DGp},{label:i.formatMessage({id:"llm.searchType.mixed"}),value:I.rk3}],rules:[{required:!0,message:i.formatMessage({id:"llm.searchType.required"})}],fieldProps:{popupRender:function(e){return(0,ee.jsxs)("div",{children:[e,(0,ee.jsxs)("div",{style:{padding:"8px 12px"},children:[(0,ee.jsx)("div",{style:{borderTop:"1px solid #e8e8e8",margin:"4px 0"}}),(0,ee.jsxs)("div",{style:{padding:"8px 0",fontSize:"12px",color:l?"rgba(255, 255, 255, 0.7)":"rgba(0,0,0,0.45)"},children:[(0,ee.jsxs)("strong",{children:[i.formatMessage({id:"llm.searchType.fulltext"}),"："]}),i.formatMessage({id:"llm.searchType.fulltext.description"}),(0,ee.jsx)("br",{}),(0,ee.jsx)("br",{}),(0,ee.jsxs)("strong",{children:[i.formatMessage({id:"llm.searchType.vector"}),"："]}),i.formatMessage({id:"llm.searchType.vector.description"}),(0,ee.jsx)("br",{}),(0,ee.jsx)("br",{}),(0,ee.jsxs)("strong",{children:[i.formatMessage({id:"llm.searchType.mixed"}),"："]}),i.formatMessage({id:"llm.searchType.mixed.description"})]})]})]})}}}),(0,ee.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,ee.jsx)(ne.Z.Text,{strong:!0,style:{marginRight:"8px"},children:i.formatMessage({id:"llm.modelSelection.label"})}),(0,ee.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,ee.jsx)(ae.Z,{size:"small",style:{width:"100%",maxWidth:"500px",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:_e,children:V&&N?(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsxs)("div",{children:[(0,ee.jsx)(ne.Z.Text,{type:"secondary",children:i.formatMessage({id:"llm.modelSelection.provider"})}),(0,ee.jsx)(ne.Z.Text,{strong:!0,children:f((null===(r=b.find((function(e){return e.uid===V})))||void 0===r?void 0:r.nickname)||V)}),(0,ee.jsx)("br",{}),(0,ee.jsx)(ne.Z.Text,{type:"secondary",children:i.formatMessage({id:"llm.modelSelection.model"})}),(0,ee.jsx)(ne.Z.Text,{strong:!0,children:Y||N})]}),(0,ee.jsx)(x.ZP,{type:"primary",children:i.formatMessage({id:"llm.modelSelection.change"})})]}):(0,ee.jsx)("div",{style:{textAlign:"center"},children:(0,ee.jsx)(x.ZP,{type:"primary",children:i.formatMessage({id:"llm.modelSelection.select"})})})})}),(0,ee.jsxs)("div",{style:{display:"none"},children:[(0,ee.jsx)(G.Z,{name:"textProvider",width:"lg"}),(0,ee.jsx)(G.Z,{name:"textProviderUid",width:"lg"}),(0,ee.jsx)(G.Z,{name:"textModel",width:"lg"})]})]}),(0,ee.jsx)(X.Z,{width:"lg",name:"prompt",label:i.formatMessage({id:"llm.prompt.label"}),tooltip:i.formatMessage({id:"llm.prompt.tooltip"}),placeholder:i.formatMessage({id:"llm.prompt.placeholder"}),fieldProps:{rows:13,maxLength:16383,showCount:!0},rules:[{required:!0,message:i.formatMessage({id:"llm.prompt.required"})},{max:16383,message:i.formatMessage({id:"llm.prompt.maxLength"})}]}),(0,ee.jsx)(X.Z,{width:"lg",name:"defaultReply",label:i.formatMessage({id:"llm.defaultReply.label"}),tooltip:i.formatMessage({id:"llm.defaultReply.tooltip"}),placeholder:i.formatMessage({id:"llm.defaultReply.placeholder"}),fieldProps:{rows:1,maxLength:100,showCount:!0},rules:[{required:!0,message:i.formatMessage({id:"llm.defaultReply.required"})},{max:100,message:i.formatMessage({id:"llm.defaultReply.maxLength"})}]}),(0,ee.jsxs)("div",{style:{width:"500px"},children:[(0,ee.jsx)(re,{width:"md",label:i.formatMessage({id:"llm.temperature.label"}),name:"temperature",min:0,max:1,step:.1,marks:{0:i.formatMessage({id:"llm.temperature.precise"}),.5:i.formatMessage({id:"llm.temperature.balanced"}),1:i.formatMessage({id:"llm.temperature.creative"})},tooltip:i.formatMessage({id:"llm.temperature.tooltip"}),rules:[{required:!0,message:i.formatMessage({id:"llm.temperature.required"})}]}),(0,ee.jsx)(re,{width:"md",label:i.formatMessage({id:"llm.topP.label"}),name:"topP",min:0,max:1,step:.05,marks:{0:i.formatMessage({id:"llm.topP.low"}),.5:i.formatMessage({id:"llm.topP.medium"}),1:i.formatMessage({id:"llm.topP.high"})},tooltip:i.formatMessage({id:"llm.topP.tooltip"})}),(0,ee.jsx)(re,{width:"md",label:i.formatMessage({id:"llm.contextMsgCount.label"}),name:"contextMsgCount",min:0,max:50,step:1,marks:{0:"0",5:"5",10:"10",15:"15",20:"20",25:"25",30:"30",35:"35",40:"40",45:"45",50:"50"},tooltip:i.formatMessage({id:"llm.contextMsgCount.tooltip"}),rules:[{required:!0,message:i.formatMessage({id:"llm.contextMsgCount.required"})}]})]})]})]}),(0,ee.jsx)(ie.Z,{visible:Z,onCancel:Je,onOk:Ge,initialProvider:V,initialModel:N,initialModelLabel:Y,providers:b,currentOrgUid:null==m?void 0:m.uid,existingProviderModels:j,onModelsLoaded:$e,allowedModelTypes:[I.l55,I.xZ8,"CHAT"]}),(0,ee.jsx)(ie.Z,{visible:xe,onCancel:Xe,onOk:He,initialProvider:we,initialModel:Pe,initialModelLabel:Re,providers:b,currentOrgUid:null==m?void 0:m.uid,existingProviderModels:Ve,onModelsLoaded:Ye,allowedModelTypes:[I.SeQ]})]})},ue=r(84005),ce="welcome",fe=function(){var e=(0,s.useIntl)(),t=(0,U.u)((function(e){return e.currentOrg})),r=(0,R.Z)().leftSiderStyle,i=(0,E.Z)().isDarkMode,o=(0,n.useState)(!1),u=p()(o,2),f=u[0],m=u[1],L=(0,n.useState)([]),D=p()(L,2),B=D[0],K=D[1],Q=(0,n.useState)(),W=p()(Q,2),_=W[0],J=W[1],G=(0,n.useState)(""),X=p()(G,2),H=X[0],$=X[1],Y=(0,n.useState)(ce),te=p()(Y,2),re=te[0],ne=te[1],ae=(0,n.useState)(!1),se=p()(ae,2),ie=se[0],le=se[1],oe=(0,n.useState)(null),fe=p()(oe,2),ge=fe[0],me=fe[1],pe=(0,n.useMemo)((function(){return B.find((function(e){return e.uid===_}))||null}),[B,_]),ve=(0,n.useState)(!1),xe=p()(ve,2),he=xe[0],be=xe[1],Me=(0,n.useState)(!1),ye=p()(Me,2),ke=ye[0],je=ye[1],we=(0,n.useState)(!1),Se=p()(we,2),Ce=Se[0],Ze=Se[1],Pe=(0,n.useRef)(""),Fe=(0,O.z)((function(e){return{setCurrentRobotSettings:e.setCurrentRobotSettings,currentRobotSettings:e.currentRobotSettings}})),Te=Fe.setCurrentRobotSettings,Ue=Fe.currentRobotSettings,Re=(0,n.useMemo)((function(){if(!H)return B;var e=H.toLowerCase();return B.filter((function(t){var r=(t.name||t.uid||"").toLowerCase(),n=(t.description||"").toLowerCase();return r.includes(e)||n.includes(e)}))}),[B,H]),Ee=(0,n.useCallback)(function(){var e=g()(c()().mark((function e(r,n){var a,s,i,l,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return m(!0),e.prev=3,s=(null!=r?r:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=8,(0,T.VW)(i);case 8:l=e.sent,console.log("加载机器人配置模板列表: ",l,i),o=(null==l||null===(a=l.data)||void 0===a?void 0:a.content)||[],K(o),!(o.length>0)||_&&o.some((function(e){return e.uid===_}))||(J(o[0].uid),null!=n&&n.keepActive||ne(ce));case 13:return e.prev=13,m(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,r){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,_]);(0,n.useEffect)((function(){Ee(H)}),[null==t?void 0:t.uid]),(0,n.useEffect)((function(){pe?(Te(pe),Pe.current=JSON.stringify(null!=pe?pe:{}),Ze(!1)):(Te(null),Pe.current=JSON.stringify({}),Ze(!1))}),[null==pe?void 0:pe.uid]),(0,n.useEffect)((function(){if(pe)try{var e=JSON.stringify(null!=Ue?Ue:{});Ze(e!==Pe.current)}catch(e){Ze(!0)}}),[Ue,null==pe?void 0:pe.uid]);var Ie=function(){var r=g()(c()().mark((function r(n){var a,s,i;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=null!=n?n:pe)&&a.uid){r.next=3;break}return r.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},r.next=6,(0,T.r$)(s);case 6:(i=r.sent)&&200===i.code?(F.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Ee(H)):F.yw.error((null==i?void 0:i.message)||"删除失败");case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),Oe=function(){var r=g()(c()().mark((function r(n,a){var s;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,T.sK)({uid:n,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(s=r.sent)&&200===s.code?(F.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),Ee(H)):F.yw.error((null==s?void 0:s.message)||"操作失败"),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("切换启用状态失败:",r.t0),F.yw.error("操作失败");case 11:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}(),Ve=function(){var r=g()(c()().mark((function r(){var n,a,s,i;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=pe&&pe.uid){r.next=3;break}return F.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"请从左侧选择模板"})),r.abrupt("return");case 3:return be(!0),r.prev=4,n=Ue&&Ue.uid===pe.uid?Ue:pe,r.next=8,(0,T.sK)(d()({uid:pe.uid,orgUid:null==t?void 0:t.uid},n));case 8:(a=r.sent)&&200===a.code?(F.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Pe.current=JSON.stringify(null!==(s=null!==(i=a.data)&&void 0!==i?i:n)&&void 0!==s?s:{}),Ze(!1),Ee(H)):F.yw.error((null==a?void 0:a.message)||"保存失败"),r.next=16;break;case 12:r.prev=12,r.t0=r.catch(4),console.error("保存失败:",r.t0),F.yw.error("保存失败");case 16:return r.prev=16,be(!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[4,12,16,19]])})));return function(){return r.apply(this,arguments)}}(),Ae=function(){var r=g()(c()().mark((function r(){var n,a,s;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=pe&&pe.uid){r.next=3;break}return F.yw.warning(e.formatMessage({id:"robot.settings.template.select",defaultMessage:"请从左侧选择模板"})),r.abrupt("return");case 3:if(je(!0),r.prev=4,!Ce){r.next=8;break}return r.next=8,Ve();case 8:return n={uid:pe.uid,orgUid:null==t?void 0:t.uid},r.next=11,(0,T.KF)(n);case 11:(a=r.sent)&&200===a.code?(F.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Pe.current=JSON.stringify(null!==(s=a.data)&&void 0!==s?s:{}),Ze(!1),Ee(H,{keepActive:!0})):F.yw.error((null==a?void 0:a.message)||"发布失败"),r.next=19;break;case 15:r.prev=15,r.t0=r.catch(4),console.error("发布失败:",r.t0),F.yw.error("发布失败");case 19:return r.prev=19,je(!1),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[4,15,19,22]])})));return function(){return r.apply(this,arguments)}}(),qe=(0,n.useMemo)((function(){return null!=pe&&pe.uid?[{key:"welcome",label:(0,ee.jsx)(s.FormattedMessage,{id:"robot.settings.service.welcome",defaultMessage:"欢迎语设置"}),children:(0,ee.jsx)(z.Z,{type:I._X4,settingsUid:pe.uid})},{key:"tips",label:(0,ee.jsx)(s.FormattedMessage,{id:"robot.settings.service.tips",defaultMessage:"提示信息"}),children:(0,ee.jsx)(q.Z,{type:I._X4,settingsUid:pe.uid})},{key:"service",label:(0,ee.jsx)(s.FormattedMessage,{id:"robot.settings.service",defaultMessage:"服务设置"}),children:(0,ee.jsx)(A.Z,{type:I._X4,settingsUid:pe.uid})},{key:"rate",label:(0,ee.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,ee.jsx)(ue.Z,{type:I._X4,settingsUid:pe.uid})}].concat(l()([]),[{key:"right",label:(0,ee.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,ee.jsx)(V.Z,{type:I._X4,settingsUid:pe.uid})}],l()([]),[{key:"llm",label:(0,ee.jsx)(s.FormattedMessage,{id:"llm",defaultMessage:"LLM"}),children:(0,ee.jsx)(de,{settingsUid:pe.uid})}],l()([])):[]}),[null==pe?void 0:pe.uid,e]);return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ee.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,ee.jsxs)(P.Z,{title:e.formatMessage({id:"robot.settings.templates",defaultMessage:"模板列表"}),extra:(0,ee.jsx)(x.ZP,{size:"small",icon:(0,ee.jsx)(S.Z,{}),type:"primary",onClick:function(){me(null),le(!0)},children:(0,ee.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:f,children:[(0,ee.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ee.jsx)(h.Z.Search,{placeholder:e.formatMessage({id:"robot.settings.template.search",defaultMessage:"搜索模板名称"}),value:H,onChange:function(e){return $(e.target.value)},onSearch:function(e){$(e),Ee(e)},allowClear:!0,size:"middle",enterButton:!0})}),(0,ee.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ee.jsx)(b.Z,{dataSource:Re,locale:{emptyText:(0,ee.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ee.jsx)(b.Z.Item,{style:_===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return J(e.uid)},children:(0,ee.jsx)(b.Z.Item.Meta,{title:(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ee.jsx)(y.Z,{size:4,children:e.isDefault?(0,ee.jsx)(k.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ee.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ee.jsx)(v.Z.Panel,{children:pe?(0,ee.jsx)(P.Z,{title:(0,ee.jsxs)(y.Z,{children:[(0,ee.jsxs)("span",{children:[e.formatMessage({id:"robot.settings.editing",defaultMessage:"编辑模板"}),": ",pe.name||pe.uid]}),(0,ee.jsx)(j.Z,{checked:!!pe.enabled,onChange:function(e){return Oe(pe.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ee.jsx)(x.ZP,{size:"small",icon:(0,ee.jsx)(C.Z,{}),onClick:function(e){var t;e.stopPropagation(),me(null!=(t=pe)?t:pe),le(!0)},children:"编辑"}),(0,ee.jsx)(w.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ie(pe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(x.ZP,{size:"small",danger:!0,icon:(0,ee.jsx)(Z.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),pe.isDefault?(0,ee.jsx)(k.Z,{color:"blue",children:"默认"}):null]}),extra:(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(w.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ae()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ee.jsx)(x.ZP,{onClick:function(e){return e.stopPropagation()},loading:ke,type:"default",children:(0,ee.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ee.jsx)(x.ZP,{onClick:function(){pe&&(Te(pe),Pe.current=JSON.stringify(null!=pe?pe:{}),Ze(!1))},disabled:!Ce,children:(0,ee.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ee.jsx)(x.ZP,{type:"primary",loading:he,onClick:Ve,disabled:!Ce,children:(0,ee.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ee.jsx)(a.Z,{activeKey:re,onChange:ne,items:qe})}):(0,ee.jsx)(P.Z,{children:(0,ee.jsx)(M.Z,{description:e.formatMessage({id:"robot.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,ee.jsx)(N.Z,{open:ie,onOpenChange:le,orgUid:(null==t?void 0:t.uid)||"",record:ge,onSuccess:function(){le(!1),Ee(H)}})]})},ge=r(54596),me=r(27401),pe=r(94571),ve=r(2915),xe=r(47268),he=function(e){var t,r=e.open,a=e.record,i=e.onClose,l=e.onSuccess,o=(0,s.useIntl)(),u=(0,U.u)((function(e){return e.currentOrg})),f=(0,n.useMemo)((function(){return!(null==a||!a.uid)}),[a]),m=(0,n.useState)(!1),v=p()(m,2),h=v[0],b=v[1],M=(0,n.useState)([]),y=p()(M,2),k=y[0],j=y[1],w=(0,n.useState)(!1),C=p()(w,2),Z=C[0],P=C[1],R=(0,n.useState)(0),E=p()(R,2),O=E[0],V=E[1],A=(0,n.useRef)(),q=(0,n.useCallback)(function(){var e=g()(c()().mark((function e(t){var r,n,a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(!0),e.prev=1,n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==u?void 0:u.uid,searchText:t||""},e.next=5,(0,T.VW)(n);case 5:return a=e.sent,s=(null==a||null===(r=a.data)||void 0===r?void 0:r.content)||[],j(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,P(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==u?void 0:u.uid]);return(0,ee.jsxs)(ve.a,{open:r,onOpenChange:function(e){e||i()},title:f?o.formatMessage({id:"robot.edit",defaultMessage:"编辑机器人"}):o.formatMessage({id:"pages.robot.new",defaultMessage:"新建机器人"}),width:520,formRef:A,initialValues:f?{nickname:null==a?void 0:a.nickname,type:null==a?void 0:a.type,settingsUid:null==a||null===(t=a.settings)||void 0===t?void 0:t.uid}:{type:I.f4h},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:o.formatMessage({id:"save",defaultMessage:"保存"}),resetText:o.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return i()}}},onFinish:function(){var e=g()(c()().mark((function e(t){var r,n,s,g,m,p,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F.yw.loading(o.formatMessage({id:f?"updating":"creating",defaultMessage:f?"Updating":"Creating"})),!f){e.next=9;break}return m=d()(d()({},a),{},{nickname:t.nickname,name:null!==(s=t.nickname)&&void 0!==s?s:null==a?void 0:a.name,type:null!==(g=t.type)&&void 0!==g?g:null==a?void 0:a.type,settingsUid:t.settingsUid}),e.next=6,(0,pe.$l)(m);case 6:n=e.sent,e.next=13;break;case 9:return p={name:t.nickname,nickname:t.nickname,type:t.type,settingsUid:t.settingsUid,kbEnabled:!1,orgUid:null==u?void 0:u.uid},e.next=12,(0,pe.lg)(p);case 12:n=e.sent;case 13:if(F.yw.destroy(),200!==(null===(r=n)||void 0===r?void 0:r.code)){e.next=21;break}return F.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==l||l(n.data),i(),e.abrupt("return",!0);case 21:return F.yw.error((null===(v=n)||void 0===v?void 0:v.message)||o.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),F.yw.destroy(),F.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,ee.jsx)(G.Z,{name:"settingsUid",label:o.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),placeholder:o.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),rules:[{required:!0,message:o.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:O},request:function(){var e=g()(c()().mark((function e(t){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.keyWords,e.abrupt("return",q(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:Z,notFoundContent:0===k.length?(0,ee.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,ee.jsx)("div",{style:{marginBottom:8,color:"#999"},children:o.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,ee.jsx)(x.ZP,{size:"small",type:"primary",icon:(0,ee.jsx)(S.Z,{}),onClick:function(){return b(!0)},children:o.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,ee.jsx)(x.ZP,{size:"small",icon:(0,ee.jsx)(S.Z,{}),onClick:function(){return b(!0)},title:o.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:o.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,ee.jsx)(xe.Z,{name:"nickname",label:o.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:o.formatMessage({id:"nickname",defaultMessage:"昵称"})}]}),(0,ee.jsx)(G.Z,{name:["type"],label:o.formatMessage({id:"type",defaultMessage:"类型"}),options:[{label:o.formatMessage({id:I.f4h,defaultMessage:"Service"}),value:I.f4h},{label:o.formatMessage({id:I.wG_,defaultMessage:"Marketing"}),value:I.wG_,disabled:!0},{label:o.formatMessage({id:I.Qeb,defaultMessage:"Chat"}),value:I.Qeb,disabled:!0}],rules:[{required:!0,message:o.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:o.formatMessage({id:"choose",defaultMessage:"Choose"}),allowClear:!0}}),(0,ee.jsx)(N.Z,{open:h,onOpenChange:b,orgUid:(null==u?void 0:u.uid)||"",record:null,onSuccess:function(){b(!1),V((function(e){return e+1}))}})]})},be=r(47239),Me=function(){var e=(0,s.useIntl)(),t=(0,n.useRef)(),r=(0,U.u)((function(e){return e.currentOrg})),a=(0,n.useState)(!1),i=p()(a,2),l=i[0],o=i[1],d=(0,n.useState)(!1),u=p()(d,2),f=u[0],m=u[1],v=(0,n.useState)(null),h=p()(v,2),b=h[0],M=h[1],y=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,ee.jsx)(me.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0},{title:e.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,r){return null!=r&&r.settings?(0,ee.jsx)("a",{onClick:function(){M(r),o(!0)},children:r.settings.name||e.formatMessage({id:"robot.settings.configured",defaultMessage:"已配置"})}):(0,ee.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){M(r),o(!0)},children:e.formatMessage({id:"robot.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:200,fixed:"right",render:function(r,n){return[(0,ee.jsx)("a",{onClick:function(){return s.history.push("/service/channel")},children:e.formatMessage({id:"robot.get.code",defaultMessage:"获取机器人代码"})},"code"),(0,ee.jsx)("a",{onClick:function(){M(n),o(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,ee.jsx)(w.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==n?void 0:n.nickname,"】？"),onConfirm:g()(c()().mark((function r(){var a,s;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return F.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),r.prev=1,r.next=4,(0,pe.gf)(n);case 4:a=r.sent,F.yw.destroy(),200===(null==a?void 0:a.code)?(F.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=t.current)||void 0===s||s.reload()):F.yw.error((null==a?void 0:a.message)||"Delete failed"),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),F.yw.destroy(),F.yw.error("Delete error");case 13:case"end":return r.stop()}}),r,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,ee.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(ge.Z,{columns:y,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},toolBarRender:function(){return[(0,ee.jsx)(x.ZP,{type:"primary",onClick:function(){M(null),m(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=g()(c()().mark((function e(t){var n,a,s,i,l,o,d,u,f,g,m,p,v,x,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(null!==(n=null==t?void 0:t.current)&&void 0!==n?n:1)-1,l=null!==(a=null==t?void 0:t.pageSize)&&void 0!==a?a:10,o=null!==(s=null==t?void 0:t.searchText)&&void 0!==s?s:"",d={pageNumber:i,pageSize:l,categoryUid:"",level:I.whQ,type:I.f4h,orgUid:null==r?void 0:r.uid,searchText:o},e.prev=4,e.next=7,(0,pe.p0)(d);case 7:if(200!==(null==(u=e.sent)?void 0:u.code)){e.next=12;break}return x=(null==u||null===(f=u.data)||void 0===f?void 0:f.content)||[],h=null!==(g=null!==(m=null==u||null===(p=u.data)||void 0===p?void 0:p.totalElements)&&void 0!==m?m:null==u||null===(v=u.data)||void 0===v?void 0:v.numberOfElements)&&void 0!==g?g:x.length,e.abrupt("return",{data:x,total:h,success:!0});case 12:return e.abrupt("return",{data:[],total:0,success:!1});case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",{data:[],total:0,success:!1});case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"robot",defaultMessage:"Robot"})}),l&&(0,ee.jsx)(he,{open:l,record:b,onClose:function(){return o(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),f&&(0,ee.jsx)(be.Z,{open:f,onClose:function(){return m(!1)},onSubmit:function(){var r=g()(c()().mark((function r(n){var a,s;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return F.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),r.prev=1,r.next=4,(0,pe.lg)(n);case 4:a=r.sent,F.yw.destroy(),200===(null==a?void 0:a.code)?(F.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),m(!1),null===(s=t.current)||void 0===s||s.reload()):F.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),F.yw.destroy(),F.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return r.stop()}}),r,null,[[1,9]])})));return function(e){return r.apply(this,arguments)}}()})]})},ye=function(){return(0,ee.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,ee.jsx)(s.FormattedMessage,{id:"menu.robot.table",defaultMessage:"Robot Account"}),children:(0,ee.jsx)(Me,{})},{key:"settings",label:(0,ee.jsx)(s.FormattedMessage,{id:"menu.robot.settings",defaultMessage:"Robot Settings"}),children:(0,ee.jsx)(fe,{})}]})}},34519:function(e,t,r){var n=r(90819),a=r.n(n),s=r(73193),i=r.n(s),l=r(89933),o=r.n(l),d=r(45332),u=r.n(d),c=r(44194),f=r(70878),g=r(66248),m=r(13243),p=r(15065),v=r(62395),x=r(61489),h=r(90170),b=r(31549);t.Z=function(e){var t=e.open,r=e.onOpenChange,n=e.orgUid,s=e.record,l=e.onSuccess,d=(0,v.useIntl)(),M=f.Z.useForm(),y=u()(M,1)[0];(0,c.useEffect)((function(){var e,r;t&&(s?y.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(r=s.isDefault)&&void 0!==r&&r}):(y.resetFields(),y.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,y]);var k=function(){var e=o()(a()().mark((function e(){var t,o,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.validateFields();case 3:if(t=e.sent,o=i()(i()({},t),{},{orgUid:n,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,h.sK)(o);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,h.ZJ)(o);case 13:e.t0=e.sent;case 14:(u=e.t0)&&200===u.code?(x.yw.success(d.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==l||l(),r(!1)):x.yw.error((null==u?void 0:u.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(g.Z,{title:(0,b.jsx)(v.FormattedMessage,{id:null!=s&&s.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:k,onCancel:function(){return r(!1)},okText:(0,b.jsx)(v.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,b.jsx)(v.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,b.jsxs)(f.Z,{form:y,layout:"vertical",preserve:!1,children:[(0,b.jsx)(f.Z.Item,{name:"name",label:(0,b.jsx)(v.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:d.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,b.jsx)(m.Z,{placeholder:d.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,b.jsx)(f.Z.Item,{name:"description",label:(0,b.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(m.Z.TextArea,{rows:3,placeholder:d.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,b.jsx)(f.Z.Item,{name:"enabled",label:(0,b.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,b.jsx)(p.Z,{})})]})})}},47239:function(e,t,r){var n=r(90819),a=r.n(n),s=r(89933),i=r.n(s),l=r(45332),o=r.n(l),d=r(77686),u=r(68992),c=r(89007),f=r(50447),g=r(47268),m=r(62395),p=r(66248),v=r(72264),x=r(44194),h=r(90170),b=r(34519),M=r(6992),y=r(31549);t.Z=function(e){var t=e.open,r=e.onClose,n=e.onSubmit,s=(0,m.useIntl)(),l=c.A.useForm(),k=o()(l,1)[0],j=(0,d.u)((function(e){return e.currentOrg})),w=(0,x.useState)(!1),S=o()(w,2),C=S[0],Z=S[1],P=(0,x.useState)(!1),F=o()(P,2),T=F[0],U=F[1],R=(0,x.useState)(0),E=o()(R,2),I=E[0],O=E[1],V=(0,x.useState)([]),A=o()(V,2),q=A[0],z=A[1],N=(0,x.useCallback)(function(){var e=i()(a()().mark((function e(t){var r,n,s,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U(!0),e.prev=1,n={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==j?void 0:j.uid,searchText:t||""},e.next=5,(0,h.VW)(n);case 5:return s=e.sent,console.log("queryRobotSettingsByOrg response:",s,n),i=(null==s||null===(r=s.data)||void 0===r?void 0:r.content)||[],z(i),!k.getFieldValue("settingsUid")&&i.length>0&&k.setFieldsValue({settingsUid:i[0].uid}),e.abrupt("return",i.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,U(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==j?void 0:j.uid,k]),L=function(){console.log("handleSaveRobot"),k.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==j?void 0:j.uid};console.log("robotObject:",t),n(t),k.resetFields()})).catch((function(e){console.log("Form errors:",e)}))};return(0,x.useEffect)((function(){console.log("RobotForm useEffect"),t&&(k.resetFields(),k.setFieldsValue({type:u.f4h}))}),[t,k]),(0,y.jsx)("div",{children:(0,y.jsxs)(p.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:L,onCancel:function(){k.resetFields(),r()},children:[(0,y.jsxs)(c.A,{form:k,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,y.jsx)(f.Z,{label:s.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:s.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],placeholder:s.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:I},request:function(){var e=i()(a()().mark((function e(t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.keyWords,e.abrupt("return",N(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:T,notFoundContent:0===q.length?(0,y.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,y.jsx)("div",{style:{marginBottom:8,color:"#999"},children:s.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,y.jsx)(v.ZP,{size:"small",type:"primary",icon:(0,y.jsx)(M.Z,{}),onClick:function(){return Z(!0)},children:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0},addonAfter:(0,y.jsx)(v.ZP,{size:"small",icon:(0,y.jsx)(M.Z,{}),onClick:function(){return Z(!0)},title:s.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:s.formatMessage({id:"common.new",defaultMessage:"新建"})})}),(0,y.jsx)(g.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return L()}}}),(0,y.jsx)(f.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:s.formatMessage({id:u.wG_,defaultMessage:"Marketing"}),value:u.wG_,disabled:!0},{label:s.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb,disabled:!0}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,y.jsx)(b.Z,{open:C,onOpenChange:Z,orgUid:(null==j?void 0:j.uid)||"",record:null,onSuccess:function(){Z(!1),O((function(e){return e+1}))}})]})})}}}]);