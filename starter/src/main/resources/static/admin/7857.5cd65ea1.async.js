"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7857],{11090:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(11757),a=r(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=r(54183),s=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var l=a.forwardRef(s)},59908:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(11757),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},i=r(54183),s=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var l=a.forwardRef(s)},32350:function(e,t,r){var n=r(17082),a=r(73457),o=r(44194),i=r(35175),s=r(31549),l=["fieldProps","proFieldProps"],d=function(e,t){var r=e.fieldProps,o=e.proFieldProps,d=(0,a.Z)(e,l);return(0,s.jsx)(i.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:o},d))};t.Z=o.forwardRef(d)},66916:function(e,t,r){r.d(t,{$l:function(){return h},JT:function(){return b},Xd:function(){return k},gf:function(){return S},lg:function(){return f},lz:function(){return y},p0:function(){return c},s9:function(){return g}});var n=r(90819),a=r.n(n),o=r(73193),i=r.n(o),s=r(89933),l=r.n(s),d=r(55735),u=r(30921);function c(e){return p.apply(this,arguments)}function p(){return(p=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/query/org",{method:"GET",params:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/create",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/create/prompt",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/avatar",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/prompt",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/kbUid",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/delete",{method:"POST",data:i()(i()({},t),{},{client:d.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},40679:function(e,t,r){var n=r(10154),a=r.n(n),o=r(73193),i=r.n(o),s=r(90819),l=r.n(s),d=r(89933),u=r.n(d),c=r(45332),p=r.n(c),f=r(86803),m=r(82863),g=r(92053),v=r(76750),h=r(55735),x=r(88721),y=r(32327),M=r(62673),b=r(40269),w=r(3849),k=r(73442),j=r(75365),S=r(8247),Z=r(30921),I=r(44194),C=r(31549),P=y.Z.Text,T=I.memo((function(e){var t,r=e.visible,n=e.onCancel,o=e.onOk,s=e.initialProvider,d=e.initialModel,c=e.initialModelLabel,T=e.providers,E=e.currentOrgUid,U=e.existingProviderModels,A=void 0===U?{}:U,L=e.onModelsLoaded,z=e.allowedModelTypes,F=void 0===z?[]:z,O=(0,Z.useIntl)(),V=(0,v.Z)().translateString,q=(0,I.useState)(s||""),B=p()(q,2),N=B[0],D=B[1],H=(0,I.useState)(A),Y=p()(H,2),R=Y[0],K=Y[1],Q=(0,I.useState)(s||""),G=p()(Q,2),J=G[0],W=G[1],$=(0,I.useState)(d||""),_=p()($,2),X=_[0],ee=_[1],te=(0,I.useState)(c||""),re=p()(te,2),ne=re[0],ae=re[1],oe=(0,I.useState)(!1),ie=p()(oe,2),se=ie[0],le=ie[1];(0,I.useEffect)((function(){W(s),ee(d),ae(c),D(s)}),[s,d,c,r]),(0,I.useEffect)((function(){if(r&&N&&!R[N]&&!se){le(!0),f.yw.loading({content:O.formatMessage({id:"loading"}),key:"modelLoading"});var e=T.find((function(e){return e.name===N}));e&&("ollama"===e.name?pe():me(e))}}),[r,N,T]);var de=(0,I.useCallback)((function(){J&&X&&o(J,X,ne)}),[J,X,ne,o]),ue=(0,I.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(t){return e.toLowerCase().includes(t.toLowerCase())}))}),[]),ce=(0,I.useCallback)((function(e){return e?e.filter((function(e){return!ue(e.value)&&(!F||0===F.length||(!e.type||F.includes(e.type)))})):[]}),[F,ue]),pe=function(){var e=u()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.VM)();case 3:200===(t=e.sent).code&&t.data?fe():(f.yw.error(t.message),f.yw.destroy("modelLoading"),le(!1)),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),f.yw.error(O.formatMessage({id:"error"})),f.yw.destroy("modelLoading"),le(!1);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=u()(l()().mark((function e(){var t,r,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.c8)();case 3:200===(t=e.sent).code?(r=t.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),n=ce(r),K((function(e){return i()(i()({},e),{},{ollama:n})})),L&&L("ollama",n)):f.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),f.yw.error(O.formatMessage({id:"error"}));case 11:return e.prev=11,f.yw.destroy("modelLoading"),le(!1),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,7,11,15]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=u()(l()().mark((function e(t){var r,n,o,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:50,providerUid:null==t?void 0:t.uid,orgUid:E,level:h.whQ},e.next=4,(0,m.LF)(r);case 4:200===(n=e.sent).code?(o=n.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:t.name}})),s=ce(o),K((function(e){return i()(i()({},e),{},a()({},t.name,s))})),L&&L(t.name,s)):f.yw.error(n.message),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),f.yw.error(O.formatMessage({id:"error"}));case 12:return e.prev=12,f.yw.destroy("modelLoading"),le(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[0,8,12,16]])})));return function(t){return e.apply(this,arguments)}}(),ge=(0,I.useCallback)((function(e,t){W(e),ee(t.value),ae(t.label)}),[]),ve=(0,I.useCallback)((function(e){if(D(e),!R[e]&&!se){le(!0),f.yw.loading({content:O.formatMessage({id:"loading"}),key:"modelLoading"});var t=T.find((function(t){return t.name===e}));t&&("ollama"===t.name?pe():me(t))}}),[T,R,se]),he=I.memo((function(e){var t=e.model,r=e.providerName;return(0,C.jsxs)(M.Z,{hoverable:!0,style:{cursor:"pointer",border:X===t.value&&J===r?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return ge(r,t)},children:[(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,C.jsx)(y.Z.Title,{level:5,style:{margin:0},children:t.label}),(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[t.type&&(0,C.jsx)("div",{style:{marginBottom:8},children:(0,x.Rb)(t.type)}),X===t.value&&J===r&&(0,C.jsx)(b.Z,{status:"processing",text:"已选"})]})]}),t.description&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(y.Z.Text,{type:"secondary",children:null==t?void 0:t.value}),(0,C.jsx)(y.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:t.description})]})]},t.value)}),(function(e,t){return e.model.value===t.model.value&&e.providerName===t.providerName&&(X===e.model.value&&J===e.providerName)===(X===t.model.value&&J===t.providerName)})),xe=(0,I.useMemo)((function(){return T.map((function(e){var t,r;return{key:e.name,label:V(e.nickname),children:(0,C.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,C.jsxs)(w.Z,{direction:"vertical",style:{width:"100%"},children:[se&&N===e.name&&!R[e.name]?(0,C.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,C.jsx)(P,{type:"secondary",children:"加载模型中..."})}):(!R[e.name]||0===(null===(t=R[e.name])||void 0===t?void 0:t.length))&&(0,C.jsx)(P,{type:"secondary",children:"暂无可用模型"}),(0,C.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(r=R[e.name])||void 0===r?void 0:r.map((function(t){return(0,C.jsx)(he,{model:t,providerName:e.name},t.value)}))})]})})}}))}),[T,R,N,se,X,J,V]);return(0,C.jsx)(k.Z,{title:"选择AI模型",open:r,onClose:n,width:700,destroyOnClose:!1,footer:(0,C.jsxs)("div",{style:{textAlign:"right"},children:[(0,C.jsx)(j.ZP,{onClick:n,style:{marginRight:8},children:"取消"}),(0,C.jsx)(j.ZP,{onClick:de,type:"primary",children:"确定"})]}),children:T.length>0&&(0,C.jsx)(S.Z,{activeKey:N||(null===(t=T[0])||void 0===t?void 0:t.name),onChange:ve,items:xe,destroyInactiveTabPane:!1})})}),(function(e,t){return e.visible===t.visible&&e.initialProvider===t.initialProvider&&e.initialModel===t.initialModel&&e.initialModelLabel===t.initialModelLabel}));t.Z=T},67857:function(e,t,r){r.d(t,{Z:function(){return X}});var n=r(84176),a=r.n(n),o=r(73193),i=r.n(o),s=r(90819),l=r.n(s),d=r(89933),u=r.n(d),c=r(45332),p=r.n(c),f=r(44194),m=r(53530),g=r(98036),v=r(75365),h=r(96485),x=r(86803),y=r(66916),M=r(30921),b=r(55735),w=r(90838),k=r(10154),j=r.n(k),S=r(40612),Z=r(69169),I=r(84881),C=r(4499),P=r(32350),T=r(32327),E=r(73442),U=r(3849),A=r(84288),L=r(62673),z=r(6631),F=r(59908),O=r(76750),V=r(40679),q=r(36605),B=r(31549),N=T.Z.Text,D=function(e){var t,r,n=e.isEdit,a=e.robot,o=e.open,s=e.level,d=e.onClose,c=e.onSubmit,m=Z.A.useForm(),g=p()(m,1)[0],h=(0,M.useIntl)(),y=(0,S.u)((function(e){return e.currentOrg})),k=(0,f.useState)("https://cdn.weiyuai.cn/assets/images/llm/provider/zhipu.png"),T=p()(k,2),D=T[0],H=(T[1],(0,f.useState)()),Y=p()(H,2),R=Y[0],K=Y[1],Q=(0,w.v)((function(e){return e.categoryResult})),G=(0,O.Z)(),J=G.translateString,W=(G.translateStringTranct,(0,f.useState)(!1)),$=p()(W,2),_=$[0],X=$[1],ee=(0,f.useState)([]),te=p()(ee,2),re=te[0],ne=te[1],ae=(0,f.useState)({}),oe=p()(ae,2),ie=oe[0],se=oe[1],le=(0,f.useState)(!1),de=p()(le,2),ue=de[0],ce=de[1],pe=(0,f.useState)(""),fe=p()(pe,2),me=fe[0],ge=fe[1],ve=(0,f.useState)(""),he=p()(ve,2),xe=he[0],ye=he[1],Me=(0,f.useState)(""),be=p()(Me,2),we=be[0],ke=be[1];(0,f.useEffect)((function(){if(n&&a&&g){var e,t,r,o,i,s;g.setFieldsValue({uid:null==a?void 0:a.uid,nickname:null==a?void 0:a.nickname,name:null==a?void 0:a.name,prompt:null==a||null===(e=a.llm)||void 0===e?void 0:e.prompt,description:null==a?void 0:a.description,categoryUid:null==a?void 0:a.categoryUid,provider:null==a||null===(t=a.llm)||void 0===t?void 0:t.provider,model:null==a||null===(r=a.llm)||void 0===r?void 0:r.model});var l=null==Q||null===(o=Q.data)||void 0===o||null===(o=o.content)||void 0===o?void 0:o.find((function(e){return e.uid===(null==a?void 0:a.categoryUid)}));K(l),ge((null==a||null===(i=a.llm)||void 0===i?void 0:i.provider)||""),ye((null==a||null===(s=a.llm)||void 0===s?void 0:s.model)||""),X((null==a?void 0:a.system)||!1)}else console.log("form resetFields"),g.resetFields(),ge(""),ye(""),ke(""),X(!1);je()}),[a]);var je=function(){var e=u()(l()().mark((function e(){var t,r,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:100,sortBy:"createdAt",sortDirection:"ascend",orgUid:null==y?void 0:y.uid,level:b.whQ},e.next=4,(0,q.mK)(t);case 4:200===(r=e.sent).code?(n=r.data.content||[],ne(n)):x.yw.error(r.message),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),Se=(0,f.useCallback)((function(){ce(!0)}),[]),Ze=(0,f.useCallback)((function(){ce(!1)}),[]),Ie=(0,f.useCallback)((function(e,t,r){ge(e),ye(t),ke(r),g.setFieldValue("provider",e),g.setFieldValue("model",t),ce(!1)}),[g]),Ce=(0,f.useCallback)((function(e,t){se((function(r){return i()(i()({},r),{},j()({},e,t))}))}),[]);(0,f.useEffect)((function(){}),[a]);return(0,B.jsx)("div",{children:(0,B.jsxs)(E.Z,{title:n?"编辑提示语":"新建提示语",width:650,onClose:d,open:o,extra:(0,B.jsxs)(U.Z,{children:[(0,B.jsx)(v.ZP,{onClick:d,children:"取消"}),(0,B.jsx)(v.ZP,{onClick:function(){console.log("handleSubmit"),g.validateFields().then((function(e){console.log("Form values:",e);var t={uid:n?null==a?void 0:a.uid:"",nickname:e.nickname,name:e.name,avatar:D,categoryUid:null==R?void 0:R.uid,llm:{prompt:e.prompt,provider:e.provider,model:e.model},description:e.description,type:b.Qeb,level:s,orgUid:null==y?void 0:y.uid};console.log("robotObject:",t),c(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:[(0,B.jsxs)(Z.A,{form:g,name:"model",submitter:!1,children:[(0,B.jsx)(I.Z,{label:"类别",name:"categoryUid",required:!0,options:null==Q||null===(t=Q.data)||void 0===t||null===(t=t.content)||void 0===t||null===(t=t.filter((function(e){return e.uid!==b.zBg})))||void 0===t?void 0:t.map((function(e){return{label:J(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),K(null==Q||null===(t=Q.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,B.jsx)(C.Z,{label:"昵称",name:"nickname",required:!0,tooltip:"显示给用户的名称"}),(0,B.jsx)(C.Z,{label:"名称",name:"name",tooltip:"内部识别使用的名称",disabled:_,fieldProps:{placeholder:_?"系统代理不可修改名称":"请输入名称"}}),_&&(0,B.jsx)("div",{style:{color:"#ff4d4f",fontSize:"12px",marginTop:"-20px",marginBottom:"10px"},children:"系统内置代理，无法修改名称"}),(0,B.jsx)(Z.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:h.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,B.jsxs)(z.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e)},onError:function(e){console.log("handleUploadError:",e),x.yw.error(e)},children:[(0,B.jsx)(A.C,{src:D}),(0,B.jsx)(v.ZP,{icon:(0,B.jsx)(F.Z,{}),children:h.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,B.jsxs)("div",{children:[(0,B.jsx)(N,{style:{marginBottom:"8px",display:"block"},children:"文字对话模型提供商"}),(0,B.jsx)(L.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9",marginBottom:"16px"},onClick:Se,children:me&&xe?(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,B.jsxs)("div",{children:[(0,B.jsx)(N,{type:"secondary",children:"供应商："}),(0,B.jsx)(N,{strong:!0,children:J((null===(r=re.find((function(e){return e.name===me})))||void 0===r?void 0:r.nickname)||me)}),(0,B.jsx)("br",{}),(0,B.jsx)(N,{type:"secondary",children:"模型："}),(0,B.jsx)(N,{strong:!0,children:we||xe})]}),(0,B.jsx)(v.ZP,{type:"primary",children:"更换模型"})]}):(0,B.jsx)("div",{style:{textAlign:"center"},children:(0,B.jsx)(v.ZP,{type:"primary",children:"选择AI模型"})})}),(0,B.jsxs)("div",{style:{display:"none"},children:[(0,B.jsx)(I.Z,{name:"provider",width:"lg"}),(0,B.jsx)(I.Z,{name:"model",width:"lg"})]})]}),(0,B.jsx)(P.Z,{label:"提示语Prompt",name:"prompt",required:!0}),(0,B.jsx)(P.Z,{label:"简介描述",name:"description"})]}),(0,B.jsx)(V.Z,{visible:ue,onCancel:Ze,onOk:Ie,initialProvider:me,initialModel:xe,initialModelLabel:we,providers:re,currentOrgUid:null==y?void 0:y.uid,existingProviderModels:ie,onModelsLoaded:Ce,allowedModelTypes:[b.JiM]})]})})},H=r(15722),Y=r(7358),R=r(10162),K=r(11090),Q=r(2484),G=r(48524),J=r(28977),W=r.n(J),$=r(36310),_=["current","pageSize","prompt"],X=function(e){var t=e.level,r=(e.type,(0,f.useRef)()),n=(0,M.useIntl)(),o=(0,f.useState)(!0),s=p()(o,2),d=s[0],c=s[1],k=(0,O.Z)().translateString,j=(0,f.useState)(1),Z=p()(j,2),I=Z[0],C=Z[1],P=(0,f.useState)(10),T=p()(P,2),E=T[0],U=T[1],A=(0,f.useState)(!1),L=p()(A,2),z=L[0],F=L[1],V=(0,f.useState)([]),q=p()(V,2),N=(q[0],q[1]),J=(0,f.useState)({}),X=p()(J,2),ee=X[0],te=X[1],re=(0,w.v)((function(e){return e.currentCategory})),ne=(0,S.u)((function(e){return e.currentOrg})),ae=m.Z.useModal(),oe=p()(ae,2),ie=oe[0],se=oe[1],le=(0,f.useState)(0),de=p()(le,2),ue=de[0],ce=de[1],pe=(0,f.useState)({}),fe=p()(pe,2),me=fe[0],ge=fe[1],ve=function(){var e=u()(l()().mark((function e(t){var a,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,y.gf)(t);case 3:200===(a=e.sent).code?(x.yw.destroy(),x.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(o=r.current)||void 0===o||o.reload()):(x.yw.destroy(),x.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=u()(l()().mark((function e(t){var a,o,i,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=8;break}return x.yw.loading(n.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,y.JT)(t);case 4:200===(a=e.sent).code?(x.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(o=r.current)||void 0===o||o.reload(),F(!1)):x.yw.error(a.message),e.next=13;break;case 8:return x.yw.loading(n.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,y.s9)(t);case 11:200===(i=e.sent).code?(x.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(s=r.current)||void 0===s||s.reload(),F(!1)):x.yw.error(i.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.reload()}),[re]);var xe=function(){var e=u()(l()().mark((function e(r,n,a){var o,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,n,a),o=localStorage.getItem(b.LA8),s=i()({categoryUid:(null==re?void 0:re.uid)===b.zBg?"":null==re?void 0:re.uid,orgUid:t===b.Hxq?"":null==ne?void 0:ne.uid,level:t,type:b.Qeb,accessToken:o||"",exportType:r},me),"current"===r?(s.pageNumber=String(I-1),s.pageSize=String(E)):"all"===r?(s.pageNumber="0",s.pageSize="1000"):"range"===r&&void 0!==n&&void 0!==a&&(s.pageNumber=String(n),s.pageSize=String(a)),window.open((0,$.kG)()+"/api/v1/robot/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],r=1e3,n=Math.ceil(e/r),a=function(){var n=o,a=o*r+1,i=Math.min((o+1)*r,e);t.push({key:"export-".concat(o),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return xe("range",n,r)}})},o=0;o<n;o++)a();return t},Me=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"pages.prompt.nickname",defaultMessage:"昵称"}),dataIndex:"nickname",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.prompt.nickname.tooltip",defaultMessage:"代理的昵称，用于展示"})},{title:n.formatMessage({id:"pages.prompt.name",defaultMessage:"名称"}),dataIndex:"name",width:200,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.prompt.name.tooltip",defaultMessage:"代理的名称，用于内部识别"})},{title:n.formatMessage({id:"pages.prompt.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:n.formatMessage({id:"pages.prompt.description.tooltip",defaultMessage:"代理的功能描述"})},{title:n.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),dataIndex:"prompt",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:n.formatMessage({id:"pages.prompt.prompt.tooltip",defaultMessage:"传递给模型的指令和上下文"}),render:function(e,t){var r,a=(null===(r=t.llm)||void 0===r?void 0:r.prompt)||"-";return(0,B.jsx)(g.Z,{content:(0,B.jsxs)("div",{children:[(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,B.jsx)("span",{children:n.formatMessage({id:"pages.prompt.prompt.content",defaultMessage:"提示词内容"})}),(0,B.jsx)(v.ZP,{type:"text",icon:(0,B.jsx)(Y.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=a,navigator.clipboard.writeText(t).then((function(){x.yw.success(n.formatMessage({id:"copy.success",defaultMessage:"复制成功"}))}),(function(e){console.error("复制失败: ",e),x.yw.error(n.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}))}))},title:n.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,B.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:n.formatMessage({id:"pages.prompt.prompt",defaultMessage:"提示词"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,B.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:n.formatMessage({id:"pages.prompt.provider",defaultMessage:"提供商"}),dataIndex:["llm","provider"],hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.provider.tooltip",defaultMessage:"模型提供商"})},{title:n.formatMessage({id:"pages.prompt.model",defaultMessage:"模型"}),dataIndex:["llm","model"],hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"pages.prompt.model.tooltip",defaultMessage:"使用的大语言模型"})},{title:n.formatMessage({id:"pages.prompt.visionEnabled",defaultMessage:"视觉模型启用"}),dataIndex:["llm","visionEnabled"],hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.visionEnabled.tooltip",defaultMessage:"是否启用视觉模型功能"}),render:function(e,t){var r;return null!==(r=t.llm)&&void 0!==r&&r.visionEnabled?"是":"否"}},{title:n.formatMessage({id:"pages.prompt.visionProvider",defaultMessage:"视觉提供商"}),dataIndex:["llm","visionProvider"],hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.visionProvider.tooltip",defaultMessage:"视觉模型的服务提供商"}),render:function(e,t){var r;return(null===(r=t.llm)||void 0===r?void 0:r.visionProvider)||"-"}},{title:n.formatMessage({id:"pages.prompt.visionModel",defaultMessage:"视觉模型"}),dataIndex:["llm","visionModel"],hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"pages.prompt.visionModel.tooltip",defaultMessage:"使用的视觉模型名称"}),render:function(e,t){var r;return(null===(r=t.llm)||void 0===r?void 0:r.visionModel)||"-"}},{title:n.formatMessage({id:"pages.prompt.speechEnabled",defaultMessage:"语音模型启用"}),dataIndex:["llm","speechEnabled"],hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.speechEnabled.tooltip",defaultMessage:"是否启用语音模型功能"}),render:function(e,t){var r;return null!==(r=t.llm)&&void 0!==r&&r.speechEnabled?"是":"否"}},{title:n.formatMessage({id:"pages.prompt.speechProvider",defaultMessage:"语音提供商"}),dataIndex:["llm","speechProvider"],hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.speechProvider.tooltip",defaultMessage:"语音模型的服务提供商"}),render:function(e,t){var r;return(null===(r=t.llm)||void 0===r?void 0:r.speechProvider)||"-"}},{title:n.formatMessage({id:"pages.prompt.speechModel",defaultMessage:"语音模型"}),dataIndex:["llm","speechModel"],hideInSearch:!0,width:150,tooltip:n.formatMessage({id:"pages.prompt.speechModel.tooltip",defaultMessage:"使用的语音模型名称"}),render:function(e,t){var r;return(null===(r=t.llm)||void 0===r?void 0:r.speechModel)||"-"}},{title:n.formatMessage({id:"pages.prompt.temperature",defaultMessage:"温度"}),dataIndex:["llm","temperature"],hideInSearch:!0,width:80,tooltip:n.formatMessage({id:"pages.prompt.temperature.tooltip",defaultMessage:"控制输出的随机性，值越高输出越随机创新"}),render:function(e,t){var r,n;return 0===(null===(r=t.llm)||void 0===r?void 0:r.temperature)?"0":(null===(n=t.llm)||void 0===n?void 0:n.temperature)||"-"}},{title:n.formatMessage({id:"pages.prompt.topK",defaultMessage:"Top K"}),dataIndex:["llm","topK"],hideInSearch:!0,width:80,tooltip:n.formatMessage({id:"pages.prompt.topK.tooltip",defaultMessage:"检索时返回的相关文档数量"}),render:function(e,t){var r;return(null===(r=t.llm)||void 0===r?void 0:r.topK)||"-"}},{title:n.formatMessage({id:"pages.prompt.system",defaultMessage:"系统"}),dataIndex:"system",hideInSearch:!0,width:80,tooltip:n.formatMessage({id:"pages.prompt.system.tooltip",defaultMessage:"是否为系统内置代理"}),render:function(e,t){return t.system?"是":"否"}},{title:n.formatMessage({id:"pages.prompt.kbEnabled",defaultMessage:"知识库启用"}),dataIndex:"kbEnabled",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.kbEnabled.tooltip",defaultMessage:"是否启用知识库增强功能"}),render:function(e,t){return t.kbEnabled?"是":"否"}},{title:n.formatMessage({id:"pages.prompt.flowEnabled",defaultMessage:"流程启用"}),dataIndex:"flowEnabled",hideInSearch:!0,width:120,tooltip:n.formatMessage({id:"pages.prompt.flowEnabled.tooltip",defaultMessage:"是否启用流程控制功能"}),render:function(e,t){return t.flowEnabled?"是":"否"}},{title:n.formatMessage({id:"pages.prompt.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:n.formatMessage({id:"pages.prompt.createdAt.tooltip",defaultMessage:"代理创建的时间"}),render:function(e,t){return t.createdAt?W()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"pages.prompt.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:n.formatMessage({id:"pages.prompt.updatedAt.tooltip",defaultMessage:"代理最后更新的时间"}),render:function(e,t){return t.updatedAt?W()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:n.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:n.formatMessage({id:"pages.prompt.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){var r;return[(0,B.jsx)("a",{onClick:function(){return function(e){c(!0),te(e),F(!0)}(t)},children:n.formatMessage({id:"pages.robot.edit",defaultMessage:"Edit"})},"edit"),!(null!=t&&null!==(r=t.uid)&&void 0!==r&&r.includes("void_agent"))&&(0,B.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,B.jsx)(H.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(k(e.nickname),"】？"),onOk:function(){ve(e)},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e},children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")]}}],be=function(){var e=u()(l()().mark((function e(r,o,s){var d,u,c,p,f,m,g,v,h;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),d=r.current,u=r.pageSize,c=r.prompt,p=a()(r,_),C(d),U(u),ge(i()(i()({},p),{},{prompt:c})),f=void 0,m=void 0,o&&Object.keys(o).length>0&&(g=Object.keys(o)[0],f=g,m="ascend"===o[g]?"ascend":"descend"),v=i()(i()({pageNumber:d-1,pageSize:u,nickname:"",orgUid:t===b.Hxq?"":null==ne?void 0:ne.uid,categoryUid:(null==re?void 0:re.uid)===b.zBg?"":null==re?void 0:re.uid,type:b.Qeb,level:t},p),{},{prompt:c,sortBy:f,sortDirection:m}),e.next=11,(0,y.p0)(v);case 11:if(h=e.sent,console.log("queryRobotsByOrg response:",h,v),200!==h.code){e.next=20;break}return x.yw.destroy(),N(h.data.content),ce(h.data.totalElements),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 20:return x.yw.destroy(),x.yw.error(h.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(G.Z,{columns:Me,actionRef:r,cardBordered:!0,rowKey:"uid",scroll:{x:2400},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){C(e),U(t)}},dateFormatter:"string",headerTitle:n.formatMessage({id:"pages.prompt.list",defaultMessage:"提示语列表"}),toolBarRender:function(){var e=[(0,B.jsx)(v.ZP,{type:"primary",onClick:function(){c(!1),te({}),F(!0)},icon:(0,B.jsx)(R.Z,{}),children:n.formatMessage({id:"pages.prompt.create",defaultMessage:"添加提示语"})},"create")],t=[{key:"export-current",icon:(0,B.jsx)(K.Z,{}),label:n.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xe("current")}}];return ue>0&&(ue<=1e3?t.push({key:"export-all",icon:(0,B.jsx)(K.Z,{}),label:n.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ue,"条)"),onClick:function(){return xe("all")}}):t.push({key:"export-range",icon:(0,B.jsx)(K.Z,{}),label:n.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ue,"条)"),children:ye(ue)})),e.push((0,B.jsx)(h.Z,{menu:{items:t},placement:"bottom",children:(0,B.jsxs)(v.ZP,{type:"primary",icon:(0,B.jsx)(K.Z,{}),children:[n.formatMessage({id:"export",defaultMessage:"导出"}),(0,B.jsx)(Q.Z,{})]})},"export")),e},request:be}),z&&(0,B.jsx)(D,{isEdit:d,robot:ee,level:t,open:z,onClose:function(){return F(!1)},onSubmit:he}),se]})}},6631:function(e,t,r){r.d(t,{G:function(){return p}});var n=r(73193),a=r.n(n),o=(r(44194),r(30348)),i=r(55735),s=r(28977),l=r.n(s),d=r(86803),u=r(36310),c=r(31549),p=function(e){var t=e.children,r=e.onSuccess,n=e.onError,s={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",client:i.bVn},p={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:s,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return s.file=e,s.fileName=t,s.fileType=e.type,console.log("beforeUpload",s),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;r(t),d.yw.success("".concat(e.file.name," 上传成功"))}else n(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),n(e.file))}};return(0,c.jsx)(o.Z,a()(a()({},p),{},{children:t}))}}}]);