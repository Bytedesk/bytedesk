"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9828],{58087:function(e,t,n){var r=n(83910),a=n(44194),s=n(15323),i=n(54183),o=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:s.Z}))},u=a.forwardRef(o);t.Z=u},49906:function(e,t,n){var r=n(94433),a=n(38956),s=n(51997),i=n(79369),o=n(44194),u=n(88116),l=n(35074),d=n(31549),c=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],g=o.forwardRef((function(e,t){var n=e.fieldProps,i=e.options,o=e.radioType,u=e.layout,g=e.proFieldProps,f=e.valueEnum,p=(0,a.Z)(e,c);return(0,d.jsx)(l.Z,(0,r.Z)((0,r.Z)({valueType:"button"===o?"radioButton":"radio",ref:t,valueEnum:(0,s.h)(f,void 0)},p),{},{fieldProps:(0,r.Z)({options:i,layout:u},n),proFieldProps:g,filedConfig:{customLightMode:!0}}))})),f=o.forwardRef((function(e,t){var n=e.fieldProps,a=e.children;return(0,d.jsx)(i.ZP,(0,r.Z)((0,r.Z)({},n),{},{ref:t,children:a}))})),p=(0,u.G)(f,{valuePropName:"checked",ignoreWidth:!0});p.Group=g,p.Button=i.ZP.Button,p.displayName="ProFormComponent",t.Z=p},11293:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return m},Gv:function(){return k},bD:function(){return f},mE:function(){return M},nQ:function(){return y},nU:function(){return h},oX:function(){return j}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),o=n(89933),u=n.n(o),l=n(14906),d=n(39497);function c(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,r=t.workgroupUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(r),{method:"GET",params:{channel:d.XtJ}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return w.apply(this,arguments)}function w(){return(w=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return S.apply(this,arguments)}function S(){return(S=u()(a()().mark((function e(t,n){var r,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,s=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(r,"/orgs/").concat(s,"/bindings"),{method:"POST",data:i()(i()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return C.apply(this,arguments)}function C(){return(C=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},56845:function(e,t,n){n.r(t),n.d(t,{default:function(){return qe}});var r=n(44194),a=n(67738),s=n(14906),i=n(76711),o=n.n(i),u=n(90819),l=n.n(u),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),p=n(45332),m=n.n(p),v=n(77033),h=n(82770),x=n(39487),k=n(32525),w=n(50716),M=n(92354),b=n(81739),y=n(66431),S=n(63649),j=n(29337),C=n(68779),Z=n(12322),F=n(58087),R=n(56482),T=n(83910),U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},P=n(54183),I=function(e,t){return r.createElement(P.Z,(0,T.Z)({},e,{ref:t,icon:U}))};var q=r.forwardRef(I),W=n(10162),O=n(90727),E=n(59304),z=n(54881),A=n(47944),D=n(80556),L=n(55785),N=n(49764),B=n(19433),V=n(43167),J=n(98830),H=n(75112),X=n(14597),G=n(99665),Q=n(66547),K=(n(84262),n(94212),n(24479),n(90631)),_=n(1460),Y=(n(417),n(41196)),$=n(86895),ee=n(31549),te=function(e){var t=e.open,n=e.onOpenChange,a=e.orgUid,i=e.record,o=e.onSuccess,u=(0,s.useIntl)(),d=Y.Z.useForm(),g=m()(d,1)[0];(0,r.useEffect)((function(){var e,n;t&&(i?g.setFieldsValue({name:i.name||"",description:i.description||"",enabled:null===(e=i.enabled)||void 0===e||e,isDefault:null!==(n=i.isDefault)&&void 0!==n&&n}):(g.resetFields(),g.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,i,g]);var p=function(){var e=c()(l()().mark((function e(){var t,r,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.validateFields();case 3:if(t=e.sent,r=f()(f()({},t),{},{orgUid:a,uid:null==i?void 0:i.uid}),null==i||!i.uid){e.next=11;break}return e.next=8,(0,V.Y2)(r);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,V.jT)(r);case 13:e.t0=e.sent;case 14:(s=e.t0)&&200===s.code?(B.yw.success(u.formatMessage({id:null!=i&&i.uid?"common.updated":"common.created",defaultMessage:null!=i&&i.uid?"更新成功":"创建成功"})),null==o||o(),n(!1)):B.yw.error((null==s?void 0:s.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving workgroup settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,ee.jsx)($.Z,{title:(0,ee.jsx)(s.FormattedMessage,{id:null!=i&&i.uid?"workgroup.settings.template.edit":"workgroup.settings.template.create",defaultMessage:null!=i&&i.uid?"编辑模板":"新建模板"}),open:t,onOk:p,onCancel:function(){return n(!1)},okText:(0,ee.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,ee.jsx)(s.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,ee.jsxs)(Y.Z,{form:g,layout:"vertical",preserve:!1,children:[(0,ee.jsx)(Y.Z.Item,{name:"name",label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:u.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,ee.jsx)(k.Z,{placeholder:u.formatMessage({id:"workgroup.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,ee.jsx)(Y.Z.Item,{name:"description",label:(0,ee.jsx)(s.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,ee.jsx)(k.Z.TextArea,{rows:3,placeholder:u.formatMessage({id:"workgroup.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,ee.jsx)(Y.Z.Item,{name:"enabled",label:(0,ee.jsx)(s.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,ee.jsx)(y.Z,{})})]})})},ne=n(27153),re=n(75580),ae=n(91361),se=n(39497),ie=n(25784),oe=n(10434),ue=n(2250),le=function(e){var t=e.variant,n=e.robotRoutingSettings,a=e.onRobotRoutingSettingsChange,s=ie.A.useForm(),i=m()(s,1)[0],o=(0,r.useRef)(!1),u=(0,r.useState)([]),d=m()(u,2),g=d[0],f=d[1],p=(0,J.u)((function(e){return e.currentOrg})),v=(0,ae.Z)().translateString,h=(0,r.useMemo)((function(){var e;return null!==(e=null==n?void 0:n.draft)&&void 0!==e?e:null==n?void 0:n.live}),[n]);(0,r.useEffect)((function(){var e,n;if("workgroup"===t){var r=null!==(e=null==h?void 0:h.robotUid)&&void 0!==e?e:null==h||null===(n=h.robot)||void 0===n?void 0:n.uid;i.setFieldsValue({defaultRobot:null==h?void 0:h.defaultRobot,offlineRobot:null==h?void 0:h.offlineRobot,nonWorktimeRobot:null==h?void 0:h.nonWorktimeRobot,robotUid:r})}}),[t,h,i]);var x=function(){var e=c()(l()().mark((function e(){var t,n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.current){e.next=3;break}return console.log("isLoading: 1",o.current),e.abrupt("return");case 3:return o.current=!0,B.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:se.f4h,orgUid:null==p?void 0:p.uid},e.next=8,(0,re.p0)(t);case 8:n=e.sent,console.log("queryRobotsByOrg: ",n),200===n.code?f(null===(r=n.data)||void 0===r?void 0:r.content):B.yw.error(n.message),o.current=!1,B.yw.destroy();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,r.useEffect)((function(){x()}),[]),(0,ee.jsx)(ie.A,{form:i,style:{marginLeft:"20px"},submitter:!1,children:"workgroup"===t&&(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(oe.Z,{name:"defaultRobot",width:"md",label:"默认启用机器人",fieldProps:{onChange:function(e){var t;return null==a?void 0:a({defaultRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),(0,ee.jsx)(oe.Z,{name:"offlineRobot",width:"md",label:"无客服在线时启用机器人",fieldProps:{onChange:function(e){var t;return null==a?void 0:a({offlineRobot:!(null==e||null===(t=e.target)||void 0===t||!t.checked)})}}}),!1,(0,ee.jsx)(ue.Z,{name:"robotUid",label:"客服机器人",width:"md",options:g.map((function(e){return{value:e.uid,label:v(e.nickname)}})),fieldProps:{allowClear:!0,placeholder:"请选择客服机器人",onChange:function(e){null==a||a({robotUid:null!=e?e:void 0})}}})]})})},de=(n(52260),n(49906)),ce=function(){var e=Y.Z.useForm(),t=m()(e,1)[0],n=(0,s.useIntl)(),a=(0,G.z)((function(e){return{currentWorkgroupSettings:e.currentWorkgroupSettings,setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings}})),i=a.currentWorkgroupSettings,o=a.setCurrentWorkgroupSettings,u=(0,r.useState)(se.vXk),l=m()(u,2),d=l[0],c=l[1];(0,r.useEffect)((function(){if(i){var e=i;c(e.routingMode),t.setFieldValue("routingMode",e.routingMode)}}),[i]);return(0,ee.jsx)("div",{children:(0,ee.jsxs)(ie.A,{form:t,submitter:!1,children:[(0,ee.jsx)(de.Z.Group,{name:"routingMode",label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.type",defaultMessage:"Route Type"}),options:[{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.roundRobin",defaultMessage:"Round Robin"}),value:se.vXk},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.leastActive",defaultMessage:"Least Active"}),value:se.ZD$},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.random",defaultMessage:"Random"}),value:se.owQ},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.weightedRandom",defaultMessage:"Weighted Random"}),value:se.e2F},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.consistentHash",defaultMessage:"Consistent Hash"}),value:se.zWk},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.fastestResponse",defaultMessage:"Fastest Response"}),value:se.HQF},{label:(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.route.recent",defaultMessage:"Recent"}),value:se.WDq}],fieldProps:{value:d,onChange:function(e){var t;!function(e){console.log("radio checked",e.target.value),c(e.target.value)}(e),t=e.target.value,i&&o(f()(f()({},i),{},{routingMode:t}))}}}),(0,ee.jsxs)(ie.A.Item,{children:[d===se.vXk&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.roundRobin.desc"})}),d===se.ZD$&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.leastActive.desc"})}),d===se.owQ&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.random.desc"})}),d===se.e2F&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.weightedRandom.desc"})}),d===se.zWk&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.consistentHash.desc"})}),d===se.HQF&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.fastestResponse.desc"})}),d===se.JEC&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.broadcast.desc"})}),d===se.WDq&&(0,ee.jsx)("p",{children:n.formatMessage({id:"workgroup.route.recent.desc"})})]})]})})},ge="tips",fe=function(){var e=(0,s.useIntl)(),t=(0,J.u)((function(e){return e.currentOrg})),n=(0,H.Z)().leftSiderStyle,i=(0,X.Z)().isDarkMode,u=(0,r.useState)(!1),d=m()(u,2),g=d[0],p=d[1],T=(0,r.useState)([]),U=m()(T,2),P=U[0],I=U[1],Y=(0,r.useState)(),$=m()(Y,2),re=$[0],ae=$[1],se=(0,r.useState)(""),ie=m()(se,2),oe=ie[0],ue=ie[1],de=(0,r.useState)(ge),fe=m()(de,2),pe=fe[0],me=fe[1],ve=(0,r.useState)(!1),he=m()(ve,2),xe=he[0],ke=he[1],we=(0,r.useState)(null),Me=m()(we,2),be=Me[0],ye=Me[1],Se=(0,r.useMemo)((function(){return P.find((function(e){return e.uid===re}))||null}),[P,re]),je=(0,r.useState)(!1),Ce=m()(je,2),Ze=Ce[0],Fe=Ce[1],Re=(0,r.useState)(!1),Te=m()(Re,2),Ue=Te[0],Pe=Te[1],Ie=(0,r.useState)(!1),qe=m()(Ie,2),We=qe[0],Oe=qe[1],Ee=(0,r.useRef)(""),ze=(0,G.z)((function(e){return{setCurrentWorkgroupSettings:e.setCurrentWorkgroupSettings,currentWorkgroupSettings:e.currentWorkgroupSettings}})),Ae=ze.setCurrentWorkgroupSettings,De=ze.currentWorkgroupSettings,Le=(0,r.useMemo)((function(){var e;return null!==(e=null!=De?De:Se)&&void 0!==e?e:null}),[De,Se]),Ne=(0,r.useCallback)((function(e){if(De){var t=De.draftServiceSettings||De.serviceSettings||{};Ae(f()(f()({},De),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[De,Ae]),Be=(0,r.useCallback)((function(e){if(De){var t=De.draftInviteSettings||De.inviteSettings||{};Ae(f()(f()({},De),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[De,Ae]),Ve=(0,r.useCallback)((function(e){if(De){var t=De.draftMessageLeaveSettings||De.messageLeaveSettings||{};Ae(f()(f()({},De),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[De,Ae]),Je=(0,r.useCallback)((function(e){if(De){var t=De.draftWorktimeSettings||De.worktimeSettings||{};Ae(f()(f()({},De),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[De,Ae]),He=(0,r.useCallback)((function(e){if(De){var t=De.draftRobotRoutingSettings||De.robotRoutingSettings||{};Ae(f()(f()({},De),{},{draftRobotRoutingSettings:f()(f()({},t),e)}))}}),[De,Ae]),Xe=(0,r.useMemo)((function(){if(!oe)return P;var e=oe.toLowerCase();return P.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),r=(t.description||"").toLowerCase();return n.includes(e)||r.includes(e)}))}),[P,oe]),Ge=(0,r.useCallback)(function(){var e=c()(l()().mark((function e(n,r){var a,s,i,o,u;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return p(!0),e.prev=3,s=(null!=n?n:"").trim(),i={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=8,(0,V.zc)(i);case 8:o=e.sent,console.log("加载工作组配置模板列表: ",o,i),u=(null==o||null===(a=o.data)||void 0===a?void 0:a.content)||[],I(u),!(u.length>0)||re&&u.some((function(e){return e.uid===re}))||(ae(u[0].uid),null!=r&&r.keepActive||me(ge));case 13:return e.prev=13,p(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,re]),Qe=(0,r.useCallback)((function(e){Ge(null!=e?e:oe)}),[Ge,oe]);(0,r.useEffect)((function(){Ge(oe)}),[null==t?void 0:t.uid]),(0,r.useEffect)((function(){Se?(Ae(Se),Ee.current=JSON.stringify(null!=Se?Se:{}),Oe(!1)):(Ae(null),Ee.current=JSON.stringify({}),Oe(!1))}),[null==Se?void 0:Se.uid]),(0,r.useEffect)((function(){if(Se)try{var e=JSON.stringify(null!=De?De:{});Oe(e!==Ee.current)}catch(e){Oe(!0)}}),[De,null==Se?void 0:Se.uid]);var Ke=function(){var n=c()(l()().mark((function n(r){var a,s,i;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=r?r:Se)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,V.zN)(s);case 6:(i=n.sent)&&200===i.code?(B.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Ge(oe)):B.yw.error((null==i?void 0:i.message)||"删除失败");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),_e=function(){var n=c()(l()().mark((function n(r,a){var s;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,V.Y2)({uid:r,orgUid:null==t?void 0:t.uid,enabled:a});case 3:(s=n.sent)&&200===s.code?(B.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),Ge(oe)):B.yw.error((null==s?void 0:s.message)||"操作失败"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("切换启用状态失败:",n.t0),B.yw.error("操作失败");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}(),Ye=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},$e=function(e){if(e){var t=Ye(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(e){if(e)return Ye(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),n?{toolbar:n}:{})}},et=function(e){if(e)return Ye(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},tt=function(e){if(e)return Ye(e,["name","description","color","order"])},nt=function(e){if(e)return Ye(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},rt=function(e){if(e)return Ye(e,["queueRobot","maxWaiting","maxWaitTime","queueTip"])},at=function(e){var t,n;if(e){var r=Ye(e,["defaultRobot","offlineRobot","nonWorktimeRobot"]),a=null!==(t=e.robotUid)&&void 0!==t?t:null===(n=e.robot)||void 0===n?void 0:n.uid;return f()(f()({},r),a?{robotUid:a}:{})}},st=function(e){if(e)return Ye(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},it=function(){var n=c()(l()().mark((function n(){var r,a,s,i,o,u;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Se&&Se.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Fe(!0),n.prev=4,r=De&&De.uid===Se.uid?De:Se,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:Se.uid,orgUid:null==t?void 0:t.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description,isDefault:null==r?void 0:r.isDefault,enabled:null==r?void 0:r.enabled,routingMode:null==r?void 0:r.routingMode,serviceSettings:$e(a(null==r?void 0:r.serviceSettings,null==r?void 0:r.draftServiceSettings)),inviteSettings:et(a(null==r?void 0:r.inviteSettings,null==r?void 0:r.draftInviteSettings)),intentionSettings:tt(a(null==r?void 0:r.intentionSettings,null==r?void 0:r.draftIntentionSettings)),messageLeaveSettings:nt(a(null==r?void 0:r.messageLeaveSettings,null==r?void 0:r.draftMessageLeaveSettings)),worktimeSettings:st(a(null==r?void 0:r.worktimeSettings,null==r?void 0:r.draftWorktimeSettings)),robotRoutingSettings:at(a(null==r?void 0:r.robotRoutingSettings,null==r?void 0:r.draftRobotRoutingSettings)),queueSettings:rt(a(null==r?void 0:r.queueSettings,null==r?void 0:r.draftQueueSettings))},n.next=10,(0,V.Y2)(s);case 10:i=n.sent,console.log("保存工作组配置模板: ",i,s),i&&200===i.code?(B.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),Ee.current=JSON.stringify(null!==(o=null!==(u=i.data)&&void 0!==u?u:r)&&void 0!==o?o:{}),Oe(!1),Ge(oe,{keepActive:!0})):B.yw.error((null==i?void 0:i.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),B.yw.error("保存失败");case 19:return n.prev=19,Fe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),ot=function(){var n=c()(l()().mark((function n(){var r,a,s;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Se&&Se.uid){n.next=3;break}return B.yw.warning(e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Pe(!0),n.prev=4,!We){n.next=8;break}return n.next=8,it();case 8:return r={uid:Se.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,V.Dm)(r);case 11:(a=n.sent)&&200===a.code?(B.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),Ee.current=JSON.stringify(null!==(s=a.data)&&void 0!==s?s:{}),Oe(!1),Ge(oe)):B.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),B.yw.error("发布失败");case 19:return n.prev=19,Pe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),ut=(0,r.useMemo)((function(){return null!=Se&&Se.uid?[{key:"tips",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(j.Z,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,ee.jsx)(_.Z,{variant:"workgroup",serviceSettings:{live:null==Le?void 0:Le.serviceSettings,draft:null==Le?void 0:Le.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"service",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(C.Z,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"workgroup.settings.service",defaultMessage:"服务设置"})]}),children:(0,ee.jsx)(K.Z,{variant:"workgroup",serviceSettings:{live:null==Le?void 0:Le.serviceSettings,draft:null==Le?void 0:Le.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"rate",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(Z.Z,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,ee.jsx)(ne.Z,{variant:"workgroup",serviceSettings:{live:null==Le?void 0:Le.serviceSettings,draft:null==Le?void 0:Le.draftServiceSettings},onServiceSettingsChange:Ne})},{key:"robot",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(F.Z,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"robot",defaultMessage:"Robot"})]}),children:(0,ee.jsx)(le,{variant:"workgroup",robotRoutingSettings:{live:null==Le?void 0:Le.robotRoutingSettings,draft:null==Le?void 0:Le.draftRobotRoutingSettings},onRobotRoutingSettingsChange:He})}].concat(o()([]),o()([]),o()([]),[{key:"right",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(R.Z,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,ee.jsx)(Q.Z,{variant:"workgroup",serviceSettings:{live:null==Le?void 0:Le.serviceSettings,draft:null==Le?void 0:Le.draftServiceSettings},onServiceSettingsChange:Ne,settingsUid:Se.uid,isActive:"right"===pe})}],o()([]),o()([]),[{key:"route",label:(0,ee.jsxs)("span",{children:[(0,ee.jsx)(q,{})," ",(0,ee.jsx)(s.FormattedMessage,{id:"pages.workgroup.tab.route",defaultMessage:"Route"})]}),children:(0,ee.jsx)(ce,{})}]):[]}),[null==Se?void 0:Se.uid,Le,e,Ne,Be,Ve,He,Je,pe]);return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(v.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ee.jsx)(v.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:n,children:(0,ee.jsxs)(N.Z,{title:e.formatMessage({id:"workgroup.settings.templates",defaultMessage:"模板列表"}),extra:(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(W.Z,{}),type:"primary",onClick:function(){ye(null),ke(!0)},children:(0,ee.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:g,children:[(0,ee.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ee.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ee.jsx)(k.Z,{placeholder:e.formatMessage({id:"workgroup.settings.template.search",defaultMessage:"搜索模板名称"}),value:oe,onChange:function(e){return ue(e.target.value)},onPressEnter:function(e){e.preventDefault();var t=e.currentTarget.value;ue(t),Qe(t)},allowClear:!0,size:"middle"}),(0,ee.jsx)(h.ZP,{type:"primary",icon:(0,ee.jsx)(O.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return Qe()}})]})}),(0,ee.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ee.jsx)(w.Z,{dataSource:Xe,locale:{emptyText:(0,ee.jsx)(M.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:M.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ee.jsx)(w.Z.Item,{style:re===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ae(e.uid)},children:(0,ee.jsx)(w.Z.Item.Meta,{title:(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ee.jsx)(x.Z,{size:4,children:e.isDefault?(0,ee.jsx)(b.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ee.jsx)("div",{style:{color:i?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ee.jsx)(v.Z.Panel,{children:Se?(0,ee.jsx)(N.Z,{title:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsxs)("span",{children:[e.formatMessage({id:"workgroup.settings.editing",defaultMessage:"编辑模板"}),": ",Se.name||Se.uid]}),(0,ee.jsx)(y.Z,{checked:!!Se.enabled,onChange:function(e){return _e(Se.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(E.Z,{}),onClick:function(e){var t;e.stopPropagation(),ye(null!=(t=Se)?t:Se),ke(!0)},children:"编辑"}),(0,ee.jsx)(S.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),Ke(Se)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ee.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,ee.jsx)(z.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),Se.isDefault?(0,ee.jsx)(b.Z,{color:"blue",children:"默认"}):null]}),extra:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(S.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),ot()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ee.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ue,type:"default",icon:(0,ee.jsx)(A.Z,{}),children:(0,ee.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ee.jsx)(h.ZP,{onClick:function(){Se&&(Ae(Se),Ee.current=JSON.stringify(null!=Se?Se:{}),Oe(!1))},disabled:!We,icon:(0,ee.jsx)(D.Z,{}),children:(0,ee.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ee.jsx)(h.ZP,{type:"primary",loading:Ze,onClick:it,disabled:!We,icon:(0,ee.jsx)(L.Z,{}),children:(0,ee.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ee.jsx)(a.Z,{activeKey:pe,onChange:me,items:ut})}):(0,ee.jsx)(N.Z,{children:(0,ee.jsx)(M.Z,{description:e.formatMessage({id:"workgroup.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,ee.jsx)(te,{open:xe,onOpenChange:ke,orgUid:(null==t?void 0:t.uid)||"",record:be,onSuccess:function(){ke(!1),Ge(oe)}})]})},pe=n(10154),me=n.n(pe),ve=n(86222),he=n.n(ve),xe=n(89246),ke=n(33797),we=n(78578),Me=n(2077),be=n(11293),ye=n(75864),Se=n(89965),je=n(80953),Ce=n(33019),Ze=n(10404),Fe=function(e){var t,n,a,i=e.open,o=e.record,u=e.onClose,d=e.onSuccess,g=(0,s.useIntl)(),p=(0,ae.Z)().translateString,v=(0,J.u)((function(e){return e.currentOrg})),k=(0,r.useMemo)((function(){return!(null==o||!o.uid)}),[o]),w=(0,r.useState)(!1),M=m()(w,2),b=M[0],y=M[1],S=(0,r.useState)([]),j=m()(S,2),C=j[0],Z=j[1],F=(0,r.useState)(!1),R=m()(F,2),T=R[0],U=R[1],P=(0,r.useState)(0),I=m()(P,2),q=I[0],O=I[1],E=(0,r.useRef)(),z=(0,Ze.E)((function(e){return e.agentResult})),A=(0,Ze.E)((function(e){return e.setAgentResult})),D=(0,r.useCallback)(function(){var e=c()(l()().mark((function e(t){var n,r,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==v?void 0:v.uid,searchText:t||""},e.next=5,(0,V.zc)(r);case 5:return a=e.sent,s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],Z(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,U(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==v?void 0:v.uid]);return(0,r.useEffect)((function(){var e=function(){var e=c()(l()().mark((function e(){var t,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&null!=v&&v.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:v.uid},e.next=6,(0,Ce._t)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?A(n):null!=n&&n.message&&B.yw.warning(n.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[i,null==v?void 0:v.uid,A]),(0,ee.jsxs)(ye.a,{open:i,onOpenChange:function(e){e||u()},title:k?g.formatMessage({id:"workgroup.edit",defaultMessage:"编辑工作组"}):g.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),width:520,formRef:E,initialValues:k?{nickname:null==o?void 0:o.nickname,description:null==o?void 0:o.description,settingsUid:null==o||null===(t=o.settings)||void 0===t?void 0:t.uid,agents:(null==o||null===(n=o.agents)||void 0===n?void 0:n.map((function(e){return e.uid})))||[]}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:g.formatMessage({id:"save",defaultMessage:"保存"}),resetText:g.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return u()}}},onFinish:function(){var e=c()(l()().mark((function e(t){var n,r,a,s,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,B.yw.loading(g.formatMessage({id:k?"updating":"creating",defaultMessage:k?"Updating":"Creating"})),!k){e.next=9;break}return a=f()(f()(f()({},o),t),{},{agentUids:t.agents}),e.next=6,(0,Me.W5)(a);case 6:r=e.sent,e.next=13;break;case 9:return s={nickname:t.nickname,description:t.description,settingsUid:t.settingsUid,orgUid:null==v?void 0:v.uid,agentUids:t.agents},e.next=12,(0,Me.p0)(s);case 12:r=e.sent;case 13:if(B.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=21;break}return B.yw.success(g.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==d||d(r.data),u(),e.abrupt("return",!0);case 21:return B.yw.error((null===(i=r)||void 0===i?void 0:i.message)||g.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),B.yw.destroy(),B.yw.error(g.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,ee.jsx)(ue.Z,{name:"agents",label:g.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),placeholder:g.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),options:((null==z||null===(a=z.data)||void 0===a?void 0:a.content)||[]).map((function(e){return{value:e.uid,label:p(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0}}),(0,ee.jsx)(ie.A.Item,{label:g.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),children:(0,ee.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ee.jsx)("div",{style:{flex:1},children:(0,ee.jsx)(ue.Z,{name:"settingsUid",label:!1,placeholder:g.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:q},request:function(){var e=c()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",D(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{style:{width:"100%"},filterOption:!1,loading:T,notFoundContent:0===C.length?(0,ee.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,ee.jsx)("div",{style:{marginBottom:8,color:"#999"},children:g.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,ee.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,ee.jsx)(W.Z,{}),onClick:function(){return y(!0)},children:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0}})}),(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(W.Z,{}),onClick:function(){return y(!0)},title:g.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:g.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,ee.jsx)(Se.Z,{name:"nickname",label:g.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),rules:[{required:!0,message:g.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,ee.jsx)(je.Z,{name:"description",label:g.formatMessage({id:"workgroup.info.description",defaultMessage:"描述"})}),(0,ee.jsx)(te,{open:b,onOpenChange:y,orgUid:(null==v?void 0:v.uid)||"",record:null,onSuccess:function(){y(!1),O((function(e){return e+1}))}})]})},Re=function(e){var t,n=e.open,a=e.onClose,i=e.onSubmit,o=(0,s.useIntl)(),u=ie.A.useForm(),d=m()(u,1)[0],g=(0,ae.Z)().translateString,f=(0,J.u)((function(e){return e.currentOrg})),p=(0,Ze.E)((function(e){return e.agentResult})),v=(0,Ze.E)((function(e){return e.setAgentResult})),k=(0,r.useState)([]),w=m()(k,2),M=w[0],b=w[1],y=(0,r.useState)(!1),S=m()(y,2),j=S[0],C=S[1],Z=(0,r.useState)(!1),F=m()(Z,2),R=F[0],T=F[1],U=(0,r.useState)(0),P=m()(U,2),I=P[0],q=P[1],O=(0,r.useState)([]),E=m()(O,2),z=E[0],A=E[1];(0,r.useEffect)((function(){n&&(d.setFieldsValue({nickname:"",agents:[]}),b([]))}),[n]);var D=(0,r.useCallback)(function(){var e=c()(l()().mark((function e(t){var n,r,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==f?void 0:f.uid,searchText:t||""},e.next=5,(0,V.zc)(r);case 5:return a=e.sent,console.log("queryWorkgroupSettingsByOrg response:",a,r),s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],A(s),!d.getFieldValue("settingsUid")&&s.length>0&&d.setFieldsValue({settingsUid:s[0].uid}),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,T(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==f?void 0:f.uid,d]);(0,r.useEffect)((function(){var e=function(){var e=c()(l()().mark((function e(){var t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=f&&f.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:f.uid},e.next=6,(0,Ce._t)(t);case 6:200===(null==(r=e.sent)?void 0:r.code)?v(r):null!=r&&r.message&&B.yw.warning(r.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,null==f?void 0:f.uid,v]);return(0,ee.jsx)("div",{children:(0,ee.jsxs)($.Z,{title:o.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),open:n,forceRender:!0,onOk:function(){console.log("handleOk"),d.validateFields().then((function(e){console.log("form values:",e);var t={nickname:d.getFieldValue("nickname"),agentUids:d.getFieldValue("agents"),settingsUid:d.getFieldValue("settingsUid"),orgUid:null==f?void 0:f.uid};console.log("workgroup:",t),i(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),a()},children:[(0,ee.jsxs)(ie.A,{form:d,name:"wgForm",submitter:{render:function(e,t){return(0,ee.jsx)(ee.Fragment,{})}},children:[(0,ee.jsx)(ue.Z,{name:"settingsUid",label:o.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),rules:[{required:!0,message:o.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],placeholder:o.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:I},request:function(){var e=c()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",D(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:R,notFoundContent:0===z.length?(0,ee.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,ee.jsx)("div",{style:{marginBottom:8,color:"#999"},children:o.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,ee.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,ee.jsx)(W.Z,{}),onClick:function(){return C(!0)},children:o.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},renderFormItem:function(e,t){var n;return(0,ee.jsxs)(x.Z.Compact,{block:!0,children:[null===(n=t.defaultRender)||void 0===n?void 0:n.call(t,e),(0,ee.jsx)(h.ZP,{size:"small",icon:(0,ee.jsx)(W.Z,{}),onClick:function(){return C(!0)},title:o.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:o.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}}),(0,ee.jsx)(Se.Z,{label:o.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),name:"nickname",rules:[{required:!0,message:o.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,ee.jsx)(ue.Z,{name:"agents",label:o.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),options:((null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[]).map((function(e){return{value:e.uid,label:g(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:o.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),value:M,onChange:function(e){console.log("selected ".concat(e)),b(e)}}})]}),(0,ee.jsx)(te,{open:j,onOpenChange:C,orgUid:(null==f?void 0:f.uid)||"",record:null,onSuccess:function(){C(!1),q((function(e){return e+1}))}})]})})},Te=n(13847),Ue=function(e){var t=e.open,n=e.orgUid,a=e.workgroup,i=e.onClose,o=e.onSuccess,u=(0,s.useIntl)(),d=(0,r.useState)([]),g=m()(d,2),f=g[0],p=g[1],v=(0,r.useState)(),h=m()(v,2),x=h[0],k=h[1],w=(0,r.useState)(!1),M=m()(w,2),b=M[0],y=M[1];(0,r.useEffect)((function(){var e=function(){var e=c()(l()().mark((function e(){var r,s,i,o,u,d,c,g,f;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,s={orgUid:n,pageNumber:0,pageSize:200,enabled:!0},e.next=6,(0,be.Bg)(s);case 6:if(i=e.sent,console.log("Ticket settings response:",i,s),o=(null==i||null===(r=i.data)||void 0===r?void 0:r.content)||[],u=o.filter((function(e){return!(null==e||!e.enabled)})),d=u.map((function(e){return{label:e.name||e.uid,value:e.uid}})),p(d),null==a||!a.uid){e.next=20;break}return e.next=15,(0,be.bD)({orgUid:n,workgroupUid:a.uid});case 15:g=e.sent,f=null==g||null===(c=g.data)||void 0===c?void 0:c.uid,k(f||void 0),e.next=21;break;case 20:k(void 0);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(2),p([]);case 26:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(){return e.apply(this,arguments)}}();e()}),[t,n,null==a?void 0:a.uid]);var S=function(){var e=c()(l()().mark((function e(){var t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=a&&a.uid&&x){e.next=2;break}return e.abrupt("return");case 2:return y(!0),e.prev=3,e.next=6,(0,be.nQ)({uid:x,orgUid:n},{workgroupUids:[a.uid]});case 6:200===(null==(t=e.sent)?void 0:t.code)?(B.yw.success(u.formatMessage({id:"ticket.settings.bind.success",defaultMessage:"绑定已更新"})),r=f.find((function(e){return e.value===x})),o({uid:x,name:(null==r?void 0:r.label)||x})):B.yw.error((null==t?void 0:t.message)||u.formatMessage({id:"ticket.settings.bind.failed",defaultMessage:"绑定失败"}));case 8:return e.prev=8,y(!1),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})));return function(){return e.apply(this,arguments)}}();return(0,ee.jsxs)($.Z,{title:u.formatMessage({id:"workgroup.ticket.template.modal.title",defaultMessage:"设置工单配置模板"}),open:t,onCancel:i,onOk:S,okButtonProps:{loading:b},destroyOnHidden:!0,children:[(0,ee.jsx)("div",{style:{marginBottom:8},children:u.formatMessage({id:"workgroup.ticket.template.tip",defaultMessage:"请选择已启用的工单配置模板"})}),(0,ee.jsx)(Te.Z,{style:{width:"100%"},placeholder:u.formatMessage({id:"workgroup.ticket.template.placeholder",defaultMessage:"选择模板"}),options:f,value:x,onChange:k,showSearch:!0,filterOption:function(e,t){return(null==t?void 0:t.label).toLowerCase().includes(e.toLowerCase())}})]})},Pe=n(23753),Ie=function(){var e=(0,s.useIntl)(),t=(0,r.useRef)(),n=(0,J.u)((function(e){return e.currentOrg})),a=(0,r.useState)(!1),i=m()(a,2),o=i[0],u=i[1],d=(0,r.useState)(!1),g=m()(d,2),p=g[0],v=g[1],x=(0,r.useState)(null),k=m()(x,2),w=k[0],M=k[1],b=(0,r.useState)(!1),y=m()(b,2),j=y[0],C=y[1],Z=(0,r.useState)(null),F=m()(Z,2),R=F[0],T=F[1],U=(0,r.useState)({}),P=m()(U,2),I=P[0],q=P[1],W=function(){var e=c()(l()().mark((function e(t){var r,a,s,i,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.uid&&Array.isArray(t)&&0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Promise.all(t.map(function(){var e=c()(l()().mark((function e(t){var r,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,(0,be.bD)({orgUid:n.uid,workgroupUid:t.uid});case 5:if(r=e.sent,a=null==r?void 0:r.data,s=null==a?void 0:a.name,!(null==a?void 0:a.uid)||!s){e.next=11;break}return e.abrupt("return",[t.uid,s]);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(2);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()));case 5:r=e.sent,a={},s=he()(r);try{for(s.s();!(i=s.n()).done;)(o=i.value)&&(a[o[0]]=o[1])}catch(e){s.e(e)}finally{s.f()}Object.keys(a).length>0&&q((function(e){return f()(f()({},e),a)})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:e.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,ee.jsx)(ke.Z,{src:null==t?void 0:t.avatar})}},{title:e.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:e.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),dataIndex:"agents",width:320,hideInSearch:!0,ellipsis:!0,render:function(t,n){var r=(null==n?void 0:n.agents)||[];return null!=r&&r.length?(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,ee.jsx)(ke.Z.Group,{max:{count:5},size:"small",children:r.map((function(e){var t;return(0,ee.jsx)(we.Z,{title:null==e?void 0:e.nickname,children:(0,ee.jsx)(ke.Z,{src:null==e?void 0:e.avatar,children:null===(t=(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)||"?")||void 0===t?void 0:t.slice(0,1)})},null==e?void 0:e.uid)}))}),(0,ee.jsx)("span",{style:{color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.map((function(e){return null==e?void 0:e.nickname})).filter(Boolean).join("、")})]}):(0,ee.jsx)("span",{style:{color:"#999"},children:e.formatMessage({id:"workgroup.members.empty",defaultMessage:"暂无成员"})})}},{title:e.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(t,n){return null!=n&&n.settings?(0,ee.jsx)("a",{onClick:function(){M(n),u(!0)},children:n.settings.name||e.formatMessage({id:"workgroup.settings.configured",defaultMessage:"已配置"})}):(0,ee.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){M(n),u(!0)},children:e.formatMessage({id:"workgroup.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:e.formatMessage({id:"workgroup.ticket.template",defaultMessage:"工单配置模板"}),dataIndex:"ticketTemplate",width:220,hideInSearch:!0,render:function(t,r){var a=I[r.uid],s=a?void 0:{color:"#ff4d4f"};return(0,ee.jsx)("a",{onClick:function(){return e=r,void(null!=n&&n.uid&&null!=e&&e.uid&&(T(e),C(!0)));var e},style:s,children:a||e.formatMessage({id:"workgroup.ticket.template.choose",defaultMessage:"设置/修改模板"})})}},{title:e.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:e.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(r,a){return[(0,ee.jsx)("a",{onClick:function(){return function(t){var r;if(null!=t&&t.uid){var a={chatConfig:{org:null==n?void 0:n.uid,t:se.I$6,sid:t.uid}};null===(r=window.bytedesk)||void 0===r||r.showChat(a)}else B.yw.error(e.formatMessage({id:"workgroup.invalid",defaultMessage:"无效的工作组"}))}(a)},children:e.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,ee.jsx)("a",{onClick:function(){return s.history.push("/service/channel")},children:e.formatMessage({id:"workgroup.get.code",defaultMessage:"获取工作组代码"})},"code"),(0,ee.jsx)("a",{onClick:function(){M(a),u(!0)},children:e.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,ee.jsx)(S.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==a?void 0:a.nickname,"】？"),onConfirm:c()(l()().mark((function n(){var r,s;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return B.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),n.prev=1,n.next=4,(0,Me.zl)(a);case 4:r=n.sent,B.yw.destroy(),200===(null==r?void 0:r.code)?(B.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=t.current)||void 0===s||s.reload()):B.yw.error((null==r?void 0:r.message)||"Delete failed"),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),B.yw.destroy(),B.yw.error("Delete error");case 13:case"end":return n.stop()}}),n,null,[[1,9]])}))),okText:e.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,ee.jsx)("a",{children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:e.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(xe.Z,{columns:O,actionRef:t,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},onLoad:function(e){W(e||[])},toolBarRender:function(){return[(0,ee.jsx)(h.ZP,{type:"primary",onClick:function(){M(null),v(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=c()(l()().mark((function e(t,r){var a,s,i,o,u,d,c,g,p,v,h,x,k,w,M,b,y,S,j,C,Z,F;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null!==(a=null==t?void 0:t.current)&&void 0!==a?a:1)-1,u=null!==(s=null==t?void 0:t.pageSize)&&void 0!==s?s:10,d=null!==(i=null==t?void 0:t.searchText)&&void 0!==i?i:"",(p=Object.entries(r||{})).length>0&&(v=p[0],h=m()(v,2),x=h[0],(k=h[1])&&(c=x,g="ascend"===k?"ascend":"descend")),w=f()(f()({pageNumber:o,pageSize:u,orgUid:null==n?void 0:n.uid,searchText:d},c?{sortBy:c}:{}),g?{sortDirection:g}:{}),e.prev=6,e.next=9,(0,Me.LE)(w);case 9:if(M=e.sent,Pe.Z.debug("WorkgroupTable queryWorkgroupsByOrg",M,w),200!==(null==M?void 0:M.code)){e.next=15;break}return Z=(null==M||null===(b=M.data)||void 0===b?void 0:b.content)||[],F=null!==(y=null!==(S=null==M||null===(j=M.data)||void 0===j?void 0:j.totalElements)&&void 0!==S?S:null==M||null===(C=M.data)||void 0===C?void 0:C.numberOfElements)&&void 0!==y?y:Z.length,e.abrupt("return",{data:Z,total:F,success:!0});case 15:return e.abrupt("return",{data:[],total:0,success:!1});case 18:return e.prev=18,e.t0=e.catch(6),Pe.Z.error("WorkgroupTable queryWorkgroupsByOrg error",e.t0,w),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:e.formatMessage({id:"workgroup",defaultMessage:"Workgroup"})}),o&&(0,ee.jsx)(Fe,{open:o,record:w,onClose:function(){return u(!1)},onSuccess:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.reload()}}),p&&(0,ee.jsx)(Re,{open:p,onClose:function(){return v(!1)},onSubmit:function(){var n=c()(l()().mark((function n(r){var a,s;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return B.yw.loading(e.formatMessage({id:"saving",defaultMessage:"Saving..."})),n.prev=1,n.next=4,(0,Me.p0)(r);case 4:a=n.sent,B.yw.destroy(),200===(null==a?void 0:a.code)?(B.yw.success(e.formatMessage({id:"create.success",defaultMessage:"Create success"})),v(!1),null===(s=t.current)||void 0===s||s.reload()):B.yw.error((null==a?void 0:a.message)||e.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),B.yw.destroy(),B.yw.error(e.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}),(0,ee.jsx)(Ue,{open:j,orgUid:null==n?void 0:n.uid,workgroup:R,onClose:function(){C(!1),T(null)},onSuccess:function(e){var t=e.name;null!=R&&R.uid&&q((function(e){return f()(f()({},e),{},me()({},R.uid,t))})),C(!1),T(null)}})]})},qe=function(){return(0,ee.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,ee.jsx)(s.FormattedMessage,{id:"menu.workgroup.table",defaultMessage:"Workgroup"}),children:(0,ee.jsx)(Ie,{})},{key:"settings",label:(0,ee.jsx)(s.FormattedMessage,{id:"menu.workgroup.settings",defaultMessage:"Workgroup Settings"}),children:(0,ee.jsx)(fe,{})}]})}}}]);