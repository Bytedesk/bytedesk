"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3280],{81214:function(e,t,i){i.r(t),i.d(t,{default:function(){return V}});var s=i(90819),a=i.n(s),n=i(89933),r=i.n(n),o=i(45332),l=i.n(o),c=i(44194),d=i(98123),u=i(44781),g=i(62673),f=i(3849),m=i(67402),v=i(88996),p=i(75365),k=i(88201),y=i(5602),x=i(59485),h=i(7875),j=i(23515),M=i(97413),w=i(60262),Z=i(74840),T=i(61107),F=i(80556),R=i(30921),b=i(5939),O=i(24562),S=i(89717),Y=i(73193),A=i.n(Y),E=i(55735);function C(e){return D.apply(this,arguments)}function D(){return(D=r()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,R.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:A()(A()({},t),{},{client:E.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=i(86803),B=i(40612),q=i(1902),I=i(95490),N=i(24170),P=i(76750),W=i(72614),z=i(28977),_=i.n(z),G=i(31549),H=d.default.RangePicker,K=u.Z.Option,V=function(){var e,t,i=(0,R.useIntl)(),s=(0,P.Z)().translateStringTranct,n=(0,c.useState)(_()().startOf("day")),o=l()(n,2),d=o[0],Y=o[1],A=(0,c.useState)(_()().endOf("day")),D=l()(A,2),z=D[0],V=D[1],$=(0,c.useState)("today"),J=l()($,2),L=J[0],Q=J[1],X=(0,c.useState)(E.AOk),ee=l()(X,2),te=ee[0],ie=ee[1],se=(0,c.useState)(),ae=l()(se,2),ne=ae[0],re=ae[1],oe=(0,c.useState)(),le=l()(oe,2),ce=le[0],de=le[1],ue=(0,B.u)((function(e){return e.currentOrg})),ge=(0,q.E)((function(e){return e})),fe=ge.agentResult,me=ge.setAgentResult,ve=(0,I.$)((function(e){return e})),pe=ve.workgroupResult,ke=ve.setWorkgroupResult,ye=(0,c.useState)(),xe=l()(ye,2),he=xe[0],je=xe[1],Me=(0,c.useState)(E.OwA),we=l()(Me,2),Ze=we[0],Te=we[1],Fe=(0,c.useState)(!1),Re=l()(Fe,2),be=Re[0],Oe=Re[1],Se=[{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){if("custom"===L)Y(d),V(z),Te(E.dd4);else{var e=_()();"today"===L?(Y(e),V(e),Te(E.OwA)):"yesterday"===L?(Y(e.subtract(1,"day")),V(e.subtract(1,"day")),Te(E.OwA)):"week"===L?(Y(e.startOf("week")),V(e.endOf("week")),Te(E.dd4)):"lastWeek"===L?(Y(e.subtract(1,"week").startOf("week")),V(e.subtract(1,"week").endOf("week")),Te(E.dd4)):"month"===L&&(Y(e.startOf("month")),V(e.endOf("month")),Te(E.dd4))}}),[L]);var Ye=function(){var e=r()(a()().mark((function e(){var t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,W.u7)(t);case 4:i=e.sent,console.log("fetchAllWorkgroups: ",i),200===i.code?(U.yw.destroy(),ke(i),i.data.content.length>0&&de(i.data.content[0].uid)):(U.yw.destroy(),U.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ae=function(){var e=r()(a()().mark((function e(){var t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,N._t)(t);case 4:i=e.sent,console.log("fetchAllAgents: ",i),200===i.code?(U.yw.destroy(),me(i),i.data.content.length>0&&re(i.data.content[0].uid)):(U.yw.destroy(),U.yw.error(s(i.message))),console.log("queryAllAgents response",i);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=r()(a()().mark((function e(){var t,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Oe(!0),e.prev=1,U.yw.loading("loading"),t={type:te,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==z?void 0:z.format("YYYY-MM-DD 23:59:59"),workgroupUid:ce,assigneeUid:ne,orgUid:null==ue?void 0:ue.uid},e.next=6,C(t);case 6:s=e.sent,console.log("queryStatisticTicketsByOrg response",s,t),200===s.code?(U.yw.destroy(),je(s.data)):(U.yw.destroy(),U.yw.error(s.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),U.yw.error(i.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,Oe(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=r()(a()().mark((function e(){var t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U.yw.loading("loading"),t={type:te,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==z?void 0:z.format("YYYY-MM-DD 23:59:59"),workgroupUid:ce,assigneeUid:ne,orgUid:null==ue?void 0:ue.uid},e.next=4,C(t);case 4:i=e.sent,console.log("queryStatisticTicketsByOrg response",i,t),200===i.code?U.yw.destroy():(U.yw.destroy(),U.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Ye(),Ae()}),[]),(0,c.useEffect)((function(){Ee()}),[te,ne,ce]),(0,c.useEffect)((function(){Ce()}),[Ze,te,ne,ce]),(0,c.useEffect)((function(){Ee()}),[d,z]);var De=[{title:i.formatMessage({id:"ticket.statistic.total"}),value:(null==he?void 0:he.totalTickets)||0,icon:(0,G.jsx)(j.Z,{}),color:"#1890ff"},{title:i.formatMessage({id:"ticket.statistic.resolved"}),value:(null==he?void 0:he.resolvedTickets)||0,icon:(0,G.jsx)(M.Z,{}),color:"#52c41a"},{title:i.formatMessage({id:"ticket.statistic.resolution.rate"}),value:"".concat((null==he?void 0:he.resolvedTickets)/(null==he?void 0:he.totalTickets)||0,"%"),icon:(0,G.jsx)(w.Z,{}),color:"#722ed1"},{title:i.formatMessage({id:"ticket.statistic.satisfaction"}),value:"".concat((null==he?void 0:he.customerSatisfactionRate)||0,"%"),icon:(0,G.jsx)(Z.Z,{}),color:"#fa8c16"}];return(0,G.jsxs)("div",{style:{padding:16},children:[(0,G.jsx)(g.Z,{style:{marginBottom:16},children:(0,G.jsxs)(f.Z,{direction:"vertical",style:{width:"100%"},children:[(0,G.jsxs)(f.Z,{wrap:!0,children:[(0,G.jsx)(m.ZP.Group,{value:L,onChange:function(e){return Q(e.target.value)},children:Se.map((function(e){return(0,G.jsx)(m.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===L&&(0,G.jsx)(H,{value:[d,z],onChange:function(e){Y(e[0]),V(e[1])}})]}),(0,G.jsxs)(f.Z,{wrap:!0,children:[(0,G.jsxs)(u.Z,{placeholder:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.type"}),style:{width:200},value:te,onChange:function(e){return ie(e)},children:[(0,G.jsx)(K,{value:E.AOk,children:(0,G.jsx)(R.FormattedMessage,{id:"i18n.all"})}),(0,G.jsx)(K,{value:E.pHh,children:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.agent"})}),(0,G.jsx)(K,{value:E.ti4,children:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.workgroup"})})]}),te===E.pHh&&(0,G.jsx)(u.Z,{placeholder:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.agent"}),style:{width:200},value:ne,onChange:function(e){return re(e)},children:null===(e=fe.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,G.jsx)(K,{value:null==e?void 0:e.uid,children:s(null==e?void 0:e.nickname)},null==e?void 0:e.uid)}))}),te===E.ti4&&(0,G.jsx)(u.Z,{placeholder:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.department"}),style:{width:200},value:ce,onChange:function(e){return de(e)},children:null===(t=pe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,G.jsx)(K,{value:null==e?void 0:e.uid,children:s(null==e?void 0:e.nickname)},null==e?void 0:e.uid)}))}),(0,G.jsx)(v.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.export"}),children:(0,G.jsx)(p.ZP,{icon:(0,G.jsx)(T.Z,{}),onClick:function(){U.yw.warning("TODO: 待实现")},children:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.export"})})}),(0,G.jsx)(v.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.refresh"}),children:(0,G.jsx)(p.ZP,{icon:(0,G.jsx)(F.Z,{}),onClick:function(){return Ee()},children:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.refresh"})})}),!1]})]})}),(0,G.jsx)(k.Z,{gutter:16,style:{marginBottom:24},children:De.map((function(e){return(0,G.jsx)(y.Z,{span:6,children:(0,G.jsx)(g.Z,{loading:be,children:(0,G.jsx)(x.Z,{title:e.title,value:e.value,prefix:c.cloneElement(e.icon,{style:{color:e.color}}),valueStyle:{color:e.color}})})},e.title)}))}),(0,G.jsx)(g.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.trend"}),style:{marginBottom:24,height:300},loading:be,children:(0,G.jsx)(b.Z,{data:[],xField:"date",yField:"value",seriesField:"type",legend:{position:"top"},meta:{type:{formatter:function(e){return i.formatMessage({id:"ticket.statistic.type.".concat(e)})}}}})}),(0,G.jsxs)(k.Z,{gutter:16,style:{marginBottom:24},children:[(0,G.jsx)(y.Z,{span:12,children:(0,G.jsx)(g.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.distribution"}),loading:be,children:(0,G.jsx)(O.Z,{data:[{type:i.formatMessage({id:"ticket.status.new"}),value:(null==he?void 0:he.newTickets)||0},{type:i.formatMessage({id:"ticket.status.assigned"}),value:(null==he?void 0:he.assignedTickets)||0},{type:i.formatMessage({id:"ticket.status.claimed"}),value:(null==he?void 0:he.claimedTickets)||0},{type:i.formatMessage({id:"ticket.status.unclaimed"}),value:(null==he?void 0:he.unclaimedTickets)||0},{type:i.formatMessage({id:"ticket.status.processing"}),value:(null==he?void 0:he.processingTickets)||0},{type:i.formatMessage({id:"ticket.status.pending"}),value:(null==he?void 0:he.pendingTickets)||0},{type:i.formatMessage({id:"ticket.status.holding"}),value:(null==he?void 0:he.holdingTickets)||0},{type:i.formatMessage({id:"ticket.status.reopened"}),value:(null==he?void 0:he.reopenedTickets)||0},{type:i.formatMessage({id:"ticket.status.resolved"}),value:(null==he?void 0:he.resolvedTickets)||0},{type:i.formatMessage({id:"ticket.status.escalated"}),value:(null==he?void 0:he.escalatedTickets)||0},{type:i.formatMessage({id:"ticket.status.transferred"}),value:(null==he?void 0:he.transferredTickets)||0},{type:i.formatMessage({id:"ticket.status.resumed"}),value:(null==he?void 0:he.resumedTickets)||0},{type:i.formatMessage({id:"ticket.status.closed"}),value:(null==he?void 0:he.closedTickets)||0},{type:i.formatMessage({id:"ticket.status.cancelled"}),value:(null==he?void 0:he.cancelledTickets)||0},{type:i.formatMessage({id:"ticket.status.verified_ok"}),value:(null==he?void 0:he.verifiedOkTickets)||0},{type:i.formatMessage({id:"ticket.status.verified_fail"}),value:(null==he?void 0:he.verifiedFailTickets)||0}].filter((function(e){return e.value>0})),angleField:"value",colorField:"type",radius:.8,tooltip:{formatter:function(e){return{name:i.formatMessage({id:"ticket.status.".concat(e.type)}),value:e.value}}},legend:{layout:"horizontal",position:"bottom",itemName:{formatter:function(e){return i.formatMessage({id:"ticket.status.".concat(e)})}}},interactions:[{type:"element-active"}]})})}),(0,G.jsx)(y.Z,{span:12,children:(0,G.jsx)(g.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.efficiency"}),loading:be,children:(0,G.jsx)(S.Z,{data:[{type:"avgResponseTime",value:(null==he?void 0:he.averageFirstResponseTime)||0},{type:"avgResolutionTime",value:(null==he?void 0:he.averageResolutionTime)||0}],xField:"type",yField:"value",label:{position:"top"},meta:{type:{formatter:function(e){return i.formatMessage({id:"ticket.statistic.time.".concat(e)})}}}})})})]}),(0,G.jsx)(g.Z,{title:(0,G.jsx)(R.FormattedMessage,{id:"ticket.statistic.agent.performance"}),loading:be,children:(0,G.jsx)(h.Z,{columns:[{title:i.formatMessage({id:"ticket.statistic.agent.name"}),dataIndex:"assigneeName",key:"assigneeName"},{title:i.formatMessage({id:"ticket.statistic.agent.tickets"}),dataIndex:"assigneeTickets",key:"assigneeTickets",sorter:!0},{title:i.formatMessage({id:"ticket.statistic.agent.resolution"}),dataIndex:"assigneeResolutionRate",key:"assigneeResolutionRate",render:function(e){return"".concat(e,"%")},sorter:!0},{title:i.formatMessage({id:"ticket.statistic.agent.satisfaction"}),dataIndex:"customerSatisfactionRate",key:"customerSatisfactionRate",render:function(e){return"".concat(e,"%")},sorter:!0}],rowKey:"assigneeUid",pagination:!1})})]})}}}]);