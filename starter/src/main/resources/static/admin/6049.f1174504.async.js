"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6049],{90092:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(38404),r=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},i=n(5901),o=function(e,t){return r.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var l=r.forwardRef(o)},16049:function(e,t,n){n.d(t,{Z:function(){return V}});var a=n(90819),r=n.n(a),s=n(89933),i=n.n(s),o=n(45332),l=n.n(o),c=n(83381),u=n(12715),d=n(90092),f=n(35911),g=n(41881),p=n(91768),m=n(80503),v=n(35746),h=n(31461),y=n(90883),x=n(55721),b=n(56668),M=n(24839),w=n(48518),C=n(49108),k=n(73193),j=n.n(k),Z=n(76711),S=n.n(Z),T=n(50884),K=n(21002),O=n(64967),z=n(28520),E=n(97588),$=n(67186),U=n(17455),R=n(34053),D=n(44194),I=n(7603),B=n(2290),F=n(27353),N=n(31549),P=function(e){return e===F.p$M||e===F.hXJ},G=function(e){var t,n=e.open,a=e.level,s=e.type,o=e.showKbase,c=void 0===o||o,u=e.isEdit,d=e.onCancel,f=e.onSubmit,g=(0,B.useIntl)(),p=E.A.useForm(),m=l()(p,1)[0],h=(0,K.Z)().translateString,y=(0,z.u)((function(e){return e.currentOrg})),x=(0,O.j)((function(e){return e.kbaseResult})),b=(0,O.j)((function(e){return e.currentKbase})),M=(0,I.v)((function(e){return{currentCategory:e.currentCategory,categoryTreeOptions:e.categoryTreeOptions}})),w=M.currentCategory,C=M.categoryTreeOptions;(0,D.useEffect)((function(){u?m.setFieldsValue({name:h(null==w?void 0:w.name),parentUid:(null==w?void 0:w.parentUid)||F.zBg}):(m.resetFields(),m.setFieldsValue({parentUid:null!=w&&w.uid&&w.uid!==F.zBg?w.uid:F.zBg})),m.setFieldsValue({kbUid:null==b?void 0:b.uid}),P(s)&&m.setFieldsValue({ticketCategoryType:s})}),[n,u]);var k=function(){m.validateFields().then(function(){var e=i()(r()().mark((function e(t){var n,i,o;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),n=t.parentUid===F.zBg?void 0:t.parentUid,i=P(s)?t.ticketCategoryType:s,o={uid:u?null==w?void 0:w.uid:"",name:t.name,level:a,type:i,parentUid:n,kbUid:t.kbUid,orgUid:null==y?void 0:y.uid},f(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),T.yw.error(g.formatMessage({id:u?"pages.category.update.failed":"pages.category.create.failed"}))}))},Z=(0,D.useMemo)((function(){var e,t,n=function e(t){return t.map((function(t){return{title:h(t.title),key:t.key,disabled:t.disabled,children:t.children?e(t.children):void 0}}))}(C||[]);n.length>0&&(null===(e=n[0])||void 0===e?void 0:e.key)===F.zBg&&(n[0].title=g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}));var a=u?null==w?void 0:w.uid:void 0;if(!a)return n;var r=function e(t){var n;t&&(t.disabled=!0,null===(n=t.children)||void 0===n||n.forEach(e))};return function e(t){t&&t.forEach((function(t){var n;t.key===a?r(t):null!==(n=t.children)&&void 0!==n&&n.length&&e(t.children)}))}(n),n.length>0&&(null===(t=n[0])||void 0===t?void 0:t.key)===F.zBg?n:[{title:g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),key:F.zBg,children:void 0}].concat(S()(n))}),[C,u,null==w?void 0:w.uid,g,h]),G=(0,D.useMemo)((function(){return g.formatMessage({id:"pages.category.drawer.parent.placeholder",defaultMessage:"选择上级分类（留空则为顶级）"})}),[g]),L=(0,D.useCallback)((function(e,t){var n=null==t?void 0:t.title;return("string"==typeof n?n:String(null!=n?n:"")).toLowerCase().includes(e.toLowerCase())}),[]),A=(0,D.useMemo)((function(){return{allowClear:!0,placeholder:G,treeData:Z,fieldNames:{label:"title",value:"key",children:"children"},treeDefaultExpandAll:!0,treeDataSimpleMode:!1,showSearch:!0,filterTreeNode:L,variant:"outlined"}}),[L,G,Z]);return(0,N.jsx)("div",{children:(0,N.jsx)(v.Z,{title:u?g.formatMessage({id:"pages.category.drawer.edit"}):g.formatMessage({id:"pages.category.drawer.create"}),open:n,forceRender:!0,onOk:k,onCancel:d,getContainer:!1,okText:g.formatMessage({id:"pages.category.drawer.save"}),cancelText:g.formatMessage({id:"pages.category.drawer.cancel"}),children:(0,N.jsxs)(E.A,{form:m,name:"categoryForm",submitter:!1,children:[(0,N.jsx)($.Z,{label:g.formatMessage({id:"pages.category.drawer.name",defaultMessage:"分类名称"}),name:"name",rules:[{required:!0,message:g.formatMessage({id:"pages.category.drawer.name.required",defaultMessage:"请输入名称!"})}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&k()},placeholder:g.formatMessage({id:"pages.category.drawer.name.placeholder",defaultMessage:"请输入分类名称"})}}),P(s)&&(0,N.jsx)(U.Z,{name:"ticketCategoryType",label:g.formatMessage({id:"pages.category.drawer.ticketType",defaultMessage:"工单类型"}),rules:[{required:!0,message:g.formatMessage({id:"pages.category.drawer.ticketType.required",defaultMessage:"请选择工单类型!"})}],options:[{label:g.formatMessage({id:"ticket.tab.external",defaultMessage:"外部工单"}),value:F.hXJ},{label:g.formatMessage({id:"ticket.tab.internal",defaultMessage:"内部工单"}),value:F.p$M}]}),(0,N.jsx)(E.A.Item,{name:"parentUid",label:g.formatMessage({id:"pages.category.drawer.parent",defaultMessage:"上级分类"}),children:(0,N.jsx)(R.Z,j()({},A))}),c&&(0,N.jsx)(U.Z,{name:"kbUid",label:g.formatMessage({id:"pages.category.drawer.kb"}),allowClear:!0,options:null==x||null===(t=x.data)||void 0===t?void 0:t.content.map((function(e){return{label:h(e.name),value:e.uid}}))})]})})})},L=n(27403),A=n(97765),V=function(e){var t=e.type,n=e.level,a=e.showKbase,s=void 0===a||a,o=(0,B.useIntl)(),k=(0,D.useState)(!0),j=l()(k,2),Z=j[0],S=j[1],E=(0,D.useState)(!1),$=l()(E,2),U=$[0],R=$[1],P=(0,D.useState)(1),V=l()(P,2),q=V[0],X=V[1],H=(0,D.useState)(20),J=l()(H,2),W=J[0],_=J[1],Q=(0,D.useState)(0),Y=l()(Q,2),ee=Y[0],te=Y[1],ne=(0,D.useState)(""),ae=l()(ne,2),re=ae[0],se=ae[1],ie=(0,z.u)((function(e){return e.currentOrg})),oe=(0,O.j)((function(e){return e.currentKbase})),le=(0,D.useState)(!1),ce=l()(le,2),ue=ce[0],de=ce[1],fe=(0,I.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid,resetDefaultCategory:e.resetDefaultCategory}})),ge=fe.categoryTreeOptions,pe=fe.currentCategory,me=fe.setCurrentCategoryUid,ve=fe.resetDefaultCategory,he=(0,K.Z)(),ye=he.translateString,xe=he.translateStringTranct,be=v.Z.useModal(),Me=l()(be,2),we=Me[0],Ce=Me[1],ke=function(){var e=i()(r()().mark((function e(){var a,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(!0),a=s?null==oe?void 0:oe.uid:"",e.next=4,(0,L.HK)(t,null==ie?void 0:ie.uid,a,n,{showLoading:!0,pageSize:W,pageNumber:q-1,searchName:re,loadingMessage:o.formatMessage({id:"loading"}),errorMessage:o.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:i=e.sent,A.Z.debug("refreshCategories response: ",null==i?void 0:i.data),R(!1),i&&null!=i&&i.data&&te((null==i?void 0:i.data.totalElements)||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(e){se(e),X(1),setTimeout((function(){ke()}),0)},Ze=function(e,t){X(e),t&&t!==W&&_(t),setTimeout((function(){ke()}),0)},Se=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(!1),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(!0),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=i()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,L.sT)(t,{showLoading:!0,loadingMessage:o.formatMessage({id:"deleting"}),successMessage:o.formatMessage({id:"delete.success"}),errorMessage:o.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&ke();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=i()(r()().mark((function e(t){var n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={showLoading:!0,loadingMessage:o.formatMessage({id:Z?"updating":"creating"}),successMessage:o.formatMessage({id:Z?"update.success":"create.success"}),errorMessage:o.formatMessage({id:Z?"update.error":"create.error",defaultMessage:Z?"Update failed":"Create failed"})},!Z){e.next=7;break}return e.next=4,(0,L.ht)(t,n);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,L.i8)(t,n);case 9:e.t0=e.sent;case 10:e.t0&&(de(!1),ke());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,D.useEffect)((function(){s&&(X(1),se(""),ke())}),[oe]),(0,D.useEffect)((function(){X(1),se(""),ve();var e=setTimeout((function(){ke()}),0);return function(){return clearTimeout(e)}}),[t,ve]);return(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(ee/W)>1||""!==re)&&(0,N.jsx)(h.Z,{placeholder:o.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,N.jsx)(u.Z,{}),suffix:(0,N.jsx)(y.ZP,{type:"text",size:"small",icon:(0,N.jsx)(u.Z,{}),onClick:function(){return je(re)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,N.jsx)("span",{onClick:function(e){e.stopPropagation(),se(""),X(1),ke()}})},value:re,onChange:function(e){var t=e.target.value;se(t),t||(X(1),setTimeout((function(){ke()}),0))},onPressEnter:function(e){return je(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,N.jsxs)(x.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,N.jsxs)(x.Z,{gap:"small",children:[(0,N.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,N.jsx)(d.Z,{}),onClick:Se,children:o.formatMessage({id:"create.category"})}),(0,N.jsx)(y.ZP,{size:"small",icon:(0,N.jsx)(f.Z,{spin:U}),onClick:ke,loading:U,children:o.formatMessage({id:"refresh"})})]}),""!==(null==pe?void 0:pe.uid)&&(null==pe?void 0:pe.uid)!==F.zBg&&(0,N.jsx)(b.Z,{menu:{items:[{key:"edit",icon:(0,N.jsx)(g.Z,{}),label:o.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Te},{key:"delete",icon:(0,N.jsx)(p.Z,{}),label:o.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==F.zBg?we.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,N.jsx)(c.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ye(e.name),"】？"),onOk:function(){Ke(e)},onCancel:function(){},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})}):T.yw.error(o.formatMessage({id:"delete.dept.all.error"}))}(pe)}}]},children:(0,N.jsx)(y.ZP,{size:"small",icon:(0,N.jsx)(m.Z,{})})})]})]}),(0,N.jsx)(M.Z,{defaultSelectedKeys:[null==pe?void 0:pe.uid],selectedKeys:[null==pe?void 0:pe.uid],onSelect:function(e,t){0!==e.length&&me(e[0].toString())},treeData:ge,blockNode:!0,titleRender:function(e){return(0,N.jsx)(w.Z,{title:ye(e.title),children:xe(e.title)})}}),Math.ceil(ee/W)>1&&(0,N.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,N.jsx)(C.Z,{size:"small",current:q,pageSize:W,total:ee,onChange:Ze,onShowSizeChange:Ze,showSizeChanger:!1,showLessItems:!0}),(0,N.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:o.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:ee})})]}),ue&&(0,N.jsx)(G,{open:ue,type:t,showKbase:s,isEdit:Z,onCancel:function(){de(!1)},onSubmit:Oe}),Ce]})}},64967:function(e,t,n){n.d(t,{j:function(){return d}});var a=n(73193),r=n.n(a),s=n(76711),i=n.n(s),o=n(27353),l=n(26557),c=n(26407),u=n(20744),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));-1!==a?n[a]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var a=t().kbaseResult.data.content,s=a.findIndex((function(e){return e.uid===n.uid}));if(-1!==s){var o=[].concat(i()(a.slice(0,s)),[n],i()(a.slice(s+1))),l=r()(r()({},t().kbaseResult),{},{data:{content:o}});e({kbaseResult:l,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var a=t().kbaseResult.data.content,s=a.findIndex((function(e){return e.uid===n}));-1!==s?e({kbaseResult:r()(r()({},t().kbaseResult),{},{data:{content:[].concat(i()(a.slice(0,s)),i()(a.slice(s+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:o.wKE})))},55721:function(e,t,n){n.d(t,{Z:function(){return C}});var a=n(44194),r=n(51865),s=n.n(r),i=n(21762),o=n(30126),l=n(30651),c=n(83298),u=n(10750);const d=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],g=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var p=function(e,t){return s()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const n=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${n}`]:n&&d.includes(n)}})(e,t)),((e,t)=>{const n={};return g.forEach((a=>{n[`${e}-align-${a}`]=t.align===a})),n[`${e}-align-stretch`]=!t.align&&!!t.vertical,n})(e,t)),((e,t)=>{const n={};return f.forEach((a=>{n[`${e}-justify-${a}`]=t.justify===a})),n})(e,t)))};const m=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},v=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},h=e=>{const{componentCls:t}=e,n={};return d.forEach((e=>{n[`${t}-wrap-${e}`]={flexWrap:e}})),n},y=e=>{const{componentCls:t}=e,n={};return g.forEach((e=>{n[`${t}-align-${e}`]={alignItems:e}})),n},x=e=>{const{componentCls:t}=e,n={};return f.forEach((e=>{n[`${t}-justify-${e}`]={justifyContent:e}})),n};var b=(0,c.I$)("Flex",(e=>{const{paddingXS:t,padding:n,paddingLG:a}=e,r=(0,u.IX)(e,{flexGapSM:t,flexGap:n,flexGapLG:a});return[m(r),v(r),h(r),y(r),x(r)]}),(()=>({})),{resetStyle:!1}),M=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};const w=a.forwardRef(((e,t)=>{const{prefixCls:n,rootClassName:r,className:c,style:u,flex:d,gap:f,vertical:g=!1,component:m="div",children:v}=e,h=M(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component","children"]),{flex:y,direction:x,getPrefixCls:w}=a.useContext(l.E_),C=w("flex",n),[k,j,Z]=b(C),S=null!=g?g:null==y?void 0:y.vertical,T=s()(c,r,null==y?void 0:y.className,C,j,Z,p(C,e),{[`${C}-rtl`]:"rtl"===x,[`${C}-gap-${f}`]:(0,o.n)(f),[`${C}-vertical`]:S}),K=Object.assign(Object.assign({},null==y?void 0:y.style),u);return d&&(K.flex=d),f&&!(0,o.n)(f)&&(K.gap=f),k(a.createElement(m,Object.assign({ref:t,className:T,style:K},(0,i.Z)(h,["justify","wrap","align"])),v))}));var C=w}}]);