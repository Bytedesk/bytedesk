"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2359],{15724:function(e,t,r){r.d(t,{Lp:function(){return m},Pn:function(){return h},c5:function(){return k},ln:function(){return f},p:function(){return d}});var a=r(90819),n=r.n(a),s=r(73193),i=r.n(s),o=r(89933),c=r.n(o),u=r(55735),l=r(41159);function d(e){return p.apply(this,arguments)}function p(){return(p=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/query/org",{method:"GET",params:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/create",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/update",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/delete",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/tag/delete/all",{method:"POST",data:i()(i()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},70582:function(e,t,r){r.d(t,{Z:function(){return q}});var a=r(84176),n=r.n(a),s=r(86222),i=r.n(s),o=r(90819),c=r.n(o),u=r(10154),l=r.n(u),d=r(73193),p=r.n(d),f=r(89933),g=r.n(f),m=r(45332),x=r.n(m),h=r(86803),v=r(55735),k=r(41159);function b(e){return M.apply(this,arguments)}function M(){return(M=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/black/query/org",{method:"GET",params:p()(p()({},t),{},{client:v.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return j.apply(this,arguments)}function j(){return(j=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/black/delete",{method:"POST",data:{uid:t,client:v.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(40612),S=r(36310),F=r(54881),T=r(2484),Z=r(11090),I=r(48524),L=r(61355),C=r(75365),O=r(53530),A=r(96485),E=r(28977),N=r.n(E),U=r(44194),Y=r(31549),z=["current","pageSize"],q=function(e){var t=e.isSuper,r=(0,k.useIntl)(),a=(0,U.useRef)(),s=(0,w.u)((function(e){return e.currentOrg})),o=(0,U.useState)(1),u=x()(o,2),d=u[0],f=u[1],m=(0,U.useState)(10),M=x()(m,2),j=M[0],E=M[1],q=(0,U.useState)({}),P=x()(q,2),D=P[0],R=P[1],B=(0,U.useState)(0),V=x()(B,2),H=V[0],G=V[1],K=(0,U.useState)([]),J=x()(K,2),Q=J[0],W=J[1],X=(0,U.useState)([]),$=x()(X,2),_=$[0],ee=$[1],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.blockIp"}),dataIndex:"blockIp",tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.blockIp.tooltip"}),valueEnum:{true:{text:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.yes"}),status:"Error"},false:{text:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.no"}),status:"Default"}}},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.reason"}),dataIndex:"reason",copyable:!0,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.reason.tooltip"})},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.startTime.tooltip"}),render:function(e,t){return t.startTime?N()(t.startTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.endTime.tooltip"}),render:function(e,t){return t.endTime?N()(t.endTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.userNickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"visitor.black.userNickname.tooltip"})},{title:(0,Y.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(k.FormattedMessage,{id:"message.createdAt.tooltip"}),render:function(e,t){return t.createdAt?N()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],re=[].concat(te,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,n){return[(0,Y.jsx)(L.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.blackNickname,"】？"),onConfirm:function(){return ne(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,Y.jsx)(C.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackip.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),ae=function(){var e=g()(c()().mark((function e(r,a,n){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,n),i=localStorage.getItem(v.LA8),o=p()({orgUid:t?"":(null==s?void 0:s.uid)||"",accessToken:i||"",exportType:r},Object.entries(D).reduce((function(e,t){var r=x()(t,2),a=r[0],n=r[1];return p()(p()({},e),{},l()({},a,"string"==typeof n?n:String(n)))}),{})),"current"===r?(o.pageNumber=String(d-1),o.pageSize=String(j)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==n&&(o.pageNumber=String(a),o.pageSize=String(n)),window.open((0,S.kG)()+"/api/v1/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ne=function(){var e=g()(c()().mark((function e(t){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,y(t.uid);case 4:n=e.sent,console.log("unblock response:",n),200===n.code?(null==a||null===(s=a.current)||void 0===s||s.reload(),h.yw.success(r.formatMessage({id:"unblock.success"}))):h.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),h.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=g()(c()().mark((function e(){var t,n,s,o,u,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==_.length){e.next=3;break}return h.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:h.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),n=0,s=0,o=i()(_),e.prev=7,o.s();case 9:if((u=o.n()).done){e.next=23;break}return l=u.value,e.prev=11,e.next=14,y(l.uid);case 14:200===e.sent.code?n++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:h.yw.destroy(),0===s?h.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:n})):h.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:n,fail:s})),W([]),ee([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ie=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),n=function(){var a=s,n=s*r+1,i=Math.min((s+1)*r,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(i," (").concat(i-n+1,"条)"),onClick:function(){return ae("range",a,r)}})},s=0;s<a;s++)n();return t},oe={selectedRowKeys:Q,onChange:function(e,t){W(e),ee(t)}};return(0,Y.jsx)(I.Z,{columns:re,actionRef:a,cardBordered:!0,rowSelection:oe,scroll:{x:2e3},request:function(){var e=g()(c()().mark((function e(r,a,i){var o,u,l,d,g,m,x,v;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,u=r.pageSize,l=n()(r,z),f(o),E(u),R(l),d=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],d=m,g="ascend"===a[m]?"ascend":"descend"),x=p()(p()({pageNumber:r.current-1,pageSize:u,orgUid:t?"":null==s?void 0:s.uid},l),{},{sortBy:d,sortDirection:g}),e.next=10,b(x);case 10:return v=e.sent,console.log("queryBlacks response:",v,x),200===v.code?G(v.data.totalElements):h.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),E(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.black.list"}),toolBarRender:function(){return function(){var e=[],t=[];Q.length>0&&(t.push({key:"batchUnblock",icon:(0,Y.jsx)(F.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(Q.length,")"),onClick:function(){O.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(Q.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:se,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,Y.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(C.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",Q.length,")",(0,Y.jsx)(T.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ae("current")}}];return H>0&&(H<=1e3?a.push({key:"export-all",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(H,"条)"),onClick:function(){return ae("all")}}):a.push({key:"export-range",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(H,"条)"),children:ie(H)})),e.push((0,Y.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,Y.jsxs)(C.ZP,{type:"primary",icon:(0,Y.jsx)(Z.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,Y.jsx)(T.Z,{})]})},"exportOperations")),e}()}})}},98714:function(e,t,r){r.d(t,{Z:function(){return Y}});var a=r(84176),n=r.n(a),s=r(86222),i=r.n(s),o=r(90819),c=r.n(o),u=r(73193),l=r.n(u),d=r(89933),p=r.n(d),f=r(45332),g=r.n(f),m=r(86803),x=r(55735),h=r(41159);function v(e){return k.apply(this,arguments)}function k(){return(k=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/ip/black/query/org",{method:"GET",params:l()(l()({},t),{},{client:x.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return M.apply(this,arguments)}function M(){return(M=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/ip/black/delete",{method:"POST",data:{uid:t,client:x.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=r(40612),j=r(36310),w=r(54881),S=r(2484),F=r(11090),T=r(48524),Z=r(61355),I=r(75365),L=r(53530),C=r(96485),O=r(28977),A=r.n(O),E=r(44194),N=r(31549),U=["current","pageSize"],Y=function(e){var t=e.isSuper,r=(0,h.useIntl)(),a=(0,E.useRef)(),s=(0,y.u)((function(e){return e.currentOrg})),o=(0,E.useState)(1),u=g()(o,2),d=u[0],f=u[1],k=(0,E.useState)(10),M=g()(k,2),O=M[0],Y=M[1],z=(0,E.useState)({}),q=g()(z,2),P=q[0],D=q[1],R=(0,E.useState)(0),B=g()(R,2),V=B[0],H=B[1],G=(0,E.useState)([]),K=g()(G,2),J=K[0],Q=K[1],W=(0,E.useState)([]),X=g()(W,2),$=X[0],_=X[1],ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.ip"}),dataIndex:"ip",tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.ip.tooltip"})},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.reason"}),dataIndex:"reason",tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.reason.tooltip"})},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.startTime.tooltip"}),render:function(e,t){return(0,N.jsx)("span",{children:A()(t.startTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.endTime.tooltip"}),render:function(e,t){return(0,N.jsx)("span",{children:A()(t.endTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.userNickname"}),dataIndex:"userNickname",tooltip:(0,N.jsx)(h.FormattedMessage,{id:"visitor.blackip.userNickname.tooltip"})},{title:(0,N.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(h.FormattedMessage,{id:"message.createdAt.tooltip"})}],te=[].concat(ee,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,n){return[(0,N.jsx)(Z.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return ae(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,N.jsx)(I.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackip.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),re=function(){var e=p()(c()().mark((function e(r,a,n){var i,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,n),i=localStorage.getItem(x.LA8),o=l()({orgUid:t?"":null==s?void 0:s.uid,accessToken:i||"",exportType:r},P),"current"===r?(o.pageNumber=String(d-1),o.pageSize=String(O)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==n&&(o.pageNumber=String(a),o.pageSize=String(n)),window.open((0,j.kG)()+"/api/v1/ip/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ae=function(){var e=p()(c()().mark((function e(t){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,b(t.uid);case 4:n=e.sent,console.log("unblock response:",n),200===n.code?(null==a||null===(s=a.current)||void 0===s||s.reload(),m.yw.success(r.formatMessage({id:"unblock.success"}))):m.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=p()(c()().mark((function e(){var t,n,s,o,u,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==$.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),n=0,s=0,o=i()($),e.prev=7,o.s();case 9:if((u=o.n()).done){e.next=23;break}return l=u.value,e.prev=11,e.next=14,b(l.uid);case 14:200===e.sent.code?n++:s++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),s++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:n})):m.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:n,fail:s})),Q([]),_([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),se=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),n=function(){var a=s,n=s*r+1,i=Math.min((s+1)*r,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(i," (").concat(i-n+1,"条)"),onClick:function(){return re("range",a,r)}})},s=0;s<a;s++)n();return t},ie={selectedRowKeys:J,onChange:function(e,t){Q(e),_(t)}};return(0,N.jsx)(T.Z,{columns:te,actionRef:a,cardBordered:!0,rowSelection:ie,scroll:{x:1800},request:function(){var e=p()(c()().mark((function e(r,a,i){var o,u,d,p,g,x,h,k;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,u=r.pageSize,d=n()(r,U),f(o),Y(u),D(d),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,g="ascend"===a[x]?"ascend":"descend"),h=l()(l()({pageNumber:r.current-1,pageSize:u,orgUid:t?"":null==s?void 0:s.uid},d),{},{sortBy:p,sortDirection:g}),e.next=10,v(h);case 10:return k=e.sent,console.log("queryIpBlacklists response:",k,h),200===k.code?H(k.data.totalElements):m.yw.error(k.message),e.abrupt("return",{data:k.data.content,success:!0,total:k.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){f(e),Y(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.blackip.list"}),toolBarRender:function(){return function(){var e=[],t=[];J.length>0&&(t.push({key:"batchUnblock",icon:(0,N.jsx)(w.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(J.length,")"),onClick:function(){L.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(J.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:ne,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,N.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,N.jsxs)(I.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",J.length,")",(0,N.jsx)(S.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,N.jsx)(F.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return re("current")}}];return V>0&&(V<=1e3?a.push({key:"export-all",icon:(0,N.jsx)(F.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(V,"条)"),onClick:function(){return re("all")}}):a.push({key:"export-range",icon:(0,N.jsx)(F.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(V,"条)"),children:se(V)})),e.push((0,N.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,N.jsxs)(I.ZP,{type:"primary",icon:(0,N.jsx)(F.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,N.jsx)(S.Z,{})]})},"exportOperations")),e}()}})}},1836:function(e,t,r){r.d(t,{Z:function(){return D}});var a=r(84176),n=r.n(a),s=r(90819),i=r.n(s),o=r(73193),c=r.n(o),u=r(89933),l=r.n(u),d=r(45332),p=r.n(d),f=r(86803),g=r(55735),m=r(41159);function x(e){return h.apply(this,arguments)}function h(){return(h=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.request)("/api/v1/visitor/query/org",{method:"GET",params:c()(c()({},t),{},{client:g.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return k.apply(this,arguments)}function k(){return(k=l()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.request)("/api/v1/visitor/update/tagList",{method:"POST",data:c()(c()({},t),{},{client:g.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=r(40612),M=r(36310),y=r(88721),j=r(11090),w=r(2484),S=r(48524),F=r(29266),T=r(96485),Z=r(75365),I=r(28977),L=r.n(I),C=r(44194),O=r(16309),A=r(73442),E=r(3849),N=r(44781),U=r(15724),Y=r(76750),z=r(31549),q=function(e){var t=e.open,r=e.onClose,a=e.onSubmit,n=e.visitor,s=e.orgUid,o=(0,m.useIntl)(),c=(0,Y.Z)().translateString,u=O.Z.useForm(),d=p()(u,1)[0],x=(0,C.useState)([]),h=p()(x,2),k=h[0],b=h[1],M=(0,C.useState)(!1),y=p()(M,2),j=y[0],w=y[1],S=(0,C.useMemo)((function(){var e;return 1===(null==n||null===(e=n.tagList)||void 0===e?void 0:e.length)&&""===n.tagList[0]?[]:(null==n?void 0:n.tagList)||[]}),[null==n?void 0:n.tagList]);(0,C.useEffect)((function(){t&&s&&F()}),[t,s]),(0,C.useEffect)((function(){t&&n&&d.setFieldsValue({tagList:S})}),[t,n,S,d]);var F=function(){var e=l()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,U.p)({orgUid:s,type:g.IuT});case 3:200===(t=e.sent).code?b(t.data.content||[]):f.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),f.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=l()(i()().mark((function e(){var t,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,w(!0),e.next=6,d.validateFields();case 6:return t=e.sent,e.next=9,v({uid:n.uid,tagList:t.tagList||[],orgUid:n.orgUid});case 9:200===(s=e.sent).code?(f.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),a(),r()):f.yw.error(s.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),f.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,w(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsx)(A.Z,{title:o.formatMessage({id:"edit.visitor",defaultMessage:"编辑访客"}),placement:"right",onClose:r,open:t,width:400,extra:(0,z.jsxs)(E.Z,{children:[(0,z.jsx)(Z.ZP,{onClick:r,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,z.jsx)(Z.ZP,{type:"primary",onClick:T,loading:j,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,z.jsx)(O.Z,{form:d,layout:"vertical",initialValues:{tagList:S},children:(0,z.jsx)(O.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,z.jsx)(N.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:k.map((function(e){return{label:c(e.name),value:e.name}})),filterOption:function(e,t){var r;return(null!==(r=null==t?void 0:t.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())}})})})})},P=["current","pageSize"],D=function(e){var t=e.isSuper,r=(0,m.useIntl)(),a=(0,C.useRef)(),s=(0,b.u)((function(e){return e.currentOrg})),o=(0,C.useState)(1),u=p()(o,2),d=u[0],h=u[1],v=(0,C.useState)(10),k=p()(v,2),I=k[0],O=k[1],A=(0,C.useState)({}),E=p()(A,2),N=E[0],U=E[1],Y=(0,C.useState)(0),D=p()(Y,2),R=D[0],B=D[1],V=(0,C.useState)([]),H=p()(V,2),G=H[0],K=H[1],J=(0,C.useState)([]),Q=p()(J,2),W=(Q[0],Q[1]),X=(0,C.useState)(!1),$=p()(X,2),_=$[0],ee=$[1],te=(0,C.useState)(null),re=p()(te,2),ae=re[0],ne=re[1],se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,z.jsx)(m.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.nickname.tooltip"})},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.ip"}),dataIndex:"ip",copyable:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.ip.tooltip"})},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.ipLocation"}),dataIndex:"ipLocation",copyable:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.ipLocation.tooltip"})},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status.tooltip"}),render:function(e,t){return"ONLINE"===t.status?(0,z.jsx)(F.Z,{color:"green",children:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===t.status?(0,z.jsx)(F.Z,{color:"red",children:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===t.status?(0,z.jsx)(F.Z,{color:"black",children:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status.blocked"})}):(0,z.jsx)(F.Z,{color:"default",children:(0,z.jsx)(m.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.vipLevel"}),dataIndex:"vipLevel",copyable:!0,hideInSearch:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.vipLevel.tooltip"})},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.client"}),dataIndex:"client",hideInSearch:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.client.tooltip"}),render:function(e,t){return(0,y.qF)(t.client)}},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.tagList"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.tagList.tooltip"}),render:function(e,t){var r;return null===(r=t.tagList)||void 0===r?void 0:r.map((function(e,t){return(0,z.jsx)(F.Z,{color:"green",style:{marginRight:4},children:e},t)}))}},{title:(0,z.jsx)(m.FormattedMessage,{id:"visitor.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,fixed:"right",tooltip:(0,z.jsx)(m.FormattedMessage,{id:"visitor.updatedAt.tooltip"}),render:function(e,t){return(0,z.jsx)("span",{children:L()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")})}}],ie=[].concat(se,[{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",fixed:"right",width:100,render:function(e,t){return[(0,z.jsx)("a",{onClick:function(){ne(t),ee(!0)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]}}]),oe=function(){var e=l()(i()().mark((function e(r,a,n){var o,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,n),o=localStorage.getItem(g.LA8),u=c()({orgUid:t?"":null==s?void 0:s.uid,accessToken:o||"",exportType:r},N),"current"===r?(u.pageNumber=String(d-1),u.pageSize=String(I)):"all"===r?(u.pageNumber="0",u.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==n&&(u.pageNumber=String(a),u.pageSize=String(n)),window.open((0,M.kG)()+"/api/v1/visitor/export?"+new URLSearchParams(u).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),n=function(){var a=s,n=s*r+1,i=Math.min((s+1)*r,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(i," (").concat(i-n+1,"条)"),onClick:function(){return oe("range",a,r)}})},s=0;s<a;s++)n();return t},ue={selectedRowKeys:G,onChange:function(e,t){K(e),W(t)}};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(S.Z,{columns:ie,actionRef:a,cardBordered:!0,rowSelection:ue,scroll:{x:1800},request:function(){var e=l()(i()().mark((function e(r,a,o){var u,l,d,p,g,m,v,k;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.current,l=r.pageSize,d=n()(r,P),h(u),O(l),U(d),p=void 0,g=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],p=m,g="ascend"===a[m]?"ascend":"descend"),v=c()(c()({pageNumber:r.current-1,pageSize:l,orgUid:t?"":null==s?void 0:s.uid},d),{},{sortBy:p,sortDirection:g}),e.next=10,x(v);case 10:return k=e.sent,console.log("queryVisitorsByOrg response:",k,v),200===k.code?B(k.data.totalElements):f.yw.error(k.message),e.abrupt("return",{data:k.data.content,success:!0,total:k.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){h(e),O(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.list"}),toolBarRender:function(){return e=[{key:"export-current",icon:(0,z.jsx)(j.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return oe("current")}}],R>0&&(R<=1e3?e.push({key:"export-all",icon:(0,z.jsx)(j.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(R,"条)"),onClick:function(){return oe("all")}}):e.push({key:"export-range",icon:(0,z.jsx)(j.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(R,"条)"),children:ce(R)})),[(0,z.jsx)(T.Z,{menu:{items:e},placement:"bottom",children:(0,z.jsxs)(Z.ZP,{type:"primary",icon:(0,z.jsx)(j.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,z.jsx)(w.Z,{})]})},"exportOperations")];var e}}),(0,z.jsx)(q,{open:_,onClose:function(){ee(!1),ne(null)},onSubmit:function(){var e;null===(e=a.current)||void 0===e||e.reload()},visitor:ae,orgUid:(null==ae?void 0:ae.orgUid)||(null==s?void 0:s.uid)})]})}}}]);