"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{12201:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(38404),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},r=n(5901),l=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var o=a.forwardRef(l)},54681:function(e,t,n){var i=n(90819),a=n.n(i),s=n(89933),r=n.n(s),l=n(45332),o=n.n(l),u=n(64273),d=n(50884),c=n(92936),g=n(77129),f=n(21002),v=n(28520),m=n(27353),p=n(54685),h=n(97588),x=n(17455),S=n(2290),b=n(44194),y=n(53478),M=n(97765),w=n(31549);t.Z=function(e){var t,n,i,s,l=h.A.useForm(),j=o()(l,1)[0],k=(0,S.useIntl)(),C=(0,f.Z)().translateString,T=(0,v.u)((function(e){return e.currentOrg})),Z=(0,b.useState)(),F=o()(Z,2),A=F[0],U=F[1],R=(0,b.useState)(),E=o()(R,2),q=E[0],P=E[1],L=(0,b.useState)(),I=o()(L,2),N=I[0],O=I[1],z=(0,b.useState)(""),B=o()(z,2),K=B[0],D=B[1],J=(0,b.useRef)(!1),W=(0,b.useRef)(),V=(0,b.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),Q=(0,b.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==V?void 0:V.draft)&&void 0!==t?t:null==V?void 0:V.live)&&void 0!==e?e:void 0}),[V]),Y=(0,b.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),G=(0,b.useCallback)((function(e){j.setFieldValue("welcomeTip",e),Y({welcomeTip:e})}),[j,Y]);(0,b.useEffect)((function(){if(null!=T&&T.uid&&(W.current!==T.uid&&(W.current=T.uid,J.current=!1),!J.current)){J.current=!0;var e=function(){var e=r()(a()().mark((function e(){var t,n,i,s,r,l,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:T.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,M.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(P(n),r=(null==n||null===(i=n.data)||void 0===i?void 0:i.content)||[],l=null==Q?void 0:Q.welcomeKbUid,(o=l||N||(null===(s=r[0])||void 0===s?void 0:s.uid))&&(O(o),j.setFieldValue("welcomeKbUid",o),l!==o&&Y({welcomeKbUid:o}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,k,null==Q?void 0:Q.welcomeKbUid,N,j,Y]),(0,b.useEffect)((function(){if(null!=T&&T.uid&&N){var e=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:T.uid,kbUid:N},e.next=4,(0,c.pf)(t);case 4:n=e.sent,M.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?U(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==T?void 0:T.uid,N,k]),(0,b.useEffect)((function(){if(Q){var e=null==Q?void 0:Q.welcomeFaqs,t=Array.isArray(Q.welcomeFaqUids)?Q.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==A||null===(t=A.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==Q?void 0:Q.welcomeFaqUids,Q]);var _=(0,b.useCallback)((function(e){O(e),j.setFieldValue("welcomeFaqUids",[]),Y({welcomeKbUid:e,welcomeFaqUids:[]})}),[Y,j]);return(0,b.useEffect)((function(){var e=C(null==Q?void 0:Q.welcomeTip);void 0!==e&&K!==e&&D(e),null!=Q&&Q.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",Q.welcomeKbUid),N!==Q.welcomeKbUid&&O(Q.welcomeKbUid))}),[C,null==Q?void 0:Q.welcomeTip,null==Q?void 0:Q.welcomeKbUid,K,j,N,null==q||null===(n=q.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,w.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,w.jsx)(h.A.Item,{name:"welcomeTip",label:(0,w.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,w.jsx)(y.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:K,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:G})}),(0,w.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,w.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"选择猜你想问知识库"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==q||null===(i=q.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:C(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return _(e)},allowClear:!0,placeholder:(0,w.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,w.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,w.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,w.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==V?void 0:V.live,draft:null==V?void 0:V.draft})]}),options:null==A||null===(s=A.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:C(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,w.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return Y({welcomeFaqUids:e})}}})]})}},32196:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ue}});var i=n(76711),a=n.n(i),s=n(44194),r=n(10820),l=n(2290),o=n(90819),u=n.n(o),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),v=n(45332),m=n.n(v),p=n(15911),h=n(90883),x=n(46206),S=n(31461),b=n(2887),y=n(18464),M=n(38623),w=n(50693),j=n(70937),k=n(35746),C=n(64724),T=n(12201),Z=n(88565),F=n(6430),A=n(80597),U=n(12715),R=n(47192),E=n(38086),q=n(33551),P=n(86775),L=n(65794),I=n(6992),N=n(41881),O=n(91768),z=n(28172),B=n(66556),K=n(35911),D=n(90417),J=n(9848),W=n(50884),V=n(42013),Q=n(28520),Y=n(90938),G=n(96775),_=n(27353),H=n(27318),X=n(32461),$=n(26809),ee=n(62210),te=(n(10463),n(21525)),ne=n(2533),ie=n(30722),ae=n(97247),se=n(17345),re=n(69897),le=n(54681),oe=n(73120),ue=(n(44769),n(92285)),de=(n(30881),n(24471)),ce=n(97765),ge=n(97588),fe=n(74056),ve=n(17455),me=n(31549),pe=function(e){var t=e.autoReplySettings,n=e.onAutoReplySettingsChange,i=ge.A.useForm(),a=m()(i,1)[0],r=(0,s.useRef)(!1),l=(0,s.useState)([]),o=m()(l,2),d=o[0],g=o[1],f=(0,Q.u)((function(e){return e.currentOrg})),v=(0,s.useMemo)((function(){var e;return null!==(e=null==t?void 0:t.draft)&&void 0!==e?e:null==t?void 0:t.live}),[t]),p=(0,s.useCallback)(c()(u()().mark((function e(){var t,n,i,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=2;break}return e.abrupt("return");case 2:if(null!=f&&f.uid){e.next=4;break}return e.abrupt("return");case 4:return r.current=!0,W.yw.loading("loading"),e.prev=6,t={pageNumber:0,pageSize:50,type:_.f4h,orgUid:null==f?void 0:f.uid},e.next=10,(0,de.p0)(t);case 10:n=e.sent,ce.Z.debug("TabAgentAutoReply queryRobotsByOrg:",n),200===n.code?g(null!==(i=null==n||null===(a=n.data)||void 0===a?void 0:a.content)&&void 0!==i?i:[]):W.yw.error(n.message);case 13:return e.prev=13,r.current=!1,W.yw.destroy(),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[6,,13,17]])}))),[null==f?void 0:f.uid]);return(0,s.useEffect)((function(){p()}),[p]),(0,s.useEffect)((function(){v&&a.setFieldsValue({autoReplyEnabled:null==v?void 0:v.autoReplyEnabled,autoReplyType:null==v?void 0:v.autoReplyType,takeoverEnabled:null==v?void 0:v.takeoverEnabled,robotUid:null==v?void 0:v.robotUid})}),[v,a]),(0,me.jsxs)(ge.A,{form:a,submitter:!1,onValuesChange:function(e,t){null==n||n({autoReplyEnabled:null==t?void 0:t.autoReplyEnabled,autoReplyType:null==t?void 0:t.autoReplyType,takeoverEnabled:null==t?void 0:t.takeoverEnabled,robotUid:null==t?void 0:t.robotUid})},children:[(0,me.jsx)(fe.Z,{width:"md",name:"autoReplyEnabled",label:"是否启用自动回复"}),(0,me.jsx)(ve.Z,{width:"md",name:"autoReplyType",label:"自动回复类型",options:[{label:"固定回复",value:_.DST},{label:"关键字匹配",value:_.PZ1},{label:"大模型回复",value:_.PcP}]}),(0,me.jsx)(fe.Z,{width:"md",name:"takeoverEnabled",label:"是否启用大模型接管会话"}),(0,me.jsx)(ve.Z,{width:"md",name:"robotUid",label:"接管机器人",placeholder:"请选择用于接管会话的机器人",options:d.map((function(e){return{label:(null==e?void 0:e.nickname)||(null==e?void 0:e.name)||(null==e?void 0:e.uid),value:null==e?void 0:e.uid}})),disabled:!a.getFieldValue("takeoverEnabled"),fieldProps:{allowClear:!0}})]})},he=n(11575),xe=n(61476),Se=function(){var e,t,n,i,o,d,g,v,_=(0,l.useIntl)(),de=(0,l.useAccess)(),ge=(0,Q.u)((function(e){return e.currentOrg})),fe=(0,Y.Z)(),ve=fe.leftSiderStyle,Se=(fe.contentStyle,(0,G.Z)().isDarkMode),be=(0,s.useState)(!1),ye=m()(be,2),Me=ye[0],we=ye[1],je=(0,s.useState)([]),ke=m()(je,2),Ce=ke[0],Te=ke[1],Ze=(0,s.useState)(),Fe=m()(Ze,2),Ae=Fe[0],Ue=Fe[1],Re=(0,s.useState)(""),Ee=m()(Re,2),qe=Ee[0],Pe=Ee[1],Le=(0,s.useState)("tips"),Ie=m()(Le,2),Ne=Ie[0],Oe=Ie[1],ze=(0,s.useState)(!1),Be=m()(ze,2),Ke=Be[0],De=Be[1],Je=(0,s.useState)(null),We=m()(Je,2),Ve=We[0],Qe=We[1],Ye=(0,s.useState)(!1),Ge=m()(Ye,2),_e=Ge[0],He=Ge[1],Xe=(0,s.useMemo)((function(){return Ce.find((function(e){return e.uid===Ae}))||null}),[Ce,Ae]),$e=(0,s.useState)(!1),et=m()($e,2),tt=et[0],nt=et[1],it=(0,s.useState)(!1),at=m()(it,2),st=at[0],rt=at[1],lt=(0,X.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),ot=lt.setCurrentAgentSettings,ut=lt.currentAgentSettings,dt=(0,s.useState)(!1),ct=m()(dt,2),gt=ct[0],ft=ct[1],vt=(0,s.useRef)(""),mt=(0,s.useMemo)((function(){var e;return null!==(e=null!=ut?ut:Xe)&&void 0!==e?e:null}),[ut,Xe]),pt=(0,s.useMemo)((function(){var e;return null==de||null===(e=de.getModulePermission)||void 0===e?void 0:e.call(de,H.MY.AGENT_SETTINGS)}),[de]),ht=null!==(e=null==pt||null===(t=pt.canRead)||void 0===t?void 0:t.call(pt))&&void 0!==e&&e,xt=null!==(n=null==pt||null===(i=pt.canCreate)||void 0===i?void 0:i.call(pt))&&void 0!==n&&n,St=null!==(o=null==pt||null===(d=pt.canUpdate)||void 0===d?void 0:d.call(pt))&&void 0!==o&&o,bt=null!==(g=null==pt||null===(v=pt.canDelete)||void 0===v?void 0:v.call(pt))&&void 0!==g&&g,yt=(0,s.useRef)(!1),Mt=function(e,t){W.yw.warning(_.formatMessage({id:e,defaultMessage:t}))},wt=(0,s.useCallback)((function(e){if(ut){var t=ut.draftServiceSettings||ut.serviceSettings||{};ot(f()(f()({},ut),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[ut,ot]),jt=(0,s.useCallback)((function(e){if(ut){var t=ut.draftTriggerSettings||ut.triggerSettings||{};ot(f()(f()({},ut),{},{draftTriggerSettings:f()(f()({},t),e)}))}}),[ut,ot]),kt=(0,s.useCallback)((function(e){if(ut){var t=ut.draftInviteSettings||ut.inviteSettings||{};ot(f()(f()({},ut),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[ut,ot]),Ct=((0,s.useCallback)((function(e){if(ut){var t=ut.draftIntentionSettings||ut.intentionSettings||{};ot(f()(f()({},ut),{},{draftIntentionSettings:f()(f()({},t),e)}))}}),[ut,ot]),(0,s.useCallback)((function(e){if(ut){var t=ut.draftEmotionSettings||ut.emotionSettings||{};ot(f()(f()({},ut),{},{draftEmotionSettings:f()(f()({},t),e)}))}}),[ut,ot]),(0,s.useCallback)((function(e){if(ut){var t=ut.draftSummarySettings||ut.summarySettings||{};ot(f()(f()({},ut),{},{draftSummarySettings:f()(f()({},t),e)}))}}),[ut,ot]),(0,s.useCallback)((function(e){if(ut){var t=ut.draftAutoReplySettings||ut.autoReplySettings||{};ot(f()(f()({},ut),{},{draftAutoReplySettings:f()(f()({},t),e)}))}}),[ut,ot])),Tt=(0,s.useCallback)((function(e){if(ut){var t=ut.draftMessageLeaveSettings||ut.messageLeaveSettings||{};ot(f()(f()({},ut),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[ut,ot]),Zt=(0,s.useCallback)((function(e){if(ut){var t=ut.draftWorktimeSettings||ut.worktimeSettings||{};ot(f()(f()({},ut),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[ut,ot]),Ft=(0,s.useCallback)((function(e){if(ut){var t=ut.draftQueueSettings||ut.queueSettings||{};ot(f()(f()({},ut),{},{draftQueueSettings:f()(f()({},t),e)}))}}),[ut,ot]),At=(0,s.useCallback)((function(e){ut&&ot(f()(f()({},ut),{},{draftRightPanelTabs:e}))}),[ut,ot]),Ut=(0,s.useCallback)((function(e){ut&&ot(f()(f()({},ut),e))}),[ut,ot]),Rt=(0,s.useMemo)((function(){if(!qe)return Ce;var e=qe.toLowerCase();return Ce.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[Ce,qe]),Et=(0,s.useCallback)(function(){var e=c()(u()().mark((function e(t,n){var i,a,s,r,l,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=ge&&ge.uid){e.next=2;break}return e.abrupt("return");case 2:if(ht){e.next=9;break}return yt.current||(yt.current=!0,Mt("agent_settings.permission.read.denied","无权限：查看客服配置")),Te([]),Ue(void 0),ot(null),ft(!1),e.abrupt("return");case 9:return we(!0),i="welcome",e.prev=11,s=(null!=t?t:"").trim(),r={orgUid:ge.uid,pageNumber:0,pageSize:100,searchText:s||void 0},e.next=16,(0,V.u9)(r);case 16:l=e.sent,ce.Z.debug("加载客服配置模板列表: ",l,r),o=(null==l||null===(a=l.data)||void 0===a?void 0:a.content)||[],Te(o),!(o.length>0)||Ae&&o.some((function(e){return e.uid===Ae}))||(Ue(o[0].uid),null!=n&&n.keepActive||Oe(i));case 21:return e.prev=21,we(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[11,,21,24]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==ge?void 0:ge.uid,Ae,ht,ot]);(0,s.useEffect)((function(){Et(qe)}),[null==ge?void 0:ge.uid]),(0,s.useEffect)((function(){Xe?(ot(Xe),vt.current=JSON.stringify(null!=Xe?Xe:{}),ft(!1)):(ot(null),vt.current=JSON.stringify({}),ft(!1))}),[Xe]),(0,s.useEffect)((function(){if(Xe)try{var e=JSON.stringify(null!=ut?ut:{});ft(e!==vt.current)}catch(e){ft(!0)}}),[ut,null==Xe?void 0:Xe.uid]);var qt=function(){var e=c()(u()().mark((function e(t){var n,i,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(bt){e.next=3;break}return Mt("agent_settings.permission.delete.denied","无权限：删除客服配置"),e.abrupt("return");case 3:if(null!=(n=null!=t?t:Xe)&&n.uid){e.next=6;break}return e.abrupt("return");case 6:return i={uid:n.uid,orgUid:null==ge?void 0:ge.uid,pageNumber:0,pageSize:100},e.next=9,(0,V.SJ)(i);case 9:a=e.sent,console.log("删除客服配置模板结果：",a,i),a&&200===a.code?(W.yw.success(_.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),Et(qe)):W.yw.error((null==a?void 0:a.message)||_.formatMessage({id:"delete.error",defaultMessage:"删除失败"}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pt=function(){var e=c()(u()().mark((function e(t,n){var i,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(St){e.next=3;break}return Mt("agent_settings.permission.update.denied","无权限：编辑客服配置"),e.abrupt("return");case 3:if(e.prev=3,i={uid:t,orgUid:null==ge?void 0:ge.uid},!n){e.next=11;break}return e.next=8,(0,V.RB)(i);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,V.iO)(i);case 13:e.t0=e.sent;case 14:(a=e.t0)&&200===a.code?(W.yw.success(_.formatMessage({id:n?"common.enabled":"common.disabled",defaultMessage:n?"已启用":"已停用"})),Et(qe)):W.yw.error((null==a?void 0:a.message)||_.formatMessage({id:"operation.failed",defaultMessage:"操作失败"})),e.next=22;break;case 18:e.prev=18,e.t1=e.catch(3),console.error("切换启用状态失败:",e.t1),W.yw.error(_.formatMessage({id:"operation.failed",defaultMessage:"操作失败"}));case 22:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(t,n){return e.apply(this,arguments)}}(),Lt=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},It=function(e){if(e){var t=Lt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","inputAssociationEnabled","inputAssociationKbUid","inputPreviewEnabled","inputPreviewAlwaysShow","inputPreviewShowSeconds","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickButtons","quickButtonUids","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","requireLogin","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var a=null==e?void 0:e[i];if(Array.isArray(a)){var s=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickButtonUids","quickButtons"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs");var i=function(e){if(e)return Lt(e,["smile","upload","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},Nt=function(e){if(e){var t=null==e?void 0:e.triggers;return Array.isArray(t)?{uid:null==e?void 0:e.uid,triggers:t.map((function(e){return{uid:null==e?void 0:e.uid,triggerKey:null==e?void 0:e.triggerKey,enabled:null==e?void 0:e.enabled,type:null==e?void 0:e.type,name:null==e?void 0:e.name,description:null==e?void 0:e.description,config:null==e?void 0:e.config}}))}:Lt(e,["uid"])}},Ot=function(e){if(e)return Lt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},zt=function(e){if(e)return Lt(e,["name","description","color","order","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},Bt=function(e){if(e)return Lt(e,["name","description","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},Kt=function(e){if(e)return Lt(e,["name","description","defaultTemplate","robotUid","enabled","executionTiming","triggerScope","triggerEveryNMessages","triggerCooldownSeconds","triggerCooldownOnly"])},Dt=function(e){if(e)return Lt(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},Jt=function(e){if(e)return Lt(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},Wt=function(e){if(e)return Lt(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},Vt=function(e){if(e)return Lt(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid","takeoverEnabled","robotUid"])},Qt=function(e){if(e)return Lt(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},Yt=function(e){if(e)return Lt(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},Gt=function(e){return(Array.isArray(e)?e:[]).filter((function(e){return!(null==e||!e.title||null==e||!e.url)})).map((function(e){return{title:String(e.title),url:String(e.url)}}))},_t=function(){var e=c()(u()().mark((function e(){var t,n,i,a,s,r,l,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(St){e.next=3;break}return Mt("settings.no.permission.update","没有更新权限"),e.abrupt("return");case 3:if(null!=Xe&&Xe.uid){e.next=6;break}return W.yw.warning(_.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),e.abrupt("return");case 6:return nt(!0),e.prev=7,n=ut&&ut.uid===Xe.uid?ut:Xe,i=function(e,t){return f()(f()({},e||{}),t||{})},a={uid:Xe.uid,orgUid:null==ge?void 0:ge.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,isDefault:null==n?void 0:n.isDefault,enabled:null==n?void 0:n.enabled,serviceSettings:It(i(null==n?void 0:n.serviceSettings,null==n?void 0:n.draftServiceSettings)),triggerSettings:Nt(i(null==n?void 0:n.triggerSettings,null==n?void 0:n.draftTriggerSettings)),inviteSettings:Ot(i(null==n?void 0:n.inviteSettings,null==n?void 0:n.draftInviteSettings)),intentionSettings:zt(i(null==n?void 0:n.intentionSettings,null==n?void 0:n.draftIntentionSettings)),emotionSettings:Bt(i(null==n?void 0:n.emotionSettings,null==n?void 0:n.draftEmotionSettings)),summarySettings:Kt(i(null==n?void 0:n.summarySettings,null==n?void 0:n.draftSummarySettings)),maxThreadCount:null==n?void 0:n.maxThreadCount,allowAgentCloseThread:null==n?void 0:n.allowAgentCloseThread,timeoutRemindEnabled:null==n?void 0:n.timeoutRemindEnabled,timeoutRemindTime:null==n?void 0:n.timeoutRemindTime,timeoutRemindTip:null==n?void 0:n.timeoutRemindTip,messageLeaveSettings:Dt(i(null==n?void 0:n.messageLeaveSettings,null==n?void 0:n.draftMessageLeaveSettings)),worktimeSettings:Wt(i(null==n?void 0:n.worktimeSettings,null==n?void 0:n.draftWorktimeSettings)),autoReplySettings:Vt(i(null==n?void 0:n.autoReplySettings,null==n?void 0:n.draftAutoReplySettings)),queueSettings:Jt(i(null==n?void 0:n.queueSettings,null==n?void 0:n.draftQueueSettings)),rateDownSettings:Qt(i(null==n?void 0:n.rateDownSettings,null==n?void 0:n.draftRateDownSettings)),agentStatusSettings:Yt(i(null==n?void 0:n.agentStatusSettings,null==n?void 0:n.draftAgentStatusSettings)),rightPanelTabs:Gt(null!==(t=null==n?void 0:n.draftRightPanelTabs)&&void 0!==t?t:null==n?void 0:n.rightPanelTabs)},e.next=13,(0,V.wU)(a);case 13:s=e.sent,console.log("保存客服配置模板结果：",s,a),s&&200===s.code?(W.yw.success(_.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),o=null!==(r=null!==(l=null==s?void 0:s.data)&&void 0!==l?l:n)&&void 0!==r?r:{},vt.current=JSON.stringify(o),ft(!1),Et(qe,{keepActive:!0})):W.yw.error((null==s?void 0:s.message)||_.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("保存失败:",e.t0),W.yw.error(_.formatMessage({id:"save.failed",defaultMessage:"保存失败"}));case 22:return e.prev=22,nt(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),Ht=function(){var e=c()(u()().mark((function e(){var t,n,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(St){e.next=3;break}return Mt("settings.no.permission.publish","没有发布权限"),e.abrupt("return");case 3:if(null!=Xe&&Xe.uid){e.next=6;break}return W.yw.warning(_.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),e.abrupt("return");case 6:if(rt(!0),e.prev=7,!gt){e.next=11;break}return e.next=11,_t();case 11:return t={uid:Xe.uid,orgUid:null==ge?void 0:ge.uid},e.next=14,(0,V.Xy)(t);case 14:(n=e.sent)&&200===n.code?(W.yw.success(_.formatMessage({id:"common.published",defaultMessage:"发布成功"})),vt.current=JSON.stringify(null!==(i=null==n?void 0:n.data)&&void 0!==i?i:{}),ft(!1),Et(qe)):W.yw.error((null==n?void 0:n.message)||_.formatMessage({id:"publish.failed",defaultMessage:"发布失败"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("发布失败:",e.t0),W.yw.error(_.formatMessage({id:"publish.failed",defaultMessage:"发布失败"}));case 22:return e.prev=22,rt(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])})));return function(){return e.apply(this,arguments)}}(),Xt=(0,s.useMemo)((function(){var e;return null!=Xe&&Xe.uid?[{key:"welcome",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(T.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,me.jsx)(le.Z,{serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},onServiceSettingsChange:wt})},{key:"tips",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(Z.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,me.jsx)(re.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},onServiceSettingsChange:wt})},{key:"service",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(F.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,me.jsx)(se.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},agentMeta:{maxThreadCount:null==mt?void 0:mt.maxThreadCount,allowAgentCloseThread:null===(e=null==mt?void 0:mt.allowAgentCloseThread)||void 0===e||e,timeoutRemindTime:null==mt?void 0:mt.timeoutRemindTime},onServiceSettingsChange:wt,onAgentMetaChange:Ut})}].concat(a()((0,xe.OJ)()?[{key:"autoReply",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(A.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"autoreply",defaultMessage:"自动回复"})]}),children:(0,me.jsx)(pe,{autoReplySettings:{live:null==mt?void 0:mt.autoReplySettings,draft:null==mt?void 0:mt.draftAutoReplySettings},onAutoReplySettingsChange:Ct})}]:[]),a()((0,xe.OJ)()?[{key:"inputAssociation",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(U.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.input.association",defaultMessage:"输入联想"})]}),children:(0,me.jsx)(ee.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},onServiceSettingsChange:wt})}]:[]),a()((0,xe.OJ)()?[{key:"rate",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(R.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,me.jsx)($.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},onServiceSettingsChange:wt})}]:[]),a()((0,xe.OJ)()?[{key:"messageLeave",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(E.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,me.jsx)(oe.Z,{variant:"agent",messageLeaveSettings:{live:null==mt?void 0:mt.messageLeaveSettings,draft:null==mt?void 0:mt.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Tt})}]:[]),a()((0,xe.OJ)()?[{key:"queue",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(he.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"agent.settings.queue",defaultMessage:"排队设置"})]}),children:(0,me.jsx)(ue.Z,{variant:"agent",queueSettings:{live:null==mt?void 0:mt.queueSettings,draft:null==mt?void 0:mt.draftQueueSettings},onQueueSettingsChange:Ft})}]:[]),a()([]),a()([]),a()((0,xe.OJ)()?[{key:"toolbar",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(q.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,me.jsx)(ie.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},settingsUid:Xe.uid,isActive:"toolbar"===Ne,onServiceSettingsChange:wt})}]:[]),a()((0,xe.OJ)()?[{key:"right",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(P.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,me.jsx)(te.Z,{variant:"agent",serviceSettings:{live:null==mt?void 0:mt.serviceSettings,draft:null==mt?void 0:mt.draftServiceSettings},agentRightPanelTabs:{live:null==mt?void 0:mt.rightPanelTabs,draft:null==mt?void 0:mt.draftRightPanelTabs},onServiceSettingsChange:wt,onAgentRightPanelTabsChange:At,settingsUid:Xe.uid,isActive:"right"===Ne})}]:[]),a()((0,xe.OJ)()?[{key:"trigger",label:(0,me.jsxs)("span",{children:[(0,me.jsx)(L.Z,{})," ",(0,me.jsx)(l.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"})]}),children:(0,me.jsx)(ne.Z,{variant:"agent",triggerSettings:{live:null==mt?void 0:mt.triggerSettings,draft:null==mt?void 0:mt.draftTriggerSettings},onTriggerSettingsChange:jt})}]:[]),a()([])):[]}),[null==Xe?void 0:Xe.uid,mt,wt,kt,Tt,Zt,Ft,At,_,Ne]);return(0,me.jsxs)(me.Fragment,{children:[(0,me.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,me.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:ve,children:(0,me.jsxs)(J.Z,{title:_.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:xt?(0,me.jsx)(h.ZP,{size:"small",icon:(0,me.jsx)(I.Z,{}),type:"primary",onClick:function(){xt?(Qe(null),De(!0)):Mt("agent_settings.permission.create.denied","无权限：创建客服配置")},children:(0,me.jsx)(l.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}):null,bodyStyle:{padding:8},loading:Me,children:[(0,me.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,me.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,me.jsx)(S.Z,{placeholder:_.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:qe,onChange:function(e){return Pe(e.target.value)},onPressEnter:function(e){Et(qe)},allowClear:!0,size:"middle"}),(0,me.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return Et(qe)},children:(0,me.jsx)(l.FormattedMessage,{id:"pages.common.search",defaultMessage:"搜索"})})]})}),(0,me.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,me.jsx)(b.Z,{dataSource:Rt,locale:{emptyText:(0,me.jsx)(y.Z,{description:_.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,me.jsx)(b.Z.Item,{style:Ae===e.uid?{backgroundColor:Se?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return Ue(e.uid)},children:(0,me.jsx)(b.Z.Item.Meta,{title:(0,me.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,me.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,me.jsx)(x.Z,{size:4,children:e.isDefault?(0,me.jsx)(M.Z,{color:"blue",children:(0,me.jsx)(l.FormattedMessage,{id:"pages.common.default",defaultMessage:"默认"})}):null})]}),description:e.description?(0,me.jsx)("div",{style:{color:Se?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,me.jsx)(p.Z.Panel,{children:Xe?(0,me.jsx)(J.Z,{title:(0,me.jsxs)(x.Z,{children:[(0,me.jsxs)("span",{children:[_.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",Xe.name||Xe.uid]}),(0,me.jsx)(w.Z,{checked:Xe.enabled,onChange:function(e){return Pt(Xe.uid,e)},checkedChildren:_.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:_.formatMessage({id:"common.disabled",defaultMessage:"停用"}),disabled:!St}),St?(0,me.jsx)(h.ZP,{size:"small",icon:(0,me.jsx)(N.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=Xe,St?(Qe(null!=t?t:Xe),De(!0)):Mt("agent_settings.permission.update.denied","无权限：编辑客服配置")},children:(0,me.jsx)(l.FormattedMessage,{id:"pages.common.edit",defaultMessage:"编辑"})}):null,bt?(0,me.jsx)(j.Z,{title:_.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),qt(Xe)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:_.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:_.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,me.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,me.jsx)(O.Z,{}),onClick:function(e){e.stopPropagation()},children:(0,me.jsx)(l.FormattedMessage,{id:"pages.common.delete",defaultMessage:"删除"})})}):null,Xe.isDefault?(0,me.jsx)(M.Z,{color:"blue",children:(0,me.jsx)(l.FormattedMessage,{id:"pages.common.default",defaultMessage:"默认"})}):null]}),extra:(0,me.jsxs)(x.Z,{children:[(0,me.jsx)(j.Z,{title:_.formatMessage({id:"settings.publish.online.title",defaultMessage:"发布到线上环境"}),description:_.formatMessage({id:"settings.publish.online.desc",defaultMessage:"只有发布之后，才会应用到线上环境"}),okText:_.formatMessage({id:"settings.publish.online.ok",defaultMessage:"继续发布"}),cancelText:_.formatMessage({id:"common.cancel",defaultMessage:"取消"}),onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),Ht()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,me.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:st,type:"default",icon:(0,me.jsx)(z.Z,{}),disabled:!St,children:(0,me.jsx)(l.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,me.jsx)(h.ZP,{onClick:function(e){e.stopPropagation(),He(!0)},type:"default",icon:(0,me.jsx)(B.Z,{}),disabled:!St,children:(0,me.jsx)(l.FormattedMessage,{id:"settings.gray.publish",defaultMessage:"灰度发布"})}),(0,me.jsx)(h.ZP,{onClick:function(){Xe&&(ot(Xe),vt.current=JSON.stringify(null!=Xe?Xe:{}),ft(!1))},disabled:!gt||!St,icon:(0,me.jsx)(K.Z,{}),children:(0,me.jsx)(l.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,me.jsx)(h.ZP,{type:"primary",loading:tt,onClick:_t,disabled:!gt||!St,icon:(0,me.jsx)(D.Z,{}),children:(0,me.jsx)(l.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,me.jsx)(r.Z,{activeKey:Ne,onChange:Oe,items:Xt,style:{minHeight:"calc(100vh - 280px)"}})}):(0,me.jsx)(J.Z,{children:(0,me.jsx)(y.Z,{description:_.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,me.jsx)(ae.Z,{open:Ke,onOpenChange:De,orgUid:(null==ge?void 0:ge.uid)||"",record:Ve,onSuccess:function(){De(!1),Et(qe)}}),(0,me.jsxs)(k.Z,{title:_.formatMessage({id:"settings.gray.publish.title",defaultMessage:"灰度发布说明"}),open:_e,onCancel:function(){return He(!1)},footer:[(0,me.jsx)(h.ZP,{onClick:function(){return He(!1)},children:(0,me.jsx)(l.FormattedMessage,{id:"common.close",defaultMessage:"关闭"})},"close"),(0,me.jsx)(h.ZP,{type:"primary",onClick:function(){He(!1),l.history.push("/service/channel")},children:(0,me.jsx)(l.FormattedMessage,{id:"settings.gray.publish.go.channel",defaultMessage:"前往渠道页面获取链接"})},"go")],children:[(0,me.jsx)(C.Z.Paragraph,{children:(0,me.jsx)(l.FormattedMessage,{id:"settings.gray.publish.p1",defaultMessage:"灰度发布用于测试当前草稿（draft）配置，点击保存，但未点击发布，不会影响线上环境。"})}),(0,me.jsx)(C.Z.Paragraph,{children:(0,me.jsx)(l.FormattedMessage,{id:"settings.gray.publish.p2",defaultMessage:"在渠道页面生成链接时勾选“灰度测试”，链接会追加 {draft1}；嵌入式脚本会在 {chatConfig} 中增加 {draftTrue}。",values:{draft1:(0,me.jsx)(C.Z.Text,{code:!0,children:"draft=1"}),chatConfig:(0,me.jsx)(C.Z.Text,{code:!0,children:"chatConfig"}),draftTrue:(0,me.jsx)(C.Z.Text,{code:!0,children:"draft: true"})}})})]})]})},be=n(85306),ye=n(84176),Me=n.n(ye);function we(e){return je.apply(this,arguments)}function je(){return(je=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/agent/status/query/org",{method:"GET",params:f()(f()({},t),{},{channel:_.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ke=n(77601),Ce=n(94011),Te=n(96596),Ze=n.n(Te),Fe=["current","pageSize"],Ae=function(){var e=(0,l.useIntl)(),t=(0,s.useRef)(),n=(0,s.useState)(1),i=m()(n,2),a=i[0],r=i[1],o=(0,s.useState)(10),d=m()(o,2),g=d[0],v=d[1],p=(0,Q.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,me.jsx)(l.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,me.jsx)(l.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,me.jsx)(me.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,me.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,me.jsx)(l.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,me.jsx)(M.Z,{color:"green",children:(0,me.jsx)(l.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,me.jsx)(M.Z,{color:"red",children:(0,me.jsx)(l.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,me.jsx)(M.Z,{color:"orange",children:(0,me.jsx)(l.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,me.jsx)(l.FormattedMessage,{id:"agent.status.duration",defaultMessage:"Duration"}),dataIndex:"durationSeconds",hideInSearch:!0,tooltip:(0,me.jsx)(l.FormattedMessage,{id:"agent.tooltip.duration",defaultMessage:"Time spent before next status"}),render:function(e,t){return function(e){if(null==e)return"-";var t=Math.max(0,Math.floor(e)),n=Math.floor(t/86400),i=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),s=t%60,r=[];return n>0&&r.push("".concat(n,"d")),(i>0||n>0)&&r.push("".concat(i,"h")),(a>0||i>0||n>0)&&r.push("".concat(a,"m")),r.push("".concat(s,"s")),r.join(" ")}(t.durationSeconds)}},{title:(0,me.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,me.jsx)(l.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,i){return Ze()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],S=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ce.Z.debug("handleExportExcel",a,g),t=localStorage.getItem(_.LA8),window.open((0,xe.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==p?void 0:p.uid)||"",pageNumber:String(a-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,me.jsx)(ke.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,i){var a,s,l,o,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ce.Z.debug("request:",t,n,i),a=t.current,s=t.pageSize,l=Me()(t,Fe),r(a),v(s),o=f()({pageNumber:a-1,pageSize:s,orgUid:null==p?void 0:p.uid},l),e.next=7,we(o);case 7:return d=e.sent,ce.Z.debug("queryAgentStatusByOrg response:",o,d),200===d.code||W.yw.error(d.message),e.abrupt("return",{data:null==d?void 0:d.data.content,success:!0,total:null==d?void 0:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){r(e),v(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,me.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,me.jsx)(K.Z,{}),children:(0,me.jsx)(l.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,me.jsx)(h.ZP,{onClick:S,type:"primary",icon:(0,me.jsx)(Ce.Z,{}),children:(0,me.jsx)(l.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},Ue=function(){var e,t,n,i,s,o,u,d,c=(0,l.useAccess)(),g=null!==(e=null==c||null===(t=c.hasAnyModulePermission)||void 0===t?void 0:t.call(c,H.MY.AGENT))&&void 0!==e&&e,f=null!==(n=null==c||null===(i=c.hasAnyModulePermission)||void 0===i?void 0:i.call(c,H.MY.AGENT_SETTINGS))&&void 0!==n&&n,v=null!==(s=null==c||null===(o=c.hasAnyModulePermission)||void 0===o?void 0:o.call(c,H.MY.AGENT_STATUS))&&void 0!==s&&s,m=[].concat(a()(g?[{key:"table",label:(0,me.jsx)(l.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,me.jsx)(be.Z,{})}]:[]),a()(f?[{key:"settings",label:(0,me.jsx)(l.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,me.jsx)(Se,{})}]:[]),a()(v?[{key:"agentStatus",label:(0,me.jsx)(l.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,me.jsx)(Ae,{})}]:[]));if(0===m.length)return null;var p=String(null!==(u=null===(d=m[0])||void 0===d?void 0:d.key)&&void 0!==u?u:"table");return(0,me.jsx)(r.Z,{defaultActiveKey:p,style:{padding:"10px"},items:m})}}}]);