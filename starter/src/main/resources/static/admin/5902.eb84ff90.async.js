"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5902],{11090:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(83910),s=a(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(54183),i=function(e,t){return s.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:n}))};var d=s.forwardRef(i)},2484:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(83910),s=a(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=a(54183),i=function(e,t){return s.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:n}))};var d=s.forwardRef(i)},32503:function(e,t,a){a.d(t,{XS:function(){return c},k4:function(){return g},uu:function(){return M},yr:function(){return m}});var r=a(90819),s=a.n(r),n=a(73193),o=a.n(n),i=a(89933),d=a.n(i),l=a(94976),u=a(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},45067:function(e,t,a){a.d(t,{Lp:function(){return m},Pn:function(){return M},c5:function(){return v},ln:function(){return g},p:function(){return c}});var r=a(90819),s=a.n(r),n=a(73193),o=a.n(n),i=a(89933),d=a.n(i),l=a(94976),u=a(4628);function c(e){return f.apply(this,arguments)}function f(){return(f=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/create",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/update",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return x.apply(this,arguments)}function x(){return(x=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete/all",{method:"POST",data:o()(o()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},34075:function(e,t,a){a.d(t,{Z:function(){return W}});var r=a(84176),s=a.n(r),n=a(73193),o=a.n(n),i=a(86222),d=a.n(i),l=a(90819),u=a.n(l),c=a(89933),f=a.n(c),g=a(10154),p=a.n(g),m=a(45332),h=a.n(m),M=a(43388),x=a(4628);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/update/admin",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/delete",{method:"POST",data:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=a(74171),I=a(94976),F=a(58620),T=a(54881),Z=a(11090),C=a(2484),A=a(34512),E=a(27729),D=a(90581),N=a(43275),R=a(28508),U=a(69533),O=a(44194),P=a(16658),L=a(69705),q=a(30857),z=a(30310),B=a(69174),_=a(45067),Y=a(88722),H=a(31549),G=function(e){var t=e.open,a=e.onClose,r=e.onSubmit,s=e.thread,n=e.orgUid,o=(0,x.useIntl)(),i=(0,Y.Z)().translateString,d=L.Z.useForm(),l=h()(d,1)[0],c=(0,O.useState)([]),g=h()(c,2),p=g[0],m=g[1],v=(0,O.useState)(!1),y=h()(v,2),w=y[0],j=y[1],k=(0,O.useMemo)((function(){var e;return 1===(null==s||null===(e=s.tagList)||void 0===e?void 0:e.length)&&""===s.tagList[0]?[]:(null==s?void 0:s.tagList)||[]}),[null==s?void 0:s.tagList]);(0,O.useEffect)((function(){t&&n&&S()}),[t,n]),(0,O.useEffect)((function(){t&&s&&l.setFieldsValue({tagList:k,status:s.status})}),[t,s,k,l]);var S=function(){var e=f()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,_.p)({orgUid:n,type:I.bDv});case 3:200===(t=e.sent).code?m((null==t?void 0:t.data.content)||[]):M.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),M.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=f()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,j(!0),e.next=6,l.validateFields();case 6:return t=e.sent,e.next=9,b({uid:s.uid,status:t.status,tagList:t.tagList||[],orgUid:s.orgUid});case 9:200===(n=e.sent).code?(M.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),r(),a()):M.yw.error(n.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),M.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,j(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,H.jsx)(q.Z,{title:o.formatMessage({id:"edit.thread",defaultMessage:"编辑会话"}),placement:"right",onClose:a,open:t,width:400,extra:(0,H.jsxs)(z.Z,{children:[(0,H.jsx)(U.ZP,{onClick:a,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,H.jsx)(U.ZP,{type:"primary",onClick:F,loading:w,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,H.jsxs)(L.Z,{form:l,layout:"vertical",initialValues:{tagList:k,status:null==s?void 0:s.status},children:[(0,H.jsx)(L.Z.Item,{name:"status",label:o.formatMessage({id:"thread.status",defaultMessage:"状态"}),rules:[{required:!0,message:o.formatMessage({id:"thread.status.required",defaultMessage:"请选择状态"})}],children:(0,H.jsx)(B.Z,{allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"thread.status.select",defaultMessage:"请选择状态"}),options:[{value:I.ach,label:o.formatMessage({id:"thread.process.status.new",defaultMessage:"新会话"})},{value:I.j0C,label:o.formatMessage({id:"thread.process.status.roboting",defaultMessage:"机器人接待中"})},{value:I.Q7C,label:o.formatMessage({id:"thread.process.status.offline",defaultMessage:"客服离线"})},{value:I.v1N,label:o.formatMessage({id:"thread.process.status.queuing",defaultMessage:"排队中"})},{value:I.hl2,label:o.formatMessage({id:"thread.process.status.chatting",defaultMessage:"对话中"})},{value:I.DS2,label:o.formatMessage({id:"thread.process.status.timeout",defaultMessage:"超时"})},{value:I.V1n,label:o.formatMessage({id:"thread.process.status.closed",defaultMessage:"已结束"})}],filterOption:function(e,t){var a;return(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:"").toString().toLowerCase().includes(e.toLowerCase())}})}),(0,H.jsx)(L.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,H.jsx)(B.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:p.map((function(e){return{label:i(e.name),value:e.name}})),filterOption:function(e,t){var a;return(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}})})]})})},V=a(85977),J=a(67242),K=["current","pageSize"],W=function(e){var t,a,r,n,i,l,c,g,m=e.type,y=e.superUser,b=(0,x.useIntl)(),w=(0,Y.Z)().translateString,k=(0,O.useRef)(),L=(0,O.useState)(1),q=h()(L,2),z=q[0],B=q[1],_=(0,O.useState)(10),W=h()(_,2),X=W[0],Q=W[1],$=(0,S.u)((function(e){return e.currentOrg})),ee=E.Z.useModal(),te=h()(ee,2),ae=te[0],re=te[1],se=(0,O.useState)([]),ne=h()(se,2),oe=ne[0],ie=ne[1],de=(0,O.useState)([]),le=h()(de,2),ue=le[0],ce=le[1],fe=(0,O.useState)(0),ge=h()(fe,2),pe=ge[0],me=ge[1],he=(0,O.useState)({}),Me=h()(he,2),xe=Me[0],ve=Me[1],ye=(0,O.useState)(!1),be=h()(ye,2),we=be[0],je=be[1],ke=(0,O.useState)(null),Se=h()(ke,2),Ie=Se[0],Fe=Se[1],Te=(0,x.useAccess)(),Ze=(0,O.useMemo)((function(){var e;return null==Te||null===(e=Te.getModulePermission)||void 0===e?void 0:e.call(Te,V.MY.THREAD)}),[Te]),Ce=null!==(t=null==Ze||null===(a=Ze.canRead)||void 0===a?void 0:a.call(Ze))&&void 0!==t&&t,Ae=null!==(r=null==Ze||null===(n=Ze.canExport)||void 0===n?void 0:n.call(Ze))&&void 0!==r&&r,Ee=null!==(i=null==Ze||null===(l=Ze.canUpdate)||void 0===l?void 0:l.call(Ze))&&void 0!==i&&i,De=null!==(c=null==Ze||null===(g=Ze.canDelete)||void 0===g?void 0:g.call(Ze))&&void 0!==c&&c,Ne=function(e,t){M.yw.warning(b.formatMessage({id:e,defaultMessage:t}))},Re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,ellipsis:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,H.jsx)(H.Fragment,{children:w(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",copyable:!0,ellipsis:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.agentNickname.tooltip"}),render:function(e,t){var a,r;return(0,H.jsx)(H.Fragment,{children:null!=t&&null!==(a=t.agentProtobuf)&&void 0!==a&&a.nickname?null==t||null===(r=t.agentProtobuf)||void 0===r?void 0:r.nickname:"无"})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",copyable:!0,ellipsis:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.robotNickname.tooltip"}),render:function(e,t){var a,r;return(0,H.jsx)(H.Fragment,{children:null!=t&&null!==(a=t.robotProtobuf)&&void 0!==a&&a.nickname?null==t||null===(r=t.robotProtobuf)||void 0===r?void 0:r.nickname:"无"})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"queue.member.workgroup",defaultMessage:"workgroupNickname"}),dataIndex:"workgroupNickname",copyable:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.workgroupNickname.tooltip"}),render:function(e,t){var a,r;return(0,H.jsx)(H.Fragment,{children:null!=t&&null!==(a=t.workgroupProtobuf)&&void 0!==a&&a.nickname?null==t||null===(r=t.workgroupProtobuf)||void 0===r?void 0:r.nickname:"无"})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,valueType:"select",valueEnum:{AGENT:{text:b.formatMessage({id:"thread.type.agent",defaultMessage:"一对一客服"})},WORKGROUP:{text:b.formatMessage({id:"thread.type.workgroup",defaultMessage:"工作组客服"})},ROBOT:{text:b.formatMessage({id:"thread.type.robot",defaultMessage:"机器人客服"})},TICKET:{text:b.formatMessage({id:"thread.type.ticket",defaultMessage:"工单对话"})},MEMBER:{text:b.formatMessage({id:"thread.type.member",defaultMessage:"组织成员对话"})},GROUP:{text:b.formatMessage({id:"thread.type.group",defaultMessage:"群组对话"})},FEEDBACK:{text:b.formatMessage({id:"thread.type.feedback",defaultMessage:"意见反馈"})},ASSISTANT:{text:b.formatMessage({id:"thread.type.assistant",defaultMessage:"助理"})},FRIEND:{text:b.formatMessage({id:"thread.type.friend",defaultMessage:"好友对话"})},LLM:{text:b.formatMessage({id:"thread.type.llm",defaultMessage:"大模型对话"})},WORKFLOW:{text:b.formatMessage({id:"thread.type.workflow",defaultMessage:"工作流对话"})},QUEUE:{text:b.formatMessage({id:"thread.type.queue",defaultMessage:"排队会话"})}},fieldProps:{showSearch:!0,allowClear:!0},tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.type.tooltip"}),render:function(e,t){return(0,P.OG)(null==t?void 0:t.type)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,valueType:"select",valueEnum:p()(p()(p()(p()(p()(p()(p()({},I.ach,{text:b.formatMessage({id:"thread.process.status.new",defaultMessage:"新会话"})}),I.j0C,{text:b.formatMessage({id:"thread.process.status.roboting",defaultMessage:"机器人接待中"})}),I.Q7C,{text:b.formatMessage({id:"thread.process.status.offline",defaultMessage:"客服离线"})}),I.v1N,{text:b.formatMessage({id:"thread.process.status.queuing",defaultMessage:"排队中"})}),I.hl2,{text:b.formatMessage({id:"thread.process.status.chatting",defaultMessage:"对话中"})}),I.DS2,{text:b.formatMessage({id:"thread.process.status.timeout",defaultMessage:"超时"})}),I.V1n,{text:b.formatMessage({id:"thread.process.status.closed",defaultMessage:"已结束"})}),fieldProps:{showSearch:!0,allowClear:!0},tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case I.ach:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.new"});case I.j0C:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.roboting"});case I.Q7C:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.offline"});case I.v1N:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.queuing"});case I.hl2:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.chatting"});case I.DS2:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.timeout",defaultMessage:"超时"});case I.V1n:return(0,H.jsx)(x.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,H.jsx)(x.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,H.jsx)(x.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,P.YG)(t.channel)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.tagList",defaultMessage:"Tag List"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.tagList.tooltip"}),render:function(e,t){var a;return null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,H.jsx)(D.Z,{color:"blue",style:{marginRight:4},children:e},t)}))}},{title:(0,H.jsx)(x.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.topic.tooltip"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.content.tooltip",defaultMessage:"Conversation content"}),render:function(e,t){var a,r;return null!==(a=null==t||null===(r=t.contentObject)||void 0===r?void 0:r.preview)&&void 0!==a?a:null==t?void 0:t.content}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.transferStatus",defaultMessage:"Transfer Status"}),dataIndex:"transferStatus",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.transferStatus.tooltip",defaultMessage:"Thread transfer status"}),render:function(e,t){return(0,P.Sy)(null==t?void 0:t.transferStatus)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.inviteStatus",defaultMessage:"Invite Status"}),dataIndex:"inviteStatus",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.inviteStatus.tooltip",defaultMessage:"Thread invite status"}),render:function(e,t){return(0,P.jS)(null==t?void 0:t.inviteStatus)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.closeType",defaultMessage:"Close Type"}),dataIndex:"closeType",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.closeType.tooltip",defaultMessage:"Thread close type"}),render:function(e,t){return(0,P.pT)(null==t?void 0:t.closeType)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"unreadCount",defaultMessage:"Unread Count"}),dataIndex:"unreadCount",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.unreadCount.tooltip",defaultMessage:"Unread message count for agent"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.visitorUnreadCount",defaultMessage:"Visitor Unread Count"}),dataIndex:"visitorUnreadCount",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.visitorUnreadCount.tooltip",defaultMessage:"Unread message count for visitor"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.star",defaultMessage:"Star"}),dataIndex:"star",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.star.tooltip",defaultMessage:"Star level"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.top",defaultMessage:"Top"}),dataIndex:"top",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.top.tooltip",defaultMessage:"Whether set to top"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.top)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.unread",defaultMessage:"Unread"}),dataIndex:"unread",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.unread.tooltip",defaultMessage:"Whether has unread messages"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.unread)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.mute",defaultMessage:"Mute"}),dataIndex:"mute",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.mute.tooltip",defaultMessage:"Whether muted"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.mute)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.hide",defaultMessage:"Hide"}),dataIndex:"hide",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.hide.tooltip",defaultMessage:"Whether hidden from list"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.hide)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.fold",defaultMessage:"Fold"}),dataIndex:"fold",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.fold.tooltip",defaultMessage:"Whether folded"}),render:function(e,t){var a;return(0,P._f)(null!==(a=null==t?void 0:t.fold)&&void 0!==a?a:null==t?void 0:t.folded)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"offline",defaultMessage:"Offline"}),dataIndex:"offline",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.offline.tooltip",defaultMessage:"Whether agent was offline"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.offline)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.robotToAgent",defaultMessage:"Robot To Agent"}),dataIndex:"robotToAgent",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.robotToAgent.tooltip",defaultMessage:"Whether escalated from robot to agent"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.robotToAgent)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.valid",defaultMessage:"Valid"}),dataIndex:"valid",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.valid.tooltip",defaultMessage:"Whether valid conversation"}),render:function(e,t){return(0,P._f)(null==t?void 0:t.valid)}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.messageCount",defaultMessage:"Message Count"}),dataIndex:"allMessageCount",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.allMessageCount.tooltip",defaultMessage:"Total message count"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.visitorMessageCount",defaultMessage:"Visitor Messages"}),dataIndex:"visitorMessageCount",hideInSearch:!0},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.agentMessageCount",defaultMessage:"Agent Messages"}),dataIndex:"agentMessageCount",hideInSearch:!0},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.systemMessageCount",defaultMessage:"System Messages"}),dataIndex:"systemMessageCount",hideInSearch:!0},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.robotMessageCount",defaultMessage:"Robot Messages"}),dataIndex:"robotMessageCount",hideInSearch:!0},{title:(0,H.jsx)(x.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.note.tooltip",defaultMessage:"Thread note"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.extra",defaultMessage:"Extra"}),dataIndex:"extra",key:"extra",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.extra.tooltip",defaultMessage:"Extra info"}),render:function(e,t){var a=null==t?void 0:t.extra;return a?(0,H.jsx)("a",{onClick:function(){ae.info({title:b.formatMessage({id:"thread.extra",defaultMessage:"扩展信息"}),width:720,content:(0,H.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:520,overflow:"auto",margin:0},children:"string"==typeof a?a:JSON.stringify(a,null,2)})})},children:b.formatMessage({id:"view",defaultMessage:"查看"})}):(0,H.jsx)(H.Fragment,{children:"-"})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.processInstanceId",defaultMessage:"Process Instance ID"}),dataIndex:"processInstanceId",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.processInstanceId.tooltip",defaultMessage:"Process instance id"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"thread.processEntityUid",defaultMessage:"Process Entity UID"}),dataIndex:"processEntityUid",ellipsis:!0,copyable:!0,hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.processEntityUid.tooltip",defaultMessage:"Process entity uid"})},{title:(0,H.jsx)(x.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInSearch:!0,tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.owner.tooltip"}),render:function(e,t){var a;return(0,H.jsx)(H.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,H.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,H.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],Ue=function(){var e=f()(u()().mark((function e(t){var a,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(De){e.next=3;break}return Ne("thread.permission.delete.denied","无权限：删除会话"),e.abrupt("return");case 3:return J.Z.debug("handleDeleteConfirm",t),M.yw.loading(b.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=5,e.next=8,j({uid:t.uid});case 8:a=e.sent,M.yw.destroy(),200===a.code?(M.yw.success(b.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==k||null===(r=k.current)||void 0===r||r.reload()):M.yw.error(a.message||b.formatMessage({id:"delete.error",defaultMessage:"Delete Error"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),M.yw.destroy(),M.yw.error(b.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),Oe=[].concat(Re,[{title:b.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",tooltip:(0,H.jsx)(x.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,a){return[(0,H.jsx)("a",{onClick:function(){!function(e){var t;J.Z.debug("handleShowChatHistory",e);var a={chatConfig:{org:null==e?void 0:e.orgUid,t:I.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)}(t)},children:b.formatMessage({id:"view",defaultMessage:"View"})},"editable"),Ee?(0,H.jsx)("a",{style:{marginLeft:8},onClick:function(){Fe(t),je(!0)},children:b.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"):null,De?(0,H.jsx)(N.Z,{title:b.formatMessage({id:"deleteTip"}),description:"".concat(b.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return Ue(t)},okText:b.formatMessage({id:"ok"}),cancelText:b.formatMessage({id:"cancel"}),children:(0,H.jsx)("a",{style:{color:"red",marginLeft:8},children:b.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete"):null]}}]),Pe=function(){var e=f()(u()().mark((function e(){var t,a,r,s,n,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(De){e.next=3;break}return Ne("thread.permission.delete.denied","无权限：批量删除会话"),e.abrupt("return");case 3:if(0!==ue.length){e.next=6;break}return M.yw.warning(b.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(b.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,r=0,s=d()(ue),e.prev=10,s.s();case 12:if((n=s.n()).done){e.next=26;break}return o=n.value,e.prev=14,e.next=17,j({uid:o.uid});case 17:200===e.sent.code?a++:r++,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),r++;case 24:e.next=12;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(10),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:M.yw.destroy(),0===r?M.yw.success(b.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):M.yw.warning(b.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:r})),ie([]),ce([]),null===(t=k.current)||void 0===t||t.reloadAndRest();case 39:case"end":return e.stop()}}),e,null,[[10,28,31,34],[14,21]])})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=f()(u()().mark((function e(t,a,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ae){e.next=3;break}return Ne("thread.permission.export.denied","无权限：导出会话"),e.abrupt("return");case 3:J.Z.debug("handleExportExcel",t,a,r),s=localStorage.getItem(I.LA8),n=o()({componentType:m,orgUid:(null==$?void 0:$.uid)||"",accessToken:s||"",exportType:t},xe),"current"===t?(n.pageNumber=String(z-1),n.pageSize=String(X)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(n.pageNumber=String(a),n.pageSize=String(r)),window.open((0,F.kG)()+"/api/v1/thread/export?"+new URLSearchParams(n).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),qe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return Le("range",r,a)}})},n=0;n<r;n++)s();return t},ze={selectedRowKeys:oe,onChange:function(e,t){ie(e),ce(t)}};return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(A.Z,{columns:Oe,actionRef:k,cardBordered:!0,rowSelection:ze,scroll:{x:"max-content"},columnsState:{persistenceKey:"thread-table-".concat(m||"all"),defaultValue:{topic:{show:!1},content:{show:!1},extra:{show:!1}}},request:function(){var e=f()(u()().mark((function e(t,a,r){var n,i,d,l,c,f,g,p;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ce){e.next=4;break}return Ne("thread.permission.read.denied","无权限：查看会话"),me(0),e.abrupt("return",{data:[],success:!0,total:0});case 4:return J.Z.debug("request:",t,a,r),n=t.current,i=t.pageSize,d=s()(t,K),B(n),Q(i),ve(d),l=void 0,c=void 0,a&&Object.keys(a).length>0&&(f=Object.keys(a)[0],l=f,c="ascend"===a[f]?"ascend":"descend"),g=o()(o()({pageNumber:n-1,pageSize:i,componentType:m,orgUid:null==$?void 0:$.uid,mergeByTopic:!1,superUser:y},d),{},{sortBy:l,sortDirection:c}),e.next=15,v(g);case 15:return p=e.sent,J.Z.debug("getAllThreads response:",p,g),200===p.code?me(null==p?void 0:p.data.totalElements):M.yw.error(p.message),e.abrupt("return",{data:null==p?void 0:p.data.content,success:!0,total:null==p?void 0:p.data.totalElements});case 19:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){J.Z.debug("page:",e)}},dateFormatter:"string",headerTitle:b.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];De&&oe.length>0&&t.push({key:"batchDelete",icon:(0,H.jsx)(T.Z,{}),danger:!0,label:b.formatMessage({id:"batch.delete"})+" (".concat(oe.length,")"),onClick:function(){E.Z.confirm({title:b.formatMessage({id:"batch.deleteTip"}),content:"".concat(b.formatMessage({id:"batch.deleteAffirm"})," ").concat(oe.length," ").concat(b.formatMessage({id:"items"}),"?"),onOk:Pe,okText:b.formatMessage({id:"ok"}),cancelText:b.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,H.jsx)(Z.Z,{}),label:b.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Le("current")}}];return pe>0&&(pe<=1e3?a.push({key:"export-all",icon:(0,H.jsx)(Z.Z,{}),label:b.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(pe,"条)"),onClick:function(){return Le("all")}}):a.push({key:"export-range",icon:(0,H.jsx)(Z.Z,{}),label:b.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(pe,"条)"),children:qe(pe)})),Ae&&e.push((0,H.jsx)(R.Z,{menu:{items:a},placement:"bottom",children:(0,H.jsxs)(U.ZP,{icon:(0,H.jsx)(Z.Z,{}),type:"primary",children:[b.formatMessage({id:"export",defaultMessage:"Export"}),(0,H.jsx)(C.Z,{})]},"button")},"export")),t.length>0&&e.push((0,H.jsx)(R.Z,{menu:{items:t},placement:"bottom",children:(0,H.jsxs)(U.ZP,{type:oe.length>0?"primary":"default",danger:oe.length>0,children:[oe.length>0?b.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(oe.length,")"):b.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,H.jsx)(C.Z,{})]})},"batchOperations")),e}()}}),(0,H.jsx)(G,{open:we,onClose:function(){je(!1),Fe(null)},onSubmit:function(){var e;null===(e=k.current)||void 0===e||e.reload()},thread:Ie,orgUid:(null==Ie?void 0:Ie.orgUid)||(null==$?void 0:$.uid)}),re]})}},40128:function(e,t,a){a.d(t,{Z:function(){return q}});var r=a(84176),s=a.n(r),n=a(73193),o=a.n(n),i=a(86222),d=a.n(i),l=a(90819),u=a.n(l),c=a(89933),f=a.n(c),g=a(76711),p=a.n(g),m=a(45332),h=a.n(m),M=a(43388),x=a(4628);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/invite/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=a(88722),w=a(74171),j=a(94976),k=a(58620),S=a(54881),I=a(11090),F=a(2484),T=a(34512),Z=a(27729),C=a(90581),A=a(43275),E=a(28508),D=a(69533),N=a(44194),R=a(85977),U=a(67242),O=a(31549),P=["current","pageSize"],L={INVITE_PENDING:{text:"invite.status.pending",defaultMessage:"邀请待处理",color:"blue"},INVITE_ACCEPTED:{text:"invite.status.accepted",defaultMessage:"接受邀请",color:"green"},INVITE_REJECTED:{text:"invite.status.rejected",defaultMessage:"拒绝邀请",color:"red"},INVITE_TIMEOUT:{text:"invite.status.timeout",defaultMessage:"邀请超时",color:"orange"},INVITE_CANCELED:{text:"invite.status.canceled",defaultMessage:"取消邀请",color:"gray"}},q=function(e){var t,a,r,n,i,l,c=e.superUser,g=(0,x.useIntl)(),m=(0,x.useAccess)(),y=(0,N.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,R.MY.THREAD_INVITE)}),[m]),q=null!==(t=null==y||null===(a=y.canRead)||void 0===a?void 0:a.call(y))&&void 0!==t&&t,z=null!==(r=null==y||null===(n=y.canExport)||void 0===n?void 0:n.call(y))&&void 0!==r&&r,B=null!==(i=null==y||null===(l=y.canDelete)||void 0===l?void 0:l.call(y))&&void 0!==i&&i,_=(0,N.useRef)(),Y=(0,N.useState)(1),H=h()(Y,2),G=H[0],V=H[1],J=(0,N.useState)(10),K=h()(J,2),W=K[0],X=K[1],Q=(0,w.u)((function(e){return e.currentOrg})),$=(0,b.Z)().translateString,ee=Z.Z.useModal(),te=h()(ee,2),ae=(te[0],te[1]),re=(0,N.useState)([]),se=h()(re,2),ne=se[0],oe=se[1],ie=(0,N.useState)([]),de=h()(ie,2),le=de[0],ue=de[1],ce=(0,N.useState)(0),fe=h()(ce,2),ge=fe[0],pe=fe[1],me=(0,N.useState)({}),he=h()(me,2),Me=he[0],xe=he[1],ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,O.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,O.jsx)(x.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"sender",copyable:!0,ellipsis:!0,tooltip:(0,O.jsx)(x.FormattedMessage,{id:"invite.sender.tooltip"}),render:function(e,t,a,r){var s;return $(null===(s=t.sender)||void 0===s?void 0:s.nickname)}},{title:(0,O.jsx)(x.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,O.jsx)(x.FormattedMessage,{id:"invite.receiver.tooltip"}),render:function(e,t,a,r){var s;return $(null===(s=t.receiver)||void 0===s?void 0:s.nickname)}},{title:(0,O.jsx)(x.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,O.jsx)(x.FormattedMessage,{id:"invite.note.tooltip"})},{title:(0,O.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,O.jsx)(x.FormattedMessage,{id:"invite.status.tooltip"}),render:function(e,t){var a=t.status,r=L[a]||{text:"invite.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,O.jsx)(C.Z,{color:r.color,children:(0,O.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,O.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,O.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],ye=[].concat(ve,[{title:g.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,O.jsx)("a",{onClick:function(){be(t)},children:g.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(B?[(0,O.jsx)(A.Z,{title:g.formatMessage({id:"deleteTip"}),description:"".concat(g.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return we(t)},okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"}),children:(0,O.jsx)("a",{style:{color:"red",marginLeft:8},children:g.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),be=function(e){var t,a;U.Z.debug("handleShowChatHistory",e);var r={chatConfig:{org:null==Q?void 0:Q.uid,t:j.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},we=function(){var e=f()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:U.Z.debug("handleDeleteConfirm",t),M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==_||null===(a=_.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(g.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=f()(u()().mark((function e(){var t,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==le.length){e.next=6;break}return M.yw.warning(g.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(le);try{for(r.s();!(s=r.n()).done;)s.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(g.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(g.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),oe([]),ue([]),null===(t=_.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=f()(u()().mark((function e(t,a,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:U.Z.debug("handleExportExcel",t,a,r),s=localStorage.getItem(j.LA8),n=o()({orgUid:(null==Q?void 0:Q.uid)||"",accessToken:s||"",exportType:t},Me),"current"===t?(n.pageNumber=String(G-1),n.pageSize=String(W)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(n.pageNumber=String(a),n.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/invite/export?"+new URLSearchParams(n).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Se=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return ke("range",r,a)}})},n=0;n<r;n++)s();return t},Ie={selectedRowKeys:ne,onChange:function(e,t){oe(e),ue(t)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(T.Z,{columns:ye,actionRef:_,cardBordered:!0,rowSelection:B?Ie:void 0,scroll:{x:"max-content"},request:function(){var e=f()(u()().mark((function e(t,a,r){var n,i,d,l,f,p,m,h;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return n=t.current,i=t.pageSize,d=s()(t,P),V(n),X(i),xe(d),l=void 0,f=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,f="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:n-1,pageSize:i,orgUid:null==Q?void 0:Q.uid,superUser:c},d),{},{sortBy:l,sortDirection:f}),e.next=13,v(m);case 13:return h=e.sent,U.Z.debug("getAllThreadInvites response:",h,m),200===h.code?pe(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){U.Z.debug("page:",e)}},dateFormatter:"string",headerTitle:g.formatMessage({id:"thread.tab.invite",defaultMessage:"ThreadInvite"}),toolBarRender:function(){return function(){var e=[],t=[];if(B&&ne.length>0&&t.push({key:"batchDelete",icon:(0,O.jsx)(S.Z,{}),danger:!0,label:g.formatMessage({id:"batch.delete"})+" (".concat(ne.length,")"),onClick:function(){Z.Z.confirm({title:g.formatMessage({id:"batch.deleteTip"}),content:"".concat(g.formatMessage({id:"batch.deleteAffirm"})," ").concat(ne.length," ").concat(g.formatMessage({id:"items"}),"?"),onOk:je,okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"})})}}),z){var a=[{key:"export-current",icon:(0,O.jsx)(I.Z,{}),label:g.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ke("current")}}];ge>0&&(ge<=1e3?a.push({key:"export-all",icon:(0,O.jsx)(I.Z,{}),label:g.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ge,"条)"),onClick:function(){return ke("all")}}):a.push({key:"export-range",icon:(0,O.jsx)(I.Z,{}),label:g.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ge,"条)"),children:Se(ge)})),e.push((0,O.jsx)(E.Z,{menu:{items:a},placement:"bottom",children:(0,O.jsxs)(D.ZP,{icon:(0,O.jsx)(I.Z,{}),type:"primary",children:[g.formatMessage({id:"export",defaultMessage:"Export"}),(0,O.jsx)(F.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,O.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,O.jsxs)(D.ZP,{type:ne.length>0?"primary":"default",danger:ne.length>0,children:[ne.length>0?g.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ne.length,")"):g.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,O.jsx)(F.Z,{})]})},"batchOperations")),e}()}}),ae]})}},96063:function(e,t,a){a.d(t,{Z:function(){return P}});var r=a(84176),s=a.n(r),n=a(73193),o=a.n(n),i=a(86222),d=a.n(i),l=a(90819),u=a.n(l),c=a(89933),f=a.n(c),g=a(76711),p=a.n(g),m=a(45332),h=a.n(m),M=a(43388),x=a(94976),v=a(4628);function y(e){return b.apply(this,arguments)}function b(){return(b=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/thread/rating/query/org",{method:"GET",params:o()(o()({},t),{},{channel:x.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=a(74171),j=a(58620),k=a(54881),S=a(11090),I=a(2484),F=a(34512),T=a(43275),Z=a(27729),C=a(28508),A=a(69533),E=a(44194),D=a(85977),N=a(67242),R=a(31549),U=["current","pageSize"],O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,ellipsis:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t,a,r){var s;return null==t||null===(s=t.thread)||void 0===s||null===(s=s.user)||void 0===s?void 0:s.nickname}},{title:(0,R.jsx)(v.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",hideInSearch:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.agent.tooltip"}),render:function(e,t,a,r){var s;return null==t||null===(s=t.thread)||void 0===s||null===(s=s.agentProtobuf)||void 0===s?void 0:s.nickname}},{title:(0,R.jsx)(v.FormattedMessage,{id:"score",defaultMessage:"Score"}),dataIndex:"score",tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.score.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"comment",copyable:!0,tooltip:(0,R.jsx)(v.FormattedMessage,{id:"rating.comment.tooltip"})},{title:(0,R.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,R.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],P=function(e){var t,a,r,n,i,l,c=e.superUser,g=(0,v.useIntl)(),m=(0,v.useAccess)(),b=(0,E.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,D.MY.THREAD_RATING)}),[m]),P=null!==(t=null==b||null===(a=b.canRead)||void 0===a?void 0:a.call(b))&&void 0!==t&&t,L=null!==(r=null==b||null===(n=b.canExport)||void 0===n?void 0:n.call(b))&&void 0!==r&&r,q=null!==(i=null==b||null===(l=b.canDelete)||void 0===l?void 0:l.call(b))&&void 0!==i&&i,z=(0,E.useRef)(),B=(0,E.useState)(1),_=h()(B,2),Y=_[0],H=_[1],G=(0,E.useState)(10),V=h()(G,2),J=V[0],K=V[1],W=(0,w.u)((function(e){return e.currentOrg})),X=(0,E.useState)([]),Q=h()(X,2),$=Q[0],ee=Q[1],te=(0,E.useState)([]),ae=h()(te,2),re=ae[0],se=ae[1],ne=(0,E.useState)(0),oe=h()(ne,2),ie=oe[0],de=oe[1],le=(0,E.useState)({}),ue=h()(le,2),ce=ue[0],fe=ue[1],ge=[].concat(O,[{title:g.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,R.jsx)("a",{onClick:function(){pe(t)},children:g.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(q?[(0,R.jsx)(T.Z,{title:g.formatMessage({id:"deleteTip"}),description:"".concat(g.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return me(t)},okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"}),children:(0,R.jsx)("a",{style:{color:"red",marginLeft:8},children:g.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),pe=function(e){var t,a,r;N.Z.debug("handleShowChatHistory",e);var s={chatConfig:{org:null==e||null===(t=e.thread)||void 0===t?void 0:t.orgUid,t:x.CCt,sid:null==e||null===(a=e.thread)||void 0===a?void 0:a.uid}};null===(r=window.bytedesk)||void 0===r||r.showChat(s)},me=function(){var e=f()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:N.Z.debug("handleDeleteConfirm",t),M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==z||null===(a=z.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(g.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=f()(u()().mark((function e(){var t,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==re.length){e.next=6;break}return M.yw.warning(g.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(re);try{for(r.s();!(s=r.n()).done;)s.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(g.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(g.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),ee([]),se([]),null===(t=z.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=f()(u()().mark((function e(t,a,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:N.Z.debug("handleExportExcel",t,a,r),s=localStorage.getItem(x.LA8),n=o()({orgUid:(null==W?void 0:W.uid)||"",accessToken:s||"",exportType:t},ce),"current"===t?(n.pageNumber=String(Y-1),n.pageSize=String(J)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(n.pageNumber=String(a),n.pageSize=String(r)),window.open((0,j.kG)()+"/api/v1/thread/rating/export?"+new URLSearchParams(n).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),xe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return Me("range",r,a)}})},n=0;n<r;n++)s();return t},ve={selectedRowKeys:$,onChange:function(e,t){ee(e),se(t)}};return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(F.Z,{columns:ge,actionRef:z,cardBordered:!0,rowSelection:q?ve:void 0,scroll:{x:"max-content"},request:function(){var e=f()(u()().mark((function e(t,a,r){var n,i,d,l,f,p,m,h;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return n=t.current,i=t.pageSize,d=s()(t,U),H(n),K(i),fe(d),l=void 0,f=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,f="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:n-1,pageSize:i,orgUid:null==W?void 0:W.uid,superUser:c},d),{},{sortBy:l,sortDirection:f}),e.next=13,y(m);case 13:return h=e.sent,N.Z.debug("queryRatesByOrgUid response:",null==h?void 0:h.data,m),200===h.code?de(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){N.Z.debug("page:",e)}},dateFormatter:"string",headerTitle:"满意度评价",toolBarRender:function(){return function(){var e=[],t=[];if(q&&$.length>0&&t.push({key:"batchDelete",icon:(0,R.jsx)(k.Z,{}),danger:!0,label:g.formatMessage({id:"batch.delete"})+" (".concat($.length,")"),onClick:function(){Z.Z.confirm({title:g.formatMessage({id:"batch.deleteTip"}),content:"".concat(g.formatMessage({id:"batch.deleteAffirm"})," ").concat($.length," ").concat(g.formatMessage({id:"items"}),"?"),onOk:he,okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"})})}}),L){var a=[{key:"export-current",icon:(0,R.jsx)(S.Z,{}),label:g.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];ie>0&&(ie<=1e3?a.push({key:"export-all",icon:(0,R.jsx)(S.Z,{}),label:g.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ie,"条)"),onClick:function(){return Me("all")}}):a.push({key:"export-range",icon:(0,R.jsx)(S.Z,{}),label:g.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ie,"条)"),children:xe(ie)})),e.push((0,R.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,R.jsxs)(A.ZP,{icon:(0,R.jsx)(S.Z,{}),type:"primary",children:[g.formatMessage({id:"export",defaultMessage:"Export"}),(0,R.jsx)(I.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,R.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(A.ZP,{type:$.length>0?"primary":"default",danger:$.length>0,children:[$.length>0?g.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat($.length,")"):g.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,R.jsx)(I.Z,{})]})},"batchOperations")),e}()}})})}},78847:function(e,t,a){a.d(t,{Z:function(){return z}});var r=a(84176),s=a.n(r),n=a(73193),o=a.n(n),i=a(86222),d=a.n(i),l=a(76711),u=a.n(l),c=a(90819),f=a.n(c),g=a(89933),p=a.n(g),m=a(45332),h=a.n(m),M=a(43388),x=a(88722),v=a(74171),y=a(94976),b=a(58620),w=a(54881),j=a(11090),k=a(2484),S=a(34512),I=a(4628),F=a(27729),T=a(90581),Z=a(30310),C=a(43275),A=a(28508),E=a(69533),D=a(44194);function N(e){return R.apply(this,arguments)}function R(){return(R=p()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,I.request)("/api/v1/thread/summary/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=a(32503),O=a(67242),P=a(85977),L=a(31549),q=["current","pageSize"],z=function(e){var t,a,r,n,i,l,c=e.superUser,g=(0,I.useIntl)(),m=(0,I.useAccess)(),R=(0,D.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,P.MY.THREAD_SUMMARY)}),[m]),z=null!==(t=null==R||null===(a=R.canRead)||void 0===a?void 0:a.call(R))&&void 0!==t&&t,B=null!==(r=null==R||null===(n=R.canExport)||void 0===n?void 0:n.call(R))&&void 0!==r&&r,_=null!==(i=null==R||null===(l=R.canDelete)||void 0===l?void 0:l.call(R))&&void 0!==i&&i,Y=(0,D.useRef)(),H=(0,D.useState)(1),G=h()(H,2),V=G[0],J=G[1],K=(0,D.useState)(10),W=h()(K,2),X=W[0],Q=W[1],$=(0,v.u)((function(e){return e.currentOrg})),ee=(0,x.Z)().translateString,te=F.Z.useModal(),ae=h()(te,2),re=(ae[0],ae[1]),se=(0,D.useState)([]),ne=h()(se,2),oe=(ne[0],ne[1]),ie=(0,D.useState)({}),de=h()(ie,2),le=de[0],ue=de[1],ce=(0,D.useState)([]),fe=h()(ce,2),ge=fe[0],pe=fe[1],me=(0,D.useState)([]),he=h()(me,2),Me=he[0],xe=he[1],ve=(0,D.useState)(0),ye=h()(ve,2),be=ye[0],we=ye[1],je=(0,D.useState)({}),ke=h()(je,2),Se=ke[0],Ie=ke[1],Fe=function(){var e=p()(f()().mark((function e(){var t,a,r,s,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:100,type:y.ics,orgUid:null==$?void 0:$.uid},e.next=4,(0,U.XS)(a);case 4:r=e.sent,O.Z.debug("queryCategoriesByOrg response:",null==r?void 0:r.data,a),200===(null==r?void 0:r.code)&&null!=r&&null!==(t=r.data)&&void 0!==t&&t.content&&(s=null==r?void 0:r.data.content,oe(s),n={},s.forEach((function(e){n[e.uid]=e.name})),ue(n)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),O.Z.error("Fetch categories error:",e.t0),M.yw.error(g.formatMessage({id:"ticket.category.load.error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,D.useEffect)((function(){null!=$&&$.uid&&Fe()}),[null==$?void 0:$.uid]);var Te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,L.jsx)(I.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,L.jsx)(I.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.title.tooltip"})},{title:(0,L.jsx)(I.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.content.tooltip"})},{title:(0,L.jsx)(I.FormattedMessage,{id:"solution",defaultMessage:"Solution"}),dataIndex:"solution",copyable:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.solution.tooltip"})},{title:(0,L.jsx)(I.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.category.tooltip"}),render:function(e,t){var a=le[t.categoryUid]||t.categoryUid;return ee(a)}},{title:(0,L.jsx)(I.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.status.tooltip"}),render:function(e,t){var a="",r="";switch(t.status){case y.kA8:a="orange",r=g.formatMessage({id:"summary.status.pending",defaultMessage:"待处理"});break;case y.zvK:a="blue",r=g.formatMessage({id:"summary.status.processing",defaultMessage:"处理中"});break;case y.fuK:a="green",r=g.formatMessage({id:"summary.status.resolved",defaultMessage:"已解决"});break;case y.cin:a="gray",r=g.formatMessage({id:"summary.status.closed",defaultMessage:"已关闭"});break;default:a="default",r=e}return(0,L.jsx)(T.Z,{color:a,children:r})}},{title:(0,L.jsx)(I.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),hideInSearch:!0,tooltip:(0,L.jsx)(I.FormattedMessage,{id:"summary.tags.tooltip"}),render:function(e,t){var a;return null!=t&&t.tagList&&Array.isArray(null==t?void 0:t.tagList)&&0!==(null==t?void 0:t.tagList.length)?(0,L.jsx)(Z.Z,{size:[0,4],wrap:!0,children:null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e){return(0,L.jsx)(T.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,L.jsx)(I.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,L.jsx)(I.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],Ze=[].concat(Te,[{title:g.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,L.jsx)("a",{onClick:function(){Ce(t)},children:g.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(u()(_?[(0,L.jsx)(C.Z,{title:g.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:g.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此总结记录吗？此操作不可恢复!"}),onConfirm:function(){return Ae(t)},okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"}),children:(0,L.jsx)("a",{style:{color:"red",marginLeft:8},children:g.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),Ce=function(e){var t;O.Z.debug("handleShowChatHistory",e);var a={chatConfig:{org:null==$?void 0:$.uid,t:y.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Ae=function(){var e=p()(f()().mark((function e(t){var a;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:O.Z.debug("handleDeleteConfirm",t),M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==Y||null===(a=Y.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(g.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){var e=p()(f()().mark((function e(){var t,a,r,s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==Me.length){e.next=6;break}return M.yw.warning(g.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(Me);try{for(r.s();!(s=r.n()).done;)s.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(g.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(g.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),pe([]),xe([]),null===(t=Y.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=p()(f()().mark((function e(t,a,r){var s,n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:O.Z.debug("handleExportExcel",t,a,r),s=localStorage.getItem(y.LA8),n=o()({orgUid:(null==$?void 0:$.uid)||"",accessToken:s||"",exportType:t},Se),"current"===t?(n.pageNumber=String(V-1),n.pageSize=String(X)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(n.pageNumber=String(a),n.pageSize=String(r)),window.open((0,b.kG)()+"/api/v1/thread/summary/export?"+new URLSearchParams(n).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Ne=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return De("range",r,a)}})},n=0;n<r;n++)s();return t},Re={selectedRowKeys:ge,onChange:function(e,t){pe(e),xe(t)}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(S.Z,{columns:Ze,actionRef:Y,cardBordered:!0,rowSelection:_?Re:void 0,scroll:{x:"max-content"},request:function(){var e=p()(f()().mark((function e(t,a,r){var n,i,d,l,u,p,m,h;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return n=t.current,i=t.pageSize,d=s()(t,q),J(n),Q(i),Ie(d),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,u="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:n-1,pageSize:i,orgUid:null==$?void 0:$.uid,superUser:c},d),{},{sortBy:l,sortDirection:u}),e.next=13,N(m);case 13:return h=e.sent,O.Z.debug("queryThreadSummariesByOrg response:",h,m),200===h.code?we(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){O.Z.debug("page:",e)}},dateFormatter:"string",headerTitle:g.formatMessage({id:"thread.tab.summary",defaultMessage:"ThreadSummary"}),toolBarRender:function(){return function(){var e=[],t=[];if(_&&ge.length>0&&t.push({key:"batchDelete",icon:(0,L.jsx)(w.Z,{}),danger:!0,label:g.formatMessage({id:"batch.delete"})+" (".concat(ge.length,")"),onClick:function(){F.Z.confirm({title:g.formatMessage({id:"batch.deleteTip"}),content:"".concat(g.formatMessage({id:"batch.deleteAffirm"})," ").concat(ge.length," ").concat(g.formatMessage({id:"items"}),"?"),onOk:Ee,okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"})})}}),B){var a=[{key:"export-current",icon:(0,L.jsx)(j.Z,{}),label:g.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return De("current")}}];be>0&&(be<=1e3?a.push({key:"export-all",icon:(0,L.jsx)(j.Z,{}),label:g.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(be,"条)"),onClick:function(){return De("all")}}):a.push({key:"export-range",icon:(0,L.jsx)(j.Z,{}),label:g.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(be,"条)"),children:Ne(be)})),e.push((0,L.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,L.jsxs)(E.ZP,{icon:(0,L.jsx)(j.Z,{}),type:"primary",children:[g.formatMessage({id:"export",defaultMessage:"Export"}),(0,L.jsx)(k.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,L.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,L.jsxs)(E.ZP,{type:ge.length>0?"primary":"default",danger:ge.length>0,children:[ge.length>0?g.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ge.length,")"):g.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,L.jsx)(k.Z,{})]})},"batchOperations")),e}()}}),re]})}},1396:function(e,t,a){a.d(t,{Z:function(){return _}});var r=a(84176),s=a.n(r),n=a(73193),o=a.n(n),i=a(86222),d=a.n(i),l=a(90819),u=a.n(l),c=a(89933),f=a.n(c),g=a(76711),p=a.n(g),m=a(45332),h=a.n(m),M=a(43388),x=a(4628);function v(e){return y.apply(this,arguments)}function y(){return(y=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/transfer/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=a(88722),w=a(74171),j=a(94976),k=a(58620),S=a(54881),I=a(11090),F=a(2484),T=a(34512),Z=a(27729),C=a(90581),A=a(43275),E=a(28508),D=a(69533),N=a(44194),R=a(96596),U=a.n(R),O=a(85977),P=a(67242),L=a(31549),q=["current","pageSize"],z={TRANSFER_PENDING:{text:"transfer.status.pending",defaultMessage:"转接待处理",color:"blue"},TRANSFER_ACCEPTED:{text:"transfer.status.accepted",defaultMessage:"接受转接",color:"green"},TRANSFER_REJECTED:{text:"transfer.status.rejected",defaultMessage:"拒绝转接",color:"red"},TRANSFER_TIMEOUT:{text:"transfer.status.timeout",defaultMessage:"转接超时",color:"orange"},TRANSFER_CANCELED:{text:"transfer.status.canceled",defaultMessage:"取消转接",color:"gray"}},B={AGENT_TO_AGENT:{text:"transfer.type.agent_to_agent",defaultMessage:"人工转人工",color:"purple"},ROBOT_TO_AGENT:{text:"transfer.type.robot_to_agent",defaultMessage:"机器人转人工",color:"cyan"}},_=function(e){var t,a,r,n,i,l,c=e.superUser,g=(0,x.useIntl)(),m=(0,x.useAccess)(),y=(0,N.useMemo)((function(){var e;return null==m||null===(e=m.getModulePermission)||void 0===e?void 0:e.call(m,O.MY.THREAD_TRANSFER)}),[m]),R=null!==(t=null==y||null===(a=y.canRead)||void 0===a?void 0:a.call(y))&&void 0!==t&&t,_=null!==(r=null==y||null===(n=y.canExport)||void 0===n?void 0:n.call(y))&&void 0!==r&&r,Y=null!==(i=null==y||null===(l=y.canDelete)||void 0===l?void 0:l.call(y))&&void 0!==i&&i,H=(0,N.useRef)(),G=(0,N.useState)(1),V=h()(G,2),J=V[0],K=V[1],W=(0,N.useState)(10),X=h()(W,2),Q=X[0],$=X[1],ee=(0,w.u)((function(e){return e.currentOrg})),te=(0,b.Z)().translateString,ae=Z.Z.useModal(),re=h()(ae,2),se=(re[0],re[1]),ne=(0,N.useState)([]),oe=h()(ne,2),ie=oe[0],de=oe[1],le=(0,N.useState)([]),ue=h()(le,2),ce=ue[0],fe=ue[1],ge=(0,N.useState)(0),pe=h()(ge,2),me=pe[0],he=pe[1],Me=(0,N.useState)({}),xe=h()(Me,2),ve=xe[0],ye=xe[1],be=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,L.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left"},{title:(0,L.jsx)(x.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"senderNickname",copyable:!0,ellipsis:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.sender.tooltip"}),render:function(e,t,a,r){var s;return te(null===(s=t.sender)||void 0===s?void 0:s.nickname)}},{title:(0,L.jsx)(x.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.receiver.tooltip"}),render:function(e,t,a,r){var s;return te(null===(s=t.receiver)||void 0===s?void 0:s.nickname)}},{title:(0,L.jsx)(x.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.note.tooltip"})},{title:(0,L.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.status.tooltip"}),render:function(e,t){var a=t.status,r=z[a]||{text:"transfer.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,L.jsx)(C.Z,{color:r.color,children:(0,L.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,L.jsx)(x.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,copyable:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.type.tooltip"}),render:function(e,t){var a=t.type,r=B[a]||{text:"transfer.type.unknown",defaultMessage:"未知类型",color:"default"};return(0,L.jsx)(C.Z,{color:r.color,children:(0,L.jsx)(x.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,L.jsx)(x.FormattedMessage,{id:"transfer.transferAt",defaultMessage:"转接时间"}),dataIndex:"transferAt",hideInSearch:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.transferAt.tooltip"}),render:function(e,t){return t.transferAt?U()(t.transferAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,L.jsx)(x.FormattedMessage,{id:"transfer.acceptAt",defaultMessage:"接受时间"}),dataIndex:"acceptAt",hideInSearch:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.acceptAt.tooltip"}),render:function(e,t){return t.acceptAt?U()(t.acceptAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,L.jsx)(x.FormattedMessage,{id:"transfer.cancelAt",defaultMessage:"取消时间"}),dataIndex:"cancelAt",hideInSearch:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.cancelAt.tooltip"}),render:function(e,t){return t.cancelAt?U()(t.cancelAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,L.jsx)(x.FormattedMessage,{id:"transfer.rejectAt",defaultMessage:"拒绝时间"}),dataIndex:"rejectAt",hideInSearch:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.rejectAt.tooltip"}),render:function(e,t){return t.rejectAt?U()(t.rejectAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,L.jsx)(x.FormattedMessage,{id:"transfer.expireAt",defaultMessage:"超时时间"}),dataIndex:"expireAt",hideInSearch:!0,tooltip:(0,L.jsx)(x.FormattedMessage,{id:"transfer.expireAt.tooltip"}),render:function(e,t){return t.expireAt?U()(t.expireAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,L.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,L.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],we=[].concat(be,[{title:g.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,L.jsx)("a",{onClick:function(){je(t)},children:g.formatMessage({id:"view",defaultMessage:"View"})},"editable")].concat(p()(Y?[(0,L.jsx)(A.Z,{title:g.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:g.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此转接记录吗？此操作不可恢复!"}),onConfirm:function(){return ke(t)},okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"}),children:(0,L.jsx)("a",{style:{color:"red",marginLeft:8},children:g.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]:[]))}}]),je=function(e){var t,a;P.Z.debug("handleShowChatHistory",e);var r={chatConfig:{org:null==ee?void 0:ee.uid,t:j.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},ke=function(){var e=f()(u()().mark((function e(t){var a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:P.Z.debug("handleDeleteConfirm",t),M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{M.yw.destroy(),M.yw.success(g.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==H||null===(a=H.current)||void 0===a||a.reload()}catch(e){M.yw.destroy(),M.yw.error(g.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(){var e=f()(u()().mark((function e(){var t,a,r,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.delete",defaultMessage:"无删除权限"})),e.abrupt("return");case 3:if(0!==ce.length){e.next=6;break}return M.yw.warning(g.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 6:M.yw.loading(g.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(ce);try{for(r.s();!(s=r.n()).done;)s.value}catch(e){r.e(e)}finally{r.f()}M.yw.destroy(),0===a?M.yw.success(g.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):M.yw.warning(g.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),de([]),fe([]),null===(t=H.current)||void 0===t||t.reloadAndRest();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=f()(u()().mark((function e(t,a,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.export",defaultMessage:"无导出权限"})),e.abrupt("return");case 3:P.Z.debug("handleExportExcel",t,a,r),s=localStorage.getItem(j.LA8),n=o()({orgUid:(null==ee?void 0:ee.uid)||"",accessToken:s||"",exportType:t},ve),"current"===t?(n.pageNumber=String(J-1),n.pageSize=String(Q)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(n.pageNumber=String(a),n.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/transfer/export?"+new URLSearchParams(n).toString());case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Fe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return Ie("range",r,a)}})},n=0;n<r;n++)s();return t},Te={selectedRowKeys:ie,onChange:function(e,t){de(e),fe(t)}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(T.Z,{columns:we,actionRef:H,cardBordered:!0,rowSelection:Y?Te:void 0,scroll:{x:"max-content"},request:function(){var e=f()(u()().mark((function e(t,a,r){var n,i,d,l,f,p,m,h;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R){e.next=3;break}return M.yw.warning(g.formatMessage({id:"no.permission.read",defaultMessage:"无查看权限"})),e.abrupt("return",{data:[],success:!0,total:0});case 3:return n=t.current,i=t.pageSize,d=s()(t,q),K(n),$(i),ye(d),l=void 0,f=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,f="ascend"===a[p]?"ascend":"descend"),m=o()(o()({pageNumber:n-1,pageSize:i,orgUid:null==ee?void 0:ee.uid,superUser:c},d),{},{sortBy:l,sortDirection:f}),e.next=13,v(m);case 13:return h=e.sent,P.Z.debug("getAllThreadTransfers response:",h,m),200===h.code?he(null==h?void 0:h.data.totalElements):M.yw.error(h.message),e.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 17:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){P.Z.debug("page:",e)}},dateFormatter:"string",headerTitle:g.formatMessage({id:"thread.tab.transfer",defaultMessage:"ThreadTransfer"}),toolBarRender:function(){return function(){var e=[],t=[];if(Y&&ie.length>0&&t.push({key:"batchDelete",icon:(0,L.jsx)(S.Z,{}),danger:!0,label:g.formatMessage({id:"batch.delete"})+" (".concat(ie.length,")"),onClick:function(){Z.Z.confirm({title:g.formatMessage({id:"batch.deleteTip"}),content:"".concat(g.formatMessage({id:"batch.deleteAffirm"})," ").concat(ie.length," ").concat(g.formatMessage({id:"items"}),"?"),onOk:Se,okText:g.formatMessage({id:"ok"}),cancelText:g.formatMessage({id:"cancel"})})}}),_){var a=[{key:"export-current",icon:(0,L.jsx)(I.Z,{}),label:g.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ie("current")}}];me>0&&(me<=1e3?a.push({key:"export-all",icon:(0,L.jsx)(I.Z,{}),label:g.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(me,"条)"),onClick:function(){return Ie("all")}}):a.push({key:"export-range",icon:(0,L.jsx)(I.Z,{}),label:g.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(me,"条)"),children:Fe(me)})),e.push((0,L.jsx)(E.Z,{menu:{items:a},placement:"bottom",children:(0,L.jsxs)(D.ZP,{icon:(0,L.jsx)(I.Z,{}),type:"primary",children:[g.formatMessage({id:"export",defaultMessage:"Export"}),(0,L.jsx)(F.Z,{})]},"button")},"export"))}return t.length>0&&e.push((0,L.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,L.jsxs)(D.ZP,{type:ie.length>0?"primary":"default",danger:ie.length>0,children:[ie.length>0?g.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ie.length,")"):g.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,L.jsx)(F.Z,{})]})},"batchOperations")),e}()}}),se]})}}}]);