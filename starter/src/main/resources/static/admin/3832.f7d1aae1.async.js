"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3832],{27522:function(e,n,r){r.d(n,{AP:function(){return d},_J:function(){return h},t5:function(){return v},v_:function(){return m}});var t=r(90819),a=r.n(t),i=r(73193),o=r.n(i),l=r(89933),s=r.n(l),u=r(55735),c=r(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return f.apply(this,arguments)}function f(){return(f=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},40679:function(e,n,r){var t=r(10154),a=r.n(t),i=r(73193),o=r.n(i),l=r(90819),s=r.n(l),u=r(89933),c=r.n(u),d=r(45332),p=r.n(d),m=r(86803),f=r(82863),v=r(92053),y=r(76750),h=r(55735),x=r(88721),g=r(32327),b=r(62673),w=r(40269),k=r(3849),j=r(73442),C=r(75365),M=r(8247),L=r(30921),Z=r(44194),P=r(31549),S=g.Z.Text,T=Z.memo((function(e){var n,r=e.visible,t=e.onCancel,i=e.onOk,l=e.initialProvider,u=e.initialModel,d=e.initialModelLabel,T=e.providers,N=e.currentOrgUid,O=e.existingProviderModels,q=void 0===O?{}:O,F=e.onModelsLoaded,I=e.allowedModelTypes,V=void 0===I?[]:I,A=(0,L.useIntl)(),E=(0,y.Z)().translateString,U=(0,Z.useState)(l||""),R=p()(U,2),_=R[0],z=R[1],B=(0,Z.useState)(q),D=p()(B,2),G=D[0],H=D[1],J=(0,Z.useState)(l||""),K=p()(J,2),Q=K[0],W=K[1],X=(0,Z.useState)(u||""),Y=p()(X,2),$=Y[0],ee=Y[1],ne=(0,Z.useState)(d||""),re=p()(ne,2),te=re[0],ae=re[1],ie=(0,Z.useState)(!1),oe=p()(ie,2),le=oe[0],se=oe[1];(0,Z.useEffect)((function(){W(l),ee(u),ae(d),z(l)}),[l,u,d,r]),(0,Z.useEffect)((function(){if(r&&_&&!G[_]&&!le){se(!0),m.yw.loading({content:A.formatMessage({id:"loading"}),key:"modelLoading"});var e=T.find((function(e){return e.name===_}));e&&("ollama"===e.name?pe():fe(e))}}),[r,_,T]);var ue=(0,Z.useCallback)((function(){Q&&$&&i(Q,$,te)}),[Q,$,te,i]),ce=(0,Z.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(n){return e.toLowerCase().includes(n.toLowerCase())}))}),[]),de=(0,Z.useCallback)((function(e){return e?e.filter((function(e){return!ce(e.value)&&(!V||0===V.length||(!e.type||V.includes(e.type)))})):[]}),[V,ce]),pe=function(){var e=c()(s()().mark((function e(){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,v.VM)();case 3:200===(n=e.sent).code&&n.data?me():(m.yw.error(n.message),m.yw.destroy("modelLoading"),se(!1)),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),m.yw.error(A.formatMessage({id:"error"})),m.yw.destroy("modelLoading"),se(!1);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=c()(s()().mark((function e(){var n,r,t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,v.c8)();case 3:200===(n=e.sent).code?(r=n.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),t=de(r),H((function(e){return o()(o()({},e),{},{ollama:t})})),F&&F("ollama",t)):m.yw.error(n.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),m.yw.error(A.formatMessage({id:"error"}));case 11:return e.prev=11,m.yw.destroy("modelLoading"),se(!1),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,7,11,15]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=c()(s()().mark((function e(n){var r,t,i,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:N,level:h.whQ},e.next=4,(0,f.LF)(r);case 4:200===(t=e.sent).code?(i=t.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:n.name}})),l=de(i),H((function(e){return o()(o()({},e),{},a()({},n.name,l))})),F&&F(n.name,l)):m.yw.error(t.message),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),m.yw.error(A.formatMessage({id:"error"}));case 12:return e.prev=12,m.yw.destroy("modelLoading"),se(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[0,8,12,16]])})));return function(n){return e.apply(this,arguments)}}(),ve=(0,Z.useCallback)((function(e,n){W(e),ee(n.value),ae(n.label)}),[]),ye=(0,Z.useCallback)((function(e){if(z(e),!G[e]&&!le){se(!0),m.yw.loading({content:A.formatMessage({id:"loading"}),key:"modelLoading"});var n=T.find((function(n){return n.name===e}));n&&("ollama"===n.name?pe():fe(n))}}),[T,G,le]),he=Z.memo((function(e){var n=e.model,r=e.providerName;return(0,P.jsxs)(b.Z,{hoverable:!0,style:{cursor:"pointer",border:$===n.value&&Q===r?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return ve(r,n)},children:[(0,P.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,P.jsx)(g.Z.Title,{level:5,style:{margin:0},children:n.label}),(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[n.type&&(0,P.jsx)("div",{style:{marginBottom:8},children:(0,x.Rb)(n.type)}),$===n.value&&Q===r&&(0,P.jsx)(w.Z,{status:"processing",text:"已选"})]})]}),n.description&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(g.Z.Text,{type:"secondary",children:null==n?void 0:n.value}),(0,P.jsx)(g.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:n.description})]})]},n.value)}),(function(e,n){return e.model.value===n.model.value&&e.providerName===n.providerName&&($===e.model.value&&Q===e.providerName)===($===n.model.value&&Q===n.providerName)})),xe=(0,Z.useMemo)((function(){return T.map((function(e){var n,r;return{key:e.name,label:E(e.nickname),children:(0,P.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,P.jsxs)(k.Z,{direction:"vertical",style:{width:"100%"},children:[le&&_===e.name&&!G[e.name]?(0,P.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,P.jsx)(S,{type:"secondary",children:"加载模型中..."})}):(!G[e.name]||0===(null===(n=G[e.name])||void 0===n?void 0:n.length))&&(0,P.jsx)(S,{type:"secondary",children:"暂无可用模型"}),(0,P.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(r=G[e.name])||void 0===r?void 0:r.map((function(n){return(0,P.jsx)(he,{model:n,providerName:e.name},n.value)}))})]})})}}))}),[T,G,_,le,$,Q,E]);return(0,P.jsx)(j.Z,{title:"选择AI模型",open:r,onClose:t,width:700,destroyOnClose:!1,footer:(0,P.jsxs)("div",{style:{textAlign:"right"},children:[(0,P.jsx)(C.ZP,{onClick:t,style:{marginRight:8},children:"取消"}),(0,P.jsx)(C.ZP,{onClick:ue,type:"primary",children:"确定"})]}),children:T.length>0&&(0,P.jsx)(M.Z,{activeKey:_||(null===(n=T[0])||void 0===n?void 0:n.name),onChange:ye,items:xe,destroyInactiveTabPane:!1})})}),(function(e,n){return e.visible===n.visible&&e.initialProvider===n.initialProvider&&e.initialModel===n.initialModel&&e.initialModelLabel===n.initialModelLabel}));n.Z=T}}]);