"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{59908:function(e,r,t){t.d(r,{Z:function(){return d}});var a=t(83910),s=t(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=t(54183),i=function(e,r){return s.createElement(o.Z,(0,a.Z)({},e,{ref:r,icon:n}))};var d=s.forwardRef(i)},38644:function(e,r,t){t.d(r,{Z:function(){return C}});var a=t(94433),s=t(38956),n=t(44194),o=t(45441),i=t(9953),d=t(31549),l=["proFieldProps","fieldProps"],u="date",g=n.forwardRef((function(e,r){var t=e.proFieldProps,g=e.fieldProps,c=(0,s.Z)(e,l),f=(0,n.useContext)(o.Z);return(0,d.jsx)(i.Z,(0,a.Z)({ref:r,valueType:u,fieldProps:(0,a.Z)({getPopupContainer:f.getPopupContainer},g),proFieldProps:t,filedConfig:{valueType:u,customLightMode:!0}},c))})),c=["proFieldProps","fieldProps"],f="dateMonth",p=n.forwardRef((function(e,r){var t=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,c),g=(0,n.useContext)(o.Z);return(0,d.jsx)(i.Z,(0,a.Z)({ref:r,valueType:f,fieldProps:(0,a.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:t,filedConfig:{valueType:f,customLightMode:!0}},u))})),m=["fieldProps"],v="dateQuarter",h=n.forwardRef((function(e,r){var t=e.fieldProps,l=(0,s.Z)(e,m),u=(0,n.useContext)(o.Z);return(0,d.jsx)(i.Z,(0,a.Z)({ref:r,valueType:v,fieldProps:(0,a.Z)({getPopupContainer:u.getPopupContainer},t),filedConfig:{valueType:v,customLightMode:!0}},l))})),y=["proFieldProps","fieldProps"],M="dateWeek",x=n.forwardRef((function(e,r){var t=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,y),g=(0,n.useContext)(o.Z);return(0,d.jsx)(i.Z,(0,a.Z)({ref:r,valueType:M,fieldProps:(0,a.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:t,filedConfig:{valueType:M,customLightMode:!0}},u))})),b=["proFieldProps","fieldProps"],Z="dateYear",w=n.forwardRef((function(e,r){var t=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,b),g=(0,n.useContext)(o.Z);return(0,d.jsx)(i.Z,(0,a.Z)({ref:r,valueType:Z,fieldProps:(0,a.Z)({getPopupContainer:g.getPopupContainer},l),proFieldProps:t,filedConfig:{valueType:Z,customLightMode:!0}},u))})),j=g;j.Week=x,j.Month=p,j.Quarter=h,j.Year=w,j.displayName="ProFormComponent";var C=j},59005:function(e,r,t){var a=t(94433),s=t(38956),n=t(57343),o=t(44194),i=t(45441),d=t(9953),l=t(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],g=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],c=function(e,r){var t=e.fieldProps,g=e.children,c=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.showSearch,y=e.options,M=(0,s.Z)(e,u),x=(0,o.useContext)(i.Z);return(0,l.jsx)(d.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,n.h)(m),request:v,params:c,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:y,mode:p,showSearch:h,getPopupContainer:x.getPopupContainer},t),ref:r,proFieldProps:f},M),{},{children:g}))},f=o.forwardRef((function(e,r){var t=e.fieldProps,u=e.children,c=e.params,f=e.proFieldProps,p=e.mode,m=e.valueEnum,v=e.request,h=e.options,y=(0,s.Z)(e,g),M=(0,a.Z)({options:h,mode:p||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),x=(0,o.useContext)(i.Z);return(0,l.jsx)(d.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,n.h)(m),request:v,params:c,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:x.getPopupContainer},M),ref:r,proFieldProps:f},y),{},{children:u}))})),p=o.forwardRef(c);p.SearchSelect=f,p.displayName="ProFormComponent",r.Z=p},50628:function(e,r,t){var a=t(94433),s=t(38956),n=t(44194),o=t(9953),i=t(31549),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],l=n.forwardRef((function(e,r){var t=e.fieldProps,n=e.unCheckedChildren,l=e.checkedChildren,u=e.proFieldProps,g=(0,s.Z)(e,d);return(0,i.jsx)(o.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:n,checkedChildren:l},t),ref:r,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},g))}));r.Z=l},11818:function(e,r,t){t.d(r,{G:function(){return f}});var a=t(73193),s=t.n(a),n=(t(44194),t(47710)),o=t(94976),i=t(96596),d=t.n(i),l=t(67242),u=t(43388),g=t(58620),c=t(31549),f=function(e){var r=e.children,t=e.onSuccess,a=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},f={name:"file",accept:"image/*",action:(0,g.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){l.Z.log("beforeUpload",e);var r=d()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=r,i.fileType=e.type,l.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&l.Z.log("not uploading:",e.file),"done"===e.file.status)if(l.Z.log("response: ",e.file.response),200===e.file.response.code){var r,s=null===(r=e.file.response)||void 0===r?void 0:r.data.fileUrl;t(s),u.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,c.jsx)(n.Z,s()(s()({},f),{},{children:r}))}},21850:function(e,r,t){var a=t(25553);r.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},50680:function(e,r,t){t.r(r),t.d(r,{default:function(){return se}});var a=t(21850),s=t(6853),n=t(44194),o=t(73193),i=t.n(o),d=t(84176),l=t.n(d),u=t(90819),g=t.n(u),c=t(89933),f=t.n(c),p=t(45332),m=t.n(p),v=t(43388),h=t(33979),y=t(10162),M=t(34512),x=t(10390),b=t(43275),Z=t(69533),w=t(76711),j=t.n(w),C=t(74171),S=t(99036),P=t(86702),k=t(60241),F=t(50628),D=t(38644),R=t(59005),T=t(69705),I=t(30857),z=t(30310),E=t(26874),U=t(95018),Y=t(28582),B=t(55533),L=t(4628),A=t(11818),O=t(59908),N=t(14312),q=t(96596),H=t.n(q),V=t(31549),W=function(e){var r,t,a,s=e.isEdit,o=e.org,d=e.open,l=e.onClose,u=e.onSubmit,c=T.Z.useForm(),p=m()(c,1)[0],h=(0,L.useIntl)(),y=(0,C.u)((function(e){return e.currentOrg})),M=(0,n.useState)(""),x=m()(M,2),b=x[0],w=x[1],q=(0,n.useState)([]),W=m()(q,2),_=W[0],J=W[1],K=new Set(["df_fa_uid","df_sys_uid"]),Q=function(e){var r,t,a=null==e||null===(r=e.nickname)||void 0===r?void 0:r.toString().trim(),s=null==e||null===(t=e.username)||void 0===t?void 0:t.toString().trim();return a||s||h.formatMessage({id:"pages.user.displayName.empty",defaultMessage:"未命名用户"})},G=function(e){var r,t,a=null==e||null===(r=e.mobile)||void 0===r?void 0:r.toString().trim(),s=null==e||null===(t=e.email)||void 0===t?void 0:t.toString().trim();return a||s||h.formatMessage({id:"pages.user.contact.empty",defaultMessage:"未绑定手机号/邮箱"})};(0,n.useEffect)((function(){if(s){var e;p.setFieldsValue({name:null==o?void 0:o.name,logo:null==o?void 0:o.logo,code:null==o?void 0:o.code,description:null==o?void 0:o.description,verifiedType:null==o?void 0:o.verifiedType,identityType:null==o?void 0:o.identityType,identityImage:null==o?void 0:o.identityImage,identityNumber:null==o?void 0:o.identityNumber,verifyDate:null==o?void 0:o.verifyDate,verifyStatus:null==o?void 0:o.verifyStatus,rejectReason:null==o?void 0:o.rejectReason,vip:null==o?void 0:o.vip,vipExpireDate:null==o?void 0:o.vipExpireDate,userUid:null==o||null===(e=o.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==o?void 0:o.enabled)})}else{p.resetFields();new Date;var r=H()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");p.setFieldsValue({verifyStatus:"未认证",vip:!0,vipExpireDate:r,enabled:!0})}}),[d]),(0,n.useEffect)((function(){null!=o&&o.logo?w(o.logo):w("")}),[null==o?void 0:o.logo]),(0,n.useEffect)((function(){var e=function(){var e=f()(g()().mark((function e(){var r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d||null==y||!y.uid){e.next=4;break}return e.next=3,ee();case 3:s&&null!=o&&o.user&&(r={label:"".concat(Q(o.user)," (").concat(G(o.user),") - ").concat(h.formatMessage({id:"pages.org.admin.current",defaultMessage:"当前管理员"})),value:o.user.uid},J((function(e){return e.some((function(e){return e.value===r.value}))?e:[r].concat(j()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[d,null==y?void 0:y.uid,s,null==o?void 0:o.user]);var $,X,ee=function(){var e=f()(g()().mark((function e(r){var t,a,s,n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:20,searchText:r||"",orgUid:null==y?void 0:y.uid},console.log("Loading users with params:",a),e.next=5,(0,N.pz)(a);case 5:if(s=e.sent,console.log("loadUsers response:",s),200!==s.code||null==s||null===(t=s.data)||void 0===t||!t.content){e.next=12;break}return n=null==s?void 0:s.data.content.filter((function(e){if(null!=e&&e.uid&&K.has(e.uid))return!1;var r=e.currentOrganization&&e.currentOrganization.uid;return r&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!r})),o=n.map((function(e){return{label:"".concat(Q(e)," (").concat(G(e),")"),value:e.uid}})),J(o),e.abrupt("return",o);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 17:return e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(r){return e.apply(this,arguments)}}(),re=[{label:h.formatMessage({id:"pages.org.verifiedType.company",defaultMessage:"企业认证"}),value:"企业认证"},{label:h.formatMessage({id:"pages.org.verifiedType.personal",defaultMessage:"个人认证"}),value:"个人认证"},{label:h.formatMessage({id:"pages.org.verifiedType.governmentInstitution",defaultMessage:"政府事业单位认证"}),value:"政府事业单位认证"}],te=[{label:h.formatMessage({id:"pages.org.identityType.businessLicense",defaultMessage:"营业执照"}),value:"营业执照"},{label:h.formatMessage({id:"pages.org.identityType.idCard",defaultMessage:"身份证"}),value:"身份证"},{label:h.formatMessage({id:"pages.org.identityType.passport",defaultMessage:"护照"}),value:"护照"},{label:h.formatMessage({id:"pages.org.identityType.others",defaultMessage:"其他"}),value:"其他"}],ae=[{label:h.formatMessage({id:"pages.org.verifyStatus.unverified",defaultMessage:"未认证"}),value:"未认证"},{label:h.formatMessage({id:"pages.org.verifyStatus.verified",defaultMessage:"已认证"}),value:"已认证"},{label:h.formatMessage({id:"pages.org.verifyStatus.reviewing",defaultMessage:"审核中"}),value:"审核中"},{label:h.formatMessage({id:"pages.org.verifyStatus.reviewFailed",defaultMessage:"审核失败"}),value:"审核失败"}];return(0,V.jsx)(I.Z,{title:s?(0,V.jsx)(L.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,V.jsx)(L.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:l,open:d,width:600,extra:(0,V.jsxs)(z.Z,{children:[(0,V.jsx)(Z.ZP,{onClick:l,children:(0,V.jsx)(L.FormattedMessage,{id:"pages.common.cancel"})}),(0,V.jsx)(Z.ZP,{onClick:function(){p.validateFields().then((function(e){u(i()(i()(i()({},o),e),{},{logo:b,orgUid:null==y?void 0:y.uid}))})).catch((function(e){console.log("Form errors:",e),v.yw.error(h.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,V.jsx)(L.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,V.jsxs)(S.A,{form:p,submitter:!1,children:[(0,V.jsx)(P.Z,{name:"name",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,V.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,V.jsx)("div",{style:{marginBottom:"8px"},children:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,V.jsxs)(E.Z,{gutter:[16,16],align:"middle",children:[(0,V.jsx)(U.Z,{children:(0,V.jsx)(Y.Z,{src:b,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,V.jsx)(U.Z,{children:(0,V.jsx)(A.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),w(e),p.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,V.jsx)(Z.ZP,{type:"primary",icon:(0,V.jsx)(O.Z,{}),size:"small",children:h.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,V.jsx)(P.Z,{name:"code",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:h.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,V.jsx)(k.Z,{name:"description",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:h.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,V.jsx)(F.Z,{name:"vip",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,V.jsx)(D.Z,{name:"vipExpireDate",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:h.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var r=new Date(e);return r.setHours(0,0,0,0),r.toISOString()}return e}}),(0,V.jsx)(R.Z,{name:"userUid",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:h.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==o||null===(r=o.user)||void 0===r?void 0:r.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(X=f()(g()().mark((function e(r){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",r),e.next=3,ee(r);case 3:case"end":return e.stop()}}),e)}))),function(e){return X.apply(this,arguments)}),onFocus:($=f()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,ee();case 3:case"end":return e.stop()}}),e)}))),function(){return $.apply(this,arguments)}),options:_}}),(0,V.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,V.jsx)(F.Z,{name:"enabled",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==o||null===(t=o.user)||void 0===t?void 0:t.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==o?void 0:o.enabled),title:!0===(null==o||null===(a=o.user)||void 0===a?void 0:a.superUser)?h.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,V.jsx)(B.Z,{defaultActiveKey:[],items:[{key:"1",label:h.formatMessage({id:"pages.org.verificationInfo",defaultMessage:"认证信息"}),children:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(R.Z,{name:"verifiedType",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:re,placeholder:h.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,V.jsx)(R.Z,{name:"identityType",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:te,placeholder:h.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,V.jsx)(P.Z,{name:"identityImage",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:h.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,V.jsx)(P.Z,{name:"identityNumber",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:h.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,V.jsx)(P.Z,{name:"verifyDate",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:h.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请输入认证时间"})}),(0,V.jsx)(R.Z,{name:"verifyStatus",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:ae,placeholder:h.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,V.jsx)(k.Z,{name:"rejectReason",label:(0,V.jsx)(L.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:h.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},_=t(1715),J=t(29892),K=t(88722),Q=t(94976),G=t(21586),$=t(16658),X=t(67242),ee=t(58620),re=["current","pageSize"],te=function(){var e=(0,L.useIntl)(),r=(0,n.useRef)(),t=(0,K.Z)().translateString,a=(0,n.useState)(!0),s=m()(a,2),o=s[0],d=s[1],u=(0,n.useState)(),c=m()(u,2),p=c[0],w=c[1],j=(0,n.useState)(!1),S=m()(j,2),P=S[0],k=S[1],F=(0,n.useState)(1),D=m()(F,2),R=(D[0],D[1]),T=(0,n.useState)(10),I=m()(T,2),z=I[0],E=I[1],U=(0,C.u)((function(e){return e.currentOrg})),Y=(0,J.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),B=Y.setRoleResult,A=Y.setRoleResultPlatform,O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,r){return r.logo?(0,V.jsx)("img",{src:r.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,r){return(0,$._i)(r.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,r){return(0,$.Cy)(r.verifyStatus)}},{title:e.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,r){return r.verifyDate?H()(r.verifyDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(r,t){return t.vip?e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,r){return r.vipExpireDate?H()(r.vipExpireDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(r,t){return!1===t.enabled?e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,r){return r.user?(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{children:r.user.nickname||r.user.username}),(0,V.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:r.user.email})]}):"-"}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.createdAt?H()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.updatedAt?H()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],N=[].concat(O,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(r,t,a,s){var o,i=!0===(null===(o=t.user)||void 0===o?void 0:o.superUser);return[(0,V.jsx)("a",{onClick:function(){ae(t)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,V.jsxs)(n.Fragment,{children:[(0,V.jsx)(x.Z,{type:"vertical"},"divider"),(0,V.jsx)(b.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:t.name||t.code}),onConfirm:function(){return se(t)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,V.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),q=(0,_.v)((function(e){return e.currentCategory})),te=function(){w(void 0),d(!1),k(!0)},ae=function(e){w(e),d(!0),k(!0)},se=function(){var a=f()(g()().mark((function a(s){var n,o,i;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!0!==(null===(n=s.user)||void 0===n?void 0:n.superUser)){a.next=3;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),a.abrupt("return");case 3:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),a.prev=4,a.next=7,(0,G.FR)({uid:s.uid});case 7:o=a.sent,v.yw.destroy(),200===o.code?(v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=r.current)||void 0===i||i.reloadAndRest()):v.yw.error(t(o.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(4),v.yw.destroy(),v.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",a.t0);case 17:case"end":return a.stop()}}),a,null,[[4,12]])})));return function(e){return a.apply(this,arguments)}}(),ne=function(){var t=f()(g()().mark((function t(a){var s,n,i;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(X.Z.debug("handleSubmitDrawer",a),!o||!0!==(null==p||null===(s=p.user)||void 0===s?void 0:s.superUser)||!1!==a.enabled){t.next=4;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),t.abrupt("return");case 4:if(o?v.yw.loading(e.formatMessage({id:"updating"})):v.yw.loading(e.formatMessage({id:"creating"})),!o){t.next=11;break}return t.next=8,(0,G.jM)(a);case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,(0,G.c5)(a);case 13:t.t0=t.sent;case 14:n=t.t0,X.Z.debug("createOrg response:",a,n),200===n.code?(v.yw.destroy(),v.yw.success(o?e.formatMessage({id:"update.success",defaultMessage:"Update successful"}):e.formatMessage({id:"create.success",defaultMessage:"Create successful"})),k(!1),null===(i=r.current)||void 0===i||i.reloadAndRest()):(v.yw.destroy(),v.yw.error(n.message));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),oe=function(){var r=f()(g()().mark((function r(){var t,a;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,orgUid:null==U?void 0:U.uid},r.next=4,(0,h.E9)(t);case 4:a=r.sent,X.Z.debug("queryRolesByOrg response ",a),200===a.code?(v.yw.destroy(),B(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),ie=function(){var r=f()(g()().mark((function r(){var t,a;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,level:Q.Hxq},r.next=4,(0,h.E9)(t);case 4:a=r.sent,X.Z.debug("queryRolesBySuper response ",a),200===a.code?(v.yw.destroy(),A(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return(0,n.useEffect)((function(){oe(),ie()}),[]),(0,n.useEffect)((function(){var e;X.Z.debug("currentCategory:",q),null===(e=r.current)||void 0===e||e.reloadAndRest()}),[q]),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(M.Z,{columns:N,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var r=f()(g()().mark((function r(a,s,n){var o,d,u,c,f,p,m,h;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return X.Z.debug("request:",a,s,n),v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=a.current,d=a.pageSize,u=l()(a,re),R(o),E(d),c=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],c=p,f="ascend"===s[p]?"ascend":"descend"),m=i()({pageNumber:o-1,pageSize:d,superUser:!0,sortBy:c,sortDirection:f},u),r.next=11,(0,G.$S)(m);case 11:return h=r.sent,X.Z.debug("getAllOrgs response:",m,h),v.yw.destroy(),200===h.code||v.yw.error(t(h.message)),r.abrupt("return",{data:null==h?void 0:h.data.content,success:!0,total:null==h?void 0:h.data.totalElements});case 16:case"end":return r.stop()}}),r)})));return function(e,t,a){return r.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:z,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,r){X.Z.debug("pagination onChange:",e,r),R(e),E(r)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,V.jsx)(Z.ZP,{icon:(0,V.jsx)(y.Z,{}),type:"primary",onClick:te,disabled:!(0,ee.OJ)(),children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),P&&(0,V.jsx)(W,{isEdit:o,open:P,org:p,onClose:function(){k(!1)},onSubmit:ne})]})},ae=s.Z.Content,se=function(){var e=(0,a.Z)().contentStyle;return(0,V.jsx)(s.Z,{children:(0,V.jsx)(s.Z,{children:(0,V.jsx)(ae,{style:e,children:(0,V.jsx)(te,{})})})})}},1715:function(e,r,t){t.d(r,{v:function(){return p}});var a=t(86222),s=t.n(a),n=t(73193),o=t.n(n),i=t(76711),d=t.n(i),l=t(94976),u=t(26557),g=t(26407),c=t(20744),f=t(67242);var p=(0,u.Ue)()((0,g.mW)((0,g.tJ)((0,c.n)((function(e,r){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:l.zBg,name:l.zBg},setCategoryResult:function(r){var t=function(e){var r,t=[];return function e(r,a){r&&0!==r.length&&r.forEach((function(r){if(r&&r.uid&&r.uid!==l.zBg){var s=a?"".concat(a," / ").concat(r.name):r.name||"";t.push({label:s,value:r.uid}),r.children&&r.children.length>0&&e(r.children,s)}}))}((null==e||null===(r=e.data)||void 0===r?void 0:r.content)||[]),t}(r),a=function(e){var r,t=(null==e||null===(r=e.data)||void 0===r?void 0:r.content)||[],a=function e(r){var t={title:r.name||"",key:r.uid||""};return r.children&&r.children.length>0&&(t.children=r.children.map((function(r){return e(r)}))),t};return t.filter((function(e){return e&&e.uid&&e.uid!==l.zBg})).map((function(e){return a(e)}))}(r),s=[{title:l.zBg,key:l.zBg}].concat(d()(a)),n={uid:l.zBg,name:l.zBg},i=o()(o()({},r),{},{data:o()(o()({},r.data),{},{content:[n].concat(d()(r.data.content))})});e({categoryResult:i,categoryTreeOptions:s,categorySelectOptions:t}),0===r.data.content.length&&e({currentCategory:{uid:l.zBg,name:l.zBg}})},insertCategory:function(r){e((function(e){e.categoryResult.data.content.unshift(r)}))},upgradeCategory:function(r){e((function(e){var t=e.categoryResult.data.content,a=t.findIndex((function(e){return e.uid===r.uid}));-1!==a?t[a]=r:console.warn("Category with uid ".concat(r.uid," not found."))}))},setCurrentCategory:function(r){e({currentCategory:r})},resetDefaultCategory:function(){f.Z.log("resetDefaultCategory"),e({currentCategory:{uid:l.zBg,name:l.zBg}})},setCurrentCategoryUid:function(t){if(t!==l.zBg){var a=function e(r,t){if(r&&0!==r.length){var a,n=s()(r);try{for(n.s();!(a=n.n()).done;){var o=a.value;if((null==o?void 0:o.uid)===t)return o;var i=e(null==o?void 0:o.children,t);if(i)return i}}catch(e){n.e(e)}finally{n.f()}}}(r().categoryResult.data.content,t);e({currentCategory:null!=a?a:{uid:l.zBg,name:l.zBg}})}else e({currentCategory:{uid:l.zBg,name:l.zBg}})},deleteCategoryCache:function(){return e({},!0)}}})),{name:l.OMm})))}}]);