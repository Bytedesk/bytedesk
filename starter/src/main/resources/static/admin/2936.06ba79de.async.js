"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2936],{11293:function(e,t,n){n.d(t,{Bg:function(){return c},Ch:function(){return m},Gv:function(){return k},L3:function(){return Z},bD:function(){return g},mE:function(){return M},nQ:function(){return y},nU:function(){return h},oX:function(){return S}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(14906),d=n(39497);function c(e){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(t){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.orgUid,r=t.workgroupUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(n,"/workgroups/").concat(r),{method:"GET",params:{channel:d.XtJ}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/publish",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return w.apply(this,arguments)}function w(){return(w=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return b.apply(this,arguments)}function b(){return(b=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return j.apply(this,arguments)}function j(){return(j=o()(a()().mark((function e(t,n){var r,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,s=t.orgUid,e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/".concat(r,"/orgs/").concat(s,"/bindings"),{method:"POST",data:i()(i()({},n),{},{channel:d.XtJ})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/bindings",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){return I.apply(this,arguments)}function I(){return(I=o()(a()().mark((function e(t,n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/ticket/settings/orgs/".concat(t,"/workgroups/").concat(n,"/categories"),{method:"GET",params:{channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},75112:function(e,t,n){var r=n(14597);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},14195:function(e,t,n){var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(45332),d=n.n(l),c=n(44194),f=n(41196),g=n(86895),p=n(32525),m=n(66431),v=n(14906),h=n(19433),x=n(43167),k=n(31549);t.Z=function(e){var t=e.open,n=e.onOpenChange,r=e.orgUid,s=e.record,u=e.onSuccess,l=(0,v.useIntl)(),w=f.Z.useForm(),M=d()(w,1)[0];(0,c.useEffect)((function(){var e,n;t&&(s?M.setFieldsValue({name:s.name||"",description:s.description||"",enabled:null===(e=s.enabled)||void 0===e||e,isDefault:null!==(n=s.isDefault)&&void 0!==n&&n}):(M.resetFields(),M.setFieldsValue({enabled:!0,isDefault:!1})))}),[t,s,M]);var b=function(){var e=o()(a()().mark((function e(){var t,o,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.validateFields();case 3:if(t=e.sent,o=i()(i()({},t),{},{orgUid:r,uid:null==s?void 0:s.uid}),null==s||!s.uid){e.next=11;break}return e.next=8,(0,x.Y2)(o);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,x.jT)(o);case 13:e.t0=e.sent;case 14:(d=e.t0)&&200===d.code?(h.yw.success(l.formatMessage({id:null!=s&&s.uid?"common.updated":"common.created",defaultMessage:null!=s&&s.uid?"更新成功":"创建成功"})),null==u||u(),n(!1)):h.yw.error((null==d?void 0:d.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving workgroup settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,k.jsx)(g.Z,{title:(0,k.jsx)(v.FormattedMessage,{id:null!=s&&s.uid?"workgroup.settings.template.edit":"workgroup.settings.template.create",defaultMessage:null!=s&&s.uid?"编辑模板":"新建模板"}),open:t,onOk:b,onCancel:function(){return n(!1)},okText:(0,k.jsx)(v.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,k.jsx)(v.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,k.jsxs)(f.Z,{form:M,layout:"vertical",preserve:!1,children:[(0,k.jsx)(f.Z.Item,{name:"name",label:(0,k.jsx)(v.FormattedMessage,{id:"workgroup.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:l.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,k.jsx)(p.Z,{placeholder:l.formatMessage({id:"workgroup.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,k.jsx)(f.Z.Item,{name:"description",label:(0,k.jsx)(v.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,k.jsx)(p.Z.TextArea,{rows:3,placeholder:l.formatMessage({id:"workgroup.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,k.jsx)(f.Z.Item,{name:"enabled",label:(0,k.jsx)(v.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,k.jsx)(m.Z,{})})]})})}},872:function(e,t,n){n.d(t,{Z:function(){return G}});var r=n(10154),a=n.n(r),s=n(73193),i=n.n(s),u=n(86222),o=n.n(u),l=n(90819),d=n.n(l),c=n(89933),f=n.n(c),g=n(45332),p=n.n(g),m=n(44194),v=n(14906),h=n(89246),x=n(33797),k=n(78578),w=n(81739),M=n(63649),b=n(82770),y=n(19433),j=n(2077),S=n(11293),C=n(98830),Z=n(39497),I=n(75864),A=n(2250),U=n(25784),T=n(89965),F=n(80953),O=n(43167),q=n(14195),E=n(39487),B=n(10162),P=n(33019),D=n(10404),W=n(91361),z=n(31549),R=function(e){var t,n,r,a=e.open,s=e.record,u=e.onClose,o=e.onSuccess,l=(0,v.useIntl)(),c=(0,W.Z)().translateString,g=(0,C.u)((function(e){return e.currentOrg})),h=(0,m.useMemo)((function(){return!(null==s||!s.uid)}),[s]),x=(0,m.useState)(!1),k=p()(x,2),w=k[0],M=k[1],S=(0,m.useState)([]),Z=p()(S,2),R=Z[0],L=Z[1],V=(0,m.useState)(!1),J=p()(V,2),N=J[0],X=J[1],G=(0,m.useState)(0),Y=p()(G,2),H=Y[0],Q=Y[1],_=(0,m.useRef)(),K=(0,D.E)((function(e){return e.agentResult})),$=(0,D.E)((function(e){return e.setAgentResult})),ee=(0,m.useCallback)(function(){var e=f()(d()().mark((function e(t){var n,r,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==g?void 0:g.uid,searchText:t||""},e.next=5,(0,O.zc)(r);case 5:return a=e.sent,s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],L(s),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 9:return e.prev=9,X(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[null==g?void 0:g.uid]);return(0,m.useEffect)((function(){var e=function(){var e=f()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&null!=g&&g.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:g.uid},e.next=6,(0,P._t)(t);case 6:200===(null==(n=e.sent)?void 0:n.code)?$(n):null!=n&&n.message&&y.yw.warning(n.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[a,null==g?void 0:g.uid,$]),(0,z.jsxs)(I.a,{open:a,onOpenChange:function(e){e||u()},title:h?l.formatMessage({id:"workgroup.edit",defaultMessage:"编辑工作组"}):l.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),width:520,formRef:_,initialValues:h?{nickname:null==s?void 0:s.nickname,description:null==s?void 0:s.description,settingsUid:null==s||null===(t=s.settings)||void 0===t?void 0:t.uid,agents:(null==s||null===(n=s.agents)||void 0===n?void 0:n.map((function(e){return e.uid})))||[]}:{},autoFocusFirstInput:!0,drawerProps:{destroyOnHidden:!0,maskClosable:!0},submitter:{searchConfig:{submitText:l.formatMessage({id:"save",defaultMessage:"保存"}),resetText:l.formatMessage({id:"cancel",defaultMessage:"取消"})},resetButtonProps:{onClick:function(){return u()}}},onFinish:function(){var e=f()(d()().mark((function e(t){var n,r,a,c,f;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.yw.loading(l.formatMessage({id:h?"updating":"creating",defaultMessage:h?"Updating":"Creating"})),!h){e.next=9;break}return a=i()(i()(i()({},s),t),{},{agentUids:t.agents}),e.next=6,(0,j.W5)(a);case 6:r=e.sent,e.next=13;break;case 9:return c={nickname:t.nickname,description:t.description,settingsUid:t.settingsUid,orgUid:null==g?void 0:g.uid,agentUids:t.agents},e.next=12,(0,j.p0)(c);case 12:r=e.sent;case 13:if(y.yw.destroy(),200!==(null===(n=r)||void 0===n?void 0:n.code)){e.next=21;break}return y.yw.success(l.formatMessage({id:"save.success",defaultMessage:"保存成功"})),null==o||o(r.data),u(),e.abrupt("return",!0);case 21:return y.yw.error((null===(f=r)||void 0===f?void 0:f.message)||l.formatMessage({id:"save.failed",defaultMessage:"保存失败"})),e.abrupt("return",!1);case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),y.yw.destroy(),y.yw.error(l.formatMessage({id:"save.error",defaultMessage:"保存出错"})),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}(),children:[(0,z.jsx)(A.Z,{name:"agents",label:l.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),placeholder:l.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),options:((null==K||null===(r=K.data)||void 0===r?void 0:r.content)||[]).map((function(e){return{value:e.uid,label:c(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0}}),(0,z.jsx)(U.A.Item,{label:l.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),children:(0,z.jsxs)(E.Z.Compact,{style:{width:"100%"},children:[(0,z.jsx)("div",{style:{flex:1},children:(0,z.jsx)(A.Z,{name:"settingsUid",label:!1,placeholder:l.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),rules:[{required:!0,message:l.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],showSearch:!0,debounceTime:300,params:{reloadStamp:H},request:function(){var e=f()(d()().mark((function e(t){var n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",ee(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{style:{width:"100%"},filterOption:!1,loading:N,notFoundContent:0===R.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:l.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(b.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(B.Z,{}),onClick:function(){return M(!0)},children:l.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0}})}),(0,z.jsx)(b.ZP,{size:"small",icon:(0,z.jsx)(B.Z,{}),onClick:function(){return M(!0)},title:l.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:l.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,z.jsx)(T.Z,{name:"nickname",label:l.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),rules:[{required:!0,message:l.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,z.jsx)(F.Z,{name:"description",label:l.formatMessage({id:"workgroup.info.description",defaultMessage:"描述"})}),(0,z.jsx)(q.Z,{open:w,onOpenChange:M,orgUid:(null==g?void 0:g.uid)||"",record:null,onSuccess:function(){M(!1),Q((function(e){return e+1}))}})]})},L=n(86895),V=function(e){var t,n=e.open,r=e.onClose,a=e.onSubmit,s=(0,v.useIntl)(),i=U.A.useForm(),u=p()(i,1)[0],o=(0,W.Z)().translateString,l=(0,C.u)((function(e){return e.currentOrg})),c=(0,D.E)((function(e){return e.agentResult})),g=(0,D.E)((function(e){return e.setAgentResult})),h=(0,m.useState)([]),x=p()(h,2),k=x[0],w=x[1],M=(0,m.useState)(!1),j=p()(M,2),S=j[0],Z=j[1],I=(0,m.useState)(!1),F=p()(I,2),R=F[0],V=F[1],J=(0,m.useState)(0),N=p()(J,2),X=N[0],G=N[1],Y=(0,m.useState)([]),H=p()(Y,2),Q=H[0],_=H[1];(0,m.useEffect)((function(){n&&(u.setFieldsValue({nickname:"",agents:[]}),w([]))}),[n]);var K=(0,m.useCallback)(function(){var e=f()(d()().mark((function e(t){var n,r,a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),e.prev=1,r={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==l?void 0:l.uid,searchText:t||""},e.next=5,(0,O.zc)(r);case 5:return a=e.sent,console.log("queryWorkgroupSettingsByOrg response:",a,r),s=(null==a||null===(n=a.data)||void 0===n?void 0:n.content)||[],_(s),!u.getFieldValue("settingsUid")&&s.length>0&&u.setFieldsValue({settingsUid:s[0].uid}),e.abrupt("return",s.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})));case 11:return e.prev=11,V(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[null==l?void 0:l.uid,u]);(0,m.useEffect)((function(){var e=function(){var e=f()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=l&&l.uid){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={pageNumber:0,pageSize:100,sortDirection:"ascend",orgUid:l.uid},e.next=6,(0,P._t)(t);case 6:200===(null==(r=e.sent)?void 0:r.code)?g(r):null!=r&&r.message&&y.yw.warning(r.message),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();e()}),[n,null==l?void 0:l.uid,g]);return(0,z.jsx)("div",{children:(0,z.jsxs)(L.Z,{title:s.formatMessage({id:"workgroup.new",defaultMessage:"新建工作组"}),open:n,forceRender:!0,onOk:function(){console.log("handleOk"),u.validateFields().then((function(e){console.log("form values:",e);var t={nickname:u.getFieldValue("nickname"),agentUids:u.getFieldValue("agents"),settingsUid:u.getFieldValue("settingsUid"),orgUid:null==l?void 0:l.uid};console.log("workgroup:",t),a(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),r()},children:[(0,z.jsxs)(U.A,{form:u,name:"wgForm",submitter:{render:function(e,t){return(0,z.jsx)(z.Fragment,{})}},children:[(0,z.jsx)(A.Z,{name:"settingsUid",label:s.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),rules:[{required:!0,message:s.formatMessage({id:"workgroup.settings.required",defaultMessage:"请选择工作组配置"})}],placeholder:s.formatMessage({id:"workgroup.settings.placeholder",defaultMessage:"请选择工作组配置"}),showSearch:!0,debounceTime:300,params:{reloadStamp:X},request:function(){var e=f()(d()().mark((function e(t){var n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyWords,e.abrupt("return",K(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fieldProps:{filterOption:!1,loading:R,notFoundContent:0===Q.length?(0,z.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,z.jsx)("div",{style:{marginBottom:8,color:"#999"},children:s.formatMessage({id:"workgroup.settings.empty",defaultMessage:"暂无配置模板"})}),(0,z.jsx)(b.ZP,{size:"small",type:"primary",icon:(0,z.jsx)(B.Z,{}),onClick:function(){return Z(!0)},children:s.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"})})]}):void 0},renderFormItem:function(e,t){var n;return(0,z.jsxs)(E.Z.Compact,{block:!0,children:[null===(n=t.defaultRender)||void 0===n?void 0:n.call(t,e),(0,z.jsx)(b.ZP,{size:"small",icon:(0,z.jsx)(B.Z,{}),onClick:function(){return Z(!0)},title:s.formatMessage({id:"workgroup.settings.create",defaultMessage:"创建配置"}),children:s.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}}),(0,z.jsx)(T.Z,{label:s.formatMessage({id:"workgroup.info.nickname",defaultMessage:"名称"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"workgroup.info.nickname.required",defaultMessage:"请输入名称"})}]}),(0,z.jsx)(A.Z,{name:"agents",label:s.formatMessage({id:"workgroup.members",defaultMessage:"成员"}),options:((null==c||null===(t=c.data)||void 0===t?void 0:t.content)||[]).map((function(e){return{value:e.uid,label:o(e.nickname)}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:s.formatMessage({id:"workgroup.members.placeholder",defaultMessage:"请选择成员"}),value:k,onChange:function(e){console.log("selected ".concat(e)),w(e)}}})]}),(0,z.jsx)(q.Z,{open:S,onOpenChange:Z,orgUid:(null==l?void 0:l.uid)||"",record:null,onSuccess:function(){Z(!1),G((function(e){return e+1}))}})]})})},J=n(13847),N=function(e){var t=e.open,n=e.orgUid,r=e.workgroup,a=e.onClose,s=e.onSuccess,i=(0,v.useIntl)(),u=(0,m.useState)([]),o=p()(u,2),l=o[0],c=o[1],g=(0,m.useState)(),h=p()(g,2),x=h[0],k=h[1],w=(0,m.useState)(!1),M=p()(w,2),b=M[0],j=M[1];(0,m.useEffect)((function(){var e=function(){var e=f()(d()().mark((function e(){var a,s,i,u,o,l,f,g,p;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,s={orgUid:n,pageNumber:0,pageSize:200,enabled:!0},e.next=6,(0,S.Bg)(s);case 6:if(i=e.sent,console.log("Ticket settings response:",i,s),u=(null==i||null===(a=i.data)||void 0===a?void 0:a.content)||[],o=u.filter((function(e){return!(null==e||!e.enabled)})),l=o.map((function(e){return{label:e.name||e.uid,value:e.uid}})),c(l),null==r||!r.uid){e.next=20;break}return e.next=15,(0,S.bD)({orgUid:n,workgroupUid:r.uid});case 15:g=e.sent,p=null==g||null===(f=g.data)||void 0===f?void 0:f.uid,k(p||void 0),e.next=21;break;case 20:k(void 0);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(2),c([]);case 26:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(){return e.apply(this,arguments)}}();e()}),[t,n,null==r?void 0:r.uid]);var C=function(){var e=f()(d()().mark((function e(){var t,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&null!=r&&r.uid&&x){e.next=2;break}return e.abrupt("return");case 2:return j(!0),e.prev=3,e.next=6,(0,S.nQ)({uid:x,orgUid:n},{workgroupUids:[r.uid]});case 6:200===(null==(t=e.sent)?void 0:t.code)?(y.yw.success(i.formatMessage({id:"ticket.settings.bind.success",defaultMessage:"绑定已更新"})),a=l.find((function(e){return e.value===x})),s({uid:x,name:(null==a?void 0:a.label)||x})):y.yw.error((null==t?void 0:t.message)||i.formatMessage({id:"ticket.settings.bind.failed",defaultMessage:"绑定失败"}));case 8:return e.prev=8,j(!1),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})));return function(){return e.apply(this,arguments)}}();return(0,z.jsxs)(L.Z,{title:i.formatMessage({id:"workgroup.ticket.template.modal.title",defaultMessage:"设置工单配置模板"}),open:t,onCancel:a,onOk:C,okButtonProps:{loading:b},destroyOnHidden:!0,children:[(0,z.jsx)("div",{style:{marginBottom:8},children:i.formatMessage({id:"workgroup.ticket.template.tip",defaultMessage:"请选择已启用的工单配置模板"})}),(0,z.jsx)(J.Z,{style:{width:"100%"},placeholder:i.formatMessage({id:"workgroup.ticket.template.placeholder",defaultMessage:"选择模板"}),options:l,value:x,onChange:k,showSearch:!0,filterOption:function(e,t){return(null==t?void 0:t.label).toLowerCase().includes(e.toLowerCase())}})]})},X=n(23753),G=function(e){var t=e.superUser,n=(0,v.useIntl)(),r=(0,m.useRef)(),s=(0,C.u)((function(e){return e.currentOrg})),u=(0,m.useState)(!1),l=p()(u,2),c=l[0],g=l[1],I=(0,m.useState)(!1),A=p()(I,2),U=A[0],T=A[1],F=(0,m.useState)(null),O=p()(F,2),q=O[0],E=O[1],B=(0,m.useState)(!1),P=p()(B,2),D=P[0],W=P[1],L=(0,m.useState)(null),J=p()(L,2),G=J[0],Y=J[1],H=(0,m.useState)({}),Q=p()(H,2),_=Q[0],K=Q[1],$=function(){var e=f()(d()().mark((function e(t){var n,r,a,u,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.uid&&Array.isArray(t)&&0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Promise.all(t.map(function(){var e=f()(d()().mark((function e(t){var n,r,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,(0,S.bD)({orgUid:s.uid,workgroupUid:t.uid});case 5:if(n=e.sent,r=null==n?void 0:n.data,a=null==r?void 0:r.name,!(null==r?void 0:r.uid)||!a){e.next=11;break}return e.abrupt("return",[t.uid,a]);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(2);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()));case 5:n=e.sent,r={},a=o()(n);try{for(a.s();!(u=a.n()).done;)(l=u.value)&&(r[l[0]]=l[1])}catch(e){a.e(e)}finally{a.f()}Object.keys(r).length>0&&K((function(e){return i()(i()({},e),r)})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:n.formatMessage({id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,ellipsis:!0,fixed:"left",hideInSearch:!0},{title:n.formatMessage({id:"avatar",defaultMessage:"Avatar"}),dataIndex:"avatar",width:64,hideInSearch:!0,render:function(e,t){return(0,z.jsx)(x.Z,{src:null==t?void 0:t.avatar})}},{title:n.formatMessage({id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",copyable:!0,width:220,hideInSearch:!0},{title:n.formatMessage({id:"workgroup.members",defaultMessage:"客服"}),dataIndex:"agents",width:420,hideInSearch:!0,ellipsis:!0,render:function(e,t){var r=(null==t?void 0:t.agents)||[];if(null==r||!r.length)return(0,z.jsx)("span",{style:{color:"#999"},children:n.formatMessage({id:"workgroup.members.empty",defaultMessage:"暂无客服"})});var a=function(e){switch(e){case"AVAILABLE":return"blue";case"BUSY":return"red";case"AWAY":return"orange";default:return"default"}},s=function(e){switch(e){case"AVAILABLE":return n.formatMessage({id:"agent.status.available",defaultMessage:"空闲"});case"BUSY":return n.formatMessage({id:"agent.status.busy",defaultMessage:"忙碌"});case"AWAY":return n.formatMessage({id:"agent.status.away",defaultMessage:"离开"});case"OFFLINE":return n.formatMessage({id:"agent.status.offline",defaultMessage:"离线"});default:return e||n.formatMessage({id:"unknown",defaultMessage:"未知"})}};return(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,minWidth:0},children:[(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,z.jsx)(x.Z.Group,{max:{count:5},size:"small",children:r.map((function(e){var t;return(0,z.jsx)(k.Z,{title:null==e?void 0:e.nickname,children:(0,z.jsx)(x.Z,{src:null==e?void 0:e.avatar,children:null===(t=(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)||"?")||void 0===t?void 0:t.slice(0,1)})},null==e?void 0:e.uid)}))}),(0,z.jsx)("span",{style:{color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.map((function(e){return null==e?void 0:e.nickname})).filter(Boolean).join("、")})]}),(0,z.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:[r.slice(0,12).map((function(e){var t=null==e?void 0:e.connected;return(0,z.jsxs)(w.Z,{color:t?"green":a(null==e?void 0:e.status),style:{margin:0},children:[(null==e?void 0:e.nickname)||(null==e?void 0:e.uid)||"?"," ",t?n.formatMessage({id:"agent.online",defaultMessage:"在线"}):n.formatMessage({id:"agent.offline",defaultMessage:"离线"})," / ",s(null==e?void 0:e.status)]},(null==e?void 0:e.uid)+"_tag")})),r.length>12&&(0,z.jsxs)(w.Z,{color:"purple",style:{margin:0},children:["+",r.length-12]},"more")]})]})}},{title:n.formatMessage({id:"workgroup.connected.count",defaultMessage:"在线客服数"}),dataIndex:"connectedAgentCount",width:100,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{color:"green",children:null!==(n=null==t?void 0:t.connectedAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.available.count",defaultMessage:"可接待客服数"}),dataIndex:"availableAgentCount",width:120,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{color:"blue",children:null!==(n=null==t?void 0:t.availableAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.connectedAndAvailable.count",defaultMessage:"在线并可接待客服数"}),dataIndex:"connectedAndAvailableAgentCount",width:150,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{color:"blue",children:null!==(n=null==t?void 0:t.connectedAndAvailableAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.busy.count",defaultMessage:"忙碌客服数"}),dataIndex:"busyAgentCount",width:100,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{color:"red",children:null!==(n=null==t?void 0:t.busyAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.away.count",defaultMessage:"离开客服数"}),dataIndex:"awayAgentCount",width:100,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{color:"orange",children:null!==(n=null==t?void 0:t.awayAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.offline.count",defaultMessage:"离线客服数"}),dataIndex:"offlineAgentCount",width:100,hideInSearch:!0,render:function(e,t){var n;return(0,z.jsx)(w.Z,{children:null!==(n=null==t?void 0:t.offlineAgentCount)&&void 0!==n?n:0})}},{title:n.formatMessage({id:"workgroup.settings",defaultMessage:"工作组配置"}),dataIndex:"settings",width:200,hideInSearch:!0,render:function(e,t){return null!=t&&t.settings?(0,z.jsx)("a",{onClick:function(){E(t),g(!0)},children:t.settings.name||n.formatMessage({id:"workgroup.settings.configured",defaultMessage:"已配置"})}):(0,z.jsx)("a",{style:{color:"#ff4d4f"},onClick:function(){E(t),g(!0)},children:n.formatMessage({id:"workgroup.settings.unconfigured",defaultMessage:"未配置，点击配置"})})}},{title:n.formatMessage({id:"workgroup.ticket.template",defaultMessage:"工单配置模板"}),dataIndex:"ticketTemplate",width:220,hideInSearch:!0,render:function(e,t){var r=_[t.uid],a=r?void 0:{color:"#ff4d4f"};return(0,z.jsx)("a",{onClick:function(){return e=t,void(null!=s&&s.uid&&null!=e&&e.uid&&(Y(e),W(!0)));var e},style:a,children:r||n.formatMessage({id:"workgroup.ticket.template.choose",defaultMessage:"设置/修改模板"})})}},{title:n.formatMessage({id:"description",defaultMessage:"Description"}),dataIndex:"description",ellipsis:!0,hideInSearch:!0},{title:n.formatMessage({id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",width:180,sorter:!0,hideInSearch:!0},{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:260,fixed:"right",render:function(e,t){return[(0,z.jsx)("a",{onClick:function(){return function(e){var t;if(null!=e&&e.uid){var r={chatConfig:{org:null==s?void 0:s.uid,t:Z.I$6,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else y.yw.error(n.formatMessage({id:"workgroup.invalid",defaultMessage:"无效的工作组"}))}(t)},children:n.formatMessage({id:"chat.test",defaultMessage:"测试"})},"test"),(0,z.jsx)("a",{onClick:function(){return v.history.push("/service/channel")},children:n.formatMessage({id:"workgroup.get.code",defaultMessage:"获取工作组代码"})},"code"),(0,z.jsx)("a",{onClick:function(){E(t),g(!0)},children:n.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit"),(0,z.jsx)(M.Z,{title:n.formatMessage({id:"deleteTip",defaultMessage:"删除确认"}),description:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确认删除"}),"【").concat(null==t?void 0:t.nickname,"】？"),onConfirm:f()(d()().mark((function e(){var a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),e.prev=1,e.next=4,(0,j.zl)(t);case 4:a=e.sent,y.yw.destroy(),200===(null==a?void 0:a.code)?(y.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=r.current)||void 0===s||s.reload()):y.yw.error((null==a?void 0:a.message)||"Delete failed"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),y.yw.destroy(),y.yw.error("Delete error");case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),okText:n.formatMessage({id:"ok",defaultMessage:"OK"}),cancelText:n.formatMessage({id:"cancel",defaultMessage:"Cancel"}),children:(0,z.jsx)("a",{children:n.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}},{title:n.formatMessage({id:"search",defaultMessage:"Search"}),dataIndex:"searchText",valueType:"text",hideInTable:!0,hideInSearch:!1}];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(h.Z,{columns:ee,actionRef:r,rowKey:"uid",cardBordered:!0,scroll:{x:"max-content"},search:{labelWidth:"auto"},onLoad:function(e){$(e||[])},toolBarRender:function(){return[(0,z.jsx)(b.ZP,{type:"primary",onClick:function(){E(null),T(!0)},children:n.formatMessage({id:"pages.robot.new",defaultMessage:"New"})},"new")]},request:function(){var e=f()(d()().mark((function e(n,r){var a,u,o,l,c,f,g,m,v,h,x,k,w,M,b,y,S,C,Z,I,A,U;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=(null!==(a=null==n?void 0:n.current)&&void 0!==a?a:1)-1,c=null!==(u=null==n?void 0:n.pageSize)&&void 0!==u?u:10,f=null!==(o=null==n?void 0:n.searchText)&&void 0!==o?o:"",(v=Object.entries(r||{})).length>0&&(h=v[0],x=p()(h,2),k=x[0],(w=x[1])&&(g=k,m="ascend"===w?"ascend":"descend")),M=i()(i()({pageNumber:l,pageSize:c,orgUid:null==s?void 0:s.uid,searchText:f,superUser:t},g?{sortBy:g}:{}),m?{sortDirection:m}:{}),e.prev=6,e.next=9,(0,j.LE)(M);case 9:if(b=e.sent,X.Z.debug("WorkgroupTable queryWorkgroupsByOrg",b,M),200!==(null==b?void 0:b.code)){e.next=15;break}return A=(null==b||null===(y=b.data)||void 0===y?void 0:y.content)||[],U=null!==(S=null!==(C=null==b||null===(Z=b.data)||void 0===Z?void 0:Z.totalElements)&&void 0!==C?C:null==b||null===(I=b.data)||void 0===I?void 0:I.numberOfElements)&&void 0!==S?S:A.length,e.abrupt("return",{data:A,total:U,success:!0});case 15:return e.abrupt("return",{data:[],total:0,success:!1});case 18:return e.prev=18,e.t0=e.catch(6),X.Z.error("WorkgroupTable queryWorkgroupsByOrg error",e.t0,M),e.abrupt("return",{data:[],total:0,success:!1});case 22:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,n){return e.apply(this,arguments)}}(),pagination:{showQuickJumper:!0},dateFormatter:"string",headerTitle:n.formatMessage({id:"workgroup",defaultMessage:"Workgroup"})}),c&&(0,z.jsx)(R,{open:c,record:q,onClose:function(){return g(!1)},onSuccess:function(){var e;return null===(e=r.current)||void 0===e?void 0:e.reload()}}),U&&(0,z.jsx)(V,{open:U,onClose:function(){return T(!1)},onSubmit:function(){var e=f()(d()().mark((function e(t){var a,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(n.formatMessage({id:"saving",defaultMessage:"Saving..."})),e.prev=1,e.next=4,(0,j.p0)(t);case 4:a=e.sent,y.yw.destroy(),200===(null==a?void 0:a.code)?(y.yw.success(n.formatMessage({id:"create.success",defaultMessage:"Create success"})),T(!1),null===(s=r.current)||void 0===s||s.reload()):y.yw.error((null==a?void 0:a.message)||n.formatMessage({id:"create.fail",defaultMessage:"Create failed"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),y.yw.destroy(),y.yw.error(n.formatMessage({id:"create.fail",defaultMessage:"Create failed"}));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()}),(0,z.jsx)(N,{open:D,orgUid:null==s?void 0:s.uid,workgroup:G,onClose:function(){W(!1),Y(null)},onSuccess:function(e){var t=e.name;null!=G&&G.uid&&K((function(e){return i()(i()({},e),{},a()({},G.uid,t))})),W(!1),Y(null)}})]})}}}]);