"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{56862:function(e,n,t){t.d(n,{$l:function(){return m},M8:function(){return j},Xd:function(){return b},gf:function(){return k},lg:function(){return f},lz:function(){return x},p0:function(){return d}});var r=t(90819),a=t.n(r),s=t(73193),o=t.n(s),i=t(89933),l=t.n(i),c=t(94976),u=t(4628);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/query/org",{method:"GET",params:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/create",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/avatar",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return y.apply(this,arguments)}function y(){return(y=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/kbUid",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return w.apply(this,arguments)}function w(){return(w=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/update/prompt/text",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return Z.apply(this,arguments)}function Z(){return(Z=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/robot/delete",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},60224:function(e,n,t){t.d(n,{Lr:function(){return x},_t:function(){return d},sE:function(){return m},x_:function(){return f}});var r=t(90819),a=t.n(r),s=t(73193),o=t.n(s),i=t(89933),l=t.n(i),c=t(94976),u=t(4628);function d(e){return p.apply(this,arguments)}function p(){return(p=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/agent/query/org",{method:"GET",params:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/agent/create",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/agent/update",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/agent/delete",{method:"POST",data:o()(o()({},n),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},79658:function(e,n,t){t.d(n,{LE:function(){return u},W5:function(){return h},p0:function(){return p},zl:function(){return g}});var r=t(90819),a=t.n(r),s=t(73193),o=t.n(s),i=t(89933),l=t.n(i),c=t(4628);function u(e){return d.apply(this,arguments)}function d(){return(d=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/query/org",{method:"GET",params:o()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/create",{method:"POST",data:o()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return(m=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/update",{method:"POST",data:o()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return x.apply(this,arguments)}function x(){return(x=l()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/workgroup/delete",{method:"POST",data:o()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},21850:function(e,n,t){var r=t(25553);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},22837:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ns}});var r=t(21850),a=t(81581),s=t(45332),o=t.n(s),i=t(25553),l=t(73193),c=t.n(l),u=t(76711),d=t.n(u),p=t(94976),f=t(26557),h=t(26407),m=t(20744),g=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:o,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),x=t(30310),v=t(1282),b=t(69533),y=t(83281),j=t(28582),w=t(44194),k=t(58620),Z=t(90727),M=t(31549),C=[{name:"web",nickname:"网站/H5",description:"用于网站/H5页面的客服接入"},{name:"npm",nickname:"Npm包",description:"通过Npm包集成到前端项目"}],E=function(){var e=(0,i.Z)().isDarkMode,n=(0,w.useState)([]),t=o()(n,2),r=t[0],a=t[1],s=(0,w.useState)(""),l=o()(s,2),c=l[0],u=l[1],d=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),p=d.currentChannel,f=d.setCurrentChannel;return(0,w.useEffect)((function(){var e=[].concat(C);!(0,k.Ox)()&&(0,k.OJ)()&&e.push({name:"app",nickname:"App应用",description:"App应用内嵌客服"},{name:"wechat",nickname:"微信应用",description:"微信小程序/公众号接入"},{name:"messenger",nickname:"Messenger",description:"Facebook Messenger客服"},{name:"instagram",nickname:"Instagram",description:"Instagram客服"},{name:"whatsapp",nickname:"Whatsapp",description:"Whatsapp客服"},{name:"telegram",nickname:"Telegram",description:"Telegram客服"},{name:"line",nickname:"Line",description:"Line客服"},{name:"email",nickname:"Email",description:"邮件客服"}),a(e)}),[]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{className:"channel-search",children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},size:"middle",children:[(0,M.jsx)(v.Z,{allowClear:!0,placeholder:"搜索渠道...",value:c,onChange:function(e){return u(e.target.value)},onPressEnter:function(){}}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),onClick:function(){}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:r.filter((function(e){if(!c)return!0;var n=c.toLowerCase();return(e.name||"").toLowerCase().includes(n)||(e.nickname||"").toLowerCase().includes(n)||(e.description||"").toLowerCase().includes(n)})),renderItem:function(n,t){return(0,M.jsx)(y.Z.Item,{className:"".concat(e?"list-item-dark":"list-item"," ")+((null==p?void 0:p.name)===n.name?e?"dark-active":"active":""),onClick:function(){f(n)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,M.jsx)(j.Z,{src:"".concat((0,k.kG)(),"/avatars/").concat(n.name,".png")}),title:(0,M.jsx)(M.Fragment,{children:null==n?void 0:n.nickname}),description:(0,M.jsx)("span",{className:"channel-desc",children:null==n?void 0:n.description})})})}})]})},S=t(21600),A=t(4628),P=function(){var e=(0,A.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(A.Access,{accessible:e.canDebug(),fallback:(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(A.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},I=t(90819),T=t.n(I),R=t(89933),L=t.n(R),W=t(10154),B=t.n(W),F=t(43388);function U(e){return z.apply(this,arguments)}function z(){return(z=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return q.apply(this,arguments)}function q(){return(q=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return N.apply(this,arguments)}function N(){return(N=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return V.apply(this,arguments)}function V(){return(V=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return K.apply(this,arguments)}function K(){return(K=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return X.apply(this,arguments)}function X(){return(X=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=t(74171),G=t(15722),Q=t(82669),$=t(80556),ee=t(59304),ne=t(54881),te=t(2484),re=t(27729),ae=t(65051),se=t(28508),oe=t(88722),ie=t(21420),le=t(79658),ce=function(){var e=L()(T()().mark((function e(n,t){var r,a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return F.yw.error("组织UID不能为空"),e.abrupt("return",null);case 3:return null!=t&&t.showLoading&&F.yw.loading(t.loadingMessage||"Loading"),e.prev=4,r={pageNumber:0,pageSize:(null==t?void 0:t.pageSize)||50,sortDirection:p.oys,orgUid:n},e.next=8,(0,le.LE)(r);case 8:if(a=e.sent,null!=t&&t.showLoading&&F.yw.destroy(),200!==a.code){e.next=15;break}return null!=t&&t.successMessage&&F.yw.success(t.successMessage),e.abrupt("return",a);case 15:return F.yw.error((null==t?void 0:t.errorMessage)||a.message),e.abrupt("return",null);case 17:e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),null!=t&&t.showLoading&&F.yw.destroy(),F.yw.error((null==t?void 0:t.errorMessage)||"获取工作组列表失败"),console.error("getWorkgroups error:",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(n,t){return e.apply(this,arguments)}}(),ue=function(){var e=L()(T()().mark((function e(n,t,r,a){var s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=t&&null!==(s=t.data)&&void 0!==s&&s.content&&t.data.content.length>0)){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,ce(n,a);case 4:if(!(o=e.sent)){e.next=8;break}return r(o),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),de=function(e){var n;return(null==e||null===(n=e.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0?e.data.content[0].uid:""},pe=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.autoLoad,r=void 0===t||t,a=n.showLoading,s=void 0===a||a,i=n.loadingMessage,l=void 0===i?"loading":i,c=(0,w.useState)(!1),u=o()(c,2),d=u[0],p=u[1],f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,ie.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),m=h.workgroupResult,g=h.setWorkgroupResult,x=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f&&f.uid){e.next=2;break}return e.abrupt("return",!1);case 2:return p(!0),e.next=5,ue(f.uid,m,g,{showLoading:s,loadingMessage:l});case 5:return n=e.sent,p(!1),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){return de(m)},b=function(){var e;return(null==m||null===(e=m.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return{label:e.nickname,value:e.uid}})))||[]};return(0,w.useEffect)((function(){r&&null!=f&&f.uid&&x()}),[r,null==f?void 0:f.uid]),{workgroupResult:m,workgroups:(null==m||null===(e=m.data)||void 0===e?void 0:e.content)||[],loading:d,loadWorkgroups:x,getDefaultUid:v,getWorkgroupOptions:b}},fe=t(99036),he=t(86702),me=t(59005),ge=t(50628),xe=t(30857),ve="MP",be="MINI",ye="WORK",je="KEFU",we=function(e){var n=e.isEdit,t=e.wechatApp,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=(0,oe.Z)().translateStringTranct,f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=pe(),j=y.workgroups,Z=y.getDefaultUid,C=y.getWorkgroupOptions,E=function(){console.log("handleSubmit"),v(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==f?void 0:f.uid});console.log("submit",n),l(n)})).catch((function(){v(!1)}))};(0,w.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||ye,appId:null==t?void 0:t.appId,agentId:null==t?void 0:t.agentId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.token,encodingAesKey:null==t?void 0:t.encodingAesKey,encryptMode:null==t?void 0:t.encryptMode,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=Z();d.setFieldsValue({name:"",description:"",type:ye,appId:"",agentId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,j]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"微信应用配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:E,loading:g||s,children:g||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"wechatWorkForm",onFinish:E,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,M.jsx)(me.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:ve},{label:"微信小程序",value:be},{label:"企业微信",value:ye},{label:"微信客服",value:je}],fieldProps:{defaultValue:ye},rules:[{required:!0}]}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,M.jsx)(he.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===ye?(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){return(0,e.getFieldValue)("type")===ye?(0,M.jsx)(he.Z,{label:"应用ID(AgentId)",name:"agentId",rules:[{required:!0}],extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/wechat_work#%E5%BA%94%E7%94%A8id-%E6%88%96-agentid",target:"_blank",rel:"noopener noreferrer",children:"查看应用ID(AgentId)获取说明"})}):null}}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,M.jsx)(he.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===ye?(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,M.jsx)(he.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,M.jsx)(me.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:C().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},ke=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:o,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),Ze=B()(B()(B()(B()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Me=function(e){e.type;var n=(0,A.useIntl)(),t=(0,w.useRef)(!1),r=(0,oe.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,s=(0,w.useState)(!1),l=o()(s,2),c=l[0],u=l[1],d=(0,w.useState)(!1),p=o()(d,2),f=p[0],h=p[1],m=(0,w.useState)(!1),g=o()(m,2),j=g[0],k=g[1],C=(0,w.useState)(""),E=o()(C,2),S=E[0],P=E[1],I=(0,Y.u)((function(e){return e.currentOrg})),R=ke((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),W=R.wechatAppResult,B=R.currentWechatApp,z=R.setWechatAppResult,D=R.insertWechatApp,q=R.setCurrentWechatApp,N=R.deleteCurrentWechatApp,V=re.Z.useModal(),K=o()(V,2),J=K[0],X=K[1],ie=function(){var e=L()(T()().mark((function e(t){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete wechatApp",t),F.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,_(t);case 4:r=e.sent,console.log("delete wechatApp response",r),200===r.code?(F.yw.destroy(),F.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),N(t.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=L()(T()().mark((function e(){var r,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,F.yw.loading(n.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,orgUid:null==I?void 0:I.uid,searchText:(null==S||null===(r=S.trim)||void 0===r?void 0:r.call(S))||void 0},e.next=8,U(a);case 8:s=e.sent,console.log("getWechatApps",s),200===s.code?(F.yw.destroy(),z(s)):(F.yw.destroy(),F.yw.error(s.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){h(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]),(0,w.useEffect)((function(){le()}),[S,null==I?void 0:I.uid]);var ce=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!f){e.next=8;break}return e.next=6,de(n);case 6:e.next=10;break;case 8:return e.next=10,ue(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ue=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading("正在创建..."),e.next=3,O(n);case 3:t=e.sent,F.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(D(null==t?void 0:t.data),q(null==t?void 0:t.data),u(!1),F.yw.success("创建成功")):F.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==B?void 0:B.uid,F.yw.loading("正在更新..."),e.next=4,H(n);case 4:t=e.sent,F.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(q(null==t?void 0:t.data),u(!1),F.yw.success("更新成功")):F.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:le,children:n.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),u(!0)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=B,void J.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){ie(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:n.formatMessage({id:"search",defaultMessage:"搜索"}),value:S,onChange:function(e){return P(e.target.value)},onPressEnter:function(e){e.preventDefault(),le()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":n.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return le()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:B.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(M.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(",Ze[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,M.jsx)(we,{isEdit:f,open:c,loading:j,wechatApp:B,onClose:function(){u(!1)},onSubmit:ce}),X]})},Ce=t(82878),Ee=t(68177),Se=t(96955),Ae=t(90581),Pe=t(98280),Ie=t(12461),Te=t(92351),Re=t(10390),Le=t(83337),We=t(34600),Be=t(15892),Fe=t(54800),Ue=t(32693),ze=t(5716),De=t(90297),qe=t(34545),Oe=t(96596),Ne=t.n(Oe),He=Ce.Z.Text,Ve=Ce.Z.Paragraph,_e=B()(B()(B()(B()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Ke=B()(B()(B()(B()({},p.a4q,(0,M.jsx)(Le.Z,{})),p.qRy,(0,M.jsx)(We.Z,{})),p._oo,(0,M.jsx)(Be.Z,{})),p.rWo,(0,M.jsx)(Fe.Z,{})),Je={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Xe={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ye=function(){var e=(0,A.useIntl)(),n=ke((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),t=n.currentWechatApp,r=n.refreshCurrentWechatApp,a=(0,w.useState)(!1),s=o()(a,2),i=s[0],l=s[1],c=(0,w.useState)(!1),u=o()(c,2),d=u[0],f=u[1],h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=(0,w.useState)(!1),j=o()(y,2),Z=j[0],C=j[1],E=(0,w.useState)(!1),S=o()(E,2),P=(S[0],S[1],(0,w.useState)(!1)),I=o()(P,2),R=I[0],W=I[1],B=(0,w.useState)(!1),U=o()(B,2),z=U[0],q=U[1],O=(0,w.useState)(!1),N=o()(O,2),V=N[0],_=N[1],K=(0,w.useState)(!1),X=o()(K,2),Y=X[0],G=X[1],Q=function(e,n){return e?n?e:"******":"-"},ne=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,J({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(F.yw.success("AccessToken 刷新成功"),r&&r(null==n?void 0:n.data),te()):F.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=L()(T()().mark((function e(){var n,a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return q(!0),e.prev=4,e.next=7,D({uid:t.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(a=null==n?void 0:n.data,F.yw.success("应用详情刷新成功"),r&&r(a)):F.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,q(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=L()(T()().mark((function e(n){var a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return _(!0),e.prev=4,e.next=7,H({uid:t.uid,enabled:n});case 7:a=e.sent,console.log("updateWechatApp enabled response",a),200===a.code?(F.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(null==a?void 0:a.data)):F.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,_(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=L()(T()().mark((function e(n){var a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return G(!0),e.prev=4,e.next=7,H({uid:t.uid,debug:n});case 7:a=e.sent,console.log("updateWechatApp debug response",a),200===a.code?(F.yw.success("调试模式已".concat(n?"开启":"关闭")),r&&r(null==a?void 0:a.data)):F.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,G(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[Ke[t.type]||(0,M.jsx)(Le.Z,{}),(0,M.jsx)("span",{children:t.name||"微信应用详情"}),(0,M.jsx)(Ae.Z,{color:"blue",children:_e[t.type]||t.type})]}),extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:te,loading:z,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(He,{copyable:!0,children:t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,M.jsx)(Ae.Z,{color:"blue",children:_e[t.type]||t.type})}),(0,M.jsx)(Pe.Z.Item,{label:"启用状态",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==t.enabled,onChange:re,loading:V,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(He,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:t.debug||!1,onChange:ae,loading:Y,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(He,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"AppID/企业ID",children:(0,M.jsx)(He,{copyable:!0,children:t.appId})}),t.type===p._oo&&t.agentId&&(0,M.jsx)(Pe.Z.Item,{label:"应用ID(AgentId)",children:(0,M.jsx)(He,{copyable:!0,children:t.agentId})}),(0,M.jsx)(Pe.Z.Item,{label:"AppSecret",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(He,{copyable:!!d&&{text:t.appSecret||""},children:Q(t.appSecret,d)}),(0,M.jsx)(Te.Z,{title:d?"隐藏AppSecret":"显示AppSecret",children:(0,M.jsx)(b.ZP,{type:"text",icon:d?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return f(!d)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"加密模式",children:(0,M.jsx)(Ae.Z,{color:Xe[t.encryptMode]||"default",children:Je[t.encryptMode]||t.encryptMode})}),(0,M.jsx)(Pe.Z.Item,{label:"URL",children:(0,M.jsx)(He,{copyable:!0,children:(0,k.kG)()+"/wechat/"+((null==t?void 0:t.type)||"").toLowerCase()+"/webhooks/"+t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:"Token",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(He,{copyable:!!g&&{text:t.token||""},children:Q(t.token,g)}),(0,M.jsx)(Te.Z,{title:g?"隐藏Token":"显示Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:g?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return v(!g)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"EncodingAESKey",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(He,{copyable:!!Z&&{text:t.encodingAesKey||""},children:Q(t.encodingAesKey,Z)}),(0,M.jsx)(Te.Z,{title:Z?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,M.jsx)(b.ZP,{type:"text",icon:Z?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return C(!Z)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"AccessToken",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(He,{copyable:!!i&&{text:t.accessToken||""},children:Q(t.accessToken,i)}),(0,M.jsx)(Te.Z,{title:i?"隐藏Token":"显示Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:i?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return l(!i)},size:"small"})}),(0,M.jsx)(Te.Z,{title:"刷新AccessToken",children:(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(qe.Z,{}),onClick:ne,size:"small",loading:R,children:"刷新Token"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Ne()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(Ve,{children:t.description})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(Ve,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,M.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,M.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",title:"微信应用详情",extra:(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),children:(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个微信应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},Ge=function(e){console.log(e)},Qe=[{key:"detail",label:"应用详情",children:(0,M.jsx)(Ye,{})}],$e=function(e){e.type;var n=(0,r.Z)().contentStyle,t=(0,w.useState)(Qe),a=o()(t,2),s=a[0],i=a[1];return(0,w.useEffect)((function(){var e=[].concat(Qe);i(e)}),[]),(0,M.jsx)("div",{style:n,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:s,onChange:Ge})})},en=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=(t.leftSiderWidth,t.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(Me,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)($e,{type:n})})]})};function nn(e){return tn.apply(this,arguments)}function tn(){return(tn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rn(e){return an.apply(this,arguments)}function an(){return(an=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e){return on.apply(this,arguments)}function on(){return(on=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ln(e){return cn.apply(this,arguments)}function cn(){return(cn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var un=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().appResult),{},{data:{content:s}});e({appResult:o,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),dn=t(60241),pn=function(e){var n=e.open,t=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,i=(0,A.useIntl)(),l=fe.A.useForm(),u=o()(l,1)[0],d=(0,Y.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,w.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,M.jsx)(xe.Z,{title:t?i.formatMessage({id:"edit",defaultMessage:"编辑应用"}):i.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:n,onClose:a,maskClosable:!0,extra:(0,M.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,M.jsx)(b.ZP,{onClick:a,children:i.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,M.jsx)(b.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});s(n)}))},type:"primary",children:i.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,M.jsxs)(fe.A,{form:u,layout:"vertical",submitter:!1,children:[(0,M.jsx)(he.Z,{name:"name",label:i.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:i.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:i.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,M.jsx)(me.Z,{name:"appPlatform",label:i.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:i.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:i.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,M.jsx)(he.Z,{name:"appPackage",label:i.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:i.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:i.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,M.jsx)(he.Z,{name:"appKey",label:"App Key",placeholder:i.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,M.jsx)(b.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,M.jsx)(he.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:i.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,M.jsx)(dn.Z,{name:"description",label:i.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:i.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},fn=function(e){e.type;var n=(0,A.useIntl)(),t=(0,w.useRef)(!1),r=(0,oe.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,s=(0,w.useState)(!1),l=o()(s,2),c=l[0],u=l[1],d=(0,w.useState)(!1),p=o()(d,2),f=p[0],h=p[1],m=(0,w.useState)(""),g=o()(m,2),j=g[0],k=g[1],C=(0,Y.u)((function(e){return e.currentOrg})),E=un((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),S=E.appResult,P=E.currentApp,I=E.setAppResult,R=E.insertApp,W=E.setCurrentApp,B=E.deleteCurrentApp,U=re.Z.useModal(),z=o()(U,2),D=z[0],q=z[1],O=function(){var e=L()(T()().mark((function e(t){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete app",t),F.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除"})),e.next=4,ln(t);case 4:r=e.sent,console.log("delete app response",r),200===r.code?(F.yw.destroy(),F.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),B(t.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=L()(T()().mark((function e(){var r,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,F.yw.loading(n.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,orgUid:null==C?void 0:C.uid,searchText:(null==j||null===(r=j.trim)||void 0===r?void 0:r.call(j))||void 0},e.next=8,nn(a);case 8:s=e.sent,console.log("getApps",s),200===s.code?(F.yw.destroy(),I(s)):(F.yw.destroy(),F.yw.error(s.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){N()}),[j,null==C?void 0:C.uid]);var H=function(){var e=L()(T()().mark((function e(t){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rn(t);case 2:r=e.sent,console.log("handleCreateApp response:",r),200===r.code?(R(null==r?void 0:r.data),u(!1),F.yw.success(n.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):F.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=L()(T()().mark((function e(t){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==P?void 0:P.uid,e.next=3,sn(t);case 3:r=e.sent,console.log("handleUpdateApp response:",r),200===r.code?(W(null==r?void 0:r.data),u(!1),F.yw.success(n.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):F.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,M.jsx)(b.ZP,{size:"small",type:"primary",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"create",defaultMessage:"新建"})}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){h(!0),u(!0)},disabled:""===(null==P?void 0:P.uid),children:n.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,M.jsx)(b.ZP,{size:"small",danger:!0,onClick:function(){return function(e){D.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(e.name,"】？"),onOk:function(){O(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(P)},disabled:""===(null==P?void 0:P.uid),children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:n.formatMessage({id:"search",defaultMessage:"搜索"}),value:j,onChange:function(e){return k(e.target.value)},onPressEnter:function(e){e.preventDefault(),N()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":n.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return N()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:S.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:P.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){W(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(M.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(",r(null==e?void 0:e.appPlatform),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,M.jsx)(pn,{isEdit:f,open:c,app:P,onClose:function(){u(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),f?V(e):H(e)}}),q]})},hn=t(2523),mn=t(48006),gn=t(40795),xn=Ce.Z.Text,vn=Ce.Z.Paragraph,bn={android:(0,M.jsx)(hn.Z,{}),ios:(0,M.jsx)(mn.Z,{}),flutter:(0,M.jsx)(gn.Z,{}),uniapp:(0,M.jsx)(We.Z,{})},yn={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},jn=function(){var e=(0,A.useIntl)(),n=un().currentApp;return null!=n&&n.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[bn[n.appPlatform]||(0,M.jsx)(gn.Z,{}),(0,M.jsx)("span",{children:n.name||e.formatMessage({id:"channel.app.details.title.fallback"})}),(0,M.jsx)(Ae.Z,{color:"blue",children:yn[n.appPlatform]||n.appPlatform})]}),variant:"borderless",children:[(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(xn,{copyable:!0,children:n.uid})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,M.jsx)(Pe.Z.Item,{label:"App Key",children:(0,M.jsx)(xn,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,M.jsx)(Pe.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(vn,{children:n.description})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:e.formatMessage({id:"channel.app.details.security.title"})}),(0,M.jsx)(vn,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:e.formatMessage({id:"channel.app.details.security.li1"})}),(0,M.jsx)("li",{children:e.formatMessage({id:"channel.app.details.security.li2"})}),(0,M.jsx)("li",{children:e.formatMessage({id:"channel.app.details.security.li3"})})]})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",children:(0,M.jsx)(Se.Z,{description:e.formatMessage({id:"channel.app.integration.empty"}),image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},wn=t(69079),kn=t(71529),Zn=t(82404),Mn=Ce.Z.Title,Cn=Ce.Z.Paragraph,En=Ce.Z.Text,Sn=(Ce.Z.Link,S.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),An=function(){var e=(0,A.useIntl)(),n=un().currentApp,t=(0,Y.u)((function(e){return e.currentOrg}));if(null==n||!n.uid)return(0,M.jsx)(Ee.Z,{variant:"borderless",children:(0,M.jsx)(Se.Z,{description:e.formatMessage({id:"channel.app.integration.empty"}),image:Se.Z.PRESENTED_IMAGE_SIMPLE})});return(0,M.jsxs)(Ee.Z,{title:e.formatMessage({id:"channel.app.integration.title"}),variant:"borderless",extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(wn.Z,{}),onClick:function(){var t=n.appPlatform,r=Sn[t];r?window.open(r,"_blank"):Zn.ZP.info(e.formatMessage({id:"channel.app.integration.repo.missing"}))},children:e.formatMessage({id:"channel.app.integration.button.source"})}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(kn.Z,{}),onClick:function(){window.open((0,k.L5)()+"/docs/zh-CN/docs/category/channel","_blank")},children:e.formatMessage({id:"channel.app.integration.button.docs"})})]}),children:[(0,M.jsx)(Mn,{level:4,children:e.formatMessage({id:"channel.app.integration.heading"},{name:n.name,platform:n.appPlatform})}),(0,M.jsx)(Cn,{children:e.formatMessage({id:"channel.app.integration.desc"},{name:n.name})}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Mn,{level:5,children:e.formatMessage({id:"channel.app.integration.section.basic"})}),(0,M.jsx)(Cn,{children:(0,M.jsxs)("ul",{children:[n.appKey&&(0,M.jsxs)("li",{children:[(0,M.jsx)(En,{strong:!0,children:"App Key:"})," ",(0,M.jsx)(En,{copyable:!0,children:n.appKey})]}),(0,M.jsxs)("li",{children:[(0,M.jsx)(En,{strong:!0,children:e.formatMessage({id:"channel.app.integration.orgId"})})," ",(0,M.jsx)(En,{copyable:!0,children:null==t?void 0:t.uid})]})]})}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Cn,{type:"secondary",children:e.formatMessage({id:"channel.app.integration.support"},{email:"270580156@qq.com"})})]})},Pn=function(e){console.log(e)},In=[{key:"details",label:"应用详情",children:(0,M.jsx)(jn,{})},{key:"integration",label:"集成指南",children:(0,M.jsx)(An,{})}],Tn=function(e){e.type;var n=(0,w.useState)([]),t=o()(n,2),a=t[0],s=t[1],i=(0,r.Z)().contentStyle;un((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,w.useEffect)((function(){var e=[].concat(In);s(e)}),[]),(0,M.jsx)("div",{style:i,children:(0,M.jsx)(S.Z,{defaultActiveKey:"details",items:a,onChange:Pn})})},Rn=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle;t.leftSiderWidth;return(0,M.jsxs)(a.Z,{children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(fn,{type:n})}),(0,M.jsx)(a.Z.Panel,{children:(0,M.jsx)(Tn,{type:n})})]})};function Ln(e){return Wn.apply(this,arguments)}function Wn(){return(Wn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bn(e){return Fn.apply(this,arguments)}function Fn(){return(Fn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Un(e){return zn.apply(this,arguments)}function zn(){return zn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),zn.apply(this,arguments)}function Dn(e){return qn.apply(this,arguments)}function qn(){return(qn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return Nn.apply(this,arguments)}function Nn(){return Nn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Nn.apply(this,arguments)}function Hn(e){return Vn.apply(this,arguments)}function Vn(){return(Vn=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/email/sync/start",{method:"POST",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _n,Kn=t(36099),Jn=t(93689),Xn=t(93953),Yn=t(48058),Gn=t(58422),Qn="IMAP",$n="POP3",et="SMTP",nt="EXCHANGE",tt="ONLINE_SERVICE",rt="TICKET_SERVICE",at=function(e){return"SERVICE"===e?tt:rt},st="QQ",ot="TENCENT_ENTERPRISE",it="SINA",lt="GMAIL",ct="NETEASE_163",ut="NETEASE_ENTERPRISE",dt="ALIYUN_ENTERPRISE",pt="HOTMAIL",ft="FEISHU_ENTERPRISE",ht="YAHOO",mt="OTHER",gt=(_n={},B()(B()(B()(B()(B()(B()(B()(B()(B()(B()(_n,st,{smtpHost:"smtp.qq.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qq.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qq.com",pop3Port:995,pop3SslEnabled:!0}),ot,{smtpHost:"smtp.exmail.qq.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.exmail.qq.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.exmail.qq.com",pop3Port:995,pop3SslEnabled:!0}),it,{smtpHost:"smtp.sina.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.sina.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.sina.com",pop3Port:995,pop3SslEnabled:!0}),lt,{smtpHost:"smtp.gmail.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"imap.gmail.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.gmail.com",pop3Port:995,pop3SslEnabled:!0}),ct,{smtpHost:"smtp.163.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.163.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.163.com",pop3Port:995,pop3SslEnabled:!0}),ut,{smtpHost:"smtp.qiye.163.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.163.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.163.com",pop3Port:995,pop3SslEnabled:!0}),dt,{smtpHost:"smtp.qiye.aliyun.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.aliyun.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.aliyun.com",pop3Port:995,pop3SslEnabled:!0}),pt,{smtpHost:"smtp-mail.outlook.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"outlook.office365.com",imapPort:993,imapSslEnabled:!0,pop3Host:"outlook.office365.com",pop3Port:995,pop3SslEnabled:!0}),ft,{smtpHost:"smtp.feishu.cn",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.feishu.cn",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.feishu.cn",pop3Port:995,pop3SslEnabled:!0}),ht,{smtpHost:"smtp.mail.yahoo.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"imap.mail.yahoo.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.mail.yahoo.com",pop3Port:995,pop3SslEnabled:!0}),B()(_n,mt,{smtpHost:"",smtpPort:587,smtpSslEnabled:!0,smtpTlsEnabled:!0,imapHost:"",imapPort:993,imapSslEnabled:!0,pop3Host:"",pop3Port:995,pop3SslEnabled:!0})),xt=function(e){var n=e.type,t=e.isEdit,r=e.email,a=e.open,s=e.loading,i=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=fe.A.useForm(),p=o()(d,1)[0],f=(0,oe.Z)().translateStringTranct,h=(0,Y.u)((function(e){return e.currentOrg})),m=(0,w.useState)(!1),g=o()(m,2),v=g[0],y=g[1],j=(0,w.useState)(Qn),Z=o()(j,2),C=Z[0],E=Z[1],S=(0,w.useState)(!1),A=o()(S,2),P=A[0],I=A[1],T=pe(),R=T.workgroups,L=T.getDefaultUid,W=T.getWorkgroupOptions,B=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,w.useEffect)((function(){if(t){var e=(null==r?void 0:r.protocol)||Qn;E(e),p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,provider:(null==r?void 0:r.provider)||dt,usageType:(null==r?void 0:r.type)||at(n),protocol:e,enabled:!1!==(null==r?void 0:r.enabled),workgroupUid:null==r?void 0:r.workgroupUid,emailAddress:null==r?void 0:r.emailAddress,emailPassword:null==r?void 0:r.emailPassword,smtpHost:null==r?void 0:r.smtpHost,smtpPort:(null==r?void 0:r.smtpPort)||587,smtpSslEnabled:!1!==(null==r?void 0:r.smtpSslEnabled),smtpTlsEnabled:!1!==(null==r?void 0:r.smtpTlsEnabled),imapHost:null==r?void 0:r.imapHost,imapPort:(null==r?void 0:r.imapPort)||993,imapSslEnabled:!1!==(null==r?void 0:r.imapSslEnabled),pop3Host:null==r?void 0:r.pop3Host,pop3Port:(null==r?void 0:r.pop3Port)||995,pop3SslEnabled:!1!==(null==r?void 0:r.pop3SslEnabled),exchangeHost:null==r?void 0:r.exchangeHost,exchangePort:(null==r?void 0:r.exchangePort)||443,exchangeSslEnabled:!1!==(null==r?void 0:r.exchangeSslEnabled),senderName:null==r?void 0:r.senderName,syncInterval:(null==r?void 0:r.syncInterval)||5,autoSyncEnabled:!1!==(null==r?void 0:r.autoSyncEnabled),autoReplyEnabled:(null==r?void 0:r.autoReplyEnabled)||!1,autoReplyContent:null==r?void 0:r.autoReplyContent,debug:(null==r?void 0:r.debug)||!1})}else{var a=L();E(Qn),p.setFieldsValue({name:"",description:"",provider:dt,usageType:at(n),protocol:Qn,enabled:!0,workgroupUid:a,emailAddress:"",emailPassword:"",smtpHost:"smtp.qiye.aliyun.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.aliyun.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.aliyun.com",pop3Port:995,pop3SslEnabled:!0,exchangeHost:"",exchangePort:443,exchangeSslEnabled:!0,senderName:"",syncInterval:5,autoSyncEnabled:!0,autoReplyEnabled:!1,autoReplyContent:"",debug:!1})}}),[t,r,n,p,R]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"邮件应用配置",onClose:l,open:a,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:l,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:B,loading:v||i,children:v||i?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:p,name:"emailForm",onFinish:B,submitter:!1,children:[(0,M.jsxs)(Ee.Z,{title:"基本信息",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:"应用名称",name:"name",rules:[{required:!0,message:"请输入应用名称"}],placeholder:"请输入邮件应用名称"}),(0,M.jsx)(he.Z,{label:"应用描述",name:"description",placeholder:"请输入应用描述，如：客服邮箱"}),(0,M.jsx)(me.Z,{label:"邮箱服务提供商",name:"provider",options:[{label:"阿里云企业邮箱",value:dt},{label:"QQ邮箱",value:st},{label:"腾讯企业邮箱",value:ot},{label:"新浪邮箱",value:it},{label:"Gmail",value:lt},{label:"网易163邮箱",value:ct},{label:"网易企业邮箱",value:ut},{label:"Hotmail/Outlook",value:pt},{label:"飞书企业邮箱",value:ft},{label:"Yahoo邮箱",value:ht},{label:"其他邮箱",value:mt}],rules:[{required:!0,message:"请选择邮箱类型"}],extra:"选择您使用的邮箱服务商类型，系统将自动填充相应的服务器配置",fieldProps:{onChange:function(e){var n=gt[e];n&&p.setFieldsValue({smtpHost:n.smtpHost,smtpPort:n.smtpPort,smtpSslEnabled:n.smtpSslEnabled,smtpTlsEnabled:n.smtpTlsEnabled,imapHost:n.imapHost,imapPort:n.imapPort,imapSslEnabled:n.imapSslEnabled,pop3Host:n.pop3Host,pop3Port:n.pop3Port,pop3SslEnabled:n.pop3SslEnabled})}}}),(0,M.jsx)(me.Z,{label:"邮箱协议",name:"protocol",options:[{label:"IMAP协议(推荐)",value:Qn},{label:"POP3协议",value:$n},{label:"SMTP协议",value:et},{label:"Exchange协议",value:nt}],rules:[{required:!0,message:"请选择邮箱协议"}],extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/email#邮件协议说明",target:"_blank",rel:"noopener noreferrer",children:"邮件协议说明"}),fieldProps:{onChange:function(e){E(e)}}})]}),(0,M.jsxs)(Ee.Z,{title:"邮箱账户",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["邮箱地址",(0,M.jsx)(Te.Z,{title:"用于接收和发送邮件的邮箱地址",children:(0,M.jsx)(Ue.Z,{style:{marginLeft:4}})})]}),name:"emailAddress",rules:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"请输入有效的邮箱地址"}],placeholder:"example@company.com"}),(0,M.jsx)(he.Z.Password,{label:(0,M.jsxs)("span",{children:["邮箱密码/授权码",(0,M.jsx)(Te.Z,{title:"邮箱密码或第三方应用授权码，建议使用授权码以提高安全性",children:(0,M.jsx)(Ue.Z,{style:{marginLeft:4}})})]}),name:"emailPassword",rules:[{required:!0,message:"请输入邮箱密码或授权码"}],placeholder:"请输入邮箱密码或授权码",extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/email#%E7%94%9F%E6%88%90%E4%B8%93%E6%9C%89%E5%AF%86%E7%A0%81%E9%9D%9E%E9%82%AE%E7%AE%B1%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81",target:"_blank",rel:"noopener noreferrer",children:"查看如何获取邮箱密码/授权码说明"})}),(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["发件人显示名称",(0,M.jsx)(Te.Z,{title:"邮件发送时显示的发件人名称",children:(0,M.jsx)(Ue.Z,{style:{marginLeft:4}})})]}),name:"senderName",placeholder:"客服中心",extra:"留空则使用邮箱地址作为发件人名称"})]}),(0,M.jsxs)(Ee.Z,{title:"SMTP服务器配置（发件）",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["SMTP服务器地址",(0,M.jsx)(Te.Z,{title:"查看SMTP服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#smtp服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"smtpHost",rules:[{required:!0,message:"请输入SMTP服务器地址"}],placeholder:"smtp.gmail.com",extra:"用于发送邮件的SMTP服务器地址"}),(0,M.jsx)(Yn.Z,{label:"SMTP端口",name:"smtpPort",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：25(不加密), 587(TLS), 465(SSL)"}),(0,M.jsx)(ge.Z,{label:"启用SSL",name:"smtpSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密连接（端口通常为465）"}),(0,M.jsx)(ge.Z,{label:"启用TLS",name:"smtpTlsEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用TLS加密连接（端口通常为587）"})]}),(0,M.jsxs)(Ee.Z,{title:"IMAP服务器配置（收件）",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["IMAP服务器地址",(0,M.jsx)(Te.Z,{title:"查看IMAP服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#imap服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"imapHost",rules:C===Qn?[{required:!0,message:"请输入IMAP服务器地址"}]:[],placeholder:"imap.gmail.com",extra:"用于接收邮件的IMAP服务器地址"}),(0,M.jsx)(Yn.Z,{label:"IMAP端口",name:"imapPort",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：143(不加密), 993(SSL)"}),(0,M.jsx)(ge.Z,{label:"IMAP启用SSL",name:"imapSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密IMAP连接"})]}),(0,M.jsxs)(Ee.Z,{title:"POP3服务器配置（收件）",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["POP3服务器地址",(0,M.jsx)(Te.Z,{title:"查看POP3服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#pop3服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"pop3Host",rules:[{required:!0,message:"请输入POP3服务器地址"}],placeholder:"pop.gmail.com",extra:"POP3服务器地址，用于接收邮件"}),(0,M.jsx)(Yn.Z,{label:"POP3端口",name:"pop3Port",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：110(不加密), 995(SSL)"}),(0,M.jsx)(ge.Z,{label:"POP3启用SSL",name:"pop3SslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密POP3连接"})]}),(0,M.jsxs)(Ee.Z,{title:"基本设置",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:W().map((function(e){return{label:f(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0,message:"请选择客服工作组"}],extra:"邮件消息将分配给选中的工作组处理"}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理邮件"})]}),(0,M.jsx)("div",{style:{textAlign:"center",margin:"16px 0"},children:(0,M.jsx)(b.ZP,{type:"dashed",onClick:function(){return I(!P)},icon:P?(0,M.jsx)("span",{children:"▼"}):(0,M.jsx)("span",{children:"▶"}),children:P?"收起高级设置":"展开高级设置"})}),P&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(Ee.Z,{title:"Exchange服务器配置（可选）",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(he.Z,{label:(0,M.jsxs)("span",{children:["Exchange服务器地址",(0,M.jsx)(Te.Z,{title:"查看Exchange服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#exchange服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"exchangeHost",rules:[{message:"请输入Exchange服务器地址"}],placeholder:"mail.company.com",extra:"Exchange服务器地址或Office 365服务器"}),(0,M.jsx)(Yn.Z,{label:"Exchange端口",name:"exchangePort",min:1,max:65535,fieldProps:{precision:0},extra:"Exchange常用端口：443(HTTPS), 993(IMAP over SSL)"}),(0,M.jsx)(ge.Z,{label:"启用SSL/TLS",name:"exchangeSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"Exchange服务器通常要求SSL/TLS加密"})]}),(0,M.jsxs)(Ee.Z,{title:"邮件同步设置",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(ge.Z,{label:"自动同步邮件",name:"autoSyncEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"是否自动定期同步邮件".concat(C===$n?"（POP3协议会删除服务器邮件）":"")}),(0,M.jsx)(Yn.Z,{label:"同步间隔（分钟）",name:"syncInterval",min:1,max:1440,fieldProps:{precision:0},extra:"邮件同步的时间间隔，建议".concat(C===$n?"10-60":"5-30","分钟")}),C===$n&&(0,M.jsxs)("div",{style:{background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"6px",padding:"12px",margin:"12px 0"},children:[(0,M.jsx)("strong",{children:"注意："})," POP3协议会将邮件从服务器下载到本地，并可能删除服务器上的邮件副本。请谨慎配置同步间隔。"]})]}),(0,M.jsxs)(Ee.Z,{title:"自动回复设置",size:"small",style:{marginBottom:16},children:[(0,M.jsx)(ge.Z,{label:"启用自动回复",name:"autoReplyEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"收到邮件时是否自动发送回复"}),(0,M.jsx)(dn.Z,{label:"自动回复内容",name:"autoReplyContent",fieldProps:{rows:4,maxLength:1e3,showCount:!0},placeholder:"感谢您的邮件，我们已收到并将尽快回复您。",extra:"启用自动回复时发送的内容，最多1000字符"})]}),(0,M.jsx)(Ee.Z,{title:"调试设置",size:"small",style:{marginBottom:16},children:(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"})})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsxs)("div",{style:{color:"#666",fontSize:"12px"},children:[(0,M.jsx)("p",{children:(0,M.jsx)("strong",{children:"协议说明："})}),C===Qn&&(0,M.jsxs)("div",{children:["• IMAP协议支持多设备同步，邮件保留在服务器上",(0,M.jsx)("br",{}),"• 需要配置SMTP用于发送邮件，IMAP用于接收邮件",(0,M.jsx)("br",{}),"• 推荐端口：IMAP 993(SSL), SMTP 587(TLS)或465(SSL)"]}),C===$n&&(0,M.jsxs)("div",{children:["• POP3协议会将邮件下载到本地，可能从服务器删除",(0,M.jsx)("br",{}),"• 需要配置SMTP用于发送邮件，POP3用于接收邮件",(0,M.jsx)("br",{}),"• 推荐端口：POP3 995(SSL), SMTP 587(TLS)或465(SSL)",(0,M.jsx)("br",{}),"• ",(0,M.jsx)("span",{style:{color:"#fa8c16"},children:"注意：POP3不支持多设备同步"})]}),C===et&&(0,M.jsxs)("div",{children:["• SMTP协议仅用于发送邮件，无法接收邮件",(0,M.jsx)("br",{}),"• 推荐端口：587(TLS)或465(SSL)",(0,M.jsx)("br",{}),"• 适用于只需要发送邮件通知的场景"]}),C===nt&&(0,M.jsxs)("div",{children:["• Exchange协议适用于Microsoft Exchange服务器和Office 365",(0,M.jsx)("br",{}),"• 支持邮件、日历、联系人等功能",(0,M.jsx)("br",{}),"• 通常使用443端口(HTTPS)或993端口(IMAP over SSL)",(0,M.jsx)("br",{}),"• 需要企业管理员配置相关权限"]}),(0,M.jsxs)("p",{style:{marginTop:"12px"},children:[(0,M.jsx)("strong",{children:"通用提示："}),(0,M.jsx)("br",{}),"• 请确保邮箱服务商已开启相应协议服务",(0,M.jsx)("br",{}),"• Gmail等邮箱建议使用应用专用密码而非账户密码",(0,M.jsx)("br",{}),"• 建议启用SSL/TLS加密以提高安全性"]})]})]})})})},vt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{emailResult:{data:{content:[]}},currentEmail:{uid:"",nickname:"",avatar:"",description:""},insertEmail:function(n){e((function(e){e.emailResult.data.content.unshift(n)}))},updateEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Email with uid ".concat(n.uid," not found."))}))},deleteEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Email with uid ".concat(n.uid," not found."))}))},setEmailResult:function(t){var r;(e({emailResult:t}),""===n().currentEmail.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentEmail:t.data.content[0]}))},setCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().emailResult),{},{data:{content:s}});e({emailResult:o,currentEmail:t})}else console.warn("Email with the specified uid not found."),e({currentEmail:t})},refreshCurrentEmail:function(n){e((function(e){e.currentEmail=c()(c()({},e.currentEmail),n);var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({emailResult:c()(c()({},n().emailResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Email not found in cache:",t),n().currentEmail.uid===t&&e({currentEmail:{uid:""}})},deleteEmailCache:function(){return e({},!0)}}})),{name:p.e73}))),bt=function(e){var n=e.type,t=void 0===n?"SERVICE":n,r=(0,A.useIntl)(),a=(0,w.useRef)(!1),s=(0,oe.Z)().translateStringTranct,l=(0,i.Z)().isDarkMode,u=(0,w.useState)(!1),d=o()(u,2),p=d[0],f=d[1],h=(0,w.useState)(!1),m=o()(h,2),g=m[0],j=m[1],k=(0,w.useState)(!1),C=o()(k,2),E=C[0],S=C[1],P=(0,w.useState)(""),I=o()(P,2),R=I[0],W=I[1],B=(0,Y.u)((function(e){return e.currentOrg})),U=(0,w.useState)(null),z=o()(U,2),D=z[0],q=z[1],O=vt((function(e){return{emailResult:e.emailResult,currentEmail:e.currentEmail,setEmailResult:e.setEmailResult,insertEmail:e.insertEmail,setCurrentEmail:e.setCurrentEmail,deleteCurrentEmail:e.deleteCurrentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),N=O.emailResult,H=O.currentEmail,V=O.setEmailResult,_=O.insertEmail,K=O.setCurrentEmail,J=O.deleteCurrentEmail,X=O.refreshCurrentEmail,ie=re.Z.useModal(),le=o()(ie,2),ce=le[0],ue=le[1],de=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete email",n),F.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,On(n);case 4:t=e.sent,console.log("delete email response",t),200===t.code?(F.yw.destroy(),F.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),J(n.uid)):(F.yw.destroy(),F.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),pe=function(){var e=L()(T()().mark((function e(){var n,t,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.current){e.next=3;break}return console.log("isLoading: 1",a.current),e.abrupt("return");case 3:return a.current=!0,F.yw.loading(r.formatMessage({id:"loading"})),t={pageNumber:0,pageSize:50,orgUid:null==B?void 0:B.uid,searchText:(null==R||null===(n=R.trim)||void 0===n?void 0:n.call(R))||void 0},e.next=8,Ln(t);case 8:s=e.sent,console.log("getEmails response:",s,t),200===s.code?(F.yw.destroy(),V(s)):(F.yw.destroy(),F.yw.error(s.message)),a.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){j(!0),f(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]),(0,w.useEffect)((function(){pe()}),[R,null==B?void 0:B.uid]);var fe=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),S(!0),e.prev=2,!g){e.next=8;break}return e.next=6,me(n);case 6:e.next=10;break;case 8:return e.next=10,he(n);case 10:return e.prev=10,S(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),he=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading(r.formatMessage({id:"creating"})),e.next=3,Un(n);case 3:t=e.sent,F.yw.destroy(),console.log("handleCreateEmail response:",t),200===t.code?(_(null==t?void 0:t.data),K(null==t?void 0:t.data),f(!1),F.yw.success(r.formatMessage({id:"common.created"}))):F.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==H?void 0:H.uid,F.yw.loading(r.formatMessage({id:"updating"})),e.next=4,Dn(n);case 4:t=e.sent,F.yw.destroy(),console.log("handleUpdateEmail response:",t),200===t.code?(K(null==t?void 0:t.data),f(!1),F.yw.success(r.formatMessage({id:"common.updated"}))):F.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ge=function(){var e=L()(T()().mark((function e(n,t){var a,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(n.uid),e.prev=1,e.next=4,Dn({uid:n.uid,enabled:t});case 4:a=e.sent,console.log("updateEmail enabled response",a),200===a.code?(F.yw.success(r.formatMessage({id:t?"email.app.toggle.success.enabled":"email.app.toggle.success.disabled"})),null!=N&&null!==(s=N.data)&&void 0!==s&&s.content&&(o=N.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),V(c()(c()({},N),{},{data:c()(c()({},N.data),{},{content:o})}))),(null==H?void 0:H.uid)===n.uid&&X&&X(null==a?void 0:a.data)):F.yw.error(a.message||r.formatMessage({id:"email.app.toggle.error.operation"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),F.yw.error(e.t0 instanceof Error?e.t0.message:r.formatMessage({id:"email.app.toggle.error.exception"}));case 12:return e.prev=12,q(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){f(!0),j(!1)},children:r.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:pe,children:r.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==H?void 0:H.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:r.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){j(!0),f(!0)}},{key:"toggle_enabled",icon:!1!==H.enabled?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(Jn.Z,{}),label:!1!==H.enabled?r.formatMessage({id:"app.disable",defaultMessage:"禁用"}):r.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return ge(H,!1===H.enabled)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:r.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){ce.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){de(e)},onCancel:function(){},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}(H)}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:r.formatMessage({id:"search",defaultMessage:"搜索"}),value:R,onChange:function(e){return W(e.target.value)},onPressEnter:function(e){e.preventDefault(),pe()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":r.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return pe()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:N.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:H.uid===(null==e?void 0:e.uid)?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){K(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"nowrap"},children:[(0,M.jsx)("span",{style:{fontWeight:"bold",minWidth:"fit-content"},children:s(null==e?void 0:e.name)}),(0,M.jsx)(Xn.Z,{spinning:D===(null==e?void 0:e.uid),size:"small",children:(0,M.jsx)(Ae.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),style:{fontSize:"11px"},children:!1!==(null==e?void 0:e.enabled)?"启用":"禁用"})})]})}),description:(0,M.jsxs)("div",{style:{marginTop:"4px"},children:[(0,M.jsx)("div",{style:{color:"#666",fontSize:"13px",marginBottom:"2px"},children:s(null==e?void 0:e.description)}),(null==e?void 0:e.emailAddress)&&(0,M.jsxs)("div",{style:{color:"#999",fontSize:"11px",marginBottom:"2px"},children:["邮箱：",e.emailAddress]}),(null==e?void 0:e.lastSyncTime)&&(0,M.jsxs)("div",{style:{color:"#999",fontSize:"11px"},children:["最后同步：",new Date(e.lastSyncTime).toLocaleString()]})]})})})}}),p&&(0,M.jsx)(xt,{type:t,isEdit:g,open:p,loading:E,email:H,onClose:function(){f(!1)},onSubmit:fe}),ue]})},yt=t(26874),jt=t(95018),wt=t(5957),kt=t(31806),Zt=t(16852),Mt=Ce.Z.Text,Ct=Ce.Z.Paragraph,Et={QQ:"QQ邮箱",TENCENT_ENTERPRISE:"腾讯企业邮箱",SINA:"新浪邮箱",GMAIL:"Gmail",NETEASE_163:"网易163邮箱",NETEASE_ENTERPRISE:"网易企业邮箱",ALIYUN_ENTERPRISE:"阿里云企业邮箱",HOTMAIL:"Hotmail/Outlook",FEISHU_ENTERPRISE:"飞书企业邮箱",YAHOO:"Yahoo邮箱"},St={IMAP:"IMAP协议",POP3:"POP3协议",SMTP:"SMTP协议",EXCHANGE:"Exchange协议"},At={QQ:(0,M.jsx)(kt.Z,{}),TENCENT_ENTERPRISE:(0,M.jsx)(kt.Z,{}),SINA:(0,M.jsx)(kt.Z,{}),GMAIL:(0,M.jsx)(kt.Z,{}),NETEASE_163:(0,M.jsx)(kt.Z,{}),NETEASE_ENTERPRISE:(0,M.jsx)(kt.Z,{}),ALIYUN_ENTERPRISE:(0,M.jsx)(kt.Z,{}),HOTMAIL:(0,M.jsx)(kt.Z,{}),FEISHU_ENTERPRISE:(0,M.jsx)(kt.Z,{}),YAHOO:(0,M.jsx)(kt.Z,{})},Pt=function(){var e,n,t=vt((function(e){return{currentEmail:e.currentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),r=t.currentEmail,a=t.refreshCurrentEmail,s=(0,w.useState)(!1),i=o()(s,2),l=i[0],c=i[1],u=(0,w.useState)(!1),d=o()(u,2),p=d[0],f=d[1],h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=(0,w.useState)(!1),j=o()(y,2),Z=j[0],C=j[1],E=(0,w.useState)(!1),S=o()(E,2),A=S[0],P=S[1],I=function(){var e=L()(T()().mark((function e(){var n,t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return f(!0),e.prev=4,e.next=7,Bn({uid:r.uid});case 7:n=e.sent,console.log("queryEmailByUid refresh detail",n),200===n.code?(t=null==n?void 0:n.data,F.yw.success("应用详情刷新成功"),a&&a(t)):F.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return v(!0),e.prev=4,e.next=7,Dn({uid:r.uid,enabled:n});case 7:t=e.sent,console.log("updateEmail enabled response",t),200===t.code?(F.yw.success("应用已".concat(n?"启用":"禁用")),a&&a(null==t?void 0:t.data)):F.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,v(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),W=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return C(!0),e.prev=4,e.next=7,Dn({uid:r.uid,debug:n});case 7:t=e.sent,console.log("updateEmail debug response",t),200===t.code?(F.yw.success("调试模式已".concat(n?"开启":"关闭")),a&&a(null==t?void 0:t.data)):F.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,C(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),B=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法启动同步，应用信息不完整"),e.abrupt("return");case 3:return P(!0),e.prev=4,e.next=7,Hn({uid:r.uid});case 7:n=e.sent,console.log("startEmailSync response",n),200===n.code?(F.yw.success("同步任务启动成功"),I()):F.yw.error("启动同步失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("启动同步出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,P(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[At[r.type]||(0,M.jsx)(kt.Z,{}),(0,M.jsx)("span",{children:r.name||"邮件应用详情"}),(0,M.jsx)(Ae.Z,{color:"blue",children:Et[r.type]||r.type}),r.protocol&&(0,M.jsx)(Ae.Z,{color:"green",children:St[r.protocol]||r.protocol}),(0,M.jsx)(Ae.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"})]}),extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(qe.Z,{}),onClick:B,loading:A,type:"default",children:"同步"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:I,loading:p,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[(0,M.jsxs)(yt.Z,{gutter:16,style:{marginBottom:16},children:[(0,M.jsx)(jt.Z,{span:24,children:(0,M.jsx)(wt.Z,{message:(0,M.jsxs)(x.Z,{children:["CONNECTED"===r.connectionStatus?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Jn.Z,{style:{color:"#52c41a"}}),(0,M.jsx)("span",{style:{color:"#52c41a"},children:"连接成功"})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Zt.Z,{style:{color:"#ff4d4f"}}),(0,M.jsx)("span",{style:{color:"#ff4d4f"},children:"连接失败"})]}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:I,loading:p,type:"link",children:"刷新状态"})]}),type:"CONNECTED"===r.connectionStatus?"success":"error"})}),r.connectionError&&(0,M.jsx)(jt.Z,{span:12,children:(0,M.jsx)(wt.Z,{message:"连接错误",description:(0,M.jsx)(Te.Z,{title:r.connectionError,children:(0,M.jsx)("div",{style:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.connectionError})}),type:"error",showIcon:!0,icon:(0,M.jsx)(G.Z,{}),style:{height:"100%"}})})]}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:"应用UID",children:(0,M.jsx)(Mt,{copyable:!0,children:r.uid})}),(0,M.jsx)(Pe.Z.Item,{label:"应用名称",children:r.name}),(0,M.jsx)(Pe.Z.Item,{label:"应用描述",children:r.description||"-"}),(0,M.jsx)(Pe.Z.Item,{label:"邮箱类型",children:(0,M.jsx)(Ae.Z,{color:"blue",children:Et[r.type]||r.type})}),r.protocol&&(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"邮箱协议"}),(0,M.jsx)(Te.Z,{title:"查看邮箱协议说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/email#邮件协议说明","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(Ae.Z,{color:"green",children:St[r.protocol]||r.protocol})}),(0,M.jsx)(Pe.Z.Item,{label:"启用状态",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==r.enabled,onChange:R,loading:g,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(Mt,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:r.debug||!1,onChange:W,loading:Z,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(Mt,{type:r.debug?"warning":"secondary",children:r.debug?"已开启":"已关闭"})]})})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"邮箱账户信息"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:"邮箱地址",children:(0,M.jsx)(Mt,{copyable:!0,children:r.emailAddress||"-"})}),(0,M.jsx)(Pe.Z.Item,{label:"邮箱密码/授权码",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Mt,{copyable:!!l&&{text:r.emailPassword||""},children:(e=r.emailPassword,n=l,e?n?e:"*".repeat(Math.min(e.length,12)):"-")}),(0,M.jsx)(Te.Z,{title:l?"隐藏密码":"显示密码",children:(0,M.jsx)(b.ZP,{type:"text",icon:l?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){c(!l)},size:"small"})}),(0,M.jsx)(Te.Z,{title:"如何获取邮箱密码/授权码？",children:(0,M.jsx)(b.ZP,{type:"text",icon:(0,M.jsx)(Gn.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/email#如何获取邮箱密码","_blank")},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"发件人显示名称",children:r.senderName||"-"})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"SMTP服务器配置（发件）"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"SMTP服务器地址"}),(0,M.jsx)(Te.Z,{title:"查看SMTP服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/email#smtp服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(Mt,{copyable:!0,children:r.smtpHost||"-"})}),(0,M.jsx)(Pe.Z.Item,{label:"SMTP端口",children:r.smtpPort||"-"}),(0,M.jsx)(Pe.Z.Item,{label:"SMTP SSL",children:(0,M.jsx)(Ae.Z,{color:r.smtpSslEnabled?"success":"default",children:r.smtpSslEnabled?"已启用":"未启用"})}),(0,M.jsx)(Pe.Z.Item,{label:"SMTP TLS",children:(0,M.jsx)(Ae.Z,{color:r.smtpTlsEnabled?"success":"default",children:r.smtpTlsEnabled?"已启用":"未启用"})})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"IMAP服务器配置（收件）"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"IMAP服务器地址"}),(0,M.jsx)(Te.Z,{title:"查看IMAP服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#imap服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(Mt,{copyable:!0,children:r.imapHost||"-"})}),(0,M.jsx)(Pe.Z.Item,{label:"IMAP端口",children:r.imapPort||"-"}),(0,M.jsx)(Pe.Z.Item,{label:"IMAP SSL",children:(0,M.jsx)(Ae.Z,{color:r.imapSslEnabled?"success":"default",children:r.imapSslEnabled?"已启用":"未启用"})})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"POP3服务器配置（备选收件）"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"POP3服务器地址"}),(0,M.jsx)(Te.Z,{title:"查看POP3服务器配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.V)()+"docs/zh-CN/docs/channel/email#pop3服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(Mt,{copyable:!0,children:r.pop3Host||"-"})}),(0,M.jsx)(Pe.Z.Item,{label:"POP3端口",children:r.pop3Port||"-"}),(0,M.jsx)(Pe.Z.Item,{label:"POP3 SSL",children:(0,M.jsx)(Ae.Z,{color:r.pop3SslEnabled?"success":"default",children:r.pop3SslEnabled?"已启用":"未启用"})})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"邮件同步设置"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:"自动同步",children:(0,M.jsx)(Ae.Z,{color:r.autoSyncEnabled?"success":"default",children:r.autoSyncEnabled?"已启用":"已禁用"})}),(0,M.jsx)(Pe.Z.Item,{label:"同步间隔",children:r.syncInterval?"".concat(r.syncInterval," 分钟"):"-"}),(0,M.jsx)(Pe.Z.Item,{label:"最后同步时间",children:r.lastSyncTime?Ne()(r.lastSyncTime).format("YYYY-MM-DD HH:mm:ss"):"未同步"})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"自动回复设置"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:"自动回复",children:(0,M.jsx)(Ae.Z,{color:r.autoReplyEnabled?"success":"default",children:r.autoReplyEnabled?"已启用":"已禁用"})}),r.autoReplyEnabled&&(0,M.jsx)(Pe.Z.Item,{label:"自动回复内容",children:(0,M.jsx)(Ct,{copyable:!0,ellipsis:{rows:3,expandable:!0,symbol:"展开"},children:r.autoReplyContent||"-"})})]}),(0,M.jsx)(Re.Z,{orientation:"left",children:"其他信息"}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:"创建时间",children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),(0,M.jsx)(Pe.Z.Item,{label:"更新时间",children:r.updatedAt?Ne()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(Ct,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的邮箱密码和授权码，避免泄露给他人"}),(0,M.jsx)("li",{children:"建议使用邮箱服务商提供的应用专用密码，而非账户登录密码"}),(0,M.jsx)("li",{children:"定期检查邮箱访问日志，确保没有异常登录"}),(0,M.jsx)("li",{children:"为邮箱账户启用双重身份验证（2FA）以提高安全性"}),(0,M.jsx)("li",{children:"确保SMTP/IMAP/POP3连接使用SSL/TLS加密"}),(0,M.jsx)("li",{children:"建议定期更换邮箱密码和授权码"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,M.jsx)("li",{children:"应用启用状态控制着是否接收和处理邮件，禁用后将暂停邮件处理"})]})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",title:"邮件应用详情",extra:(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),children:(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个邮件应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},It=function(e){e.type;var n=(0,r.Z)().contentStyle;return(0,w.useEffect)((function(){0}),[]),(0,M.jsx)("div",{style:n,children:(0,M.jsx)(Pt,{})})},Tt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=t.contentStyle;return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(bt,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)(It,{type:n})})]})};function Rt(e){return Lt.apply(this,arguments)}function Lt(){return(Lt=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/telegram/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return Bt.apply(this,arguments)}function Bt(){return Bt=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/telegram/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Bt.apply(this,arguments)}function Ft(e){return Ut.apply(this,arguments)}function Ut(){return(Ut=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/telegram/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(e){return Dt.apply(this,arguments)}function Dt(){return Dt=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/telegram/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Dt.apply(this,arguments)}function qt(){return Ot.apply(this,arguments)}function Ot(){return(Ot=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/telegram/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Nt="BOT",Ht=function(e){var n=e.isEdit,t=e.telegram,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=(0,oe.Z)().translateStringTranct,f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=pe(),j=y.workgroups,Z=y.getDefaultUid,C=y.getWorkgroupOptions,E=function(){console.log("handleSubmit"),v(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==f?void 0:f.uid});console.log("submit",n),l(n)})).catch((function(){v(!1)}))};(0,w.useEffect)((function(){if(n)d.setFieldsValue({nickname:null==t?void 0:t.nickname,username:null==t?void 0:t.username,description:null==t?void 0:t.description,token:null==t?void 0:t.token,type:(null==t?void 0:t.type)||Nt,enabled:void 0===(null==t?void 0:t.enabled)||t.enabled,workgroupUid:null==t?void 0:t.workgroupUid,debug:(null==t?void 0:t.debug)||!1});else{var e=Z();d.setFieldsValue({nickname:"",username:"",description:"",token:"",type:Nt,enabled:!0,workgroupUid:e,debug:!1})}}),[n,t,d,j]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"Telegram Bot 配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:E,loading:g||s,children:g||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"telegramForm",onFinish:E,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"Bot 名称",name:"nickname",rules:[{required:!0,message:"请输入 Bot 名称"}],placeholder:"请输入 Bot 显示名称",extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,M.jsx)(he.Z,{label:"Bot 用户名",name:"username",rules:[{required:!0,message:"请输入 Bot 用户名"}],placeholder:"请输入 Bot 用户名（不包含@）",extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,M.jsx)(he.Z,{label:"Bot Token",name:"token",rules:[{required:!0,message:"请输入 Bot Token"}],placeholder:"请输入从 BotFather 获取的 Token",fieldProps:{addonAfter:(0,M.jsx)(x.Z,{children:(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})})},extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,M.jsx)(he.Z,{label:"Bot 描述",name:"description",placeholder:"请输入 Bot 描述信息"}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:C().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用 Bot",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制 Bot 是否启用，禁用后 Bot 将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：请确保您已经在 BotFather 创建了 Bot 并获取了 Token"})]})})})},Vt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{telegramResult:{data:{content:[]}},currentTelegram:{uid:"",nickname:"",avatar:"",description:"",enabled:!0},insertTelegram:function(n){e((function(e){e.telegramResult.data.content.unshift(n)}))},updateTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Telegram with uid ".concat(n.uid," not found."))}))},deleteTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Telegram with uid ".concat(n.uid," not found."))}))},setTelegramResult:function(t){var r;(e({telegramResult:t}),""===n().currentTelegram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentTelegram:t.data.content[0]}))},setCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().telegramResult),{},{data:{content:s}});e({telegramResult:o,currentTelegram:t})}else console.warn("Telegram with the specified uid not found."),e({currentTelegram:t})},refreshCurrentTelegram:function(n){e((function(e){e.currentTelegram=c()(c()({},e.currentTelegram),n);var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({telegramResult:c()(c()({},n().telegramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Telegram not found in cache:",t),n().currentTelegram.uid===t&&e({currentTelegram:{uid:"",enabled:!0}})},deleteTelegramCache:function(){return e({},!0)}}})),{name:p.I2C}))),_t=function(e){var n=e.type,t=(0,A.useIntl)(),r=(0,w.useRef)(!1),a=(0,oe.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,l=(0,w.useState)(!1),c=o()(l,2),u=c[0],d=c[1],p=(0,w.useState)(!1),f=o()(p,2),h=f[0],m=f[1],g=(0,w.useState)(!1),j=o()(g,2),k=j[0],C=j[1],E=(0,w.useState)(""),S=o()(E,2),P=S[0],I=S[1],R=(0,Y.u)((function(e){return e.currentOrg})),W=Vt((function(e){return{telegramResult:e.telegramResult,currentTelegram:e.currentTelegram,setTelegramResult:e.setTelegramResult,insertTelegram:e.insertTelegram,setCurrentTelegram:e.setCurrentTelegram,deleteCurrentTelegram:e.deleteCurrentTelegram}})),B=W.telegramResult,U=W.currentTelegram,z=W.setTelegramResult,D=W.insertTelegram,q=W.setCurrentTelegram,O=W.deleteCurrentTelegram,N=re.Z.useModal(),H=o()(N,2),V=H[0],_=H[1],K=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete telegram",n),F.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,zt(n);case 4:r=e.sent,console.log("delete telegram response",r),200===r.code?(F.yw.destroy(),F.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),O(n.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),J=function(){var e=L()(T()().mark((function e(){var n,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,F.yw.loading(t.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,orgUid:null==R?void 0:R.uid,searchText:(null==P||null===(n=P.trim)||void 0===n?void 0:n.call(P))||void 0},e.next=8,Rt(a);case 8:s=e.sent,console.log("getTelegrams response",s,a),200===s.code?(F.yw.destroy(),z(s)):(F.yw.destroy(),F.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){m(!0),d(!0)};return window.addEventListener("telegram-edit",e),function(){window.removeEventListener("telegram-edit",e)}}),[]),(0,w.useEffect)((function(){J()}),[P,null==R?void 0:R.uid]);var X=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),C(!0),e.prev=2,!h){e.next=8;break}return e.next=6,le(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,C(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading("正在创建..."),e.next=3,Wt(n);case 3:t=e.sent,F.yw.destroy(),console.log("handleCreateTelegram response:",t),200===t.code?(D(null==t?void 0:t.data),q(null==t?void 0:t.data),d(!1),F.yw.success("创建成功")):F.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==U?void 0:U.uid,F.yw.loading("正在更新..."),e.next=4,Ft(n);case 4:t=e.sent,F.yw.destroy(),console.log("handleUpdateTelegram response:",t),200===t.code?(q(null==t?void 0:t.data),d(!1),F.yw.success("更新成功")):F.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"绑定 Bot"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:J,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==U?void 0:U.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){V.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.nickname,"】？"),onOk:function(){K(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(U)}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:t.formatMessage({id:"search",defaultMessage:"搜索"}),value:P,onChange:function(e){return I(e.target.value)},onPressEnter:function(e){e.preventDefault(),J()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":t.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return J()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:B.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:U.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(ae.Z,{align:"center",gap:"small",children:[(0,M.jsxs)("span",{children:[a(null==e?void 0:e.nickname)," ",(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(@",null==e?void 0:e.username,")"]})]}),(0,M.jsx)(Ae.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?"启用":"禁用"})]}),description:null==e?void 0:e.description})})}}),u&&(0,M.jsx)(Ht,{type:n,isEdit:h,open:u,loading:k,telegram:U,onClose:function(){d(!1)},onSubmit:X}),_]})},Kt=Ce.Z.Text,Jt=Ce.Z.Paragraph,Xt={BOT:(0,M.jsx)(Fe.Z,{})},Yt={createBot:(0,k.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",botToken:(0,k.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",botApi:"https://core.telegram.org/bots/api"},Gt=function(e){e.type;var n=(0,A.useIntl)(),t=Vt((function(e){return{currentTelegram:e.currentTelegram,refreshCurrentTelegram:e.refreshCurrentTelegram}})),r=t.currentTelegram,a=t.refreshCurrentTelegram,s=(0,w.useState)(!1),i=o()(s,2),l=i[0],c=i[1],u=(0,w.useState)(!1),d=o()(u,2),p=d[0],f=d[1],h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=(0,w.useState)(!1),j=o()(y,2),Z=j[0],C=j[1],E=(0,w.useState)(null),S=o()(E,2),P=S[0],I=S[1],R=(0,w.useState)(!1),W=o()(R,2),B=W[0],U=W[1],z=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U(!0),e.prev=1,e.next=4,qt();case 4:n=e.sent,console.log("checkServiceReachable response",n),200===n.code?I(null==n?void 0:n.data):(I(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),I(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,U(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){z()}),[]);var D,q,O=function(){var e=L()(T()().mark((function e(t){var s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.incomplete",defaultMessage:"无法切换状态，Bot信息不完整"})),e.abrupt("return");case 3:return v(!0),e.prev=4,e.next=7,Ft({uid:r.uid,enabled:t});case 7:s=e.sent,console.log("updateTelegram enabled response",s),200===s.code?(F.yw.success(n.formatMessage({id:t?"telegram.bot.toggle.success.enabled":"telegram.bot.toggle.success.disabled",defaultMessage:t?"Bot已启用":"Bot已禁用"})),a&&a(null==s?void 0:s.data)):F.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.operation",defaultMessage:"操作失败"})+": ".concat(s.message||n.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.exception",defaultMessage:"操作出错"})+": ".concat(e.t0 instanceof Error?e.t0.message:n.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"})));case 15:return e.prev=15,v(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=L()(T()().mark((function e(t){var s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.incomplete",defaultMessage:"无法切换调试状态，Bot信息不完整"})),e.abrupt("return");case 3:return C(!0),e.prev=4,e.next=7,Ft({uid:r.uid,debug:t});case 7:s=e.sent,console.log("updateTelegram debug response",s),200===s.code?(F.yw.success(n.formatMessage({id:t?"telegram.bot.toggle.debug.success.enabled":"telegram.bot.toggle.debug.success.disabled",defaultMessage:t?"调试模式已开启":"调试模式已关闭"})),a&&a(null==s?void 0:s.data)):F.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.operation",defaultMessage:"操作失败"})+": ".concat(s.message||n.formatMessage({id:"telegram.bot.toggle.debug.error.unknown",defaultMessage:"未知错误"}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.exception",defaultMessage:"操作出错"})+": ".concat(e.t0 instanceof Error?e.t0.message:n.formatMessage({id:"telegram.bot.toggle.debug.error.unknown",defaultMessage:"未知错误"})));case 15:return e.prev=15,C(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error(n.formatMessage({id:"telegram.bot.refresh.error.incomplete",defaultMessage:"无法刷新详情，应用信息不完整"})),e.abrupt("return");case 3:f(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[Xt[r.type]||(0,M.jsx)(Fe.Z,{}),(0,M.jsx)("span",{children:(null==r?void 0:r.nickname)||n.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"})}),(0,M.jsx)(Ae.Z,{color:r.enabled?"success":"default",icon:r.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:r.enabled?n.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):n.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})}),null!==P&&(0,M.jsx)(Ae.Z,{color:P?"success":"error",icon:P?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:P?"服务可用":"服务不可用"}),B&&(0,M.jsx)(Ae.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open("https://core.telegram.org/bots/api","_blank")},type:"link",children:n.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("telegram-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:n.formatMessage({id:"telegram.bot.edit",defaultMessage:"编辑"})}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Jn.Z,{}),onClick:z,loading:B,type:"default",children:"检查服务"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:H,loading:p,type:"primary",children:n.formatMessage({id:"telegram.bot.refresh.details",defaultMessage:"刷新详情"})})]}),variant:"borderless",children:[!1===P&&(0,M.jsx)("div",{style:{marginBottom:16},children:(0,M.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kn.Z,{}),(0,M.jsx)("strong",{children:"服务不可用警告："}),"Telegram服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"Bot UID"}),children:(0,M.jsx)(Kt,{copyable:!0,children:r.uid})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[n.formatMessage({id:"telegram.bot.name",defaultMessage:"Bot 名称"}),(0,M.jsx)(Te.Z,{title:"查看 Telegram Bot 创建说明",children:(0,M.jsx)(Ue.Z,{onClick:function(){return window.open(Yt.createBot,"_blank")}})})]}),children:r.nickname}),(0,M.jsxs)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[n.formatMessage({id:"telegram.bot.username",defaultMessage:"Bot 用户名"}),(0,M.jsx)(Te.Z,{title:"查看 Telegram Bot 创建说明",children:(0,M.jsx)(Ue.Z,{onClick:function(){return window.open(Yt.createBot,"_blank")}})})]}),children:["@",r.username]}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"telegram.bot.description",defaultMessage:"Bot 描述"}),children:r.description||"-"}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"telegram.bot.enabled.status",defaultMessage:"启用状态"}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:r.enabled,onChange:O,loading:g,checkedChildren:n.formatMessage({id:"telegram.bot.enable",defaultMessage:"启用"}),unCheckedChildren:n.formatMessage({id:"telegram.bot.disable",defaultMessage:"禁用"})}),(0,M.jsx)(Kt,{type:r.enabled?"success":"danger",children:r.enabled?n.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):n.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:r.debug||!1,onChange:N,loading:Z,checkedChildren:n.formatMessage({id:"telegram.bot.debug.enable",defaultMessage:"开启"}),unCheckedChildren:n.formatMessage({id:"telegram.bot.debug.disable",defaultMessage:"关闭"})}),(0,M.jsx)(Kt,{type:r.debug?"warning":"secondary",children:r.debug?n.formatMessage({id:"telegram.bot.debug.enabled",defaultMessage:"已开启"}):n.formatMessage({id:"telegram.bot.debug.disabled",defaultMessage:"已关闭"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[n.formatMessage({id:"telegram.bot.token",defaultMessage:"Bot Token"}),(0,M.jsx)(Te.Z,{title:"查看如何获取 Bot Token",children:(0,M.jsx)(Ue.Z,{onClick:function(){return window.open(Yt.botToken,"_blank")}})})]}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kt,{copyable:!0,children:(D=r.token,q=l,D?q?D:"******":"-")}),(0,M.jsx)(b.ZP,{type:"text",icon:l?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return c(!l)}})]})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"telegram.bot.created.time",defaultMessage:"创建时间"}),children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[n.formatMessage({id:"telegram.bot.service.status",defaultMessage:"服务状态"}),(0,M.jsx)(Te.Z,{title:"查看 Telegram Bot API 文档",children:(0,M.jsx)(Ue.Z,{onClick:function(){return window.open(Yt.botApi,"_blank")}})})]}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kt,{type:!0===P?"success":!1===P?"danger":void 0,children:!0===P?n.formatMessage({id:"telegram.bot.service.available",defaultMessage:"服务可用"}):!1===P?n.formatMessage({id:"telegram.bot.service.unavailable",defaultMessage:"服务不可用"}):n.formatMessage({id:"telegram.bot.service.checking",defaultMessage:"检查中..."})}),(0,M.jsx)(b.ZP,{type:"text",icon:!0===P?(0,M.jsx)(Jn.Z,{}):!1===P?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(qe.Z,{spin:!0}),onClick:z,loading:B})]})})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:n.formatMessage({id:"telegram.bot.security.instructions",defaultMessage:"安全说明"})}),(0,M.jsx)(Jt,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.warning",defaultMessage:"请妥善保管您的 Bot Token，避免泄露"})}),(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.credential",defaultMessage:"Bot Token 是访问 Bot API 的唯一凭证，泄露可能导致 Bot 被他人控制"})}),(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.rotation",defaultMessage:"建议定期更换 Bot Token，特别是在怀疑可能泄露的情况下"})}),(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.reset",defaultMessage:"如发现安全问题，请立即在 BotFather 中重置 Token 并联系我们的支持团队"})}),(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.enabled.control",defaultMessage:"Bot启用状态控制着是否接收和处理消息，禁用后Bot将暂停工作"})}),(0,M.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.maintenance",defaultMessage:"建议在维护或调试时临时禁用Bot，避免接收不必要的消息"})})]})}),(0,M.jsx)("div",{style:{marginTop:"16px",textAlign:"center"},children:(0,M.jsx)(b.ZP,{type:"link",icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open(Yt.botToken,"_blank")},children:n.formatMessage({id:"telegram.bot.more.information",defaultMessage:"查看更多 Telegram Bot 文档"})})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",title:n.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"}),extra:(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/telegram","_blank")},type:"link",children:n.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),children:(0,M.jsx)(Se.Z,{description:n.formatMessage({id:"telegram.bot.select.prompt",defaultMessage:"请先在左侧列表选择一个 Telegram Bot"}),image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},Qt=function(e){console.log(e)},$t=function(e){var n=e.type,t=(0,r.Z)().contentStyle,a=[{key:"detail",label:"应用详情",children:(0,M.jsx)(Gt,{type:n})}],s=(0,w.useState)(a),i=o()(s,2),l=i[0],c=i[1];return(0,w.useEffect)((function(){var e=[].concat(a);c(e)}),[]),(0,M.jsx)("div",{style:t,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:l,onChange:Qt})})},er=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=(t.leftSiderWidth,t.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(_t,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)($t,{type:n})})]})};function nr(e){return tr.apply(this,arguments)}function tr(){return(tr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(e){return ar.apply(this,arguments)}function ar(){return ar=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),ar.apply(this,arguments)}function sr(e){return or.apply(this,arguments)}function or(){return(or=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ir(e){return lr.apply(this,arguments)}function lr(){return lr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/update/kid",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),lr.apply(this,arguments)}function cr(e){return ur.apply(this,arguments)}function ur(){return ur=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/update/accessToken",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),ur.apply(this,arguments)}function dr(e){return pr.apply(this,arguments)}function pr(){return pr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),pr.apply(this,arguments)}function fr(){return hr.apply(this,arguments)}function hr(){return(hr=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/line/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mr=function(e){var n=e.isEdit,t=e.line,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=(0,oe.Z)().translateStringTranct,f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=pe(),j=y.workgroups,Z=y.getDefaultUid,C=y.getWorkgroupOptions,E=function(){var e=L()(T()().mark((function e(){var t,r,a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleSubmit"),v(!0),e.prev=2,e.next=5,d.validateFields();case 5:if(t=e.sent,n||t.privateKey&&t.publicKey){e.next=12;break}return e.next=9,S();case 9:r=e.sent,t.privateKey=r.privateKey,t.publicKey=r.publicKey;case 12:a=c()(c()({},t),{},{orgUid:null==f?void 0:f.uid}),console.log("submit",a),l(a),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),v(!1);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||"MESSAGING_API",enabled:!1!==(null==t?void 0:t.enabled),workgroupUid:null==t?void 0:t.workgroupUid,channelId:null==t?void 0:t.channelId,channelSecret:null==t?void 0:t.channelSecret,channelAccessToken:null==t?void 0:t.channelAccessToken,kid:null==t?void 0:t.kid,privateKey:null==t?void 0:t.privateKey,publicKey:null==t?void 0:t.publicKey,debug:(null==t?void 0:t.debug)||!1});else{var e=Z();d.setFieldsValue({name:"",description:"",type:"MESSAGING_API",enabled:!0,workgroupUid:e,channelId:"",channelSecret:"",channelAccessToken:"",kid:"",privateKey:"",publicKey:"",debug:!1})}}),[n,t,d,j]);var S=function(){var e=L()(T()().mark((function e(){var n,t,r,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 2:return n=e.sent,e.next=5,crypto.subtle.exportKey("jwk",n.privateKey);case 5:return t=e.sent,e.next=8,crypto.subtle.exportKey("jwk",n.publicKey);case 8:return r=e.sent,a=JSON.stringify(t,null,2),s=JSON.stringify(r,null,2),e.abrupt("return",{privateKey:a,publicKey:s});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"Line应用配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:E,loading:g||s,children:g||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"lineAppForm",onFinish:E,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,M.jsx)(me.Z,{label:"应用类型",name:"type",options:[{label:"LINE Messaging API",value:"MESSAGING_API"}],fieldProps:{defaultValue:"MESSAGING_API"},rules:[{required:!0}]}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,M.jsx)(he.Z,{label:"Channel ID",name:"channelId",rules:[{required:!0}],fieldProps:{addonAfter:(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("channelId");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel ID获取说明"})})}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,M.jsx)(he.Z,{label:"Channel Secret",name:"channelSecret",rules:[{required:!0}],fieldProps:{addonAfter:(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("channelSecret");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel Secret获取说明"})})}),n&&(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,M.jsx)(he.Z,{label:"Kid",name:"kid",fieldProps:{placeholder:"JWT签名的Key ID，可选配置"},extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Kid获取说明"})})}),(0,M.jsx)(he.Z,{name:"channelAccessToken",hidden:!0}),(0,M.jsx)(he.Z,{name:"privateKey",hidden:!0}),(0,M.jsx)(he.Z,{name:"publicKey",hidden:!0}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:C().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：请到 LINE Developers 平台获取 Channel ID 和 Channel Secret"})]})})})},gr=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{lineResult:{data:{content:[]}},currentLine:{uid:"",nickname:"",avatar:"",description:""},insertLine:function(n){e((function(e){e.lineResult.data.content.unshift(n)}))},updateLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Line with uid ".concat(n.uid," not found."))}))},deleteLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Line with uid ".concat(n.uid," not found."))}))},setLineResult:function(t){var r;(e({lineResult:t}),""===n().currentLine.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLine:t.data.content[0]}))},setCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().lineResult),{},{data:{content:s}});e({lineResult:o,currentLine:t})}else console.warn("Line with the specified uid not found."),e({currentLine:t})},refreshCurrentLine:function(n){e((function(e){e.currentLine=c()(c()({},e.currentLine),n);var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({lineResult:c()(c()({},n().lineResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Line not found in cache:",t),n().currentLine.uid===t&&e({currentLine:{uid:""}})},deleteLineCache:function(){return e({},!0)}}})),{name:p.yRi}))),xr=function(e){var n=e.type,t=(0,A.useIntl)(),r=(0,w.useRef)(!1),a=(0,oe.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,l=(0,w.useState)(!1),u=o()(l,2),d=u[0],p=u[1],f=(0,w.useState)(!1),h=o()(f,2),m=h[0],g=h[1],j=(0,w.useState)(!1),k=o()(j,2),C=k[0],E=k[1],S=(0,w.useState)(""),P=o()(S,2),I=P[0],R=P[1],W=(0,Y.u)((function(e){return e.currentOrg})),B=(0,w.useState)(null),U=o()(B,2),z=U[0],D=U[1],q=gr((function(e){return{lineResult:e.lineResult,currentLine:e.currentLine,setLineResult:e.setLineResult,insertLine:e.insertLine,setCurrentLine:e.setCurrentLine,deleteCurrentLine:e.deleteCurrentLine,refreshCurrentLine:e.refreshCurrentLine}})),O=q.lineResult,N=q.currentLine,H=q.setLineResult,V=q.insertLine,_=q.setCurrentLine,K=q.deleteCurrentLine,J=q.refreshCurrentLine,X=re.Z.useModal(),ie=o()(X,2),le=ie[0],ce=ie[1],ue=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete line",n),F.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,dr(n);case 4:r=e.sent,console.log("delete line response",r),200===r.code?(F.yw.destroy(),F.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),K(n.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=L()(T()().mark((function e(){var n,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,F.yw.loading(t.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,orgUid:null==W?void 0:W.uid,searchText:(null==I||null===(n=I.trim)||void 0===n?void 0:n.call(I))||void 0},e.next=8,nr(a);case 8:s=e.sent,console.log("getLines response:",s,a),200===s.code?(F.yw.destroy(),H(s)):(F.yw.destroy(),F.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){g(!0),p(!0)};return window.addEventListener("lineapp-edit",e),function(){window.removeEventListener("lineapp-edit",e)}}),[]),(0,w.useEffect)((function(){de()}),[I,null==W?void 0:W.uid]);var pe=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),E(!0),e.prev=2,!m){e.next=8;break}return e.next=6,he(n);case 6:e.next=10;break;case 8:return e.next=10,fe(n);case 10:return e.prev=10,E(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),fe=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading("正在创建..."),e.next=3,rr(n);case 3:t=e.sent,F.yw.destroy(),console.log("handleCreateLine response:",t),200===t.code?(V(null==t?void 0:t.data),_(null==t?void 0:t.data),p(!1),F.yw.success("创建成功")):F.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),he=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==N?void 0:N.uid,F.yw.loading("正在更新..."),e.next=4,sr(n);case 4:t=e.sent,F.yw.destroy(),console.log("handleUpdateLine response:",t),200===t.code?(_(null==t?void 0:t.data),p(!1),F.yw.success("更新成功")):F.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=L()(T()().mark((function e(n,t){var r,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(n.uid),e.prev=1,e.next=4,sr({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateLine enabled response",r),200===r.code?(F.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=O&&null!==(a=O.data)&&void 0!==a&&a.content&&(s=O.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),H(c()(c()({},O),{},{data:c()(c()({},O.data),{},{content:s})}))),(null==N?void 0:N.uid)===n.uid&&J&&J(null==r?void 0:r.data)):F.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,D(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:de,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==N?void 0:N.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==N.enabled?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(Jn.Z,{}),label:!1!==N.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return me(N,!1===N.enabled)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){le.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){ue(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(N)}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:t.formatMessage({id:"search",defaultMessage:"搜索"}),value:I,onChange:function(e){return R(e.target.value)},onPressEnter:function(e){e.preventDefault(),de()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":t.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return de()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:O.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:N.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){_(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,M.jsx)(Xn.Z,{spinning:z===(null==e?void 0:e.uid),size:"small",children:(0,M.jsx)(Ae.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]})})})}}),d&&(0,M.jsx)(mr,{type:n,isEdit:m,open:d,loading:C,line:N,onClose:function(){p(!1)},onSubmit:pe}),ce]})},vr=Ce.Z.Text,br=Ce.Z.Paragraph,yr=function(e){e.type;var n=(0,A.useIntl)(),t=gr((function(e){return{currentLine:e.currentLine,refreshCurrentLine:e.refreshCurrentLine}})),r=t.currentLine,a=t.refreshCurrentLine,s=(0,w.useState)(!1),i=o()(s,2),l=i[0],u=i[1],d=(0,w.useState)(!1),p=o()(d,2),f=p[0],h=p[1],m=(0,w.useState)(!1),g=o()(m,2),y=g[0],j=g[1],Z=(0,w.useState)(!1),C=o()(Z,2),E=C[0],S=C[1],P=(0,w.useState)(!1),I=o()(P,2),R=I[0],W=I[1],B=(0,w.useState)(!1),U=o()(B,2),z=U[0],D=U[1],q=(0,w.useState)(""),O=o()(q,2),N=O[0],H=O[1],V=(0,w.useState)(null),_=o()(V,2),K=_[0],J=_[1],X=(0,w.useState)(!1),Y=o()(X,2),G=Y[0],Q=Y[1],ne=function(e,n){return e?n?e:"******":"-"},te=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q(!0),e.prev=1,e.next=4,fr();case 4:n=e.sent,console.log("checkLineServiceReachable response",n),200===n.code?J(null==n?void 0:n.data):(J(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),J(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,Q(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){te()}),[]);var re=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return h(!0),e.prev=4,e.next=7,sr(c()(c()({},r),{},{enabled:n}));case 7:t=e.sent,console.log("updateLine enabled response",t),200===t.code?(F.yw.success("应用已".concat(n?"启用":"禁用")),a&&a(null==t?void 0:t.data)):F.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return j(!0),e.prev=4,e.next=7,sr(c()(c()({},r),{},{debug:n}));case 7:t=e.sent,console.log("updateLine debug response",t),200===t.code?(F.yw.success("调试模式已".concat(n?"开启":"关闭")),a&&a(null==t?void 0:t.data)):F.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,j(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:u(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=L()(T()().mark((function e(){var n,t,s,o,i,l;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法重新生成密钥，应用信息不完整"),e.abrupt("return");case 3:return S(!0),e.prev=4,F.yw.loading("正在生成新的密钥对...",0),e.next=8,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 8:return n=e.sent,e.next=11,crypto.subtle.exportKey("jwk",n.privateKey);case 11:return t=e.sent,e.next=14,crypto.subtle.exportKey("jwk",n.publicKey);case 14:return s=e.sent,o=JSON.stringify(t,null,2),i=JSON.stringify(s,null,2),e.next=19,sr(c()(c()({},r),{},{privateKey:o,publicKey:i}));case 19:l=e.sent,F.yw.destroy(),200===l.code?(F.yw.success("密钥对重新生成成功！"),a&&a(null==l?void 0:l.data),console.log("=== new private key ==="),console.log(o),console.log("=== new public key ==="),console.log(i)):F.yw.error("密钥生成失败: ".concat(l.message||"未知错误")),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(4),F.yw.destroy(),F.yw.error("密钥生成出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误")),console.error("Key regeneration failed:",e.t0);case 29:return e.prev=29,S(!1),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[4,24,29,32]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法更新 Key ID，应用信息不完整"),e.abrupt("return");case 3:if(r.privateKey&&r.publicKey){e.next=6;break}return F.yw.warning("请先生成密钥对，然后再设置 Key ID"),e.abrupt("return");case 6:return e.prev=6,e.next=9,ir(c()(c()({},r),{},{kid:N}));case 9:200===(n=e.sent).code?(F.yw.success("Key ID 更新成功！"),a&&a(null==n?void 0:n.data),D(!1)):F.yw.error("Key ID 更新失败: ".concat(n.message||"未知错误")),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),F.yw.error("Key ID 更新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return F.yw.error("无法刷新 Access Token，应用信息不完整"),e.abrupt("return");case 3:if(r.kid){e.next=6;break}return F.yw.warning("请先设置 Key ID (kid)，然后再刷新 Access Token"),e.abrupt("return");case 6:return W(!0),e.prev=7,F.yw.loading("正在刷新 Access Token...",0),e.next=11,cr({uid:r.uid,kid:r.kid});case 11:n=e.sent,F.yw.destroy(),200===n.code?(F.yw.success("Access Token 刷新成功！"),a&&a(null==n?void 0:n.data)):F.yw.error("Access Token 刷新失败: ".concat(n.message||"未知错误")),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),F.yw.destroy(),F.yw.error("Access Token 刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 20:return e.prev=20,W(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,16,20,23]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:r.name||"Line应用详情"}),(0,M.jsx)(Ae.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"}),null!==K&&(0,M.jsx)(Ae.Z,{color:K?"success":"error",icon:K?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:K?"服务可用":"服务不可用"}),G&&(0,M.jsx)(Ae.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("lineapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Jn.Z,{}),onClick:te,loading:G,type:"default",children:"检查服务"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:se,loading:l,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[!1===K&&(0,M.jsx)("div",{style:{marginBottom:16},children:(0,M.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kn.Z,{}),(0,M.jsx)("strong",{children:"服务不可用警告："}),"Line服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,styles:{label:{width:"200px",minWidth:"200px"}},children:[(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(vr,{copyable:!0,children:r.uid})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.channelId",defaultMessage:"Channel ID"}),children:(0,M.jsx)(vr,{copyable:{text:r.channelId},children:ne(r.channelId,!0)})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.channelSecret",defaultMessage:"Channel Secret"}),children:(0,M.jsx)(vr,{copyable:{text:r.channelSecret},children:ne(r.channelSecret,!1)})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.privateKey",defaultMessage:"私钥 (Private Key)"}),children:(0,M.jsx)(x.Z,{direction:"vertical",style:{width:"100%"},children:(0,M.jsx)(vr,{copyable:{text:r.privateKey},children:(0,M.jsx)("div",{style:{maxHeight:"100px",overflow:"auto",background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:r.privateKey})})})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.publicKey",defaultMessage:"公钥 (Public Key)"}),children:(0,M.jsxs)(x.Z,{direction:"vertical",style:{width:"100%"},children:[(0,M.jsx)(vr,{copyable:{text:r.publicKey},children:(0,M.jsx)("div",{style:{maxHeight:"100px",overflow:"auto",background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:r.publicKey})}),(0,M.jsx)(b.ZP,{size:"small",onClick:oe,loading:E,type:"primary",danger:!0,children:"重新生成密钥对"})]})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.kid",defaultMessage:"Kid (kid)"}),children:(0,M.jsx)(x.Z,{direction:"vertical",style:{width:"100%"},children:z?(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(v.Z,{value:N,onChange:function(e){return H(e.target.value)},placeholder:"请输入 Key ID",style:{width:200}}),(0,M.jsx)(b.ZP,{size:"small",type:"primary",onClick:ie,children:"保存"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){D(!1),H("")},children:"取消"})]}):(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(vr,{copyable:{text:r.kid},children:r.kid||"-"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){H((null==r?void 0:r.kid)||""),D(!0)},type:"link",children:"编辑"})]})})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"line.channelAccessToken",defaultMessage:"Channel Access Token"}),children:(0,M.jsx)(x.Z,{direction:"vertical",style:{width:"100%"},children:r.channelAccessToken?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("div",{children:[(0,M.jsx)(vr,{strong:!0,children:"Access Token: "}),(0,M.jsx)(vr,{copyable:{text:r.channelAccessToken.accessToken},children:ne(r.channelAccessToken.accessToken,!1)})]}),r.channelAccessToken.tokenType&&(0,M.jsxs)("div",{children:[(0,M.jsx)(vr,{strong:!0,children:"Token Type: "}),(0,M.jsx)(vr,{children:r.channelAccessToken.tokenType})]}),r.channelAccessToken.expiresIn&&(0,M.jsxs)("div",{children:[(0,M.jsx)(vr,{strong:!0,children:"Expires In: "}),(0,M.jsxs)(vr,{children:[r.channelAccessToken.expiresIn," 秒"]})]}),r.channelAccessToken.keyId&&(0,M.jsxs)("div",{children:[(0,M.jsx)(vr,{strong:!0,children:"Key ID: "}),(0,M.jsx)(vr,{copyable:{text:r.channelAccessToken.keyId},children:r.channelAccessToken.keyId})]}),(0,M.jsx)(b.ZP,{size:"small",onClick:le,loading:R,type:"primary",children:"刷新 Access Token"})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(vr,{type:"secondary",children:"-"}),(0,M.jsx)(b.ZP,{size:"small",onClick:le,loading:R,type:"primary",children:"刷新 Access Token"})]})})}),(0,M.jsx)(Pe.Z.Item,{label:"Webhook URL",children:(0,M.jsx)(vr,{copyable:!0,children:(0,k.kG)()+"/line/webhooks/"+r.uid})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==r.enabled,onChange:re,loading:f,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(vr,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:r.debug||!1,onChange:ae,loading:y,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(vr,{type:r.debug?"warning":"secondary",children:r.debug?"已开启":"已关闭"})]})}),(0,M.jsx)(Pe.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(br,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的Line应用凭证，避免泄露"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,M.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,M.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",title:"Line应用详情",extra:(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/channel/line","_blank")},type:"link",children:"文档"}),children:(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个Line应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},jr=function(e){console.log(e)},wr=function(e){var n=e.type,t=(0,r.Z)().contentStyle,a=[{key:"detail",label:"应用详情",children:(0,M.jsx)(yr,{type:n})}],s=(0,w.useState)(a),i=o()(s,2),l=i[0],c=i[1];return(0,w.useEffect)((function(){var e=[].concat(a);c(e)}),[]),(0,M.jsx)("div",{style:t,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:l,onChange:jr})})},kr=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=(t.leftSiderWidth,t.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(xr,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)(wr,{type:n})})]})};function Zr(e){return Mr.apply(this,arguments)}function Mr(){return(Mr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cr(e){return Er.apply(this,arguments)}function Er(){return(Er=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sr(e){return Ar.apply(this,arguments)}function Ar(){return(Ar=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pr(e){return Ir.apply(this,arguments)}function Ir(){return(Ir=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tr(e){return Rr.apply(this,arguments)}function Rr(){return(Rr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lr(){return Wr.apply(this,arguments)}function Wr(){return(Wr=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/whatsapp/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Br={YCLOUD:p.QVR,CLOUD:p.bcD},Fr=function(e){var n=e.isEdit,t=e.whatsApp,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=(0,oe.Z)().translateStringTranct,f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=(0,w.useState)(Br.YCLOUD),j=o()(y,2),Z=j[0],C=j[1],E=pe(),S=E.workgroups,A=E.getDefaultUid,P=E.getWorkgroupOptions,I=function(){console.log("handleSubmit"),v(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==f?void 0:f.uid});console.log("submit",n),l(n)})).catch((function(){v(!1)}))};return(0,w.useEffect)((function(){if(n){var e=(null==t?void 0:t.type)||Br.YCLOUD;d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:e,key:null==t?void 0:t.key,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1}),C(e)}else{var r=A();d.setFieldsValue({name:"",description:"",type:Br.YCLOUD,key:"",workgroupUid:r,enabled:!0,debug:!1}),C(Br.YCLOUD)}}),[n,t,d,S]),(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"WhatsApp应用配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:I,loading:g||s,children:g||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"wechatWorkForm",onFinish:I,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,M.jsx)(me.Z,{label:"应用类型",name:"type",options:[{label:"YCloud版",value:Br.YCLOUD},{label:"云服务版",value:Br.CLOUD,disabled:!0}],fieldProps:{defaultValue:Br.YCLOUD,onChange:function(e){return C(e)}},rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"应用密钥",name:"key",rules:[{required:!0}],extra:(0,M.jsxs)(M.Fragment,{children:["请输入WhatsApp应用的密钥配置信息",Z===Br.YCLOUD&&(0,M.jsx)("div",{style:{marginTop:8},children:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/whatsapp#%E5%88%9B%E5%BB%BA-api-key",target:"_blank",rel:"noopener noreferrer",children:"查看YCloud版应用密钥获取说明"})})]})}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:P().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Ur=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{whatsAppResult:{data:{content:[]}},currentWhatsApp:{uid:"",nickname:"",avatar:"",description:""},insertWhatsApp:function(n){e((function(e){e.whatsAppResult.data.content.unshift(n)}))},updateWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},deleteWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},setWhatsAppResult:function(t){var r;(e({whatsAppResult:t}),""===n().currentWhatsApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWhatsApp:t.data.content[0]}))},setCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().whatsAppResult),{},{data:{content:s}});e({whatsAppResult:o,currentWhatsApp:t})}else console.warn("WhatsApp with the specified uid not found."),e({currentWhatsApp:t})},refreshCurrentWhatsApp:function(n){e((function(e){e.currentWhatsApp=c()(c()({},e.currentWhatsApp),n);var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({whatsAppResult:c()(c()({},n().whatsAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WhatsApp not found in cache:",t),n().currentWhatsApp.uid===t&&e({currentWhatsApp:{uid:""}})},deleteWhatsAppCache:function(){return e({},!0)}}})),{name:p.TvW}))),zr=function(){var e=(0,A.useIntl)(),n=(0,w.useRef)(!1),t=(0,oe.Z)().translateStringTranct,r=(0,i.Z)().isDarkMode,a=(0,w.useState)(!1),s=o()(a,2),l=s[0],u=s[1],d=(0,w.useState)(!1),p=o()(d,2),f=p[0],h=p[1],m=(0,w.useState)(!1),g=o()(m,2),j=g[0],k=g[1],C=(0,w.useState)(""),E=o()(C,2),S=E[0],P=E[1],I=(0,Y.u)((function(e){return e.currentOrg})),R=(0,w.useState)(null),W=o()(R,2),B=W[0],U=W[1],z=Ur((function(e){return{whatsAppResult:e.whatsAppResult,currentWhatsApp:e.currentWhatsApp,setWhatsAppResult:e.setWhatsAppResult,insertWhatsApp:e.insertWhatsApp,setCurrentWhatsApp:e.setCurrentWhatsApp,deleteCurrentWhatsApp:e.deleteCurrentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),D=z.whatsAppResult,q=z.currentWhatsApp,O=z.setWhatsAppResult,N=z.insertWhatsApp,H=z.setCurrentWhatsApp,V=z.deleteCurrentWhatsApp,_=z.refreshCurrentWhatsApp,K=re.Z.useModal(),J=o()(K,2),X=J[0],ie=J[1],le=function(){var n=L()(T()().mark((function n(t){var r;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete whatsApp",t),F.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,Tr(t);case 4:r=n.sent,console.log("delete whatsApp response",r),200===r.code?(F.yw.destroy(),F.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),V(t.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ce=function(){var t=L()(T()().mark((function t(){var r,a,s;return T()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.current){t.next=3;break}return console.log("isLoading: 1",n.current),t.abrupt("return");case 3:return n.current=!0,F.yw.loading(e.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,orgUid:null==I?void 0:I.uid,searchText:(null==S||null===(r=S.trim)||void 0===r?void 0:r.call(S))||void 0},t.next=8,Zr(a);case 8:s=t.sent,console.log("getWhatsApps response",s,a),200===s.code?(F.yw.destroy(),O(s)):(F.yw.destroy(),F.yw.error(s.message)),n.current=!1;case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){h(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]),(0,w.useEffect)((function(){ce()}),[S,null==I?void 0:I.uid]);var ue=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!f){e.next=8;break}return e.next=6,pe(n);case 6:e.next=10;break;case 8:return e.next=10,de(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),de=function(){var n=L()(T()().mark((function n(t){var r;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return F.yw.loading(e.formatMessage({id:"creating"})),n.next=3,Sr(t);case 3:r=n.sent,F.yw.destroy(),console.log("handleCreateWhatsApp response:",r),200===r.code?(N(null==r?void 0:r.data),H(null==r?void 0:r.data),u(!1),F.yw.success(e.formatMessage({id:"common.created"}))):F.yw.error(r.message);case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),pe=function(){var n=L()(T()().mark((function n(t){var r;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.uid=null==q?void 0:q.uid,F.yw.loading(e.formatMessage({id:"updating"})),n.next=4,Pr(t);case 4:r=n.sent,F.yw.destroy(),console.log("handleUpdateWhatsApp response:",r),200===r.code?(H(null==r?void 0:r.data),u(!1),F.yw.success(e.formatMessage({id:"common.updated"}))):F.yw.error(r.message);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),fe=function(){var n=L()(T()().mark((function n(t,r){var a,s,o;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return U(t.uid),n.prev=1,n.next=4,Pr({uid:t.uid,enabled:r});case 4:a=n.sent,console.log("updateWhatsApp enabled response",a),200===a.code?(F.yw.success(e.formatMessage({id:r?"whatsapp.app.toggle.success.enabled":"whatsapp.app.toggle.success.disabled"})),null!=D&&null!==(s=D.data)&&void 0!==s&&s.content&&(o=D.data.content.map((function(e){return e.uid===t.uid?c()(c()({},e),{},{enabled:r}):e})),O(c()(c()({},D),{},{data:c()(c()({},D.data),{},{content:o})}))),(null==q?void 0:q.uid)===t.uid&&_&&_(null==a?void 0:a.data)):F.yw.error(a.message||e.formatMessage({id:"whatsapp.app.toggle.error.operation"})),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),F.yw.error(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"whatsapp.app.toggle.error.exception"}));case 12:return n.prev=12,U(null),n.finish(12);case 15:case"end":return n.stop()}}),n,null,[[1,9,12,15]])})));return function(e,t){return n.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){u(!0),h(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:ce,children:e.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==q?void 0:q.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:e.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),u(!0)}},{key:"toggle_enabled",icon:!1!==q.enabled?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(Jn.Z,{}),label:!1!==q.enabled?e.formatMessage({id:"app.disable",defaultMessage:"禁用"}):e.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return fe(q,!1===q.enabled)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:e.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return n=q,void X.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){le(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:e.formatMessage({id:"search",defaultMessage:"搜索"}),value:S,onChange:function(e){return P(e.target.value)},onPressEnter:function(e){e.preventDefault(),ce()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":e.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return ce()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:D.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:q.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){H(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:t(null==e?void 0:e.name)}),(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]}),(0,M.jsx)(Xn.Z,{spinning:B===(null==e?void 0:e.uid),size:"small",children:(0,M.jsx)(Ae.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:t(null==e?void 0:e.description)})})}}),l&&(0,M.jsx)(Fr,{isEdit:f,open:l,loading:j,whatsApp:q,onClose:function(){u(!1)},onSubmit:ue}),ie]})},Dr=t(77274),qr=Ce.Z.Text,Or=Ce.Z.Paragraph,Nr=B()(B()({},p.QVR,"YCloud版"),p.bcD,"云服务版"),Hr=B()(B()({},p.QVR,(0,M.jsx)(Le.Z,{})),p.bcD,(0,M.jsx)(Dr.Z,{})),Vr=function(){var e=(0,A.useIntl)(),n=Ur((function(e){return{currentWhatsApp:e.currentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),t=n.currentWhatsApp,r=n.refreshCurrentWhatsApp,a=(0,w.useState)(!1),s=o()(a,2),i=s[0],l=s[1],c=(0,w.useState)(!1),u=o()(c,2),d=u[0],p=u[1],f=(0,w.useState)(!1),h=o()(f,2),m=h[0],g=h[1],v=(0,w.useState)(!1),y=o()(v,2),j=y[0],Z=y[1],C=(0,w.useState)(null),E=o()(C,2),S=E[0],P=E[1],I=(0,w.useState)(!1),R=o()(I,2),W=R[0],B=R[1],U=function(){return l(!i)},z=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(!0),e.prev=1,e.next=4,Lr();case 4:n=e.sent,console.log("checkServiceReachable response",n),200===n.code?P(null==n?void 0:n.data):(P(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),P(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,B(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){z()}),[]);var D,q,O=function(){var n=L()(T()().mark((function n(){var a,s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"whatsapp.app.refresh.error.incomplete"})),n.abrupt("return");case 3:return p(!0),n.prev=4,n.next=7,Cr({uid:t.uid});case 7:a=n.sent,console.log("queryWhatsAppByUid refresh detail",a),200===a.code?(s=null==a?void 0:a.data,F.yw.success(e.formatMessage({id:"whatsapp.app.refresh.success"})),r&&r(s)):F.yw.error(a.message||e.formatMessage({id:"whatsapp.app.refresh.error.failed"})),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"whatsapp.app.refresh.error.exception"}));case 15:return n.prev=15,p(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(){return n.apply(this,arguments)}}(),N=function(){var n=L()(T()().mark((function n(a){var s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"whatsapp.app.toggle.error.incomplete"})),n.abrupt("return");case 3:return g(!0),n.prev=4,n.next=7,Pr({uid:t.uid,enabled:a});case 7:s=n.sent,console.log("updateWhatsApp enabled response",s),200===s.code?(F.yw.success(e.formatMessage({id:a?"whatsapp.app.toggle.success.enabled":"whatsapp.app.toggle.success.disabled"})),r&&r(null==s?void 0:s.data)):F.yw.error(s.message||e.formatMessage({id:"whatsapp.app.toggle.error.operation"})),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"whatsapp.app.toggle.error.exception"}));case 15:return n.prev=15,g(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(e){return n.apply(this,arguments)}}(),H=function(){var n=L()(T()().mark((function n(a){var s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"debug.toggle.error.incomplete"})),n.abrupt("return");case 3:return Z(!0),n.prev=4,n.next=7,Pr({uid:t.uid,debug:a});case 7:s=n.sent,console.log("updateWhatsApp debug response",s),200===s.code?(F.yw.success(e.formatMessage({id:a?"debug.toggle.success.enabled":"debug.toggle.success.disabled"})),r&&r(null==s?void 0:s.data)):F.yw.error(s.message||e.formatMessage({id:"whatsapp.app.toggle.error.operation"})),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"whatsapp.app.toggle.error.exception"}));case 15:return n.prev=15,Z(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(e){return n.apply(this,arguments)}}();return(0,M.jsx)(Ee.Z,{title:null!=t&&t.uid?(0,M.jsxs)(x.Z,{children:[Hr[t.type]||(0,M.jsx)(Le.Z,{}),(0,M.jsx)("span",{children:t.name||"WhatsApp应用详情"}),(0,M.jsx)(Ae.Z,{color:"blue",children:Nr[t.type]||t.type}),(0,M.jsx)(Ae.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==S&&(0,M.jsx)(Ae.Z,{color:S?"success":"error",icon:S?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:S?"服务可用":"服务不可用"}),W&&(0,M.jsx)(Ae.Z,{color:"processing",children:"检查服务中..."})]}):"WhatsApp应用详情",extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/whatsapp","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Jn.Z,{}),onClick:z,loading:W,type:"default",children:"检查服务"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:O,loading:d,type:"primary",children:"刷新详情"})]})]}),variant:"borderless",children:null!=t&&t.uid?(0,M.jsxs)(M.Fragment,{children:[!1===S&&(0,M.jsx)("div",{style:{marginBottom:16},children:(0,M.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kn.Z,{}),(0,M.jsx)("strong",{children:"服务不可用警告："}),"WhatsApp服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(qr,{copyable:!0,children:t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,M.jsx)(Ae.Z,{color:"blue",children:Nr[t.type]||t.type})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==t.enabled,onChange:N,loading:m,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(qr,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:t.debug||!1,onChange:H,loading:j,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(qr,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"应用密钥",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(qr,{copyable:!!i&&{text:t.key||""},children:(D=t.key,q=i,D?q?D:"******":"-")}),(0,M.jsx)(Te.Z,{title:i?"隐藏密钥":"显示密钥",children:(0,M.jsx)(b.ZP,{type:"text",icon:i?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:U,size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"Webhook URL",children:(0,M.jsx)(qr,{copyable:!0,children:(0,k.kG)()+"/whatsapp/webhooks/"+t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:"AccessToken",children:(0,M.jsx)(x.Z,{children:(0,M.jsx)(qr,{copyable:!0,children:t.accessToken||"-"})})}),(0,M.jsx)(Pe.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Ne()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(Or,{children:t.description})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(Or,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的WhatsApp应用凭证，避免泄露"}),(0,M.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,M.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,M.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,M.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个WhatsApp应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},_r=(t(36111),t(10530),function(e){console.log(e)}),Kr=function(){(0,A.useIntl)();var e=(0,r.Z)().contentStyle,n=[{key:"detail",label:"应用详情",children:(0,M.jsx)(Vr,{})}],t=(0,w.useState)(n),a=o()(t,2),s=a[0],i=a[1];return(0,w.useEffect)((function(){var e=[].concat(n);i(e)}),[]),(0,M.jsx)("div",{style:e,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:s,onChange:_r})})},Jr=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=(e.leftSiderWidth,e.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:n,children:(0,M.jsx)(zr,{})}),(0,M.jsx)(a.Z.Panel,{style:t,children:(0,M.jsx)(Kr,{})})]})};function Xr(e){return Yr.apply(this,arguments)}function Yr(){return(Yr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gr(e){return Qr.apply(this,arguments)}function Qr(){return(Qr=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $r(e){return ea.apply(this,arguments)}function ea(){return(ea=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function na(e){return ta.apply(this,arguments)}function ta(){return(ta=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ra(e){return aa.apply(this,arguments)}function aa(){return(aa=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sa(e){return oa.apply(this,arguments)}function oa(){return(oa=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/checkServiceReachable",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ia=t(84176),la=t.n(ia),ca=["token"],ua="WEBHOOK",da="MESSENGER",pa="INSTAGRAM",fa="WHATSAPP",ha=function(e){var n=e.isEdit,t=e.messenger,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=(0,oe.Z)().translateStringTranct,f=(0,Y.u)((function(e){return e.currentOrg})),h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=pe(),j=y.workgroups,Z=y.getDefaultUid,C=y.getWorkgroupOptions,E=function(){console.log("handleSubmit"),v(!0),d.validateFields().then((function(e){var n=e.token,t=la()(e,ca),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==f?void 0:f.uid});console.log("submit",r),l(r)})).catch((function(){v(!1)}))};(0,w.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||da,appId:null==t?void 0:t.appId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.verifyToken,pageId:null==t?void 0:t.pageId,pageAccessToken:null==t?void 0:t.pageAccessToken,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=Z();d.setFieldsValue({name:"",description:"",type:da,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,j]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"Meta应用配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:E,loading:g||s,children:g||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"wechatWorkForm",onFinish:E,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,M.jsx)(me.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:ua},{label:"Messenger",value:da},{label:"Instagram",value:pa},{label:"Whatsapp",value:fa}],fieldProps:{defaultValue:ua},rules:[{required:!0}]}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,M.jsx)(he.Z,{label:"应用ID(App ID)",name:"appId",rules:[{required:!0}],extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App ID获取说明"})})}}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,M.jsx)(he.Z,{label:"应用Secret(App Secret)",name:"appSecret",rules:[{required:!0}],extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App Secret获取说明"})})}}),(0,M.jsx)(he.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,M.jsx)(he.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token",extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-access-token",target:"_blank",rel:"noopener noreferrer",children:"查看Page Access Token获取说明"})})}}),(0,M.jsx)(fe.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,M.jsx)(he.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID",extra:(0,M.jsx)("a",{href:(0,k.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id",target:"_blank",rel:"noopener noreferrer",children:"查看Page ID获取说明"})})}}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:C().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},ma=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{messengerResult:{data:{content:[]}},currentMessenger:{uid:"",nickname:"",avatar:"",description:""},insertMessenger:function(n){e((function(e){e.messengerResult.data.content.unshift(n)}))},updateMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Messenger with uid ".concat(n.uid," not found."))}))},deleteMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Messenger with uid ".concat(n.uid," not found."))}))},setMessengerResult:function(t){var r;(e({messengerResult:t}),""===n().currentMessenger.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMessenger:t.data.content[0]}))},setCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().messengerResult),{},{data:{content:s}});e({messengerResult:o,currentMessenger:t})}else console.warn("Messenger with the specified uid not found."),e({currentMessenger:t})},refreshCurrentMessenger:function(n){e((function(e){e.currentMessenger=c()(c()({},e.currentMessenger),n);var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({messengerResult:c()(c()({},n().messengerResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Messenger not found in cache:",t),n().currentMessenger.uid===t&&e({currentMessenger:{uid:""}})},deleteMessengerCache:function(){return e({},!0)}}})),{name:p.Gmi}))),ga=B()(B()(B()(B()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),xa=function(e){var n=e.type,t=(0,A.useIntl)(),r=(0,w.useRef)(!1),a=(0,oe.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,l=(0,w.useState)(!1),u=o()(l,2),d=u[0],p=u[1],f=(0,w.useState)(!1),h=o()(f,2),m=h[0],g=h[1],j=(0,w.useState)(!1),k=o()(j,2),C=k[0],E=k[1],S=(0,w.useState)(""),P=o()(S,2),I=P[0],R=P[1],W=(0,Y.u)((function(e){return e.currentOrg})),B=(0,w.useState)(null),U=o()(B,2),z=U[0],D=U[1],q=ma((function(e){return{messengerResult:e.messengerResult,currentMessenger:e.currentMessenger,setMessengerResult:e.setMessengerResult,insertMessenger:e.insertMessenger,setCurrentMessenger:e.setCurrentMessenger,deleteCurrentMessenger:e.deleteCurrentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),O=q.messengerResult,N=q.currentMessenger,H=q.setMessengerResult,V=q.insertMessenger,_=q.setCurrentMessenger,K=q.deleteCurrentMessenger,J=q.refreshCurrentMessenger,X=re.Z.useModal(),ie=o()(X,2),le=ie[0],ce=ie[1],ue=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete messenger",n),F.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ra(n);case 4:r=e.sent,console.log("delete messenger response",r),200===r.code?(F.yw.destroy(),F.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),K(n.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=L()(T()().mark((function e(){var a,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,F.yw.loading(t.formatMessage({id:"loading"})),s={pageNumber:0,pageSize:50,type:n,orgUid:null==W?void 0:W.uid,searchText:(null==I||null===(a=I.trim)||void 0===a?void 0:a.call(I))||void 0},e.next=8,Xr(s);case 8:o=e.sent,console.log("getMessengers response",o,s),200===o.code?(F.yw.destroy(),H(o)):(F.yw.destroy(),F.yw.error(o.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){g(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]),(0,w.useEffect)((function(){de()}),[I,null==W?void 0:W.uid]);var pe=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),E(!0),e.prev=2,!m){e.next=8;break}return e.next=6,he(n);case 6:e.next=10;break;case 8:return e.next=10,fe(n);case 10:return e.prev=10,E(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),fe=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading("正在创建..."),e.next=3,$r(n);case 3:t=e.sent,F.yw.destroy(),console.log("handleCreateMessenger response:",t),200===t.code?(V(null==t?void 0:t.data),_(null==t?void 0:t.data),p(!1),F.yw.success("创建成功")):F.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),he=function(){var e=L()(T()().mark((function e(n){var t;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==N?void 0:N.uid,F.yw.loading("正在更新..."),e.next=4,na(n);case 4:t=e.sent,F.yw.destroy(),console.log("handleUpdateMessenger response:",t),200===t.code?(_(null==t?void 0:t.data),p(!1),F.yw.success("更新成功")):F.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=L()(T()().mark((function e(n,t){var r,a,s;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(n.uid),e.prev=1,e.next=4,na({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateMessenger enabled response",r),200===r.code?(F.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=O&&null!==(a=O.data)&&void 0!==a&&a.content&&(s=O.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),H(c()(c()({},O),{},{data:c()(c()({},O.data),{},{content:s})}))),(null==N?void 0:N.uid)===n.uid&&J&&J(null==r?void 0:r.data)):F.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,D(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:de,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==N?void 0:N.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==N.enabled?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(Jn.Z,{}),label:!1!==N.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return me(N,!1===N.enabled)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){le.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){ue(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(N)}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:t.formatMessage({id:"search",defaultMessage:"搜索"}),value:I,onChange:function(e){return R(e.target.value)},onPressEnter:function(e){e.preventDefault(),de()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":t.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return de()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:O.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:(null==N?void 0:N.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){_(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(",ga[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,M.jsx)(Xn.Z,{spinning:z===(null==e?void 0:e.uid),size:"small",children:(0,M.jsx)(Ae.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,M.jsx)(ha,{isEdit:m,open:d,loading:C,messenger:N,onClose:function(){p(!1)},onSubmit:pe}),ce]})},va=Ce.Z.Text,ba=Ce.Z.Paragraph,ya=B()(B()(B()(B()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),ja=B()(B()(B()(B()({},p.Iap,(0,M.jsx)(De.Z,{})),p.Ff2,(0,M.jsx)(Le.Z,{})),p.cRk,(0,M.jsx)(We.Z,{})),p.SbP,(0,M.jsx)(Be.Z,{})),wa="appSecret",ka="verifyToken",Za="accessToken",Ma="pageAccessToken",Ca=function(){var e=(0,A.useIntl)(),n=ma((function(e){return{currentMessenger:e.currentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),t=n.currentMessenger,r=n.refreshCurrentMessenger,a=(0,w.useState)(B()(B()(B()(B()({},wa,!1),ka,!1),Za,!1),Ma,!1)),s=o()(a,2),i=s[0],l=s[1],u=(0,w.useState)(!1),d=o()(u,2),p=d[0],f=d[1],h=(0,w.useState)(!1),m=o()(h,2),g=m[0],v=m[1],y=(0,w.useState)(!1),j=o()(y,2),Z=j[0],C=j[1],E=(0,w.useState)(null),S=o()(E,2),P=S[0],I=S[1],R=(0,w.useState)(!1),W=o()(R,2),U=W[0],z=W[1],D=function(e){l((function(n){return c()(c()({},n),{},B()({},e,!n[e]))}))},q=function(e,n){return e?n?e:"******":"-"},O=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(!0),e.prev=1,e.next=4,sa({});case 4:n=e.sent,console.log("checkMessengerServiceReachable response",n),200===n.code?I(null==n?void 0:n.data):(I(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),I(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,z(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){O()}),[]);var N,H=function(){var e=L()(T()().mark((function e(){var n,a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return f(!0),e.prev=4,e.next=7,Gr({uid:t.uid});case 7:n=e.sent,console.log("queryMessengerByUid refresh detail",n),200===n.code?(a=null==n?void 0:n.data,F.yw.success("应用详情刷新成功"),r&&r(a)):F.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=L()(T()().mark((function e(n){var a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return v(!0),e.prev=4,e.next=7,na({uid:t.uid,enabled:n});case 7:a=e.sent,console.log("updateMessenger enabled response",a),200===a.code?(F.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(null==a?void 0:a.data)):F.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,v(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=L()(T()().mark((function e(n){var a;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return F.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return C(!0),e.prev=4,e.next=7,na({uid:t.uid,debug:n});case 7:a=e.sent,console.log("updateMessenger debug response",a),200===a.code?(F.yw.success("调试模式已".concat(n?"开启":"关闭")),r&&r(null==a?void 0:a.data)):F.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),F.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,C(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,M.jsx)(Ee.Z,{title:null!=t&&t.uid?(0,M.jsxs)(x.Z,{children:[ja[t.type]||(0,M.jsx)(Le.Z,{}),(0,M.jsx)("span",{children:t.name||"Messenger应用详情"}),(0,M.jsx)(Ae.Z,{color:"blue",children:ya[t.type]||t.type}),(0,M.jsx)(Ae.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==P&&(0,M.jsx)(Ae.Z,{color:P?"success":"error",icon:P?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:P?"服务可用":"服务不可用"}),U&&(0,M.jsx)(Ae.Z,{color:"processing",children:"检查服务中..."})]}):"Messenger应用详情",extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Jn.Z,{}),onClick:O,loading:U,type:"default",children:"检查服务"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:H,loading:p,type:"primary",children:"刷新详情"})]})]}),variant:"borderless",children:null!=t&&t.uid?(0,M.jsxs)(M.Fragment,{children:[!1===P&&(0,M.jsx)("div",{style:{marginBottom:16},children:(0,M.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kn.Z,{}),(0,M.jsx)("strong",{children:"服务不可用警告："}),"Messenger服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(va,{copyable:!0,children:t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,M.jsx)(Ae.Z,{color:"blue",children:ya[t.type]||t.type})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==t.enabled,onChange:V,loading:g,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(va,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:t.debug||!1,onChange:_,loading:Z,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(va,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"AppID"}),(0,M.jsx)(Te.Z,{title:"查看获取App ID说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(va,{copyable:!0,children:t.appId})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"AppSecret"}),(0,M.jsx)(Te.Z,{title:"查看获取App Secret说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(va,{copyable:!!i[wa]&&{text:t.appSecret||""},children:q(t.appSecret,i[wa])}),(0,M.jsx)(Te.Z,{title:i[wa]?"隐藏AppSecret":"显示AppSecret",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[wa]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return D(wa)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"Webhook URL"}),(0,M.jsx)(Te.Z,{title:"查看Webhook配置说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E9%85%8D%E7%BD%AE-webhook","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsxs)(x.Z,{direction:"vertical",size:0,children:[(0,M.jsx)(va,{copyable:!0,children:(0,k.kG)()+"/meta/webhooks/"+t.uid}),(N=(0,k.kG)()+"/meta/webhooks/"+t.uid,/(\d{1,3}\.){3}\d{1,3}/.test(N)&&(0,M.jsx)(wt.Z,{message:"Webhook URL中包含IP地址，Facebook仅支持https+域名的方式。",type:"warning",action:(0,M.jsx)(b.ZP,{size:"small",onClick:function(){window.open((0,k.L5)()+"docs/zh-CN/docs/deploy/depend/nginx","_blank")},children:"-》解决方案: Nginx反向代理"})}))]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"验证口令"}),(0,M.jsx)(Te.Z,{title:"查看验证口令使用说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E9%85%8D%E7%BD%AE-webhook","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(va,{copyable:!!i[ka]&&{text:t.verifyToken||""},children:q(t.verifyToken,i[ka])}),(0,M.jsx)(Te.Z,{title:i[ka]?"隐藏Verify Token":"显示Verify Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[ka]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return D(ka)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"Page Access Token"}),(0,M.jsx)(Te.Z,{title:"查看获取Page Access Token说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-access-token","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(va,{copyable:!!i[Ma]&&{text:t.pageAccessToken||""},children:q(t.pageAccessToken,i[Ma])}),(0,M.jsx)(Te.Z,{title:i[Ma]?"隐藏Page Access Token":"显示Page Access Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[Ma]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return D(Ma)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:"Page ID"}),(0,M.jsx)(Te.Z,{title:"查看获取Page ID说明",children:(0,M.jsx)(Gn.Z,{onClick:function(){return window.open((0,k.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id","_blank")},style:{cursor:"pointer"}})})]}),children:(0,M.jsx)(va,{copyable:!0,children:t.pageId||"-"})}),t.description&&(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(ba,{children:t.description})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(ba,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的Messenger应用凭证，避免泄露"}),(0,M.jsx)("li",{children:"请妥善保存 验证口令 和 AppSecret，这些信息不应公开"}),(0,M.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,M.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,M.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个Messenger应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},Ea=function(e){console.log(e)},Sa=[{key:"detail",label:"应用详情",children:(0,M.jsx)(Ca,{})}],Aa=function(e){e.type;var n=(0,r.Z)().contentStyle,t=(0,w.useState)(Sa),a=o()(t,2),s=a[0],i=a[1];return(0,w.useEffect)((function(){var e=[].concat(Sa);i(e)}),[]),(0,M.jsx)("div",{style:n,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:s,onChange:Ea})})},Pa=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=(t.leftSiderWidth,t.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)(xa,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)(Aa,{type:n})})]})};function Ia(e){return Ta.apply(this,arguments)}function Ta(){return(Ta=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ra(e){return La.apply(this,arguments)}function La(){return(La=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wa(e){return Ba.apply(this,arguments)}function Ba(){return(Ba=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fa(e){return Ua.apply(this,arguments)}function Ua(){return(Ua=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function za(e){return Da.apply(this,arguments)}function Da(){return(Da=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qa(e){return Oa.apply(this,arguments)}function Oa(){return(Oa=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Na(){return Ha.apply(this,arguments)}function Ha(){return(Ha=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,A.request)("/api/v1/meta/app/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Va=["token"],_a="WEBHOOK",Ka="MESSENGER",Ja="INSTAGRAM",Xa="WHATSAPP",Ya=function(e){var n=e.isEdit,t=e.instagram,r=e.open,a=e.loading,s=void 0!==a&&a,i=e.onClose,l=e.onSubmit,u=fe.A.useForm(),d=o()(u,1)[0],p=((0,oe.Z)().translateStringTranct,(0,Y.u)((function(e){return e.currentOrg}))),f=(0,w.useState)(!1),h=o()(f,2),m=h[0],g=h[1],v=pe(),y=v.workgroups,j=v.getDefaultUid,k=v.getWorkgroupOptions,Z=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=e.token,t=la()(e,Va),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==p?void 0:p.uid});console.log("submit",r),l(r)})).catch((function(){g(!1)}))};(0,w.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||Ja,appId:null==t?void 0:t.appId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.verifyToken,pageId:null==t?void 0:t.pageId,pageAccessToken:null==t?void 0:t.pageAccessToken,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=j();d.setFieldsValue({name:"",description:"",type:Ja,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,y,j]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(xe.Z,{title:"Meta应用配置",onClose:i,open:r,width:600,extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{onClick:i,children:"取消"}),(0,M.jsx)(b.ZP,{type:"primary",onClick:Z,loading:m||s,children:m||s?"保存中...":"保存"})]}),children:(0,M.jsxs)(fe.A,{form:d,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,M.jsx)(he.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,M.jsx)(me.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:_a},{label:"Messenger",value:Ka},{label:"Instagram",value:Ja},{label:"Whatsapp",value:Xa}],fieldProps:{defaultValue:_a},rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,M.jsx)(b.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),F.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,M.jsx)(he.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,M.jsx)(he.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,M.jsx)(me.Z,{label:"客服工作组",name:"workgroupUid",options:k(),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,M.jsx)(ge.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,M.jsx)(ge.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,M.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Ga=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{instagramResult:{data:{content:[]}},currentInstagram:{uid:"",nickname:"",avatar:"",description:""},insertInstagram:function(n){e((function(e){e.instagramResult.data.content.unshift(n)}))},updateInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Instagram with uid ".concat(n.uid," not found."))}))},deleteInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Instagram with uid ".concat(n.uid," not found."))}))},setInstagramResult:function(t){var r;(e({instagramResult:t}),""===n().currentInstagram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentInstagram:t.data.content[0]}))},setCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().instagramResult),{},{data:{content:s}});e({instagramResult:o,currentInstagram:t})}else console.warn("Instagram with the specified uid not found."),e({currentInstagram:t})},refreshCurrentInstagram:function(n){e((function(e){e.currentInstagram=c()(c()({},e.currentInstagram),n);var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({instagramResult:c()(c()({},n().instagramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Instagram not found in cache:",t),n().currentInstagram.uid===t&&e({currentInstagram:{uid:""}})},deleteInstagramCache:function(){return e({},!0)}}})),{name:p.S6e}))),Qa=B()(B()(B()(B()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),$a=function(e){var n=e.type,t=(0,A.useIntl)(),r=(0,w.useRef)(!1),a=(0,oe.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,l=(0,w.useState)(!1),u=o()(l,2),d=u[0],p=u[1],f=(0,w.useState)(!1),h=o()(f,2),m=h[0],g=h[1],j=(0,w.useState)(!1),k=o()(j,2),C=k[0],E=k[1],S=(0,w.useState)(""),P=o()(S,2),I=P[0],R=P[1],W=(0,Y.u)((function(e){return e.currentOrg})),B=(0,w.useState)(null),U=o()(B,2),z=U[0],D=U[1],q=Ga((function(e){return{instagramResult:e.instagramResult,currentInstagram:e.currentInstagram,setInstagramResult:e.setInstagramResult,insertInstagram:e.insertInstagram,setCurrentInstagram:e.setCurrentInstagram,deleteCurrentInstagram:e.deleteCurrentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),O=q.instagramResult,N=q.currentInstagram,H=q.setInstagramResult,V=q.insertInstagram,_=q.setCurrentInstagram,K=q.deleteCurrentInstagram,J=q.refreshCurrentInstagram,X=re.Z.useModal(),ie=o()(X,2),le=ie[0],ce=ie[1],ue=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete instagram",n),F.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,za(n);case 4:r=e.sent,console.log("delete instagram response",r),200===r.code?(F.yw.destroy(),F.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),K(n.uid)):(F.yw.destroy(),F.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=L()(T()().mark((function e(){var a,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,F.yw.loading(t.formatMessage({id:"loading"})),s={pageNumber:0,pageSize:50,type:n,orgUid:null==W?void 0:W.uid,searchText:(null==I||null===(a=I.trim)||void 0===a?void 0:a.call(I))||void 0},e.next=8,Ia(s);case 8:o=e.sent,console.log("getInstagram response",o,s),200===o.code?(F.yw.destroy(),H(o)):(F.yw.destroy(),F.yw.error(o.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){var e=function(e){g(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]),(0,w.useEffect)((function(){de()}),[I,null==W?void 0:W.uid]);var pe=function(){var e=L()(T()().mark((function e(n){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),E(!0),e.prev=2,!m){e.next=8;break}return e.next=6,he(n);case 6:e.next=10;break;case 8:return e.next=10,fe(n);case 10:return e.prev=10,E(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),fe=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.yw.loading(t.formatMessage({id:"creating"})),e.next=3,Wa(n);case 3:r=e.sent,F.yw.destroy(),console.log("handleCreateInstagram response:",r),200===r.code?(V(null==r?void 0:r.data),_(null==r?void 0:r.data),p(!1),F.yw.success(t.formatMessage({id:"common.created"}))):F.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),he=function(){var e=L()(T()().mark((function e(n){var r;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==N?void 0:N.uid,F.yw.loading(t.formatMessage({id:"updating"})),e.next=4,Fa(n);case 4:r=e.sent,F.yw.destroy(),console.log("handleUpdateInstagram response:",r),200===r.code?(_(null==r?void 0:r.data),p(!1),F.yw.success(t.formatMessage({id:"common.updated"}))):F.yw.error(r.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=L()(T()().mark((function e(n,r){var a,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(n.uid),e.prev=1,e.next=4,Fa({uid:n.uid,enabled:r});case 4:a=e.sent,console.log("updateInstagram enabled response",a),200===a.code?(F.yw.success(t.formatMessage({id:r?"instagram.app.toggle.success.enabled":"instagram.app.toggle.success.disabled"})),null!=O&&null!==(s=O.data)&&void 0!==s&&s.content&&(o=O.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:r}):e})),H(c()(c()({},O),{},{data:c()(c()({},O.data),{},{content:o})}))),(null==N?void 0:N.uid)===n.uid&&J&&J(null==a?void 0:a.data)):F.yw.error("".concat(t.formatMessage({id:"instagram.app.toggle.error.operation"}),": ").concat(a.message||t.formatMessage({id:"instagram.app.toggle.error.unknown"}))),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),F.yw.error("".concat(t.formatMessage({id:"instagram.app.toggle.error.exception"}),": ").concat(e.t0 instanceof Error?e.t0.message:t.formatMessage({id:"instagram.app.toggle.error.unknown"})));case 12:return e.prev=12,D(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ae.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,M.jsxs)(ae.Z,{gap:"small",align:"center",children:[(0,M.jsx)(b.ZP,{type:"primary",size:"small",icon:(0,M.jsx)(Q.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)($.Z,{}),onClick:de,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==N?void 0:N.uid)&&(0,M.jsx)(se.Z,{menu:{items:[{key:"edit",icon:(0,M.jsx)(ee.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==N.enabled?(0,M.jsx)(Kn.Z,{}):(0,M.jsx)(Jn.Z,{}),label:!1!==N.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return me(N,!1===N.enabled)}},{key:"delete",icon:(0,M.jsx)(ne.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){le.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){ue(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(N)}}]},children:(0,M.jsx)(b.ZP,{size:"small",icon:(0,M.jsx)(te.Z,{})})})]}),(0,M.jsx)("div",{style:{margin:5},children:(0,M.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,M.jsx)(v.Z,{placeholder:t.formatMessage({id:"search",defaultMessage:"搜索"}),value:I,onChange:function(e){return R(e.target.value)},onPressEnter:function(e){e.preventDefault(),de()},allowClear:!0}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Z.Z,{}),"aria-label":t.formatMessage({id:"common.search",defaultMessage:"搜索"}),onClick:function(){return de()}})]})}),(0,M.jsx)(y.Z,{itemLayout:"horizontal",dataSource:O.data.content,renderItem:function(e,n){return(0,M.jsx)(y.Z.Item,{style:(null==N?void 0:N.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){_(e)},children:(0,M.jsx)(y.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,M.jsxs)("span",{style:{color:"#1677ff"},children:["(",Qa[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,M.jsx)(Xn.Z,{spinning:z===(null==e?void 0:e.uid),size:"small",children:(0,M.jsx)(Ae.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:t.formatMessage({id:!1!==(null==e?void 0:e.enabled)?"common.enabled":"common.disabled"})})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,M.jsx)(Ya,{isEdit:m,open:d,loading:C,instagram:N,onClose:function(){p(!1)},onSubmit:pe}),ce]})},es=Ce.Z.Text,ns=Ce.Z.Paragraph,ts=B()(B()(B()(B()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),rs=B()(B()(B()(B()({},p.Iap,(0,M.jsx)(De.Z,{})),p.Ff2,(0,M.jsx)(Le.Z,{})),p.cRk,(0,M.jsx)(We.Z,{})),p.SbP,(0,M.jsx)(Be.Z,{})),as="appSecret",ss="verifyToken",os="accessToken",is="pageAccessToken",ls=function(){var e=(0,A.useIntl)(),n=Ga((function(e){return{currentInstagram:e.currentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),t=n.currentInstagram,r=n.refreshCurrentInstagram,a=(0,w.useState)(B()(B()(B()(B()({},as,!1),ss,!1),os,!1),is,!1)),s=o()(a,2),i=s[0],l=s[1],u=(0,w.useState)(!1),d=o()(u,2),p=(d[0],d[1],(0,w.useState)(!1)),f=o()(p,2),h=f[0],m=f[1],g=(0,w.useState)(!1),v=o()(g,2),y=v[0],j=v[1],Z=(0,w.useState)(!1),C=o()(Z,2),E=C[0],S=C[1],P=(0,w.useState)(!1),I=o()(P,2),R=I[0],W=I[1],U=(0,w.useState)(null),z=o()(U,2),D=z[0],q=z[1],O=(0,w.useState)(!1),N=o()(O,2),H=N[0],V=N[1],_=function(e){l((function(n){return c()(c()({},n),{},B()({},e,!n[e]))}))},K=function(e,n){return e?n?e:"******":"-"},J=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),e.prev=1,e.next=4,Na();case 4:n=e.sent,console.log("checkInstagramServiceReachable response",n),200===n.code?q(null==n?void 0:n.data):(q(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),q(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,V(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){J()}),[]);var X=function(){var n=L()(T()().mark((function n(){var a;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"instagram.app.refresh.token.error.incomplete"})),n.abrupt("return");case 3:return m(!0),n.prev=4,n.next=7,qa({uid:t.uid});case 7:a=n.sent,console.log("refreshAccessTokenInstagram response",a),200===a.code?(F.yw.success(e.formatMessage({id:"instagram.app.refresh.token.success"})),r&&r(null==a?void 0:a.data),Y()):F.yw.error("".concat(e.formatMessage({id:"instagram.app.refresh.token.error.failed"}),": ").concat(a.message||e.formatMessage({id:"instagram.app.toggle.error.unknown"}))),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error("".concat(e.formatMessage({id:"instagram.app.refresh.token.error.exception"}),": ").concat(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"instagram.app.toggle.error.unknown"})));case 15:return n.prev=15,m(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(){return n.apply(this,arguments)}}(),Y=function(){var n=L()(T()().mark((function n(){var a,s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"instagram.app.refresh.error.incomplete"})),n.abrupt("return");case 3:return j(!0),n.prev=4,n.next=7,Ra({uid:t.uid});case 7:a=n.sent,console.log("queryInstagramByUid refresh detail",a),200===a.code?(s=null==a?void 0:a.data,F.yw.success(e.formatMessage({id:"instagram.app.refresh.success"})),r&&r(s)):F.yw.error("".concat(e.formatMessage({id:"instagram.app.refresh.error.failed"}),": ").concat(a.message||e.formatMessage({id:"instagram.app.toggle.error.unknown"}))),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error("".concat(e.formatMessage({id:"instagram.app.refresh.error.exception"}),": ").concat(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"instagram.app.toggle.error.unknown"})));case 15:return n.prev=15,j(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(){return n.apply(this,arguments)}}(),G=function(){var n=L()(T()().mark((function n(a){var s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"instagram.app.toggle.error.incomplete"})),n.abrupt("return");case 3:return S(!0),n.prev=4,n.next=7,Fa({uid:t.uid,enabled:a});case 7:s=n.sent,console.log("updateInstagram enabled response",s),200===s.code?(F.yw.success(e.formatMessage({id:a?"instagram.app.toggle.success.enabled":"instagram.app.toggle.success.disabled"})),r&&r(null==s?void 0:s.data)):F.yw.error("".concat(e.formatMessage({id:"instagram.app.toggle.error.operation"}),": ").concat(s.message||e.formatMessage({id:"instagram.app.toggle.error.unknown"}))),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error("".concat(e.formatMessage({id:"instagram.app.toggle.error.exception"}),": ").concat(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"instagram.app.toggle.error.unknown"})));case 15:return n.prev=15,S(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(e){return n.apply(this,arguments)}}(),Q=function(){var n=L()(T()().mark((function n(a){var s;return T()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.uid){n.next=3;break}return F.yw.error(e.formatMessage({id:"debug.toggle.error.incomplete"})),n.abrupt("return");case 3:return W(!0),n.prev=4,n.next=7,Fa({uid:t.uid,debug:a});case 7:s=n.sent,console.log("updateInstagram debug response",s),200===s.code?(F.yw.success(e.formatMessage({id:a?"debug.toggle.success.enabled":"debug.toggle.success.disabled"})),r&&r(null==s?void 0:s.data)):F.yw.error("".concat(e.formatMessage({id:"instagram.app.toggle.error.operation"}),": ").concat(s.message||e.formatMessage({id:"instagram.app.toggle.error.unknown"}))),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(4),F.yw.error("".concat(e.formatMessage({id:"instagram.app.toggle.error.exception"}),": ").concat(n.t0 instanceof Error?n.t0.message:e.formatMessage({id:"instagram.app.toggle.error.unknown"})));case 15:return n.prev=15,W(!1),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[4,12,15,18]])})));return function(e){return n.apply(this,arguments)}}();return null!=t&&t.uid?(0,M.jsxs)(Ee.Z,{title:(0,M.jsxs)(x.Z,{children:[rs[t.type]||(0,M.jsx)(Le.Z,{}),(0,M.jsx)("span",{children:t.name||"Instagram应用详情"}),(0,M.jsx)(Ae.Z,{color:"blue",children:ts[t.type]||t.type}),(0,M.jsx)(Ae.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==D&&(0,M.jsx)(Ae.Z,{color:D?"success":"error",icon:D?(0,M.jsx)(Jn.Z,{}):(0,M.jsx)(Kn.Z,{}),children:D?"服务可用":"服务不可用"}),H&&(0,M.jsx)(Ae.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(ee.Z,{}),onClick:function(){var e=new CustomEvent("instagram-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Jn.Z,{}),onClick:J,loading:H,type:"default",children:"检查服务"}),(0,M.jsx)(b.ZP,{icon:(0,M.jsx)($.Z,{}),onClick:Y,loading:y,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[!1===D&&(0,M.jsx)("div",{style:{marginBottom:16},children:(0,M.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Kn.Z,{}),(0,M.jsx)("strong",{children:"服务不可用警告："}),"Instagram服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,M.jsxs)(Pe.Z,{bordered:!0,column:1,children:[(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,M.jsx)(es,{copyable:!0,children:t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,M.jsx)(Ae.Z,{color:"blue",children:ts[t.type]||t.type})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:!1!==t.enabled,onChange:G,loading:E,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,M.jsx)(es,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"调试模式",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(Ie.Z,{checked:t.debug||!1,onChange:Q,loading:R,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,M.jsx)(es,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,M.jsx)(Pe.Z.Item,{label:"AppID",children:(0,M.jsx)(es,{copyable:!0,children:t.appId})}),(0,M.jsx)(Pe.Z.Item,{label:"AppSecret",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(es,{copyable:!!i[as]&&{text:t.appSecret||""},children:K(t.appSecret,i[as])}),(0,M.jsx)(Te.Z,{title:i[as]?"隐藏AppSecret":"显示AppSecret",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[as]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return _(as)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"回调网址",children:(0,M.jsx)(es,{copyable:!0,children:(0,k.kG)()+"/meta/webhooks/"+t.uid})}),(0,M.jsx)(Pe.Z.Item,{label:"验证口令",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(es,{copyable:!!i[ss]&&{text:t.verifyToken||""},children:K(t.verifyToken,i[ss])}),(0,M.jsx)(Te.Z,{title:i[ss]?"隐藏Verify Token":"显示Verify Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[ss]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return _(ss)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"Page Access Token",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(es,{copyable:!!i[is]&&{text:t.pageAccessToken||""},children:K(t.pageAccessToken,i[is])}),(0,M.jsx)(Te.Z,{title:i[is]?"隐藏Page Access Token":"显示Page Access Token",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[is]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return _(is)},size:"small"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"Page ID",children:(0,M.jsx)(es,{copyable:!0,children:t.pageId||"-"})}),(0,M.jsx)(Pe.Z.Item,{label:"AccessToken",children:(0,M.jsxs)(x.Z,{children:[(0,M.jsx)(es,{copyable:!!i[os]&&{text:t.accessToken||""},children:K(t.accessToken,i[os])}),(0,M.jsx)(Te.Z,{title:i[os]?"隐藏AccessToken":"显示AccessToken",children:(0,M.jsx)(b.ZP,{type:"text",icon:i[os]?(0,M.jsx)(ze.Z,{}):(0,M.jsx)(De.Z,{}),onClick:function(){return _(os)},size:"small"})}),(0,M.jsx)(Te.Z,{title:"刷新AccessToken",children:(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(qe.Z,{}),onClick:X,size:"small",loading:h,children:"刷新Token"})})]})}),(0,M.jsx)(Pe.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Ne()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,M.jsx)(ns,{children:t.description})}),(0,M.jsx)(Pe.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,M.jsx)(Re.Z,{}),(0,M.jsx)(Ce.Z.Title,{level:5,children:"安全说明"}),(0,M.jsx)(ns,{children:(0,M.jsxs)("ul",{children:[(0,M.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,M.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,M.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,M.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,M.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,M.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,M.jsx)(Ee.Z,{variant:"borderless",title:e.formatMessage({id:"instagram.app.detail"}),extra:(0,M.jsx)(b.ZP,{icon:(0,M.jsx)(Ue.Z,{}),onClick:function(){return window.open((0,k.V)()+"/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),children:(0,M.jsx)(Se.Z,{description:"请先在左侧列表选择一个Instagram应用",image:Se.Z.PRESENTED_IMAGE_SIMPLE})})},cs=function(e){console.log(e)},us=[{key:"detail",label:"应用详情",children:(0,M.jsx)(ls,{})}],ds=function(e){e.type;var n=(0,r.Z)().contentStyle,t=(0,w.useState)(us),a=o()(t,2),s=a[0],i=a[1];return(0,w.useEffect)((function(){var e=[].concat(us);i(e)}),[]),(0,M.jsx)("div",{style:n,children:(0,M.jsx)(S.Z,{defaultActiveKey:"agent",items:s,onChange:cs})})},ps=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,o=(t.leftSiderWidth,t.contentStyle);return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:s,children:(0,M.jsx)($a,{type:n})}),(0,M.jsx)(a.Z.Panel,{style:o,children:(0,M.jsx)(ds,{type:n})})]})},fs=t(60224),hs=t(56862),ms=t(20480),gs=t(55510),xs=t(56482),vs=t(57181),bs=t(98907),ys=t(80106),js=t(1395),ws=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{unifiedResult:{data:{content:[]}},currentUnified:{uid:"",nickname:"",avatar:"",description:"",orgUid:""},insertUnified:function(n){e((function(e){e.unifiedResult.data.content.unshift(n)}))},updateUnified:function(n){e((function(e){var t=e.unifiedResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Unified with uid ".concat(n.uid," not found."))}))},deleteUnified:function(n){e((function(e){var t=e.unifiedResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Unified with uid ".concat(n.uid," not found."))}))},setUnifiedResult:function(t){var r;(e({unifiedResult:t}),""===n().currentUnified.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentUnified:t.data.content[0]}))},setCurrentUnified:function(t){var r=n().unifiedResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),o=c()(c()({},n().unifiedResult),{},{data:{content:s}});e({unifiedResult:o,currentUnified:t})}else console.warn("Unified with the specified uid not found."),e({currentUnified:t})},deleteCurrentUnified:function(t){var r=n().unifiedResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({unifiedResult:c()(c()({},n().unifiedResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Unified not found in cache:",t),n().currentUnified.uid===t&&e({currentUnified:{uid:"",orgUid:""}})},deleteUnifiedCache:function(){return e({},!0)}}})),{name:p.jlI}))),ks=t(78112),Zs=t(7358),Ms=t(94468),Cs=function(e){var n,t,r=e.form,a=e.config,s=e.showLang,o=e.setShowLang,i=e.showTheme,l=e.setShowTheme,u=(e.lang,e.setLang),d=e.mode,p=e.setMode,f=e.updateConfig,h=e.generateConfigCode,m=e.handleCopy,g=(0,A.useIntl)();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(ge.Z,{name:"rightPlacement",label:g.formatMessage({id:"channel.web.position"}),tooltip:g.formatMessage({id:"channel.web.position.tooltip"}),fieldProps:{checked:"bottom-right"===a.placement}}),(0,M.jsx)(me.Z,{name:"buttonColor",width:"md",label:g.formatMessage({id:"channel.web.button.color"}),options:[{label:g.formatMessage({id:"channel.web.button.color.blue"}),value:"#0066FF"},{label:g.formatMessage({id:"channel.web.button.color.green"}),value:"#52c41a"},{label:g.formatMessage({id:"channel.web.button.color.red"}),value:"#ff4d4f"},{label:g.formatMessage({id:"channel.web.button.color.yellow"}),value:"#faad14"},{label:g.formatMessage({id:"channel.web.button.color.purple"}),value:"#722ed1"}],fieldProps:{value:null===(n=a.theme)||void 0===n?void 0:n.backgroundColor,onChange:function(e){f({theme:c()(c()({},a.theme),{},{textColor:"#ffffff",backgroundColor:e})}),r.setFieldsValue({configText:h(c()(c()({},a),{},{theme:c()(c()({},a.theme),{},{textColor:"#ffffff",backgroundColor:e})}))})}},addonAfter:(0,M.jsx)(Ms.Z,{value:null===(t=a.theme)||void 0===t?void 0:t.backgroundColor,onChange:function(e){var n=e.toHexString();f({theme:c()(c()({},a.theme),{},{backgroundColor:n})}),r.setFieldsValue({buttonColor:n,configText:h(c()(c()({},a),{},{theme:c()(c()({},a.theme),{},{backgroundColor:n})}))})}})}),(0,M.jsx)(bs.Z,{name:"showBubble",width:"xl",tooltip:g.formatMessage({id:"channel.web.show.bubble.tooltip"}),label:g.formatMessage({id:"channel.web.show.bubble"}),fieldProps:{onChange:function(e){var n=e.target.checked;f({bubbleConfig:c()(c()({},a.bubbleConfig),{},{show:n})}),r.setFieldsValue({configText:h(c()(c()({},a),{},{bubbleConfig:c()(c()({},a.bubbleConfig),{},{show:n})}))})}}}),(0,M.jsx)(bs.Z,{name:"showLang",width:"xl",tooltip:g.formatMessage({id:"channel.web.enable.multilang.tooltip"}),label:g.formatMessage({id:"channel.web.enable.multilang"}),fieldProps:{checked:s,onChange:function(e){var n=e.target.checked;o(n),n||u("zh-cn")}}}),s&&(0,M.jsx)(me.Z,{name:"language",width:"md",label:g.formatMessage({id:"channel.web.select.language"}),options:[{label:g.formatMessage({id:"channel.web.lang.zh_cn"}),value:"zh-cn"},{label:g.formatMessage({id:"channel.web.lang.zh_tw"}),value:"zh-tw"},{label:g.formatMessage({id:"channel.web.lang.en"}),value:"en"}],fieldProps:{onChange:function(e){return u(e)}}}),(0,M.jsx)(bs.Z,{name:"showTheme",width:"xl",tooltip:g.formatMessage({id:"channel.web.enable.theme.tooltip"}),label:g.formatMessage({id:"channel.web.enable.theme"}),fieldProps:{checked:i,onChange:function(e){var n=e.target.checked;l(n),n||p("system")}}}),i&&(0,M.jsx)(me.Z,{name:"theme",width:"md",label:g.formatMessage({id:"channel.web.theme.select"}),options:[{label:g.formatMessage({id:"channel.web.theme.follow.system"}),value:"system"},{label:g.formatMessage({id:"channel.web.theme.light"}),value:"light"},{label:g.formatMessage({id:"channel.web.theme.dark"}),value:"dark"}],fieldProps:{value:d,onChange:p}}),(0,M.jsx)(dn.Z,{name:"configText",width:"xl",label:g.formatMessage({id:"channel.web.code.embed"}),tooltip:g.formatMessage({id:"channel.web.code.embed.desc"}),fieldProps:{autoSize:{minRows:15,maxRows:25},readOnly:!0}}),(0,M.jsxs)(x.Z,{direction:"horizontal",style:{width:"100%",marginTop:10,marginBottom:10},children:[(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Zs.Z,{}),onClick:m,children:g.formatMessage({id:"channel.web.copy.code"})}),(0,M.jsx)(b.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.showChat()},children:g.formatMessage({id:"channel.web.show.chat"})}),(0,M.jsx)(b.ZP,{type:"primary",onClick:function(){var e;null===(e=window.bytedesk)||void 0===e||e.hideChat()},children:g.formatMessage({id:"channel.web.hide.chat"})})]})]})},Es=t(3340),Ss=function(e){var n=e.codeFullUrl,t=e.handleCopyFullUrl,r=e.openFullUrl,a=e.showQRCode,s=(0,A.useIntl)();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(dn.Z,{name:"codeFullUrl",width:"xl",label:s.formatMessage({id:"channel.web.code.fullscreen"}),tooltip:s.formatMessage({id:"channel.web.code.fullscreen.desc"}),fieldProps:{autoSize:{minRows:2,maxRows:5},readOnly:!0,value:n}}),(0,M.jsxs)(x.Z,{direction:"horizontal",style:{width:"100%",marginBottom:10},children:[(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Zs.Z,{}),onClick:t,children:s.formatMessage({id:"channel.web.copy.fullscreen"})}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(kn.Z,{}),onClick:r,children:s.formatMessage({id:"channel.web.open.fullscreen"})}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Es.Z,{}),onClick:function(){return a("full")},children:s.formatMessage({id:"channel.web.generate.qrcode",defaultMessage:"生成二维码"})})]})]})},As=function(e){var n=e.codeFrameUrl,t=e.handleCopyFrameUrl,r=e.openFrameUrl,a=e.showQRCode,s=(0,A.useIntl)();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(dn.Z,{name:"codeFrameUrl",width:"xl",label:s.formatMessage({id:"channel.web.code.frame"}),tooltip:s.formatMessage({id:"channel.web.code.frame.desc"}),fieldProps:{autoSize:{minRows:2,maxRows:5},readOnly:!0,value:n}}),(0,M.jsxs)(x.Z,{direction:"horizontal",style:{width:"100%"},children:[(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Zs.Z,{}),onClick:t,children:s.formatMessage({id:"channel.web.copy.frame"})}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(kn.Z,{}),onClick:r,children:s.formatMessage({id:"channel.web.open.frame"})}),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Es.Z,{}),onClick:function(){return a("frame")},children:s.formatMessage({id:"channel.web.generate.qrcode",defaultMessage:"生成二维码"})})]})]})},Ps=t(61107),Is=t(19755),Ts=function(e){var n=e.visible,t=e.qrcodeType,r=e.codeFullUrl,a=e.codeFullTicketUrl,s=e.codeFrameUrl,o=e.onClose,i=(0,A.useIntl)();return(0,M.jsx)(re.Z,{title:i.formatMessage({id:"channel.web.qrcode.title",defaultMessage:"客服二维码"}),open:n,onCancel:o,footer:[(0,M.jsx)(b.ZP,{onClick:o,children:i.formatMessage({id:"common.close",defaultMessage:"关闭"})},"close"),(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(Ps.Z,{}),onClick:function(){var e,n=null===(e=document.getElementById("bytedesk-qrcode-canvas"))||void 0===e?void 0:e.querySelector("canvas");if(n){var r=n.toDataURL(),a=document.createElement("a");a.download="bytedesk-".concat(t,"-qrcode.png"),a.href=r,document.body.appendChild(a),a.click(),document.body.removeChild(a),F.yw.success(i.formatMessage({id:"channel.web.qrcode.download.success"}))}},children:i.formatMessage({id:"channel.web.qrcode.download",defaultMessage:"下载二维码"})},"download")],width:400,centered:!0,children:(0,M.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},id:"bytedesk-qrcode-canvas",children:[(0,M.jsx)(Is.Z,{value:function(){switch(t){case"ticket":return a;case"full":default:return r;case"frame":return s}}(),size:280,style:{margin:"0 auto"},errorLevel:"H"}),(0,M.jsx)("div",{style:{marginTop:10},children:i.formatMessage({id:"channel.web.qrcode.scan",defaultMessage:"扫描二维码咨询客服"})})]})})},Rs=function(e){var n,t,r,a,s,i,l,u,f=e.type,h=fe.A.useForm(),m=o()(h,1)[0],g=(0,vs.M)(),x=g.config,v=g.updateConfig,b=(0,Y.u)((function(e){return e.currentOrg})),y=(0,ys.V)((function(e){return e.currentRobot})),j=(0,js.E)((function(e){return e.currentAgent})),Z=(0,ie.$)((function(e){return e.currentWorkgroup})),C=ws((function(e){return e.currentUnified})),E=(0,w.useState)(!1),P=o()(E,2),I=P[0],R=P[1],W=(0,w.useState)(!1),B=o()(W,2),U=B[0],z=B[1],D=(0,w.useState)(!1),q=o()(D,2),O=q[0],N=q[1],H=(0,w.useState)("zh-cn"),V=o()(H,2),_=V[0],K=V[1],J=(0,w.useState)("system"),X=o()(J,2),G=X[0],Q=X[1],$=(0,A.useIntl)(),ee=(0,w.useState)(!1),ne=o()(ee,2),te=ne[0],re=ne[1],ae=(0,w.useState)("full"),se=o()(ae,2),oe=se[0],le=se[1],ce=(0,w.useMemo)((function(){return f===p._X4?{chatType:p.ACv,chatSid:y.uid}:f===p.Njn?{chatType:p._0X,chatSid:j.uid}:f===p.aZD?{chatType:p.I$6,chatSid:Z.uid}:f===p.RB4?{chatType:p.iRZ,chatSid:C.uid}:{chatType:p.ACv,chatSid:""}}),[f,y,j,Z,C]),ue=ce.chatType,de=ce.chatSid;(0,w.useEffect)((function(){var e,n;null!=b&&b.uid&&ue&&de&&v({chatConfig:{org:null==b?void 0:b.uid,t:ue,sid:de},theme:{backgroundColor:null===(e=x.theme)||void 0===e?void 0:e.backgroundColor,textColor:null===(n=x.theme)||void 0===n?void 0:n.textColor}})}),[null==b?void 0:b.uid,ue,de,null===(n=x.theme)||void 0===n?void 0:n.backgroundColor,null===(t=x.theme)||void 0===t?void 0:t.textColor]);var pe=function(e){var n,t,r=e+"?".concat(p.I3Y,"=").concat(null==b?void 0:b.uid)+"&".concat(p.ZfG,"=").concat(ue)+"&".concat(p.RI9,"=").concat(de);(I&&(r+="&".concat(p.lHH,"=").concat(_)),U)&&(r+="&".concat(p.N1q,"=").concat(G)+"&".concat(p.spX,"=").concat(null===(n=x.theme)||void 0===n?void 0:n.backgroundColor)+"&".concat(p.cW9,"=").concat(null===(t=x.theme)||void 0===t?void 0:t.textColor));return O&&(r+="&draft=1"),r+"&"},he=(0,w.useMemo)((function(){return pe((0,k.Cn)())}),[null==b?void 0:b.uid,ue,de,I,_,U,G,null===(r=x.theme)||void 0===r?void 0:r.backgroundColor,null===(a=x.theme)||void 0===a?void 0:a.textColor,O]),me=(0,w.useMemo)((function(){var e=((0,k.Cn)()||"").replace(/\/$/,"")+"/ticket";return pe(e)}),[null==b?void 0:b.uid,ue,de,I,_,U,G,null===(s=x.theme)||void 0===s?void 0:s.backgroundColor,null===(i=x.theme)||void 0===i?void 0:i.textColor,O]),ge=(0,w.useMemo)((function(){return pe((0,k.Z$)())}),[null==b?void 0:b.uid,ue,de,I,_,U,G,null===(l=x.theme)||void 0===l?void 0:l.backgroundColor,null===(u=x.theme)||void 0===u?void 0:u.textColor,O]),xe=(0,w.useCallback)((function(e,n){var t,r,a,s,o,i,l,c,u,d,p=$.formatMessage({id:"channel.web.default.needhelp",defaultMessage:"需要帮助么"}),f=$.formatMessage({id:"channel.web.default.bubble.subtitle",defaultMessage:"点击我，与我对话"});return'\x3c!-- bytedesk.com --\x3e\n<script src="https://www.weiyuai.cn/embed/bytedesk-web.js"><\/script>\n<script>\n  const config = {\n    apiUrl: \''.concat(e.apiUrl||"https://api.weiyuai.cn","',\n    htmlUrl: '").concat(e.htmlUrl||"https://www.weiyuai.cn/chat","',\n    placement: '").concat(e.placement||"bottom-right","',\n    autoPopup: ").concat(e.autoPopup||!1,",\n    locale: '").concat(_,"',\n    inviteConfig: {\n      show: ").concat((null===(t=e.inviteConfig)||void 0===t?void 0:t.show)||!1,",\n      text: '").concat((null===(r=e.inviteConfig)||void 0===r?void 0:r.text)||p,"',\n    },\n    bubbleConfig: {\n      show: ").concat(null===(a=null===(s=e.bubbleConfig)||void 0===s?void 0:s.show)||void 0===a||a,",\n      icon: '").concat((null===(o=e.bubbleConfig)||void 0===o?void 0:o.icon)||"👋","',\n      title: '").concat((null===(i=e.bubbleConfig)||void 0===i?void 0:i.title)||p,"',\n      subtitle: '").concat((null===(l=e.bubbleConfig)||void 0===l?void 0:l.subtitle)||f,"'\n    },\n    theme: {\n      mode: '").concat(G,"',\n      backgroundColor: '").concat((null===(c=e.theme)||void 0===c?void 0:c.backgroundColor)||"#0066FF","',\n      textColor: '").concat((null===(u=e.theme)||void 0===u?void 0:u.textColor)||"#ffffff","'\n    },\n    window: {\n      width: '").concat((null===(d=e.window)||void 0===d?void 0:d.width)||380,"'\n    },\n    chatConfig: {\n      org: '").concat(null==b?void 0:b.uid,"',\n      t: '").concat(ue,"',\n      sid: '").concat(de,"'").concat(n?",\n      draft: true":"","\n    }\n  };\n  const bytedesk = new BytedeskWeb(config);\n  bytedesk.init();\n<\/script>")}),[de,ue,null==b?void 0:b.uid,$,_,G]),ve=(0,w.useCallback)((function(e){return xe(e,O)}),[xe,O]);(0,w.useEffect)((function(){var e,n;x&&(m.setFieldValue("codeFullUrl",he),m.setFieldValue("codeFullTicketUrl",me),m.setFieldValue("codeFrameUrl",ge),m.setFieldValue("buttonColor",null===(e=x.theme)||void 0===e?void 0:e.backgroundColor),m.setFieldValue("showBubble",null===(n=x.bubbleConfig)||void 0===n?void 0:n.show),m.setFieldsValue({rightPlacement:"bottom-right"===x.placement,configText:ve(x)}))}),[x,ge,me,he,m,ve]),(0,w.useEffect)((function(){x&&m.setFieldsValue({configText:ve(x)})}),[x,m,ve,_,G]);var be=function(){var e=L()(T()().mark((function e(){var n;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.getFieldValue("configText"),e.next=3,(0,ks.TE)(n);case 3:e.sent.success?F.yw.success($.formatMessage({id:"channel.web.copy.success"})):F.yw.error($.formatMessage({id:"channel.web.copy.error"}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(e){le(e),re(!0)},je=function(){var e=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ks.TE)(he);case 2:e.sent.success?F.yw.success($.formatMessage({id:"channel.web.fullscreen.copy.success"})):F.yw.error($.formatMessage({id:"channel.web.copy.error"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=L()(T()().mark((function e(){return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ks.TE)(ge);case 2:e.sent.success?F.yw.success($.formatMessage({id:"channel.web.frame.copy.success"})):F.yw.error($.formatMessage({id:"channel.web.copy.error"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Ee.Z,{title:$.formatMessage({id:"channel.web.card.title",defaultMessage:"客服代码"}),children:(0,M.jsxs)(fe.A,{form:m,submitter:!1,onValuesChange:function(e,n){var t=n.rightPlacement?{placement:"bottom-right"}:{placement:"bottom-left"};v(t),m.setFieldsValue({configText:ve(c()(c()({},x),t))})},children:[(0,M.jsx)(bs.Z,{name:"draftEnabled",width:"xl",label:$.formatMessage({id:"channel.web.draft.test",defaultMessage:"灰度测试"}),tooltip:$.formatMessage({id:"channel.web.draft.test.tooltip",defaultMessage:"勾选后：链接会追加 draft=1；嵌入脚本 chatConfig 会增加 draft: true（用于测试草稿配置，不影响线上配置）"}),fieldProps:{checked:O,onChange:function(e){var n=e.target.checked;N(n),x&&m.setFieldsValue({configText:xe(x,n)})}}}),(0,M.jsx)(S.Z,{items:[{key:"embed",label:(0,M.jsxs)("span",{children:[(0,M.jsx)(ms.Z,{style:{marginRight:6}}),$.formatMessage({id:"channel.web.tab.embed",defaultMessage:"嵌入脚本"})]}),children:(0,M.jsx)(Cs,{form:m,config:x,showLang:I,setShowLang:R,showTheme:U,setShowTheme:z,lang:_,setLang:K,mode:G,setMode:Q,updateConfig:v,generateConfigCode:ve,handleCopy:be})},{key:"full",label:(0,M.jsxs)("span",{children:[(0,M.jsx)(gs.Z,{style:{marginRight:6}}),$.formatMessage({id:"channel.web.tab.fullscreen",defaultMessage:"全屏"})]}),children:(0,M.jsx)(Ss,{codeFullUrl:he,handleCopyFullUrl:je,openFullUrl:function(){window.open(he)},showQRCode:ye})}].concat(d()((p.aZD,[])),[{key:"frame",label:(0,M.jsxs)("span",{children:[(0,M.jsx)(xs.Z,{style:{marginRight:6}}),$.formatMessage({id:"channel.web.tab.frame",defaultMessage:"内嵌"})]}),children:(0,M.jsx)(As,{codeFrameUrl:ge,handleCopyFrameUrl:we,openFrameUrl:function(){window.open(ge)},showQRCode:ye})}])})]})}),(0,M.jsx)(Ts,{visible:te,qrcodeType:oe,codeFullUrl:he,codeFullTicketUrl:me,codeFrameUrl:ge,onClose:function(){return re(!1)}})]})},Ls=t(90080),Ws=t(34073),Bs=t(69174),Fs=t(67242),Us=function(e){var n=e.channel,t=(0,w.useRef)(!1),r=(0,oe.Z)().translateString,a=(0,A.useIntl)(),s=g((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),i=s.currentType,l=s.setCurrentType,c=(0,Y.u)((function(e){return e.currentOrg})),u=[{label:a.formatMessage({id:"channel.session.type.robot"}),value:p._X4},{label:a.formatMessage({id:"channel.session.type.agent"}),value:p.Njn},{label:a.formatMessage({id:"channel.session.type.workgroup"}),value:p.aZD}],d=(0,ys.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),f=d.robotResult,h=d.currentRobot,m=d.setRobotResult,v=d.setCurrentRobot,b=(0,w.useState)([]),y=o()(b,2),j=y[0],k=y[1],Z=(0,w.useState)(null==h?void 0:h.uid),C=o()(Z,2),E=C[0],S=C[1],P=(0,js.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),I=P.agentResult,R=P.currentAgent,W=P.setAgentResult,B=P.setCurrentAgent,U=(0,w.useState)([]),z=o()(U,2),D=z[0],q=z[1],O=(0,ie.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),N=O.workgroupResult,H=O.currentWorkgroup,V=O.setWorkgroupResult,_=O.setCurrentWorkgroup,K=(0,w.useState)(null==R?void 0:R.uid),J=o()(K,2),X=J[0],G=J[1],Q=(0,w.useState)(null==H?void 0:H.uid),$=o()(Q,2),ee=$[0],ne=$[1],te=(0,w.useState)([]),re=o()(te,2),ae=re[0],se=re[1],ce=function(){var e=L()(T()().mark((function e(){var n,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.current=!0,F.yw.loading(a.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:50,categoryUid:"",level:p.whQ,type:p.f4h,orgUid:null==c?void 0:c.uid,searchText:""},e.next=5,(0,hs.p0)(n);case 5:s=e.sent,Fs.Z.debug("queryRobotsByOrg: ",s),200===s.code?(F.yw.destroy(),m(s),(null==s?void 0:s.data.content.length)>0&&(v(null==s?void 0:s.data.content[0]),S(null==s?void 0:s.data.content[0].uid)),o=[],null==s||s.data.content.forEach((function(e){var n={label:r(e.nickname),value:e.uid};o.push(n)})),k(o)):(F.yw.destroy(),F.yw.error(s.message)),t.current=!1;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=L()(T()().mark((function e(){var n,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.current=!0,F.yw.loading(a.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:50,orgUid:null==c?void 0:c.uid},e.next=5,(0,fs._t)(n);case 5:s=e.sent,Fs.Z.debug("queryAgentsByOrg: ",s),200===s.code?(F.yw.destroy(),W(s),(null==s?void 0:s.data.content.length)>0&&(B(null==s?void 0:s.data.content[0]),G(null==s?void 0:s.data.content[0].uid)),o=[],null==s||s.data.content.forEach((function(e){var n={label:r(e.nickname),value:e.uid};o.push(n)})),q(o)):(F.yw.destroy(),F.yw.error(s.message)),t.current=!1;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=L()(T()().mark((function e(){var n,s,o;return T()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.current=!0,F.yw.loading(a.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:50,orgUid:null==c?void 0:c.uid},e.next=5,(0,le.LE)(n);case 5:s=e.sent,Fs.Z.debug("getWorkgroups",s),200===s.code?(F.yw.destroy(),V(s),(null==s?void 0:s.data.content.length)>0&&(_(null==s?void 0:s.data.content[0]),ne(null==s?void 0:s.data.content[0].uid)),o=[],null==s||s.data.content.forEach((function(e){var n={label:r(e.nickname),value:e.uid};o.push(n)})),se(o)):(F.yw.destroy(),F.yw.error(s.message)),t.current=!1;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){ce(),ue(),de()}),[i]);var pe=["web","npm"].includes((null==n?void 0:n.name)||"");return(0,M.jsxs)(x.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,M.jsx)(Ee.Z,{size:"small",title:a.formatMessage({id:"channel.session.object.select"}),children:(0,M.jsxs)(x.Z,{direction:"horizontal",size:"middle",align:"center",wrap:!0,children:[(0,M.jsx)(Ls.Z,{options:u,value:i,onChange:function(e){return n=e,Fs.Z.debug("type changed:".concat(n)),void l(n);var n}}),i===p._X4&&(null==h?void 0:h.uid)&&(0,M.jsx)(M.Fragment,{children:t.current?(0,M.jsx)(Ws.Z.Input,{active:!0,style:{width:360}}):null!=j&&j.length?(0,M.jsx)(Bs.Z,{style:{width:360},showSearch:!0,placeholder:a.formatMessage({id:"channel.session.select.robot"}),optionFilterProp:"label",value:E,options:j,onChange:function(e){var n;S(e);var t=null==f||null===(n=f.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.find((function(n){return n.uid===e}));t&&v(t)}}):(0,M.jsx)(Se.Z,{description:a.formatMessage({id:"channel.session.no.robot"})})}),i===p.Njn&&(null==R?void 0:R.uid)&&(0,M.jsx)(M.Fragment,{children:t.current?(0,M.jsx)(Ws.Z.Input,{active:!0,style:{width:360}}):null!=D&&D.length?(0,M.jsx)(Bs.Z,{style:{width:360},showSearch:!0,placeholder:a.formatMessage({id:"channel.session.select.agent"}),optionFilterProp:"label",value:X,options:D,onChange:function(e){var n;G(e);var t=null==I||null===(n=I.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.find((function(n){return n.uid===e}));t&&B(t)}}):(0,M.jsx)(Se.Z,{description:a.formatMessage({id:"channel.session.no.agent"})})}),i===p.aZD&&(null==H?void 0:H.uid)&&(0,M.jsx)(M.Fragment,{children:t.current?(0,M.jsx)(Ws.Z.Input,{active:!0,style:{width:360}}):null!=ae&&ae.length?(0,M.jsx)(Bs.Z,{style:{width:360},showSearch:!0,placeholder:a.formatMessage({id:"channel.session.select.workgroup"}),optionFilterProp:"label",value:ee,options:ae,onChange:function(e){var n;ne(e);var t=null==N||null===(n=N.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.find((function(n){return n.uid===e}));t&&_(t)}}):(0,M.jsx)(Se.Z,{description:a.formatMessage({id:"channel.session.no.workgroup"})})})]})}),pe&&("web"===(null==n?void 0:n.name)?(0,M.jsx)(Rs,{type:i}):null)]})},zs=t(4342),Ds=function(e){var n,t=e.platform,r=void 0===t?"react":t,a=(0,A.useIntl)(),s=(0,w.useState)(r),i=o()(s,2),l=i[0],c=i[1];return(0,M.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,M.jsx)(Re.Z,{orientation:"left",children:a.formatMessage({id:"install.guide.select.framework"})}),(0,M.jsx)(zs.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:l,onChange:function(e){c(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,M.jsx)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,M.jsx)(b.ZP,{type:"primary",icon:(0,M.jsx)(kn.Z,{}),href:(n=(0,k.V)()+"/docs/zh-CN/docs/channel/","".concat(n).concat("vanilla"===l?"web":l)),target:"_blank",children:a.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===l?"Web":l.charAt(0).toUpperCase()+l.slice(1)})})})]})},qs=function(e){var n=e.channel;return(0,M.jsxs)("div",{children:["web"===(null==n?void 0:n.name)&&(0,M.jsx)(Us,{channel:n}),"npm"===(null==n?void 0:n.name)&&(0,M.jsx)(Ds,{}),"app"===(null==n?void 0:n.name)&&(0,M.jsx)(Rn,{type:null==n?void 0:n.name}),"wechat"===(null==n?void 0:n.name)&&(0,M.jsx)(en,{type:null==n?void 0:n.name}),"messenger"===(null==n?void 0:n.name)&&(0,M.jsx)(Pa,{type:p.Ff2}),"instagram"===(null==n?void 0:n.name)&&(0,M.jsx)(ps,{type:p.cRk}),"whatsapp"===(null==n?void 0:n.name)&&(0,M.jsx)(Jr,{}),"telegram"===(null==n?void 0:n.name)&&(0,M.jsx)(er,{type:null==n?void 0:n.name}),"line"===(null==n?void 0:n.name)&&(0,M.jsx)(kr,{type:null==n?void 0:n.name}),"email"===(null==n?void 0:n.name)&&(0,M.jsx)(Tt,{type:null==n?void 0:n.name}),"douyin"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"baidu"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"weibo"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"pdd"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"jd"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"qianniu"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"doudian"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"telegram"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"facebook"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"line"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"shopify"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"lazada"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"wordpress"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"opencart"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"magento"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"prestashop"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"dify"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{}),"coze"===(null==n?void 0:n.name)&&(0,M.jsx)(P,{})]})},Os=function(){var e,n=(0,i.Z)().isDarkMode,t=(0,w.useState)(""),r=o()(t,2),a=r[0],s=r[1],l=(0,w.useState)([]),u=o()(l,2),p=u[0],f=u[1],h=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),m=h.currentChannel,x=h.setCurrentChannel;(0,w.useEffect)((function(){m&&v(m)}),[m]);var v=function(e){var n=e.name;-1===p.findIndex((function(e){return e.key===n}))&&f([].concat(d()(p),[{label:e.nickname,key:n,children:(0,M.jsx)(qs,{channel:e}),channelInfo:e,closable:!0}])),s(n)},b=null===(e=p.find((function(e){return e.key===a})))||void 0===e?void 0:e.children;return(0,M.jsxs)("div",{className:"channel-tab-container",children:[(0,M.jsx)("div",{className:"channel-tab-sticky ".concat(n?"dark":""),children:(0,M.jsx)(S.Z,{hideAdd:!0,onChange:function(e){s(e);var n=p.find((function(n){return n.key===e}));null!=n&&n.channelInfo&&x(n.channelInfo)},activeKey:a,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=p.findIndex((function(n){return n.key===e})),t=p.filter((function(n){return n.key!==e}));if(t.length&&e===a){var r=t[n===t.length?n-1:n].key;s(r);var o=t.find((function(e){return e.key===r}));null!=o&&o.channelInfo&&x(o.channelInfo)}f(t)}(e)},items:p.map((function(e){return c()(c()({},e),{},{children:null})}))})}),(0,M.jsx)("div",{className:"channel-tab-content",children:b&&(0,M.jsx)("div",{className:"tab-pane",children:b})})]})},Ns=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,M.jsxs)(a.Z,{style:{height:"100%"},children:[(0,M.jsx)(a.Z.Panel,{defaultSize:"20%",min:"10%",max:"40%",style:n,children:(0,M.jsx)(E,{})}),(0,M.jsx)(a.Z.Panel,{style:t,children:(0,M.jsx)(Os,{})})]})}},80106:function(e,n,t){t.d(n,{V:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(94976),l=t(26557),c=t(26407),u=t(20744),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,n){return{robotResult:{data:{content:[]}},currentRobot:{uid:"",nickname:""},llmRobotsByOrg:{},insertRobot:function(n){e((function(e){e.robotResult.data.content.unshift(n)}))},setRobotResult:function(t){e({robotResult:t});var r,a=n().currentRobot;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentRobot:t.data.content[0]})},setCurrentRobot:function(t){var r=n().robotResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),l=a()(a()({},n().robotResult),{},{data:{content:i}});e({robotResult:l,currentRobot:t})}else console.warn("Robot with the specified uid not found."),e({currentRobot:t})},deleteCurrentRobot:function(t){var r=n().robotResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({robotResult:a()(a()({},n().robotResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Robot not found in cache:",t),n().currentRobot.uid===t&&e({currentRobot:{uid:""}})},getLlmRobotsByOrg:function(e){var t,r;return e&&null!==(t=null===(r=n().llmRobotsByOrg)||void 0===r?void 0:r[e])&&void 0!==t?t:[]},setLlmRobotsByOrg:function(n,t){n&&e((function(e){e.llmRobotsByOrg[n]=Array.isArray(t)?t:[]}))},clearLlmRobotsByOrg:function(n){e(n?function(e){delete e.llmRobotsByOrg[n]}:function(e){e.llmRobotsByOrg={}})},deleteRobotCache:function(){return e({},!0)}}})),{name:i.Eis})))},1395:function(e,n,t){t.d(n,{E:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(94976),l=t(26557),c=t(26407),u=t(20744),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,n){return{agentResult:{data:{content:[]}},currentAgent:{uid:"",orgUid:""},insertAgent:function(n){e((function(e){e.agentResult.data.content.unshift(n)}))},updateAgent:function(n){e((function(e){var t=e.agentResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Agent with uid ".concat(n.uid," not found."))}))},setAgentResult:function(t){var r;(e({agentResult:t}),""===n().currentAgent.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentAgent:t.data.content[0]}))},setCurrentAgent:function(t){var r=n().agentResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),l=a()(a()({},n().agentResult),{},{data:{content:i}});e({agentResult:l,currentAgent:t})}else console.warn("Agent with the specified uid not found."),e({currentAgent:t})},deleteCurrentAgent:function(t){var r=n().agentResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({agentResult:a()(a()({},n().agentResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Agent not found in cache:",t),n().currentAgent.uid===t&&e({currentAgent:{uid:"",orgUid:""}})},deleteAgentCache:function(){return e({},!0)}}})),{name:i.zzK})))},21420:function(e,n,t){t.d(n,{$:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(94976),l=t(26557),c=t(26407),u=t(20744),d=(0,l.Ue)()((0,c.mW)((0,c.tJ)((0,u.n)((function(e,n){return{workgroupResult:{data:{content:[]}},currentWorkgroup:{uid:"",nickname:"",avatar:"",description:"",orgUid:""},insertWorkgroup:function(n){e((function(e){e.workgroupResult.data.content.unshift(n)}))},updateWorkgroup:function(n){e((function(e){var t=e.workgroupResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Workgroup with uid ".concat(n.uid," not found."))}))},deleteWorkgroup:function(n){e((function(e){var t=e.workgroupResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Workgroup with uid ".concat(n.uid," not found."))}))},setWorkgroupResult:function(t){var r;(e({workgroupResult:t}),""===n().currentWorkgroup.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWorkgroup:t.data.content[0]}))},setCurrentWorkgroup:function(t){var r=n().workgroupResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),l=a()(a()({},n().workgroupResult),{},{data:{content:i}});e({workgroupResult:l,currentWorkgroup:t})}else console.warn("Workgroup with the specified uid not found."),e({currentWorkgroup:t})},deleteCurrentWorkgroup:function(t){var r=n().workgroupResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({workgroupResult:a()(a()({},n().workgroupResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Workgroup not found in cache:",t),n().currentWorkgroup.uid===t&&e({currentWorkgroup:{uid:"",orgUid:""}})},deleteWorkgroupCache:function(){return e({},!0)}}})),{name:i.b6l})))}}]);