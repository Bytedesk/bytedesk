"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3868],{32045:function(e,t,a){a.d(t,{XS:function(){return u},k4:function(){return f},uu:function(){return x},yr:function(){return m}});var r=a(90819),s=a.n(r),n=a(73193),o=a.n(n),i=a(89933),d=a.n(i),c=a(55735),l=a(30921);function u(e){return g.apply(this,arguments)}function g(){return(g=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},81651:function(e,t,a){a.r(t),a.d(t,{default:function(){return le}});var r=a(8247),s=a(21182),n=a(84176),o=a.n(n),i=a(73193),d=a.n(i),c=a(86222),l=a.n(c),u=a(90819),g=a.n(u),f=a(89933),p=a.n(f),m=a(45332),h=a.n(m),x=a(86803),M=a(30921);function y(e){return v.apply(this,arguments)}function v(){return(v=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/thread/invite/query/org",{method:"GET",params:d()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=a(76750),b=a(40612),j=a(55735),k=a(36310),S=a(54881),F=a(11090),I=a(2484),T=a(81947),A=a(53530),Z=a(29266),C=a(61355),D=a(96485),E=a(75365),N=a(44194),R=a(28977),O=a.n(R),Y=a(31549),z=["current","pageSize"],U={INVITE_PENDING:{text:"invite.status.pending",defaultMessage:"邀请待处理",color:"blue"},INVITE_ACCEPTED:{text:"invite.status.accepted",defaultMessage:"接受邀请",color:"green"},INVITE_REJECTED:{text:"invite.status.rejected",defaultMessage:"拒绝邀请",color:"red"},INVITE_TIMEOUT:{text:"invite.status.timeout",defaultMessage:"邀请超时",color:"orange"},INVITE_CANCELED:{text:"invite.status.canceled",defaultMessage:"取消邀请",color:"gray"}},q=function(){var e=(0,M.useIntl)(),t=(0,N.useRef)(),a=(0,N.useState)(1),r=h()(a,2),s=r[0],n=r[1],i=(0,N.useState)(10),c=h()(i,2),u=c[0],f=c[1],m=(0,b.u)((function(e){return e.currentOrg})),v=(0,w.Z)().translateString,R=A.Z.useModal(),q=h()(R,2),P=(q[0],q[1]),L=(0,N.useState)([]),B=h()(L,2),H=B[0],_=B[1],V=(0,N.useState)([]),G=h()(V,2),K=G[0],J=G[1],Q=(0,N.useState)(0),W=h()(Q,2),X=W[0],$=W[1],ee=(0,N.useState)({}),te=h()(ee,2),ae=te[0],re=te[1],se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,Y.jsx)(M.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"sender",copyable:!0,ellipsis:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"invite.sender.tooltip"}),render:function(e,t,a,r){var s;return v(null===(s=t.sender)||void 0===s?void 0:s.nickname)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"invite.receiver.tooltip"}),render:function(e,t,a,r){var s;return v(null===(s=t.receiver)||void 0===s?void 0:s.nickname)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"invite.note.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"invite.status.tooltip"}),render:function(e,t){var a=t.status,r=U[a]||{text:"invite.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,Y.jsx)(Z.Z,{color:r.color,children:(0,Y.jsx)(M.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.updatedAt.tooltip"}),render:function(e,t,a,r){return O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],ne=[].concat(se,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,r,s){return[(0,Y.jsx)("a",{onClick:function(){oe(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==a?void 0:a.uid,"】？"),onConfirm:function(){return ie(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),oe=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==m?void 0:m.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},ie=function(){var a=p()(g()().mark((function a(r){var s;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",r),x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(s=t.current)||void 0===s||s.reload()}catch(t){x.yw.destroy(),x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),de=function(){var a=p()(g()().mark((function a(){var r,s,n,o;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==K.length){a.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(K);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),_([]),J([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),ce=function(){var e=p()(g()().mark((function e(t,a,r){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(j.LA8),o=d()({orgUid:(null==m?void 0:m.uid)||"",accessToken:n||"",exportType:t},ae),"current"===t?(o.pageNumber=String(s-1),o.pageSize=String(u)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(o.pageNumber=String(a),o.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/invite/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),le=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return ce("range",r,a)}})},n=0;n<r;n++)s();return t},ue={selectedRowKeys:H,onChange:function(e,t){_(e),J(t)}};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(T.Z,{columns:ne,actionRef:t,cardBordered:!0,rowSelection:ue,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,i,c,l,u,p,h,M;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,i=t.pageSize,c=o()(t,z),n(s),f(i),re(c),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,u="ascend"===a[p]?"ascend":"descend"),h=d()(d()({pageNumber:s-1,pageSize:i,orgUid:null==m?void 0:m.uid},c),{},{sortBy:l,sortDirection:u}),e.next=10,y(h);case 10:return M=e.sent,console.log("getAllThreadInvites response:",M,h),200===M.code?$(M.data.totalElements):x.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.invite",defaultMessage:"ThreadInvite"}),toolBarRender:function(){return function(){var t=[],a=[];H.length>0&&a.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(H.length,")"),onClick:function(){A.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(H.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:de,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ce("current")}}];return X>0&&(X<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return ce("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:le(X)})),t.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),a.length>0&&t.push((0,Y.jsx)(D.Z,{menu:{items:a},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:H.length>0?"primary":"default",danger:H.length>0,children:[H.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(H.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),t}()}}),P]})};function P(e){return L.apply(this,arguments)}function L(){return(L=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/thread/transfer/query/org",{method:"GET",params:d()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=["current","pageSize"],H={TRANSFER_PENDING:{text:"transfer.status.pending",defaultMessage:"转接待处理",color:"blue"},TRANSFER_ACCEPTED:{text:"transfer.status.accepted",defaultMessage:"接受转接",color:"green"},TRANSFER_REJECTED:{text:"transfer.status.rejected",defaultMessage:"拒绝转接",color:"red"},TRANSFER_TIMEOUT:{text:"transfer.status.timeout",defaultMessage:"转接超时",color:"orange"},TRANSFER_CANCELED:{text:"transfer.status.canceled",defaultMessage:"取消转接",color:"gray"}},_={AGENT_TO_AGENT:{text:"transfer.type.agent_to_agent",defaultMessage:"人工转人工",color:"purple"},ROBOT_TO_AGENT:{text:"transfer.type.robot_to_agent",defaultMessage:"机器人转人工",color:"cyan"}},V=function(){var e=(0,M.useIntl)(),t=(0,N.useRef)(),a=(0,N.useState)(1),r=h()(a,2),s=r[0],n=r[1],i=(0,N.useState)(10),c=h()(i,2),u=c[0],f=c[1],m=(0,b.u)((function(e){return e.currentOrg})),y=(0,w.Z)().translateString,v=A.Z.useModal(),R=h()(v,2),z=(R[0],R[1]),U=(0,N.useState)([]),q=h()(U,2),L=q[0],V=q[1],G=(0,N.useState)([]),K=h()(G,2),J=K[0],Q=K[1],W=(0,N.useState)(0),X=h()(W,2),$=X[0],ee=X[1],te=(0,N.useState)({}),ae=h()(te,2),re=ae[0],se=ae[1],ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left"},{title:(0,Y.jsx)(M.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"senderNickname",copyable:!0,ellipsis:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.sender.tooltip"}),render:function(e,t,a,r){var s;return y(null===(s=t.sender)||void 0===s?void 0:s.nickname)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.receiver.tooltip"}),render:function(e,t,a,r){var s;return y(null===(s=t.receiver)||void 0===s?void 0:s.nickname)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.note.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.status.tooltip"}),render:function(e,t){var a=t.status,r=H[a]||{text:"transfer.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,Y.jsx)(Z.Z,{color:r.color,children:(0,Y.jsx)(M.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.type.tooltip"}),render:function(e,t){var a=t.type,r=_[a]||{text:"transfer.type.unknown",defaultMessage:"未知类型",color:"default"};return(0,Y.jsx)(Z.Z,{color:r.color,children:(0,Y.jsx)(M.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.transferAt",defaultMessage:"转接时间"}),dataIndex:"transferAt",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.transferAt.tooltip"}),render:function(e,t){return t.transferAt?O()(t.transferAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.acceptAt",defaultMessage:"接受时间"}),dataIndex:"acceptAt",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.acceptAt.tooltip"}),render:function(e,t){return t.acceptAt?O()(t.acceptAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.cancelAt",defaultMessage:"取消时间"}),dataIndex:"cancelAt",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.cancelAt.tooltip"}),render:function(e,t){return t.cancelAt?O()(t.cancelAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.rejectAt",defaultMessage:"拒绝时间"}),dataIndex:"rejectAt",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.rejectAt.tooltip"}),render:function(e,t){return t.rejectAt?O()(t.rejectAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.expireAt",defaultMessage:"超时时间"}),dataIndex:"expireAt",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"transfer.expireAt.tooltip"}),render:function(e,t){return t.expireAt?O()(t.expireAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.updatedAt.tooltip"}),render:function(e,t,a,r){return O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],oe=[].concat(ne,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,r,s){return[(0,Y.jsx)("a",{onClick:function(){ie(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:e.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:e.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此转接记录吗？此操作不可恢复!"}),onConfirm:function(){return de(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ie=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==m?void 0:m.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},de=function(){var a=p()(g()().mark((function a(r){var s;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",r),x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(s=t.current)||void 0===s||s.reload()}catch(t){x.yw.destroy(),x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),ce=function(){var a=p()(g()().mark((function a(){var r,s,n,o;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==J.length){a.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(J);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),V([]),Q([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),le=function(){var e=p()(g()().mark((function e(t,a,r){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(j.LA8),o=d()({orgUid:(null==m?void 0:m.uid)||"",accessToken:n||"",exportType:t},re),"current"===t?(o.pageNumber=String(s-1),o.pageSize=String(u)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(o.pageNumber=String(a),o.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/transfer/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ue=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return le("range",r,a)}})},n=0;n<r;n++)s();return t},ge={selectedRowKeys:L,onChange:function(e,t){V(e),Q(t)}};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(T.Z,{columns:oe,actionRef:t,cardBordered:!0,rowSelection:ge,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,i,c,l,u,p,h,M;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,i=t.pageSize,c=o()(t,B),n(s),f(i),se(c),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,u="ascend"===a[p]?"ascend":"descend"),h=d()(d()({pageNumber:s-1,pageSize:i,orgUid:null==m?void 0:m.uid},c),{},{sortBy:l,sortDirection:u}),e.next=10,P(h);case 10:return M=e.sent,console.log("getAllThreadTransfers response:",M,h),200===M.code?ee(M.data.totalElements):x.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.transfer",defaultMessage:"ThreadTransfer"}),toolBarRender:function(){return function(){var t=[],a=[];L.length>0&&a.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(L.length,")"),onClick:function(){A.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(L.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:ce,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return le("current")}}];return $>0&&($<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat($,"条)"),onClick:function(){return le("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat($,"条)"),children:ue($)})),t.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),a.length>0&&t.push((0,Y.jsx)(D.Z,{menu:{items:a},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:L.length>0?"primary":"default",danger:L.length>0,children:[L.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(L.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),t}()}}),z]})},G=a(3849);function K(e){return J.apply(this,arguments)}function J(){return(J=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/thread/summary/query/org",{method:"GET",params:d()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=a(32045),W=["current","pageSize"],X=function(){var e=(0,M.useIntl)(),t=(0,N.useRef)(),a=(0,N.useState)(1),r=h()(a,2),s=r[0],n=r[1],i=(0,N.useState)(10),c=h()(i,2),u=c[0],f=c[1],m=(0,b.u)((function(e){return e.currentOrg})),y=(0,w.Z)().translateString,v=A.Z.useModal(),R=h()(v,2),z=(R[0],R[1]),U=(0,N.useState)([]),q=h()(U,2),P=(q[0],q[1]),L=(0,N.useState)({}),B=h()(L,2),H=B[0],_=B[1],V=(0,N.useState)([]),J=h()(V,2),X=J[0],$=J[1],ee=(0,N.useState)([]),te=h()(ee,2),ae=te[0],re=te[1],se=(0,N.useState)(0),ne=h()(se,2),oe=ne[0],ie=ne[1],de=(0,N.useState)({}),ce=h()(de,2),le=ce[0],ue=ce[1],ge=function(){var t=p()(g()().mark((function t(){var a,r,s,n,o;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={pageNumber:0,pageSize:100,type:j.ics,orgUid:null==m?void 0:m.uid},t.next=4,(0,Q.XS)(r);case 4:s=t.sent,console.log("queryCategoriesByOrg response:",s.data,r),200===(null==s?void 0:s.code)&&null!==(a=s.data)&&void 0!==a&&a.content&&(n=s.data.content,P(n),o={},n.forEach((function(e){o[e.uid]=e.name})),_(o)),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Fetch categories error:",t.t0),x.yw.error(e.formatMessage({id:"ticket.category.load.error"}));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();(0,N.useEffect)((function(){null!=m&&m.uid&&ge()}),[null==m?void 0:m.uid]);var fe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,Y.jsx)(M.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.title.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.content.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"solution",defaultMessage:"Solution"}),dataIndex:"solution",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.solution.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.category.tooltip"}),render:function(e,t){var a=H[t.categoryUid]||t.categoryUid;return y(a)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.status.tooltip"}),render:function(t,a){var r="",s="";switch(a.status){case j.kA8:r="orange",s=e.formatMessage({id:"summary.status.pending",defaultMessage:"待处理"});break;case j.zvK:r="blue",s=e.formatMessage({id:"summary.status.processing",defaultMessage:"处理中"});break;case j.fuK:r="green",s=e.formatMessage({id:"summary.status.resolved",defaultMessage:"已解决"});break;case j.cin:r="gray",s=e.formatMessage({id:"summary.status.closed",defaultMessage:"已关闭"});break;default:r="default",s=t}return(0,Y.jsx)(Z.Z,{color:r,children:s})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.tags.tooltip"}),render:function(e,t){return t.tagList&&Array.isArray(t.tagList)&&0!==t.tagList.length?(0,Y.jsx)(G.Z,{size:[0,4],wrap:!0,children:t.tagList.map((function(e){return(0,Y.jsx)(Z.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"summary.updatedAt.tooltip"}),render:function(e,t,a,r){return O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],pe=[].concat(fe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,r,s){return[(0,Y.jsx)("a",{onClick:function(){me(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:e.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:e.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此总结记录吗？此操作不可恢复!"}),onConfirm:function(){return he(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),me=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==m?void 0:m.uid,t:j.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},he=function(){var a=p()(g()().mark((function a(r){var s;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",r),x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(s=t.current)||void 0===s||s.reload()}catch(t){x.yw.destroy(),x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),xe=function(){var a=p()(g()().mark((function a(){var r,s,n,o;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==ae.length){a.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(ae);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),$([]),re([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),Me=function(){var e=p()(g()().mark((function e(t,a,r){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(j.LA8),o=d()({orgUid:(null==m?void 0:m.uid)||"",accessToken:n||"",exportType:t},le),"current"===t?(o.pageNumber=String(s-1),o.pageSize=String(u)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(o.pageNumber=String(a),o.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/summary/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return Me("range",r,a)}})},n=0;n<r;n++)s();return t},ve={selectedRowKeys:X,onChange:function(e,t){$(e),re(t)}};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(T.Z,{columns:pe,actionRef:t,cardBordered:!0,rowSelection:ve,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,i,c,l,u,p,h,M;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,i=t.pageSize,c=o()(t,W),n(s),f(i),ue(c),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,u="ascend"===a[p]?"ascend":"descend"),h=d()(d()({pageNumber:s-1,pageSize:i,orgUid:null==m?void 0:m.uid},c),{},{sortBy:l,sortDirection:u}),e.next=10,K(h);case 10:return M=e.sent,console.log("queryThreadSummariesByOrg response:",M,h),200===M.code?ie(M.data.totalElements):x.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"thread.tab.summary",defaultMessage:"ThreadSummary"}),toolBarRender:function(){return function(){var t=[],a=[];X.length>0&&a.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(X.length,")"),onClick:function(){A.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(X.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:xe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];return oe>0&&(oe<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(oe,"条)"),onClick:function(){return Me("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(oe,"条)"),children:ye(oe)})),t.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),a.length>0&&t.push((0,Y.jsx)(D.Z,{menu:{items:a},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:X.length>0?"primary":"default",danger:X.length>0,children:[X.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(X.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),t}()}}),z]})};function $(e){return ee.apply(this,arguments)}function ee(){return(ee=p()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/thread/rating/query/org",{method:"GET",params:d()(d()({},t),{},{client:j.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=["current","pageSize"],ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,Y.jsx)(M.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,ellipsis:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t,a,r){var s;return null==t||null===(s=t.thread)||void 0===s||null===(s=s.user)||void 0===s?void 0:s.nickname}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"rating.agent.tooltip"}),render:function(e,t,a,r){var s;return null==t||null===(s=t.thread)||void 0===s||null===(s=s.agentProtobuf)||void 0===s?void 0:s.nickname}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"score",defaultMessage:"Score"}),dataIndex:"score",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"rating.score.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"comment",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"rating.comment.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,r){return O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}}],re=function(){var e=(0,M.useIntl)(),t=(0,N.useRef)(),a=(0,N.useState)(1),r=h()(a,2),s=r[0],n=r[1],i=(0,N.useState)(10),c=h()(i,2),u=c[0],f=c[1],m=(0,b.u)((function(e){return e.currentOrg})),y=(0,N.useState)([]),v=h()(y,2),w=v[0],Z=v[1],R=(0,N.useState)([]),O=h()(R,2),z=O[0],U=O[1],q=(0,N.useState)(0),P=h()(q,2),L=P[0],B=P[1],H=(0,N.useState)({}),_=h()(H,2),V=_[0],G=_[1],K=[].concat(ae,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(t,a,r,s){return[(0,Y.jsx)("a",{onClick:function(){J(a)},children:e.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==a?void 0:a.uid,"】？"),onConfirm:function(){return Q(a)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:e.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),J=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==m?void 0:m.uid,t:j.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},Q=function(){var a=p()(g()().mark((function a(r){var s;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("handleDeleteConfirm",r),x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==t||null===(s=t.current)||void 0===s||s.reload()}catch(t){x.yw.destroy(),x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),W=function(){var a=p()(g()().mark((function a(){var r,s,n,o;return g()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==z.length){a.next=3;break}return x.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),a.abrupt("return");case 3:x.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(z);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),Z([]),U([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 13:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),X=function(){var e=p()(g()().mark((function e(t,a,r){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(j.LA8),o=d()({orgUid:(null==m?void 0:m.uid)||"",accessToken:n||"",exportType:t},V),"current"===t?(o.pageNumber=String(s-1),o.pageSize=String(u)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(o.pageNumber=String(a),o.pageSize=String(r)),window.open((0,k.kG)()+"/api/v1/thread/rating/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ee=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return X("range",r,a)}})},n=0;n<r;n++)s();return t},re={selectedRowKeys:w,onChange:function(e,t){Z(e),U(t)}};return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(T.Z,{columns:K,actionRef:t,cardBordered:!0,rowSelection:re,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,i,c,l,u,p,h,M;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,i=t.pageSize,c=o()(t,te),n(s),f(i),G(c),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(p=Object.keys(a)[0],l=p,u="ascend"===a[p]?"ascend":"descend"),h=d()(d()({pageNumber:s-1,pageSize:i,orgUid:null==m?void 0:m.uid},c),{},{sortBy:l,sortDirection:u}),e.next=10,$(h);case 10:return M=e.sent,console.log("queryRatesByOrgUid response:",M.data,h),200===M.code?B(M.data.totalElements):x.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"评价记录",toolBarRender:function(){return function(){var t=[],a=[];w.length>0&&a.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(w.length,")"),onClick:function(){A.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(w.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:W,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return X("current")}}];return L>0&&(L<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(L,"条)"),onClick:function(){return X("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(L,"条)"),children:ee(L)})),t.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[e.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),a.length>0&&t.push((0,Y.jsx)(D.Z,{menu:{items:a},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:w.length>0?"primary":"default",danger:w.length>0,children:[w.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(w.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),t}()}})})},se=a(2041),ne=a(88721),oe=["current","pageSize"],ie=function(e){var t=e.type,a=(0,M.useIntl)(),r=(0,N.useRef)(),s=(0,N.useState)(1),n=h()(s,2),i=n[0],c=n[1],u=(0,N.useState)(10),f=h()(u,2),m=f[0],y=f[1],v=(0,b.u)((function(e){return e.currentOrg})),w=A.Z.useModal(),Z=h()(w,2),R=(Z[0],Z[1]),z=(0,N.useState)([]),U=h()(z,2),q=U[0],P=U[1],L=(0,N.useState)([]),B=h()(L,2),H=B[0],_=B[1],V=(0,N.useState)(0),G=h()(V,2),K=G[0],J=G[1],Q=(0,N.useState)({}),W=h()(Q,2),X=W[0],$=W[1],ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,ellipsis:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,Y.jsx)(Y.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case j.ach:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.new"});case j.j0C:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.roboting"});case j.Q7C:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.offline"});case j.v1N:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.queuing"});case j.hl2:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.chatting"});case j.V1n:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,Y.jsx)(M.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.client.tooltip"}),render:function(e,t){return(0,ne.qF)(t.client)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",hideInSearch:!0,sorter:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.createdAt.tooltip"}),render:function(e,t){return O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.type.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.topic.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.owner.tooltip"}),render:function(e,t){var a;return(0,Y.jsx)(Y.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.tagList.tooltip"}),render:function(e,t){var a;return null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,Y.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],te=[].concat(ee,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,r,s){return[(0,Y.jsx)("a",{onClick:function(){ae(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:a.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:a.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此群组记录吗？此操作不可恢复!"}),onConfirm:function(){return re(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ae=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:j.IUl,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},re=function(){var e=p()(g()().mark((function e(t){var s;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(s=r.current)||void 0===s||s.reload()}catch(e){x.yw.destroy(),x.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=p()(g()().mark((function e(){var t,s,n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==H.length){e.next=3;break}return x.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(H);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),P([]),_([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=p()(g()().mark((function e(a,r,s){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,s),n=localStorage.getItem(j.LA8),o=d()({componentType:t,orgUid:(null==v?void 0:v.uid)||"",accessToken:n||"",exportType:a,type:j.H_O},X),"current"===a?(o.pageNumber=String(i-1),o.pageSize=String(m)):"all"===a?(o.pageNumber="0",o.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==s&&(o.pageNumber=String(r),o.pageSize=String(s)),window.open((0,k.kG)()+"/api/v1/thread/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return de("range",r,a)}})},n=0;n<r;n++)s();return t},le={selectedRowKeys:q,onChange:function(e,t){P(e),_(t)}};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(T.Z,{columns:te,actionRef:r,cardBordered:!0,rowSelection:le,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,n,i,l,u,f,p,m;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,n=t.pageSize,i=o()(t,oe),c(s),y(n),$(i),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(f=Object.keys(a)[0],l=f,u="ascend"===a[f]?"ascend":"descend"),p=d()(d()({pageNumber:s-1,pageSize:n,componentType:"",type:j.H_O,orgUid:null==v?void 0:v.uid,mergeByTopic:!1},i),{},{sortBy:l,sortDirection:u}),e.next=10,(0,se.fk)(p);case 10:return m=e.sent,console.log("getAllThreads response:",m,p),200===m.code?J(m.data.totalElements):x.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];q.length>0&&t.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(q.length,")"),onClick:function(){A.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(q.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ie,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return de("current")}}];return K>0&&(K<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(K,"条)"),onClick:function(){return de("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(K,"条)"),children:ce(K)})),e.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),t.length>0&&e.push((0,Y.jsx)(D.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:q.length>0?"primary":"default",danger:q.length>0,children:[q.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(q.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),e}()}}),R]})},de=["current","pageSize"],ce=function(e){var t=e.type,a=(0,M.useIntl)(),r=(0,N.useRef)(),s=(0,N.useState)(1),n=h()(s,2),i=n[0],c=n[1],u=(0,N.useState)(10),f=h()(u,2),m=f[0],y=f[1],v=(0,b.u)((function(e){return e.currentOrg})),w=A.Z.useModal(),Z=h()(w,2),R=(Z[0],Z[1]),z=(0,N.useState)([]),U=h()(z,2),q=U[0],P=U[1],L=(0,N.useState)([]),B=h()(L,2),H=B[0],_=B[1],V=(0,N.useState)(0),G=h()(V,2),K=G[0],J=G[1],Q=(0,N.useState)({}),W=h()(Q,2),X=W[0],$=W[1],ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,Y.jsx)(M.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,Y.jsx)(Y.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case j.ach:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.new"});case j.j0C:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.roboting"});case j.Q7C:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.offline"});case j.v1N:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.queuing"});case j.hl2:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.chatting"});case j.V1n:return(0,Y.jsx)(M.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,Y.jsx)(M.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"client"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.client.tooltip"}),render:function(e,t){return(0,ne.qF)(t.client)}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",hideInSearch:!0,sorter:!0,tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.createdAt.tooltip"}),render:function(e,t){return O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,Y.jsx)(M.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,Y.jsx)(M.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return(0,Y.jsx)(Y.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,Y.jsx)(M.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,Y.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],te=[].concat(ee,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,Y.jsx)(M.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,r,s){return[(0,Y.jsx)("a",{onClick:function(){ae(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,Y.jsx)(C.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return re(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,Y.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ae=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:j.IUl,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},re=function(){var e=p()(g()().mark((function e(t){var s;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(s=r.current)||void 0===s||s.reload()}catch(e){x.yw.destroy(),x.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=p()(g()().mark((function e(){var t,s,n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==H.length){e.next=3;break}return x.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,n=l()(H);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}x.yw.destroy(),0===s?x.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),P([]),_([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=p()(g()().mark((function e(a,r,s){var n,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,s),n=localStorage.getItem(j.LA8),o=d()({componentType:t,orgUid:(null==v?void 0:v.uid)||"",accessToken:n||"",exportType:a,type:j.n4F},X),"current"===a?(o.pageNumber=String(i-1),o.pageSize=String(m)):"all"===a?(o.pageNumber="0",o.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==s&&(o.pageNumber=String(r),o.pageSize=String(s)),window.open((0,k.kG)()+"/api/v1/thread/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),s=function(){var r=n,s=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(o," (").concat(o-s+1,"条)"),onClick:function(){return ie("range",r,a)}})},n=0;n<r;n++)s();return t},le={selectedRowKeys:q,onChange:function(e,t){P(e),_(t)}};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(T.Z,{columns:te,actionRef:r,cardBordered:!0,rowSelection:le,scroll:{x:"max-content"},request:function(){var e=p()(g()().mark((function e(t,a,r){var s,n,i,l,u,f,p,m;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.current,n=t.pageSize,i=o()(t,de),c(s),y(n),$(i),l=void 0,u=void 0,a&&Object.keys(a).length>0&&(f=Object.keys(a)[0],l=f,u="ascend"===a[f]?"ascend":"descend"),p=d()(d()({pageNumber:s-1,pageSize:n,componentType:"",type:j.n4F,orgUid:null==v?void 0:v.uid,mergeByTopic:!1},i),{},{sortBy:l,sortDirection:u}),e.next=10,(0,se.fk)(p);case 10:return m=e.sent,console.log("getAllThreads response:",m,p),200===m.code?J(m.data.totalElements):x.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];q.length>0&&t.push({key:"batchDelete",icon:(0,Y.jsx)(S.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(q.length,")"),onClick:function(){A.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(q.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:oe,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ie("current")}}];return K>0&&(K<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(K,"条)"),onClick:function(){return ie("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(F.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(K,"条)"),children:ce(K)})),e.push((0,Y.jsx)(D.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{icon:(0,Y.jsx)(F.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,Y.jsx)(I.Z,{})]},"button")},"export")),t.length>0&&e.push((0,Y.jsx)(D.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(E.ZP,{type:q.length>0?"primary":"default",danger:q.length>0,children:[q.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(q.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(I.Z,{})]})},"batchOperations")),e}()}}),R]})},le=function(){var e=(0,M.useIntl)(),t=[{key:"thread",label:e.formatMessage({id:"thread.tab.all"}),children:(0,Y.jsx)(s.Z,{type:j.Nqz})}];return(0,k.OJ)()&&t.push({key:"rate",label:e.formatMessage({id:"thread.tab.rate"}),children:(0,Y.jsx)(re,{})},{key:"transfer",label:e.formatMessage({id:"thread.tab.transfer"}),children:(0,Y.jsx)(V,{})},{key:"invite",label:e.formatMessage({id:"thread.tab.invite"}),children:(0,Y.jsx)(q,{})},{key:"summary",label:e.formatMessage({id:"thread.tab.summary"}),children:(0,Y.jsx)(X,{})}),(0,k.Ox)()||t.push({key:"thread.group",label:e.formatMessage({id:"thread.tab.group"}),children:(0,Y.jsx)(ie,{type:j.Nqz})},{key:"thread.member",label:e.formatMessage({id:"thread.tab.member"}),children:(0,Y.jsx)(ce,{type:j.Nqz})}),(0,Y.jsx)(r.Z,{defaultActiveKey:"thread",items:t,style:{padding:"10px"}})}}}]);