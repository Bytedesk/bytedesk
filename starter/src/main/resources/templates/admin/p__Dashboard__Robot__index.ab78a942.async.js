"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6693],{10411:function(Se,ie,n){n.d(ie,{AP:function(){return z},_J:function(){return ve},t5:function(){return ae},v_:function(){return ce}});var J=n(15009),P=n.n(J),ue=n(97857),x=n.n(ue),de=n(99289),L=n.n(de),Q=n(85615),q=n(86745);function z(b){return ee.apply(this,arguments)}function ee(){return ee=L()(P()().mark(function b(H){return P()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,q.request)("/api/v1/kbase/query/org",{method:"GET",params:x()(x()({},H),{},{client:Q.bV})}));case 1:case"end":return g.stop()}},b)})),ee.apply(this,arguments)}function ce(b){return W.apply(this,arguments)}function W(){return W=L()(P()().mark(function b(H){return P()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,q.request)("/api/v1/kbase/create",{method:"POST",data:x()(x()({},H),{},{client:Q.bV})}));case 1:case"end":return g.stop()}},b)})),W.apply(this,arguments)}function ae(b){return te.apply(this,arguments)}function te(){return te=L()(P()().mark(function b(H){return P()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,q.request)("/api/v1/kbase/update",{method:"POST",data:x()(x()({},H),{},{client:Q.bV})}));case 1:case"end":return g.stop()}},b)})),te.apply(this,arguments)}function ve(b){return re.apply(this,arguments)}function re(){return re=L()(P()().mark(function b(H){return P()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,q.request)("/api/v1/kbase/delete",{method:"POST",data:x()(x()({},H),{},{client:Q.bV})}));case 1:case"end":return g.stop()}},b)})),re.apply(this,arguments)}},55595:function(Se,ie,n){n.r(ie),n.d(ie,{default:function(){return yt}});var J=n(21612),P=n(67294),ue=n(15009),x=n.n(ue),de=n(99289),L=n.n(de),Q=n(5574),q=n.n(Q),z=n(37326),ee=n(85576),ce=n(86250),W=n(14726),ae=n(2487),te=n(7134),ve=n(11475),re=n(64789),b=n(86745),H=n(39825),Y=n(87676),g=n(85615),G=n(34994),fe=n(5966),ge=n(64317),t=n(85893),je=function(u){var c=u.open,l=u.onClose,s=u.onSubmit,h=(0,b.useIntl)(),D=G.A.useForm(),Z=q()(D,1),e=Z[0],a=(0,Y.u)(function(E){return E.currentOrg}),w=function(){console.log("handleSaveRobot"),e.validateFields().then(function(i){console.log("handleSaveRobot values:",i);var F={nickname:i.nickname,type:i.type,orgUid:a.uid};console.log("robotObject:",F),s(F)}).catch(function(i){console.log("Form errors:",i)})},_=function(){l()},V=function(i){console.log("onTreeSelectChange:",i)};return(0,t.jsx)("div",{children:(0,t.jsx)(ee.Z,{title:h.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:c,okText:h.formatMessage({id:"save",defaultMessage:"Save"}),onOk:w,onCancel:_,children:(0,t.jsxs)(G.A,{form:e,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,t.jsx)(fe.Z,{label:h.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:h.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,t.jsx)(ge.Z,{label:h.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:h.formatMessage({id:g.f4,defaultMessage:"Service"}),value:g.f4},{label:h.formatMessage({id:g.wG,defaultMessage:"Marketing"}),value:g.wG,disabled:!0}],rules:[{required:!0,message:h.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:h.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:V,allowClear:!0}})]})})})},Re=je,X=n(76545),v=n(80049),oe=n(73803),xe=function(){var u=(0,H.Z)(),c=u.isDarkMode,l=(0,b.useIntl)(),s=(0,P.useRef)(!1),h=(0,oe.Z)(),D=h.translateString,Z=h.translateStringTranct,e=(0,z.V)(function(A){return{robotResult:A.robotResult,currentRobot:A.currentRobot,insertRobot:A.insertRobot,deleteCurrentRobot:A.deleteCurrentRobot,setRobotResult:A.setRobotResult,setCurrentRobot:A.setCurrentRobot}}),a=e.robotResult,w=e.currentRobot,_=e.insertRobot,V=e.deleteCurrentRobot,E=e.setRobotResult,i=e.setCurrentRobot,F=(0,Y.u)(function(A){return A.currentOrg}),S=ee.Z.useModal(),f=q()(S,2),r=f[0],d=f[1],m=function(O){r.confirm({title:l.formatMessage({id:"deleteTip"}),icon:(0,t.jsx)(ve.Z,{}),content:"".concat(l.formatMessage({id:"deleteAfirm",defaultMessage:"Delete"}),"\u3010").concat(D(O.nickname),"\u3011\uFF1F"),onOk:function(){j(O)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})})},j=function(){var A=L()(x()().mark(function O(K){var B;return x()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return console.log("delete robot",K),v.yw.loading(l.formatMessage({id:"deleting",defaultMessage:"Deleting"})),I.next=4,(0,X.gf)(K);case 4:B=I.sent,console.log("delete robot response",B),B.code===200?(v.yw.destroy(),v.yw.success(l.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),V(K.uid)):(v.yw.destroy(),v.yw.error(B.message));case 7:case"end":return I.stop()}},O)}));return function(K){return A.apply(this,arguments)}}(),C=function(){var A=L()(x()().mark(function O(){var K,B;return x()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!s.current){I.next=3;break}return console.log("isLoading: 1",s.current),I.abrupt("return");case 3:return s.current=!0,v.yw.loading("loading"),K={pageNumber:0,pageSize:50,orgUid:F.uid},I.next=8,(0,X.p0)(K);case 8:B=I.sent,console.log("queryRobotsByOrg: ",B),B.code===200?(v.yw.destroy(),E(B)):(v.yw.destroy(),v.yw.error(B.message)),s.current=!1;case 12:case"end":return I.stop()}},O)}));return function(){return A.apply(this,arguments)}}();(0,P.useEffect)(function(){C()},[]);var y=(0,P.useState)(!1),k=q()(y,2),p=k[0],o=k[1],U=function(){o(!0)},$=function(){var A=L()(x()().mark(function O(K){var B;return x()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return v.yw.loading(l.formatMessage({id:"creating",defaultMessage:"Creating"})),I.next=3,(0,X.lg)(K);case 3:B=I.sent,console.log("handleSaveRobot response:",B),B.code===200?(v.yw.destroy(),v.yw.success(l.formatMessage({id:"create.success"})),_(B.data),o(!1)):(v.yw.destroy(),o(!1),v.yw.error(B.message));case 6:case"end":return I.stop()}},O)}));return function(K){return A.apply(this,arguments)}}(),R=function(){o(!1)},N=function(){U()},ne=function(O,K){i(O)},se=function(O){return l.formatMessage({id:O==null?void 0:O.type,defaultMessage:O==null?void 0:O.type})};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{margin:10},children:(0,t.jsxs)(ce.Z,{gap:"small",align:"flex-start",children:[(0,t.jsx)(W.ZP,{size:"small",type:"primary",icon:(0,t.jsx)(re.Z,{}),onClick:N,children:l.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,t.jsx)(W.ZP,{size:"small",onClick:C,children:l.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,t.jsx)(W.ZP,{onClick:function(){return m(w)},size:"small",style:{float:"right"},danger:!0,disabled:(w==null?void 0:w.uid)==="",children:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,t.jsx)(ae.Z,{itemLayout:"horizontal",dataSource:a.data.content,renderItem:function(O,K){return(0,t.jsx)(ae.Z.Item,{style:(w==null?void 0:w.uid)===O.uid?{backgroundColor:c?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return ne(O,K)},children:(0,t.jsx)(ae.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,t.jsx)(te.C,{src:O.avatar}),title:(0,t.jsx)(t.Fragment,{children:Z(O==null?void 0:O.nickname)}),description:se(O)})})}}),(0,t.jsx)(Re,{open:p,onClose:R,onSubmit:$}),d]})},Ce=xe,me=n(11941),Ft=function(){var u=function(l,s){l.dataTransfer.setData("application/reactflow",s),l.dataTransfer.effectAllowed="move",console.log("onDragStart:",l,s)};return _jsxs("aside",{children:[_jsx("div",{className:"dndnode",onDragStart:function(l){return u(l,"nodeText")},draggable:!0,children:"Text"}),_jsx("div",{className:"dndnode",onDragStart:function(l){return u(l,"nodeImage")},draggable:!0,children:"Image"})]})},St=null,jt=n(51453),Rt=n(66419);function xt(T){var u=T.id,c=T.type,l=T.data,s=T.xPos,h=T.yPos,D=T.isConnectable,Z=useCallback(function(){var _=JSON.stringify({id:u,type:c,data:l});emitter.emit(EVENT_BUS_FLOW_NODE_RUN,_)},[]),e=useCallback(function(){var _=JSON.stringify({id:getUUid(),type:c,data:l,position:{x:s+10,y:h+10}});emitter.emit(EVENT_BUS_FLOW_NODE_COPY,_)},[]),a=useCallback(function(){emitter.emit(EVENT_BUS_FLOW_NODE_DELETE,u)},[]),w=useCallback(function(_){console.log(_.target.value)},[]);return _jsxs("div",{className:"node-text",children:[_jsxs(NodeToolbar,{isVisible:l.toolbarVisible,position:l.toolbarPosition,children:[_jsx("button",{onClick:Z,children:"run"}),_jsx("button",{onClick:e,children:"copy"}),_jsx("button",{onClick:a,children:"delete"})]}),_jsx(Handle,{type:"target",position:Position.Top,isConnectable:D}),_jsxs("div",{children:[_jsx("label",{htmlFor:"text",children:"Text:"}),_jsx("input",{id:"text",name:"text",onChange:w,className:"nodrag"})]}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:D})]})}var Ct=null;function Mt(T){var u=T.data,c=T.isConnectable,l=useCallback(function(s){console.log(s.target.value)},[]);return _jsxs("div",{className:"node-image",children:[_jsx(Handle,{type:"target",position:Position.Top,isConnectable:c}),_jsx("div",{children:_jsx("label",{htmlFor:"text",children:"Image"})}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:c})]})}var Tt=null;function wt(T){var u=T.id,c=T.type,l=T.data,s=T.isConnectable,h=useCallback(function(){var D=JSON.stringify({id:u,type:c,data:l});emitter.emit(EVENT_BUS_FLOW_NODE_RUN,D)},[]);return _jsxs("div",{className:"node-start",children:[_jsx(NodeToolbar,{isVisible:l.toolbarVisible,position:l.toolbarPosition,children:_jsx("button",{onClick:h,children:"run"})}),_jsx("div",{children:_jsx("label",{htmlFor:"text",children:"Start"})}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:s})]})}var Et=null,Dt=function(u){var c=u.open,l=u.onClose,s=useRobotStore(function(F){return F.currentRobot}),h=useState(""),D=_slicedToArray(h,2),Z=D[0],e=D[1],a=useState(!1),w=_slicedToArray(a,2),_=w[0],V=w[1],E=function(){V(!0),console.log("Iframe loaded successfully!")};useEffect(function(){var F="http://127.0.0.1:9003/chat?t="+THREAD_TYPE_ROBOT+"&sid="+(s==null?void 0:s.uid)+"&"+new Date().getTime();e(F)},[s]);var i=function(){console.log("restart");var S="http://127.0.0.1:9003/chat?t="+THREAD_TYPE_ROBOT+"&sid="+(s==null?void 0:s.uid)+"&"+new Date().getTime();e(S)};return _jsx(_Fragment,{children:_jsxs(Drawer,{title:"Preview",onClose:l,open:c,extra:_jsxs(Space,{children:[_jsx(Button,{onClick:l,children:"Cancel"}),_jsx(Button,{onClick:i,type:"primary",children:"Restart"})]}),children:[_jsx(Spin,{spinning:!_,size:"large"}),_jsx("iframe",{id:"chat-iframe",src:Z,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:E})]})})},Ot=null,Me={},Te={animated:!0},kt={hideAttribution:!0},we=0,Ee=function(){return"dndnode_".concat(we++)},Pt=function(){var u=useRef(null),c=[{id:"1",type:"nodeStart",data:{label:"start"},position:{x:250,y:5}}],l=useState(c),s=_slicedToArray(l,2),h=s[0],D=s[1],Z=useState([]),e=_slicedToArray(Z,2),a=e[0],w=e[1],_=useMemo(function(){return{nodeStart:NodeStart,nodeText:NodeText,nodeImage:NodeImage}},[]),V=useCallback(function(o){return D(function(U){return applyNodeChanges(o,U)})},[D]),E=useCallback(function(o){return w(function(U){return applyEdgeChanges(o,U)})},[w]),i=useCallback(function(o){w(function(U){return addEdge(o,U)})},[w]),F=useReactFlow(),S=F.screenToFlowPosition,f=useCallback(function(o){o.preventDefault(),o.dataTransfer.dropEffect="move"},[]),r=useCallback(function(o){o.preventDefault();var U=o.dataTransfer.getData("application/reactflow");if(!(typeof U=="undefined"||!U)){var $=S({x:o.clientX,y:o.clientY}),R={id:Ee(),type:U,data:{label:"nodeText"},position:$};D(function(N){return N.concat(R)})}},[S]),d=function(){};useEffect(function(){var o=setInterval(d,1e4);return function(){clearInterval(o)}},[h,a]);var m=useState(!1),j=_slicedToArray(m,2),C=j[0],y=j[1],k=function(){y(!0)},p=function(){y(!1)};return useEffect(function(){var o=function(N){console.log("handleRunEvent:",N),k()};emitter.on(EVENT_BUS_FLOW_NODE_RUN,o);var U=function(N){var ne=JSON.parse(N);console.log("handleCopyEvent:",N,ne),D(function(se){return se.concat(ne)})};emitter.on(EVENT_BUS_FLOW_NODE_COPY,U);var $=function(N){console.log("handleDeleteEvent:",N),D(function(ne){return ne.filter(function(se){return se.id!==N})})};return emitter.on(EVENT_BUS_FLOW_NODE_DELETE,$),function(){emitter.off(EVENT_BUS_FLOW_NODE_RUN,o),emitter.off(EVENT_BUS_FLOW_NODE_COPY,U),emitter.off(EVENT_BUS_FLOW_NODE_DELETE,$)}},[]),_jsxs("div",{className:"dndflow",children:[_jsx(Sidebar,{}),_jsx("div",{ref:u,style:{width:"75vw",height:"80vh"},children:_jsx(ReactFlow,{nodeTypes:_,nodes:h,edges:a,onNodesChange:V,onEdgesChange:E,onConnect:i,onDrop:r,onDragOver:f,fitView:!0,nodesDraggable:!0,style:Me,defaultEdgeOptions:Te,children:_jsx(Controls,{})})}),_jsx(Preview,{open:C,onClose:p})]})},_t=null,Ut=function(){var u=useAccess();return _jsx(_Fragment,{children:_jsx(Access,{accessible:u.canDebug(),fallback:_jsx(_Fragment,{children:_jsx(FormattedMessage,{id:UNDER_DEVELOPMENT})}),children:_jsx(ReactFlowProvider,{children:_jsx(Flow,{})})})})},At=null,be=n(40056),De=n(79964),Oe=n(64423),ke=n(50748),Pe=n(99072),_e=n(97857),M=n.n(_e),pe=n(52688),le=n(90672),he=n(31199),Ue=n(96074),Ae=function(){var u=(0,b.useIntl)(),c=G.A.useForm(),l=q()(c,1),s=l[0],h=(0,oe.Z)(),D=h.translateString,Z=(0,z.V)(function(i){return{currentRobot:i.currentRobot,setCurrentRobot:i.setCurrentRobot}}),e=Z.currentRobot,a=Z.setCurrentRobot;(0,P.useEffect)(function(){var i,F,S,f,r,d;s.setFieldValue("enabled",e==null||(i=e.llm)===null||i===void 0?void 0:i.enabled),s.setFieldValue("topK",e==null||(F=e.llm)===null||F===void 0?void 0:F.topK),s.setFieldValue("scoreThreshold",e==null||(S=e.llm)===null||S===void 0?void 0:S.scoreThreshold),s.setFieldValue("model",e==null||(f=e.llm)===null||f===void 0?void 0:f.model),s.setFieldValue("temperature",e==null||(r=e.llm)===null||r===void 0?void 0:r.temperature),s.setFieldValue("prompt",D(e==null||(d=e.llm)===null||d===void 0?void 0:d.prompt))},[e]);var w=function(){var i=L()(x()().mark(function F(S){var f,r,d,m,j,C,y;return x()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("TabKeyword handleEnableChange",S),v.yw.loading(u.formatMessage({id:"updating"})),C=M()(M()({},e),{},{serviceSettings:M()(M()({},e==null?void 0:e.serviceSettings),{},{faqUids:e==null||(f=e.serviceSettings)===null||f===void 0||(f=f.faqs)===null||f===void 0?void 0:f.map(function(o){return o.uid}),quickFaqUids:e==null||(r=e.serviceSettings)===null||r===void 0||(r=r.quickFaqs)===null||r===void 0?void 0:r.map(function(o){return o.uid}),guessFaqUids:e==null||(d=e.serviceSettings)===null||d===void 0?void 0:d.guessFaqs.map(function(o){return o.uid}),hotFaqUids:e==null||(m=e.serviceSettings)===null||m===void 0?void 0:m.hotFaqs.map(function(o){return o.uid}),shortcutFaqUids:e==null||(j=e.serviceSettings)===null||j===void 0?void 0:j.shortcutFaqs.map(function(o){return o.uid})}),llm:M()(M()({},e==null?void 0:e.llm),{},{enabled:S})}),console.log("robotObject:",C),p.next=6,(0,X.$l)(C);case 6:y=p.sent,console.log("updateRobot response:",y),y.code===200?(v.yw.destroy(),v.yw.success(u.formatMessage({id:"update.success"})),a(y.data)):(v.yw.destroy(),v.yw.error(y.message));case 9:case"end":return p.stop()}},F)}));return function(S){return i.apply(this,arguments)}}(),_=function(){var i=L()(x()().mark(function F(S){var f,r,d,m,j,C,y;return x()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("handleSubmit",S),v.yw.loading(u.formatMessage({id:"updating"})),C=M()(M()({},e),{},{serviceSettings:M()(M()({},e.serviceSettings),{},{faqUids:(f=e.serviceSettings)===null||f===void 0||(f=f.faqs)===null||f===void 0?void 0:f.map(function(o){return o.uid}),quickFaqUids:e==null||(r=e.serviceSettings)===null||r===void 0||(r=r.quickFaqs)===null||r===void 0?void 0:r.map(function(o){return o.uid}),guessFaqUids:e==null||(d=e.serviceSettings)===null||d===void 0?void 0:d.guessFaqs.map(function(o){return o.uid}),hotFaqUids:e==null||(m=e.serviceSettings)===null||m===void 0?void 0:m.hotFaqs.map(function(o){return o.uid}),shortcutFaqUids:e==null||(j=e.serviceSettings)===null||j===void 0?void 0:j.shortcutFaqs.map(function(o){return o.uid})}),llm:S}),console.log("robotObject:",C),p.next=6,(0,X.$l)(C);case 6:y=p.sent,console.log("updateRobot response:",y),y.code===200?(v.yw.destroy(),v.yw.success(u.formatMessage({id:"update.success"})),a(y.data)):(v.yw.destroy(),v.yw.error(y.message));case 9:case"end":return p.stop()}},F)}));return function(S){return i.apply(this,arguments)}}(),V=function(){},E=function(F,S){return[(0,t.jsx)(W.ZP,{type:"default",onClick:function(){var r;(r=F.form)===null||r===void 0||r.resetFields()},children:"\u91CD\u7F6E"},"reset"),(0,t.jsx)(W.ZP,{type:"primary",onClick:function(){var r;(r=F.form)===null||r===void 0||r.submit()},children:"\u4FDD\u5B58"},"submit")]};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(be.Z,{message:"\u5927\u6A21\u578B\u6682\u672A\u652F\u6301\u4E91\u670D\u52A1\uFF0C\u5982\u9700\u4F7F\u7528\uFF0C\u53EF\u79C1\u6709\u90E8\u7F72\uFF0C\u5E76\u914D\u7F6E\u81EA\u6709key\u4F7F\u7528",action:(0,t.jsx)(W.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs")},children:"docs"})}),(0,t.jsx)(Ue.Z,{}),(0,t.jsxs)(G.A,{form:s,size:"large",submitter:{render:E,submitButtonProps:{size:"large",htmlType:"button"}},onFinish:_,children:[(0,t.jsx)(pe.Z,{width:"lg",name:"enabled",label:"enabled",tooltip:"\u542F\u7528\u5927\u6A21\u578B\u540E\uFF0C\u5C06\u4F1A\u5173\u95ED\u5173\u952E\u8BCD\u3002\u7528\u6237\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u5C06\u4F1A\u76F4\u63A5\u8BF7\u6C42\u5927\u6A21\u578B\u3002",fieldProps:{onChange:w}}),(0,t.jsx)(le.Z,{width:"lg",name:"prompt",label:"prompt",placeholder:"\u8BF7\u8F93\u5165prompt",rules:[{required:!0,message:"\u8BF7\u8F93\u5165prompt"}]}),(0,t.jsx)(ge.Z,{width:"lg",name:"model",label:"model",allowClear:!0,options:[{value:"ZHIPUAI_GLM_3_TURBO",label:"\u667A\u8C31AI-GLM-3-Turbo"},{value:"ZHIPUAI_GLM_4",label:"\u667A\u8C31AI-GLM-4"},{value:"OLLAMA",label:"Ollama"},{value:"OPENAI",label:"OpenAi",disabled:!0}],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5927\u6A21\u578B"}]}),(0,t.jsx)(he.Z,{width:"lg",label:"\u6E29\u5EA6",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E29\u5EA6"}]}),(0,t.jsx)(he.Z,{width:"lg",label:"\u4E0A\u4E0B\u6587\u6D88\u606F\u6570",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E0A\u4E0B\u6587\u6D88\u606F\u6570"}]})]})]})},Ne=Ae,ye=n(87603),Ze=function(){var u=(0,b.useIntl)(),c=(0,b.useNavigate)(),l=G.A.useForm(),s=q()(l,1),h=s[0],D=(0,oe.Z)(),Z=D.translateString,e=(0,z.V)(function(E){return{currentRobot:E.currentRobot,setCurrentRobot:E.setCurrentRobot}}),a=e.currentRobot,w=e.setCurrentRobot;(0,P.useEffect)(function(){var E;h.setFieldValue("enabled",!(a!=null&&(E=a.llm)!==null&&E!==void 0&&E.enabled)),h.setFieldValue("defaultReply",a==null?void 0:a.defaultReply)},[a]);var _=function(){var E=L()(x()().mark(function i(){return x()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:h.validateFields().then(function(){var f=L()(x()().mark(function r(d){var m,j,C,y,k,p,o;return x()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return console.log("TabKeyword handleSubmit",d),v.yw.loading(u.formatMessage({id:"updating"})),p=M()(M()({},a),{},{serviceSettings:M()(M()({},a==null?void 0:a.serviceSettings),{},{faqUids:a==null||(m=a.serviceSettings)===null||m===void 0||(m=m.faqs)===null||m===void 0?void 0:m.map(function(R){return R.uid}),quickFaqUids:a==null||(j=a.serviceSettings)===null||j===void 0?void 0:j.quickFaqs.map(function(R){return R.uid}),guessFaqUids:a==null||(C=a.serviceSettings)===null||C===void 0?void 0:C.guessFaqs.map(function(R){return R.uid}),hotFaqUids:a==null||(y=a.serviceSettings)===null||y===void 0?void 0:y.hotFaqs.map(function(R){return R.uid}),shortcutFaqUids:a==null||(k=a.serviceSettings)===null||k===void 0?void 0:k.shortcutFaqs.map(function(R){return R.uid})}),llm:M()(M()({},a==null?void 0:a.llm),{},{enabled:!d.enabled}),defaultReply:d.defaultReply}),console.log("robotObject:",p),$.next=6,(0,X.$l)(p);case 6:o=$.sent,console.log("updateRobot response:",o),o.code===200?(v.yw.destroy(),v.yw.success(u.formatMessage({id:"update.success"})),w(o.data)):(v.yw.destroy(),v.yw.error(o.message));case 9:case"end":return $.stop()}},r)}));return function(r){return f.apply(this,arguments)}}()).catch(function(f){console.log("Form errors:",f)});case 1:case"end":return S.stop()}},i)}));return function(){return E.apply(this,arguments)}}(),V=function(){var E=L()(x()().mark(function i(F){var S,f,r,d,m,j,C;return x()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return console.log("TabKeyword handleEnableChange",F),v.yw.loading(u.formatMessage({id:"updating"})),j=M()(M()({},a),{},{serviceSettings:M()(M()({},a==null?void 0:a.serviceSettings),{},{quickFaqUids:a==null||(S=a.serviceSettings)===null||S===void 0||(S=S.quickFaqs)===null||S===void 0?void 0:S.map(function(p){return p.uid}),faqUids:a==null||(f=a.serviceSettings)===null||f===void 0||(f=f.faqs)===null||f===void 0?void 0:f.map(function(p){return p.uid}),guessFaqUids:a==null||(r=a.serviceSettings)===null||r===void 0||(r=r.guessFaqs)===null||r===void 0?void 0:r.map(function(p){return p.uid}),hotFaqUids:a==null||(d=a.serviceSettings)===null||d===void 0||(d=d.hotFaqs)===null||d===void 0?void 0:d.map(function(p){return p.uid}),shortcutFaqUids:a==null||(m=a.serviceSettings)===null||m===void 0||(m=m.shortcutFaqs)===null||m===void 0?void 0:m.map(function(p){return p.uid})}),llm:M()(M()({},a==null?void 0:a.llm),{},{enabled:!F})}),console.log("robotObject:",j),k.next=6,(0,X.$l)(j);case 6:C=k.sent,console.log("updateRobot response:",C),C.code===200?(v.yw.destroy(),v.yw.success(u.formatMessage({id:"update.success"})),w(C.data)):(v.yw.destroy(),v.yw.error(C.message));case 9:case"end":return k.stop()}},i)}));return function(F){return E.apply(this,arguments)}}();return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(G.A,{form:h,onFinish:_,children:[(0,t.jsx)(pe.Z,{label:"\u662F\u5426\u542F\u7528\u5173\u952E\u8BCD",name:"enabled",tooltip:"\u542F\u7528\u5173\u952E\u5B57\u540E\uFF0C\u5C06\u4F1A\u5173\u95ED\u5927\u6A21\u578B\u3002\u7528\u6237\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u5982\u679C\u6D88\u606F\u5185\u5BB9\u5305\u542B\u5173\u952E\u5B57\uFF0C\u5219\u673A\u5668\u4EBA\u5C06\u5339\u914D\u5173\u952E\u5B57\u5E76\u81EA\u52A8\u56DE\u590D\u3002",fieldProps:{onChange:V}}),(0,t.jsx)(G.A.Item,{children:(0,t.jsx)(W.ZP,{icon:(0,t.jsx)(ye.Z,{}),onClick:function(){c("/kb/keyword/data")},children:"\u6DFB\u52A0\u5173\u952E\u5B57"},"github")}),(0,t.jsx)(le.Z,{width:"lg",label:"\u672A\u5339\u914D\u56DE\u590D\u8BED",name:"defaultReply"})]})})},$e=Ze,Ie=function(u){var c=u.type;return(0,t.jsx)("div",{children:"TODO: \u5BF9\u63A5fastgpt\u3001dify\u7B49\u5DE5\u5177"})},Be=Ie,Le=n(17167),qe=function(){return(0,t.jsx)("div",{children:(0,t.jsx)(Le.Z,{})})},Ve=qe,Ke=n(23035),We=n(51364),Ge=n(54050),He=n(10411),Xe=function(){var u=(0,b.useIntl)(),c=(0,b.useNavigate)(),l=G.A.useForm(),s=q()(l,1),h=s[0],D=(0,oe.Z)(),Z=D.translateString,e=(0,P.useState)(),a=q()(e,2),w=a[0],_=a[1],V=(0,Y.u)(function(r){return r.currentOrg}),E=(0,z.V)(function(r){return{currentRobot:r.currentRobot,setCurrentRobot:r.setCurrentRobot}}),i=E.currentRobot,F=E.setCurrentRobot,S=function(){var r=L()(x()().mark(function d(){var m,j;return x()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return v.yw.loading(u.formatMessage({id:"loading",defaultMessage:"Loading"})),m={pageNumber:0,pageSize:50,type:g.QP,orgUid:V.uid},y.next=4,(0,He.AP)(m);case 4:j=y.sent,console.log("getKeywordBase response:",m,j),v.yw.destroy(),j.code===200?_(j):v.yw.error(j.message);case 8:case"end":return y.stop()}},d)}));return function(){return r.apply(this,arguments)}}();(0,P.useEffect)(function(){S()},[]),(0,P.useEffect)(function(){h.setFieldValue("kbUid",i==null?void 0:i.kbUid)},[i]);var f=function(){var r=L()(x()().mark(function d(m){var j,C,y,k,p,o,U;return x()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return console.log("onFinish values:",m),o=M()(M()({},i),{},{serviceSettings:M()(M()({},i.serviceSettings),{},{faqUids:i==null||(j=i.serviceSettings)===null||j===void 0?void 0:j.faqs.map(function(N){return N.uid}),quickFaqUids:i==null||(C=i.serviceSettings)===null||C===void 0?void 0:C.quickFaqs.map(function(N){return N.uid}),guessFaqUids:i==null||(y=i.serviceSettings)===null||y===void 0?void 0:y.guessFaqs.map(function(N){return N.uid}),hotFaqUids:i==null||(k=i.serviceSettings)===null||k===void 0?void 0:k.hotFaqs.map(function(N){return N.uid}),shortcutFaqUids:i==null||(p=i.serviceSettings)===null||p===void 0?void 0:p.shortcutFaqs.map(function(N){return N.uid})}),kbUid:m.kbUid}),console.log("robotObject:",o),R.next=5,(0,X.$l)(o);case 5:U=R.sent,console.log("updateRobot response:",U),U.code===200?(v.yw.destroy(),v.yw.success(u.formatMessage({id:"update.success"})),F(U.data)):(v.yw.destroy(),v.yw.error(U.message));case 8:case"end":return R.stop()}},d)}));return function(m){return r.apply(this,arguments)}}();return(0,t.jsx)("div",{children:(0,t.jsxs)(G.A,{form:h,onFinish:f,children:[(0,t.jsx)(ge.Z,{width:"md",name:"kbUid",label:"\u77E5\u8BC6\u5E93",options:w==null?void 0:w.data.content.map(function(r){return{value:r.uid,label:Z(r.name)}}),fieldProps:{onChange:function(d){console.log("kbUid:",d)}}}),(0,t.jsx)(G.A.Item,{children:(0,t.jsx)(W.ZP,{icon:(0,t.jsx)(ye.Z,{}),onClick:function(){c("/kb/llm/data")},children:"\u6DFB\u52A0\u5927\u6A21\u578B\u77E5\u8BC6\u5E93"},"github")})]})})},ze=Xe,Ye=n(73453),Je=n(48489),Qe=n(91116),et=n(35791),tt=function(){var u=(0,b.useIntl)(),c=(0,P.useMemo)(function(){return!0},[]),l=[{key:"kb",label:(0,t.jsx)(b.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,t.jsx)(ze,{}),disabled:c},{key:"faq",label:(0,t.jsx)(b.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"Faq"}),children:(0,t.jsx)(De.Z,{type:g._X}),disabled:c},{key:"quickfaqs",label:(0,t.jsx)(b.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"QuickButton"}),children:(0,t.jsx)(We.Z,{type:g._X}),disabled:c},{key:"faqGuess",label:(0,t.jsx)(b.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FaqGuess"}),children:(0,t.jsx)(Oe.Z,{type:g._X}),disabled:c},{key:"faqHot",label:(0,t.jsx)(b.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FaqHot"}),children:(0,t.jsx)(ke.Z,{type:g._X}),disabled:c},{key:"faqShortcut",label:(0,t.jsx)(b.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FaqShortcut"}),children:(0,t.jsx)(Pe.Z,{type:g._X}),disabled:c},{key:"llm",label:(0,t.jsx)(b.FormattedMessage,{id:"llm",defaultMessage:"Llm"}),children:(0,t.jsx)(Ne,{}),disabled:c},{key:"keyword",label:(0,t.jsx)(b.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),children:(0,t.jsx)($e,{}),disabled:c},{key:"third",label:(0,t.jsx)(b.FormattedMessage,{id:"third",defaultMessage:"Third"}),children:(0,t.jsx)(Be,{type:g._X}),disabled:c},{key:"transfer",label:(0,t.jsx)(b.FormattedMessage,{id:"transfer",defaultMessage:"Transfer"}),children:(0,t.jsx)(Ve,{}),disabled:c},{key:"survey",label:(0,t.jsx)(b.FormattedMessage,{id:"survey",defaultMessage:"Survey"}),children:(0,t.jsx)(et.Z,{type:g._X}),disabled:c},{key:"history",label:(0,t.jsx)(b.FormattedMessage,{id:"history",defaultMessage:"History"}),children:(0,t.jsx)(Ye.Z,{type:g._X}),disabled:c},{key:"inputassociation",label:(0,t.jsx)(b.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,t.jsx)(Qe.Z,{type:g._X}),disabled:c},{key:"black",label:(0,t.jsx)(b.FormattedMessage,{id:"black",defaultMessage:"Black"}),children:(0,t.jsx)(Ge.Z,{type:g._X}),disabled:c},{key:"antiharassment",label:(0,t.jsx)(b.FormattedMessage,{id:"antiharassment",defaultMessage:"Anti Harassment"}),children:(0,t.jsx)(Ke.Z,{type:g._X}),disabled:c}];return(0,t.jsxs)(t.Fragment,{children:[c&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(be.Z,{message:"\u4F01\u4E1A\u7248-\u9AD8\u7EA7\u529F\u80FD",style:{marginBottom:20},type:"warning",action:(0,t.jsx)(W.ZP,{type:"link",icon:(0,t.jsx)(Je.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/")},children:u.formatMessage({id:"setting.helpdoc"})})})}),(0,t.jsx)(me.Z,{tabPosition:"left",items:l})]})},nt=tt,at=n(36649),rt=n(31207),ot=n(22268),st=n(58079),it=n(53004),lt=n(88484),ut=n(8232),dt=function(){var u=G.A.useForm(),c=q()(u,1),l=c[0],s=(0,b.useIntl)(),h=(0,oe.Z)(),D=h.translateString,Z=(0,z.V)(function(r){return{currentRobot:r.currentRobot,setCurrentRobot:r.setCurrentRobot}}),e=Z.currentRobot,a=Z.setCurrentRobot,w=(0,P.useState)(""),_=q()(w,2),V=_[0],E=_[1];(0,P.useEffect)(function(){if(e){var r;l.setFieldValue("nickname",D(e==null?void 0:e.nickname)),l.setFieldValue("welcomeTip",D(e==null||(r=e.serviceSettings)===null||r===void 0?void 0:r.welcomeTip)),l.setFieldValue("description",D(e==null?void 0:e.description))}},[e]);var i=function(){var r=L()(x()().mark(function d(m){var j,C,y,k,p,o;return x()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return console.log("onFinish:",m),v.yw.loading(s.formatMessage({id:"updating"})),p=M()(M()({},e),{},{serviceSettings:M()(M()({},e.serviceSettings),{},{welcomeTip:m.welcomeTip,quickFaqUids:e==null?void 0:e.serviceSettings.quickFaqs.map(function(R){return R.uid}),faqUids:e==null||(j=e.serviceSettings)===null||j===void 0?void 0:j.faqs.map(function(R){return R.uid}),guessFaqUids:e==null||(C=e.serviceSettings)===null||C===void 0?void 0:C.guessFaqs.map(function(R){return R.uid}),hotFaqUids:e==null||(y=e.serviceSettings)===null||y===void 0?void 0:y.hotFaqs.map(function(R){return R.uid}),shortcutFaqUids:e==null||(k=e.serviceSettings)===null||k===void 0?void 0:k.shortcutFaqs.map(function(R){return R.uid})}),nickname:m.nickname,description:m.description,avatar:V}),console.log("robotObject:",p),$.next=6,(0,X.$l)(p);case 6:o=$.sent,console.log("updateRobot response:",o),o.code===200?(v.yw.success(s.formatMessage({id:"update.success"})),a(o.data)):v.yw.error(o.message),v.yw.destroy();case 10:case"end":return $.stop()}},d)}));return function(m){return r.apply(this,arguments)}}(),F=function(d){console.log("handleUploadSuccess:",d),E(d)},S=function(d){console.log("handleUploadError:",d)},f=function(d){return console.log("Upload event:",d),Array.isArray(d)?d:d==null?void 0:d.fileList};return(0,P.useEffect)(function(){E(e==null?void 0:e.avatar)},[e]),(0,t.jsxs)(G.A,{form:l,style:{marginLeft:"100px"},onFinish:i,children:[(0,t.jsx)(ut.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:f,label:s.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,t.jsxs)(it.G,{onSuccess:F,onError:S,children:[(0,t.jsx)(te.C,{src:V}),(0,t.jsx)(W.ZP,{icon:(0,t.jsx)(lt.Z,{}),children:s.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,t.jsx)(fe.Z,{width:"md",name:"nickname",label:s.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),tooltip:s.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),placeholder:s.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),rules:[{required:!0,message:s.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"})}]}),(0,t.jsx)(le.Z,{width:"md",name:"welcomeTip",label:s.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),tooltip:s.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),placeholder:s.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),rules:[{required:!0,message:s.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"})}]}),(0,t.jsx)(le.Z,{width:"md",name:"description",label:s.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:s.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:s.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:s.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})},ct=dt,vt=n(59518),gt=function(){var u=(0,b.useIntl)(),c=(0,P.useState)([]),l=q()(c,2),s=l[0],h=l[1],D=[{key:"basic",label:u.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,t.jsx)(ct,{})},{key:"serviceSettings",label:u.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,t.jsx)(vt.Z,{type:g._X})},{key:"advanced",label:u.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,t.jsx)(nt,{})},{key:"channel",label:u.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,t.jsx)(at.Z,{type:g._X})},{key:"channelsocial",label:u.formatMessage({id:"channelsocial",defaultMessage:"Social Channel"}),children:(0,t.jsx)(st.Z,{type:g._X})},{key:"channelshop",label:u.formatMessage({id:"channelshop",defaultMessage:"Shop Channel"}),children:(0,t.jsx)(ot.Z,{type:g._X})},{key:"channelforeign",label:u.formatMessage({id:"channelforeign",defaultMessage:"Foreign Channel"}),children:(0,t.jsx)(rt.Z,{type:g._X})}];return(0,P.useEffect)(function(){if(0)var Z;h(D)},[]),(0,t.jsx)(me.Z,{defaultActiveKey:"basic",items:s})},ft=gt,mt=n(77154),bt=J.Z.Sider,pt=J.Z.Content,ht=function(){var u=(0,mt.Z)(),c=u.leftSiderStyle,l=u.leftSiderWidth,s=u.contentStyle;return(0,t.jsxs)(J.Z,{children:[(0,t.jsx)(bt,{width:l,style:c,children:(0,t.jsx)(Ce,{})}),(0,t.jsx)(J.Z,{children:(0,t.jsx)(pt,{style:s,children:(0,t.jsx)(ft,{})})})]})},yt=ht}}]);
