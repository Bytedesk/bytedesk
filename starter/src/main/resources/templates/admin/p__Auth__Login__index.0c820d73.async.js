(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[368],{90613:function(W,y,a){"use strict";var B=a(5574),d=a.n(B),T=a(67294),M=function(f,S){var x=(0,T.useState)(function(){try{var F=localStorage.getItem(f);return F?JSON.parse(F):(localStorage.setItem(f,JSON.stringify(S)),S)}catch(L){return localStorage.setItem(f,JSON.stringify(S)),S}}),j=d()(x,2),b=j[0],E=j[1],C=function(L){var h;if(typeof L=="function"){var P=L;h=P(b)}else h=L;localStorage.setItem(f,JSON.stringify(h)),E(h)};return[b,C]};y.Z=M},95627:function(W,y,a){"use strict";a.r(y),a.d(y,{default:function(){return se}});var B=a(15009),d=a.n(B),T=a(97857),M=a.n(T),O=a(99289),f=a.n(O),S=a(5574),x=a.n(S),j=a(27346),b=a(60109),E=a(87547),C=a(94149),F=a(24454),L=a(68262),h=a(5966),P=a(16434),J=a(63434),V=a(45660),g=a(86745),G=a(38925),R=a(31418),H=a(48096),Y=a(67294),k=a(73935),Q=a(67610),X=a(90613),Z=a(15832),q=Z.createLogger({level:"info",format:Z.format.json(),transports:[new Z.transports.Console]}),_=q,e=a(85893),U=function(N){var p=N.content;return(0,e.jsx)(G.Z,{style:{marginBottom:24},message:p,type:"error",showIcon:!0})},ee=function(){var N=R.Z.useApp(),p=N.message,re=(0,X.Z)("ACCESS_TOKEN",""),$=x()(re,2),ge=$[0],z=$[1],ne=(0,Y.useState)("account"),w=x()(ne,2),v=w[0],te=w[1],A=(0,g.useModel)("@@initialState"),I=A.initialState,ce=A.loading,de=A.refresh,oe=A.setInitialState,le=(0,V.l)(function(){return{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('/admin/assets/images/bg-wide.png')",backgroundSize:"100% 100%"}}),l=(0,g.useIntl)(),K=function(){var m=f()(d()().mark(function t(){var s,n;return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,I==null||(s=I.fetchUserInfo)===null||s===void 0?void 0:s.call(I);case 2:n=c.sent,n&&(0,k.flushSync)(function(){oe(function(r){return M()(M()({},r),{},{userInfo:n})})});case 4:case"end":return c.stop()}},t)}));return function(){return m.apply(this,arguments)}}(),ie=function(){var m=f()(d()().mark(function t(s){var n,o,c;return d()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,console.log("handleSubmit values: ",s),i.next=4,(0,j.x4)(M()({},s));case 4:if(n=i.sent,console.log("LoginResult:",n),!n.data.access_token){i.next=14;break}return z(n.data.access_token),o=l.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),p.success(o),i.next=12,K();case 12:return g.history.push("/"),i.abrupt("return");case 14:console.log(n),i.next=22;break;case 17:i.prev=17,i.t0=i.catch(0),c=l.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),console.log(i.t0),p.error(c);case 22:case"end":return i.stop()}},t,null,[[0,17]])}));return function(s){return m.apply(this,arguments)}}(),ue=function(){var m=f()(d()().mark(function t(s){var n,o,c,r;return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,console.log("handleMobileSubmit values: ",s),u.next=4,(0,j.N9)(M()({},s));case 4:if(n=u.sent,console.log("LoginMobileResult:",n),!n.data.access_token){u.next=15;break}return z(n.data.access_token),o=l.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),p.success(o),u.next=12,K();case 12:return c=new URL(window.location.href).searchParams,g.history.push(c.get("redirect")||"/"),u.abrupt("return");case 15:console.log(n),u.next=23;break;case 18:u.prev=18,u.t0=u.catch(0),r=l.formatMessage({id:v==="account"?"pages.login.failure":"pages.login.failureCode",defaultMessage:v==="account"?"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF01":"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),console.log(u.t0),p.error(r);case 23:case"end":return u.stop()}},t,null,[[0,18]])}));return function(s){return m.apply(this,arguments)}}();return(0,e.jsxs)("div",{className:le,children:[(0,e.jsx)(g.Helmet,{children:(0,e.jsxs)("title",{children:[l.formatMessage({id:"menu.login",defaultMessage:"\u767B\u5F55\u9875"}),"- ",Q.Z.title]})}),(0,e.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,e.jsxs)(L.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,e.jsx)("img",{alt:"logo",src:"/admin/icons/logo.png"}),title:"\u5FAE\u8BED",subTitle:l.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},actions:[],onFinish:function(){var m=f()(d()().mark(function t(s){var n,o;return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(v!=="account"){r.next=7;break}return n={username:s.username,password:s.password},console.log("login info:",n),r.next=5,ie(n);case 5:r.next=11;break;case 7:return o={mobile:s.mobile,code:s.code},console.log("login mobile info:",o),r.next=11,ue(o);case 11:case"end":return r.stop()}},t)}));return function(t){return m.apply(this,arguments)}}(),children:[(0,e.jsx)(H.Z,{activeKey:v,onChange:te,centered:!0,items:[{key:"account",label:l.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"})},{key:"mobile",label:l.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"})}]}),status==="error"&&v==="account"&&(0,e.jsx)(U,{content:l.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF"})}),v==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(E.Z,{})},placeholder:l.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,e.jsx)(h.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(C.Z,{})},placeholder:l.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]}),status==="error"&&v==="mobile"&&(0,e.jsx)(U,{content:"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),v==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(F.Z,{})},name:"mobile",placeholder:l.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,e.jsx)(P.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(C.Z,{})},captchaProps:{size:"large"},placeholder:l.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(t,s){return t?"".concat(s," ").concat(l.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):l.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],onGetCaptcha:function(){var m=f()(d()().mark(function t(s){var n,o;return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("mobile:",s),!(s&&s.length===11)){r.next=13;break}return n={mobile:s},r.next=5,(0,j.Y7)(n);case 5:if(o=r.sent,_.debug("sendMobileCode",o),o.code===200){r.next=10;break}return p.error(o.message),r.abrupt("return");case 10:p.success(o.message),r.next=14;break;case 13:p.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 14:case"end":return r.stop()}},t)}));return function(t){return m.apply(this,arguments)}}()})]}),(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(J.Z,{noStyle:!0,name:"autoLogin",children:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"\u81EA\u52A8\u767B\u5F55"})}),(0,e.jsx)("div",{style:{float:"right"},children:(0,e.jsx)(g.Link,{to:"/auth/register",children:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})})})]})]})}),(0,e.jsx)(b.$_,{})]})},ae=function(){return(0,e.jsx)(R.Z,{children:(0,e.jsx)(ee,{})})},se=ae},52361:function(){},94616:function(){},69862:function(){},40964:function(){},85811:function(){},50372:function(){},87886:function(){},62828:function(){}}]);
