"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5488],{43210:function(e,t,n){n.d(t,{Az:function(){return d},Xc:function(){return y},jX:function(){return m},tu:function(){return p}});var r=n(90819),o=n.n(r),a=n(73193),c=n.n(a),i=n(89933),u=n.n(i),l=n(55735),s=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/query/org",{method:"GET",params:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/create",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/update",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/delete",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51990:function(e,t,n){var r=n(73193),o=n.n(r),a=n(84176),c=n.n(a),i=n(86803),u=n(23864),l=n(44521),s=n(55735),d=n(30921),f=n(83905),p=(n(26286),n(28977)),g=n.n(p),y=n(44194),h=n(31549),m=["placeholder","defaultValue","value","style","toolbarKeys","onChange","options"];t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,a=e.style,p=e.toolbarKeys,v=e.onChange,w=(e.options,c()(e,m)),x=((0,d.useIntl)(),(0,u.Z)().isDarkMode),k=(0,y.useRef)(null),b=(0,y.useRef)(null);return(0,y.useEffect)((function(){if(k.current){if(!b.current){var e=new f.cW({element:k.current,theme:x?"dark":"light",placeholder:t,content:n,toolbarKeys:p,image:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var a=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,c=new FormData;return c.append("file",e),c.append("file_name",a),c.append("file_type",e.type),c.append("is_avatar","false"),c.append("kb_type",s.bE7),c.append("category_uid",""),c.append("kb_uid",""),c.append("client",s.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:c}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){i.yw.destroy(),i.yw.success("".concat(a," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:a}};e(n)}else i.yw.destroy(),i.yw.error("".concat(a," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var a=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,c=new FormData;return c.append("file",e),c.append("file_name",a),c.append("file_type",e.type),c.append("is_avatar","false"),c.append("kb_type",s.bE7),c.append("category_uid",""),c.append("kb_uid",""),c.append("client",s.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:c}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){i.yw.destroy(),i.yw.success("".concat(a," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else i.yw.destroy(),i.yw.error("".concat(a," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var a=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,c=new FormData;return c.append("file",e),c.append("file_name",a),c.append("file_type",e.type),c.append("is_avatar","false"),c.append("kb_type",s.bE7),c.append("category_uid",""),c.append("kb_uid",""),c.append("client",s.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:c}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){i.yw.destroy(),i.yw.success("".concat(a," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:a}};e(n)}else i.yw.destroy(),i.yw.error("".concat(a," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){"function"==typeof v&&v(e.getHtml(),e.getMarkdown())}});b.current=e}return function(){b.current&&(b.current.destroy(),b.current=null)}}}),[]),(0,y.useEffect)((function(){b.current&&r!==b.current.getHtml()&&b.current.setContent(r||"")}),[r]),(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("div",o()(o()({ref:k},w),{},{style:o()({height:"100%"},a)}))})}},8377:function(e,t,n){n.d(t,{Z:function(){return A}});var r=n(90819),o=n.n(r),a=n(89933),c=n.n(a),i=n(45332),u=n.n(i),l=n(15722),s=n(53530),d=n(27487),f=n(75365),p=n(79777),g=n(88996),y=n(78996),h=n(44194),m=n(32045),v=n(40612),w=n(86803),x=n(90838),k=n(76750),b=n(30921),C=n(6397),j=n(55735),Z=n(31549),A=function(e){var t=e.type,n=(0,b.useIntl)(),r=(0,h.useState)(!0),a=u()(r,2),i=a[0],A=a[1],M=(0,v.u)((function(e){return e.currentOrg})),P=(0,C.j)((function(e){return e.currentKbase})),S=(0,h.useState)(!1),U=u()(S,2),R=U[0],_=U[1],D=(0,x.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,setCategoryResult:e.setCategoryResult,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),H=D.categoryTreeOptions,O=D.setCategoryResult,E=D.currentCategory,T=D.setCurrentCategoryUid,z=(0,k.Z)(),I=z.translateString,V=z.translateStringTranct,F=s.Z.useModal(),Y=u()(F,2),L=Y[0],q=Y[1],K=function(){var e=c()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmit: ",t),i?w.yw.loading(n.formatMessage({id:"updating"})):w.yw.loading(n.formatMessage({id:"creating"})),!i){e.next=8;break}return e.next=5,(0,m.yr)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,m.k4)(t);case 10:e.t0=e.sent;case 11:r=e.t0,console.log("createCategory response: ",r),200===r.code?(w.yw.destroy(),i?w.yw.success(n.formatMessage({id:"update.success"})):w.yw.success(n.formatMessage({id:"create.success"})),_(!1),N()):(w.yw.destroy(),w.yw.error(r.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=c()(o()().mark((function e(){var r,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getCategories"),w.yw.success(n.formatMessage({id:"loading"})),r={pageNumber:0,pageSize:50,type:t,orgUid:null==M?void 0:M.uid},t!==j.hcJ&&(r.kbUid=null==P?void 0:P.uid),e.next=6,(0,m.XS)(r);case 6:a=e.sent,console.log("queryCategories response: ",a),200===a.code?(O(a),w.yw.destroy()):(w.yw.destroy(),w.yw.error(a.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=c()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditCategory: ",E),A(!0),_(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteCategory: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,h.useEffect)((function(){t!==j.hcJ&&N()}),[P]),(0,h.useEffect)((function(){t===j.hcJ&&N()}),[]);return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{margin:5},children:[(0,Z.jsx)(f.ZP,{type:"primary",size:"small",onClick:function(){A(!1),_(!0)},children:n.formatMessage({id:"create"})}),(0,Z.jsx)(f.ZP,{size:"small",onClick:N,children:"刷新"}),""!==(null==E?void 0:E.uid)&&"all"!==(null==E?void 0:E.uid)&&(0,Z.jsx)(f.ZP,{size:"small",onClick:X,children:n.formatMessage({id:"edit"})}),""!==(null==E?void 0:E.uid)&&"all"!==(null==E?void 0:E.uid)&&(0,Z.jsx)(f.ZP,{onClick:function(){return function(e){L.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,Z.jsx)(l.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(I(e.name),"】？"),onOk:function(){B(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(E)},size:"small",style:{float:"right"},danger:!0,children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,Z.jsx)(p.Z,{defaultSelectedKeys:[null==E?void 0:E.uid],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&T(e[0].toString())},treeData:H,blockNode:!0,titleRender:function(e){return(0,Z.jsx)(g.Z,{title:I(e.title),children:V(e.title)})}}),R&&(0,Z.jsx)(y.Z,{open:R,type:t,isEdit:i,onCancel:function(){_(!1)},onSubmit:K}),q]})}},40179:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});var r=n(98094),o=n(96865),a=n(75574),c=n(44194),i=n(8377),u=n(55735),l=n(70185),s=n(86803),d=n(90819),f=n.n(d),p=n(89933),g=n.n(p),y=n(43210),h=n(23864),m=n(76750),v=n(73193),w=n.n(v),x=n(76711),k=n.n(x),b=n(39701),C=n(83642),j=n(41617),Z=(0,b.Ue)()((0,C.mW)((0,C.tJ)((0,j.n)((function(e,t){return{currentArticle:{uid:"",orgUid:""},articleResult:{data:{content:[]}},insertArticle:function(t){e((function(e){e.articleResult.data.content.unshift(t)}))},updateArticle:function(t){e((function(e){var n=e.articleResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Article with uid ".concat(t.uid," not found."))}))},setArticleResult:function(n){var r;(e({articleResult:n}),""===t().currentArticle.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentArticle:n.data.content[0]}))},setCurrentArticle:function(n){var r=t().articleResult.data.content,o=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var a=[].concat(k()(r.slice(0,o)),[n],k()(r.slice(o+1))),c=w()(w()({},t().articleResult),{},{data:{content:a}});e({articleResult:c,currentArticle:n})}else console.warn("Article with the specified uid not found."),e({currentArticle:n})},removeArticle:function(n){var r=t().articleResult.data.content,o=r.findIndex((function(e){return e.uid===n}));-1!==o?e({articleResult:w()(w()({},t().articleResult),{},{data:{content:[].concat(k()(r.slice(0,o)),k()(r.slice(o+1)))}})}):console.warn("Article not found in cache:",n),t().currentArticle.uid===n&&e({currentArticle:{uid:"",orgUid:""}})},deleteArticleCache:function(){return e({},!0)}}})),{name:u.SsI}))),A=n(90838),M=n(6397),P=n(40612),S=n(72608),U=n(9452),R=n(31549),_=function(){var e=(0,h.Z)().isDarkMode,t=(0,c.useRef)(!1),n=(0,m.Z)().translateString,r=(0,P.u)((function(e){return e.currentOrg})),o=(0,M.j)((function(e){return e.currentKbase})),a=(0,A.v)((function(e){return e.currentCategory})),i=Z((function(e){return{currentArticle:e.currentArticle,articleResult:e.articleResult,setCurrentArticle:e.setCurrentArticle,setArticleResult:e.setArticleResult}})),l=i.currentArticle,s=i.articleResult,d=i.setCurrentArticle,p=i.setArticleResult,v=function(){var e=g()(f()().mark((function e(){var n,c;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,S.ZP.loading("loading"),n={pageNumber:0,pageSize:50,type:u.VX,categoryUid:"all"===(null==a?void 0:a.uid)?"":null==a?void 0:a.uid,kbUid:null==o?void 0:o.uid,orgUid:null==r?void 0:r.uid},e.next=8,(0,y.Az)(n);case 8:c=e.sent,console.log("queryArticlesByOrg: ",c),200===c.code?(S.ZP.destroy(),p(c)):(S.ZP.destroy(),S.ZP.error(c.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){console.log("useEffect"),v()}),[o,a]);return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(U.Z,{itemLayout:"horizontal",dataSource:s.data.content,renderItem:function(t,r){return(0,R.jsx)(U.Z.Item,{style:l.uid===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){d(t)},children:(0,R.jsx)(U.Z.Item.Meta,{style:{marginLeft:"10px",color:e?"#ffffff":"#000000"},title:n(t.title)})})}})})},D=n(45332),H=n.n(D),O=n(27487),E=n(52288),T=n(39042),z=n(75365),I=n(39632),V=n(51990),F=n(30921),Y=n(25482),L=n(55785),q=n(90297),K=n(44521),N=function(){var e=(0,F.useIntl)(),t=(0,h.Z)().isDarkMode,n=(0,c.useState)(!1),r=H()(n,2),o=r[0],a=r[1],i=(0,c.useState)(""),l=H()(i,2),s=l[0],d=l[1],p=(0,c.useState)(""),m=H()(p,2),v=m[0],x=m[1],k=(0,c.useState)(""),b=H()(k,2),C=b[0],j=b[1],U=(0,c.useRef)(!1),_=(0,P.u)((function(e){return e.currentOrg})),D=(0,M.j)((function(e){return e.currentKbase})),N=(0,A.v)((function(e){return e.currentCategory})),X=Z((function(e){return{currentArticle:e.currentArticle,insertArticle:e.insertArticle,setCurrentArticle:e.setCurrentArticle,updateLocalArticle:e.updateArticle}})),B=X.currentArticle,J=X.insertArticle,$=X.setCurrentArticle,G=X.updateLocalArticle;(0,c.useEffect)((function(){(null==B?void 0:B.kbUid)===(null==D?void 0:D.uid)&&(d(null==B?void 0:B.title),x(null==B?void 0:B.contentHtml),j(null==B?void 0:B.contentMarkdown))}),[B]);var W=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("create"),!U.current){t.next=4;break}return console.log("isLoading: 1",U.current),t.abrupt("return");case 4:return U.current=!0,S.ZP.loading(e.formatMessage({id:"creating"})),n={uid:null==B?void 0:B.uid,title:"new article",summary:"new article summary",contentHtml:"new article content",contentMarkdown:"new article content",type:u.VX,tags:["tag1","tag2"],markdown:o,published:!1,categoryUid:null==N?void 0:N.uid,kbUid:null==D?void 0:D.uid,orgUid:null==_?void 0:_.uid},console.log("create articleObject",n),t.next=10,(0,y.tu)(n);case 10:r=t.sent,console.log("createArticle response",r),200===r.code?(S.ZP.destroy(),S.ZP.info(e.formatMessage({id:"create.success"})),J(r.data),$(r.data)):(S.ZP.destroy(),S.ZP.error(r.message)),U.current=!1;case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Q=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("save",s,v),""!==s&&""!==v){t.next=4;break}return S.ZP.error("标题或内容不能为空！"),t.abrupt("return");case 4:if(!U.current){t.next=7;break}return console.log("isLoading: 1",U.current),t.abrupt("return");case 7:return U.current=!0,S.ZP.loading(e.formatMessage({id:"updating"})),n={uid:null==B?void 0:B.uid,title:s,summary:null==B?void 0:B.summary,contentHtml:v,contentMarkdown:C,type:null==B?void 0:B.type,tags:["tag1","tag2"],markdown:null==B?void 0:B.markdown,published:null==B?void 0:B.published,categoryUid:null==B?void 0:B.categoryUid,kbUid:null==B?void 0:B.kbUid,orgUid:null==B?void 0:B.orgUid},console.log("update articleObject",n),t.next=13,(0,y.Xc)(n);case 13:r=t.sent,console.log("updateArticle response",r),200===r.code?(S.ZP.destroy(),S.ZP.info(e.formatMessage({id:"update.success"})),G(r.data)):(S.ZP.destroy(),S.ZP.error(r.message)),U.current=!1;case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,c.useEffect)((function(){var e=w()(w()({},B),{},{title:s,contentHtml:v,contentMarkdown:C});G(e)}),[s,v,C]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{children:(0,R.jsxs)(O.Z,{gap:10,style:{marginBottom:10,marginTop:5},children:[(0,R.jsx)(E.Z,{size:"large",placeholder:"title",value:s,style:{background:t?"#141414":"#f5f5f5"},onChange:function(e){console.log("title onChange:",e.target.value),d(e.target.value)}}),(0,R.jsx)(T.Z,{checkedChildren:"Markdown",unCheckedChildren:"Html",onChange:function(e){console.log("switch to ".concat(e)),a(e)},defaultValue:o}),(0,R.jsx)(z.ZP,{type:"primary",icon:(0,R.jsx)(Y.Z,{}),onClick:W,children:"新建"}),(0,R.jsx)(z.ZP,{type:"default",icon:(0,R.jsx)(L.Z,{}),onClick:Q,children:"保存"}),(0,R.jsx)(z.ZP,{type:"default",icon:(0,R.jsx)(q.Z,{}),onClick:function(){console.log("handlePreviewArticle",B),window.open("".concat((0,K.kG)(),"/kb/").concat(null==D?void 0:D.uid,"/").concat(null==B?void 0:B.uid))},children:"预览"})]})}),o&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(I.ZP,{style:{height:"100%"},value:C,enablePreview:!0,onChange:function(e,t){console.log("markdown onChange value",e,t),j(e),x(e)}})}),!o&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(V.Z,{placeholder:"article content..",value:v,onChange:function(e,t){console.log("aiEditor onChange value",e,t),x(e),j(t)}})})]})},X=a.Z.Sider,B=a.Z.Content,J=function(){var e=(0,o.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(l.w,{children:(0,R.jsxs)(r.Z,{children:[(0,R.jsx)(s.ZP,{}),(0,R.jsxs)(a.Z,{children:[(0,R.jsx)(X,{style:t,children:(0,R.jsx)(i.Z,{type:u.VX})}),(0,R.jsx)(X,{style:t,children:(0,R.jsx)(_,{})}),(0,R.jsx)(a.Z,{children:(0,R.jsx)(B,{style:n,children:(0,R.jsx)(N,{})})})]})]})})})}}}]);