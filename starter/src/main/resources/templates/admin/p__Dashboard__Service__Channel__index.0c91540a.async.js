"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{78413:function(e,n,t){t.r(n),t.d(n,{default:function(){return tn}});var r=t(96865),a=t(75574),i=t(45332),u=t.n(i),o=t(23864),c=t(73193),l=t.n(c),s=t(76711),d=t.n(s),p=t(90069),f=t(39701),h=t(83642),m=t(41617),v=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var i=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),u=l()(l()({},n().llmproviderResult),{},{data:{content:i}});e({llmproviderResult:u,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:l()(l()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),g=t(9452),x=t(44194),y=t(31549),w=[{name:"web",nickname:"网站/H5"},{name:"react",nickname:"React"},{name:"vue",nickname:"Vue"},{name:"svelte",nickname:"Svelte"},{name:"vanilla",nickname:"Vanilla"},{name:"ios",nickname:"iOS"},{name:"android",nickname:"安卓"},{name:"uniapp",nickname:"Uniapp"},{name:"flutter",nickname:"Flutter"},{name:"wechat-mp",nickname:"微信公众号"},{name:"wechat-mini",nickname:"微信小程序"},{name:"wechat-work",nickname:"企业微信"},{name:"wechat-kefu",nickname:"微信客服"},{name:"douyin",nickname:"抖音"},{name:"xiaohongshu",nickname:"小红书"},{name:"baidu",nickname:"百度"},{name:"weibo",nickname:"微博"},{name:"bilibili",nickname:"哔哩哔哩"},{name:"zhihu",nickname:"知乎"},{name:"pdd",nickname:"拼多多"},{name:"jd",nickname:"京东"},{name:"qianniu",nickname:"千牛"},{name:"doudian",nickname:"抖店"},{name:"whatsapp",nickname:"Whatsapp"},{name:"telegram",nickname:"Telegram"},{name:"facebook",nickname:"Facebook"},{name:"line",nickname:"Line"},{name:"wordpress",nickname:"Wordpress"},{name:"shopify",nickname:"Shopify"},{name:"lazada",nickname:"Lazada"},{name:"woocommerce",nickname:"Woocommerce"},{name:"opencart",nickname:"Opencart"},{name:"magento",nickname:"Magento"},{name:"prestashop",nickname:"Prestashop"}],j=function(){var e=(0,o.Z)().isDarkMode,n=(0,x.useState)([]),t=u()(n,2),r=t[0],a=t[1],i=v((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),c=i.currentChannel,l=i.setCurrentChannel;return(0,x.useEffect)((function(){var e=[].concat(w);a(e)}),[]),(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(g.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,y.jsx)(g.Z.Item,{style:(null==c?void 0:c.name)===n.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){l(n)},children:(0,y.jsx)(g.Z.Item.Meta,{title:(0,y.jsx)("div",{style:{marginLeft:10},children:n.nickname})})})}})})},M=t(30921),k=t(67639),Z=t(90819),W=t.n(Z),b=t(89933),C=t.n(b),R=t(86803),S=t(24170),T=t(72614),I=t(76750),A=t(1902),E=t(40612),P=t(95490),F=t(67402),U=t(38775),z=t(9671),L=t(13161),q=t(79176),D=t(21325),N=t(53300),V=t(36378),O=t(11452),K=t(44574),B=t(75262),G=t(10354),X=t(51103),J=t(29897),_=t(76432),H=t(6897),$=t(62476),Q=t(15025),Y=z.Z.Title,ee=z.Z.Text,ne=function(e){var n=e.channel,t=(0,x.useRef)(!1),r=(0,I.Z)().translateString,a=v((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),i=a.currentType,o=a.setCurrentType,c=(0,E.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],s=(0,A.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),d=s.agentResult,f=s.currentAgent,h=s.setAgentResult,m=s.setCurrentAgent,g=(0,x.useState)([]),w=u()(g,2),j=w[0],M=w[1],k=(0,P.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),Z=k.workgroupResult,b=k.currentWorkgroup,z=k.setWorkgroupResult,ne=k.setCurrentWorkgroup,te=(0,x.useState)(null==f?void 0:f.uid),re=u()(te,2),ae=re[0],ie=re[1],ue=(0,x.useState)(null==b?void 0:b.uid),oe=u()(ue,2),ce=oe[0],le=oe[1],se=(0,x.useState)([]),de=u()(se,2),pe=de[0],fe=de[1],he=function(){var e=C()(W()().mark((function e(){var n,a,i;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==c?void 0:c.uid},e.next=8,(0,S._t)(n);case 8:a=e.sent,console.log("queryAgentsByOrg: ",a),200===a.code?(R.yw.destroy(),h(a),a.data.content.length>0&&(m(a.data.content[0]),ie(a.data.content[0].uid)),i=[],a.data.content.forEach((function(e){var n={label:r(e.nickname),value:e.uid};i.push(n)})),M(i)):(R.yw.destroy(),R.yw.error(a.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=C()(W()().mark((function e(){var n,a,i;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==c?void 0:c.uid},e.next=8,(0,T.u7)(n);case 8:a=e.sent,console.log("getWorkgroups",a),200===a.code?(R.yw.destroy(),z(a),a.data.content.length>0&&(ne(a.data.content[0]),le(a.data.content[0].uid)),i=[],a.data.content.forEach((function(e){var n={label:r(e.nickname),value:e.uid};i.push(n)})),fe(i)):(R.yw.destroy(),R.yw.error(a.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,x.useEffect)((function(){i===p.Njn?he():i===p.aZD?me():console.log("error type")}),[i]),(0,x.useEffect)((function(){console.log("currentAgent",f),null!=f&&f.uid&&ie(f.uid)}),[f]),(0,x.useEffect)((function(){console.log("currentWorkgroup",b),null!=b&&b.uid&&le(b.uid)}),[b]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(F.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),o(e.target.value)},options:l,defaultValue:i,optionType:"button",buttonStyle:"solid"}),(0,y.jsx)("br",{}),(0,y.jsx)("br",{}),i===p.Njn&&(null==f?void 0:f.uid)&&(0,y.jsx)(F.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=d.data.content.find((function(n){return n.uid===e.target.value}));m(n)},options:j,defaultValue:ae,optionType:"button",buttonStyle:"solid"}),i===p.aZD&&(null==f?void 0:f.uid)&&(0,y.jsx)(F.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=Z.data.content.find((function(n){return n.uid===e.target.value}));ne(n)},options:pe,defaultValue:ce,optionType:"button",buttonStyle:"solid"}),(0,y.jsx)(U.Z,{}),(0,y.jsx)(Y,{level:5,children:"组织orgUid"}),(0,y.jsx)(ee,{code:!0,copyable:!0,children:null==c?void 0:c.uid}),(0,y.jsx)(Y,{level:5,children:"一对一当前客服Uid"}),(0,y.jsx)(ee,{code:!0,copyable:!0,children:null==f?void 0:f.uid}),(0,y.jsx)(Y,{level:5,children:"当前技能组Uid"}),(0,y.jsx)(ee,{code:!0,copyable:!0,children:null==b?void 0:b.uid}),(0,y.jsx)(U.Z,{}),"douyin"===(null==n?void 0:n.name)&&(0,y.jsx)(L.Z,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,y.jsx)(q.Z,{}),"baidu"===(null==n?void 0:n.name)&&(0,y.jsx)(D.Z,{}),"weibo"===(null==n?void 0:n.name)&&(0,y.jsx)(N.Z,{}),"bilibili"===(null==n?void 0:n.name)&&(0,y.jsx)(V.Z,{}),"zhihu"===(null==n?void 0:n.name)&&(0,y.jsx)(O.Z,{}),"pdd"===(null==n?void 0:n.name)&&(0,y.jsx)(K.Z,{}),"jd"===(null==n?void 0:n.name)&&(0,y.jsx)(B.Z,{}),"qianniu"===(null==n?void 0:n.name)&&(0,y.jsx)(G.Z,{}),"doudian"===(null==n?void 0:n.name)&&(0,y.jsx)(X.Z,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,y.jsx)(J.Z,{}),"telegram"===(null==n?void 0:n.name)&&(0,y.jsx)(_.Z,{}),"line"===(null==n?void 0:n.name)&&(0,y.jsx)(H.Z,{}),"shopify"===(null==n?void 0:n.name)&&(0,y.jsx)($.Z,{}),"lazada"===(null==n?void 0:n.name)&&(0,y.jsx)(Q.Z,{})]})},te=t(7785),re=t(54518),ae=t(45178),ie=t(42909),ue=t(81360),oe=t(5724),ce=t(99980),le=t(66329),se=t(30634),de=function(e){var n=e.channel;return(0,y.jsxs)(y.Fragment,{children:["web"===(null==n?void 0:n.name)&&(0,y.jsx)(se.Z,{type:p._X4}),"react"===(null==n?void 0:n.name)&&(0,y.jsx)(ie.Z,{type:n.type}),"vue"===(null==n?void 0:n.name)&&(0,y.jsx)(le.Z,{type:n.type}),"angular"===(null==n?void 0:n.name)&&(0,y.jsx)(ie.Z,{type:n.type}),"svelte"===(null==n?void 0:n.name)&&(0,y.jsx)(ue.Z,{type:n.type}),"vanilla"===(null==n?void 0:n.name)&&(0,y.jsx)(ce.Z,{type:n.type}),"ios"===(null==n?void 0:n.name)&&(0,y.jsx)(ae.Z,{type:n.type}),"android"===(null==n?void 0:n.name)&&(0,y.jsx)(te.Z,{type:n.type}),"uniapp"===(null==n?void 0:n.name)&&(0,y.jsx)(oe.Z,{type:n.type}),"flutter"===(null==n?void 0:n.name)&&(0,y.jsx)(re.Z,{type:n.type})]})},pe=t(79686),fe=t(40803),he=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatMpResult:{data:{content:[]}},currentWechatMp:{uid:"",nickname:"",avatar:"",description:""},insertWechatMp:function(n){e((function(e){e.wechatMpResult.data.content.unshift(n)}))},updateWechatMp:function(n){e((function(e){var t=e.wechatMpResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatMp with uid ".concat(n.uid," not found."))}))},deleteWechatMp:function(n){e((function(e){var t=e.wechatMpResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatMp with uid ".concat(n.uid," not found."))}))},setWechatMpResult:function(t){var r;(e({wechatMpResult:t}),""===n().currentWechatMp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatMp:t.data.content[0]}))},setCurrentWechatMp:function(t){var r=n().wechatMpResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var i=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),u=l()(l()({},n().wechatMpResult),{},{data:{content:i}});e({wechatMpResult:u,currentWechatMp:t})}else console.warn("WechatMp with the specified uid not found."),e({currentWechatMp:t})},deleteCurrentWechatMp:function(t){var r=n().wechatMpResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatMpResult:l()(l()({},n().wechatMpResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatMp not found in cache:",t),n().currentWechatMp.uid===t&&e({currentWechatMp:{uid:""}})},deleteWechatMpCache:function(){return e({},!0)}}})),{name:p._SZ}))),me=t(67444),ve=t(70458),ge=t(53530),xe=t(27487),ye=t(75365),we=t(63289),je=function(){var e=(0,M.useIntl)(),n=(0,x.useRef)(!1),t=(0,I.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,x.useState)(!1),i=u()(a,2),c=i[0],l=i[1],s=(0,x.useState)(!1),d=u()(s,2),p=d[0],f=d[1],h=(0,E.u)((function(e){return e.currentOrg})),m=he((function(e){return{wechatMpResult:e.wechatMpResult,currentWechatMp:e.currentWechatMp,setWechatMpResult:e.setWechatMpResult,insertWechatMp:e.insertWechatMp,setCurrentWechatMp:e.setCurrentWechatMp,deleteCurrentWechatMp:e.deleteCurrentWechatMp}})),v=m.wechatMpResult,w=m.currentWechatMp,j=m.setWechatMpResult,k=m.insertWechatMp,Z=m.setCurrentWechatMp,b=m.deleteCurrentWechatMp,S=ge.Z.useModal(),T=u()(S,2),A=T[0],P=T[1],F=function(){var n=C()(W()().mark((function n(t){var r;return W()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete wechatMp",t),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,(0,fe.ul)(t);case 4:r=n.sent,console.log("delete wechatMp response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),b(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),U=function(){var e=C()(W()().mark((function e(){var t,r;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:h.uid},e.next=8,(0,fe.aq)(t);case 8:r=e.sent,console.log("getWechatMps",r),200===r.code?(R.yw.destroy(),j(r)):(R.yw.destroy(),R.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){U()}),[]);var z=function(){var e=C()(W()().mark((function e(n){var t;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,fe._Z)(n);case 2:t=e.sent,console.log("handleCreateWechatMp response:",t),200===t.code?(k(t.data),l(!1)):R.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=C()(W()().mark((function e(n){var t;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==w?void 0:w.uid,e.next=3,(0,fe.sS)(n);case 3:t=e.sent,console.log("handleUpdateWechatMp response:",t),200===t.code?(Z(t.data),l(!1)):R.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(xe.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,y.jsx)(ye.ZP,{size:"small",type:"primary",icon:(0,y.jsx)(ve.Z,{}),onClick:function(){l(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,y.jsx)(ye.ZP,{size:"small",onClick:function(){f(!0),l(!0)},disabled:w&&""===w.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,y.jsx)(ye.ZP,{size:"small",danger:!0,onClick:function(){return n=w,void A.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,y.jsx)(me.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){F(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n},disabled:w&&""===w.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,y.jsx)(g.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,y.jsx)(g.Z.Item,{style:w.uid===e.uid?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Z(e)},children:(0,y.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,y.jsx)(y.Fragment,{children:t(e.name)}),description:t(e.description)})})}}),c&&(0,y.jsx)(we.Z,{isEdit:p,open:c,wechatmp:w,onClose:function(){l(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?L(e):z(e)}}),P]})},Me=function(){var e=he((function(e){return{currentWechatMp:e.currentWechatMp}})).currentWechatMp;return(0,y.jsx)(y.Fragment,{children:""!==(null==e?void 0:e.uid)&&(0,y.jsxs)("div",{className:"flex items-center justify-end",children:[(0,y.jsxs)("p",{children:["URL: ",e.url,(0,y.jsx)(ye.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.url),R.yw.success("URL已复制")},children:"复制"})]}),(0,y.jsxs)("p",{children:["Token: ",e.token,(0,y.jsx)(ye.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.token),R.yw.success("Token已复制")},children:"复制"})]})]})})},ke=function(e){console.log(e)},Ze=[{key:"agent",label:"客服管理",children:(0,y.jsx)(Me,{})}],We=function(){var e=(0,x.useState)([]),n=u()(e,2),t=n[0],r=n[1];return(0,x.useEffect)((function(){var e=[].concat(Ze);r(e)}),[]),(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(k.Z,{defaultActiveKey:"agent",items:t,onChange:ke})})},be=a.Z.Sider,Ce=a.Z.Content,Re=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,y.jsxs)(a.Z,{children:[(0,y.jsx)(be,{width:t,style:n,children:(0,y.jsx)(je,{})}),(0,y.jsx)(a.Z,{children:(0,y.jsx)(Ce,{children:(0,y.jsx)(We,{})})})]})};function Se(e){return Te.apply(this,arguments)}function Te(){return(Te=C()(W()().mark((function e(n){return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/mini/create",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=C()(W()().mark((function e(n){return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/mini/update",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=C()(W()().mark((function e(n){return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/mini/delete",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=C()(W()().mark((function e(n){return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/mini/query/org",{method:"GET",params:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatMiniResult:{data:{content:[]}},currentWechatMini:{uid:"",nickname:"",avatar:"",description:""},insertWechatMini:function(n){e((function(e){e.wechatMiniResult.data.content.unshift(n)}))},updateWechatMini:function(n){e((function(e){var t=e.wechatMiniResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatMini with uid ".concat(n.uid," not found."))}))},deleteWechatMini:function(n){e((function(e){var t=e.wechatMiniResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatMini with uid ".concat(n.uid," not found."))}))},setWechatMiniResult:function(t){var r;(e({wechatMiniResult:t}),""===n().currentWechatMini.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatMini:t.data.content[0]}))},setCurrentWechatMini:function(t){var r=n().wechatMiniResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var i=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),u=l()(l()({},n().wechatMiniResult),{},{data:{content:i}});e({wechatMiniResult:u,currentWechatMini:t})}else console.warn("WechatMini with the specified uid not found."),e({currentWechatMini:t})},deleteCurrentWechatMini:function(t){var r=n().wechatMiniResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatMiniResult:l()(l()({},n().wechatMiniResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatMini not found in cache:",t),n().currentWechatMini.uid===t&&e({currentWechatMini:{uid:""}})},deleteWechatMiniCache:function(){return e({},!0)}}})),{name:p.I5N}))),Le=t(99811),qe=t(4499),De=t(84881),Ne=t(73442),Ve=t(3849),Oe=function(e){var n,t=e.isEdit,r=e.wechatmini,a=e.open,i=e.onClose,o=e.onSubmit,c=Le.A.useForm(),s=u()(c,1)[0],d=(0,I.Z)().translateStringTranct,p=(0,E.u)((function(e){return e.currentOrg})),f=(0,P.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),h=f.workgroupResult,m=f.setWorkgroupResult;(0,x.useEffect)((function(){t?s.setFieldsValue({name:null==r?void 0:r.name,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,dataType:null==r?void 0:r.dataType,workgroupUid:null==r?void 0:r.workgroupUid}):s.setFieldsValue({name:"",appId:"",appSecret:"",encodingAesKey:"",encryptMode:"PLAINTEXT",dataType:"xml",workgroupUid:""})}),[t,r,s]);var v=function(){var e=C()(W()().mark((function e(){var n,t;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:p.uid},e.next=4,(0,T.u7)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),m(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){v()}),[]);return(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(Ne.Z,{title:"微信小程序",onClose:i,open:a,children:(0,y.jsxs)(Le.A,{form:s,name:"wechatMiniForm",onFinish:function(){console.log("handleSubmit"),s.validateFields().then((function(e){var n=l()(l()({},e),{},{orgUid:null==p?void 0:p.uid});console.log("submit",n),o(n)}))},children:[(0,y.jsx)(qe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,y.jsx)(qe.Z,{label:"appId",name:"appId",rules:[{required:!0}]}),(0,y.jsx)(qe.Z,{label:"appSecret",name:"appSecret",rules:[{required:!0}]}),(0,y.jsx)(qe.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}]}),(0,y.jsxs)(Ve.Z,{children:[(0,y.jsx)(ye.ZP,{onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}s.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,y.jsx)(ye.ZP,{onClick:function(){var e=s.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]}),(0,y.jsx)(De.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"明文模式",value:"PLAINTEXT"},{label:"兼容模式",value:"COMPATIBLE"},{label:"安全模式",value:"SAFE"}],fieldProps:{defaultValue:"PLAINTEXT",allowClear:!0},rules:[{required:!0}]}),(0,y.jsx)(qe.Z,{label:"数据格式",name:"dataType",rules:[{required:!0}],disabled:!0}),(0,y.jsx)(De.Z,{label:"客服技能组",name:"workgroupUid",options:null==h||null===(n=h.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:d(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,y.jsx)("p",{children:"注：微信公众号-》设置与开发-》开发接口管理-》基本设置 获取相关信息"})]})})})},Ke=function(){var e=(0,M.useIntl)(),n=(0,x.useRef)(!1),t=(0,I.Z)().translateStringTranct,r=(0,o.Z)().isDarkMode,a=(0,x.useState)(!1),i=u()(a,2),c=i[0],l=i[1],s=(0,x.useState)(!1),d=u()(s,2),p=d[0],f=d[1],h=(0,E.u)((function(e){return e.currentOrg})),m=ze((function(e){return{wechatMiniResult:e.wechatMiniResult,currentWechatMini:e.currentWechatMini,setWechatMiniResult:e.setWechatMiniResult,insertWechatMini:e.insertWechatMini,setCurrentWechatMini:e.setCurrentWechatMini,deleteCurrentWechatMini:e.deleteCurrentWechatMini}})),v=m.wechatMiniResult,w=m.currentWechatMini,j=m.setWechatMiniResult,k=m.insertWechatMini,Z=m.setCurrentWechatMini,b=m.deleteCurrentWechatMini,S=ge.Z.useModal(),T=u()(S,2),A=T[0],P=T[1],F=function(){var n=C()(W()().mark((function n(t){var r;return W()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete wechatMini",t),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,Ee(t);case 4:r=n.sent,console.log("delete wechatMini response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),b(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),U=function(){var e=C()(W()().mark((function e(){var t,r;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:h.uid},e.next=8,Fe(t);case 8:r=e.sent,console.log("getWechatMinis",r),200===r.code?(R.yw.destroy(),j(r)):(R.yw.destroy(),R.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){U()}),[]);var z=function(){var e=C()(W()().mark((function e(n){var t;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se(n);case 2:t=e.sent,console.log("handleCreateWechatMini response:",t),200===t.code?(k(t.data),l(!1)):R.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=C()(W()().mark((function e(n){var t;return W()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==w?void 0:w.uid,e.next=3,Ie(n);case 3:t=e.sent,console.log("handleUpdateWechatMini response:",t),200===t.code?(Z(t.data),l(!1)):R.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(xe.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,y.jsx)(ye.ZP,{size:"small",type:"primary",icon:(0,y.jsx)(ve.Z,{}),onClick:function(){l(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,y.jsx)(ye.ZP,{size:"small",onClick:function(){f(!0),l(!0)},disabled:w&&""===w.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,y.jsx)(ye.ZP,{size:"small",danger:!0,onClick:function(){return n=w,void A.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,y.jsx)(me.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){F(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n},disabled:w&&""===w.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,y.jsx)(g.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,y.jsx)(g.Z.Item,{style:w.uid===e.uid?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Z(e)},children:(0,y.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,y.jsx)(y.Fragment,{children:t(e.name)}),description:t(e.description)})})}}),c&&(0,y.jsx)(Oe,{isEdit:p,open:c,wechatmini:w,onClose:function(){l(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?L(e):z(e)}}),P]})},Be=function(){var e=ze((function(e){return{currentWechatMini:e.currentWechatMini}})).currentWechatMini;return(0,y.jsx)(y.Fragment,{children:""!==(null==e?void 0:e.uid)&&(0,y.jsxs)("div",{className:"flex items-center justify-end",children:[(0,y.jsxs)("p",{children:["URL: ",e.url,(0,y.jsx)(ye.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.url),R.yw.success("URL已复制")},children:"复制"})]}),(0,y.jsxs)("p",{className:"ml-2",children:["Token: ",e.token,(0,y.jsx)(ye.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.token),R.yw.success("Token已复制")},children:"复制"})]})]})})},Ge=function(e){console.log(e)},Xe=[{key:"agent",label:"客服管理",children:(0,y.jsx)(Be,{})}],Je=function(){var e=(0,x.useState)([]),n=u()(e,2),t=n[0],r=n[1];return(0,x.useEffect)((function(){var e=[].concat(Xe);r(e)}),[]),(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(k.Z,{defaultActiveKey:"agent",items:t,onChange:Ge})})},_e=a.Z.Sider,He=a.Z.Content,$e=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,y.jsxs)(a.Z,{children:[(0,y.jsx)(_e,{width:t,style:n,children:(0,y.jsx)(Ke,{})}),(0,y.jsx)(a.Z,{children:(0,y.jsx)(He,{children:(0,y.jsx)(Je,{})})})]})},Qe=function(e){var n=e.channel,t=(0,x.useState)([]),r=u()(t,2),a=r[0],i=r[1],o=(0,x.useState)(!0),c=u()(o,2),l=c[0],s=c[1];return(0,x.useEffect)((function(){var e=[];"web"===(null==n?void 0:n.name)||"react"===(null==n?void 0:n.name)||"vue"===(null==n?void 0:n.name)||"angular"===(null==n?void 0:n.name)||"svelte"===(null==n?void 0:n.name)||"vanilla"===(null==n?void 0:n.name)||"ios"===(null==n?void 0:n.name)||"android"===(null==n?void 0:n.name)||"flutter"===(null==n?void 0:n.name)||"uniapp"===(null==n?void 0:n.name)?(s(!0),e.push({key:"info",label:"基本信息",children:(0,y.jsx)(ne,{channel:n})},{key:"code",label:"客服代码",children:(0,y.jsx)(de,{channel:n})})):s(!1),i(e)}),[n]),(0,y.jsxs)("div",{style:{padding:"0 24px"},children:[l&&(0,y.jsx)(k.Z,{defaultActiveKey:"info",items:a}),"wechat-mp"===(null==n?void 0:n.name)&&(0,y.jsx)(Re,{}),"wechat-mini"===(null==n?void 0:n.name)&&(0,y.jsx)($e,{}),"wechat-work"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"wechat-kefu"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"douyin"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"baidu"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"weibo"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"bilibili"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"zhihu"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"pdd"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"jd"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"qianniu"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"doudian"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"telegram"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"facebook"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"line"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"shopify"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"lazada"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"wordpress"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"opencart"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"magento"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{}),"prestashop"===(null==n?void 0:n.name)&&(0,y.jsx)(pe.Z,{})]})},Ye=function(){(0,M.useIntl)();var e=(0,x.useState)(""),n=u()(e,2),t=n[0],r=n[1],a=(0,x.useState)([]),i=u()(a,2),o=i[0],c=i[1],l=v().currentChannel;(0,x.useEffect)((function(){l&&s(l)}),[l]);var s=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&c([].concat(d()(o),[{label:e.nickname,key:n,children:(0,y.jsx)(Qe,{channel:e}),channelInfo:e,closable:!0}])),r(n)};return(0,y.jsx)(k.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),a=o.filter((function(n){return n.key!==e}));if(a.length&&e===t){var i=a[n===a.length?n-1:n].key;r(i)}c(a)}(e)},items:o})},en=a.Z.Sider,nn=a.Z.Content,tn=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(a.Z,{children:[(0,y.jsx)(en,{style:n,children:(0,y.jsx)(j,{})}),(0,y.jsx)(a.Z,{children:(0,y.jsx)(nn,{style:t,children:(0,y.jsx)(Ye,{})})})]})})}}}]);