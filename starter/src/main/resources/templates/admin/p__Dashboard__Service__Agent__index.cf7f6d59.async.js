"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{32863:function(e,t,n){var r=n(17082),a=n(51190),s=n(44194),i=n(39647),u=n(31549),o=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.request,l=e.params,c=e.proFieldProps,d=(0,a.Z)(e,o);return(0,u.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:s,params:l,filedConfig:{customLightMode:!0},proFieldProps:c},d))},c=s.forwardRef(l);t.Z=c},66765:function(e,t,n){var r=n(5728);t.ZP=r.A},48619:function(e,t,n){n.d(t,{NX:function(){return d},O9:function(){return m},ZG:function(){return g},bN:function(){return v}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(77667),c=n(82045);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/autoreply/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},78477:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return v},t5:function(){return g},v_:function(){return m}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(77667),c=n(82045);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77849:function(e,t,n){n.d(t,{D$:function(){return m},EP:function(){return v},hS:function(){return g},z_:function(){return d}});var r=n(90819),a=n.n(r),s=n(73193),i=n.n(s),u=n(89933),o=n.n(u),l=n(77667),c=n(82045);function d(e){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=o()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},74382:function(e,t,n){n.r(t),n.d(t,{default:function(){return se}});var r=n(64476),a=n(44194),s=n(45332),i=n.n(s),u=n(50571),o=n(90819),l=n.n(o),c=n(73193),d=n.n(c),f=n(89933),m=n.n(f),p=n(89756),g=n(81153),h=n(1780),v=n(85702),b=n(77667),y=n(39701),x=n(83642),w=n(41617),j=(0,y.Ue)()((0,x.mW)((0,x.tJ)((0,w.n)((function(e,t){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(t){e((function(e){e.memberResult.data.content.unshift(t)}))},updateMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Member with uid ".concat(t.uid," not found."))}))},deleteMember:function(t){e((function(e){var n=e.memberResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Member with uid ".concat(t.uid," not found."))}))},setMemberResult:function(t){e({memberResult:t})},deleteMemberCache:function(){return e({},!0)}}})),{name:b.PQL}))),k=n(92349),M=n(69957),q=n(5728),S=n(43688),Z=n(11607),F=n(82045),A=n(21276),C=n(12265),P=n(31549),V=function(){var e=q.A.useForm(),t=i()(e,1)[0],n=(0,F.useIntl)(),r=(0,h.Z)().translateString,s=(j((function(e){return e.memberResult})),(0,v.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}}))),u=s.currentAgent,o=s.setCurrentAgent,c=(0,a.useState)(""),f=i()(c,2),b=f[0],y=f[1];(0,a.useEffect)((function(){var e;u&&t.setFieldsValue({nickname:r(null==u?void 0:u.nickname),email:null==u?void 0:u.email,mobile:null==u?void 0:u.mobile,description:r(null==u?void 0:u.description),memberUid:null==u||null===(e=u.member)||void 0===e?void 0:e.uid})}),[u]);var x=function(){var e=m()(l()().mark((function e(t){var r,a,s,i,c,f,m,h,v;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),p.yw.loading(n.formatMessage({id:"updating"})),h=d()(d()(d()({},u),t),{},{avatar:b,serviceSettings:d()(d()({},u.serviceSettings),{},{quickFaqUids:null==u||null===(r=u.serviceSettings)||void 0===r||null===(r=r.quickFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null==u||null===(a=u.serviceSettings)||void 0===a||null===(a=a.faqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==u||null===(s=u.serviceSettings)||void 0===s||null===(s=s.guessFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),hotFaqUids:null==u||null===(i=u.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==u||null===(c=u.serviceSettings)||void 0===c||null===(c=c.shortcutFaqs)||void 0===c?void 0:c.map((function(e){return e.uid}))}),robotSettings:d()(d()({},u.robotSettings),{},{robotUid:null===(f=u.robotSettings)||void 0===f||null===(f=f.robot)||void 0===f?void 0:f.uid}),leaveMsgSettings:d()(d()({},u.leaveMsgSettings),{},{worktimeUids:null==u||null===(m=u.leaveMsgSettings)||void 0===m||null===(m=m.worktimes)||void 0===m?void 0:m.map((function(e){return e.uid}))}),autoReplySettings:d()({},u.autoReplySettings)}),console.log("agentObject:",h),e.next=6,(0,g.sE)(h);case 6:v=e.sent,console.log("updateAgent response:",v),200===v.code?(p.yw.destroy(),p.yw.success(n.formatMessage({id:"update.success"})),o(v.data)):(p.yw.destroy(),p.yw.error(v.message));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e;u&&(y(u.avatar),t.setFieldsValue({member:null==u||null===(e=u.member)||void 0===e?void 0:e.nickname}))}),[u]),(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(q.A,{form:t,style:{marginLeft:"100px"},onFinish:x,children:[(0,P.jsx)(q.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:n.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,P.jsxs)(k.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),y(e)},onError:function(e){console.log("handleUploadError:",e),p.yw.error(e)},children:[(0,P.jsx)(A.C,{src:b}),(0,P.jsx)(C.ZP,{icon:(0,P.jsx)(M.Z,{}),children:n.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,P.jsx)(S.Z,{width:"md",name:"nickname",label:"客服卡片-展示客服昵称",rules:[{required:!0,message:"请输入客服昵称"}]}),(0,P.jsx)(S.Z,{width:"md",name:"email",label:"客服卡片-展示邮箱",rules:[{required:!0,message:"请输入邮箱"}]}),(0,P.jsx)(S.Z,{width:"md",name:"mobile",label:"客服卡片-展示手机号",rules:[{required:!0,message:"请输入手机号"}]}),(0,P.jsx)(Z.Z,{width:"md",name:"description",label:"客服卡片-展示描述",rules:[{required:!0,message:"请输入描述"}]}),(0,P.jsx)(S.Z,{width:"md",name:"member",label:"绑定成员",disabled:!0})]})})},R=n(93982),U=n(89875),E=n(18874),T=n(66772),O=(n(13253),n(9750),n(57545),n(90588)),N=n(10187),I=(n(48619),n(78477),n(40431)),L=(n(40574),n(16655)),z=(n(64859),n(28243),function(){var e=(0,F.useIntl)(),t=(0,a.useMemo)((function(){return!1}),[]),n=[{key:"faq",label:(0,P.jsx)(F.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"FAQ"}),children:(0,P.jsx)(U.Z,{type:b.Njn}),disabled:t},{key:"quickFaqs",label:(0,P.jsx)(F.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"QuickButton"}),children:(0,P.jsx)(O.Z,{type:b.Njn}),disabled:t},{key:"faqGuess",label:(0,P.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FaqGuess"}),children:(0,P.jsx)(N.Z,{type:b.Njn}),disabled:t},{key:"faqHot",label:(0,P.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FaqHot"}),children:(0,P.jsx)(E.Z,{type:b.Njn}),disabled:t},{key:"faqShortcut",label:(0,P.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FaqShortcut"}),children:(0,P.jsx)(T.Z,{type:b.Njn}),disabled:t}],r=(0,a.useState)([]),s=i()(r,2),o=s[0],l=s[1];return(0,a.useEffect)((function(){l(n)}),[]),(0,P.jsxs)(P.Fragment,{children:[t&&(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(R.Z,{message:"企业版-高级功能",style:{marginBottom:20},type:"warning",action:(0,P.jsx)(C.ZP,{type:"link",icon:(0,P.jsx)(L.Z,{}),onClick:function(){return window.open(b.VPj)},children:e.formatMessage({id:"setting.helpcenter"})})})}),(0,P.jsx)(u.Z,{tabPosition:"left",items:o})]})}),D=n(82639),G=(n(65352),n(89242),n(19743),n(3321)),_=function(){var e=(0,F.useIntl)(),t=(0,a.useState)([]),n=i()(t,2),r=n[0],s=n[1],o=[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,P.jsx)(V,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,P.jsx)(G.Z,{type:b.Njn})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,P.jsx)(z,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,P.jsx)(D.Z,{type:b.Njn})}];return(0,a.useEffect)((function(){s(o)}),[]),(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(u.Z,{defaultActiveKey:"basic",items:r})})},B=n(74145),H=n(50484),Q=n(70458),W=n(83730),$=n(80093),J=n(90136),K=n(66765),X=n(32863),Y=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=K.ZP.useForm(),u=i()(s,1)[0],o=(0,I.u)((function(e){return e.currentOrg})),l=j((function(e){return e.memberResult})),c=(0,a.useMemo)((function(){for(var e,t,n=[],r=0;r<l.data.content.length;r++){var a={title:"",value:"",children:[]};e=l.data.content[r],(t=a).title=e.nickname,t.value=e.uid,n.push(a)}return n}),[l]);return(0,P.jsx)("div",{children:(0,P.jsx)(W.Z,{title:"创建客服",open:t,forceRender:!0,onOk:function(){console.log("handleOk"),u.validateFields().then((function(e){console.log("form values:",e);var t={nickname:u.getFieldValue("nickname"),email:u.getFieldValue("email"),mobile:u.getFieldValue("mobile"),memberUid:u.getFieldValue("memberUid"),orgUid:o.uid};console.log("agent:",t),r(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),n()},children:(0,P.jsxs)(K.ZP,{form:u,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,P.jsx)(X.Z,{label:"绑定成员",name:"memberUid",tooltip:"请先到组织-》成员-》创建成员",rules:[{required:!0,message:"请选择成员!"}],fieldProps:{multiple:!1,treeDefaultExpandAll:!0,placeholder:"请选择成员",onChange:function(e){console.log("onTreeSelectChange:",e);for(var t=0;t<l.data.content.length;t++){var n=l.data.content[t];n.uid===e&&(console.log("element:",n),u.setFieldsValue({nickname:n.nickname}),u.setFieldsValue({email:n.email}),u.setFieldsValue({mobile:n.mobile}))}},treeData:c,variant:"outlined"}}),(0,P.jsx)(S.Z,{label:"昵称",name:"nickname",rules:[{required:!0,message:"请输入昵称!"}]}),(0,P.jsx)(S.Z,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱!"},{type:"email",message:"请输入正确的邮箱地址"}]}),(0,P.jsx)(S.Z,{label:"手机号",name:"mobile",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}]})]})})})},ee=n(77849),te=function(){var e=(0,F.useIntl)(),t=(0,a.useRef)(!1),n=(0,h.Z)(),r=n.translateString,s=n.translateStringTranct,u=(0,B.Z)().isDarkMode,o=(0,a.useState)(!1),c=i()(o,2),d=c[0],f=c[1],y=(0,I.u)((function(e){return e.currentOrg})),x=j((function(e){return e.setMemberResult})),w=(0,v.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,insertAgent:e.insertAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent,deleteCurrentAgent:e.deleteCurrentAgent}})),k=w.agentResult,M=w.currentAgent,q=w.insertAgent,S=w.setAgentResult,Z=w.setCurrentAgent,V=w.deleteCurrentAgent,R=W.Z.useModal(),U=i()(R,2),E=U[0],T=U[1],O=function(){var t=m()(l()().mark((function t(n){var r;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete agent",n),p.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),t.next=4,(0,g.Lr)(n);case 4:r=t.sent,console.log("delete agent response",r),200===r.code?(p.yw.destroy(),p.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),V(n.uid)):(p.yw.destroy(),p.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),N=function(){var e=m()(l()().mark((function e(){var n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,p.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:y.uid},e.next=8,(0,g._t)(n);case 8:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(p.yw.destroy(),S(r)):(p.yw.destroy(),p.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=m()(l()().mark((function e(){var t,n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:y.uid},e.next=3,(0,ee.z_)(t);case 3:n=e.sent,console.log("queryAllMembers:",t,n),200===n.code?x(n):p.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){N(),L()}),[]);var z=function(){var t=m()(l()().mark((function t(n){var r;return l()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("save agent"),p.yw.loading(e.formatMessage({id:"creating",defaultMessage:"Creating"})),t.next=4,(0,g.x_)(n);case 4:r=t.sent,console.log("create agent:",r),200===r.code?(p.yw.destroy(),p.yw.success(e.formatMessage({id:"create.success"})),q(r.data),f(!1)):(p.yw.destroy(),p.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)($.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,P.jsx)(C.ZP,{size:"small",type:"primary",icon:(0,P.jsx)(Q.Z,{}),onClick:function(){f(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,P.jsx)(C.ZP,{size:"small",onClick:N,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,P.jsx)(C.ZP,{onClick:function(){return function(t){E.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(H.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(t.nickname),"】？"),onOk:function(){O(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(M)},size:"small",danger:!0,disabled:""===(null==M?void 0:M.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,P.jsx)(J.Z,{itemLayout:"horizontal",dataSource:k.data.content,renderItem:function(e,t){return(0,P.jsx)(J.Z.Item,{style:M.uid===e.uid?{backgroundColor:u?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Z(e)},children:(0,P.jsx)(J.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,P.jsx)(A.C,{src:e.avatar}),title:(0,P.jsx)(P.Fragment,{children:s(e.nickname)}),description:(n=e,(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)("span",{style:{color:"#999999",fontSize:12},children:[n.status===b.Ra4&&"[😀-在线接待]",n.status===b.LZ1&&"[🔻-客服下线]",n.status===b.tU$&&"[🏃‍♀️-客服忙碌]",n.connected?" ✅连接成功":" ❌连接断开"]})}))})},e.uid);var n}}),d&&(0,P.jsx)(Y,{open:d,onClose:function(){f(!1)},onSubmit:z}),T]})},ne=n(93139),re=r.Z.Sider,ae=r.Z.Content,se=function(){var e=(0,ne.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth;return(0,a.useEffect)((function(){}),[]),(0,P.jsxs)(r.Z,{children:[(0,P.jsx)(re,{width:n,style:t,children:(0,P.jsx)(te,{})}),(0,P.jsx)(r.Z,{children:(0,P.jsx)(ae,{children:(0,P.jsx)(_,{})})})]})}}}]);