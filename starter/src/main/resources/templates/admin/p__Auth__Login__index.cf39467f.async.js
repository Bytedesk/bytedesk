"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{19345:function(G,A,a){a.r(A),a.d(A,{default:function(){return xe}});var w=a(15009),u=a.n(w),I=a(97857),j=a.n(I),P=a(99289),h=a.n(P),b=a(5574),T=a.n(b),M=a(98661),H=a(10915),V=a(68262),Y=a(24556),t=a(86745),Z=a(9361),J=a(48096),X=a(28459),Q=a(31418),S=a(67294),q=a(73935),_=a(60247),i=a(80049),ee=a(63998),O=a(39825),C=a(85615),ae=a(87547),z=a(94149),D=a(5966),e=a(85893),se=function(r){var f=r.loginType,d=(0,t.useIntl)();return(0,e.jsx)(e.Fragment,{children:f==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(ae.Z,{})},placeholder:d.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D/\u90AE\u7BB1"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D/\u90AE\u7BB1!"})}]}),(0,e.jsx)(D.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(z.Z,{})},placeholder:d.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]})})},re=se,ne=a(24454),te=a(16434),ie=a(38925),oe=function(r){var f=r.loginType,d=(0,t.useIntl)();return(0,e.jsx)(e.Fragment,{children:f==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(ne.Z,{})},name:"mobile",placeholder:d.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,e.jsx)(te.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(z.Z,{})},captchaProps:{size:"large"},placeholder:d.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(F,p){return F?"".concat(p," ").concat(d.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):d.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],onGetCaptcha:function(){var E=h()(u()().mark(function F(p){var R,y;return u()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(console.log("mobile:",p),!(p&&p.length===11)){g.next=12;break}return R={mobile:p,type:C.yC,platform:C.iw},g.next=5,(0,M.Y7)(R);case 5:if(y=g.sent,y.code===200){g.next=9;break}return i.yw.error(y.message),g.abrupt("return");case 9:i.yw.success(y.message),g.next=13;break;case 12:i.yw.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 13:case"end":return g.stop()}},F)}));return function(F){return E.apply(this,arguments)}}()}),(0,e.jsx)(ie.Z,{message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},le=oe,ue=a(10397),de=function(r){var f=r.loginType;return(0,e.jsx)(e.Fragment,{children:f==="scan"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ue.Z,{style:{margin:"auto"},value:"login"})})})},ge=de,L=a(66419),N=a(69554),ce=Z.Z.defaultAlgorithm,fe=Z.Z.darkAlgorithm,me=function(){var r=(0,Y.l)(function(f){var d=f.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:d.borderRadius,":hover":{backgroundColor:d.colorBgTextHover}}});return(0,e.jsx)("div",{className:r,"data-lang":!0,children:t.SelectLang&&(0,e.jsx)(t.SelectLang,{})})},he=function(){var r=(0,L.hX)();return(0,e.jsx)("img",{alt:"logo",src:r})},ve=function(){var r=(0,L.lk)();return(0,e.jsx)(t.FormattedMessage,{id:r,defaultMessage:"\u5FAE\u8BED"})},pe=function(){var r=(0,L.z)();return(0,e.jsx)(t.FormattedMessage,{id:r,defaultMessage:"\u5FAE\u8BED"})},Me=function(){var r=(0,t.useIntl)(),f=Z.Z.useToken(),d=f.token,E=(0,O.Z)(),F=E.isDarkMode,p=(0,S.useContext)(N.I),R=p.isLoggedIn,y=(0,ee.t)(function(l){return l.setAccessToken}),W=(0,S.useState)("mobile"),g=T()(W,2),x=g[0],je=g[1],B=(0,t.useModel)("@@initialState"),Ee=B.initialState,Be=B.loading,Ue=B.refresh,Fe=B.setInitialState,Te=(0,S.useState)(!1),$=T()(Te,2),Le=$[0],Ae=$[1],k=(0,_.L)(function(l){return l.setUserInfo}),Ie=[{key:"account",label:r.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"}),children:(0,e.jsx)(re,{loginType:x})},{key:"mobile",label:r.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"}),children:(0,e.jsx)(le,{loginType:x})},{key:"scan",label:r.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"\u626B\u7801\u767B\u5F55"}),children:(0,e.jsx)(ge,{loginType:x})}];(0,S.useEffect)(function(){var l=window.location.href;(0,L.qx)(L.Hw,l)&&Ae(!0)},[]);var K=function(){var l=h()(u()().mark(function m(o){return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o&&(0,q.flushSync)(function(){Fe(function(U){return j()(j()({},U),{},{userInfo:o})})});case 1:case"end":return c.stop()}},m)}));return function(o){return l.apply(this,arguments)}}(),Se=function(){var l=h()(u()().mark(function m(o){var n,c;return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,i.yw.loading("\u6B63\u5728\u767B\u5F55..."),s.next=4,(0,M.x4)(j()({},o));case 4:n=s.sent,console.log("LoginResult:",n),n.code===200?(i.yw.destroy(),i.yw.success("\u767B\u5F55\u6210\u529F\uFF01"),y(n.data.accessToken),K(n.data.user),k(n.data.user),t.history.push("/")):(i.yw.destroy(),i.yw.error(n.message)),s.next=14;break;case 9:s.prev=9,s.t0=s.catch(0),c=r.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),console.log(s.t0),i.yw.error(c);case 14:case"end":return s.stop()}},m,null,[[0,9]])}));return function(o){return l.apply(this,arguments)}}(),Ce=function(){var l=h()(u()().mark(function m(o){var n,c;return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,i.yw.loading("\u6B63\u5728\u767B\u5F55..."),s.next=4,(0,M.N9)(j()({},o));case 4:n=s.sent,console.log("LoginMobileResult:",n),n.code===200?(i.yw.destroy(),i.yw.success("\u767B\u5F55\u6210\u529F\uFF01"),y(n.data.accessToken),K(n.data.user),k(n.data.user),t.history.push("/")):(i.yw.destroy(),i.yw.error(n.message)),s.next=14;break;case 9:s.prev=9,s.t0=s.catch(0),c=r.formatMessage({id:x==="account"?"pages.login.failure":"pages.login.failureCode",defaultMessage:x==="account"?"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF01":"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),console.log(s.t0),i.yw.error(c);case 14:case"end":return s.stop()}},m,null,[[0,9]])}));return function(o){return l.apply(this,arguments)}}();return(0,e.jsxs)(H._Y,{hashed:!1,dark:F,children:[(0,e.jsx)(me,{}),(0,e.jsx)("div",{style:{backgroundColor:d.colorBgContainer,textAlign:"center",height:"100%",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:(0,e.jsxs)(V.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:he(),title:ve(),subTitle:pe(),initialValues:{},actions:[],onFinish:function(){var l=h()(u()().mark(function m(o){var n,c;return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(x!=="account"){s.next=6;break}return n={username:o.username,password:o.password,platform:C.iw},s.next=4,Se(n);case 4:s.next=9;break;case 6:return c={mobile:o.mobile,code:o.code,platform:C.iw},s.next=9,Ce(c);case 9:case"end":return s.stop()}},m)}));return function(m){return l.apply(this,arguments)}}(),children:[(0,e.jsx)(J.Z,{activeKey:x,onChange:je,centered:!0,items:Ie}),(0,e.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,e.jsxs)("div",{style:{float:"right",marginBottom:24},children:[Le&&(0,e.jsx)(t.Link,{to:"/auth/register",children:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})}),(0,e.jsx)("a",{style:{marginLeft:10},href:"https://www.weiyuai.cn/docs",target:"_blank",children:"\u5E2E\u52A9\u6587\u6863"})]})})]})})]})},ye=function(){var r=(0,O.Z)(),f=r.isDarkMode;return(0,e.jsx)(N.w,{children:(0,e.jsx)(X.ZP,{theme:{algorithm:f?fe:ce},children:(0,e.jsxs)(Q.Z,{style:{height:"100%"},children:[(0,e.jsx)(i.ZP,{}),(0,e.jsx)(Me,{})]})})})},xe=ye},60247:function(G,A,a){a.d(A,{L:function(){return P}});var w=a(85615),u=a(64529),I=a(782),j=a(71381),P=(0,u.Ue)()((0,I.mW)((0,I.tJ)((0,j.n)(function(h,b){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(M){h({userInfo:M})},setDeviceUid:function(M){h({deviceUid:M})},deleteUserInfo:function(){return h({},!0)}}}),{name:w.Em})))}}]);
