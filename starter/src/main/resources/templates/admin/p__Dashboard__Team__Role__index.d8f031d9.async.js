"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4325],{96697:function(e,n,t){t.d(n,{SA:function(){return d}});var r=t(90819),o=t.n(r),u=t(73193),i=t.n(u),s=t(89933),a=t.n(s),c=t(77667),l=t(7206);function d(e){return f.apply(this,arguments)}function f(){return(f=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/authority/query/org",{method:"GET",params:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},87601:function(e,n,t){t.d(n,{AM:function(){return d},E9:function(){return p},Rd:function(){return R},fA:function(){return m},ul:function(){return v}});var r=t(90819),o=t.n(r),u=t(73193),i=t.n(u),s=t(89933),a=t.n(s),c=t(77667),l=t(7206);function d(e){return f.apply(this,arguments)}function f(){return(f=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/role/query/super",{method:"GET",params:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/role/query/org",{method:"GET",params:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/role/create",{method:"POST",data:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/role/update",{method:"POST",data:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return w.apply(this,arguments)}function w(){return(w=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/role/delete",{method:"POST",data:i()(i()({},n),{},{client:c.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},93139:function(e,n,t){var r=t(74145);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},1780:function(e,n,t){var r=t(77667),o=t(74828),u=t(7206);n.Z=function(){var e=(0,u.useIntl)();return{translateString:function(n){return n&&n.startsWith(r.VoP)?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,o.aS)(n,10)}}}},33660:function(e,n,t){t.r(n),t.d(n,{default:function(){return J}});var r=t(93139),o=t(64476),u=t(44194),i=t(50571),s=t(73193),a=t.n(s),c=t(76711),l=t.n(c),d=t(90819),f=t.n(d),p=t(89933),h=t.n(p),m=t(45332),g=t.n(m),v=t(89756),y=t(96697),R=t(1780),w=t(4269),x=t(22199),k=t(19421),Z=t(72434),b=t(7206),j=t(87601),M=t(77667),S=t(31549),C={width:"20%",textAlign:"center"},E=function(){var e,n=(0,b.useIntl)(),t=(0,R.Z)().translateString,r=(0,w.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole}})),o=r.upgradeRole,i=r.currentRole,s=r.setCurrentRole,c=(0,u.useState)([]),d=g()(c,2),p=d[0],m=d[1],E=(0,u.useState)(i.authorities),q=g()(E,2),P=q[0],T=q[1],A=function(){var e=h()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={pageNumber:0,pageSize:100,level:M.K78},e.next=3,(0,y.SA)(n);case 3:t=e.sent,console.log("getAuthorities response",t),200===t.code?m(t.data.content):(console.log("getAuthorities error",t),v.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=p.reduce((function(e,n){var t=n.name.split("_"),r=g()(t,1)[0];return e[r]||(e[r]=[]),e[r].push(n),e}),{});(0,u.useEffect)((function(){T(i.authorities)}),[i.authorities]),(0,u.useEffect)((function(){A()}),[]);var O=function(e,n){var t=n?[].concat(l()(P),[e]):P.filter((function(n){return n.name!==e.name}));T(t),s(a()(a()({},i),{},{authorities:t})),I(a()(a()({},i),{},{authorities:t}))},I=function(){var e=h()(f()().mark((function e(t){var r,u;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",r),v.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,j.ul)(r);case 5:u=e.sent,console.log("updateRole:",u),200===u.code?(v.yw.destroy(),v.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),o(u.data)):(v.yw.destroy(),v.yw.error(u.message));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.Z,{title:"已选权限",children:null==i||null===(e=i.authorities)||void 0===e?void 0:e.map((function(e,n){return(0,S.jsx)(x.Z.Grid,{style:C,children:(0,S.jsx)(k.Z,{checked:null==P?void 0:P.some((function(n){return n.name===e.name})),onChange:function(n){return O(e,n.target.checked)},children:t(e.name)})},n)}))}),(0,S.jsx)(Z.Z,{children:"备选权限"}),Object.keys(F).map((function(e){return(0,S.jsx)(x.Z,{title:t(e),style:{marginTop:10},children:F[e].map((function(e){return(0,S.jsx)(x.Z.Grid,{style:C,children:(0,S.jsx)(k.Z,{checked:null==P?void 0:P.some((function(n){return n.name===e.name})),onChange:function(n){return O(e,n.target.checked)},disabled:""===(null==i?void 0:i.uid),children:t(e.name)})},e.name)}))},e)}))]})},q=function(e){console.log(e)},P=[{key:"authority",label:"权限",children:(0,S.jsx)(E,{})}],T=function(){return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(i.Z,{defaultActiveKey:"1",items:P,onChange:q})})},A=t(40431),F=t(83730),O=t(80093),I=t(12265),U=t(90136),V=t(74145),z=t(50484),W=t(70458),G=t(5728),D=t(43688),L=t(11607),K=t(47807),N=function(e){var n=e.open,t=e.isEdit,r=e.role,o=e.onCancel,i=e.onSubmit,s=K.Z.useForm(),a=g()(s,1)[0],c=(0,A.u)((function(e){return e.currentOrg}));(0,u.useEffect)((function(){t?a.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description}):a.resetFields()}),[t,r]);return(0,S.jsx)("div",{children:(0,S.jsx)(F.Z,{title:"创建角色",open:n,forceRender:!0,onOk:function(){a.validateFields().then(function(){var e=h()(f()().mark((function e(n){var o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={uid:t?null==r?void 0:r.uid:"",name:n.name,description:n.description,authorityUids:[],orgUid:null==c?void 0:c.uid},console.log("handleSaveRole:",n,o),i(o);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),v.yw.error("创建角色失败")}))},onCancel:o,children:(0,S.jsxs)(G.A,{form:a,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,S.jsx)(D.Z,{label:"角色名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,S.jsx)(L.Z,{label:"角色简介",name:"description",placeholder:"请输入角色简介",rules:[{required:!0,message:"角色简介是必填项"}],fieldProps:{onPressEnter:function(){a.submit()},autoSize:{minRows:2,maxRows:6}}})]})})})},_=function(){var e=(0,b.useIntl)(),n=(0,V.Z)().isDarkMode,t=F.Z.useModal(),r=g()(t,2),o=r[0],i=r[1],s=(0,R.Z)().translateStringTranct,a=(0,u.useState)(!1),c=g()(a,2),l=c[0],d=c[1],p=(0,u.useState)(!1),m=g()(p,2),y=m[0],x=m[1],k=(0,A.u)((function(e){return e.currentOrg})),Z=(0,w.Z)((function(e){return{roleResult:e.roleResult,setRoleResult:e.setRoleResult,insertRole:e.insertRole,upgradeRole:e.upgradeRole,currentRole:e.currentRole,removeRole:e.removeRole,setCurrentRole:e.setCurrentRole}})),M=Z.roleResult,C=Z.setRoleResult,E=Z.insertRole,q=Z.upgradeRole,P=Z.removeRole,T=Z.currentRole,G=Z.setCurrentRole,D=function(){var e=h()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading("正在获取角色列表..."),n={pageNumber:0,pageSize:100,orgUid:k.uid},e.next=4,(0,j.E9)(n);case 4:t=e.sent,console.log("queryRolesByOrg response ",t),200===t.code?(v.yw.destroy(),C(t)):(v.yw.destroy(),v.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){D()}),[]);var L=function(){var n=h()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("createRole",t),v.yw.loading(e.formatMessage({id:"creating"})),n.next=4,(0,j.fA)(t);case 4:r=n.sent,console.log("createRole:",r),200===r.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),E(r.data),d(!1)):(v.yw.destroy(),v.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),K=function(){var n=h()(f()().mark((function n(t){var r,o,u;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,authorityUids:(null==t||null===(r=t.authorities)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]},v.yw.loading(e.formatMessage({id:"updating"})),n.next=4,(0,j.ul)(o);case 4:u=n.sent,console.log("updateRole:",o,u),200===u.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),q(u.data),d(!1)):(v.yw.destroy(),v.yw.error(u.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),_=function(){var n=h()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteRole",t),v.yw.loading(e.formatMessage({id:"deleting"})),n.next=4,(0,j.Rd)(t);case 4:r=n.sent,console.log("updateRole:",r),200===r.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),P(r.data.uid),d(!1)):(v.yw.destroy(),v.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(O.Z,{gap:"small",wrap:"wrap",children:[(0,S.jsx)(I.ZP,{type:"primary",size:"small",icon:(0,S.jsx)(W.Z,{}),onClick:function(){console.log("new role"),x(!1),d(!0)},children:e.formatMessage({id:"create",defaultMessage:"Create"})}),(0,S.jsx)(I.ZP,{size:"small",onClick:function(){console.log("edit role"),x(!0),d(!0)},disabled:""===(null==T?void 0:T.uid),children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,S.jsx)(I.ZP,{onClick:function(){return function(n){o.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(z.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){_(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(T)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==T?void 0:T.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,S.jsx)(U.Z,{dataSource:M.data.content,renderItem:function(e,t){return(0,S.jsx)(U.Z.Item,{style:T.uid===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){G(e)},children:(0,S.jsx)(U.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,S.jsx)(S.Fragment,{children:s(e.name)})})},e.uid)}}),l&&(0,S.jsx)(N,{open:l,isEdit:y,role:T,onCancel:function(){d(!1)},onSubmit:function(e){y?K(e):L(e)}}),i]})},B=o.Z.Sider,H=o.Z.Content,J=function(){var e=(0,r.Z)().leftSiderStyle;return(0,S.jsxs)(o.Z,{children:[(0,S.jsx)(B,{style:e,children:(0,S.jsx)(_,{})}),(0,S.jsx)(o.Z,{children:(0,S.jsx)(H,{children:(0,S.jsx)(T,{})})})]})}},4269:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(73193),o=t.n(r),u=t(76711),i=t.n(u),s=t(77667),a=t(39701),c=t(83642),l=t(41617),d=(0,a.Ue)()((0,c.mW)((0,c.tJ)((0,l.n)((function(e,n){return{currentRole:{uid:"",orgUid:""},roleResult:{data:{content:[]}},insertRole:function(n){e((function(e){e.roleResult.data.content.unshift(n)}))},upgradeRole:function(n){e((function(e){var t=e.roleResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Role with uid ".concat(n.uid," not found."))}))},setRoleResult:function(t){var r;(e({roleResult:t}),""===n().currentRole.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentRole:t.data.content[0]}))},setCurrentRole:function(t){var r=n().roleResult.data.content,u=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==u){var s=[].concat(i()(r.slice(0,u)),[t],i()(r.slice(u+1))),a=o()(o()({},n().roleResult),{},{data:{content:s}});e({roleResult:a,currentRole:t})}else console.warn("Role with the specified uid not found."),e({currentRole:t})},removeRole:function(t){var r=n().roleResult.data.content,u=r.findIndex((function(e){return e.uid===t}));-1!==u?e({roleResult:o()(o()({},n().roleResult),{},{data:{content:[].concat(i()(r.slice(0,u)),i()(r.slice(u+1)))}})}):console.warn("Role not found in cache:",t),n().currentRole.uid===t&&e({currentRole:{uid:"",orgUid:""}})},deleteRoleCache:function(){return e({},!0)}}})),{name:s.uaR})))}}]);