"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2801],{58638:function(B,M,e){e.d(M,{Z:function(){return O}});var g=e(1413),d=e(67294),p={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},h=p,E=e(89099),v=function(j,R){return d.createElement(E.Z,(0,g.Z)((0,g.Z)({},j),{},{ref:R,icon:h}))},D=d.forwardRef(v),O=D},70150:function(B,M,e){e.d(M,{W5:function(){return R}});var g=e(15009),d=e.n(g),p=e(97857),h=e.n(p),E=e(99289),v=e.n(E),D=e(85615),O=e(88541),u=e.n(O),j=e(86745);function R(a){return S.apply(this,arguments)}function S(){return S=v()(d()().mark(function a(n){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/api/v1/message/query/org",{method:"GET",params:h()({},n)}));case 1:case"end":return r.stop()}},a)})),S.apply(this,arguments)}function x(a){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function a(n){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/user/robot",{method:"GET",params:{page:n.pageNumber,size:n.pageSize,client:HTTP_CLIENT}}));case 1:case"end":return r.stop()}},a)})),C.apply(this,arguments)}function K(a){return m.apply(this,arguments)}function m(){return m=_asyncToGenerator(_regeneratorRuntime().mark(function a(n){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/v1/message/rest/send",{method:"POST",data:{json:n,client:HTTP_CLIENT}}));case 1:case"end":return r.stop()}},a)})),m.apply(this,arguments)}function k(a,n){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime().mark(function a(n,c){return _regeneratorRuntime().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",request("http://127.0.0.1:1001/visitor/api/v1/ai/ollama/chat",{method:"GET",params:{query:n,kbUid:c,client:HTTP_CLIENT}}));case 1:case"end":return s.stop()}},a)})),I.apply(this,arguments)}function G(a,n,c){return i.apply(this,arguments)}function i(){return i=_asyncToGenerator(_regeneratorRuntime().mark(function a(n,c,r){var s,_;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:console.log("sendMessageAiStream: ",n),s="http://127.0.0.1:1001/visitor/api/v1/ai/ollama/chat/stream?query=".concat(n,"&kbUid=").concat(c),_=new EventSource(s,{withCredentials:!1}),_.onopen=function(t){console.log("onopen:",t.target)},_.onmessage=function(t){console.log("onmessage:",t.data),r(t.data)},_.onerror=function(t){console.log("onerror:",t),_.readyState===EventSource.CLOSED?console.log("connection is closed"):console.log("Error occured",t),_.close()},_.addEventListener("customEventName",function(t){console.log("Message id is "+t.lastEventId)});case 7:case"end":return o.stop()}},a)})),i.apply(this,arguments)}function N(a,n){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function a(n,c){var r,s;return _regeneratorRuntime().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:console.log("sendMessageSSE: ",n),r="".concat("","/visitor/api/v1/zhipuai/sse?uid=&sid=").concat(n.sid,"&content=").concat(n.content),s=new EventSource(r,{withCredentials:!1}),s.onopen=function(o){console.log("onopen:",o.target)},s.onmessage=function(o){c(o.data);var t=JSON.parse(o.data);if(t.type=="finish"){s&&s.close();return}},s.onerror=function(o){console.log("onerror:",o),alert("server error"),s.readyState===EventSource.CLOSED?console.log("connection is closed"):console.log("Error occured",o),s.close()},s.addEventListener("customEventName",function(o){console.log("Message id is "+o.lastEventId)});case 7:case"end":return P.stop()}},a)})),U.apply(this,arguments)}function w(a,n){return A.apply(this,arguments)}function A(){return A=_asyncToGenerator(_regeneratorRuntime().mark(function a(n,c){var r,s,_;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:console.log("sendMessageSSEPolyfill: ",n),r=localStorage.ACCESS_TOKEN,s="".concat("","/visitor/api/v1/zhipuai/sse?uid=&sid=").concat(n.sid,"&content=").concat(n.content),_=new EventSourcePolyfill(s,{headers:{Authorization:"Bearer ".concat(r)}}),_.onopen=function(t){console.log("onopen:",t.target)},_.onmessage=function(t){console.log("onmessage:",t.data),c(t.data);var f=JSON.parse(t.data);if(f.type=="finish"){_&&_.close();return}},_.onerror=function(t){console.log("onerror:",t),alert("server error"),_.readyState===EventSource.CLOSED?console.log("connection is closed"):console.log("Error occured",t),_.close()},_.addEventListener("customEventName",function(t){console.log("Message id is "+t.lastEventId)});case 8:case"end":return o.stop()}},a)})),A.apply(this,arguments)}},12801:function(B,M,e){var g=e(15009),d=e.n(g),p=e(97857),h=e.n(p),E=e(13769),v=e.n(E),D=e(99289),O=e.n(D),u=e(80049),j=e(70150),R=e(73803),S=e(87676),x=e(85615),C=e(58638),K=e(57482),m=e(86745),k=e(7134),I=e(14726),G=e(67294),i=e(85893),N=["current"],U=function(A){var a=A.type,n=(0,m.useIntl)(),c=(0,G.useRef)(),r=(0,R.Z)(),s=r.translateString,_=(0,S.u)(function(t){return t.currentOrg}),P=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,i.jsx)(m.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",render:function(f,l){var b,L;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.C,{src:l==null||(b=l.user)===null||b===void 0?void 0:b.avatar}),s(l==null||(L=l.user)===null||L===void 0?void 0:L.nickname)]})}},{title:(0,i.jsx)(m.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,render:function(f,l){return(0,i.jsx)(i.Fragment,{children:s(l==null?void 0:l.content)})}},{title:(0,i.jsx)(m.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:200,hideInSearch:!0},{title:(0,i.jsx)(m.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:200,copyable:!0},{title:(0,i.jsx)(m.FormattedMessage,{id:"client",defaultMessage:"Client"}),dataIndex:"client",width:100,hideInSearch:!0,copyable:!0},{title:(0,i.jsx)(m.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0}],o=function(){console.log("handleExportExcel");var f=localStorage.getItem(x.LA);window.open("/api/v1/message/export?uid="+_.uid+"&pageNumber=0&pageSize=20&accessToken="+f)};return(0,i.jsx)(K.Z,{columns:P,actionRef:c,cardBordered:!0,request:function(){var t=O()(d()().mark(function f(l,b,L){var Z,z,W,T;return d()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return console.log("request:",l,b,L),Z=l.current,z=v()(l,N),W=h()({pageNumber:l.current-1,orgUid:_.uid},z),y.next=5,(0,j.W5)(W);case 5:return T=y.sent,console.log("getAllMessages response:",W,T),T.code===200||u.yw.error(T.message),y.abrupt("return",{data:T.data.content,success:!0,total:T.data.totalElements});case 9:case"end":return y.stop()}},f)}));return function(f,l,b){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(f){console.log("page:",f)}},dateFormatter:"string",headerTitle:n.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return[(0,i.jsx)(I.ZP,{icon:(0,i.jsx)(C.Z,{}),type:"primary",onClick:o,children:n.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}})};M.Z=U},73803:function(B,M,e){var g=e(85615),d=e(66419),p=e(86745);function h(){var E=(0,p.useIntl)(),v=function(u){return u&&u.startsWith(g.Vo)?E.formatMessage({id:u,defaultMessage:u}):u},D=function(u){return u!=null&&u.startsWith(g.Vo)?(0,d.aS)(E.formatMessage({id:u}),10):(0,d.aS)(u,10)};return{translateString:v,translateStringTranct:D}}M.Z=h},87676:function(B,M,e){e.d(M,{u:function(){return E}});var g=e(85615),d=e(73445),p=e(782),h=e(18753),E=(0,d.Ue)()((0,p.mW)((0,p.tJ)((0,h.n)(function(v,D){return{currentOrg:{uid:"",name:"",description:""},setCurrentOrg:function(u){v({currentOrg:u})},deleteOrg:function(){return v({},!0)}}}),{name:g.eR})))}}]);
