"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3340],{2749:function(e,t,n){n.d(t,{Z:function(){return C}});var r=n(90228),a=n.n(r),o=n(87999),s=n.n(o),l=n(48305),i=n.n(l),c=n(71417),u=n(41258),d=n(8038),f=n(58439),p=n(13652),g=n(93568),y=n(21363),m=n(75271),h=n(83782),v=n(29244),x=n(59153),w=n(26092),b=n(51038),k=n(18735),j=n(39969),M=n(52676),C=function(e){var t=e.type,n=(0,k.useIntl)(),r=(0,m.useState)(!0),o=i()(r,2),l=o[0],C=o[1],S=(0,v.u)((function(e){return e.currentOrg})),Z=(0,j.j)((function(e){return e.currentKbase})),T=(0,m.useState)(!1),U=i()(T,2),D=U[0],_=U[1],P=(0,w.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,setCategoryResult:e.setCategoryResult,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),A=P.categoryTreeOptions,E=P.setCategoryResult,O=P.currentCategory,F=P.setCurrentCategoryUid,N=(0,b.Z)(),q=N.translateString,R=N.translateStringTranct,Y=u.Z.useModal(),I=i()(Y,2),K=I[0],L=I[1],V=function(){var e=s()(a()().mark((function e(t){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmit: ",t),l?x.yw.loading(n.formatMessage({id:"updating"})):x.yw.loading(n.formatMessage({id:"creating"})),!l){e.next=8;break}return e.next=5,(0,h.yr)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,h.k4)(t);case 10:e.t0=e.sent;case 11:r=e.t0,console.log("createCategory response: ",r),200===r.code?(x.yw.destroy(),l?x.yw.success(n.formatMessage({id:"update.success"})):x.yw.success(n.formatMessage({id:"create.success"})),_(!1),z()):(x.yw.destroy(),x.yw.error(r.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=s()(a()().mark((function e(){var r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getCategories"),x.yw.success(n.formatMessage({id:"loading"})),r={pageNumber:0,pageSize:50,type:t,kbUid:null==Z?void 0:Z.uid,orgUid:null==S?void 0:S.uid},e.next=5,(0,h.XS)(r);case 5:o=e.sent,console.log("queryCategories response: ",o),200===o.code?(E(o),x.yw.destroy()):(x.yw.destroy(),x.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditCategory: ",O),C(!0),_(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteCategory: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){z()}),[Z]);return(0,M.jsxs)("div",{children:[(0,M.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{marginBottom:5},children:[(0,M.jsx)(f.ZP,{type:"primary",size:"small",onClick:function(){C(!1),_(!0)},disabled:(null==Z?void 0:Z.type)!=t,children:n.formatMessage({id:"create"})}),""!==(null==O?void 0:O.uid)&&"all"!==(null==O?void 0:O.uid)&&(0,M.jsx)(f.ZP,{size:"small",onClick:Q,children:n.formatMessage({id:"edit"})}),""!==(null==O?void 0:O.uid)&&"all"!==(null==O?void 0:O.uid)&&(0,M.jsx)(f.ZP,{onClick:function(){return function(e){K.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(c.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(q(e.name),"】？"),onOk:function(){B(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(O)},size:"small",style:{float:"right"},danger:!0,children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,M.jsx)(p.Z,{defaultSelectedKeys:[null==O?void 0:O.uid],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&F(e[0].toString())},treeData:A,blockNode:!0,titleRender:function(e){return(0,M.jsx)(g.Z,{title:q(e.title),children:R(e.title)})}}),D&&(0,M.jsx)(y.Z,{open:D,type:t,isEdit:l,onCancel:function(){_(!1)},onSubmit:V}),L]})}},21029:function(e,t,n){var r=n(26068),a=n.n(r),o=n(48305),s=n.n(o),l=n(41258),i=n(75271),c=n(44626),u=n(26898),d=n(16483),f=n.n(d),p=n(96677),g=n(59153),y=n(39969),m=n(26092),h=n(24229),v=n(52676),x=u.Z.Dragger;t.Z=function(e){var t=e.type,n=e.acceptType,r=e.isModalOpen,o=e.handleOk,u=e.handleCancel,d=(0,y.j)((function(e){return e.currentKbase})),w=(0,i.useState)((null==d?void 0:d.uid)||""),b=s()(w,2),k=b[0],j=b[1],M=(0,m.v)((function(e){return e.currentCategory})),C=(0,i.useState)("当前支持上传pdf/txt/markdown/docx等"),S=s()(C,2),Z=S[0],T=S[1],U=(0,i.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"all"===(null==M?void 0:M.uid)?"":(null==M?void 0:M.uid)||"",kb_uid:(null==d?void 0:d.uid)||"",client:p.bVn}),D=s()(U,2),_=D[0],P=D[1],A={name:"file",accept:n,action:(0,h.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(p.LA8)},data:_,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload before",e,k,d);var n=f()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;_.file=e,_.file_name=n,_.file_type=e.type,_.kb_type=t,_.kb_uid=k,console.log("beforeUpload after",_)},onChange:function(e){"uploading"===e.file.status&&g.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status?(console.log("response: ",e.file.response),200===e.file.response.code?(g.yw.destroy(),g.yw.success("".concat(e.file.name," 上传成功")),o()):(g.yw.destroy(),g.yw.error("".concat(e.file.name," 上传失败")),u())):"error"===e.file.status&&(g.yw.error("".concat(e.file.name," 上传失败")),u())},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}},E=(0,i.useState)(A),O=s()(E,2),F=O[0],N=O[1];return(0,i.useEffect)((function(){y.j.subscribe((function(e,t){var n,r;console.log("useKbaseStore changed:",null==e||null===(n=e.currentKbase)||void 0===n?void 0:n.uid),j(null==e||null===(r=e.currentKbase)||void 0===r?void 0:r.uid),N(A)}))}),[d]),(0,i.useEffect)((function(){t!=p.QPQ&&(N(A),T("当前支持上传excel文件")),P(a()(a()({},_),{},{kb_type:t,category_uid:"all"===(null==M?void 0:M.uid)?"":null==M?void 0:M.uid})),N(A)}),[t,M]),(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(l.Z,{title:"上传文件",open:r,onOk:o,onCancel:u,children:(0,v.jsxs)(x,a()(a()({},F),{},{children:[(0,v.jsx)("p",{className:"ant-upload-drag-icon",children:(0,v.jsx)(c.Z,{})}),(0,v.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽文件至此处实现上传"}),(0,v.jsx)("p",{className:"ant-upload-hint",children:Z})]}))})})}},3148:function(e,t,n){n.r(t),n.d(t,{default:function(){return ce}});var r=n(21544),a=n(43650),o=n(26068),s=n.n(o),l=n(67825),i=n.n(l),c=n(90228),u=n.n(c),d=n(87999),f=n.n(d),p=n(48305),g=n.n(p),y=n(59153),m=n(96677),h=n(18735);function v(e){return x.apply(this,arguments)}function x(){return(x=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/query/org",{method:"GET",params:s()(s()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/create",{method:"POST",data:s()(s()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/update",{method:"POST",data:s()(s()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return C.apply(this,arguments)}function C(){return(C=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/delete",{method:"POST",data:s()(s()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=n(29244),Z=n(65496),T=n(30115),U=n(42526),D=n(22365),_=n(93061),P=n(22949),A=n(58439),E=n(75271),O=n(26092),F=n(39969),N=n(24229),q=n(44626),R=n(74730),Y=n(65948),I=n(9477),K=n(92996),L=n(15987),V=n(86831),z=n(89620),Q=n(20503),B=n(16483),H=n.n(B),J=n(52676),W=function(e){var t=e.isEdit,n=e.keyword,r=e.open,a=e.onClose,o=e.onSubmit,l=R.A.useForm(),i=g()(l,1)[0],c=(0,S.u)((function(e){return e.currentOrg})),u=(0,F.j)((function(e){return e.currentKbase})),d=(0,O.v)((function(e){return e.categorySelectOptions})),f=(0,E.useState)(),p=g()(f,2),h=p[0],v=p[1],x=(0,E.useState)(m.PYi),w=g()(x,2),b=w[0],k=w[1],j=(0,E.useState)(".png,.jpg,.jpeg"),M=g()(j,2),C=M[0],Z=M[1],T=(0,E.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==u?void 0:u.uid)||"",client:m.bVn}),U=g()(T,2),D=U[0];U[1];(0,E.useEffect)((function(){t?i.setFieldsValue({keyword:null==n?void 0:n.keywordList,reply:null==n?void 0:n.replyList,matchType:null==n?void 0:n.matchType,contentType:null==n?void 0:n.contentType,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==u?void 0:u.uid,enabled:null==n?void 0:n.enabled}):i.resetFields()}),[r]);var _={name:"file",accept:C,action:(0,N.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(m.LA8)},data:D,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;D.file=e,D.file_name=t,D.file_type=e.type,D.kb_type=m.YjS,D.category_uid=h||"",D.kb_uid=null==u?void 0:u.uid,console.log("beforeUpload",D)},onChange:function(e){if("uploading"===e.file.status&&y.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data;i.setFieldValue("reply",t),y.yw.destroy(),y.yw.success("".concat(e.file.name," 上传成功"))}else y.yw.destroy(),y.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&y.yw.error("".concat(e.file.name," 上传失败"))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(V.Z,{title:t?"修改":"新建",onClose:a,open:r,extra:(0,J.jsxs)(z.Z,{children:[(0,J.jsx)(A.ZP,{onClick:a,children:"取消"}),(0,J.jsx)(A.ZP,{onClick:function(){console.log("handleSubmit"),i.validateFields().then((function(e){console.log(e),o(s()(s()(s()({},n),e),{},{keywordList:[e.keyword],replyList:[e.reply],kbUid:null==u?void 0:u.uid,orgUid:null==c?void 0:c.uid}))})).catch((function(e){console.log("Form errors:",e),y.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,J.jsxs)(R.A,{form:i,submitter:{render:function(){return null}},children:[(0,J.jsx)(Y.Z,{label:"匹配类型",name:"matchType",rules:[{required:!0,message:"请选择匹配类型"}],options:[{label:"模糊匹配",value:m.lEl},{label:"精确匹配",value:m.TAc,disabled:!0},{label:"正则匹配",value:m.c7i,disabled:!0},{label:"向量匹配",value:m.sOn,disabled:!0},{label:"搜索引擎匹配",value:m.NDq,disabled:!0}],fieldProps:{allowClear:!0,placeholder:"请选择匹配类型"}}),(0,J.jsx)(Y.Z,{label:"内容分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:d,tooltip:"请先：创建分类",fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),v(e)}}}),(0,J.jsx)(Y.Z,{label:"类型",name:"contentType",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:m.PYi},{label:"图片",value:m.Qm},{label:"视频",value:m.tVi},{label:"音频",value:m.Yu1},{label:"文件",value:m.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),k(e),e===m.Qm?Z(".png,.jpg,.jpeg,.gif,.bmp"):e===m.tVi?Z(".mp4,.avi,.mov,.wmv"):e===m.Yu1?Z(".mp3,.wav,.flac"):e===m.Qn&&Z(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,J.jsx)(I.Z,{label:"关键词",name:"keyword",tooltip:"多个关键词使用 '|' 分割",placeholder:"请输入关键词，多个关键词使用 '|' 分割",rules:[{required:!0,message:"请输入关键词，多个关键词使用 '|' 分割 "}]}),(0,J.jsx)(K.Z,{label:"回复",name:"reply"}),(0,J.jsx)(L.Z,{label:"启用",name:"enabled",fieldProps:{defaultValue:!0}}),b!=m.PYi&&(0,J.jsxs)(Q.Z,s()(s()({},_),{},{children:[(0,J.jsx)("p",{className:"ant-upload-drag-icon",children:(0,J.jsx)(q.Z,{})}),(0,J.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽上传文件"})]}))]})})})},$=n(18979),G=n(4100),X=n(51038),ee=n(33554),te=n(93454),ne=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,te.Z)().isDarkMode,o=(0,X.Z)().translateString,s=(0,E.useRef)(),l=(0,F.j)((function(e){return e.currentKbase}));(0,E.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.clearMessage()}),[l]);var i=function(){var e=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleChatKeyword");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=f()(u()().mark((function e(t){var n,r,a,o,s,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleChatStream"),n=t[t.length-1],e.next=4,fetch("http://127.0.0.1:1001/visitor/api/v1/ai/ollama/chat/stream",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({query:null==n?void 0:n.content,kbUid:null==l?void 0:l.uid,stream:!0})});case 4:if((r=e.sent).ok&&r.body){e.next=7;break}throw new Error("HTTP error! status: ".concat(r.status));case 7:return a=r.body.getReader(),o=new TextDecoder("utf-8"),s=new TextEncoder,i=new ReadableStream({start:function(e){return f()(u()().mark((function t(){var n;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=function(){a.read().then((function(t){var r=t.done,a=t.value;if(r)e.close();else{var l=o.decode(a,{stream:!0}).replaceAll("data:","").replaceAll("\n","");e.enqueue(s.encode(l)),n()}})).catch((function(t){console.error("读取流中的数据时发生错误",t),e.error(t)}))})();case 2:case"end":return t.stop()}}),t)})))()}}),e.abrupt("return",new Response(i));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,J.jsx)("div",{children:(0,J.jsx)(V.Z,{title:o(null==l?void 0:l.name),onClose:function(){r&&r()},open:n,styles:{body:{padding:0}},children:(0,J.jsx)(G.f6,{appearance:a?"dark":"light",theme:{algorithm:a?ee.Z.darkAlgorithm:ee.Z.defaultAlgorithm},children:(0,J.jsx)($.j,{chatRef:s,helloMessage:"请输入你想问的问题",request:function(){var e=f()(u()().mark((function e(n){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("messages:",n),!(n.length>0)){e.next=8;break}if(t!==m.QPQ){e.next=6;break}return e.abrupt("return",c(n));case 6:if(t!==m.jNC){e.next=8;break}return e.abrupt("return",i(n));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})})})},re=n(21029),ae=["current"],oe=function(){var e=(0,h.useIntl)(),t=(0,E.useRef)(),n=(0,E.useState)(!0),r=g()(n,2),a=r[0],o=r[1],l=(0,E.useState)(),c=g()(l,2),d=c[0],p=c[1],x=(0,E.useState)(!1),b=g()(x,2),j=b[0],C=b[1],q=(0,S.u)((function(e){return e.currentOrg})),R=(0,F.j)((function(e){return e.currentKbase})),Y=(0,O.v)((function(e){return e.currentCategory})),I=(0,E.useState)(!1),K=g()(I,2),L=K[0],V=K[1],z=(0,E.useState)(!1),Q=g()(z,2),B=Q[0],H=Q[1],$=function(){var n=f()(u()().mark((function n(r){var a;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,M(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),y.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):y.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),G=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,J.jsx)(h.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),dataIndex:"keywordList",copyable:!0},{title:(0,J.jsx)(h.FormattedMessage,{id:"reply",defaultMessage:"Reply"}),dataIndex:"replyList",copyable:!0},{title:(0,J.jsx)(h.FormattedMessage,{id:"matchType",defaultMessage:"MatchType"}),dataIndex:"matchType",width:80,render:function(t,n){return e.formatMessage({id:null==n?void 0:n.matchType,defaultMessage:null==n?void 0:n.matchType})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"contentType",hideInSearch:!0,width:50,render:function(t,n){return(0,J.jsx)(J.Fragment,{children:e.formatMessage({id:null==n?void 0:n.contentType,defaultMessage:null==n?void 0:n.contentType})})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",width:80,render:function(t,n){return(0,J.jsx)(J.Fragment,{children:null!=n&&n.enabled?e.formatMessage({id:"yes",defaultMessage:"Yes"}):e.formatMessage({id:"no",defaultMessage:"No"})})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){ee(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,J.jsx)(P.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.keywordList,"】？"),onConfirm:function(){return $(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,J.jsx)(A.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}],X=function(){p(void 0),o(!1),C(!0)},ee=function(e){p(e),o(!0),C(!0)},te=function(){var n=f()(u()().mark((function n(r){var o,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("handleSubmitDrawer",r),a?y.yw.loading(e.formatMessage({id:"updating"})):y.yw.loading(e.formatMessage({id:"creating"})),!a){n.next=8;break}return n.next=5,k(r);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,w(r);case 10:n.t0=n.sent;case 11:o=n.t0,console.log("createKeyword response:",r,o),200===o.code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),C(!1),null===(s=t.current)||void 0===s||s.reloadAndRest()):(y.yw.destroy(),y.yw.error(o.message));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),oe=function(){var e=f()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=f()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=localStorage.getItem(m.LA8),window.open((0,N.SV)()+"/api/v1/keyword/export?categoryUid="+(null==Y?void 0:Y.uid)+"&kbUid="+(null==R?void 0:R.uid)+"&orgUid="+(null==q?void 0:q.uid)+"&pageNumber=0&pageSize=20&accessToken="+t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,E.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[R,Y]);var le=(0,E.useMemo)((function(){return(null==R?void 0:R.type)!==m.jNC||""===(null==R?void 0:R.uid)}),[R]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(_.Z,{columns:G,actionRef:t,cardBordered:!0,request:function(){var t=f()(u()().mark((function t(n,r,a){var o,l,c;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),y.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.current,o=i()(n,ae),l=s()({pageNumber:n.current-1,categoryUid:"all"===Y.uid?"":Y.uid,kbUid:null==R?void 0:R.uid,orgUid:null==q?void 0:q.uid},o),t.next=6,v(l);case 6:return c=t.sent,console.log("getAllKeywords response:",l,c),y.yw.destroy(),200===c.code||y.yw.error(c.message),t.abrupt("return",{data:c.data.content,success:!0,total:c.data.totalElements});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"menu.knowledge.keyword",defaultMessage:"KEYWORD"}),toolBarRender:function(){return[(0,J.jsx)(A.ZP,{icon:(0,J.jsx)(Z.Z,{}),type:"primary",onClick:X,disabled:le,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,J.jsx)(A.ZP,{icon:(0,J.jsx)(T.Z,{}),type:"primary",onClick:oe,disabled:le,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"import"),(0,J.jsx)(A.ZP,{icon:(0,J.jsx)(U.Z,{}),type:"primary",onClick:se,disabled:le,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"export"),(0,J.jsx)(A.ZP,{icon:(0,J.jsx)(D.Z,{}),type:"link",onClick:function(){window.open("https://www.weiyuai.cn/download/excel/kbase_keyword.xlsx")},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]}}),(0,J.jsx)(W,{isEdit:a,open:j,keyword:d,onClose:function(){return C(!1)},onSubmit:te}),(0,J.jsx)(re.Z,{type:m.jNC,acceptType:".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",isModalOpen:B,handleOk:function(){console.log("handleUploadDragSubmit"),H(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),H(!1),null==t||t.current.reload()}}),(0,J.jsx)(ne,{type:m.jNC,open:L,onClose:function(){return V(!1)}})]})},se=n(2749),le=a.Z.Sider,ie=a.Z.Content,ce=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,J.jsx)("div",{children:(0,J.jsxs)(a.Z,{children:[(0,J.jsx)(le,{style:t,children:(0,J.jsx)(se.Z,{type:m.jNC})}),(0,J.jsx)(a.Z,{children:(0,J.jsx)(ie,{style:n,children:(0,J.jsx)(oe,{})})})]})})}}}]);