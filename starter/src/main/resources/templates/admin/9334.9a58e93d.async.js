"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9334],{27522:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return h},t5:function(){return g},v_:function(){return p}});var r=t(90819),a=t.n(r),s=t(73193),o=t.n(s),u=t(89933),i=t.n(u),l=t(55735),c=t(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},96865:function(e,n,t){var r=t(23864);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,n,t){var r=t(55735),a=t(65461),s=t(30921);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&n.startsWith(r.VoP)?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},23573:function(e,n,t){t.d(n,{Z:function(){return P}});var r=t(90819),a=t.n(r),s=t(89933),o=t.n(s),u=t(45332),i=t.n(u),l=t(53530),c=t(9452),d=t(44194),f=t(86803),p=t(76750),b=t(40612),g=t(55735),m=t(99811),h=t(84881),v=t(4499),k=t(32350),w=t(31549),x=function(e){var n=e.open,t=e.isEdit,r=e.type,s=e.kbase,u=e.onCancel,c=e.onSubmit,x=m.A.useForm(),K=i()(x,1)[0],y=(0,p.Z)().translateString,S=(0,b.u)((function(e){return e.currentOrg}));(0,d.useEffect)((function(){t?(K.setFieldsValue({name:y(null==s?void 0:s.name)}),K.setFieldsValue({headline:y(null==s?void 0:s.headline)}),K.setFieldsValue({footerHtml:y(null==s?void 0:s.footerHtml)}),K.setFieldsValue({descriptionHtml:y(null==s?void 0:s.descriptionHtml)}),K.setFieldsValue({language:null==s?void 0:s.language}),K.setFieldsValue({embedding:null==s?void 0:s.embedding})):K.resetFields()}),[n]);var Z=function(){K.validateFields().then(function(){var e=o()(a()().mark((function e(n){var o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),o={uid:t?null==s?void 0:s.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:r,embedding:n.embedding,language:n.language,orgUid:null==S?void 0:S.uid},c(o);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),f.yw.error("创建知识库失败")}))},j=function(e){"Enter"===e.key&&Z()};return(0,w.jsx)("div",{children:(0,w.jsx)(l.Z,{title:"新建知识库",open:n,forceRender:!0,onOk:Z,onCancel:u,children:(0,w.jsxs)(m.A,{form:K,submitter:!1,children:[(0,w.jsx)(h.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,w.jsx)(v.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:j,placeholder:"请输入名称"}}),r===g.VX&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:j,placeholder:"请输入名称"}}),(0,w.jsx)(k.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,w.jsx)(k.Z,{label:"描述",name:"descriptionHtml"})]})})})},K=t(27522),y=t(6397),S=t(23864),Z=t(30921),j=t(67444),R=t(27487),C=t(75365),M=function(e){var n=e.currentKbase,t=e.handleNewKbase,r=e.handleEditKbase,a=e.showDeleteConfirmModel,s=(0,Z.useIntl)();return(0,w.jsx)("div",{children:(0,w.jsxs)(R.Z,{gap:"small",wrap:"wrap",style:{margin:5},children:[(0,w.jsx)(C.ZP,{size:"small",type:"primary",onClick:t,children:s.formatMessage({id:"createKb",defaultMessage:"Create Knowledge Base"})}),""!==(null==n?void 0:n.uid)&&"all"!==(null==n?void 0:n.uid)&&(0,w.jsx)(C.ZP,{size:"small",onClick:r,children:s.formatMessage({id:"edit",defaultMessage:"Edit"})}),""!==(null==n?void 0:n.uid)&&"all"!==(null==n?void 0:n.uid)&&(0,w.jsx)(C.ZP,{onClick:function(){return a(n)},size:"small",style:{float:"right"},danger:!0,children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})})},E=l.Z.confirm,P=function(e){var n=e.type,t=(0,Z.useIntl)(),r=(0,d.useRef)(!1),s=(0,d.useState)(!1),u=i()(s,2),l=u[0],m=u[1],h=(0,S.Z)().isDarkMode,v=(0,p.Z)().translateString,k=(0,b.u)((function(e){return e.currentOrg})),R=(0,d.useState)(!0),C=i()(R,2),P=C[0],H=C[1],F=(0,y.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),V=F.kbaseResult,O=F.currentKbase,T=F.insertKbase,I=F.updateLocalKbase,q=F.setKbaseResult,D=F.setCurrentKbase,A=F.removeKbase,L=function(){var e=o()(a()().mark((function e(){var t,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,f.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==k?void 0:k.uid},e.next=8,(0,K.AP)(t);case 8:s=e.sent,console.log("queryKbasesByOrg: ",s),200===s.code?(f.yw.destroy(),q(s)):(f.yw.destroy(),f.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){console.log("useEffect"),L()}),[]);var N=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P?W(n):_(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),e.next=3,(0,K.v_)(n);case 3:t=e.sent,console.log("create kb response",t),200===t.code?(T(t.data),m(!1)):(console.log("create kb failed",t),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),W=function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),e.next=3,(0,K.t5)(n);case 3:t=e.sent,console.log("update kb response",t),200===t.code?(I(t.data),m(!1)):(console.log("update kb failed",t),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",O),H(!0),m(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleDeleteKbase: ",n),e.next=3,(0,K._J)(n);case 3:t=e.sent,console.log("handleDeleteKbase: ",t),200==t.code?A(n.uid):(console.log("handleDeleteKbase: ",t),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),G=function(e){return n!=g._FS?v(e.descriptionHtml):"PLATFORM"===e.level?"全平台客服可见":"ORGANIZATION"===e.level?"本组织客服可见":"AGENT"===e.level?"本客服可见":v(e.descriptionHtml)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(M,{currentKbase:O,handleNewKbase:function(){console.log("new kb"),H(!1),m(!0)},handleEditKbase:z,showDeleteConfirmModel:function(e){E({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(j.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(v(e.name),"】？"),onOk:function(){U(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}}),(0,w.jsx)(c.Z,{itemLayout:"horizontal",dataSource:V.data.content,renderItem:function(e,n){return(0,w.jsx)(c.Z.Item,{style:O.uid===e.uid?{backgroundColor:h?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){D(e)},children:(0,w.jsx)(c.Z.Item.Meta,{style:{marginLeft:"10px"},title:v(e.name),description:G(e)})})}}),l&&(0,w.jsx)(x,{open:l,isEdit:P,type:n,kbase:O,onSubmit:N,onCancel:function(){m(!1)}})]})}},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),u=t(55735),i=t(39701),l=t(83642),c=t(41617),d=(0,i.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var u=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),i=a()(a()({},n().kbaseResult),{},{data:{content:u}});e({kbaseResult:i,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:u.wKE})))}}]);