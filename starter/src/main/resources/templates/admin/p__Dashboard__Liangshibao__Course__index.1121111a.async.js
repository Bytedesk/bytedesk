"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1742],{11475:function(Z,P,e){e.d(P,{Z:function(){return c}});var R=e(1413),n=e(67294),d={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},r=d,_=e(91146),i=function(f,y){return n.createElement(_.Z,(0,R.Z)((0,R.Z)({},f),{},{ref:y,icon:r}))},m=n.forwardRef(i),c=m},51042:function(Z,P,e){var R=e(1413),n=e(67294),d=e(42110),r=e(91146),_=function(c,s){return n.createElement(r.Z,(0,R.Z)((0,R.Z)({},c),{},{ref:s,icon:d.Z}))},i=n.forwardRef(_);P.Z=i},30300:function(Z,P,e){e.d(P,{FU:function(){return s},O7:function(){return F},k4:function(){return y},yr:function(){return j}});var R=e(15009),n=e.n(R),d=e(97857),r=e.n(d),_=e(99289),i=e.n(_),m=e(85615),c=e(86745);function s(a){return f.apply(this,arguments)}function f(){return f=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/category/query/org",{method:"GET",params:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),f.apply(this,arguments)}function y(a){return g.apply(this,arguments)}function g(){return g=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/category/create",{method:"POST",data:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),g.apply(this,arguments)}function j(a){return E.apply(this,arguments)}function E(){return E=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/category/update",{method:"POST",data:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),E.apply(this,arguments)}function U(a){return M.apply(this,arguments)}function M(){return M=_asyncToGenerator(_regeneratorRuntime().mark(function a(v){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/v1/category/delete",{method:"POST",data:_objectSpread(_objectSpread({},v),{},{client:HTTP_CLIENT})}));case 1:case"end":return t.stop()}},a)})),M.apply(this,arguments)}function w(a){return B.apply(this,arguments)}function B(){return B=_asyncToGenerator(_regeneratorRuntime().mark(function a(v){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/v1/category/all",{method:"GET",params:_objectSpread(_objectSpread({},v),{},{client:HTTP_CLIENT})}));case 1:case"end":return t.stop()}},a)})),B.apply(this,arguments)}function F(){return W.apply(this,arguments)}function W(){return W=i()(n()().mark(function a(){return n()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.abrupt("return",(0,c.request)("/visitor/api/v1/category/query",{method:"GET",params:{client:m.bV}}));case 1:case"end":return T.stop()}},a)})),W.apply(this,arguments)}},7420:function(Z,P,e){e.d(P,{$T:function(){return y},A:function(){return w},Hf:function(){return U},P6:function(){return j},gx:function(){return s}});var R=e(15009),n=e.n(R),d=e(97857),r=e.n(d),_=e(99289),i=e.n(_),m=e(85615),c=e(86745);function s(a){return f.apply(this,arguments)}function f(){return f=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/course/query/org",{method:"GET",params:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),f.apply(this,arguments)}function y(a){return g.apply(this,arguments)}function g(){return g=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/course/query/user",{method:"GET",params:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),g.apply(this,arguments)}function j(a){return E.apply(this,arguments)}function E(){return E=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/course/create",{method:"POST",data:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),E.apply(this,arguments)}function U(a){return M.apply(this,arguments)}function M(){return M=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/course/update",{method:"POST",data:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),M.apply(this,arguments)}function w(a){return B.apply(this,arguments)}function B(){return B=i()(n()().mark(function a(v){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,c.request)("/api/v1/course/delete",{method:"POST",data:r()(r()({},v),{},{client:m.bV})}));case 1:case"end":return t.stop()}},a)})),B.apply(this,arguments)}function F(a){return W.apply(this,arguments)}function W(){return W=_asyncToGenerator(_regeneratorRuntime().mark(function a(v){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/v1/course/filter",{method:"GET",params:_objectSpread(_objectSpread({},v),{},{client:HTTP_CLIENT})}));case 1:case"end":return t.stop()}},a)})),W.apply(this,arguments)}},77154:function(Z,P,e){var R=e(39825);function n(){var d=(0,R.Z)(),r=d.isDarkMode,_={borderRight:r?"1px solid #333":"1px solid #ccc",background:r?"#141414":"#f5f5f5"},i={background:r?"#141414":"#fff"},m={borderLeft:r?"1px solid #333":"1px solid #ccc",background:r?"#141414":"#f5f5f5"},c={minHeight:120,background:r?"#141414":"#f5f5f5"};return{leftSiderStyle:_,headerStyle:i,rightSiderStyle:m,contentStyle:c}}P.Z=n},83373:function(Z,P,e){e.r(P),e.d(P,{default:function(){return ge}});var R=e(77154),n=e(21612),d=e(67294),r=e(15009),_=e.n(r),i=e(99289),m=e.n(i),c=e(5574),s=e.n(c),f=e(80049),y=e(7420),g=e(89333),j=e(60247),E=e(11475),U=e(51042),M=e(96853),w=e(85576),B=e(14726),F=e(8232),W=e(85265),a=e(42075),v=e(55102),T=e(2084),t=e(74656),ne=e(89102),l=e(85893),ie=function(S){var b=S.isEdit,u=S.course,$=S.open,K=S.onClose,N=S.onSubmit,X=F.Z.useForm(),Y=s()(X,1),L=Y[0],V=(0,ne.v)(function(x){return x.categoryTreeOptions});(0,d.useEffect)(function(){if(u&&L){var x,D;L.setFieldsValue({name:u==null?void 0:u.name,description:u==null?void 0:u.description}),L.setFieldsValue({categories:[u==null||(x=u.mainCategory)===null||x===void 0?void 0:x.uid,u==null||(D=u.subCategory)===null||D===void 0?void 0:D.uid]})}else L!=null&&!b&&(console.log("form resetFields"),L.resetFields())},[u]);var re=function(D){console.log("handleNameChange:",D)},q=function(D,z){console.log("Cascader value:",D),console.log("Cascader selectedData:",z)},H=function(D){console.log("selected ".concat(D))},J=function(){console.log("handleSubmit"),L.validateFields().then(function(D){console.log("Form values:",D);var z={uid:u==null?void 0:u.uid,name:D.name,cover:u.cover,description:D.description,detail:u.detail,price:u.price,mainCategory:{uid:D.categories[0]},subCategory:{uid:D.categories[1]},published:D.published==="true"};N(z)}).catch(function(D){console.log("Form errors:",D)})};return(0,l.jsx)("div",{children:(0,l.jsx)(W.Z,{title:b?"\u4FEE\u6539\u8BFE\u7A0B":"\u65B0\u5EFA\u8BFE\u7A0B",onClose:K,open:$,extra:(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(B.ZP,{onClick:K,children:"\u53D6\u6D88"}),(0,l.jsx)(B.ZP,{onClick:J,type:"primary",children:"\u4FDD\u5B58"})]}),children:(0,l.jsxs)(F.Z,{form:L,children:[(0,l.jsx)(F.Z.Item,{name:"name",label:"\u8BFE\u7A0B\u540D\u79F0",initialValue:u==null?void 0:u.name,children:(0,l.jsx)(v.Z,{placeholder:"\u8BF7\u8F93\u5165\u8BFE\u7A0B\u540D\u79F0"})}),(0,l.jsx)(F.Z.Item,{name:"categories",label:"\u8BFE\u7A0B\u5206\u7C7B",children:(0,l.jsx)(T.Z,{options:V,onChange:q,placeholder:"\u9009\u62E9\u5206\u7C7B"})}),(0,l.jsx)(F.Z.Item,{name:"description",label:"\u8BFE\u7A0B\u63CF\u8FF0",initialValue:u==null?void 0:u.description,children:(0,l.jsx)(v.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u8BFE\u7A0B\u63CF\u8FF0"})}),(0,l.jsx)(F.Z.Item,{name:"published",label:"\u8BFE\u7A0B\u72B6\u6001",initialValue:u!=null&&u.published?"true":"false",children:(0,l.jsx)(t.Z,{style:{width:120},onChange:H,options:[{value:"true",label:"\u5DF2\u53D1\u5E03"},{value:"false",label:"\u672A\u53D1\u5E03"}]})})]})})})},le=ie,de=e(30300),ce=e(86745),_e=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u5C01\u9762",dataIndex:"cover",render:function(S,b){return(0,l.jsx)("a",{href:b.cover,target:"_blank",children:(0,l.jsx)("img",{src:b.cover,width:"40",height:"40"})})}},{title:"\u540D\u79F0",dataIndex:"name",copyable:!0},{title:"\u5206\u7C7B",key:"category",render:function(S,b){var u=b.mainCategory?b.mainCategory.name:"-",$=b.subCategory?b.subCategory.name:"-";return(0,l.jsxs)("span",{children:[u," / ",$]})}},{title:"\u57CE\u5E02",dataIndex:"city",render:function(S,b){return b.city?b.city.name:"-"}},{title:"\u53D1\u5E03\u4EBA",editable:!1,renderText:function(S,b,u,$){var K;return(K=b.user)===null||K===void 0?void 0:K.nickname}},{title:"\u72B6\u6001",key:"published",render:function(S,b){return b.published?"\u5DF2\u53D1\u5E03":"\u672A\u53D1\u5E03"}},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt",dataIndex:"updatedAt",editable:!1,sorter:!0,hideInSearch:!0}],me=function(){var S=(0,ce.useIntl)(),b=(0,j.L)(function(p){return p.userInfo}),u=(0,d.useRef)(),$=(0,d.useState)(1),K=s()($,2),N=K[0],X=K[1],Y=(0,d.useState)(10),L=s()(Y,2),V=L[0],re=L[1],q=(0,d.useState)(!0),H=s()(q,2),J=H[0],x=H[1],D=(0,d.useState)(),z=s()(D,2),he=z[0],ae=z[1],G=(0,g.K)(function(p){return{courseResult:p.courseResult,insertCourseResult:p.insertCourseResult,updateCourseResult:p.updateCourseResult,deleteCourseResult:p.deleteCourseResult,setCourseResult:p.setCourseResult}}),Q=G.courseResult,Ce=G.insertCourseResult,ye=G.updateCourseResult,Ee=G.deleteCourseResult,be=G.setCourseResult,De=(0,ne.v)(function(p){return p.setCategoryResult}),Oe=(0,d.useState)(!1),ue=s()(Oe,2),Re=ue[0],ee=ue[1],Pe=w.Z.useModal(),se=s()(Pe,2),je=se[0],Te=se[1],Me=function(h){je.confirm({title:S.formatMessage({id:"deleteTip"}),icon:(0,l.jsx)(E.Z,{}),content:"\u786E\u8BA4\u8981\u5220\u9664\u8BFE\u7A0B\u3010".concat(h.name,"\u3011\u5417\uFF1F"),onOk:function(){Be(h)},onCancel:function(){},okText:S.formatMessage({id:"ok"}),cancelText:S.formatMessage({id:"cancel"})})},Se=function(){ae(void 0),x(!1),ee(!0)},Ae=function(h){ae(h),x(!0),ee(!0)},te=function(){ee(!1)},Ue=function(){var p=m()(_()().mark(function h(o){var O,A;return _()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(console.log("handleSubmitDrawer:",o),!J){I.next=9;break}return I.next=4,(0,y.Hf)(o);case 4:O=I.sent,console.log("updateCourse:",O),O.code===200?(f.yw.success("\u66F4\u65B0\u6210\u529F"),ye(O.data),te()):f.yw.error(O.message),I.next=14;break;case 9:return I.next=11,(0,y.P6)(o);case 11:A=I.sent,console.log("createCourse:",A),A.code===200?(f.yw.success("\u521B\u5EFA\u6210\u529F"),Ce(A.data),te()):f.yw.error(A.message);case 14:case"end":return I.stop()}},h)}));return function(o){return p.apply(this,arguments)}}(),Be=function(){var p=m()(_()().mark(function h(o){var O;return _()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return console.log("handleDeleteCourse:",o),C.next=3,(0,y.A)(o);case 3:O=C.sent,O.code===200?Ee(o):f.yw.error(O.message);case 5:case"end":return C.stop()}},h)}));return function(o){return p.apply(this,arguments)}}(),Ie=[].concat(_e,[{title:"\u64CD\u4F5C",valueType:"option",key:"option",render:function(h,o,O,A){return[(0,l.jsx)("a",{onClick:function(){console.log("edit record:",o),Ae(o)},children:"\u4FEE\u6539"},"editable"),(0,l.jsx)(B.ZP,{size:"small",type:"link",onClick:function(){return Me(o)},danger:!0,children:"\u5220\u9664"},"delete")]}}]),oe=function(){var p=m()(_()().mark(function h(){var o,O;return _()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(o={pageNumber:N-1,pageSize:V},!b.superUser){C.next=7;break}return C.next=4,(0,y.gx)(o);case 4:C.t0=C.sent,C.next=10;break;case 7:return C.next=9,(0,y.$T)(o);case 9:C.t0=C.sent;case 10:O=C.t0,console.log("getAllCourses response:",o,O),O.code===200?be(O):f.yw.error(O.message);case 13:case"end":return C.stop()}},h)}));return function(){return p.apply(this,arguments)}}(),xe=function(){var p=m()(_()().mark(function h(){var o;return _()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,de.O7)();case 2:o=A.sent,console.log("getAllCategories response:",o),o.code===200?De(o):f.yw.error(o.message);case 5:case"end":return A.stop()}},h)}));return function(){return p.apply(this,arguments)}}();return(0,d.useEffect)(function(){oe(),xe()},[]),(0,d.useEffect)(function(){oe()},[N,V]),(0,d.useEffect)(function(){console.log("courseResult:",Q),u.current.reload()},[Q]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(M.Z,{columns:Ie,actionRef:u,cardBordered:!0,request:function(){var p=m()(_()().mark(function h(o,O,A){return _()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return console.log("request:",o,O,A),X(o.current),re(o.pageSize),I.abrupt("return",Promise.resolve({data:Q.data.content,success:!0,total:Q.data.totalElements}));case 4:case"end":return I.stop()}},h)}));return function(h,o,O){return p.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:V,showQuickJumper:!0,onChange:function(h){console.log("page:",h)}},dateFormatter:"string",headerTitle:"\u8BFE\u7A0B",toolBarRender:function(){return[(0,l.jsxs)(B.ZP,{type:"primary",onClick:Se,children:[(0,l.jsx)(U.Z,{}),"\u65B0\u5EFA"]})]}}),(0,l.jsx)(le,{isEdit:J,course:he,open:Re,onClose:te,onSubmit:Ue}),Te]})},pe=me,Fe=n.Z.Sider,fe=n.Z.Content,ve=function(){var S=(0,R.Z)(),b=S.contentStyle;return(0,l.jsx)(n.Z,{children:(0,l.jsx)(n.Z,{children:(0,l.jsx)(fe,{style:b,children:(0,l.jsx)(pe,{})})})})},ge=ve},89102:function(Z,P,e){e.d(P,{v:function(){return s}});var R=e(19632),n=e.n(R),d=e(97857),r=e.n(d),_=e(85615),i=e(64529),m=e(782),c=e(71381),s=(0,i.Ue)()((0,m.mW)((0,m.tJ)((0,c.n)(function(g,j){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:""},setCategoryResult:function(U){var M=y(U),w={uid:"all",name:"\u5168\u90E8"},B=r()(r()({},U),{},{data:{content:[w].concat(n()(U.data.content))}}),F=f(B);g({categoryResult:B,categoryTreeOptions:F,categorySelectOptions:M})},setCurrentCategoryUid:function(U){var M=j().categoryResult.data.content.find(function(w){return w.uid===U});g({currentCategory:M})},deleteCategoryCache:function(){return g({},!0)}}}),{name:_.OM})));function f(g){var j=[];return g.data.content.forEach(function(E){var U={title:E.name,key:E.uid,children:[]};E.children&&Array.isArray(E.children)&&(U.children=E.children.map(function(M){return{title:M.name,key:M.uid,children:[]}})),j.push(U)}),j}function y(g){var j=[];return g.data.content.forEach(function(E){var U={label:E.name,value:E.uid};j.push(U)}),j}},89333:function(Z,P,e){e.d(P,{K:function(){return _}});var R=e(85615),n=e(64529),d=e(782),r=e(71381),_=(0,n.Ue)()((0,d.mW)((0,d.tJ)((0,r.n)(function(i,m){return{courseResult:{data:{content:[]}},insertCourseResult:function(s){i(function(f){var y=f.courseResult.data.content;y.unshift(s)})},updateCourseResult:function(s){i(function(f){var y=f.courseResult.data.content,g=y.findIndex(function(j){return j.uid===s.uid});g!==-1?y[g]=s:console.warn("Course with uid ".concat(s.uid," not found."))})},deleteCourseResult:function(s){i(function(f){var y=f.courseResult.data.content,g=y.findIndex(function(j){return j.uid===s.uid});g!==-1?y.splice(g,1):console.warn("Course with uid ".concat(s.uid," not found."))})},setCourseResult:function(s){i({courseResult:s})},deleteCourseCache:function(){return i({},!0)}}}),{name:R.vC})))},60247:function(Z,P,e){e.d(P,{L:function(){return _}});var R=e(85615),n=e(64529),d=e(782),r=e(71381),_=(0,n.Ue)()((0,d.mW)((0,d.tJ)((0,r.n)(function(i,m){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(s){i({userInfo:s})},setDeviceUid:function(s){i({deviceUid:s})},deleteUserInfo:function(){return i({},!0)}}}),{name:R.Em})))}}]);
