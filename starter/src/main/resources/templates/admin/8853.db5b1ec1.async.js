"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8853],{82863:function(e,r,n){n.d(r,{Jr:function(){return m},LF:function(){return d},Oh:function(){return h},WS:function(){return v}});var t=n(90819),o=n.n(t),i=n(73193),l=n.n(i),a=n(89933),s=n.n(a),u=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return P.apply(this,arguments)}function P(){return(P=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36605:function(e,r,n){n.d(r,{HH:function(){return h},T:function(){return m},fx:function(){return v},mK:function(){return d}});var t=n(90819),o=n.n(t),i=n(73193),l=n.n(i),a=n(89933),s=n.n(a),u=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/query/org",{method:"GET",params:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/create",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/update",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return P.apply(this,arguments)}function P(){return(P=s()(o()().mark((function e(r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/delete",{method:"POST",data:l()(l()({},r),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92053:function(e,r,n){n.d(r,{V:function(){return u},c:function(){return d}});var t=n(90819),o=n.n(t),i=n(89933),l=n.n(i),a=n(55735),s=n(30921);function u(){return c.apply(this,arguments)}function c(){return(c=l()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:a.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return f.apply(this,arguments)}function f(){return(f=l()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:a.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},59875:function(e,r,n){var t=n(90819),o=n.n(t),i=n(89933),l=n.n(i),a=n(45332),s=n.n(a),u=n(44194),c=n(36605),d=n(86803),f=n(23864),m=n(76750),p=n(30921),v=n(53530),g=n(27487),h=n(75365),P=n(9452),y=n(84288),x=n(40612),w=n(55735),k=n(15722),L=n(25482),b=n(11490),j=n(31842),M=n(19317),Z=n(31549);r.Z=function(e){var r,n,t=e.level,i=(0,f.Z)().isDarkMode,a=(0,p.useIntl)(),S=(0,m.Z)(),C=S.translateString,R=S.translateStringTranct,E=(0,x.u)((function(e){return e.currentOrg})),q=(0,u.useState)(!1),O=s()(q,2),T=O[0],U=O[1],K=(0,u.useState)(!1),F=s()(K,2),I=F[0],V=F[1],A=(0,b.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}})),D=A.llmproviderResult,H=A.currentLlmProvider,z=A.setLlmProviderResult,W=A.insertLlmProvider,Y=A.setCurrentLlmProvider,N=A.upgradeLlmProvider,B=A.deleteCurrentLlmProvider,G=(0,M.$)((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),J=G.llmproviderResultPlatform,_=G.currentLlmProviderPlatform,Q=G.setLlmProviderResultPlatform,$=G.insertLlmProviderPlatform,X=G.setCurrentLlmProviderPlatform,ee=G.upgradeLlmProviderPlatform,re=G.deleteCurrentLlmProviderPlatform,ne=(0,u.useState)(t===w.Hxq),te=s()(ne,1)[0],oe=te?_:H,ie=v.Z.useModal(),le=s()(ie,2),ae=le[0],se=le[1],ue=function(){var e=l()(o()().mark((function e(r){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),d.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,c.HH)(r);case 4:n=e.sent,console.log("delete robot response",n),200===n.code?(d.yw.destroy(),d.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),te?re(r.uid):B(r.uid)):(d.yw.destroy(),d.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ce=function(){var e=l()(o()().mark((function e(){var r,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),r={pageNumber:0,pageSize:50,status:t===w.Hxq?"":w.KY,orgUid:null==E?void 0:E.uid,level:t},e.next=4,(0,c.mK)(r);case 4:n=e.sent,console.log("queryLlmProvidersByOrg: ",n),200===n.code?te?Q(n):z(n):d.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){ce()}),[]);var de=function(){var e=l()(o()().mark((function e(r){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",r),d.yw.loading(a.formatMessage({id:"creating"})),e.next=4,(0,c.T)(r);case 4:n=e.sent,console.log("createLlmProvider:",n),200===n.code?(d.yw.destroy(),d.yw.success(a.formatMessage({id:"create.success",defaultMessage:"create success"})),te?$(n.data):W(n.data),U(!1)):(d.yw.destroy(),d.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),fe=function(){var e=l()(o()().mark((function e(r){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(a.formatMessage({id:"updating"})),e.next=3,(0,c.fx)(r);case 3:n=e.sent,console.log("updateLlmProvider:",r,n),200===n.code?(d.yw.destroy(),d.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),te?ee(n.data):N(n.data),U(!1)):(d.yw.destroy(),d.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{style:{margin:10},children:(0,Z.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[(0,Z.jsx)(h.ZP,{size:"small",type:"primary",icon:(0,Z.jsx)(L.Z,{}),onClick:function(){console.log("new llmProvider"),V(!1),U(!0)},children:a.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,Z.jsx)(h.ZP,{size:"small",onClick:function(){console.log("edit llmProvider"),V(!0),U(!0)},disabled:""===(null==oe?void 0:oe.uid),children:a.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,Z.jsx)(h.ZP,{onClick:function(){return function(e){ae.confirm({title:a.formatMessage({id:"deleteTip"}),icon:(0,Z.jsx)(k.Z,{}),content:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(C(e.nickname),"】？"),onOk:function(){ue(e)},onCancel:function(){},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}(oe)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==oe?void 0:oe.uid),children:a.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,Z.jsx)(P.Z,{itemLayout:"horizontal",dataSource:te?(null==J||null===(r=J.data)||void 0===r?void 0:r.content)||[]:(null==D||null===(n=D.data)||void 0===n?void 0:n.content)||[],renderItem:function(e,r){return(0,Z.jsx)(P.Z.Item,{style:(null==oe?void 0:oe.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return r=e,void(te?X(r):Y(r));var r},children:(0,Z.jsx)(P.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,Z.jsx)(y.C,{src:e.logo}),title:(0,Z.jsx)(Z.Fragment,{children:R(null==e?void 0:e.nickname)}),description:(null==e?void 0:e.status)===w.KY?"上线发布":"未上线"})})}}),T&&(0,Z.jsx)(j.Z,{open:T,isEdit:I,level:t,llmProvider:oe,onCancel:function(){U(!1)},onSubmit:function(e){I?fe(e):de(e)}}),se]})}},41672:function(e,r,n){n.d(r,{Z:function(){return B}});var t=n(76711),o=n.n(t),i=n(45332),l=n.n(i),a=n(44194),s=n(8247),u=n(73193),c=n.n(u),d=n(90819),f=n.n(d),m=n(89933),p=n.n(m),v=n(86803),g=n(82863),h=n(40612),P=n(55735),y=n(53530),x=n(84288),w=n(75365),k=n(39042),L=n(38775),b=n(3849),j=n(9452),M=n(69169),Z=n(4499),S=n(73442),C=n(31549),R=function(e){var r=e.isEdit,n=e.llmmodel,t=e.provider,o=e.open,i=e.level,s=e.onClose,u=e.onSubmit,c=M.A.useForm(),d=l()(c,1)[0],f=(0,h.u)((function(e){return e.currentOrg}));(0,a.useEffect)((function(){r&&n&&d?d.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,nickname:null==n?void 0:n.nickname}):(console.log("form resetFields"),d.resetFields())}),[n]);return(0,a.useEffect)((function(){}),[n]),(0,C.jsx)("div",{children:(0,C.jsx)(S.Z,{title:r?"编辑模型":"新建模型",onClose:s,open:o,extra:(0,C.jsxs)(b.Z,{children:[(0,C.jsx)(w.ZP,{onClick:s,children:"取消"}),(0,C.jsx)(w.ZP,{onClick:function(){console.log("handleSubmit"),d.validateFields().then((function(e){console.log("Form values:",e);var o={uid:r?null==n?void 0:n.uid:"",name:e.name,nickname:e.nickname,providerUid:null==t?void 0:t.uid,level:i,orgUid:null==f?void 0:f.uid};console.log("llmmodelObject:",o),u(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,C.jsxs)(M.A,{form:d,name:"model",submitter:!1,children:[(0,C.jsx)(Z.Z,{label:"名称(用于接口调用)",name:"name"}),(0,C.jsx)(Z.Z,{label:"昵称(便于记忆)",name:"nickname"})]})})})},E=n(15722),q=n(11090),O=n(25482),T=n(80556),U=n(30921),K=n(36605),F=n(23864),I=n(76750),V=n(11490),A=n(31842),D=function(e){var r=e.provider,n=e.level,t=(0,U.useIntl)(),o=(0,F.Z)().isDarkMode,i=(0,a.useState)(!0),s=l()(i,2),u=s[0],d=s[1],m=(0,I.Z)(),M=m.translateString,Z=(m.translateStringTranct,(0,a.useState)()),S=l()(Z,2),D=S[0],H=S[1],z=(0,a.useState)(!1),W=l()(z,2),Y=W[0],N=W[1],B=(0,h.u)((function(e){return e.currentOrg})),G=(0,a.useState)([]),J=l()(G,2),_=J[0],Q=J[1],$=(0,V.A)((function(e){return e.upgradeLlmProvider})),X=y.Z.useModal(),ee=l()(X,2),re=ee[0],ne=ee[1],te=(0,a.useState)(!1),oe=l()(te,2),ie=oe[0],le=oe[1],ae=function(){var e=p()(f()().mark((function e(r){var n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),v.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,g.Oh)(r);case 4:n=e.sent,console.log("delete robot response",n),200===n.code?(v.yw.destroy(),v.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),se()):(v.yw.destroy(),v.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),se=function(){var e=p()(f()().mark((function e(){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestModels"),Q([]),v.yw.loading(t.formatMessage({id:"loading",defaultMessage:"Loading"})),o={pageNumber:0,pageSize:50,providerUid:null==r?void 0:r.uid,orgUid:null==B?void 0:B.uid,level:n},e.next=6,(0,g.LF)(o);case 6:i=e.sent,console.log("queryLlmModelsByOrg: ",i,o),200===i.code?(Q(i.data.content),v.yw.destroy()):(v.yw.destroy(),v.yw.error(i.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){se()}),[]);var ue=function(){N(!1)},ce=function(){var e=p()(f()().mark((function e(r){var n,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!u){e.next=9;break}return e.next=4,(0,g.WS)(r);case 4:n=e.sent,console.log("updateLlmModel:",n),200===n.code?(v.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),se(),ue()):v.yw.error(n.message),e.next=14;break;case 9:return e.next=11,(0,g.Jr)(r);case 11:o=e.sent,console.log("createLlmModel:",o),200===o.code?(v.yw.success(t.formatMessage({id:"create.success",defaultMessage:"create success"})),se(),ue()):v.yw.error(o.message);case 14:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),de=function(){var e=p()(f()().mark((function e(n){var o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",r),o=c()(c()({},r),{},{status:n?P.KY:P.L2A}),e.next=4,(0,K.fx)(o);case 4:i=e.sent,console.log("updateLlmProvider:",o,i),200===i.code?(v.yw.destroy(),v.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),$(i.data)):(v.yw.destroy(),v.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),fe=function(e,r){var n;console.log("list on delete",e),n=e,re.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,C.jsx)(E.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(n.nickname),"】？"),onOk:function(){ae(n)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})},me=function(){var e=p()(f()().mark((function e(r){var n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,K.fx)(r);case 3:n=e.sent,console.log("updateLlmProvider:",r,n),200===n.code?(v.yw.destroy(),v.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),$(n.data),le(!1)):(v.yw.destroy(),v.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("h1",{children:[(0,C.jsx)(x.C,{src:null==r?void 0:r.logo}),null==r?void 0:r.nickname,(0,C.jsx)(w.ZP,{type:"text",icon:(0,C.jsx)(q.Z,{}),onClick:function(){window.open(null==r?void 0:r.webUrl,"_blank")}})]}),(0,C.jsxs)("p",{children:["apiUrl: ",null==r?void 0:r.apiUrl]}),(0,C.jsxs)("p",{children:["apiKey: ",null!=r&&r.apiKey?"".concat(r.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),n===P.Hxq&&(0,C.jsx)(k.Z,{checkedChildren:"上线发布",unCheckedChildren:"下线调试",defaultChecked:(null==r?void 0:r.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),de(e)}}),(0,C.jsx)(L.Z,{orientation:"left",children:"模型列表"}),(0,C.jsxs)(b.Z,{children:[(0,C.jsx)(w.ZP,{icon:(0,C.jsx)(O.Z,{}),type:"primary",onClick:function(){d(!1),N(!0)},children:"添加模型"}),(0,C.jsx)(w.ZP,{icon:(0,C.jsx)(T.Z,{}),onClick:se,children:"刷新模型"})]}),(0,C.jsx)(j.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:_,renderItem:function(e,r){return(0,C.jsx)(j.Z.Item,{style:(null==D?void 0:D.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){H(e)},actions:[(0,C.jsx)(w.ZP,{type:"link",onClick:function(){return r=e,console.log("list on edit",r),d(!0),void N(!0);var r},children:t.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,C.jsx)(w.ZP,{type:"link",onClick:function(){return fe(e)},children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,C.jsx)(j.Z.Item.Meta,{style:{marginLeft:"15px"},title:e.nickname,description:e.name})})}}),Y&&(0,C.jsx)(R,{isEdit:u,llmmodel:D,provider:r,open:Y,level:n,onClose:ue,onSubmit:ce}),ie&&(0,C.jsx)(A.Z,{open:ie,isEdit:u,level:n,llmProvider:r,onCancel:function(){return le(!1)},onSubmit:me}),ne]})},H=n(92053),z=n(32943),W=n(65461),Y=function(e){var r=e.provider,n=e.level,t=(0,U.useIntl)(),o=(0,F.Z)().isDarkMode,i=(0,a.useState)(!1),s=l()(i,2),u=s[0],c=s[1],d=(0,a.useState)(!1),m=l()(d,2),g=m[0],h=m[1],P=(0,a.useState)([]),y=l()(P,2),k=y[0],b=y[1],M=(0,a.useState)(!1),Z=l()(M,2),S=Z[0],R=Z[1],E=(0,V.A)((function(e){return e.upgradeLlmProvider})),O=(0,a.useState)(),I=l()(O,2),D=I[0],Y=I[1],N=function(){var e=p()(f()().mark((function e(){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),console.log("pingOllama"),e.next=4,(0,H.V)();case 4:r=e.sent,console.log("getOllamaServerStatus: ",r),200===r.code?(h(r.data),c(!1)):(h(!1),c(!1));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=p()(f()().mark((function e(){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,(0,H.c)();case 3:r=e.sent,console.log("getOllamaLocalModels: ",r),200===r.code&&b(r.data);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){N(),B()};(0,a.useEffect)((function(){G()}),[]);var J=function(){var e=p()(f()().mark((function e(r){var n;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading(t.formatMessage({id:"updating"})),e.next=3,(0,K.fx)(r);case 3:n=e.sent,console.log("updateLlmProvider:",r,n),200===n.code?(v.yw.destroy(),v.yw.success(t.formatMessage({id:"update.success",defaultMessage:"update success"})),E(n.data),R(!1)):(v.yw.destroy(),v.yw.error(n.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("h1",{children:[(0,C.jsx)(x.C,{src:null==r?void 0:r.logo}),null==r?void 0:r.nickname,(0,C.jsx)(w.ZP,{type:"text",icon:(0,C.jsx)(q.Z,{}),onClick:function(){window.open(null==r?void 0:r.webUrl,"_blank")}})]}),(0,C.jsx)(w.ZP,{icon:(0,C.jsx)(T.Z,{}),loading:u,type:"primary",onClick:G,children:"刷新"}),(0,C.jsx)("br",{}),(0,C.jsx)("br",{}),g?(0,C.jsx)(z.Z,{message:"Ollama运行中",type:"success"}):(0,C.jsx)(z.Z,{message:"请首先启动Ollama",type:"error"}),(0,C.jsx)(L.Z,{orientation:"left",children:"本地模型列表"}),(0,C.jsx)(j.Z,{itemLayout:"horizontal",style:{marginTop:10},dataSource:k,renderItem:function(e,r){return(0,C.jsx)(j.Z.Item,{style:(null==D?void 0:D.name)===e.name?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Y(e)},actions:[],children:(0,C.jsx)(j.Z.Item.Meta,{title:null==e?void 0:e.name,description:(0,W.mr)(null==e?void 0:e.modified_at.toString()),style:{marginLeft:"15px"}})})}}),S&&(0,C.jsx)(A.Z,{open:S,isEdit:!0,level:n,llmProvider:r,onCancel:function(){return R(!1)},onSubmit:J})]})},N=n(19317),B=function(e){var r=e.level,n=(0,a.useState)("default"),t=l()(n,2),i=t[0],u=t[1],c=(0,a.useState)([]),d=l()(c,2),f=d[0],m=d[1],p=(0,V.A)((function(e){return e.currentLlmProvider})),v=(0,N.$)((function(e){return e.currentLlmProviderPlatform})),g=(0,a.useState)(r===P.Hxq),h=l()(g,1)[0]?v:p;(0,a.useEffect)((function(){if(console.log("llmProvider: ",h),f.find((function(e){return e.key===(null==h?void 0:h.name)})))u(null==h?void 0:h.name);else{var e=o()(f);"ollama"===(null==h?void 0:h.name)?e.push({label:null==h?void 0:h.nickname,children:(0,C.jsx)(Y,{provider:h,level:r}),key:null==h?void 0:h.name,closable:!0}):e.push({label:null==h?void 0:h.nickname,children:(0,C.jsx)(D,{provider:h,level:r}),key:null==h?void 0:h.name,closable:!0}),m(e),u(null==h?void 0:h.name)}}),[h]);return(0,C.jsx)(s.Z,{type:"editable-card",onChange:function(e){u(e)},activeKey:i,onEdit:function(e,r){!function(e){var r=i,n=-1;f.forEach((function(r,t){r.key===e&&(n=t-1)}));var t=f.filter((function(r){return r.key!==e}));t.length&&r===e&&(r=n>=0?t[n].key:t[0].key),m(t),u(r)}(e)},items:f})}},31842:function(e,r,n){var t=n(90819),o=n.n(t),i=n(89933),l=n.n(i),a=n(45332),s=n.n(a),u=n(86803),c=n(36605),d=n(40612),f=n(55735),m=n(69169),p=n(84881),v=n(4499),g=n(16309),h=n(53530),P=n(44194),y=n(31549);r.Z=function(e){var r=e.open,n=e.isEdit,t=e.llmProvider,i=e.level,a=e.onCancel,x=e.onSubmit,w=g.Z.useForm(),k=s()(w,1)[0],L=(0,d.u)((function(e){return e.currentOrg})),b=(0,P.useState)([]),j=s()(b,2),M=j[0],Z=j[1],S=(0,P.useState)([]),C=s()(S,2),R=C[0],E=C[1],q=(0,P.useState)(),O=s()(q,2),T=O[0],U=O[1],K=function(){var e=l()(o()().mark((function e(){var r,n,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLlmProviders"),r={pageNumber:0,pageSize:50,status:"",level:f.Hxq},e.next=4,(0,c.mK)(r);case 4:n=e.sent,console.log("queryLlmProvidersByOrg: ",n),200===n.code?Z(null==n||null===(t=n.data)||void 0===t?void 0:t.content):u.yw.error(n.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,P.useEffect)((function(){var e=[];M.forEach((function(r){e.push({label:r.nickname,value:r.name,disabled:r.status!==f.KY})})),E(e)}),[M]),(0,P.useEffect)((function(){i===f.whQ&&K()}),[]),(0,P.useEffect)((function(){n?(U(t),k.setFieldsValue({name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,apiUrl:null==t?void 0:t.apiUrl,apiKey:null==t?void 0:t.apiKey})):k.resetFields()}),[n,t]);return(0,y.jsx)("div",{children:(0,y.jsx)(h.Z,{title:"添加大模型提供商",open:r,forceRender:!0,onOk:function(){k.validateFields().then(function(){var e=l()(o()().mark((function e(r){var i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={uid:n?null==t?void 0:t.uid:"",name:null==T?void 0:T.name,nickname:null==r?void 0:r.nickname,logo:null==T?void 0:T.logo,description:null==T?void 0:T.description,apiUrl:null==r?void 0:r.apiUrl,apiKey:null==r?void 0:r.apiKey,webUrl:null==T?void 0:T.webUrl,status:f.KY,level:f.whQ,orgUid:null==L?void 0:L.uid},console.log("handleSaveLlmProvider:",r,i),x(i);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),u.yw.error("创建角色失败")}))},onCancel:a,children:(0,y.jsxs)(m.A,{form:k,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[i===f.whQ&&(0,y.jsx)(p.Z,{label:"选择大模型提供商",name:"name",options:R,fieldProps:{placeholder:"选择大模型提供商(必选)",allowClear:!0,onChange:function(e){console.log("onParentSelectChange:",e);var r=M.find((function(r){return r.name===e}));U(r),console.log("selectedProvider:",r),k.setFieldsValue({nickname:null==r?void 0:r.nickname,apiUrl:null==r?void 0:r.apiUrl,apiKey:null==r?void 0:r.apiKey})},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,y.jsx)(v.Z,{label:"名称",name:"nickname",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,y.jsx)(v.Z,{label:"ApiUrl",name:"apiUrl",rules:[{required:!0,message:"请输入apiUrl!"}],fieldProps:{onPressEnter:function(e){}}}),"ollama"!==(null==T?void 0:T.name)&&(0,y.jsx)(v.Z.Password,{label:"ApiKey",name:"apiKey",fieldProps:{placeholder:"请输入apiKey",allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){}}})]})})})}},96865:function(e,r,n){var t=n(23864);r.Z=function(){var e=(0,t.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,r,n){var t=n(55735),o=n(65461),i=n(30921);r.Z=function(){var e=(0,i.useIntl)();return{translateString:function(r){return null==r?r:r&&r.startsWith(t.VoP)?e.formatMessage({id:r,defaultMessage:r}):r},translateStringTranct:function(r){return null==r?r:null!=r&&r.startsWith(t.VoP)||null!=r&&r.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:r,defaultMessage:r}),10):(0,o.aS)(r,10)}}}},11490:function(e,r,n){n.d(r,{A:function(){return d}});var t=n(73193),o=n.n(t),i=n(76711),l=n.n(i),a=n(55735),s=n(39701),u=n(83642),c=n(41617),d=(0,s.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,r){return{llmproviderResult:{data:{content:[]}},currentLlmProvider:{uid:"",nickname:""},insertLlmProvider:function(r){e((function(e){e.llmproviderResult.data.content.unshift(r)}))},upgradeLlmProvider:function(r){e((function(e){var n=e.llmproviderResult.data.content,t=n.findIndex((function(e){return e.uid===r.uid}));-1!==t?n[t]=r:console.warn("LlmProvider with uid ".concat(r.uid," not found."))}))},setLlmProviderResult:function(n){e({llmproviderResult:n});var t,o=r().currentLlmProvider;""!==o.uid&&void 0!==o||(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProvider:n.data.content[0]})},setCurrentLlmProvider:function(n){var t=r().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===n.uid}));if(-1!==i){var a=[].concat(l()(t.slice(0,i)),[n],l()(t.slice(i+1))),s=o()(o()({},r().llmproviderResult),{},{data:{content:a}});e({llmproviderResult:s,currentLlmProvider:n})}else e({currentLlmProvider:n})},deleteCurrentLlmProvider:function(n){var t=r().llmproviderResult.data.content,i=t.findIndex((function(e){return e.uid===n}));-1!==i?e({llmproviderResult:o()(o()({},r().llmproviderResult),{},{data:{content:[].concat(l()(t.slice(0,i)),l()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",n),r().currentLlmProvider.uid===n&&e({currentLlmProvider:{uid:""}})},deleteLlmProviderCache:function(){return e({},!0)}}})),{name:a.ajB})))},19317:function(e,r,n){n.d(r,{$:function(){return d}});var t=n(73193),o=n.n(t),i=n(76711),l=n.n(i),a=n(55735),s=n(39701),u=n(83642),c=n(41617),d=(0,s.Ue)()((0,u.mW)((0,u.tJ)((0,c.n)((function(e,r){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(r){e((function(e){e.llmproviderResultPlatform.data.content.unshift(r)}))},upgradeLlmProviderPlatform:function(r){e((function(e){var n=e.llmproviderResultPlatform.data.content,t=n.findIndex((function(e){return e.uid===r.uid}));-1!==t?n[t]=r:console.warn("LlmProvider with uid ".concat(r.uid," not found."))}))},setLlmProviderResultPlatform:function(n){e({llmproviderResultPlatform:n});var t,o=r().currentLlmProviderPlatform;""!==o.uid&&void 0!==o||(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentLlmProviderPlatform:n.data.content[0]})},setCurrentLlmProviderPlatform:function(n){var t=r().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===n.uid}));if(-1!==i){var a=[].concat(l()(t.slice(0,i)),[n],l()(t.slice(i+1))),s=o()(o()({},r().llmproviderResultPlatform),{},{data:{content:a}});e({llmproviderResultPlatform:s,currentLlmProviderPlatform:n})}else e({currentLlmProviderPlatform:n})},deleteCurrentLlmProviderPlatform:function(n){var t=r().llmproviderResultPlatform.data.content,i=t.findIndex((function(e){return e.uid===n}));-1!==i?e({llmproviderResultPlatform:o()(o()({},r().llmproviderResultPlatform),{},{data:{content:[].concat(l()(t.slice(0,i)),l()(t.slice(i+1)))}})}):console.warn("LlmProvider not found in cache:",n),r().currentLlmProviderPlatform.uid===n&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:a.dNm})))}}]);