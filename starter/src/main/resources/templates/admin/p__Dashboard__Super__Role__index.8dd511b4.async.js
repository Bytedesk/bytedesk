"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6021],{27536:function(e,n,t){t.r(n),t.d(n,{default:function(){return _}});var r=t(96865),s=t(75574),o=t(44194),i=t(8247),a=t(73193),u=t.n(a),c=t(76711),l=t.n(c),d=t(90819),f=t.n(d),m=t(89933),p=t.n(m),g=t(45332),h=t.n(g),y=t(86803),v=t(71121),x=t(76750),w=t(78488),R=t(62673),j=t(99749),Z=t(38775),k=t(30921),M=t(81924),C=t(55735),S=t(31549),b={width:"20%",textAlign:"center"},F=function(){var e,n=(0,k.useIntl)(),t=(0,x.Z)().translateString,r=(0,w.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole}})),s=r.upgradeRole,i=r.currentRole,a=r.setCurrentRole,c=(0,o.useState)([]),d=h()(c,2),m=d[0],g=d[1],F=(0,o.useState)(i.authorities),A=h()(F,2),E=A[0],P=A[1],z=function(){var e=p()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={pageNumber:0,pageSize:100,level:C.whQ},e.next=3,(0,v.SA)(n);case 3:t=e.sent,console.log("getAuthorities response",t),200===t.code?g(t.data.content):(console.log("getAuthorities error",t),y.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=m.reduce((function(e,n){var t=n.name.split("_"),r=h()(t,1)[0];return e[r]||(e[r]=[]),e[r].push(n),e}),{});(0,o.useEffect)((function(){P(i.authorities)}),[i.authorities]),(0,o.useEffect)((function(){z()}),[]);var O=function(e,n){var t=n?[].concat(l()(E),[e]):E.filter((function(n){return n.name!==e.name}));P(t),a(u()(u()({},i),{},{authorities:t})),T(u()(u()({},i),{},{authorities:t}))},T=function(){var e=p()(f()().mark((function e(t){var r,o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",r),y.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,M.ul)(r);case 5:o=e.sent,console.log("updateRole:",o),200===o.code?(y.yw.destroy(),y.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),s(o.data)):(y.yw.destroy(),y.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(R.Z,{title:"已选权限",children:null==i||null===(e=i.authorities)||void 0===e?void 0:e.map((function(e,n){return(0,S.jsx)(R.Z.Grid,{style:b,children:(0,S.jsx)(j.Z,{checked:null==E?void 0:E.some((function(n){return n.name===e.name})),onChange:function(n){return O(e,n.target.checked)},children:t(e.name)})},n)}))}),(0,S.jsx)(Z.Z,{children:"备选权限"}),Object.keys(I).map((function(e){return(0,S.jsx)(R.Z,{title:t(e),style:{marginTop:10},children:I[e].map((function(e){return(0,S.jsx)(R.Z.Grid,{style:b,children:(0,S.jsx)(j.Z,{checked:null==E?void 0:E.some((function(n){return n.name===e.name})),onChange:function(n){return O(e,n.target.checked)},disabled:""===(null==i?void 0:i.uid),children:t(e.name)})},e.name)}))},e)}))]})},A=function(e){console.log(e)},E=[{key:"authority",label:"权限",children:(0,S.jsx)(F,{})}],P=function(){return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(i.Z,{defaultActiveKey:"1",items:E,onChange:A})})},z=t(40612),I=t(53530),O=t(27487),T=t(75365),U=t(9452),q=t(23864),D=t(15722),G=t(82669),N=t(69169),B=t(4499),H=t(32350),K=t(16309),L=function(e){var n=e.open,t=e.isEdit,r=e.role,s=e.onCancel,i=e.onSubmit,a=K.Z.useForm(),u=h()(a,1)[0],c=(0,z.u)((function(e){return e.currentOrg}));(0,o.useEffect)((function(){t?u.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description}):u.resetFields()}),[t,r]);return(0,S.jsx)("div",{children:(0,S.jsx)(I.Z,{title:"创建角色",open:n,forceRender:!0,onOk:function(){u.validateFields().then(function(){var e=p()(f()().mark((function e(n){var s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={uid:t?null==r?void 0:r.uid:"",name:n.name,description:n.description,authorityUids:[],orgUid:null==c?void 0:c.uid},console.log("handleSaveRole:",n,s),i(s);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),y.yw.error("创建角色失败")}))},onCancel:s,children:(0,S.jsxs)(N.A,{form:u,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,S.jsx)(B.Z,{label:"角色名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,S.jsx)(H.Z,{label:"角色简介",name:"description",placeholder:"请输入角色简介",rules:[{required:!0,message:"角色简介是必填项"}],fieldProps:{onPressEnter:function(){u.submit()},autoSize:{minRows:2,maxRows:6}}})]})})})},Q=function(){var e=(0,k.useIntl)(),n=(0,q.Z)().isDarkMode,t=I.Z.useModal(),r=h()(t,2),s=r[0],i=r[1],a=(0,x.Z)().translateStringTranct,u=(0,o.useState)(!1),c=h()(u,2),l=c[0],d=c[1],m=(0,o.useState)(!1),g=h()(m,2),v=g[0],R=g[1],j=((0,z.u)((function(e){return e.currentOrg})),(0,w.Z)((function(e){return{roleResult:e.roleResult,setRoleResult:e.setRoleResult,insertRole:e.insertRole,upgradeRole:e.upgradeRole,currentRole:e.currentRole,removeRole:e.removeRole,setCurrentRole:e.setCurrentRole}}))),Z=j.roleResult,b=j.setRoleResult,F=j.insertRole,A=j.upgradeRole,E=j.removeRole,P=j.currentRole,N=j.setCurrentRole,B=function(){var e=p()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading("正在获取角色列表..."),n={pageNumber:0,pageSize:100,level:C.Hxq},e.next=4,(0,M.AM)(n);case 4:t=e.sent,console.log("queryRolesBySuper response ",t),200===t.code?(y.yw.destroy(),b(t)):(y.yw.destroy(),y.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){B()}),[]);var H=function(){var n=p()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("createRole",t),y.yw.loading(e.formatMessage({id:"creating"})),n.next=4,(0,M.fA)(t);case 4:r=n.sent,console.log("createRole:",r),200===r.code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),F(r.data),d(!1)):(y.yw.destroy(),y.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),K=function(){var n=p()(f()().mark((function n(t){var r,s,o;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s={uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,authorityUids:(null==t||null===(r=t.authorities)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]},y.yw.loading(e.formatMessage({id:"updating"})),n.next=4,(0,M.ul)(s);case 4:o=n.sent,console.log("updateRole:",s,o),200===o.code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),A(o.data),d(!1)):(y.yw.destroy(),y.yw.error(o.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Q=function(){var n=p()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteRole",t),y.yw.loading(e.formatMessage({id:"deleting"})),n.next=4,(0,M.Rd)(t);case 4:r=n.sent,console.log("updateRole:",r),200===r.code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),E(r.data.uid),d(!1)):(y.yw.destroy(),y.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(O.Z,{gap:"small",wrap:"wrap",children:[(0,S.jsx)(T.ZP,{type:"primary",size:"small",icon:(0,S.jsx)(G.Z,{}),onClick:function(){console.log("new role"),R(!1),d(!0)},children:e.formatMessage({id:"create",defaultMessage:"Create"})}),(0,S.jsx)(T.ZP,{size:"small",onClick:function(){console.log("edit role"),R(!0),d(!0)},disabled:""===(null==P?void 0:P.uid),children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,S.jsx)(T.ZP,{onClick:function(){return function(n){s.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(D.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){Q(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(P)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==P?void 0:P.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,S.jsx)(U.Z,{dataSource:Z.data.content,renderItem:function(e,t){return(0,S.jsx)(U.Z.Item,{style:P.uid===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){N(e)},children:(0,S.jsx)(U.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,S.jsx)(S.Fragment,{children:a(e.name)})})},e.uid)}}),(0,S.jsx)(L,{open:l,isEdit:v,role:P,onCancel:function(){d(!1)},onSubmit:function(e){v?K(e):H(e)}}),i]})},V=s.Z.Sider,W=s.Z.Content,_=function(){var e=(0,r.Z)().leftSiderStyle;return(0,S.jsxs)(s.Z,{children:[(0,S.jsx)(V,{style:e,children:(0,S.jsx)(Q,{})}),(0,S.jsx)(s.Z,{children:(0,S.jsx)(W,{children:(0,S.jsx)(P,{})})})]})}}}]);