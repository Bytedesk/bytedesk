"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3340],{34075:function(e,t,n){n.r(t),n.d(t,{default:function(){return de}});var r=n(96865),a=n(75574),o=n(73193),s=n.n(o),l=n(84176),i=n.n(l),u=n(90819),d=n.n(u),c=n(89933),p=n.n(c),f=n(45332),g=n.n(f),m=n(86803),y=n(90069),h=n(30921);function x(e){return v.apply(this,arguments)}function v(){return(v=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/query/org",{method:"GET",params:s()(s()({},t),{},{client:y.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/create",{method:"POST",data:s()(s()({},t),{},{client:y.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/update",{method:"POST",data:s()(s()({},t),{},{client:y.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return T.apply(this,arguments)}function T(){return(T=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/keyword/delete",{method:"POST",data:s()(s()({},t),{},{client:y.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=n(40612),S=n(31816),Z=n(50648),U=n(47719),A=n(52590),P=n(19513),D=n(61355),F=n(75365),q=n(44194),E=n(90838),I=n(6397),_=n(44521),N=n(60051),R=n(99811),Y=n(84881),L=n(4499),O=n(48708),K=n(73442),V=n(3849),Q=n(44867),z=n(28977),B=n.n(z),H=n(51990),G=n(65461),J=n(31549),W=function(e){var t=e.isEdit,n=e.keyword,r=e.open,a=e.onClose,o=e.onSubmit,l=R.A.useForm(),i=g()(l,1)[0],u=(0,q.useState)(""),d=g()(u,2),c=d[0],p=d[1],f=(0,C.u)((function(e){return e.currentOrg})),h=(0,I.j)((function(e){return e.currentKbase})),x=(0,E.v)((function(e){return e.categorySelectOptions})),v=(0,q.useState)(),w=g()(v,2),b=w[0],k=w[1],j=(0,q.useState)(y.PYi),M=g()(j,2),T=M[0],S=M[1],Z=(0,q.useState)(".png,.jpg,.jpeg"),U=g()(Z,2),A=U[0],P=U[1],D=(0,q.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==h?void 0:h.uid)||"",client:y.bVn}),z=g()(D,2),W=z[0];z[1];(0,q.useEffect)((function(){t?i.setFieldsValue({keyword:null==n?void 0:n.keywordList,reply:null==n?void 0:n.replyList,matchType:null==n?void 0:n.matchType,contentType:null==n?void 0:n.contentType,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==h?void 0:h.uid,enabled:null==n?void 0:n.enabled}):i.resetFields()}),[r]);var $={name:"file",accept:A,action:(0,_.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(y.LA8)},data:W,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=B()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;W.file=e,W.file_name=t,W.file_type=e.type,W.kb_type=y.YjS,W.category_uid=b||"",W.kb_uid=null==h?void 0:h.uid,console.log("beforeUpload",W)},onChange:function(e){if("uploading"===e.file.status&&m.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;i.setFieldValue("reply",t),m.yw.destroy(),m.yw.success("".concat(e.file.name," 上传成功"))}else m.yw.destroy(),m.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&m.yw.error("".concat(e.file.name," 上传失败"))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(K.Z,{title:t?"修改":"新建",width:650,onClose:a,open:r,extra:(0,J.jsxs)(V.Z,{children:[(0,J.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,J.jsx)(F.ZP,{onClick:function(){console.log("handleSubmit"),i.validateFields().then((function(e){console.log(e),o(s()(s()(s()({},n),e),{},{keywordList:[e.keyword],replyList:[c],kbUid:null==h?void 0:h.uid,orgUid:null==f?void 0:f.uid}))})).catch((function(e){console.log("Form errors:",e),m.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,J.jsxs)(R.A,{form:i,submitter:{render:function(){return null}},children:[(0,J.jsx)(Y.Z,{label:"匹配类型",name:"matchType",rules:[{required:!0,message:"请选择匹配类型"}],options:[{label:"模糊匹配",value:y.lEl},{label:"精确匹配",value:y.TAc,disabled:!0},{label:"正则匹配",value:y.c7i,disabled:!0},{label:"向量匹配",value:y.sOn,disabled:!0},{label:"搜索引擎匹配",value:y.NDq,disabled:!0}],fieldProps:{allowClear:!0,placeholder:"请选择匹配类型"}}),(0,J.jsx)(Y.Z,{label:"内容分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:x,tooltip:"请先：创建分类",fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),k(e)}}}),(0,J.jsx)(Y.Z,{label:"类型",name:"contentType",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:y.PYi},{label:"图片",value:y.Qm},{label:"视频",value:y.tVi},{label:"音频",value:y.Yu1},{label:"文件",value:y.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),S(e),e===y.Qm?P(".png,.jpg,.jpeg,.gif,.bmp"):e===y.tVi?P(".mp4,.avi,.mov,.wmv"):e===y.Yu1?P(".mp3,.wav,.flac"):e===y.Qn&&P(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,J.jsx)(L.Z,{label:"关键词",name:"keyword",tooltip:"多个关键词使用 '|' 分割",placeholder:"请输入关键词，多个关键词使用 '|' 分割",rules:[{required:!0,message:"请输入关键词，多个关键词使用 '|' 分割 "}]}),(0,J.jsx)(R.A.Item,{name:"reply",label:"回复",rules:[{required:!0,message:"请输入回复"}],children:(0,J.jsx)(H.Z,{placeholder:"reply content..",value:c,toolbarKeys:(0,G.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){p(e)}})}),(0,J.jsx)(O.Z,{label:"启用",name:"enabled",fieldProps:{defaultValue:!0}}),T!=y.PYi&&(0,J.jsxs)(Q.Z,s()(s()({},$),{},{children:[(0,J.jsx)("p",{className:"ant-upload-drag-icon",children:(0,J.jsx)(N.Z,{})}),(0,J.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽上传文件"})]}))]})})})},$=n(66408),X=n(20035),ee=n(76750),te=n(42540),ne=n(23864),re=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,ne.Z)().isDarkMode,o=(0,ee.Z)().translateString,s=(0,q.useRef)(),l=(0,I.j)((function(e){return e.currentKbase}));(0,q.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.clearMessage()}),[l]);var i=function(){var e=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleChatKeyword");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=p()(d()().mark((function e(t){var n,r,a,o,s,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleChatStream"),n=t[t.length-1],e.next=4,fetch("http://127.0.0.1:1001/visitor/api/v1/ai/ollama/chat/stream",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({query:null==n?void 0:n.content,kbUid:null==l?void 0:l.uid,stream:!0})});case 4:if((r=e.sent).ok&&r.body){e.next=7;break}throw new Error("HTTP error! status: ".concat(r.status));case 7:return a=r.body.getReader(),o=new TextDecoder("utf-8"),s=new TextEncoder,i=new ReadableStream({start:function(e){return p()(d()().mark((function t(){var n;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=function(){a.read().then((function(t){var r=t.done,a=t.value;if(r)e.close();else{var l=o.decode(a,{stream:!0}).replaceAll("data:","").replaceAll("\n","");e.enqueue(s.encode(l)),n()}})).catch((function(t){console.error("读取流中的数据时发生错误",t),e.error(t)}))})();case 2:case"end":return t.stop()}}),t)})))()}}),e.abrupt("return",new Response(i));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,J.jsx)("div",{children:(0,J.jsx)(K.Z,{title:o(null==l?void 0:l.name),onClose:function(){r&&r()},open:n,styles:{body:{padding:0}},children:(0,J.jsx)(X.f6,{appearance:a?"dark":"light",theme:{algorithm:a?te.Z.darkAlgorithm:te.Z.defaultAlgorithm},children:(0,J.jsx)($.j,{chatRef:s,helloMessage:"请输入你想问的问题",request:function(){var e=p()(d()().mark((function e(n){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("messages:",n),!(n.length>0)){e.next=8;break}if(t!==y.QPQ){e.next=6;break}return e.abrupt("return",u(n));case 6:if(t!==y.jNC){e.next=8;break}return e.abrupt("return",i(n));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})})})},ae=n(27650),oe=["current"],se=function(){var e=(0,h.useIntl)(),t=(0,q.useRef)(),n=(0,q.useState)(!0),r=g()(n,2),a=r[0],o=r[1],l=(0,q.useState)(),u=g()(l,2),c=u[0],f=u[1],v=(0,q.useState)(!1),b=g()(v,2),j=b[0],T=b[1],N=(0,C.u)((function(e){return e.currentOrg})),R=(0,I.j)((function(e){return e.currentKbase})),Y=(0,E.v)((function(e){return e.currentCategory})),L=(0,q.useState)(!1),O=g()(L,2),K=O[0],V=O[1],Q=(0,q.useState)(!1),z=g()(Q,2),B=z[0],H=z[1],G=function(){var n=p()(d()().mark((function n(r){var a;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,M(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),m.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):m.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),$=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,J.jsx)(h.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),dataIndex:"keywordList",copyable:!0},{title:(0,J.jsx)(h.FormattedMessage,{id:"reply",defaultMessage:"Reply"}),dataIndex:"replyList",copyable:!0},{title:(0,J.jsx)(h.FormattedMessage,{id:"matchType",defaultMessage:"MatchType"}),dataIndex:"matchType",width:80,render:function(t,n){return e.formatMessage({id:null==n?void 0:n.matchType,defaultMessage:null==n?void 0:n.matchType})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"contentType",hideInSearch:!0,width:50,render:function(t,n){return(0,J.jsx)(J.Fragment,{children:e.formatMessage({id:null==n?void 0:n.contentType,defaultMessage:null==n?void 0:n.contentType})})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",width:80,render:function(t,n){return(0,J.jsx)(J.Fragment,{children:null!=n&&n.enabled?e.formatMessage({id:"yes",defaultMessage:"Yes"}):e.formatMessage({id:"no",defaultMessage:"No"})})}},{title:(0,J.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,render:function(t,n,r,a){return[(0,J.jsx)("a",{onClick:function(){ee(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,J.jsx)(D.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.keywordList,"】？"),onConfirm:function(){return G(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,J.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}],X=function(){f(void 0),o(!1),T(!0)},ee=function(e){f(e),o(!0),T(!0)},te=function(){var n=p()(d()().mark((function n(r){var o,s;return d()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("handleSubmitDrawer",r),a?m.yw.loading(e.formatMessage({id:"updating"})):m.yw.loading(e.formatMessage({id:"creating"})),!a){n.next=8;break}return n.next=5,k(r);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,w(r);case 10:n.t0=n.sent;case 11:o=n.t0,console.log("createKeyword response:",r,o),200===o.code?(m.yw.destroy(),m.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),T(!1),null===(s=t.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(o.message));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ne=function(){var e=p()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=p()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=localStorage.getItem(y.LA8),window.open((0,_.kG)()+"/api/v1/keyword/export?categoryUid="+(null==Y?void 0:Y.uid)+"&kbUid="+(null==R?void 0:R.uid)+"&orgUid="+(null==N?void 0:N.uid)+"&pageNumber=0&pageSize=20&accessToken="+t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,q.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[R,Y]);var le=(0,q.useMemo)((function(){return(null==R?void 0:R.type)!==y.jNC||""===(null==R?void 0:R.uid)}),[R]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(P.Z,{columns:$,actionRef:t,cardBordered:!0,request:function(){var t=p()(d()().mark((function t(n,r,a){var o,l,u;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),m.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.current,o=i()(n,oe),l=s()({pageNumber:n.current-1,categoryUid:"all"===Y.uid?"":Y.uid,kbUid:null==R?void 0:R.uid,orgUid:null==N?void 0:N.uid},o),t.next=6,x(l);case 6:return u=t.sent,console.log("getAllKeywords response:",l,u),m.yw.destroy(),200===u.code||m.yw.error(u.message),t.abrupt("return",{data:u.data.content,success:!0,total:u.data.totalElements});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"menu.knowledge.keyword",defaultMessage:"KEYWORD"}),toolBarRender:function(){return[(0,J.jsx)(F.ZP,{icon:(0,J.jsx)(S.Z,{}),type:"primary",onClick:X,disabled:le,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,J.jsx)(F.ZP,{icon:(0,J.jsx)(Z.Z,{}),type:"primary",onClick:ne,disabled:le,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"import"),(0,J.jsx)(F.ZP,{icon:(0,J.jsx)(U.Z,{}),type:"primary",onClick:se,disabled:le,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"export"),(0,J.jsx)(F.ZP,{icon:(0,J.jsx)(A.Z,{}),type:"link",onClick:function(){window.open("https://www.weiyuai.cn/download/excel/kbase_keyword.xlsx")},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]}}),j&&(0,J.jsx)(W,{isEdit:a,open:j,keyword:c,onClose:function(){return T(!1)},onSubmit:te}),B&&(0,J.jsx)(ae.Z,{type:y.jNC,acceptType:".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",isModalOpen:B,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),H(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),H(!1),null==t||t.current.reload()}}),K&&(0,J.jsx)(re,{type:y.jNC,open:K,onClose:function(){return V(!1)}})]})},le=n(8377),ie=a.Z.Sider,ue=a.Z.Content,de=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,J.jsx)("div",{children:(0,J.jsxs)(a.Z,{children:[(0,J.jsx)(ie,{style:t,children:(0,J.jsx)(le.Z,{type:y.jNC})}),(0,J.jsx)(a.Z,{children:(0,J.jsx)(ue,{style:n,children:(0,J.jsx)(se,{})})})]})})}}}]);