"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1742],{51042:function(K,T,r){var w=r(1413),C=r(67294),v=r(42110),y=r(89099),o=function(b,F){return C.createElement(y.Z,(0,w.Z)((0,w.Z)({},b),{},{ref:F,icon:v.Z}))},O=C.forwardRef(o);T.Z=O},77154:function(K,T,r){var w=r(39825);function C(){var v=(0,w.Z)(),y=v.isDarkMode,o={borderRight:y?"1px solid #333":"1px solid #ccc",background:y?"#141414":"#eee",width:260},O={background:y?"#141414":"#fff"},h={borderLeft:y?"1px solid #333":"1px solid #ccc",background:y?"#141414":"#eee"},b={minHeight:120};return{leftSiderStyle:o,headerStyle:O,rightSiderStyle:h,contentStyle:b}}T.Z=C},14886:function(K,T,r){r.r(T),r.d(T,{default:function(){return Ae}});var w=r(77154),C=r(21612),v=r(67294),y=r(15009),o=r.n(y),O=r(99289),h=r.n(O),b=r(5574),F=r.n(b),D=r(80049),ce=r(97857),j=r.n(ce),re=r(85615),P=r(86745);function de(t){return V.apply(this,arguments)}function V(){return V=h()(o()().mark(function t(u){return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/v1/course/query/org",{method:"GET",params:j()(j()({},u),{},{client:re.bV})}));case 1:case"end":return e.stop()}},t)})),V.apply(this,arguments)}function fe(t){return z.apply(this,arguments)}function z(){return z=h()(o()().mark(function t(u){return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/v1/course/query/user",{method:"GET",params:j()(j()({},u),{},{client:re.bV})}));case 1:case"end":return e.stop()}},t)})),z.apply(this,arguments)}function pe(t){return N.apply(this,arguments)}function N(){return N=h()(o()().mark(function t(u){return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/v1/course/create",{method:"POST",data:j()(j()({},u),{},{client:"web"})}));case 1:case"end":return e.stop()}},t)})),N.apply(this,arguments)}function ve(t){return k.apply(this,arguments)}function k(){return k=h()(o()().mark(function t(u){return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/v1/course/update",{method:"POST",data:j()(j()({},u),{},{client:"web"})}));case 1:case"end":return e.stop()}},t)})),k.apply(this,arguments)}function Ve(t){return J.apply(this,arguments)}function J(){return J=_asyncToGenerator(_regeneratorRuntime().mark(function t(u){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/v1/course/delete",{method:"POST",data:_objectSpread(_objectSpread({},u),{},{client:"web"})}));case 1:case"end":return e.stop()}},t)})),J.apply(this,arguments)}function ze(t){return H.apply(this,arguments)}function H(){return H=_asyncToGenerator(_regeneratorRuntime().mark(function t(u){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/v1/course/filter",{method:"GET",params:_objectSpread(_objectSpread({},u),{},{client:HTTP_CLIENT})}));case 1:case"end":return e.stop()}},t)})),H.apply(this,arguments)}var te=r(64529),Z=r(782),ne=r(71381),he=(0,te.Ue)()((0,Z.mW)((0,Z.tJ)((0,ne.n)(function(t,u){return{courseResult:{data:{content:[]}},insertCourseResult:function(e){t(function(g){var E=g.courseResult.data.content;E.unshift(e)})},updateCourseResult:function(e){t(function(g){var E=g.courseResult.data.content,A=E.findIndex(function(I){return I.uid===e.uid});A!==-1?E[A]=e:console.warn("Course with uid ".concat(e.uid," not found."))})},setCourseResult:function(e){t({courseResult:e})},deleteCourseCache:function(){return t({},!0)}}}),{name:"COURSE_STORE"}))),me=r(60247),ge=r(51042),Ce=r(66955),Q=r(14726),B=r(8232),ye=r(85265),Se=r(42075),ae=r(96365),Re=r(40782),Ee=r(83863),ue=(0,te.Ue)()((0,Z.mW)((0,Z.tJ)((0,ne.n)(function(t,u){return{categoryResult:{data:[]},categoryOptions:[],setCategoryResult:function(e){var g=be(e);t({categoryResult:e,categoryOptions:g})},deleteCategoryCache:function(){return t({},!0)}}}),{name:"CATEGORY_STORE"})));function be(t){var u=[];return t.data.forEach(function(a){var e={value:a.uid,label:a.name};a.children&&Array.isArray(a.children)&&(e.children=a.children.map(function(g){return{value:g.uid,label:g.name}})),u.push(e)}),u}var s=r(85893),Te=function(u){var a=u.isEdit,e=u.course,g=u.open,E=u.onClose,A=u.onSubmit,I=B.Z.useForm(),U=F()(I,1),S=U[0],q=ue(function(R){return R.categoryOptions});(0,v.useEffect)(function(){if(e&&S){var R,i;S.setFieldsValue({name:e==null?void 0:e.name,description:e==null?void 0:e.description}),S.setFieldsValue({categories:[e==null||(R=e.mainCategory)===null||R===void 0?void 0:R.uid,e==null||(i=e.subCategory)===null||i===void 0?void 0:i.uid]})}else S!=null&&!a&&(console.log("form resetFields"),S.resetFields())},[e]);var se=function(i){console.log("handleNameChange:",i)},M=function(i,x){console.log("Cascader value:",i),console.log("Cascader selectedData:",x)},L=function(i){console.log("selected ".concat(i))},G=function(){console.log("handleSubmit"),S.validateFields().then(function(i){console.log("Form values:",i);var x={uid:e==null?void 0:e.uid,name:i.name,cover:e.cover,description:i.description,detail:e.detail,price:e.price,mainCategory:{uid:i.categories[0]},subCategory:{uid:i.categories[1]},published:i.published==="true"};A(x)}).catch(function(i){console.log("Form errors:",i)})};return(0,s.jsx)("div",{children:(0,s.jsx)(ye.Z,{title:a?"\u7F16\u8F91\u8BFE\u7A0B":"\u65B0\u5EFA\u8BFE\u7A0B",onClose:E,open:g,extra:(0,s.jsxs)(Se.Z,{children:[(0,s.jsx)(Q.ZP,{onClick:E,children:"\u53D6\u6D88"}),(0,s.jsx)(Q.ZP,{onClick:G,type:"primary",children:"\u4FDD\u5B58"})]}),children:(0,s.jsxs)(B.Z,{form:S,children:[(0,s.jsx)(B.Z.Item,{name:"name",label:"\u8BFE\u7A0B\u540D\u79F0",initialValue:e==null?void 0:e.name,children:(0,s.jsx)(ae.Z,{placeholder:"\u8BF7\u8F93\u5165\u8BFE\u7A0B\u540D\u79F0"})}),(0,s.jsx)(B.Z.Item,{name:"categories",label:"\u8BFE\u7A0B\u5206\u7C7B",children:(0,s.jsx)(Re.Z,{options:q,onChange:M,placeholder:"\u9009\u62E9\u5206\u7C7B"})}),(0,s.jsx)(B.Z.Item,{name:"description",label:"\u8BFE\u7A0B\u63CF\u8FF0",initialValue:e==null?void 0:e.description,children:(0,s.jsx)(ae.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u8BFE\u7A0B\u63CF\u8FF0"})}),(0,s.jsx)(B.Z.Item,{name:"published",label:"\u8BFE\u7A0B\u72B6\u6001",initialValue:e!=null&&e.published?"true":"false",children:(0,s.jsx)(Ee.Z,{style:{width:120},onChange:L,options:[{value:"true",label:"\u5DF2\u53D1\u5E03"},{value:"false",label:"\u672A\u53D1\u5E03"}]})})]})})})},we=Te;function Ne(t){return Y.apply(this,arguments)}function Y(){return Y=_asyncToGenerator(_regeneratorRuntime().mark(function t(u){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/v1/category/all",{method:"GET",params:_objectSpread(_objectSpread({},u),{},{client:"web"})}));case 1:case"end":return e.stop()}},t)})),Y.apply(this,arguments)}function Fe(){return X.apply(this,arguments)}function X(){return X=h()(o()().mark(function t(){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,P.request)("/visitor/api/v1/category/query",{method:"GET",params:{client:"web"}}));case 1:case"end":return a.stop()}},t)})),X.apply(this,arguments)}var je=function(){var u=(0,me.L)(function(l){return l.userInfo}),a=(0,v.useRef)(),e=(0,v.useState)(1),g=F()(e,2),E=g[0],A=g[1],I=(0,v.useState)(10),U=F()(I,2),S=U[0],q=U[1],se=(0,v.useState)(!0),M=F()(se,2),L=M[0],G=M[1],R=(0,v.useState)(),i=F()(R,2),x=i[0],oe=i[1],W=he(function(l){return{courseResult:l.courseResult,insertCourseResult:l.insertCourseResult,updateCourseResult:l.updateCourseResult,setCourseResult:l.setCourseResult}}),$=W.courseResult,Pe=W.insertCourseResult,Ie=W.updateCourseResult,xe=W.setCourseResult,Ze=ue(function(l){return l.setCategoryResult}),Ue=(0,v.useState)(!1),le=F()(Ue,2),Me=le[0],_=le[1],Le=function(){oe(void 0),G(!1),_(!0)},Ge=function(c){oe(c),G(!0),_(!0)},ee=function(){_(!1)},We=function(){var l=h()(o()().mark(function c(n){var d,p;return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(console.log("handleSubmitDrawer:",n),!L){m.next=9;break}return m.next=4,ve(n);case 4:d=m.sent,console.log("updateCourse:",d),d.code===200?(D.yw.success("\u66F4\u65B0\u6210\u529F"),Ie(d.data),ee()):D.yw.error(d.message),m.next=14;break;case 9:return m.next=11,pe(n);case 11:p=m.sent,console.log("createCourse:",p),p.code===200?(D.yw.success("\u521B\u5EFA\u6210\u529F"),Pe(p.data),ee()):D.yw.error(p.message);case 14:case"end":return m.stop()}},c)}));return function(n){return l.apply(this,arguments)}}(),$e=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u5C01\u9762",dataIndex:"cover",render:function(c,n){return(0,s.jsx)("a",{href:n.cover,target:"_blank",children:(0,s.jsx)("img",{src:n.cover,width:"40",height:"40"})})}},{title:"\u540D\u79F0",dataIndex:"name",copyable:!0},{title:"\u5206\u7C7B",key:"category",render:function(c,n){var d=n.mainCategory?n.mainCategory.name:"-",p=n.subCategory?n.subCategory.name:"-";return(0,s.jsxs)("span",{children:[d," / ",p]})}},{title:"\u53D1\u5E03\u4EBA",copyable:!0,editable:!1,renderText:function(c,n,d,p){var f;return(f=n.user)===null||f===void 0?void 0:f.nickname}},{title:"\u72B6\u6001",key:"published",render:function(c,n){return n.published?"\u5DF2\u53D1\u5E03":"\u672A\u53D1\u5E03"}},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt",dataIndex:"updatedAt",editable:!1,sorter:!0,hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",key:"option",render:function(c,n,d,p){return[(0,s.jsx)("a",{onClick:function(){console.log("edit record:",n),Ge(n)},children:"\u7F16\u8F91"},"editable")]}}],ie=function(){var l=h()(o()().mark(function c(){var n,d;return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n={pageNumber:E-1,pageSize:S},!u.superUser){f.next=7;break}return f.next=4,de(n);case 4:f.t0=f.sent,f.next=10;break;case 7:return f.next=9,fe(n);case 9:f.t0=f.sent;case 10:d=f.t0,console.log("getAllCourses response:",n,d),d.code===200?xe(d):D.yw.error(d.message);case 13:case"end":return f.stop()}},c)}));return function(){return l.apply(this,arguments)}}(),Ke=function(){var l=h()(o()().mark(function c(){var n;return o()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Fe();case 2:n=p.sent,console.log("getAllCategories response:",n),n.code===200?Ze(n):D.yw.error(n.message);case 5:case"end":return p.stop()}},c)}));return function(){return l.apply(this,arguments)}}();return(0,v.useEffect)(function(){ie(),Ke()},[]),(0,v.useEffect)(function(){ie()},[E,S]),(0,v.useEffect)(function(){console.log("courseResult:",$),a.current.reload()},[$]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Ce.Z,{columns:$e,actionRef:a,cardBordered:!0,request:function(){var l=h()(o()().mark(function c(n,d,p){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("request:",n,d,p),A(n.current),q(n.pageSize),m.abrupt("return",Promise.resolve({data:$.data.content,success:!0,total:$.data.totalElements}));case 4:case"end":return m.stop()}},c)}));return function(c,n,d){return l.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:S,showQuickJumper:!0,onChange:function(c){console.log("page:",c)}},dateFormatter:"string",headerTitle:"\u8BFE\u7A0B",toolBarRender:function(){return[(0,s.jsxs)(Q.ZP,{type:"primary",onClick:Le,children:[(0,s.jsx)(ge.Z,{}),"\u65B0\u5EFA"]})]}}),(0,s.jsx)(we,{isEdit:L,course:x,open:Me,onClose:ee,onSubmit:We})]})},Oe=je,ke=C.Z.Sider,De=C.Z.Content,Be=function(){var u=(0,w.Z)(),a=u.contentStyle;return(0,s.jsx)(C.Z,{children:(0,s.jsx)(C.Z,{children:(0,s.jsx)(De,{style:a,children:(0,s.jsx)(Oe,{})})})})},Ae=Be},60247:function(K,T,r){r.d(T,{L:function(){return y}});var w=r(64529),C=r(782),v=r(71381),y=(0,w.Ue)()((0,C.mW)((0,C.tJ)((0,v.n)(function(o,O){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(b){o({userInfo:b})},setDeviceUid:function(b){o({deviceUid:b})},deleteUserInfo:function(){return o({},!0)}}}),{name:"USER_STORE"})))}}]);
