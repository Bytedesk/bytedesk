"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6693],{10411:function(Se,ie,n){n.d(ie,{AP:function(){return z},_J:function(){return ve},t5:function(){return ae},v_:function(){return ce}});var Y=n(15009),U=n.n(Y),ue=n(97857),C=n.n(ue),de=n(99289),B=n.n(de),J=n(85615),L=n(86745);function z(F){return ee.apply(this,arguments)}function ee(){return ee=B()(U()().mark(function F(H){return U()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,L.request)("/api/v1/kbase/query/org",{method:"GET",params:C()(C()({},H),{},{client:J.bVn})}));case 1:case"end":return g.stop()}},F)})),ee.apply(this,arguments)}function ce(F){return K.apply(this,arguments)}function K(){return K=B()(U()().mark(function F(H){return U()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,L.request)("/api/v1/kbase/create",{method:"POST",data:C()(C()({},H),{},{client:J.bVn})}));case 1:case"end":return g.stop()}},F)})),K.apply(this,arguments)}function ae(F){return te.apply(this,arguments)}function te(){return te=B()(U()().mark(function F(H){return U()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,L.request)("/api/v1/kbase/update",{method:"POST",data:C()(C()({},H),{},{client:J.bVn})}));case 1:case"end":return g.stop()}},F)})),te.apply(this,arguments)}function ve(F){return re.apply(this,arguments)}function re(){return re=B()(U()().mark(function F(H){return U()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,L.request)("/api/v1/kbase/delete",{method:"POST",data:C()(C()({},H),{},{client:J.bVn})}));case 1:case"end":return g.stop()}},F)})),re.apply(this,arguments)}},55595:function(Se,ie,n){n.r(ie),n.d(ie,{default:function(){return Ft}});var Y=n(21612),U=n(67294),ue=n(15009),C=n.n(ue),de=n(99289),B=n.n(de),J=n(5574),L=n.n(J),z=n(37326),ee=n(85576),ce=n(86250),K=n(14726),ae=n(2487),te=n(7134),ve=n(11475),re=n(64789),F=n(86745),H=n(39825),Q=n(87676),g=n(85615),G=n(34994),fe=n(5966),ge=n(64317),t=n(85893),Re=function(d){var v=d.open,l=d.onClose,o=d.onSubmit,S=(0,F.useIntl)(),O=G.A.useForm(),Z=L()(O,1),e=Z[0],a=(0,Q.u)(function(D){return D.currentOrg}),E=function(){console.log("handleSaveRobot"),e.validateFields().then(function(i){console.log("handleSaveRobot values:",i);var R={nickname:i.nickname,type:i.type,orgUid:a.uid};console.log("robotObject:",R),o(R)}).catch(function(i){console.log("Form errors:",i)})},A=function(){l()},q=function(i){console.log("onTreeSelectChange:",i)};return(0,t.jsx)("div",{children:(0,t.jsx)(ee.Z,{title:S.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:v,forceRender:!0,okText:S.formatMessage({id:"save",defaultMessage:"Save"}),onOk:E,onCancel:A,children:(0,t.jsxs)(G.A,{form:e,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,t.jsx)(fe.Z,{label:S.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:S.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,t.jsx)(ge.Z,{label:S.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:S.formatMessage({id:g.f4h,defaultMessage:"Service"}),value:g.f4h},{label:S.formatMessage({id:g.wG_,defaultMessage:"Marketing"}),value:g.wG_,disabled:!0},{label:S.formatMessage({id:g.MLd,defaultMessage:"Knowledgebase"}),value:g.MLd},{label:S.formatMessage({id:g.iu4,defaultMessage:"Qa"}),value:g.iu4}],rules:[{required:!0,message:S.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:S.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:q,allowClear:!0}})]})})})},je=Re,X=n(76545),f=n(80049),oe=n(73803),xe=function(){var d=(0,H.Z)(),v=d.isDarkMode,l=(0,F.useIntl)(),o=(0,U.useRef)(!1),S=(0,oe.Z)(),O=S.translateString,Z=S.translateStringTranct,e=(0,z.V)(function(N){return{robotResult:N.robotResult,currentRobot:N.currentRobot,insertRobot:N.insertRobot,deleteCurrentRobot:N.deleteCurrentRobot,setRobotResult:N.setRobotResult,setCurrentRobot:N.setCurrentRobot}}),a=e.robotResult,E=e.currentRobot,A=e.insertRobot,q=e.deleteCurrentRobot,D=e.setRobotResult,i=e.setCurrentRobot,R=(0,Q.u)(function(N){return N.currentOrg}),j=ee.Z.useModal(),y=L()(j,2),r=y[0],u=y[1],m=function(P){r.confirm({title:l.formatMessage({id:"deleteTip"}),icon:(0,t.jsx)(ve.Z,{}),content:"".concat(l.formatMessage({id:"deleteAfirm",defaultMessage:"Delete"}),"\u3010").concat(O(P.nickname),"\u3011\uFF1F"),onOk:function(){c(P)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})})},c=function(){var N=B()(C()().mark(function P(V){var I;return C()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return console.log("delete robot",V),f.yw.loading(l.formatMessage({id:"deleting",defaultMessage:"Deleting"})),$.next=4,(0,X.gf)(V);case 4:I=$.sent,console.log("delete robot response",I),I.code===200?(f.yw.destroy(),f.yw.success(l.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),q(V.uid)):(f.yw.destroy(),f.yw.error(I.message));case 7:case"end":return $.stop()}},P)}));return function(V){return N.apply(this,arguments)}}(),h=function(){var N=B()(C()().mark(function P(){var V,I;return C()().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!o.current){$.next=3;break}return console.log("isLoading: 1",o.current),$.abrupt("return");case 3:return o.current=!0,f.yw.loading("loading"),V={pageNumber:0,pageSize:50,orgUid:R.uid},$.next=8,(0,X.p0)(V);case 8:I=$.sent,console.log("queryRobotsByOrg: ",I),I.code===200?(f.yw.destroy(),D(I)):(f.yw.destroy(),f.yw.error(I.message)),o.current=!1;case 12:case"end":return $.stop()}},P)}));return function(){return N.apply(this,arguments)}}();(0,U.useEffect)(function(){h()},[]);var b=(0,U.useState)(!1),x=L()(b,2),p=x[0],s=x[1],_=function(){s(!0)},W=function(){var N=B()(C()().mark(function P(V){var I;return C()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return f.yw.loading(l.formatMessage({id:"creating",defaultMessage:"Creating"})),$.next=3,(0,X.lg)(V);case 3:I=$.sent,console.log("handleSaveRobot response:",I),I.code===200?(f.yw.destroy(),f.yw.success(l.formatMessage({id:"create.success"})),A(I.data),s(!1)):(f.yw.destroy(),s(!1),f.yw.error(I.message));case 6:case"end":return $.stop()}},P)}));return function(V){return N.apply(this,arguments)}}(),k=function(){s(!1)},M=function(){_()},ne=function(P,V){i(P)},se=function(P){return l.formatMessage({id:P==null?void 0:P.type,defaultMessage:P==null?void 0:P.type})};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{margin:10},children:(0,t.jsxs)(ce.Z,{gap:"small",align:"flex-start",children:[(0,t.jsx)(K.ZP,{size:"small",type:"primary",icon:(0,t.jsx)(re.Z,{}),onClick:M,children:l.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,t.jsx)(K.ZP,{size:"small",onClick:h,children:l.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,t.jsx)(K.ZP,{onClick:function(){return m(E)},size:"small",style:{float:"right"},danger:!0,disabled:(E==null?void 0:E.uid)==="",children:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,t.jsx)(ae.Z,{itemLayout:"horizontal",dataSource:a.data.content,renderItem:function(P,V){return(0,t.jsx)(ae.Z.Item,{style:(E==null?void 0:E.uid)===P.uid?{backgroundColor:v?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return ne(P,V)},children:(0,t.jsx)(ae.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,t.jsx)(te.C,{src:P.avatar}),title:(0,t.jsx)(t.Fragment,{children:Z(P==null?void 0:P.nickname)}),description:se(P)})})}}),(0,t.jsx)(je,{open:p,onClose:k,onSubmit:W}),u]})},Ce=xe,me=n(11941),St=function(){var d=function(l,o){l.dataTransfer.setData("application/reactflow",o),l.dataTransfer.effectAllowed="move",console.log("onDragStart:",l,o)};return _jsxs("aside",{children:[_jsx("div",{className:"dndnode",onDragStart:function(l){return d(l,"nodeText")},draggable:!0,children:"Text"}),_jsx("div",{className:"dndnode",onDragStart:function(l){return d(l,"nodeImage")},draggable:!0,children:"Image"})]})},Rt=null,jt=n(23661),xt=n(66419);function Ct(w){var d=w.id,v=w.type,l=w.data,o=w.xPos,S=w.yPos,O=w.isConnectable,Z=useCallback(function(){var A=JSON.stringify({id:d,type:v,data:l});emitter.emit(EVENT_BUS_FLOW_NODE_RUN,A)},[]),e=useCallback(function(){var A=JSON.stringify({id:getUUid(),type:v,data:l,position:{x:o+10,y:S+10}});emitter.emit(EVENT_BUS_FLOW_NODE_COPY,A)},[]),a=useCallback(function(){emitter.emit(EVENT_BUS_FLOW_NODE_DELETE,d)},[]),E=useCallback(function(A){console.log(A.target.value)},[]);return _jsxs("div",{className:"node-text",children:[_jsxs(NodeToolbar,{isVisible:l.toolbarVisible,position:l.toolbarPosition,children:[_jsx("button",{onClick:Z,children:"run"}),_jsx("button",{onClick:e,children:"copy"}),_jsx("button",{onClick:a,children:"delete"})]}),_jsx(Handle,{type:"target",position:Position.Top,isConnectable:O}),_jsxs("div",{children:[_jsx("label",{htmlFor:"text",children:"Text:"}),_jsx("input",{id:"text",name:"text",onChange:E,className:"nodrag"})]}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:O})]})}var Mt=null;function Tt(w){var d=w.data,v=w.isConnectable,l=useCallback(function(o){console.log(o.target.value)},[]);return _jsxs("div",{className:"node-image",children:[_jsx(Handle,{type:"target",position:Position.Top,isConnectable:v}),_jsx("div",{children:_jsx("label",{htmlFor:"text",children:"Image"})}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:v})]})}var wt=null;function Et(w){var d=w.id,v=w.type,l=w.data,o=w.isConnectable,S=useCallback(function(){var O=JSON.stringify({id:d,type:v,data:l});emitter.emit(EVENT_BUS_FLOW_NODE_RUN,O)},[]);return _jsxs("div",{className:"node-start",children:[_jsx(NodeToolbar,{isVisible:l.toolbarVisible,position:l.toolbarPosition,children:_jsx("button",{onClick:S,children:"run"})}),_jsx("div",{children:_jsx("label",{htmlFor:"text",children:"Start"})}),_jsx(Handle,{type:"source",position:Position.Bottom,id:"b",isConnectable:o})]})}var Dt=null,Ot=function(d){var v=d.open,l=d.onClose,o=useRobotStore(function(R){return R.currentRobot}),S=useState(""),O=_slicedToArray(S,2),Z=O[0],e=O[1],a=useState(!1),E=_slicedToArray(a,2),A=E[0],q=E[1],D=function(){q(!0),console.log("Iframe loaded successfully!")};useEffect(function(){var R="http://127.0.0.1:9003/chat?t="+THREAD_TYPE_ROBOT+"&sid="+(o==null?void 0:o.uid)+"&"+new Date().getTime();e(R)},[o]);var i=function(){console.log("restart");var j="http://127.0.0.1:9003/chat?t="+THREAD_TYPE_ROBOT+"&sid="+(o==null?void 0:o.uid)+"&"+new Date().getTime();e(j)};return _jsx(_Fragment,{children:_jsxs(Drawer,{title:"Preview",onClose:l,open:v,extra:_jsxs(Space,{children:[_jsx(Button,{onClick:l,children:"Cancel"}),_jsx(Button,{onClick:i,type:"primary",children:"Restart"})]}),children:[_jsx(Spin,{spinning:!A,size:"large"}),_jsx("iframe",{id:"chat-iframe",src:Z,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:D})]})})},kt=null,Me={},Te={animated:!0},we={hideAttribution:!0},Ee=0,De=function(){return"dndnode_".concat(Ee++)},Pt=function(){var d=useRef(null),v=[{id:"1",type:"nodeStart",data:{label:"start"},position:{x:250,y:5}}],l=useState(v),o=_slicedToArray(l,2),S=o[0],O=o[1],Z=useState([]),e=_slicedToArray(Z,2),a=e[0],E=e[1],A=useMemo(function(){return{nodeStart:NodeStart,nodeText:NodeText,nodeImage:NodeImage}},[]),q=useCallback(function(s){return O(function(_){return applyNodeChanges(s,_)})},[O]),D=useCallback(function(s){return E(function(_){return applyEdgeChanges(s,_)})},[E]),i=useCallback(function(s){E(function(_){return addEdge(s,_)})},[E]),R=useReactFlow(),j=R.screenToFlowPosition,y=useCallback(function(s){s.preventDefault(),s.dataTransfer.dropEffect="move"},[]),r=useCallback(function(s){s.preventDefault();var _=s.dataTransfer.getData("application/reactflow");if(!(typeof _=="undefined"||!_)){var W=j({x:s.clientX,y:s.clientY}),k={id:De(),type:_,data:{label:"nodeText"},position:W};O(function(M){return M.concat(k)})}},[j]),u=function(){};useEffect(function(){var s=setInterval(u,1e4);return function(){clearInterval(s)}},[S,a]);var m=useState(!1),c=_slicedToArray(m,2),h=c[0],b=c[1],x=function(){b(!0)},p=function(){b(!1)};return useEffect(function(){var s=function(M){console.log("handleRunEvent:",M),x()};emitter.on(EVENT_BUS_FLOW_NODE_RUN,s);var _=function(M){var ne=JSON.parse(M);console.log("handleCopyEvent:",M,ne),O(function(se){return se.concat(ne)})};emitter.on(EVENT_BUS_FLOW_NODE_COPY,_);var W=function(M){console.log("handleDeleteEvent:",M),O(function(ne){return ne.filter(function(se){return se.id!==M})})};return emitter.on(EVENT_BUS_FLOW_NODE_DELETE,W),function(){emitter.off(EVENT_BUS_FLOW_NODE_RUN,s),emitter.off(EVENT_BUS_FLOW_NODE_COPY,_),emitter.off(EVENT_BUS_FLOW_NODE_DELETE,W)}},[]),_jsxs("div",{className:"dndflow",children:[_jsx(Sidebar,{}),_jsx("div",{ref:d,style:{width:"75vw",height:"80vh"},children:_jsx(ReactFlow,{nodeTypes:A,nodes:S,edges:a,onNodesChange:q,onEdgesChange:D,onConnect:i,onDrop:r,onDragOver:y,fitView:!0,proOptions:we,nodesDraggable:!0,style:Me,defaultEdgeOptions:Te,children:_jsx(Controls,{})})}),_jsx(Preview,{open:h,onClose:p})]})},_t=null,Ut=function(){var d=useAccess();return _jsx(_Fragment,{children:_jsx(Access,{accessible:d.canDebug(),fallback:_jsx(_Fragment,{children:_jsx(FormattedMessage,{id:UNDER_DEVELOPMENT})}),children:_jsx(ReactFlowProvider,{children:_jsx(Flow,{})})})})},At=null,be=n(40056),Oe=n(79964),ke=n(64423),Pe=n(50748),_e=n(99072),Ue=n(97857),T=n.n(Ue),pe=n(52688),le=n(90672),he=n(31199),Ae=n(96074),Ne=function(){var d=(0,F.useIntl)(),v=G.A.useForm(),l=L()(v,1),o=l[0],S=(0,oe.Z)(),O=S.translateString,Z=(0,z.V)(function(i){return{currentRobot:i.currentRobot,setCurrentRobot:i.setCurrentRobot}}),e=Z.currentRobot,a=Z.setCurrentRobot;(0,U.useEffect)(function(){var i,R,j,y,r,u;o.setFieldValue("enabled",e==null||(i=e.llm)===null||i===void 0?void 0:i.enabled),o.setFieldValue("topK",e==null||(R=e.llm)===null||R===void 0?void 0:R.topK),o.setFieldValue("scoreThreshold",e==null||(j=e.llm)===null||j===void 0?void 0:j.scoreThreshold),o.setFieldValue("model",e==null||(y=e.llm)===null||y===void 0?void 0:y.model),o.setFieldValue("temperature",e==null||(r=e.llm)===null||r===void 0?void 0:r.temperature),o.setFieldValue("prompt",O(e==null||(u=e.llm)===null||u===void 0?void 0:u.prompt))},[e]);var E=function(){var i=B()(C()().mark(function R(j){var y,r,u,m,c,h,b;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("TabKeyword handleEnableChange",j),f.yw.loading(d.formatMessage({id:"updating"})),h=T()(T()({},e),{},{serviceSettings:T()(T()({},e==null?void 0:e.serviceSettings),{},{faqUids:e==null||(y=e.serviceSettings)===null||y===void 0||(y=y.faqs)===null||y===void 0?void 0:y.map(function(s){return s.uid}),quickFaqUids:e==null||(r=e.serviceSettings)===null||r===void 0||(r=r.quickFaqs)===null||r===void 0?void 0:r.map(function(s){return s.uid}),guessFaqUids:e==null||(u=e.serviceSettings)===null||u===void 0||(u=u.guessFaqs)===null||u===void 0?void 0:u.map(function(s){return s.uid}),hotFaqUids:e==null||(m=e.serviceSettings)===null||m===void 0||(m=m.hotFaqs)===null||m===void 0?void 0:m.map(function(s){return s.uid}),shortcutFaqUids:e==null||(c=e.serviceSettings)===null||c===void 0||(c=c.shortcutFaqs)===null||c===void 0?void 0:c.map(function(s){return s.uid})}),llm:T()(T()({},e==null?void 0:e.llm),{},{enabled:j})}),console.log("robotObject:",h),p.next=6,(0,X.$l)(h);case 6:b=p.sent,console.log("updateRobot response:",b),b.code===200?(f.yw.destroy(),f.yw.success(d.formatMessage({id:"update.success"})),a(b.data)):(f.yw.destroy(),f.yw.error(b.message));case 9:case"end":return p.stop()}},R)}));return function(j){return i.apply(this,arguments)}}(),A=function(){var i=B()(C()().mark(function R(j){var y,r,u,m,c,h,b;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("handleSubmit",j),f.yw.loading(d.formatMessage({id:"updating"})),h=T()(T()({},e),{},{serviceSettings:T()(T()({},e.serviceSettings),{},{faqUids:(y=e.serviceSettings)===null||y===void 0||(y=y.faqs)===null||y===void 0?void 0:y.map(function(s){return s.uid}),quickFaqUids:e==null||(r=e.serviceSettings)===null||r===void 0||(r=r.quickFaqs)===null||r===void 0?void 0:r.map(function(s){return s.uid}),guessFaqUids:e==null||(u=e.serviceSettings)===null||u===void 0||(u=u.guessFaqs)===null||u===void 0?void 0:u.map(function(s){return s.uid}),hotFaqUids:e==null||(m=e.serviceSettings)===null||m===void 0||(m=m.hotFaqs)===null||m===void 0?void 0:m.map(function(s){return s.uid}),shortcutFaqUids:e==null||(c=e.serviceSettings)===null||c===void 0||(c=c.shortcutFaqs)===null||c===void 0?void 0:c.map(function(s){return s.uid})}),llm:j}),console.log("robotObject:",h),p.next=6,(0,X.$l)(h);case 6:b=p.sent,console.log("updateRobot response:",b),b.code===200?(f.yw.destroy(),f.yw.success(d.formatMessage({id:"update.success"})),a(b.data)):(f.yw.destroy(),f.yw.error(b.message));case 9:case"end":return p.stop()}},R)}));return function(j){return i.apply(this,arguments)}}(),q=function(){},D=function(R,j){return[(0,t.jsx)(K.ZP,{type:"default",onClick:function(){var r;(r=R.form)===null||r===void 0||r.resetFields()},children:"\u91CD\u7F6E"},"reset"),(0,t.jsx)(K.ZP,{type:"primary",onClick:function(){var r;(r=R.form)===null||r===void 0||r.submit()},children:"\u4FDD\u5B58"},"submit")]};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(be.Z,{message:"\u5927\u6A21\u578B\u6682\u672A\u652F\u6301\u4E91\u670D\u52A1\uFF0C\u5982\u9700\u4F7F\u7528\uFF0C\u53EF\u79C1\u6709\u90E8\u7F72\uFF0C\u5E76\u914D\u7F6E\u81EA\u6709key\u4F7F\u7528",action:(0,t.jsx)(K.ZP,{type:"link",onClick:function(){window.open(g.rVq)},children:"docs"})}),(0,t.jsx)(Ae.Z,{}),(0,t.jsxs)(G.A,{form:o,size:"large",submitter:{render:D,submitButtonProps:{size:"large",htmlType:"button"}},onFinish:A,children:[(0,t.jsx)(pe.Z,{width:"lg",name:"enabled",label:"enabled",tooltip:"\u542F\u7528\u5927\u6A21\u578B\u540E\uFF0C\u5C06\u4F1A\u5173\u95ED\u5173\u952E\u8BCD\u3002\u7528\u6237\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u5C06\u4F1A\u76F4\u63A5\u8BF7\u6C42\u5927\u6A21\u578B\u3002",fieldProps:{onChange:E}}),(0,t.jsx)(le.Z,{width:"lg",name:"prompt",label:"prompt",placeholder:"\u8BF7\u8F93\u5165prompt",rules:[{required:!0,message:"\u8BF7\u8F93\u5165prompt"}]}),(0,t.jsx)(ge.Z,{width:"lg",name:"model",label:"model",allowClear:!0,options:[{value:"ZHIPUAI_GLM_3_TURBO",label:"\u667A\u8C31AI-GLM-3-Turbo"},{value:"ZHIPUAI_GLM_4",label:"\u667A\u8C31AI-GLM-4"},{value:"OLLAMA",label:"Ollama"},{value:"OPENAI",label:"OpenAi",disabled:!0}],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5927\u6A21\u578B"}]}),(0,t.jsx)(he.Z,{width:"lg",label:"\u6E29\u5EA6",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E29\u5EA6"}]}),(0,t.jsx)(he.Z,{width:"lg",label:"\u4E0A\u4E0B\u6587\u6D88\u606F\u6570",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E0A\u4E0B\u6587\u6D88\u606F\u6570"}]})]})]})},Ze=Ne,ye=n(87603),$e=function(){var d=(0,F.useIntl)(),v=(0,F.useNavigate)(),l=G.A.useForm(),o=L()(l,1),S=o[0],O=(0,oe.Z)(),Z=O.translateString,e=(0,z.V)(function(D){return{currentRobot:D.currentRobot,setCurrentRobot:D.setCurrentRobot}}),a=e.currentRobot,E=e.setCurrentRobot;(0,U.useEffect)(function(){var D;S.setFieldValue("enabled",!(a!=null&&(D=a.llm)!==null&&D!==void 0&&D.enabled)),S.setFieldValue("defaultReply",a==null?void 0:a.defaultReply)},[a]);var A=function(){var D=B()(C()().mark(function i(){return C()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:S.validateFields().then(function(){var y=B()(C()().mark(function r(u){var m,c,h,b,x,p,s;return C()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return console.log("TabKeyword handleSubmit",u),f.yw.loading(d.formatMessage({id:"updating"})),p=T()(T()({},a),{},{serviceSettings:T()(T()({},a==null?void 0:a.serviceSettings),{},{faqUids:a==null||(m=a.serviceSettings)===null||m===void 0||(m=m.faqs)===null||m===void 0?void 0:m.map(function(k){return k.uid}),quickFaqUids:a==null||(c=a.serviceSettings)===null||c===void 0||(c=c.quickFaqs)===null||c===void 0?void 0:c.map(function(k){return k.uid}),guessFaqUids:a==null||(h=a.serviceSettings)===null||h===void 0||(h=h.guessFaqs)===null||h===void 0?void 0:h.map(function(k){return k.uid}),hotFaqUids:a==null||(b=a.serviceSettings)===null||b===void 0||(b=b.hotFaqs)===null||b===void 0?void 0:b.map(function(k){return k.uid}),shortcutFaqUids:a==null||(x=a.serviceSettings)===null||x===void 0||(x=x.shortcutFaqs)===null||x===void 0?void 0:x.map(function(k){return k.uid})}),llm:T()(T()({},a==null?void 0:a.llm),{},{enabled:!u.enabled}),defaultReply:u.defaultReply}),console.log("robotObject:",p),W.next=6,(0,X.$l)(p);case 6:s=W.sent,console.log("updateRobot response:",s),s.code===200?(f.yw.destroy(),f.yw.success(d.formatMessage({id:"update.success"})),E(s.data)):(f.yw.destroy(),f.yw.error(s.message));case 9:case"end":return W.stop()}},r)}));return function(r){return y.apply(this,arguments)}}()).catch(function(y){console.log("Form errors:",y)});case 1:case"end":return j.stop()}},i)}));return function(){return D.apply(this,arguments)}}(),q=function(){var D=B()(C()().mark(function i(R){var j,y,r,u,m,c,h;return C()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return console.log("TabKeyword handleEnableChange",R),f.yw.loading(d.formatMessage({id:"updating"})),c=T()(T()({},a),{},{serviceSettings:T()(T()({},a==null?void 0:a.serviceSettings),{},{quickFaqUids:a==null||(j=a.serviceSettings)===null||j===void 0||(j=j.quickFaqs)===null||j===void 0?void 0:j.map(function(p){return p.uid}),faqUids:a==null||(y=a.serviceSettings)===null||y===void 0||(y=y.faqs)===null||y===void 0?void 0:y.map(function(p){return p.uid}),guessFaqUids:a==null||(r=a.serviceSettings)===null||r===void 0||(r=r.guessFaqs)===null||r===void 0?void 0:r.map(function(p){return p.uid}),hotFaqUids:a==null||(u=a.serviceSettings)===null||u===void 0||(u=u.hotFaqs)===null||u===void 0?void 0:u.map(function(p){return p.uid}),shortcutFaqUids:a==null||(m=a.serviceSettings)===null||m===void 0||(m=m.shortcutFaqs)===null||m===void 0?void 0:m.map(function(p){return p.uid})}),llm:T()(T()({},a==null?void 0:a.llm),{},{enabled:!R})}),console.log("robotObject:",c),x.next=6,(0,X.$l)(c);case 6:h=x.sent,console.log("updateRobot response:",h),h.code===200?(f.yw.destroy(),f.yw.success(d.formatMessage({id:"update.success"})),E(h.data)):(f.yw.destroy(),f.yw.error(h.message));case 9:case"end":return x.stop()}},i)}));return function(R){return D.apply(this,arguments)}}();return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(G.A,{form:S,onFinish:A,children:[(0,t.jsx)(pe.Z,{label:"\u662F\u5426\u542F\u7528\u5173\u952E\u8BCD",name:"enabled",tooltip:"\u542F\u7528\u5173\u952E\u5B57\u540E\uFF0C\u5C06\u4F1A\u5173\u95ED\u5927\u6A21\u578B\u3002\u7528\u6237\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u5982\u679C\u6D88\u606F\u5185\u5BB9\u5305\u542B\u5173\u952E\u5B57\uFF0C\u5219\u673A\u5668\u4EBA\u5C06\u5339\u914D\u5173\u952E\u5B57\u5E76\u81EA\u52A8\u56DE\u590D\u3002",fieldProps:{onChange:q}}),(0,t.jsx)(G.A.Item,{children:(0,t.jsx)(K.ZP,{icon:(0,t.jsx)(ye.Z,{}),onClick:function(){v("/kb/keyword/data")},children:"\u6DFB\u52A0\u5173\u952E\u5B57"},"github")}),(0,t.jsx)(le.Z,{width:"lg",label:"\u672A\u5339\u914D\u56DE\u590D\u8BED",name:"defaultReply"})]})})},Ie=$e,Be=function(d){var v=d.type;return(0,t.jsx)("div",{children:"TODO: \u5BF9\u63A5fastgpt\u3001dify\u7B49\u5DE5\u5177"})},Le=Be,qe=n(17167),Ve=function(){return(0,t.jsx)("div",{children:(0,t.jsx)(qe.Z,{})})},Ke=Ve,We=n(23035),Ge=n(51364),He=n(54050),Xe=n(10411),ze=function(){var d=(0,F.useIntl)(),v=(0,F.useNavigate)(),l=G.A.useForm(),o=L()(l,1),S=o[0],O=(0,oe.Z)(),Z=O.translateString,e=(0,U.useState)(),a=L()(e,2),E=a[0],A=a[1],q=(0,Q.u)(function(r){return r.currentOrg}),D=(0,z.V)(function(r){return{currentRobot:r.currentRobot,setCurrentRobot:r.setCurrentRobot}}),i=D.currentRobot,R=D.setCurrentRobot,j=function(){var r=B()(C()().mark(function u(){var m,c;return C()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f.yw.loading(d.formatMessage({id:"loading",defaultMessage:"Loading"})),m={pageNumber:0,pageSize:50,type:g.QPQ,orgUid:q.uid},b.next=4,(0,Xe.AP)(m);case 4:c=b.sent,console.log("getKeywordBase response:",m,c),f.yw.destroy(),c.code===200?A(c):f.yw.error(c.message);case 8:case"end":return b.stop()}},u)}));return function(){return r.apply(this,arguments)}}();(0,U.useEffect)(function(){j()},[]),(0,U.useEffect)(function(){S.setFieldValue("kbUid",i==null?void 0:i.kbUid)},[i]);var y=function(){var r=B()(C()().mark(function u(m){var c,h,b,x,p,s,_;return C()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return console.log("onFinish values:",m),s=T()(T()({},i),{},{serviceSettings:T()(T()({},i.serviceSettings),{},{faqUids:i==null||(c=i.serviceSettings)===null||c===void 0||(c=c.faqs)===null||c===void 0?void 0:c.map(function(M){return M.uid}),quickFaqUids:i==null||(h=i.serviceSettings)===null||h===void 0||(h=h.quickFaqs)===null||h===void 0?void 0:h.map(function(M){return M.uid}),guessFaqUids:i==null||(b=i.serviceSettings)===null||b===void 0||(b=b.guessFaqs)===null||b===void 0?void 0:b.map(function(M){return M.uid}),hotFaqUids:i==null||(x=i.serviceSettings)===null||x===void 0||(x=x.hotFaqs)===null||x===void 0?void 0:x.map(function(M){return M.uid}),shortcutFaqUids:i==null||(p=i.serviceSettings)===null||p===void 0||(p=p.shortcutFaqs)===null||p===void 0?void 0:p.map(function(M){return M.uid})}),kbUid:m.kbUid}),console.log("robotObject:",s),k.next=5,(0,X.$l)(s);case 5:_=k.sent,console.log("updateRobot response:",_),_.code===200?(f.yw.destroy(),f.yw.success(d.formatMessage({id:"update.success"})),R(_.data)):(f.yw.destroy(),f.yw.error(_.message));case 8:case"end":return k.stop()}},u)}));return function(m){return r.apply(this,arguments)}}();return(0,t.jsx)("div",{children:(0,t.jsxs)(G.A,{form:S,onFinish:y,children:[(0,t.jsx)(ge.Z,{width:"md",name:"kbUid",label:"\u77E5\u8BC6\u5E93",options:E==null?void 0:E.data.content.map(function(r){return{value:r.uid,label:Z(r.name)}}),fieldProps:{onChange:function(u){console.log("kbUid:",u)}}}),(0,t.jsx)(G.A.Item,{children:(0,t.jsx)(K.ZP,{icon:(0,t.jsx)(ye.Z,{}),onClick:function(){v("/kb/llm/data")},children:"\u6DFB\u52A0\u5927\u6A21\u578B\u77E5\u8BC6\u5E93"},"github")})]})})},Qe=ze,Ye=n(73453),Je=n(48489),et=n(91116),tt=n(35791),nt=function(){var d=(0,F.useIntl)(),v=(0,U.useMemo)(function(){return!0},[]),l=[{key:"kb",label:(0,t.jsx)(F.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,t.jsx)(Qe,{}),disabled:v},{key:"faq",label:(0,t.jsx)(F.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"Faq"}),children:(0,t.jsx)(Oe.Z,{type:g._X4}),disabled:v},{key:"quickFaqs",label:(0,t.jsx)(F.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"QuickButton"}),children:(0,t.jsx)(Ge.Z,{type:g._X4}),disabled:v},{key:"faqGuess",label:(0,t.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FaqGuess"}),children:(0,t.jsx)(ke.Z,{type:g._X4}),disabled:v},{key:"faqHot",label:(0,t.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FaqHot"}),children:(0,t.jsx)(Pe.Z,{type:g._X4}),disabled:v},{key:"faqShortcut",label:(0,t.jsx)(F.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FaqShortcut"}),children:(0,t.jsx)(_e.Z,{type:g._X4}),disabled:v},{key:"llm",label:(0,t.jsx)(F.FormattedMessage,{id:"llm",defaultMessage:"Llm"}),children:(0,t.jsx)(Ze,{}),disabled:v},{key:"keyword",label:(0,t.jsx)(F.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),children:(0,t.jsx)(Ie,{}),disabled:v},{key:"third",label:(0,t.jsx)(F.FormattedMessage,{id:"third",defaultMessage:"Third"}),children:(0,t.jsx)(Le,{type:g._X4}),disabled:v},{key:"transfer",label:(0,t.jsx)(F.FormattedMessage,{id:"transfer",defaultMessage:"Transfer"}),children:(0,t.jsx)(Ke,{}),disabled:v},{key:"survey",label:(0,t.jsx)(F.FormattedMessage,{id:"survey",defaultMessage:"Survey"}),children:(0,t.jsx)(tt.Z,{type:g._X4}),disabled:v},{key:"history",label:(0,t.jsx)(F.FormattedMessage,{id:"history",defaultMessage:"History"}),children:(0,t.jsx)(Ye.Z,{type:g._X4}),disabled:v},{key:"inputassociation",label:(0,t.jsx)(F.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,t.jsx)(et.Z,{type:g._X4}),disabled:v},{key:"black",label:(0,t.jsx)(F.FormattedMessage,{id:"black",defaultMessage:"Black"}),children:(0,t.jsx)(He.Z,{type:g._X4}),disabled:v},{key:"antiharassment",label:(0,t.jsx)(F.FormattedMessage,{id:"antiharassment",defaultMessage:"Anti Harassment"}),children:(0,t.jsx)(We.Z,{type:g._X4}),disabled:v}];return(0,t.jsxs)(t.Fragment,{children:[v&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(be.Z,{message:"\u4F01\u4E1A\u7248-\u9AD8\u7EA7\u529F\u80FD",style:{marginBottom:20},type:"warning",action:(0,t.jsx)(K.ZP,{type:"link",icon:(0,t.jsx)(Je.Z,{}),onClick:function(){return window.open(g.rVq)},children:d.formatMessage({id:"setting.helpdoc"})})})}),(0,t.jsx)(me.Z,{tabPosition:"left",items:l})]})},at=nt,rt=n(36649),ot=n(31207),st=n(22268),it=n(16737),lt=n(53004),ut=n(88484),dt=n(8232),ct=function(){var d=G.A.useForm(),v=L()(d,1),l=v[0],o=(0,F.useIntl)(),S=(0,oe.Z)(),O=S.translateString,Z=(0,z.V)(function(r){return{currentRobot:r.currentRobot,setCurrentRobot:r.setCurrentRobot}}),e=Z.currentRobot,a=Z.setCurrentRobot,E=(0,U.useState)(""),A=L()(E,2),q=A[0],D=A[1];(0,U.useEffect)(function(){if(e){var r;l.setFieldValue("nickname",O(e==null?void 0:e.nickname)),l.setFieldValue("welcomeTip",O(e==null||(r=e.serviceSettings)===null||r===void 0?void 0:r.welcomeTip)),l.setFieldValue("description",O(e==null?void 0:e.description))}},[e]);var i=function(){var r=B()(C()().mark(function u(m){var c,h,b,x,p,s,_;return C()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return console.log("onFinish:",m),f.yw.loading(o.formatMessage({id:"updating"})),s=T()(T()({},e),{},{serviceSettings:T()(T()({},e.serviceSettings),{},{welcomeTip:m.welcomeTip,quickFaqUids:e==null||(c=e.serviceSettings)===null||c===void 0||(c=c.quickFaqs)===null||c===void 0?void 0:c.map(function(M){return M.uid}),faqUids:e==null||(h=e.serviceSettings)===null||h===void 0||(h=h.faqs)===null||h===void 0?void 0:h.map(function(M){return M.uid}),guessFaqUids:e==null||(b=e.serviceSettings)===null||b===void 0||(b=b.guessFaqs)===null||b===void 0?void 0:b.map(function(M){return M.uid}),hotFaqUids:e==null||(x=e.serviceSettings)===null||x===void 0||(x=x.hotFaqs)===null||x===void 0?void 0:x.map(function(M){return M.uid}),shortcutFaqUids:e==null||(p=e.serviceSettings)===null||p===void 0||(p=p.shortcutFaqs)===null||p===void 0?void 0:p.map(function(M){return M.uid})}),nickname:m.nickname,description:m.description,avatar:q}),console.log("robotObject:",s),k.next=6,(0,X.$l)(s);case 6:_=k.sent,console.log("updateRobot response:",_),_.code===200?(f.yw.success(o.formatMessage({id:"update.success"})),a(_.data)):f.yw.error(_.message),f.yw.destroy();case 10:case"end":return k.stop()}},u)}));return function(m){return r.apply(this,arguments)}}(),R=function(u){console.log("handleUploadSuccess:",u),D(u)},j=function(u){console.log("handleUploadError:",u)},y=function(u){return console.log("Upload event:",u),Array.isArray(u)?u:u==null?void 0:u.fileList};return(0,U.useEffect)(function(){D(e==null?void 0:e.avatar)},[e]),(0,t.jsxs)(G.A,{form:l,style:{marginLeft:"100px"},onFinish:i,children:[(0,t.jsx)(dt.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:y,label:o.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,t.jsxs)(lt.G,{onSuccess:R,onError:j,children:[(0,t.jsx)(te.C,{src:q}),(0,t.jsx)(K.ZP,{icon:(0,t.jsx)(ut.Z,{}),children:o.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,t.jsx)(fe.Z,{width:"md",name:"nickname",label:o.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),tooltip:o.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),placeholder:o.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),rules:[{required:!0,message:o.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"})}]}),(0,t.jsx)(le.Z,{width:"md",name:"welcomeTip",label:o.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),tooltip:o.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),placeholder:o.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),rules:[{required:!0,message:o.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"})}]}),(0,t.jsx)(le.Z,{width:"md",name:"description",label:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:o.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})},vt=ct,gt=n(59518),ft=function(){var d=(0,F.useIntl)(),v=(0,U.useState)([]),l=L()(v,2),o=l[0],S=l[1],O=[{key:"basic",label:d.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,t.jsx)(vt,{})},{key:"serviceSettings",label:d.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,t.jsx)(gt.Z,{type:g._X4})},{key:"advanced",label:d.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,t.jsx)(at,{})},{key:"channel",label:d.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,t.jsx)(rt.Z,{type:g._X4})},{key:"channelsocial",label:d.formatMessage({id:"channelsocial",defaultMessage:"Social Channel"}),children:(0,t.jsx)(it.Z,{type:g._X4})},{key:"channelshop",label:d.formatMessage({id:"channelshop",defaultMessage:"Shop Channel"}),children:(0,t.jsx)(st.Z,{type:g._X4})},{key:"channelforeign",label:d.formatMessage({id:"channelforeign",defaultMessage:"Foreign Channel"}),children:(0,t.jsx)(ot.Z,{type:g._X4})}];return(0,U.useEffect)(function(){if(0)var Z;S(O)},[]),(0,t.jsx)(me.Z,{defaultActiveKey:"basic",items:o})},mt=ft,bt=n(77154),pt=Y.Z.Sider,ht=Y.Z.Content,yt=function(){var d=(0,bt.Z)(),v=d.leftSiderStyle,l=d.leftSiderWidth,o=d.contentStyle;return(0,t.jsxs)(Y.Z,{children:[(0,t.jsx)(pt,{width:l,style:v,children:(0,t.jsx)(Ce,{})}),(0,t.jsx)(Y.Z,{children:(0,t.jsx)(ht,{style:o,children:(0,t.jsx)(mt,{})})})]})},Ft=yt}}]);
