"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6130],{200:function(e,t,n){n.d(t,{I2:function(){return h},dO:function(){return f},l8:function(){return m},o_:function(){return c}});var r=n(90819),a=n.n(r),o=n(73193),s=n.n(o),l=n(89933),i=n.n(l),u=n(55735),d=n(30921);function c(e){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/autoreply/fixed/query/org",{method:"GET",params:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/autoreply/fixed/create",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return(y=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/autoreply/fixed/update",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/autoreply/fixed/delete",{method:"POST",data:s()(s()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},63912:function(e,t,n){n.r(t),n.d(t,{default:function(){return ye}});var r=n(96865),a=n(75574),o=n(55735),s=n(8377),l=n(8247),i=n(30921),u=n(73193),d=n.n(u),c=n(84176),p=n.n(c),f=n(90819),g=n.n(f),m=n(89933),y=n.n(m),h=n(45332),v=n.n(h),x=n(86803);function w(e){return b.apply(this,arguments)}function b(){return(b=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/autoreply/keyword/query/org",{method:"GET",params:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return M.apply(this,arguments)}function M(){return(M=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/autoreply/keyword/create",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/autoreply/keyword/update",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return C.apply(this,arguments)}function C(){return(C=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/autoreply/keyword/delete",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=n(40612),U=n(25482),D=n(30617),A=n(11090),P=n(61107),F=n(72381),Y=n(61355),_=n(75365),I=n(44194),q=n(90838),E=n(6397),L=n(44521),O=n(42085),V=n(69169),R=n(84881),K=n(4499),Q=n(48708),z=n(73442),N=n(3849),W=n(44867),B=n(28977),H=n.n(B),G=n(51990),J=n(65461),$=n(31549),X=function(e){var t=e.isEdit,n=e.keyword,r=e.open,a=e.onClose,s=e.onSubmit,l=V.A.useForm(),i=v()(l,1)[0],u=(0,I.useState)(""),c=v()(u,2),p=c[0],f=c[1],g=(0,T.u)((function(e){return e.currentOrg})),m=(0,E.j)((function(e){return e.currentKbase})),y=(0,q.v)((function(e){return e.categorySelectOptions})),h=(0,I.useState)(),w=v()(h,2),b=w[0],k=w[1],M=(0,I.useState)(o.PYi),j=v()(M,2),S=j[0],Z=j[1],C=(0,I.useState)(".png,.jpg,.jpeg"),U=v()(C,2),D=U[0],A=U[1],P=(0,I.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==m?void 0:m.uid)||"",client:o.bVn}),F=v()(P,2),Y=F[0];F[1];(0,I.useEffect)((function(){t?i.setFieldsValue({keyword:null==n?void 0:n.keywordList,reply:null==n?void 0:n.replyList,matchType:null==n?void 0:n.matchType,contentType:null==n?void 0:n.contentType,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==m?void 0:m.uid,enabled:null==n?void 0:n.enabled}):i.resetFields()}),[r]);var B={name:"file",accept:D,action:(0,L.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:Y,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;Y.file=e,Y.file_name=t,Y.file_type=e.type,Y.kb_type=o.YjS,Y.category_uid=b||"",Y.kb_uid=null==m?void 0:m.uid,console.log("beforeUpload",Y)},onChange:function(e){if("uploading"===e.file.status&&x.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;i.setFieldValue("reply",t),x.yw.destroy(),x.yw.success("".concat(e.file.name," 上传成功"))}else x.yw.destroy(),x.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&x.yw.error("".concat(e.file.name," 上传失败"))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,$.jsx)($.Fragment,{children:(0,$.jsx)(z.Z,{title:t?"修改":"新建",width:650,onClose:a,open:r,extra:(0,$.jsxs)(N.Z,{children:[(0,$.jsx)(_.ZP,{onClick:a,children:"取消"}),(0,$.jsx)(_.ZP,{onClick:function(){console.log("handleSubmit"),i.validateFields().then((function(e){console.log(e),s(d()(d()(d()({},n),e),{},{keywordList:[e.keyword],replyList:[p],kbUid:null==m?void 0:m.uid,orgUid:null==g?void 0:g.uid}))})).catch((function(e){console.log("Form errors:",e),x.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,$.jsxs)(V.A,{form:i,submitter:{render:function(){return null}},children:[(0,$.jsx)(R.Z,{label:"匹配类型",name:"matchType",rules:[{required:!0,message:"请选择匹配类型"}],options:[{label:"模糊匹配",value:o.lEl},{label:"精确匹配",value:o.TAc,disabled:!0},{label:"正则匹配",value:o.c7i,disabled:!0},{label:"向量匹配",value:o.sOn,disabled:!0},{label:"搜索引擎匹配",value:o.NDq,disabled:!0}],fieldProps:{allowClear:!0,placeholder:"请选择匹配类型"}}),(0,$.jsx)(R.Z,{label:"内容分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:y,tooltip:"请先：创建分类",fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),k(e)}}}),(0,$.jsx)(R.Z,{label:"类型",name:"contentType",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:o.PYi},{label:"图片",value:o.Qm},{label:"视频",value:o.tVi},{label:"音频",value:o.Yu1},{label:"文件",value:o.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),Z(e),e===o.Qm?A(".png,.jpg,.jpeg,.gif,.bmp"):e===o.tVi?A(".mp4,.avi,.mov,.wmv"):e===o.Yu1?A(".mp3,.wav,.flac"):e===o.Qn&&A(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,$.jsx)(K.Z,{label:"关键词",name:"keyword",tooltip:"多个关键词使用 '|' 分割",placeholder:"请输入关键词，多个关键词使用 '|' 分割",rules:[{required:!0,message:"请输入关键词，多个关键词使用 '|' 分割 "}]}),(0,$.jsx)(V.A.Item,{name:"reply",label:"回复",rules:[{required:!0,message:"请输入回复"}],children:(0,$.jsx)(G.Z,{placeholder:"reply content..",value:p,toolbarKeys:(0,J.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){f(e)}})}),(0,$.jsx)(Q.Z,{label:"启用",name:"enabled",fieldProps:{defaultValue:!0}}),S!=o.PYi&&(0,$.jsxs)(W.Z,d()(d()({},B),{},{children:[(0,$.jsx)("p",{className:"ant-upload-drag-icon",children:(0,$.jsx)(O.Z,{})}),(0,$.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽上传文件"})]}))]})})})},ee=n(93569),te=n(20035),ne=n(76750),re=n(42540),ae=n(23864),oe=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,ae.Z)().isDarkMode,s=(0,ne.Z)().translateString,l=(0,I.useRef)(),i=(0,E.j)((function(e){return e.currentKbase}));(0,I.useEffect)((function(){var e;null===(e=l.current)||void 0===e||e.clearMessage()}),[i]);var u=function(){var e=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleChatKeyword");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=y()(g()().mark((function e(t){var n,r,a,o,s,l;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleChatStream"),n=t[t.length-1],e.next=4,fetch("http://127.0.0.1:1001/visitor/api/v1/ai/ollama/chat/stream",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({query:null==n?void 0:n.content,kbUid:null==i?void 0:i.uid,stream:!0})});case 4:if((r=e.sent).ok&&r.body){e.next=7;break}throw new Error("HTTP error! status: ".concat(r.status));case 7:return a=r.body.getReader(),o=new TextDecoder("utf-8"),s=new TextEncoder,l=new ReadableStream({start:function(e){return y()(g()().mark((function t(){var n;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=function(){a.read().then((function(t){var r=t.done,a=t.value;if(r)e.close();else{var l=o.decode(a,{stream:!0}).replaceAll("data:","").replaceAll("\n","");e.enqueue(s.encode(l)),n()}})).catch((function(t){console.error("读取流中的数据时发生错误",t),e.error(t)}))})();case 2:case"end":return t.stop()}}),t)})))()}}),e.abrupt("return",new Response(l));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,$.jsx)("div",{children:(0,$.jsx)(z.Z,{title:s(null==i?void 0:i.name),onClose:function(){r&&r()},open:n,styles:{body:{padding:0}},children:(0,$.jsx)(te.f6,{appearance:a?"dark":"light",theme:{algorithm:a?re.Z.darkAlgorithm:re.Z.defaultAlgorithm},children:(0,$.jsx)(ee.j,{chatRef:l,helloMessage:"请输入你想问的问题",request:function(){var e=y()(g()().mark((function e(n){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("messages:",n),!(n.length>0)){e.next=8;break}if(t!==o.QPQ){e.next=6;break}return e.abrupt("return",d(n));case 6:if(t!==o.WvL){e.next=8;break}return e.abrupt("return",u(n));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})})})},se=n(27650),le=["current"],ie=function(){var e=(0,i.useIntl)(),t=(0,I.useRef)(),n=(0,I.useState)(!0),r=v()(n,2),a=r[0],s=r[1],l=(0,I.useState)(),u=v()(l,2),c=u[0],f=u[1],m=(0,I.useState)(!1),h=v()(m,2),b=h[0],M=h[1],S=(0,T.u)((function(e){return e.currentOrg})),C=(0,E.j)((function(e){return e.currentKbase})),O=(0,q.v)((function(e){return e.currentCategory})),V=(0,I.useState)(!1),R=v()(V,2),K=R[0],Q=R[1],z=(0,I.useState)(!1),N=v()(z,2),W=N[0],B=N[1],G=function(){var n=y()(g()().mark((function n(r){var a;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,Z(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),J=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,$.jsx)(i.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),dataIndex:"keywordList",copyable:!0},{title:(0,$.jsx)(i.FormattedMessage,{id:"reply",defaultMessage:"Reply"}),dataIndex:"replyList",copyable:!0},{title:(0,$.jsx)(i.FormattedMessage,{id:"matchType",defaultMessage:"MatchType"}),dataIndex:"matchType",width:80,render:function(t,n){return e.formatMessage({id:null==n?void 0:n.matchType,defaultMessage:null==n?void 0:n.matchType})}},{title:(0,$.jsx)(i.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"contentType",hideInSearch:!0,width:50,render:function(t,n){return(0,$.jsx)($.Fragment,{children:e.formatMessage({id:null==n?void 0:n.contentType,defaultMessage:null==n?void 0:n.contentType})})}},{title:(0,$.jsx)(i.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",width:80,render:function(t,n){return(0,$.jsx)($.Fragment,{children:null!=n&&n.enabled?e.formatMessage({id:"yes",defaultMessage:"Yes"}):e.formatMessage({id:"no",defaultMessage:"No"})})}},{title:(0,$.jsx)(i.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,r){return H()(null==t?void 0:t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,render:function(t,n,r,a){return[(0,$.jsx)("a",{onClick:function(){te(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,$.jsx)(Y.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.keywordList,"】？"),onConfirm:function(){return G(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,$.jsx)(_.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}],ee=function(){f(void 0),s(!1),M(!0)},te=function(e){f(e),s(!0),M(!0)},ne=function(){var n=y()(g()().mark((function n(r){var o,s;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("handleSubmitDrawer",r),a?x.yw.loading(e.formatMessage({id:"updating"})):x.yw.loading(e.formatMessage({id:"creating"})),!a){n.next=8;break}return n.next=5,j(r);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,k(r);case 10:n.t0=n.sent;case 11:o=n.t0,console.log("createKeyword response:",r,o),200===o.code?(x.yw.destroy(),x.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),M(!1),null===(s=t.current)||void 0===s||s.reloadAndRest()):(x.yw.destroy(),x.yw.error(o.message));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),re=function(){var e=y()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=y()(g()().mark((function e(){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=localStorage.getItem(o.LA8),window.open((0,L.kG)()+"/api/v1/keyword/export?categoryUid="+(null==O?void 0:O.uid)+"&kbUid="+(null==C?void 0:C.uid)+"&orgUid="+(null==S?void 0:S.uid)+"&pageNumber=0&pageSize=20&accessToken="+t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,I.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[C,O]);var ie=(0,I.useMemo)((function(){return(null==C?void 0:C.type)!==o.WvL||""===(null==C?void 0:C.uid)}),[C]);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(F.Z,{columns:J,actionRef:t,cardBordered:!0,request:function(){var t=y()(g()().mark((function t(n,r,a){var o,s,l;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.current,o=p()(n,le),s=d()({pageNumber:n.current-1,categoryUid:"all"===O.uid?"":O.uid,kbUid:null==C?void 0:C.uid,orgUid:null==S?void 0:S.uid},o),t.next=6,w(s);case 6:return l=t.sent,console.log("getAllKeywords response:",s,l),x.yw.destroy(),200===l.code||x.yw.error(l.message),t.abrupt("return",{data:l.data.content,success:!0,total:l.data.totalElements});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"menu.knowledge.keyword",defaultMessage:"KEYWORD"}),tooltip:{title:"客服-》一对一-》高级设置-》自动回复",placement:"top"},toolBarRender:function(){return[(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(U.Z,{}),type:"primary",onClick:ee,disabled:ie,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(D.Z,{}),type:"primary",onClick:re,disabled:ie,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"import"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(A.Z,{}),type:"primary",onClick:ae,disabled:ie,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"export"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(P.Z,{}),type:"link",onClick:function(){window.open("https://www.weiyuai.cn/download/excel/kbase_keyword.xlsx")},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]}}),b&&(0,$.jsx)(X,{isEdit:a,open:b,keyword:c,onClose:function(){return M(!1)},onSubmit:ne}),W&&(0,$.jsx)(se.Z,{type:o.WvL,acceptType:".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",isModalOpen:W,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),B(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),B(!1),null==t||t.current.reload()}}),K&&(0,$.jsx)(oe,{type:o.WvL,open:K,onClose:function(){return Q(!1)}})]})},ue=n(200),de=function(e){var t=e.isEdit,n=e.autoreply,r=e.open,a=e.onClose,s=e.onSubmit,l=V.A.useForm(),i=v()(l,1)[0],u=(0,I.useState)(""),c=v()(u,2),p=c[0],f=c[1],g=(0,T.u)((function(e){return e.currentOrg})),m=(0,E.j)((function(e){return e.currentKbase})),y=(0,q.v)((function(e){return e.categorySelectOptions})),h=(0,I.useState)(),w=v()(h,2),b=w[0],k=w[1],M=(0,I.useState)(o.PYi),j=v()(M,2),S=j[0],Z=j[1],C=(0,I.useState)(".png,.jpg,.jpeg"),U=v()(C,2),D=U[0],A=U[1],P=(0,I.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==m?void 0:m.uid)||"",client:o.bVn}),F=v()(P,2),Y=F[0];F[1];(0,I.useEffect)((function(){t?i.setFieldsValue({type:null==n?void 0:n.type,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==m?void 0:m.uid}):i.resetFields()}),[r]);var K={name:"file",accept:D,action:(0,L.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:Y,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=H()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;Y.file=e,Y.file_name=t,Y.file_type=e.type,Y.kb_type=o.YjS,Y.category_uid=b||"",Y.kb_uid=null==m?void 0:m.uid,console.log("beforeUpload",Y)},onChange:function(e){if("uploading"===e.file.status&&x.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;f(t),x.yw.destroy(),x.yw.success("".concat(e.file.name," 上传成功"))}else x.yw.destroy(),x.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&x.yw.error("".concat(e.file.name," 上传失败"))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,$.jsx)($.Fragment,{children:(0,$.jsx)(z.Z,{title:t?"修改":"新建",width:650,onClose:a,open:r,extra:(0,$.jsxs)(N.Z,{children:[(0,$.jsx)(_.ZP,{onClick:a,children:"取消"}),(0,$.jsx)(_.ZP,{onClick:function(){console.log("handleSubmit"),i.validateFields().then((function(e){console.log(e),s(d()(d()(d()({},n),e),{},{kbUid:null==m?void 0:m.uid,orgUid:null==g?void 0:g.uid,content:p}))})).catch((function(e){console.log("Form errors:",e),x.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,$.jsxs)(V.A,{form:i,initialValues:d()({},n),submitter:{render:function(){return null}},children:[(0,$.jsx)(R.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:y,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),k(e)}}}),(0,$.jsx)(R.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:o.PYi},{label:"图片",value:o.Qm},{label:"视频",value:o.tVi},{label:"音频",value:o.Yu1},{label:"文件",value:o.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),Z(e),e===o.Qm?A(".png,.jpg,.jpeg,.gif,.bmp"):e===o.tVi?A(".mp4,.avi,.mov,.wmv"):e===o.Yu1?A(".mp3,.wav,.flac"):e===o.Qn&&A(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,$.jsx)(V.A.Item,{name:"content",label:"回复",rules:[{required:!0,message:"请输入回复"}],children:(0,$.jsx)(G.Z,{placeholder:"content content..",value:p,toolbarKeys:(0,J.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){f(e)}})}),S!=o.PYi&&(0,$.jsxs)(W.Z,d()(d()({},K),{},{children:[(0,$.jsx)("p",{className:"ant-upload-drag-icon",children:(0,$.jsx)(O.Z,{})}),(0,$.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽上传文件"})]}))]})})})},ce=["current"],pe=function(){var e=(0,i.useIntl)(),t=(0,I.useRef)(),n=(0,I.useState)(!0),r=v()(n,2),a=r[0],s=r[1],l=(0,I.useState)(),u=v()(l,2),c=u[0],f=u[1],m=(0,I.useState)(!1),h=v()(m,2),w=h[0],b=h[1],k=(0,ne.Z)().translateString,M=(0,T.u)((function(e){return e.currentOrg})),j=(0,E.j)((function(e){return e.currentKbase})),S=(0,q.v)((function(e){return e.currentCategory})),Z=(0,I.useState)(!1),C=v()(Z,2),O=C[0],V=C[1],R=function(){var n=y()(g()().mark((function n(r){var a,o;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,(0,ue.I2)(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||null===(o=t.current)||void 0===o||o.reload(),x.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):x.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),K=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,$.jsx)(i.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",render:function(e,t){return k(null==t?void 0:t.content)}},{title:(0,$.jsx)(i.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,render:function(t,n){return(0,$.jsx)($.Fragment,{children:e.formatMessage({id:null==n?void 0:n.type,defaultMessage:null==n?void 0:n.type})})}},{title:(0,$.jsx)(i.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,r){return H()(null==t?void 0:t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,render:function(t,n,r,a){return[(0,$.jsx)("a",{onClick:function(){z(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,$.jsx)(Y.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.content,"】？"),onConfirm:function(){return R(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,$.jsx)(_.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}],Q=function(){f(void 0),s(!1),b(!0)},z=function(e){f(e),s(!0),b(!0)},N=function(){var n=y()(g()().mark((function n(r){var o,s;return g()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("handleSubmitDrawer",r),a?x.yw.loading(e.formatMessage({id:"updating"})):x.yw.loading(e.formatMessage({id:"creating"})),!a){n.next=8;break}return n.next=5,(0,ue.l8)(r);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,ue.dO)(r);case 10:n.t0=n.sent;case 11:o=n.t0,console.log("createQuickreply response:",r,o),200===o.code?(x.yw.destroy(),x.yw.loading(e.formatMessage({id:"create.success"})),b(!1),null===(s=t.current)||void 0===s||s.reload()):(x.yw.destroy(),x.yw.error(o.message));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),W=function(){var e=y()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:V(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=y()(g()().mark((function e(){var t;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExport"),t=localStorage.getItem(o.LA8),window.open((0,L.kG)()+"/api/v1/autoreply/export?categoryUid="+(null==S?void 0:S.uid)+"&kbUid="+(null==j?void 0:j.uid)+"&orgUid="+(null==M?void 0:M.uid)+"&pageNumber=0&pageSize=20&accessToken="+t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,I.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reload()}),[j,S]);var G=(0,I.useMemo)((function(){return(null==j?void 0:j.type)!==o.WvL||""===(null==j?void 0:j.uid)}),[j]);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(F.Z,{columns:K,actionRef:t,cardBordered:!0,request:function(){var t=y()(g()().mark((function t(n,r,a){var o,s,l,i,u;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),x.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,s=void 0===o?1:o,l=p()(n,ce),i=d()({pageNumber:s-1,categoryUid:"all"===(null==S?void 0:S.uid)?"":null==S?void 0:S.uid,kbUid:null==j?void 0:j.uid,orgUid:null==M?void 0:M.uid},l),t.next=6,(0,ue.o_)(i);case 6:return u=t.sent,console.log("queryAutoRepliesByOrg response:",i,u),x.yw.destroy(),200===u.code||x.yw.error(u.message),t.abrupt("return",{data:u.data.content,success:!0,total:u.data.totalElements});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"快捷回复",tooltip:{title:"客服-》一对一-》高级设置-》自动回复",placement:"top"},toolBarRender:function(){return[(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(U.Z,{}),type:"primary",onClick:Q,disabled:G,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"button"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(D.Z,{}),type:"primary",onClick:W,disabled:G,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"button"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(A.Z,{}),type:"primary",onClick:B,disabled:G,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button"),(0,$.jsx)(_.ZP,{icon:(0,$.jsx)(P.Z,{}),type:"link",onClick:function(){window.open("https://www.weiyuai.cn/download/excel/kbase_auto_reply.xlsx")},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]}}),(0,$.jsx)(de,{isEdit:a,open:w,autoreply:c,onClose:function(){return b(!1)},onSubmit:N}),O&&(0,$.jsx)(se.Z,{type:o.WvL,isModalOpen:O,handleSubmit:function(e){var n;console.log("handleUploadDragSubmit",e),V(!1),null==t||null===(n=t.current)||void 0===n||n.reload()},handleCancel:function(){var e;console.log("handleUploadDragCancel"),V(!1),null==t||null===(e=t.current)||void 0===e||e.reload()}})]})},fe=function(){var e=(0,i.useIntl)(),t=[{key:"keyword",label:e.formatMessage({id:"knowledge.autoreply.keyword",defaultMessage:"关键词回复"}),children:(0,$.jsx)(ie,{})},{key:"fixed",label:e.formatMessage({id:"knowledge.autoreply.fixed",defaultMessage:"固定回复"}),children:(0,$.jsx)(pe,{})}];return(0,$.jsx)(l.Z,{defaultActiveKey:"keyword",items:t})},ge=a.Z.Sider,me=a.Z.Content,ye=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,$.jsx)("div",{children:(0,$.jsxs)(a.Z,{children:[(0,$.jsx)(ge,{style:t,children:(0,$.jsx)(s.Z,{type:o.WvL})}),(0,$.jsx)(a.Z,{children:(0,$.jsx)(me,{style:n,children:(0,$.jsx)(fe,{})})})]})})}}}]);