"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{70401:function(me,R,e){e.d(R,{$t:function(){return ne},a_:function(){return H},vf:function(){return b}});var V=e(15009),p=e.n(V),B=e(97857),t=e.n(B),N=e(99289),u=e.n(N),x=e(85615),v=e(86745);function b(m){return I.apply(this,arguments)}function I(){return I=u()(p()().mark(function m(d){return p()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,v.request)("/api/v1/vip/crm/query/visitor/org",{method:"GET",params:t()(t()({},d),{},{client:x.bV})}));case 1:case"end":return g.stop()}},m)})),I.apply(this,arguments)}function H(){return y.apply(this,arguments)}function y(){return y=u()(p()().mark(function m(){return p()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",(0,v.request)("/visitor/api/v1/kaptcha",{method:"GET",params:{client:x.bV}}));case 1:case"end":return _.stop()}},m)})),y.apply(this,arguments)}function ne(m,d){return ee.apply(this,arguments)}function ee(){return ee=u()(p()().mark(function m(d,_){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,v.request)("/visitor/api/v1/kaptcha/check",{method:"POST",data:{captchaUid:d,captchaCode:_,client:x.bV}}));case 1:case"end":return l.stop()}},m)})),ee.apply(this,arguments)}function o(m){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function m(d){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",request("/api/v1/visitor/update",{method:"POST",data:_objectSpread(_objectSpread({},d),{},{client:HTTP_CLIENT})}));case 1:case"end":return g.stop()}},m)})),U.apply(this,arguments)}function O(m){return Y.apply(this,arguments)}function Y(){return Y=_asyncToGenerator(_regeneratorRuntime().mark(function m(d){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",request("/api/v1/visitor/delete",{method:"POST",data:_objectSpread(_objectSpread({},d),{},{client:HTTP_CLIENT})}));case 1:case"end":return g.stop()}},m)})),Y.apply(this,arguments)}},6144:function(me,R,e){var V=e(15009),p=e.n(V),B=e(99289),t=e.n(B),N=e(5574),u=e.n(N),x=e(70401),v=e(50228),b=e(86745),I=e(55102),H=e(67294),y=e(85893),ne=function(o){var U=o.onKaptchaChange,O=o.onKaptchaCheck,Y=(0,b.useIntl)(),m=(0,H.useState)(),d=u()(m,2),_=d[0],g=d[1],l=(0,H.useState)(),oe=u()(l,2),re=oe[0],ae=oe[1],se=function(){var w=t()(p()().mark(function a(){var A;return p()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(0,x.a_)();case 2:A=T.sent,A.code===200&&(g(A.data.captchaUid),ae(A.data.captchaImage));case 4:case"end":return T.stop()}},a)}));return function(){return w.apply(this,arguments)}}(),fe=function(){var w=t()(p()().mark(function a(A,ie){var T;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,x.$t)(A,ie);case 2:T=J.sent,console.log("checkCaptcha response",T),T.code===200?O&&O(!0):O&&O(!1);case 5:case"end":return J.stop()}},a)}));return function(A,ie){return w.apply(this,arguments)}}();(0,H.useEffect)(function(){se()},[]);var le=function(a){U&&(U(_,a.target.value),a.target.value&&a.target.value!==""&&a.target.value.trim().length===4?fe(_,a.target.value):O&&O(!1))};return(0,y.jsx)(y.Fragment,{children:re&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(I.Z,{onChange:le,prefix:(0,y.jsx)(v.Z,{}),placeholder:Y.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40}}),(0,y.jsx)("img",{src:re,alt:"captcha",onClick:se})]})})};R.Z=ne},19345:function(me,R,e){e.r(R),e.d(R,{default:function(){return ke}});var V=e(97857),p=e.n(V),B=e(15009),t=e.n(B),N=e(99289),u=e.n(N),x=e(5574),v=e.n(x),b=e(98661),I=e(34994),H=e(98082),y=e(10915),ne=e(68262),ee=e(92879),o=e(86745),U=e(9361),O=e(11941),Y=e(28459),m=e(31418),d=e(67294),_=e(73935),g=e(60247),l=e(80049),oe=e(63998),re=e(39825),ae=e(85615),se=e(6144),fe=e(87547),le=e(94149),w=e(5966),a=e(85893),A=function(s){var D=s.loginType,L=s.onKaptchaChange,$=s.onKaptchaCheck,K=(0,o.useIntl)(),te=function(){var Z=u()(t()().mark(function S(k,G){return t()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:L&&L(k,G);case 1:case"end":return X.stop()}},S)}));return function(k,G){return Z.apply(this,arguments)}}(),ue=function(){var Z=u()(t()().mark(function S(k){return t()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:$&&$(k);case 1:case"end":return C.stop()}},S)}));return function(k){return Z.apply(this,arguments)}}();return(0,a.jsx)(a.Fragment,{children:D==="account"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{name:"username",fieldProps:{size:"large",prefix:(0,a.jsx)(fe.Z,{})},placeholder:K.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D/\u90AE\u7BB1"}),rules:[{required:!0,message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D/\u90AE\u7BB1!"})}]}),(0,a.jsx)(w.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,a.jsx)(le.Z,{})},placeholder:K.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]}),(0,a.jsx)(I.A.Item,{name:"captchaCode",rules:[{required:!0,message:K.formatMessage({id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],children:(0,a.jsx)(se.Z,{onKaptchaChange:te,onKaptchaCheck:ue})})]})})},ie=A,T=e(24454),ye=e(16434),J=e(40056),je=function(s){var D=s.loginType,L=s.onKaptchaChange,$=s.onKaptchaCheck,K=(0,o.useIntl)(),te=(0,d.useRef)(),ue=(0,d.useState)(""),Z=v()(ue,2),S=Z[0],k=Z[1],G=(0,d.useState)(""),C=v()(G,2),X=C[0],ve=C[1],_e=(0,d.useState)(!1),de=v()(_e,2),ge=de[0],he=de[1],Me=function(){var z=u()(t()().mark(function j(f,F){return t()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:k(f),ve(F),L&&L(f,F);case 3:case"end":return Q.stop()}},j)}));return function(f,F){return z.apply(this,arguments)}}(),pe=function(){var z=u()(t()().mark(function j(f){return t()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:he(f),$&&$(f);case 2:case"end":return E.stop()}},j)}));return function(f){return z.apply(this,arguments)}}();return(0,a.jsx)(a.Fragment,{children:D==="mobile"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{fieldProps:{size:"large",prefix:(0,a.jsx)(T.Z,{})},name:"mobile",placeholder:K.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,a.jsx)(I.A.Item,{name:"captchaCode",rules:[{required:!0,message:K.formatMessage({id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],children:(0,a.jsx)(se.Z,{onKaptchaChange:Me,onKaptchaCheck:pe})}),(0,a.jsx)(ye.Z,{fieldProps:{size:"large",prefix:(0,a.jsx)(le.Z,{})},captchaProps:{size:"large",disabled:!ge},placeholder:K.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(j,f){return j?"".concat(f," ").concat(K.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):K.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],fieldRef:te,onGetCaptcha:function(){var z=u()(t()().mark(function j(f){var F,E;return t()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(console.log("mobile:",f),!(f&&f.length===11)){P.next=12;break}return F={mobile:f,type:ae.yC,captchaUid:S,captchaCode:X,platform:ae.iw},P.next=5,(0,b.Y7)(F);case 5:if(E=P.sent,E.code===200){P.next=9;break}return l.yw.error(E.message),P.abrupt("return");case 9:l.yw.success(E.message),P.next=13;break;case 12:l.yw.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 13:case"end":return P.stop()}},j)}));return function(j){return z.apply(this,arguments)}}()}),(0,a.jsx)(J.Z,{message:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},Ee=je,be=e(97253),Te=function(s){var D=s.loginType;return(0,a.jsx)(a.Fragment,{children:D==="scan"&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(be.Z,{style:{margin:"auto"},value:"login"})})})},De=Te,ce=e(66419),Ke=e(69554),Pe=U.Z.defaultAlgorithm,Ue=U.Z.darkAlgorithm,Le=function(){var s=(0,ee.l)(function(D){var L=D.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:L.borderRadius,":hover":{backgroundColor:L.colorBgTextHover}}});return(0,a.jsx)("div",{className:s,"data-lang":!0,children:o.SelectLang&&(0,a.jsx)(o.SelectLang,{})})},Se=function(){var s=(0,ce.hX)();return(0,a.jsx)("img",{alt:"logo",src:s})},xe=function(){var s=(0,ce.lk)();return(0,a.jsx)(o.FormattedMessage,{id:s,defaultMessage:"\u5FAE\u8BED"})},Ie=function(){var s=(0,ce.z)();return(0,a.jsx)(o.FormattedMessage,{id:s,defaultMessage:"\u5FAE\u8BED"})},Oe=function(){var s=(0,o.useIntl)(),D=I.A.useForm(),L=v()(D,1),$=L[0],K=U.Z.useToken(),te=K.token,ue=(0,re.Z)(),Z=ue.isDarkMode,S=(0,oe.t)(function(h){return h.setAccessToken}),k=(0,d.useState)("mobile"),G=v()(k,2),C=G[0],X=G[1],ve=(0,o.useModel)("@@initialState"),_e=ve.setInitialState,de=(0,d.useState)(!1),ge=v()(de,2),he=ge[0],Me=ge[1],pe=(0,g.L)(function(h){return h.setUserInfo}),z=(0,d.useState)(""),j=v()(z,2),f=j[0],F=j[1],E=function(){var h=u()(t()().mark(function c(i,n){return t()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:F(i),$.setFieldValue("captchaCode",n);case 2:case"end":return r.stop()}},c)}));return function(i,n){return h.apply(this,arguments)}}(),Q=function(){var h=u()(t()().mark(function c(i){return t()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:console.log("handleKaptchaCheck:",i);case 1:case"end":return M.stop()}},c)}));return function(i){return h.apply(this,arguments)}}(),P=[{key:"account",label:s.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"}),children:(0,a.jsx)(ie,{loginType:C,onKaptchaChange:E,onKaptchaCheck:Q})},{key:"mobile",label:s.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"}),children:(0,a.jsx)(Ee,{loginType:C,onKaptchaChange:E,onKaptchaCheck:Q})},{key:"scan",label:s.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"\u626B\u7801\u767B\u5F55"}),children:(0,a.jsx)(De,{loginType:C})}],Be={marginInlineStart:"16px",color:(0,H.uK)(te.colorTextBase,.2),fontSize:"24px",verticalAlign:"middle",cursor:"pointer"};(0,d.useEffect)(function(){(0,ce.Bc)()&&Me(!0)},[]);var Ce=function(){var h=u()(t()().mark(function c(i){return t()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:i&&(0,_.flushSync)(function(){_e(function(r){return p()(p()({},r),{},{userInfo:i})})});case 1:case"end":return M.stop()}},c)}));return function(i){return h.apply(this,arguments)}}(),Fe=function(){var h=u()(t()().mark(function c(i){var n;return t()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,l.yw.loading(s.formatMessage({id:"logining",defaultMessage:"logining..."})),r.next=4,(0,b.x4)(p()({},i));case 4:n=r.sent,console.log("LoginResult:",n),n.code===200?(l.yw.destroy(),l.yw.success(s.formatMessage({id:"login.success",defaultMessage:"login success"})),S(n.data.accessToken),Ce(n.data.user),pe(n.data.user),o.history.push("/")):(l.yw.destroy(),l.yw.error(n.message)),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(0),console.log(r.t0),l.yw.error(s.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 13:case"end":return r.stop()}},c,null,[[0,9]])}));return function(i){return h.apply(this,arguments)}}(),Re=function(){var h=u()(t()().mark(function c(i){var n;return t()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,l.yw.loading(s.formatMessage({id:"logining",defaultMessage:"logining..."})),r.next=4,(0,b.N9)(p()({},i));case 4:n=r.sent,console.log("LoginMobileResult:",n),n.code===200?(l.yw.destroy(),l.yw.success(s.formatMessage({id:"login.success",defaultMessage:"login success"})),S(n.data.accessToken),Ce(n.data.user),pe(n.data.user),o.history.push("/")):(l.yw.destroy(),l.yw.error(n.message)),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(0),console.log(r.t0),l.yw.error(s.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 13:case"end":return r.stop()}},c,null,[[0,9]])}));return function(i){return h.apply(this,arguments)}}(),we=function(){var h=u()(t()().mark(function c(){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:console.log("handleGithubLogin");case 1:case"end":return n.stop()}},c)}));return function(){return h.apply(this,arguments)}}(),We=function(){var h=u()(t()().mark(function c(){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:console.log("handleGoogleLogin");case 1:case"end":return n.stop()}},c)}));return function(){return h.apply(this,arguments)}}();return(0,a.jsxs)(y._Y,{hashed:!1,dark:Z,children:[(0,a.jsx)(Le,{}),(0,a.jsx)("div",{style:{backgroundColor:te.colorBgContainer,textAlign:"center",height:"100%",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:(0,a.jsxs)(ne.U,{form:$,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:Se(),title:xe(),subTitle:Ie(),actions:he&&!1,onFinish:function(){var h=u()(t()().mark(function c(i){var n,M;return t()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(console.log("login values:",i),C!=="account"){q.next=8;break}return n={username:i.username,password:i.password,captchaUid:f,captchaCode:i.captchaCode,platform:ae.iw},console.log("login info:",n),q.next=6,Fe(n);case 6:q.next=12;break;case 8:return M={mobile:i.mobile,code:i.code,captchaUid:f,captchaCode:i.captchaCode,platform:ae.iw},console.log("login mobile info:",M),q.next=12,Re(M);case 12:case"end":return q.stop()}},c)}));return function(c){return h.apply(this,arguments)}}(),children:[(0,a.jsx)(O.Z,{activeKey:C,onChange:X,centered:!0,items:P}),(0,a.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,a.jsxs)("div",{style:{float:"right",marginBottom:24},children:[he&&(0,a.jsx)(o.Link,{to:"/auth/register",children:(0,a.jsx)(o.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})}),(0,a.jsx)(o.Link,{style:{marginLeft:10},to:"https://www.weiyuai.cn/docs",target:"_blank",children:"\u5E2E\u52A9\u6587\u6863"})]})})]})})]})},Ae=function(){var s=(0,re.Z)(),D=s.isDarkMode;return(0,a.jsx)(Ke.w,{children:(0,a.jsx)(Y.ZP,{theme:{algorithm:D?Ue:Pe},children:(0,a.jsxs)(m.Z,{style:{height:"100%"},children:[(0,a.jsx)(l.ZP,{}),(0,a.jsx)(Oe,{})]})})})},ke=Ae},60247:function(me,R,e){e.d(R,{L:function(){return N}});var V=e(85615),p=e(73445),B=e(782),t=e(18753),N=(0,p.Ue)()((0,B.mW)((0,B.tJ)((0,t.n)(function(u,x){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(b){u({userInfo:b})},setDeviceUid:function(b){u({deviceUid:b})},deleteUserInfo:function(){return u({},!0)}}}),{name:V.Em})))}}]);
