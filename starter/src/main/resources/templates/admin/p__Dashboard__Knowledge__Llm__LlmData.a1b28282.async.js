"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4167],{99885:function(e,t,n){n.d(t,{Yg:function(){return x},kh:function(){return p},pf:function(){return d},y:function(){return m}});var r=n(90819),a=n.n(r),o=n(73193),s=n.n(o),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/query/org",{method:"GET",params:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/create",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/update",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/faq/delete",{method:"POST",data:s()(s()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},41606:function(e,t,n){n.r(t),n.d(t,{default:function(){return Oe}});var r=n(96865),a=n(75574),o=n(55735),s=n(8377),i=n(44194),u=n(8247),l=n(30921),c=n(73193),d=n.n(c),f=n(84176),p=n.n(f),g=n(90819),m=n.n(g),h=n(89933),x=n.n(h),v=n(45332),y=n.n(v),w=n(86803);function M(e){return b.apply(this,arguments)}function b(){return(b=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/file/query/org",{method:"GET",params:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/file/delete",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=n(76750),S=n(6397),I=n(40612),T=n(51239),Z=n(44521),D=n(73442),q=n(3849),F=n(75365),A=n(80601),Y=n(31549),E=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,C.Z)().translateString,o=(0,S.j)((function(e){return e.currentKbase})),s=(0,T.L)((function(e){return e.userInfo})),u=(0,I.u)((function(e){return e.currentOrg})),l=(0,i.useState)(""),c=y()(l,2),d=c[0],f=c[1],p=(0,i.useState)(!1),g=y()(p,2),m=g[0],h=g[1],x=function(){console.log("refresh"),h(!1);var e=(0,Z.Cn)()+"?org="+encodeURIComponent(null==u?void 0:u.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==o?void 0:o.uid)+"&uid="+encodeURIComponent(null==s?void 0:s.uid)+"&nickname="+encodeURIComponent(null==s?void 0:s.nickname)+"&avatar="+encodeURIComponent(null==s?void 0:s.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,i.useEffect)((function(){x()}),[o]);return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)(D.Z,{title:a(null==o?void 0:o.name),onClose:function(){r&&r()},open:n,extra:(0,Y.jsxs)(q.Z,{children:[(0,Y.jsx)(F.ZP,{onClick:function(){window.open(d)},children:"新窗口"}),(0,Y.jsx)(F.ZP,{onClick:function(){console.log("restart"),x()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,Y.jsx)(A.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,Y.jsx)("iframe",{id:"chat-iframe",src:d,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},P=n(90838),U=n(69114),O=n(11757),_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-left",theme:"outlined"},V=n(54183),N=function(e,t){return i.createElement(V.Z,(0,O.Z)({},e,{ref:t,icon:_}))};var R=i.forwardRef(N),Q=n(25482),B=n(72381),H=n(61355),z=n(28977),L=n.n(z),K=n(27650),G=["current"],W=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,Y.jsx)(l.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",render:function(e,t,n,r){var a,o;return null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")?null==t||null===(o=t.fileName)||void 0===o?void 0:o.split("_").slice(1).join("_"):null==t?void 0:t.fileName}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],J=function(){var e=(0,l.useIntl)(),t=(0,l.useNavigate)(),n=(0,i.useRef)(),r=(0,I.u)((function(e){return e.currentOrg})),a=(0,S.j)((function(e){return e.currentKbase})),s=(0,P.v)((function(e){return e.currentCategory})),u=(0,i.useState)(!1),c=y()(u,2),f=c[0],g=c[1],h=(0,i.useState)(!1),v=y()(h,2),b=v[0],k=v[1],C=function(){var t=x()(m()().mark((function t(r){var a;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,j(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=[].concat(W,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){var e=null==n?void 0:n.fileUrl,t=encodeURIComponent(e);window.open(decodeURIComponent(t))},children:e.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,Y.jsx)(H.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return C(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,i.useEffect)((function(){var e;null==n||null===(e=n.current)||void 0===e||e.reload()}),[a,s]),(0,i.useEffect)((function(){return U.Z.on(o.YwV,(function(e){var t;console.log("EVENT_BUS_MQTT_NOTICE",e),null==n||null===(t=n.current)||void 0===t||t.reload()})),function(){U.Z.off(o.YwV)}}),[]);var Z=(0,i.useMemo)((function(){return(null==a?void 0:a.type)!==o.QPQ||""===(null==a?void 0:a.uid)}),[a]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B.Z,{columns:T,actionRef:n,cardBordered:!0,request:function(){var e=x()(m()().mark((function e(t,n,a){var o,s,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,a),t.current,o=p()(t,G),s=d()({pageNumber:t.current-1,orgUid:null==r?void 0:r.uid},o),e.next=5,M(s);case 5:return i=e.sent,console.log("queryFilesByOrg response:",i,s),200===i.code||w.yw.error(i.message),e.abrupt("return",{data:i.data.content,success:!0,total:i.data.totalElements});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"文件拆分列表",toolBarRender:function(){return[(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(R,{}),type:"primary",onClick:function(){console.log("handleProcess"),t("/kb/upload/data")},disabled:Z,children:"查看文件上传列表"},"uploadList"),(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(Q.Z,{}),type:"primary",onClick:function(){return g(!0)},disabled:Z,children:e.formatMessage({id:"upload",defaultMessage:"File"})},"button")]}}),f&&(0,Y.jsx)(K.Z,{type:o.QPQ,acceptType:"*",isModalOpen:f,handleSubmit:function(e){console.log("handleFileDragSubmit",e),g(!1),null==n||n.current.reload()},handleCancel:function(){console.log("handleFileDragCancel"),g(!1),null==n||n.current.reload()}}),b&&(0,Y.jsx)(E,{type:o.xtN,open:b,onClose:function(){return k(!1)}})]})};function $(e){return X.apply(this,arguments)}function X(){return(X=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/query/org",{method:"GET",params:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/create",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/update",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return oe.apply(this,arguments)}function oe(){return(oe=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/delete",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se=n(15722),ie=n(53530),ue=n(51990),le=n(65461),ce=n(69169),de=n(4499),fe=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,o=e.onSubmit,s=ce.A.useForm(),u=y()(s,1)[0],l=(0,i.useState)(""),c=y()(l,2),f=c[0],p=c[1],g=(0,I.u)((function(e){return e.currentOrg}));return(0,i.useEffect)((function(){t?(u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content}),p((null==n?void 0:n.content)||"")):u.resetFields()}),[t,n,u]),(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(D.Z,{title:"标签",onClose:a,open:r,width:650,extra:(0,Y.jsxs)(q.Z,{children:[(0,Y.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(F.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=d()(d()({},e),{},{orgUid:null==g?void 0:g.uid});console.log("submit",t),o(t)}))},type:"primary",children:"保存"})]}),children:(0,Y.jsxs)(ce.A,{form:u,name:"tagForm",submitter:{render:function(){return null}},children:[(0,Y.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,Y.jsx)(ce.A.Item,{name:"answer",label:"回复",rules:[{required:!0,message:"请输入回复"}],children:(0,Y.jsx)(ue.Z,{placeholder:"answer..",value:f,toolbarKeys:(0,le.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){p(e)}})})]})})})},pe=["current"],ge=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,Y.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,render:function(e,t){return(0,Y.jsx)(Y.Fragment,{children:t.name})}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,render:function(e,t){return(0,Y.jsx)(Y.Fragment,{children:t.content})}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,r){return L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],me=function(){var e=(0,l.useIntl)(),t=(0,i.useRef)(),n=(0,I.u)((function(e){return e.currentOrg})),r=(0,i.useState)(!1),a=y()(r,2),o=a[0],s=a[1],u=(0,i.useState)({}),c=y()(u,2),f=c[0],g=c[1],h=(0,i.useState)(!1),v=y()(h,2),M=v[0],b=v[1],j=ie.Z.useModal(),k=y()(j,2),C=k[0],S=k[1],T=[].concat(ge,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){g(n),b(!0),s(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,Y.jsx)(F.ZP,{type:"link",onClick:function(){return t=n,void C.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(se.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){Z(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")]}}]),Z=function(){var n=x()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,ae(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):w.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),D=function(){var e=x()(m()().mark((function e(n){var r,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),s(!1)):w.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=x()(m()().mark((function e(n){var r,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==f?void 0:f.uid,e.next=3,ne(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),s(!1)):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){s(!0),b(!1),g({})};return(0,Y.jsxs)(Y.Fragment,{children:[o&&(0,Y.jsx)(fe,{isEdit:M,open:o,text:f,onClose:function(){s(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),M?q(e):D(e)}}),(0,Y.jsx)(B.Z,{columns:T,actionRef:t,cardBordered:!0,request:function(){var e=x()(m()().mark((function e(t,r,a){var o,s,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.current,o=p()(t,pe),s=d()({pageNumber:t.current-1,orgUid:null==n?void 0:n.uid},o),e.next=4,$(s);case 4:return i=e.sent,console.log("queryTextsByOrg response:",i,s),200===i.code||w.yw.error(i.message),e.abrupt("return",{data:i.data.content,success:!0,total:i.data.totalElements});case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"文本列表",toolBarRender:function(){return[(0,Y.jsx)(F.ZP,{type:"primary",icon:(0,Y.jsx)(Q.Z,{}),onClick:A,children:e.formatMessage({id:"create",defaultMessage:"Create"})})]}}),S]})};l.FormattedMessage,l.FormattedMessage,l.FormattedMessage,l.FormattedMessage,l.FormattedMessage;function he(e){return xe.apply(this,arguments)}function xe(){return(xe=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/split/query/org",{method:"GET",params:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e){return ye.apply(this,arguments)}function ye(){return(ye=x()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/split/delete",{method:"POST",data:d()(d()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=["current"],Me=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",width:200,render:function(e,t,n,r){var a,o;return null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")?null==t||null===(o=t.name)||void 0===o?void 0:o.split("_").slice(1).join("_"):null==t?void 0:t.name}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",render:function(e,t,n,r){var a;return(null==t||null===(a=t.content)||void 0===a?void 0:a.slice(0,100))+"..."}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return L()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],be=function(){var e=(0,l.useIntl)(),t=((0,l.useNavigate)(),(0,i.useRef)()),n=(0,I.u)((function(e){return e.currentOrg})),r=(0,S.j)((function(e){return e.currentKbase})),a=(0,P.v)((function(e){return e.currentCategory})),s=(0,i.useState)(!1),u=y()(s,2),c=u[0],f=u[1],g=(0,i.useState)(!1),h=y()(g,2),v=h[0],M=h[1],b=function(){var n=x()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,ve(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),j=[].concat(Me,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){},children:e.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,Y.jsx)(H.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return b(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[r,a]),(0,i.useEffect)((function(){return U.Z.on(o.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){U.Z.off(o.YwV)}}),[]);(0,i.useMemo)((function(){return(null==r?void 0:r.type)!==o.QPQ||""===(null==r?void 0:r.uid)}),[r]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B.Z,{columns:j,actionRef:t,cardBordered:!0,request:function(){var e=x()(m()().mark((function e(t,r,a){var o,s,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,r,a),t.current,o=p()(t,we),s=d()({pageNumber:t.current-1,orgUid:null==n?void 0:n.uid},o),e.next=5,he(s);case 5:return i=e.sent,console.log("querySplitsByOrg response:",i,s),200===i.code||w.yw.error(i.message),e.abrupt("return",{data:i.data.content,success:!0,total:i.data.totalElements});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:!1,rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"拆分列表",toolBarRender:function(){return[]}}),c&&(0,Y.jsx)(K.Z,{type:o.QPQ,acceptType:"*",isModalOpen:c,handleSubmit:function(e){console.log("handleSplitDragSubmit",e),f(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleSplitDragCancel"),f(!1),null==t||t.current.reload()}}),v&&(0,Y.jsx)(E,{type:o.xtN,open:v,onClose:function(){return M(!1)}})]})},je=n(99885),ke=n(30617),Ce=n(11090),Se=n(61107),Ie=n(29078),Te=function(e){var t=e.content,n=Ie.Z.sanitize(t,{ALLOWED_TAGS:["p","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","a","strong","em","b","i","img","blockquote","code","pre"],ALLOWED_ATTR:["href","target","src","alt","style","class"]});return(0,Y.jsx)("div",{className:"RichText",dangerouslySetInnerHTML:{__html:n}})},Ze=n(42085),De=n(84881),qe=n(44867),Fe=function(e){var t=e.isEdit,n=e.faq,r=e.open,a=e.onClose,s=e.onSubmit,u=ce.A.useForm(),l=y()(u,1)[0],c=(0,i.useState)(""),f=y()(c,2),p=f[0],g=f[1],m=(0,I.u)((function(e){return e.currentOrg})),h=(0,S.j)((function(e){return e.currentKbase})),x=(0,P.v)((function(e){return e.categorySelectOptions})),v=(0,i.useState)(),M=y()(v,2),b=M[0],j=M[1],k=(0,i.useState)(o.PYi),C=y()(k,2),T=C[0],A=C[1],E=(0,i.useState)(".png,.jpg,.jpeg"),U=y()(E,2),O=(U[0],U[1]),_=(0,i.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==h?void 0:h.uid)||"",client:o.bVn}),V=y()(_,2),N=V[0];V[1];(0,i.useEffect)((function(){t?(l.setFieldsValue({type:null==n?void 0:n.type,title:null==n?void 0:n.question,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==h?void 0:h.uid}),g(null==n?void 0:n.answer)):l.resetFields()}),[n]);var R={name:"file",action:(0,Z.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:N,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var t=L()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;N.file=e,N.file_name=t,N.file_type=e.type,N.kb_type=o.YjS,N.category_uid=b||"",N.kb_uid=null==h?void 0:h.uid,console.log("beforeUpload",N)},onChange:function(e){if("uploading"===e.file.status&&w.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;g(t),w.yw.destroy(),w.yw.success("".concat(e.file.name," 上传成功"))}else w.yw.destroy(),w.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&w.yw.error("".concat(e.file.name," 上传失败"))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(D.Z,{title:t?"修改":"新建",width:650,onClose:a,open:r,extra:(0,Y.jsxs)(q.Z,{children:[(0,Y.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(F.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){console.log(e),s(d()(d()(d()({},n),e),{},{kbUid:null==h?void 0:h.uid,orgUid:null==m?void 0:m.uid,answer:p}))})).catch((function(e){console.log("Form errors:",e),w.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,Y.jsxs)(ce.A,{form:l,submitter:{render:function(){return null}},children:[(0,Y.jsx)(De.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:x,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),j(e)}}}),(0,Y.jsx)(De.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],options:[{label:"文本",value:o.PYi},{label:"图片",value:o.Qm},{label:"视频",value:o.tVi},{label:"音频",value:o.Yu1},{label:"文件",value:o.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),A(e),e===o.Qm?O(".png,.jpg,.jpeg,.gif,.bmp"):e===o.tVi?O(".mp4,.avi,.mov,.wmv"):e===o.Yu1?O(".mp3,.wav,.flac"):e===o.Qn&&O(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,Y.jsx)(de.Z,{label:"标题",name:"question",rules:[{required:!0,message:"请输入标题"}]}),(0,Y.jsx)(ce.A.Item,{name:"answer",label:"回复",rules:[{required:!0,message:"请输入回复"}],children:(0,Y.jsx)(ue.Z,{placeholder:"answer..",value:p,toolbarKeys:(0,le.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){g(e)}})}),T!=o.PYi&&(0,Y.jsxs)(qe.Z,d()(d()({},R),{},{children:[(0,Y.jsx)("p",{className:"ant-upload-drag-icon",children:(0,Y.jsx)(Ze.Z,{})}),(0,Y.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽上传文件"})]}))]})})})},Ae=["current"],Ye=function(){var e=(0,l.useIntl)(),t=(0,i.useRef)(),n=(0,i.useState)(!0),r=y()(n,2),a=r[0],s=r[1],u=(0,i.useState)(),c=y()(u,2),f=c[0],g=c[1],h=(0,i.useState)(!1),v=y()(h,2),M=v[0],b=v[1],j=(0,I.u)((function(e){return e.currentOrg})),k=(0,S.j)((function(e){return e.currentKbase})),C=(0,P.v)((function(e){return e.currentCategory})),T=(0,i.useState)(!1),D=y()(T,2),q=D[0],A=D[1],E=function(){var n=x()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,(0,je.Yg)(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),U=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.question",defaultMessage:"Question"}),dataIndex:"question",copyable:!0,fixed:"left",width:300},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.answer",defaultMessage:"Answer"}),dataIndex:"answer",width:400,render:function(e,t){return(0,Y.jsx)(Te,{content:null==t?void 0:t.answer})}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:100,render:function(t,n){return(0,Y.jsx)(Y.Fragment,{children:e.formatMessage({id:"faq.type.".concat(null==n?void 0:n.type.toLowerCase()),defaultMessage:null==n?void 0:n.type})})}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.updatedAt",defaultMessage:"Updated At"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return L()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){_(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,Y.jsx)(H.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return E(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.viewCount",defaultMessage:"Views"}),key:"viewCount",dataIndex:"viewCount",hideInSearch:!0,hideInTable:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.clickCount",defaultMessage:"Clicks"}),key:"clickCount",dataIndex:"clickCount",hideInSearch:!0,hideInTable:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.upCount",defaultMessage:"Likes"}),key:"upCount",dataIndex:"upCount",hideInSearch:!0,hideInTable:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.downCount",defaultMessage:"Dislikes"}),key:"downCount",dataIndex:"downCount",hideInSearch:!0,hideInTable:!0},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.isValid",defaultMessage:"Valid"}),key:"valid",dataIndex:"valid",hideInSearch:!0,hideInTable:!0,render:function(e,t){return(0,Y.jsx)(Y.Fragment,{children:t.valid?"有效":"无效"})}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.startDate",defaultMessage:"Start Date"}),key:"startDate",dataIndex:"startDate",hideInSearch:!0,hideInTable:!0,render:function(e,t){return t.startDate?L()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):""}},{title:(0,Y.jsx)(l.FormattedMessage,{id:"faq.endDate",defaultMessage:"End Date"}),key:"endDate",dataIndex:"endDate",hideInSearch:!0,hideInTable:!0,render:function(e,t){return t.endDate?L()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):""}}],O=function(){g(void 0),s(!1),b(!0)},_=function(e){g(e),s(!0),b(!0)},V=function(){var n=x()(m()().mark((function n(r){var o,s;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("handleSubmitDrawer",r),a?w.yw.loading(e.formatMessage({id:"updating"})):w.yw.loading(e.formatMessage({id:"creating"})),!a){n.next=8;break}return n.next=5,(0,je.y)(r);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,je.kh)(r);case 10:n.t0=n.sent;case 11:o=n.t0,console.log("createFaq response:",r,o),200===o.code?(w.yw.destroy(),w.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),b(!1),null===(s=t.current)||void 0===s||s.reloadAndRest()):(w.yw.destroy(),w.yw.error(o.message));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),N=function(){var e=x()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleImport"),A(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=x()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExport"),t=localStorage.getItem(o.LA8),window.open((0,Z.kG)()+"/api/v1/faq/export?categoryUid="+(null==C?void 0:C.uid)+"&kbUid="+(null==k?void 0:k.uid)+"&orgUid="+(null==j?void 0:j.uid)+"&pageNumber=0&pageSize=20&accessToken="+t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.reloadAndRest()}),[k,C]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B.Z,{columns:U,actionRef:t,cardBordered:!0,request:function(){var t=x()(m()().mark((function t(n,r,a){var o,s,i;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),w.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.current,o=p()(n,Ae),s=d()({pageNumber:n.current-1,categoryUid:"all"===C.uid?"":C.uid,kbUid:null==k?void 0:k.uid,orgUid:null==j?void 0:j.uid},o),t.next=6,(0,je.pf)(s);case 6:return i=t.sent,console.log("getAllFaqs response:",s,i),w.yw.destroy(),200===i.code||w.yw.error(i.message),t.abrupt("return",{data:i.data.content,success:!0,total:i.data.totalElements});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"常见问题",toolBarRender:function(){return[(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(Q.Z,{}),type:"primary",onClick:O,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"button"),(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(ke.Z,{}),type:"primary",onClick:N,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"button"),(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(Ce.Z,{}),type:"primary",onClick:R,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button"),(0,Y.jsx)(F.ZP,{icon:(0,Y.jsx)(Se.Z,{}),type:"link",onClick:function(){window.open("https://www.weiyuai.cn/download/excel/kbase_faq.xlsx")},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]},scroll:{x:1300},columnsState:{persistenceKey:"faq-table-columns",defaultValue:{viewCount:{show:!1},clickCount:{show:!1},upCount:{show:!1},downCount:{show:!1},valid:{show:!1},startDate:{show:!1},endDate:{show:!1}}}}),M&&(0,Y.jsx)(Fe,{isEdit:a,open:M,faq:f,onClose:function(){return b(!1)},onSubmit:V}),q&&(0,Y.jsx)(K.Z,{type:o.bE7,isModalOpen:q,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),A(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),A(!1),null==t||t.current.reload()}})]})},Ee=function(){var e=(0,l.useIntl)(),t=(0,i.useMemo)((function(){return[{key:"split",label:e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"}),children:(0,Y.jsx)(be,{})},{key:"file",label:e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,Y.jsx)(J,{})},{key:"faq",label:e.formatMessage({id:"pages.robot.kb.faq",defaultMessage:"FAQ"}),children:(0,Y.jsx)(Ye,{})},{key:"text",label:e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,Y.jsx)(me,{})}]}),[e]);return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(u.Z,{items:t})})},Pe=a.Z.Sider,Ue=a.Z.Content,Oe=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,Y.jsx)("div",{children:(0,Y.jsxs)(a.Z,{children:[(0,Y.jsx)(Pe,{style:t,children:(0,Y.jsx)(s.Z,{type:o.QPQ})}),(0,Y.jsx)(a.Z,{children:(0,Y.jsx)(Ue,{style:n,children:(0,Y.jsx)(Ee,{})})})]})})}}}]);