"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7960],{30617:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},i=n(54183),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},82669:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(11757),a=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},i=n(54183),s=function(e,t){return a.createElement(i.Z,(0,r.Z)({},e,{ref:t,icon:o}))};var u=a.forwardRef(s)},32350:function(e,t,n){var r=n(17082),a=n(73457),o=n(44194),i=n(87413),s=n(31549),u=["fieldProps","proFieldProps"],l=function(e,t){var n=e.fieldProps,o=e.proFieldProps,l=(0,a.Z)(e,u);return(0,s.jsx)(i.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:o},l))};t.Z=o.forwardRef(l)},2516:function(e,t,n){var r=n(17082),a=n(73457),o=n(44194),i=n(87413),s=n(31549),u=["fieldProps","request","params","proFieldProps"],l=function(e,t){var n=e.fieldProps,o=e.request,l=e.params,c=e.proFieldProps,d=(0,a.Z)(e,u);return(0,s.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:n,ref:t,request:o,params:l,filedConfig:{customLightMode:!0},proFieldProps:c},d))},c=o.forwardRef(l);t.Z=c},81924:function(e,t,n){n.d(t,{AM:function(){return d},E9:function(){return m},Rd:function(){return x},fA:function(){return g},ul:function(){return v}});var r=n(90819),a=n.n(r),o=n(73193),i=n.n(o),s=n(89933),u=n.n(s),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/query/super",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/role/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},73669:function(e,t,n){n.d(t,{D$:function(){return m},EP:function(){return v},hS:function(){return g},z_:function(){return d}});var r=n(90819),a=n.n(r),o=n(73193),i=n.n(o),s=n(89933),u=n.n(s),l=n(55735),c=n(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17220:function(e,t,n){n(44194);var r=n(75365),a=n(54881),o=n(30921),i=n(31549);t.Z=function(e){var t,n,s=e.file,u=e.onDelete,l=e.showDelete,c=void 0===l||l,d=(0,o.useIntl)();return(0,i.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:d.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[c&&(0,i.jsx)(r.ZP,{type:"text",size:"small",icon:(0,i.jsx)(a.Z,{}),onClick:function(){return u(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,i.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(n=s.fileType)&&void 0!==n&&n.startsWith("image/")?(0,i.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,n){var r=n(76711),a=n.n(r),o=n(73193),i=n.n(o),s=n(45332),u=n.n(s),l=n(44194),c=n(42085),d=n(30348),f=n(53530),m=n(28977),p=n.n(m),g=n(55735),h=n(86803),v=n(44521),b=n(17220),x=n(30921),y=n(6397),w=n(31549),M=d.Z.Dragger;t.Z=function(e){var t=e.type,n=(e.acceptType,e.isModalOpen),r=e.attachments,o=e.handleSubmit,s=e.handleCancel,d=(0,x.useIntl)(),m=(0,y.j)((function(e){return e.currentKbase})),j=(0,l.useState)([]),k=u()(j,2),R=k[0],D=k[1],S=(0,l.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==m?void 0:m.uid,client:g.bVn}),Z=u()(S,2),C=Z[0],P=Z[1];(0,l.useEffect)((function(){console.log("UploadDrag currentKbase",m),m&&P((function(e){return i()(i()({},e),{},{kb_uid:null==m?void 0:m.uid})}))}),[m]);var F=(0,l.useMemo)((function(){return{name:"file",multiple:!0,action:(0,v.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(g.LA8)},data:C,showUploadList:!1,beforeUpload:function(e){var t=p()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return P((function(n){return i()(i()({},n),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&h.yw.loading(d.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(h.yw.destroy(),h.yw.success(d.formatMessage({id:"upload.success"},{filename:e.file.name})),D((function(t){return[].concat(a()(t),[e.file.response.data])}))):(h.yw.destroy(),h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&h.yw.error(d.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[C,d]);(0,l.useEffect)((function(){P((function(e){return i()(i()({},e),{},{kb_type:t,category_uid:""})})),r&&D(r.map((function(e){return e.upload})))}),[t]);var T=function(e){console.log("handleDelete",e),D((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,w.jsxs)(f.Z,{title:d.formatMessage({id:"upload.modal.title"}),open:n,onOk:function(){o(R)},onCancel:s,children:[(0,w.jsxs)(M,i()(i()({},F),{},{children:[(0,w.jsx)("p",{className:"ant-upload-drag-icon",children:(0,w.jsx)(c.Z,{})}),(0,w.jsx)("p",{className:"ant-upload-text",children:d.formatMessage({id:"upload.drag.text"})}),(0,w.jsx)("p",{className:"ant-upload-hint",children:d.formatMessage({id:"upload.drag.hint"})})]})),(0,w.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:R.map((function(e){return(0,w.jsx)(b.Z,{file:e,onDelete:T},e.uid)}))})})]})}},96865:function(e,t,n){var r=n(23864);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},76750:function(e,t,n){var r=n(55735),a=n(65461),o=n(30921);t.Z=function(){var e=(0,o.useIntl)();return{translateString:function(t){return null==t?t:t&&t.startsWith(r.VoP)?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},53627:function(e,t,n){n.r(t),n.d(t,{default:function(){return he}});var r=n(75574),a=n(44194),o=n(96865),i=n(73193),s=n.n(i),u=n(84176),l=n.n(u),c=n(90819),d=n.n(c),f=n(89933),m=n.n(f),p=n(45332),g=n.n(p),h=n(73669),v=n(86222),b=n.n(v),x=n(76711),y=n.n(x),w=n(55735),M=n(44435),j=n(83642),k=n(83890),R=(0,M.Ue)()((0,j.mW)((0,j.tJ)((0,k.n)((function(e,t){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:w.zBg,nickname:w.zBg},insertDepartment:function(t){e((function(e){var n=e.departmentResult.data.content;if(t.parentUid){var r=n.find((function(e){return e.uid===t.parentUid}));r&&(r.children||(r.children=[]),r.children.push(t))}else n.push(t)}))},upgradeDepartment:function(t){e((function(e){var n=e.departmentResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:n.forEach((function(e){if(e.children){var n=e.children.findIndex((function(e){return e.uid===t.uid}));-1!==n&&(e.children[n]=t)}}))}))},setDepartmentResult:function(n){var r,a={uid:w.zBg,name:w.zBg};(e({departmentResult:s()(s()({},n),{},{data:{content:[a].concat(y()(n.data.content))}})}),""===t().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=t().departmentResult.data.content,a=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==a){var o=[].concat(y()(r.slice(0,a)),[n],y()(r.slice(a+1))),i=s()(s()({},t().departmentResult),{},{data:{content:o}});e({departmentResult:i,currentDepartment:n})}else console.warn("Department with the specified uid not found."),e({currentDepartment:n})},removeDepartment:function(n){e((function(e){var t=e.departmentResult.data.content;e.departmentResult.data.content=function e(t,n){return t.filter((function(t){return t.uid!==n&&(t.children&&(t.children=e(t.children,n)),!0)}))}(t,n)})),t().currentDepartment.uid===n&&e({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,a,o=null===(r=t().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(e){return e.uid===n}));if(o)e({currentDepartment:o});else{!function t(r){var a,o=b()(r);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(i.uid===n)return void e({currentDepartment:i});i.children&&i.children.length>0&&t(i.children)}}catch(e){o.e(e)}finally{o.f()}}((null===(a=t().departmentResult)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.content)||[])}},deleteDepartmentCache:function(){return e({},!0)}}})),{name:w.xY_}))),D=n(40612),S=n(15722),Z=n(25482),C=n(30617),P=n(11090),F=n(61107),T=n(81947),U=n(53530),E=n(29266),q=n(75365),z=n(69169),I=n(2516),N=n(4499),O=n(84881),V=n(30921),K=n(73442),_=n(3849),B=n(86803),W=n(81924),A=n(78488),H=n(76750),L=n(31549),Y=function(e){var t=e.isEdit,n=e.member,r=e.open,o=e.onClose,i=e.onSubmit,s=z.A.useForm(),u=g()(s,1)[0],l=(0,V.useIntl)(),c=(0,H.Z)().translateString,f=R((function(e){return e.departmentResult})),p=(0,D.u)((function(e){return e.currentOrg})),h=(0,a.useState)([]),v=g()(h,2),b=v[0],x=v[1],y=(0,A.Z)((function(e){return{roleResult:e.roleResult,setRoleResult:e.setRoleResult}})),M=y.setRoleResult,j=y.roleResult;(0,a.useEffect)((function(){t&&n&&u?u.setFieldsValue({uid:null==n?void 0:n.uid,nickname:null==n?void 0:n.nickname,email:null==n?void 0:n.email,mobile:null==n?void 0:n.mobile,jobNo:null==n?void 0:n.jobNo,jobTitle:c(null==n?void 0:n.jobTitle),seatNo:null==n?void 0:n.seatNo,telephone:null==n?void 0:n.telephone,deptUid:null==n?void 0:n.deptUid}):(console.log("form resetFields"),u.resetFields())}),[n]);var k=function e(t,n){if(t.name.startsWith(w.VoP)?n.title=l.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name,n.value=t.uid,t.children)for(var r=0;r<t.children.length;r++){var a={title:"",value:"",children:[]};e(t.children[r],a),n.children.push(a)}},S=(0,a.useMemo)((function(){for(var e=[],t=0;t<f.data.content.length;t++)if(f.data.content[t].name!==w.zBg){var n={title:"",value:"",children:[]};k(f.data.content[t],n),e.push(n)}return e}),[f]),Z=function(){var e=m()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B.yw.loading("正在获取角色列表..."),t={pageNumber:0,pageSize:100,orgUid:null==p?void 0:p.uid},e.next=4,(0,W.E9)(t);case 4:n=e.sent,console.log("queryRolesByOrg response ",n),200===n.code?(B.yw.destroy(),M(n)):(B.yw.destroy(),B.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){var e,t=(null==n||null===(e=n.roleUids)||void 0===e?void 0:e.filter((function(e){return""!==e})))||[];x(t)}),[n]),(0,a.useEffect)((function(){Z()}),[]);var C="df_mb_uid"===(null==n?void 0:n.uid);return(0,L.jsx)("div",{children:(0,L.jsx)(K.Z,{title:t?(0,L.jsx)(V.FormattedMessage,{id:"team.member.drawer.edit.title"}):(0,L.jsx)(V.FormattedMessage,{id:"team.member.drawer.create.title"}),onClose:o,open:r,width:600,extra:(0,L.jsxs)(_.Z,{children:[(0,L.jsx)(q.ZP,{onClick:o,children:(0,L.jsx)(V.FormattedMessage,{id:"team.member.drawer.button.cancel"})}),(0,L.jsx)(q.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:null==n?void 0:n.uid,nickname:e.nickname,email:e.email,mobile:e.mobile,jobNo:e.jobNo,jobTitle:e.jobTitle,seatNo:e.seatNo,telephone:e.telephone,deptUid:e.deptUid,orgUid:null==p?void 0:p.uid,roleUids:b};console.log("memberObject:",t),i(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:(0,L.jsx)(V.FormattedMessage,{id:"team.member.drawer.button.save"})})]}),children:(0,L.jsxs)(z.A,{form:u,name:"memForm",submitter:!1,children:[(0,L.jsx)(I.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.department"}),name:"deptUid",width:"md",placeholder:l.formatMessage({id:"team.member.form.department.placeholder"}),allowClear:!0,rules:[{required:!0,message:l.formatMessage({id:"team.member.form.department.required"})}],fieldProps:{treeDefaultExpandAll:!0,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:S,variant:"outlined"}}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.name"}),name:"nickname",rules:[{required:!0,message:l.formatMessage({id:"team.member.form.name.required"})}]}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.mobile"}),name:"mobile",disabled:t,rules:[{required:!0,message:l.formatMessage({id:"team.member.form.mobile.required"})},{pattern:/^1[3456789]\d{9}$/,message:l.formatMessage({id:"team.member.form.mobile.invalid"})}]}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.email"}),name:"email",disabled:t,rules:[{required:!0,message:l.formatMessage({id:"team.member.form.email.required"})},{type:"email",message:l.formatMessage({id:"team.member.form.email.invalid"})}]}),C&&(0,L.jsx)("p",{children:"超级管理员拥有所有权限，禁止编辑角色"}),(0,L.jsx)(O.Z,{name:"roleUids",label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.role"}),width:"md",disabled:C,options:j.data.content.map((function(e){return{value:e.uid,label:e.name}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:l.formatMessage({id:"team.member.form.role.placeholder"}),value:b,onChange:function(e){console.log("selected ".concat(e));var t=e.filter((function(e){return""!==e}));x(t)}}}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.jobNo"}),name:"jobNo"}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.jobTitle"}),name:"jobTitle"}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.seatNo"}),name:"seatNo"}),(0,L.jsx)(N.Z,{label:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.telephone"}),name:"telephone"}),(0,L.jsx)("p",{children:(0,L.jsx)(V.FormattedMessage,{id:"team.member.form.login.tip"})})]})})})},G=n(44521),J=n(27650),$=["current","pageSize"],Q=function(){var e,t=(0,a.useRef)(),n=(0,V.useIntl)(),r=(0,a.useRef)(!1),o=(0,H.Z)().translateString,i=(0,a.useState)(!0),u=g()(i,2),c=u[0],f=u[1],p=(0,a.useState)(1),v=g()(p,2),b=v[0],x=v[1],y=(0,a.useState)(10),M=g()(y,2),j=M[0],k=M[1],z=(0,a.useState)(),I=g()(z,2),N=I[0],O=I[1],K=(0,a.useState)(!1),_=g()(K,2),W=_[0],A=_[1],Q=(0,D.u)((function(e){return e.currentOrg})),X=R((function(e){return e.currentDepartment})),ee=U.Z.useModal(),te=g()(ee,2),ne=te[0],re=te[1],ae=(0,a.useState)(!1),oe=g()(ae,2),ie=oe[0],se=oe[1],ue=R((function(e){return e.departmentResult})),le=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,L.jsx)(V.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"nickname"},{title:(0,L.jsx)(V.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",render:function(e,t){return(0,L.jsx)("a",{href:"mailto:".concat(t.email),children:e})}},{title:(0,L.jsx)(V.FormattedMessage,{id:"department",defaultMessage:"Department"}),dataIndex:"deptUid",valueType:"select",fieldProps:{options:(null==ue||null===(e=ue.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return{label:o(e.name),value:e.uid===w.zBg?"":e.uid}})))||[]},render:function(e,t){var n=ue.data.content.find((function(e){return e.uid===t.deptUid}));return n?(0,L.jsx)(E.Z,{children:o(n.name)}):""}},{title:(0,L.jsx)(V.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",render:function(e,t){return(0,L.jsx)("a",{href:"tel:".concat(t.mobile),children:t.mobile})}},{title:(0,L.jsx)(V.FormattedMessage,{id:"jobNo",defaultMessage:"JobNum"}),dataIndex:"jobNo"},{title:(0,L.jsx)(V.FormattedMessage,{id:"jobTitle",defaultMessage:"jobTitle"}),dataIndex:"jobTitle",hideInSearch:!0,render:function(e,t){return(0,L.jsx)(L.Fragment,{children:o(null==t?void 0:t.jobTitle)})}}],ce=function(){var e=m()(d()().mark((function e(r){var a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete mem:",r),e.next=3,(0,h.EP)(r);case 3:a=e.sent,console.log("deleteMember:",a),200===a.code?(B.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):B.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){A(!1)},fe=[].concat(le,[{title:n.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",render:function(e,t,r,a){return[(0,L.jsx)("a",{onClick:function(){console.log("editable:",t),function(e){O(e),f(!0),A(!0)}(t)},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,L.jsx)(q.ZP,{type:"link",onClick:function(){return e=t,void ne.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,L.jsx)(S.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.nickname,"】？"),onOk:function(){ce(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e},danger:!0,children:n.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")]}}]);(0,a.useEffect)((function(){console.log("currentDepDid:",X),t.current.reload()}),[X]);var me,pe=function(){var e=m()(d()().mark((function e(r){var a,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!c){e.next=9;break}return e.next=4,(0,h.hS)(r);case 4:a=e.sent,console.log("updateMember:",a),200===a.code?(B.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),t.current.reload(),de()):B.yw.error(a.message),e.next=14;break;case 9:return e.next=11,(0,h.D$)(r);case 11:o=e.sent,console.log("createMember:",o),200===o.code?(B.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),t.current.reload(),de()):B.yw.error(o.message);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=m()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=m()(d()().mark((function e(){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",b,j),t=localStorage.getItem(w.LA8),window.open((0,G.kG)()+"/api/v1/member/export?"+new URLSearchParams({orgUid:(null==Q?void 0:Q.uid)||"",pageNumber:String(b-1),pageSize:String(j),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(T.Z,{columns:fe,actionRef:t,cardBordered:!0,request:function(){var e=m()(d()().mark((function e(t,n,a){var o,i,u,c,f;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("request:",t,n,a),!r.current){e.next=4;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 4:return r.current=!0,B.yw.loading("正在加载"),o=t.current,i=t.pageSize,u=l()(t,$),x(o),k(i),c=s()({pageNumber:o-1,pageSize:i,orgUid:null==Q?void 0:Q.uid,deptUid:(null==X?void 0:X.uid)===w.zBg?"":null==X?void 0:X.uid},u),e.next=12,(0,h.z_)(c);case 12:return f=e.sent,console.log("queryMembersByOrg:",c,f),200===f.code||B.yw.error(f.message),r.current=!1,B.yw.destroy(),e.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:j,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){console.log("pagination onChange:",e,t),x(e),k(t)}},headerTitle:null!=X&&null!==(me=X.name)&&void 0!==me&&me.startsWith("i18n.")?n.formatMessage({id:null==X?void 0:X.name,defaultMessage:null==X?void 0:X.name}):null==X?void 0:X.name,toolBarRender:function(){return[(0,L.jsx)(q.ZP,{icon:(0,L.jsx)(Z.Z,{}),onClick:function(){console.log("new"),O(void 0),f(!1),A(!0)},type:"primary",children:n.formatMessage({id:"create.member",defaultMessage:"Create Member"})},"button"),(0,L.jsx)(q.ZP,{icon:(0,L.jsx)(C.Z,{}),type:"primary",onClick:ge,children:n.formatMessage({id:"import",defaultMessage:"Import"})},"button"),(0,L.jsx)(q.ZP,{icon:(0,L.jsx)(P.Z,{}),type:"primary",onClick:he,children:n.formatMessage({id:"export",defaultMessage:"Export"})},"button"),(0,L.jsx)(q.ZP,{icon:(0,L.jsx)(F.Z,{}),type:"link",onClick:function(){(0,G.$E)()},children:n.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]}}),W&&(0,L.jsx)(Y,{isEdit:c,member:N,open:W,onClose:de,onSubmit:pe}),ie&&(0,L.jsx)(J.Z,{type:w.zey,acceptType:".xls,.xlsx,.csv,.*",isModalOpen:ie,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),se(!1),null==t||t.current.reload()},handleCancel:function(){console.log("handleUploadDragCancel"),se(!1),null==t||t.current.reload()}}),re]})},X=n(27487),ee=n(79777);function te(e){return ne.apply(this,arguments)}function ne(){return(ne=m()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,V.request)("/api/v1/department/query/org",{method:"GET",params:s()(s()({},t),{},{client:w.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return ae.apply(this,arguments)}function ae(){return(ae=m()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,V.request)("/api/v1/department/create",{method:"POST",data:s()(s()({},t),{},{client:w.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return ie.apply(this,arguments)}function ie(){return(ie=m()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,V.request)("/api/v1/department/update",{method:"POST",data:s()(s()({},t),{},{client:w.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return ue.apply(this,arguments)}function ue(){return(ue=m()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,V.request)("/api/v1/department/delete",{method:"POST",data:s()(s()({},t),{},{client:w.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=n(82669),ce=n(32350),de=n(16309),fe=function(e){var t=e.open,n=e.isEdit,r=e.department,o=e.onCancel,i=e.onSubmit,s=de.Z.useForm(),u=g()(s,1)[0],l=(0,V.useIntl)(),c=(0,a.useState)(""),f=g()(c,2),p=f[0],h=f[1],v=R((function(e){return e.departmentResult})),b=(0,D.u)((function(e){return e.currentOrg})),x=(0,H.Z)().translateString;(0,a.useEffect)((function(){t&&n?(u.setFieldsValue({uid:null==r?void 0:r.uid,parentUid:null==r?void 0:r.parentUid,name:x(null==r?void 0:r.name),description:null==r?void 0:r.description}),console.log("useEffect:",p)):u.resetFields()}),[t]);var y=function e(t,n){if(t.name.startsWith(w.VoP)?n.title=l.formatMessage({id:t.name,defaultMessage:t.name}):n.title=t.name,n.value=t.uid,t.children)for(var r=0;r<t.children.length;r++){e(t.children[r],{title:"",value:"",children:[]})}},M=(0,a.useMemo)((function(){for(var e=[],t=0;t<v.data.content.length;t++)if(v.data.content[t].name!==w.zBg){var n={title:"",value:"",children:[]};y(v.data.content[t],n),e.push(n)}return e}),[v]);return(0,L.jsx)("div",{children:(0,L.jsx)(U.Z,{title:"创建部门",open:t,forceRender:!0,onOk:function(){u.validateFields().then(function(){var e=m()(d()().mark((function e(t){var a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==r?void 0:r.uid:"",name:t.name,description:t.description,parentUid:p||void 0,orgUid:null==b?void 0:b.uid},console.log("handleSaveDep:",t,a),i(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),B.yw.error("创建部门失败")}))},onCancel:o,children:(0,L.jsxs)(z.A,{form:u,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,L.jsx)(I.Z,{label:"上级部门",name:"parentUid",allowClear:!0,fieldProps:{treeData:M,placeholder:"请选择上级部门(可选)",allowClear:!0,treeDefaultExpandAll:!0,onChange:function(e){console.log("onParentSelectChange:",e),h(e||"")},dropdownStyle:{maxHeight:400,overflow:"auto"}}}),(0,L.jsx)(N.Z,{label:"部门名称",name:"name",rules:[{required:!0,message:"请输入名称!"}]}),(0,L.jsx)(ce.Z,{label:"部门简介",name:"description"})]})})})},me=function(){var e=(0,V.useIntl)(),t=(0,a.useState)(!1),n=g()(t,2),r=n[0],o=n[1],i=(0,a.useState)(!1),s=g()(i,2),u=s[0],l=s[1],c=(0,D.u)((function(e){return e.currentOrg})),f=U.Z.useModal(),p=g()(f,2),h=p[0],v=p[1],b=R((function(e){return{currentDepartment:e.currentDepartment,departmentResult:e.departmentResult,insertDepartment:e.insertDepartment,upgradeDepartment:e.upgradeDepartment,removeDepartment:e.removeDepartment,setCurrentDepartment:e.setCurrentDepartment,setDepartmentResult:e.setDepartmentResult,setCurrentDepUid:e.setCurrentDepUid}})),x=b.currentDepartment,y=b.departmentResult,M=b.insertDepartment,j=b.upgradeDepartment,k=b.removeDepartment,Z=b.setCurrentDepartment,C=b.setDepartmentResult,P=b.setCurrentDepUid,F=function t(n,r){if(n.name.startsWith(w.VoP)?r.title=e.formatMessage({id:n.name,defaultMessage:n.name}):r.title=n.name,r.key=n.uid,n.children)for(var a=0;a<n.children.length;a++){var o={title:"",key:"",children:[]};t(n.children[a],o),r.children.push(o)}},T=(0,a.useMemo)((function(){for(var e=[],t=0;t<y.data.content.length;t++){var n={title:"",key:"",children:[]};F(y.data.content[t],n),e.push(n)}return e}),[y]),E=function(){var e=m()(d()().mark((function e(){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:50,orgUid:null==c?void 0:c.uid},e.next=3,te(t);case 3:n=e.sent,console.log("queryDepartmentsByOrg:",n),200===n.code?C(n):B.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){E()}),[]);var z=function(){var t=m()(d()().mark((function t(n){var r;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleCreateDept",n),B.yw.loading(e.formatMessage({id:"creating"})),t.next=4,re(n);case 4:r=t.sent,console.log("createDepartment:",r),200===r.code?(B.yw.destroy(),B.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),M(r.data),Z(r.data),o(!1)):(B.yw.destroy(),B.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=function(){var t=m()(d()().mark((function t(n){var r;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return B.yw.loading(e.formatMessage({id:"updating"})),t.next=3,oe(n);case 3:r=t.sent,console.log("handleUpdateDept:",n,r),200===r.code?(B.yw.destroy(),B.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),Z(r.data),j(r.data),o(!1)):(B.yw.destroy(),B.yw.error(r.message));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),N=function(){var t=m()(d()().mark((function t(n){var r;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleDeleteDept",n),B.yw.loading(e.formatMessage({id:"deleting"})),t.next=4,se(n);case 4:r=t.sent,console.log("handleDeleteDept:",r),200===r.code?(B.yw.destroy(),B.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),k(null==n?void 0:n.uid),o(!1)):(B.yw.destroy(),B.yw.error(r.message));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(X.Z,{gap:"small",wrap:"wrap",children:[(0,L.jsx)(q.ZP,{type:"primary",size:"small",icon:(0,L.jsx)(le.Z,{}),onClick:function(){console.log("new dep"),l(!1),o(!0)},children:e.formatMessage({id:"createDept",defaultMessage:"createDepartment"})}),(0,L.jsx)(q.ZP,{size:"small",onClick:function(){console.log("edit role"),l(!0),o(!0)},disabled:""===(null==x?void 0:x.uid),children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,L.jsx)(q.ZP,{onClick:function(){return t=x,void h.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,L.jsx)(S.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){N(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var t},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==x?void 0:x.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,L.jsx)(ee.Z,{defaultSelectedKeys:[null==x?void 0:x.uid],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&P(e[0].toString())},treeData:T,blockNode:!0}),r&&(0,L.jsx)(fe,{open:r,isEdit:u,department:x,onCancel:function(){o(!1)},onSubmit:function(e){u?I(e):z(e)}}),v]})},pe=r.Z.Sider,ge=r.Z.Content,he=function(){var e=(0,o.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,a=e.contentStyle;return(0,L.jsxs)(r.Z,{children:[(0,L.jsx)(pe,{width:n,style:t,children:(0,L.jsx)(me,{})}),(0,L.jsx)(r.Z,{children:(0,L.jsx)(ge,{style:a,children:(0,L.jsx)(Q,{})})})]})}},78488:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(73193),a=n.n(r),o=n(76711),i=n.n(o),s=n(55735),u=n(44435),l=n(83642),c=n(83890),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var n=e.roleResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(n){var r;(e({roleResult:n}),""===t().currentRole.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentRole:n.data.content[0]}))},setCurrentRole:function(n){var r=t().roleResult.data.content,o=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var s=[].concat(i()(r.slice(0,o)),[n],i()(r.slice(o+1))),u=a()(a()({},t().roleResult),{},{data:{content:s}});e({roleResult:u,currentRole:n})}else console.warn("Role with the specified uid not found."),e({currentRole:n})},removeRole:function(n){var r=t().roleResult.data.content,o=r.findIndex((function(e){return e.uid===n}));-1!==o?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(i()(r.slice(0,o)),i()(r.slice(o+1)))}})}):console.warn("Role not found in cache:",n),t().currentRole.uid===n&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:s.uaR})))},6397:function(e,t,n){n.d(t,{j:function(){return d}});var r=n(73193),a=n.n(r),o=n(76711),i=n.n(o),s=n(55735),u=n(44435),l=n(83642),c=n(83890),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var s=[].concat(i()(r.slice(0,o)),[n],i()(r.slice(o+1))),u=a()(a()({},t().kbaseResult),{},{data:{content:s}});e({kbaseResult:u,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n}));-1!==o?e({kbaseResult:a()(a()({},t().kbaseResult),{},{data:{content:[].concat(i()(r.slice(0,o)),i()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:s.wKE})))}}]);