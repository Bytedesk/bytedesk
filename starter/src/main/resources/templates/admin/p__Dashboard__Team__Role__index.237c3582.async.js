"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4325],{4499:function(e,n,t){var r=t(42601),o=t(17082),s=t(51190),i=t(46015),l=t(16309),a=t(98036),u=t(36490),c=t(44194),d=t(63554),f=t(31549),p=["fieldProps","proFieldProps"],m=["fieldProps","proFieldProps"],g="text",h=function(e){var n=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),t=(0,r.Z)(n,2),s=t[0],u=t[1];return(0,f.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(n){var t,r=n.getFieldValue(e.name||[]);return(0,f.jsx)(a.Z,(0,o.Z)((0,o.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(t=e.statusRender)||void 0===t?void 0:t.call(e,r),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var n=e.fieldProps,t=e.proFieldProps,r=(0,s.Z)(e,p);return(0,f.jsx)(d.Z,(0,o.Z)({valueType:g,fieldProps:n,filedConfig:{valueType:g},proFieldProps:t},r))};v.Password=function(e){var n=e.fieldProps,t=e.proFieldProps,i=(0,s.Z)(e,m),l=(0,c.useState)(!1),a=(0,r.Z)(l,2),p=a[0],v=a[1];return null!=n&&n.statusRender&&i.name?(0,f.jsx)(h,{name:i.name,statusRender:null==n?void 0:n.statusRender,popoverProps:null==n?void 0:n.popoverProps,strengthText:null==n?void 0:n.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(d.Z,(0,o.Z)({valueType:"password",fieldProps:(0,o.Z)((0,o.Z)({},(0,u.Z)(n,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var t;null==n||null===(t=n.onBlur)||void 0===t||t.call(n,e),v(!1)},onClick:function(e){var t;null==n||null===(t=n.onClick)||void 0===t||t.call(n,e),v(!0)}}),proFieldProps:t,filedConfig:{valueType:g}},i))})}):(0,f.jsx)(d.Z,(0,o.Z)({valueType:"password",fieldProps:n,proFieldProps:t,filedConfig:{valueType:g}},i))},v.displayName="ProFormComponent",n.Z=v},71121:function(e,n,t){t.d(n,{SA:function(){return d}});var r=t(90819),o=t.n(r),s=t(73193),i=t.n(s),l=t(89933),a=t.n(l),u=t(55735),c=t(30921);function d(e){return f.apply(this,arguments)}function f(){return(f=a()(o()().mark((function e(n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/authority/query/org",{method:"GET",params:i()(i()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1311:function(e,n,t){t.r(n),t.d(n,{default:function(){return L}});var r=t(96865),o=t(75574),s=t(44194),i=t(8247),l=t(73193),a=t.n(l),u=t(76711),c=t.n(u),d=t(90819),f=t.n(d),p=t(89933),m=t.n(p),g=t(45332),h=t.n(g),v=t(86803),y=t(71121),x=t(76750),Z=t(78488),w=t(62673),j=t(99749),R=t(38775),C=t(30921),P=t(81924),b=t(55735),k=t(31549),M={width:"20%",textAlign:"center"},O=function(){var e,n=(0,C.useIntl)(),t=(0,x.Z)().translateString,r=(0,Z.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole}})),o=r.upgradeRole,i=r.currentRole,l=r.setCurrentRole,u=(0,s.useState)([]),d=h()(u,2),p=d[0],g=d[1],O=(0,s.useState)(i.authorities),S=h()(O,2),F=S[0],T=S[1],E=function(){var e=m()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={pageNumber:0,pageSize:100,level:b.whQ},e.next=3,(0,y.SA)(n);case 3:t=e.sent,console.log("getAuthorities response",t),200===t.code?g(t.data.content):(console.log("getAuthorities error",t),v.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=p.reduce((function(e,n){var t=n.name.split("_"),r=h()(t,1)[0];return e[r]||(e[r]=[]),e[r].push(n),e}),{});(0,s.useEffect)((function(){T(i.authorities)}),[i.authorities]),(0,s.useEffect)((function(){E()}),[]);var I=function(e,n){var t=n?[].concat(c()(F),[e]):F.filter((function(n){return n.name!==e.name}));T(t),l(a()(a()({},i),{},{authorities:t})),N(a()(a()({},i),{},{authorities:t}))},N=function(){var e=m()(f()().mark((function e(t){var r,s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",r),v.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,P.ul)(r);case 5:s=e.sent,console.log("updateRole:",s),200===s.code?(v.yw.destroy(),v.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),o(s.data)):(v.yw.destroy(),v.yw.error(s.message));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(w.Z,{title:"已选权限",children:null==i||null===(e=i.authorities)||void 0===e?void 0:e.map((function(e,n){return(0,k.jsx)(w.Z.Grid,{style:M,children:(0,k.jsx)(j.Z,{checked:null==F?void 0:F.some((function(n){return n.name===e.name})),onChange:function(n){return I(e,n.target.checked)},children:t(e.name)})},n)}))}),(0,k.jsx)(R.Z,{children:"备选权限"}),Object.keys(A).map((function(e){return(0,k.jsx)(w.Z,{title:t(e),style:{marginTop:10},children:A[e].map((function(e){return(0,k.jsx)(w.Z.Grid,{style:M,children:(0,k.jsx)(j.Z,{checked:null==F?void 0:F.some((function(n){return n.name===e.name})),onChange:function(n){return I(e,n.target.checked)},disabled:""===(null==i?void 0:i.uid),children:t(e.name)})},e.name)}))},e)}))]})},S=function(e){console.log(e)},F=[{key:"authority",label:"权限",children:(0,k.jsx)(O,{})}],T=function(){return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(i.Z,{defaultActiveKey:"1",items:F,onChange:S})})},E=t(40612),A=t(53530),I=t(27487),N=t(75365),U=t(9452),q=t(23864),z=t(15722),$=t(82669),B=t(69169),D=t(4499),G=t(32350),V=t(16309),W=function(e){var n=e.open,t=e.isEdit,r=e.role,o=e.onCancel,i=e.onSubmit,l=V.Z.useForm(),a=h()(l,1)[0],u=(0,E.u)((function(e){return e.currentOrg}));(0,s.useEffect)((function(){t?a.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,description:null==r?void 0:r.description}):a.resetFields()}),[t,r]);return(0,k.jsx)("div",{children:(0,k.jsx)(A.Z,{title:"创建角色",open:n,forceRender:!0,onOk:function(){a.validateFields().then(function(){var e=m()(f()().mark((function e(n){var o;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={uid:t?null==r?void 0:r.uid:"",name:n.name,description:n.description,authorityUids:[],orgUid:null==u?void 0:u.uid},console.log("handleSaveRole:",n,o),i(o);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),v.yw.error("创建角色失败")}))},onCancel:o,children:(0,k.jsxs)(B.A,{form:a,name:"depForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,k.jsx)(D.Z,{label:"角色名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:function(e){}}}),(0,k.jsx)(G.Z,{label:"角色简介",name:"description",placeholder:"请输入角色简介",rules:[{required:!0,message:"角色简介是必填项"}],fieldProps:{onPressEnter:function(){a.submit()},autoSize:{minRows:2,maxRows:6}}})]})})})},_=function(){var e=(0,C.useIntl)(),n=(0,q.Z)().isDarkMode,t=A.Z.useModal(),r=h()(t,2),o=r[0],i=r[1],l=(0,x.Z)().translateStringTranct,a=(0,s.useState)(!1),u=h()(a,2),c=u[0],d=u[1],p=(0,s.useState)(!1),g=h()(p,2),y=g[0],w=g[1],j=(0,E.u)((function(e){return e.currentOrg})),R=(0,Z.Z)((function(e){return{roleResult:e.roleResult,setRoleResult:e.setRoleResult,insertRole:e.insertRole,upgradeRole:e.upgradeRole,currentRole:e.currentRole,removeRole:e.removeRole,setCurrentRole:e.setCurrentRole}})),b=R.roleResult,M=R.setRoleResult,O=R.insertRole,S=R.upgradeRole,F=R.removeRole,T=R.currentRole,B=R.setCurrentRole,D=function(){var e=m()(f()().mark((function e(){var n,t;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.yw.loading("正在获取角色列表..."),n={pageNumber:0,pageSize:100,orgUid:null==j?void 0:j.uid},e.next=4,(0,P.E9)(n);case 4:t=e.sent,console.log("queryRolesByOrg response ",t),200===t.code?(v.yw.destroy(),M(t)):(v.yw.destroy(),v.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){D()}),[]);var G=function(){var n=m()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("createRole",t),v.yw.loading(e.formatMessage({id:"creating"})),n.next=4,(0,P.fA)(t);case 4:r=n.sent,console.log("createRole:",r),200===r.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),O(r.data),d(!1)):(v.yw.destroy(),v.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),V=function(){var n=m()(f()().mark((function n(t){var r,o,s;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,authorityUids:(null==t||null===(r=t.authorities)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]},v.yw.loading(e.formatMessage({id:"updating"})),n.next=4,(0,P.ul)(o);case 4:s=n.sent,console.log("updateRole:",o,s),200===s.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"update.success",defaultMessage:"update success"})),S(s.data),d(!1)):(v.yw.destroy(),v.yw.error(s.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),_=function(){var n=m()(f()().mark((function n(t){var r;return f()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteRole",t),v.yw.loading(e.formatMessage({id:"deleting"})),n.next=4,(0,P.Rd)(t);case 4:r=n.sent,console.log("updateRole:",r),200===r.code?(v.yw.destroy(),v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"delete success"})),F(r.data.uid),d(!1)):(v.yw.destroy(),v.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(I.Z,{gap:"small",wrap:"wrap",children:[(0,k.jsx)(N.ZP,{type:"primary",size:"small",icon:(0,k.jsx)($.Z,{}),onClick:function(){console.log("new role"),w(!1),d(!0)},children:e.formatMessage({id:"create",defaultMessage:"Create"})}),(0,k.jsx)(N.ZP,{size:"small",onClick:function(){console.log("edit role"),w(!0),d(!0)},disabled:""===(null==T?void 0:T.uid),children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,k.jsx)(N.ZP,{onClick:function(){return function(n){o.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,k.jsx)(z.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){_(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(T)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==T?void 0:T.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,k.jsx)(U.Z,{dataSource:b.data.content,renderItem:function(e,t){return(0,k.jsx)(U.Z.Item,{style:T.uid===e.uid?{backgroundColor:n?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){B(e)},children:(0,k.jsx)(U.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,k.jsx)(k.Fragment,{children:l(e.name)})})},e.uid)}}),c&&(0,k.jsx)(W,{open:c,isEdit:y,role:T,onCancel:function(){d(!1)},onSubmit:function(e){y?V(e):G(e)}}),i]})},Q=o.Z.Sider,K=o.Z.Content,L=function(){var e=(0,r.Z)().leftSiderStyle;return(0,k.jsxs)(o.Z,{children:[(0,k.jsx)(Q,{style:e,children:(0,k.jsx)(_,{})}),(0,k.jsx)(o.Z,{children:(0,k.jsx)(K,{children:(0,k.jsx)(T,{})})})]})}},53530:function(e,n,t){t.d(n,{Z:function(){return w}});var r=t(18960),o=t(31695),s=t(27710),i=t(44194),l=t(51865),a=t.n(l),u=t(24255),c=t(43037),d=t(37167),f=t(30829),p=t(78660),m=t(59348),g=t(6750),h=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t};var v=(0,c.i)((e=>{const{prefixCls:n,className:t,closeIcon:r,closable:o,type:s,title:l,children:c,footer:v}=e,y=h(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:x}=i.useContext(d.E_),Z=x(),w=n||x("modal"),j=(0,f.Z)(Z),[R,C,P]=(0,g.ZP)(w,j),b=`${w}-confirm`;let k={};return k=s?{closable:null!=o&&o,title:"",footer:"",children:i.createElement(p.O,Object.assign({},e,{prefixCls:w,confirmPrefixCls:b,rootPrefixCls:Z,content:c}))}:{closable:null==o||o,title:l,footer:null!==v&&i.createElement(m.$,Object.assign({},e)),children:c},R(i.createElement(u.s,Object.assign({prefixCls:w,className:a()(C,`${w}-pure-panel`,s&&b,s&&`${b}-${s}`,t,P,j)},y,{closeIcon:(0,m.b)(w,r),closable:o},k)))})),y=t(75807);function x(e){return(0,r.ZP)((0,r.uW)(e))}const Z=s.Z;Z.useModal=y.Z,Z.info=function(e){return(0,r.ZP)((0,r.cw)(e))},Z.success=function(e){return(0,r.ZP)((0,r.vq)(e))},Z.error=function(e){return(0,r.ZP)((0,r.AQ)(e))},Z.warning=x,Z.warn=x,Z.confirm=function(e){return(0,r.ZP)((0,r.Au)(e))},Z.destroyAll=function(){for(;o.Z.length;){const e=o.Z.pop();e&&e()}},Z.config=r.ai,Z._InternalPanelDoNotUseOrYouWillBeFired=v;var w=Z}}]);