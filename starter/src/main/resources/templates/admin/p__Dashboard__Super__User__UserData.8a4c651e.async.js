"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3088],{81924:function(e,t,r){r.d(t,{E9:function(){return c},Rd:function(){return y},fA:function(){return g},ul:function(){return p}});var n=r(90819),a=r.n(n),s=r(73193),o=r.n(s),u=r(89933),i=r.n(u),l=r(55735),d=r(30921);function c(e){return f.apply(this,arguments)}function f(){return(f=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=i()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:o()(o()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},76750:function(e,t,r){var n=r(55735),a=r(65461),s=r(30921);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},95104:function(e,t,r){r.r(t),r.d(t,{default:function(){return Y}});var n=r(73193),a=r.n(n),s=r(84176),o=r.n(s),u=r(90819),i=r.n(u),l=r(89933),d=r.n(l),c=r(45332),f=r.n(c),g=r(86803),m=r(67318),p=r(81924),h=r(10162),y=r(11090),M=r(81947),x=r(29266),v=r(3849),R=r(38775),b=r(61355),w=r(75365),j=r(44194),k=r(40612),C=r(69169),S=r(4499),P=r(48708),I=r(16309),Z=r(73442),U=r(30921),F=r(31549),A=function(e){var t=e.isEdit,r=e.user,n=e.open,s=e.onClose,o=e.onSubmit,u=I.Z.useForm(),i=f()(u,1)[0],l=(0,U.useIntl)(),d=(0,k.u)((function(e){return e.currentOrg}));(0,j.useEffect)((function(){t?i.setFieldsValue({username:null==r?void 0:r.username,nickname:null==r?void 0:r.nickname,email:null==r?void 0:r.email,emailVerified:null==r?void 0:r.emailVerified,mobile:null==r?void 0:r.mobile,mobileVerified:null==r?void 0:r.mobileVerified,enabled:null==r?void 0:r.enabled}):(i.resetFields(),i.setFieldsValue({enabled:!0}))}),[n]);return(0,F.jsx)(Z.Z,{title:t?(0,F.jsx)(U.FormattedMessage,{id:"pages.user.edit",defaultMessage:"Edit User"}):(0,F.jsx)(U.FormattedMessage,{id:"pages.user.create",defaultMessage:"Create User"}),onClose:s,open:n,width:600,extra:(0,F.jsxs)(v.Z,{children:[(0,F.jsx)(w.ZP,{onClick:s,children:(0,F.jsx)(U.FormattedMessage,{id:"pages.common.cancel"})}),(0,F.jsx)(w.ZP,{onClick:function(){i.validateFields().then((function(e){null==r||!r.superUser||!1!==e.enabled&&!1!==e.mobileVerified&&!1!==e.emailVerified?o(a()(a()(a()({},r),e),{},{orgUid:null==d?void 0:d.uid})):g.yw.error(l.formatMessage({id:"pages.user.superUser.notAllow"}))})).catch((function(e){console.log("Form errors:",e),g.yw.error(l.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,F.jsx)(U.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,F.jsxs)(C.A,{form:i,submitter:!1,children:[(0,F.jsx)(S.Z,{name:"username",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.username"}),rules:[{required:!0,message:l.formatMessage({id:"pages.user.username.required"})}],disabled:t}),(0,F.jsx)(S.Z,{name:"nickname",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.nickname"}),rules:[{required:!0,message:l.formatMessage({id:"pages.user.nickname.required"})}]}),(0,F.jsx)(S.Z,{name:"email",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.email"}),rules:[{required:!0,message:l.formatMessage({id:"pages.user.email.required"})},{type:"email",message:l.formatMessage({id:"pages.user.email.invalid"})}]}),(0,F.jsx)(P.Z,{name:"emailVerified",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.email.verified"}),disabled:!t}),(0,F.jsx)(S.Z,{name:"mobile",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.mobile"}),rules:[{required:!0,message:l.formatMessage({id:"pages.user.mobile.required"})},{pattern:/^1[3-9]\d{9}$/,message:l.formatMessage({id:"pages.user.mobile.invalid"})}]}),(0,F.jsx)(P.Z,{name:"mobileVerified",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.mobile.verified"}),disabled:!t}),(0,F.jsx)(P.Z,{name:"enabled",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.enabled",defaultMessage:"Status"}),checkedChildren:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.status.disabled",defaultMessage:"禁用"}),disabled:!t}),!t&&(0,F.jsx)(S.Z.Password,{name:"password",label:(0,F.jsx)(U.FormattedMessage,{id:"pages.user.password"}),rules:[{required:!0,message:l.formatMessage({id:"pages.user.password.required"})}]})]})})},E=r(90838),q=r(78488),z=r(76750),V=r(28977),O=r.n(V),T=r(55735),D=r(44521),B=["current","pageSize"],L=function(){var e=(0,U.useIntl)(),t=(0,j.useRef)(),r=(0,z.Z)().translateString,n=(0,j.useState)(!0),s=f()(n,2),u=s[0],l=s[1],c=(0,j.useState)(),C=f()(c,2),S=C[0],P=C[1],I=(0,j.useState)(!1),Z=f()(I,2),V=Z[0],L=Z[1],Y=(0,j.useState)(1),W=f()(Y,2),H=W[0],N=W[1],J=(0,j.useState)(10),_=f()(J,2),G=_[0],K=_[1],Q=(0,k.u)((function(e){return e.currentOrg})),$=(0,q.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),X=($.roleResult,$.roleResultPlatform,$.setRoleResult),ee=$.setRoleResultPlatform,te=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:e.formatMessage({id:"pages.user.username"}),dataIndex:"username",copyable:!0},{title:e.formatMessage({id:"pages.user.nickname"}),dataIndex:"nickname",copyable:!0},{title:e.formatMessage({id:"pages.user.email"}),dataIndex:"email",render:function(t,r){return r.email+(r.emailVerified?"(".concat(e.formatMessage({id:"pages.user.email.verified.yes"}),")"):"(".concat(e.formatMessage({id:"pages.user.email.verified.no"}),")"))}},{title:e.formatMessage({id:"pages.user.mobile"}),dataIndex:"mobile",render:function(t,r){return r.mobile+(r.mobileVerified?"(".concat(e.formatMessage({id:"pages.user.mobile.verified.yes"}),")"):"(".concat(e.formatMessage({id:"pages.user.mobile.verified.no"}),")"))}},{title:e.formatMessage({id:"pages.user.organization"}),dataIndex:"currentOrganization",hideInSearch:!0,render:function(e,t){return t.currentOrganization?(0,F.jsx)(x.Z,{color:"blue",children:t.currentOrganization.name||"-"}):"-"}},{title:e.formatMessage({id:"pages.user.roles"}),dataIndex:"currentRoles",hideInSearch:!0,render:function(e,t){return t.currentRoles&&t.currentRoles.length>0?(0,F.jsx)(v.Z,{wrap:!0,children:t.currentRoles.map((function(e,t){return(0,F.jsx)(x.Z,{color:"green",children:r(e.name)},t)}))}):null}},{title:e.formatMessage({id:"pages.user.description"}),dataIndex:"description",hideInSearch:!0,hideInTable:!0},{title:e.formatMessage({id:"pages.user.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(t,r){return r.enabled?e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}):e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.user.superUser"}),dataIndex:"superUser",hideInSearch:!0,render:function(t,r){return r.superUser?e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.user.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,hideInTable:!0,render:function(e,t){return t.createdAt?O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.user.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,hideInTable:!0,render:function(e,t){return t.updatedAt?O()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],re=[].concat(te,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,r,n,a){return[(0,F.jsx)("a",{onClick:function(){se(r)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!r.superUser&&(0,F.jsxs)(j.Fragment,{children:[(0,F.jsx)(R.Z,{type:"vertical"},"divider"),(0,F.jsx)(b.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:r.nickname||r.username}),onConfirm:function(){return oe(r)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,F.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")]}}]),ne=(0,E.v)((function(e){return e.currentCategory})),ae=function(){P(void 0),l(!1),L(!0)},se=function(e){P(e),l(!0),L(!0)},oe=function(){var n=d()(i()().mark((function n(a){var s,o;return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!a.superUser){n.next=3;break}return g.yw.error(e.formatMessage({id:"pages.user.superUser.notDelete"})),n.abrupt("return");case 3:return g.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n.prev=4,n.next=7,(0,m.h8)({uid:a.uid});case 7:s=n.sent,g.yw.destroy(),200===s.code?(g.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):g.yw.error(r(s.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),g.yw.destroy(),g.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete user error:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(e){return n.apply(this,arguments)}}(),ue=function(){var r=d()(i()().mark((function r(n){var a,s;return i()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("handleSubmitDrawer",n),u?g.yw.loading(e.formatMessage({id:"updating"})):g.yw.loading(e.formatMessage({id:"creating"})),!u){r.next=8;break}return r.next=5,(0,m.Nq)(n);case 5:r.t0=r.sent,r.next=11;break;case 8:return r.next=10,(0,m.r4)(n);case 10:r.t0=r.sent;case 11:a=r.t0,console.log("createUser response:",n,a),200===a.code?(g.yw.destroy(),g.yw.loading(e.formatMessage({id:"create.success"})),L(!1),null===(s=t.current)||void 0===s||s.reloadAndRest()):(g.yw.destroy(),g.yw.error(a.message));case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),ie=function(){var t=d()(i()().mark((function t(){var r,n;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return g.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,orgUid:null==Q?void 0:Q.uid},t.next=4,(0,p.E9)(r);case 4:n=t.sent,console.log("queryRolesByOrg response ",n),200===n.code?(g.yw.destroy(),X(n)):(g.yw.destroy(),g.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),le=function(){var t=d()(i()().mark((function t(){var r,n;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return g.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),r={pageNumber:0,pageSize:100,level:T.Hxq},t.next=4,(0,p.E9)(r);case 4:n=t.sent,console.log("queryRolesBySuper response ",n),200===n.code?(g.yw.destroy(),ee(n)):(g.yw.destroy(),g.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,j.useEffect)((function(){ie(),le()}),[]),(0,j.useEffect)((function(){var e;console.log("currentCategory:",ne),null===(e=t.current)||void 0===e||e.reloadAndRest()}),[ne]);var de=function(){var e=d()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",H,G),t=localStorage.getItem(T.LA8),window.open((0,D.kG)()+"/api/v1/user/export?"+new URLSearchParams({pageNumber:String(H-1),pageSize:String(G),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(M.Z,{columns:re,actionRef:t,cardBordered:!0,request:function(){var t=d()(i()().mark((function t(n,s,u){var l,d,c,f,p;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,s,u),g.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),l=n.current,d=n.pageSize,c=o()(n,B),N(l),K(d),f=a()({pageNumber:l-1,pageSize:d},c),t.next=8,(0,m._9)(f);case 8:return p=t.sent,console.log("getAllUsers response:",f,p),g.yw.destroy(),200===p.code||g.yw.error(r(p.message)),t.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:G,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,t){console.log("pagination onChange:",e,t),N(e),K(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.user.list",defaultMessage:"用户列表"}),toolBarRender:function(){return[(0,F.jsx)(w.ZP,{icon:(0,F.jsx)(h.Z,{}),type:"primary",onClick:ae,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button"),(0,F.jsx)(w.ZP,{icon:(0,F.jsx)(y.Z,{}),type:"primary",onClick:de,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),V&&(0,F.jsx)(A,{isEdit:u,open:V,user:S,onClose:function(){L(!1)},onSubmit:ue})]})},Y=function(){return(0,F.jsx)("div",{children:(0,F.jsx)(L,{})})}},90838:function(e,t,r){r.d(t,{v:function(){return c}});var n=r(76711),a=r.n(n),s=r(73193),o=r.n(s),u=r(55735),i=r(44435),l=r(83642),d=r(83890),c=(0,i.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:u.zBg,name:u.zBg},setCategoryResult:function(t){var r=function(e){var t=[];return e.data.content.forEach((function(e){var r={label:e.name,value:e.uid};t.push(r)})),t}(t),n={uid:u.zBg,name:u.zBg},s=o()(o()({},t),{},{data:{content:[n].concat(a()(t.data.content))}}),i=function(e){var t=[];return e.data.content.forEach((function(e){var r={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(r.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(r)})),t}(s);e({categoryResult:s,categoryTreeOptions:i,categorySelectOptions:r}),e({currentCategory:{uid:u.zBg,name:u.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var r=e.categoryResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:u.zBg,name:u.zBg}})},setCurrentCategoryUid:function(r){var n=t().categoryResult.data.content.find((function(e){return e.uid===r}));e({currentCategory:n})},deleteCategoryCache:function(){return e({},!0)}}})),{name:u.OMm})))},78488:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(73193),a=r.n(n),s=r(76711),o=r.n(s),u=r(55735),i=r(44435),l=r(83642),d=r(83890),c=(0,i.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},currentRolePlatform:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},roleResultPlatform:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},insertRolePlatform:function(t){e((function(e){e.roleResultPlatform.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var r=e.roleResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},upgradeRolePlatform:function(t){e((function(e){var r=e.roleResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(r){var n;(e({roleResult:r}),""===t().currentRole.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRole:r.data.content[0]}))},setRoleResultPlatform:function(r){var n;(e({roleResultPlatform:r}),""===t().currentRolePlatform.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRolePlatform:r.data.content[0]}))},setCurrentRole:function(r){var n=t().roleResult.data.content,s=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==s){var u=[].concat(o()(n.slice(0,s)),[r],o()(n.slice(s+1))),i=a()(a()({},t().roleResult),{},{data:{content:u}});e({roleResult:i,currentRole:r})}else console.warn("Role with the specified uid not found."),e({currentRole:r})},setCurrentRolePlatform:function(r){var n=t().roleResultPlatform.data.content,s=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==s){var u=[].concat(o()(n.slice(0,s)),[r],o()(n.slice(s+1))),i=a()(a()({},t().roleResultPlatform),{},{data:{content:u}});e({roleResultPlatform:i,currentRolePlatform:r})}else console.warn("Role with the specified uid not found."),e({currentRolePlatform:r})},removeRole:function(r){var n=t().roleResult.data.content,s=n.findIndex((function(e){return e.uid===r}));-1!==s?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(o()(n.slice(0,s)),o()(n.slice(s+1)))}})}):console.warn("Role not found in cache:",r),t().currentRole.uid===r&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},removeRolePlatform:function(r){var n=t().roleResultPlatform.data.content,s=n.findIndex((function(e){return e.uid===r}));-1!==s?e({roleResult:a()(a()({},t().roleResult),{},{data:{content:[].concat(o()(n.slice(0,s)),o()(n.slice(s+1)))}})}):console.warn("Role not found in cache:",r),t().currentRolePlatform.uid===r&&e({currentRolePlatform:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:u.uaR})))}}]);