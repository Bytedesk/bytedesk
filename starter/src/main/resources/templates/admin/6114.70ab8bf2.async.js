"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6114],{60029:function(e,t,n){var a=n(73193),o=n.n(a),r=n(84176),s=n.n(r),l=n(89756),i=n(74145),c=n(93074),u=n(77667),d=n(74698),p=n(83905),f=(n(4334),n(28977)),y=n.n(f),g=n(44194),m=n(31549),h=["placeholder","defaultValue","value","style","toolbarKeys","onChange","options"];t.Z=function(e){var t=e.placeholder,n=e.defaultValue,a=e.value,r=e.style,f=e.toolbarKeys,w=e.onChange,v=(e.options,s()(e,h)),b=((0,d.useIntl)(),(0,i.Z)().isDarkMode),k=(0,g.useRef)(null),C=(0,g.useRef)(null);return(0,g.useEffect)((function(){if(k.current){if(!C.current){var e=new p.cW({element:k.current,theme:b?"dark":"light",placeholder:t,content:n,toolbarKeys:f,image:{uploadUrl:(0,c.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var r=y()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,s=new FormData;return s.append("file",e),s.append("file_name",r),s.append("file_type",e.type),s.append("is_avatar","false"),s.append("kb_type",u.bE7),s.append("category_uid",""),s.append("kb_uid",""),s.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:s}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){l.yw.destroy(),l.yw.success("".concat(r," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:r}};e(n)}else l.yw.destroy(),l.yw.error("".concat(r," 上传失败"))})).catch((function(e){a(e)}))}))}},video:{uploadUrl:(0,c.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var r=y()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,s=new FormData;return s.append("file",e),s.append("file_name",r),s.append("file_type",e.type),s.append("is_avatar","false"),s.append("kb_type",u.bE7),s.append("category_uid",""),s.append("kb_uid",""),s.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:s}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){l.yw.destroy(),l.yw.success("".concat(r," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else l.yw.destroy(),l.yw.error("".concat(r," 上传失败"))})).catch((function(e){a(e)}))}))}},attachment:{uploadUrl:(0,c.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(u.LA8)},uploader:function(e,t,n,a){console.log("uploader:",e,t,n,a);var r=y()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,s=new FormData;return s.append("file",e),s.append("file_name",r),s.append("file_type",e.type),s.append("is_avatar","false"),s.append("kb_type",u.bE7),s.append("category_uid",""),s.append("kb_uid",""),s.append("client",u.bVn),new Promise((function(e,a){fetch(t,{method:"POST",headers:o()({Accept:"application/json"},n),body:s}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){l.yw.destroy(),l.yw.success("".concat(r," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:r}};e(n)}else l.yw.destroy(),l.yw.error("".concat(r," 上传失败"))})).catch((function(e){a(e)}))}))}},onChange:function(e){"function"==typeof w&&w(e.getHtml(),e.getMarkdown())}});C.current=e}return function(){C.current&&(C.current.destroy(),C.current=null)}}}),[]),(0,g.useEffect)((function(){C.current&&a!==C.current.getHtml()&&C.current.setContent(a||"")}),[a]),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("div",o()(o()({ref:k},v),{},{style:o()({height:"100%"},r)}))})}},47227:function(e,t,n){n.d(t,{Z:function(){return j}});var a=n(90819),o=n.n(a),r=n(89933),s=n.n(r),l=n(45332),i=n.n(l),c=n(67444),u=n(53530),d=n(27487),p=n(75365),f=n(82962),y=n(88996),g=n(56913),m=n(44194),h=n(72272),w=n(40431),v=n(89756),b=n(26305),k=n(1780),C=n(74698),_=n(57024),x=n(77667),M=n(31549),j=function(e){var t=e.type,n=(0,C.useIntl)(),a=(0,m.useState)(!0),r=i()(a,2),l=r[0],j=r[1],D=(0,w.u)((function(e){return e.currentOrg})),S=(0,_.j)((function(e){return e.currentKbase})),Z=(0,m.useState)(!1),Y=i()(Z,2),U=Y[0],H=Y[1],A=(0,b.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,setCategoryResult:e.setCategoryResult,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),T=A.categoryTreeOptions,E=A.setCategoryResult,O=A.currentCategory,P=A.setCurrentCategoryUid,z=(0,k.Z)(),K=z.translateString,N=z.translateStringTranct,F=u.Z.useModal(),I=i()(F,2),R=I[0],V=I[1],L=function(){var e=s()(o()().mark((function e(t){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmit: ",t),l?v.yw.loading(n.formatMessage({id:"updating"})):v.yw.loading(n.formatMessage({id:"creating"})),!l){e.next=8;break}return e.next=5,(0,h.yr)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,h.k4)(t);case 10:e.t0=e.sent;case 11:a=e.t0,console.log("createCategory response: ",a),200===a.code?(v.yw.destroy(),l?v.yw.success(n.formatMessage({id:"update.success"})):v.yw.success(n.formatMessage({id:"create.success"})),H(!1),B()):(v.yw.destroy(),v.yw.error(a.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=s()(o()().mark((function e(){var a,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getCategories"),v.yw.success(n.formatMessage({id:"loading"})),a={pageNumber:0,pageSize:50,type:t,orgUid:null==D?void 0:D.uid},t!==x.hcJ&&(a.kbUid=null==S?void 0:S.uid),e.next=6,(0,h.XS)(a);case 6:r=e.sent,console.log("queryCategories response: ",r),200===r.code?(E(r),v.yw.destroy()):(v.yw.destroy(),v.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=s()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditCategory: ",O),j(!0),H(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=s()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteCategory: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){t!==x.hcJ&&B()}),[S]),(0,m.useEffect)((function(){t===x.hcJ&&B()}),[]);return(0,M.jsxs)("div",{children:[(0,M.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{margin:5},children:[(0,M.jsx)(p.ZP,{type:"primary",size:"small",onClick:function(){j(!1),H(!0)},children:n.formatMessage({id:"create"})}),(0,M.jsx)(p.ZP,{size:"small",onClick:B,children:"刷新"}),""!==(null==O?void 0:O.uid)&&"all"!==(null==O?void 0:O.uid)&&(0,M.jsx)(p.ZP,{size:"small",onClick:$,children:n.formatMessage({id:"edit"})}),""!==(null==O?void 0:O.uid)&&"all"!==(null==O?void 0:O.uid)&&(0,M.jsx)(p.ZP,{onClick:function(){return function(e){R.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(c.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(K(e.name),"】？"),onOk:function(){J(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(O)},size:"small",style:{float:"right"},danger:!0,children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,M.jsx)(f.Z,{defaultSelectedKeys:[null==O?void 0:O.uid],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&P(e[0].toString())},treeData:T,blockNode:!0,titleRender:function(e){return(0,M.jsx)(y.Z,{title:K(e.title),children:N(e.title)})}}),U&&(0,M.jsx)(g.Z,{open:U,type:t,isEdit:l,onCancel:function(){H(!1)},onSubmit:L}),V]})}},36213:function(e,t,n){var a=n(73193),o=n.n(a),r=n(45332),s=n.n(r),l=n(53530),i=n(44194),c=n(60051),u=n(1962),d=n(28977),p=n.n(d),f=n(77667),y=n(89756),g=n(57024),m=n(26305),h=n(93074),w=n(31549),v=u.Z.Dragger;t.Z=function(e){var t=e.type,n=e.acceptType,a=e.isModalOpen,r=e.handleOk,u=e.handleCancel,d=(0,g.j)((function(e){return e.currentKbase})),b=(0,i.useState)((null==d?void 0:d.uid)||""),k=s()(b,2),C=k[0],_=k[1],x=(0,m.v)((function(e){return e.currentCategory})),M=(0,i.useState)("当前支持上传pdf/txt/markdown/docx等"),j=s()(M,2),D=j[0],S=j[1],Z=(0,i.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"all"===(null==x?void 0:x.uid)?"":(null==x?void 0:x.uid)||"",kb_uid:(null==d?void 0:d.uid)||"",client:f.bVn}),Y=s()(Z,2),U=Y[0],H=Y[1],A={name:"file",accept:n,multiple:!0,action:(0,h.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(f.LA8)},data:U,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload before",e,C,d);var n=p()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;U.file=e,U.file_name=n,U.file_type=e.type,U.kb_type=t,U.kb_uid=C,console.log("beforeUpload after",U)},onChange:function(e){"uploading"===e.file.status&&y.yw.loading("".concat(e.file.name," 上传中")),"done"===e.file.status?(console.log("response: ",e.file.response),200===e.file.response.code?(y.yw.destroy(),y.yw.success("".concat(e.file.name," 上传成功")),r()):(y.yw.destroy(),y.yw.error("".concat(e.file.name," 上传失败")),u())):"error"===e.file.status&&(y.yw.error("".concat(e.file.name," 上传失败")),u())},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}},T=(0,i.useState)(A),E=s()(T,2),O=E[0],P=E[1];return(0,i.useEffect)((function(){g.j.subscribe((function(e,t){var n,a;console.log("useKbaseStore changed:",null==e||null===(n=e.currentKbase)||void 0===n?void 0:n.uid),_(null==e||null===(a=e.currentKbase)||void 0===a?void 0:a.uid),P(A)}))}),[d]),(0,i.useEffect)((function(){t!=f.QPQ&&(P(A),S("当前支持上传excel文件")),H(o()(o()({},U),{},{kb_type:t,category_uid:"all"===(null==x?void 0:x.uid)?"":null==x?void 0:x.uid})),P(A)}),[t,x]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(l.Z,{title:"上传文件",open:a,onOk:r,onCancel:u,children:(0,w.jsxs)(v,o()(o()({},O),{},{children:[(0,w.jsx)("p",{className:"ant-upload-drag-icon",children:(0,w.jsx)(c.Z,{})}),(0,w.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽文件至此处实现上传"}),(0,w.jsx)("p",{className:"ant-upload-hint",children:D})]}))})})}}}]);