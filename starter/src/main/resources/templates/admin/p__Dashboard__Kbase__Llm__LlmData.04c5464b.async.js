"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{99885:function(e,t,n){n.d(t,{Yg:function(){return v},kh:function(){return p},pf:function(){return c},y:function(){return m}});var r=n(90819),a=n.n(r),o=n(73193),i=n.n(o),s=n(89933),u=n.n(s),l=n(55735),d=n(30921);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/faq/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},51990:function(e,t,n){var r=n(73193),a=n.n(r),o=n(84176),i=n.n(o),s=n(86803),u=n(23864),l=n(44521),d=n(55735),c=n(30921),f=n(83905),p=(n(26286),n(28977)),g=n.n(p),m=n(44194),h=n(31549),v=["placeholder","defaultValue","value","style","toolbarKeys","onChange","options"];t.Z=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,o=e.style,p=e.toolbarKeys,x=e.onChange,y=(e.options,i()(e,v)),w=((0,c.useIntl)(),(0,u.Z)().isDarkMode),M=(0,m.useRef)(null),b=(0,m.useRef)(null);return(0,m.useEffect)((function(){if(M.current){if(!b.current){var e=new f.cW({element:M.current,theme:w?"dark":"light",placeholder:t,content:n,toolbarKeys:p,image:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(d.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("file_name",o),i.append("file_type",e.type),i.append("is_avatar","false"),i.append("kb_type",d.bE7),i.append("category_uid",""),i.append("kb_uid",""),i.append("client",d.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,alt:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},video:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(d.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("file_name",o),i.append("file_type",e.type),i.append("is_avatar","false"),i.append("kb_type",d.bE7),i.append("category_uid",""),i.append("kb_uid",""),i.append("client",d.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{src:t.data.fileUrl,poster:"https://www.weiyuai.cn/avatars/video_poster.png"}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},attachment:{uploadUrl:(0,l.M$)(),uploadFormName:"file",uploadHeaders:{Authorization:"Bearer "+localStorage.getItem(d.LA8)},uploader:function(e,t,n,r){console.log("uploader:",e,t,n,r);var o=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,i=new FormData;return i.append("file",e),i.append("file_name",o),i.append("file_type",e.type),i.append("is_avatar","false"),i.append("kb_type",d.bE7),i.append("category_uid",""),i.append("kb_uid",""),i.append("client",d.bVn),new Promise((function(e,r){fetch(t,{method:"POST",headers:a()({Accept:"application/json"},n),body:i}).then((function(e){return e.json()})).then((function(t){if(console.log("upload data:",t),200===t.code){s.yw.destroy(),s.yw.success("".concat(o," 上传成功"));var n={errorCode:0,data:{href:t.data.fileUrl,fileName:o}};e(n)}else s.yw.destroy(),s.yw.error("".concat(o," 上传失败"))})).catch((function(e){r(e)}))}))}},onChange:function(e){"function"==typeof x&&x(e.getHtml(),e.getMarkdown())}});b.current=e}return function(){b.current&&(b.current.destroy(),b.current=null)}}}),[]),(0,m.useEffect)((function(){b.current&&r!==b.current.getHtml()&&b.current.setContent(r||"")}),[r]),(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("div",a()(a()({ref:M},y),{},{style:a()({height:"100%"},o)}))})}},17220:function(e,t,n){n(44194);var r=n(75365),a=n(54881),o=n(30921),i=n(31549);t.Z=function(e){var t,n,s=e.file,u=e.onDelete,l=e.showDelete,d=void 0===l||l,c=(0,o.useIntl)();return(0,i.jsxs)("div",{style:{position:"relative",width:"50px",height:"50px",border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"hidden"},title:c.formatMessage({id:null!=s&&null!==(t=s.fileType)&&void 0!==t&&t.startsWith("image/")?"upload.preview.image":"upload.preview.file"}),children:[d&&(0,i.jsx)(r.ZP,{type:"text",size:"small",icon:(0,i.jsx)(a.Z,{}),onClick:function(){return u(s.uid)},style:{position:"absolute",top:0,right:0,padding:"2px",background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"0 4px 0 4px",zIndex:1}}),(0,i.jsx)("div",{onClick:function(){return window.open(s.fileUrl,"_blank")},style:{width:"100%",height:"100%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:null!=s&&null!==(n=s.fileType)&&void 0!==n&&n.startsWith("image/")?(0,i.jsx)("img",{src:null==s?void 0:s.fileUrl,alt:null==s?void 0:s.fileName,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{style:{fontSize:"12px",padding:"4px",textAlign:"center",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.fileName})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"#fff",fontSize:"10px",padding:"2px",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.fileName})]},s.uid)}},27650:function(e,t,n){var r=n(76711),a=n.n(r),o=n(73193),i=n.n(o),s=n(45332),u=n.n(s),l=n(44194),d=n(42085),c=n(30348),f=n(53530),p=n(28977),g=n.n(p),m=n(55735),h=n(86803),v=n(44521),x=n(17220),y=n(30921),w=n(6397),M=n(31549),b=c.Z.Dragger;t.Z=function(e){var t=e.type,n=(e.acceptType,e.isModalOpen),r=e.attachments,o=e.handleSubmit,s=e.handleCancel,c=(0,y.useIntl)(),p=(0,w.j)((function(e){return e.currentKbase})),j=(0,l.useState)([]),k=u()(j,2),S=k[0],C=k[1],I=(0,l.useState)({file:null,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:t,category_uid:"",kb_uid:null==p?void 0:p.uid,client:m.bVn}),Z=u()(I,2),D=Z[0],T=Z[1];(0,l.useEffect)((function(){console.log("UploadDrag currentKbase",p),p&&T((function(e){return i()(i()({},e),{},{kb_uid:null==p?void 0:p.uid})}))}),[p]);var U=(0,l.useMemo)((function(){return{name:"file",multiple:!0,action:(0,v.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(m.LA8)},data:D,showUploadList:!1,beforeUpload:function(e){var t=g()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return T((function(n){return i()(i()({},n),{},{file:e,file_name:t,file_type:e.type,category_uid:""})})),!0},onChange:function(e){"uploading"===e.file.status&&h.yw.loading(c.formatMessage({id:"upload.uploading"},{filename:e.file.name})),"done"===e.file.status?200===e.file.response.code?(h.yw.destroy(),h.yw.success(c.formatMessage({id:"upload.success"},{filename:e.file.name})),C((function(t){return[].concat(a()(t),[e.file.response.data])}))):(h.yw.destroy(),h.yw.error(c.formatMessage({id:"upload.failed"},{filename:e.file.name}))):"error"===e.file.status&&h.yw.error(c.formatMessage({id:"upload.failed"},{filename:e.file.name}))},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}}}),[D,c]);(0,l.useEffect)((function(){T((function(e){return i()(i()({},e),{},{kb_type:t,category_uid:""})})),r&&C(r.map((function(e){return e.upload})))}),[t]);var F=function(e){console.log("handleDelete",e),C((function(t){return t.filter((function(t){return t.uid!==e}))}))};return(0,M.jsxs)(f.Z,{title:c.formatMessage({id:"upload.modal.title"}),open:n,onOk:function(){o(S)},onCancel:s,children:[(0,M.jsxs)(b,i()(i()({},U),{},{children:[(0,M.jsx)("p",{className:"ant-upload-drag-icon",children:(0,M.jsx)(d.Z,{})}),(0,M.jsx)("p",{className:"ant-upload-text",children:c.formatMessage({id:"upload.drag.text"})}),(0,M.jsx)("p",{className:"ant-upload-hint",children:c.formatMessage({id:"upload.drag.hint"})})]})),(0,M.jsx)("div",{style:{marginTop:"16px",maxHeight:"200px",overflowY:"auto"},children:(0,M.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:S.map((function(e){return(0,M.jsx)(x.Z,{file:e,onDelete:F},e.uid)}))})})]})}},96074:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ae}});var r=n(96865),a=n(75574),o=n(55735),i=n(8377),s=n(44194),u=n(8247),l=n(30921),d=n(73193),c=n.n(d),f=n(84176),p=n.n(f),g=n(90819),m=n.n(g),h=n(89933),v=n.n(h),x=n(45332),y=n.n(x),w=n(86803);function M(e){return b.apply(this,arguments)}function b(){return(b=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/file/query/org",{method:"GET",params:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/file/delete",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=n(76750),C=n(6397),I=n(40612),Z=n(51239),D=n(44521),T=n(73442),U=n(3849),F=n(75365),q=n(80601),A=n(31549),E=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,S.Z)().translateString,o=(0,C.j)((function(e){return e.currentKbase})),i=(0,Z.L)((function(e){return e.userInfo})),u=(0,I.u)((function(e){return e.currentOrg})),l=(0,s.useState)(""),d=y()(l,2),c=d[0],f=d[1],p=(0,s.useState)(!1),g=y()(p,2),m=g[0],h=g[1],v=function(){console.log("refresh"),h(!1);var e=(0,D.Cn)()+"?org="+encodeURIComponent(null==u?void 0:u.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==o?void 0:o.uid)+"&uid="+encodeURIComponent(null==i?void 0:i.uid)+"&nickname="+encodeURIComponent(null==i?void 0:i.nickname)+"&avatar="+encodeURIComponent(null==i?void 0:i.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,s.useEffect)((function(){v()}),[o]);return(0,A.jsx)(A.Fragment,{children:(0,A.jsxs)(T.Z,{title:a(null==o?void 0:o.name),onClose:function(){r&&r()},open:n,extra:(0,A.jsxs)(U.Z,{children:[(0,A.jsx)(F.ZP,{onClick:function(){window.open(c)},children:"新窗口"}),(0,A.jsx)(F.ZP,{onClick:function(){console.log("restart"),v()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,A.jsx)(q.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,A.jsx)("iframe",{id:"chat-iframe",src:c,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},_=n(90838),Y=n(69114),P=n(25482),z=n(11090),O=n(72381),V=n(61355),N=n(28977),R=n.n(N),B=n(27650),H=n(28425),L=["current","pageSize"],K=function(){var e=(0,l.useIntl)(),t=((0,l.useNavigate)(),(0,s.useRef)()),n=(0,S.Z)().translateString,r=(0,s.useState)(1),a=y()(r,2),i=a[0],u=a[1],d=(0,s.useState)(10),f=y()(d,2),g=f[0],h=f[1],x=(0,I.u)((function(e){return e.currentOrg})),b=(0,C.j)((function(e){return e.currentKbase})),k=(0,_.v)((function(e){return e.currentCategory})),Z=((0,_.v)((function(e){return e.categorySelectOptions})),(0,s.useState)(!1)),T=y()(Z,2),U=T[0],q=T[1],N=(0,s.useState)(!1),K=y()(N,2),Q=K[0],W=K[1],G=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,A.jsx)(l.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",render:function(e,t,n,r){var a,o;return null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")?null==t||null===(o=t.fileName)||void 0===o?void 0:o.split("_").slice(1).join("_"):null==t?void 0:t.fileName}},{title:(0,A.jsx)(l.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return R()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],$=function(){var n=v()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,j(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),J=[].concat(G,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,A.jsx)("a",{onClick:function(){var e=null==n?void 0:n.fileUrl,t=encodeURIComponent(e);window.open(decodeURIComponent(t))},children:e.formatMessage({id:"open",defaultMessage:"Open"})},"editable"),(0,A.jsx)(V.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return $(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,A.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,s.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[b,k]),(0,s.useEffect)((function(){return Y.Z.on(o.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){Y.Z.off(o.YwV)}}),[]);var X=function(){var t=v()(m()().mark((function t(){return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,H.HK)(o.QPQ,null==x?void 0:x.uid,null==b?void 0:b.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ee=function(){var e=v()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,g),t=localStorage.getItem(o.LA8),window.open((0,D.kG)()+"/api/v1/file/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==k?void 0:k.uid)===o.zBg?"":null==k?void 0:k.uid,kbUid:null==b?void 0:b.uid,orgUid:(null==x?void 0:x.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.Z,{columns:J,actionRef:t,cardBordered:!0,request:function(){var e=v()(m()().mark((function e(t,n,r){var a,i,s,l,d;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,i=t.pageSize,s=p()(t,L),u(a),h(i),l=c()({pageNumber:a-1,pageSize:i,categoryUid:(null==k?void 0:k.uid)===o.zBg?"":null==k?void 0:k.uid,kbUid:null==b?void 0:b.uid,orgUid:null==x?void 0:x.uid},s),e.next=7,M(l);case 7:return d=e.sent,console.log("queryFilesByOrg response:",d,l),200===d.code||w.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:n(null==b?void 0:b.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 ’拆分‘ 列表中",toolBarRender:function(){return[(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(P.Z,{}),type:"primary",onClick:function(){return q(!0)},children:e.formatMessage({id:"upload",defaultMessage:"File"})},"button"),(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(z.Z,{}),type:"primary",onClick:ee,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),U&&(0,A.jsx)(B.Z,{type:o.QPQ,acceptType:"*",isModalOpen:U,handleSubmit:function(e){console.log("handleFileDragSubmit",e),q(!1),null==t||t.current.reload(),X()},handleCancel:function(){console.log("handleFileDragCancel"),q(!1),null==t||t.current.reload()}}),Q&&(0,A.jsx)(E,{type:o.xtN,open:Q,onClose:function(){return W(!1)}})]})};function Q(e){return W.apply(this,arguments)}function W(){return(W=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/query/org",{method:"GET",params:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return $.apply(this,arguments)}function $(){return($=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/create",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return X.apply(this,arguments)}function X(){return(X=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/update",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/text/delete",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ne=n(15722),re=n(53530),ae=n(29266),oe=n(51990),ie=n(65461),se=n(69169),ue=n(84881),le=n(4499),de=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,o=e.onSubmit,i=se.A.useForm(),u=y()(i,1)[0],l=(0,s.useState)(""),d=y()(l,2),f=d[0],p=d[1],g=(0,I.u)((function(e){return e.currentOrg})),m=(0,_.v)((function(e){return e.categorySelectOptions})),h=(0,s.useState)(),v=y()(h,2),x=v[0],w=v[1],M=(0,C.j)((function(e){return e.currentKbase}));(0,s.useEffect)((function(){t?(u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:n.categoryUid}),p((null==n?void 0:n.content)||"")):u.resetFields()}),[t,n,u]);return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(T.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,A.jsxs)(U.Z,{children:[(0,A.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,A.jsx)(F.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=c()(c()({},e),{},{categoryUid:x,kbUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid});console.log("submit",t),o(t)}))},type:"primary",children:"保存"})]}),children:(0,A.jsxs)(se.A,{form:u,submitter:{render:function(){return null}},children:[(0,A.jsx)(ue.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:m,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),w(e)}}}),(0,A.jsx)(le.Z,{label:"标题",name:"name",rules:[{required:!0}]}),(0,A.jsx)(se.A.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:(0,A.jsx)(oe.Z,{placeholder:"请输入内容",value:f,toolbarKeys:(0,ie.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){p(e)}})})]})})})},ce=["current","pageSize"],fe=function(){var e=(0,l.useIntl)(),t=(0,s.useRef)(),n=(0,S.Z)().translateString,r=(0,s.useState)(1),a=y()(r,2),i=a[0],u=a[1],d=(0,s.useState)(10),f=y()(d,2),g=f[0],h=f[1],x=(0,I.u)((function(e){return e.currentOrg})),M=(0,C.j)((function(e){return e.currentKbase})),b=(0,_.v)((function(e){return e.currentCategory})),j=(0,_.v)((function(e){return e.categorySelectOptions})),k=(0,s.useState)(!1),Z=y()(k,2),T=Z[0],U=Z[1],q=(0,s.useState)({}),E=y()(q,2),Y=E[0],V=E[1],N=(0,s.useState)(!1),B=y()(N,2),H=B[0],L=B[1],K=re.Z.useModal(),W=y()(K,2),$=W[0],X=W[1],te=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,A.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,render:function(e,t){return(0,A.jsx)(A.Fragment,{children:t.name})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",render:function(e,t){return(0,A.jsx)(A.Fragment,{children:t.content})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(e,t){var n=j.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,A.jsx)(ae.Z,{children:null==n?void 0:n.label})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t,n,r){return R()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],oe=[].concat(te,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,render:function(t,n,r,a){return[(0,A.jsx)("a",{onClick:function(){V(n),L(!0),U(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,A.jsx)(F.ZP,{type:"link",onClick:function(){return function(t){$.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,A.jsx)(ne.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){ie(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")]}}]);(0,s.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[M,b]);var ie=function(){var n=v()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,ee(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):w.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),se=function(){var e=v()(m()().mark((function e(n){var r,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),U(!1)):w.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=v()(m()().mark((function e(n){var r,a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==Y?void 0:Y.uid,e.next=3,J(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),U(!1)):w.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),le=function(){U(!0),L(!1),V({})},fe=function(){var e=v()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,g),t=localStorage.getItem(o.LA8),window.open((0,D.kG)()+"/api/v1/text/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==b?void 0:b.uid)===o.zBg?"":null==b?void 0:b.uid,kbUid:null==M?void 0:M.uid,orgUid:(null==x?void 0:x.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,A.jsxs)(A.Fragment,{children:[T&&(0,A.jsx)(de,{isEdit:H,open:T,text:Y,onClose:function(){U(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),H?ue(e):se(e)}}),(0,A.jsx)(O.Z,{columns:oe,actionRef:t,cardBordered:!0,request:function(){var e=v()(m()().mark((function e(t,n,r){var a,i,s,l,d;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,i=t.pageSize,s=p()(t,ce),u(a),h(i),l=c()({pageNumber:a-1,pageSize:i,categoryUid:(null==b?void 0:b.uid)===o.zBg?"":null==b?void 0:b.uid,kbUid:null==M?void 0:M.uid,orgUid:null==x?void 0:x.uid},s),e.next=6,Q(l);case 6:return d=e.sent,console.log("queryTextsByOrg response:",d,l),200===d.code||w.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:n(null==M?void 0:M.name)+" - 文本列表",tooltip:"所添加文本内容会自动添加到 ’拆分‘ 列表中 ",toolBarRender:function(){return[(0,A.jsx)(F.ZP,{type:"primary",icon:(0,A.jsx)(P.Z,{}),onClick:le,children:e.formatMessage({id:"create",defaultMessage:"Create"})}),(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(z.Z,{}),type:"primary",onClick:fe,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),X]})};function pe(e){return ge.apply(this,arguments)}function ge(){return(ge=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/split/query/org",{method:"GET",params:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){return he.apply(this,arguments)}function he(){return(he=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/split/update",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e){return xe.apply(this,arguments)}function xe(){return(xe=v()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/split/delete",{method:"POST",data:c()(c()({},t),{},{client:o.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ye=n(32350),we=function(e){var t=e.isEdit,n=e.split,r=e.open,a=e.onClose,o=e.onSubmit,i=se.A.useForm(),u=y()(i,1)[0],d=(0,l.useIntl)(),f=(0,I.u)((function(e){return e.currentOrg})),p=(0,C.j)((function(e){return e.currentKbase})),g=(0,_.v)((function(e){return e.currentCategory}));return(0,s.useEffect)((function(){t&&n?u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content}):u.setFieldsValue({name:"",content:""})}),[t,n,u]),(0,A.jsx)(T.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,A.jsxs)(U.Z,{children:[(0,A.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,A.jsx)(F.ZP,{onClick:function(){u.validateFields().then((function(e){var t=c()(c()({},e),{},{orgUid:null==f?void 0:f.uid,kbUid:null==p?void 0:p.uid,categoryUid:null==g?void 0:g.uid});console.log("submit",t),o(t)}))},type:"primary",children:"保存"})]}),children:(0,A.jsxs)(se.A,{form:u,name:"splitForm",submitter:!1,children:[(0,A.jsx)(le.Z,{label:d.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0}]}),(0,A.jsx)(ye.Z,{label:d.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0}],fieldProps:{rows:6}})]})})},Me=["current","pageSize"],be=function(){var e=(0,l.useIntl)(),t=(0,s.useRef)(),n=(0,S.Z)().translateString,r=(0,s.useState)(1),a=y()(r,2),i=a[0],u=a[1],d=(0,s.useState)(10),f=y()(d,2),g=f[0],h=f[1],x=(0,I.u)((function(e){return e.currentOrg})),M=(0,C.j)((function(e){return e.currentKbase})),b=(0,_.v)((function(e){return e.currentCategory})),j=(0,_.v)((function(e){return e.categorySelectOptions})),k=(0,s.useState)(!1),Z=y()(k,2),T=Z[0],U=Z[1],q=(0,s.useState)(!1),P=y()(q,2),N=P[0],B=P[1],H=(0,s.useState)(),L=y()(H,2),K=L[0],Q=L[1],W=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",width:200,render:function(e,t,n,r){var a,o;return null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")?null==t||null===(o=t.name)||void 0===o?void 0:o.split("_").slice(1).join("_"):null==t?void 0:t.name}},{title:(0,A.jsx)(l.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",render:function(e,t,n,r){var a;return(null==t||null===(a=t.content)||void 0===a?void 0:a.slice(0,100))+"..."}},{title:(0,A.jsx)(l.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",render:function(e,t){var n=j.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,A.jsx)(ae.Z,{children:null==n?void 0:n.label})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:200,hideInSearch:!0,render:function(e,t,n,r){return R()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],G=function(){var n=v()(m()().mark((function n(r){var a;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,ve(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),$=function(){var n=v()(m()().mark((function n(r){var a,o;return m()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!K){n.next=7;break}return n.next=4,me(c()(c()({},r),{},{uid:K.uid}));case 4:a=n.sent,n.next=7;break;case 7:200===a.code?(w.yw.success(e.formatMessage({id:K?"update.success":"add.success",defaultMessage:K?"Update Success":"Add Success"})),B(!1),null==t||null===(o=t.current)||void 0===o||o.reload()):w.yw.error(a.message),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),w.yw.error(e.formatMessage({id:K?"update.error":"add.error",defaultMessage:K?"Update Error":"Add Error"}));case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}(),J=[].concat(W,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,render:function(t,n,r,a){return[(0,A.jsx)("a",{onClick:function(){return function(e){Q(e),B(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,A.jsx)(V.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return G(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,A.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]);(0,s.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[M,b]),(0,s.useEffect)((function(){return Y.Z.on(o.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){Y.Z.off(o.YwV)}}),[]);var X=function(){var e=v()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",i,g),t=localStorage.getItem(o.LA8),window.open((0,D.kG)()+"/api/v1/split/export?"+new URLSearchParams({pageNumber:String(i-1),pageSize:String(g),categoryUid:(null==b?void 0:b.uid)===o.zBg?"":null==b?void 0:b.uid,kbUid:null==M?void 0:M.uid,orgUid:(null==x?void 0:x.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.Z,{columns:J,actionRef:t,cardBordered:!0,request:function(){var e=v()(m()().mark((function e(t,n,r){var a,i,s,l,d;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,i=t.pageSize,s=p()(t,Me),u(a),h(i),l=c()({pageNumber:a-1,pageSize:i,categoryUid:(null==b?void 0:b.uid)===o.zBg?"":null==b?void 0:b.uid,kbUid:null==M?void 0:M.uid,orgUid:null==x?void 0:x.uid},s),e.next=7,pe(l);case 7:return d=e.sent,console.log("querySplitsByOrg response:",d,l),200===d.code||w.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:!1,rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:n(null==M?void 0:M.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:function(){return[(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(z.Z,{}),type:"primary",onClick:X,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),T&&(0,A.jsx)(E,{type:o.xtN,open:T,onClose:function(){return U(!1)}}),(0,A.jsx)(we,{isEdit:!!K,split:K,open:N,onClose:function(){return B(!1)},onSubmit:$})]})},je=n(99885),ke=n(30617),Se=n(61107),Ce=n(29078),Ie=function(e){var t=e.content,n=Ce.Z.sanitize(t,{ALLOWED_TAGS:["p","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","a","strong","em","b","i","img","blockquote","code","pre"],ALLOWED_ATTR:["href","target","src","alt","style","class"]});return(0,A.jsx)("div",{className:"RichText",dangerouslySetInnerHTML:{__html:n}})},Ze=function(e){var t=e.isEdit,n=e.faq,r=e.open,a=e.onClose,i=e.onSubmit,u=se.A.useForm(),l=y()(u,1)[0],d=(0,s.useState)(""),f=y()(d,2),p=f[0],g=f[1],m=(0,I.u)((function(e){return e.currentOrg})),h=(0,C.j)((function(e){return e.currentKbase})),v=(0,_.v)((function(e){return e.categorySelectOptions})),x=(0,s.useState)(),M=y()(x,2),b=(M[0],M[1]),j=(0,s.useState)(o.PYi),k=y()(j,2),S=(k[0],k[1]),Z=(0,s.useState)(".png,.jpg,.jpeg"),q=y()(Z,2),E=(q[0],q[1]),Y=(0,s.useState)({file:void 0,file_name:"test.pdf",file_type:"application/pdf",is_avatar:"false",kb_type:"type",category_uid:"",kb_uid:(null==h?void 0:h.uid)||"",client:o.bVn}),P=y()(Y,2);P[0],P[1];(0,s.useEffect)((function(){t?(l.setFieldsValue({type:null==n?void 0:n.type,title:null==n?void 0:n.question,answer:null==n?void 0:n.answer,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==h?void 0:h.uid}),g(null==n?void 0:n.answer)):(l.setFieldsValue({type:o.PYi,title:"",answer:"",categoryUid:"",kbUid:null==h?void 0:h.uid}),g(""))}),[n]);(0,D.M$)(),localStorage.getItem(o.LA8);return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(T.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:a,open:r,extra:(0,A.jsxs)(U.Z,{children:[(0,A.jsx)(F.ZP,{onClick:a,children:"取消"}),(0,A.jsx)(F.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){console.log(e),i(c()(c()(c()({},n),e),{},{kbUid:null==h?void 0:h.uid,orgUid:null==m?void 0:m.uid,answer:p}))})).catch((function(e){console.log("Form errors:",e),w.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,A.jsxs)(se.A,{form:l,submitter:{render:function(){return null}},children:[(0,A.jsx)(ue.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:v,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),b(e)}}}),(0,A.jsx)(ue.Z,{label:"类型",name:"type",rules:[{required:!0,message:"请选择类型"}],disabled:!0,options:[{label:"文本",value:o.PYi},{label:"图片",value:o.Qm},{label:"视频",value:o.tVi},{label:"音频",value:o.Yu1},{label:"文件",value:o.Qn}],fieldProps:{allowClear:!0,placeholder:"请选择类型",onChange:function(e){console.log("type selected ".concat(e)),S(e),e===o.Qm?E(".png,.jpg,.jpeg,.gif,.bmp"):e===o.tVi?E(".mp4,.avi,.mov,.wmv"):e===o.Yu1?E(".mp3,.wav,.flac"):e===o.Qn&&E(".doc,.xls,.ppt,.pdf,.docx,.txt,.csv,.xlsx,.rtf,.zip,.7z,.tar,.gz,.rar,.iso")}}}),(0,A.jsx)(le.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,A.jsx)(se.A.Item,{name:"answer",label:"答案",rules:[{required:!0,message:"请输入答案"}],children:(0,A.jsx)(oe.Z,{placeholder:"answer..",value:p,toolbarKeys:(0,ie.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){g(e)}})})]})})})},De=["current","pageSize"],Te=function(){var e=(0,l.useIntl)(),t=(0,S.Z)().translateString,n=(0,s.useRef)(),r=(0,s.useState)(!0),a=y()(r,2),i=a[0],u=a[1],d=(0,s.useState)(),f=y()(d,2),g=f[0],h=f[1],x=(0,s.useState)(!1),M=y()(x,2),b=M[0],j=M[1],k=(0,s.useState)(1),Z=y()(k,2),T=Z[0],U=Z[1],q=(0,s.useState)(10),E=y()(q,2),Y=E[0],N=E[1],L=(0,I.u)((function(e){return e.currentOrg})),K=(0,C.j)((function(e){return e.currentKbase})),Q=(0,_.v)((function(e){return e.currentCategory})),W=(0,_.v)((function(e){return e.categorySelectOptions})),G=(0,s.useState)(!1),$=y()(G,2),J=$[0],X=$[1],ee=function(){var t=v()(m()().mark((function t(r){var a;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,(0,je.Yg)(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),w.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):w.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.question",defaultMessage:"Question"}),dataIndex:"question",copyable:!0,fixed:"left",width:300},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.answer",defaultMessage:"Answer"}),dataIndex:"answer",width:400,render:function(e,t){return(0,A.jsx)(Ie,{content:null==t?void 0:t.answer})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:100,render:function(t,n){return(0,A.jsx)(A.Fragment,{children:e.formatMessage({id:"faq.type.".concat(null==n?void 0:n.type.toLowerCase()),defaultMessage:null==n?void 0:n.type})})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,render:function(e,t){var n=W.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,A.jsx)(ae.Z,{children:null==n?void 0:n.label})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.updatedAt",defaultMessage:"Updated At"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,t){return R()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")}},{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(t,n,r,a){return[(0,A.jsx)("a",{onClick:function(){re(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,A.jsx)(V.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return ee(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,A.jsx)(F.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.viewCount",defaultMessage:"Views"}),key:"viewCount",dataIndex:"viewCount",hideInSearch:!0,hideInTable:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.clickCount",defaultMessage:"Clicks"}),key:"clickCount",dataIndex:"clickCount",hideInSearch:!0,hideInTable:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.upCount",defaultMessage:"Likes"}),key:"upCount",dataIndex:"upCount",hideInSearch:!0,hideInTable:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.downCount",defaultMessage:"Dislikes"}),key:"downCount",dataIndex:"downCount",hideInSearch:!0,hideInTable:!0},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.isValid",defaultMessage:"Valid"}),key:"valid",dataIndex:"valid",hideInSearch:!0,hideInTable:!0,render:function(e,t){return(0,A.jsx)(A.Fragment,{children:t.valid?"有效":"无效"})}},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.startDate",defaultMessage:"Start Date"}),key:"startDate",dataIndex:"startDate",hideInSearch:!0,hideInTable:!0,render:function(e,t){return t.startDate?R()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):""}},{title:(0,A.jsx)(l.FormattedMessage,{id:"faq.endDate",defaultMessage:"End Date"}),key:"endDate",dataIndex:"endDate",hideInSearch:!0,hideInTable:!0,render:function(e,t){return t.endDate?R()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):""}}],ne=function(){h(void 0),u(!1),j(!0)},re=function(e){h(e),u(!0),j(!0)},oe=function(){var t=v()(m()().mark((function t(r){var a,o;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),i?w.yw.loading(e.formatMessage({id:"updating"})):w.yw.loading(e.formatMessage({id:"creating"})),!i){t.next=8;break}return t.next=5,(0,je.y)(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,je.kh)(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createFaq response:",r,a),200===a.code?(w.yw.destroy(),w.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),j(!1),null===(o=n.current)||void 0===o||o.reloadAndRest()):(w.yw.destroy(),w.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ie=function(){var e=v()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleImport"),X(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[K,Q]);var se=function(){var t=v()(m()().mark((function t(){return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,H.HK)(o.QPQ,null==L?void 0:L.uid,null==K?void 0:K.uid,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ue=function(){var e=v()(m()().mark((function e(){var t;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",T,Y),t=localStorage.getItem(o.LA8),window.open((0,D.kG)()+"/api/v1/faq/export?"+new URLSearchParams({pageNumber:String(T-1),pageSize:String(Y),categoryUid:(null==Q?void 0:Q.uid)===o.zBg?"":null==Q?void 0:Q.uid,kbUid:null==K?void 0:K.uid,orgUid:(null==L?void 0:L.uid)||"",accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.Z,{columns:te,actionRef:n,cardBordered:!0,request:function(){var t=v()(m()().mark((function t(n,r,a){var i,s,u,l,d;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),w.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),i=n.current,s=n.pageSize,u=p()(n,De),U(i),N(s),l=c()({pageNumber:i-1,pageSize:s,categoryUid:(null==Q?void 0:Q.uid)===o.zBg?"":null==Q?void 0:Q.uid,kbUid:null==K?void 0:K.uid,orgUid:null==L?void 0:L.uid},u),t.next=8,(0,je.pf)(l);case 8:return d=t.sent,console.log("getAllFaqs response:",l,d),w.yw.destroy(),200===d.code||w.yw.error(d.message),t.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 13:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:t(null==K?void 0:K.name)+" - 常见问题",tooltip:"所添加FAQ内容会自动添加到 ’拆分‘ 列表中 ",toolBarRender:function(){return[(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(P.Z,{}),type:"primary",onClick:ne,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"button"),(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(ke.Z,{}),type:"primary",onClick:ie,children:e.formatMessage({id:"import",defaultMessage:"Import"})},"button"),(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(z.Z,{}),type:"primary",onClick:ue,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button"),(0,A.jsx)(F.ZP,{icon:(0,A.jsx)(Se.Z,{}),type:"link",onClick:function(){(0,D.IY)()},children:e.formatMessage({id:"download.template",defaultMessage:"Download Template"})},"download")]},scroll:{x:1300},columnsState:{persistenceKey:"faq-table-columns",defaultValue:{viewCount:{show:!1},clickCount:{show:!1},upCount:{show:!1},downCount:{show:!1},valid:{show:!1},startDate:{show:!1},endDate:{show:!1}}}}),b&&(0,A.jsx)(Ze,{isEdit:i,open:b,faq:g,onClose:function(){return j(!1)},onSubmit:oe}),J&&(0,A.jsx)(B.Z,{type:o.bE7,isModalOpen:J,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),X(!1),null==n||n.current.reload(),se()},handleCancel:function(){console.log("handleUploadDragCancel"),X(!1),null==n||n.current.reload()}})]})},Ue=function(){var e=(0,l.useIntl)(),t=(0,s.useMemo)((function(){return[{key:"split",label:e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"}),children:(0,A.jsx)(be,{})},{key:"file",label:e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,A.jsx)(K,{})},{key:"faq",label:e.formatMessage({id:"pages.robot.kb.faq",defaultMessage:"FAQ"}),children:(0,A.jsx)(Te,{})},{key:"text",label:e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,A.jsx)(fe,{})}]}),[e]);return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(u.Z,{items:t})})},Fe=a.Z.Sider,qe=a.Z.Content,Ae=function(){var e=(0,r.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,A.jsx)("div",{children:(0,A.jsxs)(a.Z,{children:[(0,A.jsx)(Fe,{style:t,children:(0,A.jsx)(i.Z,{type:o.QPQ})}),(0,A.jsx)(a.Z,{children:(0,A.jsx)(qe,{style:n,children:(0,A.jsx)(Ue,{})})})]})})}}}]);