"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[642],{17482:function(ie,B,r){r.r(B),r.d(B,{default:function(){return t}});var $=r(19245),F=r(21612),w=r(67294),p=r(15009),Z=r.n(p),O=r(99289),N=r.n(O),z=r(5574),M=r.n(z),J=r(64789),R=r(33277),v=r(8232),E=r(45360),K=r(85576),P=r(83863),j=r(96365),k=r(14726),e=r(85893),G=function(){var u=v.Z.useForm(),a=M()(u,1),d=a[0],g=(0,w.useState)(!1),C=M()(g,2),S=C[0],A=C[1],D=(0,$.u)(function(m){return{depCurrent:m.depCurrent,depOptions:m.depOptions,departments:m.departments,createMem:m.createMem,setDepCurrent:m.setDepCurrent}}),b=D.depCurrent,H=D.depOptions,te=D.departments,Y=D.createMem,q=D.setDepCurrent,_=(0,w.useMemo)(function(){return b.name==="DEPT_CS"?b.members:[]},[b]),ee=function(){A(!0)},re=function(){var m=N()(Z()().mark(function f(){var T,y,x,V,ae,I,ue,le;return Z()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(T=d.getFieldValue("jobNo"),y=d.getFieldValue("realname"),x=d.getFieldValue("seatNo"),V=d.getFieldValue("telephone"),ae=d.getFieldValue("mobile"),I=d.getFieldValue("email"),ue=b.did,console.log("realname",y),b.did!==""){L.next=11;break}return E.ZP.error("please choose a department"),L.abrupt("return");case 11:y?(le={jobNo:T,realname:y,seatNo:x,telephone:V,mobile:ae,email:I,depDid:ue},Y(le),A(!1)):E.ZP.error("name should not be null");case 12:case"end":return L.stop()}},f)}));return function(){return m.apply(this,arguments)}}(),se=function(){A(!1)},ne=function(){console.log("new mem"),ee()},h=function(f){console.log("select checked",f),q(f)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.Z,{title:"\u6DFB\u52A0\u6210\u5458",open:S,onOk:re,onCancel:se,children:(0,e.jsxs)(v.Z,{form:d,name:"memForm",initialValues:{dep_did:b.did},children:[(0,e.jsx)(v.Z.Item,{label:"\u90E8\u95E8",name:"dep_did",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u90E8\u95E8!"}],children:(0,e.jsx)(P.Z,{options:H,onChange:h})}),(0,e.jsx)(v.Z.Item,{label:"\u59D3\u540D",name:"realname",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D!"}],children:(0,e.jsx)(j.Z,{})}),(0,e.jsx)(v.Z.Item,{label:"\u624B\u673A\u53F7",name:"mobile",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7!"}],children:(0,e.jsx)(j.Z,{})}),(0,e.jsx)(v.Z.Item,{label:"\u5DE5\u53F7",name:"jobNo",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5DE5\u53F7!"}],children:(0,e.jsx)(j.Z,{})}),(0,e.jsx)(v.Z.Item,{label:"\u5EA7\u4F4D\u53F7",name:"seatNo",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5EA7\u4F4D\u53F7!"}],children:(0,e.jsx)(j.Z,{})}),(0,e.jsx)(v.Z.Item,{label:"\u5206\u673A\u53F7",name:"telephone",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u5206\u673A\u53F7!"}],children:(0,e.jsx)(j.Z,{})}),(0,e.jsx)(v.Z.Item,{label:"\u90AE\u7BB1",name:"email",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"}],children:(0,e.jsx)(j.Z,{})})]})}),(0,e.jsx)(k.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(J.Z,{}),onClick:ne,children:"create agent"}),(0,e.jsx)(R.Rs,{rowKey:"id",headerTitle:"DEPT_CS",dataSource:_,showActions:"hover",editable:{onSave:function(){var m=N()(Z()().mark(function T(y,x,V){return Z()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return console.log(y,x,V),I.abrupt("return",!0);case 2:case"end":return I.stop()}},T)}));function f(T,y,x){return m.apply(this,arguments)}return f}()},metas:{title:{dataIndex:"realname"},avatar:{dataIndex:"user.avatar",editable:!1},description:{dataIndex:"user.description",render:function(f){return(0,e.jsx)("div",{children:f})}},actions:{render:function(f,T,y,x){return[(0,e.jsx)("a",{onClick:function(){x==null||x.startEditable(T.mid)},children:"\u7F16\u8F91"},"link")]}}}})]})},U=G,W=r(68508),Q=function(){var u=v.Z.useForm(),a=M()(u,1),d=a[0],g=(0,w.useState)(!1),C=M()(g,2),S=C[0],A=C[1],D=(0,$.u)(function(h){return{depCurrent:h.depCurrent,departments:h.departments,createDep:h.createDep,setDepCurrent:h.setDepCurrent}}),b=D.depCurrent,H=D.departments,te=D.createDep,Y=D.setDepCurrent,q=(0,w.useMemo)(function(){return H.filter(function(h){return h.label==="DEPT_CS"})},[H]),_=function(){A(!0)},ee=function(){var h=N()(Z()().mark(function m(){var f;return Z()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:f=d.getFieldValue("nickname"),console.log("nickname",f),f?(te(f),A(!1)):E.ZP.error("\u6635\u79F0\u4E0D\u80FD\u4E3A\u7A7A");case 3:case"end":return y.stop()}},m)}));return function(){return h.apply(this,arguments)}}(),re=function(){A(!1)},se=function(){console.log("new dep"),_()},ne=function(m){Y(m.key)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{onClick:ne,defaultSelectedKeys:[b.did],mode:"inline",items:q}),(0,e.jsx)(K.Z,{title:"\u521B\u5EFA\u90E8\u95E8",open:S,onOk:ee,onCancel:re,children:(0,e.jsx)(v.Z,{form:d,name:"depForm",style:{maxWidth:400},children:(0,e.jsx)(v.Z.Item,{label:"\u90E8\u95E8\u540D\u79F0",name:"nickname",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0!"}],children:(0,e.jsx)(j.Z,{})})})})]})},X=Q,i=F.Z.Sider,o=F.Z.Content,c={margin:"10px",minHeight:120,backgroundColor:"#EEFAE0"},n={margin:"10px",backgroundColor:"#EEFAE0",borderRight:"1px solid #ccc"},l=function(){var u=(0,$.u)(function(a){return a.queryOrgs});return(0,w.useEffect)(function(){u()},[]),(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(i,{style:n,children:(0,e.jsx)(X,{})}),(0,e.jsx)(F.Z,{children:(0,e.jsx)(o,{style:c,children:(0,e.jsx)(U,{})})})]})},t=l},19245:function(ie,B,r){r.d(B,{u:function(){return X}});var $=r(19632),F=r.n($),w=r(15009),p=r.n(w),Z=r(99289),O=r.n(Z),N=r(97857),z=r.n(N),M=r(86745);function J(i){return R.apply(this,arguments)}function R(){return R=O()(p()().mark(function i(o){return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,M.request)("/api/org",{method:"POST",data:{nickname:o,client:"web"}}));case 1:case"end":return n.stop()}},i)})),R.apply(this,arguments)}function v(i,o,c){return E.apply(this,arguments)}function E(){return E=O()(p()().mark(function i(o,c,n){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,M.request)("/api/v1/dep/create",{method:"POST",data:{nickname:o,parent_did:c,org_oid:n,client:"web"}}));case 1:case"end":return t.stop()}},i)})),E.apply(this,arguments)}function K(i){return P.apply(this,arguments)}function P(){return P=O()(p()().mark(function i(o){return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,M.request)("/api/v1/mem/create",{method:"POST",data:z()(z()({},o),{},{client:"web"})}));case 1:case"end":return n.stop()}},i)})),P.apply(this,arguments)}function j(i,o){return k.apply(this,arguments)}function k(){return k=O()(p()().mark(function i(o,c){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,M.request)("/api/v1/org/query",{method:"GET",params:{pageNumber:o,pageSize:c,client:"web"}}));case 1:case"end":return l.stop()}},i)})),k.apply(this,arguments)}function e(i){return G.apply(this,arguments)}function G(){return G=_asyncToGenerator(_regeneratorRuntime().mark(function i(o){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/org",_objectSpread({method:"GET",params:{client:"web"}},o||{})));case 1:case"end":return n.stop()}},i)})),G.apply(this,arguments)}var U=r(64529),W=r(782),Q=r(1151),X=(0,U.Ue)()((0,W.mW)((0,W.tJ)((0,Q.n)(function(i,o){return{orgCurrent:{oid:"",name:"",avatar:"",description:""},depOptions:[],depCurrent:{did:""},departments:[],createOrg:function(){var c=O()(p()().mark(function l(t){var s;return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,J(t);case 2:s=a.sent,console.log("createOrg:",s),s.code==200&&o().transferOrgToTree(s.data);case 5:case"end":return a.stop()}},l)}));function n(l){return c.apply(this,arguments)}return n}(),createDep:function(){var c=O()(p()().mark(function l(t){var s,u,a,d;return p()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=o().orgCurrent.oid,C.next=3,v(t,"",s);case 3:u=C.sent,console.log("createDep:",u),u.code==200&&(a={label:u.data.name,key:u.data.did},d={label:u.data.name,value:u.data.did},i({depOptions:[].concat(F()(o().depOptions),[d]),departments:[].concat(F()(o().departments),[a])}));case 6:case"end":return C.stop()}},l)}));function n(l){return c.apply(this,arguments)}return n}(),setDepCurrent:function(n){for(var l=o().orgCurrent.departments,t=0;t<l.length;t++){var s=l[t];s.did===n&&i({depCurrent:s})}},createMem:function(){var c=O()(p()().mark(function l(t){var s,u,a,d,g;return p()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,K(t);case 2:if(s=S.sent,console.log("createMem:",t.depDid,s),s.code==200){for(u=o().orgCurrent,a=u.departments,d=0;d<a.length;d++)g=a[d],g.did===t.depDid&&(g.members=[s.data].concat(F()(g.members)),g.did===o().depCurrent.did&&i({depCurrent:g})),a[d]=g;u.departments=a,i({orgCurrent:u})}case 5:case"end":return S.stop()}},l)}));function n(l){return c.apply(this,arguments)}return n}(),queryOrgs:function(){var c=O()(p()().mark(function l(){var t,s;return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,j(0,10);case 2:if(t=a.sent,console.log("refresh orgs:",t),t.data.content.length!=0){a.next=6;break}return a.abrupt("return");case 6:s=t.data.content[0],o().transferOrgToTree(s);case 8:case"end":return a.stop()}},l)}));function n(){return c.apply(this,arguments)}return n}(),transferOrgToTree:function(n){for(var l=[],t=[],s=0;s<n.departments.length;s++){var u=n.departments[s],a={label:u.name,key:u.did};t.push(a);var d={label:u.name,value:u.did};l.push(d)}i({orgCurrent:n,depOptions:l,departments:t})},deleteOrgCache:function(){return i({},!0)}}}),{name:"ORGANIZTION_STORE"})))}}]);
