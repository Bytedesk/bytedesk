"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2522],{82863:function(e,t,n){n.d(t,{Jr:function(){return f},LF:function(){return d},Oh:function(){return h},WS:function(){return g}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36605:function(e,t,n){n.d(t,{HH:function(){return h},T:function(){return f},fx:function(){return g},mK:function(){return d}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92053:function(e,t,n){n.d(t,{V:function(){return l},c:function(){return d}});var r=n(90819),s=n.n(r),o=n(89933),a=n.n(o),i=n(55735),u=n(30921);function l(){return c.apply(this,arguments)}function c(){return(c=a()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return p.apply(this,arguments)}function p(){return(p=a()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},27522:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return h},t5:function(){return g},v_:function(){return f}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(55735),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},84282:function(e,t,n){n.r(t),n.d(t,{default:function(){return le}});var r=n(75574),s=n(44194),o=n(90819),a=n.n(o),i=n(89933),u=n.n(i),l=n(45332),c=n.n(l),d=n(66310),p=n(53530),f=n(27487),m=n(75365),g=n(9452),v=n(84288),h=n(15722),b=n(82669),y=n(30921),x=n(23864),w=n(40612),k=n(55735),M=n(69169),q=n(4499),F=n(84881),j=n(31549),S=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=(0,y.useIntl)(),o=M.A.useForm(),a=c()(o,1)[0],i=(0,w.u)((function(e){return e.currentOrg}));return(0,j.jsx)("div",{children:(0,j.jsx)(p.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:function(){console.log("handleSaveRobot"),a.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},orgUid:null==i?void 0:i.uid};console.log("robotObject:",t),r(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){n()},children:(0,j.jsxs)(M.A,{form:a,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,j.jsx)(q.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,j.jsx)(F.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:k.f4h,defaultMessage:"Service"}),value:k.f4h}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})},R=n(66916),Z=n(86803),C=n(76750),V=function(){var e=(0,x.Z)().isDarkMode,t=(0,y.useIntl)(),n=((0,s.useRef)(!1),(0,C.Z)()),r=n.translateString,o=n.translateStringTranct,i=(0,d.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,insertRobot:e.insertRobot,deleteCurrentRobot:e.deleteCurrentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),l=i.robotResult,M=i.currentRobot,q=i.insertRobot,F=i.deleteCurrentRobot,V=i.setRobotResult,U=i.setCurrentRobot,T=(0,w.u)((function(e){return e.currentOrg})),P=p.Z.useModal(),O=c()(P,2),A=O[0],E=O[1],I=function(){var e=u()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),Z.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,R.gf)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(Z.yw.destroy(),Z.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),F(n.uid)):(Z.yw.destroy(),Z.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=u()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.yw.loading("loading"),t={pageNumber:0,pageSize:100,categoryUid:"",level:k.whQ,type:k.f4h,orgUid:null==T?void 0:T.uid},e.next=4,(0,R.p0)(t);case 4:n=e.sent,console.log("queryRobotsByOrg: ",n,t),200===n.code?(Z.yw.destroy(),V(n),!M&&n.data.content.length>0&&U(n.data.content[0])):(Z.yw.destroy(),Z.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){L()}),[]);var z=(0,s.useState)(!1),N=c()(z,2),_=N[0],K=N[1],X=function(){var e=u()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.yw.loading(t.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=3,(0,R.lg)(n);case 3:r=e.sent,console.log("handleSaveRobot response:",r),200===r.code?(Z.yw.destroy(),Z.yw.success(t.formatMessage({id:"create.success"})),q(r.data),K(!1)):(Z.yw.destroy(),K(!1),Z.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(e){return t.formatMessage({id:null==e?void 0:e.type,defaultMessage:null==e?void 0:e.type})};return(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{margin:10},children:(0,j.jsxs)(f.Z,{gap:"small",align:"flex-start",children:[(0,j.jsx)(m.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(b.Z,{}),onClick:function(){K(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,j.jsx)(m.ZP,{size:"small",onClick:L,children:t.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,j.jsx)(m.ZP,{onClick:function(){return function(e){A.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(h.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(e.nickname),"】？"),onOk:function(){I(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(M)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==M?void 0:M.uid),children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,j.jsx)(g.Z,{itemLayout:"horizontal",dataSource:l.data.content,renderItem:function(t,n){return(0,j.jsx)(g.Z.Item,{style:(null==M?void 0:M.uid)===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){U(t)},children:(0,j.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,j.jsx)(v.C,{src:t.avatar}),title:(0,j.jsx)(j.Fragment,{children:o(null==t?void 0:t.nickname)}),description:B(t)})})}}),_&&(0,j.jsx)(S,{open:_,onClose:function(){K(!1)},onSubmit:X}),E]})},U=n(8247),T=(n(55930),n(82211)),P=(n(73170),n(9389),n(73193)),O=n.n(P),A=n(6631),E=n(59908),I=n(32350),L=n(16309),z=(n(26286),function(){var e,t=M.A.useForm(),n=c()(t,1)[0],r=(0,y.useIntl)(),o=(0,C.Z)().translateString,i=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),l=i.currentRobot,p=i.setCurrentRobot,f=(0,s.useState)(""),g=c()(f,2),h=g[0],b=g[1],x=(0,s.useState)(o(null==l||null===(e=l.serviceSettings)||void 0===e?void 0:e.welcomeTip)||""),w=c()(x,2),k=w[0],F=w[1];(0,s.useEffect)((function(){var e;l&&(n.setFieldValue("nickname",o(null==l?void 0:l.nickname)),F(o(null==l||null===(e=l.serviceSettings)||void 0===e?void 0:e.welcomeTip)),n.setFieldValue("description",o(null==l?void 0:l.description)))}),[l]);var S=function(){var e=u()(a()().mark((function e(t){var n,s,o,i,u,c,d,f;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),Z.yw.loading(r.formatMessage({id:"updating"})),d=O()(O()({},l),{},{serviceSettings:O()(O()({},l.serviceSettings),{},{welcomeTip:k,welcomeFaqUids:null==l||null===(n=l.serviceSettings)||void 0===n||null===(n=n.welcomeFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),quickFaqUids:null==l||null===(s=l.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==l||null===(o=l.serviceSettings)||void 0===o||null===(o=o.faqs)||void 0===o?void 0:o.map((function(e){return e.uid})),guessFaqUids:null==l||null===(i=l.serviceSettings)||void 0===i||null===(i=i.guessFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),hotFaqUids:null==l||null===(u=l.serviceSettings)||void 0===u||null===(u=u.hotFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),shortcutFaqUids:null==l||null===(c=l.serviceSettings)||void 0===c||null===(c=c.shortcutFaqs)||void 0===c?void 0:c.map((function(e){return e.uid}))}),nickname:t.nickname,description:t.description,avatar:h}),console.log("robotObject:",d),e.next=6,(0,R.$l)(d);case 6:f=e.sent,console.log("updateRobot response:",f),200===f.code?(Z.yw.success(r.formatMessage({id:"update.success"})),p(f.data)):Z.yw.error(f.message),Z.yw.destroy();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=u()(a()().mark((function e(t){var n,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUploadSuccess:",t),b(t),n=O()(O()({},l),{},{avatar:t}),e.next=5,(0,R.n1)(n);case 5:s=e.sent,console.log("updateAvatar response:",s),200===s.code?(Z.yw.success(r.formatMessage({id:"update.success"})),p(s.data)):Z.yw.error(s.message);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){b(null==l?void 0:l.avatar)}),[l]),(0,j.jsxs)(M.A,{form:n,style:{marginLeft:"20px"},onFinish:S,children:[(0,j.jsx)(L.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return console.log("Upload event:",e),Array.isArray(e)?e:null==e?void 0:e.fileList},label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,j.jsxs)(A.G,{onSuccess:V,onError:function(e){console.log("handleUploadError:",e)},children:[(0,j.jsx)(v.C,{src:h}),(0,j.jsx)(m.ZP,{icon:(0,j.jsx)(E.Z,{}),children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,j.jsx)(q.Z,{width:"md",name:"nickname",label:r.formatMessage({id:"agent.info.nickname"}),rules:[{required:!0,message:r.formatMessage({id:"agent.info.nickname.required"})}]}),(0,j.jsx)(I.Z,{width:"md",name:"description",label:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})}),N=n(27522),_=n(5651),K=function(){var e=(0,y.useIntl)(),t=(0,y.useNavigate)(),n=M.A.useForm(),r=c()(n,1)[0],o=(0,C.Z)().translateString,i=(0,s.useState)(),l=c()(i,2),p=l[0],f=l[1],g=(0,w.u)((function(e){return e.currentOrg})),v=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),h=v.currentRobot,b=v.setCurrentRobot,x=function(){var t=u()(a()().mark((function t(){var n,r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,type:k.QPQ,orgUid:null==g?void 0:g.uid},t.next=4,(0,N.AP)(n);case 4:r=t.sent,console.log("getKeywordBase response:",n,r),Z.yw.destroy(),200===r.code?f(r):Z.yw.error(r.message);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,s.useEffect)((function(){x()}),[]),(0,s.useEffect)((function(){r.setFieldValue("kbUid",null==h?void 0:h.kbUid)}),[h]);var q=function(){var t=u()(a()().mark((function t(n){var r,s,o,i,u,l,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("onFinish values:",n),l=O()(O()({},h),{},{serviceSettings:O()(O()({},h.serviceSettings),{},{faqUids:null==h||null===(r=h.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==h||null===(s=h.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==h||null===(o=h.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==h||null===(i=h.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==h||null===(u=h.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),kbUid:n.kbUid}),console.log("robotObject:",l),t.next=5,(0,R.$l)(l);case 5:c=t.sent,console.log("updateRobot response:",c),200===c.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"update.success"})),b(c.data)):(Z.yw.destroy(),Z.yw.error(c.message));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,j.jsx)("div",{children:(0,j.jsxs)(M.A,{form:r,onFinish:q,children:[(0,j.jsx)(F.Z,{width:"md",name:"kbUid",label:"知识库",options:null==p?void 0:p.data.content.map((function(e){return{value:e.uid,label:o(e.name)}})),fieldProps:{onChange:function(e){console.log("kbUid:",e)}}}),(0,j.jsx)(M.A.Item,{children:(0,j.jsx)(m.ZP,{icon:(0,j.jsx)(_.Z,{}),onClick:function(){t("/kb/llm/data")},children:"添加大模型知识库"},"github")})]})})},X=n(43705),B=n(71469),Q=n(50796),G=n(36605),D=n(82863),H=n(48708),W=n(79907),$=n(92053),J=function(){var e=(0,y.useIntl)(),t=M.A.useForm(),n=c()(t,1)[0],r=(0,C.Z)().translateString,o=(0,w.u)((function(e){return e.currentOrg})),i=(0,s.useState)([]),l=c()(i,2),p=l[0],f=l[1],g=(0,s.useState)([]),v=c()(g,2),h=v[0],b=v[1],x=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),q=x.currentRobot,S=x.setCurrentRobot;(0,s.useEffect)((function(){var e,t,s,o,a,i,u,l;n.setFieldValue("enabled",null==q||null===(e=q.llm)||void 0===e?void 0:e.enabled),n.setFieldValue("topK",null==q||null===(t=q.llm)||void 0===t?void 0:t.topK),n.setFieldValue("scoreThreshold",null==q||null===(s=q.llm)||void 0===s?void 0:s.scoreThreshold),n.setFieldValue("provider",null==q||null===(o=q.llm)||void 0===o?void 0:o.provider),n.setFieldValue("model",null==q||null===(a=q.llm)||void 0===a?void 0:a.model),n.setFieldValue("temperature",null==q||null===(i=q.llm)||void 0===i?void 0:i.temperature),n.setFieldValue("prompt",r(null==q||null===(u=q.llm)||void 0===u?void 0:u.prompt)),n.setFieldValue("contextMsgCount",null==q||null===(l=q.llm)||void 0===l?void 0:l.contextMsgCount)}),[q]);var V=function(){var e=u()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid,level:k.whQ},e.next=4,(0,G.mK)(t);case 4:n=e.sent,console.log("queryLlmProvidersByOrg result:",n),200===n.code?f(n.data.content||[]):Z.yw.error(n.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){V();A({uid:"",name:"zhipu"})}),[]);var U=function(){var t=u()(a()().mark((function t(n){var r,s,o,i,u,l,c,d;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSubmit",n),Z.yw.loading(e.formatMessage({id:"updating"})),c=O()(O()({},q),{},{serviceSettings:O()(O()({},q.serviceSettings),{},{welcomeFaqUids:null==q||null===(r=q.serviceSettings)||void 0===r||null===(r=r.welcomeFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null===(s=q.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),quickFaqUids:null==q||null===(o=q.serviceSettings)||void 0===o||null===(o=o.quickFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),guessFaqUids:null==q||null===(i=q.serviceSettings)||void 0===i||null===(i=i.guessFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),hotFaqUids:null==q||null===(u=q.serviceSettings)||void 0===u||null===(u=u.hotFaqs)||void 0===u?void 0:u.map((function(e){return e.uid})),shortcutFaqUids:null==q||null===(l=q.serviceSettings)||void 0===l||null===(l=l.shortcutFaqs)||void 0===l?void 0:l.map((function(e){return e.uid}))}),llm:O()(O()({},q.llm),{},{enabled:n.enabled,topK:n.topK,scoreThreshold:n.scoreThreshold,provider:n.provider,model:n.model,temperature:n.temperature,prompt:n.prompt,contextMsgCount:n.contextMsgCount})}),console.log("robotObject:",c),t.next=6,(0,R.$l)(c);case 6:d=t.sent,console.log("updateRobot response:",d),200===d.code?(Z.yw.destroy(),Z.yw.success(e.formatMessage({id:"update.success"})),S(d.data)):(Z.yw.destroy(),Z.yw.error(d.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=function(){var e=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("pingOllama"),e.next=3,(0,$.V)();case 3:t=e.sent,console.log("getOllamaServerStatus: ",t),200===t.code&&t.data?P():Z.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=u()(a()().mark((function e(){var t,r,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,(0,$.c)();case 3:t=e.sent,console.log("getOllamaLocalModels: ",t),200===t.code?(r=t.data.map((function(e){return{value:e.name,label:e.name}})),b(r),0===r.length?n.setFieldValue("model",void 0):(o=null==q||null===(s=q.llm)||void 0===s?void 0:s.model)&&r.some((function(e){return e.value===o}))?n.setFieldValue("model",o):n.setFieldValue("model",r[0].value)):Z.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var t=u()(a()().mark((function t(r){var s,i,u,l,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Z.yw.loading(e.formatMessage({id:"loading"})),t.prev=1,s={pageNumber:0,pageSize:50,providerName:null==r?void 0:r.name,orgUid:null==o?void 0:o.uid,level:k.whQ},t.next=5,(0,D.LF)(s);case 5:i=t.sent,console.log("queryLlmModelsByOrg response:",i,s),200===i.code?(u=i.data.content.map((function(e){return{value:e.name,label:e.nickname}})),b(u),0===u.length?n.setFieldValue("model",void 0):(c=null==q||null===(l=q.llm)||void 0===l?void 0:l.model)&&u.some((function(e){return e.value===c}))?n.setFieldValue("model",c):n.setFieldValue("model",u[0].value)):Z.yw.error(i.message),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Failed to fetch models:",t.t0),Z.yw.error(e.formatMessage({id:"error"}));case 14:return t.prev=14,Z.yw.destroy(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,10,14,17]])})));return function(e){return t.apply(this,arguments)}}(),E=function(){var e=u()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=p.find((function(e){return e.name===t})),console.log("selectedProvider:",n),null!=n&&n.name&&("ollama"===n.name?T():A(n));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(M.A,{form:n,size:"large",submitter:{render:function(e,t){return[(0,j.jsx)(m.ZP,{type:"default",onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields()},children:"重置"},"reset"),(0,j.jsx)(m.ZP,{type:"primary",onClick:function(){var t;null===(t=e.form)||void 0===t||t.submit()},children:"保存"},"submit")]},submitButtonProps:{size:"large",htmlType:"button"}},onFinish:U,children:[(0,j.jsx)(H.Z,{width:"lg",name:"enabled",label:"启用大模型",tooltip:"启用大模型后，将会关闭关键词。用户在发送消息时，将会直接请求大模型。"}),(0,j.jsx)(I.Z,{width:"lg",name:"prompt",label:"提示词",placeholder:"请输入提示词",rules:[{required:!0,message:"请输入提示词"}]}),(0,j.jsx)(F.Z,{width:"lg",name:"provider",label:"AI 供应商",options:p.map((function(e){return{value:e.name,label:r(e.nickname)}})),onChange:E,rules:[{required:!0,message:"请选择 AI 供应商"}]}),(0,j.jsx)(F.Z,{width:"lg",name:"model",label:"大模型",options:h,rules:[{required:!0,message:"请选择大模型"}]}),(0,j.jsx)(W.Z,{width:"lg",label:"温度",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"请输入温度"}]}),(0,j.jsx)(W.Z,{width:"lg",label:"上下文消息数",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"请输入上下文消息数"}]})]})})},Y=(n(54166),n(75808)),ee=n(40836),te=n(98473),ne=n(23635),re=function(){var e=(0,y.useIntl)(),t=(0,s.useMemo)((function(){return[{key:"kb",label:(0,j.jsx)(y.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,j.jsx)(K,{})},{key:"faq",label:(0,j.jsx)(y.FormattedMessage,{id:"menu.kbase.faq",defaultMessage:"FAQ"}),children:(0,j.jsx)(X.Z,{type:k._X4})},{key:"quickFaqs",label:(0,j.jsx)(y.FormattedMessage,{id:"menu.kbase.quickbutton",defaultMessage:"Quick Button"}),children:(0,j.jsx)(B.Z,{type:k._X4})},{key:"llm",label:(0,j.jsx)(y.FormattedMessage,{id:"llm",defaultMessage:"LLM"}),children:(0,j.jsx)(J,{})},{key:"rate",label:(0,j.jsx)(y.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,j.jsx)(ne.Z,{type:k._X4})},{key:"right",label:(0,j.jsx)(y.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,j.jsx)(ee.Z,{type:k._X4})},{key:"popup",label:(0,j.jsx)(y.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,j.jsx)(Y.Z,{type:k._X4})},{key:"trigger",label:(0,j.jsx)(y.FormattedMessage,{id:"trigger",defaultMessage:"Trigger"}),children:(0,j.jsx)(te.Z,{type:k._X4})},{key:"inputassociation",label:(0,j.jsx)(y.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,j.jsx)(Q.Z,{type:k._X4})}]}),[e]);return(0,j.jsx)(U.Z,{tabPosition:"left",items:t})},se=n(14238),oe=function(){var e=(0,y.useIntl)(),t=(0,s.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,j.jsx)(z,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,j.jsx)(se.Z,{type:k._X4})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,j.jsx)(re,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,j.jsx)(T.Z,{type:k._X4})}]}),[e]);return(0,j.jsx)(U.Z,{defaultActiveKey:"basic",items:t})},ae=n(96865),ie=r.Z.Sider,ue=r.Z.Content,le=function(){var e=(0,ae.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,s=e.contentStyle;return(0,j.jsxs)(r.Z,{children:[(0,j.jsx)(ie,{width:n,style:t,children:(0,j.jsx)(V,{})}),(0,j.jsx)(r.Z,{children:(0,j.jsx)(ue,{style:s,children:(0,j.jsx)(oe,{})})})]})}}}]);