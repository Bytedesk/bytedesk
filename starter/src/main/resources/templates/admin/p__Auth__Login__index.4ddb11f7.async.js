"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{19345:function(b,S,a){a.r(S),a.d(S,{default:function(){return Te}});var E=a(15009),o=a.n(E),L=a(97857),p=a.n(L),M=a(99289),T=a.n(M),x=a(5574),v=a.n(x),D=a(98661),$=a(10915),G=a(68262),H=a(24556),t=a(86745),Z=a(9361),J=a(48096),V=a(28459),Y=a(31418),w=a(67294),X=a(73935),Q=a(60247),i=a(80049),q=a(63998),k=a(39825),I=a(85615),_=a(99702),ee=a(87547),z=a(94149),O=a(5966),e=a(85893),ae=function(n){var c=n.loginType,g=(0,t.useIntl)();return(0,e.jsx)(e.Fragment,{children:c==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(ee.Z,{})},placeholder:g.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u90AE\u7BB1"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"})}]}),(0,e.jsx)(O.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(z.Z,{})},placeholder:g.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]})})},se=ae,ne=a(24454),re=a(16434),te=a(38925),oe=function(n){var c=n.loginType,g=(0,t.useIntl)();return(0,e.jsx)(e.Fragment,{children:c==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(ne.Z,{})},name:"mobile",placeholder:g.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,e.jsx)(re.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(z.Z,{})},captchaProps:{size:"large"},placeholder:g.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(A,h){return A?"".concat(h," ").concat(g.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):g.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],onGetCaptcha:function(){var U=T()(o()().mark(function A(h){var B,F;return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(console.log("mobile:",h),!(h&&h.length===11)){f.next=12;break}return B={mobile:h,type:I.yC,platform:I.iw},f.next=5,(0,D.Y7)(B);case 5:if(F=f.sent,F.code===200){f.next=9;break}return i.yw.error(F.message),f.abrupt("return");case 9:i.yw.success(F.message),f.next=13;break;case 12:i.yw.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 13:case"end":return f.stop()}},A)}));return function(A){return U.apply(this,arguments)}}()}),(0,e.jsx)(te.Z,{message:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},ie=oe,le=a(10397),ue=function(n){var c=n.loginType;return(0,e.jsx)(e.Fragment,{children:c==="scan"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(le.Z,{style:{margin:"auto"},value:"login"})})})},de=ue,C=a(66419),ge=Z.Z.defaultAlgorithm,ce=Z.Z.darkAlgorithm,fe=function(){var n=(0,H.l)(function(c){var g=c.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:g.borderRadius,":hover":{backgroundColor:g.colorBgTextHover}}});return(0,e.jsx)("div",{className:n,"data-lang":!0,children:t.SelectLang&&(0,e.jsx)(t.SelectLang,{})})},me=function(){var n=(0,C.hX)();return(0,e.jsx)("img",{alt:"logo",src:n})},ve=function(){var n=(0,C.lk)();return(0,e.jsx)(t.FormattedMessage,{id:n,defaultMessage:"\u5FAE\u8BED"})},he=function(){var n=(0,C.z)();return(0,e.jsx)(t.FormattedMessage,{id:n,defaultMessage:"\u5FAE\u8BED"})},pe=function(){var n=(0,t.useIntl)(),c=Z.Z.useToken(),g=c.token,U=(0,k.Z)(),A=U.isDarkMode,h=(0,q.t)(function(u){return u.setAccessToken}),B=(0,w.useState)("mobile"),F=v()(B,2),j=F[0],f=F[1],P=(0,t.useModel)("@@initialState"),Le=P.initialState,Ce=P.loading,Ie=P.refresh,ye=P.setInitialState,je=(0,w.useState)(!1),W=v()(je,2),xe=W[0],Fe=W[1],K=(0,Q.L)(function(u){return u.setUserInfo}),Se=[{key:"account",label:n.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"}),children:(0,e.jsx)(se,{loginType:j})},{key:"mobile",label:n.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"}),children:(0,e.jsx)(ie,{loginType:j})},{key:"scan",label:n.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"\u626B\u7801\u767B\u5F55"}),children:(0,e.jsx)(de,{loginType:j})}];(0,w.useEffect)(function(){var u=window.location.href;(0,C.qx)(C.Hw,u)&&Fe(!0)},[]);var N=function(){var u=T()(o()().mark(function m(l){return o()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:l&&(0,X.flushSync)(function(){ye(function(R){return p()(p()({},R),{},{userInfo:l})})});case 1:case"end":return d.stop()}},m)}));return function(l){return u.apply(this,arguments)}}(),Ae=function(){var u=T()(o()().mark(function m(l){var r,d;return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("handleSubmit values: ",l),i.yw.loading("\u6B63\u5728\u767B\u5F55..."),s.next=5,(0,D.x4)(p()({},l));case 5:r=s.sent,console.log("LoginResult:",r),r.code===200?(i.yw.destroy(),i.yw.success("\u767B\u5F55\u6210\u529F\uFF01"),h(r.data.accessToken),N(r.data.user),K(r.data.user),t.history.push("/")):(i.yw.destroy(),i.yw.error(r.message)),s.next=15;break;case 10:s.prev=10,s.t0=s.catch(0),d=n.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),console.log(s.t0),i.yw.error(d);case 15:case"end":return s.stop()}},m,null,[[0,10]])}));return function(l){return u.apply(this,arguments)}}(),Ee=function(){var u=T()(o()().mark(function m(l){var r,d;return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("handleMobileSubmit values: ",l),i.yw.loading("\u6B63\u5728\u767B\u5F55..."),s.next=5,(0,D.N9)(p()({},l));case 5:r=s.sent,console.log("LoginMobileResult:",r),r.code===200?(i.yw.destroy(),i.yw.success("\u767B\u5F55\u6210\u529F\uFF01"),h(r.data.accessToken),N(r.data.user),K(r.data.user),t.history.push("/")):(i.yw.destroy(),i.yw.error(r.message)),s.next=15;break;case 10:s.prev=10,s.t0=s.catch(0),d=n.formatMessage({id:j==="account"?"pages.login.failure":"pages.login.failureCode",defaultMessage:j==="account"?"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF01":"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),console.log(s.t0),i.yw.error(d);case 15:case"end":return s.stop()}},m,null,[[0,10]])}));return function(l){return u.apply(this,arguments)}}();return(0,e.jsxs)($._Y,{hashed:!1,dark:A,children:[(0,e.jsx)(fe,{}),(0,e.jsx)("div",{style:{backgroundColor:g.colorBgContainer,textAlign:"center",height:"100vh",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:(0,e.jsxs)(G.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:me(),title:ve(),subTitle:he(),initialValues:{},actions:[],onFinish:function(){var u=T()(o()().mark(function m(l){var r,d;return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(j!=="account"){s.next=7;break}return r={username:l.username,password:l.password,platform:I.iw},console.log("login info:",r),s.next=5,Ae(r);case 5:s.next=11;break;case 7:return d={mobile:l.mobile,code:l.code,platform:I.iw},console.log("login mobile info:",d),s.next=11,Ee(d);case 11:case"end":return s.stop()}},m)}));return function(m){return u.apply(this,arguments)}}(),children:[(0,e.jsx)(J.Z,{activeKey:j,onChange:f,centered:!0,items:Se}),(0,e.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,e.jsxs)("div",{style:{float:"right",marginBottom:24},children:[xe&&(0,e.jsx)(t.Link,{to:"/auth/register",children:(0,e.jsx)(t.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})}),(0,e.jsx)("a",{style:{marginLeft:10},href:"http://www.weiyuai.cn/docs",target:"_blank",children:"\u5E2E\u52A9\u6587\u6863"})]})})]})}),(0,e.jsx)(_.Z,{})]})},Me=function(){var n=(0,k.Z)(),c=n.isDarkMode;return(0,e.jsx)(V.ZP,{theme:{algorithm:c?ce:ge},children:(0,e.jsxs)(Y.Z,{children:[(0,e.jsx)(i.ZP,{}),(0,e.jsx)(pe,{})]})})},Te=Me},63998:function(b,S,a){a.d(S,{t:function(){return p}});var E=a(64529),o=a(782),L=a(71381),p=(0,E.Ue)()((0,o.mW)((0,o.tJ)((0,L.n)(function(M,T){return{accessToken:"",setAccessToken:function(v){localStorage.setItem("ACCESS_TOKEN",v),M({accessToken:v})},getAccessToken:function(){return T().accessToken},removeAccessToken:function(){localStorage.removeItem("ACCESS_TOKEN"),M({accessToken:""})}}}),{name:"AUTH_STORE"})))},60247:function(b,S,a){a.d(S,{L:function(){return p}});var E=a(64529),o=a(782),L=a(71381),p=(0,E.Ue)()((0,o.mW)((0,o.tJ)((0,L.n)(function(M,T){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(v){M({userInfo:v})},setDeviceUid:function(v){M({deviceUid:v})},deleteUserInfo:function(){return M({},!0)}}}),{name:"USER_STORE"})))}}]);
