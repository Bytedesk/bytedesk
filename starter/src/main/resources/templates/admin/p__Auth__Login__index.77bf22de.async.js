"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{70401:function(fe,B,e){e.d(B,{$t:function(){return se},a_:function(){return J},vf:function(){return b}});var H=e(15009),p=e.n(H),w=e(97857),n=e.n(w),Y=e(99289),i=e.n(Y),I=e(85615),_=e(86745);function b(m){return O.apply(this,arguments)}function O(){return O=i()(p()().mark(function m(d){return p()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,_.request)("/api/v1/vip/crm/query/visitor/org",{method:"GET",params:n()(n()({},d),{},{client:I.bVn})}));case 1:case"end":return g.stop()}},m)})),O.apply(this,arguments)}function J(){return C.apply(this,arguments)}function C(){return C=i()(p()().mark(function m(){return p()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,_.request)("/visitor/api/v1/kaptcha",{method:"GET",params:{client:I.bVn}}));case 1:case"end":return M.stop()}},m)})),C.apply(this,arguments)}function se(m,d){return te.apply(this,arguments)}function te(){return te=i()(p()().mark(function m(d,M){return p()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,_.request)("/visitor/api/v1/kaptcha/check",{method:"POST",data:{captchaUid:d,captchaCode:M,client:I.bVn}}));case 1:case"end":return o.stop()}},m)})),te.apply(this,arguments)}function u(m){return L.apply(this,arguments)}function L(){return L=_asyncToGenerator(_regeneratorRuntime().mark(function m(d){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",request("/api/v1/visitor/update",{method:"POST",data:_objectSpread(_objectSpread({},d),{},{client:HTTP_CLIENT})}));case 1:case"end":return g.stop()}},m)})),L.apply(this,arguments)}function A(m){return X.apply(this,arguments)}function X(){return X=_asyncToGenerator(_regeneratorRuntime().mark(function m(d){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",request("/api/v1/visitor/delete",{method:"POST",data:_objectSpread(_objectSpread({},d),{},{client:HTTP_CLIENT})}));case 1:case"end":return g.stop()}},m)})),X.apply(this,arguments)}},6144:function(fe,B,e){var H=e(15009),p=e.n(H),w=e(99289),n=e.n(w),Y=e(5574),i=e.n(Y),I=e(70401),_=e(50228),b=e(86745),O=e(55102),J=e(67294),C=e(85893),se=function(u){var L=u.onKaptchaChange,A=u.onKaptchaCheck,X=(0,b.useIntl)(),m=(0,J.useState)(),d=i()(m,2),M=d[0],g=d[1],o=(0,J.useState)(),ce=i()(o,2),ie=ce[0],Q=ce[1],ue=function(){var $=n()(p()().mark(function a(){var k;return p()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(0,I.a_)();case 2:k=T.sent,k.code===200&&(g(k.data.captchaUid),Q(k.data.captchaImage));case 4:case"end":return T.stop()}},a)}));return function(){return $.apply(this,arguments)}}(),ve=function(){var $=n()(p()().mark(function a(k,oe){var T;return p()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,(0,I.$t)(k,oe);case 2:T=q.sent,console.log("checkCaptcha response",T),T.code===200?A&&A(!0):A&&A(!1);case 5:case"end":return q.stop()}},a)}));return function(k,oe){return $.apply(this,arguments)}}();(0,J.useEffect)(function(){ue()},[]);var de=function(a){L&&(L(M,a.target.value),a.target.value&&a.target.value!==""&&a.target.value.trim().length===4?ve(M,a.target.value):A&&A(!1))};return(0,C.jsx)(C.Fragment,{children:ie&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(O.Z,{onChange:de,prefix:(0,C.jsx)(_.Z,{}),placeholder:X.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40}}),(0,C.jsx)("img",{src:ie,alt:"captcha",onClick:ue})]})})};B.Z=se},19345:function(fe,B,e){e.r(B),e.d(B,{default:function(){return Fe}});var H=e(97857),p=e.n(H),w=e(15009),n=e.n(w),Y=e(99289),i=e.n(Y),I=e(5574),_=e.n(I),b=e(98661),O=e(34994),J=e(98082),C=e(10915),se=e(68262),te=e(92879),u=e(86745),L=e(9361),A=e(11941),X=e(28459),m=e(31418),d=e(67294),M=e(73935),g=e(60247),o=e(80049),ce=e(63998),ie=e(39825),Q=e(85615),ue=e(6144),ve=e(87547),de=e(94149),$=e(5966),a=e(85893),k=function(r){var D=r.loginType,S=r.onKaptchaChange,Z=r.onKaptchaCheck,K=(0,u.useIntl)(),re=function(){var G=i()(n()().mark(function x(F,V){return n()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:S&&S(F,V);case 1:case"end":return ee.stop()}},x)}));return function(F,V){return G.apply(this,arguments)}}(),le=function(){var G=i()(n()().mark(function x(F){return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:Z&&Z(F);case 1:case"end":return y.stop()}},x)}));return function(F){return G.apply(this,arguments)}}();return(0,a.jsx)(a.Fragment,{children:D==="account"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.Z,{name:"username",fieldProps:{size:"large",prefix:(0,a.jsx)(ve.Z,{})},placeholder:K.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D/\u90AE\u7BB1"}),rules:[{required:!0,message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D/\u90AE\u7BB1!"})}]}),(0,a.jsx)($.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,a.jsx)(de.Z,{})},placeholder:K.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]}),(0,a.jsx)(O.A.Item,{name:"captchaCode",rules:[{required:!0,message:K.formatMessage({id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],children:(0,a.jsx)(ue.Z,{onKaptchaChange:re,onKaptchaCheck:le})})]})})},oe=k,T=e(24454),ye=e(16434),q=e(40056),Ee=function(r){var D=r.loginType,S=r.onKaptchaChange,Z=r.onKaptchaCheck,K=(0,u.useIntl)(),re=(0,d.useRef)(),le=(0,d.useState)(""),G=_()(le,2),x=G[0],F=G[1],V=(0,d.useState)(""),y=_()(V,2),ee=y[0],_e=y[1],Me=(0,d.useState)(!1),ge=_()(Me,2),he=ge[0],pe=ge[1],Ce=function(){var z=i()(n()().mark(function j(f,R){return n()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:F(f),_e(R),S&&S(f,R);case 3:case"end":return ae.stop()}},j)}));return function(f,R){return z.apply(this,arguments)}}(),me=function(){var z=i()(n()().mark(function j(f){return n()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:pe(f),Z&&Z(f);case 2:case"end":return E.stop()}},j)}));return function(f){return z.apply(this,arguments)}}();return(0,a.jsx)(a.Fragment,{children:D==="mobile"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.Z,{fieldProps:{size:"large",prefix:(0,a.jsx)(T.Z,{})},name:"mobile",placeholder:K.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,a.jsx)(O.A.Item,{name:"captchaCode",rules:[{required:!0,message:K.formatMessage({id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],children:(0,a.jsx)(ue.Z,{onKaptchaChange:Ce,onKaptchaCheck:me})}),(0,a.jsx)(ye.Z,{fieldProps:{size:"large",prefix:(0,a.jsx)(de.Z,{})},captchaProps:{size:"large",disabled:!he},placeholder:K.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(j,f){return j?"".concat(f," ").concat(K.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):K.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],fieldRef:re,onGetCaptcha:function(){var z=i()(n()().mark(function j(f){var R,E;return n()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(console.log("mobile:",f),!(f&&f.length===11)){P.next=12;break}return R={mobile:f,type:Q.yCI,captchaUid:x,captchaCode:ee,platform:Q.iw8},P.next=5,(0,b.Y7)(R);case 5:if(E=P.sent,E.code===200){P.next=9;break}return o.yw.error(E.message),P.abrupt("return");case 9:o.yw.success(E.message),P.next=13;break;case 12:o.yw.error("\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF");case 13:case"end":return P.stop()}},j)}));return function(j){return z.apply(this,arguments)}}()}),(0,a.jsx)(q.Z,{message:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},be=Ee,Te=e(97253),De=function(r){var D=r.loginType;return(0,a.jsx)(a.Fragment,{children:D==="scan"&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Te.Z,{style:{margin:"auto"},value:"login"})})})},Ke=De,ne=e(66419),Pe=e(69554),Ue=L.Z.defaultAlgorithm,Le=L.Z.darkAlgorithm,Se=function(){var r=(0,te.l)(function(D){var S=D.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:S.borderRadius,":hover":{backgroundColor:S.colorBgTextHover}}});return(0,a.jsx)("div",{className:r,"data-lang":!0,children:u.SelectLang&&(0,a.jsx)(u.SelectLang,{})})},xe=function(){var r=(0,ne.hX)();return(0,a.jsx)("img",{alt:"logo",src:r})},Ie=function(){var r=(0,ne.lk)();return(0,a.jsx)(u.FormattedMessage,{id:r,defaultMessage:"\u5FAE\u8BED"})},Oe=function(){var r=(0,ne.z)();return(0,a.jsx)(u.FormattedMessage,{id:r,defaultMessage:"\u5FAE\u8BED"})},Ae=function(){var r=(0,u.useIntl)(),D=O.A.useForm(),S=_()(D,1),Z=S[0],K=L.Z.useToken(),re=K.token,le=(0,ie.Z)(),G=le.isDarkMode,x=(0,ce.t)(function(h){return h.setAccessToken}),F=(0,d.useState)("mobile"),V=_()(F,2),y=V[0],ee=V[1],_e=(0,u.useModel)("@@initialState"),Me=_e.setInitialState,ge=(0,d.useState)(!1),he=_()(ge,2),pe=he[0],Ce=he[1],me=(0,g.L)(function(h){return h.setUserInfo}),z=(0,d.useState)(""),j=_()(z,2),f=j[0],R=j[1],E=function(){var h=i()(n()().mark(function l(s,t){return n()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:R(s),Z.setFieldValue("captchaCode",t);case 2:case"end":return c.stop()}},l)}));return function(s,t){return h.apply(this,arguments)}}(),ae=function(){var h=i()(n()().mark(function l(s){return n()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:console.log("handleKaptchaCheck:",s);case 1:case"end":return v.stop()}},l)}));return function(s){return h.apply(this,arguments)}}(),P=[{key:"account",label:r.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"}),children:(0,a.jsx)(oe,{loginType:y,onKaptchaChange:E,onKaptchaCheck:ae})},{key:"mobile",label:r.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"}),children:(0,a.jsx)(be,{loginType:y,onKaptchaChange:E,onKaptchaCheck:ae})},{key:"scan",label:r.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"\u626B\u7801\u767B\u5F55"}),children:(0,a.jsx)(Ke,{loginType:y})}],we={marginInlineStart:"16px",color:(0,J.uK)(re.colorTextBase,.2),fontSize:"24px",verticalAlign:"middle",cursor:"pointer"};(0,d.useEffect)(function(){(0,ne.iE)(),(0,ne.Bc)()&&Ce(!0),(0,ne.pr)()},[]);var je=function(){var h=i()(n()().mark(function l(s){return n()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s&&(0,M.flushSync)(function(){Me(function(c){return p()(p()({},c),{},{userInfo:s})})});case 1:case"end":return v.stop()}},l)}));return function(s){return h.apply(this,arguments)}}(),Re=function(){var h=i()(n()().mark(function l(s){var t;return n()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,o.yw.loading(r.formatMessage({id:"logining",defaultMessage:"logining..."})),c.next=4,(0,b.x4)(p()({},s));case 4:t=c.sent,console.log("LoginResult:",t),t.code===200?(o.yw.destroy(),o.yw.success(r.formatMessage({id:"login.success",defaultMessage:"login success"})),x(t.data.accessToken),je(t.data.user),me(t.data.user),u.history.push("/")):(o.yw.destroy(),o.yw.error(t.message)),c.next=13;break;case 9:c.prev=9,c.t0=c.catch(0),console.log(c.t0),o.yw.error(r.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 13:case"end":return c.stop()}},l,null,[[0,9]])}));return function(s){return h.apply(this,arguments)}}(),Be=function(){var h=i()(n()().mark(function l(s){var t,v,c;return n()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.prev=0,o.yw.loading(r.formatMessage({id:"logining",defaultMessage:"logining..."})),U.next=4,(0,b.N9)(p()({},s));case 4:t=U.sent,console.log("LoginMobileResult:",t),t.code===200?(o.yw.destroy(),o.yw.success(r.formatMessage({id:"login.success",defaultMessage:"login success"})),x(t==null?void 0:t.data.accessToken),je(t==null||(v=t.data)===null||v===void 0?void 0:v.user),me(t==null||(c=t.data)===null||c===void 0?void 0:c.user),u.history.push("/")):(o.yw.destroy(),o.yw.error(t.message)),U.next=13;break;case 9:U.prev=9,U.t0=U.catch(0),console.log(U.t0),o.yw.error(r.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 13:case"end":return U.stop()}},l,null,[[0,9]])}));return function(s){return h.apply(this,arguments)}}(),$e=function(){var h=i()(n()().mark(function l(){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.log("handleGithubLogin");case 1:case"end":return t.stop()}},l)}));return function(){return h.apply(this,arguments)}}(),We=function(){var h=i()(n()().mark(function l(){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.log("handleGoogleLogin");case 1:case"end":return t.stop()}},l)}));return function(){return h.apply(this,arguments)}}();return(0,a.jsxs)(C._Y,{hashed:!1,dark:G,children:[(0,a.jsx)(Se,{}),(0,a.jsx)("div",{style:{backgroundColor:re.colorBgContainer,textAlign:"center",height:"100%",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:(0,a.jsxs)(se.U,{form:Z,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:xe(),title:Ie(),subTitle:Oe(),actions:pe&&!1,onFinish:function(){var h=i()(n()().mark(function l(s){var t,v;return n()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(console.log("login values:",s),y!=="account"){N.next=8;break}return t={username:s.username,password:s.password,captchaUid:f,captchaCode:s.captchaCode,platform:Q.iw8},console.log("login info:",t),N.next=6,Re(t);case 6:N.next=12;break;case 8:return v={mobile:s.mobile,code:s.code,captchaUid:f,captchaCode:s.captchaCode,platform:Q.iw8},console.log("login mobile info:",v),N.next=12,Be(v);case 12:case"end":return N.stop()}},l)}));return function(l){return h.apply(this,arguments)}}(),children:[(0,a.jsx)(A.Z,{activeKey:y,onChange:ee,centered:!0,items:P}),(0,a.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,a.jsxs)("div",{style:{float:"right",marginBottom:24},children:[pe&&(0,a.jsx)(u.Link,{to:"/auth/register",children:(0,a.jsx)(u.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C "})}),(0,a.jsx)(u.Link,{style:{marginLeft:10},to:Q.rVq,target:"_blank",children:"\u5E2E\u52A9\u6587\u6863"})]})})]})})]})},ke=function(){var r=(0,ie.Z)(),D=r.isDarkMode;return(0,a.jsx)(Pe.w,{children:(0,a.jsx)(X.ZP,{theme:{algorithm:D?Le:Ue},children:(0,a.jsxs)(m.Z,{style:{height:"100%"},children:[(0,a.jsx)(o.ZP,{}),(0,a.jsx)(Ae,{})]})})})},Fe=ke},60247:function(fe,B,e){e.d(B,{L:function(){return Y}});var H=e(85615),p=e(73445),w=e(782),n=e(18753),Y=(0,p.Ue)()((0,w.mW)((0,w.tJ)((0,n.n)(function(i,I){return{userInfo:{uid:""},deviceUid:"",setUserInfo:function(b){i({userInfo:b})},setDeviceUid:function(b){i({deviceUid:b})},deleteUserInfo:function(){return i({},!0)}}}),{name:H.EmD})))}}]);
