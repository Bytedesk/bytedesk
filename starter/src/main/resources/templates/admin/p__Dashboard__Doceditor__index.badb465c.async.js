"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5488],{85022:function(e,t,n){n.d(t,{Az:function(){return d},Xc:function(){return h},jX:function(){return m},tu:function(){return p}});var r=n(15009),c=n.n(r),u=n(97857),i=n.n(u),o=n(99289),a=n.n(o),l=n(85615),s=n(86745);function d(e){return f.apply(this,arguments)}function f(){return(f=a()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/query/org",{method:"GET",params:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=a()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/create",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=a()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/update",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return(y=a()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/delete",{method:"POST",data:i()(i()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3059:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var r=n(31418),c=n(77154),u=n(21612),i=n(67294),o=n(52670),a=n(85615),l=n(69554),s=n(80049),d=n(15009),f=n.n(d),p=n(99289),g=n.n(p),h=n(85022),v=n(39825),m=n(73803),y=n(97857),x=n.n(y),w=n(19632),A=n.n(w),j=n(73445),k=n(782),Z=n(18753),b=(0,j.Ue)()((0,k.mW)((0,k.tJ)((0,Z.n)((function(e,t){return{currentArticle:{uid:"",orgUid:""},articleResult:{data:{content:[]}},insertArticle:function(t){e((function(e){e.articleResult.data.content.unshift(t)}))},updateArticle:function(t){e((function(e){var n=e.articleResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Article with uid ".concat(t.uid," not found."))}))},setArticleResult:function(n){var r;(e({articleResult:n}),""===t().currentArticle.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentArticle:n.data.content[0]}))},setCurrentArticle:function(n){var r=t().articleResult.data.content,c=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==c){var u=[].concat(A()(r.slice(0,c)),[n],A()(r.slice(c+1))),i=x()(x()({},t().articleResult),{},{data:{content:u}});e({articleResult:i,currentArticle:n})}else console.warn("Article with the specified uid not found."),e({currentArticle:n})},removeArticle:function(n){var r=t().articleResult.data.content,c=r.findIndex((function(e){return e.uid===n}));-1!==c?e({articleResult:x()(x()({},t().articleResult),{},{data:{content:[].concat(A()(r.slice(0,c)),A()(r.slice(c+1)))}})}):console.warn("Article not found in cache:",n),t().currentArticle.uid===n&&e({currentArticle:{uid:"",orgUid:""}})},deleteArticleCache:function(){return e({},!0)}}})),{name:a.SsI}))),C=n(89102),P=n(38302),R=n(87676),M=n(45360),S=n(2487),U=n(85893),E=function(){var e=(0,v.Z)().isDarkMode,t=(0,i.useRef)(!1),n=(0,m.Z)().translateString,r=(0,R.u)((function(e){return e.currentOrg})),c=(0,P.j)((function(e){return e.currentKbase})),u=(0,C.v)((function(e){return e.currentCategory})),o=b((function(e){return{currentArticle:e.currentArticle,articleResult:e.articleResult,setCurrentArticle:e.setCurrentArticle,setArticleResult:e.setArticleResult}})),l=o.currentArticle,s=o.articleResult,d=o.setCurrentArticle,p=o.setArticleResult,y=function(){var e=g()(f()().mark((function e(){var n,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,M.ZP.loading("loading"),n={pageNumber:0,pageSize:50,type:a.bjp,categoryUid:null==u?void 0:u.uid,kbUid:null==c?void 0:c.uid,orgUid:null==r?void 0:r.uid},e.next=8,(0,h.Az)(n);case 8:i=e.sent,console.log("queryArticlesByOrg: ",i),200===i.code?(M.ZP.destroy(),p(i)):(M.ZP.destroy(),M.ZP.error(i.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){console.log("useEffect"),y()}),[c,u]);return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(S.Z,{itemLayout:"horizontal",dataSource:s.data.content,renderItem:function(t,r){return(0,U.jsx)(S.Z.Item,{style:l.uid===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){d(t)},children:(0,U.jsx)(S.Z.Item.Meta,{style:{marginLeft:"10px",color:e?"#ffffff":"#000000"},title:n(t.title)})})}})})},I=n(5574),O=n.n(I),V=n(86250),H=n(55102),L=n(72269),q=n(14726),F=n(31359),z=n(13769),B=n.n(z),T=n(86745),X=n(60520),D=(n(74864),["placeholder","defaultValue","value","onChange","options"]),K=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,c=e.onChange,u=(e.options,B()(e,D)),o=(0,T.useIntl)(),a=(0,i.useRef)(null),l=(0,i.useRef)(null);return(0,i.useEffect)((function(){if(a.current){if(!l.current){var e=new X.cW({element:a.current,placeholder:t,content:n,image:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},video:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},attachment:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},onChange:function(e){"function"==typeof c&&c(e.getHtml(),e.getMarkdown())}});l.current=e}return function(){l.current&&(l.current.destroy(),l.current=null)}}}),[]),(0,i.useEffect)((function(){l.current&&r!==l.current.getHtml()&&l.current.setContent(r||"")}),[r]),(0,U.jsx)(U.Fragment,{children:(0,U.jsx)("div",x()(x()({ref:a},u),{},{style:{height:"100%"}}))})},W=n(51042),G=n(60219),J=n(55287),N=n(17634),Q=function(){var e=(0,T.useIntl)(),t=(0,v.Z)().isDarkMode,n=(0,i.useState)(!1),r=O()(n,2),c=r[0],u=r[1],o=(0,i.useState)(""),l=O()(o,2),s=l[0],d=l[1],p=(0,i.useState)(""),m=O()(p,2),y=m[0],w=m[1],A=(0,i.useState)(""),j=O()(A,2),k=j[0],Z=j[1],S=(0,i.useRef)(!1),E=(0,R.u)((function(e){return e.currentOrg})),I=(0,P.j)((function(e){return e.currentKbase})),z=(0,C.v)((function(e){return e.currentCategory})),B=b((function(e){return{currentArticle:e.currentArticle,insertArticle:e.insertArticle,setCurrentArticle:e.setCurrentArticle,updateLocalArticle:e.updateArticle}})),X=B.currentArticle,D=B.insertArticle,Q=B.setCurrentArticle,Y=B.updateLocalArticle;(0,i.useEffect)((function(){(null==X?void 0:X.kbUid)===(null==I?void 0:I.uid)&&(d(null==X?void 0:X.title),w(null==X?void 0:X.contentHtml),Z(null==X?void 0:X.contentMarkdown))}),[X]);var $=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("create"),!S.current){t.next=4;break}return console.log("isLoading: 1",S.current),t.abrupt("return");case 4:return S.current=!0,M.ZP.loading(e.formatMessage({id:"creating"})),n={uid:null==X?void 0:X.uid,title:"new article",summary:"new article summary",contentHtml:"new article content",contentMarkdown:"new article content",type:a.bjp,tags:["tag1","tag2"],markdown:c,published:!1,categoryUid:null==z?void 0:z.uid,kbUid:null==I?void 0:I.uid,orgUid:null==E?void 0:E.uid},console.log("create articleObject",n),t.next=10,(0,h.tu)(n);case 10:r=t.sent,console.log("createArticle response",r),200===r.code?(M.ZP.destroy(),M.ZP.info(e.formatMessage({id:"create.success"})),D(r.data),Q(r.data)):(M.ZP.destroy(),M.ZP.error(r.message)),S.current=!1;case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("save",s,y),""!==s&&""!==y){t.next=4;break}return M.ZP.error("标题或内容不能为空！"),t.abrupt("return");case 4:if(!S.current){t.next=7;break}return console.log("isLoading: 1",S.current),t.abrupt("return");case 7:return S.current=!0,M.ZP.loading(e.formatMessage({id:"updating"})),n={uid:null==X?void 0:X.uid,title:s,summary:null==X?void 0:X.summary,contentHtml:y,contentMarkdown:k,type:null==X?void 0:X.type,tags:["tag1","tag2"],markdown:null==X?void 0:X.markdown,published:null==X?void 0:X.published,categoryUid:null==X?void 0:X.categoryUid,kbUid:null==X?void 0:X.kbUid,orgUid:null==X?void 0:X.orgUid},console.log("update articleObject",n),t.next=13,(0,h.Xc)(n);case 13:r=t.sent,console.log("updateArticle response",r),200===r.code?(M.ZP.destroy(),M.ZP.info(e.formatMessage({id:"update.success"})),Y(r.data)):(M.ZP.destroy(),M.ZP.error(r.message)),S.current=!1;case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,i.useEffect)((function(){var e=x()(x()({},X),{},{title:s,contentHtml:y,contentMarkdown:k});Y(e)}),[s,y,k]),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{children:(0,U.jsxs)(V.Z,{gap:10,style:{marginBottom:10,marginTop:5},children:[(0,U.jsx)(H.Z,{size:"large",placeholder:"title",value:s,style:{background:t?"#141414":"#f5f5f5"},onChange:function(e){console.log("title onChange:",e.target.value),d(e.target.value)}}),(0,U.jsx)(L.Z,{checkedChildren:"Markdown",unCheckedChildren:"Html",onChange:function(e){console.log("switch to ".concat(e)),u(e)},defaultValue:c}),(0,U.jsx)(q.ZP,{type:"primary",icon:(0,U.jsx)(W.Z,{}),onClick:$,children:"新建"}),(0,U.jsx)(q.ZP,{type:"default",icon:(0,U.jsx)(G.Z,{}),onClick:_,children:"保存"}),(0,U.jsx)(q.ZP,{type:"default",icon:(0,U.jsx)(J.Z,{}),onClick:function(){console.log("handlePreviewArticle",X),window.open("".concat((0,N.SV)(),"/article/").concat(null==I?void 0:I.uid,"/").concat(null==X?void 0:X.uid))},children:"预览"})]})}),c&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(F.ZP,{style:{height:"100%"},value:k,enablePreview:!0,onChange:function(e,t){console.log("markdown onChange value",e,t),Z(e),w(e)}})}),!c&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(K,{placeholder:"article content..",value:y,onChange:function(e,t){console.log("aiEditor onChange value",e,t),w(e),Z(t)}})})]})},Y=u.Z.Sider,$=u.Z.Content,_=function(){var e=(0,c.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(l.w,{children:(0,U.jsxs)(r.Z,{children:[(0,U.jsx)(s.ZP,{}),(0,U.jsxs)(u.Z,{children:[(0,U.jsx)(Y,{style:t,children:(0,U.jsx)(o.Z,{type:a.bjp})}),(0,U.jsx)(Y,{style:t,children:(0,U.jsx)(E,{})}),(0,U.jsx)(u.Z,{children:(0,U.jsx)($,{style:n,children:(0,U.jsx)(Q,{})})})]})]})})})}}}]);