"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3280],{74840:function(e,t,i){i.d(t,{Z:function(){return o}});var a=i(11757),n=i(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},r=i(54183),c=function(e,t){return n.createElement(r.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var o=n.forwardRef(c)},89717:function(e,t,i){var a=i(44194),n=i(51113),s=function(){return s=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)},r=(0,a.forwardRef)((function(e,t){return a.createElement(n.P,s({},e,{chartType:"Column",ref:t}))}));t.Z=r},79672:function(e,t,i){i.r(t),i.d(t,{default:function(){return ee}});var a=i(90819),n=i.n(a),s=i(89933),r=i.n(s),c=i(45332),o=i.n(c),l=i(44194),d=i(98123),u=i(44781),f=i(62673),g=i(3849),v=i(67402),m=i(88996),p=i(75365),h=i(88201),y=i(5602),k=i(59485),x=i(7875),w=i(11757),j={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"},M=i(54183),Z=function(e,t){return l.createElement(M.Z,(0,w.Z)({},e,{ref:t,icon:j}))};var T=l.forwardRef(Z),b=i(30082),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm72-112c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48zm400-188h-59.3c-2.6 0-5 1.2-6.5 3.3L763.7 538.1l-49.9-68.8a7.92 7.92 0 00-6.5-3.3H648c-6.5 0-10.3 7.4-6.5 12.7l109.2 150.7a16.1 16.1 0 0026 0l165.8-228.7c3.8-5.3 0-12.7-6.5-12.7zm-44 306h-64.2c-5.5 0-10.6 2.9-13.6 7.5a352.2 352.2 0 01-49.8 62.2A355.92 355.92 0 01651.1 840a355 355 0 01-138.7 27.9c-48.1 0-94.8-9.4-138.7-27.9a355.92 355.92 0 01-113.3-76.3A353.06 353.06 0 01184 650.5c-18.6-43.8-28-90.5-28-138.5s9.4-94.7 28-138.5c17.9-42.4 43.6-80.5 76.4-113.2 32.8-32.7 70.9-58.4 113.3-76.3a355 355 0 01138.7-27.9c48.1 0 94.8 9.4 138.7 27.9 42.4 17.9 80.5 43.6 113.3 76.3 19 19 35.6 39.8 49.8 62.2 2.9 4.7 8.1 7.5 13.6 7.5H892c6 0 9.8-6.3 7.2-11.6C828.8 178.5 684.7 82 517.7 80 278.9 77.2 80.5 272.5 80 511.2 79.5 750.1 273.3 944 512.4 944c169.2 0 315.6-97 386.7-238.4A8 8 0 00892 694z"}}]},name:"issues-close",theme:"outlined"},R=function(e,t){return l.createElement(M.Z,(0,w.Z)({},e,{ref:t,icon:F}))};var O=l.forwardRef(R),S=i(74840),A=i(61107),z=i(80556),C=i(30921),Y=i(5939),E=i(24562),B=i(89717),D=i(73193),U=i.n(D),H=i(55735);function P(e){return V.apply(this,arguments)}function V(){return(V=r()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:U()(U()({},t),{},{client:H.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=i(86803),I=i(40612),W=i(1902),N=i(95490),G=i(24170),K=i(76750),L=i(72614),$=i(28977),_=i.n($),J=i(31549),Q=d.default.RangePicker,X=u.default.Option,ee=function(){var e,t,i=(0,C.useIntl)(),a=(0,K.Z)().translateStringTranct,s=(0,l.useState)(_()().startOf("day")),c=o()(s,2),d=c[0],w=c[1],j=(0,l.useState)(_()().endOf("day")),M=o()(j,2),Z=M[0],F=M[1],R=(0,l.useState)("today"),D=o()(R,2),U=D[0],V=D[1],$=(0,l.useState)(H.AOk),ee=o()($,2),te=ee[0],ie=ee[1],ae=(0,l.useState)(),ne=o()(ae,2),se=ne[0],re=ne[1],ce=(0,l.useState)(),oe=o()(ce,2),le=oe[0],de=oe[1],ue=(0,I.u)((function(e){return e.currentOrg})),fe=(0,W.E)((function(e){return e})),ge=fe.agentResult,ve=fe.setAgentResult,me=(0,N.$)((function(e){return e})),pe=me.workgroupResult,he=me.setWorkgroupResult,ye=(0,l.useState)(),ke=o()(ye,2),xe=ke[0],we=ke[1],je=(0,l.useState)(H.OwA),Me=o()(je,2),Ze=Me[0],Te=Me[1],be=(0,l.useState)(!1),Fe=o()(be,2),Re=Fe[0],Oe=Fe[1],Se=[{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,l.useEffect)((function(){if("custom"===U)w(d),F(Z),Te(H.dd4);else{var e=_()();"today"===U?(w(e),F(e),Te(H.OwA)):"yesterday"===U?(w(e.subtract(1,"day")),F(e.subtract(1,"day")),Te(H.OwA)):"week"===U?(w(e.startOf("week")),F(e.endOf("week")),Te(H.dd4)):"lastWeek"===U?(w(e.subtract(1,"week").startOf("week")),F(e.subtract(1,"week").endOf("week")),Te(H.dd4)):"month"===U&&(w(e.startOf("month")),F(e.endOf("month")),Te(H.dd4))}}),[U]);var Ae=function(){var e=r()(n()().mark((function e(){var t,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,L.u7)(t);case 4:i=e.sent,console.log("fetchAllWorkgroups: ",i),200===i.code?(q.yw.destroy(),he(i),i.data.content.length>0&&de(i.data.content[0].uid)):(q.yw.destroy(),q.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(){var e=r()(n()().mark((function e(){var t,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==ue?void 0:ue.uid},e.next=4,(0,G._t)(t);case 4:i=e.sent,console.log("fetchAllAgents: ",i),200===i.code?(q.yw.destroy(),ve(i),i.data.content.length>0&&re(i.data.content[0].uid)):(q.yw.destroy(),q.yw.error(a(i.message))),console.log("queryAllAgents response",i);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=r()(n()().mark((function e(){var t,a;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Oe(!0),e.prev=1,q.yw.loading("loading"),t={type:te,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==Z?void 0:Z.format("YYYY-MM-DD 23:59:59"),workgroupUid:le,assigneeUid:se,orgUid:null==ue?void 0:ue.uid},e.next=6,P(t);case 6:a=e.sent,console.log("queryStatisticTicketsByOrg response",a,t),200===a.code?(q.yw.destroy(),we(a.data)):(q.yw.destroy(),q.yw.error(a.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),q.yw.error(i.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,Oe(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}(),Ye=function(){var e=r()(n()().mark((function e(){var t,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q.yw.loading("loading"),t={type:te,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==Z?void 0:Z.format("YYYY-MM-DD 23:59:59"),workgroupUid:le,assigneeUid:se,orgUid:null==ue?void 0:ue.uid},e.next=4,P(t);case 4:i=e.sent,console.log("queryStatisticTicketsByOrg response",i,t),200===i.code?q.yw.destroy():(q.yw.destroy(),q.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){Ae(),ze()}),[]),(0,l.useEffect)((function(){Ce()}),[te,se,le]),(0,l.useEffect)((function(){Ye()}),[Ze,te,se,le]),(0,l.useEffect)((function(){Ce()}),[d,Z]);var Ee=[{title:i.formatMessage({id:"ticket.statistic.total"}),value:(null==xe?void 0:xe.totalTickets)||0,icon:(0,J.jsx)(T,{}),color:"#1890ff"},{title:i.formatMessage({id:"ticket.statistic.resolved"}),value:(null==xe?void 0:xe.resolvedTickets)||0,icon:(0,J.jsx)(b.Z,{}),color:"#52c41a"},{title:i.formatMessage({id:"ticket.statistic.resolution.rate"}),value:"".concat((null==xe?void 0:xe.resolvedTickets)/(null==xe?void 0:xe.totalTickets)||0,"%"),icon:(0,J.jsx)(O,{}),color:"#722ed1"},{title:i.formatMessage({id:"ticket.statistic.satisfaction"}),value:"".concat((null==xe?void 0:xe.customerSatisfactionRate)||0,"%"),icon:(0,J.jsx)(S.Z,{}),color:"#fa8c16"}];return(0,J.jsxs)("div",{style:{padding:16},children:[(0,J.jsx)(f.Z,{style:{marginBottom:16},children:(0,J.jsxs)(g.Z,{direction:"vertical",style:{width:"100%"},children:[(0,J.jsxs)(g.Z,{wrap:!0,children:[(0,J.jsx)(v.ZP.Group,{value:U,onChange:function(e){return V(e.target.value)},children:Se.map((function(e){return(0,J.jsx)(v.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===U&&(0,J.jsx)(Q,{value:[d,Z],onChange:function(e){w(e[0]),F(e[1])}})]}),(0,J.jsxs)(g.Z,{wrap:!0,children:[(0,J.jsxs)(u.default,{placeholder:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.type"}),style:{width:200},value:te,onChange:function(e){return ie(e)},children:[(0,J.jsx)(X,{value:H.AOk,children:(0,J.jsx)(C.FormattedMessage,{id:"i18n.all"})}),(0,J.jsx)(X,{value:H.pHh,children:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.agent"})}),(0,J.jsx)(X,{value:H.ti4,children:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.workgroup"})})]}),te===H.pHh&&(0,J.jsx)(u.default,{placeholder:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.agent"}),style:{width:200},value:se,onChange:function(e){return re(e)},children:null===(e=ge.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,J.jsx)(X,{value:null==e?void 0:e.uid,children:a(null==e?void 0:e.nickname)},null==e?void 0:e.uid)}))}),te===H.ti4&&(0,J.jsx)(u.default,{placeholder:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.department"}),style:{width:200},value:le,onChange:function(e){return de(e)},children:null===(t=pe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,J.jsx)(X,{value:null==e?void 0:e.uid,children:a(null==e?void 0:e.nickname)},null==e?void 0:e.uid)}))}),(0,J.jsx)(m.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.export"}),children:(0,J.jsx)(p.ZP,{icon:(0,J.jsx)(A.Z,{}),onClick:function(){q.yw.warning("TODO: 待实现")},children:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.export"})})}),(0,J.jsx)(m.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.refresh"}),children:(0,J.jsx)(p.ZP,{icon:(0,J.jsx)(z.Z,{}),onClick:function(){return Ce()},children:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.filter.refresh"})})}),!1]})]})}),(0,J.jsx)(h.Z,{gutter:16,style:{marginBottom:24},children:Ee.map((function(e){return(0,J.jsx)(y.Z,{span:6,children:(0,J.jsx)(f.Z,{loading:Re,children:(0,J.jsx)(k.Z,{title:e.title,value:e.value,prefix:l.cloneElement(e.icon,{style:{color:e.color}}),valueStyle:{color:e.color}})})},e.title)}))}),(0,J.jsx)(f.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.trend"}),style:{marginBottom:24,height:300},loading:Re,children:(0,J.jsx)(Y.Z,{data:[],xField:"date",yField:"value",seriesField:"type",legend:{position:"top"},meta:{type:{formatter:function(e){return i.formatMessage({id:"ticket.statistic.type.".concat(e)})}}}})}),(0,J.jsxs)(h.Z,{gutter:16,style:{marginBottom:24},children:[(0,J.jsx)(y.Z,{span:12,children:(0,J.jsx)(f.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.distribution"}),loading:Re,children:(0,J.jsx)(E.Z,{data:[{type:"new",value:(null==xe?void 0:xe.newTickets)||0},{type:"claimed",value:(null==xe?void 0:xe.claimedTickets)||0},{type:"unclaimed",value:(null==xe?void 0:xe.unclaimedTickets)||0},{type:"processing",value:(null==xe?void 0:xe.processingTickets)||0},{type:"pending",value:(null==xe?void 0:xe.pendingTickets)||0},{type:"holding",value:(null==xe?void 0:xe.holdingTickets)||0},{type:"reopened",value:(null==xe?void 0:xe.reopenedTickets)||0},{type:"resolved",value:(null==xe?void 0:xe.resolvedTickets)||0},{type:"escalated",value:(null==xe?void 0:xe.escalatedTickets)||0}],angleField:"value",colorField:"type",radius:.8,label:{text:function(e){var t=e.type,i=e.value;return"".concat(t,": ").concat(i)},style:{fontSize:14}},legend:{position:"bottom",itemHeight:8}})})}),(0,J.jsx)(y.Z,{span:12,children:(0,J.jsx)(f.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.efficiency"}),loading:Re,children:(0,J.jsx)(B.Z,{data:[{type:"avgResponseTime",value:(null==xe?void 0:xe.averageFirstResponseTime)||0},{type:"avgResolutionTime",value:(null==xe?void 0:xe.averageResolutionTime)||0}],xField:"type",yField:"value",label:{position:"top"},meta:{type:{formatter:function(e){return i.formatMessage({id:"ticket.statistic.time.".concat(e)})}}}})})})]}),(0,J.jsx)(f.Z,{title:(0,J.jsx)(C.FormattedMessage,{id:"ticket.statistic.agent.performance"}),loading:Re,children:(0,J.jsx)(x.Z,{columns:[{title:i.formatMessage({id:"ticket.statistic.agent.name"}),dataIndex:"assigneeName",key:"assigneeName"},{title:i.formatMessage({id:"ticket.statistic.agent.tickets"}),dataIndex:"assigneeTickets",key:"assigneeTickets",sorter:!0},{title:i.formatMessage({id:"ticket.statistic.agent.resolution"}),dataIndex:"assigneeResolutionRate",key:"assigneeResolutionRate",render:function(e){return"".concat(e,"%")},sorter:!0},{title:i.formatMessage({id:"ticket.statistic.agent.satisfaction"}),dataIndex:"customerSatisfactionRate",key:"customerSatisfactionRate",render:function(e){return"".concat(e,"%")},sorter:!0}],rowKey:"assigneeUid",pagination:!1})})]})}}}]);