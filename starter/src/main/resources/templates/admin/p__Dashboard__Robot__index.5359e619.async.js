"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6693],{10411:function(e,t,n){n.d(t,{AP:function(){return c},_J:function(){return b},t5:function(){return m},v_:function(){return g}});var s=n(15009),a=n.n(s),r=n(97857),o=n.n(r),i=n(99289),l=n.n(i),u=n(85615),d=n(86745);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return p.apply(this,arguments)}function p(){return(p=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},7674:function(e,t,n){n.r(t),n.d(t,{default:function(){return xe}});var s=n(21612),a=n(67294),r=n(15009),o=n.n(r),i=n(99289),l=n.n(i),u=n(5574),d=n.n(u),c=n(37326),f=n(85576),g=n(86250),p=n(14726),m=n(2487),v=n(7134),b=n(11475),h=n(64789),y=n(86745),x=n(39825),M=n(87676),w=n(85615),j=n(34994),k=n(5966),F=n(64317),q=n(85893),S=function(e){var t=e.open,n=e.onClose,s=e.onSubmit,a=(0,y.useIntl)(),r=j.A.useForm(),o=d()(r,1)[0],i=(0,M.u)((function(e){return e.currentOrg}));return(0,q.jsx)("div",{children:(0,q.jsx)(f.Z,{title:a.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:a.formatMessage({id:"save",defaultMessage:"Save"}),onOk:function(){console.log("handleSaveRobot"),o.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={nickname:e.nickname,type:e.type,orgUid:i.uid};console.log("robotObject:",t),s(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){n()},children:(0,q.jsxs)(j.A,{form:o,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,q.jsx)(k.Z,{label:a.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:a.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,q.jsx)(F.Z,{label:a.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:a.formatMessage({id:w.f4h,defaultMessage:"Service"}),value:w.f4h},{label:a.formatMessage({id:w.wG_,defaultMessage:"Marketing"}),value:w.wG_,disabled:!0},{label:a.formatMessage({id:w.MLd,defaultMessage:"Knowledgebase"}),value:w.MLd},{label:a.formatMessage({id:w.iu4,defaultMessage:"Qa"}),value:w.iu4},{label:a.formatMessage({id:w.xVG,defaultMessage:"AgentAsistant"}),value:w.xVG},{label:a.formatMessage({id:w.jam,defaultMessage:"TicketAsistant"}),value:w.jam}],rules:[{required:!0,message:a.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:a.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})},Z=n(76545),R=n(80049),C=n(73803),U=function(){var e=(0,x.Z)().isDarkMode,t=(0,y.useIntl)(),n=(0,a.useRef)(!1),s=(0,C.Z)(),r=s.translateString,i=s.translateStringTranct,u=(0,c.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,insertRobot:e.insertRobot,deleteCurrentRobot:e.deleteCurrentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),w=u.robotResult,j=u.currentRobot,k=u.insertRobot,F=u.deleteCurrentRobot,U=u.setRobotResult,T=u.setCurrentRobot,A=(0,M.u)((function(e){return e.currentOrg})),P=f.Z.useModal(),V=d()(P,2),_=V[0],I=V[1],O=function(){var e=l()(o()().mark((function e(n){var s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,Z.gf)(n);case 4:s=e.sent,console.log("delete robot response",s),200===s.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),F(n.uid)):(R.yw.destroy(),R.yw.error(s.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=l()(o()().mark((function e(){var t,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,published:!1,orgUid:null==A?void 0:A.uid},e.next=8,(0,Z.p0)(t);case 8:s=e.sent,console.log("queryRobotsByOrg: ",s),200===s.code?(R.yw.destroy(),U(s)):(R.yw.destroy(),R.yw.error(s.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){X()}),[]);var L=(0,a.useState)(!1),E=d()(L,2),G=E[0],K=E[1],N=function(){var e=l()(o()().mark((function e(n){var s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading(t.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=3,(0,Z.lg)(n);case 3:s=e.sent,console.log("handleSaveRobot response:",s),200===s.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"create.success"})),k(s.data),K(!1)):(R.yw.destroy(),K(!1),R.yw.error(s.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(e){return t.formatMessage({id:null==e?void 0:e.type,defaultMessage:null==e?void 0:e.type})};return(0,q.jsxs)("div",{children:[(0,q.jsx)("div",{style:{margin:10},children:(0,q.jsxs)(g.Z,{gap:"small",align:"flex-start",children:[(0,q.jsx)(p.ZP,{size:"small",type:"primary",icon:(0,q.jsx)(h.Z,{}),onClick:function(){K(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,q.jsx)(p.ZP,{size:"small",onClick:X,children:t.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,q.jsx)(p.ZP,{onClick:function(){return function(e){_.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,q.jsx)(b.Z,{}),content:"".concat(t.formatMessage({id:"deleteAfirm",defaultMessage:"Delete"}),"【").concat(r(e.nickname),"】？"),onOk:function(){O(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(j)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==j?void 0:j.uid),children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,q.jsx)(m.Z,{itemLayout:"horizontal",dataSource:w.data.content,renderItem:function(t,n){return(0,q.jsx)(m.Z.Item,{style:(null==j?void 0:j.uid)===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(t)},children:(0,q.jsx)(m.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,q.jsx)(v.C,{src:t.avatar}),title:(0,q.jsx)(q.Fragment,{children:i(null==t?void 0:t.nickname)}),description:B(t)})})}}),(0,q.jsx)(S,{open:G,onClose:function(){K(!1)},onSubmit:N}),I]})},T=n(11941),A=n(38437),P=n(79964),V=n(64423),_=n(50748),I=n(99072),O=n(97857),X=n.n(O),L=n(52688),E=n(90672),G=n(31199),K=n(96074),N=function(){var e=(0,y.useIntl)(),t=j.A.useForm(),n=d()(t,1)[0],s=(0,C.Z)().translateString,r=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),i=r.currentRobot,u=r.setCurrentRobot;(0,a.useEffect)((function(){var e,t,a,r,o,l;n.setFieldValue("enabled",null==i||null===(e=i.llm)||void 0===e?void 0:e.enabled),n.setFieldValue("topK",null==i||null===(t=i.llm)||void 0===t?void 0:t.topK),n.setFieldValue("scoreThreshold",null==i||null===(a=i.llm)||void 0===a?void 0:a.scoreThreshold),n.setFieldValue("model",null==i||null===(r=i.llm)||void 0===r?void 0:r.model),n.setFieldValue("temperature",null==i||null===(o=i.llm)||void 0===o?void 0:o.temperature),n.setFieldValue("prompt",s(null==i||null===(l=i.llm)||void 0===l?void 0:l.prompt))}),[i]);var f=function(){var t=l()(o()().mark((function t(n){var s,a,r,l,d,c,f;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("TabKeyword handleEnableChange",n),R.yw.loading(e.formatMessage({id:"updating"})),c=X()(X()({},i),{},{serviceSettings:X()(X()({},null==i?void 0:i.serviceSettings),{},{faqUids:null==i||null===(s=i.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),quickFaqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==i||null===(l=i.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),llm:X()(X()({},null==i?void 0:i.llm),{},{enabled:n})}),console.log("robotObject:",c),t.next=6,(0,Z.$l)(c);case 6:f=t.sent,console.log("updateRobot response:",f),200===f.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),u(f.data)):(R.yw.destroy(),R.yw.error(f.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),g=function(){var t=l()(o()().mark((function t(n){var s,a,r,l,d,c,f;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSubmit",n),R.yw.loading(e.formatMessage({id:"updating"})),c=X()(X()({},i),{},{serviceSettings:X()(X()({},i.serviceSettings),{},{faqUids:null===(s=i.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),quickFaqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==i||null===(l=i.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),llm:n}),console.log("robotObject:",c),t.next=6,(0,Z.$l)(c);case 6:f=t.sent,console.log("updateRobot response:",f),200===f.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),u(f.data)):(R.yw.destroy(),R.yw.error(f.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(A.Z,{message:"大模型暂未支持云服务，如需使用，可私有部署，并配置自有key使用",action:(0,q.jsx)(p.ZP,{type:"link",onClick:function(){window.open(w.rVq)},children:"docs"})}),(0,q.jsx)(K.Z,{}),(0,q.jsxs)(j.A,{form:n,size:"large",submitter:{render:function(e,t){return[(0,q.jsx)(p.ZP,{type:"default",onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields()},children:"重置"},"reset"),(0,q.jsx)(p.ZP,{type:"primary",onClick:function(){var t;null===(t=e.form)||void 0===t||t.submit()},children:"保存"},"submit")]},submitButtonProps:{size:"large",htmlType:"button"}},onFinish:g,children:[(0,q.jsx)(L.Z,{width:"lg",name:"enabled",label:"enabled",tooltip:"启用大模型后，将会关闭关键词。用户在发送消息时，将会直接请求大模型。",fieldProps:{onChange:f}}),(0,q.jsx)(E.Z,{width:"lg",name:"prompt",label:"prompt",placeholder:"请输入prompt",rules:[{required:!0,message:"请输入prompt"}]}),(0,q.jsx)(F.Z,{width:"lg",name:"model",label:"model",allowClear:!0,options:[{value:"ZHIPUAI_GLM_3_TURBO",label:"智谱AI-GLM-3-Turbo"},{value:"ZHIPUAI_GLM_4",label:"智谱AI-GLM-4"},{value:"OLLAMA",label:"Ollama"},{value:"OPENAI",label:"OpenAi",disabled:!0}],rules:[{required:!0,message:"请选择大模型"}]}),(0,q.jsx)(G.Z,{width:"lg",label:"温度",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"请输入温度"}]}),(0,q.jsx)(G.Z,{width:"lg",label:"上下文消息数",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"请输入上下文消息数"}]})]})]})},B=n(87603),D=function(){var e=(0,y.useIntl)(),t=(0,y.useNavigate)(),n=j.A.useForm(),s=d()(n,1)[0],r=((0,C.Z)().translateString,(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}}))),i=r.currentRobot,u=r.setCurrentRobot;(0,a.useEffect)((function(){var e;s.setFieldValue("enabled",!(null!=i&&null!==(e=i.llm)&&void 0!==e&&e.enabled)),s.setFieldValue("defaultReply",null==i?void 0:i.defaultReply)}),[i]);var f=function(){var t=l()(o()().mark((function t(){return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.validateFields().then(function(){var t=l()(o()().mark((function t(n){var s,a,r,l,d,c,f;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("TabKeyword handleSubmit",n),R.yw.loading(e.formatMessage({id:"updating"})),c=X()(X()({},i),{},{serviceSettings:X()(X()({},null==i?void 0:i.serviceSettings),{},{faqUids:null==i||null===(s=i.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),quickFaqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==i||null===(l=i.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),llm:X()(X()({},null==i?void 0:i.llm),{},{enabled:!n.enabled}),defaultReply:n.defaultReply}),console.log("robotObject:",c),t.next=6,(0,Z.$l)(c);case 6:f=t.sent,console.log("updateRobot response:",f),200===f.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),u(f.data)):(R.yw.destroy(),R.yw.error(f.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){console.log("Form errors:",e)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){var t=l()(o()().mark((function t(n){var s,a,r,l,d,c,f;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("TabKeyword handleEnableChange",n),R.yw.loading(e.formatMessage({id:"updating"})),c=X()(X()({},i),{},{serviceSettings:X()(X()({},null==i?void 0:i.serviceSettings),{},{quickFaqUids:null==i||null===(s=i.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.faqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==i||null===(l=i.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),llm:X()(X()({},null==i?void 0:i.llm),{},{enabled:!n})}),console.log("robotObject:",c),t.next=6,(0,Z.$l)(c);case 6:f=t.sent,console.log("updateRobot response:",f),200===f.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),u(f.data)):(R.yw.destroy(),R.yw.error(f.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(j.A,{form:s,onFinish:f,children:[(0,q.jsx)(L.Z,{label:"是否启用关键词",name:"enabled",tooltip:"启用关键字后，将会关闭大模型。用户在发送消息时，如果消息内容包含关键字，则机器人将匹配关键字并自动回复。",fieldProps:{onChange:g}}),(0,q.jsx)(j.A.Item,{children:(0,q.jsx)(p.ZP,{icon:(0,q.jsx)(B.Z,{}),onClick:function(){t("/kb/keyword/data")},children:"添加关键字"},"github")}),(0,q.jsx)(E.Z,{width:"lg",label:"未匹配回复语",name:"defaultReply"})]})})},z=function(e){e.type;return(0,q.jsx)("div",{children:"TODO: 对接fastgpt、dify等工具"})},H=n(17167),$=function(){return(0,q.jsx)("div",{children:(0,q.jsx)(H.Z,{})})},Q=n(23035),W=n(51364),J=n(54050),Y=n(10411),ee=function(){var e=(0,y.useIntl)(),t=(0,y.useNavigate)(),n=j.A.useForm(),s=d()(n,1)[0],r=(0,C.Z)().translateString,i=(0,a.useState)(),u=d()(i,2),f=u[0],g=u[1],m=(0,M.u)((function(e){return e.currentOrg})),v=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),b=v.currentRobot,h=v.setCurrentRobot,x=function(){var t=l()(o()().mark((function t(){var n,s;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,type:w.QPQ,orgUid:m.uid},t.next=4,(0,Y.AP)(n);case 4:s=t.sent,console.log("getKeywordBase response:",n,s),R.yw.destroy(),200===s.code?g(s):R.yw.error(s.message);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,a.useEffect)((function(){x()}),[]),(0,a.useEffect)((function(){s.setFieldValue("kbUid",null==b?void 0:b.kbUid)}),[b]);var k=function(){var t=l()(o()().mark((function t(n){var s,a,r,i,l,u,d;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("onFinish values:",n),u=X()(X()({},b),{},{serviceSettings:X()(X()({},b.serviceSettings),{},{faqUids:null==b||null===(s=b.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),quickFaqUids:null==b||null===(a=b.serviceSettings)||void 0===a||null===(a=a.quickFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==b||null===(r=b.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==b||null===(i=b.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==b||null===(l=b.serviceSettings)||void 0===l||null===(l=l.shortcutFaqs)||void 0===l?void 0:l.map((function(e){return e.uid}))}),kbUid:n.kbUid}),console.log("robotObject:",u),t.next=5,(0,Z.$l)(u);case 5:d=t.sent,console.log("updateRobot response:",d),200===d.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),h(d.data)):(R.yw.destroy(),R.yw.error(d.message));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,q.jsx)("div",{children:(0,q.jsxs)(j.A,{form:s,onFinish:k,children:[(0,q.jsx)(F.Z,{width:"md",name:"kbUid",label:"知识库",options:null==f?void 0:f.data.content.map((function(e){return{value:e.uid,label:r(e.name)}})),fieldProps:{onChange:function(e){console.log("kbUid:",e)}}}),(0,q.jsx)(j.A.Item,{children:(0,q.jsx)(p.ZP,{icon:(0,q.jsx)(B.Z,{}),onClick:function(){t("/kb/llm/data")},children:"添加大模型知识库"},"github")})]})})},te=n(73453),ne=n(48489),se=n(91116),ae=n(35791),re=function(){var e=(0,y.useIntl)(),t=(0,a.useMemo)((function(){return!0}),[]),n=[{key:"kb",label:(0,q.jsx)(y.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,q.jsx)(ee,{}),disabled:t},{key:"faq",label:(0,q.jsx)(y.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"Faq"}),children:(0,q.jsx)(P.Z,{type:w._X4}),disabled:t},{key:"quickFaqs",label:(0,q.jsx)(y.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"QuickButton"}),children:(0,q.jsx)(W.Z,{type:w._X4}),disabled:t},{key:"faqGuess",label:(0,q.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FaqGuess"}),children:(0,q.jsx)(V.Z,{type:w._X4}),disabled:t},{key:"faqHot",label:(0,q.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FaqHot"}),children:(0,q.jsx)(_.Z,{type:w._X4}),disabled:t},{key:"faqShortcut",label:(0,q.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FaqShortcut"}),children:(0,q.jsx)(I.Z,{type:w._X4}),disabled:t},{key:"llm",label:(0,q.jsx)(y.FormattedMessage,{id:"llm",defaultMessage:"Llm"}),children:(0,q.jsx)(N,{}),disabled:t},{key:"keyword",label:(0,q.jsx)(y.FormattedMessage,{id:"keyword",defaultMessage:"Keyword"}),children:(0,q.jsx)(D,{}),disabled:t},{key:"third",label:(0,q.jsx)(y.FormattedMessage,{id:"third",defaultMessage:"Third"}),children:(0,q.jsx)(z,{type:w._X4}),disabled:t},{key:"transfer",label:(0,q.jsx)(y.FormattedMessage,{id:"transfer",defaultMessage:"Transfer"}),children:(0,q.jsx)($,{}),disabled:t},{key:"survey",label:(0,q.jsx)(y.FormattedMessage,{id:"survey",defaultMessage:"Survey"}),children:(0,q.jsx)(ae.Z,{type:w._X4}),disabled:t},{key:"history",label:(0,q.jsx)(y.FormattedMessage,{id:"history",defaultMessage:"History"}),children:(0,q.jsx)(te.Z,{type:w._X4}),disabled:t},{key:"inputassociation",label:(0,q.jsx)(y.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,q.jsx)(se.Z,{type:w._X4}),disabled:t},{key:"black",label:(0,q.jsx)(y.FormattedMessage,{id:"black",defaultMessage:"Black"}),children:(0,q.jsx)(J.Z,{type:w._X4}),disabled:t},{key:"antiharassment",label:(0,q.jsx)(y.FormattedMessage,{id:"antiharassment",defaultMessage:"Anti Harassment"}),children:(0,q.jsx)(Q.Z,{type:w._X4}),disabled:t}];return(0,q.jsxs)(q.Fragment,{children:[t&&(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(A.Z,{message:"企业版-高级功能",style:{marginBottom:20},type:"warning",action:(0,q.jsx)(p.ZP,{type:"link",icon:(0,q.jsx)(ne.Z,{}),onClick:function(){return window.open(w.rVq)},children:e.formatMessage({id:"setting.helpdoc"})})})}),(0,q.jsx)(T.Z,{tabPosition:"left",items:n})]})},oe=n(36649),ie=n(31207),le=n(22268),ue=n(16737),de=n(53004),ce=n(88484),fe=n(8232),ge=function(){var e=j.A.useForm(),t=d()(e,1)[0],n=(0,y.useIntl)(),s=(0,C.Z)().translateString,r=(0,c.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),i=r.currentRobot,u=r.setCurrentRobot,f=(0,a.useState)(""),g=d()(f,2),m=g[0],b=g[1];(0,a.useEffect)((function(){var e;i&&(t.setFieldValue("nickname",s(null==i?void 0:i.nickname)),t.setFieldValue("welcomeTip",s(null==i||null===(e=i.serviceSettings)||void 0===e?void 0:e.welcomeTip)),t.setFieldValue("description",s(null==i?void 0:i.description)))}),[i]);var h=function(){var e=l()(o()().mark((function e(t){var s,a,r,l,d,c,f;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),R.yw.loading(n.formatMessage({id:"updating"})),c=X()(X()({},i),{},{serviceSettings:X()(X()({},i.serviceSettings),{},{welcomeTip:t.welcomeTip,quickFaqUids:null==i||null===(s=i.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),faqUids:null==i||null===(a=i.serviceSettings)||void 0===a||null===(a=a.faqs)||void 0===a?void 0:a.map((function(e){return e.uid})),guessFaqUids:null==i||null===(r=i.serviceSettings)||void 0===r||null===(r=r.guessFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),hotFaqUids:null==i||null===(l=i.serviceSettings)||void 0===l||null===(l=l.hotFaqs)||void 0===l?void 0:l.map((function(e){return e.uid})),shortcutFaqUids:null==i||null===(d=i.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),nickname:t.nickname,description:t.description,avatar:m}),console.log("robotObject:",c),e.next=6,(0,Z.$l)(c);case 6:f=e.sent,console.log("updateRobot response:",f),200===f.code?(R.yw.success(n.formatMessage({id:"update.success"})),u(f.data)):R.yw.error(f.message),R.yw.destroy();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){b(null==i?void 0:i.avatar)}),[i]),(0,q.jsxs)(j.A,{form:t,style:{marginLeft:"100px"},onFinish:h,children:[(0,q.jsx)(fe.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return console.log("Upload event:",e),Array.isArray(e)?e:null==e?void 0:e.fileList},label:n.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,q.jsxs)(de.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),b(e)},onError:function(e){console.log("handleUploadError:",e)},children:[(0,q.jsx)(v.C,{src:m}),(0,q.jsx)(p.ZP,{icon:(0,q.jsx)(ce.Z,{}),children:n.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,q.jsx)(k.Z,{width:"md",name:"nickname",label:n.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),tooltip:n.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),placeholder:n.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),rules:[{required:!0,message:n.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"})}]}),(0,q.jsx)(E.Z,{width:"md",name:"welcomeTip",label:n.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),tooltip:n.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),placeholder:n.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),rules:[{required:!0,message:n.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"})}]}),(0,q.jsx)(E.Z,{width:"md",name:"description",label:n.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:n.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:n.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:n.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})},pe=n(59518),me=function(e){var t=e.type;console.log("TabApi:",t);var n=(0,y.useAccess)();return n.canDebug&&console.log("TabApi canDebug"),(0,q.jsx)("div",{children:(0,q.jsx)("p",{children:(0,q.jsx)(y.Access,{accessible:n.canDebug(),fallback:(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(y.FormattedMessage,{id:w.h5w})}),children:"开放api、权限控制、统计数据"})})})},ve=function(){var e=(0,y.useIntl)(),t=(0,a.useState)([]),n=d()(t,2),s=n[0],r=n[1],o=[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,q.jsx)(ge,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,q.jsx)(pe.Z,{type:w._X4})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,q.jsx)(re,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,q.jsx)(oe.Z,{type:w._X4})},{key:"channelsocial",label:e.formatMessage({id:"channelsocial",defaultMessage:"Social Channel"}),children:(0,q.jsx)(ue.Z,{type:w._X4})},{key:"channelshop",label:e.formatMessage({id:"channelshop",defaultMessage:"Shop Channel"}),children:(0,q.jsx)(le.Z,{type:w._X4})},{key:"channelforeign",label:e.formatMessage({id:"channelforeign",defaultMessage:"Foreign Channel"}),children:(0,q.jsx)(ie.Z,{type:w._X4})},{key:"tabapi",label:"API",children:(0,q.jsx)(me,{type:w._X4})}];return(0,a.useEffect)((function(){r(o)}),[]),(0,q.jsx)(T.Z,{defaultActiveKey:"basic",items:s})},be=n(77154),he=s.Z.Sider,ye=s.Z.Content,xe=function(){var e=(0,be.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,a=e.contentStyle;return(0,q.jsxs)(s.Z,{children:[(0,q.jsx)(he,{width:n,style:t,children:(0,q.jsx)(U,{})}),(0,q.jsx)(s.Z,{children:(0,q.jsx)(ye,{style:a,children:(0,q.jsx)(ve,{})})})]})}}}]);