"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1742],{50484:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(17082),u=n(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=n(64423),s=function(e,t){return u.createElement(o.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};var c=u.forwardRef(s)},72272:function(e,t,n){n.d(t,{O7:function(){return x},XS:function(){return d},k4:function(){return p},uu:function(){return y},yr:function(){return g}});var r=n(90819),u=n.n(r),a=n(73193),o=n.n(a),s=n(89933),c=n.n(s),i=n(77667),l=n(7206);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return C.apply(this,arguments)}function C(){return(C=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/visitor/api/v1/category/query",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},18237:function(e,t,n){n.d(t,{$T:function(){return p},A:function(){return x},Hf:function(){return y},P6:function(){return g},gx:function(){return d}});var r=n(90819),u=n.n(r),a=n(73193),o=n.n(a),s=n(89933),c=n.n(s),i=n(77667),l=n(7206);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/course/query/org",{method:"GET",params:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/course/query/user",{method:"GET",params:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/course/create",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return v.apply(this,arguments)}function v(){return(v=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/course/update",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return C.apply(this,arguments)}function C(){return(C=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/course/delete",{method:"POST",data:o()(o()({},t),{},{client:i.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},93139:function(e,t,n){var r=n(74145);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},6584:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var r=n(93139),u=n(64476),a=n(44194),o=n(90819),s=n.n(o),c=n(89933),i=n.n(c),l=n(45332),d=n.n(l),f=n(89756),p=n(18237),h=n(6433),g=n(22509),m=n(50484),y=n(31816),v=n(52519),x=n(83730),C=n(12265),b=n(47807),w=n(61411),k=n(62599),R=n(19140),S=n(47725),j=n(77090),Z=n(26305),M=n(31549),T=function(e){var t=e.isEdit,n=e.course,r=e.open,u=e.onClose,o=e.onSubmit,s=b.Z.useForm(),c=d()(s,1)[0],i=(0,Z.v)((function(e){return e.categoryTreeOptions}));(0,a.useEffect)((function(){var e,r;n&&c?(c.setFieldsValue({name:null==n?void 0:n.name,description:null==n?void 0:n.description}),c.setFieldsValue({categories:[null==n||null===(e=n.mainCategory)||void 0===e?void 0:e.uid,null==n||null===(r=n.subCategory)||void 0===r?void 0:r.uid]})):null==c||t||(console.log("form resetFields"),c.resetFields())}),[n]);return(0,M.jsx)("div",{children:(0,M.jsx)(w.Z,{title:t?"修改课程":"新建课程",onClose:u,open:r,extra:(0,M.jsxs)(k.Z,{children:[(0,M.jsx)(C.ZP,{onClick:u,children:"取消"}),(0,M.jsx)(C.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:null==n?void 0:n.uid,name:e.name,cover:n.cover,description:e.description,detail:n.detail,price:n.price,mainCategory:{uid:e.categories[0]},subCategory:{uid:e.categories[1]},published:"true"===e.published};o(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:"保存"})]}),children:(0,M.jsxs)(b.Z,{form:c,children:[(0,M.jsx)(b.Z.Item,{name:"name",label:"课程名称",initialValue:null==n?void 0:n.name,children:(0,M.jsx)(R.Z,{placeholder:"请输入课程名称"})}),(0,M.jsx)(b.Z.Item,{name:"categories",label:"课程分类",children:(0,M.jsx)(S.Z,{options:i,onChange:function(e,t){console.log("Cascader value:",e),console.log("Cascader selectedData:",t)},placeholder:"选择分类"})}),(0,M.jsx)(b.Z.Item,{name:"description",label:"课程描述",initialValue:null==n?void 0:n.description,children:(0,M.jsx)(R.Z.TextArea,{placeholder:"请输入课程描述"})}),(0,M.jsx)(b.Z.Item,{name:"published",label:"课程状态",initialValue:null!=n&&n.published?"true":"false",children:(0,M.jsx)(j.default,{style:{width:120},onChange:function(e){console.log("selected ".concat(e))},options:[{value:"true",label:"已发布"},{value:"false",label:"未发布"}]})})]})})})},q=n(72272),V=n(7206),E=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:(0,M.jsx)(V.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"name",copyable:!0},{title:(0,M.jsx)(V.FormattedMessage,{id:"category",defaultMessage:"Category"}),key:"category",render:function(e,t){var n=t.mainCategory?t.mainCategory.name:"-",r=t.subCategory?t.subCategory.name:"-";return(0,M.jsxs)("span",{children:[n," / ",r]})}},{title:"城市",dataIndex:"city",render:function(e,t){return t.city?t.city.name:"-"}},{title:"发布人",editable:!1,renderText:function(e,t,n,r){var u;return null===(u=t.user)||void 0===u?void 0:u.nickname}},{title:(0,M.jsx)(V.FormattedMessage,{id:"status",defaultMessage:"Status"}),key:"published",render:function(e,t){return t.published?"已发布":"未发布"}},{title:(0,M.jsx)(V.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",editable:!1,sorter:!0,hideInSearch:!0}],O=function(){var e=(0,V.useIntl)(),t=(0,g.L)((function(e){return e.userInfo})),n=(0,a.useRef)(),r=(0,a.useState)(1),u=d()(r,2),o=u[0],c=u[1],l=(0,a.useState)(10),b=d()(l,2),w=b[0],k=b[1],R=(0,a.useState)(!0),S=d()(R,2),j=S[0],O=S[1],A=(0,a.useState)(),F=d()(A,2),I=F[0],P=F[1],z=(0,h.K)((function(e){return{courseResult:e.courseResult,insertCourseResult:e.insertCourseResult,updateCourseResult:e.updateCourseResult,deleteCourseResult:e.deleteCourseResult,setCourseResult:e.setCourseResult}})),D=z.courseResult,B=z.insertCourseResult,G=z.updateCourseResult,H=z.deleteCourseResult,U=z.setCourseResult,W=(0,Z.v)((function(e){return e.setCategoryResult})),J=(0,a.useState)(!1),K=d()(J,2),L=K[0],$=K[1],N=x.Z.useModal(),Q=d()(N,2),X=Q[0],Y=Q[1],_=function(){P(void 0),O(!1),$(!0)},ee=function(){$(!1)},te=function(){var t=i()(s()().mark((function t(n){var r,u;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer:",n),!j){t.next=9;break}return t.next=4,(0,p.Hf)(n);case 4:r=t.sent,console.log("updateCourse:",r),200===r.code?(f.yw.success("更新成功"),G(r.data),ee()):f.yw.error(r.message),t.next=14;break;case 9:return t.next=11,(0,p.P6)(n);case 11:u=t.sent,console.log("createCourse:",u),200===u.code?(f.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),B(u.data),ee()):f.yw.error(u.message);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ne=function(){var e=i()(s()().mark((function e(t){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleDeleteCourse:",t),e.next=3,(0,p.A)(t);case 3:200===(n=e.sent).code?H(t):f.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=[].concat(E,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",render:function(t,n,r,u){return[(0,M.jsx)("a",{onClick:function(){console.log("edit record:",n),function(e){P(e),O(!0),$(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,M.jsx)(C.ZP,{size:"small",type:"link",onClick:function(){return function(t){X.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,M.jsx)(m.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.name,"】？"),onOk:function(){ne(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:"删除"},"delete")]}}]),ue=function(){var e=i()(s()().mark((function e(){var n,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={pageNumber:o-1,pageSize:w},null==t||!t.superUser){e.next=7;break}return e.next=4,(0,p.gx)(n);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,p.$T)(n);case 9:e.t0=e.sent;case 10:r=e.t0,console.log("getAllCourses response:",n,r),200===r.code?U(r):f.yw.error(r.message);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=i()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,q.O7)();case 2:t=e.sent,console.log("getAllCategories response:",t),200===t.code?W(t):f.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){ue(),ae()}),[]),(0,a.useEffect)((function(){ue()}),[o,w]),(0,a.useEffect)((function(){console.log("courseResult:",D),n.current.reload()}),[D]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(v.Z,{columns:re,actionRef:n,cardBordered:!0,request:function(){var e=i()(s()().mark((function e(t,n,r){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),c(t.current),k(t.pageSize),e.abrupt("return",Promise.resolve({data:D.data.content,success:!0,total:D.data.totalElements}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:w,showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"课程",toolBarRender:function(){return[(0,M.jsxs)(C.ZP,{type:"primary",onClick:_,children:[(0,M.jsx)(y.Z,{}),e.formatMessage({id:"create",defaultMessage:"Create"})]})]}}),(0,M.jsx)(T,{isEdit:j,course:I,open:L,onClose:ee,onSubmit:te}),Y]})},A=(u.Z.Sider,u.Z.Content),F=function(){var e=(0,r.Z)().contentStyle;return(0,M.jsx)(u.Z,{children:(0,M.jsx)(u.Z,{children:(0,M.jsx)(A,{style:e,children:(0,M.jsx)(O,{})})})})}},26305:function(e,t,n){n.d(t,{v:function(){return d}});var r=n(76711),u=n.n(r),a=n(73193),o=n.n(a),s=n(77667),c=n(39701),i=n(83642),l=n(41617),d=(0,c.Ue)()((0,i.mW)((0,i.tJ)((0,l.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:""},setCategoryResult:function(t){var n,r=function(e){var t=[];return e.data.content.forEach((function(e){var n={label:e.name,value:e.uid};t.push(n)})),t}(t),a=o()(o()({},t),{},{data:{content:[{uid:"all",name:"All"}].concat(u()(t.data.content))}}),s=function(e){var t=[];return e.data.content.forEach((function(e){var n={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(n.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(n)})),t}(a);e({categoryResult:a,categoryTreeOptions:s,categorySelectOptions:r}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0?e({currentCategory:t.data.content[0]}):e({currentCategory:{uid:""}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var n=e.categoryResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},setCurrentCategoryUid:function(n){var r=t().categoryResult.data.content.find((function(e){return e.uid===n}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:s.OMm})))},6433:function(e,t,n){n.d(t,{K:function(){return s}});var r=n(77667),u=n(39701),a=n(83642),o=n(41617),s=(0,u.Ue)()((0,a.mW)((0,a.tJ)((0,o.n)((function(e,t){return{courseResult:{data:{content:[]}},insertCourseResult:function(t){e((function(e){e.courseResult.data.content.unshift(t)}))},updateCourseResult:function(t){e((function(e){var n=e.courseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Course with uid ".concat(t.uid," not found."))}))},deleteCourseResult:function(t){e((function(e){var n=e.courseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n.splice(r,1):console.warn("Course with uid ".concat(t.uid," not found."))}))},setCourseResult:function(t){e({courseResult:t})},deleteCourseCache:function(){return e({},!0)}}})),{name:r.vCH})))}}]);