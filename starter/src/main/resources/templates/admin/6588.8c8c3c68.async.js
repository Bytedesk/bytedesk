"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6588],{8377:function(e,r,n){n.d(r,{Z:function(){return S}});var t=n(90819),s=n.n(t),a=n(89933),o=n.n(a),u=n(45332),i=n.n(u),c=n(15722),l=n(53530),d=n(27487),g=n(75365),f=n(79777),p=n(88996),y=n(78996),w=n(44194),h=n(40612),v=n(86803),m=n(90838),M=n(76750),x=n(30921),k=n(6397),b=n(55735),C=n(28425),L=n(31549),S=function(e){var r=e.type,n=(0,x.useIntl)(),t=(0,w.useState)(!0),a=i()(t,2),u=a[0],S=a[1],Z=(0,h.u)((function(e){return e.currentOrg})),j=(0,k.j)((function(e){return e.currentKbase})),z=(0,w.useState)(!1),T=i()(z,2),U=T[0],D=T[1],F=(0,m.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),K=F.categoryTreeOptions,O=F.currentCategory,P=F.setCurrentCategoryUid,B=(0,M.Z)(),E=B.translateString,J=B.translateStringTranct,H=l.Z.useModal(),N=i()(H,2),R=N[0],q=N[1],A=function(){var e=o()(s()().mark((function e(r){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={showLoading:!0,loadingMessage:n.formatMessage({id:u?"updating":"creating"}),successMessage:n.formatMessage({id:u?"update.success":"create.success"}),errorMessage:n.formatMessage({id:u?"update.error":"create.error",defaultMessage:u?"Update failed":"Create failed"})},!u){e.next=7;break}return e.next=4,(0,C.ht)(r,t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,C.i8)(r,t);case 9:e.t0=e.sent;case 10:e.t0&&(D(!1),I());case 12:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),I=function(){var e=o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.HK)(r,null==Z?void 0:Z.uid,null==j?void 0:j.uid,{showLoading:!0,loadingMessage:n.formatMessage({id:"loading"}),errorMessage:n.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(!0),D(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=o()(s()().mark((function e(r){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.sT)(r,{showLoading:!0,loadingMessage:n.formatMessage({id:"deleting"}),successMessage:n.formatMessage({id:"delete.success"}),errorMessage:n.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&I();case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){r!==b.hcJ&&I()}),[j]),(0,w.useEffect)((function(){r===b.hcJ&&I()}),[]);return(0,L.jsxs)("div",{children:[(0,L.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{margin:5},children:[(0,L.jsx)(g.ZP,{type:"primary",size:"small",onClick:function(){S(!1),D(!0)},children:n.formatMessage({id:"create.category"})}),(0,L.jsx)(g.ZP,{size:"small",onClick:I,children:n.formatMessage({id:"refresh"})}),""!==(null==O?void 0:O.uid)&&(null==O?void 0:O.uid)!==b.zBg&&(0,L.jsx)(g.ZP,{size:"small",onClick:X,children:n.formatMessage({id:"edit"})}),""!==(null==O?void 0:O.uid)&&(null==O?void 0:O.uid)!==b.zBg&&(0,L.jsx)(g.ZP,{onClick:function(){return function(e){e.uid!==b.zBg?R.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,L.jsx)(c.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(E(e.name),"】？"),onOk:function(){G(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})}):v.yw.error(n.formatMessage({id:"delete.dept.all.error"}))}(O)},size:"small",style:{float:"right"},danger:!0,children:n.formatMessage({id:"delete"})})]}),(0,L.jsx)(f.Z,{defaultSelectedKeys:[null==O?void 0:O.uid],selectedKeys:[null==O?void 0:O.uid],onSelect:function(e,r){0!==e.length&&P(e[0].toString())},treeData:K,blockNode:!0,titleRender:function(e){return(0,L.jsx)(p.Z,{title:E(e.title),children:J(e.title)})}}),U&&(0,L.jsx)(y.Z,{open:U,type:r,isEdit:u,onCancel:function(){D(!1)},onSubmit:A}),q]})}},28425:function(e,r,n){n.d(r,{HK:function(){return d},ht:function(){return f},i8:function(){return g},sT:function(){return p}});var t=n(90819),s=n.n(t),a=n(89933),o=n.n(a),u=n(86803),i=n(32045),c=n(90838),l=n(55735),d=function(){var e=o()(s()().mark((function e(r,n,t,a){var o,d,g;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.v.getState().setCategoryResult,null!=a&&a.showLoading&&u.yw.loading((null==a?void 0:a.loadingMessage)||"Loading..."),d={pageNumber:0,pageSize:(null==a?void 0:a.pageSize)||50,orgUid:n},r!==l.hcJ&&(d.kbUid=t),e.prev=4,e.next=7,(0,i.XS)(d);case 7:if(g=e.sent,console.log("queryCategories response: ",g,d),200!==g.code){e.next=15;break}return o(g),null!=a&&a.showLoading&&u.yw.destroy(),e.abrupt("return",g);case 15:return null!=a&&a.showLoading&&u.yw.destroy(),u.yw.error(g.message),e.abrupt("return",null);case 18:e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(4),null!=a&&a.showLoading&&u.yw.destroy(),u.yw.error((null==a?void 0:a.errorMessage)||"Failed to fetch categories"),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[4,20]])})));return function(r,n,t,s){return e.apply(this,arguments)}}(),g=function(){var e=o()(s()().mark((function e(r,n){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Creating..."),e.prev=1,e.next=4,(0,i.k4)(r);case 4:if(t=e.sent,console.log("createCategory response:",t),200!==t.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Create Success"),e.abrupt("return",t);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(t.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to create category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(r,n){return e.apply(this,arguments)}}(),f=function(){var e=o()(s()().mark((function e(r,n){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Updating..."),e.prev=1,e.next=4,(0,i.yr)(r);case 4:if(t=e.sent,console.log("updateCategory response:",t),200!==t.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Update Success"),e.abrupt("return",t);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(t.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to update category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(r,n){return e.apply(this,arguments)}}(),p=function(){var e=o()(s()().mark((function e(r,n){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=n&&n.showLoading&&u.yw.loading((null==n?void 0:n.loadingMessage)||"Deleting..."),e.prev=1,e.next=4,(0,i.uu)(r);case 4:if(t=e.sent,console.log("deleteCategory response:",t),200!==t.code){e.next=12;break}return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.success((null==n?void 0:n.successMessage)||"Delete Success"),e.abrupt("return",t);case 12:return null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error(t.message),e.abrupt("return",null);case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(1),null!=n&&n.showLoading&&u.yw.destroy(),u.yw.error((null==n?void 0:n.errorMessage)||"Failed to delete category"),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(r,n){return e.apply(this,arguments)}}()}}]);