"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1730],{87048:function(e,t,r){r.d(t,{$t:function(){return h},a_:function(){return g},vf:function(){return d}});var a=r(90228),n=r.n(a),s=r(26068),o=r.n(s),i=r(87999),c=r.n(i),u=r(64453),l=r(45234);function d(e){return p.apply(this,arguments)}function p(){return(p=c()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/vip/crm/query/visitor/org",{method:"GET",params:o()(o()({},t),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return f.apply(this,arguments)}function f(){return(f=c()(n()().mark((function e(){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/visitor/api/v1/kaptcha",{method:"GET",params:{client:u.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return m.apply(this,arguments)}function m(){return(m=c()(n()().mark((function e(t,r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/visitor/api/v1/kaptcha/check",{method:"POST",data:{captchaUid:t,captchaCode:r,client:u.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67130:function(e,t,r){var a=r(90228),n=r.n(a),s=r(87999),o=r.n(s),i=r(48305),c=r.n(i),u=r(87048),l=r(90995),d=r(45234),p=r(25139),g=r(75271),f=r(52676);t.Z=function(e){var t=e.onKaptchaChange,r=e.onKaptchaCheck,a=(0,d.useIntl)(),s=(0,g.useState)(),i=c()(s,2),h=i[0],m=i[1],x=(0,g.useState)(),v=c()(x,2),w=v[0],y=v[1],M=function(){var e=o()(n()().mark((function e(){var t;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.a_)();case 2:200===(t=e.sent).code&&(m(t.data.captchaUid),y(t.data.captchaImage));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=o()(n()().mark((function e(t,a){var s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.$t)(t,a);case 2:s=e.sent,console.log("checkCaptcha response",s),200===s.code?r&&r(!0):r&&r(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();(0,g.useEffect)((function(){M()}),[]);return(0,f.jsx)(f.Fragment,{children:w&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(p.Z,{onChange:function(e){t&&(t(h,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?k(h,e.target.value):r&&r(!1))},prefix:(0,f.jsx)(l.Z,{}),placeholder:a.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40}}),(0,f.jsx)("img",{src:w,alt:"captcha",onClick:M})]})})}},13350:function(e,t,r){r.r(t);var a=r(26068),n=r.n(a),s=r(90228),o=r.n(s),i=r(87999),c=r.n(i),u=r(48305),l=r.n(u),d=r(51717),p=r(96789),g=r(78712),f=r(64391),h=r(18880),m=r(43393),x=r(56566),v=r(24617),w=r(64826),y=r(42730),M=r(8570),k=r(45234),j=r(2475),b=r(20679),C=r(32878),Z=r(42502),q=r(17943),S=r(28733),T=r(75271),A=r(94414),F=r(37240),z=r(64453),P=r(30536),I=r(30967),L=r(65453),R=r(74592),U=r(67130),V=r(49437),_=r(52676),B=j.Z.defaultAlgorithm,E=j.Z.darkAlgorithm,N=function(){var e=(0,M.l)((function(e){var t=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:t.borderRadius,":hover":{backgroundColor:t.colorBgTextHover}}}));return(0,_.jsx)("div",{className:e,"data-lang":!0,children:k.SelectLang&&(0,_.jsx)(k.SelectLang,{})})},$=function(e){var t=e.content;return(0,_.jsx)(b.Z,{style:{marginBottom:24},message:t,type:"error",showIcon:!0})},K=function(){var e=m.A.useForm(),t=l()(e,1)[0],r=j.Z.useToken().token,a=(0,A.Z)().isDarkMode,s=(0,T.useRef)(),i=(0,T.useState)(!1),u=l()(i,2),M=u[0],b=u[1],q=(0,k.useModel)("@@initialState"),S=(q.initialState,q.loading,q.refresh,q.setInitialState),B=(0,T.useState)(!1),E=l()(B,2),K=E[0],G=E[1],D=(0,P.t)((function(e){return e.setAccessToken})),H=(0,L.L)((function(e){return e.setUserInfo})),W=(0,k.getLocale)();console.log("register page locale:",W);var Y=(0,k.useIntl)(),O=(0,T.useState)(""),J=l()(O,2),Q=J[0],X=J[1],ee=(0,T.useState)(""),te=l()(ee,2),re=te[0],ae=te[1],ne=function(){var e=c()(o()().mark((function e(r,a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X(r),ae(a),t.setFieldValue("captchaCode",a);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),se=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,T.useEffect)((function(){(0,V.ME)(),(0,R.Bc)()&&G(!0),(0,R.pr)()}),[]);var oe=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(0,I.flushSync)((function(){S((function(e){return n()(n()({},e),{},{userInfo:t})}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=c()(o()().mark((function e(t){var r,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("values:",t),F.yw.loading(Y.formatMessage({id:"registering",defaultMessage:"registering..."})),e.next=5,(0,d.z2)(n()({},t));case 5:if(r=e.sent,console.log("registerResult:",r),200!==r.code){e.next=15;break}return F.yw.destroy(),F.yw.success(r.message),a={username:t.email,password:t.password,captchaUid:Q,captchaCode:t.captchaCode,platform:z.iw8},ce(a),e.abrupt("return");case 15:F.yw.destroy(),F.yw.error(r.message);case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0),F.yw.error(Y.formatMessage({id:"register.error",defaultMessage:"register failed"}));case 23:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=c()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("handleSubmit values: ",t),F.yw.loading(Y.formatMessage({id:"logining",defaultMessage:"logining..."})),e.next=5,(0,d.x4)(n()({},t));case 5:r=e.sent,console.log("LoginResult:",r),200===r.code?(F.yw.destroy(),F.yw.success(Y.formatMessage({id:"login.success",defaultMessage:"login success"})),oe(r.data.user),H(r.data.user),D(r.data.accessToken),k.history.push("/")):(F.yw.destroy(),F.yw.error(r.message)),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),F.yw.error(Y.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();return(0,_.jsxs)(x._Y,{hashed:!1,dark:a,children:[(0,_.jsx)(N,{}),(0,_.jsx)("div",{style:{backgroundColor:r.colorBgContainer,textAlign:"center",height:"100vh",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:K?(0,_.jsxs)(v.U,{form:t,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,_.jsx)("img",{alt:"logo",src:"/admin/icons/logo.png"}),title:(0,_.jsx)(k.FormattedMessage,{id:"app.title"}),subTitle:Y.formatMessage({id:"pages.login.registerAccount"}),initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:Y.formatMessage({id:"pages.login.register"})}},onFinish:function(){var e=c()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("login values:",t),r={email:t.username,password:t.password,mobile:t.mobile,code:t.code,captchaUid:Q,captchaCode:t.captchaCode,platform:z.iw8},console.log("register info:",r),e.next=5,ie(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:["error"===status&&(0,_.jsx)($,{content:Y.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"账户或密码错误"})}),(0,_.jsx)(w.Z,{name:"username",fieldProps:{size:"large",prefix:(0,_.jsx)(g.Z,{})},placeholder:Y.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入邮箱!"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,_.jsx)(w.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,_.jsx)(f.Z,{})},placeholder:Y.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})}]}),(0,_.jsx)(w.Z,{fieldProps:{size:"large",prefix:(0,_.jsx)(h.Z,{})},name:"mobile",placeholder:Y.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,_.jsx)(m.A.Item,{name:"captchaCode",rules:[{required:!0,message:Y.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,_.jsx)(U.Z,{onKaptchaChange:ne,onKaptchaCheck:se})}),(0,_.jsx)(y.Z,{fieldProps:{size:"large",prefix:(0,_.jsx)(f.Z,{})},captchaProps:{size:"large",disabled:!M},placeholder:Y.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,t){return e?"".concat(t," ").concat(Y.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):Y.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:s,onGetCaptcha:function(){var e=c()(o()().mark((function e(t){var r,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||11!==t.length){e.next=13;break}return r={mobile:t,type:z.i_k,captchaUid:Q,captchaCode:re,platform:z.iw8},e.next=4,(0,d.Y7)(r);case 4:if(a=e.sent,console.log("sendMobileCodeResult:",a),200===a.code){e.next=10;break}return F.yw.error(a.message),setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=s.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:F.yw.success(a.message),e.next=14;break;case 13:F.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),"error"===status&&(0,_.jsx)($,{content:"验证码错误"}),(0,_.jsx)("div",{style:{marginBottom:64},children:(0,_.jsx)("div",{style:{float:"right"},children:(0,_.jsx)(k.Link,{to:"/auth/login",children:(0,_.jsx)(k.FormattedMessage,{id:"pages.login.submit",defaultMessage:"登录 "})})})})]}):(0,_.jsx)("div",{style:{textAlign:"center",margin:"0 auto"},children:(0,_.jsx)(C.Z,{description:"only for vip users, please contact: 270580156@qq.com",children:(0,_.jsx)(Z.ZP,{type:"primary",onClick:function(){window.open("https://www.weiyuai.cn")},children:"open weiyuai.cn"})})})}),(0,_.jsx)(p.$_,{})]})};t.default=function(){var e=(0,A.Z)().isDarkMode;return(0,_.jsx)(q.ZP,{theme:{algorithm:e?E:B},children:(0,_.jsxs)(S.Z,{children:[(0,_.jsx)(F.ZP,{}),(0,_.jsx)(K,{})]})})}}}]);