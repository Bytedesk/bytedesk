"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6693],{19353:function(gn,Ie,i){i.r(Ie),i.d(Ie,{default:function(){return fn}});var ve=i(21612),l=i(67294),ze=i(15009),k=i.n(ze),Ve=i(99289),Y=i.n(Ve),He=i(5574),Z=i.n(He),ne=i(37326),Ke=i(85576),Qe=i(86250),L=i(14726),Se=i(2487),$e=i(7134),qe=i(11475),Ge=i(64789),V=i(86745),Ye=i(39825),pe=i(87676),I=i(85615),ae=i(34994),Be=i(5966),ge=i(64317),e=i(85893),Je=function(t){var o=t.open,n=t.onClose,r=t.onSubmit,s=(0,V.useIntl)(),f=ae.A.useForm(),F=Z()(f,1),g=F[0],m=(0,pe.u)(function(T){return T.currentOrg}),y=function(){console.log("handleSaveRobot"),g.validateFields().then(function(R){console.log("handleSaveRobot values:",R);var b={nickname:R.nickname,type:R.type,orgUid:m.uid};console.log("robotObject:",b),r(b)}).catch(function(R){console.log("Form errors:",R)})},w=function(){n()},M=function(R){console.log("onTreeSelectChange:",R)};return(0,e.jsx)("div",{children:(0,e.jsx)(Ke.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:o,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:y,onCancel:w,children:(0,e.jsxs)(ae.A,{form:g,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,e.jsx)(Be.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,e.jsx)(ge.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:I.f4,defaultMessage:"Service"}),value:I.f4},{label:s.formatMessage({id:I.wG,defaultMessage:"Marketing"}),value:I.wG},{label:s.formatMessage({id:I.ML,defaultMessage:"Knowledgebase"}),value:I.ML},{label:s.formatMessage({id:I.iu,defaultMessage:"Qa"}),value:I.iu}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:M,allowClear:!0}})]})})})},We=Je,ue=i(76545),j=i(80049),fe=i(73803),Xe=function(){var t=(0,Ye.Z)(),o=t.isDarkMode,n=(0,V.useIntl)(),r=(0,l.useRef)(!1),s=(0,fe.Z)(),f=s.translateString,F=s.translateStringTranct,g=(0,ne.V)(function(A){return{robotResult:A.robotResult,currentRobot:A.currentRobot,insertRobot:A.insertRobot,deleteCurrentRobot:A.deleteCurrentRobot,setRobotResult:A.setRobotResult,setCurrentRobot:A.setCurrentRobot}}),m=g.robotResult,y=g.currentRobot,w=g.insertRobot,M=g.deleteCurrentRobot,T=g.setRobotResult,R=g.setCurrentRobot,b=(0,pe.u)(function(A){return A.currentOrg}),C=Ke.Z.useModal(),B=Z()(C,2),a=B[0],c=B[1],K=function($){a.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,e.jsx)(qe.Z,{}),content:"".concat(n.formatMessage({id:"deleteAfirm",defaultMessage:"Delete"}),"\u3010").concat(f($.nickname),"\u3011\uFF1F"),onOk:function(){S($)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})},S=function(){var A=Y()(k()().mark(function $(z){var H;return k()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return console.log("delete robot",z),j.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),N.next=4,(0,ue.gf)(z);case 4:H=N.sent,console.log("delete robot response",H),H.code===200?(j.yw.destroy(),j.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),M(z.uid)):(j.yw.destroy(),j.yw.error(H.message));case 7:case"end":return N.stop()}},$)}));return function(z){return A.apply(this,arguments)}}(),v=function(){var A=Y()(k()().mark(function $(){var z,H;return k()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!r.current){N.next=3;break}return console.log("isLoading: 1",r.current),N.abrupt("return");case 3:return r.current=!0,j.yw.loading("loading"),z={pageNumber:0,pageSize:50,orgUid:b.uid},N.next=8,(0,ue.p0)(z);case 8:H=N.sent,console.log("queryRobotsByOrg: ",H),H.code===200?(j.yw.destroy(),T(H)):(j.yw.destroy(),j.yw.error(H.message)),r.current=!1;case 12:case"end":return N.stop()}},$)}));return function(){return A.apply(this,arguments)}}();(0,l.useEffect)(function(){v()},[]);var P=(0,l.useState)(!1),p=Z()(P,2),U=p[0],d=p[1],D=function(){d(!0)},G=function(){var A=Y()(k()().mark(function $(z){var H;return k()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return j.yw.loading(n.formatMessage({id:"creating",defaultMessage:"Creating"})),N.next=3,(0,ue.lg)(z);case 3:H=N.sent,console.log("handleSaveRobot response:",H),H.code===200?(j.yw.destroy(),j.yw.success(n.formatMessage({id:"create.success"})),w(H.data),d(!1)):(j.yw.destroy(),d(!1),j.yw.error(H.message));case 6:case"end":return N.stop()}},$)}));return function(z){return A.apply(this,arguments)}}(),E=function(){d(!1)},x=function(){D()},q=function($,z){R($)},_=function($){return n.formatMessage({id:$==null?void 0:$.type,defaultMessage:$==null?void 0:$.type})};return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{style:{margin:10},children:(0,e.jsxs)(Qe.Z,{gap:"small",align:"flex-start",children:[(0,e.jsx)(L.ZP,{size:"small",type:"primary",icon:(0,e.jsx)(Ge.Z,{}),onClick:x,children:n.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,e.jsx)(L.ZP,{size:"small",onClick:v,children:n.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,e.jsx)(L.ZP,{onClick:function(){return K(y)},size:"small",style:{float:"right"},danger:!0,disabled:(y==null?void 0:y.uid)==="",children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,e.jsx)(Se.Z,{itemLayout:"horizontal",dataSource:m.data.content,renderItem:function($,z){return(0,e.jsx)(Se.Z.Item,{style:(y==null?void 0:y.uid)===$.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return q($,z)},children:(0,e.jsx)(Se.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,e.jsx)($e.C,{src:$.avatar}),title:(0,e.jsx)(e.Fragment,{children:F($==null?void 0:$.nickname)}),description:_($)})})}}),(0,e.jsx)(We,{open:U,onClose:E,onSubmit:G}),c]})},_e=Xe,xe=i(48096),et=i(97857),J=i.n(et),tt=i(66723),Ae=i(88484),Re=i(90672),W=i(8232),nt=function(){var u,t=W.Z.useForm(),o=Z()(t,1),n=o[0],r=(0,V.useIntl)(),s=(0,fe.Z)(),f=s.translateString,F=(0,ne.V)(function(a){return{currentRobot:a.currentRobot,setCurrentRobot:a.setCurrentRobot}}),g=F.currentRobot,m=F.setCurrentRobot,y=(0,l.useState)(""),w=Z()(y,2),M=w[0],T=w[1];(0,l.useEffect)(function(){var a=ne.V.subscribe(function(c,K){var S,v,P;n.setFieldValue("nickname",f((S=c.currentRobot)===null||S===void 0?void 0:S.nickname)),n.setFieldValue("welcomeTip",f((v=c.currentRobot)===null||v===void 0||(v=v.serviceSettings)===null||v===void 0?void 0:v.welcomeTip)),n.setFieldValue("description",f((P=c.currentRobot)===null||P===void 0?void 0:P.description))});return a},[g]);var R=function(){var a=Y()(k()().mark(function c(K){var S,v;return k()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("onFinish:",K),j.yw.loading(r.formatMessage({id:"updating"})),S=J()(J()(J()({},g),K),{},{avatar:M}),console.log("robotObject:",S),p.next=6,(0,ue.$l)(S);case 6:v=p.sent,console.log("updateRobot response:",v),v.code===200?(j.yw.success(r.formatMessage({id:"update.success"})),m(v.data)):j.yw.error(v.message),j.yw.destroy();case 10:case"end":return p.stop()}},c)}));return function(K){return a.apply(this,arguments)}}(),b=function(c){console.log("handleUploadSuccess:",c),T(c)},C=function(c){console.log("handleUploadError:",c)},B=function(c){return console.log("Upload event:",c),Array.isArray(c)?c:c==null?void 0:c.fileList};return(0,l.useEffect)(function(){T(g==null?void 0:g.avatar)},[g]),(0,e.jsxs)(ae.A,{form:n,style:{marginLeft:"100px"},onFinish:R,initialValues:{nickname:f(g==null?void 0:g.nickname),welcomeTip:f(g==null||(u=g.serviceSettings)===null||u===void 0?void 0:u.welcomeTip),description:f(g==null?void 0:g.description)},children:[(0,e.jsx)(W.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:B,label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,e.jsxs)(tt.G,{onSuccess:b,onError:C,children:[(0,e.jsx)($e.C,{src:M}),(0,e.jsx)(L.ZP,{icon:(0,e.jsx)(Ae.Z,{}),children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,e.jsx)(Be.Z,{width:"md",name:"nickname",label:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),tooltip:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),placeholder:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"})}]}),(0,e.jsx)(Re.Z,{width:"md",name:"welcomeTip",label:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),tooltip:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),placeholder:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"})}]}),(0,e.jsx)(Re.Z,{width:"md",name:"description",label:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})},rt=function(){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(nt,{})})};function mn(u){return Ce.apply(this,arguments)}function Ce(){return Ce=_asyncToGenerator(_regeneratorRuntime().mark(function u(t){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/v1/kb/query",{method:"GET",params:{pageNumber:t.pageNumber,pageSize:t.pageSize,client:HTTP_CLIENT}}));case 1:case"end":return n.stop()}},u)})),Ce.apply(this,arguments)}function at(u,t){return De.apply(this,arguments)}function De(){return De=Y()(k()().mark(function u(t,o){return k()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/v1/kb/file/query",{method:"GET",params:{kbName:t,pageNumber:o.pageNumber,pageSize:o.pageSize,client:I.bV}}));case 1:case"end":return r.stop()}},u)})),De.apply(this,arguments)}function ot(u,t){return we.apply(this,arguments)}function we(){return we=Y()(k()().mark(function u(t,o){return k()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/v1/kb/doc/query",{method:"GET",params:{kbName:t,pageNumber:o.pageNumber,pageSize:o.pageSize,client:I.bV}}));case 1:case"end":return r.stop()}},u)})),we.apply(this,arguments)}function vn(u,t){return Me.apply(this,arguments)}function Me(){return Me=_asyncToGenerator(_regeneratorRuntime().mark(function u(t,o){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/llm/kb/file/doc/update",{method:"POST",data:{did:t,pageContent:o,client:HTTP_CLIENT}}));case 1:case"end":return r.stop()}},u)})),Me.apply(this,arguments)}function pn(u,t,o){return je.apply(this,arguments)}function je(){return je=_asyncToGenerator(_regeneratorRuntime().mark(function u(t,o,n){return _regeneratorRuntime().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",request("/update/doc",{method:"POST",data:{did:t,content:o,metadata:n,client:HTTP_CLIENT}}));case 1:case"end":return s.stop()}},u)})),je.apply(this,arguments)}function st(u){return(0,V.request)("/api/v1/kb/file/delete",{method:"POST",params:{kid:u,client:I.bV}})}function lt(u){return Te.apply(this,arguments)}function Te(){return Te=Y()(k()().mark(function u(t){return k()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,V.request)("/api/v1/kb/doc/delete",{method:"POST",params:{did:t,client:I.bV}}));case 1:case"end":return n.stop()}},u)})),Te.apply(this,arguments)}function bn(u){return ke.apply(this,arguments)}function ke(){return ke=_asyncToGenerator(_regeneratorRuntime().mark(function u(t){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/delete/doc",{method:"POST",data:{did:t,client:HTTP_CLIENT}}));case 1:case"end":return n.stop()}},u)})),ke.apply(this,arguments)}var it=i(73445),Oe=i(782),ut=i(71381),ce=(0,it.Ue)()((0,Oe.mW)((0,Oe.tJ)((0,ut.n)(function(u,t){return{kbFileResult:{},kbDocResult:{items:[]},currentKbFile:{},currentKbDoc:{fileName:"",pageContent:""},fetchFiles:function(){var o=Y()(k()().mark(function r(s,f){var F;return k()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("kbName",s," pageParams",f),m.next=3,at(s,f);case 3:F=m.sent,console.log("kbName kbFiles",F);case 5:case"end":return m.stop()}},r)}));function n(r,s){return o.apply(this,arguments)}return n}(),deleteFile:function(){var o=Y()(k()().mark(function r(s){var f,F,g,m,y;return k()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return console.log("delete file",s),M.next=3,st(s);case 3:f=M.sent,F=t().kbFileResult.data.content.filter(function(T){return T.uid!==s}),u(function(T){return{kbFileResult:{items:F}}}),console.log("delete file result",f),g=t().kbDocResult.data.content,m=k()().mark(function T(){var R;return k()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:R=f.data[y],g=g.filter(function(B){return B.uid!==R});case 2:case"end":return C.stop()}},T)}),y=0;case 10:if(!(y<f.data.length)){M.next=15;break}return M.delegateYield(m(),"t0",12);case 12:y++,M.next=10;break;case 15:u(function(T){return{kbFileDocResult:{items:g}}});case 16:case"end":return M.stop()}},r)}));function n(r){return o.apply(this,arguments)}return n}(),fetchDocs:function(){var o=Y()(k()().mark(function r(s,f){var F;return k()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("fetchFileDocs kbName",s," pageParams",f),m.next=3,ot(s,f);case 3:F=m.sent,console.log("kbName kbFileDocs",F);case 5:case"end":return m.stop()}},r)}));function n(r,s){return o.apply(this,arguments)}return n}(),deleteFileDoc:function(){var o=Y()(k()().mark(function r(s){var f,F;return k()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("delete file doc",s),m.next=3,lt(s);case 3:f=m.sent,console.log("delete file doc result",f),F=t().kbDocResult.data.content.filter(function(y){return y.uid!==s}),u(function(y){return{kbFileDocResult:{items:F}}});case 7:case"end":return m.stop()}},r)}));function n(r){return o.apply(this,arguments)}return n}(),setCurrentFile:function(n){var r=t().kbFileResult.data.content.find(function(s){return s.uid===n});u({currentKbFile:r})},setCurrentFileDoc:function(n){var r=t().kbDocResult.data.content.find(function(s){return s.uid===n});console.log("setCurrentFileDoc",n,r),u({currentKbDoc:r})},updateKbFileDocPython:function(){var o=Y()(k()().mark(function r(s,f,F){return k()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:console.log("updateKbFileDocPython",s,f,F);case 1:case"end":return m.stop()}},r)}));function n(r,s,f){return o.apply(this,arguments)}return n}(),deleteKbCache:function(){return u({},!0)}}}),{name:I.cn}))),be=i(53719),he=i(86738),de=i(45360),Fe=i(85265),ye=i(42075),Ze=i(55102),ct=function(){var t=(0,V.useIntl)(),o=W.Z.useForm(),n=Z()(o,1),r=n[0],s=(0,ne.V)(function(O){return{currentRobot:O.currentRobot}}),f=s.currentRobot,F=(0,l.useRef)(),g=(0,l.useState)(1),m=Z()(g,2),y=m[0],w=m[1],M=(0,l.useState)(20),T=Z()(M,2),R=T[0],b=T[1],C=ce(function(O){return{kbFileDocResult:O.kbDocResult,currentKbFileDoc:O.currentKbDoc,fetchFileDocs:O.fetchDocs,setCurrentFileDoc:O.setCurrentFileDoc,updateKbFileDocPython:O.updateKbFileDocPython}}),B=C.kbFileDocResult,a=C.currentKbFileDoc,c=C.fetchFileDocs,K=C.setCurrentFileDoc,S=C.updateKbFileDocPython;ce.subscribe(function(O,ee){console.log("kb",O)});var v=function(){};(0,l.useEffect)(function(){v()},[]),(0,l.useEffect)(function(){v()},[y,R]),(0,l.useEffect)(function(){w(1),v()},[f]),(0,l.useEffect)(function(){F.current.reload()},[B]);var P=(0,l.useState)(!1),p=Z()(P,2),U=p[0],d=p[1],D=(0,l.useState)("\u4FEE\u6539\u6587\u672C"),G=Z()(D,2),E=G[0],x=G[1],q=function(){d(!0)},_=function(){d(!1)},A=function(){d(!1)},$=function(){console.log("handleInputText"),x("\u8F93\u5165\u6587\u672C"),q()},z=function(){console.log("handleInputUrl"),x("\u8F93\u5165\u7F51\u5740"),q()};function H(O){K(O.did),q()}function te(O){console.log("handleDelete",O)}var N=[{title:t.formatMessage({id:"pages.robot.file.title",defaultMessage:"Title"}),width:150,dataIndex:"file_name"},{title:t.formatMessage({id:"pages.robot.file.content",defaultMessage:"Content"}),dataIndex:"page_content"},{title:t.formatMessage({id:"pages.robot.file.type",defaultMessage:"Type"}),width:80,dataIndex:"type"},{title:t.formatMessage({id:"pages.robot.file.action",defaultMessage:"Action"}),width:150,key:"option",valueType:"option",render:function(ee,le){return[(0,e.jsx)(L.ZP,{type:"link",size:"small",onClick:function(){return H(le)},children:"\u4FEE\u6539"},"edit"),(0,e.jsx)(he.Z,{title:t.formatMessage({id:"pages.robot.file.delete",defaultMessage:"Delete"}),onConfirm:function(){return te(le)},onCancel:function(){return A()},children:(0,e.jsx)(L.ZP,{type:"link",size:"small",danger:!0,children:"\u5220\u9664"},"delete")},"confirm_delete")]}}],Ee=function(ee){console.log("Success:",ee,a.uid,a.meta),S(a.uid,ee.pageContent,a.meta),de.ZP.success("\u66F4\u65B0\u6210\u529F"),d(!1)},me=function(ee){console.log("Failed:",ee)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(be.Z,{actionRef:F,columns:N,headerTitle:"\u89E3\u6790\u6587\u672C\u5185\u5BB9",request:function(ee,le,ie){return console.log("request:",ee,le,ie),w(ee.current-1),b(ee.pageSize),Promise.resolve({data:B.data.content,success:!0,total:B.data.totalElements})},rowKey:"did",pagination:{showQuickJumper:!0},search:!1,toolBarRender:function(){return[(0,e.jsx)(L.ZP,{onClick:$,children:"\u8F93\u5165\u95EE\u7B54\u5BF9"},"text")]}}),(0,e.jsx)(Fe.Z,{title:E,size:"default",placement:"right",onClose:A,open:U,extra:(0,e.jsx)(ye.Z,{children:(0,e.jsx)(L.ZP,{onClick:A,children:"\u53D6\u6D88"})}),children:(0,e.jsxs)(W.Z,{form:r,name:"basic",onFinish:Ee,onFinishFailed:me,autoComplete:"off",children:[(0,e.jsx)(W.Z.Item,{label:"\u6807\u9898",name:"fileName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898!"}]}),(0,e.jsx)(W.Z.Item,{label:"\u5185\u5BB9",name:"pageContent",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9!"}],children:(0,e.jsx)(Ze.Z.TextArea,{rows:15})}),(0,e.jsx)(W.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,e.jsx)(L.ZP,{type:"primary",htmlType:"submit",children:"\u4FDD\u5B58"})})]})})]})},dt=function(){var t=(0,V.useIntl)(),o=W.Z.useForm(),n=Z()(o,1),r=n[0],s=(0,ne.V)(function(h){return{currentRobot:h.currentRobot}}),f=s.currentRobot,F=(0,l.useRef)(),g=(0,l.useState)(1),m=Z()(g,2),y=m[0],w=m[1],M=(0,l.useState)(20),T=Z()(M,2),R=T[0],b=T[1],C=ce(function(h){return{kbFileDocResult:h.kbDocResult,currentKbFileDoc:h.currentKbDoc,fetchFileDocs:h.fetchDocs,setCurrentFileDoc:h.setCurrentFileDoc,updateKbFileDocPython:h.updateKbFileDocPython}}),B=C.kbFileDocResult,a=C.currentKbFileDoc,c=C.fetchFileDocs,K=C.setCurrentFileDoc,S=C.updateKbFileDocPython;ce.subscribe(function(h,Q){});var v=function(){};(0,l.useEffect)(function(){v()},[]),(0,l.useEffect)(function(){v()},[y,R]),(0,l.useEffect)(function(){w(1),v()},[f]),(0,l.useEffect)(function(){F.current.reload()},[B]);var P=(0,l.useState)(!1),p=Z()(P,2),U=p[0],d=p[1],D=(0,l.useState)("\u4FEE\u6539\u6587\u672C"),G=Z()(D,2),E=G[0],x=G[1],q=(0,l.useState)(""),_=Z()(q,2),A=_[0],$=_[1],z=function(){d(!0)},H=function(){d(!1)},te=function(){d(!1)},N=function(){console.log("handleInputText"),x("\u8F93\u5165\u6587\u672C"),z()},Ee=function(){console.log("handleInputUrl"),x("\u8F93\u5165\u7F51\u5740"),z()};function me(h){K(h.did),z()}function O(h){console.log("handleDelete",h)}var ee=[{title:t.formatMessage({id:"pages.robot.file.title",defaultMessage:"Title"}),width:150,dataIndex:"file_name"},{title:t.formatMessage({id:"pages.robot.file.content",defaultMessage:"Content"}),dataIndex:"page_content"},{title:t.formatMessage({id:"pages.robot.file.type",defaultMessage:"Type"}),width:80,dataIndex:"type"},{title:t.formatMessage({id:"pages.robot.file.action",defaultMessage:"Action"}),width:150,key:"option",valueType:"option",render:function(Q,oe){return[(0,e.jsx)(L.ZP,{type:"link",size:"small",onClick:function(){return me(oe)},children:"\u4FEE\u6539"},"edit"),(0,e.jsx)(he.Z,{title:t.formatMessage({id:"pages.robot.file.delete",defaultMessage:"Delete"}),onConfirm:function(){return O(oe)},onCancel:function(){return te()},children:(0,e.jsx)(L.ZP,{type:"link",size:"small",danger:!0,children:"\u5220\u9664"},"delete")},"confirm_delete")]}}],le=function(Q){console.log("Success:",Q,a.uid,a.meta),S(a.uid,Q.pageContent,a.meta),de.ZP.success("\u66F4\u65B0\u6210\u529F"),d(!1)},ie=function(Q){console.log("Failed:",Q)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(be.Z,{actionRef:F,columns:ee,headerTitle:"\u89E3\u6790\u6587\u672C\u5185\u5BB9",request:function(Q,oe,se){return console.log("request:",Q,oe,se),w(Q.current-1),b(Q.pageSize),Promise.resolve({data:B.data.content,success:!0,total:B.data.totalElements})},rowKey:"did",pagination:{showQuickJumper:!0},search:!1,toolBarRender:function(){return[(0,e.jsx)(L.ZP,{onClick:N,children:"\u8F93\u5165\u95EE\u7B54\u5BF9"},"text")]}}),(0,e.jsx)(Fe.Z,{title:E,size:"default",placement:"right",onClose:te,open:U,extra:(0,e.jsx)(ye.Z,{children:(0,e.jsx)(L.ZP,{onClick:te,children:"\u53D6\u6D88"})}),children:(0,e.jsxs)(W.Z,{form:r,name:"basic",onFinish:le,onFinishFailed:ie,autoComplete:"off",children:[(0,e.jsx)(W.Z.Item,{label:"\u6807\u9898",name:"fileName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898!"}]}),(0,e.jsx)(W.Z.Item,{label:"\u5185\u5BB9",name:"pageContent",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9!"}],children:(0,e.jsx)(Ze.Z.TextArea,{rows:15})}),(0,e.jsx)(W.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,e.jsx)(L.ZP,{type:"primary",htmlType:"submit",children:"\u4FDD\u5B58"})})]})})]})},ft=function(){var t=(0,V.useIntl)(),o=W.Z.useForm(),n=Z()(o,1),r=n[0],s=(0,ne.V)(function(h){return{currentRobot:h.currentRobot}}),f=s.currentRobot,F=(0,l.useRef)(),g=(0,l.useState)(1),m=Z()(g,2),y=m[0],w=m[1],M=(0,l.useState)(20),T=Z()(M,2),R=T[0],b=T[1],C=ce(function(h){return{kbFileDocResult:h.kbDocResult,currentKbFileDoc:h.currentKbDoc,fetchFileDocs:h.fetchDocs,setCurrentFileDoc:h.setCurrentFileDoc,updateKbFileDocPython:h.updateKbFileDocPython}}),B=C.kbFileDocResult,a=C.currentKbFileDoc,c=C.fetchFileDocs,K=C.setCurrentFileDoc,S=C.updateKbFileDocPython;ce.subscribe(function(h,Q){r.setFieldValue("pageContent",h.currentKbDoc.content)});var v=function(){};(0,l.useEffect)(function(){v()},[]),(0,l.useEffect)(function(){v()},[y,R]),(0,l.useEffect)(function(){w(1),v()},[f]),(0,l.useEffect)(function(){F.current.reload()},[B]);var P=(0,l.useState)(!1),p=Z()(P,2),U=p[0],d=p[1],D=(0,l.useState)("\u4FEE\u6539\u6587\u672C"),G=Z()(D,2),E=G[0],x=G[1],q=(0,l.useState)(""),_=Z()(q,2),A=_[0],$=_[1],z=function(){d(!0)},H=function(){d(!1)},te=function(){d(!1)},N=function(){console.log("handleInputText"),x("\u8F93\u5165\u6587\u672C"),z()},Ee=function(){console.log("handleInputUrl"),x("\u8F93\u5165\u7F51\u5740"),z()};function me(h){K(h.did),z()}function O(h){console.log("handleDelete",h)}var ee=[{title:t.formatMessage({id:"pages.robot.file.title",defaultMessage:"Title"}),width:150,dataIndex:"file_name"},{title:t.formatMessage({id:"pages.robot.file.content",defaultMessage:"Content"}),dataIndex:"page_content"},{title:t.formatMessage({id:"pages.robot.file.type",defaultMessage:"Type"}),width:80,dataIndex:"type"},{title:t.formatMessage({id:"pages.robot.file.action",defaultMessage:"Action"}),width:150,key:"option",valueType:"option",render:function(Q,oe){return[(0,e.jsx)(L.ZP,{type:"link",size:"small",onClick:function(){return me(oe)},children:"\u4FEE\u6539"},"edit"),(0,e.jsx)(he.Z,{title:t.formatMessage({id:"pages.robot.file.delete",defaultMessage:"Delete"}),onConfirm:function(){return O(oe)},onCancel:function(){return te()},children:(0,e.jsx)(L.ZP,{type:"link",size:"small",danger:!0,children:"\u5220\u9664"},"delete")},"confirm_delete")]}}],le=function(Q){console.log("Success:",Q,a.uid,a.meta),S(a.uid,Q.pageContent,a.meta),de.ZP.success("\u66F4\u65B0\u6210\u529F"),d(!1)},ie=function(Q){console.log("Failed:",Q)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(be.Z,{actionRef:F,columns:ee,headerTitle:"\u89E3\u6790\u6587\u672C\u5185\u5BB9",request:function(Q,oe,se){return console.log("request:",Q,oe,se),w(Q.current-1),b(Q.pageSize),Promise.resolve({data:B.data.content,success:!0,total:B.data.totalElements})},rowKey:"did",pagination:{showQuickJumper:!0},search:!1,toolBarRender:function(){return[(0,e.jsx)(L.ZP,{onClick:N,children:"\u8F93\u5165\u95EE\u7B54\u5BF9"},"text")]}}),(0,e.jsx)(Fe.Z,{title:E,size:"default",placement:"right",onClose:te,open:U,extra:(0,e.jsx)(ye.Z,{children:(0,e.jsx)(L.ZP,{onClick:te,children:"\u53D6\u6D88"})}),children:(0,e.jsxs)(W.Z,{form:r,name:"basic",onFinish:le,onFinishFailed:ie,autoComplete:"off",children:[(0,e.jsx)(W.Z.Item,{label:"\u6807\u9898",name:"fileName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898!"}]}),(0,e.jsx)(W.Z.Item,{label:"\u5185\u5BB9",name:"pageContent",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9!"}],children:(0,e.jsx)(Ze.Z.TextArea,{rows:15})}),(0,e.jsx)(W.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,e.jsx)(L.ZP,{type:"primary",htmlType:"submit",children:"\u4FDD\u5B58"})})]})})]})},gt=i(66476),mt=i(27484),Ne=i.n(mt),vt=function(){var t=(0,V.useIntl)(),o=(0,fe.Z)(),n=o.translateString,r=de.ZP.useMessage(),s=Z()(r,2),f=s[0],F=s[1],g=(0,ne.V)(function(E){return E.currentRobot}),m=(0,l.useRef)(),y=(0,l.useState)(1),w=Z()(y,2),M=w[0],T=w[1],R=(0,l.useState)(10),b=Z()(R,2),C=b[0],B=b[1],a=ce(function(E){return{kbFileResult:E.kbFileResult,fetchFiles:E.fetchFiles,fetchFileDocs:E.fetchDocs,deleteFile:E.deleteFile}}),c=a.kbFileResult,K=a.fetchFiles,S=a.fetchFileDocs,v=a.deleteFile;function P(E){console.log("handleDelete",E),v(E.uid)}function p(){console.log("handleCancel")}var U=[{title:t.formatMessage({id:"pages.robot.file.title",defaultMessage:"Title"}),dataIndex:"name"},{title:t.formatMessage({id:"pages.robot.file.action",defaultMessage:"Action"}),width:150,key:"option",valueType:"option",render:function(x,q){return[(0,e.jsx)(he.Z,{title:t.formatMessage({id:"pages.robot.file.delete",defaultMessage:"Delete"}),onConfirm:function(){return P(q)},onCancel:function(){return p()},children:(0,e.jsx)(L.ZP,{type:"link",size:"small",danger:!0,children:"\u5220\u9664"},"delete")},"confirm_delete")]}}],d=function(){var x={pageNumber:M,pageSize:C};K(g.uid,x),S(g.uid,x)};(0,l.useEffect)(function(){d()},[]),(0,l.useEffect)(function(){d()},[M,C]),(0,l.useEffect)(function(){T(1),d()},[g]),(0,l.useEffect)(function(){m.current.reload()},[c]);var D={file_name:"test.png",file_kid:Ne()(new Date).format("YYYYMMDDHHmmss"),rid:g.uid,client:I.bV},G={name:"file",action:"/api/v1/upload/file",headers:{Authorization:"Bearer "+localStorage.getItem(I.LA).replaceAll('"',"")},showUploadList:!1,data:D,beforeUpload:function(x){if(x.name.includes("_"))return de.ZP.error(t.formatMessage({id:"pages.robot.file.name_invalid",defaultMessage:"File name should not contain _"})),!1;D.file_name=x.name;var q=Ne()(new Date).format("YYYYMMDDHHmmss");return D.file_kid=q,D.rid=g.uid,console.log("file:",x," uploadData:",D),f.open({type:"loading",content:t.formatMessage({id:"pages.robot.file.uploading",defaultMessage:"Uploading..."}),duration:0}),!0},onChange:function(x){x.file.status!=="uploading"&&console.log(x.file,x.fileList),x.file.status==="done"?(console.log(x.file.response.data),f.destroy(),de.ZP.success("".concat(x.file.name," file uploaded successfully")),d()):x.file.status==="error"&&de.ZP.error("".concat(x.file.name," file upload failed."))}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(be.Z,{actionRef:m,columns:U,headerTitle:n(g.nickname),request:function(x,q,_){return console.log("request:",x,q,_),T(x.current),B(x.pageSize),Promise.resolve({data:c.data.content,success:!0,total:c.data.totalElements})},rowKey:"kid",pagination:{showQuickJumper:!0},search:!1,toolBarRender:function(){return[(0,e.jsx)(gt.Z,J()(J()({},G),{},{children:(0,e.jsx)(L.ZP,{icon:(0,e.jsx)(Ae.Z,{}),type:"primary",children:t.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})}),"upload")]}}),F]})},pt=function(){var t=(0,V.useIntl)(),o=[{key:"file",label:t.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,e.jsx)(vt,{})},{key:"text",label:t.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,e.jsx)(ct,{})},{key:"qa",label:t.formatMessage({id:"pages.robot.kb.qa",defaultMessage:"Q&A"}),children:(0,e.jsx)(dt,{})},{key:"web",label:t.formatMessage({id:"pages.robot.kb.web",defaultMessage:"Website"}),children:(0,e.jsx)(ft,{})}];return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(xe.Z,{tabPosition:"left",items:o})})},bt=pt,X=i(21235),ht=i(24885),hn=i(94326),Ft=function(){var t=function(n,r){n.dataTransfer.setData("application/reactflow",r),n.dataTransfer.effectAllowed="move",console.log("onDragStart:",n,r)};return(0,e.jsxs)("aside",{children:[(0,e.jsx)("div",{className:"dndnode",onDragStart:function(n){return t(n,"nodeText")},draggable:!0,children:"Text"}),(0,e.jsx)("div",{className:"dndnode",onDragStart:function(n){return t(n,"nodeImage")},draggable:!0,children:"Image"})]})},yt=Ft,Le=i(52080),re=i(51453),St=i(16854);function xt(u){var t=u.id,o=u.type,n=u.data,r=u.xPos,s=u.yPos,f=u.isConnectable,F=(0,l.useCallback)(function(){var w=JSON.stringify({id:t,type:o,data:n});re.Z.emit(I.zf,w)},[]),g=(0,l.useCallback)(function(){var w=JSON.stringify({id:(0,St.Zx)(),type:o,data:n,position:{x:r+10,y:s+10}});re.Z.emit(I.aC,w)},[]),m=(0,l.useCallback)(function(){re.Z.emit(I.rF,t)},[]),y=(0,l.useCallback)(function(w){console.log(w.target.value)},[]);return(0,e.jsxs)("div",{className:"node-text",children:[(0,e.jsxs)(Le.M,{isVisible:n.toolbarVisible,position:n.toolbarPosition,children:[(0,e.jsx)("button",{onClick:F,children:"run"}),(0,e.jsx)("button",{onClick:g,children:"copy"}),(0,e.jsx)("button",{onClick:m,children:"delete"})]}),(0,e.jsx)(X.HH,{type:"target",position:X.Ly.Top,isConnectable:f}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"text",children:"Text:"}),(0,e.jsx)("input",{id:"text",name:"text",onChange:y,className:"nodrag"})]}),(0,e.jsx)(X.HH,{type:"source",position:X.Ly.Bottom,id:"b",isConnectable:f})]})}var Rt=xt;function Ct(u){var t=u.data,o=u.isConnectable,n=(0,l.useCallback)(function(r){console.log(r.target.value)},[]);return(0,e.jsxs)("div",{className:"node-image",children:[(0,e.jsx)(X.HH,{type:"target",position:X.Ly.Top,isConnectable:o}),(0,e.jsx)("div",{children:(0,e.jsx)("label",{htmlFor:"text",children:"Image"})}),(0,e.jsx)(X.HH,{type:"source",position:X.Ly.Bottom,id:"b",isConnectable:o})]})}var Dt=Ct;function wt(u){var t=u.id,o=u.type,n=u.data,r=u.isConnectable,s=(0,l.useCallback)(function(){var f=JSON.stringify({id:t,type:o,data:n});re.Z.emit(I.zf,f)},[]);return(0,e.jsxs)("div",{className:"node-start",children:[(0,e.jsx)(Le.M,{isVisible:n.toolbarVisible,position:n.toolbarPosition,children:(0,e.jsx)("button",{onClick:s,children:"run"})}),(0,e.jsx)("div",{children:(0,e.jsx)("label",{htmlFor:"text",children:"Start"})}),(0,e.jsx)(X.HH,{type:"source",position:X.Ly.Bottom,id:"b",isConnectable:r})]})}var Mt=wt,jt=i(74330),Tt=function(t){var o=t.open,n=t.onClose,r=(0,ne.V)(function(b){return b.currentRobot}),s=(0,l.useState)(""),f=Z()(s,2),F=f[0],g=f[1],m=(0,l.useState)(!1),y=Z()(m,2),w=y[0],M=y[1],T=function(){M(!0),console.log("Iframe loaded successfully!")};(0,l.useEffect)(function(){var b="http://127.0.0.1:9003/chat?t="+I.xt+"&sid="+(r==null?void 0:r.uid)+"&"+new Date().getTime();g(b)},[r]);var R=function(){console.log("restart");var C="http://127.0.0.1:9003/chat?t="+I.xt+"&sid="+(r==null?void 0:r.uid)+"&"+new Date().getTime();g(C)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(Fe.Z,{title:"Preview",onClose:n,open:o,extra:(0,e.jsxs)(ye.Z,{children:[(0,e.jsx)(L.ZP,{onClick:n,children:"Cancel"}),(0,e.jsx)(L.ZP,{onClick:R,type:"primary",children:"Restart"})]}),children:[(0,e.jsx)(jt.Z,{spinning:!w,size:"large"}),(0,e.jsx)("iframe",{id:"chat-iframe",src:F,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:T})]})})},kt=Tt,Zt={},Pt={animated:!0},Fn={hideAttribution:!0},Et=0,It=function(){return"dndnode_".concat(Et++)},Kt=function(){var t=(0,l.useRef)(null),o=[{id:"1",type:"nodeStart",data:{label:"start"},position:{x:250,y:5}}],n=(0,l.useState)(o),r=Z()(n,2),s=r[0],f=r[1],F=(0,l.useState)([]),g=Z()(F,2),m=g[0],y=g[1],w=(0,l.useMemo)(function(){return{nodeStart:Mt,nodeText:Rt,nodeImage:Dt}},[]),M=(0,l.useCallback)(function(d){return f(function(D){return(0,X.Fb)(d,D)})},[f]),T=(0,l.useCallback)(function(d){return y(function(D){return(0,X.yn)(d,D)})},[y]),R=(0,l.useCallback)(function(d){y(function(D){return(0,X.Z_)(d,D)})},[y]),b=(0,X._K)(),C=b.screenToFlowPosition,B=(0,l.useCallback)(function(d){d.preventDefault(),d.dataTransfer.dropEffect="move"},[]),a=(0,l.useCallback)(function(d){d.preventDefault();var D=d.dataTransfer.getData("application/reactflow");if(!(typeof D=="undefined"||!D)){var G=C({x:d.clientX,y:d.clientY}),E={id:It(),type:D,data:{label:"nodeText"},position:G};f(function(x){return x.concat(E)})}},[C]),c=function(){};(0,l.useEffect)(function(){var d=setInterval(c,1e4);return function(){clearInterval(d)}},[s,m]);var K=(0,l.useState)(!1),S=Z()(K,2),v=S[0],P=S[1],p=function(){P(!0)},U=function(){P(!1)};return(0,l.useEffect)(function(){var d=function(x){console.log("handleRunEvent:",x),p()};re.Z.on(I.zf,d);var D=function(x){var q=JSON.parse(x);console.log("handleCopyEvent:",x,q),f(function(_){return _.concat(q)})};re.Z.on(I.aC,D);var G=function(x){console.log("handleDeleteEvent:",x),f(function(q){return q.filter(function(_){return _.id!==x})})};return re.Z.on(I.rF,G),function(){re.Z.off(I.zf,d),re.Z.off(I.aC,D),re.Z.off(I.rF,G)}},[]),(0,e.jsxs)("div",{className:"dndflow",children:[(0,e.jsx)(yt,{}),(0,e.jsx)("div",{ref:t,style:{width:"75vw",height:"80vh"},children:(0,e.jsx)(X.x$,{nodeTypes:w,nodes:s,edges:m,onNodesChange:M,onEdgesChange:T,onConnect:R,onDrop:a,onDragOver:B,fitView:!0,nodesDraggable:!0,style:Zt,defaultEdgeOptions:Pt,children:(0,e.jsx)(ht.Z,{})})}),(0,e.jsx)(kt,{open:v,onClose:U})]})},$t=Kt,Bt=function(){var t=(0,V.useAccess)();return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(V.Access,{accessible:t.canDebug(),fallback:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(V.FormattedMessage,{id:I.h5})}),children:(0,e.jsx)(X.tV,{children:(0,e.jsx)($t,{})})})})},At=Bt,Ot=i(52688),Nt=i(31199),Lt=function(){var t,o,n,r,s,f,F,g,m,y,w=(0,V.useIntl)(),M=ae.A.useForm(),T=Z()(M,1),R=T[0],b=(0,fe.Z)(),C=b.translateString,B=(0,ne.V)(function(S){return{currentRobot:S.currentRobot,setCurrentRobot:S.setCurrentRobot}}),a=B.currentRobot,c=B.setCurrentRobot;(0,l.useEffect)(function(){var S,v,P,p,U,d,D;R.setFieldValue("enabled",a==null||(S=a.llm)===null||S===void 0?void 0:S.enabled),R.setFieldValue("topK",a==null||(v=a.llm)===null||v===void 0?void 0:v.topK),R.setFieldValue("scoreThreshold",a==null||(P=a.llm)===null||P===void 0?void 0:P.scoreThreshold),R.setFieldValue("model",a==null||(p=a.llm)===null||p===void 0?void 0:p.model),R.setFieldValue("embeddings",a==null||(U=a.llm)===null||U===void 0?void 0:U.embeddings),R.setFieldValue("temperature",a==null||(d=a.llm)===null||d===void 0?void 0:d.temperature),R.setFieldValue("prompt",C(a==null||(D=a.llm)===null||D===void 0?void 0:D.prompt))},[a]);var K=function(){var S=Y()(k()().mark(function v(P){var p,U,d,D;return k()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return console.log("handleSubmit",P),j.yw.loading(w.formatMessage({id:"updating"})),d=J()(J()({},a),{},{serviceSettings:J()(J()({},a.serviceSettings),{},{faqUids:(p=a.serviceSettings)===null||p===void 0||(p=p.faqs)===null||p===void 0?void 0:p.map(function(x){return x.uid}),quickButtonUids:(U=a.serviceSettings)===null||U===void 0||(U=U.quickButtons)===null||U===void 0?void 0:U.map(function(x){return x.uid})}),llm:P}),console.log("robotObject:",d),E.next=6,(0,ue.$l)(d);case 6:D=E.sent,console.log("updateRobot response:",D),D.code===200?(j.yw.destroy(),j.yw.success(w.formatMessage({id:"update.success"})),c(D.data)):(j.yw.destroy(),j.yw.error(D.message));case 9:case"end":return E.stop()}},v)}));return function(P){return S.apply(this,arguments)}}();return(0,e.jsxs)(ae.A,{form:R,size:"large",onFinish:K,initialValues:{enabled:a==null||(t=a.llm)===null||t===void 0?void 0:t.enabled,topK:a==null||(o=a.llm)===null||o===void 0?void 0:o.topK,scoreThreshold:a==null||(n=a.llm)===null||n===void 0?void 0:n.scoreThreshold,model:a==null||(r=a.llm)===null||r===void 0?void 0:r.model,embeddings:a==null||(s=a.llm)===null||s===void 0?void 0:s.embeddings,temperature:a==null||(f=a.llm)===null||f===void 0?void 0:f.temperature,prompt:C(a==null||(F=a.llm)===null||F===void 0?void 0:F.prompt),apiKey:a==null||(g=a.llm)===null||g===void 0?void 0:g.apiKey,apiSecret:a==null||(m=a.llm)===null||m===void 0?void 0:m.apiSecret,apiUrl:a==null||(y=a.llm)===null||y===void 0?void 0:y.apiUrl},children:[(0,e.jsx)(Ot.Z,{width:"lg",name:"enabled",label:"enabled",tooltip:"\u662F\u5426\u542F\u7528\u5927\u6A21\u578B"}),(0,e.jsx)(Re.Z,{width:"lg",name:"prompt",label:"prompt",placeholder:"\u8BF7\u8F93\u5165prompt",rules:[{required:!0,message:"\u8BF7\u8F93\u5165prompt"}]}),(0,e.jsx)(ge.Z,{width:"lg",name:"model",label:"model",allowClear:!0,options:[{value:"ZHIPUAI_GLM_3_TURBO",label:"\u667A\u8C31AI-GLM-3-Turbo"},{value:"ZHIPUAI_GLM_4",label:"\u667A\u8C31AI-GLM-4"},{value:"OLLAMA",label:"Ollama",disabled:!0},{value:"OPENAI",label:"OpenAi",disabled:!0}],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5927\u6A21\u578B"}]}),(0,e.jsx)(ge.Z,{width:"lg",name:"embeddings",label:"embeddings",allowClear:!0,options:[{value:"M3E_BASE",label:"m3e-base"}],rules:[{required:!0,message:"\u8BF7\u9009\u62E9embeddings"}]}),(0,e.jsx)(Nt.Z,{width:"lg",label:"\u6E29\u5EA6",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E29\u5EA6"}]})]})},Ut=Lt,zt=i(9465),Pe=i(40056),Ue=i(96074),Vt=function(){var t,o,n=(0,V.useIntl)(),r=ae.A.useForm(),s=Z()(r,1),f=s[0],F=(0,fe.Z)(),g=F.translateString,m=(0,pe.u)(function(c){return c.currentOrg}),y=(0,l.useState)(),w=Z()(y,2),M=w[0],T=w[1],R=(0,ne.V)(function(c){return{currentRobot:c.currentRobot,setCurrentRobot:c.setCurrentRobot}}),b=R.currentRobot,C=R.setCurrentRobot,B=function(){var c=Y()(k()().mark(function K(){var S,v;return k()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return j.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),S={pageNumber:0,pageSize:50,orgUid:m.uid},p.next=4,(0,zt.qL)(S);case 4:v=p.sent,console.log("getAllQuickbuttons response:",S,v),j.yw.destroy(),v.code===200?T(v):j.yw.error(v.message);case 8:case"end":return p.stop()}},K)}));return function(){return c.apply(this,arguments)}}();(0,l.useEffect)(function(){B()},[m]),(0,l.useEffect)(function(){var c;f.setFieldValue("quickButtonUids",(b==null||(c=b.serviceSettings)===null||c===void 0?void 0:c.quickButtons.map(function(K){return K.uid}))||[])},[b]);var a=function(){var c=Y()(k()().mark(function K(S){var v,P,p;return k()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("onFinish",S),P=J()(J()({},b),{},{serviceSettings:J()(J()({},b.serviceSettings),{},{quickButtonUids:S.quickButtonUids,faqUids:b==null||(v=b.serviceSettings)===null||v===void 0?void 0:v.faqs.map(function(D){return D.uid})})}),console.log("robotObject:",P),d.next=5,(0,ue.$l)(P);case 5:p=d.sent,console.log("updateRobot response:",p),p.code===200?(j.yw.destroy(),j.yw.success(n.formatMessage({id:"update.success"})),C(p.data)):(j.yw.destroy(),j.yw.error(p.message));case 8:case"end":return d.stop()}},K)}));return function(S){return c.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsx)(Pe.Z,{message:n.formatMessage({id:"quickbutton.guide",defaultMessage:"Please goto Knowledge base -> QuickButton -> Create, then add quickbutton here"}),type:"success"}),(0,e.jsx)(Ue.Z,{}),(0,e.jsx)(ae.A,{form:f,layout:"vertical",initialValues:{quickButtonUids:(b==null||(t=b.serviceSettings)===null||t===void 0?void 0:t.quickButtons.map(function(c){return c.uid}))||[]},onFinish:a,children:(0,e.jsx)(ge.Z,{name:"quickButtonUids",width:"md",label:n.formatMessage({id:"quickbutton",defaultMessage:"QuickButton"}),options:M==null||(o=M.data)===null||o===void 0?void 0:o.content.map(function(c){return{label:g(c.title),value:c.uid}}),fieldProps:{mode:"multiple",allowClear:!0,placeholder:n.formatMessage({id:"choose",defaultMessage:"Please Choose"})}})})]})},Ht=Vt,Qt=i(40401),qt=i(48489),Gt=function(){var t,o,n=ae.A.useForm(),r=Z()(n,1),s=r[0],f=(0,V.useIntl)(),F=(0,fe.Z)(),g=F.translateString,m=(0,pe.u)(function(c){return c.currentOrg}),y=(0,l.useState)(),w=Z()(y,2),M=w[0],T=w[1],R=(0,ne.V)(function(c){return{currentRobot:c.currentRobot,setCurrentRobot:c.setCurrentRobot}}),b=R.currentRobot,C=R.setCurrentRobot,B=function(){var c=Y()(k()().mark(function K(){var S,v;return k()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return j.yw.loading(f.formatMessage({id:"loading",defaultMessage:"Loading"})),S={pageNumber:0,pageSize:50,orgUid:m.uid},p.next=4,(0,Qt.pf)(S);case 4:v=p.sent,console.log("getAllFaqs response:",S,v),j.yw.destroy(),v.code===200?T(v):j.yw.error(v.message);case 8:case"end":return p.stop()}},K)}));return function(){return c.apply(this,arguments)}}();(0,l.useEffect)(function(){B()},[m]),(0,l.useEffect)(function(){s.setFieldValue("faqUids",(b==null?void 0:b.serviceSettings.faqs.map(function(c){return c.uid}))||[])},[b]);var a=function(){var c=Y()(k()().mark(function K(S){var v,P,p;return k()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return console.log("onFinish",S),P=J()(J()({},b),{},{serviceSettings:J()(J()({},b.serviceSettings),{},{faqUids:S.faqUids,quickButtonUids:b==null||(v=b.serviceSettings)===null||v===void 0?void 0:v.quickButtons.map(function(D){return D.uid})})}),console.log("robotObject:",P),d.next=5,(0,ue.$l)(P);case 5:p=d.sent,console.log("updateRobot response:",p),p.code===200?(j.yw.destroy(),j.yw.success(f.formatMessage({id:"update.success"})),C(p.data)):(j.yw.destroy(),j.yw.error(p.message));case 8:case"end":return d.stop()}},K)}));return function(S){return c.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[(0,e.jsx)(Pe.Z,{message:"\u8BF7\u5148\u5230 \u77E5\u8BC6\u5E93 -> \u5E38\u89C1\u95EE\u9898 -> \u65B0\u5EFA\uFF0C\u521B\u5EFA\u5E38\u89C1\u95EE\u9898\u4E4B\u540E\uFF0C\u518D\u6765\u6DFB\u52A0",type:"success",action:(0,e.jsx)(L.ZP,{type:"link",icon:(0,e.jsx)(qt.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/")},children:f.formatMessage({id:"setting.helpdoc"})})}),(0,e.jsx)(Pe.Z,{message:"\u63D0\u4EA4\u4E4B\u540E\uFF0C\u5BF9\u65B0\u4F1A\u8BDD\u7ACB\u5373\u751F\u6548\u3002\u5BF9\u4E8E\u8FDB\u884C\u4E2D\u4F1A\u8BDD\uFF0C\u9700\u8981\u5173\u95ED\u4E4B\u540E\uFF0C\u91CD\u65B0\u8FDB\u5165\u624D\u4F1A\u751F\u6548",type:"warning",style:{marginTop:10}}),(0,e.jsx)(Ue.Z,{}),(0,e.jsx)(ae.A,{form:s,layout:"vertical",initialValues:{faqUids:(b==null||(t=b.serviceSettings)===null||t===void 0?void 0:t.faqs.map(function(c){return c.uid}))||[]},onFinish:a,children:(0,e.jsx)(ge.Z,{name:"faqUids",width:"md",label:f.formatMessage({id:"menu.knowledge.faq"}),options:M==null||(o=M.data)===null||o===void 0?void 0:o.content.map(function(c){return{label:g(c.title),value:c.uid}}),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,e.jsx)(V.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}})})]})},Yt=Gt,Jt=i(17167),Wt=function(){return(0,e.jsx)("div",{children:(0,e.jsx)(Jt.Z,{})})},Xt=Wt,_t=function(){var t=(0,V.useIntl)(),o=[{key:"quickbutton",label:t.formatMessage({id:"quickbutton",defaultMessage:"QuickButton"}),children:(0,e.jsx)(Ht,{})},{key:"faq",label:(0,e.jsx)(V.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"FAQ"}),children:(0,e.jsx)(Yt,{})},{key:"llm",label:t.formatMessage({id:"llm",defaultMessage:"LLM"}),children:(0,e.jsx)(Ut,{})},{key:"transfer",label:t.formatMessage({id:"transfer",defaultMessage:"Transfer"}),children:(0,e.jsx)(Xt,{})}];return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(xe.Z,{tabPosition:"left",items:o})})},en=_t,tn=i(36649),nn=i(34937),rn=i(60478),an=i(45106),on=function(){var t=(0,V.useIntl)(),o=(0,l.useState)([]),n=Z()(o,2),r=n[0],s=n[1],f=function(m){},F=[{key:"basic",label:t.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,e.jsx)(rt,{})},{key:"kb",label:t.formatMessage({id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,e.jsx)(bt,{})},{key:"advanced",label:t.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,e.jsx)(en,{})},{key:"flow",label:t.formatMessage({id:"pages.robot.tab.flow",defaultMessage:"Flow"}),children:(0,e.jsx)(At,{})},{key:"channel",label:t.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,e.jsx)(tn.Z,{type:I._X})},{key:"channelsocial",label:"\u793E\u4EA4\u6E20\u9053",children:(0,e.jsx)(an.Z,{type:I._X})},{key:"channelshop",label:"\u7535\u5546\u6E20\u9053",children:(0,e.jsx)(rn.Z,{type:I._X})},{key:"channelforeign",label:"\u6D77\u5916\u6E20\u9053",children:(0,e.jsx)(nn.Z,{type:I._X})}];return(0,l.useEffect)(function(){s(F)},[]),(0,e.jsx)(xe.Z,{defaultActiveKey:"1",items:r,onChange:f})},sn=on,ln=i(77154),un=ve.Z.Sider,cn=ve.Z.Content,dn=function(){var t=(0,ln.Z)(),o=t.leftSiderStyle,n=t.leftSiderWidth,r=t.contentStyle;return(0,e.jsxs)(ve.Z,{children:[(0,e.jsx)(un,{width:n,style:o,children:(0,e.jsx)(_e,{})}),(0,e.jsx)(ve.Z,{children:(0,e.jsx)(cn,{style:r,children:(0,e.jsx)(sn,{})})})]})},fn=dn}}]);
