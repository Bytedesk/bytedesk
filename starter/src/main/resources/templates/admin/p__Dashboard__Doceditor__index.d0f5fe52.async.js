"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5488],{96286:function(e,t,n){n.d(t,{Az:function(){return d},Xc:function(){return h},jX:function(){return m},tu:function(){return p}});var r=n(90228),u=n.n(r),i=n(26068),c=n.n(i),o=n(87999),a=n.n(o),l=n(64453),s=n(45234);function d(e){return f.apply(this,arguments)}function f(){return(f=a()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/query/org",{method:"GET",params:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=a()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/create",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=a()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/update",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return(y=a()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/article/delete",{method:"POST",data:c()(c()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2818:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var r=n(28733),u=n(7571),i=n(16242),c=n(75271),o=n(35411),a=n(64453),l=n(1312),s=n(37240),d=n(90228),f=n.n(d),p=n(87999),g=n.n(p),h=n(96286),v=n(94414),m=n(92785),y=n(26068),x=n.n(y),w=n(15558),A=n.n(w),k=n(79475),Z=n(11811),j=n(15226),b=(0,k.Ue)()((0,Z.mW)((0,Z.tJ)((0,j.n)((function(e,t){return{currentArticle:{uid:"",orgUid:""},articleResult:{data:{content:[]}},insertArticle:function(t){e((function(e){e.articleResult.data.content.unshift(t)}))},updateArticle:function(t){e((function(e){var n=e.articleResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Article with uid ".concat(t.uid," not found."))}))},setArticleResult:function(n){var r;(e({articleResult:n}),""===t().currentArticle.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentArticle:n.data.content[0]}))},setCurrentArticle:function(n){var r=t().articleResult.data.content,u=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==u){var i=[].concat(A()(r.slice(0,u)),[n],A()(r.slice(u+1))),c=x()(x()({},t().articleResult),{},{data:{content:i}});e({articleResult:c,currentArticle:n})}else console.warn("Article with the specified uid not found."),e({currentArticle:n})},removeArticle:function(n){var r=t().articleResult.data.content,u=r.findIndex((function(e){return e.uid===n}));-1!==u?e({articleResult:x()(x()({},t().articleResult),{},{data:{content:[].concat(A()(r.slice(0,u)),A()(r.slice(u+1)))}})}):console.warn("Article not found in cache:",n),t().currentArticle.uid===n&&e({currentArticle:{uid:"",orgUid:""}})},deleteArticleCache:function(){return e({},!0)}}})),{name:a.SsI}))),C=n(29416),P=n(34620),R=n(65098),M=n(86905),S=n(94455),U=n(52676),E=function(){var e=(0,v.Z)().isDarkMode,t=(0,c.useRef)(!1),n=(0,m.Z)().translateString,r=(0,R.u)((function(e){return e.currentOrg})),u=(0,P.j)((function(e){return e.currentKbase})),i=(0,C.v)((function(e){return e.currentCategory})),o=b((function(e){return{currentArticle:e.currentArticle,articleResult:e.articleResult,setCurrentArticle:e.setCurrentArticle,setArticleResult:e.setArticleResult}})),l=o.currentArticle,s=o.articleResult,d=o.setCurrentArticle,p=o.setArticleResult,y=function(){var e=g()(f()().mark((function e(){var n,c;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,M.ZP.loading("loading"),n={pageNumber:0,pageSize:50,type:a.VX,categoryUid:"all"===(null==i?void 0:i.uid)?"":null==i?void 0:i.uid,kbUid:null==u?void 0:u.uid,orgUid:null==r?void 0:r.uid},e.next=8,(0,h.Az)(n);case 8:c=e.sent,console.log("queryArticlesByOrg: ",c),200===c.code?(M.ZP.destroy(),p(c)):(M.ZP.destroy(),M.ZP.error(c.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){console.log("useEffect"),y()}),[u,i]);return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(S.Z,{itemLayout:"horizontal",dataSource:s.data.content,renderItem:function(t,r){return(0,U.jsx)(S.Z.Item,{style:l.uid===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){d(t)},children:(0,U.jsx)(S.Z.Item.Meta,{style:{marginLeft:"10px",color:e?"#ffffff":"#000000"},title:n(t.title)})})}})})},V=n(48305),I=n.n(V),O=n(85867),H=n(25139),L=n(20187),q=n(42502),F=n(19074),X=n(67825),z=n.n(X),B=n(45234),T=n(23658),D=(n(54767),["placeholder","defaultValue","value","onChange","options"]),K=function(e){var t=e.placeholder,n=e.defaultValue,r=e.value,u=e.onChange,i=(e.options,z()(e,D)),o=(0,B.useIntl)(),a=(0,c.useRef)(null),l=(0,c.useRef)(null);return(0,c.useEffect)((function(){if(a.current){if(!l.current){var e=new T.cW({element:a.current,placeholder:t,content:n,image:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},video:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},attachment:{uploaderEvent:{onUploadBefore:function(e,t,n){s.yw.warning(o.formatMessage({id:"i18n.under.development",defaultMessage:"Coming Soon"}))}}},onChange:function(e){"function"==typeof u&&u(e.getHtml(),e.getMarkdown())}});l.current=e}return function(){l.current&&(l.current.destroy(),l.current=null)}}}),[]),(0,c.useEffect)((function(){l.current&&r!==l.current.getHtml()&&l.current.setContent(r||"")}),[r]),(0,U.jsx)(U.Fragment,{children:(0,U.jsx)("div",x()(x()({ref:a},i),{},{style:{height:"100%"}}))})},W=n(40141),G=n(1491),J=n(22201),N=n(49437),Q=function(){var e=(0,B.useIntl)(),t=(0,v.Z)().isDarkMode,n=(0,c.useState)(!1),r=I()(n,2),u=r[0],i=r[1],o=(0,c.useState)(""),l=I()(o,2),s=l[0],d=l[1],p=(0,c.useState)(""),m=I()(p,2),y=m[0],w=m[1],A=(0,c.useState)(""),k=I()(A,2),Z=k[0],j=k[1],S=(0,c.useRef)(!1),E=(0,R.u)((function(e){return e.currentOrg})),V=(0,P.j)((function(e){return e.currentKbase})),X=(0,C.v)((function(e){return e.currentCategory})),z=b((function(e){return{currentArticle:e.currentArticle,insertArticle:e.insertArticle,setCurrentArticle:e.setCurrentArticle,updateLocalArticle:e.updateArticle}})),T=z.currentArticle,D=z.insertArticle,Q=z.setCurrentArticle,Y=z.updateLocalArticle;(0,c.useEffect)((function(){(null==T?void 0:T.kbUid)===(null==V?void 0:V.uid)&&(d(null==T?void 0:T.title),w(null==T?void 0:T.contentHtml),j(null==T?void 0:T.contentMarkdown))}),[T]);var $=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("create"),!S.current){t.next=4;break}return console.log("isLoading: 1",S.current),t.abrupt("return");case 4:return S.current=!0,M.ZP.loading(e.formatMessage({id:"creating"})),n={uid:null==T?void 0:T.uid,title:"new article",summary:"new article summary",contentHtml:"new article content",contentMarkdown:"new article content",type:a.VX,tags:["tag1","tag2"],markdown:u,published:!1,categoryUid:null==X?void 0:X.uid,kbUid:null==V?void 0:V.uid,orgUid:null==E?void 0:E.uid},console.log("create articleObject",n),t.next=10,(0,h.tu)(n);case 10:r=t.sent,console.log("createArticle response",r),200===r.code?(M.ZP.destroy(),M.ZP.info(e.formatMessage({id:"create.success"})),D(r.data),Q(r.data)):(M.ZP.destroy(),M.ZP.error(r.message)),S.current=!1;case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=g()(f()().mark((function t(){var n,r;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("save",s,y),""!==s&&""!==y){t.next=4;break}return M.ZP.error("标题或内容不能为空！"),t.abrupt("return");case 4:if(!S.current){t.next=7;break}return console.log("isLoading: 1",S.current),t.abrupt("return");case 7:return S.current=!0,M.ZP.loading(e.formatMessage({id:"updating"})),n={uid:null==T?void 0:T.uid,title:s,summary:null==T?void 0:T.summary,contentHtml:y,contentMarkdown:Z,type:null==T?void 0:T.type,tags:["tag1","tag2"],markdown:null==T?void 0:T.markdown,published:null==T?void 0:T.published,categoryUid:null==T?void 0:T.categoryUid,kbUid:null==T?void 0:T.kbUid,orgUid:null==T?void 0:T.orgUid},console.log("update articleObject",n),t.next=13,(0,h.Xc)(n);case 13:r=t.sent,console.log("updateArticle response",r),200===r.code?(M.ZP.destroy(),M.ZP.info(e.formatMessage({id:"update.success"})),Y(r.data)):(M.ZP.destroy(),M.ZP.error(r.message)),S.current=!1;case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,c.useEffect)((function(){var e=x()(x()({},T),{},{title:s,contentHtml:y,contentMarkdown:Z});Y(e)}),[s,y,Z]),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{children:(0,U.jsxs)(O.Z,{gap:10,style:{marginBottom:10,marginTop:5},children:[(0,U.jsx)(H.Z,{size:"large",placeholder:"title",value:s,style:{background:t?"#141414":"#f5f5f5"},onChange:function(e){console.log("title onChange:",e.target.value),d(e.target.value)}}),(0,U.jsx)(L.Z,{checkedChildren:"Markdown",unCheckedChildren:"Html",onChange:function(e){console.log("switch to ".concat(e)),i(e)},defaultValue:u}),(0,U.jsx)(q.ZP,{type:"primary",icon:(0,U.jsx)(W.Z,{}),onClick:$,children:"新建"}),(0,U.jsx)(q.ZP,{type:"default",icon:(0,U.jsx)(G.Z,{}),onClick:_,children:"保存"}),(0,U.jsx)(q.ZP,{type:"default",icon:(0,U.jsx)(J.Z,{}),onClick:function(){console.log("handlePreviewArticle",T),window.open("".concat((0,N.SV)(),"/kb/").concat(null==V?void 0:V.uid,"/").concat(null==T?void 0:T.uid))},children:"预览"})]})}),u&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(F.ZP,{style:{height:"100%"},value:Z,enablePreview:!0,onChange:function(e,t){console.log("markdown onChange value",e,t),j(e),w(e)}})}),!u&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(K,{placeholder:"article content..",value:y,onChange:function(e,t){console.log("aiEditor onChange value",e,t),w(e),j(t)}})})]})},Y=i.Z.Sider,$=i.Z.Content,_=function(){var e=(0,u.Z)(),t=e.leftSiderStyle,n=e.contentStyle;return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(l.w,{children:(0,U.jsxs)(r.Z,{children:[(0,U.jsx)(s.ZP,{}),(0,U.jsxs)(i.Z,{children:[(0,U.jsx)(Y,{style:t,children:(0,U.jsx)(o.Z,{type:a.VX})}),(0,U.jsx)(Y,{style:t,children:(0,U.jsx)(E,{})}),(0,U.jsx)(i.Z,{children:(0,U.jsx)($,{style:n,children:(0,U.jsx)(Q,{})})})]})]})})})}}}]);