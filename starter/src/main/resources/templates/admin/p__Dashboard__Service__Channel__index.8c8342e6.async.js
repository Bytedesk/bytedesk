"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{78413:function(e,n,t){t.r(n),t.d(n,{default:function(){return tn}});var a=t(96865),r=t(75574),i=t(45332),u=t.n(i),o=t(23864),c=t(73193),l=t.n(c),s=t(76711),d=t.n(s),p=t(55735),h=t(44435),f=t(83642),m=t(83890),v=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var a,r=n().currentChannel;""!==r.uid&&void 0!==r||(null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var a=n().llmproviderResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));if(-1!==r){var i=[].concat(d()(a.slice(0,r)),[t],d()(a.slice(r+1))),u=l()(l()({},n().llmproviderResult),{},{data:{content:i}});e({llmproviderResult:u,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var a=n().llmproviderResult.data.content,r=a.findIndex((function(e){return e.uid===t}));-1!==r?e({llmproviderResult:l()(l()({},n().llmproviderResult),{},{data:{content:[].concat(d()(a.slice(0,r)),d()(a.slice(r+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),g=t(9452),x=t(44194),w=t(31549),y=[{name:"web",nickname:"网站/H5"},{name:"react",nickname:"React"},{name:"vue",nickname:"Vue"},{name:"svelte",nickname:"Svelte"},{name:"vanilla",nickname:"Vanilla"},{name:"ios",nickname:"iOS"},{name:"android",nickname:"安卓"},{name:"uniapp",nickname:"Uniapp"},{name:"flutter",nickname:"Flutter"},{name:"wechat-mp",nickname:"微信公众号"},{name:"wechat-mini",nickname:"微信小程序"},{name:"wechat-work",nickname:"企业微信"},{name:"wechat-kefu",nickname:"微信客服"},{name:"douyin",nickname:"抖音"},{name:"xiaohongshu",nickname:"小红书"},{name:"baidu",nickname:"百度"},{name:"weibo",nickname:"微博"},{name:"bilibili",nickname:"哔哩哔哩"},{name:"zhihu",nickname:"知乎"},{name:"pdd",nickname:"拼多多"},{name:"jd",nickname:"京东"},{name:"qianniu",nickname:"千牛"},{name:"doudian",nickname:"抖店"},{name:"whatsapp",nickname:"Whatsapp"},{name:"telegram",nickname:"Telegram"},{name:"facebook",nickname:"Facebook"},{name:"instagram",nickname:"Instagram"},{name:"line",nickname:"Line"},{name:"wordpress",nickname:"Wordpress"},{name:"shopify",nickname:"Shopify"},{name:"lazada",nickname:"Lazada"},{name:"woocommerce",nickname:"Woocommerce"},{name:"opencart",nickname:"Opencart"},{name:"magento",nickname:"Magento"},{name:"prestashop",nickname:"Prestashop"}],j=function(){var e=(0,o.Z)().isDarkMode,n=(0,x.useState)([]),t=u()(n,2),a=t[0],r=t[1],i=v((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),c=i.currentChannel,l=i.setCurrentChannel;return(0,x.useEffect)((function(){var e=[].concat(y);r(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(g.Z,{itemLayout:"horizontal",dataSource:a,renderItem:function(n,t){return(0,w.jsx)(g.Z.Item,{style:(null==c?void 0:c.name)===n.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){l(n)},children:(0,w.jsx)(g.Z.Item.Meta,{title:(0,w.jsx)("div",{style:{marginLeft:10},children:n.nickname})})})}})})},M=t(8247),k=t(90819),Z=t.n(k),W=t(89933),C=t.n(W),b=t(86803),R=t(24170),S=t(72614),T=t(76750),I=t(1902),A=t(40612),E=t(95490),P=t(67402),F=t(38775),U=t(18697),z=t(13161),L=t(79176),q=t(21325),D=t(53300),V=t(36378),N=t(11452),O=t(44574),K=t(75262),B=t(10354),G=t(51103),J=t(29897),X=t(76432),H=t(6897),_=t(62476),$=t(15025),Q=U.Z.Title,Y=U.Z.Text,ee=function(e){var n=e.channel,t=((0,x.useRef)(!1),(0,T.Z)().translateString),a=v((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),r=a.currentType,i=a.setCurrentType,o=(0,A.u)((function(e){return e.currentOrg})),c=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],l=(0,I.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),s=l.agentResult,d=l.currentAgent,h=l.setAgentResult,f=l.setCurrentAgent,m=(0,x.useState)([]),g=u()(m,2),y=g[0],j=g[1],M=(0,E.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),k=M.workgroupResult,W=M.currentWorkgroup,U=M.setWorkgroupResult,ee=M.setCurrentWorkgroup,ne=(0,x.useState)(null==d?void 0:d.uid),te=u()(ne,2),ae=te[0],re=te[1],ie=(0,x.useState)(null==W?void 0:W.uid),ue=u()(ie,2),oe=ue[0],ce=ue[1],le=(0,x.useState)([]),se=u()(le,2),de=se[0],pe=se[1],he=function(){var e=C()(Z()().mark((function e(){var n,a,r;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,R._t)(n);case 4:a=e.sent,console.log("queryAgentsByOrg: ",a),200===a.code?(b.yw.destroy(),h(a),a.data.content.length>0&&(f(a.data.content[0]),re(a.data.content[0].uid)),r=[],a.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};r.push(n)})),j(r)):(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=C()(Z()().mark((function e(){var n,a,r;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,S.u7)(n);case 4:a=e.sent,console.log("getWorkgroups",a),200===a.code?(b.yw.destroy(),U(a),a.data.content.length>0&&(ee(a.data.content[0]),ce(a.data.content[0].uid)),r=[],a.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};r.push(n)})),pe(r)):(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,x.useEffect)((function(){he(),fe()}),[r]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(P.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),i(e.target.value)},options:c,defaultValue:r,optionType:"button",buttonStyle:"solid"}),(0,w.jsx)("br",{}),(0,w.jsx)("br",{}),r===p.Njn&&(null==d?void 0:d.uid)&&(0,w.jsx)(P.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=s.data.content.find((function(n){return n.uid===e.target.value}));f(n)},options:y,defaultValue:ae,optionType:"button",buttonStyle:"solid"}),r===p.aZD&&(null==d?void 0:d.uid)&&(0,w.jsx)(P.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=k.data.content.find((function(n){return n.uid===e.target.value}));ee(n)},options:de,defaultValue:oe,optionType:"button",buttonStyle:"solid"}),(0,w.jsx)(F.Z,{}),(0,w.jsx)(Q,{level:5,children:"组织orgUid"}),(0,w.jsx)(Y,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,w.jsx)(Q,{level:5,children:"一对一当前客服Uid"}),(0,w.jsx)(Y,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,w.jsx)(Q,{level:5,children:"当前技能组Uid"}),(0,w.jsx)(Y,{code:!0,copyable:!0,children:null==W?void 0:W.uid}),(0,w.jsx)(F.Z,{}),"douyin"===(null==n?void 0:n.name)&&(0,w.jsx)(z.Z,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,w.jsx)(L.Z,{}),"baidu"===(null==n?void 0:n.name)&&(0,w.jsx)(q.Z,{}),"weibo"===(null==n?void 0:n.name)&&(0,w.jsx)(D.Z,{}),"bilibili"===(null==n?void 0:n.name)&&(0,w.jsx)(V.Z,{}),"zhihu"===(null==n?void 0:n.name)&&(0,w.jsx)(N.Z,{}),"pdd"===(null==n?void 0:n.name)&&(0,w.jsx)(O.Z,{}),"jd"===(null==n?void 0:n.name)&&(0,w.jsx)(K.Z,{}),"qianniu"===(null==n?void 0:n.name)&&(0,w.jsx)(B.Z,{}),"doudian"===(null==n?void 0:n.name)&&(0,w.jsx)(G.Z,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,w.jsx)(J.Z,{}),"telegram"===(null==n?void 0:n.name)&&(0,w.jsx)(X.Z,{}),"line"===(null==n?void 0:n.name)&&(0,w.jsx)(H.Z,{}),"shopify"===(null==n?void 0:n.name)&&(0,w.jsx)(_.Z,{}),"lazada"===(null==n?void 0:n.name)&&(0,w.jsx)($.Z,{})]})},ne=t(7785),te=t(54518),ae=t(45178),re=t(42909),ie=t(81360),ue=t(5724),oe=t(99980),ce=t(66329),le=t(30634),se=function(e){var n=e.channel;return(0,w.jsxs)(w.Fragment,{children:["web"===(null==n?void 0:n.name)&&(0,w.jsx)(le.Z,{type:p.aZD}),"react"===(null==n?void 0:n.name)&&(0,w.jsx)(re.Z,{type:n.name}),"vue"===(null==n?void 0:n.name)&&(0,w.jsx)(ce.Z,{type:n.name}),"angular"===(null==n?void 0:n.name)&&(0,w.jsx)(re.Z,{type:n.name}),"svelte"===(null==n?void 0:n.name)&&(0,w.jsx)(ie.Z,{type:n.name}),"vanilla"===(null==n?void 0:n.name)&&(0,w.jsx)(oe.Z,{type:n.name}),"ios"===(null==n?void 0:n.name)&&(0,w.jsx)(ae.Z,{type:n.name}),"android"===(null==n?void 0:n.name)&&(0,w.jsx)(ne.Z,{type:n.name}),"uniapp"===(null==n?void 0:n.name)&&(0,w.jsx)(ue.Z,{type:n.name}),"flutter"===(null==n?void 0:n.name)&&(0,w.jsx)(te.Z,{type:n.name})]})},de=t(79686),pe=t(40803),he=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{wechatMpResult:{data:{content:[]}},currentWechatMp:{uid:"",nickname:"",avatar:"",description:""},insertWechatMp:function(n){e((function(e){e.wechatMpResult.data.content.unshift(n)}))},updateWechatMp:function(n){e((function(e){var t=e.wechatMpResult.data.content,a=t.findIndex((function(e){return e.uid===n.uid}));-1!==a?t[a]=n:console.warn("WechatMp with uid ".concat(n.uid," not found."))}))},deleteWechatMp:function(n){e((function(e){var t=e.wechatMpResult.data.content,a=t.findIndex((function(e){return e.uid===n.uid}));-1!==a?t.splice(a,1):console.warn("WechatMp with uid ".concat(n.uid," not found."))}))},setWechatMpResult:function(t){var a;(e({wechatMpResult:t}),""===n().currentWechatMp.uid)&&((null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentWechatMp:t.data.content[0]}))},setCurrentWechatMp:function(t){var a=n().wechatMpResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));if(-1!==r){var i=[].concat(d()(a.slice(0,r)),[t],d()(a.slice(r+1))),u=l()(l()({},n().wechatMpResult),{},{data:{content:i}});e({wechatMpResult:u,currentWechatMp:t})}else console.warn("WechatMp with the specified uid not found."),e({currentWechatMp:t})},deleteCurrentWechatMp:function(t){var a=n().wechatMpResult.data.content,r=a.findIndex((function(e){return e.uid===t}));-1!==r?e({wechatMpResult:l()(l()({},n().wechatMpResult),{},{data:{content:[].concat(d()(a.slice(0,r)),d()(a.slice(r+1)))}})}):console.warn("WechatMp not found in cache:",t),n().currentWechatMp.uid===t&&e({currentWechatMp:{uid:""}})},deleteWechatMpCache:function(){return e({},!0)}}})),{name:p._SZ}))),fe=t(15722),me=t(82669),ve=t(30921),ge=t(53530),xe=t(27487),we=t(75365),ye=t(63289),je=function(){var e=(0,ve.useIntl)(),n=(0,x.useRef)(!1),t=(0,T.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,r=(0,x.useState)(!1),i=u()(r,2),c=i[0],l=i[1],s=(0,x.useState)(!1),d=u()(s,2),p=d[0],h=d[1],f=(0,A.u)((function(e){return e.currentOrg})),m=he((function(e){return{wechatMpResult:e.wechatMpResult,currentWechatMp:e.currentWechatMp,setWechatMpResult:e.setWechatMpResult,insertWechatMp:e.insertWechatMp,setCurrentWechatMp:e.setCurrentWechatMp,deleteCurrentWechatMp:e.deleteCurrentWechatMp}})),v=m.wechatMpResult,y=m.currentWechatMp,j=m.setWechatMpResult,M=m.insertWechatMp,k=m.setCurrentWechatMp,W=m.deleteCurrentWechatMp,R=ge.Z.useModal(),S=u()(R,2),I=S[0],E=S[1],P=function(){var n=C()(Z()().mark((function n(t){var a;return Z()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete wechatMp",t),b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,(0,pe.ul)(t);case 4:a=n.sent,console.log("delete wechatMp response",a),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(t.uid)):(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),F=function(){var e=C()(Z()().mark((function e(){var t,a;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,b.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==f?void 0:f.uid},e.next=8,(0,pe.aq)(t);case 8:a=e.sent,console.log("getWechatMps",a),200===a.code?(b.yw.destroy(),j(a)):(b.yw.destroy(),b.yw.error(a.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){F()}),[]);var U=function(){var e=C()(Z()().mark((function e(n){var t;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,pe._Z)(n);case 2:t=e.sent,console.log("handleCreateWechatMp response:",t),200===t.code?(M(t.data),l(!1)):b.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=C()(Z()().mark((function e(n){var t;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==y?void 0:y.uid,e.next=3,(0,pe.sS)(n);case 3:t=e.sent,console.log("handleUpdateWechatMp response:",t),200===t.code?(k(t.data),l(!1)):b.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(xe.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,w.jsx)(we.ZP,{size:"small",type:"primary",icon:(0,w.jsx)(me.Z,{}),onClick:function(){l(!0),h(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(we.ZP,{size:"small",onClick:function(){h(!0),l(!0)},disabled:y&&""===y.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,w.jsx)(we.ZP,{size:"small",danger:!0,onClick:function(){return n=y,void I.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(fe.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){P(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n},disabled:y&&""===y.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,w.jsx)(g.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,w.jsx)(g.Z.Item,{style:y.uid===e.uid?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){k(e)},children:(0,w.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsx)(w.Fragment,{children:t(e.name)}),description:t(e.description)})})}}),c&&(0,w.jsx)(ye.Z,{isEdit:p,open:c,wechatmp:y,onClose:function(){l(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?z(e):U(e)}}),E]})},Me=function(){var e=he((function(e){return{currentWechatMp:e.currentWechatMp}})).currentWechatMp;return(0,w.jsx)(w.Fragment,{children:""!==(null==e?void 0:e.uid)&&(0,w.jsxs)("div",{className:"flex items-center justify-end",children:[(0,w.jsxs)("p",{children:["URL: ",e.url,(0,w.jsx)(we.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.url),b.yw.success("URL已复制")},children:"复制"})]}),(0,w.jsxs)("p",{children:["Token: ",e.token,(0,w.jsx)(we.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.token),b.yw.success("Token已复制")},children:"复制"})]})]})})},ke=function(e){console.log(e)},Ze=[{key:"agent",label:"客服管理",children:(0,w.jsx)(Me,{})}],We=function(){var e=(0,x.useState)([]),n=u()(e,2),t=n[0],a=n[1];return(0,x.useEffect)((function(){var e=[].concat(Ze);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(M.Z,{defaultActiveKey:"agent",items:t,onChange:ke})})},Ce=r.Z.Sider,be=r.Z.Content,Re=function(){var e=(0,a.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,w.jsxs)(r.Z,{children:[(0,w.jsx)(Ce,{width:t,style:n,children:(0,w.jsx)(je,{})}),(0,w.jsx)(r.Z,{children:(0,w.jsx)(be,{children:(0,w.jsx)(We,{})})})]})};function Se(e){return Te.apply(this,arguments)}function Te(){return(Te=C()(Z()().mark((function e(n){return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ve.request)("/api/v1/wechat/mini/create",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=C()(Z()().mark((function e(n){return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ve.request)("/api/v1/wechat/mini/update",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=C()(Z()().mark((function e(n){return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ve.request)("/api/v1/wechat/mini/delete",{method:"POST",data:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=C()(Z()().mark((function e(n){return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ve.request)("/api/v1/wechat/mini/query/org",{method:"GET",params:l()(l()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{wechatMiniResult:{data:{content:[]}},currentWechatMini:{uid:"",nickname:"",avatar:"",description:""},insertWechatMini:function(n){e((function(e){e.wechatMiniResult.data.content.unshift(n)}))},updateWechatMini:function(n){e((function(e){var t=e.wechatMiniResult.data.content,a=t.findIndex((function(e){return e.uid===n.uid}));-1!==a?t[a]=n:console.warn("WechatMini with uid ".concat(n.uid," not found."))}))},deleteWechatMini:function(n){e((function(e){var t=e.wechatMiniResult.data.content,a=t.findIndex((function(e){return e.uid===n.uid}));-1!==a?t.splice(a,1):console.warn("WechatMini with uid ".concat(n.uid," not found."))}))},setWechatMiniResult:function(t){var a;(e({wechatMiniResult:t}),""===n().currentWechatMini.uid)&&((null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentWechatMini:t.data.content[0]}))},setCurrentWechatMini:function(t){var a=n().wechatMiniResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));if(-1!==r){var i=[].concat(d()(a.slice(0,r)),[t],d()(a.slice(r+1))),u=l()(l()({},n().wechatMiniResult),{},{data:{content:i}});e({wechatMiniResult:u,currentWechatMini:t})}else console.warn("WechatMini with the specified uid not found."),e({currentWechatMini:t})},deleteCurrentWechatMini:function(t){var a=n().wechatMiniResult.data.content,r=a.findIndex((function(e){return e.uid===t}));-1!==r?e({wechatMiniResult:l()(l()({},n().wechatMiniResult),{},{data:{content:[].concat(d()(a.slice(0,r)),d()(a.slice(r+1)))}})}):console.warn("WechatMini not found in cache:",t),n().currentWechatMini.uid===t&&e({currentWechatMini:{uid:""}})},deleteWechatMiniCache:function(){return e({},!0)}}})),{name:p.I5N}))),Le=t(69169),qe=t(4499),De=t(84881),Ve=t(73442),Ne=t(3849),Oe=function(e){var n,t=e.isEdit,a=e.wechatmini,r=e.open,i=e.onClose,o=e.onSubmit,c=Le.A.useForm(),s=u()(c,1)[0],d=(0,T.Z)().translateStringTranct,p=(0,A.u)((function(e){return e.currentOrg})),h=(0,E.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),f=h.workgroupResult,m=h.setWorkgroupResult;(0,x.useEffect)((function(){t?s.setFieldsValue({name:null==a?void 0:a.name,appId:null==a?void 0:a.appId,appSecret:null==a?void 0:a.appSecret,encodingAesKey:null==a?void 0:a.encodingAesKey,encryptMode:null==a?void 0:a.encryptMode,dataType:null==a?void 0:a.dataType,workgroupUid:null==a?void 0:a.workgroupUid}):s.setFieldsValue({name:"",appId:"",appSecret:"",encodingAesKey:"",encryptMode:"PLAINTEXT",dataType:"xml",workgroupUid:""})}),[t,a,s]);var v=function(){var e=C()(Z()().mark((function e(){var n,t;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==p?void 0:p.uid},e.next=4,(0,S.u7)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(b.yw.destroy(),m(t)):(b.yw.destroy(),b.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){v()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Ve.Z,{title:"微信小程序",onClose:i,open:r,children:(0,w.jsxs)(Le.A,{form:s,name:"wechatMiniForm",onFinish:function(){console.log("handleSubmit"),s.validateFields().then((function(e){var n=l()(l()({},e),{},{orgUid:null==p?void 0:p.uid});console.log("submit",n),o(n)}))},children:[(0,w.jsx)(qe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(qe.Z,{label:"appId",name:"appId",rules:[{required:!0}]}),(0,w.jsx)(qe.Z,{label:"appSecret",name:"appSecret",rules:[{required:!0}]}),(0,w.jsx)(qe.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}]}),(0,w.jsxs)(Ne.Z,{children:[(0,w.jsx)(we.ZP,{onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var a=Math.floor(Math.random()*e.length);n+=e.charAt(a)}s.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,w.jsx)(we.ZP,{onClick:function(){var e=s.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),b.yw.success("已复制到剪切板")}},children:"复制"})]}),(0,w.jsx)(De.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"明文模式",value:"PLAINTEXT"},{label:"兼容模式",value:"COMPATIBLE"},{label:"安全模式",value:"SAFE"}],fieldProps:{defaultValue:"PLAINTEXT",allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(qe.Z,{label:"数据格式",name:"dataType",rules:[{required:!0}],disabled:!0}),(0,w.jsx)(De.Z,{label:"客服技能组",name:"workgroupUid",options:null==f||null===(n=f.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:d(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)("p",{children:"注：微信公众号-》设置与开发-》开发接口管理-》基本设置 获取相关信息"})]})})})},Ke=function(){var e=(0,ve.useIntl)(),n=(0,x.useRef)(!1),t=(0,T.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,r=(0,x.useState)(!1),i=u()(r,2),c=i[0],l=i[1],s=(0,x.useState)(!1),d=u()(s,2),p=d[0],h=d[1],f=(0,A.u)((function(e){return e.currentOrg})),m=ze((function(e){return{wechatMiniResult:e.wechatMiniResult,currentWechatMini:e.currentWechatMini,setWechatMiniResult:e.setWechatMiniResult,insertWechatMini:e.insertWechatMini,setCurrentWechatMini:e.setCurrentWechatMini,deleteCurrentWechatMini:e.deleteCurrentWechatMini}})),v=m.wechatMiniResult,y=m.currentWechatMini,j=m.setWechatMiniResult,M=m.insertWechatMini,k=m.setCurrentWechatMini,W=m.deleteCurrentWechatMini,R=ge.Z.useModal(),S=u()(R,2),I=S[0],E=S[1],P=function(){var n=C()(Z()().mark((function n(t){var a;return Z()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete wechatMini",t),b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,Ee(t);case 4:a=n.sent,console.log("delete wechatMini response",a),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(t.uid)):(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),F=function(){var e=C()(Z()().mark((function e(){var t,a;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,b.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==f?void 0:f.uid},e.next=8,Fe(t);case 8:a=e.sent,console.log("getWechatMinis",a),200===a.code?(b.yw.destroy(),j(a)):(b.yw.destroy(),b.yw.error(a.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){F()}),[]);var U=function(){var e=C()(Z()().mark((function e(n){var t;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se(n);case 2:t=e.sent,console.log("handleCreateWechatMini response:",t),200===t.code?(M(t.data),l(!1)):b.yw.error(t.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=C()(Z()().mark((function e(n){var t;return Z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==y?void 0:y.uid,e.next=3,Ie(n);case 3:t=e.sent,console.log("handleUpdateWechatMini response:",t),200===t.code?(k(t.data),l(!1)):b.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(xe.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,w.jsx)(we.ZP,{size:"small",type:"primary",icon:(0,w.jsx)(me.Z,{}),onClick:function(){l(!0),h(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(we.ZP,{size:"small",onClick:function(){h(!0),l(!0)},disabled:y&&""===y.uid,children:e.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,w.jsx)(we.ZP,{size:"small",danger:!0,onClick:function(){return n=y,void I.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(fe.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){P(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n},disabled:y&&""===y.uid,children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,w.jsx)(g.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,w.jsx)(g.Z.Item,{style:y.uid===e.uid?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){k(e)},children:(0,w.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsx)(w.Fragment,{children:t(e.name)}),description:t(e.description)})})}}),c&&(0,w.jsx)(Oe,{isEdit:p,open:c,wechatmini:y,onClose:function(){l(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),p?z(e):U(e)}}),E]})},Be=function(){var e=ze((function(e){return{currentWechatMini:e.currentWechatMini}})).currentWechatMini;return(0,w.jsx)(w.Fragment,{children:""!==(null==e?void 0:e.uid)&&(0,w.jsxs)("div",{className:"flex items-center justify-end",children:[(0,w.jsxs)("p",{children:["URL: ",e.url,(0,w.jsx)(we.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.url),b.yw.success("URL已复制")},children:"复制"})]}),(0,w.jsxs)("p",{className:"ml-2",children:["Token: ",e.token,(0,w.jsx)(we.ZP,{onClick:function(){navigator.clipboard.writeText(null==e?void 0:e.token),b.yw.success("Token已复制")},children:"复制"})]})]})})},Ge=function(e){console.log(e)},Je=[{key:"agent",label:"客服管理",children:(0,w.jsx)(Be,{})}],Xe=function(){var e=(0,x.useState)([]),n=u()(e,2),t=n[0],a=n[1];return(0,x.useEffect)((function(){var e=[].concat(Je);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(M.Z,{defaultActiveKey:"agent",items:t,onChange:Ge})})},He=r.Z.Sider,_e=r.Z.Content,$e=function(){var e=(0,a.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,w.jsxs)(r.Z,{children:[(0,w.jsx)(He,{width:t,style:n,children:(0,w.jsx)(Ke,{})}),(0,w.jsx)(r.Z,{children:(0,w.jsx)(_e,{children:(0,w.jsx)(Xe,{})})})]})},Qe=function(e){var n=e.channel,t=(0,x.useState)([]),a=u()(t,2),r=a[0],i=a[1],o=(0,x.useState)(!0),c=u()(o,2),l=c[0],s=c[1];return(0,x.useEffect)((function(){var e=[];"web"===(null==n?void 0:n.name)||"react"===(null==n?void 0:n.name)||"vue"===(null==n?void 0:n.name)||"angular"===(null==n?void 0:n.name)||"svelte"===(null==n?void 0:n.name)||"vanilla"===(null==n?void 0:n.name)||"ios"===(null==n?void 0:n.name)||"android"===(null==n?void 0:n.name)||"flutter"===(null==n?void 0:n.name)||"uniapp"===(null==n?void 0:n.name)?(s(!0),e.push({key:"info",label:"基本信息",children:(0,w.jsx)(ee,{channel:n})},{key:"code",label:"客服代码",children:(0,w.jsx)(se,{channel:n})})):s(!1),i(e)}),[n]),(0,w.jsxs)("div",{style:{padding:"0 24px"},children:[l&&(0,w.jsx)(M.Z,{defaultActiveKey:"info",items:r}),"wechat-mp"===(null==n?void 0:n.name)&&(0,w.jsx)(Re,{}),"wechat-mini"===(null==n?void 0:n.name)&&(0,w.jsx)($e,{}),"wechat-work"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"wechat-kefu"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"douyin"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"baidu"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"weibo"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"bilibili"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"zhihu"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"pdd"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"jd"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"qianniu"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"doudian"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"telegram"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"facebook"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"line"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"shopify"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"lazada"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"wordpress"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"opencart"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"magento"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{}),"prestashop"===(null==n?void 0:n.name)&&(0,w.jsx)(de.Z,{})]})},Ye=function(){var e=(0,x.useState)(""),n=u()(e,2),t=n[0],a=n[1],r=(0,x.useState)([]),i=u()(r,2),o=i[0],c=i[1],l=v().currentChannel;(0,x.useEffect)((function(){l&&s(l)}),[l]);var s=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&c([].concat(d()(o),[{label:e.nickname,key:n,children:(0,w.jsx)(Qe,{channel:e}),channelInfo:e,closable:!0}])),a(n)};return(0,w.jsx)(M.Z,{hideAdd:!0,onChange:function(e){a(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),r=o.filter((function(n){return n.key!==e}));if(r.length&&e===t){var i=r[n===r.length?n-1:n].key;a(i)}c(r)}(e)},items:o})},en=r.Z.Sider,nn=r.Z.Content,tn=function(){var e=(0,a.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(r.Z,{children:[(0,w.jsx)(en,{style:n,children:(0,w.jsx)(j,{})}),(0,w.jsx)(r.Z,{children:(0,w.jsx)(nn,{style:t,children:(0,w.jsx)(Ye,{})})})]})})}}}]);