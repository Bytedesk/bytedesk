"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9451],{425:function(e,t,n){n.d(t,{FU:function(){return d},O7:function(){return v},k4:function(){return p},yr:function(){return y}});var r=n(90228),a=n.n(r),o=n(26068),u=n.n(o),i=n(87999),c=n.n(i),s=n(64453),l=n(45234);function d(e){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:u()(u()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:u()(u()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:u()(u()({},t),{},{client:s.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/visitor/api/v1/category/query",{method:"GET",params:{client:s.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},35411:function(e,t,n){n.d(t,{Z:function(){return Z}});var r=n(90228),a=n.n(r),o=n(87999),u=n.n(o),i=n(48305),c=n.n(i),s=n(65060),l=n(8591),d=n(85867),f=n(42502),p=n(99914),g=n(1088),y=n(37240),h=n(92785),v=n(37866),m=n(95877),b=n(43393),k=n(64826),w=n(6817),C=n(75271),x=n(52676),S=function(e){var t,n=e.open,r=e.type,o=e.isEdit,i=e.category,s=e.onCancel,d=e.onSubmit,f=b.A.useForm(),p=c()(f,1)[0],g=(0,h.Z)().translateString,S=(0,m.u)((function(e){return e.currentOrg})),R=(0,v.j)((function(e){return e.kbaseResult})),K=(0,v.j)((function(e){return e.currentKbase}));(0,C.useEffect)((function(){o?p.setFieldsValue({name:g(null==i?void 0:i.name)}):p.resetFields(),p.setFieldsValue({kbUid:null==K?void 0:K.uid})}),[n,o]);var j=function(){p.validateFields().then(function(){var e=u()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),n={uid:o?null==i?void 0:i.uid:"",name:t.name,type:r,kbUid:t.kbUid,orgUid:null==S?void 0:S.uid},d(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),y.yw.error("创建分类失败")}))};return(0,x.jsx)("div",{children:(0,x.jsx)(l.Z,{title:"新建分类",open:n,forceRender:!0,onOk:j,onCancel:s,getContainer:!1,children:(0,x.jsxs)(b.A,{form:p,name:"categoryForm",submitter:!1,children:[(0,x.jsx)(k.Z,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&j()},placeholder:"请输入分类名称"}}),(0,x.jsx)(w.Z,{name:"kbUid",label:"所属知识库",allowClear:!0,options:null==R||null===(t=R.data)||void 0===t?void 0:t.content.map((function(e){return{label:g(e.name),value:e.uid}}))})]})})})},R=n(425),K=n(69483),j=n(45234),U=l.Z.confirm,Z=function(e){var t=e.type,n=(0,C.useState)(!1),r=c()(n,2),o=r[0],i=r[1],l=(0,j.useIntl)(),b=(0,C.useState)(!0),k=c()(b,2),w=k[0],Z=k[1],M=(0,C.useState)(),O=c()(M,2),T=O[0],E=O[1],F=(0,m.u)((function(e){return e.currentOrg})),q=(0,v.j)((function(e){return e.currentKbase})),D=(0,K.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,setCategoryResult:e.setCategoryResult,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid}})),A=D.categoryTreeOptions,P=D.setCategoryResult,V=D.currentCategory,z=D.setCurrentCategoryUid,I=(0,h.Z)(),W=I.translateString,G=I.translateStringTranct,J=function(){var e=u()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmit: ",t),w?y.yw.loading(l.formatMessage({id:"updating"})):y.yw.loading(l.formatMessage({id:"creating"})),!w){e.next=8;break}return e.next=5,(0,R.yr)(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,R.k4)(t);case 10:e.t0=e.sent;case 11:n=e.t0,console.log("createCategory response: ",n),200===n.code?(y.yw.destroy(),w?y.yw.success(l.formatMessage({id:"update.success"})):y.yw.success(l.formatMessage({id:"create.success"})),i(!1),N()):(y.yw.destroy(),y.yw.error(n.message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=u()(a()().mark((function e(){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getCategories"),y.yw.success(l.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:50,type:t,kbUid:null==q?void 0:q.uid,orgUid:null==F?void 0:F.uid},e.next=5,(0,R.FU)(n);case 5:r=e.sent,console.log("queryCategories response: ",r),200===r.code?(P(r),y.yw.destroy()):(y.yw.destroy(),y.yw.error(r.message));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditCategory: ",V),Z(!0),E(V),i(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteCategory: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,C.useEffect)((function(){N()}),[q]);return(0,x.jsxs)("div",{children:[(0,x.jsxs)(d.Z,{gap:"small",wrap:"wrap",style:{marginBottom:5},children:[(0,x.jsx)(f.ZP,{type:"primary",size:"small",onClick:function(){Z(!1),E(void 0),i(!0)},disabled:(null==q?void 0:q.type)!=t,children:"创建分类"}),""!==(null==V?void 0:V.uid)&&"all"!==(null==V?void 0:V.uid)&&(0,x.jsx)(f.ZP,{size:"small",onClick:B,children:l.formatMessage({id:"edit"})}),""!==(null==V?void 0:V.uid)&&"all"!==(null==V?void 0:V.uid)&&(0,x.jsx)(f.ZP,{onClick:function(){return function(e){U({title:l.formatMessage({id:"deleteTip"}),icon:(0,x.jsx)(s.Z,{}),content:"".concat(l.formatMessage({id:"deleteAfirm",defaultMessage:"Delete"}),"【").concat(W(e.name),"】？"),onOk:function(){H(e)},onCancel:function(){},okText:l.formatMessage({id:"ok"}),cancelText:l.formatMessage({id:"cancel"})})}(V)},size:"small",style:{float:"right"},danger:!0,children:l.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,x.jsx)(p.Z,{defaultSelectedKeys:[V.uid],onSelect:function(e,t){console.log("selected",e,t),0!==e.length&&z(e[0].toString())},treeData:A,blockNode:!0,titleRender:function(e){return(0,x.jsx)(g.Z,{title:W(e.title),children:G(e.title)})}}),(0,x.jsx)(S,{open:o,type:t,isEdit:w,category:T,onCancel:function(){i(!1)},onSubmit:J})]})}},7571:function(e,t,n){var r=n(94414);t.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh"}}}},69483:function(e,t,n){n.d(t,{v:function(){return d}});var r=n(15558),a=n.n(r),o=n(26068),u=n.n(o),i=n(64453),c=n(79475),s=n(11811),l=n(15226),d=(0,c.Ue)()((0,s.mW)((0,s.tJ)((0,l.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:""},setCategoryResult:function(t){var n,r=function(e){var t=[];return e.data.content.forEach((function(e){var n={label:e.name,value:e.uid};t.push(n)})),t}(t),o=u()(u()({},t),{},{data:{content:[{uid:"all",name:"All"}].concat(a()(t.data.content))}}),i=function(e){var t=[];return e.data.content.forEach((function(e){var n={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(n.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(n)})),t}(o);e({categoryResult:o,categoryTreeOptions:i,categorySelectOptions:r}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0?e({currentCategory:t.data.content[0]}):e({currentCategory:{uid:""}})},setCurrentCategoryUid:function(n){var r=t().categoryResult.data.content.find((function(e){return e.uid===n}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))},37866:function(e,t,n){n.d(t,{j:function(){return d}});var r=n(26068),a=n.n(r),o=n(15558),u=n.n(o),i=n(64453),c=n(79475),s=n(11811),l=n(15226),d=(0,c.Ue)()((0,s.mW)((0,s.tJ)((0,l.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var n=e.kbaseResult.data.content,r=n.findIndex((function(e){return e.uid===t.uid}));-1!==r?n[r]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var n;e({kbaseResult:t}),(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n.uid}));if(-1!==o){var i=[].concat(u()(r.slice(0,o)),[n],u()(r.slice(o+1))),c=a()(a()({},t().kbaseResult),{},{data:{content:i}});e({kbaseResult:c,currentKbase:n})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:n})},removeKbase:function(n){var r=t().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===n}));-1!==o?e({kbaseResult:a()(a()({},t().kbaseResult),{},{data:{content:[].concat(u()(r.slice(0,o)),u()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",n),t().currentKbase.uid===n&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))}}]);