"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2522],{82863:function(e,t,n){n.d(t,{Jr:function(){return f},LF:function(){return d},Oh:function(){return h},WS:function(){return m}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(90069),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},36605:function(e,t,n){n.d(t,{HH:function(){return h},T:function(){return f},fx:function(){return m},mK:function(){return d}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(90069),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/provider/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92053:function(e,t,n){n.d(t,{V:function(){return l},c:function(){return d}});var r=n(90819),s=n.n(r),o=n(89933),a=n.n(o),i=n(90069),u=n(30921);function l(){return c.apply(this,arguments)}function c(){return(c=a()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/ping",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return p.apply(this,arguments)}function p(){return(p=a()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{client:i.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},27522:function(e,t,n){n.d(t,{AP:function(){return d},_J:function(){return h},t5:function(){return m},v_:function(){return f}});var r=n(90819),s=n.n(r),o=n(73193),a=n.n(o),i=n(89933),u=n.n(i),l=n(90069),c=n(30921);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=u()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:a()(a()({},t),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},14052:function(e,t,n){n.r(t),n.d(t,{default:function(){return ge}});var r=n(75574),s=n(44194),o=n(90819),a=n.n(o),i=n(89933),u=n.n(i),l=n(45332),c=n.n(l),d=n(66310),p=n(53530),f=n(27487),g=n(75365),m=n(9452),v=n(84288),h=n(67444),b=n(70458),y=n(30921),w=n(23864),x=n(40612),M=n(90069),k=n(99811),q=n(4499),j=n(84881),F=n(31549),S=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,s=(0,y.useIntl)(),o=k.A.useForm(),a=c()(o,1)[0],i=(0,x.u)((function(e){return e.currentOrg}));return(0,F.jsx)("div",{children:(0,F.jsx)(p.Z,{title:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:s.formatMessage({id:"save",defaultMessage:"Save"}),onOk:function(){console.log("handleSaveRobot"),a.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={nickname:e.nickname,type:e.type,orgUid:i.uid};console.log("robotObject:",t),r(t)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){n()},children:(0,F.jsxs)(k.A,{form:a,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,F.jsx)(q.Z,{label:s.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"nickname",defaultMessage:"Nickname"})}]}),(0,F.jsx)(j.Z,{label:s.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:s.formatMessage({id:M.f4h,defaultMessage:"Service"}),value:M.f4h}],rules:[{required:!0,message:s.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:s.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})},Z=n(66916),R=n(86803),C=n(76750),T=function(){var e=(0,w.Z)().isDarkMode,t=(0,y.useIntl)(),n=(0,s.useRef)(!1),r=(0,C.Z)(),o=r.translateString,i=r.translateStringTranct,l=(0,d.V)((function(e){return{robotResult:e.robotResult,currentRobot:e.currentRobot,insertRobot:e.insertRobot,deleteCurrentRobot:e.deleteCurrentRobot,setRobotResult:e.setRobotResult,setCurrentRobot:e.setCurrentRobot}})),k=l.robotResult,q=l.currentRobot,j=l.insertRobot,T=l.deleteCurrentRobot,U=l.setRobotResult,V=l.setCurrentRobot,P=(0,x.u)((function(e){return e.currentOrg})),O=p.Z.useModal(),A=c()(O,2),E=A[0],I=A[1],L=function(){var e=u()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,Z.gf)(n);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),T(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=u()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,level:M.whQ,type:M.f4h,orgUid:null==P?void 0:P.uid},e.next=8,(0,Z.p0)(t);case 8:r=e.sent,console.log("queryRobotsByOrg: ",r),200===r.code?(R.yw.destroy(),U(r)):(R.yw.destroy(),R.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){_()}),[]);var X=(0,s.useState)(!1),z=c()(X,2),N=z[0],Q=z[1],G=function(){var e=u()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading(t.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=3,(0,Z.lg)(n);case 3:r=e.sent,console.log("handleSaveRobot response:",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"create.success"})),j(r.data),Q(!1)):(R.yw.destroy(),Q(!1),R.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(e){return t.formatMessage({id:null==e?void 0:e.type,defaultMessage:null==e?void 0:e.type})};return(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{style:{margin:10},children:(0,F.jsxs)(f.Z,{gap:"small",align:"flex-start",children:[(0,F.jsx)(g.ZP,{size:"small",type:"primary",icon:(0,F.jsx)(b.Z,{}),onClick:function(){Q(!0)},children:t.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,F.jsx)(g.ZP,{size:"small",onClick:_,children:t.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,F.jsx)(g.ZP,{onClick:function(){return function(e){E.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,F.jsx)(h.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(o(e.nickname),"】？"),onOk:function(){L(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(q)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==q?void 0:q.uid),children:t.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,F.jsx)(m.Z,{itemLayout:"horizontal",dataSource:k.data.content,renderItem:function(t,n){return(0,F.jsx)(m.Z.Item,{style:(null==q?void 0:q.uid)===t.uid?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){V(t)},children:(0,F.jsx)(m.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,F.jsx)(v.C,{src:t.avatar}),title:(0,F.jsx)(F.Fragment,{children:i(null==t?void 0:t.nickname)}),description:K(t)})})}}),(0,F.jsx)(S,{open:N,onClose:function(){Q(!1)},onSubmit:G}),I]})},U=n(67639),V=n(73193),P=n.n(V),O=n(27522),A=n(11984),E=function(){var e=(0,y.useIntl)(),t=(0,y.useNavigate)(),n=k.A.useForm(),r=c()(n,1)[0],o=(0,C.Z)().translateString,i=(0,s.useState)(),l=c()(i,2),p=l[0],f=l[1],m=(0,x.u)((function(e){return e.currentOrg})),v=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),h=v.currentRobot,b=v.setCurrentRobot,w=function(){var t=u()(a()().mark((function t(){var n,r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),n={pageNumber:0,pageSize:50,type:M.QPQ,orgUid:m.uid},t.next=4,(0,O.AP)(n);case 4:r=t.sent,console.log("getKeywordBase response:",n,r),R.yw.destroy(),200===r.code?f(r):R.yw.error(r.message);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,s.useEffect)((function(){w()}),[]),(0,s.useEffect)((function(){r.setFieldValue("kbUid",null==h?void 0:h.kbUid)}),[h]);var q=function(){var t=u()(a()().mark((function t(n){var r,s,o,i,u,l,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("onFinish values:",n),l=P()(P()({},h),{},{serviceSettings:P()(P()({},h.serviceSettings),{},{faqUids:null==h||null===(r=h.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==h||null===(s=h.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==h||null===(o=h.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==h||null===(i=h.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==h||null===(u=h.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),kbUid:n.kbUid}),console.log("robotObject:",l),t.next=5,(0,Z.$l)(l);case 5:c=t.sent,console.log("updateRobot response:",c),200===c.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),b(c.data)):(R.yw.destroy(),R.yw.error(c.message));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,F.jsx)("div",{children:(0,F.jsxs)(k.A,{form:r,onFinish:q,children:[(0,F.jsx)(j.Z,{width:"md",name:"kbUid",label:"知识库",options:null==p?void 0:p.data.content.map((function(e){return{value:e.uid,label:o(e.name)}})),fieldProps:{onChange:function(e){console.log("kbUid:",e)}}}),(0,F.jsx)(k.A.Item,{children:(0,F.jsx)(g.ZP,{icon:(0,F.jsx)(A.Z,{}),onClick:function(){t("/kb/llm/data")},children:"添加大模型知识库"},"github")})]})})},I=n(43705),L=n(61765),_=n(1461),X=n(71469),z=n(76810),N=n(50796),Q=n(36605),G=n(82863),K=n(48708),B=n(32350),D=n(79907),H=n(92053),$=function(){var e=(0,y.useIntl)(),t=k.A.useForm(),n=c()(t,1)[0],r=(0,C.Z)().translateString,o=(0,x.u)((function(e){return e.currentOrg})),i=(0,s.useState)([]),l=c()(i,2),p=l[0],f=l[1],m=(0,s.useState)([]),v=c()(m,2),h=v[0],b=v[1],w=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),q=w.currentRobot,S=w.setCurrentRobot;(0,s.useEffect)((function(){var e,t,s,o,a,i,u,l;n.setFieldValue("enabled",null==q||null===(e=q.llm)||void 0===e?void 0:e.enabled),n.setFieldValue("topK",null==q||null===(t=q.llm)||void 0===t?void 0:t.topK),n.setFieldValue("scoreThreshold",null==q||null===(s=q.llm)||void 0===s?void 0:s.scoreThreshold),n.setFieldValue("provider",null==q||null===(o=q.llm)||void 0===o?void 0:o.provider),n.setFieldValue("model",null==q||null===(a=q.llm)||void 0===a?void 0:a.model),n.setFieldValue("temperature",null==q||null===(i=q.llm)||void 0===i?void 0:i.temperature),n.setFieldValue("prompt",r(null==q||null===(u=q.llm)||void 0===u?void 0:u.prompt)),n.setFieldValue("contextMsgCount",null==q||null===(l=q.llm)||void 0===l?void 0:l.contextMsgCount)}),[q]),(0,s.useEffect)((function(){var e=function(){var e=u()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid,level:M.whQ},e.next=4,(0,Q.mK)(t);case 4:n=e.sent,console.log("queryLlmProvidersByOrg result:",n),200===n.code?f(n.data.content||[]):R.yw.error(n.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();e()}),[o]);var T=function(){var t=u()(a()().mark((function t(n){var r,s,o,i,u,l,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("TabKeyword handleEnableChange",n),R.yw.loading(e.formatMessage({id:"updating"})),l=P()(P()({},q),{},{serviceSettings:P()(P()({},null==q?void 0:q.serviceSettings),{},{faqUids:null==q||null===(r=q.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==q||null===(s=q.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==q||null===(o=q.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==q||null===(i=q.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==q||null===(u=q.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),llm:P()(P()({},null==q?void 0:q.llm),{},{enabled:n})}),console.log("robotObject:",l),t.next=6,(0,Z.$l)(l);case 6:c=t.sent,console.log("updateRobot response:",c),200===c.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),S(c.data)):(R.yw.destroy(),R.yw.error(c.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),U=function(){var t=u()(a()().mark((function t(n){var r,s,o,i,u,l,c;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSubmit",n),R.yw.loading(e.formatMessage({id:"updating"})),l=P()(P()({},q),{},{serviceSettings:P()(P()({},q.serviceSettings),{},{faqUids:null===(r=q.serviceSettings)||void 0===r||null===(r=r.faqs)||void 0===r?void 0:r.map((function(e){return e.uid})),quickFaqUids:null==q||null===(s=q.serviceSettings)||void 0===s||null===(s=s.quickFaqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==q||null===(o=q.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==q||null===(i=q.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==q||null===(u=q.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),llm:n}),console.log("robotObject:",l),t.next=6,(0,Z.$l)(l);case 6:c=t.sent,console.log("updateRobot response:",c),200===c.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"update.success"})),S(c.data)):(R.yw.destroy(),R.yw.error(c.message));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),V=function(){var e=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("pingOllama"),e.next=3,(0,H.V)();case 3:t=e.sent,console.log("getOllamaServerStatus: ",t),200===t.code&&t.data?O():R.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),e.next=3,(0,H.c)();case 3:t=e.sent,console.log("getOllamaLocalModels: ",t),200===t.code?(b(t.data.map((function(e){return{value:e.name,label:e.name}}))),0===t.data.length?n.setFieldValue("model",void 0):n.setFieldValue("model",t.data[0].name)):R.yw.error(t.message);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var t=u()(a()().mark((function t(r){var s,i,u;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R.yw.loading(e.formatMessage({id:"loading"})),t.prev=1,s={pageNumber:0,pageSize:50,providerUid:r.uid,orgUid:null==o?void 0:o.uid,level:M.whQ},t.next=5,(0,G.LF)(s);case 5:i=t.sent,console.log("queryLlmModelsByOrg response:",i),200===i.code?(u=i.data.content.map((function(e){return{value:e.name,label:e.nickname}})),b(u),0===u.length?n.setFieldValue("model",void 0):n.setFieldValue("model",u[0].value)):R.yw.error(i.message),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Failed to fetch models:",t.t0),R.yw.error(e.formatMessage({id:"error"}));case 14:return t.prev=14,R.yw.destroy(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,10,14,17]])})));return function(e){return t.apply(this,arguments)}}(),E=function(){var e=u()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=p.find((function(e){return e.name===t})),console.log("selectedProvider:",n),null!=n&&n.name&&("ollama"===n.name?V():A(n));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)(k.A,{form:n,size:"large",submitter:{render:function(e,t){return[(0,F.jsx)(g.ZP,{type:"default",onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields()},children:"重置"},"reset"),(0,F.jsx)(g.ZP,{type:"primary",onClick:function(){var t;null===(t=e.form)||void 0===t||t.submit()},children:"保存"},"submit")]},submitButtonProps:{size:"large",htmlType:"button"}},onFinish:U,children:[(0,F.jsx)(K.Z,{width:"lg",name:"enabled",label:"启用大模型",tooltip:"启用大模型后，将会关闭关键词。用户在发送消息时，将会直接请求大模型。",fieldProps:{onChange:T}}),(0,F.jsx)(B.Z,{width:"lg",name:"prompt",label:"提示词",placeholder:"请输入提示词",rules:[{required:!0,message:"请输入提示词"}]}),(0,F.jsx)(j.Z,{width:"lg",name:"provider",label:"AI 供应商",options:p.map((function(e){return{value:e.name,label:r(e.nickname)}})),onChange:E,rules:[{required:!0,message:"请选择 AI 供应商"}]}),(0,F.jsx)(j.Z,{width:"lg",name:"model",label:"大模型",options:h,rules:[{required:!0,message:"请选择大模型"}]}),(0,F.jsx)(D.Z,{width:"lg",label:"温度",name:"temperature",min:0,max:1,fieldProps:{precision:1,step:.1},rules:[{required:!0,message:"请输入温度"}]}),(0,F.jsx)(D.Z,{width:"lg",label:"上下文消息数",name:"contextMsgCount",min:0,max:10,fieldProps:{precision:0,step:1},rules:[{required:!0,message:"请输入上下文消息数"}]})]})})},W=(n(54166),n(75808)),J=n(40836),Y=function(){var e=(0,y.useIntl)(),t=(0,s.useMemo)((function(){return[{key:"kb",label:(0,F.jsx)(y.FormattedMessage,{id:"pages.robot.tab.kb",defaultMessage:"Knowledge Base"}),children:(0,F.jsx)(E,{})},{key:"faq",label:(0,F.jsx)(y.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"FAQ"}),children:(0,F.jsx)(I.Z,{type:M._X4})},{key:"quickFaqs",label:(0,F.jsx)(y.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"Quick Button"}),children:(0,F.jsx)(X.Z,{type:M._X4})},{key:"faqGuess",label:(0,F.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FAQ Guess"}),children:(0,F.jsx)(L.Z,{type:M._X4})},{key:"faqHot",label:(0,F.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FAQ Hot"}),children:(0,F.jsx)(_.Z,{type:M._X4})},{key:"faqShortcut",label:(0,F.jsx)(y.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FAQ Shortcut"}),children:(0,F.jsx)(z.Z,{type:M._X4})},{key:"llm",label:(0,F.jsx)(y.FormattedMessage,{id:"llm",defaultMessage:"LLM"}),children:(0,F.jsx)($,{})},{key:"right",label:(0,F.jsx)(y.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,F.jsx)(J.Z,{type:M._X4})},{key:"popup",label:(0,F.jsx)(y.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,F.jsx)(W.Z,{type:M._X4})},{key:"inputassociation",label:(0,F.jsx)(y.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,F.jsx)(N.Z,{type:M._X4})}]}),[e]);return(0,F.jsx)(U.Z,{tabPosition:"left",items:t})},ee=n(6631),te=n(69957),ne=n(51990),re=n(3909),se=(n(26286),n(65461)),oe=function(){var e,t=k.A.useForm(),n=c()(t,1)[0],r=(0,y.useIntl)(),o=(0,C.Z)().translateString,i=(0,d.V)((function(e){return{currentRobot:e.currentRobot,setCurrentRobot:e.setCurrentRobot}})),l=i.currentRobot,p=i.setCurrentRobot,f=(0,s.useState)(""),m=c()(f,2),h=m[0],b=m[1],w=(0,s.useState)(o(null==l||null===(e=l.serviceSettings)||void 0===e?void 0:e.welcomeTip)||""),x=c()(w,2),M=x[0],j=x[1];(0,s.useEffect)((function(){var e;l&&(n.setFieldValue("nickname",o(null==l?void 0:l.nickname)),j(o(null==l||null===(e=l.serviceSettings)||void 0===e?void 0:e.welcomeTip)),n.setFieldValue("description",o(null==l?void 0:l.description)))}),[l]);var S=function(){var e=u()(a()().mark((function e(t){var n,s,o,i,u,c,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",t),R.yw.loading(r.formatMessage({id:"updating"})),c=P()(P()({},l),{},{serviceSettings:P()(P()({},l.serviceSettings),{},{welcomeTip:M,quickFaqUids:null==l||null===(n=l.serviceSettings)||void 0===n||null===(n=n.quickFaqs)||void 0===n?void 0:n.map((function(e){return e.uid})),faqUids:null==l||null===(s=l.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==l||null===(o=l.serviceSettings)||void 0===o||null===(o=o.guessFaqs)||void 0===o?void 0:o.map((function(e){return e.uid})),hotFaqUids:null==l||null===(i=l.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==l||null===(u=l.serviceSettings)||void 0===u||null===(u=u.shortcutFaqs)||void 0===u?void 0:u.map((function(e){return e.uid}))}),nickname:t.nickname,description:t.description,avatar:h}),console.log("robotObject:",c),e.next=6,(0,Z.$l)(c);case 6:d=e.sent,console.log("updateRobot response:",d),200===d.code?(R.yw.success(r.formatMessage({id:"update.success"})),p(d.data)):R.yw.error(d.message),R.yw.destroy();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){b(null==l?void 0:l.avatar)}),[l]);return(0,F.jsxs)(k.A,{form:n,style:{marginLeft:"20px"},onFinish:S,children:[(0,F.jsx)(re.Z.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return console.log("Upload event:",e),Array.isArray(e)?e:null==e?void 0:e.fileList},label:r.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,F.jsxs)(ee.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),b(e)},onError:function(e){console.log("handleUploadError:",e)},children:[(0,F.jsx)(v.C,{src:h}),(0,F.jsx)(g.ZP,{icon:(0,F.jsx)(te.Z,{}),children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,F.jsx)(q.Z,{width:"md",name:"nickname",label:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),tooltip:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),placeholder:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.title",defaultMessage:"Title"})}]}),(0,F.jsx)(k.A.Item,{name:"welcomeTip",label:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),tooltip:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.welcomeTip",defaultMessage:"welcomeTip"})}],children:(0,F.jsx)(ne.Z,{placeholder:"welcomeTip content..",value:M,toolbarKeys:(0,se.eD)(),style:{height:"200px",width:"600px"},onChange:function(e,t){j(e)}})}),(0,F.jsx)(B.Z,{width:"md",name:"description",label:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),tooltip:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),placeholder:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"}),rules:[{required:!0,message:r.formatMessage({id:"pages.robot.tab.description",defaultMessage:"description"})}]})]})},ae=n(55930),ie=n(82211),ue=n(73170),le=n(9389),ce=function(){var e=(0,y.useIntl)(),t=(0,s.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,F.jsx)(oe,{})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,F.jsx)(Y,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,F.jsx)(ie.Z,{type:M._X4})},{key:"channelsocial",label:e.formatMessage({id:"channelsocial",defaultMessage:"Social Channel"}),children:(0,F.jsx)(le.Z,{type:M._X4})},{key:"channelshop",label:e.formatMessage({id:"channelshop",defaultMessage:"Shop Channel"}),children:(0,F.jsx)(ue.Z,{type:M._X4})},{key:"channelforeign",label:e.formatMessage({id:"channelforeign",defaultMessage:"Foreign Channel"}),children:(0,F.jsx)(ae.Z,{type:M._X4})}]}),[e]);return(0,F.jsx)(U.Z,{defaultActiveKey:"basic",items:t})},de=n(96865),pe=r.Z.Sider,fe=r.Z.Content,ge=function(){var e=(0,de.Z)(),t=e.leftSiderStyle,n=e.leftSiderWidth,s=e.contentStyle;return(0,F.jsxs)(r.Z,{children:[(0,F.jsx)(pe,{width:n,style:t,children:(0,F.jsx)(T,{})}),(0,F.jsx)(r.Z,{children:(0,F.jsx)(fe,{style:s,children:(0,F.jsx)(ce,{})})})]})}}}]);