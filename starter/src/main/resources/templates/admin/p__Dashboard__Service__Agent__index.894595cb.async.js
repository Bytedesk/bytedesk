"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{32863:function(e,n,t){var r=t(17082),s=t(51190),a=t(44194),i=t(39647),o=t(31549),l=["fieldProps","request","params","proFieldProps"],u=function(e,n){var t=e.fieldProps,a=e.request,u=e.params,c=e.proFieldProps,d=(0,s.Z)(e,l);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:t,ref:n,request:a,params:u,filedConfig:{customLightMode:!0},proFieldProps:c},d))},c=a.forwardRef(u);n.Z=c},77849:function(e,n,t){t.d(n,{D$:function(){return f},EP:function(){return b},hS:function(){return p},z_:function(){return d}});var r=t(90819),s=t.n(r),a=t(73193),i=t.n(a),o=t(89933),l=t.n(o),u=t(77667),c=t(82045);function d(e){return g.apply(this,arguments)}function g(){return(g=l()(s()().mark((function e(n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/query/org",{method:"GET",params:i()(i()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=l()(s()().mark((function e(n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/create",{method:"POST",data:i()(i()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=l()(s()().mark((function e(n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/update",{method:"POST",data:i()(i()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return(v=l()(s()().mark((function e(n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/member/delete",{method:"POST",data:i()(i()({},n),{},{client:u.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},32731:function(e,n,t){t.r(n),t.d(n,{default:function(){return ge}});var r=t(64476),s=t(44194),a=t(50571),i=t(82045),o=t(90819),l=t.n(o),u=t(73193),c=t.n(u),d=t(89933),g=t.n(d),f=t(45332),m=t.n(f),p=t(89756),h=t(81153),b=t(1780),v=t(85702),x=t(77667),y=t(39701),M=t(83642),j=t(41617),k=(0,y.Ue)()((0,M.mW)((0,M.tJ)((0,j.n)((function(e,n){return{memberResult:{data:{content:[],totalElements:0}},insertMember:function(n){e((function(e){e.memberResult.data.content.unshift(n)}))},updateMember:function(n){e((function(e){var t=e.memberResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Member with uid ".concat(n.uid," not found."))}))},deleteMember:function(n){e((function(e){var t=e.memberResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Member with uid ".concat(n.uid," not found."))}))},setMemberResult:function(n){e({memberResult:n})},deleteMemberCache:function(){return e({},!0)}}})),{name:x.PQL}))),w=t(92349),Z=t(69957),q=t(5728),F=t(43688),S=t(11607),A=t(21276),C=t(12265),P=t(31549),R=function(){var e=q.A.useForm(),n=m()(e,1)[0],t=(0,i.useIntl)(),r=(0,b.Z)().translateString,a=(k((function(e){return e.memberResult})),(0,v.E)((function(e){return{currentAgent:e.currentAgent,setCurrentAgent:e.setCurrentAgent}}))),o=a.currentAgent,u=a.setCurrentAgent,d=(0,s.useState)(""),f=m()(d,2),x=f[0],y=f[1];(0,s.useEffect)((function(){var e;o&&n.setFieldsValue({nickname:r(null==o?void 0:o.nickname),email:null==o?void 0:o.email,mobile:null==o?void 0:o.mobile,description:r(null==o?void 0:o.description),memberUid:null==o||null===(e=o.member)||void 0===e?void 0:e.uid})}),[o]);var M=function(){var e=g()(l()().mark((function e(n){var r,s,a,i,d,g,f,m,b;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onFinish:",n),p.yw.loading(t.formatMessage({id:"updating"})),m=c()(c()(c()({},o),n),{},{avatar:x,serviceSettings:c()(c()({},o.serviceSettings),{},{quickFaqUids:null==o||null===(r=o.serviceSettings)||void 0===r||null===(r=r.quickFaqs)||void 0===r?void 0:r.map((function(e){return e.uid})),faqUids:null==o||null===(s=o.serviceSettings)||void 0===s||null===(s=s.faqs)||void 0===s?void 0:s.map((function(e){return e.uid})),guessFaqUids:null==o||null===(a=o.serviceSettings)||void 0===a||null===(a=a.guessFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})),hotFaqUids:null==o||null===(i=o.serviceSettings)||void 0===i||null===(i=i.hotFaqs)||void 0===i?void 0:i.map((function(e){return e.uid})),shortcutFaqUids:null==o||null===(d=o.serviceSettings)||void 0===d||null===(d=d.shortcutFaqs)||void 0===d?void 0:d.map((function(e){return e.uid}))}),robotSettings:c()(c()({},o.robotSettings),{},{robotUid:null===(g=o.robotSettings)||void 0===g||null===(g=g.robot)||void 0===g?void 0:g.uid}),leaveMsgSettings:c()(c()({},o.leaveMsgSettings),{},{worktimeUids:null==o||null===(f=o.leaveMsgSettings)||void 0===f||null===(f=f.worktimes)||void 0===f?void 0:f.map((function(e){return e.uid}))})}),console.log("agentObject:",m),e.next=6,(0,h.sE)(m);case 6:b=e.sent,console.log("updateAgent response:",b),200===b.code?(p.yw.destroy(),p.yw.success(t.formatMessage({id:"update.success"})),u(b.data)):(p.yw.destroy(),p.yw.error(b.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e;o&&(y(o.avatar),n.setFieldsValue({member:null==o||null===(e=o.member)||void 0===e?void 0:e.nickname}))}),[o]),(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(q.A,{form:n,style:{marginLeft:"20px"},onFinish:M,children:[(0,P.jsx)(q.A.Item,{name:"avatar",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:t.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,P.jsxs)(w.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),y(e)},onError:function(e){console.log("handleUploadError:",e),p.yw.error(e)},children:[(0,P.jsx)(A.C,{src:x}),(0,P.jsx)(C.ZP,{icon:(0,P.jsx)(Z.Z,{}),children:t.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,P.jsx)(F.Z,{width:"md",name:"nickname",label:t.formatMessage({id:"agent.info.nickname"}),rules:[{required:!0,message:t.formatMessage({id:"agent.info.nickname.required"})}]}),(0,P.jsx)(F.Z,{width:"md",name:"email",label:t.formatMessage({id:"agent.info.email"}),rules:[{required:!0,message:t.formatMessage({id:"agent.info.email.required"})}]}),(0,P.jsx)(F.Z,{width:"md",name:"mobile",label:t.formatMessage({id:"agent.info.mobile"}),rules:[{required:!0,message:t.formatMessage({id:"agent.info.mobile.required"})}]}),(0,P.jsx)(S.Z,{width:"md",name:"description",label:t.formatMessage({id:"agent.info.description"}),rules:[{required:!0,message:t.formatMessage({id:"agent.info.description.required"})}]}),(0,P.jsx)(F.Z,{width:"md",name:"member",label:t.formatMessage({id:"agent.info.member"}),disabled:!0})]})})},U=t(93982),N=t(89875),V=t(18874),E=t(66772),I=t(90588),L=t(10187),O=t(9750),T=(t(13253),t(28243),t(16655)),z=t(64859),D=t(34890),G=t(26469),B=function(){var e=(0,i.useIntl)(),n=(0,s.useMemo)((function(){return!1}),[]),t=(0,s.useMemo)((function(){return[{key:"faq",label:(0,P.jsx)(i.FormattedMessage,{id:"menu.knowledge.faq",defaultMessage:"FAQ"}),children:(0,P.jsx)(N.Z,{type:x.Njn}),disabled:n},{key:"quickFaqs",label:(0,P.jsx)(i.FormattedMessage,{id:"menu.knowledge.quickbutton",defaultMessage:"QuickButton"}),children:(0,P.jsx)(I.Z,{type:x.Njn}),disabled:n},{key:"faqGuess",label:(0,P.jsx)(i.FormattedMessage,{id:"menu.knowledge.faqGuess",defaultMessage:"FaqGuess"}),children:(0,P.jsx)(L.Z,{type:x.Njn}),disabled:n},{key:"faqHot",label:(0,P.jsx)(i.FormattedMessage,{id:"menu.knowledge.faqHot",defaultMessage:"FaqHot"}),children:(0,P.jsx)(V.Z,{type:x.Njn}),disabled:n},{key:"faqShortcut",label:(0,P.jsx)(i.FormattedMessage,{id:"menu.knowledge.faqShortcut",defaultMessage:"FaqShortcut"}),children:(0,P.jsx)(E.Z,{type:x.Njn}),disabled:n},{key:"rate",label:(0,P.jsx)(i.FormattedMessage,{id:"rate",defaultMessage:"Rate"}),children:(0,P.jsx)(O.Z,{type:x.Njn}),disabled:n},{key:"right",label:(0,P.jsx)(i.FormattedMessage,{id:"right",defaultMessage:"Right"}),children:(0,P.jsx)(G.Z,{type:x.Njn})},{key:"popup",label:(0,P.jsx)(i.FormattedMessage,{id:"popup",defaultMessage:"Popup"}),children:(0,P.jsx)(D.Z,{type:x.Njn})},{key:"inputassociation",label:(0,P.jsx)(i.FormattedMessage,{id:"inputassociation",defaultMessage:"Input Association"}),children:(0,P.jsx)(z.Z,{type:x.Njn}),disabled:n}]}),[e,n]);return(0,P.jsxs)(P.Fragment,{children:[n&&(0,P.jsx)(U.Z,{message:"企业版-高级功能",style:{marginBottom:20},type:"warning",action:(0,P.jsx)(C.ZP,{type:"link",icon:(0,P.jsx)(T.Z,{}),onClick:function(){return window.open(x.VPj)},children:e.formatMessage({id:"setting.helpcenter"})})}),(0,P.jsx)(a.Z,{tabPosition:"left",items:t})]})},_=t(82639),H=t(36360),Q=t(2561),W=t(61562),$=t(3321),J=function(){var e=(0,i.useIntl)(),n=(0,s.useMemo)((function(){return[{key:"basic",label:e.formatMessage({id:"pages.robot.tab.basic",defaultMessage:"Basic"}),children:(0,P.jsx)(R,{})},{key:"serviceSettings",label:e.formatMessage({id:"pages.agent.service.settings",defaultMessage:"Service Settings"}),children:(0,P.jsx)($.Z,{type:x.Njn})},{key:"advanced",label:e.formatMessage({id:"pages.robot.tab.advanced",defaultMessage:"Advanced"}),children:(0,P.jsx)(B,{})},{key:"channel",label:e.formatMessage({id:"pages.robot.tab.channel",defaultMessage:"Channel"}),children:(0,P.jsx)(_.Z,{type:x.Njn})},{key:"channelsocial",label:e.formatMessage({id:"channelsocial",defaultMessage:"Social Channel"}),children:(0,P.jsx)(H.Z,{type:x.Njn})},{key:"channelshop",label:e.formatMessage({id:"channelshop",defaultMessage:"Shop Channel"}),children:(0,P.jsx)(W.Z,{type:x.Njn})},{key:"channelforeign",label:e.formatMessage({id:"channelforeign",defaultMessage:"Foreign Channel"}),children:(0,P.jsx)(Q.Z,{type:x.Njn})}]}),[e]);return(0,P.jsx)(a.Z,{defaultActiveKey:"basic",items:n})},K=t(74145),X=t(40431),Y=t(50484),ee=t(70458),ne=t(83730),te=t(80093),re=t(90136),se=t(66765),ae=t(32863),ie=function(e){var n=e.open,t=e.onClose,r=e.onSubmit,a=se.ZP.useForm(),i=m()(a,1)[0],o=(0,X.u)((function(e){return e.currentOrg})),l=k((function(e){return e.memberResult})),u=(0,s.useMemo)((function(){for(var e,n,t=[],r=0;r<l.data.content.length;r++){var s={title:"",value:"",children:[]};e=l.data.content[r],(n=s).title=e.nickname,n.value=e.uid,t.push(s)}return t}),[l]);return(0,P.jsx)("div",{children:(0,P.jsx)(ne.Z,{title:"创建客服",open:n,forceRender:!0,onOk:function(){console.log("handleOk"),i.validateFields().then((function(e){console.log("form values:",e);var n={nickname:i.getFieldValue("nickname"),email:i.getFieldValue("email"),mobile:i.getFieldValue("mobile"),memberUid:i.getFieldValue("memberUid"),orgUid:o.uid};console.log("agent:",n),r(n)})).catch((function(e){console.log("Form errors:",e)}))},onCancel:function(){console.log("handleCancel"),t()},children:(0,P.jsxs)(se.ZP,{form:i,name:"agentForm",style:{maxWidth:400},submitter:!1,children:[(0,P.jsx)(ae.Z,{label:"绑定成员",name:"memberUid",tooltip:"请先到组织-》成员-》创建成员",rules:[{required:!0,message:"请选择成员!"}],fieldProps:{multiple:!1,treeDefaultExpandAll:!0,placeholder:"请选择成员",onChange:function(e){console.log("onTreeSelectChange:",e);for(var n=0;n<l.data.content.length;n++){var t=l.data.content[n];t.uid===e&&(console.log("element:",t),i.setFieldsValue({nickname:t.nickname}),i.setFieldsValue({email:t.email}),i.setFieldsValue({mobile:t.mobile}))}},treeData:u,variant:"outlined"}}),(0,P.jsx)(F.Z,{label:"昵称",name:"nickname",rules:[{required:!0,message:"请输入昵称!"}]}),(0,P.jsx)(F.Z,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱!"},{type:"email",message:"请输入正确的邮箱地址"}]}),(0,P.jsx)(F.Z,{label:"手机号",name:"mobile",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}]})]})})})},oe=t(77849),le=function(){var e=(0,i.useIntl)(),n=(0,s.useRef)(!1),t=(0,b.Z)(),r=t.translateString,a=t.translateStringTranct,o=(0,K.Z)().isDarkMode,u=(0,s.useState)(!1),c=m()(u,2),d=c[0],f=c[1],y=(0,X.u)((function(e){return e.currentOrg})),M=k((function(e){return e.setMemberResult})),j=(0,v.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,insertAgent:e.insertAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent,deleteCurrentAgent:e.deleteCurrentAgent}})),w=j.agentResult,Z=j.currentAgent,q=j.insertAgent,F=j.setAgentResult,S=j.setCurrentAgent,R=j.deleteCurrentAgent,U=ne.Z.useModal(),N=m()(U,2),V=N[0],E=N[1],I=function(){var n=g()(l()().mark((function n(t){var r;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete agent",t),p.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,(0,h.Lr)(t);case 4:r=n.sent,console.log("delete agent response",r),200===r.code?(p.yw.destroy(),p.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),R(t.uid)):(p.yw.destroy(),p.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),L=function(){var e=g()(l()().mark((function e(){var t,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,p.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:y.uid},e.next=8,(0,h._t)(t);case 8:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(p.yw.destroy(),F(r)):(p.yw.destroy(),p.yw.error(a(r.message))),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=g()(l()().mark((function e(){var n,t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={pageNumber:0,pageSize:50,orgUid:y.uid},e.next=3,(0,oe.z_)(n);case 3:t=e.sent,console.log("queryAllMembers:",n,t),200===t.code?M(t):p.yw.error(a(t.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){L(),O()}),[]);var T=function(){var n=g()(l()().mark((function n(t){var r;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("save agent"),p.yw.loading(e.formatMessage({id:"creating",defaultMessage:"Creating"})),n.next=4,(0,h.x_)(t);case 4:r=n.sent,console.log("create agent:",r),200===r.code?(p.yw.destroy(),p.yw.success(e.formatMessage({id:"create.success"})),q(r.data),f(!1)):(p.yw.destroy(),p.yw.error(a(r.message)));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(te.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,P.jsx)(C.ZP,{size:"small",type:"primary",icon:(0,P.jsx)(ee.Z,{}),onClick:function(){f(!0)},children:e.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,P.jsx)(C.ZP,{size:"small",onClick:L,children:e.formatMessage({id:"refresh",defaultMessage:"Refresh"})}),(0,P.jsx)(C.ZP,{onClick:function(){return function(n){V.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(Y.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(n.nickname),"】？"),onOk:function(){I(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(Z)},size:"small",danger:!0,disabled:""===(null==Z?void 0:Z.uid),children:e.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]}),(0,P.jsx)(re.Z,{itemLayout:"horizontal",dataSource:w.data.content,renderItem:function(n,t){return(0,P.jsx)(re.Z.Item,{style:Z.uid===n.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){S(n)},children:(0,P.jsx)(re.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,P.jsx)(A.C,{src:n.avatar}),title:(0,P.jsx)(P.Fragment,{children:a(n.nickname)}),description:(r=n,(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)("span",{style:{color:"#999999",fontSize:12},children:[r.status===x.Ra4&&"[😀-".concat(e.formatMessage({id:"agent.status.online"}),"]"),r.status===x.LZ1&&"[🔻-".concat(e.formatMessage({id:"agent.status.offline"}),"]"),r.status===x.tU$&&"[🏃‍♀️-".concat(e.formatMessage({id:"agent.status.busy"}),"]"),r.connected?" ✅".concat(e.formatMessage({id:"agent.connection.success"})):" ❌".concat(e.formatMessage({id:"agent.connection.failed"}))]})}))})},n.uid);var r}}),d&&(0,P.jsx)(ie,{open:d,onClose:function(){f(!1)},onSubmit:T}),E]})},ue=t(93139),ce=r.Z.Sider,de=r.Z.Content,ge=function(){var e=(0,ue.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth;return(0,s.useEffect)((function(){}),[]),(0,P.jsxs)(r.Z,{children:[(0,P.jsx)(ce,{width:t,style:n,children:(0,P.jsx)(le,{})}),(0,P.jsx)(r.Z,{children:(0,P.jsx)(de,{children:(0,P.jsx)(J,{})})})]})}}}]);