<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åé¦ˆæœåŠ¡æµ‹è¯•é¡µé¢ - å·²ä¿®å¤</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .feedback-container {
            background: #f5f7fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
            text-align: center;
        }
        .feedback-button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }
        .feedback-button:hover {
            background: #1565c0;
        }
        .feedback-button.negative {
            background: #d32f2f;
        }
        .feedback-button.negative:hover {
            background: #c62828;
        }
        .comment-section {
            margin-top: 1rem;
            text-align: left;
        }
        .comment-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }
        .comment-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .submit-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .cancel-button {
            background: #757575;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .thank-you {
            color: #4caf50;
            font-weight: bold;
        }
        .status {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <h1>Bytedesk æ–‡æ¡£åé¦ˆç³»ç»Ÿæµ‹è¯•</h1>
    
    <p>è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•é¡µé¢ï¼Œç”¨äºéªŒè¯åé¦ˆç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
    
    <div class="status" id="status">
        çŠ¶æ€ï¼šå‡†å¤‡å°±ç»ª
    </div>

    <div class="feedback-container" id="feedbackContainer">
        <p>è¿™é¡µæ–‡æ¡£å¯¹æ‚¨æœ‰å¸®åŠ©å—ï¼Ÿ</p>
        <button class="feedback-button" onclick="handleFeedback('positive')">
            æœ‰å¸®åŠ© ğŸ‘
        </button>
        <button class="feedback-button negative" onclick="handleFeedback('negative')">
            éœ€æ”¹è¿› ğŸ‘
        </button>
        
        <div class="comment-section" id="commentSection" style="display: none;">
            <textarea 
                class="comment-input" 
                id="commentInput" 
                placeholder="è¯·å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•æ”¹è¿›è¿™ç¯‡æ–‡æ¡£..."></textarea>
            <div class="comment-actions">
                <button class="submit-button" onclick="submitFeedback()">æäº¤</button>
                <button class="cancel-button" onclick="cancelFeedback()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <h2>æœ¬åœ°å­˜å‚¨çš„åé¦ˆæ•°æ®</h2>
    <div class="status">
        <button onclick="loadFeedbacks()">åˆ·æ–°æ•°æ®</button>
        <button onclick="clearFeedbacks()">æ¸…é™¤æ•°æ®</button>
        <button onclick="exportFeedbacks()">å¯¼å‡ºJSON</button>
        <button onclick="exportCSV()">å¯¼å‡ºCSV</button>
    </div>
    <div id="feedbackList"></div>

    <script>
        // æ¨¡æ‹Ÿåé¦ˆæœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½
        class TestFeedbackService {
            constructor() {
                this.storageKey = 'doc_feedbacks';
            }

            async submitFeedback(data) {
                console.log('æäº¤åé¦ˆæ•°æ®:', data);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const existingFeedbacks = JSON.parse(localStorage.getItem(this.storageKey) || '[]');
                existingFeedbacks.push(data);
                
                // åªä¿ç•™æœ€è¿‘100æ¡
                if (existingFeedbacks.length > 100) {
                    existingFeedbacks.splice(0, existingFeedbacks.length - 100);
                }
                
                localStorage.setItem(this.storageKey, JSON.stringify(existingFeedbacks));
                
                // æ¨¡æ‹Ÿå…¶ä»–æœåŠ¡è°ƒç”¨
                this.mockGoogleAnalytics(data);
                this.mockFormspree(data);
                
                return Promise.resolve();
            }

            mockGoogleAnalytics(data) {
                console.log('ğŸ“Š Google Analytics:', {
                    event: 'feedback_submit',
                    category: 'documentation',
                    label: data.type,
                    value: data.type === 'positive' ? 1 : 0
                });
            }

            mockFormspree(data) {
                console.log('ğŸ“§ Formspree:', {
                    subject: `æ–‡æ¡£åé¦ˆ - ${data.type}`,
                    message: data.comment,
                    url: data.url
                });
            }

            getLocalFeedbacks() {
                return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
            }

            clearLocalFeedbacks() {
                localStorage.removeItem(this.storageKey);
            }

            exportAsJSON() {
                const feedbacks = this.getLocalFeedbacks();
                return JSON.stringify(feedbacks, null, 2);
            }

            exportAsCSV() {
                const feedbacks = this.getLocalFeedbacks();
                if (feedbacks.length === 0) return '';

                const headers = ['ç±»å‹', 'è¯„è®º', 'URL', 'æ—¶é—´', 'ç”¨æˆ·ä»£ç†', 'æ–‡æ¡£æ ‡é¢˜'];
                const csvRows = [headers.join(',')];

                feedbacks.forEach(feedback => {
                    const row = [
                        feedback.type,
                        `"${feedback.comment.replace(/"/g, '""')}"`,
                        feedback.url,
                        feedback.timestamp,
                        `"${feedback.userAgent.replace(/"/g, '""')}"`,
                        feedback.docTitle || ''
                    ];
                    csvRows.push(row.join(','));
                });

                return csvRows.join('\n');
            }
        }

        const feedbackService = new TestFeedbackService();
        let currentFeedbackType = null;

        function updateStatus(message) {
            document.getElementById('status').textContent = `çŠ¶æ€ï¼š${message}`;
        }

        function handleFeedback(type) {
            currentFeedbackType = type;
            updateStatus(`é€‰æ‹©äº† ${type === 'positive' ? 'æ­£é¢' : 'è´Ÿé¢'} åé¦ˆ`);
            
            if (type === 'positive') {
                submitFeedbackData(type, '');
            } else {
                document.getElementById('commentSection').style.display = 'block';
            }
        }

        function submitFeedback() {
            const comment = document.getElementById('commentInput').value;
            submitFeedbackData(currentFeedbackType, comment);
        }

        function cancelFeedback() {
            currentFeedbackType = null;
            document.getElementById('commentSection').style.display = 'none';
            document.getElementById('commentInput').value = '';
            updateStatus('å·²å–æ¶ˆåé¦ˆ');
        }

        async function submitFeedbackData(type, comment) {
            const feedbackData = {
                type: type,
                comment: comment,
                url: window.location.href,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                docTitle: document.title
            };

            try {
                await feedbackService.submitFeedback(feedbackData);
                
                // æ˜¾ç¤ºæ„Ÿè°¢ä¿¡æ¯
                document.getElementById('feedbackContainer').innerHTML = 
                    '<p class="thank-you">è°¢è°¢æ‚¨çš„åé¦ˆï¼æ‚¨çš„æ„è§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚</p>';
                
                updateStatus('åé¦ˆæäº¤æˆåŠŸ');
                
                // è‡ªåŠ¨åˆ·æ–°åé¦ˆåˆ—è¡¨
                setTimeout(() => {
                    loadFeedbacks();
                }, 500);
                
            } catch (error) {
                console.error('æäº¤åé¦ˆå¤±è´¥:', error);
                updateStatus('åé¦ˆæäº¤å¤±è´¥');
            }
        }

        function loadFeedbacks() {
            const feedbacks = feedbackService.getLocalFeedbacks();
            const feedbackList = document.getElementById('feedbackList');
            
            if (feedbacks.length === 0) {
                feedbackList.innerHTML = '<p>æš‚æ— åé¦ˆæ•°æ®</p>';
                return;
            }

            let html = '<h3>åé¦ˆå†å²è®°å½•</h3>';
            html += `<p>æ€»è®¡ï¼š${feedbacks.length} æ¡åé¦ˆ</p>`;
            html += '<div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 1rem;">';
            
            feedbacks.reverse().forEach((feedback, index) => {
                html += `
                    <div style="border-bottom: 1px solid #eee; padding: 1rem 0;">
                        <strong>${feedback.type === 'positive' ? 'ğŸ‘ æ­£é¢' : 'ğŸ‘ è´Ÿé¢'}</strong>
                        <span style="color: #666; margin-left: 1rem;">
                            ${new Date(feedback.timestamp).toLocaleString()}
                        </span>
                        ${feedback.comment ? `<p style="margin: 0.5rem 0; color: #333;">"${feedback.comment}"</p>` : ''}
                        <small style="color: #888;">URL: ${feedback.url}</small>
                    </div>
                `;
            });
            
            html += '</div>';
            feedbackList.innerHTML = html;
            updateStatus(`å·²åŠ è½½ ${feedbacks.length} æ¡åé¦ˆè®°å½•`);
        }

        function clearFeedbacks() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰åé¦ˆæ•°æ®å—ï¼Ÿ')) {
                feedbackService.clearLocalFeedbacks();
                loadFeedbacks();
                updateStatus('åé¦ˆæ•°æ®å·²æ¸…é™¤');
            }
        }

        function exportFeedbacks() {
            const data = feedbackService.exportAsJSON();
            downloadFile('feedback-data.json', data, 'application/json');
            updateStatus('å·²å¯¼å‡ºJSONæ–‡ä»¶');
        }

        function exportCSV() {
            const data = feedbackService.exportAsCSV();
            if (data) {
                downloadFile('feedback-data.csv', data, 'text/csv');
                updateStatus('å·²å¯¼å‡ºCSVæ–‡ä»¶');
            } else {
                updateStatus('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
            }
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½åé¦ˆæ•°æ®
        window.onload = function() {
            loadFeedbacks();
            updateStatus('é¡µé¢å·²åŠ è½½ï¼Œåé¦ˆç³»ç»Ÿå°±ç»ª');
        };
    </script>
</body>
</html>
