"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8989],{19971:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>o});var t=n(30758);const a={},r=t.createContext(a);function i(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:s},e.children)}},36677:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/unread_count_uid-d690758958872f7df7c4a384a40b022d.png"},61563:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"development/message_unread_visitor","title":"Unread Message Count Integration","description":"This page introduces how to integrate the unread message count functionality of the Weiyu customer service system into your application, displaying the number of unread customer service messages for users in real-time, helping to improve user experience and message read rates.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/development/message_unread_visitor.md","sourceDirName":"development","slug":"/development/message_unread_visitor","permalink":"/docs/docs/development/message_unread_visitor","draft":false,"unlisted":false,"editUrl":"https://github.com/bytedesk/bytedesk-docs/blob/main/docs/development/message_unread_visitor.md","tags":[],"version":"current","lastUpdatedBy":"jack ning","lastUpdatedAt":1761279339000,"sidebarPosition":13,"frontMatter":{"sidebar_label":"Unread Messages","sidebar_position":13},"sidebar":"tutorialSidebar","previous":{"title":"UnreadCount","permalink":"/docs/docs/development/message_unread"},"next":{"title":"Text to Speech","permalink":"/docs/docs/development/tts"}}');var a=n(86070),r=n(19971);const i={sidebar_label:"Unread Messages",sidebar_position:13},o="Unread Message Count Integration",d={},c=[{value:"Why is Unread Message Count Integration Needed?",id:"why-is-unread-message-count-integration-needed",level:2},{value:"Unread Message Count Functionality Implementation",id:"unread-message-count-functionality-implementation",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"1. Get Unread Message Count",id:"1-get-unread-message-count",level:4},{value:"2. Mark All Messages as Read",id:"2-mark-all-messages-as-read",level:4},{value:"API Reference",id:"api-reference",level:2},{value:"1. getUnreadMessageCount()",id:"1-getunreadmessagecount",level:3},{value:"2. clearUnreadMessages()",id:"2-clearunreadmessages",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Unread Message Count Display",id:"1-unread-message-count-display",level:3},{value:"2. User Experience Optimization",id:"2-user-experience-optimization",level:3},{value:"3. Performance Considerations",id:"3-performance-considerations",level:3},{value:"Common Questions",id:"common-questions",level:2},{value:"Q1: Unread message count doesn&#39;t update automatically, how to solve?",id:"q1-unread-message-count-doesnt-update-automatically-how-to-solve",level:3},{value:"Q2: How to synchronize unread message status between multiple tabs?",id:"q2-how-to-synchronize-unread-message-status-between-multiple-tabs",level:3},{value:"Q3: Can I get unread message count for specific sessions?",id:"q3-can-i-get-unread-message-count-for-specific-sessions",level:3},{value:"Q4: What to do if unread message count display is abnormal?",id:"q4-what-to-do-if-unread-message-count-display-is-abnormal",level:3},{value:"Q5: How to use pure API to get visitor&#39;s unread message count?",id:"q5-how-to-use-pure-api-to-get-visitors-unread-message-count",level:3},{value:"Q6: How to pull unread message list from Weiyu customer service system visitor end?",id:"q6-how-to-pull-unread-message-list-from-weiyu-customer-service-system-visitor-end",level:3},{value:"Summary",id:"summary",level:2}];function l(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"unread-message-count-integration",children:"Unread Message Count Integration"})}),"\n",(0,a.jsx)(s.p,{children:"This page introduces how to integrate the unread message count functionality of the Weiyu customer service system into your application, displaying the number of unread customer service messages for users in real-time, helping to improve user experience and message read rates."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Demo link: ",(0,a.jsx)(s.a,{href:"https://weiyuai.cn/reactdemo",children:"Unread Message Count Integration Demo"})]}),"\n"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Demo code:"}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://github.com/Bytedesk/bytedesk-web/blob/master/examples/react-demo/src/pages/unreadCountDemo.tsx",children:"Unread Message Count Integration Example - React"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://github.com/Bytedesk/bytedesk-web/blob/master/examples/vue-demo/src/pages/unreadCountDemo.vue",children:"Unread Message Count Integration Example - Vue"})}),"\n"]}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsxs)(s.p,{children:["Note: Please ensure you have completed the basic functionality integration in the ",(0,a.jsx)(s.a,{href:"/docs/docs/channel/react",children:"React Integration Guide"})," or ",(0,a.jsx)(s.a,{href:"/docs/docs/channel/vue",children:"Vue Integration Guide"})," before proceeding with unread message count integration."]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Unread Message Count Integration Example",src:n(76118).A+"",width:"3322",height:"1470"})}),"\n",(0,a.jsx)(s.h2,{id:"why-is-unread-message-count-integration-needed",children:"Why is Unread Message Count Integration Needed?"}),"\n",(0,a.jsx)(s.p,{children:"In modern applications, displaying unread message counts in real-time is an important feature for improving user experience. It can:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Remind users of new customer service messages that need to be viewed"}),"\n",(0,a.jsx)(s.li,{children:"Increase the likelihood of users replying to messages, improving communication efficiency"}),"\n",(0,a.jsx)(s.li,{children:"Reduce the chance of users missing important messages"}),"\n",(0,a.jsx)(s.li,{children:"Enhance the professionalism and completeness of the application"}),"\n",(0,a.jsx)(s.li,{children:"Provide users with better message management experience"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"unread-message-count-functionality-implementation",children:"Unread Message Count Functionality Implementation"}),"\n",(0,a.jsx)(s.p,{children:"The Weiyu customer service system provides simple and easy-to-use APIs to obtain and manage unread message counts, mainly including three core methods:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"getUnreadMessageCount()"}),": Get current unread message count"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"clearUnreadMessages()"}),": Mark all messages as read"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,a.jsx)(s.h4,{id:"1-get-unread-message-count",children:"1. Get Unread Message Count"}),"\n",(0,a.jsxs)(s.p,{children:["You can use the ",(0,a.jsx)(s.code,{children:"getUnreadMessageCount()"})," method to get the current user's unread message count at any time:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"// Get unread message count\nwindow.bytedesk?.getUnreadMessageCount().then((count) => {\n  console.log('Current unread message count:', count);\n  // Update your UI display\n  setUnreadCount(count);\n});\n"})}),"\n",(0,a.jsx)(s.h4,{id:"2-mark-all-messages-as-read",children:"2. Mark All Messages as Read"}),"\n",(0,a.jsxs)(s.p,{children:["When users have viewed all messages, or when you need to manually reset the unread message count, you can use the ",(0,a.jsx)(s.code,{children:"clearUnreadMessages()"})," method:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"// Mark all messages as read\nwindow.bytedesk?.clearUnreadMessages().then((count) => {\n  console.log('All messages marked as read:', count);\n  // Update UI display\n  // setUnreadCount(0);\n});\n"})}),"\n",(0,a.jsx)(s.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,a.jsx)(s.h3,{id:"1-getunreadmessagecount",children:"1. getUnreadMessageCount()"}),"\n",(0,a.jsx)(s.p,{children:"Get the total number of unread messages for the current user."}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Return value"}),": Promise<number> - Unread message count"]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Example"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"window.bytedesk?.getUnreadMessageCount().then((count) => {\n  console.log('Current unread message count:', count);\n});\n"})}),"\n",(0,a.jsx)(s.h3,{id:"2-clearunreadmessages",children:"2. clearUnreadMessages()"}),"\n",(0,a.jsx)(s.p,{children:"Mark all messages as read, reset unread count to 0."}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Return value"}),": Promise<number> - Unread message count after reset (should be 0)"]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Example"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"window.bytedesk?.clearUnreadMessages().then((count) => {\n  console.log('All messages marked as read, current unread count:', count);\n});\n"})}),"\n",(0,a.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(s.h3,{id:"1-unread-message-count-display",children:"1. Unread Message Count Display"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Appropriate Position"}),": Display unread count in navigation bar, tabs, or fixed position"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Eye-catching Style"}),": Use red or other eye-catching colors to display unread count"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Number Limit"}),': When unread count exceeds a certain number (e.g., 99), display as "99+"']}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Auto Refresh"}),": Regularly auto-refresh unread count (recommended interval not less than 30 seconds)"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"2-user-experience-optimization",children:"2. User Experience Optimization"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Instant Update"}),": When users open chat window and read messages, update unread count promptly"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Notification Reminders"}),": Combine with browser notification API to send new message notifications when users allow"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Sound Alerts"}),": Add sound alerts for important messages (consider user preference settings)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Custom Control"}),": Allow users to control whether to display unread count and notification methods"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"3-performance-considerations",children:"3. Performance Considerations"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Avoid Frequent Queries"}),": Don't call API too frequently to check unread message count"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Caching Strategy"}),": Cache unread count appropriately to reduce request frequency"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Error Handling"}),": Handle API request failures properly to avoid affecting user experience"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"common-questions",children:"Common Questions"}),"\n",(0,a.jsx)(s.h3,{id:"q1-unread-message-count-doesnt-update-automatically-how-to-solve",children:"Q1: Unread message count doesn't update automatically, how to solve?"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"A"}),": Currently, unread message count needs to be obtained manually by calling API. You can:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Get unread message count once when application initializes"}),"\n",(0,a.jsx)(s.li,{children:"Set timer to refresh regularly (e.g., every 1-5 minutes)"}),"\n",(0,a.jsx)(s.li,{children:"Get once each when users open chat window and before closing chat window"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"q2-how-to-synchronize-unread-message-status-between-multiple-tabs",children:"Q2: How to synchronize unread message status between multiple tabs?"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"A"}),": For multi-tab scenarios, you can:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Use LocalStorage event mechanism for communication between tabs"}),"\n",(0,a.jsx)(s.li,{children:"Each tab independently gets latest unread message count regularly"}),"\n",(0,a.jsxs)(s.li,{children:["When one tab calls ",(0,a.jsx)(s.code,{children:"clearUnreadMessages()"})," method, notify other tabs to update status through LocalStorage"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Example code:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"// Broadcast to other tabs after marking as read\nwindow.bytedesk?.clearUnreadMessages().then(() => {\n  localStorage.setItem('bytedesk_unread_update', Date.now().toString());\n});\n\n// Listen for changes in other tabs\nwindow.addEventListener('storage', (e) => {\n  if (e.key === 'bytedesk_unread_update') {\n    window.bytedesk?.getUnreadMessageCount().then((count) => {\n      setUnreadCount(count);\n    });\n  }\n});\n"})}),"\n",(0,a.jsx)(s.h3,{id:"q3-can-i-get-unread-message-count-for-specific-sessions",children:"Q3: Can I get unread message count for specific sessions?"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"A"}),": Current version API mainly provides total unread message count. For more granular control, it's recommended:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Use ",(0,a.jsx)(s.code,{children:"getUnreadMessageCount()"})," to get total unread count"]}),"\n",(0,a.jsx)(s.li,{children:"Record user's reading status for specific sessions in your application"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"q4-what-to-do-if-unread-message-count-display-is-abnormal",children:"Q4: What to do if unread message count display is abnormal?"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"A"}),": If you encounter abnormal unread message count display, try the following solutions:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Confirm your application connects normally with Weiyu customer service system"}),"\n",(0,a.jsx)(s.li,{children:"Check if user login status is consistent"}),"\n",(0,a.jsxs)(s.li,{children:["Manually call ",(0,a.jsx)(s.code,{children:"getUnreadMessageCount()"})," to refresh count"]}),"\n",(0,a.jsxs)(s.li,{children:["If necessary, call ",(0,a.jsx)(s.code,{children:"clearUnreadMessages()"})," to reset count"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"q5-how-to-use-pure-api-to-get-visitors-unread-message-count",children:"Q5: How to use pure API to get visitor's unread message count?"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"First get current visitor uid, you can get visitor information from localStorage.getItem('VISITOR_STORE'), parse currentVisitor from json and get uid"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:"// Get visitor information\nconst visitorInfo = localStorage.getItem('VISITOR_STORE');\nconst currentVisitor = JSON.parse(visitorInfo).state.currentVisitor;\nconst uid = currentVisitor.uid; // Get visitor uid\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Get Visitor UID",src:n(36677).A+"",width:"3092",height:"758"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Call API to get unread message count. Code example:"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:'// Request URL example: Please replace 127.0.0.1:9003 with your Weiyu customer service system address\nhttp://127.0.0.1:9003/visitor/api/v1/message/unread/count?uid=1678201721979008\n// Return result example:\n{\n    message: "get unread messages count success",\n    code: 200,\n    data: 10 // Unread message count\n}\n'})}),"\n",(0,a.jsx)(s.h3,{id:"q6-how-to-pull-unread-message-list-from-weiyu-customer-service-system-visitor-end",children:"Q6: How to pull unread message list from Weiyu customer service system visitor end?"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Call API to get unread messages. Code example:"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-javascript",children:'// Request URL example: Please replace 127.0.0.1:9003 with your Weiyu customer service system address\nhttp://127.0.0.1:9003/visitor/api/v1/message/unread?pageNumber=0&pageSize=10&uid=1678201721979008\n// Return result example:\n{\n    message: "get unread messages success",\n    code: 200,\n    data: [] // Unread message list\n}\n'})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Reference ",(0,a.jsx)(s.a,{href:"https://github.com/Bytedesk/bytedesk-web/blob/master/src/apis/message.ts",children:"API Interface Code"})]}),"\n",(0,a.jsx)(s.li,{children:"Note: Visitor end anonymous users, no token required, only uid needed. For logged-in user authorization, please contact Weiyu customer service."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(s.p,{children:"Unread message count integration is an important feature for improving user experience. By displaying unread message count in real-time, it can effectively remind users to view customer service messages promptly, improving communication efficiency. The Weiyu customer service system provides simple and easy-to-use APIs to help developers easily implement unread message count management functionality. By following the best practices provided in this document, you can create a more complete message notification experience for users."})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},76118:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/unread_count-2da41d8426fa48e253c4d8c8f61d2d81.png"}}]);