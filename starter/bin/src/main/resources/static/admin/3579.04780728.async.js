"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3579],{48337:function(e,t,r){r.d(t,{Cd:function(){return R},E9:function(){return c},Rd:function(){return v},fA:function(){return m},ul:function(){return p}});var n=r(90819),o=r.n(n),a=r(73193),s=r.n(a),i=r(89933),u=r.n(i),l=r(6844),d=r(19736);function c(e){return f.apply(this,arguments)}function f(){return(f=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/query/org",{method:"GET",params:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/create",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/update",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/delete",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return w.apply(this,arguments)}function w(){return(w=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/role/reset/level",{method:"POST",data:s()(s()({},t),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},62860:function(e,t,r){r.d(t,{Z:function(){return O}});var n=r(90819),o=r.n(n),a=r(73193),s=r.n(a),i=r(89933),u=r.n(i),l=r(45332),d=r.n(l),c=r(4441),f=r(44194),m=r(48337),g=r(14888),p=r(93527),h=r(19736),v=r(46141),y=r(70984),R=r(3925),w=r(77359),x=r(9428),M=r(48769),P=r(71876),k=r(26710),b=r(44679),Z=r(15722),j=r(82669),C=r(90727),S=r(6844),U=r(30064),q=r(86684),I=r(13847),H=r(58867),E=r(31549),A=function(e){var t=e.open,r=e.superUser,n=e.isEdit,a=e.role,s=e.onCancel,i=e.onSubmit,l=H.Z.useForm(),c=d()(l,1)[0],m=(0,h.useIntl)(),y=(0,g.u)((function(e){return e.currentOrg}));(0,f.useEffect)((function(){n&&a?c.setFieldsValue({uid:a.uid,name:a.name,description:a.description}):c.resetFields()}),[n,a]);var R=function(){c.validateFields().then(function(){var e=u()(o()().mark((function e(t){var s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={uid:n?null==a?void 0:a.uid:"",name:t.name,description:t.description,authorityUids:[],orgUid:null==y?void 0:y.uid,level:r?S.Hxq:S.whQ},i(s);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),p.yw.error(m.formatMessage({id:"role.message.operation.failed"}))}))};return(0,E.jsx)(v.Z,{title:m.formatMessage({id:n?"role.edit.title":"role.create.title"}),open:t,forceRender:!0,onOk:R,onCancel:s,children:(0,E.jsxs)(U.A,{form:c,name:"roleForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,E.jsx)(q.Z,{label:m.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0,message:m.formatMessage({id:"role.name.required"})}],fieldProps:{onPressEnter:function(){c.validateFields(["description"]).then((function(){R()}))}}}),(0,E.jsx)(I.Z,{label:m.formatMessage({id:"role.description"}),name:"description",rules:[{required:!0,message:m.formatMessage({id:"role.description.required"})}],fieldProps:{onPressEnter:function(){R()},autoSize:{minRows:2,maxRows:6}}})]})})},T=r(36125),O=function(e){var t,r,n,a,i,l,U=e.superUser,q=(0,h.useIntl)(),I=(0,h.useAccess)(),H=(0,k.Z)().isDarkMode,O=v.Z.useModal(),F=d()(O,2),z=F[0],B=F[1],J=(0,b.Z)().translateString,Q=(0,f.useState)(!1),D=d()(Q,2),G=D[0],_=D[1],X=(0,f.useState)(""),L=d()(X,2),N=L[0],Y=L[1],W=(0,f.useState)(!1),K=d()(W,2),V=K[0],$=K[1],ee=(0,g.u)((function(e){return e.currentOrg})),te=(0,c.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform,insertRole:e.insertRole,insertRolePlatform:e.insertRolePlatform,upgradeRole:e.upgradeRole,upgradeRolePlatform:e.upgradeRolePlatform,currentRole:e.currentRole,currentRolePlatform:e.currentRolePlatform,removeRole:e.removeRole,removeRolePlatform:e.removeRolePlatform,setCurrentRole:e.setCurrentRole,setCurrentRolePlatform:e.setCurrentRolePlatform}})),re=te.roleResult,ne=te.roleResultPlatform,oe=te.setRoleResult,ae=te.setRoleResultPlatform,se=te.insertRole,ie=te.insertRolePlatform,ue=te.upgradeRole,le=te.upgradeRolePlatform,de=te.removeRole,ce=te.removeRolePlatform,fe=te.currentRole,me=te.currentRolePlatform,ge=te.setCurrentRole,pe=te.setCurrentRolePlatform,he=U?S.Hxq:S.whQ,ve=null==I?void 0:I.rolePermission,ye=null!==(t=null==ve||null===(r=ve.canCreate)||void 0===r?void 0:r.call(ve,he))&&void 0!==t&&t,Re=null!==(n=null==ve||null===(a=ve.canUpdate)||void 0===a?void 0:a.call(ve,he))&&void 0!==n&&n,we=null!==(i=null==ve||null===(l=ve.canDelete)||void 0===l?void 0:l.call(ve,he))&&void 0!==i&&i,xe=function(){p.yw.warning(q.formatMessage({id:"role.permission.denied",defaultMessage:"暂无操作权限"}))},Me=U?me:fe,Pe=function(e){return[S.jGk,S.w7Z,S.nGQ,S.gJI,S.iIG].includes(null==e?void 0:e.uid)||!0===(null==e?void 0:e.system)},ke=function(){var e=u()(o()().mark((function e(){var t,r,n,a,i,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.yw.loading(q.formatMessage({id:"loading"})),e.prev=1,t={pageNumber:0,pageSize:100,searchText:N},r=U?s()(s()({},t),{},{system:!0}):s()(s()({},t),{},{orgUid:null==ee?void 0:ee.uid}),e.next=6,(0,m.E9)(r);case 6:if(n=e.sent,T.Z.debug("queryRolesByOrg response: ",null==n?void 0:n.data,r),200===n.code){e.next=10;break}throw new Error(n.message);case 10:U?(ae(n),""===(null==me?void 0:me.uid)&&null!=n&&null!==(a=n.data)&&void 0!==a&&null!==(a=a.content)&&void 0!==a&&a.length&&pe(n.data.content[0])):(oe(n),""===(null==fe?void 0:fe.uid)&&null!=n&&null!==(i=n.data)&&void 0!==i&&null!==(i=i.content)&&void 0!==i&&i.length&&ge(n.data.content[0])),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),T.Z.error("failed to load roles",e.t0),p.yw.error(null!==(u=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==u?u:q.formatMessage({id:"role.load.failed",defaultMessage:"角色加载失败"}));case 17:return e.prev=17,p.yw.destroy(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,13,17,20]])})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){ke()}),[N,null==ee?void 0:ee.uid]);var be=function(){var e=u()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye){e.next=3;break}return xe(),e.abrupt("return");case 3:return p.yw.loading(q.formatMessage({id:"creating"})),e.next=6,(0,m.fA)(s()({},t));case 6:200===(r=e.sent).code?(p.yw.destroy(),p.yw.success(q.formatMessage({id:"create.success"})),_(!1),U?(ie(null==r?void 0:r.data),pe(null==r?void 0:r.data)):(se(null==r?void 0:r.data),ge(null==r?void 0:r.data))):(p.yw.destroy(),p.yw.error(r.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ze=function(){var e=u()(o()().mark((function e(t){var r,n,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Re){e.next=3;break}return xe(),e.abrupt("return");case 3:return n={uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,description:null==t?void 0:t.description,authorityUids:(null==t||null===(r=t.authorities)||void 0===r?void 0:r.map((function(e){return e.uid})))||[],system:U},p.yw.loading(q.formatMessage({id:"updating"})),e.next=7,(0,m.ul)(n);case 7:200===(a=e.sent).code?(p.yw.destroy(),p.yw.success(q.formatMessage({id:"update.success"})),U?le(null==a?void 0:a.data):ue(null==a?void 0:a.data),_(!1)):(p.yw.destroy(),p.yw.error(a.message));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=u()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=3;break}return xe(),e.abrupt("return");case 3:return p.yw.loading(q.formatMessage({id:"deleting"})),e.next=6,(0,m.Rd)(t);case 6:200===(r=e.sent).code?(p.yw.destroy(),p.yw.success(q.formatMessage({id:"delete.success"})),U?ce(t.uid):de(t.uid),_(!1),ke()):(p.yw.destroy(),p.yw.error(r.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=U?ne.data.content:re.data.content,Se=function(){var e=u()(o()().mark((function e(){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Re){e.next=3;break}return xe(),e.abrupt("return");case 3:if(null!=Me&&Me.uid){e.next=6;break}return p.yw.warning(q.formatMessage({id:"role.reset.select",defaultMessage:"请先选择角色"})),e.abrupt("return");case 6:return t={uid:Me.uid,level:Me.level||he,orgUid:Me.orgUid},p.yw.loading(q.formatMessage({id:"role.reset.progress",defaultMessage:"正在重置角色权限"})),e.prev=8,e.next=11,(0,m.Cd)(t);case 11:r=e.sent,p.yw.destroy(),200===r.code?(p.yw.success(q.formatMessage({id:"role.reset.success",defaultMessage:"已恢复默认权限"})),U?(le(null==r?void 0:r.data),pe(null==r?void 0:r.data)):(ue(null==r?void 0:r.data),ge(null==r?void 0:r.data))):p.yw.error(r.message),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(8),p.yw.destroy(),p.yw.error(q.formatMessage({id:"role.reset.failed",defaultMessage:"重置失败，请稍后再试"}));case 20:case"end":return e.stop()}}),e,null,[[8,16]])})));return function(){return e.apply(this,arguments)}}();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(y.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[ye&&(0,E.jsx)(R.ZP,{type:"primary",size:"small",icon:(0,E.jsx)(j.Z,{}),onClick:function(){ye?($(!1),_(!0)):xe()},children:q.formatMessage({id:"create"})}),(0,E.jsx)(R.ZP,{size:"small",onClick:ke,children:q.formatMessage({id:"refresh"})}),U&&Re&&(0,E.jsx)(w.Z,{title:q.formatMessage({id:"role.reset.confirm.title",defaultMessage:"重置【{name}】的权限？"},{name:null!=Me&&Me.name?J(Me.name):q.formatMessage({id:"role.reset.none",defaultMessage:"未选择角色"})}),description:q.formatMessage({id:"role.reset.confirm.desc",defaultMessage:"仅保留当前层级默认权限，继续？"}),okText:q.formatMessage({id:"ok"}),cancelText:q.formatMessage({id:"cancel"}),onConfirm:Se,disabled:!(null!=Me&&Me.uid),children:(0,E.jsx)(R.ZP,{size:"small",disabled:!(null!=Me&&Me.uid),children:q.formatMessage({id:"role.reset.button",defaultMessage:"重置权限"})})}),!Pe(Me)&&(null==Me?void 0:Me.uid)&&(0,E.jsxs)(E.Fragment,{children:[Re&&(0,E.jsx)(R.ZP,{size:"small",onClick:function(){Re?Pe(Me)?p.yw.error(q.formatMessage({id:"role.system.noedit"})):($(!0),_(!0)):xe()},children:q.formatMessage({id:"edit"})}),we&&(0,E.jsx)(R.ZP,{onClick:function(){return function(e){we?Pe(e)?p.yw.error(q.formatMessage({id:"role.system.nodelete"})):z.confirm({title:q.formatMessage({id:"deleteTip"}),icon:(0,E.jsx)(Z.Z,{}),content:"".concat(q.formatMessage({id:"deleteAffirm"}),"【").concat(J(e.name),"】？"),onOk:function(){je(e)},okText:q.formatMessage({id:"ok"}),cancelText:q.formatMessage({id:"cancel"})}):xe()}(Me)},size:"small",style:{float:"right"},danger:!0,children:q.formatMessage({id:"delete"})})]})]}),(0,E.jsx)("div",{style:{margin:5},children:(0,E.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,E.jsx)(M.Z,{placeholder:q.formatMessage({id:"role.search.placeholder",defaultMessage:"搜索角色名称"}),value:N,onChange:function(e){return Y(e.target.value)},onPressEnter:function(){return ke()},allowClear:!0}),(0,E.jsx)(R.ZP,{onClick:function(){return ke()},icon:(0,E.jsx)(C.Z,{})})]})}),(0,E.jsx)(P.Z,{dataSource:Ce,renderItem:function(e){return(0,E.jsx)(P.Z.Item,{style:{backgroundColor:(null==Me?void 0:Me.uid)===e.uid?H?"#333333":"#dddddd":void 0,cursor:"pointer"},onClick:function(){return t=e,void(U?pe(t):ge(t));var t},children:(0,E.jsx)(P.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,E.jsx)(E.Fragment,{children:J(e.name)}),description:J(e.description)})},e.uid)}}),G&&(0,E.jsx)(A,{open:G,superUser:U,isEdit:V,role:Me,onCancel:function(){_(!1)},onSubmit:function(e){V?Ze(e):be(e)}}),B]})}},59310:function(e,t,r){r.d(t,{Z:function(){return E}});var n=r(44194),o=r(31167),a=r(73193),s=r.n(a),i=r(90819),u=r.n(i),l=r(76711),d=r.n(l),c=r(89933),f=r.n(c),m=r(45332),g=r.n(m),p=r(93527),h=r(6844),v=r(19736);function y(e){return R.apply(this,arguments)}function R(){return(R=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/authority/query/org",{method:"GET",params:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(44679),x=r(4441),M=r(20921),P=r(12792),k=r(53229),b=r(51891),Z=r(37326),j=r(1691),C=r(48337),S=r(36125),U=r(31549),q={width:"20%",textAlign:"center"},I="ORGANIZATION",H=function(e){var t,r,o=e.superUser,a=e.level,i=(0,v.useIntl)(),l=(0,v.useAccess)(),c=(0,w.Z)().translateString,m=(0,n.useState)(!1),R=g()(m,2),H=R[0],E=R[1],A=(0,n.useState)({uid:""}),T=g()(A,2),O=T[0],F=T[1],z=(0,x.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole,currentRolePlatform:e.currentRolePlatform,setCurrentRolePlatform:e.setCurrentRolePlatform}})),B=z.upgradeRole,J=z.currentRole,Q=z.setCurrentRole,D=z.currentRolePlatform,G=z.setCurrentRolePlatform,_=(0,n.useState)([]),X=g()(_,2),L=X[0],N=X[1],Y=(0,n.useState)([]),W=g()(Y,2)[1],K=(0,n.useState)(J.authorities),V=g()(K,2),$=V[0],ee=V[1],te=null==l?void 0:l.rolePermission,re=null!==(t=null==te||null===(r=te.canUpdate)||void 0===r?void 0:r.call(te,a))&&void 0!==t&&t,ne=a===h.Hxq,oe=function(){return!!re&&(!ne||o)},ae=function(){!ne||o?p.yw.warning(i.formatMessage({id:"authority.permission.denied",defaultMessage:"暂无权限修改该层级权限"})):p.yw.warning(i.formatMessage({id:"authority.level.platform.readonly",defaultMessage:"平台级权限仅超级管理员可设置"}))},se=[h.Hxq,h.whQ,h.nYM,h.v5D,h.fyH,h.guB],ie=function(e){var t,r,n=(t=e.name||"",(r=(null==t?void 0:t.split("_"))||[]).length>=3?{module:r[0],level:r[1],action:r.slice(2).join("_")}:null);if(!n)return!1;var o=se.indexOf(n.level);if(o<=0)return!1;for(var a,s=function(){var e=se[i],t="".concat(n.module,"_").concat(e,"_").concat(n.action);if(null==$?void 0:$.some((function(e){return e.name===t})))return{v:{inherited:!0,fromLevel:e}}},i=0;i<o;i++)if(a=s())return a.v;return!1},ue=function(e){switch(e){case h.Hxq:return i.formatMessage({id:"authority.level.platform",defaultMessage:"平台级"});case h.whQ:return i.formatMessage({id:"authority.level.organization",defaultMessage:"组织级"});case h.nYM:return i.formatMessage({id:"authority.level.department",defaultMessage:"部门级"});case h.v5D:return i.formatMessage({id:"authority.level.workgroup",defaultMessage:"工作组级"});case h.fyH:return i.formatMessage({id:"authority.level.agent",defaultMessage:"客服级"});case h.guB:return i.formatMessage({id:"authority.level.user",defaultMessage:"用户级"});default:return e}},le=function(){var e=f()(u()().mark((function e(){var t,r,n,o,s,l,c,f,m;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(!0),t=[],r=0,n=100,o=!0,e.prev=5;case 6:if(!o){e.next=15;break}return s={pageNumber:r,pageSize:n,level:h.Hxq},e.next=10,y(s);case 10:l=e.sent,S.Z.debug("getAuthorities response page",r,null==l?void 0:l.data,s),200===l.code?(c=(null==l?void 0:l.data.content)||[],t.push.apply(t,d()(c)),S.Z.debug("getAuthorities fetched content count",c.length),f=(null==l?void 0:l.data.totalPages)||0,r++,o=r<f):(S.Z.debug("getAuthorities error",l),p.yw.error(l.message),o=!1),e.next=6;break;case 15:W(t),m=t.filter((function(e){var t,r=(null===(t=e.name)||void 0===t?void 0:t.split("_"))||[];if(r.length>=2){var n=r[0],o=r[1];return(n!==I||a===h.Hxq)&&o===a}return!1})),S.Z.debug("getAuthorities total:",t.length,"filtered:",m.length),N(m),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(5),console.error("getAuthorities error:",e.t0),p.yw.error(i.formatMessage({id:"query.failed",defaultMessage:"查询失败"}));case 25:return e.prev=25,E(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[5,21,25,28]])})));return function(){return e.apply(this,arguments)}}(),de=L.reduce((function(e,t){var r,n=((null===(r=t.name)||void 0===r?void 0:r.split("_"))||[])[0]||"OTHER";return e[n]||(e[n]=[]),e[n].push(t),e}),{}),ce=Object.keys(de).filter((function(e){return!!ne||e!==I}));(0,n.useEffect)((function(){o?(F(D),ee(D.authorities)):(F(J),ee(J.authorities))}),[J,D,o]),(0,n.useEffect)((function(){le()}),[a]);var fe=function(e){return e.every((function(e){var t=null==$?void 0:$.some((function(t){return t.name===e.name})),r=!!ie(e);return t||r}))},me=function(e){return e.every((function(e){return!!ie(e)}))},ge=function(){var e=f()(u()().mark((function e(t){var r,n,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t.uid,name:t.name,description:t.description,authorityUids:(null===(r=t.authorities)||void 0===r?void 0:r.map((function(e){return e.uid})))||[]},S.Z.debug("handleUpdateRole authority:",n),p.yw.loading(i.formatMessage({id:"updating"})),e.next=5,(0,C.ul)(n);case 5:o=e.sent,S.Z.debug("updateRole:",o),200===o.code?(p.yw.destroy(),p.yw.success(i.formatMessage({id:"update.success",defaultMessage:"update success"})),B(null==o?void 0:o.data)):(p.yw.destroy(),p.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return H?(0,U.jsx)(M.Z,{tip:i.formatMessage({id:"loading",defaultMessage:"加载中..."}),children:(0,U.jsx)("div",{style:{minHeight:100}})}):0===ce.length?(0,U.jsx)(P.Z,{description:i.formatMessage({id:"authority.empty",defaultMessage:"暂无权限数据"})}):(0,U.jsxs)(U.Fragment,{children:[!re&&(0,U.jsx)(k.Z,{type:"warning",showIcon:!0,message:i.formatMessage({id:"authority.permission.readonly",defaultMessage:"暂无权限修改当前层级权限，仅可查看"}),style:{marginBottom:10}}),ne&&!o&&(0,U.jsx)(k.Z,{type:"warning",showIcon:!0,message:i.formatMessage({id:"authority.level.platform.readonly",defaultMessage:"平台级权限仅超级管理员可设置"}),style:{marginBottom:10}}),a!==h.Hxq&&(0,U.jsx)(k.Z,{type:"info",showIcon:!0,message:i.formatMessage({id:"authority.inheritance.hint",defaultMessage:"高层级权限自动包含低层级权限。已继承的权限显示为选中状态且不可取消。"}),style:{marginBottom:10}}),ce.sort().map((function(e){return(0,U.jsx)(b.Z,{title:(0,U.jsx)(Z.Z,{checked:fe(de[e]),indeterminate:(t=de[e],r=t.some((function(e){var t=null==$?void 0:$.some((function(t){return t.name===e.name})),r=!!ie(e);return t||r})),n=fe(t),r&&!n),onChange:function(t){return function(e,t){if(oe()){var r,n=de[e];t?(r=d()($||[]),n.forEach((function(e){ie(e)||r.some((function(t){return t.name===e.name}))||r.push(e)}))):(n.filter((function(e){return!!ie(e)})).map((function(e){return e.name})).length>0&&p.yw.info(i.formatMessage({id:"authority.inherited.kept",defaultMessage:"部分权限来自高层级继承，无法取消"})),r=($||[]).filter((function(e){return!n.some((function(t){return t.name===e.name}))}))),ee(r),o?(G(s()(s()({},D),{},{authorities:r})),ge(s()(s()({},D),{},{authorities:r}))):(Q(s()(s()({},J),{},{authorities:r})),ge(s()(s()({},J),{},{authorities:r})))}else ae()}(e,t.target.checked)},disabled:!oe()||!(null!=O&&O.uid)||me(de[e]),children:c(e)}),style:{marginTop:10},size:"small",children:de[e].map((function(e){var t,r,n,a=ie(e),u=null==$?void 0:$.some((function(t){return t.name===e.name})),l=!!a;return(0,U.jsx)(b.Z.Grid,{style:q,children:(0,U.jsx)(j.Z,{title:l?i.formatMessage({id:"authority.inherited.from",defaultMessage:"已从{level}继承"},{level:ue(a.fromLevel)}):"",children:(0,U.jsx)(Z.Z,{checked:u||l,disabled:!oe()||!(null!=O&&O.uid)||l,onChange:function(t){return function(e,t){if(oe()){var r,n=ie(e);!n||t?(r=t?[].concat(d()($||[]),[e]):($||[]).filter((function(t){return t.name!==e.name})),ee(r),o?(G(s()(s()({},D),{},{authorities:r})),ge(s()(s()({},D),{},{authorities:r}))):(Q(s()(s()({},J),{},{authorities:r})),ge(s()(s()({},J),{},{authorities:r})))):p.yw.warning(i.formatMessage({id:"authority.inherited.cannot.uncheck",defaultMessage:"该权限已从{level}继承，无法取消"},{level:ue(n.fromLevel)}))}else ae()}(e,t.target.checked)},style:l?{color:"#1890ff"}:void 0,children:(0,U.jsxs)("span",{style:l?{color:"#1890ff",fontStyle:"italic"}:void 0,children:[(t=e.name||"",r=t.split("_"),n=r[r.length-1],c("i18n.".concat(n))),l&&" ✓"]})})})},e.name)}))},e);var t,r,n}))]})},E=function(e){var t,r=e.superUser,n=(0,v.useIntl)();return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(o.Z,{defaultActiveKey:r?h.Hxq:h.whQ,items:(t=[],r&&t.push({key:h.Hxq,label:n.formatMessage({id:"authority.level.platform",defaultMessage:"平台权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.Hxq})}),t.push({key:h.whQ,label:n.formatMessage({id:"authority.level.organization",defaultMessage:"组织权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.whQ})}),t.push({key:h.nYM,label:n.formatMessage({id:"authority.level.department",defaultMessage:"部门权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.nYM})}),t.push({key:h.v5D,label:n.formatMessage({id:"authority.level.workgroup",defaultMessage:"工作组权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.v5D})}),t.push({key:h.fyH,label:n.formatMessage({id:"authority.level.agent",defaultMessage:"客服权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.fyH})}),t.push({key:h.guB,label:n.formatMessage({id:"authority.level.user",defaultMessage:"用户权限"}),children:(0,U.jsx)(H,{superUser:r,level:h.guB})}),t),onChange:function(e){console.log(e)}})})}},88449:function(e,t,r){var n=r(26710);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},4441:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(73193),o=r.n(n),a=r(76711),s=r.n(a),i=r(6844),u=r(26557),l=r(26407),d=r(20744),c=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,d.n)((function(e,t){return{currentRole:{uid:"",orgUid:"",authorities:[]},currentRolePlatform:{uid:"",orgUid:"",authorities:[]},roleResult:{data:{content:[]}},roleResultPlatform:{data:{content:[]}},insertRole:function(t){e((function(e){e.roleResult.data.content.unshift(t)}))},insertRolePlatform:function(t){e((function(e){e.roleResultPlatform.data.content.unshift(t)}))},upgradeRole:function(t){e((function(e){var r=e.roleResult.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},upgradeRolePlatform:function(t){e((function(e){var r=e.roleResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("Role with uid ".concat(t.uid," not found."))}))},setRoleResult:function(r){var n;(e({roleResult:r}),""===t().currentRole.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRole:r.data.content[0]}))},setRoleResultPlatform:function(r){var n;(e({roleResultPlatform:r}),""===t().currentRolePlatform.uid)&&((null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentRolePlatform:r.data.content[0]}))},setCurrentRole:function(r){var n=t().roleResult.data.content,a=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==a){var i=[].concat(s()(n.slice(0,a)),[r],s()(n.slice(a+1))),u=o()(o()({},t().roleResult),{},{data:{content:i}});e({roleResult:u,currentRole:r})}else console.warn("Role with the specified uid not found."),e({currentRole:r})},setCurrentRolePlatform:function(r){var n=t().roleResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==a){var i=[].concat(s()(n.slice(0,a)),[r],s()(n.slice(a+1))),u=o()(o()({},t().roleResultPlatform),{},{data:{content:i}});e({roleResultPlatform:u,currentRolePlatform:r})}else console.warn("Role with the specified uid not found."),e({currentRolePlatform:r})},removeRole:function(r){var n=t().roleResult.data.content,a=n.findIndex((function(e){return e.uid===r}));-1!==a?e({roleResult:o()(o()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,a)),s()(n.slice(a+1)))}})}):console.warn("Role not found in cache:",r),t().currentRole.uid===r&&e({currentRole:{uid:"",orgUid:"",authorities:[]}})},removeRolePlatform:function(r){var n=t().roleResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===r}));-1!==a?e({roleResult:o()(o()({},t().roleResult),{},{data:{content:[].concat(s()(n.slice(0,a)),s()(n.slice(a+1)))}})}):console.warn("Role not found in cache:",r),t().currentRolePlatform.uid===r&&e({currentRolePlatform:{uid:"",orgUid:"",authorities:[]}})},deleteRoleCache:function(){return e({},!0)}}})),{name:i.uaR})))}}]);