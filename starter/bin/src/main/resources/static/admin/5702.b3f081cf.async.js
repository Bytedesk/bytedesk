"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5702],{68972:function(e,s,t){var a=t(90819),n=t.n(a),o=t(73193),r=t.n(o),l=t(89933),i=t.n(l),d=t(45332),u=t.n(d),c=t(44194),f=t(58867),g=t(46141),m=t(48769),p=t(65513),h=t(19736),M=t(93527),v=t(29195),b=t(31549);s.Z=function(e){var s=e.open,t=e.onOpenChange,a=e.orgUid,o=e.record,l=e.onSuccess,d=(0,h.useIntl)(),x=f.Z.useForm(),j=u()(x,1)[0];(0,c.useEffect)((function(){var e,t;s&&(o?j.setFieldsValue({name:o.name||"",description:o.description||"",enabled:null===(e=o.enabled)||void 0===e||e,isDefault:null!==(t=o.isDefault)&&void 0!==t&&t}):(j.resetFields(),j.setFieldsValue({enabled:!0,isDefault:!1})))}),[s,o,j]);var k=function(){var e=i()(n()().mark((function e(){var s,i,u;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.validateFields();case 3:if(s=e.sent,i=r()(r()({},s),{},{orgUid:a,uid:null==o?void 0:o.uid}),null==o||!o.uid){e.next=11;break}return e.next=8,(0,v.sK)(i);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,(0,v.ZJ)(i);case 13:e.t0=e.sent;case 14:(u=e.t0)&&200===u.code?(M.yw.success(d.formatMessage({id:null!=o&&o.uid?"common.updated":"common.created",defaultMessage:null!=o&&o.uid?"更新成功":"创建成功"})),null==l||l(),t(!1)):M.yw.error((null==u?void 0:u.message)||"操作失败"),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.error("Error saving robot settings:",e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(g.Z,{title:(0,b.jsx)(h.FormattedMessage,{id:null!=o&&o.uid?"robot.settings.template.edit":"robot.settings.template.create",defaultMessage:null!=o&&o.uid?"编辑模板":"新建模板"}),open:s,onOk:k,onCancel:function(){return t(!1)},okText:(0,b.jsx)(h.FormattedMessage,{id:"common.save",defaultMessage:"保存"}),cancelText:(0,b.jsx)(h.FormattedMessage,{id:"common.cancel",defaultMessage:"取消"}),destroyOnHidden:!0,width:600,children:(0,b.jsxs)(f.Z,{form:j,layout:"vertical",preserve:!1,children:[(0,b.jsx)(f.Z.Item,{name:"name",label:(0,b.jsx)(h.FormattedMessage,{id:"robot.settings.template.name",defaultMessage:"模板名称"}),rules:[{required:!0,message:d.formatMessage({id:"required",defaultMessage:"此项为必填项"})}],children:(0,b.jsx)(m.Z,{placeholder:d.formatMessage({id:"robot.settings.template.name.placeholder",defaultMessage:"请输入模板名称"})})}),(0,b.jsx)(f.Z.Item,{name:"description",label:(0,b.jsx)(h.FormattedMessage,{id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(m.Z.TextArea,{rows:3,placeholder:d.formatMessage({id:"robot.settings.template.description.placeholder",defaultMessage:"请输入模板描述"})})}),(0,b.jsx)(f.Z.Item,{name:"enabled",label:(0,b.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"启用"}),valuePropName:"checked",children:(0,b.jsx)(p.Z,{})})]})})}},95702:function(e,s,t){var a=t(90819),n=t.n(a),o=t(89933),r=t.n(o),l=t(45332),i=t.n(l),d=t(14888),u=t(6844),c=t(30064),f=t(86684),g=t(68263),m=t(19736),p=t(46141),h=t(58867),M=t(65100),v=t(3925),b=t(9428),x=t(29589),j=t(44194),k=t(29195),Z=t(68972),F=t(10162),y=t(54605),w=t(59908),S=t(31549);s.Z=function(e){var s=e.open,t=e.onClose,a=e.onSubmit,o=(0,m.useIntl)(),l=c.A.useForm(),C=i()(l,1)[0],U=(0,d.u)((function(e){return e.currentOrg})),O=(0,j.useState)(!1),E=i()(O,2),q=E[0],I=E[1],P=(0,j.useState)(!1),R=i()(P,2),T=R[0],V=R[1],A=(0,j.useState)(0),N=i()(A,2),D=N[0],z=N[1],G=(0,j.useState)([]),B=i()(G,2),Q=B[0],W=B[1],_=(0,j.useState)([]),H=i()(_,2),J=H[0],K=H[1],L=(0,j.useState)(""),X=i()(L,2),Y=X[0],$=X[1],ee=(0,j.useCallback)(function(){var e=r()(n()().mark((function e(s){var t,a,o,r,l;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),e.prev=1,a={pageNumber:0,pageSize:50,enabled:!0,orgUid:null==U?void 0:U.uid,searchText:s||""},e.next=5,(0,k.VW)(a);case 5:return o=e.sent,console.log("queryRobotSettingsByOrg response:",o,a),r=(null==o||null===(t=o.data)||void 0===t?void 0:t.content)||[],W(r),!C.getFieldValue("settingsUid")&&r.length>0&&C.setFieldsValue({settingsUid:r[0].uid}),l=r.map((function(e){return{label:"".concat(e.name||e.uid).concat(e.isDefault?" (默认)":"").concat(e.enabled?"":" (已停用)"),value:e.uid}})),K(l),e.abrupt("return",l);case 13:return e.prev=13,V(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,,13,16]])})));return function(s){return e.apply(this,arguments)}}(),[null==U?void 0:U.uid,C]);(0,j.useEffect)((function(){s&&ee()}),[s,D,ee]);var se=function(){console.log("handleSaveRobot"),C.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var s={name:e.nickname,nickname:e.nickname,type:e.type,settingsUid:e.settingsUid,orgUid:null==U?void 0:U.uid,avatar:e.avatar||Y};console.log("robotObject:",s),a(s),C.resetFields(),$("")})).catch((function(e){console.log("Form errors:",e)}))};(0,j.useEffect)((function(){console.log("RobotForm useEffect"),s&&(C.resetFields(),C.setFieldsValue({type:u.f4h}),$(""))}),[s,C]);var te=function(){var e=r()(n()().mark((function e(s){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("RobotModel handleUploadSuccess:",s),$(s),C.setFieldsValue({avatar:s});case 3:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();return(0,S.jsx)("div",{children:(0,S.jsxs)(p.Z,{title:o.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:s,forceRender:!0,okText:o.formatMessage({id:"save",defaultMessage:"Save"}),onOk:se,onCancel:function(){C.resetFields(),t()},children:[(0,S.jsxs)(c.A,{form:C,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,S.jsx)(h.Z.Item,{name:"avatarUpload",label:o.formatMessage({id:"pages.robot.tab.avatar",defaultMessage:"Avatar"}),children:(0,S.jsxs)(y.G,{onSuccess:te,onError:function(e){console.log("RobotModel handleUploadError:",e)},children:[(0,S.jsx)(M.Z,{src:Y}),(0,S.jsx)(v.ZP,{icon:(0,S.jsx)(w.Z,{}),style:{marginLeft:12},children:o.formatMessage({id:"pages.robot.upload",defaultMessage:"Upload"})})]},"avatar")}),(0,S.jsx)(f.Z,{name:"avatar",hidden:!0}),(0,S.jsx)(c.A.Item,{label:o.formatMessage({id:"robot.settings",defaultMessage:"机器人配置"}),name:"settingsUid",rules:[{required:!0,message:o.formatMessage({id:"robot.settings.required",defaultMessage:"请选择机器人配置"})}],children:(0,S.jsxs)(b.Z.Compact,{block:!0,children:[(0,S.jsx)(x.Z,{showSearch:!0,allowClear:!0,placeholder:o.formatMessage({id:"robot.settings.placeholder",defaultMessage:"请选择机器人配置"}),options:J,loading:T,filterOption:!1,onSearch:function(e){return ee(e)},onFocus:function(){return ee()},notFoundContent:0===Q.length?(0,S.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,S.jsx)("div",{style:{marginBottom:8,color:"#999"},children:o.formatMessage({id:"robot.settings.empty",defaultMessage:"暂无配置模板"})}),(0,S.jsx)(v.ZP,{size:"small",type:"primary",icon:(0,S.jsx)(F.Z,{}),onClick:function(){return I(!0)},children:o.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"})})]}):void 0}),(0,S.jsx)(v.ZP,{size:"small",icon:(0,S.jsx)(F.Z,{}),onClick:function(){return I(!0)},title:o.formatMessage({id:"robot.settings.create",defaultMessage:"创建配置"}),children:o.formatMessage({id:"common.new",defaultMessage:"新建"})})]})}),(0,S.jsx)(f.Z,{label:o.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:o.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return se()}}}),(0,S.jsx)(g.Z,{label:o.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:o.formatMessage({id:u.f4h,defaultMessage:"Service"}),value:u.f4h},{label:o.formatMessage({id:u.Qeb,defaultMessage:"Chat"}),value:u.Qeb,disabled:!0},{label:o.formatMessage({id:u.wG_,defaultMessage:"Marketing"}),value:u.wG_,disabled:!0}],rules:[{required:!0,message:o.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:o.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]}),(0,S.jsx)(Z.Z,{open:q,onOpenChange:I,orgUid:(null==U?void 0:U.uid)||"",record:null,onSuccess:function(){I(!1),z((function(e){return e+1}))}})]})})}}}]);