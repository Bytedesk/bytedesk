"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[428],{67559:function(e,t,a){a.d(t,{AP:function(){return m},_J:function(){return h},t5:function(){return p},v_:function(){return g}});var i=a(90819),s=a.n(i),n=a(73193),u=a.n(n),l=a(89933),r=a.n(l),o=a(6844),d=a(19736);function m(e){return f.apply(this,arguments)}function f(){return(f=r()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/query/org",{method:"GET",params:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=r()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/create",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return c.apply(this,arguments)}function c(){return(c=r()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/update",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=r()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/kbase/delete",{method:"POST",data:u()(u()({},t),{},{channel:o.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},20585:function(e,t,a){var i=a(90819),s=a.n(i),n=a(89933),u=a.n(n),l=a(45332),r=a.n(l),o=a(74341),d=a(44679),m=a(90104),f=a(53816),g=a(30064),v=(a(68263),a(86684),a(58867)),p=a(19736),c=a(44194),h=a(43590),x=a(14888),M=(a(6844),a(31549));t.Z=function(e){var t,a,i=e.messageLeaveSettings,n=e.onMessageLeaveSettingsChange,l=(0,p.useIntl)(),y=(0,d.Z)().translateString,w=g.A.useForm(),T=r()(w,1)[0],b=(null===(t=v.Z.useWatch)||void 0===t||t.call(v.Z,"messageLeaveNotify",T),null===(a=v.Z.useWatch)||void 0===a?void 0:a.call(v.Z,"messageLeaveNotifyType",T)),q=(0,x.u)((function(e){return e.currentOrg})),L=(0,c.useMemo)((function(){return null!=i?i:{}}),[i]),k=(0,c.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==L?void 0:L.draft)&&void 0!==t?t:null==L?void 0:L.live)&&void 0!==e?e:void 0}),[L]),j=((0,c.useMemo)((function(){return[{label:l.formatMessage({id:"leavemsg.notify.email",defaultMessage:"Email"}),value:"EMAIL"},{label:l.formatMessage({id:"leavemsg.notify.sms",defaultMessage:"SMS"}),value:"SMS"},{label:l.formatMessage({id:"leavemsg.notify.email_sms",defaultMessage:"Email + SMS"}),value:"EMAIL_SMS"}]}),[l]),(0,c.useRef)("")),W=(0,c.useState)(""),P=r()(W,2),E=P[0],S=P[1],Z=(0,c.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==n||n(e))}),[n]);(0,c.useEffect)((function(){var e,t,a;T.setFieldsValue({messageLeaveEnabled:null===(e=null==k?void 0:k.messageLeaveEnabled)||void 0===e||e,messageLeaveAgentUid:null==k?void 0:k.messageLeaveAgentUid,messageLeaveNotify:null!==(t=null==k?void 0:k.messageLeaveNotify)&&void 0!==t&&t,messageLeaveNotifyType:null!==(a=null==k?void 0:k.messageLeaveNotifyType)&&void 0!==a?a:"EMAIL",messageLeaveNotifyEmail:null==k?void 0:k.messageLeaveNotifyEmail,messageLeaveNotifyMobile:null==k?void 0:k.messageLeaveNotifyMobile,messageLeaveForm:null==k?void 0:k.messageLeaveForm});var i=y(null==k?void 0:k.messageLeaveTip)||"";j.current!==i&&(j.current=i,S(i),T.setFieldValue("messageLeaveTip",i))}),[k,T,y]);var C=(0,c.useCallback)((function(e){Z(e)}),[Z]),F=(0,c.useCallback)((function(e){j.current=e,S(e),T.setFieldValue("messageLeaveTip",e),Z({messageLeaveTip:e})}),[Z,T]),A=((0,c.useCallback)(function(){var e=u()(s()().mark((function e(t){var a,i,n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=q&&q.uid){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=2,e.next=5,(0,h._t)({pageNumber:0,pageSize:100,orgUid:q.uid,searchText:null!=t?t:""});case 5:if(200!==(null==(a=e.sent)?void 0:a.code)){e.next=8;break}return e.abrupt("return",(null!==(i=null==a||null===(n=a.data)||void 0===n?void 0:n.content)&&void 0!==i?i:[]).map((function(e){return{label:(null==e?void 0:e.nickname)||(null==e?void 0:e.uid),value:null==e?void 0:e.uid}})).filter((function(e){return Boolean(e.value)})));case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),[null==q?void 0:q.uid]),!1);null!=b||null==k||k.messageLeaveNotifyType;return(0,M.jsxs)(g.A,{form:T,submitter:!1,style:{marginLeft:"20px"},onValuesChange:function(e){return C(e)},children:[!1,(0,M.jsx)(g.A.Item,{name:"messageLeaveTip",label:(0,M.jsxs)("span",{children:[l.formatMessage({id:"agent.settings.leave.msg"}),(0,M.jsx)(o.Z,{type:"messageLeave",keys:["messageLeaveTip"],live:null==L?void 0:L.live,draft:null==L?void 0:L.draft})]}),rules:[{required:!0,message:l.formatMessage({id:"agent.settings.leave.msg.required"})}],children:(0,M.jsx)(f.Z,{placeholder:l.formatMessage({id:"agent.settings.leave.msg.placeholder"}),value:E,toolbarKeys:(0,m.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:F},"messageLeaveTipEditor")}),!1,A,A,false,false]})}},35165:function(e,t,a){var i=a(45332),s=a.n(i),n=a(74341),u=a(30064),l=a(69438),r=a(13847),o=a(19736),d=a(44194),m=a(31549);t.Z=function(e){e.variant;var t,a,i=e.queueSettings,f=e.onQueueSettingsChange,g=(0,o.useIntl)(),v=u.A.useForm(),p=s()(v,1)[0],c=(0,d.useRef)(!1),h=u.A.useWatch("showEstimatedWaitTime",p),x=(0,d.useMemo)((function(){return{position:"{position}",waitTime:"{waitTime}"}}),[]),M=(0,d.useMemo)((function(){return null!=i?i:{}}),[i]),y=(0,d.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==M?void 0:M.draft)&&void 0!==t?t:null==M?void 0:M.live)&&void 0!==e?e:void 0}),[null==M?void 0:M.draft,null==M?void 0:M.live]),w=(0,d.useCallback)((function(e){e&&0!==Object.keys(e).length&&(null==f||f(e))}),[f]),T=(0,d.useCallback)((function(e,t){var a=!1!==t,i=[];return!1!==e&&i.push(g.formatMessage({id:"queue.settings.tip.fragment.position",defaultMessage:"您前面还有 {position} 人排队"},x)),a&&i.push(g.formatMessage({id:"queue.settings.tip.fragment.wait",defaultMessage:"预计等待 {waitTime}"},x)),i.push(g.formatMessage({id:"queue.settings.tip.fragment.suffix",defaultMessage:"请耐心等候。"})),i.filter(Boolean).join("，")}),[g,x]),b=(0,d.useCallback)((function(e){var t=e&&"showQueuePosition"in e?e.showQueuePosition:p.getFieldValue("showQueuePosition"),a=e&&"showEstimatedWaitTime"in e?e.showEstimatedWaitTime:p.getFieldValue("showEstimatedWaitTime"),i=T(t,a);p.getFieldValue("queueTip")!==i&&(c.current=!0,p.setFieldsValue({queueTip:i}),c.current=!1,w({queueTip:i}))}),[T,w,p]);(0,d.useEffect)((function(){var e,t,a,i,s,n,u,l;c.current=!0,p.setFieldsValue({queueRobot:null!==(e=null==y?void 0:y.queueRobot)&&void 0!==e&&e,showQueuePosition:null===(t=null==y?void 0:y.showQueuePosition)||void 0===t||t,showEstimatedWaitTime:null===(a=null==y?void 0:y.showEstimatedWaitTime)||void 0===a||a,avgWaitTimePerPerson:null!==(i=null==y?void 0:y.avgWaitTimePerPerson)&&void 0!==i?i:60,maxWaiting:null!==(s=null==y?void 0:y.maxWaiting)&&void 0!==s?s:1e4,maxWaitTime:null!==(n=null==y?void 0:y.maxWaitTime)&&void 0!==n?n:86400,queueTip:null!==(u=null==y?void 0:y.queueTip)&&void 0!==u?u:"",queueReadyTip:null!==(l=null==y?void 0:y.queueReadyTip)&&void 0!==l?l:""}),c.current=!1}),[y,p]);var q=(0,d.useCallback)((function(e){c.current||(w(e),("showQueuePosition"in e||"showEstimatedWaitTime"in e)&&b(e))}),[w,b]);t=null!=h?h:null==y?void 0:y.showEstimatedWaitTime;return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(u.A,{layout:"vertical",form:p,submitter:!1,style:{marginLeft:"20px"},onValuesChange:q,children:[(0,m.jsx)(l.Z,{width:"md",name:"maxWaiting",label:(0,m.jsxs)("span",{children:[g.formatMessage({id:"queue.settings.max.waiting",defaultMessage:"最大等待人数"}),(0,m.jsx)(n.Z,{type:"generic",keys:["maxWaiting"],live:null==M?void 0:M.live,draft:null==M?void 0:M.draft})]}),min:1,max:1e5,fieldProps:{precision:0},tooltip:g.formatMessage({id:"queue.settings.max.waiting.tooltip",defaultMessage:"设置允许同时排队等待的最大访客数量，超过则进入留言流程"})}),(0,m.jsx)(l.Z,{width:"md",name:"maxWaitTime",label:(0,m.jsxs)("span",{children:[g.formatMessage({id:"queue.settings.max.wait.time",defaultMessage:"最大等待时间(秒)"}),(0,m.jsx)(n.Z,{type:"generic",keys:["maxWaitTime"],live:null==M?void 0:M.live,draft:null==M?void 0:M.draft})]}),min:1,max:604800,fieldProps:{precision:0},tooltip:g.formatMessage({id:"queue.settings.max.wait.time.tooltip",defaultMessage:"设置访客最长排队等待时间（秒），超时后将进入留言流程"}),extra:g.formatMessage({id:"queue.settings.max.wait.time.extra",defaultMessage:"当前设置：约 {hours} 小时"},{hours:Math.round((null!==(a=null==y?void 0:y.maxWaitTime)&&void 0!==a?a:86400)/3600)})}),(0,m.jsx)(l.Z,{width:"md",name:"avgWaitTimePerPerson",label:(0,m.jsxs)("span",{children:[g.formatMessage({id:"queue.settings.avg.wait.time.per.person",defaultMessage:"每人平均等待时长(秒)"}),(0,m.jsx)(n.Z,{type:"generic",keys:["avgWaitTimePerPerson"],live:null==M?void 0:M.live,draft:null==M?void 0:M.draft})]}),min:1,max:600,fieldProps:{precision:0},tooltip:g.formatMessage({id:"queue.settings.avg.wait.time.per.person.tooltip",defaultMessage:"用于计算预计等待时间，预计等待时间 = 前面排队人数 × 每人平均等待时长"}),extra:g.formatMessage({id:"queue.settings.avg.wait.time.per.person.extra",defaultMessage:"默认值：60 秒（1 分钟）"})}),(0,m.jsx)(r.Z,{width:"lg",name:"queueTip",label:(0,m.jsxs)("span",{children:[g.formatMessage({id:"queue.settings.tip",defaultMessage:"排队提示语模板"}),(0,m.jsx)(n.Z,{type:"generic",keys:["queueTip"],live:null==M?void 0:M.live,draft:null==M?void 0:M.draft})]}),fieldProps:{rows:3,maxLength:500},placeholder:g.formatMessage({id:"queue.settings.tip.placeholder",defaultMessage:"您前面还有 {position} 人排队，预计等待 {waitTime}，请耐心等候。"},{position:x.position,waitTime:x.waitTime}),tooltip:g.formatMessage({id:"queue.settings.tip.tooltip",defaultMessage:"访客排队时显示的提示信息，支持模板变量自动替换"}),extra:(0,m.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:g.formatMessage({id:"queue.settings.tip.variables",defaultMessage:"支持的模板变量：\n• '{'position'}' - 当前排队位置（前面的排队人数）\n• '{'queueSize'}' - 当前队列总人数\n• '{'waitSeconds'}' - 预计等待秒数\n• '{'waitMinutes'}' - 预计等待分钟数\n• '{'waitTime'}' - 格式化的等待时间（如\"约5分钟\"）"})})}),(0,m.jsx)(r.Z,{width:"lg",name:"queueReadyTip",label:(0,m.jsxs)("span",{children:[g.formatMessage({id:"queue.settings.ready.tip",defaultMessage:"即将接入提示语"}),(0,m.jsx)(n.Z,{type:"generic",keys:["queueReadyTip"],live:null==M?void 0:M.live,draft:null==M?void 0:M.draft})]}),fieldProps:{rows:2,maxLength:200},placeholder:g.formatMessage({id:"queue.settings.ready.tip.placeholder",defaultMessage:"客服即将为您服务，请稍候..."}),tooltip:g.formatMessage({id:"queue.settings.ready.tip.tooltip",defaultMessage:"当访客排队位置为0（即前面没有人排队，下一个就是该访客）时显示的提示信息"}),extra:g.formatMessage({id:"queue.settings.ready.tip.extra",defaultMessage:"此提示语用于替代排队位置为0时的默认提示，提升用户体验"})})]})})}},81005:function(e,t,a){a(73193),a(84176),a(45332),a(19736),a(44194),a(31549)}}]);