"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9986],{86567:function(e,t,a){a.d(t,{Z:function(){return J}});var n=a(90819),r=a.n(n),s=a(89933),i=a.n(s),o=a(45332),u=a.n(o),l=a(15722),c=a(90727),d=a(82669),f=a(80556),g=a(59304),p=a(54881),m=a(2484),h=a(46141),v=a(48769),y=a(3925),M=a(70984),b=a(71277),x=a(51936),k=a(1691),w=a(74192),C=a(73193),j=a.n(C),S=a(76711),Z=a.n(S),T=a(93527),K=a(44679),z=a(56773),U=a(14888),R=a(30064),D=a(86684),E=a(68263),B=a(74491),F=a(44194),O=a(47598),I=a(19736),L=a(6844),P=a(31549),A=function(e){return e===L.p$M||e===L.hXJ},N=function(e){var t,a=e.open,n=e.level,s=e.type,o=e.showKbase,l=void 0===o||o,c=e.isEdit,d=e.onCancel,f=e.onSubmit,g=(0,I.useIntl)(),p=R.A.useForm(),m=u()(p,1)[0],v=(0,K.Z)().translateString,y=(0,U.u)((function(e){return e.currentOrg})),M=(0,z.j)((function(e){return e.kbaseResult})),b=(0,z.j)((function(e){return e.currentKbase})),x=(0,O.v)((function(e){return{currentCategory:e.currentCategory,categoryTreeOptions:e.categoryTreeOptions}})),k=x.currentCategory,w=x.categoryTreeOptions;(0,F.useEffect)((function(){c?m.setFieldsValue({name:v(null==k?void 0:k.name),parentUid:(null==k?void 0:k.parentUid)||L.zBg}):(m.resetFields(),m.setFieldsValue({parentUid:null!=k&&k.uid&&k.uid!==L.zBg?k.uid:L.zBg})),m.setFieldsValue({kbUid:null==b?void 0:b.uid}),A(s)&&m.setFieldsValue({ticketCategoryType:s})}),[a,c]);var C=function(){m.validateFields().then(function(){var e=i()(r()().mark((function e(t){var a,i,o;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",t),a=t.parentUid===L.zBg?void 0:t.parentUid,i=A(s)?t.ticketCategoryType:s,o={uid:c?null==k?void 0:k.uid:"",name:t.name,level:n,type:i,parentUid:a,kbUid:t.kbUid,orgUid:null==y?void 0:y.uid},f(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),T.yw.error(g.formatMessage({id:c?"pages.category.update.failed":"pages.category.create.failed"}))}))},S=(0,F.useMemo)((function(){var e,t,a=function e(t){return t.map((function(t){return{title:v(t.title),key:t.key,disabled:t.disabled,children:t.children?e(t.children):void 0}}))}(w||[]);a.length>0&&(null===(e=a[0])||void 0===e?void 0:e.key)===L.zBg&&(a[0].title=g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}));var n=c?null==k?void 0:k.uid:void 0;if(!n)return a;var r=function e(t){var a;t&&(t.disabled=!0,null===(a=t.children)||void 0===a||a.forEach(e))};return function e(t){t&&t.forEach((function(t){var a;t.key===n?r(t):null!==(a=t.children)&&void 0!==a&&a.length&&e(t.children)}))}(a),a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.key)===L.zBg?a:[{title:g.formatMessage({id:"pages.category.drawer.parent.top",defaultMessage:"顶级（无上级）"}),key:L.zBg,children:void 0}].concat(Z()(a))}),[w,c,null==k?void 0:k.uid,g,v]),N=(0,F.useMemo)((function(){return g.formatMessage({id:"pages.category.drawer.parent.placeholder",defaultMessage:"选择上级分类（留空则为顶级）"})}),[g]),q=(0,F.useCallback)((function(e,t){var a=null==t?void 0:t.title;return("string"==typeof a?a:String(null!=a?a:"")).toLowerCase().includes(e.toLowerCase())}),[]),V=(0,F.useMemo)((function(){return{allowClear:!0,placeholder:N,treeData:S,fieldNames:{label:"title",value:"key",children:"children"},treeDefaultExpandAll:!0,treeDataSimpleMode:!1,showSearch:!0,filterTreeNode:q,variant:"outlined"}}),[q,N,S]);return(0,P.jsx)("div",{children:(0,P.jsx)(h.Z,{title:c?g.formatMessage({id:"pages.category.drawer.edit"}):g.formatMessage({id:"pages.category.drawer.create"}),open:a,forceRender:!0,onOk:C,onCancel:d,getContainer:!1,okText:g.formatMessage({id:"pages.category.drawer.save"}),cancelText:g.formatMessage({id:"pages.category.drawer.cancel"}),children:(0,P.jsxs)(R.A,{form:m,name:"categoryForm",submitter:!1,children:[(0,P.jsx)(D.Z,{label:g.formatMessage({id:"pages.category.drawer.name",defaultMessage:"分类名称"}),name:"name",rules:[{required:!0,message:g.formatMessage({id:"pages.category.drawer.name.required",defaultMessage:"请输入名称!"})}],fieldProps:{onKeyDown:function(e){"Enter"===e.key&&C()},placeholder:g.formatMessage({id:"pages.category.drawer.name.placeholder",defaultMessage:"请输入分类名称"})}}),A(s)&&(0,P.jsx)(E.Z,{name:"ticketCategoryType",label:g.formatMessage({id:"pages.category.drawer.ticketType",defaultMessage:"工单类型"}),rules:[{required:!0,message:g.formatMessage({id:"pages.category.drawer.ticketType.required",defaultMessage:"请选择工单类型!"})}],options:[{label:g.formatMessage({id:"ticket.tab.external",defaultMessage:"外部工单"}),value:L.hXJ},{label:g.formatMessage({id:"ticket.tab.internal",defaultMessage:"内部工单"}),value:L.p$M}]}),(0,P.jsx)(R.A.Item,{name:"parentUid",label:g.formatMessage({id:"pages.category.drawer.parent",defaultMessage:"上级分类"}),children:(0,P.jsx)(B.Z,j()({},V))}),l&&(0,P.jsx)(E.Z,{name:"kbUid",label:g.formatMessage({id:"pages.category.drawer.kb"}),allowClear:!0,options:null==M||null===(t=M.data)||void 0===t?void 0:t.content.map((function(e){return{label:v(e.name),value:e.uid}}))})]})})})},q=a(88165),V=a(36125),J=function(e){var t=e.type,a=e.level,n=e.showKbase,s=void 0===n||n,o=(0,I.useIntl)(),C=(0,F.useState)(!0),j=u()(C,2),S=j[0],Z=j[1],R=(0,F.useState)(!1),D=u()(R,2),E=D[0],B=D[1],A=(0,F.useState)(1),J=u()(A,2),H=J[0],W=J[1],X=(0,F.useState)(20),$=u()(X,2),G=$[0],Q=$[1],Y=(0,F.useState)(0),_=u()(Y,2),ee=_[0],te=_[1],ae=(0,F.useState)(""),ne=u()(ae,2),re=ne[0],se=ne[1],ie=(0,U.u)((function(e){return e.currentOrg})),oe=(0,z.j)((function(e){return e.currentKbase})),ue=(0,F.useState)(!1),le=u()(ue,2),ce=le[0],de=le[1],fe=(0,O.v)((function(e){return{categoryTreeOptions:e.categoryTreeOptions,currentCategory:e.currentCategory,setCurrentCategoryUid:e.setCurrentCategoryUid,resetDefaultCategory:e.resetDefaultCategory}})),ge=fe.categoryTreeOptions,pe=fe.currentCategory,me=fe.setCurrentCategoryUid,he=fe.resetDefaultCategory,ve=(0,K.Z)(),ye=ve.translateString,Me=ve.translateStringTranct,be=h.Z.useModal(),xe=u()(be,2),ke=xe[0],we=xe[1],Ce=function(){var e=i()(r()().mark((function e(){var n,i;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(!0),n=s?null==oe?void 0:oe.uid:"",e.next=4,(0,q.HK)(t,null==ie?void 0:ie.uid,n,a,{showLoading:!0,pageSize:G,pageNumber:H-1,searchName:re,loadingMessage:o.formatMessage({id:"loading"}),errorMessage:o.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 4:i=e.sent,V.Z.debug("refreshCategories response: ",null==i?void 0:i.data),B(!1),i&&null!=i&&i.data&&te((null==i?void 0:i.data.totalElements)||0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(e){se(e),W(1),setTimeout((function(){Ce()}),0)},Se=function(e,t){W(e),t&&t!==G&&Q(t),setTimeout((function(){Ce()}),0)},Ze=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z(!1),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=i()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z(!0),de(!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ke=function(){var e=i()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,q.sT)(t,{showLoading:!0,loadingMessage:o.formatMessage({id:"deleting"}),successMessage:o.formatMessage({id:"delete.success"}),errorMessage:o.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})});case 2:e.sent&&Ce();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=i()(r()().mark((function e(t){var a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={showLoading:!0,loadingMessage:o.formatMessage({id:S?"updating":"creating"}),successMessage:o.formatMessage({id:S?"update.success":"create.success"}),errorMessage:o.formatMessage({id:S?"update.error":"create.error",defaultMessage:S?"Update failed":"Create failed"})},!S){e.next=7;break}return e.next=4,(0,q.ht)(t,a);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,(0,q.i8)(t,a);case 9:e.t0=e.sent;case 10:e.t0&&(de(!1),Ce());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,F.useEffect)((function(){s&&(W(1),se(""),Ce())}),[oe]),(0,F.useEffect)((function(){W(1),se(""),he();var e=setTimeout((function(){Ce()}),0);return function(){return clearTimeout(e)}}),[t,he]);return(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{style:{padding:"10px"},children:[(Math.ceil(ee/G)>1||""!==re)&&(0,P.jsx)(v.Z,{placeholder:o.formatMessage({id:"search.category.placeholder",defaultMessage:"搜索分类"}),prefix:(0,P.jsx)(c.Z,{}),suffix:(0,P.jsx)(y.ZP,{type:"text",size:"small",icon:(0,P.jsx)(c.Z,{}),onClick:function(){return je(re)},style:{border:"none",marginRight:"-7px"}}),allowClear:{clearIcon:(0,P.jsx)("span",{onClick:function(e){e.stopPropagation(),se(""),W(1),Ce()}})},value:re,onChange:function(e){var t=e.target.value;se(t),t||(W(1),setTimeout((function(){Ce()}),0))},onPressEnter:function(e){return je(e.currentTarget.value)},style:{marginBottom:"10px"}}),(0,P.jsxs)(M.Z,{gap:"small",wrap:"nowrap",style:{justifyContent:"space-between"},children:[(0,P.jsxs)(M.Z,{gap:"small",children:[(0,P.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,P.jsx)(d.Z,{}),onClick:Ze,children:o.formatMessage({id:"create.category"})}),(0,P.jsx)(y.ZP,{size:"small",icon:(0,P.jsx)(f.Z,{spin:E}),onClick:Ce,loading:E,children:o.formatMessage({id:"refresh"})})]}),""!==(null==pe?void 0:pe.uid)&&(null==pe?void 0:pe.uid)!==L.zBg&&(0,P.jsx)(b.Z,{menu:{items:[{key:"edit",icon:(0,P.jsx)(g.Z,{}),label:o.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:Te},{key:"delete",icon:(0,P.jsx)(p.Z,{}),label:o.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){e.uid!==L.zBg?ke.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(l.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(ye(e.name),"】？"),onOk:function(){Ke(e)},onCancel:function(){},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})}):T.yw.error(o.formatMessage({id:"delete.dept.all.error"}))}(pe)}}]},children:(0,P.jsx)(y.ZP,{size:"small",icon:(0,P.jsx)(m.Z,{})})})]})]}),(0,P.jsx)(x.Z,{defaultSelectedKeys:[null==pe?void 0:pe.uid],selectedKeys:[null==pe?void 0:pe.uid],onSelect:function(e,t){0!==e.length&&me(e[0].toString())},treeData:ge,blockNode:!0,titleRender:function(e){return(0,P.jsx)(k.Z,{title:ye(e.title),children:Me(e.title)})}}),Math.ceil(ee/G)>1&&(0,P.jsxs)("div",{style:{textAlign:"center",padding:"10px 0"},children:[(0,P.jsx)(w.Z,{size:"small",current:H,pageSize:G,total:ee,onChange:Se,onShowSizeChange:Se,showSizeChanger:!1,showLessItems:!0}),(0,P.jsx)("div",{style:{marginTop:"5px",fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:o.formatMessage({id:"pagination.total",defaultMessage:"共 {total} 条"},{total:ee})})]}),ce&&(0,P.jsx)(N,{open:ce,type:t,showKbase:s,isEdit:S,onCancel:function(){de(!1)},onSubmit:ze}),we]})}},88449:function(e,t,a){var n=a(26710);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto",padding:10}}}},56773:function(e,t,a){a.d(t,{j:function(){return d}});var n=a(73193),r=a.n(n),s=a(76711),i=a.n(s),o=a(6844),u=a(26557),l=a(26407),c=a(20744),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,t){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(t){e((function(e){e.kbaseResult.data.content.unshift(t)}))},updateKbase:function(t){e((function(e){var a=e.kbaseResult.data.content,n=a.findIndex((function(e){return e.uid===t.uid}));-1!==n?a[n]=t:console.warn("Kbase with uid ".concat(t.uid," not found."))}))},setKbaseResult:function(t){var a;e({kbaseResult:t}),(null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentKbase:t.data.content[0]})},setCurrentKbase:function(a){var n=t().kbaseResult.data.content,s=n.findIndex((function(e){return e.uid===a.uid}));if(-1!==s){var o=[].concat(i()(n.slice(0,s)),[a],i()(n.slice(s+1))),u=r()(r()({},t().kbaseResult),{},{data:{content:o}});e({kbaseResult:u,currentKbase:a})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:a})},removeKbase:function(a){var n=t().kbaseResult.data.content,s=n.findIndex((function(e){return e.uid===a}));-1!==s?e({kbaseResult:r()(r()({},t().kbaseResult),{},{data:{content:[].concat(i()(n.slice(0,s)),i()(n.slice(s+1)))}})}):console.warn("Kbase not found in cache:",a),t().currentKbase.uid===a&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:o.wKE})))}}]);