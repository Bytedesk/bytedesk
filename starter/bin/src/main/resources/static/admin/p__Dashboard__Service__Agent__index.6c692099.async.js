"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1642],{31806:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(83910),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},r=n(54183),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(o)},58791:function(e,t,n){var i=n(83910),a=n(44194),s=n(85333),r=n(54183),o=function(e,t){return a.createElement(r.Z,(0,i.Z)({},e,{ref:t,icon:s.Z}))},l=a.forwardRef(o);t.Z=l},33798:function(e,t,n){var i=n(90819),a=n.n(i),s=n(89933),r=n.n(s),o=n(45332),l=n.n(o),u=n(74341),d=n(93527),c=n(11591),g=n(67559),f=n(44679),v=n(14888),m=n(6844),p=n(90104),h=n(30064),x=n(68263),S=n(19736),w=n(44194),y=n(53816),b=n(36125),M=n(31549);t.Z=function(e){var t,n,i,s,o=h.A.useForm(),j=l()(o,1)[0],k=(0,S.useIntl)(),Z=(0,f.Z)().translateString,F=(0,v.u)((function(e){return e.currentOrg})),C=(0,w.useState)(),T=l()(C,2),q=T[0],U=T[1],A=(0,w.useState)(),L=l()(A,2),R=L[0],E=L[1],P=(0,w.useState)(),I=l()(P,2),z=I[0],N=I[1],K=(0,w.useState)(""),B=l()(K,2),O=B[0],W=B[1],D=(0,w.useRef)(!1),V=(0,w.useRef)(),Q=(0,w.useMemo)((function(){var t;return null!==(t=e.serviceSettings)&&void 0!==t?t:{}}),[e.serviceSettings]),H=(0,w.useMemo)((function(){var e,t;return null!==(e=null!==(t=null==Q?void 0:Q.draft)&&void 0!==t?t:null==Q?void 0:Q.live)&&void 0!==e?e:void 0}),[Q]),J=(0,w.useCallback)((function(t){var n;null===(n=e.onServiceSettingsChange)||void 0===n||n.call(e,t)}),[e.onServiceSettingsChange]),Y=(0,w.useCallback)((function(e){j.setFieldValue("welcomeTip",e),J({welcomeTip:e})}),[j,J]);(0,w.useEffect)((function(){if(null!=F&&F.uid&&(V.current!==F.uid&&(V.current=F.uid,D.current=!1),!D.current)){D.current=!0;var e=function(){var e=r()(a()().mark((function e(){var t,n,i,s,r,o,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,type:m.QPQ,orgUid:F.uid},e.next=4,(0,g.AP)(t);case 4:n=e.sent,b.Z.debug("TabServiceWelcome queryKbasesByOrg:",n,t),d.yw.destroy(),200===n.code?(E(n),r=(null==n||null===(i=n.data)||void 0===i?void 0:i.content)||[],o=null==H?void 0:H.welcomeKbUid,(l=o||z||(null===(s=r[0])||void 0===s?void 0:s.uid))&&(N(l),j.setFieldValue("welcomeKbUid",l),o!==l&&J({welcomeKbUid:l}))):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,k,null==H?void 0:H.welcomeKbUid,z,j,J]),(0,w.useEffect)((function(){if(null!=F&&F.uid&&z){var e=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.yw.loading(k.formatMessage({id:"loading",defaultMessage:"Loading"})),t={pageNumber:0,pageSize:50,orgUid:F.uid,kbUid:z},e.next=4,(0,c.pf)(t);case 4:n=e.sent,b.Z.debug("TabServiceWelcome queryFaqsByOrg:",n,t),d.yw.destroy(),200===n.code?U(n):d.yw.error(n.message);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){}}}),[null==F?void 0:F.uid,z,k]),(0,w.useEffect)((function(){if(H){var e=null==H?void 0:H.welcomeFaqs,t=Array.isArray(H.welcomeFaqUids)?H.welcomeFaqUids:Array.isArray(e)?e.map((function(e){return null==e?void 0:e.uid})).filter(Boolean):[];j.setFieldValue("welcomeFaqUids",t)}}),[j,null==q||null===(t=q.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length,null==H?void 0:H.welcomeFaqUids,H]);var G=(0,w.useCallback)((function(e){N(e),j.setFieldValue("welcomeFaqUids",[]),J({welcomeKbUid:e,welcomeFaqUids:[]})}),[J,j]);return(0,w.useEffect)((function(){var e=Z(null==H?void 0:H.welcomeTip);void 0!==e&&O!==e&&W(e),null!=H&&H.welcomeKbUid&&(j.setFieldValue("welcomeKbUid",H.welcomeKbUid),z!==H.welcomeKbUid&&N(H.welcomeKbUid))}),[Z,null==H?void 0:H.welcomeTip,null==H?void 0:H.welcomeKbUid,O,j,z,null==R||null===(n=R.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length]),(0,M.jsxs)(h.A,{form:j,submitter:!1,style:{marginLeft:"20px"},children:[(0,M.jsx)(h.A.Item,{name:"welcomeTip",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"agent.settings.welcome.tip"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeTip"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),tooltip:k.formatMessage({id:"agent.settings.welcome.tip"}),rules:[{required:!0,message:k.formatMessage({id:"agent.settings.welcome.tip.required"})}],children:(0,M.jsx)(y.Z,{placeholder:k.formatMessage({id:"agent.settings.welcome.tip.placeholder"}),value:O,toolbarKeys:(0,p.eD)(),style:{height:"150px",width:"600px"},maxLength:200,onChange:Y})}),(0,M.jsx)(x.Z,{name:"welcomeKbUid",width:"md",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.select",defaultMessage:"选择欢迎语常见问题知识库"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeKbUid"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),options:null==R||null===(i=R.data)||void 0===i||null===(i=i.content)||void 0===i?void 0:i.map((function(e){return{label:Z(e.name)||e.name,value:e.uid}})),fieldProps:{onChange:function(e){return G(e)},allowClear:!0,placeholder:(0,M.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"})}}),(0,M.jsx)(x.Z,{name:"welcomeFaqUids",width:"md",label:(0,M.jsxs)("span",{children:[k.formatMessage({id:"menu.kbase.faq.welcome"}),(0,M.jsx)(u.Z,{type:"service",keys:["welcomeFaqUids"],live:null==Q?void 0:Q.live,draft:null==Q?void 0:Q.draft})]}),options:null==q||null===(s=q.data)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.map((function(e){return{label:Z(e.question),value:e.uid}})),fieldProps:{mode:"multiple",allowClear:!0,placeholder:(0,M.jsx)(S.FormattedMessage,{id:"choose",defaultMessage:"Choose"}),onChange:function(e){return J({welcomeFaqUids:e})}}})]})}},33949:function(e,t,n){n.r(t),n.d(t,{default:function(){return he}});var i=n(44194),a=n(31167),s=n(19736),r=n(76711),o=n.n(r),l=n(90819),u=n.n(l),d=n(89933),c=n.n(d),g=n(73193),f=n.n(g),v=n(45332),m=n.n(v),p=n(85255),h=n(3925),x=n(9428),S=n(48769),w=n(71876),y=n(12792),b=n(66810),M=n(65513),j=n(77359),k=n(74840),Z=n(29337),F=n(68779),C=n(12322),T=n(31806),q=n(34600),U=n(56482),A=n(10162),L=n(59304),R=n(54881),E=n(47944),P=n(80556),I=n(55785),z=n(79866),N=n(93527),K=n(50989),B=n(14888),O=n(88449),W=n(26710),D=n(6844),V=n(61952),Q=n(21914),H=(n(47460),n(2061)),J=(n(15012),n(42670)),Y=n(89105),G=n(23312),X=n(1725),_=n(33798),$=n(20585),ee=(n(81005),n(35165)),te=n(58791),ne=n(36125),ie=n(31549),ae=function(){var e=(0,s.useIntl)(),t=(0,B.u)((function(e){return e.currentOrg})),n=(0,O.Z)(),r=n.leftSiderStyle,l=(n.contentStyle,(0,W.Z)().isDarkMode),d=(0,i.useState)(!1),g=m()(d,2),v=g[0],D=g[1],ae=(0,i.useState)([]),se=m()(ae,2),re=se[0],oe=se[1],le=(0,i.useState)(),ue=m()(le,2),de=ue[0],ce=ue[1],ge=(0,i.useState)(""),fe=m()(ge,2),ve=fe[0],me=fe[1],pe=(0,i.useState)("tips"),he=m()(pe,2),xe=he[0],Se=he[1],we=(0,i.useState)(!1),ye=m()(we,2),be=ye[0],Me=ye[1],je=(0,i.useState)(null),ke=m()(je,2),Ze=ke[0],Fe=ke[1],Ce=(0,i.useMemo)((function(){return re.find((function(e){return e.uid===de}))||null}),[re,de]),Te=(0,i.useState)(!1),qe=m()(Te,2),Ue=qe[0],Ae=qe[1],Le=(0,i.useState)(!1),Re=m()(Le,2),Ee=Re[0],Pe=Re[1],Ie=(0,V.z)((function(e){return{setCurrentAgentSettings:e.setCurrentAgentSettings,currentAgentSettings:e.currentAgentSettings}})),ze=Ie.setCurrentAgentSettings,Ne=Ie.currentAgentSettings,Ke=(0,i.useState)(!1),Be=m()(Ke,2),Oe=Be[0],We=Be[1],De=(0,i.useRef)(""),Ve=(0,i.useMemo)((function(){var e;return null!==(e=null!=Ne?Ne:Ce)&&void 0!==e?e:null}),[Ne,Ce]),Qe=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftServiceSettings||Ne.serviceSettings||{};ze(f()(f()({},Ne),{},{draftServiceSettings:f()(f()({},t),e)}))}}),[Ne,ze]),He=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftInviteSettings||Ne.inviteSettings||{};ze(f()(f()({},Ne),{},{draftInviteSettings:f()(f()({},t),e)}))}}),[Ne,ze]),Je=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftMessageLeaveSettings||Ne.messageLeaveSettings||{};ze(f()(f()({},Ne),{},{draftMessageLeaveSettings:f()(f()({},t),e)}))}}),[Ne,ze]),Ye=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftWorktimeSettings||Ne.worktimeSettings||{};ze(f()(f()({},Ne),{},{draftWorktimeSettings:f()(f()({},t),e)}))}}),[Ne,ze]),Ge=(0,i.useCallback)((function(e){if(Ne){var t=Ne.draftQueueSettings||Ne.queueSettings||{};ze(f()(f()({},Ne),{},{draftQueueSettings:f()(f()({},t),e)}))}}),[Ne,ze]),Xe=(0,i.useCallback)((function(e){Ne&&ze(f()(f()({},Ne),e))}),[Ne,ze]),_e=(0,i.useMemo)((function(){if(!ve)return re;var e=ve.toLowerCase();return re.filter((function(t){var n=(t.name||t.uid||"").toLowerCase(),i=(t.description||"").toLowerCase();return n.includes(e)||i.includes(e)}))}),[re,ve]),$e=(0,i.useCallback)(function(){var e=c()(u()().mark((function e(n,i){var a,s,r,o,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=2;break}return e.abrupt("return");case 2:return D(!0),a="welcome",e.prev=4,r=(null!=n?n:"").trim(),o={orgUid:t.uid,pageNumber:0,pageSize:100,searchText:r||void 0},e.next=9,(0,K.u9)(o);case 9:l=e.sent,ne.Z.debug("加载客服配置模板列表: ",l,o),d=(null==l||null===(s=l.data)||void 0===s?void 0:s.content)||[],oe(d),!(d.length>0)||de&&d.some((function(e){return e.uid===de}))||(ce(d[0].uid),null!=i&&i.keepActive||Se(a));case 14:return e.prev=14,D(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[4,,14,17]])})));return function(t,n){return e.apply(this,arguments)}}(),[null==t?void 0:t.uid,de]);(0,i.useEffect)((function(){$e(ve)}),[null==t?void 0:t.uid]),(0,i.useEffect)((function(){Ce?(ze(Ce),De.current=JSON.stringify(null!=Ce?Ce:{}),We(!1)):(ze(null),De.current=JSON.stringify({}),We(!1))}),[de]),(0,i.useEffect)((function(){if(Ce)try{var e=JSON.stringify(null!=Ne?Ne:{});We(e!==De.current)}catch(e){We(!0)}}),[Ne,null==Ce?void 0:Ce.uid]);var et=function(){var n=c()(u()().mark((function n(i){var a,s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=null!=i?i:Ce)&&a.uid){n.next=3;break}return n.abrupt("return");case 3:return s={uid:a.uid,orgUid:null==t?void 0:t.uid,pageNumber:0,pageSize:100},n.next=6,(0,K.SJ)(s);case 6:r=n.sent,console.log("删除客服配置模板结果：",r,s),r&&200===r.code?(N.yw.success(e.formatMessage({id:"common.deleted",defaultMessage:"删除成功"})),$e(ve)):N.yw.error((null==r?void 0:r.message)||"删除失败");case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),tt=function(){var n=c()(u()().mark((function n(i,a){var s,r;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s={uid:i,orgUid:null==t?void 0:t.uid},!a){n.next=8;break}return n.next=5,(0,K.RB)(s);case 5:n.t0=n.sent,n.next=11;break;case 8:return n.next=10,(0,K.iO)(s);case 10:n.t0=n.sent;case 11:(r=n.t0)&&200===r.code?(N.yw.success(e.formatMessage({id:a?"common.enabled":"common.disabled",defaultMessage:a?"已启用":"已停用"})),$e(ve)):N.yw.error((null==r?void 0:r.message)||"操作失败"),n.next=19;break;case 15:n.prev=15,n.t1=n.catch(0),console.error("切换启用状态失败:",n.t1),N.yw.error("操作失败");case 19:case"end":return n.stop()}}),n,null,[[0,15]])})));return function(e,t){return n.apply(this,arguments)}}(),nt=function(e,t){if(e){var n={};return t.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},it=function(e){if(e){var t=nt(e,["language","autoPopup","showTopTip","topTip","topTipStart","topTipEnd","showRateBtn","autoInviteRate","inviteRateTip","rateMsgCount","showPreForm","preFormRequired","preForm","showPreSearch","showHistory","showInputAssociation","showCaptcha","welcomeTip","welcomeFaqUids","welcomeKbUid","enableWorkflow","workflowUid","autoCloseMin","autoCloseTip","agentCloseTip","queueTip","leavemsgTip","showRightIframe","rightIframeUrl","showFaqs","faqUids","faqKbUid","showQuickFaqs","quickFaqUids","quickFaqKbUid","showGuessFaqs","guessFaqUids","showHotFaqs","hotFaqUids","showShortcutFaqs","shortcutFaqUids","relatedQuestionGuide","enableProactiveTrigger","noResponseTimeout","proactiveMessage","maxProactiveCount","proactiveInterval","triggerConditions","proactiveFaqUids","showLogo","validateUntil"]),n=function(n,i){if(void 0===t[n]){var a=null==e?void 0:e[i];if(Array.isArray(a)){var s=a.map((function(e){return null==e?void 0:e.uid})).filter(Boolean);s.length>0&&(t[n]=s)}}};n("welcomeFaqUids","welcomeFaqs"),n("faqUids","faqs"),n("quickFaqUids","quickFaqs"),n("guessFaqUids","guessFaqs"),n("hotFaqUids","hotFaqs"),n("shortcutFaqUids","shortcutFaqs"),n("proactiveFaqUids","proactiveFaqs");var i=function(e){if(e)return nt(e,["smile","image","file","rate","leavemsg","orderSelector","ticket","audio","video","tel","order"])}(e.toolbar);return f()(f()({},t),i?{toolbar:i}:{})}},at=function(e){if(e)return nt(e,["name","description","defaultTemplate","show","text","icon","delay","loop","loopDelay","loopCount","messageList","targetedInvite","targetedInviteUrls","smartTrigger","pageStayTriggerSeconds","scrollTrigger","scrollTriggerPerceninviteSettinge","exitIntentTrigger","referrerTrigger","referrerPatterns","deviceTypes","visitorSegmentation","newVisitorMessage","returningVisitorMessage","vipVisitorMessage","inviteStyle","inviteAnimation","abTesting"])},st=function(e){if(e)return nt(e,["name","description","color","order"])},rt=function(e){if(e)return nt(e,["messageLeaveEnabled","messageLeaveTip","messageLeaveAgentUid","messageLeaveNotify","messageLeaveNotifyType","messageLeaveNotifyEmail","messageLeaveNotifyMobile","messageLeaveForm"])},ot=function(e){if(e)return nt(e,["queueRobot","showQueuePosition","showEstimatedWaitTime","avgWaitTimePerPerson","maxWaiting","maxWaitTime","queueTip","queueReadyTip","queueNoticeBatchWindowMs"])},lt=function(e){if(e)return nt(e,["enabled","regularWorktimes","specialWorktimes","holidays"])},ut=function(e){if(e)return nt(e,["autoReplyEnabled","autoReplyType","autoReplyUid","autoReplyContentType","autoReplyContent","kbUid"])},dt=function(e){if(e)return nt(e,["name","description","defaultTemplate","enabled","rateDownTagList","maxTagSelection","allowCustomFeedback","maxFeedbackLength","requireFollowup","showThankYouMessage","thankYouMessage","triggerSatisfactionSurvey","markForQualityInspection","offerHumanAgent"])},ct=function(e){if(e)return nt(e,["name","description","needReview","reviewTimeType","reviewStartTime","reviewEndTime","reviewMethod","reviewTimeoutMinutes"])},gt=function(){var n=c()(u()().mark((function n(){var i,a,s,r,o,l,d;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ce&&Ce.uid){n.next=3;break}return N.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:return Ae(!0),n.prev=4,i=Ne&&Ne.uid===Ce.uid?Ne:Ce,a=function(e,t){return f()(f()({},e||{}),t||{})},s={uid:Ce.uid,orgUid:null==t?void 0:t.uid,name:null==i?void 0:i.name,description:null==i?void 0:i.description,isDefault:null==i?void 0:i.isDefault,enabled:null==i?void 0:i.enabled,serviceSettings:it(a(null==i?void 0:i.serviceSettings,null==i?void 0:i.draftServiceSettings)),inviteSettings:at(a(null==i?void 0:i.inviteSettings,null==i?void 0:i.draftInviteSettings)),intentionSettings:st(a(null==i?void 0:i.intentionSettings,null==i?void 0:i.draftIntentionSettings)),maxThreadCount:null==i?void 0:i.maxThreadCount,timeoutRemindEnabled:null==i?void 0:i.timeoutRemindEnabled,timeoutRemindTime:null==i?void 0:i.timeoutRemindTime,timeoutRemindTip:null==i?void 0:i.timeoutRemindTip,messageLeaveSettings:rt(a(null==i?void 0:i.messageLeaveSettings,null==i?void 0:i.draftMessageLeaveSettings)),worktimeSettings:lt(a(null==i?void 0:i.worktimeSettings,null==i?void 0:i.draftWorktimeSettings)),autoReplySettings:ut(a(null==i?void 0:i.autoReplySettings,null==i?void 0:i.draftAutoReplySettings)),queueSettings:ot(a(null==i?void 0:i.queueSettings,null==i?void 0:i.draftQueueSettings)),rateDownSettings:dt(a(null==i?void 0:i.rateDownSettings,null==i?void 0:i.draftRateDownSettings)),agentStatusSettings:ct(a(null==i?void 0:i.agentStatusSettings,null==i?void 0:i.draftAgentStatusSettings))},n.next=10,(0,K.wU)(s);case 10:r=n.sent,console.log("保存客服配置模板结果：",r,s),r&&200===r.code?(N.yw.success(e.formatMessage({id:"common.saved",defaultMessage:"保存成功"})),d=null!==(o=null!==(l=null==r?void 0:r.data)&&void 0!==l?l:i)&&void 0!==o?o:{},De.current=JSON.stringify(d),We(!1),$e(ve,{keepActive:!0})):N.yw.error((null==r?void 0:r.message)||"保存失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("保存失败:",n.t0),N.yw.error("保存失败");case 19:return n.prev=19,Ae(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),ft=function(){var n=c()(u()().mark((function n(){var i,a,s;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=Ce&&Ce.uid){n.next=3;break}return N.yw.warning(e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})),n.abrupt("return");case 3:if(Pe(!0),n.prev=4,!Oe){n.next=8;break}return n.next=8,gt();case 8:return i={uid:Ce.uid,orgUid:null==t?void 0:t.uid},n.next=11,(0,K.Xy)(i);case 11:(a=n.sent)&&200===a.code?(N.yw.success(e.formatMessage({id:"common.published",defaultMessage:"发布成功"})),De.current=JSON.stringify(null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{}),We(!1),$e(ve)):N.yw.error((null==a?void 0:a.message)||"发布失败"),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(4),console.error("发布失败:",n.t0),N.yw.error("发布失败");case 19:return n.prev=19,Pe(!1),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,15,19,22]])})));return function(){return n.apply(this,arguments)}}(),vt=(0,i.useMemo)((function(){return null!=Ce&&Ce.uid?[{key:"welcome",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(k.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"agent.settings.service.welcome",defaultMessage:"欢迎语设置"})]}),children:(0,ie.jsx)(_.Z,{serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})},{key:"tips",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(Z.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"agent.settings.service.tips",defaultMessage:"提示信息"})]}),children:(0,ie.jsx)(X.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})},{key:"service",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(F.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"agent.settings.service",defaultMessage:"服务设置"})]}),children:(0,ie.jsx)(G.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},agentMeta:{maxThreadCount:null==Ve?void 0:Ve.maxThreadCount,timeoutRemindTime:null==Ve?void 0:Ve.timeoutRemindTime},onServiceSettingsChange:Qe,onAgentMetaChange:Xe})},{key:"rate",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(C.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"rate",defaultMessage:"Rate"})]}),children:(0,ie.jsx)(Q.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe})},{key:"messageLeave",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(T.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"agent.settings.message.leave",defaultMessage:"Leave Message"})]}),children:(0,ie.jsx)($.Z,{variant:"agent",messageLeaveSettings:{live:null==Ve?void 0:Ve.messageLeaveSettings,draft:null==Ve?void 0:Ve.draftMessageLeaveSettings},onMessageLeaveSettingsChange:Je})},{key:"queue",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(te.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"agent.settings.queue",defaultMessage:"排队设置"})]}),children:(0,ie.jsx)(ee.Z,{variant:"agent",queueSettings:{live:null==Ve?void 0:Ve.queueSettings,draft:null==Ve?void 0:Ve.draftQueueSettings},onQueueSettingsChange:Ge})}].concat(o()([]),[{key:"toolbar",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(q.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"toolbar",defaultMessage:"Toolbar"})]}),children:(0,ie.jsx)(J.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},settingsUid:Ce.uid,isActive:"toolbar"===xe,onServiceSettingsChange:Qe})},{key:"right",label:(0,ie.jsxs)("span",{children:[(0,ie.jsx)(U.Z,{})," ",(0,ie.jsx)(s.FormattedMessage,{id:"right",defaultMessage:"Right"})]}),children:(0,ie.jsx)(H.Z,{variant:"agent",serviceSettings:{live:null==Ve?void 0:Ve.serviceSettings,draft:null==Ve?void 0:Ve.draftServiceSettings},onServiceSettingsChange:Qe,settingsUid:Ce.uid,isActive:"right"===xe})}],o()([]),o()([])):[]}),[null==Ce?void 0:Ce.uid,Ve,Qe,He,Je,Ye,Ge,e,xe]);return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsxs)(p.Z,{style:{minHeight:"calc(100vh - 160px)"},children:[(0,ie.jsx)(p.Z.Panel,{defaultSize:"20%",min:"14%",max:"40%",style:r,children:(0,ie.jsxs)(z.Z,{title:e.formatMessage({id:"agent.settings.templates",defaultMessage:"模板列表"}),extra:(0,ie.jsx)(h.ZP,{size:"small",icon:(0,ie.jsx)(A.Z,{}),type:"primary",onClick:function(){Fe(null),Me(!0)},children:(0,ie.jsx)(s.FormattedMessage,{id:"common.new",defaultMessage:"新建"})}),bodyStyle:{padding:8},loading:v,children:[(0,ie.jsx)("div",{style:{margin:"0 0 8px 0"},children:(0,ie.jsxs)(x.Z.Compact,{style:{width:"100%"},children:[(0,ie.jsx)(S.Z,{placeholder:e.formatMessage({id:"agent.settings.template.search",defaultMessage:"搜索模板名称"}),value:ve,onChange:function(e){return me(e.target.value)},onPressEnter:function(e){$e(ve)},allowClear:!0,size:"middle"}),(0,ie.jsx)(h.ZP,{type:"primary",size:"middle",onClick:function(){return $e(ve)},children:"搜索"})]})}),(0,ie.jsx)("div",{style:{overflow:"auto",maxHeight:"calc(100vh - 280px)"},children:(0,ie.jsx)(w.Z,{dataSource:_e,locale:{emptyText:(0,ie.jsx)(y.Z,{description:e.formatMessage({id:"empty",defaultMessage:"暂无数据"}),image:y.Z.PRESENTED_IMAGE_SIMPLE})},renderItem:function(e){return(0,ie.jsx)(w.Z.Item,{style:de===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer",borderRadius:6,marginBottom:8,padding:10}:{cursor:"pointer",borderRadius:6,marginBottom:8,padding:10},onClick:function(){return ce(e.uid)},children:(0,ie.jsx)(w.Z.Item.Meta,{title:(0,ie.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ie.jsx)("div",{style:{fontWeight:500,flex:1},children:e.name||e.uid}),(0,ie.jsx)(x.Z,{size:4,children:e.isDefault?(0,ie.jsx)(b.Z,{color:"blue",children:"默认"}):null})]}),description:e.description?(0,ie.jsx)("div",{style:{color:l?"#aaa":"#999",fontSize:12},children:e.description}):null})},e.uid)}})})]})}),(0,ie.jsx)(p.Z.Panel,{children:Ce?(0,ie.jsx)(z.Z,{title:(0,ie.jsxs)(x.Z,{children:[(0,ie.jsxs)("span",{children:[e.formatMessage({id:"agent.settings.editing",defaultMessage:"编辑模板"}),": ",Ce.name||Ce.uid]}),(0,ie.jsx)(M.Z,{checked:Ce.enabled,onChange:function(e){return tt(Ce.uid,e)},checkedChildren:e.formatMessage({id:"common.enabled",defaultMessage:"启用"}),unCheckedChildren:e.formatMessage({id:"common.disabled",defaultMessage:"停用"})}),(0,ie.jsx)(h.ZP,{size:"small",icon:(0,ie.jsx)(L.Z,{}),onClick:function(e){var t;e.stopPropagation(),Fe(null!=(t=Ce)?t:Ce),Me(!0)},children:"编辑"}),(0,ie.jsx)(j.Z,{title:e.formatMessage({id:"common.delete.confirm",defaultMessage:"确定要删除吗?"}),onConfirm:function(e){null==e||e.stopPropagation(),et(Ce)},onCancel:function(e){return null==e?void 0:e.stopPropagation()},okText:e.formatMessage({id:"common.confirm",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"common.cancel",defaultMessage:"取消"}),children:(0,ie.jsx)(h.ZP,{size:"small",danger:!0,icon:(0,ie.jsx)(R.Z,{}),onClick:function(e){e.stopPropagation()},children:"删除"})}),Ce.isDefault?(0,ie.jsx)(b.Z,{color:"blue",children:"默认"}):null]}),extra:(0,ie.jsxs)(x.Z,{children:[(0,ie.jsx)(j.Z,{title:"发布到线上环境",description:"只有发布之后，才会应用到线上环境",okText:"继续发布",cancelText:"取消",onConfirm:function(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),ft()},onCancel:function(e){var t;return null==e||null===(t=e.stopPropagation)||void 0===t?void 0:t.call(e)},children:(0,ie.jsx)(h.ZP,{onClick:function(e){return e.stopPropagation()},loading:Ee,type:"default",icon:(0,ie.jsx)(E.Z,{}),children:(0,ie.jsx)(s.FormattedMessage,{id:"common.publish",defaultMessage:"发布"})})}),(0,ie.jsx)(h.ZP,{onClick:function(){Ce&&(ze(Ce),De.current=JSON.stringify(null!=Ce?Ce:{}),We(!1))},disabled:!Oe,icon:(0,ie.jsx)(P.Z,{}),children:(0,ie.jsx)(s.FormattedMessage,{id:"common.reset",defaultMessage:"重置"})}),(0,ie.jsx)(h.ZP,{type:"primary",loading:Ue,onClick:gt,disabled:!Oe,icon:(0,ie.jsx)(I.Z,{}),children:(0,ie.jsx)(s.FormattedMessage,{id:"common.save",defaultMessage:"保存"})})]}),children:(0,ie.jsx)(a.Z,{activeKey:xe,onChange:Se,items:vt,style:{minHeight:"calc(100vh - 280px)"}})}):(0,ie.jsx)(z.Z,{children:(0,ie.jsx)(y.Z,{description:e.formatMessage({id:"agent.settings.template.select",defaultMessage:"请从左侧选择模板"})})})})]}),(0,ie.jsx)(Y.Z,{open:be,onOpenChange:Me,orgUid:(null==t?void 0:t.uid)||"",record:Ze,onSuccess:function(){Me(!1),$e(ve)}})]})},se=n(73693),re=n(84176),oe=n.n(re);function le(e){return ue.apply(this,arguments)}function ue(){return(ue=c()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.request)("/api/v1/agent/status/query/org",{method:"GET",params:f()(f()({},t),{},{channel:D.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var de=n(65819),ce=n(86307),ge=n(61107),fe=n(96596),ve=n.n(fe),me=["current","pageSize"],pe=function(){var e=(0,s.useIntl)(),t=(0,i.useRef)(),n=(0,i.useState)(1),a=m()(n,2),r=a[0],o=a[1],l=(0,i.useState)(10),d=m()(l,2),g=d[0],v=d[1],p=(0,B.u)((function(e){return e.currentOrg})),x=[{dataIndex:"index",valueType:"indexBorder"},{title:(0,ie.jsx)(s.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"agent",copyable:!0,tooltip:(0,ie.jsx)(s.FormattedMessage,{id:"agent.tooltip.nickname"}),render:function(e,t){var n;return(0,ie.jsx)(ie.Fragment,{children:null==t||null===(n=t.agent)||void 0===n?void 0:n.nickname})}},{title:(0,ie.jsx)(s.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,hideInSearch:!1,tooltip:(0,ie.jsx)(s.FormattedMessage,{id:"agent.tooltip.status"}),valueEnum:{AVAILABLE:{text:e.formatMessage({id:"agent.status.available"}),status:"Success"},OFFLINE:{text:e.formatMessage({id:"agent.status.offline"}),status:"Error"},BUSY:{text:e.formatMessage({id:"agent.status.busy"}),status:"Warning"}},render:function(e,t){return"AVAILABLE"===t.status?(0,ie.jsx)(b.Z,{color:"green",children:(0,ie.jsx)(s.FormattedMessage,{id:"agent.status.available"})}):"OFFLINE"===t.status?(0,ie.jsx)(b.Z,{color:"red",children:(0,ie.jsx)(s.FormattedMessage,{id:"agent.status.offline"})}):"BUSY"===t.status?(0,ie.jsx)(b.Z,{color:"orange",children:(0,ie.jsx)(s.FormattedMessage,{id:"agent.status.busy"})}):void 0}},{title:(0,ie.jsx)(s.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,sortDirections:["descend","ascend"],hideInSearch:!0,tooltip:(0,ie.jsx)(s.FormattedMessage,{id:"agent.tooltip.createdAt"}),render:function(e,t,n,i){return ve()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],S=function(){var e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ne.Z.debug("handleExportExcel",r,g),t=localStorage.getItem(D.LA8),window.open((0,de.kG)()+"/api/v1/agent/status/export?"+new URLSearchParams({orgUid:(null==p?void 0:p.uid)||"",pageNumber:String(r-1),pageSize:String(g),accessToken:t||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ie.jsx)(ce.Z,{columns:x,actionRef:t,cardBordered:!0,rowClassName:function(){return"cursor-pointer"},request:function(){var e=c()(u()().mark((function e(t,n,i){var a,s,r,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ne.Z.debug("request:",t,n,i),a=t.current,s=t.pageSize,r=oe()(t,me),o(a),v(s),l=f()({pageNumber:a-1,pageSize:s,orgUid:null==p?void 0:p.uid},r),e.next=7,le(l);case 7:return d=e.sent,ne.Z.debug("queryAgentStatusByOrg response:",l,d),200===d.code||N.yw.error(d.message),e.abrupt("return",{data:null==d?void 0:d.data.content,success:!0,total:null==d?void 0:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:function(e,t){o(e),v(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"agent.status.list"}),toolBarRender:function(){return[(0,ie.jsx)(h.ZP,{onClick:function(){t.current&&t.current.reload()},icon:(0,ie.jsx)(P.Z,{}),children:(0,ie.jsx)(s.FormattedMessage,{id:"refresh",defaultMessage:"Refresh"})},"refresh"),(0,ie.jsx)(h.ZP,{onClick:S,type:"primary",icon:(0,ie.jsx)(ge.Z,{}),children:(0,ie.jsx)(s.FormattedMessage,{id:"export.excel",defaultMessage:"Export Excel"})},"export")]}})},he=function(){return(0,ie.jsx)(a.Z,{defaultActiveKey:"table",style:{padding:"10px"},items:[{key:"table",label:(0,ie.jsx)(s.FormattedMessage,{id:"menu.agent.table",defaultMessage:"客服账号"}),children:(0,ie.jsx)(se.Z,{})},{key:"settings",label:(0,ie.jsx)(s.FormattedMessage,{id:"menu.agent.settings",defaultMessage:"客服配置"}),children:(0,ie.jsx)(ae,{})},{key:"agentStatus",label:(0,ie.jsx)(s.FormattedMessage,{id:"action.tab.agentStatus",defaultMessage:"Agent Status"}),children:(0,ie.jsx)(pe,{})}]})}}}]);